/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var yM=Object.defineProperty,bM=(e,r,t)=>r in e?yM(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,E=(e,r,t)=>(bM(e,typeof r!="symbol"?r+"":r,t),t),HC=(e,r,t)=>{if(!r.has(e))throw TypeError("Cannot "+t)},VC=(e,r,t)=>(HC(e,r,"read from private field"),t?t.call(e):r.get(e)),NC=(e,r,t)=>{if(r.has(e))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(e):r.set(e,t)},Ks=(e,r,t,i)=>(HC(e,r,"write to private field"),i?i.call(e,t):r.set(e,t),t),zC,q=class{static cacheFlags(e=navigator.platform,r=navigator.userAgent){const t=this;t._isLinux=!!e.match(/Linux/),t._isMac=!!e.match(/Mac/),t._isWindows=!!e.match(/Win32/),t._isMobile=!!(r.match(/Mobile|Opera Mini|Opera Mobi|Puffin/)||typeof globalThis.orientation=="number"),t._isWebkit=!!(r.match(/WebKit/)&&!r.match(/Edg/)),t._firefoxVersion=t.getVersion(r,/Firefox\/(\d+)\./),t._isFirefox=t._firefoxVersion>0,t._chromeVersion=t.getVersion(r,/Chrom(?:e|ium)\/(\d+)\./),t._isChrome=t._chromeVersion>0,t._isSafari=!!r.match(/Safari/)&&!t._isChrome,t._isMobileSafari=!!r.match(/Mobile.*Safari/),t._safariVersion=t.getVersion(r,/Version\/(.*).Safari/),t._isAndroid=!!r.match(/Android/g)}static get supportsOverflowClip(){if(this._supportsOverflowClip==null){const e=document.createElement("div");e.style.overflow="clip",e.style.display="none",document.documentElement.appendChild(e),this._supportsOverflowClip=e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("overflow")==="clip",e.remove()}return this._supportsOverflowClip}static get supportsSticky(){return!0}static getVersion(e,r){const t=e.match(r);return t?parseFloat(t[1]):0}static get isTouchDevice(){return this._isTouchDevice===void 0&&(this._isTouchDevice=globalThis.matchMedia("(pointer:coarse)").matches),this._isTouchDevice}static get isHoverableDevice(){return this._isHoverableDevice===void 0&&(this._isHoverableDevice=globalThis.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}static get isBrowserEnv(){return typeof window!="undefined"}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isAndroid(){return this._isAndroid}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get safariVersion(){return this._safariVersion}static get isMobileSafari(){return this._isMobileSafari}static get isMobile(){return this._isMobile}static get platform(){const e=this;return e._isLinux?"linux":e._isMac?"mac":e._isWindows?"windows":e._isAndroid?"android":e._isMobileSafari?"ios":null}static get supportsPassive(){return!0}static get supportsRandomUUID(){if(this._supportsRandomUUID===void 0)try{this._supportsRandomUUID=globalThis.crypto.randomUUID().length>0}catch(e){this._supportsRandomUUID=!1}return this._supportsRandomUUID}static get storageAvailable(){let e,r;try{return e=localStorage,r="__storage_test__",e.setItem(r,r),e.removeItem(r),!0}catch(t){return t instanceof DOMException&&(t.code===22||t.code===1014||t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e.length!==0}}static setLocalStorageItem(e,r){this.storageAvailable&&localStorage.setItem(e,r)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static searchParam(e,r=null,t=document.location.search){const i=new RegExp(`[?&]${e}=?([^&]*)`),n=t.match(i);return n&&n[1]||r}static getCookie(e){const r=encodeURIComponent(e)+"=",t=document.cookie.split(";");for(let i=0;i<t.length;i++){let n=t[i];for(;n.charAt(0)===" ";)n=n.substring(1,n.length);if(n.indexOf(r)===0)return decodeURIComponent(n.substring(r.length,n.length))}return""}static download(e,r){const t=document.createElement("a");t.download=e,t.href=r||e,t.style.cssText="display:none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}static downloadBlob(e,r){const t=globalThis.URL.createObjectURL(e);this.download(r,t),globalThis.URL.revokeObjectURL(t)}static get queryString(){var e;const r=new URL(globalThis.location.href).searchParams;return(e=Object.fromEntries)==null?void 0:e.call(Object,r.entries())}static copyToClipboard(e){let r=!0;const t=document.createElement("textarea");t.value=e,t.style.height=t.style.width=0,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(i){r=!1}return t.remove(),r}static isBryntumOnline(e){return e=Array.isArray(e)?e:[e],!!(/^(www\.)?bryntum\.com/.test(globalThis.location.host)||e!=null&&e.some(r=>this.queryString[r]!=null))}static get isCSP(){const{bryntum:e,document:r}=globalThis;return e.CSP==null&&(e.CSP=!!r.querySelector('meta[http-equiv="Content-Security-Policy"]')),e.CSP}};E(q,"supportsPointerEvents",!!(globalThis.PointerEvent||globalThis.MSPointerEvent)),E(q,"supportsPointerEventConstructor",typeof PointerEvent!="undefined"),E(q,"PointerEventConstructor",globalThis.PointerEvent||globalThis.CustomEvent),E(q,"isPhone",(zC=globalThis.matchMedia)==null?void 0:zC.call(globalThis,"(max-height:414px) or (max-width:414px)").matches),q.isBrowserEnv&&q.cacheFlags(),q._$name="BrowserHelper";var WC,GC,UC,YC,qC=/([a-z])([A-Z])/g,CM=/[\n\r]/g,SM=/[.*+?^${}()|[\]\\]/g,DM=/[&<]/,wM=/(^[^a-z]+[^\w]+)/gi,EM=/\s+/,xM=/^[^a-z]+|[^\w:.-]+/gi,RM=(e,r)=>GC[r.toLowerCase()]||String.fromCharCode(parseInt(r.substr(2),10)),TM=(e,r)=>WC[r],MM=(e,r,t)=>`${r}-${t.toLowerCase()}`,IM=(e,r,t)=>`${r} ${t.toLowerCase()}`,PM=e=>e?`_x${[...e].map(r=>r.charCodeAt(0).toString(16)).join("")}`:"__blank__",KC={},XC={},wi=class{static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){const r=KC[e];return r||(KC[e]=e.replace(qC,MM))}static separate(e){const r=XC[e];return r||(XC[e]=this.capitalize(e.replace(qC,IM)))}static createId(e){return String(e).replace(wM,PM)}static makeValidDomId(e,r=""){return e==null?null:String(e).replace(xM,r)}static escapeRegExp(e,r){let t=e.replace(SM,"\\$&");return r!==void 0&&(t=new RegExp(t,r)),t}static decodeHtml(e){return e&&String(e).replace(YC,RM)}static encodeHtml(e=""){return e&&String(e).replace(UC,TM)}static encodeHtmlBR(e){var r;return(r=wi.encodeHtml(e))==null?void 0:r.replace(CM,"<br>")}static isHtml(e){return typeof e=="string"&&DM.test(e||"")}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const r=Object.keys(e);WC=e,GC=r.reduce((t,i)=>(t[e[i]]=i,t),{}),UC=new RegExp(`([${r.map(t=>"[-]".includes(t)?"\\"+t:t).join("")}])`,"g"),YC=new RegExp(`(${Object.values(e).join("|")}|&#[0-9]+;)`,"ig")}static safeJsonParse(e){let r=null;try{r=JSON.parse(e)}catch(t){}return r}static safeJsonStringify(e,r=null,t=null){let i=null;try{i=JSON.stringify(e,r,t)}catch(n){}return i}static joinPaths(e,r="/"){return e.join(r).replace(new RegExp("\\"+r+"+","g"),r)}static split(e,r=EM){let t=e;return typeof t=="string"&&(t=e.trim(),t=t?t.split(r):[]),t}static xss(e,...r){const t=[];let i=r.length;for(t[i]=e[i];i-- >0;)t[i]=e[i]+wi.encodeHtml(r[i]);return t.join("")}static xssBR(e,...r){const t=[];let i=r.length;for(t[i]=e[i];i-- >0;)t[i]=e[i]+wi.encodeHtmlBR(r[i]);return t.join("")}static toJavaScriptValue(e,r){const t=N.typeOf(e);if(t==="boolean"||t==="string"||t==="number"||e===null)return wi.safeJsonStringify(e);if(e===globalThis)return"window";if(t==="date")return`new Date(${e.getFullYear()}, ${e.getMonth()}, ${e.getDate()}, ${e.getHours()}, ${e.getMinutes()}, ${e.getSeconds()}, ${e.getMilliseconds()})`;if(t==="array")return`[${e.map(i=>wi.toJavaScriptValue(i,r))}]`;if(t==="object"||t==="instance")return this.toJavaScriptString(e,r);if(t==="function"){let i=e.toString();return i.match(/^async (\w+?)\(/)?i=i.replace(/^async (\w+?)\(/,"async function("):!i.startsWith("async(")&&i.match(/^(\w+?)\(/)&&(i=i.replace(/^(\w+?)\(/,"function(")),i}if(t==="class")return e.toJavaScriptValue?e.toJavaScriptValue(r):Object.prototype.hasOwnProperty.call(e,"$name")?e.$name:e.name}static toJavaScriptString(e,r={}){var t;const i=(t=r.level)!=null?t:0,n=2;return`{
`+Object.keys(e).map(s=>" ".repeat((i+1)*n)+(s.match(/[- *]/)?`"${s}"`:s)+`: ${wi.toJavaScriptValue(e[s],{...r,level:i+1})}`).join(`,
`)+`
`+" ".repeat(i*n)+"}"}static encodeAttributeSelector(e,r){return`[${e}="${String(r).replace(/["\\]/g,"\\$&")}"]`}static generateUUID(){var e;return q.supportsRandomUUID?globalThis.crypto.randomUUID():(e=globalThis.crypto)!=null&&e.getRandomValues?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,r=>(r^globalThis.crypto.getRandomValues(new Uint8Array(1))[0]&15>>r/4).toString(16)):`${Date.now()}-${++wi.fakeNodeUUIDIndex}`}},O=wi;E(O,"fakeNodeUUIDIndex",0),O.initHtmlEntities(),O._$name="StringHelper";var{hasOwnProperty:AM,toString:_M}=Object.prototype,{isFrozen:ZC}=Object,kM=/\s*<\s*/,FM=/\s*>\s*/,JC={},QC={},eS=Object.freeze({}),N=class{static assign(e,...r){for(let t,i,n=0;n<r.length;n++)if(t=r[n],t)for(i in t)e[i]=t[i];return e}static assignIf(e,...r){for(let t,i,n=0;n<r.length;n++)if(t=r[n],t)for(i in t)(!(i in e)||e[i]===void 0)&&(e[i]=t[i]);return e}static blend(e,r,t){t=t||JC,e=e||{};const{clone:i=N.clone,merge:n=N.blend}=t;if(Array.isArray(r)){if(r.length>1)return r.forEach(s=>{e=N.blend(e,s,t)}),e;r=r[0]}if(r){let s,a,o;for(a in r)o=r[a],o&&N.isObject(o)&&(s=e[a],t.key=a,s&&N.isObject(s)?(ZC(s)&&(e[a]=s=i(s,t)),o=n(s,o,t)):o=ZC(o)?o:i(o,t)),e[a]=o}return e}static clone(e,r){let t=e,i;if(e&&typeof e=="object")if(r&&typeof r=="object"&&r&&(r=null),N.isObject(e))if(e.skipClone)t=e;else{t={};for(i in e)t[i]=N.clone(e[i])}else if(Array.isArray(e))for(t=[],i=e.length;i-- >0;)t[i]=N.clone(e[i]);else N.isDate(e)?t=new Date(e.getTime()):r&&(t=r(e));return t}static createTruthyKeys(e){const r=O.split(e),t=r&&{};if(r)for(const i of r)i&&(t[i]=!0);return t}static getPath(e,r){return r.split(".").reduce((t,i)=>(t||eS)[i],e)}static getPathDefault(e,r,t){const i=Array.isArray(r)?r:typeof r=="string"?r.split("."):[r],n=i.length-1;return i.reduce((s,a,o)=>(t&&!(a in s)&&(s[a]=o===n?t:{}),(s||eS)[a]),e)}static hasPath(e,r){return r.split(".").every(t=>e&&t in e?(e=e[t],!0):!1)}static getTruthyKeys(e){const r=[];for(const t in e)e[t]&&r.push(t);return r}static getTruthyValues(e){const r=[];for(const t in e)e[t]&&r.push(e[t]);return r}static isClass(e){var r;return typeof e=="function"&&((r=e.prototype)==null?void 0:r.constructor)===e}static isDate(e){return!!(e!=null&&e.getUTCDate)&&N.typeOf(e)==="date"}static isPromise(e){if(Promise&&Promise.resolve)return Promise.resolve(e)===e||typeof(e==null?void 0:e.then)=="function";throw new Error("Promise not supported in your environment")}static isEmpty(e){if(e&&typeof e=="object")for(const r in e)return!1;return!0}static isObject(e){const r=e==null?void 0:e.constructor;return!!(r?r===Object||r.getPrototypeOf&&r.prototype&&!Object.getPrototypeOf(r.prototype):e&&typeof e=="object")}static isInstantiated(e){return e?typeof e=="object"&&!N.isObject(e):!1}static merge(e,...r){return N.blend(e,r)}static mergeItems(e,r,t){t=t||JC;let i,n,s,a,o,l,c;const{merge:d=N.blend}=t;if(e=e||{},Array.isArray(r))r.forEach(u=>{e=N.mergeItems(e,u,t)});else if(r)for(o in r)if(c=r[o],i=null,o.includes(">")?([o,i]=o.split(FM),n=0):o.includes("<")&&([i,o]=o.split(kM),n=1),o in e)c&&e[o]&&d&&(t.key=o,c=d(e[o],c,t)),e[o]=c;else if(!i)e[o]=c,a==null||a.set(o,a.size);else{if(!a){a=new Map,s=0;for(const u in e)a.set(u,s++)}if(s=a.get(i),e[o]=c,s==null&&n)s=a.size;else{l=l||[],s=(s||0)+n;for(const u of a){const[h,g]=u;s<=g&&(l&&(l[a.size-g-1]=h),a.set(h,g+1))}if(l)for(;l.length;){const u=l.pop(),h=e[u];delete e[u],e[u]=h}}a.set(o,s)}return e}static setPath(e,r,t){return r.split(".").reduce((i,n,s,a)=>s===a.length-1?i[n]=t:(i[n]instanceof Object||(i[n]={}),i[n]),e),e}static typeOf(e){let r,t;return e===null?t="null":e!==e?t="nan":(t=typeof e,t==="object"?e.isBase?t="instance":Array.isArray(e)?t="array":(t=QC[r=_M.call(e)])||(QC[r]=t=r.slice(8,-1).toLowerCase()):t==="function"&&e.isBase&&(t="class")),t}};Object.defineProperty(N,"hasOwn",{value:Object.hasOwn||((e,r)=>AM.call(e,r))}),N._$name="Objects";var ne=class{static setVersion(e,r){e=e.toLowerCase(),lr[e]={version:r,isNewerThan(n){return ne.semanticCompareVersion(n,r,"<")},isOlderThan(n){return ne.semanticCompareVersion(n,r,">")}};let t="";typeof productName!="undefined"&&(t=productName);const i=`${t}.${e}${r.replace(/\./g,"-")}`;if(q.isBrowserEnv&&!globalThis.bryntum.silenceBundleException)if(globalThis.bryntum[i]===!0)if(this.isTestEnv)globalThis.BUNDLE_EXCEPTION=!0;else{let n=t||e;n==="core"&&(n="grid");let s=O.capitalize(n);throw n==="schedulerpro"&&(s="SchedulerPro"),new Error(`The Bryntum ${s} bundle was loaded multiple times by the application.

Common reasons you are getting this error includes:

* Imports point to different types of the bundle (e.g. *.module.js and *.umd.js)
* Imports point to both sources and bundle
* Imports do not use the shortest relative path, JS treats them as different files
* Cache busters differ between imports, JS treats ${n}.module.js?1 and ${n}.module.js?2 as different files
* Imports missing file type, verify they all end in .js

See https://bryntum.com/products/${n}/docs/guide/${s}/gettingstarted/es6bundle#troubleshooting for more information

`)}else globalThis.bryntum[i]=!0}static getVersion(e){if(e=e.toLowerCase(),!lr[e])throw new Error("No version specified! Please check that you import VersionHelper correctly into the class from where you call `deprecate` function.");return lr[e].version}static semanticCompareVersion(e,r,t="="){e=e||"",r=r||"";const i=e.split(/[-.]/),n=r.split(/[-.]/),s=t.includes("<"),a=(l,c)=>{const d=["rc","beta","alpha"],u=l.map(h=>{if(d.includes(h))return-d.indexOf(h)-2;const g=Number.parseInt(h);return Number.isNaN(g)?-d.length:g});for(;u.length<c;)u.push(-1);return u},o=()=>{const l=Math.max(i.length,n.length),c=a(i,l),d=a(n,l);for(let u=0;u<l;u++)if(c[u]!==d[u])return s?c[u]<d[u]:c[u]>d[u];return!0};switch(t){case"=":return e===r;case"<=":case">=":return e===r||o();case"<":case">":return e!==r&&o()}return!1}static checkVersion(e,r,t){return ne.semanticCompareVersion(lr.getVersion(e),r,t)}static deprecate(e,r,t){if(lr.checkVersion(e,r,"<"))console.warn(`Deprecation warning: You are using a deprecated API which will change in v${r}. ${t}`);else throw new Error(`Deprecated API use. ${t}`)}static get isTestEnv(){var e,r,t;const i=!!((e=globalThis.bryntum)!=null&&e.isTestEnv);try{return i||!!((t=(r=globalThis.parent)==null?void 0:r.bryntum)!=null&&t.isTestEnv)}catch(n){return i}}static get isDebug(){return!1}},lr=ne;q.isBrowserEnv&&(lr.isTestEnv&&(q._isHoverableDevice=!0),globalThis.bryntum=Object.assign(globalThis.bryntum||{},{getVersion:lr.getVersion.bind(lr),checkVersion:lr.checkVersion.bind(lr),deprecate:lr.deprecate.bind(lr),license:"bf757ffb-df5b-11e9-9294-d094663d5c88"})),ne._$name="VersionHelper";var{defineProperty:Cd,getOwnPropertyDescriptor:tS}=Reflect,{hasOwnProperty:rS,toString:yf}=Object.prototype,bf=Symbol("instanceProperties"),iS=Symbol("configuring"),Xs=Symbol("lazyConfigValues"),nS=yf.call(new Date),OM=/\s+/,LM=(e,r)=>(e[r]=1,e),Pe=class{static get(e,r){const{cache:t}=this,i=t[e]||(t[e]=new Pe(e));let n=i,s;return r&&(s=Pe.makeCacheKey(e,r),(n=s&&t[s])||(n=i.extend(r),s&&(t[s]=n))),n}constructor(e){const r=this,t=e[0].toUpperCase()+e.substr(1);r.base=r,r.name=e,r.field="_"+e,r.capName=t,r.changer="change"+t,r.initializing="initializing"+t,r.updater="update"+t}get descriptor(){let e=this._descriptor;return(!e||!rS.call(this,"_descriptor"))&&(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return(!e||!rS.call(this,"_initDescriptor"))&&(this._initDescriptor=e=this.makeInitter()),e}equal(e,r){return e===r}extend(e){const r=Object.assign(Object.create(this),e),{equal:t,merge:i}=e,{equalityMethods:n}=Pe;return typeof t=="string"&&(t.endsWith("[]")?r.equal=Pe.makeArrayEquals(n[t.substr(0,t.length-2)]):r.equal=n[t]),typeof i=="string"&&(r.merge=Pe.mergeMethods[i]),r}define(e){const r=tS(e,this.name);let t=this.descriptor;r&&r.get&&(t=Object.assign({},t),t.get=r.get),Cd(e,this.name,t)}defineInitter(e,r){const{name:t}=this,i=e[bf];let n,s;!i[t]&&(s=tS(e,t))&&!("value"in s)&&(i[t]=s),Cd(e,t,this.initDescriptor),this.lazy&&(n=e[Xs]||(e[Xs]=new Map),n.set(t,r))}static makeArrayEquals(e){return(r,t)=>{let i,n=r&&t&&r.length===(i=t.length);if(n&&Array.isArray(r)&&Array.isArray(t))if(e)for(;n&&i-- >0;)n=e(r[i],t[i]);else for(;n&&i-- >0;)n=r[i]===t[i];else n=e?e(r,t):r===t;return n}}static makeCacheKey(e,r){const t=Object.keys(r).sort();for(let i,n,s,a=t.length;a-- >0;)if(s=r[i=t[a]],s==null&&s===!1)t.splice(a,1);else{if(n=typeof s,n==="function")return null;n==="string"?t[a]=`${i}:"${s}"`:n==="number"&&(t[a]=`${i}:${s}`)}return t.length?`${e}>${t.join("|")}`:e}makeDescriptor(){const e=this,{base:r,field:t,changer:i,updater:n,name:s}=e;return r!==e&&r.equal===e.equal?r.descriptor:{get(){var a;return(a=this.configObserver)==null||a.get(s,this),this[t]},set(a){var o,l;const c=this;let d=c[t],u,h;if(typeof a=="string"){let g=a;a.startsWith("up.")?g=(o=c.owner)==null?void 0:o.resolveProperty(a.substr(3)):a.startsWith("this.")&&(g=c.resolveProperty(a.substr(5))),g!==void 0&&typeof g!="function"&&(a=g)}c[i]&&(u=(h=c[i](a,d))===void 0,u||(a=h,d=c[t])),!u&&!(e.equal===sS?d===a:e.equal(d,a))&&(c[t]=a,u=!0,(l=c[n])==null||l.call(c,a,d)),u&&!c.isDestroyed&&!c.onConfigChange.$nullFn&&c.onConfigChange({name:s,value:a,was:d,config:e})}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:r,name:t}=e;return{configurable:!0,get(){const i=this;return e.removeInitter(i),i[r]=!0,i[t]=i[iS][t],i[r]=!1,i.configDone[t]=!0,i[t]},set(i){e.removeInitter(this),this.configDone[t]=!0,this[t]=i}}}makeLazyInitter(){const e=this,{initializing:r,name:t}=e;return{configurable:!0,get(){const i=this,n=i[Xs].get(t);return e.removeInitter(i),i.isDestroying||(i[r]=!0,i[t]=n,i[r]=!1),i[t]},set(i){e.removeInitter(this),this[t]=i}}}removeInitter(e){const{name:r}=this,t=e[bf][r],i=e[Xs];t?Cd(e,r,t):delete e[r],i!=null&&i.delete(r)&&!i.size&&delete e[Xs]}setDefault(e,r){Cd(e.prototype,this.field,{configurable:!0,writable:!0,value:r})}merge(e,r){if(r&&e&&N.isObject(e)){if(r.isBase)return r.setConfig(e);N.isObject(r)&&(e=N.merge(N.clone(r),e))}return e}},{prototype:Uo}=Pe,{equal:sS}=Uo;Pe.symbols={configuring:iS,instanceProperties:bf,lazyConfigs:Xs},Pe.cache=Object.create(null),Pe.equalityMethods={array:Pe.makeArrayEquals(),date(e,r){return e===r?!0:e&&r&&yf.call(e)===nS&&yf.call(r)===nS?e.getTime()===r.getTime():!1},strict:Pe.equal=sS},Pe.mergeMethods={distinct(e,r){let t=r?r.slice():[];if(e!=null)if(N.isObject(e))if(r===void 0)t=e;else{let i,n;for(i in e)n=t.indexOf(i),e[i]?n<0&&t.push(i):n>-1&&t.splice(n,1)}else Array.isArray(e)?e.forEach(i=>!t.includes(i)&&t.push(i)):t.includes(e)||t.push(e);return t},merge:Pe.merge=Uo.merge,classList(e,r){if(typeof e=="string"){if(!e.length)return r;e=e.split(OM)}return Array.isArray(e)&&(e=e.reduce(LM,{})),Pe.merge(e,r)},objects(e,r){return e===!0?r||{}:Pe.merge(e,r)},replace(e){return e},items(e,r,t,i){return i?N.mergeItems(r,e,{merge:(n,s)=>Uo.merge(s,n)}):Uo.merge(e,r)}},Object.assign(Uo,{_descriptor:null,_initDescriptor:null,lazy:!1,nullify:!1,render:!1}),Pe._$name="Config";var $M=class{constructor(e){e&&Object.assign(this,e)}getInherited(e,r=!0){var t;let i=this[e];return e in this||(i=(t=this.super)==null?void 0:t.getInherited(e,r),(i||r)&&(this[e]=i=Object.create(i||null))),i}},{getPrototypeOf:aS}=Object,{hasOwn:Ar}=N,{defineProperty:oS}=Reflect,Sd=Symbol("classMetaData"),lS=Symbol("mixinTag"),Cf=Symbol("originalConfig"),C$=Symbol("createdAt"),Xr=Pe.symbols.configuring,jM=Pe.symbols.instanceProperties,Yo=Pe.symbols.lazyConfigs,BM={merge:"replace",simple:!0},Dd=()=>{},cS=e=>new $M(e),dS={},HM=Object.freeze({}),uS=Object.freeze([]),F=class{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const r=this,t=r.constructor;r.$meta.class!==t&&Dd(t.$meta),r.construct(...e),r.afterConstruct(),r.isConstructing=!1}static new(...e){return e=e.filter(r=>r),new this(e.length>1?this.mergeConfigs(...e):e[0])}construct(...e){e[0]!==null&&this.configure(...e),this.afterConfigure()}static destroy(...e){const r=t=>{t!=null&&t.destroy?t.destroy():Array.isArray(t)&&t.forEach(r)};r(e)}destroy(){const e=this,{id:r}=e;e.isDestroying=!0,e.destroy=Dd,e.doDestroy(),Object.setPrototypeOf(e,null);for(const t in e)t!=="destroy"&&t!=="isDestroying"&&delete e[t];delete e[Cf],e.isDestroyed=!0,e.id=r}_thisIsAUsedExpression(e){}static get $$name(){return Ar(this,"$name")&&this.$name||Ar(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,r,t=uS){const{handler:i,thisObj:n}=this.resolveCallback(e,r==="this"?this:r)||HM;return i==null?void 0:i.apply(n,t)}resolveProperty(e){let r=this;for(;r;){if(N.hasPath(r,e))return N.getPath(r,e);r=r.owner}}resolveCallback(e,r=this,t=!0){if(e!=null&&e.substring){if(e.endsWith("?")&&(t=!1,e=e.substring(0,e.length-1)),e.startsWith("up.")){for(e=e.substring(3),r=this.owner;r&&!r[e];r=r.owner);if(!r)return}else e.startsWith("this.")&&(e=e.substring(5),r=this);if(!r||!(r instanceof Object))return;e=r[e]}if(typeof e=="function")return{handler:e,thisObj:r};if(t)throw new Error(`No method named ${e} on ${r.$$name||"thisObj object"}`)}bindCallback(e,r=this){if(e){const{handler:t,thisObj:i}=this.resolveCallback(e,r);if(t)return t.bind(i)}}delay(e,r,t=e.name||e){return e=this.setTimeout?e:e.bind(this),(this.setTimeout?this:globalThis)[typeof r=="number"?"setTimeout":"requestAnimationFrame"](e,r,t)}doDestroy(){const e=this,{nullify:r}=e.$meta;if(r)for(let t=0;t<r.length;++t)e[r[t].field]!=null&&(e[r[t].name]=null)}destroyProperties(...e){var r,t;const i=this;let n;for(n of e)n in i&&(!i[Xr]||!i[Xr][n])&&((t=(r=i[n])==null?void 0:r.destroy)==null||t.call(r),delete i[n])}configure(e={}){const r=this,t=r.$meta,{beforeConfigure:i}=e,n=t.configs,s=r.getDefaultConfiguration();let a,o,l;r.initialConfig=e,r.isConfiguring=!0,Object.assign(r,r.getProperties());for(o in e)l=e[o],a=n[o],s[o]=a?a.merge(l,s[o],null,t):l;i&&(delete s.beforeConfigure,i(r,s)),r.setConfig(r[Cf]=s,!0),r.isConfiguring=!1}getConfig(e){return this[e]}setConfig(e,r){var t;const i=this,n=i[Xr],s=n?i.configDone:i.configDone={},a=i.$meta.configs;let o,l;i[jM]={},i[Xr]=n?Object.setPrototypeOf(Object.assign({},e),n):e;for(l in e)e[l]!=null||Ar(e,l)?(o=a[l]||Pe.get(l),o.defineInitter(i,e[l]),r||(s[l]=!1)):s[l]=!0;r&&i.startConfigure(e);for(l in e)!s[l]&&!((t=a[l])!=null&&t.lazy)&&(i[l]=e[l]);return n?i[Xr]=n:delete i[Xr],r&&i.finishConfigure(e),i}hasConfig(e){var r;const t=this,i=t[Xr];return!!(t["_"+e]!=null||((r=t[Yo])==null?void 0:r.get(e))!=null||!t.configDone[e]&&i&&(i[e]!=null||Ar(i,e)))}peekConfig(e){const r=this,t=r[Yo],i=r[Xr];if(t!=null&&t.has(e))return t.get(e);if(i&&e in i){if(r.configDone[e])return r[e];if(i[e]!=null||Ar(i,e))return i[e]}}triggerConfig(e){const r=this,{configDone:t}=r,i=r[Yo],n=r[Xr],s=i!=null&&i.has(e)||n&&(n[e]!=null||Ar(n,e))?!t[e]:null;return s&&r.getConfig(e),s}triggerConfigs(e){const r=this,t=r.$meta.configs,i=r[Yo],n=i?[...i.keys()].filter(s=>t[s].lazy===e):uS;for(const s of n)r.triggerConfig(s);return n.length?n:null}onConfigChange(){}get config(){const e={},r=this[Cf];for(const t in r)e[t]=r[t];return e}static processConfigValue(e,r){if(e===globalThis)return globalThis;if(Array.isArray(e))return e.map(t=>F.processConfigValue(t,r));if(e instanceof F)return r.visited.has(e)?void 0:e.getCurrentConfig(r);if(e instanceof HTMLElement||e instanceof DocumentFragment)return null;if(N.isObject(e)){const t={};for(const i in e)i!=="owner"&&(t[i]=F.processConfigValue(e[i],r));return t}return e}getConfigValue(e,r){var t;const i=this,n=i[Yo];if(!((t=i.$meta.configs[e])!=null&&t.lazy))return F.processConfigValue(i[e],r);if(n!=null&&n.has(e))return F.processConfigValue(n.get(e),r)}preProcessCurrentConfigs(){}getCurrentConfig(e={}){const r=this,t=e.configs==="all"?r.config:N.clone(r.initialConfig),i=e.visited||(e.visited=new Set),n=e.depth||(e.depth=0),s={};if(!i.has(r)){i.add(r),this.preProcessCurrentConfigs(t);for(const a in t){const o=r.getConfigValue(a,{...e,depth:n+1});o!==void 0&&(s[a]=o)}return s}}getConfigString(e={}){return O.toJavaScriptString(this.getCurrentConfig(e))}getTestCase(e={}){const r=this.isGantt?"Gantt":this.isSchedulerPro?"SchedulerPro":this.isCalendar?"Calendar":this.isScheduler?"Scheduler":this.isGrid?"Grid":this.isTaskBoard?"TaskBoard":null;if(r){const t=r.toLowerCase(),i=`../../build/${t}.module.js`;let n,s;e.import==="static"?(n=`import * as module from "${i}";Object.assign(window, module);`,s=""):(n=`import("${i}").then(module => { Object.assign(window, module);
`,s="});");const a=ne.getVersion(t);return a&&(n+=`
console.log('${r} ${a}');
`),`${n}      
const ${t} = new ${r}(${this.getConfigString(e)});
${s}`}}downloadTestCase(e={}){e.output="return";const r=this.getTestCase(e);q.download("app.js","data:application/javascript;charset=utf-8,"+escape(r))}static initClass(){return this.$meta.class}static get $meta(){const e=this;let r=e[Sd];return Ar(e,Sd)||(e[Sd]=r=cS(),r.class=e,e.setupClass(r)),r}static onClassMixedIn(){}static mergeConfigs(e,...r){const t=this.$meta.configs,i=N.clone(e)||{};let n,s,a,o;for(s=0;s<r.length;++s)if(n=r[s],n)for(a in n)o=n[a],t[a]?o=t[a].merge(o,i[a]):i[a]&&o&&(o=Pe.merge(o,i[a])),i[a]=o;return i}static mixin(...e){let r=this,t;for(t=0;t<e.length;++t){const i=e[t],n=i[lS]||(i[lS]=Symbol("mixinTag"));r[n]||(r=i(r),r[n]=!0,Ar(r,"onClassMixedIn")&&r.onClassMixedIn())}return r}static setupClass(e){var r;const t=e.class,i=aS(t).$meta,n=t.$$name,s=i.names,a=t.prototype;if(oS(a,"$meta",{value:e}),Object.assign(e,{super:i,config:Object.create(i.config),configs:Object.create(i.configs),declarables:i.declarables,forkConfigs:i.forkConfigs,hierarchy:Object.freeze([...i.hierarchy,t]),names:s.includes(n)?s:Object.freeze([...s,n]),properties:i.properties,nullify:(r=i.nullify)==null?void 0:r.slice()}),s!==e.names){const o=`is${n}`,l=c=>{Ar(c,o)||oS(c,o,{get(){return!0}})};l(a),l(t)}for(let o,l,c=0;c<e.declarables.length;++c)o=e.declarables[c],Ar(t,o)&&(l=dS[o]||(dS[o]=`setup${O.capitalize(o)}`),t[l](t,e))}static setupConfigs(e,r,t){const i=e.config,n=e.configs,s=e.class,a=e.super;let{nullify:o}=e,l,c,d,u,h,g;for(const f in r)h=r[f],t?(l=n[f])?h=l.merge(h,i[f],e,a):l=Pe.get(f,BM):(c=d=u=void 0,h&&typeof h=="object"&&"$config"in h&&(d=h.$config,d&&!N.isObject(d)&&(d=N.createTruthyKeys(d)),u="default"in h,c=u?h.default:c,h=h.value),(l=n[f])?(g=l.nullify,d&&(l=l.extend(d)),h=l.merge(h,i[f],e,a)):(l=Pe.get(f,d),l.define(s.prototype),u=!(l.field in s.prototype),g=!1),u&&l.setDefault(s,c),l.nullify&&!g&&(o||(o=e.nullify||(e.nullify=[]))).push(l)),h&&(N.isObject(h)||Array.isArray(h))&&!Object.isFrozen(h)&&(e.forkConfigs=!0),n[f]=l,i[f]=h}static setupConfigurable(e,r){e.setupConfigs(r,e.configurable,!1)}static setupDefaultConfig(e,r){e.setupConfigs(r,e.defaultConfig,!0)}static setupDeclarable(e,r){const t=e.declarable;let i=r.declarables,n,s;for(s=0;s<t.length;++s)i.includes(t[s])||(n||(r.declarables=n=i=i.slice()),i.push(t[s]))}static setupProperties(e,r){r.properties=r.super.properties.slice(),r.properties.push(e),Object.freeze(r.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.$meta,r=e.forkConfigs?F.fork(e.config):Object.create(e.config);if(ne.isTestEnv&&q.isBrowserEnv&&r.testConfig&&globalThis.__applyTestConfigs)for(const t in r.testConfig)r[t]=r.testConfig[t];return r}static fork(e){let r=e,t,i;if(e&&N.isObject(e)&&!Object.isFrozen(e)){r=Object.create(e);for(t in e)i=e[t],i&&(N.isObject(i)?r[t]=F.fork(i):Array.isArray(i)&&(r[t]=i.slice()))}return r}getProperties(){const e=this.$meta.properties,r={};for(let t=0;t<e.length;t++)Object.assign(r,e[t].properties);return r}static get superclass(){return aS(this)}classHierarchy(e){const r=this.$meta.hierarchy,t=e?r.indexOf(e):0;return t>0?r.slice(t):r}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(e){let r=this.$detachers;if(r=r==null?void 0:r[e],r)for(;r.length;)r.pop()()}trackDetacher(e,r){const t=this.$detachers||(this.$detachers={});(t[e]||(t[e]=[])).push(r)}untrackDetachers(e){const r=this.$detachers;if(r)for(const t in r){const i=r[t];for(let n=i.length;n-- >0;)i[n].eventer===e&&i.splice(n,1)}}},Sf=F.prototype;Sf.onConfigChange.$nullFn=Dd.$nullFn=!0,F[Sd]=Sf.$meta=cS({class:F,config:Object.freeze({}),configs:Object.create(null),declarables:F.declarable,forkConfigs:!1,hierarchy:Object.freeze([F]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null}),Object.assign(Sf,{$detachers:null,configObserver:null,isConstructing:!0,isDestroyed:!1,isDestroying:!1}),F.emptyFn=Dd,ne.setVersion("core","5.5.0"),F._$name="Base";var H=class{static clean(e){return e.reduce((r,t)=>(t!=null&&!(Array.isArray(t)&&t.length===0)&&t!==""&&r.push(t),r),[])}static from(e,r,t){const i=[];if(e)for(const n of e)(!r||r(n))&&i.push(t?t(n):n);return i}static remove(e,...r){let t,i,n=!1;r=r[0]instanceof Set?[...r[0]]:r;for(let s=0;s<r.length;s++)i=r[s],(t=e.indexOf(i))!==-1&&(e.splice(t,1),n=!0);return n}static findInsertionIndex(e,r,t=this.lexicalCompare,i){const n=r.length;let s,a;return i<n&&(s=i>0?t(r[i-1],e):0,a=i<n-1?t(e,r[i]):0,s<1&&a<1)?i:this.binarySearch(r,e,t)}static findLast(e,r,t){for(let{length:i}=e,n=i-1;n>=0;n--)if(r.call(t,e[n],n,e))return e[n]}static binarySearch(e,r,t=0,i=e.length,n=this.lexicalCompare){const s=e.length;let a,o;for(t instanceof Function?(n=t,t=0):i instanceof Function&&(n=i,i=s),--i;t<=i;)a=t+i>>1,o=n(r,e[a]),o>=0?t=a+1:o<0&&(i=a-1);return t}magnitudeCompare(e,r){return e<r?-1:e>r?1:0}lexicalCompare(e,r){return e=String(e),r=String(r),e<r?-1:e>r?1:0}static fill(e,r={},t=null){const i=[],n=Array.isArray(r)?r:[r];for(let s=0;s<e;s++)for(const a of n){const o=Object.assign({},a);t&&t(o,s),i.push(o)}return i}static populate(e,r,t=!1){const i=[];for(let n=0;n<e;n++)i.push(r(n+(t?1:0)));return i}static include(e,...r){for(const t of r)e.includes(t)||e.push(t)}static unique(e){return[...new Set(e)]}static allowNegative(e){return new Proxy(e,{get(r,t,i){if(typeof t!="string")return Reflect.get(r,t,i);const n=Number(t);return Number.isNaN(n)?Reflect.get(r,t,i):r[n<0?r.length+n:n]},set(r,t,i,n){if(typeof t!="string")return Reflect.set(r,t,i,n);const s=Number(t);return Number.isNaN(s)?Reflect.set(r,t,i,n):(r[s<0?r.length+s:s]=i,!0)}})}static delta(e,r,t=!1){if(!r)return t?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const i=[],n=[],s=new Set,a=new Set(r);for(let o=0;o<e.length;o++){const l=e[o];a.has(l)?s.add(l):i.push(l)}for(let o=0;o<r.length;o++){const l=r[o];s.has(l)||n.push(l)}return t?{toAdd:i,toRemove:n,toKeep:s}:{onlyInA:i,onlyInB:n,inBoth:[...s]}}static asArray(e){return e==null?e:e instanceof Set?Array.from(e):Array.isArray(e)?e:[e]}static identity(e){return e}static keyBy(e,r,t=H.identity){const i=typeof r=="string"?s=>s==null?void 0:s[r]:r,n=typeof t=="string"?s=>s==null?void 0:s[t]:t;return e.reduce((s,a)=>(s[i(a)]=n(a),s),{})}static aggregate(e,r,t,i,n={}){const s=e.length,a=e[0].length,o=[];n.targetArray=o,n.arrays=e;for(let l=0;l<a;l++)n.entryIndex=l,o.push(i(l,n));for(let l=0;l<s;l++){const c=e[l];n.rowIndex=l;for(let d=0;d<a;d++){n.entryIndex=d;const u=r(c[d],n);o[d]=t(o[d],u,l,d,n)}}return o}static groupBy(e,r){const t=typeof r=="string"?i=>i==null?void 0:i[r]:r;return e.reduce((i,n)=>{const s=t(n);return(i[s]=i[s]||[]).push(n),i},{})}};H._$name="ArrayHelper";var hS=/,\s*/,Df=Symbol("decompiled"),VM=/^\s*(async\s+)?([a-z_]\w*)\s*=>([\s\S]+)$/i,NM=/^\s*(async\s*)?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)\s+=>([\s\S]+)$/i,zM=/^(\s*async)?(?:\s*function)?(?:\s*([a-z_]\w*))?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)([\s\S]+)$/i,{hasOwnProperty:WM}=Object.prototype,Te=class{static after(e,r,t,i,n){const s=typeof t=="string",a=(n==null?void 0:n.return)!==!1,o=(...l)=>{const c=o.$nextHook.call(e,...l),d=i!=null&&i.isDestroyed?void 0:a?s?i[t](c,...l):t.call(i,c,...l):s?i[t](...l):t.call(i,...l);return d===void 0?c:d};return Te.hookMethod(e,r,o)}static before(e,r,t,i){const n=typeof t=="string",s=(...a)=>{const o=i!=null&&i.isDestroyed?0:n?i[t](...a):t.call(i,...a);return o===!1?o:s.$nextHook.call(e,...a)};return Te.hookMethod(e,r,s)}static curry(e){return function r(...t){return t.length>=e.length?e.apply(this,t):function(...i){return r.apply(this,t.concat(i))}}}static bindAll(e){for(const r in e)typeof e[r]=="function"&&(e[r]=e[r].bind(e))}static createInterceptor(e,r,t){return function(...i){const n=t||this;return r.call(n,...i)!==!1?e.call(n,...i):!1}}static createSequence(e,r,t){return(...i)=>{const n=e.call(t,...i),s=r.call(t,...i);return s===void 0?n:s}}static createThrottled(e,r,t,i,n){let s=-Number.MAX_VALUE,a,o;const l=()=>{o=0,s=performance.now(),a.push.apply(a,i),e.apply(t,a)},c=function(...d){const u=performance.now()-s;a=d,u>=r?(clearTimeout(o),l()):(o||(o=setTimeout(l,r-u)),n&&(a.push.apply(a,i),n.apply(t,a)))};return c.cancel=()=>clearTimeout(o),c}static createBuffered(e,r,t,i){let n,s;const a=()=>{s=0,o.isPending=!1,n.push.apply(n,i),e.apply(t,n)},o=function(...l){n=l,s&&clearTimeout(s),o.isPending=!0,s=setTimeout(a,r)};return o.cancel=()=>{o.isPending=!1,clearTimeout(s)},o}static decompile(e){if(!(Df in e)){const r=e.toString();let t=VM.exec(r),i,n,s,a,o;t?(i=[t[2]],n=t[3]):(t=NM.exec(r))?(o=t[2].trim(),i=o?o.split(hS):[],n=t[3]):(t=zM.exec(r))&&(s=t[2],o=t[3].trim(),i=o?o.split(hS):[],n=t[4]),n=n==null?void 0:n.trim(),e[Df]=a=t&&{args:i,async:!!t[1],body:n!=null&&n.startsWith("{")?n.substring(1,n.length-1).trim():n},s&&(a.name=s)}return e[Df]}static hookMethod(e,r,t){return t.$nextHook=e[r],e[r]=t,()=>{var i;if(WM.call(e,r)){let n=e[r],s;if(n===t)((i=Object.getPrototypeOf(e))==null?void 0:i[r])===t.$nextHook?delete e[r]:e[r]=t.$nextHook;else for(;s=n==null?void 0:n.$nextHook;n=s)if(s===t){n.$nextHook=t.$nextHook;break}}}}static noThrow(e,r,t){const i=e[r];e[r]=(...n)=>{try{return i.apply(e,n)}catch(s){return t==null?void 0:t(s)}}}static returnTrue(){return!0}static animate(e,r,t,i="linear"){let n=!1;const s=new Promise(a=>{const o=performance.now(),l=()=>{const c=Math.min((performance.now()-o)/e,1),d=t&&t.setTimeout?t:globalThis;n||r.call(t,this.easingFunctions[i](c))===!1&&a(),n||c===1?d.requestAnimationFrame(()=>a()):d.requestAnimationFrame(l)};l()});return s.cancel=()=>(n=!0,s.cancelled=!0,!1),s}},Ae=.5,Ei=1.70158,cr=7.5625,wd=1.525,wf=2/2.75,Ef=2.25/2.75,xf=1/2.75,Rf=1.5/2.75,Tf=2.5/2.75,Mf=2.625/2.75,If=.75,Pf=.9375,Af=.984375,GM=1.70158,UM=1.70158;Te.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=Ae)<1?Ae*Math.pow(e,2):-Ae*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=Ae)<1?Ae*Math.pow(e,3):Ae*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=Ae)<1?Ae*Math.pow(e,4):-Ae*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=Ae)<1?Ae*Math.pow(e,5):Ae*(Math.pow(e-2,5)+2),easeInSine:e=>-Math.cos(e*(Math.PI/2))+1,easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-Ae*(Math.cos(Math.PI*e)-1),easeInExpo:e=>e===0?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>e===1?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>e===0?0:e===1?1:(e/=Ae)<1?Ae*Math.pow(2,10*(e-1)):Ae*(-Math.pow(2,-10*--e)+2),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=Ae)<1?-Ae*(Math.sqrt(1-e*e)-1):Ae*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<xf?cr*e*e:e<wf?cr*(e-=Rf)*e+If:e<Tf?cr*(e-=Ef)*e+Pf:cr*(e-=Mf)*e+Af,easeInBack:e=>e*e*((Ei+1)*e-Ei),easeOutBack:e=>(e=e-1)*e*((Ei+1)*e+Ei)+1,easeInOutBack:e=>{let r=GM;return(e/=Ae)<1?Ae*(e*e*(((r*=wd)+1)*e-r)):Ae*((e-=2)*e*(((r*=wd)+1)*e+r)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((e*6-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let r=UM;return(e/=Ae)<1?Ae*(e*e*(((r*=wd)+1)*e-r)):Ae*((e-=2)*e*(((r*=wd)+1)*e+r)+2)},swingFrom:e=>e*e*((Ei+1)*e-Ei),swingTo:e=>(e-=1)*e*((Ei+1)*e+Ei)+1,bounce:e=>e<xf?cr*e*e:e<wf?cr*(e-=Rf)*e+If:e<Tf?cr*(e-=Ef)*e+Pf:cr*(e-=Mf)*e+Af,bouncePast:e=>e<xf?cr*e*e:e<wf?2-(cr*(e-=Rf)*e+If):e<Tf?2-(cr*(e-=Ef)*e+Pf):2-(cr*(e-=Mf)*e+Af),easeFromTo:e=>(e/=Ae)<1?Ae*Math.pow(e,4):-Ae*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},Te._$name="FunctionHelper";var{isArray:gS}=Array,{hasOwnProperty:YM}=Object.prototype,fS={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1,$internal:1},mS=(e,r)=>r.prio-e.prio,Le=e=>class LC extends(e||F){constructor(){super(...arguments),E(this,"eventsSuspended",null)}static get $name(){return"Events"}static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(t,i){const n=i.getInherited("deprecatedEvents"),s=t.deprecatedEvents;for(const a in s)n[a.toLowerCase()]=n[a]=s[a]}static get configurable(){return{listeners:{value:null,$config:{merge(t,i){if(t!==null){if(!t)return i;i&&(t=t?[t]:[],t.push[gS(i)?"apply":"call"](t,i))}return t}}},internalListeners:null,bubbleEvents:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(t,...i){(this.configuredListeners=t==null?void 0:t.listeners)&&(t=N.assign({},t),delete t.listeners),super.construct(t,...i),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const t=this,{isConfiguring:i}=t;t.isConfiguring=!1,t.listeners=t.configuredListeners,t.configuredListeners=null,t.isConfiguring=i}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(!1),super.doDestroy()}static setupClass(t){super.setupClass(t),LC.prototype.onListen.$nullFn=!0,LC.prototype.onUnlisten.$nullFn=!0}addListener(t,i,n){var s;if(gS(t)){for(let l=0,{length:c}=t;l<c;l++)this.addListener(t[l],i);return}const a=this,o=a.$meta.getInherited("deprecatedEvents");if(typeof t=="string")return a.addListener({[t]:i,detachable:i.detachable!==!1,thisObj:n});{i=t.thisObj=t.thisObj!==void 0?t.thisObj:i;for(const u in t)if(!fS[u]&&t[u]!=null){const h=u.toLowerCase(),g=o==null?void 0:o[h],f=a.eventListeners||(a.eventListeners={}),m=t[u],p=m.expires||t.expires,v={fn:typeof m=="object"?m.fn:m,thisObj:m.thisObj!==void 0?m.thisObj:i,args:m.args||t.args,prio:m.prio!==void 0?m.prio:t.prio!==void 0?t.prio:0,once:m.once!==void 0?m.once:t.once!==void 0?t.once:!1,buffer:m.buffer||t.buffer,throttle:m.throttle||t.throttle,$internal:t.$internal,catchAll:u==="catchAll"};if(g){const{product:C,invalidAsOfVersion:D,message:S}=g;ne.deprecate(C,D,S)}if(p){const{alt:C}=p,D=C?p.delay:p,S=t.name||u,x=()=>{a.un(h,v),C&&!v.called&&a.callback(C,i)};a.isDelayable?a.setTimeout({fn:x,name:S,cancelOutstanding:!0,delay:D}):globalThis.setTimeout(x,D)}let y=f[h]||(f[h]=[]);y.$firing&&(f[h]=y=y.slice()),y.splice(H.findInsertionIndex(v,y,mS,y.length),0,v),!a.onListen.$nullFn&&y.length<2&&a.onListen(h),(s=a.afterAddListener)==null||s.call(a,h,v)}t.relayAll&&a.relayAll(t.relayAll),i&&i!==a&&a.attachAutoDetacher(t,i);const l=t.detachable!==!1,c=t.name,d=t.expires||l||c?()=>{a.isDestroyed||a.removeListener(t,i)}:null;if(d&&(d.eventer=a,d.listenerName=c,c&&(i!=null&&i.trackDetacher)&&i.trackDetacher(c,d),t.expires&&a.delay(d,isNaN(t.expires)?t.expires.delay:t.expires,c),l))return d}}on(t,i,n){return this.addListener(t,i,n)}ion(t){return t.$internal=!0,this.on(t)}un(...t){this.removeListener(...t)}updateInternalListeners(t,i){i==null||i.detach(),t&&(t.detach=this.ion(t))}get listeners(){return this.eventListeners}changeListeners(t){if(this.isConfiguring)this.getConfig("internalListeners"),t&&this.on(t,this);else{if(Array.isArray(t))for(let i=0,n=t[0],{length:s}=t;i<s;n=t[++i])"thisObj"in n||(t[i]=N.assign({thisObj:this},n));else t&&!("thisObj"in t)&&(t=N.assign({thisObj:this},t));return t}}updateListeners(t,i){i&&this.un(i),t&&this.on(t)}removeListener(t,i=t.thisObj,n){const s=this;if(typeof t=="string")return s.removeListener({[t]:i},n);Object.entries(t).forEach(([a,o])=>{var l;if(!fS[a]&&o!=null){a=a.toLowerCase();const{eventListeners:c}=s,d=s.findListener(a,o,i);if(d>=0){let u=c[a];(l=s.afterRemoveListener)==null||l.call(s,a,u[d]),u.length>1?(u.$firing&&(c[a]=u=u.slice()),u.splice(d,1)):(delete c[a],s.onUnlisten.$nullFn||s.onUnlisten(a))}}}),t.thisObj&&!t.thisObj.isDestroyed&&s.detachAutoDetacher(t)}findListener(t,i,n){var s;const a=(s=this.eventListeners)==null?void 0:s[t],o=i.fn||i,l=i.thisObj||n;if(a){for(let c,d=0,{length:u}=a;d<u;d++)if(c=a[d],c.fn===o&&c.thisObj===l)return d}return-1}hasListener(t){var i;return!!((i=this.eventListeners)!=null&&i[t==null?void 0:t.toLowerCase()])}relayAll(t,i,n=!0){this.relayAllTargets||(this.relayAllTargets=[]);const{relayAllTargets:s}=this;t.ion({beforeDestroy:({source:a})=>{a===t&&s.filter(l=>l.through===t).forEach(l=>H.remove(s,l))}}),s.push({through:t,prefix:i,transformCase:n})}removeAllListeners(t=!0){var i;const n=this.eventListeners;let s,a;for(const o in n){const l=n[o];for(s=l.length;s-- >0;){const c=l[s];(!c.$internal||!t)&&(this.removeListener(o,c),a=c.thisObj,(i=a==null?void 0:a.untrackDetachers)==null||i.call(a,this))}}}relayEvents(t,i,n=""){const s={detachable:!0,thisObj:this};return i.forEach(a=>{s[a]=(o,...l)=>this.trigger(n+a,o,...l)}),t.on(s)}onListen(){}onUnlisten(){}destructorInterceptor(){const{autoDetachers:t,target:i,oldDestructor:n}=this;for(let s=0;s<t.length;s++){const{dispatcher:a,config:o}=t[s];a.isDestroyed||a.removeListener(o,i)}n.call(i)}attachAutoDetacher(t,i){const n=t.thisObj||i,s="doDestroy"in n?"doDestroy":"destroy";if(s in n){let{$autoDetachers:a}=n;a||(n.$autoDetachers=a=[]),n.$oldDestructor||(n.$oldDestructor=n[s],n[s]=this.destructorInterceptor.bind({autoDetachers:a,oldDestructor:n.$oldDestructor,target:n})),a.push({config:t,dispatcher:this})}else n[s]=()=>{this.removeListener(t)}}detachAutoDetacher(t){const i=t.thisObj;i.$oldDestructor&&!i.isDestroying&&(H.remove(i.$autoDetachers,i.$autoDetachers.find(n=>n.config===t&&n.dispatcher===this)),i.$autoDetachers.length||(i["doDestroy"in i?"doDestroy":"destroy"]=i.$oldDestructor,i.$oldDestructor=null))}await(t,i={checkLog:!0,resetLog:!0,args:null}){const n=this;i===!1&&(i={checkLog:!1});const{args:s}=i;return new Promise(a=>{var o;if(i.checkLog&&((o=n._triggered)!=null&&o[t])&&(a(),i.resetLog&&n.clearLog(t)),s){const l=n.on({[t]:(...c)=>{(typeof s=="function"?s(...c):Object.keys(s).every(u=>u in c[0]&&c[0][u]===s[u]))&&(a(...c),i.resetLog&&n.clearLog(t),l())},prio:-1e4})}else n.on({[t]:(...l)=>{a(...l),i.resetLog&&n.clearLog(t)},prio:-1e4,once:!0})})}clearLog(t){this._triggered&&(t?delete this._triggered[t]:this._triggered={})}trigger(t,i){var n,s,a,o;const l=this,c=t.toLowerCase(),{eventsSuspended:d,relayAllTargets:u,callOnFunctions:h}=l;let g=(n=l.eventListeners)==null?void 0:n[c],f;if(l._triggered||(l._triggered={}),l._triggered[t]=!0,d)return d.shouldQueue&&d.queue.push(arguments),!0;if((s=l.eventListeners)!=null&&s.catchall&&((g=g?g.slice():[]).push(...l.eventListeners.catchall),g.sort(mS)),!g&&!u&&!h)return!0;if(i?"source"in i||(Object.isExtensible(i)?i.source=l:i=Object.setPrototypeOf({source:l},i)):i={source:l},i.type!==c&&(i.constructor!==Object?Reflect.defineProperty(i,"type",{get:()=>c}):i.type=c),i.eventName=t,!("bubbles"in i)&&((a=l.bubbleEvents)!=null&&a[t])&&(i.bubbles=l.bubbleEvents[t]),h){const p="on"+O.capitalize(t);if(p in l){const v=l[p]?l.callback(l[p],l,[i]):!0;let y;if(N.isPromise(v)?(f||(f=[])).push(v):y=v===!1||y,!l.isDestroyed&&YM.call(l,p)&&!((o=l.pluginFunctionChain)!=null&&o[p])){const C=Object.getPrototypeOf(l);if(p in C){const D=C[p].call(l,i);if(N.isPromise(D)?(f||(f=[])).push(D):y=D===!1||y,l.isDestroyed)return}}if(y)return!1}}let m;if(g){let p=0,v=!1;for(g.$firing=!0,p;p<g.length&&!l.isDestroyed&&!v;p++){const y=g[p];if(m===!1&&!y.$internal)continue;let C,D=y.thisObj;if(!D||!D.isDestroyed){if(y.called=!0,y.once&&l.removeListener(c,y),typeof y.fn=="string"){if(D&&(C=D[y.fn]),!C){const x=l.resolveCallback(y.fn);C=x.handler,D=x.thisObj}}else C=y.fn;if(y.buffer){if(!y.bufferFn){const x=Number(y.buffer);if(typeof x!="number"||isNaN(x))throw new Error(`Incorrect type for buffer, got "${x}" (expected a Number)`);y.bufferFn=Te.createBuffered(C,x,D,y.args)}C=y.bufferFn}if(y.throttle){const x=Number(y.throttle);if(typeof x!="number"||isNaN(x))throw new Error(`Incorrect type for throttle, got "${x}" (expected a Number)`);y.throttledFn||(y.throttledFn=Te.createThrottled(C,x,D,y.args)),C=y.throttledFn}const S=C.call(D||l,...y.args||[],i);m!==!1&&(m=S),y.$internal&&S===!1&&(v=!0),N.isPromise(S)&&(S.$internal=y.$internal,(f||(f=[])).push(S))}}if(g.$firing=!1,v)return!1}return u==null||u.forEach(p=>{let v=t;if(p.transformCase&&(v=O.capitalize(v)),p.prefix&&(v=p.prefix+v),p.through.trigger(v,i)===!1)return!1}),i.bubbles&&l.owner&&!l.owner.isDestroyed?l.owner.trigger(t,i):(f=f==null?void 0:f.filter(p=>m!==!1||p.$internal),f!=null&&f.length?new Promise(p=>{Promise.all(f).then(v=>{const y=!v.some(C=>C===!1);p(y)})}):m!==!1)}suspendEvents(t=!1){const i=this.eventsSuspended||(this.eventsSuspended={shouldQueue:t,queue:[],count:0});i.count++}resumeEvents(){const t=this.eventsSuspended;if(t&&--t.count===0&&(this.eventsSuspended=null,t.shouldQueue))for(const i of t.queue)this.trigger(...i);return!this.eventsSuspended}},bn=class{static animationFrame(){return new Promise(e=>{requestAnimationFrame(e)})}static sleep(e){return new Promise(r=>{setTimeout(()=>{r()},e)})}static yield(){return Promise.resolve()}};bn._$name="AsyncHelper";var qM=/^(\w+)=(.*)$/,KM=function(e){const r={},t=e.split("&");for(const i of t){const[n,s,a]=qM.exec(i),o=decodeURIComponent(s),l=decodeURIComponent(a);if(n){let c=r[o];c?(Array.isArray(c)||(c=r[o]=[c]),c.push(l)):r[o]=l}}return r},Cn=class{static get(e,r){return this.fetch(e,r)}static post(e,r,t={}){return!(r instanceof FormData)&&typeof r!="string"&&(r=JSON.stringify(r),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:r},t))}static fetch(e,r){let t;if(r=N.merge({},Cn.DEFAULT_FETCH_OPTIONS,r),typeof AbortController!="undefined"&&(t=r.abortController=new AbortController,r.signal=t.signal),"credentials"in r||(r.credentials="include"),r.queryParams){const n=Object.entries(r.queryParams);if(n.length){let s=!1;if(r.headers&&r.addQueryParamsToBody===!0){const a=new Headers(r.headers).get("Content-Type");let o;switch(a){case"application/x-www-form-urlencoded":o=URLSearchParams;break;case"multipart/form-data":o=FormData;break}if(o){const l=r.body||(r.body=new o);l instanceof o&&(n.forEach(([c,d])=>l.set(c,d)),s=!0)}}s||(e+=(e.includes("?")?"&":"?")+n.map(([a,o])=>`${a}=${encodeURIComponent(o)}`).join("&"))}}const i=new Promise((n,s)=>{fetch(e,r).then(a=>{r.parseJson?a.json().then(o=>{a.parsedJson=o,n(a)}).catch(o=>{a.parsedJson=null,a.error=o,s(a)}):n(a)}).catch(a=>{a.stack=i.stack,s(a)})});return i.stack=new Error().stack,i.abort=function(){t==null||t.abort()},i}static mockUrl(e,r){const t=this;(t.mockAjaxMap||(t.mockAjaxMap={}))[e]=r,Cn.originalFetch||(Cn.originalFetch=Cn.fetch,Cn.fetch=t.mockAjaxFetch.bind(t))}static async mockAjaxFetch(e,r){const t=e.split("?");let i=this.mockAjaxMap[t[0]],n=null;if(i){typeof i=="function"&&(i=await i(t[0],t[1]&&KM(t[1]),r));try{n=(r==null?void 0:r.parseJson)&&JSON.parse(i.responseText)}catch(s){n=null,i.error=s}return i=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:n,text:()=>new Promise(s=>{s(i.responseText)}),json:()=>new Promise(s=>{s(n)})},i),new Promise(function(s,a){i.synchronous?s(i):setTimeout(function(){s(i)},"delay"in i?i.delay:100)})}else return Cn.originalFetch(e,r)}},_r=Cn;E(_r,"DEFAULT_FETCH_OPTIONS",{}),_r._$name="AjaxHelper";var qo=class{static mergeLocales(...e){const r={};return e.forEach(t=>{Object.keys(t).forEach(i=>{typeof t[i]=="object"?r[i]={...r[i],...t[i]}:r[i]=t[i]})}),r}static trimLocale(e,r){const t=(i,n)=>{e[i]&&(n?e[i][n]&&delete e[i][n]:delete e[i])};Object.keys(r).forEach(i=>{Object.keys(r[i]).length>0?Object.keys(r[i]).forEach(n=>t(i,n)):t(i)})}static normalizeLocale(e,r){if(!e)throw new Error('"nameOrConfig" parameter can not be empty');if(typeof e=="string"){if(!r)throw new Error('"config" parameter can not be empty');r.locale?r.name=e||r.name:r.localeName=e}else r=e;let t={};if(r.name||r.locale)t=Object.assign({localeName:r.name},r.locale),r.desc&&(t.localeDesc=r.desc),r.code&&(t.localeCode=r.code),r.path&&(t.localePath=r.path);else{if(!r.localeName)throw new Error(`"config" parameter doesn't have "localeName" property`);t=Object.assign({},r)}for(const i of["name","desc","code","path"])t[i]&&delete t[i];if(!t.localeName)throw new Error("Locale name can not be empty");return t}static get locales(){return globalThis.bryntum.locales||{}}static set locales(e){globalThis.bryntum.locales=e}static get localeName(){return globalThis.bryntum.locale||"En"}static set localeName(e){globalThis.bryntum.locale=e||qo.localeName}static get locale(){return qo.localeName&&this.locales[qo.localeName]||this.locales.En||Object.values(this.locales)[0]||{localeName:"",localeDesc:"",localeCoode:""}}static publishLocale(e,r){const{locales:t}=globalThis.bryntum,i=qo.normalizeLocale(e,r),{localeName:n}=i;return!t[n]||r===!0?t[n]=i:t[n]=this.mergeLocales(t[n]||{},i||{}),t[n]}},yt=qo;E(yt,"skipLocaleIntegrityCheck",!1),globalThis.bryntum=globalThis.bryntum||{},globalThis.bryntum.locales=globalThis.bryntum.locales||{},yt._$name="LocaleHelper";var XM=class extends Le(F){static get defaultConfig(){return{throwOnMissingLocale:ne.isTestEnv}}construct(...e){var r;const t=this;if(super.construct(...e),q.isBrowserEnv){const i=document.querySelector("script[data-default-locale]");i?t.applyLocale(i.dataset.defaultLocale):(r=t.locale)!=null&&r.localeName&&t.applyLocale(t.locale.localeName)}}get locales(){return yt.locales}set locales(e){yt.locales=e}set locale(e){this.applyLocale(e)}get locale(){return yt.locale}registerLocale(e,r){ne.deprecate("Core","6.0.0","LocaleManager.registerLocale deprecated, use LocaleHelper.publishLocale instead"),yt.publishLocale(e,r)}extendLocale(e,r){ne.deprecate("Core","6.0.0","LocaleManager.extendLocale deprecated, use LocaleManager.applyLocale instead");const t=yt.publishLocale(e,r);return this.applyLocale(t,!0)}applyLocale(e,r,t=!1){const i=this;let n;if(typeof e=="string")if(typeof r!="object"){if(n=i.locales[e],!n){if(t)return!0;throw new Error(`Locale "${e}" is not published. Publish with LocaleHelper.publishLocale() before applying.`)}}else n=yt.publishLocale(e,r);else n=yt.publishLocale(e);if(i.locale.localeName&&i.locale.localeName===n.localeName&&r!==!0)return i.locale;yt.localeName=n.localeName;const s=()=>{i.trigger("locale",n)};return n.localePath?new Promise((a,o)=>{i.loadLocale(n.localePath).then(l=>{l.text().then(c=>{new Function(c)(),q.isBrowserEnv&&(n=i.locales[n.localeName],n&&delete n.localePath),s(),a(n)})}).catch(l=>o(l))}):(s(),n)}loadLocale(e){return _r.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}},ZM=new XM,ze=ZM,JM=Object.getPrototypeOf(Object),pS=/L{.*?}/g,vS=/L{(.*?)}/g,yS=/((.*?)\.)?(.+)/g,QM=e=>e.replace(/{(\d+)}/gm,"[[$1]]"),bS=e=>e.replace(/\[\[(\d+)]]/gm,"{$1}"),eI=Object.freeze(Object.create(null)),We=e=>class qr extends(e||F){static get $name(){return"Localizable"}static get configurable(){return{localeClass:null,localizable:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(t){var i,n;return typeof t=="string"?t:t===JM?"Object":t.$$name||t.name||((i=t.prototype)==null?void 0:i.$$name)||((n=t.prototype)==null?void 0:n.name)}static parseLocaleString(t){const i=[];let n;if(t!=null&&t.includes("L{"))for(t=QM(t),vS.lastIndex=0;(n=vS.exec(t))!=null;){yS.lastIndex=0;const s=yS.exec(n[1]);i.push({match:bS(n[0]),localeKey:bS(s[3]),localeClass:s[2]})}return i.length>0?i:[{match:t,localeKey:t,localeClass:void 0}]}construct(t={},...i){super.construct(t,...i),ze.ion({locale:"updateLocalization",thisObj:this}),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(t){var i,n,s;const a=this,o=N.getPath(a,t),l=((i=a.$meta.configs[t])==null?void 0:i.localeKey)||((s=(n=a.fieldMap)==null?void 0:n[t])==null?void 0:s.defaultValue);let c;return l?(c=qr.localize(l,a,a.localeClass||a),c&&!(t in(a.initialConfig||eI))&&N.setPath(a.isColumn?a.data:a,t,c)):typeof o=="string"&&(a.originalLocales=a.originalLocales||{},c=N.getPath(a.originalLocales,t),c===void 0&&(N.setPath(a.originalLocales,t,o),c=o),c&&N.setPath(a,t,c=a.optionalL(c,a))),c||o}updateLocalization(){var t,i;this.localizable!==!1&&((t=this.localizableProperties)==null||t.forEach(this.localizeProperty,this),(i=this.trigger)==null||i.call(this,"localized"))}static getTranslation(t,i,n){const s=ze.locale;let a=null,o,l;if(s)for(const{match:c,localeKey:d,localeClass:u}of this.parseLocaleString(t)){const h=f=>{var m;const p=(m=s[f])==null?void 0:m[d];return p&&(typeof p=="function"?a=i!=null?p(i):p:typeof p=="object"||t===c?a=p:a=(a||t).replace(c,p),typeof p=="string"&&p.includes("L{")&&(a=this.getTranslation(p,i,n))),p};let g=!1;for(l=n;l&&(o=qr.clsName(l))&&!(g=h(o));l=Object.getPrototypeOf(l))if(typeof l=="string")break;!g&&u&&h(u)}return a}static localize(t,i=void 0,...n){(n==null?void 0:n.length)===0&&(n=[this]);let s=null;return n.some(a=>(s=qr.getTranslation(t,i,a),s!=null)),s}static L(t,i=void 0,...n){(n==null?void 0:n.length)===0&&(n=[this]);const s=this.localize(t,i,...n);if(s==null&&ze.throwOnMissingLocale&&t.includes("L{"))throw new Error(`Localization is not found for '${t}' in '${n.map(a=>qr.clsName(a)).join(", ")}'. ${ze.locale.localeName?`Locale : ${ze.locale.localeName}`:""}`);return s!=null?s:t}L(t,i){const{localeClass:n,constructor:s}=this;return n&&qr.clsName(n)!==qr.clsName(s)?qr.L(t,i,n,s):qr.L(t,i,s)}static optionalL(t,i=void 0,...n){const s=ze.throwOnMissingLocale;ze.throwOnMissingLocale=s&&pS.test(t),(n==null?void 0:n.length)===0&&(n=[this]);const a=qr.L(t,i,...n);return ze.throwOnMissingLocale=s,a}optionalL(t,i=this,n=!1){const s=ze.throwOnMissingLocale;ze.throwOnMissingLocale=s&&pS.test(t)&&!n;const a=this.L(t,i);return ze.throwOnMissingLocale=s,a}get localeManager(){return ze}get localeHelper(){return yt}},tI={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{Yes:"Yes",No:"No",Cancel:"Cancel",Ok:"OK",Week:"Week"},ColorPicker:{noColor:"No color"},Combo:{noResults:"No results",recordNotCommitted:"Record could not be added",addNewValue:e=>`Add ${e}`},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:e=>`Value must be less than or equal to ${e.max}`,rangeUnderflow:e=>`Value must be greater than or equal to ${e.min}`,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},DatePicker:{gotoPrevYear:"Go to previous year",gotoPrevMonth:"Go to previous month",gotoNextMonth:"Go to next month",gotoNextYear:"Go to next year"},NumberFormat:{locale:"en-US",currency:"USD"},DurationField:{invalidUnit:"Invalid unit"},TimeField:{invalidTime:"Invalid time input"},TimePicker:{hour:"Hour",minute:"Minute",second:"Second"},List:{loading:"Loading...",selectAll:"Select All"},GridBase:{loadMask:"Loading...",syncMask:"Saving changes, please wait..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:e=>`of ${e.lastPage}`,summaryTemplate:e=>`Displaying records ${e.start} - ${e.end} of ${e.allCount}`},PanelCollapser:{Collapse:"Collapse",Expand:"Expand"},Popup:{close:"Close"},UndoRedo:{Undo:"Undo",Redo:"Redo",UndoLastAction:"Undo last action",RedoLastAction:"Redo last undone action",NoActions:"No items in the undo queue"},FieldFilterPicker:{equals:"equals",doesNotEqual:"does not equal",isEmpty:"empty",isNotEmpty:"not empty",contains:"contains",doesNotContain:"does not contain",startsWith:"starts with",endsWith:"ends with",isOneOf:"one of",isNotOneOf:"not one of",isGreaterThan:"greater than",isLessThan:"less than",isGreaterThanOrEqualTo:"greater than or equal to",isLessThanOrEqualTo:"less than or equal to",isBetween:"between",isNotBetween:"not between",isBefore:"before",isAfter:"after",isToday:"today",isTomorrow:"tomorrow",isYesterday:"yesterday",isThisWeek:"this week",isNextWeek:"next week",isLastWeek:"last week",isThisMonth:"this month",isNextMonth:"next month",isLastMonth:"last month",isThisYear:"this year",isNextYear:"next year",isLastYear:"last year",isYearToDate:"year to date",isTrue:"true",isFalse:"false",selectAProperty:"Select a property",selectAnOperator:"Select an operator",caseSensitive:"Case-sensitive",and:"and",dateFormat:"D/M/YY",selectOneOrMoreValues:"Select one or more values",enterAValue:"Enter a value",enterANumber:"Enter a number",selectADate:"Select a date"},FieldFilterPickerGroup:{addFilter:"Add filter"},DateHelper:{locale:"en-US",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"},{single:"decade",plural:"decades",abbrev:"dec"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A"},ordinalSuffix:e=>{const r=["11","12","13"].find(i=>e.endsWith(i));let t="th";if(!r){const i=e[e.length-1];t={1:"st",2:"nd",3:"rd"}[i]||"th"}return e+t}}},S$=yt.publishLocale(tI),{toString:CS}=Object.prototype,rI=CS.call(new Date),Ed=new Date,_f=1e3*60*60,kf=(e,r)=>isNaN(e)||e==null?r:e,iI=/([ES]){([^}]+)}/g,SS=e=>{const r=["11","12","13"].find(i=>e.endsWith(i));let t="th";if(!r){const i=e[e.length-1];t={1:"st",2:"nd",3:"rd"}[i]||"th"}return e+t},wt=(e,r,t)=>(Ri[e]||(Ri[e]=new Intl.DateTimeFormat(xi,r))).format(t),Ko=(e,r,t,i=!1)=>{let n=wt(e,r,t);return/am|pm/i.test(n)&&(n=n.replace(/^0/,""),i&&(n=n.replace(/:00/,""))),n},nI=(e,r)=>Math.floor((e.getTime()-r.getTime()-(e.getTimezoneOffset()-r.getTimezoneOffset())*Lt.minute.millisecond)/Lt.day.millisecond)+1,DS=e=>e>=0?e:e+7,sI=/([^\w])(S+)/gm,aI=(e,r)=>r+"SSS",wS=/[:.\-/\s]/,xi="en-US",Zr=SS,xd={},Xo={},Ri={},Ff={},ES=e=>{const r=Of[e];if(!r)throw new Error("Only international formats should be used here");if(Xo[e]!==void 0)return Xo[e];const t=new Intl.DateTimeFormat(xi,r),i=t.formatToParts(new Date(2001,1,2,3,4,5,6)).map(n=>{const s=n.type,a=r[s];if(s==="literal")return n.value.replace(/,/g,"");if(s==="day")return a==="numeric"?"D":"DD";if(s==="month")return a==="short"?"MMM":a==="long"?"MMMM":a==="numeric"?"M":"MM";if(s==="year")return a==="numeric"?"YYYY":"YY"}).join("");return Xo[e]=i},xS=2020,RS=0,TS=1,Of={l:{year:"numeric",month:"numeric",day:"numeric"},ll:{year:"numeric",month:"short",day:"numeric"}},lt={M:e=>e.getMonth()+1,Mo:e=>Zr(lt.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>wt("MMM",{month:"short"},e),MMMM:e=>wt("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/3),Qo:e=>Zr(lt.Q(e).toString()),D:e=>e.getDate(),Do:e=>Zr(lt.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/Lt.day.millisecond),DDDo:e=>Zr(lt.DDD(e).toString()),DDDD:e=>lt.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>Zr(e.getDay().toString()),d1:e=>wt("d1",{weekday:"narrow"},e).substr(0,1),dd:e=>lt.ddd(e).substring(0,2),ddd:e=>wt("ddd",{weekday:"short"},e),dddd:e=>wt("dddd",{weekday:"long"},e),u:e=>{const r=Ri.u||(Ri.u=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"})),t=r.formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}Z`},uu:e=>{const r=Ri.uu||(Ri.uu=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),t=r.formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}T${t[6].value}${t[8].value}${t[10].value}Z`},e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>b.getWeekNumber(e)[1],Wo:e=>Zr(lt.W(e).toString()),WW:e=>lt.W(e).toString().padStart(2,"0"),Wp:e=>`${b.localize("L{Week}")} ${lt.W(e)}`,WWp:e=>`${b.localize("L{Week}")} ${lt.WW(e)}`,Wp0:e=>`${b.localize("L{Week}")[0]}${lt.W(e)}`,WWp0:e=>`${b.localize("L{Week}")[0]}${lt.WW(e)}`,Y:e=>e.getFullYear(),YY:e=>(e.getFullYear()%100).toString().padStart(2,"0"),YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>lt.h(e).toString().padStart(2,"0"),k:e=>e.getHours()||24,kk:e=>lt.k(e).toString().padStart(2,"0"),K:e=>Ko("K",{hour:"numeric"},e),KK:e=>Ko("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>lt.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>lt.s(e).toString().padStart(2,"0"),S:e=>Math.floor(e.getMilliseconds()/100).toString(),SS:e=>Math.floor(e.getMilliseconds()/10).toString().padStart(2,"0"),SSS:e=>e.getMilliseconds().toString().padStart(3,"0"),z:e=>wt("z",{timeZoneName:"short"},e),zz:e=>wt("zz",{timeZoneName:"long"},e),Z:e=>L.getGMTOffset(e),LT:e=>Ko("LT",{hour:"2-digit",minute:"2-digit"},e),LST:e=>Ko("LST",{hour:"numeric",minute:"2-digit"},e,!0),LTS:e=>Ko("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>wt("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>wt("l",Of.l,e),LL:e=>wt("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>wt("ll",Of.ll,e),LLL:e=>wt("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>wt("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>wt("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>wt("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},oI=Object.keys(lt).sort((e,r)=>r.length-e.length),lI=`^(?:${oI.join("|")})`,Tt=()=>({}),cI=e=>vI.test(e),Lf=e=>cI(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))},MS={YYYY:e=>{const r=parseInt(e);return{year:r>=1e3&&r<=9999?r:NaN}},Y:e=>({year:parseInt(e)}),YY:e=>{const r=parseInt(e);return{year:r+(r>1968?1900:2e3)}},M:e=>({month:parseInt(e)-1}),MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),MMM:e=>{const r=(e||"").toLowerCase();for(const[t,i]of Object.entries(b._monthShortNamesIndex))if(r.startsWith(t))return{month:i.value}},MMMM:e=>{const r=(e||"").toLowerCase();for(const[t,i]of Object.entries(b._monthNamesIndex))if(r.startsWith(t))return{month:i.value}},DD:e=>({date:parseInt(e)}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:Tt,DDDo:Tt,DDDD:Tt,d:Tt,do:Tt,d1:Tt,dd:Tt,ddd:Tt,dddd:Tt,Q:Tt,Qo:Tt,W:Tt,Wo:Tt,WW:Tt,e:Tt,E:Tt,HH:e=>({hours:parseInt(e)}),hh:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:Lf,SS:Lf,SSS:Lf,A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A",l:{type:"dynamic",parser:()=>ES("l")},ll:{type:"dynamic",parser:()=>ES("ll")},Z:e=>{if(!e||!AS.test(e)&&e!=="Z")return null;let r=0;if(e!=="Z"){const t=AS.exec(e);if(t){const i=t[1]==="+"?1:-1,n=parseInt(t[2])||0,s=parseInt(t[3])||0;r=i*(n*60+s)}else r=-1*new Date().getTimezoneOffset()}return{timeZone:r}}},dI=Object.keys(MS).sort((e,r)=>r.length-e.length),IS=new RegExp(`(${dI.join("|")})`),uI=new RegExp("^(LL|LLL|lll|LLLL|llll)$"),Lt={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:24*3652,minute:1440*3652,second:86400*3652,millisecond:864e5*3652},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:24*365,minute:1440*365,second:86400*365,millisecond:864e5*365},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:24*91,minute:1440*91,second:86400*91,millisecond:864e5*91},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-24*30,minute:-1440*30,second:-86400*30,millisecond:-864e5*30},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/(3652*24),year:-1/(365*24),quarter:-1/(91*24),month:-1/(30*24),week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/(3652*1440),year:-1/(365*1440),quarter:-1/(91*1440),month:-1/(30*1440),week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/(3652*86400),year:-1/(365*86400),quarter:-1/(91*86400),month:-1/(30*86400),week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/(3652*864e5),year:-1/(365*864e5),quarter:-1/(91*864e5),month:-1/(30*864e5),week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:1/1e3}},PS={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",mi:"minute",min:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",mo:"month",mon:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year",dec:"decade",decades:"decade"},hI=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,gI=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,Zs=["millisecond","second","minute","hour","day","week","month","quarter","year","decade"],fI=[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],$f=["decade","year","month","week","day","hour","minute","second","millisecond"],mI=["milliseconds","seconds","minutes","hours","date","month","year"],pI=e=>{const r=parseFloat(e);return isNaN(r)?null:r},vI=/^[0-9]+$/,AS=/([+-])(\d\d):*(\d\d)*$/,dr={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8,decade:9},yI={round(e,r=1){return Math.round(e/r)*r},floor(e,r=1){return Math.floor(e/r)*r},ceil(e,r=1){return Math.ceil(e/r)*r}},_S={},Jr=class extends We(){static get $name(){return"DateHelper"}static set defaultFormat(e){L._defaultFormat=e}static get defaultFormat(){return L._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static buildParser(e){const r=e.split(IS),t=[];return r.length===1||uI.test(e)?[]:(r.reduce((i,n,s,a)=>{if(s!==0||n!=="")if(IS.test(n)){const o=this.localize("L{parsers}")||{},l=o[n]||MS[n];if(n==="Z"&&s<a.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);const c=typeof l=="function"||typeof l=="string"?l:l.parser();if(typeof c=="string"){const d=L.buildParser(c),u=d.pop();delete u.last,t.push(...d),i=u}else i.pattern=n,i.fn=c}else i.splitter=n,t.push(i),i={};else Object.prototype.hasOwnProperty.call(i,"pattern")&&t.push(i);return i},{}),t[t.length-1].last=!0,t)}static makeKey(e){if(e.length===10)return e;e.getTime&&(e=e.getTime());const r=_S[Math.trunc(e/_f)];if(r)return r;Ed.setTime(e);const t=Ed.getMonth()+1,i=Ed.getDate();return _S[Math.trunc(e/_f)]=`${Ed.getFullYear()}-${t<10?"0"+t:t}-${i<10?"0"+i:i}`}static parseKey(e){return L.parse(e,"YYYY-MM-DD")}static parse(e,r=L.defaultParseFormat,t=!1){if(e instanceof Date)return e;if(typeof e!="string"||!e)return null;const i={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};r=r.replace(sI,aI);let n=Ff[r],s;if(n||(n=Ff[r]=L.buildParser(r)),e.includes("\u202F")&&(e=e.replace(/\s/g," ")),n.reduce((o,l)=>{var c;if(l.last)Object.assign(i,l.fn(o));else{let d;if(l.splitter==="T"&&o.indexOf("T")===-1)d=o.indexOf(" ");else{const g=o.indexOf("+");let{splitter:f}=l;!t&&wS.test(f)&&(f=wS),d=l.splitter!==""?o.search(typeof f=="string"?O.escapeRegExp(f):f):((c=l.pattern)==null?void 0:c.length)||-1,g>-1&&d>g&&(d=-1)}let u,h;if(d===-1||l.pattern==="SSS"&&o.match(/^\d+Z$/)){const g=o.split(/([Z\-+])/);g.length===1?(u=o,h=""):(u=g[0],h=`${g[1]}${g[2]}`)}else u=o.substring(0,d)||o,h=o.substring(d+l.splitter.length);if(l.fn){const g=l.fn(u);g?Object.assign(i,g):h=u+h}return h}},e),i.year&&!i.date&&(i.date=1),i.date>31||i.month>12)return null;const a=L.create(i,t);return a?s=a:t||(s=new Date(e)),s}static create(e,r=!1){const t={...e};let i=isNaN(t.year)||r&&(isNaN(t.month)||isNaN(t.date)),n=!1;if(!i){let a=!0;mI.forEach(o=>{(!(o in t)||isNaN(t[o]))&&(t[o]=0),a=a&&t[o]===null}),i=a}if(i||(t.amPm==="am"?t.hours=t.hours%12:t.amPm==="pm"&&(t.hours=t.hours%12+12),"timeZone"in t&&(n=!0,t.minutes-=t.timeZone),r&&(t.year==null||t.month==null||t.date==null)))return null;const s=[kf(t.year,xS),kf(t.month,RS),kf(t.date,TS),t.hours,t.minutes,t.seconds,t.milliseconds];return n?new Date(Date.UTC(...s)):new Date(...s)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,r=L.defaultFormat){if(!e||isNaN(e))return null;let t=xd[r],i="";if(!t){t=xd[r]=[];for(let n=0;n<r.length;n++){const s=r.slice(n).match(lI),a=s==null?void 0:s[0];if(a){const o=this.localize("L{formats}")||{},l=o[a]||lt[a];t.push(l),n+=a.length-1}else if(r[n]==="{"){const o=r.indexOf("}",n+1);o===-1?(t.push(r.substr(n+1)),n=r.length):(t.push(r.substring(n+1,o)),n=o)}else t.push(r[n])}}return t.forEach(n=>{typeof n=="string"?i+=n:i+=n(e)}),i}static formatRange(e,r){return r.replace(iI,(t,i,n)=>Jr.format(e[i==="S"?0:1],n))}static asMilliseconds(e,r=null){return typeof e=="string"&&(r=e,e=1),L.as("millisecond",e,r)}static asMonths(e){const r=L.as("ms",L.daysInMonth(e),"day"),t=(e.valueOf()-L.startOf(e,"month").valueOf())/r;return e.getYear()*12+e.getMonth()+t}static monthsToDate(e){const r=Math.floor(e),t=e-r,i=new Date(0,r),n=L.as("ms",L.daysInMonth(i),"days");return i.setTime(i.getTime()+t*n),i}static formatDelta(e,r){let t,i;typeof r=="boolean"?t=r:r&&(t=r.abbrev);const n=this.getDelta(e,r),s=[],a=(r==null?void 0:r.separator)||(t?"":" ");for(i in n)s.push(`${n[i]}${a}${i}`);return(r==null?void 0:r.asString)===!1?s:s.join(", ")}static getDelta(e,r){let t,i,n,s,a,o,l;typeof r=="boolean"?t=r:r&&(t=r.abbrev,s=L.normalizeUnit(r.precision),o=r.maxUnit,l=!t&&r.ignoreLocale);const c={},d=t?L.getShortNameOfUnit:L.getLocalizedNameOfUnit,u=o?$f.slice($f.indexOf(o)):$f;for(a of u)if(i=L.as(a,e),n=s===a,i=Math[n?"round":"floor"](i),(i||n&&!c.length)&&(c[l?a:d.call(L,a,i!==1)]=i,e-=L.as("ms",i,a)),n||!e)break;return c}static as(e,r,t="ms"){return typeof r=="string"&&(r=L.parseDuration(r)),typeof r=="object"&&(t=r.unit,r=r.magnitude),e===t||(e=L.normalizeUnit(e),t=L.normalizeUnit(t),e===t)?r:dr[t]>dr[e]?r*Math.abs(Lt[t][e]):r/Math.abs(Lt[e][t])}static formatContainsHourInfo(e){const r=/(\\.)/g;return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(r,""))}static is24HourFormat(e){return L.format(L.getTime(13,0,0),e).includes("13")}static add(e,r,t="ms",i=!0){let n;if(typeof e=="string"?n=L.parse(e):i?n=new Date(e.getTime()):n=e,typeof r=="string"){const s=Jr.parseDuration(r);r=s.magnitude,t=s.unit}else r&&typeof r=="object"&&(t=r.unit,r=r.magnitude);if(!t||r===0)return n;switch(t=L.normalizeUnit(t),t){case"millisecond":n.setTime(n.getTime()+r);break;case"second":n.setTime(n.getTime()+r*1e3);break;case"minute":n.setTime(n.getTime()+r*6e4);break;case"hour":n.setTime(n.getTime()+r*36e5);break;case"day":r%1===0?(n.setDate(n.getDate()+r),n.getHours()===23&&e.getHours()===0&&n.setHours(n.getHours()+1)):n.setTime(n.getTime()+r*864e5);break;case"week":n.setDate(n.getDate()+r*7);break;case"month":{let s=n.getDate();s>28&&(s=Math.min(s,L.getLastDateOfMonth(L.add(L.getFirstDateOfMonth(n),r,"month")).getDate())),n.setDate(s),n.setMonth(n.getMonth()+r);break}case"quarter":L.add(n,r*3,"month",!1);break;case"year":n.setFullYear(n.getFullYear()+r);break;case"decade":n.setFullYear(n.getFullYear()+r*10);break}return n}static diff(e,r,t="ms",i=!0){if(t=L.normalizeUnit(t),!e||!r)return 0;let n;switch(t){case"year":n=L.diff(e,r,"month")/12;break;case"quarter":n=L.diff(e,r,"month")/3;break;case"month":n=(r.getFullYear()-e.getFullYear())*12+(r.getMonth()-e.getMonth()),n===0&&i&&(n=L.diff(e,r,"day",i)/L.daysInMonth(e));break;case"week":n=L.diff(e,r,"day")/7;break;case"day":{const s=e.getTimezoneOffset()-r.getTimezoneOffset();n=(r-e+s*60*1e3)/864e5;break}case"hour":n=(r-e)/36e5;break;case"minute":n=(r-e)/6e4;break;case"second":n=(r-e)/1e3;break;case"millisecond":n=r-e;break}return i?n:Math.round(n)}static startOf(e,r="day",t=!0,i=L.weekStartDay){if(!e)return null;switch(r=L.normalizeUnit(r),t&&(e=L.clone(e)),r){case"year":return e.setMonth(0,1),e.setHours(0,0,0,0),e;case"quarter":return e.setMonth((L.get(e,"quarter")-1)*3,1),e.setHours(0,0,0,0),e;case"month":return e.setDate(1),e.setHours(0,0,0,0),e;case"week":{const n=e.getDay()-i;return e.setDate(e.getDate()-n),e.setHours(0,0,0,0),e}case"day":return e.setHours(0,0,0,0),e;case"hour":e.getMinutes()>0&&e.setMinutes(0);case"minute":e.getSeconds()>0&&e.setSeconds(0);case"second":e.getMilliseconds()>0&&e.setMilliseconds(0);case"millisecond":return e}}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,r=!0){return e?(r&&(e=new Date(e.getTime())),e.setHours(0,0,0,0),e):null}static midnight(e,r){let t=L.clearTime(e);return r&&t<e&&(t=L.add(t,1,"d")),t}static getTimeOfDay(e,r="ms"){const t=e.getHours()*Lt.hour.millisecond+e.getMinutes()*Lt.minute.millisecond+e.getSeconds()*Lt.second.millisecond+e.getMilliseconds();return r==="ms"?t:L.as(r,t,"ms")}static set(e,r,t){if(!r)return e;if(typeof r=="string")switch(L.normalizeUnit(r)){case"millisecond":(t!==0||e.getMilliseconds()>0)&&e.setMilliseconds(t);break;case"second":(t!==0||e.getSeconds()>0)&&e.setSeconds(t);break;case"minute":(t!==0||e.getMinutes()>0)&&e.setMinutes(t);break;case"hour":e.setHours(t);break;case"day":case"date":e.setDate(t);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(t);break;case"quarter":e.setDate(1),e.setMonth((t-1)*3);break;case"year":e.setFullYear(t);break}else Object.entries(r).sort((i,n)=>dr[i[0]]-dr[n[0]]).forEach(([i,n])=>{L.set(e,i,n)});return e}static setDateToMidday(e,r=!0){return L.set(L.clearTime(e,r),"hour",12)}static constrain(e,r,t){return r!=null&&(e=L.max(e,r)),t==null?e:L.min(e,t)}static getTime(e,r=0,t=0,i=0){return e instanceof Date&&(i=e.getMilliseconds(),t=e.getSeconds(),r=e.getMinutes(),e=e.getHours()),new Date(xS,RS,TS,e,r,t,i)}static copyTimeValues(e,r){return e.setHours(r.getHours()),e.setMinutes(r.getMinutes()),e.setSeconds(r.getSeconds()),e.setMilliseconds(r.getMilliseconds()),e}static get isDSTEnabled(){const e=new Date().getFullYear(),r=new Date(e,0,1),t=new Date(e,6,1);return r.getTimezoneOffset()!==t.getTimezoneOffset()}static isDST(e){const r=e.getFullYear(),t=new Date(r,0,1),i=new Date(r,6,1);return e.getTimezoneOffset()<Math.max(t.getTimezoneOffset(),i.getTimezoneOffset())}static isBefore(e,r){return e<r}static isAfter(e,r){return e>r}static isEqual(e,r,t=null){return t===null?e&&r&&e.getTime()===r.getTime():L.startOf(e,t)-L.startOf(r,t)===0}static compare(e,r,t=null){return t&&(e=L.startOf(e,t),r=L.startOf(r,t)),e<r?-1:e>r?1:0}static clamp(e,r,t){if(!isNaN(e))return r!=null&&(e=Math.max(e,r)),t!=null&&(e=Math.min(e,t)),new Date(e)}static isSameDate(e,r){return L.compare(e,r,"d")===0}static isSameTime(e,r){return e.getHours()===r.getHours()&&e.getMinutes()===r.getMinutes()&&e.getSeconds()===r.getSeconds()&&e.getMilliseconds()===r.getMilliseconds()}static isStartOf(e,r){return L.isEqual(e,L.startOf(e,r))}static betweenLesser(e,r,t){return r.getTime()<=e.getTime()&&e.getTime()<t.getTime()}static betweenLesserEqual(e,r,t){return r.getTime()<=e.getTime()&&e.getTime()<=t.getTime()}static intersectSpans(e,r,t,i){return L.betweenLesser(e,t,i)||L.betweenLesser(t,e,r)}static compareUnits(e,r){return Math.sign(dr[L.normalizeUnit(e)]-dr[L.normalizeUnit(r)])}static timeSpanContains(e,r,t,i){return t-e>=0&&r-i>=0}static get weekStartDay(){return L._weekStartDay==null&&(L._weekStartDay=this.localize("L{weekStartDay}")||0),L._weekStartDay}static get nonWorkingDays(){return{...this.localize("L{nonWorkingDays}")}}static get nonWorkingDaysAsArray(){return Object.keys(this.nonWorkingDays).map(Number)}static get weekends(){return{...this.localize("L{weekends}")}}static get(e,r){switch(L.normalizeUnit(r)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return lt.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInYear(e){const r=e.getFullYear(),t=new Date(r+1,0,1)-new Date(r,0,1);return this.as("day",t)}static daysInMonth(e){return 32-new Date(e.getFullYear(),e.getMonth(),32).getDate()}static hoursInDay(e){const r=e.getFullYear(),t=e.getMonth(),i=e.getDate(),n=new Date(r,t,i+1)-new Date(r,t,i);return this.as("hour",n)}static getNormalizedUnitDuration(e,r){let t;switch(r){case"month":t=L.asMilliseconds(L.daysInMonth(e),"day");break;case"year":t=L.asMilliseconds(L.daysInYear(e),"day");break;case"day":t=L.asMilliseconds(L.hoursInDay(e),"hour");break;default:t=L.asMilliseconds(r)}return t}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,r){return e.getTime()<r.getTime()?e:r}static max(e,r){return e.getTime()>r.getTime()?e:r}static getNext(e,r,t=1,i=L.weekStartDay){if(r==="week"){const n=L.clone(e),s=n.getDay();return L.startOf(n,"day",!1),L.add(n,i-s+7*(t-(i<=s?0:1)),"day",!1),n.getDay()!==i&&L.add(n,1,"hour"),n}return L.startOf(L.add(e,t,r),r,!1)}static isValidDate(e){return L.isDate(e)&&!isNaN(e)}static isDate(e){return e&&CS.call(e)===rI}static getStartOfNextDay(e,r=!1,t=!1){let i=L.add(t?e:L.clearTime(e,r),1,"day");if(i.getDate()===e.getDate()){const n=L.add(L.clearTime(e,r),2,"day").getTimezoneOffset(),s=e.getTimezoneOffset();i=L.add(i,s-n,"minute")}return i}static getEndOfPreviousDay(e,r=!1){const t=r?e:L.clearTime(e,!0);return t-e?t:L.add(t,-1,"day")}static getWeekDescription(e,r=e){const t=e.getMonth()===r.getMonth()?Jr.format(e,"MMMM"):`${Jr.format(e,"MMM")} - ${Jr.format(r,"MMM")}`,i=Jr.getWeekNumber(e);return`${i[1]}, ${t} ${i[0]}`}static getWeekNumber(e,r=Jr.weekStartDay){const t=new Date(e.getFullYear(),0,1),i=new Date(e.getFullYear(),11,31),n=DS(t.getDay()-r),s=DS(i.getDay()-r),a=nI(e,t);let o;if(n<4?o=Math.floor((a+n-1)/7)+1:o=Math.floor((a+n-1)/7),o){let c=e.getFullYear();return o===53&&s<3&&(c++,o=1),[c,o]}const l=Jr.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,l]}static formatCount(e,r){return r=L.normalizeUnit(r),e!==1&&(r+="s"),e+" "+r}static getUnitToBaseUnitRatio(e,r,t=!1){return e=L.normalizeUnit(e),r=L.normalizeUnit(r),e===r?1:Lt[e]&&Lt[e][r]&&(t||Lt[e][r]>0)?1/L.as(r,1,e):Lt[r]&&Lt[r][e]&&(t||Lt[r][e]>0)?L.as(e,1,r):-1}static getShortNameOfUnit(e){return e=L.parseTimeUnit(e),L.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,r=!1){const t=e.charAt(0)===e.charAt(0).toUpperCase();return e=L.normalizeUnit(e),e=L.parseTimeUnit(e),e=L.unitLookup[e][r?"plural":"single"],t&&(e=O.capitalize(e)),e}static normalizeUnit(e){if(!e)return null;const r=e.toLowerCase();return r==="date"||Zs.includes(r)?r:PS[e]||PS[r]}static getUnitByName(e){return L.normalizeUnit(e)||L.normalizeUnit(L.parseTimeUnit(e))}static getDurationInUnit(e,r,t,i){return L.diff(e,r,t,i)}static doesUnitsAlign(e,r){return!(e!==r&&r==="week")}static getSmallerUnit(e){return Zs[dr[L.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return Zs[dr[L.normalizeUnit(e)]+1]||null}static round(e,r,t,i){return L.snap("round",e,r,t,i)}static floor(e,r,t,i){return L.snap("floor",e,r,t,i)}static ceil(e,r,t,i){return L.snap("ceil",e,r,t,i)}static snap(e,r,t,i,n=L.weekStartDay){const s=yI[e];if(typeof t=="string"&&(t=L.parseDuration(t)),N.isObject(t)){const a=t.magnitude||t.increment;switch(t.unit){case"week":{const o=r.getDay();return i=L.add(L.clearTime(r),o>=n?n-o:-(o-n+7),"day"),L[e](r,`${a*7} days`,i)}case"month":{r=L.asMonths(r);let o;return i?(i=L.asMonths(i),o=r+s(r-i,a)):o=s(r,a),L.monthsToDate(o)}case"quarter":return L[e](r,`${a*3} months`,i);case"year":return L[e](r,`${a*12} months`,i);case"decade":return L[e](r,`${a*10} years`,i)}t=L.as("ms",a,t.unit)}if(i){const a=L.as("ms",i.getTimezoneOffset()-r.getTimezoneOffset(),"ms");return new Date(i.valueOf()+s(L.diff(i,r,"ms")+a,t))}else{const a=r.getTimezoneOffset()*60*1e3;return new Date(s(r.valueOf()-a,t)+a)}}static parseDuration(e,r=!0,t){var i;const n=r?hI:gI,s=n.exec(e);if(e==null||!s)return null;const a=pI((i=s[1])==null?void 0:i.replace(",",".")),o=L.parseTimeUnit(s[2])||t;return o?{magnitude:a,unit:o}:null}static parseTimeUnit(e){const r=e==null?null:L.durationRegEx.exec(e.toLowerCase());if(!r)return null;for(let t=0;t<Zs.length;t++)if(r[t+1])return Zs[t]}static getGMTOffset(e=new Date){if(!e)return;const r=e.getTimezoneOffset();return r?(r>0?"-":"+")+Math.abs(Math.trunc(r/60)).toString().padStart(2,"0")+":"+Math.abs(r%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),r=L._dayNames||[],t=L._dayShortNames||[];r.length=0,t.length=0;for(let i=2;i<9;i++)e.setDate(i),r.push(L.format(e,"dddd")),t.push(L.format(e,"ddd"));L._dayNames=r,L._dayShortNames=t}static getDayNames(){return L._dayNames}static getDayName(e){return L._dayNames[e]}static getDayShortNames(){return L._dayShortNames}static getDayShortName(e){return L._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),r=L._monthNames||[],t=L._monthShortNames||[],i={},n={};r.length=0,t.length=0;for(let s=0;s<12;s++){e.setMonth(s);const a=L.format(e,"MMMM");r.push(a);const o=L.format(e,"MMM");t.push(o),i[a.toLowerCase()]={name:a,value:s},n[o.toLowerCase()]={name:o,value:s}}L._monthNames=r,L._monthShortNames=t,L._monthNamesIndex=i,L._monthShortNamesIndex=n}static getMonthShortNames(){return L._monthShortNames}static getMonthShortName(e){return L._monthShortNames[e]}static getMonthNames(){return L._monthNames}static getMonthName(e){return L._monthNames[e]}static set locale(e){xi=e,Ri={},xd={},Xo={}}static get locale(){return xi}static setupDurationRegEx(e=[],r=[]){const t=this,i={};let n="";for(let s=0;s<r.length;s++){const a=r[s],o=e[s];o.canonicalUnitName=Zs[s],i[o.single]=i[o.single.toUpperCase()]=i[o.canonicalUnitName]=i[o.canonicalUnitName.toUpperCase()]=o,n+=`${s?"|":""}(`;for(let l=0;l<a.length;l++)n+=`${a[l]}|`;if(xi=t.localize("L{locale}")||"en-US",xi!=="en-US"){const l=fI[s];for(let c=0;c<l.length;c++)n+=`${l[c]}|`}n+=`${o.single}|${o.plural}|${o.canonicalUnitName}|${o.canonicalUnitName}s)`}t.unitLookup=i,t.durationRegEx=new RegExp(`^(?:${n})$`)}static applyLocale(){const e=this,r=e.localize("L{unitAbbreviations}")||[],t=e.unitNames=e.localize("L{unitNames}");t!=="unitNames"&&(xi=e.localize("L{locale}")||"en-US",xi==="en-US"?Zr=SS:Zr=e.localize("L{ordinalSuffix}")||Zr,xd={},Xo={},Ff={},Ri={},L._weekStartDay=null,L.setupDurationRegEx(t,r),L.fillDayNames(),L.fillMonthNames())}},b=Jr;E(b,"MS_PER_DAY",_f*24);var L=b;L.useIntlFormat=wt,ze.ion({locale:"applyLocale",prio:1e3,thisObj:L}),ze.locale&&L.applyLocale(),b._$name="DateHelper";var{hasOwn:jf}=N,kS=1.005.toFixed(2)==="1.01"?null:function(e,r){const t=e.toString().split("."),i=+(t[1]?t.join(".")+"1":t[0]);return e.toFixed.call(i,r)},T=class extends N{static transformArrayToNamedObject(e,r="ref"){const t={};return e.forEach((i,n)=>{const s=i[r]!=null&&i[r].toString().length?i[r]:n;t[s]=i}),t}static transformNamedObjectToArray(e,r="ref"){return Object.keys(e).filter(t=>e[t]).map(t=>{const i=e[t];return i[r]=t,i})}static isEqual(e,r,t=!1){if(e===null&&r!==null||e===void 0&&r!==void 0||r===null&&e!==null||r===void 0&&e!==void 0)return!1;if(e==null&&r==null||e===r)return!0;const i=typeof e;if(i===typeof r){switch(i){case"number":case"string":case"boolean":return e===r}switch(!0){case(e instanceof Date&&r instanceof Date):return e.getTime()===r.getTime();case(Array.isArray(e)&&Array.isArray(r)):return e.length===r.length?e.every((s,a)=>Qt.isEqual(s,r[a],t)):!1;case(i==="object"&&e.constructor.prototype===r.constructor.prototype):return t?Qt.isDeeplyEqual(e,r,t):O.safeJsonStringify(e)===O.safeJsonStringify(r)}}return String(e)===String(r)}static isDeeplyEqual(e,r,t={}){if(e===r)return!0;if(!e||!r)return!1;const i=Qt.keys(e,t.ignore),n=Qt.keys(r,t.ignore);if(i.length!==n.length)return!1;for(let s=0;s<i.length;s++){const a=i[s],o=n[s];if(a!==o)return!1;const l=e[a],c=r[o];if(!(t.shouldEvaluate&&t.shouldEvaluate(a,{value:l,object:e},{value:c,object:r})===!1)){if(t.evaluate){const d=t.evaluate(a,{value:l,object:e},{value:c,object:r});if(d===!1)return!1;if(d===!0)continue}if(!Qt.isEqual(l,c,t))return!1}}return!0}static isPartial(e,r){return e=String(e).toLowerCase(),r=String(r).toLowerCase(),e.indexOf(r)!==-1}static isLessThan(e,r){return e instanceof Date&&r instanceof Date?b.isBefore(e,r):e<r}static isMoreThan(e,r){return e instanceof Date&&r instanceof Date?b.isAfter(e,r):e>r}static fork(e){let r,t,i;if(e&&e.constructor===Object){r=Object.setPrototypeOf({},e);for(t in e)i=e[t],i&&(i.constructor===Object?r[t]=Qt.fork(i):i instanceof Array&&(r[t]=i.slice()))}else r=e;return r}static copyProperties(e,r,t){let i,n;for(n=0;n<t.length;n++)i=t[n],i in r&&(e[i]=r[i]);return e}static copyPropertiesIf(e,r,t){if(r)for(const i of t)!(i in e)&&i in r&&(e[i]=r[i]);return e}static entries(e,r){const t=[],i=typeof r=="function";if(e)for(const n in e)(i?!r(n,e[n]):!(r!=null&&r[n]))&&t.push([n,e[n]]);return t}static fromEntries(e,r){if(r=r||{},e)for(let t=0;t<e.length;++t)r[e[t][0]]=e[t][1];return r}static keys(e,r,t){const i=[],n=typeof r=="function";if(e){let s=0;for(const a in e)(n?!r(a,e[a]):!(r!=null&&r[a]))&&(i.push(t?t(a,s):a),++s)}return i}static values(e,r,t){const i=[],n=typeof r=="function";if(e){let s=0;for(const a in e)(n?!r(a,e[a]):!(r!=null&&r[a]))&&(i.push(t?t(e[a],s):e[a]),++s)}return i}static pathExists(e,r){return r.split(".").every(i=>!e||!(i in e)?!1:(e=e[i],!0))}static pathifyKeys(e,r){const t={};for(const i in e)if(jf(e,i)){const n=r==null?void 0:r[i],s=(n==null?void 0:n.type)==="object"||(n==null?void 0:n.complexMapping)||!r;if(s&&Array.isArray(e[i]))t[i]=e[i].slice();else if(s&&e[i]instanceof Object){const a=this.pathifyKeys(e[i]);for(const o in a)t[`${i}.${o}`]=a[o]}else t[i]=e[i]}return t}static deletePath(e,r){r.split(".").reduce((t,i,n,s)=>{if(t==null)return null;if(jf(t,i))if(n===s.length-1)delete t[i];else return t[i]},e)}static coerce(e,r){const t=N.typeOf(e),i=N.typeOf(r),n=typeof e=="string";if(t!==i)switch(i){case"string":return String(e);case"number":return Number(e);case"boolean":return n&&(!e||e==="false"||e==="0")?!1:!!e;case"null":return n&&(!e||e==="null")?null:!1;case"undefined":return n&&(!e||e==="undefined")?void 0:!1;case"date":return n&&isNaN(e)?b.parse(e):Date(Number(e))}return e}static wrapProperty(e,r,t,i,n=!0){const s={};let a=Object.getPrototypeOf(e),o=Object.getOwnPropertyDescriptor(a,r);for(;!o&&a&&n;)a=Object.getPrototypeOf(a),a&&(o=Object.getOwnPropertyDescriptor(a,r));o?(o.set?s.set=l=>{o.set.call(e,l),i&&i.call(e,o.get.call(e))}:s.set=i,o.get?s.get=()=>{let l=o.get.call(e);return t&&(l=t.call(e,l)),l}:s.get=t):(s.set=l=>{e[`_${r}`]=l,i&&i.call(e,l)},s.get=()=>{let l=e[`_${r}`];return t&&(l=t.call(e,l)),l}),Object.defineProperty(e,r,s)}static hookProperty(e,r,t){const i=T.getPropertyDescriptor(t.prototype,"value"),n=T.getPropertyDescriptor(e,r),s=`_${r}`,a=class{get value(){return n?n.get.call(this):this[s]}set value(l){n?n.set.call(this,l):this[s]=l}},o=T.getPropertyDescriptor(a.prototype,"value");return Object.setPrototypeOf(t.prototype,a.prototype),Object.defineProperty(e,r,{configurable:!0,get:i.get||o.get,set:i.set||o.set}),()=>delete e[r]}static getPropertyDescriptor(e,r){let t=null;for(let i=e;i&&!t&&!jf(i,"isBase");i=Object.getPrototypeOf(i))t=Object.getOwnPropertyDescriptor(i,r);return t}static cleanupProperties(e,r=!1){return Object.entries(e).forEach(([t,i])=>{r?i===void 0&&delete e[t]:i==null&&delete e[t]}),e}static removeAllProperties(e){return Object.keys(e).forEach(r=>delete e[r]),e}static assertType(e,r,t){const i=N.typeOf(e);if(e!=null&&i!==r)throw new Error(`Incorrect type "${i}" for ${t}, expected "${r}"`)}static assertObject(e,r){Qt.assertType(e,"object",r)}static assertInstance(e,r){Qt.assertType(e,"instance",r)}static assertClass(e,r){Qt.assertType(e,"class",r)}static assertFunction(e,r){if(typeof e!="function"||e.isBase||e.$$name)throw new Error(`Incorrect type for ${r}, got "${e}" (expected a function)`)}static assertNumber(e,r){const t=Number(e);if(typeof e!="number"||isNaN(t))throw new Error(`Incorrect type for ${r}, got "${e}" (expected a Number)`)}static assertBoolean(e,r){Qt.assertType(e,"boolean",r)}static assertString(e,r){Qt.assertType(e,"string",r)}static assertArray(e,r){Qt.assertType(e,"array",r)}static toFixed(e,r){return kS?kS(e,r):e.toFixed(r)}static roundTo(e,r=1){return Math.round(e/r)*r}static round(e,r){if(r==null)return e;const t=10**r;return Math.round(e*t)/t}static getMapPath(e,r,t){const i=Array.isArray(r)?r:typeof r=="string"?r.split("."):[r],n=i.length===1,s=i[0],a=e.has(s)?e.get(s):e.set(s,n?t:{}).get(s);return n?a:Qt.getPathDefault(a,i.slice(1),t)}},Qt=T;T._$name="ObjectHelper";var FS=["border-top-width","border-right-width","border-bottom-width","border-left-width"],bI=["margin-top","margin-right","margin-bottom","margin-left"],CI=["padding-top","padding-right","padding-bottom","padding-left"],Ti={t:"border-top-width",r:"border-right-width",b:"border-bottom-width",l:"border-left-width"},Rd={t:"padding-top",r:"padding-right",b:"padding-bottom",l:"padding-left"},SI=Object.freeze({x:0,y:0}),DI=/^([trblc])(\d*)-([trblc])(\d*)$/i,wI=/^([trblc])(\d*)$/i,Td=["top","right","bottom","left"],Zo={t:0,r:1,b:2,l:3},Bf=["b-t","l-r","t-b","r-l"],EI={bt:1,tb:1,lr:2,rl:2},OS=Object.freeze([0,0]),xI=["width","height"],Md=(e,r=e,t=e,i=r)=>Array.isArray(e)?Md.apply(null,e):[e,r,t,i];function LS(e,r){const t=DI.exec(e),i=t[1],n=t[3],s=parseInt(t[2]||50),a=parseInt(t[4]||50),o=r&&!(Zo[i]&1)?100-s:s,l=r&&!(Zo[n]&1)?100-a:a,c=EI[i+n];return{myAlignmentPoint:i+o,myEdge:i,myOffset:o,targetAlignmentPoint:n+l,targetEdge:n,targetOffset:l,startZone:Zo[n],edgeAligned:c}}function RI(e){return`${Td[(Zo[e.myEdge]+2)%4][0]}${e.myOffset}-${Td[(Zo[e.targetEdge]+2)%4][0]}${e.targetOffset}`}function TI(e){return e==null?OS:typeof e=="number"?[e,e]:e}var k=class{get isRectangle(){return!0}static from(e,r,t){if(typeof e=="string"?e=document.querySelector(e):(e==null?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&(e=e.host||e.ownerDocument),typeof r=="string"&&(r=document.querySelector(r)),e==null||e.isRectangle)return e;if(e=e.element||e,t===void 0&&typeof r=="boolean"&&(t=r,r=null),!(r!=null&&r.isRectangle))if(r){let{scrollLeft:l,scrollTop:c}=r;q.isSafari&&r===document.body&&(l=c=0),r=k.from(r).translate(-l,-c)}else r=SI;const i=e===document||e===globalThis,n=e===document.body&&document.body.offsetHeight===0,s=n&&e.getBoundingClientRect(),a=n?new k(s.left,s.top,s.width,document.body.parentElement.scrollHeight):i?new k(0,0,globalThis.innerWidth,globalThis.innerHeight):e.getBoundingClientRect(),o=t||i?[0,0]:[globalThis.pageXOffset,globalThis.pageYOffset];return new k(a.left+o[0]-r.x,a.top+o[1]-r.y,a.width,a.height)}static fromScreen(e,r){return k.from(e,r,!0)}static inner(e,r,t=!1){const i=this.from(e,r,t);if(document.body.contains(e)){const n=w.getStyleValue(e,FS);i.x+=parseFloat(n[Ti.l]),i.y+=parseFloat(n[Ti.t]),i.right-=parseFloat(n[Ti.r]),i.bottom-=parseFloat(n[Ti.b])}return i}static content(e,r,t=!1){const i=this.from(e,r,t);if(document.body.contains(e)){const n=w.getStyleValue(e,FS),s=w.getStyleValue(e,CI);i.x+=parseFloat(n[Ti.l])+parseFloat(s[Rd.l]),i.y+=parseFloat(n[Ti.t])+parseFloat(s[Rd.t]),i.right-=parseFloat(n[Ti.r])+parseFloat(s[Rd.r]),i.bottom-=parseFloat(n[Ti.b])+parseFloat(s[Rd.b])}return i}static client(e,r,t=!1){const i=this.content(e,r,t),n=w.scrollBarWidth;let s;return n&&(e.scrollHeight>e.clientHeight&&w.getStyleValue(e,"overflow-y")!=="hidden"&&(s=parseFloat(w.getStyleValue(e,"padding-right")),i.right+=s-Math.max(s,n)),e.scrollWidth>e.clientWidth&&w.getStyleValue(e,"overflow-x")!=="hidden"&&(s=parseFloat(w.getStyleValue(e,"padding-bottom")),i.bottom+=s-Math.max(s,n))),i}static outer(e,r,t=!1){const i=this.from(e,r,t);if(document.body.contains(e)){const n=w.getStyleValue(e,bI);i.x-=parseFloat(n["margin-left"]),i.y-=parseFloat(n["margin-top"]),i.right+=parseFloat(n["margin-right"]),i.bottom+=parseFloat(n["margin-bottom"])}return i}static union(...e){let{x:r,y:t,right:i,bottom:n}=e[0],s;if(e.length>1)for(let a=1;a<e.length;a++)s=e[a],s.x<r&&(r=s.x),s.y<t&&(t=s.y),s.right>i&&(i=s.right),s.bottom>n&&(n=s.bottom);return new k(r,t,i-r,n-t)}roundPx(e=globalThis.devicePixelRatio||1){const r=this;return r._x=w.roundPx(r._x,e),r._y=w.roundPx(r._y,e),r._width=w.roundPx(r._width,e),r._height=w.roundPx(r._height,e),r}static get $$name(){return hasOwnProperty.call(this,"$name")&&this.$name||hasOwnProperty.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}constructor(e,r,t,i){T.assertNumber(e,"Rectangle.x"),T.assertNumber(r,"Rectangle.y"),T.assertNumber(t,"Rectangle.width"),T.assertNumber(i,"Rectangle.height");const n=this;t<0&&(e+=t,t=-t),i<0&&(r+=i,i=-i),n._x=e,n._y=r,n._width=t,n._height=i}clone(){const e=this,r=new k(e.x,e.y,e.width,e.height);return r.isAlignRectangle=e.isAlignRectangle,r.minHeight=e.minHeight,r.minWidth=e.minWidth,r}contains(e){const r=this;return e.isRectangle?e._x>=r._x&&e._y>=r._y&&e.right<=r.right&&e.bottom<=r.bottom:!1}intersect(e,r=!1,t=!1){const i=this,n=Math.max(i.y,e.y),s=Math.min(i.right,e.right),a=Math.min(i.bottom,e.bottom),o=Math.max(i.x,e.x);return(t?a>=n&&s>=o:a>n&&s>o)?r?!0:new k(o,n,s-o,a-n):!1}equals(e,r=!1){const t=r?i=>Math.round(i):i=>i;return e.isRectangle&&t(e.x)===t(this.x)&&t(e.y)===t(this.y)&&t(e.width)===t(this.width)&&t(e.height)===t(this.height)}translate(e,r){return this._x+=e||0,this._y+=r||0,this}moveTo(e,r){return e!=null&&(this._x=e),r!=null&&(this._y=r),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){return new k.Point(this.x+this.width/2,this.y+this.height/2)}set x(e){const r=e-this._x;this._x=e,this._width-=r}get x(){return this._x}get start(){return this.left}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){const r=e-this._y;this._y=e,this._height-=r}get y(){return this._y}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}get end(){return this.right}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}getStart(e,r=!0){return r?e?this.right:this.left:this.top}getEnd(e,r=!0){return r?e?this.left:this.right:this.bottom}get area(){return this.width*this.height}set minWidth(e){const r=this;isNaN(e)?r._minWidth=null:(r._minWidth=Number(e),r.isAlignRectangle||(r.width=Math.max(r.width,r._minWidth)))}get minWidth(){return this._minWidth}set minHeight(e){const r=this;isNaN(e)?r._minHeight=null:(r._minHeight=Number(e),r.isAlignRectangle||(r.height=Math.max(r.height,r._minHeight)))}get minHeight(){return this._minHeight}adjust(e,r,t,i){const n=this;return n.x+=e,n.y+=r,n.width+=t,n.height+=i,n}inflate(e,r=e,t=e,i=r){return Array.isArray(e)&&([e,r,t,i]=Md(e)),this.adjust(-i,-e,r,t)}deflate(e,r=e,t=e,i=r){return Array.isArray(e)&&([e,r,t,i]=Md(e)),this.adjust(i,e,-r,-t)}constrainTo(e,r){const t=this,i=t.height,n=t.y,s=t.minWidth||t.width,a=t.minHeight||t.height;if(t.height>=e.height){if(r&&a>e.height)return!1;t._y=e.y,t.height=e.height}if(t.width>=e.width){if(r&&s>e.width)return t.y=n,t.height=i,!1;t._x=e.x,t.width=e.width}return t.translate.apply(t,t.constrainVector=[Math.min(e.right-t.right,0),Math.min(e.bottom-t.bottom,0)]),t.translate(Math.max(e.x-t.x,0),Math.max(e.y-t.y,0)),t}alignTo(e){let r=this.clone(),{target:t,constrainTo:i,constrainPadding:n}=e,s,a,o,l;if(t&&!t.isRectangle&&(t=k.from(t.element?t.element:t)),i){if(!i.isRectangle){l=i===globalThis||i===document;const I="ignorePageScroll"in e?e.ignorePageScroll:!l;i=k.from(i.element?i.element:i,null,I)}n&&(n=Md(n),n[0]=Math.min(n[0],t.top),n[1]=Math.min(n[1],i.right-t.right),n[2]=Math.min(n[0],i.bottom-t.bottom),n[3]=Math.min(n[0],t.left),i=i.deflate.apply(i.clone(),n))}const c=this,d=TI(e.offset),{align:u,axisLock:h,anchorSize:g,anchorPosition:f,matchSize:m,position:p,rtl:v}=e,y=LS(u,v),C=i&&i.clone(),D=[],S=[{zone:a=y.startZone,align:u}],x=m&&xI[y.startZone&1],R=c[x];if(x&&h?r[x]=t[x]:!y.edgeAligned&&m&&(r.width=t.width,r.height=t.height),i&&r.constrainTo(i),i&&y.startZone!=null)if(h)S.push({zone:a=(a+2)%4,align:RI(y)}),h==="flexible"&&(S.push({zone:a=(y.startZone+1)%4,align:Bf[a]}),S.push({zone:a=(a+2)%4,align:Bf[a]}));else for(let I=1;I<4;I++)S.push({zone:a=(a+1)%4,align:Bf[a]});if(f){const I=y.startZone&1?"y":"x";s={[I]:f[I],edge:Td[(y.startZone+2)%4]}}if(C&&t&&(C.adjust(-t.width,-t.height,t.width,t.height),t.constrainTo(C)),r.minWidth=c.minWidth,r.minHeight=c.minHeight,p)r.moveTo(p.x,p.y),i&&r.constrainTo(i);else{const I=y.myEdge==="c"||y.targetEdge==="c",M=g&&!I?[g[1]+d[0],g[1]+d[1]]:d,P=t.getAlignmentPoint(y.targetAlignmentPoint,M),_=r.getAlignmentPoint(y.myAlignmentPoint);r.translate(P[0]-_[0],P[1]-_[1]);let A=r.intersect(t,!0);if(A)i&&r.constrainTo(i),o=y.startZone,r.translate(...M);else if(i&&!i.contains(r)){const z=r.clone(),Y=[];let V,U;s=null,D[0]=V=i.clone(),V.bottom=t.y-M[1],D[1]=V=i.clone(),V.x=t.right+M[0],D[2]=V=i.clone(),V.y=t.bottom+M[1],D[3]=V=i.clone(),V.right=t.x-M[0];for(let K=0;K<S.length;K++){if(x&&K==2&&(r[x]=R),V=D[o=S[K].zone],r=r.alignTo({target:t,offsets:M,align:S[K].align}),r.constrainTo(V,!0)&&(Y.push({result:r,zone:o}),!U||r.width<c.width||r.height<c.height)){r.align=S[K].align;break}if(!U||V.area>U.area){const le=r.clone();switch(o){case 0:le.moveTo(null,V.bottom-le.height);break;case 1:le.moveTo(V.left);break;case 2:le.moveTo(null,V.top);break;case 3:le.moveTo(V.right-le.width);break}U={area:V.area,result:le,zone:o}}}Y.length?(Y.length>1&&!h&&Y.sort((K,le)=>{const Ce=Math.sqrt((z.x-K.result.x)**2+(z.y-K.result.y)**2),Me=Math.sqrt((z.x-le.result.x)**2+(z.y-le.result.y)**2);return Ce-Me}),r=Y[0].result,o=Y[0].zone):(r=U.result,o=U.zone,l&&r.constrainTo(i))}else o=y.startZone;if(r.zone=o,r.overlap=A=r.intersect(t,!0),g&&!A){if(!s){const z=o&1,Y=z?"y":"x",V=z?"bottom":"right",U=Math.max(t[Y],r[Y]),K=Math.min(t[V],r[V]);let le=U+(K-U)/2-g[0]/2;const Ce=le+g[0];Ce>r[V]&&(le-=Ce-r[V]),le<r[Y]&&(le+=r[Y]-le),s={[Y]:le-r[Y],edge:Td[(o+2)%4]}}r.anchor=s}}return r}getAlignmentPoint(e,r=OS){const t=this,i=wI.exec(e),n=i[1].toLowerCase(),s=Math.min(Math.max(parseInt(i[2]||50),0),100)/100;switch(n){case"t":return[t.x+t.width*s,t.y-r[1]];case"r":return[t.right+r[0],t.y+t.height*s];case"b":return[t.x+t.width*s,t.bottom+r[1]];case"l":return[t.x-r[0],t.y+t.height*s];case"c":return[t.x+t.width/2,t.y+t.height/2]}}highlight(){const e=this,r=w.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;
                            left:${e.x}px;top:${e.y}px;width:${e.width}px;height:${e.height}px`});return w.highlight(r).then(()=>r.remove())}visualize(e,r){const t=this,i=T.merge({style:{left:`${t.x}px`,top:`${t.y}px`,width:`${t.width}px`,height:`${t.height}px`,pointerEvents:"none",...e.class?{}:{position:"absolute","z-index":9999999}}},e);return r?i:w.createElement(i)}toString(e=","){return[`${this.top}px`,`${this.right}px`,`${this.bottom}px`,`${this.left}px`].join(e)}};k._$name="Rectangle";var Sn=Symbol("value"),$S=Symbol("length"),J=class{static change(e,r,t,i="string"){t=J.normalize(t,"object");const n=J.normalize(e,"array").filter(s=>!t[s]);if(r){r=J.normalize(r,"array");for(let s=0;s<r.length;++s)n.includes(r[s])||n.push(r[s])}return J.normalize(n,i)}static from(e,r){return e&&(e.isDomClassList?r=r!=null?r:!0:(r=r!=null?r:N.isObject(e)&&!N.isEmpty(e),e=new J(e)),!e.value&&!r&&(e=null)),e||(r?new J:null)}static normalize(e,r="string"){e=e||"";const t=typeof e,i=r==="array",n=r==="object",s=!i&&!n;let a=t==="string",o,l,c;for(t==="object"&&(e.nodeType===Element.ELEMENT_NODE&&typeof e.getAttribute=="function"?(e=e.getAttribute("class")||"",a=!0):e!=null&&e.isDomClassList?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof Map?e=Array.from(e.keys()).filter(d=>e.get(d)):e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=N.getTruthyKeys(e))),a&&(e=[...new Set(O.split(e))]),l=e.length;l-- >0;)o=e[l],o.length?o.includes(" ")&&e.splice(l,1,...O.split(o)):e.splice(l,1);if(i)c=e;else if(s)c=e.join(" ");else for(c=Object.create(null),l=0;l<e.length;++l)c[e[l]]=!0;return c}constructor(...e){this.process(1,e)}clear(){for(const e in this)this[e]=!1;return this}set(...e){return this.clear().process(1,e)}get isDomClassList(){return!0}clone(){return new J(this)}contains(e){return typeof e=="string"&&e?!!this[e]:!1}toString(){return this.length?`${this.value} `:""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){const r=J.normalize(e,"array"),t=r.length;if(this.length===t){for(let i=0;i<t;i++)if(!this[r[i]])return!1;return!0}return!1}get value(){let e=this[Sn],r;return e==null&&(r=N.getTruthyKeys(this),this[$S]=r.length,this[Sn]=e=r.join(" ")),e}set value(e){const r=this,t=Object.keys(r),i=t.length;for(let n=0;n<i;n++)delete r[t[n]];e?r.process(1,[e]):delete r[Sn]}get values(){return N.getTruthyKeys(this)}get length(){return this.value?this[$S]:0}process(e,r){for(let t,i,n=0;n<r.length;n++)if(r[n])if(t=r[n],t.isDomClassList||N.isObject(t))for(i in t)this[i]=e?t[i]:!t[i];else for(t=J.normalize(r[n],"array"),i=0;i<t.length;++i)this[t[i]]=e;return delete this[Sn],this}assign(e){for(const r in e)!this[r]!=!e[r]&&(this[r]=e[r],delete this[Sn]);return this}assignTo(e){const r=e.nodeType===Element.ELEMENT_NODE?e.classList:e,t=J.from(r);t.add(this),r.value=t.value}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}toggle(e,r=!this[e]){if(r=!!r,!!this[e]!==r)return this[e]=r,delete this[Sn],!0}split(){return N.getTruthyKeys(this)}forEach(e){return N.getTruthyKeys(this).forEach(e)}};J.prototype[Sn]=null,J._$name="DomClassList";var Sr=class extends k{static from(e){const r=e.changedTouches;return new Sr(r?r[0].screenX:e.screenX,r?r[0].screenY:e.pageY)}constructor(e,r){super(e,r,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}};Object.getPrototypeOf(Sr).Point=Sr,Sr._$name="Point";var MI=["clientX","clientY","pageX","pageY","screenX","screenY"],II={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1,block:1},Mi=!0,jS={configurable:Mi,value:!0},PI={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},AI={Control:"ctrl",Alt:"alt",Shift:"shift"},_I=/^(ctrl|shift|alt|meta)$/,kI=["altKey","bubbles","button","buttons","cancelBubble","cancelable","clientX","clientY","ctrlKey","layerX","layerY","metaKey","pageX","pageY","returnValue","screenX","screenY","shiftKey"],BS=class{static normalizeEvent(e){return T.copyPropertiesIf(e,e.changedTouches[0]||e.touches[0],MI)}static copyEvent(e,r){return T.copyProperties(e,r,kI)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,r){const t=rt.getXY(e),i=rt.getXY(r);return Math.sqrt(Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2))}static getPagePoint(e){return new k.Point(e.pageX,e.pageY)}static getClientPoint(e){return new k.Point(e.clientX,e.clientY)}static addListener(e,r,t,i){return e.nodeType?typeof r=="string"?i=Object.assign({element:e,[r]:t},i):i=Object.assign({element:e},r):i=e,rt.on(i)}static on(e){const r=e.element,t=e.thisObj,i=[];for(const s in e)if(!II[s]){let a=e[s];typeof a!="object"&&(a={handler:a});const o=a.element||r;i.push(rt.addElementListener(o,s,a,e))}const n=()=>{for(let s,a=0;a<i.length;a++)s=i[a],rt.removeEventListener(s[0],s[1],s[2]);i.length=0};return t&&e.autoDetach!==!1&&(t.doDestroy=Te.createInterceptor(t.doDestroy,n,t)),n}static addElementListener(e,r,t,i){const n=rt.createHandler(e,r,t,i),{spec:s}=n,a=t.expires||i.expires,o=s.capture!=null||s.passive!=null?{capture:s.capture,passive:s.passive}:void 0;if(e.addEventListener(r,n,o),a){const l=t.thisObj||i.thisObj,c=l!=null&&l.isDelayable?l:globalThis,{alt:d}=a,u=d?a.delay:a,{spec:h}=n;h.expires=a,h.timerId=c[typeof u=="number"?"setTimeout":"requestAnimationFrame"](()=>{h.timerId=null,rt.removeEventListener(e,r,n),d&&!n.called&&(typeof d=="string"?l[d]:d).call(l)},u,`listener-timer-${performance.now()}`)}return[e,r,n,o]}static getComposedPathTarget(e){return e.composedPath()[0]||e.path[0]}static fixEvent(e){var r,t,i;if(e.fixed)return e;const{type:n,target:s}=e;if((s!=null&&s.shadowRoot||(t=(r=s==null?void 0:s.getRootNode)==null?void 0:r.call(s))!=null&&t.host)&&e.composedPath){const a=this.getComposedPathTarget(e),o=s;Object.defineProperty(e,"target",{value:a,configurable:Mi}),Object.defineProperty(e,"originalTarget",{value:o,configurable:Mi})}if(Object.defineProperty(e,"fixed",jS),n.startsWith("key")){const a=PI[e.key];a&&Object.defineProperty(e,"key",{value:a,configurable:Mi}),e.key===" "&&!e.code&&Object.defineProperty(e,"code",{value:"Space",configurable:Mi})}if(e.metaKey&&!e.ctrlKey&&Object.defineProperty(e,"ctrlKey",jS),s&&"offsetX"in e&&(Object.getOwnPropertyDescriptor(e,"borderOffsetX")||Object.defineProperty(e,"borderOffsetX",{get:()=>e.offsetX+(q.isSafari?0:parseInt(s.ownerDocument.defaultView.getComputedStyle(s).getPropertyValue("border-left-width")))}),Object.getOwnPropertyDescriptor(e,"borderOffsetY")||Object.defineProperty(e,"borderOffsetY",{get:()=>e.offsetY+(q.isSafari?0:parseInt(s.ownerDocument.defaultView.getComputedStyle(s).getPropertyValue("border-top-width")))})),(s==null?void 0:s.nodeType)===Element.DOCUMENT_NODE&&"clientX"in e){const a=w.elementFromPoint(e.clientX,e.clientY);Object.defineProperty(e,"target",{value:a,configurable:Mi})}if((s==null?void 0:s.nodeType)===Element.TEXT_NODE){const a=e.target.parentElement;Object.defineProperty(e,"target",{value:a,configurable:Mi})}if(((i=e.relatedTarget)==null?void 0:i.nodeType)===Element.TEXT_NODE){const a=e.target.parentElement;Object.defineProperty(e,"relatedTarget",{value:a,configurable:Mi})}return n.startsWith("touch")&&e.touches.length&&this.normalizeEvent(e),e}static createHandler(e,r,t,i){const n=t.delay||i.delay,s=t.throttled||i.throttled,a=t.block||i.block,o="once"in t?t.once:i.once,l="capture"in t?t.capture:i.capture,c="passive"in t?t.passive:i.passive,d="delegate"in t?t.delegate:i.delegate,u=t.handler,h=t.expires,g=t.thisObj||i.thisObj,{rtlSource:f=g}=g||{};let m=(p,...v)=>{rt.playingDemo&&p.isTrusted||g!=null&&g.isDestroyed||(p=rt.fixEvent(p,f==null?void 0:f.rtl),m.called=!0,(typeof u=="string"?g[u]:u).call(g,p,...v),delete p.target,delete p.relatedTarget,delete p.originalarget,delete p.key,delete p.code,delete p.ctrlKey,delete p.fixed)};if(a){const p=m;let v,y;m=(C,...D)=>{const S=performance.now();(!v||C.target!==y||S-v>a)&&(y=C.target,v=S,p(C,...D))}}if(n!=null){const p=m,v=g!=null&&g.setTimeout?g:globalThis;m=(...y)=>{v.setTimeout(()=>{p(...y)},n)}}if(s!=null){let p,v=s;s.buffer&&(p=y=>s.alt.call(rt,rt.fixEvent(y,f==null?void 0:f.rtl)),v=s.buffer),g!=null&&g.isDelayable?m=g.throttle(m,{delay:v,throttled:p}):m=Te.createThrottled(m,v,g,null,p)}if(o){const p=m;m=(...v)=>{rt.removeEventListener(e,r,m),p(...v)}}if(d){const p=m;m=(v,...y)=>{var C;v=rt.fixEvent(v,f==null?void 0:f.rtl);const D=((C=v.target.closest)==null?void 0:C.call)&&v.target.closest(d);D&&(Object.defineProperty(v,"currentTarget",{get:()=>D,configurable:!0}),p(v,...y))}}return t.thisObj&&t.autoDetach!==!1&&(g.doDestroy=Te.createInterceptor(g.doDestroy,()=>rt.removeEventListener(e,r,m),g)),m.spec={delay:n,throttled:s,block:a,once:o,thisObj:g,capture:l,expires:h,passive:c,delegate:d},m}static removeEventListener(e,r,t){const{expires:i,timerId:n,thisObj:s,capture:a}=t.spec;i!=null&&i.alt&&n&&(s!=null&&s.isDelayable?s:globalThis)[typeof i.delay=="number"?"clearTimeout":"cancelAnimationFrame"](n),e.removeEventListener(r,t,a)}static onTransitionEnd({element:e,animationName:r,property:t,handler:i,mode:n=r?"animation":"transition",duration:s=w[`get${n==="transition"?"Property":""}${O.capitalize(n)}Duration`](e,t),thisObj:a=globalThis,args:o=[],timerSource:l,runOnDestroy:c}){let d;l=l||(a.isDelayable?a:globalThis);const u=[e,t,...o],h=()=>{g(),a.isDestroyed||(a.callback?a.callback(i,a,u):i.apply(a,u))},g=rt.on({element:e,[`${n}end`]({animationName:f,propertyName:m,target:p}){var v;p===e&&(m===t||f!=null&&f.match(r))&&(d&&((v=l.clearTimeout)==null||v.call(l,d),d=null),h())}});return s!=null&&(d=l.setTimeout(h,s+50,"onTransitionEnd",c)),g}static async waitForTransitionEnd(e){return new Promise(r=>{e.handler=r,BS.onTransitionEnd(e)})}static createDblClickWrapper(e,r,t){let i,n,s;return()=>{n||(n=rt.on({element:e,touchstart:a=>{i=a.changedTouches[0].identifier,a.preventDefault()},touchend:a=>{if(a.changedTouches[0].identifier===i){a.preventDefault(),clearTimeout(s),i=n=null;const o=k.from(a.changedTouches[0].target,null,!0),l=a.changedTouches[0].pageX-o.x,c=a.changedTouches[0].pageY-o.y,d=Object.assign({browserEvent:a},a),u=new MouseEvent("dblclick",d);Object.defineProperties(u,{target:{value:a.target},offsetX:{value:l},offsetY:{value:c}}),typeof r=="string"&&(r=t[r]),r.call(t,u)}},once:!0}),s=setTimeout(()=>{n(),i=n=null},rt.dblClickTime))}}static toSpecialKey(e,r=q.isMac?"metaKey":"ctrlKey"){let t=!1;return e===!0?t=r:typeof e=="string"&&(e=e.toLowerCase(),e.match(_I)&&(t=`${e}Key`)),t}static specialKeyFromEventKey(e){return AI[e]||"no-special-key"}},B=BS;E(B,"eventNameMap",{mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseenter:"MouseEnter",mouseleave:"MouseLeave",mousemove:"MouseMove",mouseover:"MouseOver",mouseout:"MouseOut",keyup:"KeyUp",keydown:"KeyDown",keypress:"KeyPress"});var rt=B;rt.longPressTime=700,rt.dblClickTime=300,q.isTouchDevice&&rt.on({element:document,touchmove:e=>{e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0}),B._$name="EventHelper";var FI=14,OI={align:"t0-t0"},Jo=Node.ELEMENT_NODE,Id=Node.TEXT_NODE,{isObject:LI}=T,HS=/[+-]?\d*\.?\d+[eE]?-?\d*/g,kr=HS.source,$I=new RegExp(`matrix\\((?:${kr}),\\s?(?:${kr}),\\s?(?:${kr}),\\s?(?:${kr}),\\s?(${kr}),\\s?(${kr})`),jI=new RegExp("matrix3d\\((?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(-?\\d*),\\s?(-?\\d*)"),Pd=new RegExp(`(?:${$I.source})|(?:${jI.source})`),BI=new RegExp(`translate(3d|X)?\\((${kr})px(?:,\\s?(${kr})px)?`),HI=new RegExp(`translate(3d|Y)?\\((${kr})px(?:,\\s?(${kr})px)?`),VI=/\s+/,NI=/\s*;\s*/,zI=/\s*:\s*/,WI=/^-?((\d+(\.\d*)?)|(\.?\d+))$/,GI="$bryntum",UI={elementData:"",for:"htmlFor",retainElement:""},YI={tag:1,html:1,text:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,class:1,className:1,unmatched:1,onlyChildren:1,listeners:1,compareHtml:1,syncOptions:1,keepChildren:1},VS={length:1,parentRule:1,style:1},qI={INPUT:1,TEXTAREA:1},KI={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,BODY:1},Ad=globalThis,ct=document,XI=Object.freeze({}),Hf=Array.prototype.slice,ZI=Promise.resolve(),JI=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],QI=e=>e._hidden,eP=e=>e.parentNode||e.host,tP=(e,r,t)=>t.key==="children"?T.mergeItems(e,r,t):T.blend(e,r,t),Vf=e=>{const r=e.ownerDocument.defaultView.getComputedStyle(e);return r.getPropertyValue("display")!=="none"&&r.getPropertyValue("visibility")!=="hidden"},Ii=e=>e&&(e===ct.body||!!e.offsetParent||(e.ownerDocument.defaultView&&"offsetParent"in e&&w.getStyleValue(e,"position")!=="fixed"?e.offsetParent:Ii(e.parentNode))),NS=e=>e instanceof Node?e:typeof e=="string"?W.createElementFromTemplate(e):W.createElement(e),Qo=Object.create(null),zS=(e,r)=>{const t=Qo[e]||[O.hyphenate(e),r];return Qo[e]||(Qo[t[0]]=Qo[e]=t),t},rP=e=>e.ownerSVGElement?e.ownerSVGElement.parentNode:e.offsetParent,iP=/b-slide-in-from-\w+/;["top","right","bottom","left","width","height","maxWidth","maxHeight","minWidth","minHeight","borderSpacing","borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","letterSpacing","lineHeight","outlineWidth","textIndent","wordSpacing"].forEach(e=>zS(e,!0));var el=null,nP=0,Dn=null,Nf,WS,GS,w=class{static async slideIn(e,r=1){const t=`b-slide-in-${r>0?"next":"previous"}`,{classList:i}=e,{style:n}=e.parentNode,{overflow:s,overflowX:a,overflowY:o}=n;n.overflow="hidden",i.add(t),await B.waitForTransitionEnd({element:e,animationName:iP}),n.overflow=s,n.overflowX=a,n.overflowY=o,i.remove(t)}static isFocusable(e,r=!1){if(!r&&(!W.isVisible(e)||W.Widget.fromElement(e,QI)))return!1;const t=e.nodeName;return KI[t]||(t==="A"||t==="LINK")&&!!e.href||e.getAttribute("tabIndex")!=null||e.contentEditable==="true"}static isEditable(e){return e.isContentEditable||qI[e.nodeName]}static isInView(e,r=!1,t){if(!Ii(e))return!1;const i=(t==null?void 0:t.positioned)&&w.getStyleValue(t.element,"position")!=="fixed",n=k.from(globalThis),s=r?"contains":"intersect",a=i&&t.element.offsetParent,o=i&&k.from(a);if(n.height=ct.scrollingElement.scrollHeight,e===ct.body)return n;const l=this.getViewportIntersection(e,n,s);return l&&i&&l.translate(ct.scrollingElement.scrollLeft,ct.scrollingElement.scrollTop),i&&l?l.translate(-o.x+a.scrollLeft,-o.y+a.scrollTop):l}static getViewportIntersection(e,r,t){const{parentNode:i}=e,{parentElement:n}=i.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.getRootNode().host:e,s=n.ownerDocument.defaultView.getComputedStyle(n),a=s.overflowX!=="visible"||s.overflowY!=="visible",o=rP(e);let l=k.from(e,null,!0);for(let c=a?e.parentNode:o;l&&c!==ct.documentElement;c=c.parentNode){c.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&c.host&&(c=c.host.parentNode);const d=c===ct.body,u=c.ownerDocument.defaultView.getComputedStyle(c),h=d?r:k.inner(c,null,!0);(d||u.overflow!=="visible")&&(l=h[t](l,!1,!0))}return l}static isVisible(e){const r=e.ownerDocument;for(;e;e=eP(e)){if(e===r)return!0;if(e.nodeType===e.ELEMENT_NODE&&!Vf(e))return!1}return!1}static isDOMEvent(e){return e instanceof Event}static merge(e,...r){return T.blend(e,r,{merge:tP})}static normalizeChildren(e,r,t){var i;let n=e==null?void 0:e.children,s,a,o,l,c;if((i=e==null?void 0:e.syncOptions)!=null&&i.ignoreRefs&&(t=!0),n&&!(e instanceof Node))if(Array.isArray(n))for(a=0;a<n.length;++a)W.normalizeChildren(n[a],r,t);else{l=n,e.children=n=[];for(o in l)s=l[o],s!=null&&s.isWidget&&(s=s.element),c=!o.startsWith("$")&&!W.isElement(s),c&&(r==null||r(o,!t)),s&&(s instanceof Node||(s.reference===!1?delete s.reference:c&&typeof s!="string"&&(s.reference=o),W.normalizeChildren(s,r,t)),n.push(s))}return e}static roundPx(e,r=globalThis.devicePixelRatio||1){const t=1/r;return Math.round(e/t)*t}static floorPx(e,r=globalThis.devicePixelRatio||1){const t=1/r;return Math.floor(e*t)/t}static isCustomElement(e){return!!(e!=null&&e.shadowRoot)}static elementFromPoint(e,r){let t=document.elementFromPoint(e,r);return W.isCustomElement(t)&&(t=t.shadowRoot.elementFromPoint(e,r)||t),t}static childFromPoint(e,r,t,i=e){const n=t==null?r:new k(r,t,0,0);let s=null;return Array.from(e.children).reverse().some(a=>{if(k.from(a,i).contains(n))return s=a.children.length&&W.childFromPoint(a,n,null,i)||a,!0}),s}static unitize(e,r,t="px"){const[i,n]=zS(e);return r!=null&&(r=String(r),r=n&&WI.test(r)?r+t:r),[i,r]}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getActiveElement(e){e!=null&&e.isWidget&&(e=e.element);let r=((e==null?void 0:e.getRootNode())||document).activeElement;for(;r!=null&&r.shadowRoot;)r=r.shadowRoot.activeElement;return r}static getRootElement(e){var r;const t=(r=e.getRootNode)==null?void 0:r.call(e),{nodeType:i}=t;return i===Node.DOCUMENT_NODE?t.body:i===Node.DOCUMENT_FRAGMENT_NODE?t:e.ownerDocument.contains(e)?e.ownerDocument.body:null}static getOutermostElement(e){var r;const t=(r=e.getRootNode)==null?void 0:r.call(e);if(t!=null&&t.body)return t==null?void 0:t.body;for(;e.parentNode!==t&&e.parentNode;)e=e.parentNode;return e}static isValidFloatRootParent(e){return e===document.body||e.constructor.name==="ShadowRoot"}static getId(e){return e.id||(e.id="b-element-"+ ++nP)}static getCommonAncestor(e,r){var t;if(e===r)return e;for(;e&&!((t=e[e.isWidget?"owns":"contains"])!=null&&t.call(e,r)||e===r);)e=e.owner||e.parentNode;return e}static getElement(e){return e instanceof Element?e:ct.querySelector(e)}static setAttributes(e,r){const t=W.getElement(e);if(t&&r)for(const i in r)r[i]==null?t.removeAttribute(i):t.setAttribute(i,r[i])}static setLength(e,r,t){return arguments.length===1?t=typeof e=="number"?`${e}px`:e!=null?e:"":(e=W.getElement(e),t=e.style[r]=typeof t=="number"?`${t}px`:t!=null?t:""),t}static percentify(e,r=2){const t=Math.pow(10,r);return e==null||e===""||isNaN(e)?"":`${Math.round(e*t)/t}%`}static getChild(e,r){return e.querySelector(":scope>"+r)}static hasChild(e,r){return W.getChild(e,r)!=null}static children(e,r){return(r[0]===">"||r.startsWith("# "))&&(r[0]==="#"&&(r=r.substr(2)),r=":scope "+r),Array.from(e.querySelectorAll(r))}static getChildElementCount(e){return e.childElementCount}static down(e,r){return e?e.matches&&e.matches(r)?e:(r=":scope "+r,e.querySelector(r)):null}static isDescendant(e,r){const t=W.getRootElement(e),i=W.getRootElement(r);return i&&t!==i&&i.host?W.isDescendant(t,i.host):e.contains(r)}static getEventElement(e,r="target"){return!e||W.isElement(e)?e:e[r]}static isElement(e){return(e==null?void 0:e.nodeType)===document.ELEMENT_NODE&&W.isNode(e)}static isReactElement(e){return(e==null?void 0:e.$$typeof)===Symbol.for("react.element")}static isNode(e){return!!e&&typeof e.nodeType=="number"&&!LI(e)}static forEachSelector(e,r,t){if(typeof e=="string")throw new Error("DomHelper.forEachSelector must provide a root element context (for shadow root scenario)");W.children(e,r).forEach(t)}static forEachChild(e,r){Array.from(e.children).forEach(r)}static removeEachSelector(e,r){W.forEachSelector(e,r,t=>t.remove())}static removeClsGlobally(e,...r){r.forEach(t=>W.forEachSelector(e,"."+t,i=>i.classList.remove(t)))}static up(e,r){return ne.deprecate("Core","6.0.0","DomHelper.up() deprecated, use native `element.closest()` instead"),e.closest(r)}static getAncestor(e,r,t=null){let i=!1,n,s=e;for(r=H.asArray(r);s=s.parentElement;){if(r.includes(s)){i=!0;break}if(t&&s===t)break;n=s}return i?n||e:null}static getParents(e){const r=[];for(;e.parentElement;)r.push(e.parentElement),e=e.parentElement;return r}static makeValidId(e,r=""){return O.makeValidDomId(e,r)}static createElement(e={},r){var t,i;let n=r,s,a,o,l,c,d,u,h,g,f,m;if(typeof n=="boolean")throw new Error("Clean up");r&&(c=r.ignoreRefs,g=r.refOwner,f=r.refs,n=r.returnAll,m=r.syncIdField,c&&(o=!0,c=c!=="children")),typeof e.parent=="string"&&(e.parent=document.getElementById(e.parent));const p=e.parent||e.nextSibling&&e.nextSibling.parentNode,{dataset:v,html:y,reference:C,syncOptions:D,text:S}=e;if(D&&(m=D.syncIdField||m,l=D.ignoreRefs,l&&(o=!0,c=l!=="children",r={...r,ignoreRefs:!0})),c&&(g=null),e.ns?s=ct.createElementNS(e.ns,e.tag||"svg"):s=ct.createElement(e.tag||"div"),S!=null?W.setInnerText(s,S):y!=null&&(y instanceof DocumentFragment?s.appendChild(y):s.innerHTML=y),e.tooltip&&W.Widget.attachTooltip(s,e.tooltip),e.style&&W.applyStyle(s,e.style),v)for(u in v)h=v[u],h!=null&&(s.dataset[u]=h);p&&this.addChild(p,s,e.nextSibling),g&&(s.$refOwnerId=g.id),C&&!c&&(g?(s.$reference=C,g.attachRef(C,s,e)):(f||(r=Object.assign({},r),r.refs=f={}),f[C]=s,s.setAttribute("data-reference",C)));const x=e.className||e.class,R=Object.keys(e);for(x&&s.setAttribute("class",J.normalize(x)),a=0;a<R.length;++a)u=R[a],h=e[u],(d=UI[u])!=null?s[d||u]=h:!YI[u]&&u&&h!=null&&s.setAttribute(u,h);return!e["aria-hidden"]&&!e.role&&!e.tabIndex&&!w.isFocusable(s,!0)&&!s.htmlFor&&s.setAttribute("role","presentation"),(i=r==null?void 0:r.callback)==null||i.call(r,{action:"newElement",domConfig:e,targetElement:s,syncId:g?C:r.syncIdField&&((t=e.dataset)==null?void 0:t[r.syncIdField])}),n===!0?r.returnAll=n=[s]:Array.isArray(n)&&n.push(s),e.children&&(m&&(s.syncIdMap={}),e.children.forEach(I=>{var M,P,_;if(I)if(typeof I=="string"){const A=document.createTextNode(I);g&&(A.$refOwnerId=g.id),s.appendChild(A)}else if(isNaN(I.nodeType)){I.parent=s,!I.ns&&e.ns&&(I.ns=e.ns);const A=W.createElement(I,{...r,ignoreRefs:(P=(M=e.syncOptions)==null?void 0:M.ignoreRef)!=null?P:o}),z=(_=I.dataset)==null?void 0:_[m];z!=null&&(s.syncIdMap[z]=A),delete I.parent}else s.appendChild(I)})),s.lastDomConfig=e,f||n||s}static createElementFromTemplate(e,r=XI){const{array:t,raw:i,fragment:n}=r;let s;if(W.supportsTemplate){if((Nf||(Nf=ct.createElement("template"))).innerHTML=e,s=Nf.content,n)return s.cloneNode(!0)}else if(s=(WS||(WS=new DOMParser)).parseFromString(e,"text/html").body,n){const a=s.childNodes;for(s=document.createDocumentFragment();a.length;)s.appendChild(a[0]);return s}return i?s=s.childNodes:s=s.children,s.length===1&&!t?s[0]:Hf.call(s)}static triggerMouseEvent(e,r="contextmenu"){const t=this.isInView(e),i=t||k.from(e),n=i.center,s=new MouseEvent(r,{clientX:n.x,clientY:n.y,bubbles:!0});e.dispatchEvent(s)}static insertFirst(e,r){return r&&r.nodeType!==Jo&&r.tag&&(r=W.createElement(r)),e.insertBefore(r,e.firstElementChild)}static insertBefore(e,r,t){return r&&r.nodeType!==Jo&&r.tag&&(r=W.createElement(r)),t?e.insertBefore(r,t):W.insertFirst(e,r)}static insertAt(e,r,t){const i=Array.from(e.children);if(t>=i.length)return W.append(e,r);const n=i[t];return W.insertBefore(e,r,n)}static append(e,r){if(r.forEach){if(Array.isArray(r)&&(r=r.map(t=>NS(t))),e.append)e.append(...r);else{const t=document.createDocumentFragment();r.forEach(function(i){t.appendChild(i)}),e.appendChild(t)}return r}else return e.appendChild(NS(r))}static getTranslateX(e){const r=e.style.transform;let t=BI.exec(r);return t?parseFloat(t[2]):(t=Pd.exec(r)||Pd.exec(W.getStyleValue(e,"transform")),t?parseFloat(t[1]||t[3]):0)}static getTranslateY(e){const r=e.style.transform;let t=HI.exec(r);if(t){const i=parseFloat(t[t[1]==="Y"?2:3]);return isNaN(i)?0:i}else return t=Pd.exec(r)||Pd.exec(W.getStyleValue(e,"transform")),t?parseFloat(t[2]||t[4]):0}static getTranslateXY(e){return[W.getTranslateX(e),W.getTranslateY(e)]}static getOffsetX(e,r=null){return r?e.getBoundingClientRect().left-r.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,r=null){return r?e.getBoundingClientRect().top-r.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,r=null){return[W.getOffsetX(e,r),W.getOffsetY(e,r)]}static focusWithoutScrolling(e){function r(i){i.forEach(({element:n,scrollLeft:s,scrollTop:a})=>{n.scrollLeft!==s&&(n.scrollLeft=s),n.scrollTop!==a&&(n.scrollTop=a)})}if(!q.isSafari)e.focus({preventScroll:!0});else{const i=W.getParents(e),n=i.map(s=>({element:s,scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}));e.focus(),setTimeout(()=>r(n),0)}}static getPageX(e){return e.getBoundingClientRect().left+Ad.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+Ad.pageYOffset}static getExtremalSizePX(e,r){const t=O.hyphenate(r),i=t.split("-")[1];let n=W.getStyleValue(e,t);return/%/.test(n)?e.parentElement?n=parseInt(W.getStyleValue(e.parentElement,i),10):n=NaN:n=parseInt(n,10),n}static setScale(e,r,t=r){const i=W.getStyleValue(e,"transform").split(/,\s*/);i.length>1?(i[0].startsWith("matrix3d")?(i[0]=`matrix3d(${r}`,i[5]=t):(i[0]=`matrix(${r}`,i[3]=t),e.style.transform=i.join(",")):e.style.transform=`scale(${r}, ${t})`}static setTranslateX(e,r){const t=W.getStyleValue(e,"transform").split(/,\s*/);r=W.roundPx(r),t.length>1?(t[t[0].startsWith("matrix3d")?12:4]=r,e.style.transform=t.join(",")):e.style.transform=`translateX(${r}px)`}static setTranslateY(e,r){const t=W.getStyleValue(e,"transform").split(/,\s*/);r=W.roundPx(r),t.length>1?(t[t[0].startsWith("matrix3d")?13:5]=r,e.style.transform=t.join(",")+")"):e.style.transform=`translateY(${r}px)`}static setTop(e,r){W.setLength(e,"top",r)}static setLeft(e,r){W.setLength(e,"left",r)}static setTopLeft(e,r,t){W.setLength(e,"top",r),W.setLength(e,"left",t)}static setRect(e,{x:r,y:t,width:i,height:n}){W.setTopLeft(e,t,r),W.setLength(e,"width",i),W.setLength(e,"height",n)}static setTranslateXY(e,r,t){if(r==null)return W.setTranslateY(e,t);if(t==null)return W.setTranslateX(e,r);r=W.roundPx(r),t=W.roundPx(t);const i=W.getStyleValue(e,"transform").split(/,\s*/),n=i[0].startsWith("matrix3d");i.length>1?(i[n?12:4]=r,i[n?13:5]=t,e.style.transform=i.join(",")+")"):e.style.transform=`translate(${r}px, ${t}px)`}static addTranslateX(e,r){W.setTranslateX(e,W.getTranslateX(e)+r)}static addTranslateY(e,r){W.setTranslateY(e,W.getTranslateY(e)+r)}static addLeft(e,r){W.setLeft(e,W.getOffsetX(e)+r)}static addTop(e,r){W.setTop(e,W.getOffsetY(e)+r)}static alignTo(e,r,t=OI,i){r=r instanceof k?r:k.from(r,!0);const n=W.getTranslateXY(e),s=k.from(e,!0);i&&(s.roundPx(),r.roundPx());const a=s.alignTo(Object.assign(t,{target:r}));W.setTranslateXY(e,n[0]+a.x-s.x,n[1]+a.y-s.y)}static getStyleValue(e,r,t,i){const n=t?e.style:e.ownerDocument.defaultView.getComputedStyle(e,i);if(Array.isArray(r)){const s={};for(const a of r)s[a]=n.getPropertyValue(O.hyphenate(a));return s}return n.getPropertyValue(O.hyphenate(r))}static getEdgeSize(e,r,t){const i=r==="border"?"-width":"",n={raw:{}};for(const s of["top","right","bottom","left"])(!t||t.includes(s[0]))&&(n[s]=parseFloat(n.raw[s]=W.getStyleValue(e,`${r}-${s}${i}`)));return n.width=(n.left||0)+(n.right||0),n.height=(n.top||0)+(n.bottom||0),n}static parseStyle(e){if(typeof e=="string"){const r=e.split(NI);e={};for(let t=0,{length:i}=r;t<i;t++){const n=r[t].split(zI);e[n[0]]=n[1]}}return e||{}}static applyStyle(e,r,t=!1){if(typeof r=="string")t?(r.length||e.style.cssText.length)&&(e.style.cssText=r):e.style.cssText+=r;else if(r){t&&(e.style.cssText=""),r.style&&typeof r.style!="string"&&(r=T.assign({},r,r.style));let i,n;for(i in r)VS[i]||([i,n]=W.unitize(i,r[i]),n==null?e.style.removeProperty(i):e.style.setProperty(i,n));typeof r.style=="string"&&(e.style.cssText+=r.style)}}static getCSSText(e){if(typeof e=="string")return e;let r="";for(const t in e)VS[t]||(r+=`${O.hyphenate(t)}:${e[t]};`);return r}static addClasses(e,r){ne.deprecate("Core","6.0.0","DomHelper.addClasses should be replaced by native classList.add"),e.classList.add(...r)}static removeClasses(e,r){ne.deprecate("Core","6.0.0","DomHelper.removeClasses should be replaced by native classList.remove"),e.classList.remove(...r)}static toggleClasses(e,r,t=null){r=H.asArray(r),t===!0?e.classList.add(...r):t===!1?e.classList.remove(...r):r.forEach(i=>e.classList.toggle(i))}static addTemporaryClass(e,r,t,i=globalThis){t>0&&(e.classList.add(r),i.setTimeout({fn:n=>e.classList.remove(n),delay:t,name:r,args:[r],cancelOutstanding:!0}))}static getPropertyTransitionDuration(e,r){const t=globalThis.getComputedStyle(e),i=t.transitionProperty.split(", "),n=t.transitionDuration.split(", "),s=i.indexOf(O.hyphenate(r));let a;return s!==-1&&(a=parseFloat(n[s])*1e3),a}static getAnimationDuration(e){return parseFloat(W.getStyleValue(e,"animation-duration"))*1e3}static highlight(e,r=globalThis){return e instanceof k?e.highlight():new Promise(t=>{r.setTimeout(()=>{e.classList.add("b-fx-highlight"),r.setTimeout(()=>{e.classList.remove("b-fx-highlight"),t()},1e3)},0)})}static get scrollBarWidth(){if(el===null){const e=GS||(GS=W.createElement({parent:ct.documentElement,style:"position:absolute;top:-9999em;height:100px;overflow-y:scroll"}));e.parentNode!==ct.documentElement&&ct.documentElement.appendChild(e),el=e.offsetWidth}return el}static get scrollBarPadElement(){return{className:"b-yscroll-pad",children:[{className:"b-yscroll-pad-sizer"}]}}static resetScrollBarWidth(){el=null}static measureText(e,r,t=!1,i=void 0){const n=W.getMeasureElement(r,i);n[t?"innerHTML":"innerText"]=e;const s=n.clientWidth;return n.className="",s}static measureSize(e,r,t=!0){if(!e)return 0;if(typeof e=="number")return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(r){const i=W.getMeasureElement(r);i.innerHTML="",i.style.width=W.setLength(e);const n=t?i.offsetWidth:i.getBoundingClientRect().width;return i.style.width=i.className="",n}return/^\d+em$/.test(e)?parseInt(e)*FI:isNaN(e)?0:parseInt(e)}static getMeasureElement(e,r=ct.body){const t=Ad.getComputedStyle(e),i=r.offScreenDiv=r.offScreenDiv||W.createElement({parent:r,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},{returnAll:!0})[1];return JI.forEach(n=>{i.style[n]!==t[n]&&(i.style[n]=t[n])}),i.className=e.className,i.parentElement.parentElement!==r&&r.appendChild(i.parentElement),i}static stripTags(e){return(W.$domParser||(W.$domParser=new DOMParser)).parseFromString(e,"text/html").body.textContent}static sync(e,r){if(typeof e=="string")if(e===""){r.innerHTML="";return}else e=W.createElementFromTemplate(e);return W.performSync(e,r),r}static performSync(e,r){return e.outerHTML!==r.outerHTML?(W.syncAttributes(e,r),W.syncContent(e,r),W.syncChildren(e,r),!0):!1}static getSyncAttributes(e){const r={},t=[];for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i];if(n.specified){const s=n.name.toLowerCase();r[s]=n.value,t.push(s)}}return{attributes:r,names:t}}static syncAttributes(e,r){const{attributes:t,names:i}=W.getSyncAttributes(e),{attributes:n,names:s}=W.getSyncAttributes(r),a=i.includes("dataset"),o=i.filter(d=>!s.includes(d)),l=s.filter(d=>!i.includes(d)&&(!a||!d.startsWith("data-"))),c=i.filter(d=>s.includes(d));if(o.length>0)for(let d=0;d<o.length;d++){const u=o[d];u==="style"?W.applyStyle(r,t.style,!0):u==="dataset"?Object.assign(r.dataset,t.dataset):r.setAttribute(u,t[u])}if(l.length>0)for(let d=0;d<l.length;d++)r.removeAttribute(l[d]);if(c.length>0)for(let d=0;d<c.length;d++){const u=c[d];if(u==="style")W.applyStyle(r,t.style,!0);else if(u==="dataset")Object.assign(r.dataset,t.dataset);else if(u==="class"&&(t.class.isDomClassList||typeof t.class=="object")){let h;t.class.isDomClassList?h=t.class:h=new J(t.class),h.isEqual(n.class)||r.setAttribute("class",h)}else n[u]!==t[u]&&r.setAttribute(u,t[u])}}static syncContent(e,r){W.getChildElementCount(e)===0&&(r.innerText=e.innerText)}static setInnerText(e,r){const{firstChild:t}=e;(t==null?void 0:t.nodeType)===Element.TEXT_NODE?t.data=r:e.textContent=r}static syncChildren(e,r){const t=this,i=Hf.call(e.childNodes),n=Hf.call(r.childNodes);for(;i.length;){const s=i.shift(),a=n.shift();if(s&&s.nodeType!==Id&&s.nodeType!==Jo)throw new Error(`Source node type ${s.nodeType} not supported by DomHelper.sync()`);if(a&&a.nodeType!==Id&&a.nodeType!==Jo)throw new Error(`Target node type ${a.nodeType} not supported by DomHelper.sync()`);if(!a)r.appendChild(s);else if(s.nodeType===a.nodeType)s.nodeType===Id?a.data=s.data:s.tagName===a.tagName?t.performSync(s,a):(r.insertBefore(s,a),a.remove());else if(s.nodeType===Id&&a.nodeType===Jo)r.innerText=s.data.trim();else{const o=s.parentElement||s;throw new Error(`Currently no support for transforming nodeType.
${o.outerHTML}`)}}n.forEach(s=>{s.remove()})}static syncClassList(e,r){const{classList:t}=e,i=typeof r=="string",n=i?r.split(VI):J.normalize(r,"array"),s=n.length;let a=t.length!==s,o;for(o=0;!a&&o<s;o++)a=!t.contains(n[o]);return a&&(e.className=i?r:n.join(" ")),a}static updateClassList(e,r){const{classList:t}=e;let i,n,s=!1;for(i in r)n=!!r[i],t.contains(i)!==n&&(t[n?"add":"remove"](i),s=!0);return s}static setTheme(e,r){e=e.toLowerCase();const{head:t}=document,i=W.getThemeInfo(r).name.toLowerCase();let n=t.querySelectorAll("[data-bryntum-theme]:not([data-loading])"),s=0;if(i===e)return ZI;W.removeEachSelector(t,"#bryntum-theme[data-loading],link[data-bryntum-theme][data-loading]");const a={theme:e,prev:i};function o(l,c,d){const u=w.createElement({tag:"link",rel:"stylesheet",dataset:{loading:!0,bryntumTheme:!0},href:l.href.replace(i,e),nextSibling:l});u.addEventListener("load",()=>{delete u.dataset.loading,Dn=null,++s===n.length&&(n.forEach(h=>h.remove()),be.trigger("theme",a),c(a))}),u.addEventListener("error",h=>{delete u.dataset.loading,d(h)})}if(n.length)return new Promise((l,c)=>{n.forEach((d,u)=>{o(d,l,c,u===n.length-1)})});{const l=t.querySelector("#bryntum-theme:not([data-loading])")||t.querySelector(`[href*="${i}.css"]:not([data-loading])`);if(!(l!=null&&l.href.includes(`${i}.css`)))throw new Error(`Theme link for ${i} not found`);return n=[l],new Promise((c,d)=>o(l,c,d))}}static get themeInfo(){return w.getThemeInfo()}static getThemeInfo(e){if(!Dn){const r=W.createElement({parent:document.body,className:"b-theme-info"}),t=W.getStyleValue(r,"content",!1,":before");if(t)try{Dn=JSON.parse(t.replace(/^["']|["']$|\\/g,""))}catch(i){Dn=null}Dn=Dn||(e?{name:e}:null),r.remove()}return Dn}static async transition({element:e,selector:r="[data-dom-transition]",duration:t,action:i,thisObj:n=this,addTransition:s={},removeTransition:a={}}){const o=new Set,l=Array.from(e.querySelectorAll(r)),c=new Map(l.map(g=>{let f=0,m=g.parentElement;for(;m&&m!==e;)f++,m=m.parentElement;g.$depth=f,g.scrollHeight>g.offsetHeight&&getComputedStyle(g).overflow==="auto"&&(g.$scrollTop=g.scrollTop,o.add(g));const{parentElement:p}=g,v=k.from(g,e),y=k.from(g,p),C=getComputedStyle(p),D=parseFloat(C.borderLeftWidth);return D&&(v.left-=D,y.left-=D),[g.id,{element:g,globalBounds:v,localBounds:y,depth:f,parentElement:p}]}));i.call(n);const d=Array.from(e.querySelectorAll(r)),u=new Map(d.map(g=>{const f=k.from(g,e),m=k.from(g,g.parentElement),p=globalThis.getComputedStyle(g.parentElement),v=parseFloat(p.borderLeftWidth);return v&&(f.left-=v,m.left-=v),[g.id,{element:g,globalBounds:f,localBounds:m}]})),h=["position","top","left","width","height","padding","margin","zIndex","minWidth","minHeight","opacity","overflow"];for(const[g,f]of c){const m=u.get(g);if(m){const{element:p}=m,{style:v,parentElement:y}=p,C=parseInt(W.getStyleValue(p,"zIndex")),{globalBounds:D,localBounds:S,depth:x,parentElement:R}=f,I=R!==y;T.copyProperties(p.$initial={parentElement:y},v,h);let M;I?(m.bounds=m.globalBounds,M=D,e.appendChild(p)):(m.bounds=m.localBounds,M=S,R.appendChild(p));let P="hidden";o.has(p)&&(p.$scrollPlaceholder=W.createElement({parent:p,style:{height:p.scrollHeight}}),P="auto");const _={position:"absolute",top:`${M.top}px`,left:`${M.left}px`,width:`${M.width}px`,height:`${M.height}px`,minWidth:0,minHeight:0,margin:0,zIndex:x+(C||0),overflow:P};p.dataset.domTransition!=="preserve-padding"&&(_.padding=0),Object.assign(v,_),m.processed=!0}else{const{element:p,localBounds:v,depth:y,parentElement:C}=f;p.$initial={removed:!0},Object.assign(p.style,{position:"absolute",top:`${v.top}px`,left:`${v.left}px`,width:`${v.width}px`,height:`${v.height}px`,minWidth:0,minHeight:0,padding:0,margin:0,zIndex:y,overflow:"hidden"}),C.appendChild(p),u.set(g,{element:p,bounds:v,removed:!0,processed:!0}),d.push(p)}}for(const[,g]of u)if(!g.processed){const{element:f}=g,{style:m,parentElement:p}=f,v=g.bounds=g.localBounds;f.classList.add("b-dom-transition-adding"),T.copyProperties(f.$initial={parentElement:p},m,h),Object.assign(m,{position:"absolute",top:s.top?0:`${v.top}px`,left:s.left?0:`${v.left}px`,width:s.width?0:`${v.width}px`,height:s.height?0:`${v.height}px`,opacity:s.opacity?0:null,zIndex:p.$depth+1,overflow:"hidden"})}for(const g of o)g.scrollTop=g.$scrollTop;e.classList.add("b-dom-transition"),e.firstElementChild.offsetWidth;for(const[,{element:g,bounds:f,removed:m}]of u)m?Object.assign(g.style,{top:a.top?0:`${f.top}px`,left:a.left?0:`${f.left}px`,width:a.width?0:`${f.width}px`,height:a.height?0:`${f.height}px`,opacity:a.opacity?0:g.$initial.opacity}):Object.assign(g.style,{top:`${f.top}px`,left:`${f.left}px`,width:`${f.width}px`,height:`${f.height}px`,opacity:g.$initial.opacity});await bn.sleep(t),e.classList.remove("b-dom-transition");for(const g of d)g.$initial&&(g.$initial.removed?g.remove():(T.copyProperties(g.style,g.$initial,h),g.$scrollPlaceholder&&(g.$scrollPlaceholder.remove(),delete g.$scrollPlaceholder),g.classList.remove("b-dom-transition-adding"),g.$initial.parentElement.appendChild(g)));for(const g of o)g.scrollTop=g.$scrollTop,delete g.$scrollTop}static async loadScript(e){return new Promise((r,t)=>{const i=document.createElement("script");i.src=e,i.onload=r,i.onerror=t,document.head.appendChild(i)})}static isNamedColor(e){return e&&!/^(#|hsl|rgb|hwb)/.test(e)}static get NodeFilter(){return NodeFilter}static addChild(e,r,t){e.insertBefore(r,t)}static cloneStylesIntoShadowRoot(e,r){return new Promise((t,i)=>{r&&e.querySelectorAll('style, link[rel="stylesheet"]').forEach(a=>a.remove());const n=document.querySelectorAll('link[rel="stylesheet"]');let s=0;n.forEach(a=>{const o=a.cloneNode();o.addEventListener("load",()=>{s+=1,s===n.length&&t()}),o.addEventListener("error",l=>{i(o.href)}),e.appendChild(o)}),document.querySelectorAll("style").forEach(a=>{e.appendChild(a.cloneNode())})})}},W=w,US,sP=()=>W.isTouchEvent=!1,YS=()=>{W.isTouchEvent=!0,clearTimeout(US),US=setTimeout(sP,400)};if(ct.addEventListener("touchstart",YS,!0),ct.addEventListener("touchend",YS,!0),W.canonicalStyles=Qo,W.supportsTemplate="content"in ct.createElement("template"),W.elementPropKey=GI,W.numberRe=HS,!("children"in Node.prototype)){const e=r=>r.nodeType===r.ELEMENT_NODE;Object.defineProperty(Node.prototype,"children",{get:function(){return Array.prototype.filter.call(this.childNodes,e)}})}Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){const r=(this.document||this.ownerDocument).querySelectorAll(e);let t=r.length;for(;--t>=0&&r.item(t)!==this;);return t>-1}),Ad.Element&&!Element.prototype.closest?Node.prototype.closest=Element.prototype.closest=function(e){let r=this;if(!ct.documentElement.contains(r))return null;do{if(r.matches(e))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===r.ELEMENT_NODE);return null}:Node.prototype.closest=function(e){var r;return(r=this.parentNode)==null?void 0:r.closest(e)},function(e){e.forEach(function(r){Object.prototype.hasOwnProperty.call(r,"remove")||Object.defineProperty(r,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype]),globalThis.addEventListener("resize",()=>el=null),w._$name="DomHelper";var aP=5,oP=e=>e.floating,lP={touchend:1,pointerup:1},cP={Meta:1,Control:1,Alt:1},Qr=new class extends F.mixin(Le){suspendFocusEvents(){_d=!0}resumeFocusEvents(){_d=!1}setupFocusListenersOnce(r,t){r&&!Qr.observedElements.has(r)&&(Qr.setupFocusListeners(r,t),Qr.observedElements.add(r))}setupFocusListeners(r=document,t,i=!1){const n={element:r,touchstart(s){if(!Dr&&s.changedTouches.length===1){if(Dr=s.changedTouches[0],!q.isAndroid){const a=({clientX:c,clientY:d,type:u})=>{(lP[u]||Math.max(Math.abs(c-Dr.clientX),Math.abs(d-Dr.clientY))>aP)&&(zf=null,o(),clearTimeout(l))},o=t.on({element:document,touchmove:a,touchend:a,pointermove:a,pointerup:a,capture:!0}),l=setTimeout(()=>{zf=Dr.identifier,o(),s.target.dispatchEvent(new MouseEvent("contextmenu",t.copyEvent({},s)))},t.longPressTime)}}else Dr=null},touchend:{handler:s=>{Dr&&(s.changedTouches[0].identifier===zf?(s.stopImmediatePropagation(),s.cancelable!==!1&&s.preventDefault()):s.changedTouches.length===1&&s.changedTouches[0].identifier===Dr.identifier&&Qr.trigger("globaltap",{event:s}),Dr=null)},passive:!1},mousedown:{handler:s=>{kd="mouse",Dr||Qr.trigger("globaltap",{event:s}),wn=s;const a=s.ctrlKey||s.altKey||s.shiftKey||s.metaKey;!Qe&&a?Qe=new KeyboardEvent("keydown",{key:s.ctrlKey?"Control":s.shiftKey?"Shift":s.altKey?"Alt":"Meta",ctrlKey:s.ctrlKey,altKey:s.altKey,shiftKey:s.shiftKey,metaKey:s.metaKey}):Qe&&!a&&(Qe=null)},passive:!1},mouseup(){wn=null},pointerdown:{passive:!1,handler:s=>{var a;tl=s,w.usingKeyboard=!1,(a=r.classList)==null||a.remove("b-using-keyboard"),r.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&w.removeClsGlobally(r,"b-using-keyboard")}},pointerup:{passive:!1,handler:s=>{(tl==null?void 0:tl.pointerId)===s.pointerId&&(tl=null)}},keydown(s){if(kd="key",Qe=s,!cP[s.key])if(w.usingKeyboard=!0,r.nodeType===Node.DOCUMENT_FRAGMENT_NODE)for(const a of r.children)a.matches(".b-outer")&&a.classList.add("b-using-keyboard");else r.classList.add("b-using-keyboard")},keypress(){kd="key"},keyup(){Qe=null},focusin(s){var a,o,l;const{Widget:c}=Qr;if((a=s.target)!=null&&a.shadowRoot||(o=s.target)!=null&&o._shadowRoot||(c.resetFloatRootScroll(),_d))return;const d=s.relatedTarget?s.relatedTarget instanceof HTMLElement?s.relatedTarget:document.body:null,u=s.target||document.body,h=c.fromElement(d),g=c.fromElement(u),f=w.getCommonAncestor(h,g),m=!!(d&&u.compareDocumentPosition(d)&4),p=c.query(dP);let v=null;if(u&&u!==document.body?v=w.getActiveElement(u):v=w.getActiveElement(document),p&&!p._isRevertingFocus&&(!g||!p.owns(g)&&!(p.element.compareDocumentPosition(g.element)&4&&g.up(oP))))return p.focus();let y=Gf("focusout",d,s.target,h,g,m);for(let D=h,S;D&&D!==f;D=S)if(S=D.owner,!D.isDestroying&&D.onFocusOut&&(D.onFocusOut(y),s.target&&v!==w.getActiveElement(s.target)))return;if(f&&s.target===f.element)!f.isDestroying&&w.getActiveElement(f)===u&&f.focusElement&&f.focusElement!==f.element&&(!f.element.contains(v)||f.focusDescendant)&&f.setTimeout(()=>{var D;return(D=f.focus)==null?void 0:D.call(f)},0);else{y=Gf("focusin",u,d,h,g,m);for(let D=g;D&&D!==f;D=D.owner)D.isDestroying||(l=D.onFocusIn)==null||l.call(D,y)}const C=w.getCommonAncestor((d==null?void 0:d.nodeType)===Element.ELEMENT_NODE?d:null,u)||u.parentNode;C&&(y=Gf("focusmove",u,d,h,g,m,{bubbles:!0}),C.dispatchEvent(y))},focusout(s){if(!_d&&(!s.relatedTarget||!Qr.Widget.fromElement(s.relatedTarget))){const a=s.relatedTarget&&s.relatedTarget instanceof HTMLElement?s.relatedTarget:null;n.focusin({target:a,relatedTarget:s.target}),Qe=wn=null}},blur:{element:globalThis,handler(s){s.target===globalThis&&(Qe=null,wn=null)}},capture:!0,passive:!0};i&&(Wf==null||Wf()),Wf=this.detachEvents=t.on(n)}get lastInteractionType(){return kd}get shiftKeyDown(){return Qe==null?void 0:Qe.shiftKey}get ctrlKeyDown(){return(Qe==null?void 0:Qe.ctrlKey)||(Qe==null?void 0:Qe.metaKey)}get altKeyDown(){return Qe==null?void 0:Qe.altKey}isKeyDown(r){return r?(Qe==null?void 0:Qe.key)===r||Qe[(r==null?void 0:r.toLowerCase())+"Key"]===!0:!!Qe}isMouseDown(r=0){return(wn==null?void 0:wn.button)===r}get currentMouseDown(){return wn}get currentPointerDown(){return tl}get currentTouch(){return Dr}get currentKeyDown(){return Qe}},dP=e=>e.isVisible&&e.isTopModal;Qr.observedElements=new Set;var Dr,zf,_d=!1,kd,Qe,wn,tl,Wf;function Gf(e,r,t,i,n,s,a){const o=new CustomEvent(e,a);return Object.defineProperty(o,"_target",{get(){return r}}),Object.defineProperty(o,"relatedTarget",{get(){return t}}),o.fromWidget=i,o.toWidget=n,o.backwards=s,o}var be=Qr;function uP(e,r){const t=T.getPropertyDescriptor(e,r);return t&&(t.get||t.set)?t:null}var Q=class extends F.mixin(Le,We){static get configurable(){return{clientListeners:null,disabled:!1,client:null,keyMap:null}}updateClient(e){this.owner||(this.owner=e)}updateKeyMap(e){const{client:r}=this;r.keyMap=r.mergeKeyMaps(r.keyMap,e,O.uncapitalize(this.constructor.$name))}static initPlugins(e,...r){const t=e.plugins||(e.plugins={});for(const i of r)t[i.$$name]=new i(e)}get enabled(){return!this.disabled}getFocusRevertTarget(){var e;return(e=this.client)==null?void 0:e.getFocusRevertTarget()}construct(...e){const r=this;let[t,i]=e,n;e.length===1?T.isObject(t)&&(i=t,t=i.client):(i=T.assign({},i),delete i.client),r.client=t,super.construct(i),r.applyPluginConfig(t),n=r.clientListeners,n&&(n=T.assign({},n),n.thisObj=r,t.ion(n))}applyPluginConfig(e){const r=this,t=r.pluginConfig||r.constructor.pluginConfig;if(t){const{assign:i,chain:n,after:s,before:a,override:o}=t;i&&r.applyAssign(e,i),(n||s)&&r.applyChain(e,n||s),a&&r.applyChain(e,a,!1),o&&r.applyOverride(e,o)}}applyAssign(e,r){r.forEach(t=>this.assign(e,t))}applyChain(e,r,t=!0){if(Array.isArray(r))for(const i of r)this.chain(e,i,i,t);else for(const i in r)this.chain(e,i,r[i],t)}applyOverride(e,r){const t=this;t.overridden||(t.overridden={}),r.forEach(i=>{if(!t[i])throw new Error(`Trying to chain fn ${e.$$name}#${i}, but plugin fn ${t.$$name}#${i} does not exist`);typeof e[i]=="function"&&(t.overridden[i]=e[i].bind(e)),e[i]=t[i].bind(t)})}assign(e,r){const t=this,i=uP(t,r);i?Object.defineProperty(e,r,{configurable:!0,enumerable:!0,get:i.get&&i.get.bind(t),set:i.set&&i.set.bind(t)}):e[r]=t[r].bind(t)}chain(e,r,t,i=!0){let n=0;typeof r=="object"&&(r=r.fn),typeof t=="object"&&(n=t.prio||0,t=t.fn);const s=this,a=e.pluginFunctionChain||(e.pluginFunctionChain={}),o=s[t]&&s[t].bind(s),l=s.functionChainRunner;if(!o)throw new Error(`Trying to chain fn ${e.$$name}#${t}, but plugin fn ${s.$$name}#${t} does not exist`);if(!a[r]){let c=e[r];c&&(c=c.bind(e),c.$this=e,c.$prio=0),a[r]=c?[c]:[],e[r]=(...d)=>l(a[r],d)}o.$this=s,o.$prio=n,a[r][i?"push":"unshift"](o),a[r].$sorted=!1}functionChainRunner(e,r){let t,i,n;for(e.$sorted||(e.sort((s,a)=>a.$prio-s.$prio),e.$sorted=!0),i=0;i<e.length&&(t=e[i],!(!t.$this.isDestroyed&&(n=t(...r),n===!1)));i++);return n}doDisable(e){var r,t,i,n;const s=this,{constructor:a}=s,o="featureClass"in a?a.featureClass:`b-${a.$$name.toLowerCase()}`,l=O.uncapitalize(a.$$name);o&&((t=(r=s.client)==null?void 0:r._element)==null||t.classList[e?"remove":"add"](o)),s.isConfiguring||(e?s.trigger("disable"):s.trigger("enable"),(n=(i=s.client).syncSplits)==null||n.call(i,c=>{const d=c.features[l];d&&(d.disabled=e)}))}updateDisabled(e){this.doDisable(e)}throwOverrideIsMissing(e){throw new Error(`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`)}get rootElement(){return this.client.rootElement}};E(Q,"$name","InstancePlugin"),Q._$name="InstancePlugin";var Uf=e=>class extends(e||F){static get $name(){return"Pluggable"}get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(t){t&&(Array.isArray(t)||(t=[t]),Q.initPlugins(this,...t)),this.initPlugins()}initPlugins(){}addPlugins(...t){Q.initPlugins(this,...t)}hasPlugin(t){return this.getPlugin(t)!=null}getPlugin(t){var i;return typeof t=="function"&&(t=t.$$name),(i=this.plugins)==null?void 0:i[t]}get widgetClass(){}},{defineProperty:Yf}=Reflect,Fd;q.isBrowserEnv?Fd=globalThis.performance:Fd={now(){return new Date().getTime()}};var Se=null;if(ne.isTestEnv){const e=globalThis.bryntum||(globalThis.bryntum={});Se=e.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,idleCallbacks:new Map,isEmpty(r=!1){return Se.timeouts.size+Se.animationFrames.size+Se.idleCallbacks.size+(r?Se.intervals.size:0)===0},getFiltered({ignoreTimeouts:r=[],maxDelay:t=5e3,includeIntervals:i=!1}){const n=[],s=["timeouts","animationFrames","idleCallbacks"];i&&s.push("intervals");for(const a of s){const o=Se[a];for(const[,l]of o.entries())!r.includes(l.name)&&(!Number.isInteger(l.delay)||l.delay<t)&&n.push(l)}return n}}}var rl=(e,r,t,i)=>{const n=typeof r=="string",s=(i==null?void 0:i.appendArgs)||[],a=()=>{t.timerId=null,t.lastCallTime=Fd.now();const o=t.args;t.args=null,n?e[r](...o,...s):r.call(e,...o,...s),t.called=!0,++t.calls};return i&&(e=i.thisObj||e),t.lastCallTime=-9e9,t.calls=0,t.invoker=a,a.wrapFn=t,a},Od=(e,r,t="clearTimeout")=>(r.cancel=()=>{r.isPending&&(e[t](r.timerId),r.args=r.timerId=null)},r.flush=()=>{r.isPending&&(e[t](r.timerId),r.timerId=null,r.invoker())},r.now=(...i)=>{r.cancel(),r.args=i,r.invoker()},r.resume=i=>{const n=r.suspended;r.suspended=i||n<1?0:n-1},r.suspend=()=>{++r.suspended},r.immediate=!1,r.suspended=0,r.timerId=null,Yf(r,"isPending",{get(){return r.timerId!==null}}),r),fe=e=>class extends(e||F){static get $name(){return"Delayable"}static get declarable(){return["delayable"]}doDestroy(){const t=this;super.doDestroy(),t.timeoutIds&&(t.timeoutIds.forEach((i,n)=>{typeof i=="function"&&i(),clearTimeout(n),Se==null||Se.timeouts.delete(n)}),t.timeoutIds=null),t.timeoutMap&&(t.timeoutMap.forEach((i,n)=>clearTimeout(n)),t.timeoutMap=null),t.intervalIds&&(t.intervalIds.forEach(i=>{clearInterval(i),Se==null||Se.intervals.delete(i)}),t.intervalIds=null),t.animationFrameIds&&(t.animationFrameIds.forEach(i=>{cancelAnimationFrame(i),Se==null||Se.animationFrames.delete(i)}),t.animationFrameIds=null),t.idleCallbackIds&&(t.idleCallbackIds.forEach(i=>{cancelIdleCallback(i),Se==null||Se.idleCallbacks.delete(i)}),t.idleCallbackIds=null)}hasTimeout(t){var i;return!!((i=this.timeoutMap)!=null&&i.has(t))}setTimeout({fn:t,delay:i,name:n,runOnDestroy:s,cancelOutstanding:a,args:o}){(arguments.length>1||typeof arguments[0]=="function")&&([t,i,n,s]=arguments),typeof t=="string"?n=t:n||(n=t.name||t),a&&this.clearTimeout(n);const l=this,c=l.timeoutIds||(l.timeoutIds=new Map),d=l.timeoutMap||(l.timeoutMap=new Map),u=setTimeout(()=>{typeof t=="string"&&(t=l[n]),c==null||c.delete(u),d==null||d.delete(n),Se==null||Se.timeouts.delete(u),t.apply(l,o)},i);return c.set(u,s?t:!0),Se==null||Se.timeouts.set(u,{fn:t,delay:i,name:n}),n&&d.set(n,u),u}clearTimeout(t){var i;let n=t;if(typeof n=="string")if(this.timeoutMap)n=this.timeoutMap.get(t),this.timeoutMap.delete(t);else return;clearTimeout(n),(i=this.timeoutIds)==null||i.delete(n),Se==null||Se.timeouts.delete(n)}clearInterval(t){var i;clearInterval(t),(i=this.intervalIds)==null||i.delete(t),Se==null||Se.intervals.delete(t)}setInterval(t,i,n){const s=setInterval(t,i);return(this.intervalIds||(this.intervalIds=new Set)).add(s),Se==null||Se.intervals.set(s,{fn:t,delay:i,name:n}),s}requestAnimationFrame(t,i=[],n=this){const s=this.animationFrameIds||(this.animationFrameIds=new Set),a=requestAnimationFrame(()=>{Se==null||Se.animationFrames.delete(a),s.delete(a)&&t.apply(n,i)});return s.add(a),Se==null||Se.animationFrames.set(a,{fn:t,extraArgs:i,thisObj:n}),a}requestIdleCallback(t,i=[],n=this){const s=this.idleCallbackIds||(this.idleCallbackIds=new Set),a=requestIdleCallback(()=>{Se==null||Se.idleCallbacks.delete(a),s.delete(a)&&t.apply(n,i)});return s.add(a),Se==null||Se.idleCallbacks.set(a,{fn:t,extraArgs:i,thisObj:n}),a}createOnFrame(t,i=[],n=this,s){let a;const o=(...l)=>{a!=null&&s&&(this.cancelAnimationFrame(a),a=null),a==null&&(a=this.requestAnimationFrame(()=>{typeof t=="string"&&(t=n[t]),a=null,l.push(...i),t.apply(n,l)}))};return o.cancel=()=>this.cancelAnimationFrame(a),o}cancelAnimationFrame(t){var i;cancelAnimationFrame(t),(i=this.animationFrameIds)==null||i.delete(t),Se==null||Se.animationFrames.delete(t)}cancelIdleCallback(t){var i;cancelIdleCallback(t),(i=this.idleCallbackIds)==null||i.delete(t),Se==null||Se.idleCallbacks.delete(t)}async nextAnimationFrame(){return new Promise(t=>this.requestAnimationFrame(t))}buffer(t,i){let n=i;i&&typeof i!="number"?n=i.delay:i=null;const s=(...o)=>{if(s.suspended)return;const{delay:l}=s;s.cancel(),s.called=!1,s.args=o,s.immediate||!l?a():s.timerId=this.setTimeout(a,l)},a=rl(this,t,s,i);return s.delay=n,Od(this,s)}raf(t,i){let n=i;i&&typeof i!="boolean"?n=i.cancelOutstanding:i=null;const s=(...o)=>{s.suspended||(s.cancelOutstanding&&s.cancel(),s.called=!1,s.args=o,s.immediate?a():s.isPending||(s.timerId=this.requestAnimationFrame(a)))},a=rl(this,t,s,i);return s.cancelOutstanding=n,Od(this,s,"cancelAnimationFrame")}idle(t,i){let n=i;i&&typeof i!="boolean"?n=i.cancelOutstanding:i=null;const s=(...o)=>{s.suspended||(s.cancelOutstanding&&s.cancel(),s.called=!1,s.args=o,s.immediate?a():s.isPending||(s.timerId=this.requestIdleCallback(a)))},a=rl(this,t,s,i);return s.cancelOutstanding=n,this.setTimeout(()=>this.idleCallbackIds.delete(s.timerId)&&s.now(),100),Od(this,s,"cancelIdleCallback")}throttle(t,i){let n=i,s;i&&typeof i!="number"?(n=i.delay,s=i.throttled):i=null;const a=this,o=(...c)=>{if(o.suspended)return;const{delay:d}=o,u=Fd.now()-o.lastCallTime;o.args=c,o.immediate||u>=d?(a.clearTimeout(o.timerId),l()):(o.isPending||(o.timerId=a.setTimeout(l,d-u),o.called=!1),s&&(s.wrapFn.args=c,s()))},l=rl(a,t,o,i);return o.delay=n,s&&(s=rl(a,s,()=>{},i)),Od(a,o)}static setupDelayable(t){t.setupDelayableMethods(t.delayable)}static setupDelayableMethods(t,i=null){const n=this,s=t.static,a=i||n.prototype;s&&delete t.static;for(const o in t){let l=t[o];const c=o+"Now",d=typeof l;a[c]||(a[c]=a[o]),d==="number"?l={type:"buffer",delay:l}:d==="string"&&(l={type:l}),Yf(a,o,{get(){const u=this[l.type]((...h)=>{this[c](...h)},l);return Yf(this,o,{value:u}),u}})}}get widgetClass(){}},Js=class{get data(){return Object.create(null)}get keys(){return[]}clear(){}getItem(e){return null}removeItem(e){}setItem(e,r){}};Js._$name="StateStorage";var hP=class extends Js{constructor(e){super(),this.prefix=e.prefix||""}get isLocal(){return!0}get data(){const e=qS(),r=this.keys;for(const t of r)e[t]=this.getItem(t);return e}get keys(){return KS(this.prefix,this.prefix.length)}clear(){const e=KS(this.prefix);for(const r of e)localStorage.removeItem(r)}getItem(e){const r=localStorage.getItem(this.prefix+e);return r===null?r:JSON.parse(r)}removeItem(e){return localStorage.removeItem(this.prefix+e)}setItem(e,r){return localStorage.setItem(this.prefix+e,JSON.stringify(r))}},gP=class extends Js{constructor(){super(),this.clear()}get isMemory(){return!0}get data(){return T.clone(this._data)}get keys(){return Object.keys(this._data)}clear(){this._data=qS()}getItem(e){return e in this._data?this._data[e]:null}removeItem(e){delete this._data[e]}setItem(e,r){this._data[e]=r}},qS=()=>Object.create(null),KS=(e,r=0)=>{const t=[],i=localStorage.length;for(let n,s=0;s<i;++s)n=localStorage.key(s),n.startsWith(e)&&t.push(n.slice(r));return t},XS=new Js,qf={local:hP,memory:gP},Qs=class extends F.mixin(fe,Le){static get $name(){return"StateProvider"}static get configurable(){return{prefix:"bryntum-state:",storage:"local"}}static get delayable(){return{writeStatefuls:50}}static get instance(){return this._instance}static set instance(e){e==null?e=ZS:((typeof e=="string"||T.isClass(e)||e instanceof Js)&&(e={storage:e}),T.isObject(e)&&(e=new Qs(e))),this._instance=e}static setup(e){return this.instance=e,this.instance}doDestroy(){self.writeStatefuls.flush(),super.doDestroy()}get data(){return this.storage.data}set data(e){if(!e)this.clear();else for(const r in e)this.setValue(r,e[r])}clear(){return this.storage.clear(),this}changeStorage(e){if(e==null)e=XS;else{if(typeof e=="string"){if(!qf[e])throw new Error(`Invalid storage type "${e}" (expected one of: "${Object.keys(qf).join('", "')}")`);e=qf[e]}T.isClass(e)&&(e=new e(this))}return e}saveStateful(e,r){(this.pendingSaves||(this.pendingSaves=[])).push([e,r]),this.writeStatefuls()}writeStatefuls(){const e=this,{pendingSaves:r}=e,t=r==null?void 0:r.length,i=[],n=[];if(e.pendingSaves=null,t){for(let s,a,o,l=0;l<t;++l)[a,s]=r[l],!a.isDestroying&&a.isSaveStatePending&&(o=a.saveState({...s,immediate:!0}),o&&(i.push(o),n.push(a)));i.length&&e.trigger("save",{stateIds:i,saved:n})}}getValue(e){return this.writeStatefuls.flush(),this.storage.getItem(e)}setValue(e,r){const t=this,{storage:i}=t,n=t.getValue(e);return r!=null?(i.setItem(e,r),t.trigger("set",{key:e,value:r,was:n})):n!==null&&(i.removeItem(e),t.trigger("remove",{key:e,was:n})),t}},ZS=new Qs({storage:XS});Qs._instance=ZS,Qs._$name="StateProvider";var fP=/boolean|number|string/,Ld=e=>{var r;return r=class extends(e||F){afterConstruct(){super.afterConstruct(),this.loadState()}finalizeInit(){this.loadState(),super.finalizeInit()}get isStateful(){return!0}get isStatefulActive(){return!this.statefulSuspended&&!this.isResponsivePending&&!this.isResponsiveUpdating}get state(){return this._state=this.getState()}set state(t){this._state=t,t&&this.applyState(t)}updateStatefulEvents(t){var i;const n=this,s={name:"statefulEvents",thisObj:n};if(n.detachListeners(s.name),t&&(typeof t=="string"?t=O.split(t):Array.isArray(t)||(t=T.getTruthyKeys(t)),t.length)){for(const a of t)s[a]="onStatefulEvent";(i=n.ion)==null||i.call(n,s)}}get statefulId(){const t=this,{responsiveState:i}=t;let n=t.stateId;return n==null&&t.hasGeneratedId===!1&&t.stateful!==!1&&(n=t.id),n&&i&&(n=`${n}[${i}]`),n}get statefulness(){const{stateful:t}=this;return Array.isArray(t)?T.createTruthyKeys(t):t}get stateProvider(){return this._stateProvider||Qs.instance}applyState(t){t=this.pruneState(t),t&&this.setConfig(t)}getState(){const t=this,{initialConfig:i,statefulness:n,isConstructing:s}=t,{configs:a}=t.$meta,o=s?Object.setPrototypeOf(i,t.$meta.config):t;let l=null,c,d;if(n){l={};for(c in n)if(n[c]){if(d=o[c],d!=null&&d.isStateful)d=d.state;else if(!s&&(T.isDate(d)&&(d=b.format(d,"YYYY-MM-DDTHH:mm:ssZ")),a[c].equal(d,i==null?void 0:i[c])||!fP.test(typeof d)))continue;l[c]=d}}return l}loadState(t,i){typeof t=="boolean"&&(i=t,t=null);const n=this,{statefulLoaded:s}=n;if(n.isStatefulActive&&(i||!s)){const a=n.loadStatefulData(t||(t=n.statefulId));!s&&t&&(n.defaultState=n.state,n.statefulLoaded=!0),a&&(n.state=a)}}loadStatefulData(t){var i;return t=this.isStatefulActive?t||this.statefulId:null,t&&((i=this.stateProvider)==null?void 0:i.getValue(t))}resetDefaultState(){this.defaultState&&(this.state=this.defaultState)}resumeStateful(t=!1){this.statefulSuspended=t?0:Math.max(this.statefulSuspended-1,0)}saveState(t){typeof t=="string"?t={id:t}:t=t||{};const i=this,{stateProvider:n}=i,s=t.id||i.isStatefulActive&&i.statefulId;if(s&&n)return t.immediate?(i.isSaveStatePending=!1,n.setValue(s,i.state)):i.isSaveStatePending||(i.isSaveStatePending=!0,n.saveStateful(i,t)),s}suspendStateful(){++this.statefulSuspended}onConfigChange({name:t,value:i,was:n,config:s}){if(super.onConfigChange({name:t,value:i,was:n,config:s}),!this.isConstructing&&this.isStatefulActive&&this.statefulId){const{stateful:a}=this;(Array.isArray(a)?a.includes(t):a!=null&&a[t])&&this.saveState()}}onStatefulEvent(){this.isConstructing||this.saveState()}pruneState(t){const{statefulness:i}=this;if(i){const n={};for(const s in t)i[s]&&(n[s]=t[s]);t=n}return t}get widgetClass(){}},E(r,"$name","State"),E(r,"configurable",{stateful:{value:null,$config:{merge:"classList"}},statefulEvents:{$config:{merge:"classList"},value:["stateChange"]},stateId:null,stateProvider:null}),E(r,"prototypeProperties",{statefulLoaded:!1,statefulSuspended:0}),r},JS=T.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),mP={string:1,number:1},ea=e=>class extends(e||F){static get $name(){return"Identifiable"}static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(t,i){const{identifiable:n}=t;n.idMap=Object.create(null),Reflect.defineProperty(t,"identifiable",{get(){return n}})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(t){return(this.hasGeneratedId=!t)?this.generateAutoId():t}updateId(t,i){const n=this,s=n.constructor;i&&s.unregisterInstance(n,i),(!n.hasGeneratedId||s.identifiable.registerGeneratedId!==!1)&&s.registerInstance(n,t)}generateAutoId(){return this.constructor.generateId(`b-${this.$$name.toLowerCase()}-`)}static get all(){return Object.values(this.identifiable.idMap)}static generateId(t="generatedId"){return t+(JS[t]=(JS[t]||0)+1)}static registerInstance(t,i=t.id){const{idMap:n}=this.identifiable;if(i in n&&!this.disableThrow)throw new Error("Id "+i+" already in use");n[i]=t}static unregisterInstance(t,i=t.id){const{idMap:n}=this.identifiable;mP[typeof t]?delete n[t]:n[i]===t&&delete n[i]}static getById(t){const i=this.identifiable.idMap;if(i)return i[t]}static get registeredInstances(){const t=this.identifiable.idMap;return t?Object.values(t):[]}},QS=Symbol("STM_PROP"),eD={parentIndex:1},tD=e=>class extends(e||F){static get $name(){return"ModelStm"}static get defaultConfig(){return{stm:null}}joinStore(t){this.stm||(this.stm=t.stm)}unjoinStore(t,i=!1){var n;this.stm===t.stm&&(this.stm=null),(n=super.unjoinStore)==null||n.call(this,t,i)}get stm(){return this[QS]}set stm(t){this[QS]=t}beforeChronoFieldSet(t,i){var n;const s=this;return!s.inSetting&&((n=s.stm)!=null&&n.enabled)&&!eD[t]&&!s.constructor.nonPersistableFields[t]&&s.getFieldDefinition(t)?{[t]:{value:i,oldValue:s[t]}}:null}afterChronoFieldSet(t,i,n){n&&this.afterSet(t,i,!1,!1,n,!0)}shouldRecordFieldChange(t,i,n){const s=this.firstStore;return!(this.constructor.nonPersistableFields[t]||i==null&&n==null||i===n||i instanceof Date&&n instanceof Date&&i.getTime()===n.getTime()||t==="id"||t==="$PhantomId"||t==="parentId"&&s&&s.oldIdMap[i]===s.getById(n))}afterSet(t,i,n,s,a,o){const{stm:l}=this,c=this.constructor.nonPersistableFields;if(l!=null&&l.isBase&&l.enabled&&!eD[t]&&!c[t]&&a){let d;const[u,h]=Object.keys(a).reduce((g,f)=>{const{value:m,oldValue:p}=a[f];return this.shouldRecordFieldChange(f,p,m)&&(d=!0,g[0][f]=m,g[1][f]=p),g},[{},{}]);d&&l.onModelUpdate(this,u,h,o)}}beforeInsertChild(t){var i;const n=((i=super.beforeInsertChild)==null?void 0:i.call(this,t))||[],{stm:s}=this;return s!=null&&s.enabled&&n.push(t.reduce((a,o)=>(o.root===this.root&&a.set(o,{parent:o.parent,index:o.parent?o.parentIndex:void 0}),a),new Map)),n}afterInsertChild(t,i,n,s){var a;const{stm:o}=this;if(o!=null&&o.enabled){const l=n.pop();s&&o.onModelInsertChild(this,t,s,l)}(a=super.afterInsertChild)==null||a.call(this,t,i,n,s)}beforeRemoveChild(t,i){const n=super.beforeRemoveChild?super.beforeRemoveChild(t,i):[],{stm:s}=this;return s!=null&&s.enabled&&!i&&n.push(t.reduce((a,o)=>(a.set(o,{parentIndex:o.parentIndex,orderedParentIndex:o.orderedParentIndex}),a),new Map)),n}afterRemoveChild(t,i,n){var s;const{stm:a}=this;if(a!=null&&a.enabled&&!n){const o=i.pop();t&&t.length&&a.onModelRemoveChild(this,t,o)}(s=super.afterRemoveChild)==null||s.call(this,t,i,n)}},pP={includeFilteredOutRecords:!1},Kf=e=>(e=e||!1,typeof e=="boolean"&&(e={includeFilteredOutRecords:e}),e||pP),rD=e=>class extends(e||F){static get $name(){return"TreeNode"}static set convertEmptyParentToLeaf(t){t===!0?t={onLoad:!0,onRemove:!0}:t===!1&&(t={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=t}constructor(...t){super(...t),this.children&&(this.orderedChildren=this.orderedChildren||[])}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(t,i=this.stores){const{inProcessChildren:n,constructor:s}=this,a=i[0];if(t===!0)return n?!0:[];if(t){t=H.asArray(t);const o=t.length,l=[];for(let c=0,d;c<o;c++)d=t[c],d=d.isModel?d:a?a.createRecord(d,!1,!0):new s(d,null,null,!0),d=a?a.processRecord(d):d,l.push(d);if(this.children===!0&&a){const c=a.createSorterFn(a.sorters);l.sort(c)}return l}}processChildren(t=this.stores){const i=this,{meta:n}=i;i.inProcessChildren=!0;const s=i.ingestChildren(i.data[i.constructor.childrenField],t);if(s){const{convertEmptyParentToLeaf:a}=i.constructor;if(a===!0||a.onLoad?s.length:Array.isArray(s)){if(n.isLeaf=!1,i.children===!0)i.children=[];else if(s.length===0){i.children=s;return}i.insertChild(s)}else s===!0?(n.isLeaf=!1,i.children=!0):i.isRoot||(n.isLeaf=i.constructor.convertEmptyParentToLeaf.onLoad)}i.inProcessChildren=!1}ancestorsExpanded(t=this.firstStore){const{parent:i}=this;return!i||i.isExpanded(t)&&i.ancestorsExpanded(t)}isExpanded(t=this.firstStore){const i=this.instanceMeta(t.id);return Object.prototype.hasOwnProperty.call(i,"collapsed")||(i.collapsed=!this.expanded),!i.collapsed}get expanded(){return this.data.expanded}get childLevel(){let t=this,i=-1;for(;t&&!t.isRoot;)++i,t=t.parent;return i}get isLeaf(){return this.meta.isLeaf!==!1&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(t=!1,i=this.firstStore){const{children:n}=this;return!n||!Array.isArray(n)||t&&!this.isExpanded(i)?0:n.reduce((s,a)=>s+a.getDescendantCount(t),n.length)}get allChildren(){return this.getAllChildren(!1)}get allUnfilteredChildren(){return this.getAllChildren(!0)}getAllChildren(t=!1){const{[t?"unfilteredChildren":"children"]:i}=this;return!i||i===!0?[]:i.reduce((n,s)=>(n.push(s),n.push.apply(n,t?s.allUnfilteredChildren:s.allChildren),n),[])}get firstChild(){const{children:t}=this;return(t==null?void 0:t.length)&&t[0]||null}get lastChild(){const{children:t}=this;return(t==null?void 0:t.length)&&t[t.length-1]||null}get previousSiblingsTotalCount(){let t=this.previousSibling,i=this.parentIndex;for(;t;)i+=t.descendantCount,t=t.previousSibling;return i}get previousOrderedSibling(){var t;return(t=this.parent)==null?void 0:t.orderedChildren[this.orderedParentIndex-1]}get nextOrderedSibling(){var t;return(t=this.parent)==null?void 0:t.orderedChildren[this.orderedParentIndex+1]}get root(){var t;return((t=this.parent)==null?void 0:t.root)||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(t){const i=this,{parent:n}=i,s=t===null?i.firstStore.rootNode:i.firstStore.getById(t);s===n||!n&&!s||(i.isBatchUpdating?i.meta.batchChanges.parentId=t:s?s.appendChild(i):i.parent.removeChild(i))}static set parentIdField(t){this._parentIdField=t,Object.defineProperty(this.prototype,t,{set:function(i){this.parentId=i},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}getChildren(t){let i;return t.includeFilteredOutRecords?i=this.unfilteredChildren||this.children:t.useOrderedTree?i=this.orderedChildren:i=this.children,i}traverse(t,i,n){n=Kf(n);const s=this,a=s.getChildren(n);i||t.call(s,s);for(let o=0,l=a==null?void 0:a.length;o<l;o++)a[o].traverse(t,!1,n)}traverseBefore(t,i,n){n=Kf(n);const s=this,a=s.getChildren(n);for(let o=0,l=a==null?void 0:a.length;o<l;o++)a[o].traverse(t,!1,n);i||t.call(s,s)}traverseWhile(t,i,n){n=Kf(n);const s=this;let a=i||t.call(s,s)!==!1;if(a){const o=s.getChildren(n);o!=null&&o.length&&(a=o.every(l=>l.traverseWhile(t,!1,n)))}return a}bubble(t,i=!1){let n=this;for(i||t.call(n,n);n.parent;)n=n.parent,t.call(n,n)}bubbleWhile(t,i=!1){let n=this,s=!0;for(i||(s=t.call(n,n));s&&n.parent;)n=n.parent,s=t.call(n,n);return s}contains(t,i=!1){return t&&typeof t=="object"&&(t=t.id),!this.traverseWhile(n=>n.id!=t,i)}getTopParent(t){let i;return t?(i=[],this.bubbleWhile(n=>(i.push(n),n.parent&&!n.parent.isRoot))):(i=null,this.bubbleWhile(n=>(i=n,n.parent&&!n.parent.isRoot))),i}appendChild(t,i=!1){return this.insertChild(t,null,i)}insertChild(t,i=null,n=!1,s={}){var a,o,l,c,d,u,h;const g=this,f=Array.isArray(t);if(t=H.asArray(t),typeof i=="number"&&(i=(o=(a=g.children)==null?void 0:a[i])!=null?o:null),!n&&!g.stores.every(y=>y.trigger("beforeAdd",{records:t,parent:g})!==!1))return null;t=g.ingestChildren(t);const m=(d=(c=i==null?void 0:i.parentIndex)!=null?c:(l=g.children)==null?void 0:l.length)!=null?d:0,p=(u=g.beforeInsertChild)==null?void 0:u.call(g,t),v=g.internalAppendInsert(t,i,n,s);return v.length&&g.convertToParent(n),(h=g.afterInsertChild)==null||h.call(g,m,t,p,v),f||!v?v:v[0]}convertToParent(t=!1){const i=this,n=i.isLeaf;i.meta.isLeaf=!1,i.children||(i.children=[]),n&&!i.root.isLoading&&!t&&i.signalNodeChanged({isLeaf:{value:!1,oldValue:!0}})}signalNodeChanged(t,i=this.stores){i.forEach(n=>{n.trigger("update",{record:this,records:[this],changes:t}),n.trigger("change",{action:"update",record:this,records:[this],changes:t})})}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(t,i,n,s){const a=this,{stores:o,root:l,children:c}=a,{firstStore:d}=l,{parentIdField:u}=a.constructor,h=a.id;let g,f,m,p,v,y;if(!l.isLoading&&d)for(y={},v=[],m=0;m<t.length;m++){const C=t[m];y[C.id]=C.root===l,v[m]=C.parentIndex}if(i&&i.parent!==a&&(i=null),c){const C=i?i.parentIndex:c.length;if(c[f=C]===t[0]||c[f=C-1]===t[0])for(g=!0,m=0;g&&m<t.length;m++)t[m]!==c[f+m]&&(g=!1)}if(g)return t;for(m=0;m<t.length;m++){const C=t[m],D=C.parent;if(d&&!l.isLoading&&C.traverse(S=>{S.root===l&&(y[S.id]=!0)}),(D==null?void 0:D.removeChild(C,y==null?void 0:y[C.id],n,{isInserting:!0,...s}))===!1)p||(t=t.slice(),p=!0),t.splice(m--,1);else{C.parent=a,C.data[u]=h;const{meta:S}=C;S.modified[u]===h&&!D&&(S.oldParentId=h),D&&(S.oldParentId=D.id)}}if(t.length){Array.isArray(c)||(a.children=[]),Array.isArray(a.orderedChildren)||(a.orderedChildren=[]);const C=a.addToChildren(i,t,s);o.forEach(D=>{D.isChained||(t.forEach(S=>{S.joinStore(D)}),D.onNodeAddChild(a,t,C,y,n),t.forEach((S,x)=>{if(S.meta.oldParentId!=null&&!(a.inProcessChildren||a.isLoading)){const R={[u]:h,[a.getDataSource("parentIndex")]:S.parentIndex},I={},{modified:M,oldParentId:P}=S.meta,_=v[x];if(delete S.meta.oldParentId,a.id!==P&&(I[u]={value:h,oldValue:P}),S.parentIndex!==_&&(I.parentIndex={value:S.parentIndex,oldValue:_}),M[u]===a.id?Reflect.deleteProperty(M,u):u in M||(M[u]=P),y[S.id]){const A=D.getById(P);A.isLeaf&&!n&&A.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}},[D])}S.afterChange(R,I)}S.traverse(R=>{!R.ignoreBag&&!R.isLinked&&D.updateModifiedBagForRecord(R)})}))})}return t}removeChild(t,i=!1,n=!1,s={}){var a,o;const l=this,c=[],d=l.isLeaf,{children:u,stores:h}=l;if(t=H.asArray(t),t=t.filter(f=>f.parent===l),!n){for(const f of h)if(!f.isChained&&f.trigger("beforeRemove",{parent:l,records:t,isMove:i})===!1)return!1}const g=(a=l.beforeRemoveChild)==null?void 0:a.call(l,t,i);for(const f of t){const{parentIdField:m}=f.constructor,{modified:p}=f.meta,v=f.parent?f.parent.id:null;!(m in p)&&!f.isLinked&&(p[m]=v);const y=l.removeFromChildren(f,s);h.forEach(C=>{if(!C.isChained){const{isRemoving:D}=C;C.isRemoving=!0,c.push(...C.onNodeRemoveChild(l,[f],y,{isMove:i,silent:n})),C.isRemoving=D}}),i||(f.parent=f.parentIndex=f.unfilteredIndex=f.nextSibling=f.previousSibling=null,f.data[m]=null)}return(l.unfilteredChildren||u).length===0&&l.constructor.convertEmptyParentToLeaf.onRemove&&!l.isRoot&&(l.meta.isLeaf=!0),l.isLeaf!==d&&!n&&!i&&l.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}}),(o=l.afterRemoveChild)==null||o.call(l,t,g,i),c}clearParentId(){const t=this;Reflect.deleteProperty(t.data,t.parentIdField),Reflect.deleteProperty(t.originalData,t.parentIdField),t.meta.modified&&Reflect.deleteProperty(t.meta.modified,t.parentIdField)}replaceChildren(t){return this.clearChildren(),this.data[this.constructor.childrenField]=t,this.processChildren(),this.children}clearChildren(t=!1){const i=this,{stores:n}=i,s=i.unfilteredChildren||i.children;i.children=[],i.orderedChildren=[],s&&s!==!0&&(n.forEach(a=>{a.isChained||a.onNodeRemoveChild(i,s,0,{unfiltered:!0,silent:t})}),i.unfilteredChildren&&(i.unfilteredChildren=[]))}clear(){var t;const i=this,{stores:n}=i,s=(t=i.children)==null?void 0:t.slice();if(!(!i.isRoot||!s)){for(const a of n)if(!a.isChained&&a.trigger("beforeRemove",{parent:i,records:s,isMove:!1,removingAll:!0})===!1)return!1;i.children.length=0,i.unfilteredChildren&&(i.unfilteredChildren.length=0),n.forEach(a=>{s.forEach(o=>{o.stores.includes(a)&&o.unjoinStore(a),o.parent=o.parentIndex=o.nextSibling=o.previousSibling=null}),a.storage.suspendEvents(),a.storage.clear(),a.storage.resumeEvents(),a.added.clear(),a.modified.clear(),a.trigger("removeAll"),a.trigger("change",{action:"removeall"})})}}updateChildrenIndices(t,i,n=!1){let s=null;for(let a=0;a<t.length;a++){const o=t[a],l=o[i];i==="parentIndex"||i==="orderedParentIndex"?l===void 0||n?o.setData(i,a):l!==a&&o.set(i,a,!0):o[i]=a,i==="parentIndex"&&(o.previousSibling=s,s&&(s.nextSibling=o),a===t.length-1&&(o.nextSibling=null),s=o)}}addToChildren(t,i,n={}){var s,a;const o=this,l=[[o.children,"parentIndex",t],[o.unfilteredChildren,"unfilteredIndex",t],[o.orderedChildren,"orderedParentIndex",(s=n==null?void 0:n.orderedBeforeNode)!=null?s:(n==null?void 0:n.orderedParentIndex)!==void 0?o.orderedChildren[n==null?void 0:n.orderedParentIndex]:t]];for(const c of l){const[d,u,h]=c;if(d){const g=h?u==="orderedParentIndex"?d.indexOf(h):h[u]:d.length;c.push(g),d.splice(g,0,...i),(a=n==null?void 0:n[u])!=null&&a.skip||o.updateChildrenIndices(d,u)}}return l[0][3]}removeFromChildren(t,i){var n;const s=[[this.children,"parentIndex"],[this.unfilteredChildren,"unfilteredIndex"],[this.orderedChildren,"orderedParentIndex"]];for(const a of s){const[o,l]=a;if(o){const c=o.indexOf(t);a.push(c),c>-1&&(o.splice(c,1),(n=i==null?void 0:i[l])!=null&&n.skip||this.updateChildrenIndices(o,l))}}return s[0][2]}sortOrderedChildren(t=!0,i=!1){const n=[];return this.isLeaf||(this.orderedChildren.sort((s,a)=>{var o,l;if(i){const c=(o=s.meta.modified.orderedParentIndex)!=null?o:s.orderedParentIndex,d=(l=a.meta.modified.orderedParentIndex)!=null?l:a.orderedParentIndex,u=c-d;return u!==0&&(n.push(s),n.push(a)),u}else return s.orderedParentIndex-a.orderedParentIndex}),t&&this.orderedChildren.forEach(s=>{n.push(...s.sortOrderedChildren(t,i))}),this.updateChildrenIndices(this.orderedChildren,"orderedParentIndex",!0)),new Set(n)}unjoinStore(t,i=!1){var n;const s=this;s.unfilteredChildren&&(s.children=s.unfilteredChildren.slice(),s.unfilteredChildren=null),(n=super.unjoinStore)==null||n.call(this,t,i)}},iD={id:1,stores:1,parentIndex:1,parent:1,previousSibling:1,nextSibling:1,unfilteredIndex:1},vP={get(e,r){return r==="proxyMeta"?this.proxyMeta:r==="constructor"?e.constructor:r==="setData"?this.setDataOverride:r==="set"?this.setOverride:iD[r]?this.proxyMeta.data[r]:Reflect.get(e,r,this.proxyRecord)},set(e,r,t){return iD[r]?this.proxyMeta.data[r]=t:e[r]=t,!0},setDataOverride(e,r){e==="parentIndex"?this.proxyMeta.data.parentIndex=r:this.proxyMeta.originalRecord.setData(e,r)},setOverride(e,r,...t){e==="parentIndex"?this.proxyMeta.data.parentIndex=r:this.proxyMeta.originalRecord.set(e,r,...t)}},nD=e=>{var r;return r=class extends(e||F){link(){if(this.isLinked)return this.$original.link();const t=this,i={...vP,proxyMeta:{originalRecord:t,data:{id:`${t.id}_link_${O.generateUUID()}`,stores:[]}}},n=new Proxy(t,i);return i.proxyRecord=n,(t.meta.linkedRecords||(t.meta.linkedRecords=[])).push(n),n}get isLinked(){var t;return!!((t=this.proxyMeta)!=null&&t.originalRecord)}get hasLinks(){return!!(!this.proxyMeta&&this.$links.length)}removeLink(t,i=null,n=!1){if(t.hasLinks)for(const s of t.$links.slice())i?H.include(i,s):s.remove(n);else t.isLinked&&H.remove(t.$original.$links,t)}beforeRemove(t){this.removeLink(this,t)}removeChild(t,i,n,s){if(!(s!=null&&s.isInserting)){t=H.asArray(t);for(const a of t)this.removeLink(a,null,n)}return super.removeChild(t,i,n,s)}get $originalId(){return this.$original.id}get $links(){var t;return(t=this.meta.linkedRecords)!=null?t:[]}},E(r,"$name","ModelLink"),r},{defineProperty:sD}=Reflect,Xf=Symbol("owner"),yP=/[\s,]+/,En=e=>class extends(e||F){static get $name(){return"Factoryable"}static get declarable(){return["factoryable","alias","type"]}static register(t,i,n=globalThis.__BRYNTUM_EXAMPLE){const{factoryable:s}=this.initClass(),{caseless:a,registry:o}=s,l=O.split(t,yP);for(let c,d,u=0;u<l.length;++u){if(d=l[u],c=a?d.toLowerCase():d,!n&&c in o)throw new Error(`Type "${d}" already registered with ${s.class.name} factory`);o[d]=o[c]=i.initClass()}}static isA(t,i){return this.isType(t,i,!0)}static isType(t,i,n){const{factoryable:s}=this,{caseless:a,registry:o}=s,l=o[a?i.toLowerCase():i];return l?n?t instanceof l:t.constructor===l:!1}static setupAlias(t){t.register(t.alias,t)}static setupFactoryable(t,i){const n=i.super.class;let{factoryable:s}=t;s={caseless:!0,defaultType:null,extends:n.factoryable?[n]:null,typeKey:"type",...s},s.class=t,s.registry=Object.create(null),s.extends&&!Array.isArray(s.extends)&&(s.extends=[s.extends]),sD(t,"factoryable",{get(){return s}})}static setupType(t,i){const{type:n}=t;t.register(n,t,i.replaceType),sD(t.prototype,"type",{value:n})}static create(t,i){return this.reconfigure(null,t,i)}static reconfigure(t,i,n){const s=this,{factoryable:a}=s,{typeKey:o}=a;let l=n,c,d,u,h,g,f,m,p,v;if(n&&!T.isClass(n)&&(l=null,m=typeof n,m==="function"?f=n:m==="string"?l=n:T.isObject(n)?(c=n.cleanup,d=n.defaults,h=n.owner,f=n.setup,l=n.type,p=n.transform):h=n),p&&(i=typeof p=="string"?h[p](i):p(i)),v=i,typeof v=="string")i={};else if(i){if(i===!0&&(i={}),!T.isObject(i))return h&&i!==t&&(t==null?void 0:t[Xf])===h&&(typeof c=="string"?h[c](t):c==null||c(t),t.destroy()),i;v=i[o]}if(v=v&&s.resolveType(v),t){if(i&&(!v||t.constructor===v))return o in i&&(i=T.assign({},i),delete i[o]),t.setConfig(i),t;h&&t[Xf]===h&&(typeof c=="string"?h[c](t):c==null||c(t),t.destroy())}if(i){if(d){if(!(u=v)){if(!(u=d[o]||l||a.defaultType))throw new Error(`No default mergeType defined for ${a.class.name} factory`);u=s.resolveType(u)}u&&(i=u.mergeConfigs(d,i))}if(f){if(g=typeof f=="string"?h[f](i,v,d):f(i,v,d),g===null)return g;i=g||i}if(!v){if(!(v=i[o]||l||a.defaultType))throw new Error(`No default type defined for ${a.class.name} factory`);v=s.resolveType(v)}d&&!u&&(i=v.mergeConfigs(d,i)),o in i&&(i=T.assign({},i),delete i[o]),i=new v(i),h&&(i[Xf]=h)}return i||null}static resolveType(t,i){if(typeof t!="string")return t;const{factoryable:n}=this,s=n.extends;let a=n.registry[n.caseless?t.toLowerCase():t],o;for(o=0;!a&&s&&o<s.length;++o)a=s[o].resolveType(t,!0);if(!a&&!i)throw new Error(`Invalid type name "${t}" passed to ${n.class.name} factory`);return a}},{getOwnPropertyDescriptor:bP}=Reflect,er=class extends F.mixin(En){static get $name(){return"DataField"}static get type(){return"auto"}static get factoryable(){return{defaultType:"auto"}}static get prototypeProperties(){return{compare:null,compareItems:null,dataSource:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:void 0,persist:!0,readOnly:!1,internal:!1,useProp:null}}construct(e){const r=this;e&&(r.name=e.name,Object.assign(r,e)),r.compare&&(r.compareItems=(t,i)=>r.compare(t==null?void 0:t[r.name],i==null?void 0:i[r.name]))}defineAccessor(e,r){const{name:t,dataSource:i}=this;!r&&t in e&&e.$meta.hierarchy.some(n=>{var s;return((s=bP(n.prototype,t))==null?void 0:s.enumerable)===!1})||Reflect.defineProperty(e,t,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(t,i)}:function(){return this.batching&&t in this.meta.batchChanges?this.meta.batchChanges[t]:i in this.data?this.data[i]:this.data[t]},set(n){const s=this.$meta.fields.map[t];s&&s.readOnly||this.set(t,n)}})}isEqual(e,r){return T.isEqual(e,r)}print(e){return e==null?this.nullText:this.printValue(e)}printValue(e){return String(e)}};er._$name="DataField";var il=class extends er{isEqual(e,r){return e===r}getAt(e,r){return e.get(this.name)[r]}};E(il,"$name","ArrayDataField"),E(il,"type","array"),il.initClass(),il._$name="ArrayDataField";var Zf=class extends er{static get $name(){return"BooleanDataField"}static get type(){return"boolean"}static get alias(){return"bool"}static get prototypeProperties(){return{nullValue:!1}}isEqual(e,r){return e==null&&r==null?!0:super.isEqual(e,r)}convert(e){var r;return e==null?this.nullable?e:this.nullValue:((r=e.toLowerCase)==null?void 0:r.call(e))==="false"?!1:!!e}};Zf.initClass(),Zf._$name="BooleanDataField";var Jf=class extends er{static get $name(){return"DateDataField"}static get type(){return"date"}static get prototypeProperties(){return{format:null}}convert(e){return e==null?this.nullable||(e=this.nullValue):e==="now"?e=new Date:e instanceof Date||(e=b.parse(e,this.format||b.defaultParseFormat),(!e||isNaN(e))&&(e=void 0)),e}serialize(e){return e instanceof Date&&(e=b.format(e,this.format||b.defaultFormat)),e}printValue(e){return b.format(e,this.format||b.defaultFormat)}};Jf.initClass(),Jf._$name="DateDataField";var $d=class extends er{static get $name(){return"StringDataField"}static get type(){return"string"}static get prototypeProperties(){return{nullValue:""}}convert(e){return e==null?this.nullable?e:this.nullValue:String(e)}};$d.initClass(),$d._$name="StringDataField";var aD=class extends $d{static get $name(){return"DurationUnitDataField"}static get type(){return"durationunit"}isEqual(e,r){return b.compareUnits(e,r)===0}};aD.initClass(),aD._$name="DurationUnitDataField";var Qf=class extends er{static get $name(){return"IntegerDataField"}static get type(){return"integer"}static get alias(){return"int"}static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(e){return e==null?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}};Qf.initClass(),Qf._$name="IntegerDataField";var em=class extends er{static get $name(){return"ModelDataField"}static get type(){return"model"}static get prototypeProperties(){return{complexMapping:!0}}isEqual(e,r){return e&&r&&r instanceof e.constructor&&r.id==e.id}};em.initClass(),em._$name="ModelDataField";var tm=class extends er{static get $name(){return"NumberDataField"}static get type(){return"number"}static get alias(){return"float"}static get prototypeProperties(){return{nullValue:0,precision:null}}isEqual(e,r){return isNaN(Number(e))&&isNaN(Number(r))||super.isEqual(e,r)}convert(e){if(e==null)return this.nullable?e:this.nullValue;if(e=Number(e),isNaN(e))return;let r=this.precision;return r?(r=10**r,e=Math.round(e*r)/r):r===0&&(e=Math.round(e)),e}};tm.initClass(),tm._$name="NumberDataField";var rm=class extends er{static get $name(){return"ObjectDataField"}static get type(){return"object"}static get prototypeProperties(){return{complexMapping:!0}}};rm.initClass(),rm._$name="ObjectDataField";var nl=class extends er{init(e,r){var t;const i=this,n=`${i.name}Store`,s={skipStack:!0,syncDataOnLoad:!0};if(i.store&&T.assign(s,i.store),i.modelClass&&(s.modelClass=i.modelClass),(t=r[`init${O.capitalize(n)}`])==null||t.call(r,s),!s.storeClass&&!i.storeClass)throw new Error(`Field '${i.name}' with type 'store' must have a storeClass configured`);const a=r.meta[n]=new(s.storeClass||i.storeClass)(s);i.complexMapping?T.setPath(e,i.dataSource,a):e[i.dataSource]=a,a.verifyNoGeneratedIds=!1,a.usesId=!a.count||!a.every(o=>o.hasGeneratedId),a.$currentValue=i.getValue(a),a.ion({change:({action:o})=>{const l=i.getValue(a);if(!a.$isSettingStoreFieldData){const c=a.$preserveCurrentDataset;a.$preserveCurrentDataset=i.subStore&&(o==="update"||o==="remove"||o==="add"),i.$isUpdatingRecord=!0,r.set(i.name,l),i.$isUpdatingRecord=!1,a.$preserveCurrentDataset=c}a.$currentValue=l}})}set(e,r,t){var i,n;const s=this,a=`${s.name}Store`,{[a]:o}=t.meta;if(!o)return t.meta.initableValues.set(s,e),!1;o.$isSettingStoreFieldData||(o.$isSettingStoreFieldData=!0,e=(n=(i=t[`process${O.capitalize(a)}Data`])==null?void 0:i.call(t,e,t))!=null?n:e,o.$preserveCurrentDataset||(o.data=e),o.$isSettingStoreFieldData=!1,o.usesId=!o.count||!o.every(l=>l.hasGeneratedId))}serialize(e,r){const t=r.meta[`${this.name}Store`];return this.$isUpdatingRecord?this.getValue(t):t.$currentValue}getValue(e){return e.allRecords.map(r=>{const t=r.persistableData;return e.usesId||delete t.id,t})}isEqual(e,r){return e!=null&&e.isStore&&(e=e.$currentValue),r!=null&&r.isStore&&(r=r.$currentValue),T.isDeeplyEqual(e,r)}getOldValue(e){const r=e.meta[`${this.name}Store`];return r?T.clone(r.$currentValue):null}getAt(e,r){const t=e.meta[`${this.name}Store`];return t==null?void 0:t.getAt(r)}};E(nl,"$name","StoreDataField"),E(nl,"type","store"),nl.initClass(),nl._$name="StoreDataField";var oD=new RegExp(/^(.*?)\.(.*)/),lD=/(.*)\[(.*)]\.?(.*)/,{defineProperty:CP}=Reflect,{hasOwn:sl}=T,ei=void 0,SP={children:1,data:1,meta:1},DP=["name","title","text","label","description"],wP={boolean:1,number:1,date:1,object:1},cD={parentId:1,$PhantomId:2,id:3},im=class extends F.mixin(tD,rD,nD){static get $name(){return"Model"}static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0},{name:"orderedParentIndex",type:"number",persist:!1,internal:!0},{name:"readOnly",type:"boolean"},{name:"expanded",internal:!0}]}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){if(!this._childrenField){const e=this.fieldMap.children;this._childrenField=(e==null?void 0:e.dataSource)||"children"}return this._childrenField}get indexPath(){const e=[];let r=this,t=r.childLevel;for(r=this;r&&!r.isRoot;r=r.parent)e[t--]=r.parentIndex+1;return e}construct(e={},r=null,t=null,i=!1,n=!1,s=!1){var a,o;const l=this,c=(a=H.asArray(r))!=null?a:[],{constructor:d,fieldMap:u}=l;let h=null;if(r=c[0],l.meta={modified:{},...d.metaConfig,...t},d.applyConfigs)for(const g in l.getDefaultConfiguration())h||(h={},(!l.useRawData||!l.useRawData.enabled)&&(e={...e})),g in e&&(e[g]!==void 0&&(h[g]=e[g]),delete e[g]);if(super.construct(h),i||d.exposeProperties(e,s),!sl(d,"idFieldProcessed")){let g=l.meta.idField;g||(d._assignedIdField?g=d.idField:r&&(g=r.idField)),g&&g!==u.id.dataSource&&d.addField({name:"id",dataSource:g,internal:!0}),d._idField=u.id.dataSource,d.idFieldProcessed=!0}l._internalId=im._internalIdCounter++,l.stores=[],l.unjoinedStores=[],l.originalData||(l.originalData=e),l.data=d.processData(e,!1,r,l,n),(o=l.meta.initableValues)!=null&&o.size&&l.assignInitables(),l.id==null&&l.setData("id",l.generateId(r)),l.data[d.childrenField]&&l.processChildren(c),l.generation=0}set isCreating(e){const r=this;!!r.meta.isCreating!==e&&(r.meta.isCreating=e,r.stores.forEach(t=>{t.onIsCreatingToggle(r,e)}))}get isCreating(){return!!this.meta.isCreating}equals(e){if(e instanceof this.constructor){for(let r=this.$meta.fields.defs,t=0,{length:i}=r;t<i;t++){const n=r[t],{name:s}=n;if(s!=="id"&&!n.isEqual(this.getValue(s),e.getValue(s)))return!1}return!0}return!1}get subclass(){return new this.constructor(Object.setPrototypeOf({id:ei},this.data),this.stores[0],null,!0)}static processData(e,r=!1,t,i,n){const{fieldMap:s,defaultValues:a}=this,{useRawData:o={enabled:!1}}=t||{},l=n||o.enabled?e:T.clone(e);let c;if(r=r||o.disableDefaultValue||n,!r){for(c in a)if(l[c]===ei){let d=a[c];Array.isArray(d)&&(d=d.slice()),l[c]=d}}if(!o.disableTypeConversion&&!n)for(c in s){const d=s[c],{name:u,dataSource:h}=d,g=h!==u,f=d.complexMapping,m=g&&(f?T.pathExists(e,h):h in e),p=u in e&&(!g||!m),v=!o.disableTypeConversion&&d.convert;if((p||v)&&(!r||p||m)){const y=p?l[u]:f?T.getPath(l,h):l[h],C=v?d.convert(y,e,i):y;f?T.setPath(l,h,C):l[h]=C,g&&delete l[u]}}return this.$meta.fields.initable.length&&this.initInitables(i,l),l}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,r){var t,i,n,s,a;const o=sl(e,"fields")&&e.fields,l=r.super.fields,c=r.fields={defs:(t=l==null?void 0:l.defs.slice())!=null?t:[],exposedData:!1,defaults:l?{...l.defaults}:{},exposed:Object.create((i=l==null?void 0:l.exposed)!=null?i:null),ordinals:Object.create((n=l==null?void 0:l.ordinals)!=null?n:null),map:Object.create((s=l==null?void 0:l.map)!=null?s:null),sources:Object.create((a=l==null?void 0:l.sources)!=null?a:null)};sl(e,"defaults")&&Object.assign(c.defaults,e.defaults),sl(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),c.exposed[e.idField]=!0),o!=null&&o.length&&o.map(e.addField,e),c.initable=c.defs.filter(d=>d.init),e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get allFields(){return this.$meta.fields.defs}get allFields(){return this.$meta.fields.defs}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e,r=!0){const t=this,i=t.$meta.fields,n=r?"exposed":"map";if(e&&t.autoExposeFields&&!i.exposedData){let s,a,o;for(s in e)!i[n][s]&&s!==t.childrenField&&(o=T.typeOf(e[s]),a={name:s,dataSource:s,fromData:!0},wP[o]&&(a.type=o),t.addField(a));i.exposedData=!0}t.exposeRelations()}static addField(e){if(e==null)return;typeof e=="string"&&(e={name:e});const r=this.initClass(),t=r.$meta.fields,{ordinals:i}=t,n=t.exposed,{name:s}=e,a=t.map[s],o=e.dataSource||(e.dataSource=s);let l,c;if(!a||e.type&&e.type!==a.type)l=er.create(e),l.definedBy=a?a.definedBy:r,l.ordinal=a?a.ordinal:i[s]=t.defs.length;else{l=Object.create(a);for(c in e)c!=="type"&&(l[c]=e[c])}return l.owner=r,t.defs[l.ordinal]=l,t.map[s]=l,t.sources[o]||(t.sources[o]=l),o.includes(".")&&(l.complexMapping=!0),l.complexMapping?n[o.split(".")[0]]=!0:n[o]=!0,"defaultValue"in l&&(t.defaults[o]=l.defaultValue),SP[s]||l.defineAccessor(r.prototype),r._nonPersistableFields=null,r._alwaysWriteFields=null,l}static removeField(e){const r=this.initClass(),t=r.$meta.fields,i=t.map[e],{ordinals:n}=t,s=n[e];if(i){t.defs.splice(s,1),delete n[e],delete t.defaults[e],delete t.exposed[e],delete t.map[e],delete t.sources[i.dataSource];for(const a in n)n[a]>s&&--n[a];delete r.prototype[e]}}static exposeRelations(){const e=this;if(!sl(e,"exposedRelations")&&e.relations){e.exposedRelations=[];for(const r in e.relations){const t=e.relations[r];t.relationName=r,e.exposedRelations.push(t),Reflect.ownKeys(e.prototype).includes(r)||CP(e.prototype,r,{enumerable:!0,get:function(){return this.getForeign(r)},set:function(i){this.setForeign(r,i,t)}})}}}static initInitables(e,r){const t=e.meta.initableValues=new Map;for(const i of this.$meta.fields.initable){const n=T.getPath(r,i.dataSource);n!==void 0&&t.set(i,n),!i.lazy&&i.init(r,e)}}assignInitables(){const{initableValues:e}=this.meta;for(const[r,t]of e)r.set(t,this.data,this)!==!1&&e.delete(r)}static get autoExposeFields(){return!0}static fieldSorter(e,r){return(cD[e]||100)-(cD[r]||100)}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.$meta.fields.map[e]}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.$meta.fields.map[e]}static getFieldDataSource(e){var r;return((r=this.getFieldDefinition(e))==null?void 0:r.dataSource)||e}getDataSource(e){const r=this.constructor.getFieldDefinition(e);return(r==null?void 0:r.dataSource)||(r==null?void 0:r.name)}static processField(e,r,t){const i=this.fieldMap[e];return i!=null&&i.convert?i.convert(r,this.data,t):r}initRelations(){const e=this;e.constructor.exposedRelations&&e.stores.forEach(t=>{var i;t.modelRelations||t.initRelations();const n=[];(i=t.modelRelations)==null||i.forEach(s=>{n.push({related:e.initRelation(s),config:s})}),t.updateRecordRelationCache(e,n)})}initRelation(e){const r=this,t=r.get(e.foreignKey),i=t!==ei&&typeof e.foreignStore!="string"&&e.foreignStore.getById(t),n=r.meta.relationCache||(r.meta.relationCache={});return n[e.relationName]=i||(t!=null?{id:t,placeHolder:!0}:null),i}removeRelation(e){const{relationName:r,foreignKey:t,nullFieldOnRemove:i}=e;this.meta.relationCache[r]&&(delete this.meta.relationCache[r],i&&this.setData(t,null))}getForeign(e){var r;return(r=this.meta.relationCache)==null?void 0:r[e]}setForeign(e,r,t){const i=im.asId(r);return this.set(t.foreignKey,i)}getRelationConfig(e){var r,t;return(t=(r=this.firstStore)==null?void 0:r.modelRelations)==null?void 0:t.find(i=>i.foreignKey===e)}flatGet(e,r){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:r in this.data?this.data[r]:this.data[e]}complexGet(e,r){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:T.getPath(this.data,r)}get(e){if(!e)return;const r=this,t=r.fieldMap[e];if(!t){if(e.includes("[")){const[,i,n,s]=e.match(lD),a=r.fieldMap[i];if(a!=null&&a.getAt){r._thisIsAUsedExpression(r[i]);const o=a.getAt(r,n);return o&&s?o.isModel?o.getValue(s):o[s]:o}return null}if(e.includes("."))return T.hasPath(r.data,e)?r.complexGet(e,e):T.getPath(r,e)}return t!=null&&t.complexMapping?r.complexGet(e,t.dataSource):r.flatGet(e,(t==null?void 0:t.dataSource)||e)}getValue(e){if(e)return e in this?this[e]:this.get(e)}setValue(e,r){e in this?this[e]=r:this.set(e,r)}setData(e,r){var t,i;const{data:n,fieldMap:s}=this;if(typeof e=="string"){const a=s[e],o=(t=a==null?void 0:a.dataSource)!=null?t:e;a!=null&&a.set?a.set(r,this.data,this):a!=null&&a.complexMapping?T.setPath(n,o,r):n[o]=r}else{const a=Object.keys(e);for(let o=0;o<a.length;o++){const l=a[o],c=s[l],d=(i=c==null?void 0:c.dataSource)!=null?i:l;c!=null&&c.set?c.set(r,this.data,this):d&&(c!=null&&c.complexMapping?T.setPath(n,d,e[l]):n[d]=e[l])}}}getData(e){var r;const t=this.fieldMap[e],i=(r=t==null?void 0:t.dataSource)!=null?r:e;if(i)return t!=null&&t.complexMapping?T.getPath(this.data,i):this.data[i]}syncId(e){const r=this.id;if(r!==e){this.setData("id",e);const t={id:{value:e,oldValue:r}};this.afterChange(t,t)}}set(e,r,t=!1,i=!1,n=!1,s=!1,a=!0){var o;const l=this;if(l.isBatchUpdating)return l.inBatchSet(e,r,t||l.$silenceBatch),null;{const c=l.inSet(e,r,t,i,n,s,a);return(o=l.afterSet)==null||o.call(l,e,r,t,i,c),c}}fieldToKeys(e,r){return typeof e!="string"?T.assign({},e):{[e]:r}}inBatchSet(e,r,t){const i=this,{meta:n,constructor:s,fieldMap:a}=i,o={};let l,c=!1;if(typeof e!="string"?Object.keys(i.fieldToKeys(e,r)).forEach(d=>{l=a[d]||T,r=s.processField(d,e[d],i),l.isEqual(n.batchChanges[d],r)||(o[d]={value:r,oldValue:i.get(d)},n.batchChanges[d]=r,c=!0)}):(l=a[e]||T,l.isEqual(n.batchChanges[e],r)||(o[e]={value:r,oldValue:i.get(e)},n.batchChanges[e]=r,c=!0)),c&&(i.generation++,!t)){const d={action:"update",record:i,records:[i],changes:o};i.stores.forEach(u=>{u.trigger("batchedUpdate",{...d})}),i.forEachLinked((u,h)=>u.trigger("batchedUpdate",{...d,record:h,records:[h]}))}}inSet(e,r,t,i,n=!1,s=!1,a=!0){var o,l,c;const d=this,{data:u,meta:h,fieldMap:g,constructor:f}=d,{prototype:m,childrenField:p,relations:v}=f,y={},C=d.fieldToKeys(e,r),D=Object.keys(C).sort(f.fieldSorter);let S=!1;if(!t&&!d.triggerBeforeUpdate(C))return null;d.inSetting=!0;for(let x=0;x<D.length;x++){const R=D[x];if(R===p)continue;if(R.includes("[")){const[,le,Ce,Me]=R.match(lD),te=d.fieldMap[le];if(te!=null&&te.getAt){const Ie=te.getAt(d,Ce);Ie.isModel?Ie.set(Me,C[R]):T.setPath(Ie,Me,C[R]);continue}}const I=R.includes(".");if(v&&I){const[,le,Ce]=R.match(oD);if(v[le]){d[le].set(Ce,C[R]);continue}}const M=g[R],P=M||T,_=M==null?void 0:M.readOnly,A=(o=M==null?void 0:M.dataSource)!=null?o:R,z=!n&&!M&&R in m||(M==null?void 0:M.useProp),Y=z?d[A]:M!=null&&M.complexMapping||I?T.getPath(u,A):u[A],V=f.processField(R,C[R],d),U=C[R]={value:V},K=d.getRelationConfig(R);!_&&!P.isEqual(Y,V)&&(!s||V!==void 0)&&(d.generation++,U.oldValue=(c=(l=M==null?void 0:M.getOldValue)==null?void 0:l.call(M,d))!=null?c:Y,S=!0,R in h.modified&&P.isEqual(h.modified[R],V)?(Reflect.deleteProperty(h.modified,R),d.isReverting&&(d.data[A]=V)):d.ignoreBag||(R in h.modified||d.storeFieldChange(R,Y),U.oldValue===ei&&Reflect.deleteProperty(U,"oldValue")),y[R]=U,d.applyValue(z,A,V,n,M),K&&!i&&(d.initRelation(K),d.stores.forEach(le=>le.cacheRelatedRecord(d,V,K.relationName,U.oldValue))))}return S&&d.afterChange(C,y,t,i,n),d.inSetting=!1,S?y:null}applyValue(e,r,t,i,n){var s;const a=this;if(((n==null?void 0:n.name)||r)===a.constructor.parentIdField)(s=a.parent)!=null&&s.isRoot&&(t==null||!a.firstStore.getById(t))||(a.firstStore.getById(t)||a.firstStore.rootNode).insertChild(a,null,!1,{orderedParentIndex:{skip:!0}});else if(e)a[(n==null?void 0:n.name)||r]=t;else if(n!=null&&n.set)n.set(t,a.data,a);else{let o=n==null?void 0:n.complexMapping;if(!n&&r.includes(".")){const l=r.split(".")[0];n=a.constructor.fieldMap[l],o=(n==null?void 0:n.complexMapping)||(n==null?void 0:n.type)==="object"}o?T.setPath(a.data,r,t):a.data[r]=t}}afterChange(e,r,t,i,n){for(const s of this.stores)s.onModelChange(this,e,r,t,i,n);this.forEachLinked((s,a)=>s.onModelChange(a,e,r,t,i,n))}forEachLinked(e){for(const r of this.$links)for(const t of r.stores)e(t,r)}get isPersistable(){return!this.isBatchUpdating&&!this.isCreating}get isModified(){return!!(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!T.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&e in this.meta.modified}getFieldPersistentValue(e){const r=typeof e=="string"?this.getFieldDefinition(e):e,t=(r==null?void 0:r.name)||e;let i;return(!r||r.persist)&&(i=this.getValue(t),r!=null&&r.serialize&&(i=r.serialize(i,this))),i}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,r={};if(!e.isModified)return null;let t=!1;return Object.keys(e.meta.modified).forEach(i=>{const n=e.getFieldPersistentValue(i);n!==ei&&(r[i]=n,t=!0)}),t?r:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&T.setPath(e,this.constructor.idField,this.id),e}get rawModificationData(){const e=this,{fieldMap:r}=e.constructor,t={};if(!e.isModified)return null;let i=!1;return Object.keys(e.meta.modified).forEach(n=>{let s=r[n],a=s==null?void 0:s.dataSource;if(n.includes(".")){const o=n.match(oD)[1];s=r[o],a=n}if(s!=null&&s.persist){const o=e.getFieldPersistentValue(n);o!==ei&&(T.setPath(t,a,o),i=!0)}}),i?t:null}get modificationDataToWrite(){const e=this.constructor.alwaysWriteFields,r=this.modificationData;return e.forEach(t=>{r[this.getFieldDefinition(t).dataSource]=this.getFieldPersistentValue(t)}),r}get persistableData(){const e=this,r={};return e.fields.forEach(t=>{const i=e.getFieldPersistentValue(t);i!==ei&&(t!=null&&t.complexMapping?T.setPath(r,t.dataSource,i):r[t.dataSource]=i)}),r}get dataByFieldName(){const{data:e}=this;return this.fields.reduce((r,t)=>(T.hasPath(e,t.dataSource)&&(r[t.name]=e[t.dataSource]),r),{})}get isCommitting(){return!!this.meta.committing}clearChanges(e=!0,r=!0,t=null){const i=this,{meta:n}=i;if(t)for(const a in t)delete n.modified[a];else n.modified={};const s=T.isEmpty(n.modified);n.committing=!1,r&&i.stores.forEach(a=>{if(s&&a.modified.remove(i),a.added.remove(i),e){const o=a.collectDescendants(i).all;a.added.remove(o),s&&a.modified.remove(o)}})}storeFieldChange(e,r){this.meta.modified[e]=r}revertChanges(e=!1){this.isReverting=!0,this.set(this.meta.modified,ei,e),this.isReverting=!1}applyChangeset(e,r="$PhantomId",t=!0){var i;const n=this,s=n.constructor,{idField:a,fieldDataSourceMap:o}=s,l=T.pathifyKeys(e,o),c=T.pathifyKeys(n.modificationData),d={},u=r in e;for(const g in l){const f=o[g],m=(i=f==null?void 0:f.name)!=null?i:g;(t||((f==null?void 0:f.name)===a?u:l[g]===c[g]))&&(d[m]=l[g])}const h=n.set(d);return n.clearChanges(!1,!0,t?null:d),h?Object.entries(h).reduce((g,[f,m])=>(g[f]=m.value,g),{}):{}}get internalId(){return this._internalId}get isPhantom(){return this.id===""||this.id==null||this.hasGeneratedId}get isModel(){return!0}get hasGeneratedId(){return typeof this.id=="string"&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return`_generated${e}_${O.generateUUID()}`}generateId(){return this.constructor.generateId()}static asId(e){return e!=null&&e.isModel?e.id:T.isObject(e)?e[this.fieldMap.id.dataSource]:e}get json(){return O.safeJsonStringify(this)}toJSON(){const{children:e,unfilteredChildren:r}=this,t=this.persistableData;return(r||e)&&(t[this.constructor.childrenField]=(r||e).map(i=>i.toJSON())),t}toString(){const e=this,r=DP.find(i=>i in e.constructor.fieldMap),t=r?{[e.constructor.idField]:e.id,[r]:e[r]}:e.data;return O.safeJsonStringify(t)}get isBatchUpdating(){return!!this.batching}hasBatchedChange(e){var r,t;return(t=(r=this.meta)==null?void 0:r.batchChanges)==null?void 0:t[e]}beginBatch(e=!1){const r=this;r.batching||(r.batching=0,r.meta.batchChanges={}),e&&(r.$silenceBatch=(r.$silenceBatch||0)+1),r.batching++}endBatch(e=!1,r=!1,t=!0){const i=this,{parentIdField:n}=i.constructor;if(i.batching&&(i.batching--,i.$silenceBatch&&i.$silenceBatch--,!(i.batching>0)&&!T.isEmpty(i.meta.batchChanges))){let{batchChanges:s}=i.meta;i.meta.batchChanges=null,s[n]&&(s={...s},i.parentId=s[n],delete s[n]),i.set(s,ei,e,!1,r,void 0,t)}}cancelBatch(){if(this.batching){const e=this,{batchChanges:r}=e.meta,t={};if(e.batching=null,e.meta.batchChanges=null,e.generation++,!e.$silenceBatch){Object.entries(r).forEach(([n,s])=>{t[n]={oldValue:s,value:e[n]}});const i={action:"update",record:e,records:[e],changes:t};e.stores.forEach(n=>{n.trigger("batchedUpdate",{...i})}),e.forEachLinked((n,s)=>{n.trigger("batchedUpdate",{...i,record:s,records:[s]})})}e.$silenceBatch&&e.$silenceBatch--}}triggerBeforeUpdate(e){var r;return!((r=this.stores)!=null&&r.some(t=>t.trigger("beforeUpdate",{record:this,changes:e})===!1))}copy(e=null,r){const t=this,i=T.clone(t.data),n=t.constructor.idField,s=T.isObject(r)?r.deep:r;let a;if(e&&typeof e=="object"?(a=e[n],Object.assign(i,e)):a=e,s&&t.children?i.children=t.children.map(l=>l.copy(void 0,r)):(delete i.children,delete i.expanded),t.$meta.fields.initable.length>0){const l=t.toJSON();for(const c of t.$meta.fields.initable)i[c.name]=l[c.name]}e!==!1&&(i[n]=a||t.generateId(t.firstStore));const o=new t.constructor(i,null,null,!1,!0);return o.originalInternalId=t.internalId,o}copyData(e,r,t){const i={};e.allFields.forEach(({name:n})=>{n!==e.constructor.idField&&(i[n]=r?e.get(n):e.getValue(n))}),this.set(i,null,t)}remove(e=!1){const r=this,{parent:t}=this;t?t.removeChild(r):r.stores.length&&!r.isSpecialRow&&r.stores.forEach(i=>i.remove(r,e,!1,!0))}beforeRemove(e,r){return super.beforeRemove(e,r)}get isValid(){return!0}get firstStore(){return this.stores.length>0&&this.stores[0]}joinStore(e){var r;const t=this,{stores:i}=t;if(!i.includes(e)){const{unjoinedStores:n}=t;super.joinStore(e),e.register(t),i.push(e),n.includes(e)&&n.splice(n.indexOf(e),1),t.isLoaded&&t.children.forEach(s=>s.joinStore(e)),t.initRelations(),e.tree&&!t.isRoot&&!((r=e.stm)!=null&&r.isRestoring)&&(t.instanceMeta(e.id).collapsed=!t.expanded)}}unjoinStore(e,r=!1){var t,i,n;const s=this,{stores:a,unjoinedStores:o}=s;a.includes(e)&&(e.isDestroying||(e.unregister(s),o.push(e)),(i=(t=s.unfilteredChildren||s.children)==null?void 0:t.forEach)==null||i.call(t,l=>l.unjoinStore(e,r)),a.splice(a.indexOf(e),1),(n=super.unjoinStore)==null||n.call(this,e,r),e.uncacheRelatedRecord(s))}isPartOfStore(e){return e?e.includes(this):this.stores.length>0}get isRemoved(){return!this.isPartOfStore()}instanceMeta(e){const{meta:r}=this,t=e.id||e;return r.map||(r.map={}),r.map[t]||(r.map[t]={})}get isGroupHeader(){return"groupRowFor"in this.meta}get isGroupFooter(){return"groupFooterFor"in this.meta}get isSpecialRow(){var e;return!!((e=this.meta)!=null&&e.specialRow)}get $original(){return this.isLinked?this.proxyMeta.originalRecord:this}static get nonPersistableFields(){const e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach(r=>{(!r.persist||r.calculated)&&(e._nonPersistableFields[r.name]=1)})),e._nonPersistableFields}static get alwaysWriteFields(){const e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=[],e.allFields.forEach(r=>{r.alwaysWrite&&e._alwaysWriteFields.push(r.name)})),e._alwaysWriteFields}get domId(){return typeof this.id=="string"?this.id.replace(/[ .]/g,"-"):this.id}static toJavaScriptValue(e){const{names:r}=this.$meta,t=r[r.length-2],i=r[r.length-3];return`class ${t} extends ${i} { static fields = ${O.toJavaScriptValue(this.fields,e)}; }`}getCurrentConfig(e){const{data:r,children:t}=this,{defaultValues:i,applyConfigs:n}=this.constructor,s=n?super.getCurrentConfig(e):{};if(s){for(const a of this.fields)if(a.persist){const o=T.getPath(r,a.dataSource);a.isEqual(o,i[a.name])||T.setPath(s,a.dataSource,F.processConfigValue(o,e))}if(t)if(Array.isArray(t)){s.children=[];for(const a of t)s.children.push(a.getCurrentConfig(e))}else s.children=t;this.hasGeneratedId&&delete s.id,delete s.parentId,delete s.parentIndex}return s}},ce=im;E(ce,"relations",null),ce._idField="id",ce._internalIdCounter=1,ce._assignedIdField=!1,ce.exposeProperties(),ce._$name="Model";var _e=class{constructor(e,r){typeof e=="number"||e===null?(this._magnitude=e,this._unit=r):(typeof e=="string"&&Object.assign(this,b.parseDuration(e)),typeof e=="object"&&Object.assign(this,e))}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude=typeof e=="number"&&e}get unit(){return this._unit}set unit(e){this._unit=b.parseTimeUnit(e)}get isValid(){return this._magnitude!=null&&!!b.normalizeUnit(this._unit)}get milliseconds(){return this.isValid?Math.round(b.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return!!e&&this._magnitude!=null&&e._magnitude!=null&&this.milliseconds===e.milliseconds}toString(e){const r=this,t=e?"getShortNameOfUnit":"getLocalizedNameOfUnit";return r.isValid?`${r._magnitude} ${b[t](r._unit,r._magnitude!==1)}`:""}toJSON(){return this.toString()}valueOf(){return this.milliseconds}diff(e){return new _e({unit:this.unit,magnitude:b.as(this.unit,this.milliseconds-e.milliseconds)})}};_e._$name="Duration";var EP=(e,r)=>e==null?void 0:e[r],xP=/^is(this|next|last)(week|month|year)$/i,RP=["isToday","isTomorrow","isYesterday","isThisWeek","isNextWeek","isLastWeek","isThisMonth","isNextMonth","isLastMonth","isThisYear","isNextYear","isLastYear","isYearToDate"],jd=class extends F.mixin(ea){static get defaultConfig(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null,internal:null,disabled:!1}}static get configurable(){return{property:null}}construct(e){typeof e=="function"&&(e={filterBy:e}),e.type?e.type==="date"&&e.value!=null&&!Array.isArray(e.value)?e.value=new Date(e.value):e.type==="duration"&&e.value!=null&&!Array.isArray(e.value)&&(e.value=new _e(e.value)):b.isDate(e.value)||Array.isArray(e.value)&&e.value.every(b.isDate)?e.type="date":e.value instanceof _e&&(e.type="duration"),super.construct(e)}get id(){return this._id||(this.internal?this._id=jd.generateId(`b-internal-${this.property}-filter-`):this._id=this.property||jd.generateId("b-filter-")),this._id}set id(e){this._id=e}onChange(e){var r;const t=this;!t.isConfiguring&&((r=t.owner)!=null&&r.onFilterChanged)&&!t.owner.isConfiguring&&t.owner.onFilterChanged(t,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){const r=this;let t;return e.isModel?t=e.getValue(r.property):r._propertyItems.length>1?t=r._propertyItems.reduce(EP,e):t=e[r.property],r[r.operator](r.convert(t))}updateProperty(e){this._propertyItems=e.split("."),this.onChange("property")}set value(e){const r=this;r._value=e,Array.isArray(e)&&({date:1,duration:1}[r.type]||e.length>0&&typeof e[0]=="string")?r._filterValue=e.map(t=>r.convert(t)):!r.caseSensitive&&Array.isArray(e)&&e.length>0&&typeof e[0]=="string"?r._filterValue=e.map(t=>t==null?void 0:t.toLowerCase()):!r.caseSensitive&&typeof e=="string"?r._filterValue=e.toLowerCase():r._filterValue=r.convert(e),r.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){const e=this;return e._operator?e._operator:Array.isArray(e.filterValue)?"isIncludedIn":typeof e.filterValue=="string"?"*":"="}convert(e){var r;return this.operator!=="sameTime"&&!(typeof this.filterValue=="string"&&e instanceof Date)&&(this.operator==="sameDay"&&(e=b.clearTime(e)),e=(r=e==null?void 0:e.valueOf())!=null?r:e),e=!this.caseSensitive&&typeof e=="string"?e.toLowerCase():e,e}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}isIncludedIn(e){return this.filterValue.length===0||this.filterValue.includes(e)}isNotIncludedIn(e){return!this.isIncludedIn(e)}includes(e){return this.filterValue.length===0||String(e).includes(this.filterValue)}doesNotInclude(e){return!this.includes(e)}sameTime(e){return b.isSameTime(e,this.filterValue)}sameDay(e){return e===this.filterValue}"="(e){return T.isEqual(e,this.filterValue)}"!="(e){return!T.isEqual(e,this.filterValue)}">"(e){return T.isMoreThan(e,this.filterValue)}">="(e){return T.isMoreThan(e,this.filterValue)||T.isEqual(e,this.filterValue)}"<"(e){return T.isLessThan(e,this.filterValue)}"<="(e){return T.isLessThan(e,this.filterValue)||T.isEqual(e,this.filterValue)}"*"(e){return T.isPartial(e,this.filterValue)}between(e){const[r,t]=this._filterValue;return(T.isMoreThan(e,r)||T.isEqual(e,r))&&(T.isLessThan(e,t)||T.isEqual(e,t))}notBetween(e){return!this.between(e)}empty(e){return e==null||String(e).length===0}notEmpty(e){return!this.empty(e)}isToday(e){return this.between(e)}isTomorrow(e){return this.between(e)}isYesterday(e){return this.between(e)}isThisWeek(e){return this.between(e)}isNextWeek(e){return this.between(e)}isLastWeek(e){return this.between(e)}isThisMonth(e){return this.between(e)}isNextMonth(e){return this.between(e)}isLastMonth(e){return this.between(e)}isThisYear(e){return this.between(e)}isNextYear(e){return this.between(e)}isLastYear(e){return this.between(e)}isYearToDate(e){return this.between(e)}isTrue(e){return e===!0}isFalse(e){return e===!1}setRelativeDateValues(){this._filterValue=jd.getRelativeDateRange(this._operator).map(e=>e.valueOf())}static getRelativeDateRange(e,r=new Date){let t,i,n,s,a,o,l;switch(e){case"isYearToDate":return[b.floor(r,"1 year"),r];case"isToday":return t=b.floor(r,"1 day"),[t,b.add(t,1,"day")];case"isYesterday":return t=b.floor(r,"1 day"),[b.add(t,-1,"day"),t];case"isTomorrow":return i=b.getStartOfNextDay(r),[i,b.add(i,1,"day")];case"isThisWeek":case"isNextWeek":case"isLastWeek":case"isThisMonth":case"isNextMonth":case"isLastMonth":case"isThisYear":case"isNextYear":case"isLastYear":if(n=e.toLowerCase().match(xP),!n)throw new Error(`Unrecognized relative date expression: ${e}`);return[,o,l]=n,s=`1 ${l}`,a=b.floor(r,s),o==="next"?a=b.add(a,1,l):o==="last"&&(a=b.add(a,-1,l)),[a,b.add(a,1,l)]}}static generateFiltersFunction(e){if(!e||!e.length&&!e.count)return Te.returnTrue;for(const r of e)r.type==="date"&&RP.includes(r._operator)&&r.setRelativeDateValues();return function(r){let t=!0;for(const i of e)if(i.disabled||(t=i.filter(r)),!t)break;return t}}},dt=jd;E(dt,"$name","CollectionFilter"),dt._$name="CollectionFilter";var dD=T.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),ti=class{static generateId(e="generatedId"){return e+(dD[e]=(dD[e]||0)+1)}};ti._$name="IdHelper";var al=class extends F{static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){typeof e=="function"&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||ti.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,r){const t=this,{convert:i,property:n,useLocaleSort:s}=t,a=t.direction.toLowerCase()==="desc"?-1:1;if(e=e[n],r=r[n],i&&(e=i(e),r=i(r)),s&&e!=null&&r!=null&&typeof e=="string"){if(s===!0)return String(e).localeCompare(r);if(typeof s=="string")return String(e).localeCompare(r,s);if(typeof s=="object")return String(e).localeCompare(r,s.locale,s)}return(e>r?1:e<r?-1:0)*a}static generateSortFunction(e,r){const t=e.isCollection?e.values:e,i=t.length;return(n,s)=>{let a,o;for(o=0;o<i;++o)if(a=t[o].sortFn(n,s),a)return a;return r?r(n,s):0}}};al._$name="CollectionSorter";var TP=()=>0,MP=(e,r)=>r-e,nm=Symbol("filteredIndicesProperty"),ta=Object.freeze([]),IP=Object.freeze({action:"sort",added:ta,removed:ta,replaced:ta}),PP=Object.freeze({action:"filter",added:ta,removed:ta,replaced:ta}),xn={string:1,number:1};function uD(e,r,t){if(r.unique!==!1)r.set(t,e);else{let i=r.get(t);i||(i=new Set,r.set(t,i)),i.add(e)}}function AP(e,r,t){r.unique!==!1?r.delete(t):r.has(t)&&(r.get(t).delete(e),r.get(t).size||r.delete(t))}function hD(e,r,t,i){for(let n=0;n<e.length;n++){const s=e[n];for(let a=0;a<i;a++){const o=t[a],l=s[o],c=r[o];uD(s,c,l)}}}var $t=class extends F.mixin(Le){constructor(){super(...arguments),E(this,"_sortFunction",null),E(this,"_addedValues",null)}static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,autoSort:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const r=this;r._values.length=0,r.isFiltered&&(r._filteredValues.length=0,r.filters.destroy()),(e=r._sorters)==null||e.destroy()}clear(){const e=this,r=e._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:r}))}equals(e,r){if(e.isCollection&&(e=e.values),e.length===this.count){let{values:t}=this;return r&&(e=e.map(r),t=t.map(r)),H.delta(e,t).inBoth.length===this.count}return!1}replaceValues({values:e,filteredValues:r,silent:t=!1,isNewDataset:i=!1}){const n=this;let s,a;n.isFiltered&&!i?(!!r?e&&(s=n._values,n._values=e.slice()):(r=e.slice(),e=null),a=n._filteredValues,n._filteredValues=r.slice()):(s=n._values,n._values=e.slice(),r=null,n.isFiltered&&i&&n.autoFilter?(n._filterFunction=null,n._filteredValues=n._values.filter(n.filterFunction)):n._filteredValues&&(n._filteredValues.length=0)),n._indicesInvalid=!0,n._addedValues=void 0,n.generation++,t||n.trigger("change",{action:"replaceValues",replacedValues:s,replacedFilteredValues:a,values:e,filteredValues:r})}set values(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}get filteredValues(){return this._filteredValues}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,r=!1){(this.isFiltered&&!r?this._filteredValues:this._values).forEach(e)}map(e,r=!1){return(this.isFiltered&&!r?this._filteredValues:this._values).map(e)}find(e,r=!1){return(this.isFiltered&&!r?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}get addedValues(){return this._addedValues}match(e,r=!0){const t=this,{_values:i}=t,n=[];return t.forEach(s=>{const a=e.get(s.id,!0);if(a){const o=t.indexOf(s,!0),l=i[o];i[o]=a,t.removeFromIndices(l),t.addToIndices(a)}else r&&n.push(s)}),n.length&&t.remove(n),t.isFiltered&&(t._filteredValues=t._values.filter(t.filterFunction)),n}add(...e){e.length===1?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){e.length===1?this.splice(0,...e):this.splice(0,e)}move(e,r){for(e=H.asArray(e);e.length&&e[0]===r;)e.shift();if(!e.length)return;const t=this,{_values:i}=t,n=t.indexOf(e[0],!0);if(e.length===1&&i[n+1]===r)return;t.suspendEvents(),t.remove(e),t.resumeEvents();const s=r?t.indexOf(r,!0):i.length;if(s===-1)throw new Error("Collection move beforeItem parameter must be present in Collection");return i.splice(s,0,...e),t._indicesInvalid=1,t.trigger("change",{action:"move",items:e,from:n,to:s}),s}splice(e=0,r,...t){const i=this,n=i.idProperty,s=i._values,a={},o=[],l=[],c=i.totalCount;let d,u;if(i.trigger("beforeSplice",{index:e,toRemove:r,toAdd:t})!==!1){if(t)if(t.length===1&&Array.isArray(t[0])&&(t=t[0]),c&&t.length){const h=i.indices[n];d=[];for(let g=0;g<t.length;g++){const f=t[g],m=f[n],p=h.get(m),v=p?s.indexOf(p):-1;a[m]=!0,v!==-1?s[v]!==f&&(l.push([s[v],f]),s[v]=f):d.push(f)}}else d=t;if(r){if(typeof r=="number"){r=Math.min(r,s.length-e);for(let h=e;r;--r){const g=s[h][n];a[g]?(e++,h++):(o.push(s[h]),s.splice(h,1),u=!0)}}else{let h=d.length===0,g;r=H.asArray(r);const f=r.reduce((m,p)=>{const v=typeof p=="number",y=v?p:i.indexOf(p,!0);return h&&(g!=null&&y!==g+1||v)&&(h=!1),y>=0&&y<c&&m.push(y),g=y,m},[]).sort(MP);if(h)f.length&&(o.push.apply(o,r),s.splice(f[f.length-1],f.length),u=!0);else for(let m=0;m<f.length;m++){const p=f[m];if(p!==-1){const v=s[p][n];a[v]||(o.unshift(s[p]),s.splice(p,1),u=!0)}}}o.length&&!i._indicesInvalid&&o.forEach(i.removeFromIndices,i)}if(d.length){s.splice(Math.min(e,s.length),0,...d),u=!0,i._indicesInvalid||d.forEach(i.addToIndices,i),i._addedValues||(i._addedValues=new Set);for(const h of d)i._addedValues.add(h)}if(o.length&&i._addedValues)for(const h of o)i._addedValues.delete(h);l.length&&!i._indicesInvalid&&l.forEach(h=>{i.removeFromIndices(h[0]),i.addToIndices(h[1])}),u||l.length?(i.isSorted?i.onSortersChanged():i.isFiltered&&(i.autoFilter?i.onFiltersChanged({action:"splice",oldCount:1}):i._filteredValues.splice(Math.min(e,i._filteredValues.length),0,...d)),i.generation++,i.trigger("change",{action:"splice",removed:o,added:d,replaced:l,oldCount:c})):i.trigger("noChange",{index:e,toRemove:r,toAdd:t})}}changeId(e,r){const t=this,{idProperty:i}=t,n=xn[typeof e]?e:e[i],s=t.get(n);if(s){const a=t.get(r);if(a&&s!==a)throw new Error(`Attempt to set item ${n} to already existing member's id ${r}`);t.removeIndexEntry(e,i,n),t.addIndexEntry(e,i,r),s[i]=r}}get(e,r=!1){return this.getBy(this.idProperty,e,r)}getAt(e,r=!1){return this.isFiltered&&!r?this._filteredValues[e]:this._values[e]}getBy(e,r,t=!1){return this.findItem(e,r,this.isFiltered&&t)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new $t({values:H.asArray(e),internalListeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const r=e instanceof al?e:new al(e);return this.sorters.add(r),r}get isSorted(){var e;return!!((e=this._sorters)!=null&&e.count)}onSortersChanged(){const e=this;e._sortFunction=null,e._addedValues=null,e._values.sort(e.sortFunction),e.trigger("change",IP)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=al.generateSortFunction(this.sorters.values):this._sortFunction=TP),this._sortFunction}get filters(){return this._filters||(this._filters=new $t({internalListeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const r=e instanceof dt?e:new dt(e);return this.filters.add(r),r}removeFilter(e){const{filters:r}=this;e.isCollectionFilter||(e=r.get(e)),r.remove(e)}clearFilters(){this.filters.clear()}get isFiltered(){return!!(this._filters&&this._filters.count)}onFiltersChanged({action:e,removed:r,oldCount:t}){const i=this,n=t||e==="clear"&&r.length?i._filteredValues:i._values;i._filterFunction=null,i._filteredValues=i._values.filter(i.filterFunction),i._indicesInvalid=!0;const{toAdd:s,toRemove:a}=H.delta(i._filteredValues,n,!0);i.trigger("change",{...PP,added:s,removed:a})}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=dt.generateFiltersFunction(this.filters.values):this._filterFunction=Te.returnTrue),this._filterFunction}changeExtraKeys(e){return H.asArray(e).map(t=>typeof t=="string"?{property:t,unique:!0}:t)}updateExtraKeys(e){for(let r=0;r<e.length;r++)this.addIndex(e[r])}addIndex(e){const r=this;e&&((r._indices||(r._indices={}))[e.property]=new Map,Object.assign(r._indices[e.property],e),r.invalidateIndices(),e.dependentOn&&(r.hasCompositeIndex=!0))}findIndex(e,r,t=!1){const i=this.findItem(e,r,t);return i?(this.isFiltered&&!t?this._filteredValues:this._values).indexOf(i):-1}findItem(e,r,t=!1){var i;const n=this,{isFiltered:s}=n,a=s&&!t?n.indices[nm][e]:n.indices[e];if(a){const o=(i=a.get(r))!=null?i:typeof r=="string"&&r.length&&!isNaN(r)&&a.get(Number(r))||null;if(o!=null)return o}else{const o=s&&!t?n._filteredValues:n._values,l=o.length;for(let c=0;c<l;c++){const d=o[c];if(d[e]==r)return d}}return null}removeIndex(e){delete this._indices[e],this.hasCompositeIndex=Object.values(this.indices).some(r=>r.dependentOn)}indexOf(e,r=!1){return this.findIndex(this.idProperty,xn[typeof e]?e:e[this.idProperty],r)}includes(e,r=!1){return Array.isArray(e)?e.some(t=>this.includes(t)):!!this.findItem(this.idProperty,xn[typeof e]?e:e[this.idProperty],r)}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}invalidateIndices(){this._indicesInvalid=!0}rebuildIndices(){const e=this,r=e.isFiltered,t=e._indices||(e._indices={}),i=Object.keys(t),n=i.length,s=e._values;let a;r&&(a=t[nm]={});for(let o=0;o<n;o++){const l=t[i[o]];if(l.clear(),r){let c=a[i[o]];c?c.clear():(c=a[i[o]]=new Map,c.unique=l.unique)}}hD(s,t,i,n),r&&hD(e._filteredValues,a,i,n),e._indicesInvalid=!1}getIndices(e){const r=[this.indices[e]];return this.isFiltered&&r.push(this.indices[nm][e]),r}addToIndices(e){Object.keys(this.indices).forEach(r=>{this.addIndexEntry(e,r,e[r])})}removeFromIndices(e){Object.keys(this.indices).forEach(r=>{this.removeIndexEntry(e,r,e[r])})}removeIndexEntry(e,r,t){this.getIndices(r).forEach(i=>AP(e,i,t))}addIndexEntry(e,r,t){this.getIndices(r).forEach(i=>uD(e,i,t))}onItemMutation(e,r){const t=this;!t._indicesInvalid&&Object.keys(t.indices).length>1&&Object.keys(r).forEach(i=>{var n;if(t.indices[i]){const{value:a,oldValue:o}=r[i];t.removeIndexEntry(e,i,o),t.addIndexEntry(e,i,a)}if(t.hasCompositeIndex){const a=Object.values(t.indices).find(o=>{var l;return(l=o.dependentOn)==null?void 0:l[i]});if(a){const o={};for(const c in a.dependentOn)o[c]=((n=r[c])==null?void 0:n.oldValue)||e[c];const l=e.buildIndexKey(o);t.removeIndexEntry(e,a.property,l),t.addIndexEntry(e,a.property,e[a.property])}}})}};$t._$name="Collection";var gD=new WeakMap,ol=e=>{if(e&&typeof e=="object"){let r=gD.get(e);r===void 0&&(r=Symbol("bscik"),gD.set(e,r)),e=r}return e},ll=class{constructor(e){const r=this;r.generation=0,r.items=new Set,r.idMap={},r.idProperty="id",e&&(e.idProperty&&(r.idProperty=e.idProperty),e.values&&(r.values=e.values))}get(e){return this.idMap[ol(e)]}get count(){return this.items.size}add(...e){e.length===1&&Array.isArray(e[0])&&(e=e[0]);const r=this,{items:t,idMap:i,idProperty:n}=r,s=e.length;for(let a=0;a<s;a++){const o=e[a],l=xn[typeof o]?o:ol(o[n]),c=i[l];c==null?(i[l]=o,t.add(o),r.generation++):c!==o&&(i[l]=o,t.delete(c),t.add(o))}}at(e){let r,t;e<0&&(e+=this.count);for(r of this.items)if(!e--){t=r;break}return t}remove(e){e=H.asArray(e);const{items:r,idMap:t,idProperty:i}=this,n=e.length;for(let s=0;s<n;s++){const a=e[s],o=xn[typeof a]?a:ol(a[i]),l=t[o];l!=null&&(r.delete(l),delete t[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}countOf(e){let r=0,t;for(t of this.items)e(t)&&++r;return r}changeId(e,r){const t=this,{idMap:i,idProperty:n}=t,s=xn[typeof e]?e:ol(e[n]),a=t.get(s);if(a){const o=t.get(r);if(o&&a!==o)throw new Error(`Attempt to set item ${s} to already existing member's id ${r}`);a[n]=r,delete i[s],i[r]=a}}filter(e,r){const{items:t}=this,i=[];let n=0;return t.forEach(s=>{e.call(r,s,n++,t)&&i.push(s)}),i}includes(e){const r=xn[typeof e]?e:ol(e[this.idProperty]);return!!this.idMap[r]}map(e,r){const{items:t}=this,i=new Array(t.size);let n=0;return t.forEach(s=>{i[n]=e.call(r,s,n++,t)}),i}forEach(e,r){return this.items.forEach(e,r)}find(e,r=0){let t,i;r<0&&(r+=this.countOf(e));for(t of this.items)if(e(t)&&!r--){i=t;break}return i}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e,r){let t=-1,i;for(i of this.items)if((!r||r(i))&&(++t,i===e))return t;return-1}get values(){return[...this.items]}set values(e){e=H.asArray(e),this.clear(),this.add.apply(this,e),this.generation++}sort(e){this.values=this.values.sort(e)}some(e,r){return this.values.some(e,r)}};ll._$name="Bag";var Bd=class extends ll{add(...e){return e.length===1&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter(r=>r.isPersistable))}};Bd._$name="StoreBag";var fD=e=>class extends(e||F){static get $name(){return"StoreCRUD"}static get defaultConfig(){return{autoCommit:!1}}static get properties(){return{isRemoving:!1,suspendCount:0}}remove(t,i=!1){const n=this,{storage:s}=n;if(t=H.asArray(t).reduce((a,o)=>(o=n.getById(o),o&&a.push(o),a),[]),t.length===0)return t;if(!n.tree&&!i&&n.trigger("beforeRemove",{records:t})===!1)return[];if(n.isRemoving=!0,n.isGrouped){const a=s.count,o=[],l=new Set;for(const c of t){const{groupParent:d}=c.instanceMeta(n);d.meta.collapsed&&o.push(c),H.remove(d.groupChildren,c),H.remove(d.unfilteredGroupChildren,c),d.meta.childCount--,l.add(d)}for(const c of l)c.groupChildren.length>0&&n.onModelChange(c,{},{});o.length&&s.trigger("change",{action:"splice",removed:o,added:[],replaced:[],oldCount:a})}else if(n.tree){const a=[],o=t.length>1,l=t[0],c=o?void 0:s.indexOf(l),d=t.reduce((h,g)=>{const{parent:f}=g;return f&&(h[f.id]||(h[f.id]=[f,[]]),h[f.id][1].push(g)),h},{}),u=Array.from(Object.values(d));if(!i&&n.trigger("beforeRemove",{records:t,isMove:!1,parent:o?void 0:l.parent})===!1)return n.isRemoving=!1,[];u.sort((h,g)=>g[0].childLevel-h[0].childLevel);for(const[h,g]of u)a.push(...h.removeChild(g,!1,!0));return i||(n.trigger("remove",{parent:o?void 0:l.parent,index:c,isChild:!0,allRecords:a,isMove:!1,records:t}),n.trigger("change",{action:"remove",records:t})),n.isRemoving=!1,t}if(t.length===0)return n.isRemoving=!1,t;for(const a of t)a.beforeRemove(t);return i&&n.suspendEvents(),s.remove(t),i&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),n.isRemoving=!1,t}clear(t=!1){var i,n;const s=this,{storage:a}=s;if(s.storage.totalCount||(n=(i=s.rootNode)==null?void 0:i.unfilteredChildren)!=null&&n.length){if(!t&&s.trigger("beforeRemove",{records:a.allValues,removingAll:!0})===!1)return null;if(s.rootNode)s.isChained||s.rootNode.clearChildren(t);else if(t){const o=s.registeredRecords;for(let l=o.length-1,c;l>=0;l--)c=o[l],c&&!c.isDestroyed&&c.unjoinStore(s)}t&&(s.removed.clear(),a.suspendEvents()),a.clear(),t&&a.resumeEvents(),s.added.clear(),s.modified.clear()}}removeAll(t=!1){const i=this,n=i.storage;let s;if(i.isRemoving=!0,t){n.suspendEvents();const a=i.registeredRecords;for(let o=a.length-1,l;o>=0;o--)l=a[o],l&&!l.isDestroyed&&!l.isRoot&&l.unjoinStore(i)}return i.tree?s=i.rootNode.clear()!==!1:s=i.clear()!==null,t&&n.resumeEvents(),i.isRemoving=!1,s}add(t,i=!1,n={}){const s=this,{storage:a}=s;if(t=H.asArray(t),!(t!=null&&t.length))return;if(s.tree=s.tree||!!(s.autoTree&&t[0].children),s.tree){const l=new Map,c=s.modelClass.getFieldDataSource("parentIndex"),{parentIdField:d}=s.modelClass,u=[];return t.forEach(h=>{const g=h[d];l.has(g)||l.set(g,{append:[],insert:[]});const f=l.get(g);!h.isModel&&c in h?f.insert.push(h):f.append.push(h)}),l.forEach(({append:h,insert:g},f)=>{const m=f==null?s.rootNode:s.getById(f);if(!m)throw new Error(`Parent node with id ${f} not found, cannot add children.`);if(h.length&&u.push(...m.appendChild(h,i)),g.length)for(const p of g)u.push(m.insertChild(p,p[c],i,n))}),s.isFiltered&&s.reapplyFilterOnAdd&&s.filter({silent:!0}),s.reapplySortersOnAdd&&!s.isSyncingDataOnLoad&&s.sort(),u}if(!i&&s.trigger("beforeAdd",{records:t})===!1)return null;if(s.tree=s.tree||!!(s.autoTree&&t[0].children),s.tree)return s.rootNode.appendChild(t);const o=s.processRecords(t);return i&&s.suspendEvents(),a.add(o),i&&s.resumeEvents(),s.autoCommit&&s.doAutoCommit(),o}processRecords(t,i){return t.map(n=>{const s=this.processRecord(n.isModel?n:this.createRecord(n));return i==null||i.call(this,s),s})}insert(t,i,n=!1){var s;const a=this,o=a.storage,l=a.getAt(t),c=o.values,d=[];if(i=H.asArray(i),a.tree){const m=a.rootNode;return m.insertChild(i,(s=m.children)==null?void 0:s[t],n)}if(!n&&a.trigger("beforeAdd",{records:i})===!1)return null;let u,h,g;if(c[h=t]===i[0]||c[h=t-1]===i[0])for(u=!0,g=0;u&&g<i.length;g++)i[g]!==c[h+g]&&(u=!1);if(u)return null;const f=a.processRecords(i,m=>{const p=o.indexOf(m);m.children&&m.children.length&&a.autoTree&&(a.tree=!0),p>-1&&(p<t&&l&&t--,d.push(p)),m.meta.previousIndex=p});return a.suspendEvents(),a.storage.remove(d),a.resumeEvents(),n&&a.suspendEvents(),o.splice(t,0,...f),n&&a.resumeEvents(),a.autoCommit&&a.doAutoCommit(),f}move(t,i){this.isTree?i.parent.insertChild(t,i):this.storage.move(t,i)}setMultiple(t,i,n){const s=this,a=[],o=[];s.forEach(l=>{t(l)&&(o.push(l.set(i,n,!0)),a.push(l))}),s.trigger("updateMultiple",{records:a,all:s.records.length===a.length}),s.trigger("change",{action:"updatemultiple",records:a,all:s.records.length===a.length}),s.reapplyFilterOnUpdate&&s.isFiltered&&s.filter()}setAll(t,i){const n=this,s=[];n.forEach(a=>{s.push(a.set(t,i,!0))}),n.trigger("updateMultiple",{records:n.records,all:!0}),n.trigger("change",{action:"updatemultiple",records:n.records,all:!0}),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}acceptChanges(){const t=this;t.added.forEach(i=>i.clearChanges(!0,!1)),t.modified.forEach(i=>i.clearChanges(!0,!1)),t.added.clear(),t.modified.clear(),t.removed.clear()}commit(t=!1){const{changes:i}=this;return!t&&this.trigger("beforeCommit",{changes:i})===!1?!1:(this.acceptChanges(),t||this.trigger("commit",{changes:i}),i)}revertChanges(){const t=this,{changes:i}=t;if(i){const n={action:"clearchanges",changes:i};t.add(t.removed.values,!0),t.remove(t.added.values,!0),t.modified.forEach(s=>s.revertChanges(!0)),t.added.clear(),t.modified.clear(),t.removed.clear(),t.trigger("change",n),t.trigger("refresh",n)}}get changes(){const t=this,i=t.modified.values.filter(n=>n.rawModifications);return t.added.count||i.length||t.removed.count?{added:t.added.values.slice(),modified:i,removed:t.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(t){this._autoCommit=t,t&&this.changes&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(t=!0){this.suspendCount--,this.autoCommit&&t&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}},mD=e=>class extends(e||F){static get $name(){return"StoreChanges"}static get configurable(){return{applyChangesetFilterSortTarget:"changes"}}applyChangesFromStore(t){const i=this,{changes:n}=t;n&&(n.added&&i.add(n.added),n.removed&&i.remove(n.removed.map(s=>s.id)),n.modified&&n.modified.forEach(s=>{const a=i.getById(s.id);a==null||a.set(s.modifications)}))}applyChangeset(t,i=null,n="$PhantomId",s=!0,a=!1){var o,l,c,d;const u=this,{added:h,updated:g,modified:f,removed:m}=(o=i==null?void 0:i(t,u))!=null?o:t,p=(l=g!=null?g:f)!=null?l:[],v=u.modelClass.getFieldDataSource("id"),y=a?new Map:null,C=[],D=[];let S=!1,x=[];if(u._groupVisibleRecordIds=[],u.isGrouped&&u.forEach(R=>{u._groupVisibleRecordIds.push(R.id)}),(h==null?void 0:h.length)>0){const R=[],I=[];for(const P of h)u.getById((c=P[n])!=null?c:T.getPath(P,v))?R.push(P):I.push(P);p.unshift.apply(p,R);const M=(d=u.add(I,!1,{orderedParentIndex:{skip:!0}}))!=null?d:[];if(C.push(...M),u.tree)for(const P of M){const{parent:_}=P;if(_.isRoot){S=!0,x=[_];break}!_.isRoot&&x.every(A=>!A.contains(_))&&x.push(_)}for(const P of M)y==null||y.set(P.id,P.data),P.clearChanges()}if((p==null?void 0:p.length)>0)for(const R of p){const I=R[n],M=T.getPath(R,v),P=u.getById(I!=null?I:M);if(P){const _=P.applyChangeset(R,n,s);u.tree&&!S&&x.every(A=>!A.contains(P))&&(P.parent.isRoot?(S=!0,x=[P.parent]):x.push(P.parent)),y==null||y.set(M,_),D.push(P)}}if((m==null?void 0:m.length)>0&&u.applyRemovals(m),u.applyChangesetFilterSortTarget==="changes"){const R=u.filterChangeset(C,D);x.push(...R)}return u.afterChangesetApplied(x),u._groupVisibleRecordIds=null,y}afterChangesetApplied(t){t.forEach(i=>{i.traverse(n=>{n.sortOrderedChildren(!1,!1),n.children&&n.updateChildrenIndices(n.children,"parentIndex",!0),n.unfilteredChildren&&n.updateChildrenIndices(n.unfilteredChildren,"unfilteredIndex",!0)})})}applyRemovals(t){const i=this,{removed:n}=i,s=i.modelClass.idField,a=[];for(const o of t){const l=T.getPath(o,s);n.includes(l)?n.remove(l):a.push(l)}i.remove(a);for(const o of a)n.remove(o)}filterChangeset(t,i){const n=this,{isFiltered:s,tree:a,isGrouped:o,filtersFunction:l}=n,c=n.isSorted?n.createSorterFn(n.sorters):void 0,{allValues:d,addedValues:u,isSorted:h}=n.storage,g=c!=null||h?c!=null?c:n.storage.sortFunction:null,f=new Set;if(!s)return[];let m=!1,p;if(o&&(p=n.groupers,n.clearGroupers(!0)),a){const y=new Set(i.filter(l));for(const D of t.filter(l))y.add(D);y.forEach(D=>D.bubble(S=>y.add(S))),y.delete(n.rootNode);const C=H.groupBy(Array.from(y),"parentId");for(const D of Object.values(C)){const{parent:S}=D[0];S.unfilteredChildren&&(S.children.push(...D.filter(x=>!S.children.includes(x))),f.add(S))}}else if(g&&!o){const{filteredValues:y}=n.storage,C=u?y.findLastIndex(x=>!u.has(x))+1:y.length,D=y.slice(0,C),S=new Set(i.filter(l));for(const x of y)S.has(x)&&S.delete(x);for(const x of S)D.push(x);D.sort(g),y.splice(0,C,...D),m=!0}else{const y=i.filter(C=>l(C)&&!n.storage.includes(C));y.length>0&&(n.includeInSubset(d,n.storage.filteredValues,y),m=!0)}const v=new Set(t.filter(y=>!l(y)));if(v.size>0){if(a)for(const y of v)H.remove(y.parent.children,y),f.add(y.parent);else H.remove(n.storage.filteredValues,v);m=!0}return p&&(n.group(p[0],null,!1,!0,!0),m=!0),a&&f.size>0?n.storage.replaceValues({values:n.collectDescendants(n.rootNode).visible,silent:!0}):m&&(n._idMap=null,n.trigger("refresh")),[...f]}includeInSubset(t,i,n){const s=new Set(n);let a=0,o=0,l=s.size===0;for(;o<t.length&&!l;){const c=i[a];let d=t[o];for(;c!==d;)s.has(d)&&(i.splice(a,0,d),a++,s.delete(d),l=s.size===0),d=t[++o];s.has(c)&&s.delete(c),a<i.length&&a++}return i}},pD=e=>class extends(e||F){static get $name(){return"StoreFilter"}static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set reapplyFilterOnAdd(t){this.storage.autoFilter=t}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(t){const i=this,n=i.filters;if(n.clear(),i._filtersFunction=null,t){if(t.constructor.name==="Object")for(const s of Object.entries(t))s[0]==="filterBy"&&typeof s[1]=="function"?n.add(new dt({filterBy:s[1]})):n.add(new dt(s[1].constructor.name==="Object"?Object.assign({property:s[0]},s[1]):{property:s[0],value:s[1]}));else Array.isArray(t)?n.add(...t.map(s=>s instanceof dt?s:new dt(s))):t.isCollection?n.add(...t.values):n.add(new dt({filterBy:t}));n.forEach(s=>s.owner=i)}}get filters(){return this._filters||(this._filters=new $t({extraKeys:["property"]}))}set filtersFunction(t){this._filtersFunction=t}get filtersFunction(){const t=this,{filters:i,isGrouped:n}=t;if(!t._filtersFunction)if(i.count){const s=dt.generateFiltersFunction(i);t._filtersFunction=a=>n&&a.isSpecialRow?a.groupChildren.some(s):s(a)}else t._filtersFunction=Te.returnTrue;return t._filtersFunction}get isFiltered(){return this.filters.values.some(t=>!t.disabled)}traverseFilter(t){const i=this,n=!t.isRoot&&i.filtersFunction(t),s=t.unfilteredChildren||t.children;return!s||!s.length?n:(t.unfilteredChildren||(t.unfilteredChildren=t.children.slice()),t.children=t.unfilteredChildren.filter(a=>i.traverseFilter(a)),t.updateChildrenIndices(t.unfilteredChildren,"unfilteredIndex",!0),t.updateChildrenIndices(t.children,"parentIndex",!0),n||!!t.children.length)}traverseClearFilter(t){const i=this;t.unfilteredChildren&&(t.children=t.orderedChildren.slice(),t.unfilteredChildren=null),t.children&&(t.children.forEach(n=>i.traverseClearFilter(n)),t.updateChildrenIndices(t.children,"parentIndex",!0))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(t,i=!1){const n=this;if(t=t instanceof dt?t:new dt(t),t.owner=n,n.filters.add(t),!i){if(n.remoteFilter)return n.filter().then(()=>t);n.filter()}return t}filter(t){const i=this;let n=!1,s;if(t){let o=typeof t;if(o==="object"&&("silent"in t||"replace"in t||t.filters)&&(n=t.silent,t.replace&&i.clearFilters(t.filters.length===0),s=t.internal,t=t.filters,o=typeof t),t){const l=i.isFiltered;if(i.isConfiguring=!0,Array.isArray(t))t.forEach(c=>i.addFilter(c,!0),i);else if(o==="function"){const c=new dt(t);c.internal=s,i.addFilter(c,!0)}else o==="string"?i.addFilter({property:t,value:arguments[1]},!0):i.addFilter(t,!0);if(i.isConfiguring=!1,!i.isFiltered&&!l)return null}}i.filtersFunction=null;const a=i.performFilter(n);return i._idMap=null,a}performFilter(t){const i=this,{storage:n,filters:s,rootNode:a}=i,o=i.count;i.trigger("beforeFilter",{filters:s});let l,c;if(i.tree){const d=n.values;i.isFiltered?i.traverseFilter(a):i.traverseClearFilter(a);const u=i.collectDescendants(a).visible;n.replaceValues({values:u,silent:!0});const h=H.delta(u,d,!0);l=h.toAdd,c=h.toRemove}else n.ion({change({removed:d,added:u}){c=d,l=u},once:!0}),i.isFiltered?(i.isGrouped&&i.includeCollapsed(),n.addFilter({id:"primary-filter",filterBy:i.filtersFunction}),i.isGrouped&&i.excludeCollapsed()):n.filters.clear();i.afterPerformFilter(t||i.isRemoteDataLoading?null:{action:"filter",filters:s,oldCount:o,added:l,removed:c,records:i.storage.values})}afterPerformFilter(t){this.resetRelationCache(),t&&this.triggerFilterEvent(t)}triggerFilterEvent(t){this.trigger("filter",t),this.remoteFilter||(this.trigger("refresh",t),this.trigger("change",t))}filterBy(t){return this.filter(t)}removeFilter(t,i=!1){const n=this,s=t instanceof dt?t:n.filters.get(t);if(s){if(n.filters.remove(s),n._filtersFunction=null,!i){if(n.remoteFilter)return n.filter().then(()=>s);n.filter()}return s}}clearFilters(t=!0){if(this.filters.remove(this.filters.values.filter(i=>!i.internal)),t)return this.filter()}convertFilterToString(t){const i=this.filters.getBy("property",t);return i&&!i.filterBy?String(i):""}doDestroy(){var t;(t=this._filters)==null||t.destroy(),super.doDestroy()}},_P={add:1,replace:1},vD=e=>{var r;return r=class extends(e||F){static get properties(){return{collapsedGroups:new Set}}construct(t){super.construct(t),this.ion({change:"onDataChanged",thisObj:this})}updateGroupers(t){this.setGroupers(t)}setGroupers(t,i=null){const n=this,{storage:s}=n;let a;return t!=null&&t.length?n._groupers=t:n.groupers&&(delete n._groupers,n.includeCollapsed(),s.replaceValues({values:n.removeHeadersAndFooters(s._values),filteredValues:s.isFiltered?n.removeHeadersAndFooters(s._filteredValues):null,silent:!0}),a=n.group(null,null,null,!1,i==null?void 0:i.silent)),n._idMap=null,a}get groupRecords(){const t=[];if(this.isGrouped)for(const i of this)i.isSpecialRow&&t.push(i);return t}get unfilteredGroupRecords(){var t;const i=this;if(i.isGrouped){const{generation:n}=i.storage;((t=i._unfilteredGroupRecords)==null?void 0:t.generation)!==n&&(i._unfilteredGroupRecords=i.storage.allValues.filter(s=>s.isSpecialRow),i._unfilteredGroupRecords.generation=n)}return i._unfilteredGroupRecords||[]}getGroupHeaderForRecord(t,i=!1){if(this.isGrouped){let n;const s=i?this.storage._values:this.storage.values;for(const a of s)if(a.isGroupHeader){if(!t)n=a;else if(a===t||a.unfilteredGroupChildren.includes(t)){n=a;break}}return n}}includeCollapsed(){for(const t of this.collapsedGroups)this.expand(this.getById(t),!1)}excludeCollapsed(){for(const t of this.collapsedGroups)this.collapse(this.getById(t))}onDataChange({source:t,action:i,removed:n}){var s;const a=this,{groupers:o}=a;o&&(o.length?(i==="splice"&&(n!=null&&n.length)||i==="move")&&t.replaceValues({...a.prepareGroupRecords(),silent:!0}):t.replaceValues({values:a.removeHeadersAndFooters(t._values),filteredValues:t.isFiltered?a.removeHeadersAndFooters(t._filteredValues):null,silent:!0})),(s=super.onDataChange)==null||s.call(this,...arguments)}move(t,i){const n=this;if(n.isGrouped&&!n.tree){let s=i;if(i!=null&&i.isSpecialRow&&(s=n.getPrev(i,!1,!1),!s))return;const a=n.getGroupHeaderForRecord(s),o=n.groupers[0].field,l=a.meta.groupRowFor,{reapplyFilterOnUpdate:c}=n;if(n.reapplyFilterOnUpdate=!1,n.beginBatch(),t.forEach(d=>d.setValue(o,l)),n.endBatch(),n.reapplyFilterOnUpdate=c,n.isFiltered&&(i!=null&&i.isSpecialRow)){const{unfilteredGroupRecords:d}=n,u=d.indexOf(a);i=d[u+1]}}super.move(t,i)}collapse(t){return t&&!t.meta.collapsed?(this.excludeGroupRecords(t),t.meta.collapsed=!0,this.collapsedGroups.add(t.id),this.trigger("toggleGroup",{groupRecord:t,collapse:!0}),!0):!1}expand(t,i=!0){return t!=null&&t.meta.collapsed?(this.includeGroupRecords(t),t.meta.collapsed=!1,i&&this.collapsedGroups.delete(t.id),i&&this.trigger("toggleGroup",{groupRecord:t,collapse:!1}),!0):!1}removeHeadersAndFooters(t){return t.filter(i=>i.isSpecialRow?(this.unregister(i),!1):!0)}prepareGroupRecords(t){const i=this,{isFiltered:n,reapplyFilterOnUpdate:s,startGroupsCollapsed:a}=i,o=i.collapsedGroups,{allValues:l}=i.storage,c=[],d=i._groupVisibleRecordIds||[],u=D=>{const S=!n||i.filtersFunction(D);return s?S:S||d.includes(D.id)};for(const D of l)D.isGroupHeader&&(D.meta.collapsed||o.has(D.id))&&(o.add(D.id),c.push(D));for(const D of c)i.includeGroupRecords(D);const h=i.removeHeadersAndFooters(i.storage._values);t&&h.sort(t),n&&(i.filtersFunction=null);const g=[],f=i.groupers[0].field;let m=null,p=null,v=0;function y(){const D=p.meta.groupRowFor,S=`group-footer-${typeof D=="number"?D:O.createId(D)}`,x=i.getById(S)||new i.modelClass({id:S},i,{specialRow:!0,groupFooterFor:D,groupRecord:p});return x.stores=[i],i.register(x),x.groupChildren=p.groupChildren,p.meta.collapsed||g.push(x),i.allRecords.push(x),p.groupChildren.push(x),p.unfilteredGroupChildren.push(x),v++,x}h.forEach(D=>{var S;const x=D.getValue(f),R=x==null?"__novalue__":x,I=`group-header-${typeof R=="number"?R:O.createId(R)}`;if(((S=D.unfilteredGroupChildren)==null?void 0:S.length)===0){i.unregister(D);return}T.isEqual(R,m)||(p&&(i.useGroupFooters&&y(p),p.meta.childCount=v),p=i.getById(I),p||(p=new i.modelClass({id:I},i,{specialRow:!0,groupRowFor:R,groupField:f}),a&&(o.add(I),i.startGroupsCollapsed=!1)),p.meta.collapsed=o.has(I),p.stores=[i],i.register(p),p.groupChildren=[],p.unfilteredGroupChildren=[],g.push(p),i.allRecords.push(p),m=R,v=0),D.instanceMeta(i.id).groupParent=p,o.has(I)||g.push(D),u(D)&&(p.groupChildren.push(D),v++),p.unfilteredGroupChildren.push(D)}),p&&(i.useGroupFooters&&y(),p.meta.childCount=v),i._idMap=null;const C={values:g};return n&&(C.filteredValues=g.filter(u)),C}get isGrouped(){var t;return!!((t=this.groupers)!=null&&t.length)}group(t,i,n=!1,s=!0,a=!1){var o,l;const c=this;let d,u;if(t&&typeof t=="object"&&(i=t.ascending,u=t.fn,t=t.field),n?c.groupers.push(d={field:t,ascending:i,complexMapping:t.includes(".")}):t&&(i==null&&(i=((o=c.groupInfo)==null?void 0:o.field)===t&&((l=c.groupInfo)==null?void 0:l.fn)===u?!c.groupInfo.ascending:!0),c.groupInfo=d={field:t,ascending:i,fn:u,complexMapping:t.includes(".")},c.groupers=[c.groupInfo]),d){const{prototype:h}=c.modelClass;d.complexMapping&&!Object.prototype.hasOwnProperty.call(h,t)&&Object.defineProperty(h,t,{get(){return T.getPath(this,t)}})}if(s!==!1){if(c.remoteSort&&!c.isRemoteDataLoading)return c.sort(null,null,!1,!0).then(()=>c.onAfterGrouping(a));c.sort(null,null,!1,!0)}c.onAfterGrouping(a)}onAfterGrouping(t){if(t)return;const i=this,n=i.groupers||[];i.trigger("group",{isGrouped:i.isGrouped,groupers:n,records:i.storage.values}),i.trigger("refresh",{action:"group",isGrouped:i.isGrouped,groupers:n,records:i.storage.values})}addGrouper(t,i=!0){return this.group(t,i,!0)}removeGrouper(t){const i=this,{groupers:n}=i;if(!n)return;const s=n.findIndex(a=>a.field===t);if(s>-1)return n.splice(s,1),n.length?i.group():i.clearGroupers()}clearGroupers(t=!1){return this.setGroupers(null,{silent:t})}isRecordInGroup(t,i){var n;if(!this.isGrouped)return null;const s=(n=this.groupers[0])==null?void 0:n.field;return t.getValue(s)===i&&!t.isSpecialRow}isInCollapsedGroup(t){const i=t.instanceMeta(this).groupParent;return i==null?void 0:i.meta.collapsed}getGroupRecords(t){return this.isGrouped?this.storage.values.filter(i=>this.isRecordInGroup(i,t)):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0].field):null}onDataChanged({changes:t,action:i}){this.isGrouped&&(!t&&_P[i]||t&&this.groupers.some(n=>n.field in t))&&this.sort()}internalIncludeExcludeGroupRecords(t,i){const n=this,s=n.indexOf(t),a=n.allIndexOf(t),{id:o,storage:l}=n,{_filteredValues:c,_values:d}=l,{meta:u,groupChildren:h,unfilteredGroupChildren:g}=t;a===-1||u.collapsed&&!i||!u.collapsed&&i||(g.forEach(f=>f.instanceMeta(o).hiddenByCollapse=!i),i?(c&&c.splice(s+1,0,...h.filter(f=>!n.isAvailable(f))),l._values.splice(a+1,0,...g.filter(f=>!n.isAvailable(f)))):(c&&c.splice(s+1,h.length),d.splice(a+1,g.length)),l._indicesInvalid=!0,n._idMap=null)}excludeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!1)}includeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!0)}collectGroupRecords(t,i=!0){return(t?this.storage.allValues:this.storage.values).reduce((s,a)=>(a.isSpecialRow&&(i&&!a.isGroupFooter&&s.push(a),a.isGroupHeader&&s.push.apply(s,a.groupChildren)),s),[])}},E(r,"$name","StoreGroup"),E(r,"configurable",{groupers:null,useGroupFooters:!1,startGroupsCollapsed:null}),r},yD=e=>class extends(e||F){static get configurable(){return{objectify:null}}initProxy(){if(!globalThis.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(i,n){if(n in i)return i[n];if(n==="$store")return i;let s=i.getById(n);return!s&&!isNaN(parseInt(n))&&(s=i.getAt(parseInt(n))),s},set(i,n,s){return n in i||i.isDestroying?i[n]=s:i.add({[i.modelClass.idField]:n,...s}),!0},deleteProperty(i,n){return i.isDestroying?(delete i[n],!0):!!i.remove(n).length},has(i,n){if(n in i)return!0;if(n.startsWith("{")&&n.endsWith("}")){const s=O.safeJsonParse(n);n=s==null?void 0:s.id}return i.includes(n)}})}},bD=e=>{var r;return r=class extends(e||F){initRelations(t){const i=this,n=i.modelClass.exposedRelations;t&&i.modelRelations&&i.modelRelations.forEach(s=>{var a;return(a=s.storeDetacher)==null?void 0:a.call(s)}),(!i.modelRelations||i.modelRelations.length===0||t)&&n&&(i.modelRelations=[],n==null||n.forEach(s=>{const a={...s},{foreignStore:o,relationName:l,relatedCollectionName:c}=a,d=typeof o=="string"?i[o]:o;if(a.dependentStore=i,i.modelRelations.push(a),d){a.foreignStoreProperty=a.foreignStore,a.foreignStore=d;const u=d.dependentStoreConfigs;if(u.has(i)){const h=u.get(i);if(t){const g=h.find(f=>f.relationName===l);g&&H.remove(h,g)}h.push(a)}else u.set(i,[a]);c&&d.initRelationCollection(a,i),d.count>0&&d.updateDependentStores("dataset",d.records)}}))}initRelationCollection(t,i){const n=this,s=t.relatedCollectionName,a=n.collectionStores||(n.collectionStores={});a[s]={store:i,config:t},n[s+"Store"]||(n[s+"Store"]=i),n.count>0&&n.initModelRelationCollection(s,n.records)}initModelRelationCollection(t,i){const n=this;i.forEach(s=>{s.traverse(a=>{const o=t in a?`$related${O.capitalize(t)}`:t;Object.defineProperty(a,o,{enumerable:!0,configurable:!0,get:function(){return n.getCollection(this,t)},set:function(l){return n.setCollection(this,t,l)}})})})}resetRelationCache(){this.relationCache={},this.forEach(t=>t.initRelations())}updateRecordRelationCache(t,i){i==null||i.forEach(n=>{const{config:s}=n,a=n.related?n.related.id:t.getValue(s.foreignKey);a!==void 0&&this.cacheRelatedRecord(t,a,s.relationName,a)})}getRelationCollection(t,i){var n;const s=ce.asId(i);return((n=this.relationCache[t])==null?void 0:n[s])||[]}getCollection(t,i){var n;const{config:s,store:a}=this.collectionStores[i];return((n=a.relationCache[s.relationName])==null?void 0:n[t.id])||[]}setCollection(t,i,n){const{config:s,store:a}=this.collectionStores[i],o=a.relationCache[s.relationName]||(a.relationCache[s.relationName]={}),l=(o[t.id]||[]).slice(),c=[],d=[];a.suspendEvents(),l.forEach(u=>{n.includes(u)||(u[s.foreignKey]=null,a.remove(u),d.push(u))}),n.forEach(u=>{u.isModel instanceof ce?u.stores.includes(a)||(a.add(u),c.push(u)):([u]=a.add(u),c.push(u)),u[s.foreignKey]=t.id}),a.resumeEvents(),d.length&&(a.trigger("remove",{records:d}),a.trigger("change",{action:"remove",records:d})),c.length&&(a.trigger("add",{records:c}),a.trigger("change",{action:"add",records:c}))}cacheRelatedRecord(t,i,n,s=null){const a=this,o=a.relationCache[n]||(a.relationCache[n]={});s!==null&&a.uncacheRelatedRecord(t,n,s),i!=null&&H.include(o[i]||(o[i]=[]),t)}uncacheRelatedRecord(t,i=null,n=null){const s=this;function a(o,l){const c=s.relationCache[o],d=c==null?void 0:c[l];if(d){const u=d.indexOf(t);u>=0&&d.splice(u,1),d.length===0&&delete c[l]}}n!=null?a(i,n):t.meta.relationCache&&Object.entries(t.meta.relationCache).forEach(([o,l])=>a(o,l==null?void 0:l.id))}updateDependentStores(t,i){this.dependentStoreConfigs.forEach(n=>{n.forEach(s=>{const{dependentStore:a,relatedCollectionName:o,relationName:l,foreignKey:c}=s,d=a.relationCache[l];if(t==="dataset"){o&&this.initModelRelationCollection(o,i),a.forEach(u=>{const h=u.initRelation(s);h&&a.cacheRelatedRecord(u,h.id,l,h.id)});return}if(t==="removeall"){a.forEach(u=>u.removeRelation(s)),delete a.relationCache[l];return}t==="add"&&o&&this.initModelRelationCollection(o,i),(t==="add"||t==="remove")&&i.forEach(u=>{const h=d==null?void 0:d[u.id];switch(t){case"remove":h&&h.forEach(g=>g.removeRelation(s));break;case"add":a.forEach(g=>{g.getValue(c)==u.id&&(g.initRelation(s),a.cacheRelatedRecord(g,u.id,l))});break}})})})}updateDependentRecordIds(t,i){var n;(n=this.dependentStoreConfigs)==null||n.forEach(s=>{s.forEach(a=>{var o;const{dependentStore:l,relationName:c,foreignKey:d}=a,u=l.relationCache[c],h=(o=u==null?void 0:u[t])==null?void 0:o.slice();h==null||h.forEach(g=>{l.cacheRelatedRecord(g,i,c,t),g.set(d,i,!1,!0)})})})}},E(r,"$name","StoreRelation"),r},CD=e=>class extends(e||F){static get $name(){return"StoreSum"}sum(t,i=this.storage.values){return i?i.reduce((n,s)=>{if(s.isSpecialRow)return n;const a=Number(s.getValue(t));return isNaN(a)?n:n+a},0):0}min(t,i=this.storage.values){return i!=null&&i.length?i.reduce((n,s)=>{const a=s.getValue(t);return typeof(a==null?void 0:a.valueOf())==="number"&&a<n&&(n=a),n},i[0].getValue(t)):0}max(t,i=this.storage.values){return i!=null&&i.length?i.reduce((n,s)=>{const a=s.getValue(t);return typeof(a==null?void 0:a.valueOf())==="number"&&a>n&&(n=a),n},i[0].getValue(t)):0}average(t,i=this.storage.values){if(!(i!=null&&i.length))return 0;let n=0;const s=i.reduce((a,o)=>{if(o.isSpecialRow)return a;const l=parseFloat(o.getValue(t));return isNaN(l)?a:(n++,a+l)},0);return n>0?s/n:0}groupSum(t,i){return this.sum(i,this.getGroupRecords(t))}},sm=(e,r)=>String(e).toLowerCase().includes(r),SD={string:sm,number:sm,boolean:sm,date:(e,r)=>e instanceof Date&&r instanceof Date?e-r===0:String(e.getMonth()+1).includes(r)||String(e.getDate()).includes(r)||String(e.getFullYear()).includes(r),object:(e,r)=>e===r,undefined:(e,r)=>e===r},DD=e=>class extends(e||F){static get $name(){return"StoreSearch"}search(t,i=null,n,s){const a=this.isTree&&!s?this.rootNode.allChildren:this.getAllDataRecords(s),o=a.length,l=[];if(t==null)return[];typeof t=="string"&&(t=t.toLowerCase());let c,d,u,h,g,f;for(c=0;c<o;c++){u=a[c],d=0;for(const m of i||u.fieldNames){h=u.getValue(m),g=h instanceof Date?"date":typeof h;const p=n==null?void 0:n[d];p&&(h=p(h),g="string"),f=SD[g],h&&(f!=null&&f(h,t))&&l.push({index:c,data:u,field:m,id:u.id}),d++}}return l}findByField(t,i,n=!1,s=!1){const a=this.getAllDataRecords(s),o=a.length,l=new Set,c=[];let d,u,h;for(i!=null&&(i=String(i).toLowerCase()),d=0;d<o;d++)if(u=a[d],h=u.getValue(t),!n||!l.has(h)){const g=h instanceof Date?"date":typeof h,f=SD[g];(i==null&&h===i||i&&f(h,i))&&(c.push({id:u.id,index:d,data:u}),n&&l.add(h))}return c}find(t,i=!1){return this.getAllDataRecords(i).find(t)}findRecord(t,i,n=!1){const s=a=>T.isEqual(a[t],i);return this.isTree?this.query(s,n)[0]:this.getAllDataRecords(n).find(s)}query(t,i=!1){if(this.isTree){const n=[];return this.traverse(s=>{t(s)&&n.push(s)},void 0,void 0,i),n}return this.getAllDataRecords(i).filter(t)}some(t,i=!1){return this.getAllDataRecords(i).some(t)}},wD=e=>class extends(e||F){static get $name(){return"StoreSort"}static get defaultConfig(){return{useLocaleSort:null}}static get configurable(){return{sorters:[],reapplySortersOnAdd:!1}}get isSorted(){return!!this.sorters.length||this.isGrouped}changeSorters(t){return t.map(i=>this.normalizeSorterConfig(i,!0))}updateReapplySortersOnAdd(t){this.storage.autoSort=t}sort(t,i,n=!1,s=!1){const a=this,o=a.allRecords,l=a.sorters?a.sorters.slice():[];let c=null,d;if(t)if(Array.isArray(t))a.sorters=t.map(u=>a.normalizeSorterConfig(u,typeof u=="string"?!0:i));else{const u=a.normalizeSorterConfig(t,i);n?(d=a.getCurrentSorterByField(u.field),d?(c=d.ascending,d.ascending=u.ascending):a.sorters.push(u)):a.sorters=[u]}return!s&&a.trigger("beforeSort",{sorters:a.sorters,records:o,currentSorters:l})===!1?(a.sorters=l,c!==null&&(d.ascending=c),null):a.performSort(s)}normalizeSorterConfig(t,i){var n,s,a;const o=this,l={ascending:i};if(typeof t=="object"?(T.assign(l,t),t.fn&&(delete l.fn,l.sortFn=t.fn),l.ascending=(n=t.ascending)!=null?n:i):typeof t=="function"?l.sortFn=t:l.field=t,l.ascending==null){const c=o.getCurrentSorterByField(l.field);l.ascending=c?!c.ascending:!0}if(l.sortFn==null){const c=(a=(s=o.modelClass)==null?void 0:s.$meta.fields.map[l.field])==null?void 0:a.compareItems;c&&(l.sortFn=c)}return l}getCurrentSorterByField(t){return typeof t=="string"&&this.sorters.find(i=>i.field===t)||null}addSorter(t,i=!0){return this.sort(t,i,!0)}removeSorter(t){const i=this.sorters.findIndex(n=>n.field===t||n.sortFn===t);if(i>-1)return this.sorters.splice(i,1),this.sort()}clearSorters(t=!1){if(this.sorters.length)return this.sorters.length=0,this.sort(void 0,void 0,void 0,t)}createSorterFn(t){const i=this.useLocaleSort;return(n,s)=>{for(let a=0;a<t.length;a++){const o=t[a],{field:l,ascending:c=!0,useLocaleSort:d=i}=o,u=o.fn||o.sortFn,h=c?1:-1;if(u){const m=u.call(o,n,s);if(m===0)continue;if(m!==null)return m*h}const g=n.isModel?n.getValue(l):n[l],f=s.isModel?s.getValue(l):s[l];if(g!==f){if(g==null)return-h;if(f==null)return h;if(d&&typeof g=="string"){if(d===!0)return String(g).localeCompare(f)*h;if(typeof d=="string")return String(g).localeCompare(f,d)*h;if(typeof d=="object")return String(g).localeCompare(f,d.locale,d)*h}if(g>f)return h;if(g<f)return-h}}return 0}}get sorterFn(){const t=this,{sorters:i}=t;return t.createSorterFn(t.remoteSort?[{field:"_remoteSortIndex"}]:t.isGrouped?t.groupers.concat(i):i)}performSort(t){const i=this,{rootNode:n,storage:s,sorterFn:a}=i;i.tree?(!i.isChained&&n.traverse(o=>{o.isLoaded&&o.isParent&&(o.children.sort(a),o.updateChildrenIndices(o.children,"parentIndex",!0))}),s.replaceValues({values:i.collectDescendants(n).visible,silent:!0})):i.isGrouped?s.replaceValues({...i.prepareGroupRecords(a),silent:!0}):s.replaceValues({values:s.values.sort(a),silent:!0}),i.afterPerformSort(t||i.isRemoteDataLoading)}afterPerformSort(t){if(t)return;const i=this;i._idMap=null;const n={action:"sort",sorters:i.sorters,records:i.allRecords};i.trigger("sort",n),i.trigger("refresh",n)}},ED=()=>!0,xD=e=>class extends(e||F){static get $name(){return"StoreChained"}static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],excludeCollapsedRecords:!0,chainSuspended:0}}static get properties(){return{chainedStores:null}}construct(t){super.construct(t);const i=this,{masterStore:n}=i,s=i.syncOrder?"sort":"";n&&(i.methodNamesToRelay.forEach(a=>i[a]=(...o)=>i.relayToMaster(a,o)),i.removeAll=(...a)=>{n.remove(i.getRange(),...a)},n.ion({changePreCommit:i.onMasterDataChangedPreCommit,change:i.onMasterDataChanged,[s]:i.onMasterDataChanged,prio:1,thisObj:i}),n.chainedStores||(n.chainedStores=[]),n.chainedStores.push(i),i.fillFromMaster())}get $master(){return this.masterStore||this}get isChained(){return!!this.masterStore}set chainedFilterFn(t){this._chainedFilterFn=this.thisObj?t.bind(this.thisObj):t}get chainedFilterFn(){return this._chainedFilterFn||ED}get methodNamesToRelay(){const t=Array.isArray(this.doRelayToMaster),i=Array.isArray(this.dontRelayToMaster);return t&&this.doRelayToMaster.filter(n=>!i||!this.dontRelayToMaster.includes(n))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach(t=>t.fillFromMaster())}fillFromMaster(){const t=this,{masterStore:i,isTree:n}=t;let s=[];if(!t.isChained)throw new Error("fillFromMaster only allowed on chained store");if(!t.isChainSuspended){if(i.isGrouped&&i.isFiltered?i.forEach(a=>s.push(a),i,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0}):s=i.allRecords.filter(a=>!a.isSpecialRow&&t.chainedFilterFn(a)),n&&(t.idRegister={},t.internalIdRegister={},s.forEach(a=>{a.stores.includes(t)?t.register(a):a.joinStore(t)}),t.excludeCollapsedRecords)){const a=t.getChildren(t.rootNode);s=t.doIncludeExclude(a,!0)}t.isFillingFromMaster=!0,t.data=s,t.isFillingFromMaster=!1}}commitToMaster(){const t=this,i=t.masterStore;if(!t.isChained)throw new Error("commitToMaster only allowed on chained store");return i.beginBatch(),i.remove(t.removed.values),i.add(t.added.values),i.endBatch(),t.commit()}relayToMaster(t,i){return this.masterStore[t](...i)}onMasterDataChangedPreCommit(t){this.onMasterDataChanged(t),this.$masterEventhandled=!0}onMasterDataChanged({action:t,changes:i,$handled:n,isMove:s}){var a;if(this.$masterEventhandled){this.$masterEventhandled=!1;return}s&&t==="remove"||(t!=="update"||(a=this.chainedFields)!=null&&a.some(o=>o in i))&&this.fillFromMaster()}makeChained(t=ED,i,n){return new((n==null?void 0:n.storeClass)||this.constructor)({...n||{},tree:!1,autoTree:!1,masterStore:this.$master,modelClass:this.modelClass,syncDataOnLoad:!1,chainedFilterFn:t,chainedFields:i})}chain(){return this.makeChained(...arguments)}doDestroy(){var t;(t=this.chainedStores)==null||t.forEach(i=>i.destroy()),super.doDestroy()}suspendChain(){this.chainSuspended++}resumeChain(t=!1){this.chainSuspended&&!--this.chainSuspended&&t&&this.fillFromMaster()}get isChainSuspended(){return this.chainSuspended>0}},RD=e=>class extends(e||F){static get $name(){return"StoreState"}getState(){const{sorters:t,groupers:i,filters:n}=this,s={};return t!=null&&t.length&&(s.sorters=t.map(a=>{const o=T.cleanupProperties(T.clone(a));return delete o.fn,delete o.sortFn,o})),i!=null&&i.length&&(s.groupers=i.map(a=>{const o=T.cleanupProperties(T.clone(a));return delete o.fn,o})),n!=null&&n.values.length&&(s.filters=n.values.map(a=>{const o=T.cleanupProperties(T.clone(a.config));return o.value=a.value,o.caseSensitive&&delete o.caseSensitive,o})),s}applyState(t){const i=this,{sorters:n=[],groupers:s=[],filters:a=[]}=t,{sortParamName:o,filterParamName:l}=i;i.sorters=n.filter(c=>c.field||c.sortFn&&!o),i.groupers=s.slice(),i.sort(),i.filters=a.filter(c=>c.property||c.filterBy&&!l),i.filter()}},kP=e=>String(e).padStart(6,"0"),it=class{constructor(e){this.value=e,this._padded=null}set value(e){this._value=String(e!=null?e:"")}get value(){return this._value}static from(e){return e==null||e instanceof it?e:new it(e)}static pad(e){return e instanceof it?e.valueOf():it.split(e).map(kP).join(".")}static split(e){let r,t;if(e||e===0)switch(typeof e){case"object":e=String(e);case"string":for(t=e.split("."),r=t.length;r-- >0;)t[r]=parseInt(t[r],10);break;case"number":t=[e];break}return t||[]}static compare(e,r){return e===r?0:!e||!r?e?1:r?-1:0:(e=it.pad(e),r=it.pad(r),e<r?-1:r<e?1:0)}append(e){const r=this.value;return it.from(r?`${r}.${e}`:e)}isEqual(e){return!it.compare(this,e)}match(e){let r=!1;if(e){const t=this.value,i=e[0]==="*",n=e.endsWith("*"),s=e.length;i===n?r=t.indexOf(i?e.substr(1,s-2):e)>-1:i?r=t.endsWith(e.substr(1)):r=t.startsWith(e.substr(0,s-1))}return r}toString(){return this.value}toJSON(){return this.toString()}valueOf(){var e;return(e=this._padded)!=null?e:this._padded=it.pad(this.value)}};it._$name="Wbs";var FP=Object.freeze([]),cl=Symbol("StopBranch"),TD=e=>{var r;return r=class extends(e||F){get StopBranch(){return cl}get isTree(){return this.tree||this.masterStore&&this.masterStore.tree}get leaves(){const t=this,i=[];return t.isTree?(t.traverse(n=>{n.isLeaf&&i.push(n)}),i):(t.allRecords.forEach(n=>{n.isLeaf&&i.push(n),n.traverse(s=>{s.isLeaf&&i.push(s)},!0)}),i)}async loadChildren(t){}onNodeAddChild(t,i,n,s,a=!1){var o;const l=this,c=t===l.rootNode&&t.isLoading,{storage:d}=l,{previousSibling:u}=i[0];let h;const{visible:g,all:f}=l.collectDescendants(i,void 0,void 0,{inCollapsedBranch:!(t.isExpanded(l)&&t.ancestorsExpanded(l)),applyFilter:l.isFiltered&&l.reapplyFilterOnAdd});if(!c&&f.length)for(const m of f)!l.modified.includes(m)&&!s[m.id]&&(l.removed.includes(m)?l.removed.remove(m):m.isLinked||l.added.add(m));if(c&&l.rootVisible&&(g.unshift(t),f.unshift(t)),g.length?(n===0||!u?h=d.indexOf(t):h=d.indexOf(u)+u.getDescendantCount(!0,l),d.suspendEvents(),l.storage.splice(++h,0,g),d.resumeEvents(),l._idMap=null):l._allRecords=null,l.updateDependentStores("add",i),c&&g.length){if(l.sorters.length&&l.sort(null,null,!1,!0),(o=l.afterLoadData)==null||o.call(l),!a){const m={action:"dataset",data:l._data,records:g};l.trigger("refresh",m),l.trigger("change",m)}}else if(!a){const m={action:"add",parent:t,isChild:!0,isMove:s,records:i,allRecords:f,index:h};if(l.trigger("add",m),l.trigger("change",m),Object.values(s).some(p=>p)){const p={newParent:t,records:i.filter(v=>s[v.id]),oldParents:i.map(v=>l.getById(v.meta.oldParentId))};l.trigger("move",p)}}}onNodeRemoveChild(t,i,n,s={isMove:!1,silent:!1,unfiltered:!1}){const a=this,{storage:o}=a,l=[],c=[],{isMove:d,silent:u,unfiltered:h}=s,g=h&&a.isFiltered,f=g&&t.unfilteredChildren?t.unfilteredChildren:i;if(a.collectDescendants(f,l,c,{inCollapsedBranch:!(t.isExpanded(a)&&t.ancestorsExpanded(a)),unfiltered:g}),!d){for(const m of i)m.unjoinStore(a);for(const m of c)m.stores.includes(a)&&m.unjoinStore(a),a.added.includes(m)?a.added.remove(m):m.isLinked||a.removed.add(m);a.modified.remove(c)}if(l.length?(n=o.indexOf(l[0]),n>-1&&(o.suspendEvents(),o.splice(n,l.length),o.resumeEvents(),a._idMap=null)):(n=-1,a._allRecords=null),!u&&(a.fireRemoveEventForMoveAction||!d)){const m={action:"remove",parent:t,isChild:!0,isMove:d,records:i,allRecords:c,index:n};a.trigger("remove",m),a.trigger("change",m)}return c}collectDescendants(t,i=[],n=[],s={}){var a;const o=this,{inCollapsedBranch:l=!1,unfiltered:c=!1,applyFilter:d=!1}=s,u=Array.isArray(t)?t:(a=o.getChildren(t,c))!=null?a:[];if(d)return{visible:u.flatMap(h=>this.collectVisibleNodeDescendantsFiltered(h)),all:u.flatMap(h=>h.allChildren)};for(let h=0,g=u.length,f;h<g;h++)f=u[h],l||i.push(f),n.push(f),o.collectDescendants(f,i,n,{inCollapsedBranch:l||!f.isExpanded(o),unfiltered:c});return{visible:i,all:n}}collectVisibleNodeDescendantsFiltered(t){const i=t.unfilteredChildren||t.children;if(!i||i.length===0||!t.isLeaf&&!t.isExpanded(this))return this.filtersFunction(t)?[t]:[];const n=i.flatMap(s=>this.collectVisibleNodeDescendantsFiltered(s));return n.length||this.filtersFunction(t)?[t,...n]:[]}getChildren(t,i=!1){const n=this,s=(i||n.isChained)&&t.unfilteredChildren||t.children;return s!=null&&s.length?n.isChained?s.filter(n.chainedFilterFn).sort(n.sorterFn):s:FP}internalToggleTreeSubRecords(t,i){const n=this,{storage:s}=n,a=s.indexOf(t),o=n.doIncludeExclude(n.getChildren(t),i);if(n.isFiltered&&i&&t.unfilteredChildren&&n.updateChildrenHiddenState(t),o.length&&a!==!1){if(s.suspendEvents(),i){s.splice(a+1,0,...o);const l={action:"add",isExpand:!0,records:o,index:a+1};n.trigger("add",l),n.trigger("change",l)}else{s.splice(a+1,o.length);const l={action:"remove",isCollapse:!0,records:o,index:a+1};n.trigger("remove",l),n.trigger("change",l)}s.resumeEvents(),n._idMap=null}}updateChildrenHiddenState(t){var i;(i=t.unfilteredChildren)==null||i.forEach(n=>{n.instanceMeta(this.id).hidden=!1,n.isLeaf||this.updateChildrenHiddenState(n)})}doIncludeExclude(t,i,n=[]){const s=this,a=(t==null?void 0:t.length)||0;for(let o=0;o<a;o++){const l=t[o];if(!s.isChained||s.chainedFilterFn(l)){const c=l.instanceMeta(s.id);(i||!c.hidden)&&n.push(l),c.hidden=!i,l.isExpanded(s)&&s.doIncludeExclude(s.getChildren(l),i,n)}}return n}async toggleCollapse(t,i){const n=this,s=n.getById(t),a=s.instanceMeta(n);if(i===void 0&&(i=!a.collapsed),!a.isLoadingChildren&&!s.isLeaf&&s.isExpanded(n)===i){if(n.trigger("beforeToggleNode",{record:s,collapse:i}),a.collapsed=i,a.collapsed)return n.onNodeCollapse(s),!0;{n.onNodeExpand(s);let o=!0;if(!s.isLoaded){a.isLoadingChildren=!0;try{await n.loadChildren(s)}catch(l){a.collapsed=!0,o=!1,n.trigger("loadChildrenException",{record:s,exception:l})}finally{a.isLoadingChildren=!1}}return o}}}onNodeCollapse(t){if(t.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(t,!1)}onNodeExpand(t){if(t.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(t,!0)}transformToTree(t){const{parentIdField:i,idField:n,childrenField:s}=this.modelClass,a=new Map,o=new Set,l=[];for(const d of t){const u=d[n];u!=null&&a.set(u,d),d[i]!=null&&o.add(d[i])}const c=d=>{const u=Object.assign({},d);return u[s]=[],a.set(u.id,u),u};for(let d of t){o.has(d.id)&&!d[s]&&(d=c(d));const u=d[i];if(u!=null){let h=a.get(u);h&&(h[s]||(h=c(h)),h[s].push(d))}else d[s]?l.push(d):d[n]!=null?l.push(c(d)):l.push(d)}return l}treeify(t,i,n=!1){const{length:s}=t,a=[],o=[],l={};let c,d;for(c=0;c<s;c++){let h=t[c];h=h.field||h,t[c].call||(t[c]=g=>g[h],t[c].fieldName=h),a[c]=new Map}this.rootNode.traverse(h=>{if(d=null,h.isLeaf){for(c=0;c<s;c++){const g=(d==null?void 0:d.path)||"",f=a[c],m=t[c](h);if(m===cl)break;const p=`${g+(m!=null&&m.isModel?m.id:m)}/`,v=O.makeValidDomId(`generated_${p}`,"_"),y=t[c].fieldName,C=f.get(v)||f.set(v,{id:v,key:m,path:p,expanded:!0,readOnly:!0,children:[],generatedParent:!0,field:y,firstGroupChild:h}).get(v);d&&!d.children.includes(C)&&d.children.push(C),d=C}d?d.children.push(h):o.push(h)}},!0),(i||n)&&a.forEach(h=>h.forEach((g,f,m)=>{i==null||i(g),n&&(g=this.createRecord(g),m.set(f,g))})),l.children=[...a[0].values(),...o];const u=h=>{h.children&&(h.children.sort((g,f)=>{if(g.isLeaf===f.isLeaf)if(g.isLeaf){let m;for(let p=0;!m&&p<s;p++){const v=t[p](g),y=t[p](f);if(v===cl||y===cl)return g.isLeaf<f.isLeaf?-1:g.isLeaf>f.isLeaf?1:0;m=v<y?-1:y>v?1:0}return m}else return typeof g.key=="string"&&typeof f.key=="string"?g.key.localeCompare(f.key,void 0,{numeric:!0}):g.key<f.key?-1:g.key>f.key?1:0;else return g.isLeaf<f.isLeaf?-1:g.isLeaf>f.isLeaf?1:0}),h.children.forEach(u))};return u(l),l}treeifyFlatData(t){const{childrenField:i,parentIdField:n}=this.modelClass;let s=!1,a=!0;for(const o of t){if(o.isModel||Array.isArray(o[i])){a=!1;break}o[n]!=null&&(s=!0)}return a&&s&&(t=this.transformToTree(t)),t}async indent(t){const i=this;if(t=Array.isArray(t)?t:[t],t=t.filter(n=>{let s=!!n.previousSibling;for(;s&&!n.isRoot;)s=!t.includes(n.parent),n=n.parent;return s}),t.length&&i.trigger("beforeIndent",{records:t})!==!1){t.sort((n,s)=>it.compare(n.wbsCode,s.wbsCode)),i.beginBatch();for(const n of t){const s=n.previousSibling;s.appendChild(n),i.toggleCollapse(s,!1)}i.endBatch(),i.trigger("indent",{records:t}),i.trigger("change",{action:"indent",records:t})}}async outdent(t){const i=this;if(t=Array.isArray(t)?t:[t],t=t.filter(n=>{const{parent:s}=n;let a=s&&!s.isRoot;for(;a&&!n.isRoot;)a=!t.includes(s),n=n.parent;return a}),t.length&&i.trigger("beforeOutdent",{records:t})!==!1){t.sort((n,s)=>it.compare(n.wbsCode,s.wbsCode)),i.beginBatch();for(const n of t){const{parent:s}=n,a=s.children.slice(s.children.indexOf(n)+1);s.parent.insertChild(n,s.nextSibling),n.appendChild(a),i.toggleCollapse(n,!1)}i.endBatch(),i.trigger("outdent",{records:t}),i.trigger("change",{action:"outdent",records:t})}}},E(r,"$name","StoreTree"),E(r,"StopBranch",cl),E(r,"configurable",{transformFlatData:null,fireRemoveEventForMoveAction:ne.checkVersion("core","6.0","<")}),r},Rn=class{static preWalk(e,r,t){const i=[e];let n,s;for(;i.length;)n=i.pop(),t(n),s=r(n),s&&i.push.apply(i,s.slice().reverse())}static preWalkWithParent(e,r,t){const i=[{node:e,parent:null}];for(;i.length;){const{parent:n,node:s}=i.pop();t(n,s);const a=r(s);Array.isArray(a)&&i.push(...a.slice().reverse().map(o=>({node:o,parent:s})))}}static preWalkUnordered(e,r,t){const i=[e];let n,s;for(;i.length;)n=i[i.length-1],t(n),s=r(n),s?i.splice(i.length-1,1,...s):i.length=i.length-1}static postWalk(e,r,t){const i=new Map,n=[e];let s,a;for(;n.length;)s=n[n.length-1],i.has(s)?(t(s),n.pop()):(a=r(s),a&&n.push(...a.slice().reverse()),i.set(s,s))}static prePostWalk(e,r,t,i){const n=new Map,s=[e];let a,o;for(;s.length;)a=s[s.length-1],n.has(a)?(i(a),s.pop()):(t(a),o=r(a),o&&s.push(...o.slice().reverse()),n.set(a,a))}};Rn._$name="WalkHelper";var MD=e=>class extends(e||F){static get $name(){return"StoreSync"}static get configurable(){return{syncDataOnLoad:null,shouldSyncDataset:null,shouldSyncRecord:null}}syncDataset(t){var i;const n=this,{storage:s}=n,a=(i=n.shouldSyncDataset)==null?void 0:i.call(n,{data:t});if(a===!1)return;n.isSyncingDataOnLoad=!0;const{toAdd:o,toRemove:l,toMove:c,updated:d,ids:u}=n.tree?n.syncTreeDataset(t,a):n.syncFlatDataset(t,a);let{threshold:h}=n.syncDataOnLoad,g=!1;if(h&&(typeof h=="string"&&(h=parseInt(h,10)/100*n.count),g=o.length+l.length+c.length+d.length>h),n.tree){if(o.length&&n.add(o,g).forEach(p=>p.clearParentId()),c.length)for(const{parent:m,node:p,index:v}of c)n.getById(m.id).insertChild(p,v);n.remove(l,g)}else g&&n.suspendEvents(),n.remove(l),n.add(o),g&&n.resumeEvents();h&&!g&&d.forEach(({record:m,toSet:p,wasSet:v})=>n.onModelChange(m,p,v)),n.acceptChanges();const f={added:o,removed:l,updated:d,thresholdSurpassed:g};if(n.isFiltered&&!n.remoteFilter&&n.filter({silent:n.isRemoteDataLoading}),n.isGrouped)n.group(null,null,!1,!0,n.isRemoteDataLoading);else if(n.isSorted)n.remoteSort?s.replaceValues({values:s.values.sort(n.createSorterFn(n.sorters)),silent:!0}):n.sort();else if(!n.tree)s.values.some((m,p)=>m.id!==u[p])&&(s.replaceValues({values:s.values.sort((m,p)=>u.indexOf(m.id)-u.indexOf(p.id)),silent:!0}),!g&&n.afterPerformSort());else{let m=!1,p=0;Rn.preWalk(n.rootNode,v=>Array.isArray(v.children)&&!m?v.children:null,v=>{v.id!==u[p++]&&(m=!0)}),m&&(n.sort((v,y)=>u.indexOf(v.id)-u.indexOf(y.id),void 0,void 0,!0),n.clearSorters(!0),!g&&n.afterPerformSort())}g&&n.trigger("refresh",{action:"batch",data:t,records:s.values,syncInfo:f}),n.isSyncingDataOnLoad=!1,n.trigger("loadSync",f)}syncFlatDataset(t,i){if(!t)return{toRemove:this.records};const n=this,{idField:s,allFields:a}=n.modelClass,o=[],l=[],c=[],d={},u=[],h=Array.isArray(i),{threshold:g,keepMissingValues:f}=n.syncDataOnLoad;let m=0;if(t.forEach(p=>{var v;p=p.isModel?p.data:p;const y=p[s],C=n.getById(y);if(!h||i.includes(y))if(C){if(((v=n.shouldSyncRecord)==null?void 0:v.call(n,{record:C,data:p}))!==!1){if(f===!1)for(const S of a)!(S.dataSource in p)&&S.dataSource in C.data&&(p[S.dataSource]=S.defaultValue);const D=C.set(p,null,!!g);D&&c.push({record:C,wasSet:D,toSet:p})}}else l.push(n.processRecord(n.createRecord(p)));C&&m++,d[y]=1,u.push(y)}),m<n.storage.totalCount)if(i)for(const p of i)d[p]||o.push(n.getById(p));else n.forEach(p=>{d[p.id]||o.push(p)});return{toAdd:l,toRemove:o,toMove:[],updated:c,ids:u}}syncTreeDataset(t){if(!t)return{toRemove:this.records};const i=this,{idField:n,parentIdField:s,childrenField:a,allFields:o}=i.modelClass,{keepMissingValues:l,threshold:c}=i.syncDataOnLoad,d=[],u=[],h=[],g=[],f=new Set,m=[];return i.transformFlatData&&(t=i.treeifyFlatData(t)),Rn.preWalkWithParent({isRoot:!0,id:i.rootNode.id,children:t},p=>p.children,(p,v)=>{var y;if(p){const{id:C,node:D}=i.resolveSyncNode(v);if(D){if(((y=i.shouldSyncRecord)==null?void 0:y.call(i,{record:D,data:v}))!==!1){let S;const x=D.children;if(x!==!0&&v[a]===!0&&(D.clearChildren(),D.data[a]=D.children=!0,delete v[a],i.toggleCollapse(D,!0),S=!0),D.parent.id!==p[n]&&h.push({node:D,parent:p,index:p[a].indexOf(v)}),l===!1)for(const I of o)I.name!=="parentId"&&!(I.dataSource in v)&&I.dataSource in D.data&&(v[I.dataSource]=I.defaultValue);const R=D.set(v,null,!!c);R?g.push({record:D,wasSet:R,toSet:v}):S&&D.signalNodeChanged({[a]:{value:!0,oldValue:x}})}}else v[s]=p[n],u.push({...v,...Array.isArray(v[a])?{children:[]}:void 0});f.add(D),m.push(C)}}),f.length!==t.length&&i.traverse(p=>{f.has(p)||d.push(p)}),{toAdd:u,toRemove:d,toMove:h,updated:g,ids:m}}resolveSyncNode(t){const i=t[this.modelClass.idField],n=this.getById(i);return{id:i,node:n}}},ID=Symbol("STM_PROP"),PD=e=>class extends(e||F){static get $name(){return"StoreStm"}static get defaultConfig(){return{stm:null,ignoreRemoteChangesInSTM:!1}}get stm(){return this[ID]}set stm(t){var i;const n=this;n.stm!==t&&((i=n.stm)!=null&&i.hasStore(n)&&n.stm.removeStore(n),n[ID]=t,n.stm&&!n.stm.hasStore(n)&&n.stm.addStore(n))}add(t,i=!1,n={}){let s;const{stm:a}=this;return!this.tree&&(a!=null&&a.enabled)?(s=super.add(t,i),s!=null&&s.length&&a.onStoreModelAdd(this,s,i)):s=super.add(t,i,n),s}insert(t,i,n=!1){let s;const{stm:a}=this;if(!this.tree&&(a!=null&&a.enabled)){const o=(Array.isArray(i)?i:[i]).reduce((l,c)=>{const d=c instanceof ce?this.indexOf(c):void 0;return d!==void 0&&d!==-1&&l.set(c,d),l},new Map);s=super.insert(t,i),s!=null&&s.length&&(t=this.indexOf(s[0]),a.onStoreModelInsert(this,t,s,o,n))}else s=super.insert(t,i,n);return s}remove(t,i=!1,n){let s;const{stm:a}=this;if(!this.tree&&(a!=null&&a.enabled)){const l=(Array.isArray(t)?t:[t]).map(c=>this.getById(c)).filter(c=>!!c).reduce((c,d)=>{const u=this.indexOf(d);return u!==void 0&&u!==-1&&c.set(d,u),c},new Map);s=super.remove(t,i,n),s!=null&&s.length&&a.onStoreModelRemove(this,s,l,i)}else s=super.remove(t,i,n);return s}removeAll(t){const{stm:i}=this;let n;if(i!=null&&i.enabled){const{tree:s,rootNode:a,allRecords:o}=this,l=o.length,c=s?a.children.slice():o.slice();n=super.removeAll(t),l&&this.count===0&&i.onStoreRemoveAll(this,c,t)}else n=super.removeAll(t);return n}beforeApplyChangeset(){const{stm:t,crudManager:i}=this;let n=!1,s=null;return!(i!=null&&i.applyingChangeset)&&(t!=null&&t.enabled)&&(n=!0,t.isRecording&&(s=t.stash()),this.ignoreRemoteChangesInSTM?t.disable():t.startTransaction()),{shouldResume:n,transactionId:s}}applyChangeset(t,i,n,s,a){const{shouldResume:o,transactionId:l}=this.beforeApplyChangeset(),c=super.applyChangeset(t,i,n,s,a);return this.afterApplyChangeset(o,l),c}afterApplyChangeset(t,i){if(t){const{stm:n}=this;this.ignoreRemoteChangesInSTM?n.enable():n.stopTransaction(),n.applyStash(i)}}},OP={splice:1,clear:1},LP={includeFilteredOutRecords:!1,includeCollapsedGroupRecords:!1},am=(e,r)=>(r=r||!1,typeof r=="boolean"&&(r={includeFilteredOutRecords:r,includeCollapsedGroupRecords:!1}),r||LP),re=class extends F.mixin(fe,ea,Le,Uf,Ld,pD,mD,fD,bD,CD,DD,wD,vD,xD,RD,TD,PD,MD,yD){static get $name(){return"Store"}static get properties(){return{relationCache:{},dependentStoreConfigs:new Map}}static get configurable(){return{id:!0,modelClass:ce,verifyNoGeneratedIds:!0}}static get defaultConfig(){return{fields:null,autoTree:!0,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:!1,allowNoId:!0,preventSubClassingModel:null}}static get identifiable(){return{registerGeneratedId:!1}}constructor(...e){if(super(...e),this.objectify)return this.initProxy()}construct(e={}){const r=this;Object.assign(r,{added:new Bd,removed:new Bd,modified:new Bd,idRegister:{},internalIdRegister:{},oldIdMap:{}}),e.storeId&&(e=T.assign({id:e.storeId},e)),super.construct(e),r.initRelations()}static from(e,r={},t=null){return e&&!e.isStore&&(typeof e=="string"?e=re.getStore(e):(Array.isArray(e)&&(t&&(e=e.map(i=>i.isModel?i:t(i))),e=T.assign({},r,{data:e})),e=new re(e))),e}doDestroy(){var e,r,t,i;const n=this,s=n.registeredRecords;(r=(e=n.stm)==null?void 0:e.removeStore)==null||r.call(e,n);for(let a=s.length-1,o;a>=0;a--)o=s[a],o!=null&&o.isDestroyed||o.unjoinStore(n);(t=n._storage)==null||t.destroy(),n.isChained||(i=n.rootNode)==null||i.destroy(),super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const r=this;e!=null&&e.isCollection?r._storage=e:r._storage=new $t(e),r._storage.autoFilter=r.reapplyFilterOnAdd,r._storage.autoSort=r.reapplySortersOnAdd;for(const t of r._storage)t.joinStore(r);r._storage.ion({change:"onDataChange",thisObj:r})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){var e;const r=this;if(((e=r._allRecords)==null?void 0:e.generation)!==r.storage.generation){if(r.isTree){const t=r.collectDescendants(r.rootNode,void 0,void 0,{unfiltered:!0}).all;r.rootVisible&&t.unshift(r.rootNode),r._allRecords=t}else r._allRecords=r.isGrouped?r.collectGroupRecords():r.storage.allValues;r._allRecords.generation=r.storage.generation}return r._allRecords}getAllDataRecords(e){const r=this;return r.tree?e?r.allRecords:r.rootNode.allChildren:r.isGrouped?r.collectGroupRecords(e,!1):e?r.storage.allValues:r.storage.values}onIsCreatingToggle(e,r){const t=this,i=e.isPersistable&&!r;t.added[i?"add":"remove"](e),i&&(t.trigger("addConfirmed",{record:e}),t.autoCommit&&t.doAutoCommit())}joinRecordsToStore(e){const{allCount:r}=this;for(let t=0;t<e.length;t++){const i=e[t];i.setData("parentIndex",r+t-e.length),i.joinStore(this)}}onDataChange({source:e,action:r,added:t,removed:i,replaced:n,oldCount:s,items:a,from:o,to:l}){const c=this,d=OP[r],u=d&&(t==null?void 0:t.length),h=d&&(i==null?void 0:i.length);let g,f;if(c._idMap=null,u&&c.joinRecordsToStore(t),n==null||n.forEach(([m,p])=>{m.unjoinStore(c,!0),p.joinStore(c)}),super.onDataChange(...arguments),!c.isTree){if(u){for(const m of t)c.removed.includes(m)?c.removed.remove(m):m.isLinked||c.added.add(m);g=!c.remoteFilter&&c.isFiltered&&c.reapplyFilterOnAdd,g&&c.filter({silent:!0}),f=!c.remoteSort&&c.isSorted&&c.reapplySortersOnAdd,f&&c.sort(null,null,!1,!0)}if(h){for(const m of i)m.cancelBatch(),m.unjoinStore(c),c.added.includes(m)?c.added.remove(m):!m._undoingInsertion&&!m.isCreating&&!m.isLinked&&c.removed.add(m);c.modified.remove(i),g=!c.remoteFilter&&c.isFiltered,g&&c.filter({silent:!0})}}switch(r){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(u){c.updateDependentStores("add",t);const m=t.reduce((y,C)=>{const{previousIndex:D}=C.meta;return D>-1&&D<y&&(y=D),y},t[0].meta.previousIndex),p=e.indexOf(t[0],!e.autoFilter),v={records:t,index:p};m>-1&&(v.oldIndex=m),c.trigger("add",v),c.trigger("change",Object.assign({action:"add"},v)),g&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:s,records:c.storage.allValues}),f&&c.trigger("sort",{action:"sort",sorters:c.sorters,records:c.storage.allValues})}i.length&&(c.updateDependentStores("remove",i),c.trigger("remove",{records:i}),c.trigger("change",{action:"remove",records:i})),n.length&&(c.trigger("replace",{records:n,all:c.records.length===n.length}),c.trigger("change",{action:"replace",replaced:n,all:c.records.length===n.length}));break;case"filter":(c.isGrouped||c.isSorted)&&c.performSort(!0);break;case"move":{const m=Math.min(o,l),p=Math.min(c.storage.allValues.length-1,Math.max(o,l));for(let v=c.storage.allValues,y=m;y<=p;y++)v[y].setData("parentIndex",y);c.trigger("move",{record:a[0],records:a,from:o,to:l}),c.isFiltered&&c.performFilter(),c.trigger("change",{action:r,record:a[0],records:a,from:o,to:l});break}}}onDataReplaced(e,r){var t;const i=this,{storage:n}=i,s=n.allValues,a=i.sorters.length>0;for(let l=0;l<s.length;l++)s[l].joinStore(i);if(!i.remoteFilter&&i.isFiltered&&i.filter({silent:!0}),i.remoteSort?i.isGrouped&&n.replaceValues({...i.prepareGroupRecords(),silent:!0}):(i.isGrouped&&i.group(null,null,!1,!a,!0),a&&i.sort(null,null,!1,!0)),!i.useRawData.disableDuplicateIdCheck){const{idMap:l}=i;if(Object.keys(l).length<n.values.length){const c=[];throw n.values.forEach(d=>l[d.id]?delete l[d.id]:c.push(d)),new Error(`Id collision on ${c.map(d=>d.id)}`)}}const o={action:e,data:r,records:n.values};i.updateDependentStores(e,o.records),(t=i.afterLoadData)==null||t.call(i),i.isRemoteDataLoading||i.trigger("refresh",o),i.trigger("change",o)}onModelChange(e,r,t,i,n){const s=this,a={record:e,records:[e],changes:t,batch:e.batching!=null,fromRelationUpdate:n},o=e.ignoreBag||e.isLinked?!1:s.updateModifiedBagForRecord(e);if(s.storage.onItemMutation(e,t),"id"in t){const{oldValue:l,value:c}=r.id;s.updateDependentRecordIds(l,c),s.onRecordIdChange({record:e,oldValue:l,value:c})}if(!i){if("id"in t){const{oldValue:l,value:c}=r.id;s.trigger("idChange",{store:s,record:e,oldValue:l,value:c})}s.onUpdateRecord(e,t),s.trigger("update",a),s.trigger("change",Object.assign({action:"update"},a))}s.autoCommit&&o&&s.doAutoCommit()}updateModifiedBagForRecord(e){const r=this;let t=!1;return e.isModified?!r.modified.includes(e)&&!r.added.includes(e)&&e.isPartOfStore(r)&&!e.isAutoRoot&&(e.isPhantom?r.added.add(e):r.modified.add(e),t=!0):r.modified.remove(e),t}get idMap(){const e=this,r=!e._idMap,t=e._idMap||(e._idMap={});if(r){const i=e.storage.values;for(let n,s=0,a=0;s<i.length;s++)n=i[s],t[n.id]={index:s,visibleIndex:a,record:n},n.isSpecialRow||a++;if(e.isFiltered)for(let n=0,s=e.storage._values.length;n<s;n++){const a=e.storage._values[n];a.id in t?t[a.id].unfilteredIndex=n:t[a.id]={index:-1,unfilteredIndex:n,record:a}}}return t}changeModelClass(e){const{fields:r}=this;this.originalModelClass=e;let t=e;if(r!=null&&r.length){class i extends e{static get fields(){return r}}t=i}else if(!this.preventSubClassingModel){class i extends e{}t=i}return t.initClass(),t}set storeId(e){this.id=e}get storeId(){return this.id}changeId(e,r){return super.changeId(e!==!0&&e,r)}updateId(e,r){const t=re.getById(e);t&&re.unregisterInstance(t),super.updateId(e,r)}generateAutoId(){return re.generateId("store-")}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}buildRootNode(){return{}}static getStore(e,r){if(e instanceof re)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let t;const i=e.map(n=>(n instanceof ce?t=n.constructor:typeof n=="string"&&(n={text:n}),n));if(!t){class n extends ce{}t=n}e={autoCreated:!0,data:i,modelClass:t,allowNoId:!0},r||(r=re)}if(r)return new r(e)}static get stores(){return re.registeredInstances}get rootNode(){return this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var r;const t=this,i=t._rootNode;e!==i&&(i&&t.clear(!0),e instanceof ce?(e.instanceMeta(t).collapsed=!1,t._rootNode=e):t._rootNode=e=new t.modelClass(Object.assign({expanded:!0,[t.modelClass.idField]:`${t.id}-rootNode`},e),t,null,!0),t._tree=!0,e.isRoot=!0,e.joinStore(t),((r=e.children)!=null&&r.length||t.rootVisible)&&(e.isLoading=!0,t.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),t.trigger("rootChange",{oldRoot:i,rootNode:e}))}set data(e){this.setStoreData(e)}setStoreData(e){const r=this,{idField:t,childrenField:i}=r.modelClass;if(r.transformFlatData&&(e==null?void 0:e.length)>0&&!Object.isExtensible(e[0])&&(r.useRawData=r.useRawData||{disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1},e=T.clone(e)),r.getConfig("plugins"),r.processConfiguredListeners(),e&&!Array.isArray(e)&&(e=T.transformNamedObjectToArray(e,t)),r.tree=!r.isChained&&(r.tree||!!(r.autoTree&&(e!=null&&e.some(n=>n[i])))),e&&(r.remoteSort||r.remoteFilter))for(let n=0;n<e.length;n++)e[n]._remoteSortIndex=n;if(!r.syncDataOnLoad||!r._data){if(r._data=e,r.tree){r.transformFlatData&&(e=r.treeifyFlatData(e));const n=r.rootNode;if(n.isLoading=!0,r.clear(!0),n.appendChild(e),r.updateDependentStores("dataset",[n]),n.isLoading=!1,e.length===0){const s={action:"dataset",data:[],records:[]};r.trigger("refresh",s),r.trigger("change",s)}else r.isFiltered&&r.filter()}else r.loadData(e);r.added.clear(),r.removed.clear(),r.modified.clear()}else r.syncDataset(e)}loadData(e,r="dataset"){var t,i;const n=this,{storage:s,allowNoId:a}=n,o=n.modelClass.fieldMap.id.dataSource,l=n.find(d=>d.isCreating);l&&s.values.splice(n.records.indexOf(l),1);let c=n.verifyNoGeneratedIds;if(n.removeHeadersAndFooters(n.storage.values),n._idMap=null,n.oldIdMap={},e){if(!(e[0]instanceof ce)){n.modelClass.exposeProperties(e[0]);const u=e.length,h=new Array(u);for(let g=0;g<u;g++){const f=e[g];if(!a&&f[o]==null)throw new Error(`Id required but not found on row ${g}`);c&&((i=(t=f[o])==null?void 0:t.startsWith)!=null&&i.call(t,"_generated"))&&(console.warn(`Generated id found in data: ${f[o]}. Generated ids are temporary and should be replaced with real ids by the backend`),c=!1),h[g]=n.processRecord(n.createRecord(f,!0),!0),h[g].setData("parentIndex",g)}n.clear(!0),s.replaceValues({values:h,isNewDataset:!0,silent:!0})}else n.clear(!0),s.replaceValues({values:e.slice(),isNewDataset:!0,silent:!0});l&&!s.values.includes(l)&&s.values.push(l),n._data=e,n.onDataReplaced(r,e)}else n.clear(!0),n._data=null;n.isSyncingDataOnLoad=!1}get data(){return this._data}getRange(e,r,t=!0){return(t?this.storage.allValues:this.storage.values).slice(e,r)}createRecord(e,r=!1,t=!1){return new this.modelClass(e,this,null,r,!1,t)}processRecord(e,r=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:r,value:t}){const i=this,n=i._idMap,{idRegister:s,oldIdMap:a}=i;if(i.storage._indicesInvalid=!0,a[r]=e,n&&!n[t]){const o=n[r];delete n[r],n[t]=o}i.added.changeId(r,t),i.removed.changeId(r,t),i.modified.changeId(r,t),delete s[r],s[t]=e,e.index=i.storage.indexOf(e)}onUpdateRecord(e,r){const t=this,{internalId:i}=r,{internalIdRegister:n}=t;i&&(this.storage._indicesInvalid=!0,delete n[i.oldValue],n[i.value]=e),t.reapplyFilterOnUpdate&&t.isFiltered&&t.filter()}get useRawData(){return this._useRawData}set useRawData(e){e===!0?this._useRawData={enabled:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0,disableDefaultValue:!1}:this._useRawData=e?Object.assign(e,{enabled:!0}):{enabled:!1}}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){var e;return this.storage.totalCount-(((e=this.groupRecords)==null?void 0:e.length)||0)}get count(){return this.storage.count}get allCount(){return this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,r=!1){return this.storage.getAt(e,r)}register(e){const r=this;if(!r.useRawData.disableDuplicateIdCheck){const t=r.isTree&&r.idRegister[e.id];if(t&&t!==e)throw new Error(`Id collision on ${e.id}`)}r.idRegister[e.id]=e,r.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){if(e!=null&&e.isModel){const r=e;return r.hasLinks&&!this.storage.allValues.includes(r)?r.$links.find(t=>this.storage.allValues.includes(t)):r}return this.idRegister[e]}isAvailable(e){const r=this.getById(e);return r&&this.storage.includes(r)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?this.idRegister[ce.asId(e)]!=null:this.indexOf(e)>-1}indexOf(e,r=!1,t=!1){if(e!=null&&e.isModel&&!e.stores.includes(this.$store||this)){const s=e.$links.find(a=>this.storage.allValues.includes(a));return s?this.indexOf(s,r):-1}if(this.isTree)return(t?this.rootNode.allChildren:this.storage.values).indexOf(this.getById(e));const i=ce.asId(e);if(i==null)return-1;const n=this.idMap[i];return n?n[r?"visibleIndex":"index"]:-1}allIndexOf(e){return this.isTree?this.allRecords.indexOf(this.getById(e)):this.storage.indexOf(e,!0)}getDistinctValues(e,r=!1){const t=this,i=[],n={};let s;return t.forEach(a=>{if(!a.isSpecialRow&&!a.isRoot){s=a.getValue(e);const o=s instanceof Date?s.getTime():s;n[o]||(i.push(s),n[o]=1)}},t,r),i}getValueCount(e,r){let t=0;return this.forEach(i=>{T.isEqual(i.getValue(e),r)&&t++}),t}set json(e){typeof e=="string"&&(e=O.safeJsonParse(e)),this.data=e}get json(){return O.safeJsonStringify(this)}get formattedJSON(){return O.safeJsonStringify(this,null,4)}toJSON(){return(this.isTree?this.rootNode.unfilteredChildren||this.rootNode.children||[]:this.allRecords).map(e=>e.toJSON())}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.project}getInlineData(e){var r;const t=[];return this.tree?(r=this.rootNode.children)==null||r.forEach(i=>t.push(i.getCurrentConfig(e))):this.forEach(i=>t.push(i.getCurrentConfig(e))),t}getCurrentConfig(e){var r;const t=super.getCurrentConfig(e),{state:i}=this;return t&&(t.data&&(t.data=this.getInlineData(e)),delete t.project,delete t.stm,delete t.asyncEvents,((r=t.modelClass)==null?void 0:r.$meta.hierarchy[t.modelClass.$meta.hierarchy.length-2])===this.constructor.defaultConfig.modelClass&&delete t.modelClass,this.tree||delete t.tree,i&&Object.assign(t,i)),t}forEach(e,r=this,t){const i=this,n=(s,a)=>{if(!s.isRoot&&!s.isSpecialRow)return e.call(r,s,a)};if(t=am(i,t),i.isTree)i.isChained&&(t={...t,sorterFn:i.sorterFn}),i.rootNode.traverseWhile(n,!1,t);else{const s=t.includeFilteredOutRecords?i.storage.allValues:i.storage.values;if(i.isGrouped&&t.includeCollapsedGroupRecords)for(let a=0;a<s.length;a++){const o=s[a],l=t.includeFilteredOutRecords?o.unfilteredGroupChildren:o.groupChildren;if(l&&o.meta.collapsed===!0)for(let c=0;c<l.length;c++){const d=l[c];if(n(d,c)===!1)return}else if(n(o,a)===!1)return}else for(let a=0;a<s.length;a++)if(n(s[a],a)===!1)return}}map(e,r=this){return this.storage.values.map(e,r)}flatMap(e,r=this){return this.storage.values.flatMap(e,r)}every(e,r=this,t){return this.storage[t?"allValues":"values"].every(e,r)}reduce(e,r=[],t=this){return t!==this&&(e=e.bind(t)),this.storage.values.reduce(e,r,t)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,r=this.rootNode,t=r===this.rootNode,i){const n=this;if(i=am(n,i),n.isTree){if(typeof r=="boolean"&&(t=r,r=n.rootNode),n.isChained){const s=e;e=a=>{n.chainedFilterFn(a)&&s(a)}}r.traverse(e,t,i)}else n.forEach(s=>s.traverse(e,!1,i),n,i)}traverseWhile(e,r=this.rootNode,t=r===this.rootNode,i){const n=this;if(i=am(n,i),n.isTree){if(typeof r=="boolean"&&(t=r,r=n.rootNode),n.isChained){const s=e;e=a=>{n.chainedFilterFn(a)&&s(a)}}r.traverseWhile(e,t,i)}else for(const s of n.storage)if(s.traverse(e,!1,i)===!1)break}getNext(e,r=!1,t=!1){const i=this,n=i.storage.values;let s=i.indexOf(e);if(s>=n.length-1)if(r)s=-1;else return null;const a=n[s+1];return t&&a&&a.isSpecialRow?i.getNext(n[s+1],r,!0):a}getPrev(e,r=!1,t=!1){const i=this,n=i.storage.values;let s=i.indexOf(e);if(s===0)if(r)s=n.length;else return null;const a=n[s-1];return t&&a&&a.isSpecialRow&&s>0?i.getPrev(n[s-1],r,!0):a}getAdjacent(e,r=!0,t=!1,i=!1){return r?this.getNext(e,t,i):this.getPrev(e,t,i)}getNextLeaf(e,r=!1){const t=this,i=t.leaves,n=t.getById(e);let s=i.indexOf(n);if(s>=i.length-1)if(r)s=-1;else return null;return i[s+1]}getPrevLeaf(e,r=!1){const t=this,i=t.leaves,n=t.getById(e);let s=i.indexOf(n);if(s===0)if(r)s=i.length;else return null;return i[s-1]}getAdjacentLeaf(e,r=!0,t=!1){return r?this.getNextLeaf(e,t):this.getPrevLeaf(e,t)}};re.initClass(),re._$name="Store";var $P=(e,r)=>(Array.isArray(r[1])?r[1].forEach(t=>e.push(encodeURIComponent(r[0])+"="+encodeURIComponent(t))):e.push(encodeURIComponent(r[0])+"="+encodeURIComponent(r[1])),e),Hd=Promise.resolve(),dl=e=>String(e).padStart(2,"0"),jP=e=>`${e.getFullYear()}-${dl(e.getMonth()+1)}-${dl(e.getDate())}T${dl(e.getHours())}:${dl(e.getMinutes())}:${dl(e.getSeconds())}.${e.getMilliseconds()}`,bt=class extends re{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:null,writeAllFields:null,parentIdParamName:"id",responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",filterParamName:null,restfulFilter:!1,sortParamName:null,pageParamName:null,pageStartParamName:null,pageSizeParamName:"pageSize",pageSize:50,useRestfulMethods:null,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"}}}static get configurable(){return{params:null}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch(()=>{})}get isLoading(){return this._isLoading?2:this.loadTriggerPromise?1:!1}get isCommitting(){return!!this.commitPromise}set pageParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this._pageParamName=e}get pageParamName(){return this._pageParamName}set pageStartParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this._pageStartParamName=e}get pageStartParamName(){return this._pageStartParamName}get isPaged(){return this.pageParamName||this.pageStartParamName}get allCount(){return"remoteTotal"in this?this.remoteTotal:super.allCount}get lastPage(){if(this.isPaged)return Math.floor((this.allCount+this.pageSize-1)/this.pageSize)}buildQueryString(e,...r){const t=e.includes("?"),i=Object.entries(Object.assign({},...r)).reduce($P,[]).join("&");return i?(t?"&":"?")+i:""}async performSort(e){const r=this;if(r.remoteSort&&!r.isRemoteDataLoading){r.isRemoteDataLoading=!0;const t=await r.internalLoad({},"",i=>{r.data=i.data,r.afterPerformSort(e)});return r.isRemoteDataLoading=!1,t}else super.performSort(e)}async performFilter(e){var r;const t=this;if(t.remoteFilter){(r=t.loadingPromise)==null||r.abort(),t.isRemoteDataLoading=!0;const i=t.count,{filters:n}=t;t.currentPage=1;const s=await t.internalLoad({},"",a=>{t.data=a.data,a=e?null:{action:"filter",filters:n,oldCount:i,records:t.storage.values},t.afterPerformFilter(a),t.trigger("refresh",a)});return t.isRemoteDataLoading=!1,s}else super.performFilter(e)}encodeFilterParams(e){const r=[];for(const{property:t,operator:i,value:n,caseSensitive:s}of e)r.push({field:t,operator:i,value:n,caseSensitive:s});return JSON.stringify(r,function(t,i){return t===""?i:this[t]instanceof Date?jP(this[t]):i})}encodeSorterParams(e){return JSON.stringify(e.filter(r=>!r.sortFn).map(r=>r))}buildReadUrl(){const{readUrl:e}=this;return this.restfulFilter&&this.filters.count?(e.endsWith("/")?e:e+"/")+this.filters.first.value:e}internalLoad(e,r,t,i=0){e=T.assign({},this.params,e);const n=this,s=n.buildReadUrl(),a={action:"read"+r,params:e,url:s};if(!s)throw new Error("No load url specified");if(n.trigger("beforeLoad"+r,a)===!1)throw!1;return n.loadArgs=[s,a,e,r,t],i===!1?new Promise((o,l)=>n.sendLoadRequest(o,l)):n.loadTriggerPromise||(n.loadTriggerPromise=new Promise((o,l)=>{n.setTimeout({delay:i,fn:"sendLoadRequest",args:[o,l],cancelOutstanding:!0})}))}async sendLoadRequest(e,r){const t=this,[i,n,s,a,o]=t.loadArgs;if(t.loadTriggerPromise=null,i){if(t._isLoading=!0,t.trigger(`load${a}Start`,n),t.trigger("beforeRequest",n),t.filterParamName&&t.isFiltered&&(s[t.filterParamName]=t.encodeFilterParams(t.filters.values)),t.remoteSort&&t.isSorted&&(s[t.sortParamName]=t.encodeSorterParams(t.groupers?t.groupers.concat(t.sorters):t.sorters)),t.isPaged){if(!(t.pageParamName in s||t.pageStartParamName in s)){const c=Math.min(t.currentPage||1,t.allCount?t.lastPage:1/0);t.pageParamName?s[t.pageParamName]=c:s[t.pageStartParamName]=(c-1)*t.pageSize}s[t.pageSizeParamName]=t.pageSize}const l={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(l.method=t.httpMethods.read,n.body&&(l.body=JSON.stringify(n.body)));try{const c=t.loadingPromise=_r.get(n.url+t.buildQueryString(n.url,s),T.assign(l,t.fetchOptions)),d=await c,u=d.parsedJson,h=Array.isArray(u),g=h||u&&T.getPath(u,t.responseSuccessProperty)!==!1,f=h?null:T.getPath(u,t.responseTotalProperty);if(t.isDestroyed)return;if(t.loadingPromise=null,t._isLoading=!1,n.response=d,n.json=u,g){if(f!=null&&(t.remoteTotal=parseInt(f,10)),t.isPaged)if(t.remoteTotal>=0){const m=t.pageParamName?s[t.pageParamName]:s[t.pageStartParamName]/t.pageSize+1;t.currentPage=Math.min(m,t.lastPage)}else throw new Error("A paged store must receive its responseTotalProperty in each data packet");n.data=h?u:T.getPath(u,t.responseDataProperty),await o(n),!t.isDestroyed&&t.trigger("load"+a,n),e(n)}else Object.assign(n,{exception:!0,exceptionType:"server",error:u==null?void 0:u.error}),!t.isDestroyed&&t.trigger("exception",n),r(n);!t.isDestroyed&&t.trigger("afterRequest",n)}catch(c){t._isLoading=!1,n.exception=!0,c instanceof Response?(n.exceptionType=c.ok?"server":"network",n.response=c,n.error=c.error):(n.exceptionType="server",n.error=c),!t.isDestroyed&&t.trigger("exception",n),r(n),!t.isDestroyed&&t.trigger("afterRequest",n)}}}async load(e){const r=this;return r.isPaged?r.loadPage(r.currentPage||1,e):r.internalLoad(e,"",t=>{r.data=t.data})}async loadChildren(e){return this.readUrl?this.internalLoad({[this.parentIdParamName]:e.id},"Children",r=>{r.parentRecord=e,e.children.length&&e.clearChildren(!0),e.data[e.constructor.childrenField]=r.data,e.processChildren(e.stores)},!1):this.immediatePromise}async loadPage(e,r){this.allCount&&(e=Math.min(e,this.lastPage));const t=this,i=t.pageParamName?{[t.pageParamName]:e}:{[t.pageStartParamName]:(e-1)*t.pageSize};return i[t.pageSizeParamName]=t.pageSize,t.internalLoad(T.assign(i,r),"Page",n=>{t.loadData(n.data,"pageLoad")})}async nextPage(e){const r=this;return r.isPaged&&r.currentPage!==r.lastPage?r.loadPage(r.currentPage+1,e):Hd}async previousPage(e){return this.isPaged&&this.currentPage!==1?this.loadPage(this.currentPage-1,e):Hd}async commit(){const e=this,{changes:r}=e,t=[];if(e.commitPromise)return!1;if(!r)return e.modified.count&&(e.modified.forEach(i=>i.clearChanges(!0,!1)),e.modified.clear()),Hd;if(e.trigger("beforeCommit",{changes:r})!==!1){[...r.added,...r.modified,...r.removed].forEach(s=>s.meta.committing=!0),e.trigger("commitStart",{changes:r});const i={action:"commit",exception:!1,changes:r};let n=e.commitRemoved(i);return n&&t.push(n),n=e.commitAdded(i),n&&t.push(n),n=e.commitModified(i),n&&t.push(n),t.length?(n=t.length===1?t[0]:Promise.all(t),e.commitPromise=new Promise((s,a)=>{n.then(()=>{e.commitPromise=null,i.exception?(e.trigger("exception",i),a(i)):(e.trigger("commit",{changes:r}),s(i))}).catch(()=>{e.commitPromise=null,a(i)})})):(e.modified.forEach(s=>s.clearChanges(!0,!1)),e.modified.clear(),e.added.forEach(s=>s.clearChanges(!0,!1)),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:r}),Hd)}}doAutoCommit(){this.suspendCount<=0&&this.commit().catch(e=>{const{response:r}=e;if(!(r&&(r.ok&&r.parsedJson||[500,404].includes(r.status))))throw e})}commitAdded(e){const r=this,t=r.added,i={action:"create",params:r.params};return t.count&&r.createUrl?new Promise(n=>{const s=t.values.map(c=>c.persistableData);e.create=i,i.body={data:s},r.trigger("beforeRequest",i);let a=i.body;if(r.sendAsFormData){const c=new FormData;c.append("data",JSON.stringify(s)),a=c}const o={headers:r.headers,parseJson:!0},l=r.createUrl+r.buildQueryString(r.createUrl,r.params);r.useRestfulMethods&&(o.method=r.httpMethods.create),_r.post(l,a,T.assign(o,r.fetchOptions)).then(c=>{const d=c.parsedJson,u=Array.isArray(d),h=u||d&&d.success!==!1;e.response=c,i.json=d,i.response=c,h?(r.processReturnedData(t.values,u?d:T.getPath(d,r.responseDataProperty)),t.clear(),r.trigger("commitAdded"),r.trigger("refresh",i),n(e)):(t.forEach(g=>g.meta.committing=!1),e.exception=i.exception=!0,e.exceptionType=i.exceptionType="server",r.trigger("exception",i),n(e)),r.trigger("afterRequest",i)}).catch(c=>{t.forEach(d=>d.meta.committing=!1),e.exception=i.exception=!0,c instanceof Response?(e.response=c,i.exceptionType=c.ok?"server":"network",i.response=c,i.error=c.error):(i.exceptionType="server",i.error=c),r.trigger("exception",i),n(e),r.trigger("afterRequest",i)})}):null}commitModified(e){const r=this,{modified:t}=r.changes,i={action:"update",params:r.params},n=t.length&&r.updateUrl?new Promise(s=>{const a=t.map(c=>r.writeAllFields?c.persistableData:c.modificationDataToWrite).filter(c=>!T.isEmpty(c));if(a.length===0){r.modified.clear(),t.forEach(c=>c.meta.committing=!1),s();return}e.update=i,i.body={data:a},r.trigger("beforeRequest",i);let o=i.body;if(r.sendAsFormData){const c=new FormData;c.append("data",JSON.stringify(a)),o=c}const l={headers:r.headers,parseJson:!0};r.useRestfulMethods&&(l.method=r.httpMethods.update),_r.post(r.updateUrl+r.buildQueryString(r.updateUrl,r.params),o,T.assign(l,r.fetchOptions)).then(c=>{const d=c.parsedJson,u=Array.isArray(d),h=u||d&&d.success!==!1;e.response=c,i.json=d,i.response=c,h?(r.processReturnedData(t,u?d:T.getPath(d,r.responseDataProperty),!0),r.modified.clear(),r.trigger("commitModified"),r.trigger("refresh",i),s(e)):(t.forEach(g=>g.meta.committing=!1),e.exception=i.exception=!0,i.exceptionType="server",r.trigger("exception",i),s(e)),r.trigger("afterRequest",i)}).catch(c=>{t.forEach(d=>d.meta.committing=!1),e.exception=i.exception=!0,c instanceof Response?(e.response=c,i.exceptionType=c.ok?"server":"network",i.response=c,i.error=c.error):(i.exceptionType="server",i.error=c),r.trigger("exception",i),s(e),r.trigger("afterRequest",i)})}):null;return!t.length&&r.modified.count&&r.modified.clear(),n}processReturnedData(e,r,t=!1){const i=this,n=i.modelClass,s=n.fieldMap.id.dataSource;r.forEach((a,o)=>{const l=e[o];l.clearChanges(!0,!1),l.syncId(a[s]),Object.assign(e[o].data,n.processData(a,t,i,l))})}commitRemoved(e){const r=this,t=r.removed,i={action:"delete",params:r.params};return t.count&&r.deleteUrl?new Promise(n=>{e.delete=i,i.body={ids:t.map(o=>o.id)},r.trigger("beforeRequest",i);let s=i.body;if(r.sendAsFormData){const o=new FormData;o.append("id",JSON.stringify(s.ids)),s=o}const a={headers:r.headers,parseJson:!0};r.useRestfulMethods&&(a.method=r.httpMethods.delete),_r.post(r.deleteUrl+r.buildQueryString(r.deleteUrl,r.params),s,T.assign(a,r.fetchOptions)).then(o=>{const l=o.parsedJson,c=Array.isArray(l),d=c||l&&l.success!==!1;e.response=o,i.json=l,i.response=o,d?(t.forEach(u=>u.meta.committing=!1),t.clear(),r.trigger("commitRemoved"),r.trigger("refresh",i),n(e)):(t.forEach(u=>u.meta.committing=!1),e.exception=i.exception=!0,i.exceptionType="server",r.trigger("exception",i),n(e)),r.trigger("afterRequest",i)}).catch(o=>{t.forEach(l=>l.meta.committing=!1),e.exception=i.exception=!0,o instanceof Response?(e.response=o,i.exceptionType=o.ok?"server":"network",i.response=o,i.error=o.error):(i.exceptionType="server",i.error=o),r.trigger("exception",i),n(e),r.trigger("afterRequest",i)})}):null}get remoteFilter(){return!!(this.filterParamName||this.restfulFilter)}get remoteSort(){return!!this.sortParamName}};E(bt,"$name","AjaxStore"),bt._$name="AjaxStore";var Ge=class{static get(e,r){const t=e._domData||(e._domData={});return r!=null?t[r]:t}static remove(e,r){const{_domData:t}=e,i=t==null?void 0:t[r];return t==null||delete t[r],i}static set(e,r,t){arguments.length===3?(e._domData||(e._domData={}))[r]=t:e._domData=r}static assign(e,r){Object.assign(e._domData||(e._domData={}),r)}};Ge._$name="DomDataStore";var AD=()=>{throw new Error("Abstract method call!")},ri=class extends F{get type(){return this.constructor.name}undo(){AD()}redo(){AD()}};ri._$name="ActionBase";var nt=()=>{throw new Error("Abstract method call!")},$e=()=>{throw new Error("Method cannot be called at this state!")},Pi=class extends F{canUndo(e){nt()}canRedo(e){nt()}onUndo(e){nt()}onRedo(e){nt()}onStartTransaction(e){nt()}onStopTransaction(e){nt()}onStopTransactionDelayed(e){nt()}onRejectTransaction(e){nt()}onEnable(e){nt()}onDisable(e){nt()}onAutoRecordOn(e){nt()}onAutoRecordOff(e){nt()}onResetQueue(e){nt()}onModelUpdate(e){nt()}onStoreModelAdd(e){nt()}onStoreModelInsert(e){nt()}onStoreModelRemove(e){nt()}onStoreModelRemoveAll(e){nt()}onModelInsertChild(e){nt()}onModelRemoveChild(e){nt()}};Pi._$name="StateBase";var ke=Symbol("STATE_PROP"),Ai=Symbol("STORES_PROP"),jt=Symbol("QUEUE_PROP"),wr=Symbol("POS_PROP"),Ve=Symbol("TRANSACTION_PROP"),ur=Symbol("TRANSACTION_TIMER_PROP"),Er=Symbol("AUTO_RECORD_PROP"),ul=Symbol("IS_APPLYING_STASH"),H$=Object.freeze([ke,Ai,jt,wr,Ve,ur,Er,ul]),_D=new Map,BP=(e,r)=>{_D.set(e,r)},HP=e=>(typeof e=="string"&&(e=_D.get(e)),e),Fr={registerStmState:BP,resolveStmState:HP},Vd=(e,r)=>{const{undo:t,redo:i}=r;let n;return t&&!i?n={[jt]:e[jt].slice(e.position),[wr]:0}:i&&!t?n={[jt]:e[jt].slice(0,e.position)}:n={[jt]:[],[wr]:0},[n,()=>{e.notifyStoresAboutQueueReset(r)}]},VP=class extends Pi{canUndo(){return!1}canRedo(){return!1}onUndo(){$e()}onRedo(){$e()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){$e()}onAutoRecordOn(){return{[Er]:!0}}onAutoRecordOff(){return{[Er]:!1}}onStartTransaction(){$e()}onStopTransaction(){$e()}onStopTransactionDelayed(){$e()}onRejectTransaction(){$e()}onResetQueue(e,r){return Vd(e,r)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},kD=new VP,NP=kD;Fr.registerStmState("disabledstate",kD);var ra=Symbol("ACTION_QUEUE_PROP"),Nd=class extends F{get defaultConfig(){return{title:null}}construct(...e){this[ra]=[],super.construct(...e)}get queue(){return this[ra].slice(0)}get length(){return this[ra].length}addAction(e){this[ra].push(e)}undo(){const e=this[ra];for(let r=e.length-1;r>=0;--r)e[r].undo()}redo(){const e=this[ra];for(let r=0,t=e.length;r<t;++r)e[r].redo()}};Nd._$name="Transaction";var FD=class extends Pi{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,r){let t=e.position;const i=e[jt],n=Math.max(0,t-r),s=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];for(;t!==n;){const o=i[--t];o.undo(),a.push(o)}return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"undo",transactions:a})}]};return[{[ke]:"restoringstate",[wr]:n},s]}onRedo(e,r){let t=e.position;const i=e[jt],n=Math.min(i.length,t+r),s=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];do{const o=i[t++];o.redo(),a.push(o)}while(t!==n);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"redo",transactions:a})}]};return[{[ke]:"restoringstate",[wr]:n},s]}onEnable(){$e()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[ke]:"autoreadystate",[Er]:!0}}onAutoRecordOff(){$e()}onStartTransaction(e,r){const t=new Nd({title:r});return[{[ke]:"recordingstate",[Ve]:t},()=>{e.notifyStoresAboutStateRecordingStart(t)}]}onStopTransaction(){$e()}onStopTransactionDelayed(){$e()}onRejectTransaction(){$e()}onResetQueue(e,r){return Vd(e,r)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},OD=new FD,zd=OD;Fr.registerStmState("readystate",OD);var LD=class extends Pi{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const r=e[Ve];return e.notifyStoresAboutStateRecordingStop(r,{disabled:!0}),{[ke]:"disabledstate",[Ve]:null}}onAutoRecordOn(e){return[{[ke]:"autorecordingstate",[Er]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){$e()}onStartTransaction(){$e()}onStopTransaction(e,r){const t=e[Ve],i=e[jt];let n=e[wr];return t.length&&(!t.title&&!r&&e.getTransactionTitle?t.title=e.getTransactionTitle(t):r&&(t.title=r),i[n]=t,i.length=++n),[{[ke]:"readystate",[wr]:n,[Ve]:null},()=>{e.notifyStoresAboutStateRecordingStop(t,{stop:!0})}]}onRejectTransaction(e){const r=e[Ve];return[{[ke]:"restoringstate",[Ve]:null},()=>(r.length&&r.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(r,{rejected:!0})}])]}onStopTransactionDelayed(){$e()}onResetQueue(e,r){return Vd(e,r)}onModelUpdate(e,r,t,i,n){e[Ve].addAction(e.makeModelUpdateAction(r,t,i,n))}onModelInsertChild(e,r,t,i,n,s){e[Ve].addAction(e.makeModelInsertChildAction(r,t,i,n,s))}onModelRemoveChild(e,r,t,i){e[Ve].addAction(e.makeModelRemoveChildAction(r,t,i))}onStoreModelAdd(e,r,t,i){e[Ve].addAction(e.makeStoreModelAddAction(r,t,i))}onStoreModelInsert(e,r,t,i,n,s){e[Ve].addAction(e.makeStoreModelInsertAction(r,t,i,n,s))}onStoreModelRemove(e,r,t,i,n){e[Ve].addAction(e.makeStoreModelRemoveAction(r,t,i,n))}onStoreRemoveAll(e,r,t,i){e[Ve].addAction(e.makeStoreRemoveAllAction(r,t,i))}},$D=new LD,zP=$D;Fr.registerStmState("recordingstate",$D);var WP=class extends Pi{static get $name(){return"RestoringStateClass"}canUndo(){return!1}canRedo(){return!1}onUndo(){$e()}onRedo(){$e()}onEnable(){$e()}onDisable(){$e()}onAutoRecordOn(){return{[Er]:!0}}onAutoRecordOff(){return{[Er]:!1}}onStartTransaction(){$e()}onStopTransaction(){$e()}onStopTransactionDelayed(){$e()}onRejectTransaction(){$e()}onQueueReset(){$e()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},jD=new WP,GP=jD;Fr.registerStmState("restoringstate",jD);var UP=class extends FD{onAutoRecordOn(){$e()}onAutoRecordOff(){return{[ke]:"readystate",[Er]:!1}}onStartTransaction(e,r){const t=new Nd({title:r});return[{[ke]:"autorecordingstate",[Ve]:t},()=>{e.notifyStoresAboutStateRecordingStart(t),e.stopTransactionDelayed()}]}onModelUpdate(e,r,t,i){e.startTransaction(),e.onModelUpdate(r,t,i)}onModelInsertChild(e,r,t,i,n){e.startTransaction(),e.onModelInsertChild(r,t,i,n)}onModelRemoveChild(e,r,t,i){e.startTransaction(),e.onModelRemoveChild(r,t,i)}onStoreModelAdd(e,r,t,i){e.startTransaction(),e.onStoreModelAdd(r,t,i)}onStoreModelInsert(e,r,t,i,n,s){e.startTransaction(),e.onStoreModelInsert(r,t,i,n,s)}onStoreModelRemove(e,r,t,i,n){e.startTransaction(),e.onStoreModelRemove(r,t,i,n)}onStoreRemoveAll(e,r,t,i){e.startTransaction(),e.onStoreRemoveAll(r,t,i)}},BD=new UP,om=BD;Fr.registerStmState("autoreadystate",BD);var YP=class extends LD.mixin(fe){onDisable(e){const r=e[Ve],t=e[ur];return t&&this.clearTimeout(t),e.notifyStoresAboutStateRecordingStop(r,{disabled:!0}),{[ke]:"disabledstate",[Ve]:null,[ur]:null}}onAutoRecordOn(e){$e()}onAutoRecordOff(e){const r=e[ur];return r&&this.clearTimeout(r),{[ke]:"recordingstate",[Er]:!1,[ur]:null}}onStopTransaction(e,r){const t=e[Ve],i=e[ur],n=e[jt];let s=e[wr];return i&&this.clearTimeout(i),t.length&&(!t.title&&!r&&e.getTransactionTitle?t.title=e.getTransactionTitle(t):r&&(t.title=r),n[s]=t,n.length=++s),[{[ke]:"autoreadystate",[wr]:s,[Ve]:null,[ur]:null},()=>{e.notifyStoresAboutStateRecordingStop(t,{stop:!0})}]}onStopTransactionDelayed(e){let r=e[ur];return r&&this.clearTimeout(r),r=this.setTimeout(()=>{e.stopTransaction()},e.autoRecordTransactionStopTimeout),{[ke]:lm,[ur]:r}}onResetQueue(e,r){return Vd(e,r)}onRejectTransaction(e){const r=e[Ve],t=e[ur];return t&&this.clearTimeout(t),[{[ke]:"restoringstate",[Ve]:null,[ur]:null},()=>(r.length&&r.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(r,{rejected:!0})}])]}onModelUpdate(e,...r){super.onModelUpdate(e,...r),e.stopTransactionDelayed()}onModelInsertChild(e,...r){super.onModelInsertChild(e,...r),e.stopTransactionDelayed()}onModelRemoveChild(e,...r){super.onModelRemoveChild(e,...r),e.stopTransactionDelayed()}onStoreModelAdd(e,...r){super.onStoreModelAdd(e,...r),e.stopTransactionDelayed()}onStoreModelInsert(e,...r){super.onStoreModelInsert(e,...r),e.stopTransactionDelayed()}onStoreModelRemove(e,...r){super.onStoreModelRemove(e,...r),e.stopTransactionDelayed()}onStoreRemoveAll(e,...r){super.onStoreRemoveAll(e,...r),e.stopTransactionDelayed()}},lm=new YP,qP=lm;Fr.registerStmState("autorecordingstate",lm);var HD=Symbol("MODEL_PROP"),VD=Symbol("NEW_DATA_PROP"),ND=Symbol("OLD_DATA_PROP"),hl=class extends ri{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0,isInitialUserAction:!1}}get type(){return"UpdateAction"}get model(){return this[HD]}set model(e){this[HD]=e}get newData(){return this[VD]}set newData(e){this[VD]={...e}}get oldData(){return this[ND]}set oldData(e){this[ND]={...e}}undo(){const{model:e,oldData:r}=this;e.$&&Object.assign(e,r),e.set(r,null,null,null,!!e.$)}redo(){const{model:e,newData:r}=this;e.$&&Object.assign(e,r),e.set(r,null,null,null,!!e.$)}};hl._$name="UpdateAction";var zD=Symbol("PARENT_MODEL_PROP"),WD=Symbol("CHILD_MODELS_PROP"),GD=Symbol("INSERT_INDEX_PROP"),UD=Symbol("CONTEXT_PROP"),YD=class extends ri{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[zD]}set parentModel(e){this[zD]=e}get childModels(){return this[WD]}set childModels(e){this[WD]=e.slice(0)}get insertIndex(){return this[GD]}set insertIndex(e){this[GD]=e}get context(){return this[UD]}set context(e){this[UD]=e}undo(){const{parentModel:e,context:r,childModels:t}=this,i=new Map,n=new Set;for(const s of t){const a=r.get(s);if(!a)n.add(s);else{let o=i.get(a.parent);o||(o={moveRight:[],moveLeft:[],moveFromAnotherParent:[]},i.set(a.parent,o)),a.parent===e?a.index>s.parentIndex?o.moveRight.push({parent:a.parent,model:s,index:a.index+1}):o.moveLeft.push({parent:a.parent,model:s,index:a.index}):o.moveFromAnotherParent.push({parent:a.parent,model:s,index:a.index})}}for(const s of i.values()){const{moveRight:a,moveLeft:o}=s;o.sort((l,c)=>l.index-c.index),a.sort((l,c)=>c.index-l.index)}n.forEach(s=>s.parent.removeChild(s));for(const s of i.values()){const{moveRight:a,moveLeft:o,moveFromAnotherParent:l}=s;o.forEach(c=>{c.parent.insertChild(c.model,c.index)}),a.forEach(c=>{c.parent.insertChild(c.model,c.index)}),l.forEach(c=>{c.parent.insertChild(c.model,c.index)})}}redo(){var e;const{parentModel:r,insertIndex:t,childModels:i}=this,n=r.children[t];r.insertChild(i,n,!1,{orderedBeforeNode:(e=n==null?void 0:n.previousSibling)==null?void 0:e.nextOrderedSibling})}};YD._$name="InsertChildAction";var qD=Symbol("PARENT_MODEL_PROP"),KD=Symbol("CHILD_MODELS_PROP"),XD=Symbol("CONTEXT_PROP"),ZD=class extends ri{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[qD]}set parentModel(e){this[qD]=e}get childModels(){return this[KD]}set childModels(e){this[KD]=e.slice(0)}get context(){return this[XD]}set context(e){this[XD]=e}undo(){const{parentModel:e,context:r,childModels:t}=this;t.sort((i,n)=>{const s=r.get(i),a=r.get(n);return s-a}),t.forEach(i=>{const n=r.get(i);e.insertChild(i,n.parentIndex,void 0,{orderedParentIndex:n.orderedParentIndex})})}redo(){this.parentModel.removeChild(this.childModels)}};ZD._$name="RemoveChildAction";var JD=Symbol("STORE_PROP"),QD=Symbol("MODEL_LIST_PROP"),ew=class extends ri{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[JD]}set store(e){this[JD]=e}get modelList(){return this[QD]}set modelList(e){this[QD]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}};ew._$name="AddAction";var tw=Symbol("STORE_PROP"),rw=Symbol("MODEL_LIST_PROP"),iw=Symbol("INSERT_INDEX_PROP"),nw=Symbol("CONTEXT_PROP"),sw=class extends ri{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[tw]}set store(e){this[tw]=e}get modelList(){return this[rw]}set modelList(e){this[rw]=e.slice(0)}get insertIndex(){return this[iw]}set insertIndex(e){this[iw]=e}get context(){return this[nw]}set context(e){this[nw]=e}undo(){const{store:e,modelList:r,context:t,silent:i}=this;r.sort((n,s)=>{const a=t.get(n),o=t.get(s);return a!==void 0&&o!==void 0?a-o:0}),r.forEach(n=>{const s=t.get(n);n._undoingInsertion=!0,s!==void 0?e.insert(s,n,i):e.remove(n,i),n._undoingInsertion=!1})}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}};sw._$name="InsertAction";var aw=Symbol("STORE_PROP"),ow=Symbol("MODEL_LIST_PROP"),lw=Symbol("CONTEXT_PROP"),cw=class extends ri{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[aw]}set store(e){this[aw]=e}get modelList(){return this[ow]}set modelList(e){this[ow]=e.slice(0)}get context(){return this[lw]}set context(e){this[lw]=e}undo(){const{store:e,context:r,modelList:t,silent:i}=this;t.sort((n,s)=>{const a=r.get(n),o=r.get(s);return a-o}),t.forEach(n=>{const s=r.get(n);e.insert(s,n,i)})}redo(){this.store.remove(this.modelList,this.silent)}};cw._$name="RemoveAction";var dw=Symbol("STORE_PROP"),uw=Symbol("ALL_RECORDS_PROP"),hw=class extends ri{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[dw]}set store(e){this[dw]=e}get allRecords(){return this[uw]}set allRecords(e){this[uw]=e.slice(0)}undo(){const{store:e,allRecords:r,silent:t}=this;e.add(r,t)}redo(){this.store.removeAll(this.silent)}};hw._$name="RemoveAllAction";var KP=(e,r,t,i)=>new hl({model:e,newData:r,oldData:t,isInitialUserAction:i}),XP=(e,r,t,i)=>new YD({parentModel:e,childModels:t,insertIndex:r,context:i}),ZP=(e,r,t)=>new ZD({parentModel:e,childModels:r,context:t}),JP=(e,r,t)=>new ew({store:e,modelList:r,silent:t}),QP=(e,r,t,i,n)=>new sw({store:e,insertIndex:r,modelList:t,context:i,silent:n}),eA=(e,r,t,i)=>new cw({store:e,modelList:r,context:t,silent:i}),tA=(e,r,t)=>new hw({store:e,allRecords:r,silent:t}),ut=(e,r,...t)=>{const i=e.state,n=r.call(e[ke],e,...t);if(typeof n=="string")e[ke]=Fr.resolveStmState(n);else if(n instanceof Pi)e[ke]=n;else if(Array.isArray(n)){const[s,a]=n;typeof s=="string"?e[ke]=Fr.resolveStmState(s):s instanceof Pi?e[ke]=s:s&&typeof s=="object"&&(e=Object.assign(e,s),e[ke]=Fr.resolveStmState(e[ke])),typeof a=="function"&&ut(e,a,...t)}else n&&typeof n=="object"&&(e=Object.assign(e,n),e[ke]=Fr.resolveStmState(e[ke]));i!==zd&&i!==om&&n!==zd&&n!==om&&e.trigger("ready")},ia=class extends Le(F){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:KP,makeModelInsertChildAction:XP,makeModelRemoveChildAction:ZP,makeStoreModelAddAction:JP,makeStoreModelInsertAction:QP,makeStoreModelRemoveAction:eA,makeStoreRemoveAllAction:tA,getTransactionTitle:null}}construct(...e){Object.assign(this,{[ke]:zd,[Ai]:[],[jt]:[],[wr]:0,[Ve]:null,[ur]:null,[Er]:!1,[ul]:!1,stashedTransactions:{}}),super.construct(...e)}get state(){return this[ke]}get position(){return this[wr]}get length(){return this[jt].length}get stores(){return Array.from(this[Ai])}hasStore(e){return this[Ai].includes(e)}addStore(e){this.hasStore(e)||(this[Ai].push(e),e.stm=this,e.forEach(r=>r.stm=this))}removeStore(e){this.hasStore(e)&&(this[Ai]=this[Ai].filter(r=>r!==e),e.stm=null,e.forEach(r=>r.stm=null))}forEachStore(e){this[Ai].forEach(r=>e(r,r.id))}get disabled(){return this.state===NP}set disabled(e){const r=this;r.disabled!==e&&(e?ut(r,r.state.onDisable,r):ut(r,r.state.onEnable,r),r.trigger("stmDisabled",{disabled:e}),r.trigger("disabled",{disabled:e}))}get enabled(){return!this.disabled}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===zd||this.state===om}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===zP||this.state===qP}get isApplyingStash(){return this[ul]}get autoRecord(){return this[Er]}set autoRecord(e){const r=this;r.autoRecord!=e&&(e?ut(r,r.state.onAutoRecordOn,r):ut(r,r.state.onAutoRecordOff,r))}startTransaction(e=null){ut(this,this.state.onStartTransaction,e)}stopTransaction(e=null){ut(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){ut(this,this.state.onStopTransactionDelayed)}rejectTransaction(){ut(this,this.state.onRejectTransaction)}get transaction(){return this[Ve]}get queue(){return this[jt].map(e=>e.title)}get rawQueue(){return this[jt]}get isRestoring(){return this.state===GP||this.isApplyingStash}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(e=1){this.isReady||await this.waitForReadiness(),ut(this,this.state.onUndo,e)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(e=1){this.isReady||await this.waitForReadiness(),ut(this,this.state.onRedo,e)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){ut(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore(r=>{var t;return(t=r.onStmRecordingStart)==null?void 0:t.call(r,this,e)}),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,r){this.forEachStore(t=>{var i;return(i=t.onStmRecordingStop)==null?void 0:i.call(t,this,e,r)}),this.trigger("recordingStop",{stm:this,transaction:e,reason:r})}notifyStoresAboutStateRestoringStart(){this.forEachStore(e=>{var r;return(r=e.onStmRestoringStart)==null?void 0:r.call(e,this)}),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop({cause:e,transactions:r}){this.forEachStore(t=>{var i;return(i=t.onStmRestoringStop)==null?void 0:i.call(t,this)}),this.trigger("restoringStop",{stm:this,cause:e,transactions:r})}notifyStoresAboutQueueReset(e){this.forEachStore(r=>{var t;return(t=r.onStmQueueReset)==null?void 0:t.call(r,this,e)}),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,r,t,i){ut(this,this.state.onModelUpdate,e,r,t,i)}onModelInsertChild(e,r,t,i){ut(this,this.state.onModelInsertChild,e,r,t,i)}onModelRemoveChild(e,r,t){ut(this,this.state.onModelRemoveChild,e,r,t)}onStoreModelAdd(e,r,t){ut(this,this.state.onStoreModelAdd,e,r,t)}onStoreModelInsert(e,r,t,i,n){ut(this,this.state.onStoreModelInsert,e,r,t,i,n)}onStoreModelRemove(e,r,t,i){ut(this,this.state.onStoreModelRemove,e,r,t,i)}onStoreRemoveAll(e,r,t){ut(this,this.state.onStoreRemoveAll,e,r,t)}onUndoKeyPress(e){const r=this;r.enabled&&(e.shiftKey?r.canRedo&&(e.preventDefault(),r.redo()):r.canUndo&&(e.preventDefault(),r.undo()))}stash(){const e=this;if(this.transaction){const r=ti.generateId("_stashedTransactionGeneratedId_");return e.stashedTransactions[r]=e.transaction,e.rejectTransaction(),r}}applyStash(e){const r=this,t=r.stashedTransactions[e];r[ul]=!0,t&&(r.startTransaction(t.title),t.redo(),delete r.stashedTransactions[e]),r[ul]=!1}};ia._$name="StateTrackingManager";var cm=class{static insertRule(e,r=document.head){const t=this.getStyleSheet(r),i=t.cssRules.length;if(t.insertRule(e,0),t.cssRules.length>i)return t.cssRules[0]}static findRule(e){let r;const t=typeof e=="function";return Array.prototype.find.call(document.head.querySelectorAll("link[rel=stylesheet],style[type*=css]"),i=>{if(r=Array.prototype.find.call(i.sheet.rules||i.sheet.cssRules,n=>t?e(n):n.selectorText===e),r)return!0}),r}static getStyleSheet(e=document.head){return e.$bryntumStylesheet||(e.$bryntumStylesheet=w.createElement({tag:"style",id:"bryntum-private-styles",type:"text/css",parent:e}).sheet),e.$bryntumStylesheet}static getCSSVersion(){return getComputedStyle(document.documentElement).getPropertyValue("--bryntum-version").replace(/[" ]/gm,"")}};cm._$name="CSSHelper";var gw=Array.prototype.slice,fw=Object.freeze([]),rA=Object.freeze({}),mw=/[&<]/,{getPrototypeOf:pw}=Object,{toString:iA}=Object.prototype,{isEqual:vw,isObject:nA}=T,sA={parent:1,elementData:1,ns:1,syncOptions:1},yw=()=>({ignore:sA,refsFound:new Set}),bw={class:1,className:1,classname:1},aA={bigint:1,boolean:1,function:1,number:1,string:1,symbol:1},oA={tag:1,html:1,text:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,listeners:1,isReleased:1,null:1,"":1,keepChildren:1},lA=(e,r)=>{const t="className"in r?"className":"class",i=r[t];if(i)if(typeof i=="string"){const n=i.split(" ");n.includes(e)||(n.push(e),r[t]=n.join(" "))}else Array.isArray(i)?i.includes(e)||i.push(e):i.isDomClassList?i.add(e):T.isObject(i)&&(i[e]=1)},cA=(e,r)=>{const t="className"in r?"className":"class",i=r[t];if(i)if(typeof i=="string"){const n=i.split(" ");n.includes(e)&&(n.splice(n.indexOf(e),1),r[t]=n.join(" "))}else Array.isArray(i)?i.includes(e)&&i.splice(i.indexOf(e),1):i.isDomClassList?i.remove(e):T.isObject(i)&&delete i[e]},X=class{static checkEquality(e,r,t,i){var n;if(e===r)return!0;if(e==null)return r==null;if(!e||!r)return!1;const s=typeof e;if(s!==typeof r||aA[s])return!1;let o=t.equalityCache||(t.equalityCache=new Map),l=!!i,c,d,u,h,g,f,m;if(o=o.get(e)||o.set(e,new Map).get(e),c=o.get(r),c===void 0){if(c=!0,pw(e)!==pw(r)||e instanceof Node)c=!1;else if(Array.isArray(e)){if(d=e.length,d!==r.length)c=!1;else for(;d-- >0;)if(!X.checkEquality(e[d],r[d],t,l)){c=!1;break}}else{f=e.syncOptions,h=f==null?void 0:f.ignoreRefs,h&&(l=!0,i=h!=="children"),u=t.ignore||rA;for(g in r)if(!u[g]&&!(g in e)&&!(i&&g==="reference")){c=!1;break}if(c){if(iA.call(r)==="[object Date]")c=e.getTime()===r.getTime();else for(g in e)if(!u[g]&&!(i&&g==="reference")){if(!(g in r)){c=!1;break}if(m=e[g],!X.checkEquality(m,r[g],t,l)){c=!1;break}}}}!i&&nA(e)&&e.reference&&((n=t.refsFound)==null||n.add(e.reference)),o.set(r,c)}return c}static sync(e){const r=e,{refOwner:t}=e,i=t==null?void 0:t.byRef,n=yw();let s=e.affected,a,o,l,c;if(typeof s=="string"&&(s=[s]),e={...e,checkEqualityOptions:n},t){if(t.byRef={},s)for(o in i)s.includes(o)||(t.byRef[o]=i[o]);e.refsWas=i}if(r.changed=X.performSync(e,e.targetElement),t)for(s||(s=Object.keys(i)),a=0;a<s.length;++a)o=s[a],l=i[o],n.refsFound.has(o)||l.retainElement?t.byRef[o]=l:(c=l.lastDomConfig,l.remove(),t.detachRef(o,l,c));return e.targetElement}static performSync(e,r){const{domConfig:t,callback:i}=e,{lastDomConfig:n}=r;if((e.configEquality||X.checkEquality)(t,n,e.checkEqualityOptions,e.ignoreRefs))i==null||i({action:"none",domConfig:t,targetElement:r});else return t?(t.onlyChildren||(X.syncAttributes(t,r,e),X.syncContent(t,r)),t.keepChildren||X.syncChildren(e,r)):(r.innerHTML=null,r.syncIdMap=null),r.lastDomConfig=t!=null&&t.onlyChildren&&n?{...n,children:t.children}:t,!0;return!1}static syncDataset(e,r){const{lastDomConfig:t}=r,i=e===t,n=Object.keys(e.dataset),s=t&&t.dataset&&Object.keys(t.dataset),a=H.delta(n,s);let o,l,c,d;for(l=0;l<a.onlyInA.length;l++)o=a.onlyInA[l],d=e.dataset[o],d!=null&&r.setAttribute(`data-${O.hyphenate(o)}`,d);for(l=0;l<a.inBoth.length;l++)o=a.inBoth[l],d=e.dataset[o],(i||d!=t.dataset[o])&&(c=`data-${O.hyphenate(o)}`,d==null?r.removeAttribute(c):r.setAttribute(c,d));for(l=0;l<a.onlyInB.length;l++)r.removeAttribute(`data-${O.hyphenate(a.onlyInB[l])}`)}static addCls(e,r){const{lastDomConfig:t}=r;e=J.normalize(e,"array"),e.forEach(i=>{r.classList.add(i),lA(i,t)})}static removeCls(e,r){const{lastDomConfig:t}=r;e=J.normalize(e,"array"),e.forEach(i=>{r.classList.remove(i),cA(i,t)})}static syncClassList(e,r,t){let i=e.className||e.class,n=!1,s,a,o,l,c,d;if(t){for(a=J.normalize(r,"array"),i=J.normalize(i,"object"),d=J.normalize(t.className||t.class,"object"),c=[],o=0,l=a.length;o<l;++o)s=a[o],i[s]||!(s in d)?(d[s]=1,c.push(s)):n=!0;for(s in i)d[s]||(c.push(s),n=!0);if(!n)return;i=c.join(" ")}else i=J.normalize(i);r.setAttribute("class",i)}static getSyncAttributes(e){const r={},t=[];return e&&Object.keys(e).forEach(i=>{if(!oA[i]){const n=i.toLowerCase();r[n]=e[i],t.push(n)}}),{attributes:r,names:t}}static syncAttributes(e,r,t){const{lastDomConfig:i}=r,n=e===i,s=X.getSyncAttributes(e),{attributes:a,names:o}=s,{attributes:l,names:c}=n?s:X.getSyncAttributes(i),{onlyInA:d,onlyInB:u,inBoth:h}=n?{onlyInA:fw,onlyInB:fw,inBoth:o}:H.delta(o,c);let g,f;for(f=0;f<d.length;f++){g=d[f];const m=a[g];g==="style"&&m!=null?w.applyStyle(r,m,!0):g==="dataset"?X.syncDataset(e,r):bw[g]?X.syncClassList(e,r):m!=null&&r.setAttribute(g,m)}for(f=0;f<u.length;f++)r.removeAttribute(u[f]);for(f=0;f<h.length;f++){g=h[f];const m=a[g],p=l[g];m==null?r.removeAttribute(g):g==="style"?t.strict?n?X.syncStyles(r,m):vw(m,p,!0)||X.syncStyles(r,m,p):(n||!vw(m,p,!0))&&w.applyStyle(r,m,!0):g==="dataset"?X.syncDataset(e,r):bw[g]?X.syncClassList(e,r,t.strict&&r.lastDomConfig):(n||m!==p)&&r.setAttribute(g,m)}}static syncStyles(e,r,t){let i,n,s;if(!t)i=r;else{if(i={},r=w.parseStyle(r),t=w.parseStyle(t),r)for(n in r)s=r[n],t[n]!==s&&(i[n]=s);for(n in t)n in r||(i[n]="")}w.applyStyle(e,i)}static syncContent(e,r){var t;const{html:i,text:n}=e,s=n!=null?n:i;if(r.didSetTextContent=!1,e.elementData&&(r.elementData=e.elementData),s instanceof DocumentFragment)r.childNodes.length===1&&w.getChildElementCount(r)===0&&s.childNodes.length===1&&w.getChildElementCount(s)===0?w.setInnerText(r,s.firstChild.data):(r.innerHTML="",r.appendChild(s));else if(i!=null&&mw.test(i))r.innerHTML=String(i);else if(s!=null){const{lastDomConfig:a}=r;(t=a==null?void 0:a.children)!=null&&t.length||a!=null&&a.html&&mw.test(r.lastDomConfig.html)?r.innerHTML=s:(w.setInnerText(r,String(s)),r.didSetTextContent=!0)}}static insertTextNode(e,r,t,i,n=null){const s=document.createTextNode(e);r.insertBefore(s,n),i&&(s.$refOwnerId=i.id),t==null||t({action:"newNode",domConfig:e,targetElement:s})}static insertElement(e,r,t,i,n,s,a){var o;const l=a.ns?document.createElementNS(a.ns,e.tag||"svg"):document.createElement(e.tag||"div");r.insertBefore(l,t),X.performSync(a,l),s!=null&&(n[s]=l),!e.role&&!e.tabIndex&&!e["aria-hidden"]&&!w.isFocusable(l,!0)&&!l.htmlFor&&l.setAttribute("role","presentation"),i&&(l.$refOwnerId=i.id,s&&(l.$reference=s,i.attachRef(s,l,e))),(o=a.callback)==null||o.call(a,{action:"newElement",domConfig:e,targetElement:l,syncId:s})}static syncChildren(e,r){var t,i,n;let{domConfig:s,syncIdField:a,callback:o,releaseThreshold:l,configEquality:c,ns:d,refOwner:u,refsWas:h,strict:g,checkEqualityOptions:f,ignoreRefs:m}=e,p=null,v,y,C;const D=s.syncOptions||{};if((t=s.html)!=null?t:s.text)return;m=!!((i=D.ignoreRefs)!=null?i:m),m&&(u=h=null),"strict"in D&&(g=D.strict);const S=u?u.byRef:{},x=gw.call(s.children||[]),R=gw.call(r.childNodes),I=h||r.syncIdMap||{},M=r.releasedIdMap||{},P=A=>{for(;R.length&&R[0].parentNode!==r;)R.shift();return(A?R.shift():R[0])||null};a=D.syncIdField||a,g=D.strict||g,o=D.callback||o,c=D.configEquality||c,l="releaseThreshold"in D?D.releaseThreshold:l,a&&(r.syncIdMap=S);const _={checkEqualityOptions:f||yw(),ignoreRefs:m,refOwner:u,refsWas:h,strict:g,syncIdField:a,releaseThreshold:l,callback:o,configEquality:c};for(;x.length;){const A=x.shift();if(C=null,!A)continue;if(w.isReactElement(A)){o({jsx:A,targetElement:r});continue}if(Array.isArray(A)){this.syncChildren({...e,domConfig:{...e.domConfig,children:A}},r);continue}if(A instanceof Node){y=P(),A!==y&&r.insertBefore(A,y),v=R.indexOf(A),v>-1&&R.splice(v,1);continue}const z=typeof A=="string";if(_.domConfig=A,_.ns=A.ns||d,!z){if(u?C=A.reference:a&&A.dataset&&(C=A.dataset[a]),C!=null&&!A.unmatched){const K=I[C]||M[C];if(K){const{lastDomConfig:le}=K;K.retainElement||X.performSync(_,K)&&(o==null||o({action:"reuseOwnElement",domConfig:A,targetElement:K,lastDomConfig:le,syncId:C})),A.retainElement&&(K.retainElement=!0),S[C]=K,H.remove(R,K),delete M[C],K.isReleased=!1,y=P(),(K.parentNode!==r||g&&K.nextSibling!==y)&&r.insertBefore(K,y)}else g?X.insertElement(A,r,P(),u,S,C,_):(x.push(A),A.unmatched=!0);continue}A.unmatched&&delete A.unmatched}let Y=null,V=null,U;for(;!V&&(U=P(!0));){if(u){if(U.$refOwnerId!==u.id)continue;if(U.$reference){if(!g)continue;Y=U;break}V=U}else U.retainElement||(V=U);V||(p||(p=[])).push(U)}if(Y||!V)z?X.insertTextNode(A,r,o,u,Y):X.insertElement(A,r,Y,u,S,C,_);else if(!z&&V.nodeType===Node.ELEMENT_NODE&&(A.tag||"div").toLowerCase()===V.tagName.toLowerCase()){const{lastDomConfig:K}=V,le=X.performSync(_,V);if(a&&((n=K==null?void 0:K.dataset)==null?void 0:n[a])!=null){const Ce=K.dataset[a];delete M[Ce],delete I[Ce]}C!=null&&(S[C]=V),V.isReleased=!1,le&&(o==null||o({action:"reuseElement",domConfig:A,targetElement:V,lastDomConfig:K,syncId:C}))}else z&&V.nodeType===Node.TEXT_NODE?V.data=A:(z?X.insertTextNode(A,r,o,u,V):X.insertElement(A,r,V,u,S,C,_),V.remove())}if(!(r.didSetTextContent&&R.length===1&&R[0].nodeType===Node.TEXT_NODE)){for(;y=P(!0);)(!u||y.$refOwnerId===u.id&&!y.$reference)&&(p||(p=[])).push(y);p&&X.syncChildrenCleanup(r,p,S,o,u,l,a)}}static syncChildrenCleanup(e,r,t,i,n,s,a){let o=0,l;for(const c of r){const{lastDomConfig:d}=c;if(c.nodeType===Element.TEXT_NODE){c.remove();continue}c.retainElement?a&&d&&(t[c.dataset[a]]=c):!n&&a&&(s==null||o<s)?(c.isReleased||(c.className="b-released",c.isReleased=!0,d!=null&&d.dataset&&(e.releasedIdMap||(e.releasedIdMap={}),e.releasedIdMap[d.dataset[a]]=c),i==null||i({action:"releaseElement",domConfig:d,lastDomConfig:d,targetElement:c}),d&&(d.isReleased=!0,d.className&&(d.className="b-released"),d.class&&(d.class="b-released"),d.style&&(d.style=null))),o++):(c.remove(),n&&(l=c.$reference,l&&n.detachRef(l,c,d)),e.releasedIdMap&&a&&(d!=null&&d.dataset)&&delete e.releasedIdMap[d.dataset[a]],i==null||i({action:"removeElement",domConfig:c.lastDomConfig,lastDomConfig:c.lastDomConfig,targetElement:c}))}}static removeChild(e,r){if(e.contains(r)){const t=e.syncIdMap;if(t){const i=Object.values(t).indexOf(r);i>-1&&delete t[Object.keys(t)[i]]}e.removeChild(r)}}static addChild(e,r,t){e.appendChild(r),e.syncIdMap||(e.syncIdMap={}),e.syncIdMap[t]=r}static getChild(e,r){var t;const i=String(r).split(".");for(const n of i)if(e=(t=e==null?void 0:e.syncIdMap)==null?void 0:t[n],!e)return null;return e}};X._$name="DomSync";var Or=class{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],r=s=>e.map(a=>{let o=s+O.capitalize(a);return s==="moz"&&(o=o.replace("screen","Screen"),"mozCancelFullScreen"in document&&a==="exitFullscreen"&&(o="mozCancelFullScreen")),o});this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&r("webkit")||"mozFullScreenEnabled"in document&&r("moz")||"msFullscreenEnabled"in document&&r("ms")||[];const t=["fullscreenchange","fullscreenerror"],i=["MSFullscreenChange","MSFullscreenError"],n=s=>t.map(a=>s+O.capitalize(a));this.events="fullscreenEnabled"in document&&t||"webkitFullscreenEnabled"in document&&n("webkit")||"mozFullscreenEnabled"in document&&n("moz")||"msFullscreenEnabled"in document&&i||[],this.onFullscreenChange(this.onInternalFullscreenChange.bind(this))}static get enabled(){return!!(this.functions[0]&&document[this.functions[0]])}static async request(e){return this.functions[1]&&(e==null?void 0:e[this.functions[1]]())}static async exit(){return this.functions[2]&&document[this.functions[2]]()}static get isFullscreen(){return!!this.element}static get element(){return this.functions[3]&&document[this.functions[3]]}static onFullscreenChange(e){this.events[0]&&document.addEventListener(this.events[0],e)}static unFullscreenChange(e){this.events[0]&&document.removeEventListener(this.events[0],e)}static onInternalFullscreenChange(){const e=this,{element:r}=e;if(r){if(!r.closest(".b-floatroot")){const t=w.getRootElement(r),{floatRoot:i}=t;i&&(e._floatRoot=i,e._oldParent=i.parentElement,r.appendChild(i))}}else e._floatRoot&&e._oldParent.appendChild(e._floatRoot),e._oldParent=null,e._floatRoot=null}};Or.init(),Or._$name="Fullscreen";var dm=null,um=[],dA=e=>{var r;return e.nodeType===e.ELEMENT_NODE&&((r=e.ownerDocument.defaultView)==null?void 0:r.getComputedStyle(e).getPropertyValue("position"))==="absolute"},st=class{static addResizeListener(e,r){const t=this;if((e===document||e===globalThis)&&(e=document.body),e.nodeType===e.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)t.hasWindowResizeListener||(globalThis.addEventListener("resize",t.onWindowResize),t.hasWindowResizeListener=!0);else if(globalThis.ResizeObserver)t.resizeObserver||(t.resizeObserver=new ResizeObserver(t.onElementResize)),t.resizeObserver.observe(e);else{e.classList.add("b-no-resizeobserver");const[i,n,s]=w.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},{returnAll:!0});n.scrollLeft=n.scrollTop=s.scrollLeft=s.scrollTop=1e6,n.addEventListener("scroll",t.onSizeMonitorScroll,!0),s.addEventListener("scroll",t.onSizeMonitorScroll,!0),(r.targetMutationMonitor=new MutationObserver(a=>{const o=[],l=[];for(const d of a)d.type==="childList"&&(o.push.apply(o,d.addedNodes),l.push.apply(l,d.removedNodes));const c=[...o.filter(d=>!l.includes(d)),...l.filter(d=>!o.includes(d))];c.length!==0&&(c.length>0&&c.every(dA)||n.dispatchEvent(new CustomEvent("scroll",{bubbles:!1})))})).observe(e,{childList:!0,subtree:!0}),r.monitorElement=i}e._bResizemonitor.handlers.push(r)}static removeResizeListener(e,r){if(e){(e===document||e===globalThis)&&(e=document.body);const t=e._bResizemonitor;let i=0;t&&t.handlers&&(H.remove(t.handlers,r),i=t.handlers.length),i||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(r.monitorElement&&(r.monitorElement.remove(),r.monitorElement=null),r.targetMutationMonitor&&r.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(const r of e){const t=r.target,i=t._bResizemonitor,n=r.contentRect||t.getBoundingClientRect();if(Ii(t)&&(!i.rectangle||n.width!==i.rectangle.width||n.height!==i.rectangle.height)){const s=i.rectangle;i.rectangle=n;for(const a of i.handlers)a(t,s,n)}}}static onSizeMonitorScroll(e){var r;if((r=document.body)!=null&&r.contains(e.target)){e.stopImmediatePropagation();const t=e.target.parentNode,i=t.parentNode,n=i._bResizemonitor,s=i.getBoundingClientRect();(!n.rectangle||s.width!==n.rectangle.width||s.height!==n.rectangle.height)&&(um.push([i,n.rectangle,s]),n.rectangle=s,dm||(dm=requestAnimationFrame(st.fireResizeEvents))),t.firstChild.scrollLeft=t.firstChild.scrollTop=t.childNodes[1].scrollTop=t.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){const r=document.body,t=r._bResizemonitor,i=t.rectangle;t.rectangle=document.documentElement.getBoundingClientRect();for(const n of t.handlers)n(r,i,t.rectangle)}static fireResizeEvents(){for(const e of um)for(const r of e[0]._bResizemonitor.handlers)e[0].offsetParent&&r.apply(this,e);dm=null,um.length=0}static removeGlobalListeners(){globalThis.removeEventListener("resize",this.onWindowResize)}};st._$name="ResizeMonitor";var Cw={auto:"auto",true:"auto",false:"hidden","hidden-scroll":"auto",clip:q.supportsOverflowClip?"clip":"hidden"},Sw="b-widget-scroller",hm={block:"nearest"},Dw=Promise.resolve(),ww=e=>new Promise(r=>B.on({element:e===document.documentElement?globalThis:e,scroll:r,once:!0})),uA={x:1},Wd={auto:1,scroll:1},hA={true:1,auto:1},gA={overflowX:"auto",overflowY:"auto"},fA=e=>{var r,t,i,n;let s,a,o,l;return e?typeof e=="number"?s=a=o=l=e:(s=(r=e.top)!=null?r:0,a=(t=e.bottom)!=null?t:0,o=(i=e.start)!=null?i:0,l=(n=e.end)!=null?n:0):s=a=o=l=0,{top:s,bottom:a,start:o,end:l}},xr=class extends fe(Le(F)){static get configurable(){return{widget:null,element:{$config:{nullify:!0},value:null},contentElement:{$config:{nullify:!0},value:null},overflowX:null,overflowY:null,translate:null,x:0,y:0,rtlSource:null,propagateSync:null}}static get delayable(){return{onScrollEnd:{type:"buffer",delay:100}}}get isRTL(){var e;return!!((e=this.rtlSource)!=null&&e.rtl)}syncOverflowState(){const e=this,{element:r}=e,t=new J(r.classList),i=e.hasOverflowX=r.scrollWidth>r.clientWidth,n=e.hasOverflowY=r.scrollHeight>r.clientHeight;t.value=r.classList,(t.toggle("b-horizontal-overflow",i)||t.toggle("b-vertical-overflow",n))&&(w.syncClassList(r,t),e.isConfiguring||e.trigger("overflowChange",{x:i,y:n}))}hasOverflow(e="y"){const r=this,t=r[`overflow${e.toUpperCase()}`],i=r[`overflow${e==="y"?"x":"y"}`];if(!w.scrollBarWidth||!hA[t]||i==="hidden-scroll"){const n=e==="y"?"Height":"Width";return r[`scroll${n}`]>r[`client${n}`]}return r[`hasOverflow${e.toUpperCase()}`]}hasScrollbar(e="y"){const{element:r}=this;if(r&&w.scrollBarWidth){const t=e==="y",i=t?"Width":"Height",n=r[`client${i}`],s=parseInt(w.getStyleValue(r,`border${t?"Left":"Top"}Width`))+parseInt(w.getStyleValue(r,`border${t?"Right":"Bottom"}Width`)),a=r[`offset${i}`]-s-n;return Math.abs(a-w.scrollBarWidth)<2}}addPartner(e,r=uA){const t=this;typeof r=="string"&&(r={[r]:1}),t.partners||(t.partners={}),t.partners[e.id]={scroller:e,axes:r},r.x&&(e.x=t.x),r.y&&(e.y=t.y),e.isPartneredWith(t)||e.addPartner(t,r)}eachPartner(e){const{partners:r}=this;r&&Object.values(r).forEach(e)}removePartner(e){e&&this.isPartneredWith(e)&&(delete this.partners[e.id],e.removePartner(this))}isPartneredWith(e){var r;return!!((r=this.partners)!=null&&r[e.id])}clearPartners(){this.partners&&Object.values(this.partners).forEach(e=>e.scroller.removePartner(this))}async scrollIntoView(e,r=hm){const t=this,{isRectangle:i}=e,n=i?e:k.from(e),{xDelta:s,yDelta:a}=t.getDeltaTo(e,r),o=t.scrollBy(s,a,r);return(r.highlight||r.focus)&&o.then(()=>{i&&(e=n.translate(-s,-a)),r.highlight&&(isNaN(r.highlight)?(t.widget||t).callback(r.highlight,null,[e]):w.highlight(e,t)),r.focus&&w.focusWithoutScrolling(e)}),o}static async scrollIntoView(e,r=hm,t=!1){const i=k.from(e),n=typeof r=="object"?r.animate:r,s=xr._globalScroller||(xr._globalScroller=new xr),a=[];s.rtlSource={rtl:t};let o=0,l=0,c;for(let d=e.parentNode;d.nodeType===Node.ELEMENT_NODE;d=d.parentNode){if(d===document.body&&d!==document.scrollingElement)continue;const u=d===document.scrollingElement?gA:d.ownerDocument.defaultView.getComputedStyle(d);if(r.y!==!1&&Wd[u.overflowY]&&d.scrollHeight>d.clientHeight||r.x!==!1&&Wd[u.overflowX]&&d.scrollWidth>d.clientWidth){s.element=d,s.positionDirty=!0;const{xDelta:h,yDelta:g}=s.getDeltaTo(i,r);(h||g)&&(a.push({element:d,x:d.scrollLeft,y:d.scrollTop,xDelta:h,yDelta:g}),i.translate(-h,-g),o+=h,l+=g)}}if(a.length){const d=Math.abs(o),u=Math.abs(l);let h=n&&(typeof n=="number"?n:typeof n.duration=="number"?n.duration:300);if(h&&(d>10||u>10))Math.max(d,u)<50&&(h=Math.min(h,500)),c=s.scrollAnimation=Te.animate(h,g=>{const f=g===1;for(const{element:m,x:p,y:v,xDelta:y,yDelta:C}of a)s.element=m,y&&(s.x=Math[t?"min":"max"](p+(f?y:Math.round(y*g)),0)),C&&(s.y=Math.max(v+(f?C:Math.round(C*g)),0))},null,n.easing),c.then(()=>{s.scrollAnimation=null});else{for(const{element:g,xDelta:f,yDelta:m}of a)g.scrollTop+=m,g.scrollLeft+=f;c=ww(a[a.length-1].element)}}else c=Dw;return(r.highlight||r.focus)&&c.then(()=>{r.highlight&&(isNaN(r.highlight)?s.callback(r.highlight,null,[e]):w.highlight(e,s)),r.focus&&e.focus()}),c}scrollBy(e=0,r=0,t=hm){const i=this,n=typeof t=="object"?t.animate:t,s=Math.abs(e),a=Math.abs(r);i.scrollAnimation&&(i.scrollAnimation.cancel(),i.scrollAnimation=null),(e||r)&&(i.silent=t.silent);let o=n&&(typeof n=="number"?n:typeof n.duration=="number"?n.duration:300);if(o&&(s>10||a>10)){const{x:l,y:c}=i;let d=l,u=c;return Math.max(s,a)<50&&(o=Math.min(o,500)),i.scrollAnimation=Te.animate(o,h=>{var g,f;const m=h===1;if(e){if(Math.abs(i.x-d)>1&&!t.force)return(g=i.scrollAnimation)==null?void 0:g.cancel();i.x=Math.max(l+(m?e:Math.round(e*h)),0)}if(r){if(Math.abs(i.y-u)>1&&!t.force)return(f=i.scrollAnimation)==null?void 0:f.cancel();i.y=Math.max(c+(m?r:Math.round(r*h)),0)}d=i.x,u=i.y},i,n.easing),i.element.classList.add("b-scrolling"),i.scrollAnimation.then(()=>{i.isDestroyed||(i.element.classList.remove("b-scrolling"),i.scrollAnimation=null)}),i.scrollAnimation}else{if(e||r){const l=i.x,c=i.y;if(i.x+=e,i.y+=r,i.x!==l||i.y!==c)return ww(i.element)}return Dw}}async scrollTo(e,r,t){const{x:i,y:n}=this,s=e==null?0:e-i,a=r==null?0:r-n;return this.scrollBy(s,a,t)}doDestroy(){var e,r;const t=this;t._element&&(t._element.removeEventListener("scroll",t.scrollHandler),(e=t.wheelListenerRemover)==null||e.call(t)),(r=t.scrollAnimation)==null||r.cancel(),Object.values(t.partners||{}).forEach(({scroller:i})=>i.removePartner(t)),super.doDestroy()}onElMutation(e){const r=this,[t,i]=w.getTranslateXY(r.element);if(r._x!==-t||r.y!==-i){const n=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(n,"target",{get:()=>r.element}),r.onScroll(n)}}onElResize(){const e=this,{widget:r}=e;r!=null&&r.isAnimating?r.findListener("animationend","onElResize",e)===-1&&r.ion({animationEnd:"onElResize",thisObj:e,once:!0}):e.syncOverflowState()}onScroll(e){const r=this,{_x:t,_y:i,element:n}=r;let s=0;r.overflowX==="clip"&&n.scrollLeft!==t&&(n.scrollLeft=t,++s),r.overflowY==="clip"&&n.scrollTop!==i&&(n.scrollTop=i,++s),s!==2&&(!r.widget||!r.widget.isDestroyed)&&(r.positionDirty=!0,n.classList.contains("b-scrolling")||n.classList.add("b-scrolling"),e.widget=r.widget,r.silent||r.trigger("scroll",e),r.syncPartners(),r.controllingPartner=null,r.onScrollEnd(e))}syncPartners(e,r=this.propagateSync){const t=this;t.partners&&Object.values(t.partners).forEach(({axes:i,scroller:n})=>{(n!==t.controllingPartner||e)&&n.sync(t,i)&&r&&n.syncPartners(e,r)})}onScrollEnd(e){const r=this;r.silent&&(r.silent=!1),r.trigger("scrollEnd",e),r.controllingPartner=null,r.element.classList.remove("b-scrolling")}getDeltaTo(e,r){const t=this;if(!t.viewport)return{xDelta:0,yDelta:0};const{x:i,y:n,scrollWidth:s,scrollHeight:a,isRTL:o}=t,l=e instanceof k?e:k.from(e),c=r.block||"nearest",d=t.viewport,u=fA(r.edgeOffset),h=d.width>=l.width+(u.start+u.end)?u:{start:0,end:0},g=d.height>=l.height+(u.top+u.bottom)?u:{top:0,bottom:0},f=new k(o?d.right- -i-s:d.x-i,d.y-n,s,a),m=l.clone().adjust(-h.start,-g.top,h.end,g.bottom).constrainTo(f),p=m.clone(),v=t.isRTL?-1:1;let y=0,C=0;if(c==="start")p.moveTo(d.x+(t.isRTL?d.width-p.width:0),d.y),y=m.x-p.x,C=m.y-p.y;else if(c==="end")p.moveTo(d.x+(t.isRTL?0:d.width-p.width),d.bottom-p.height),y=m.x-p.x,C=m.y-p.y;else if(c==="center"){const D=d.center;p.moveTo(D.x-p.width/2,D.y-p.height/2),y=y||m.x-p.x,C=C||m.y-p.y}else p.width>d.width?y=p.x-d.x:p.right>d.right?y=p.right-d.right:p.x<d.x&&(y=p.x-d.x),p.height>d.height?C=p.y-d.y:p.bottom>d.bottom?C=p.bottom-d.bottom:p.y<d.y&&(C=p.y-d.y);return y=v*Math.round(y),C=Math.round(C),{xDelta:r.x===!1?0:Math.max(Math.min(y,t.maxX-i),-i),yDelta:r.y===!1?0:Math.max(Math.min(C,t.maxY-n),-n)}}get viewport(){return k.client(this.element)}updateWidget(e){this.rtlSource=this.owner=e}updateElement(e,r){var t;const i=this;if(i===xr._globalScroller){i._element=e,i.positionDirty=!0;return}const n=i.scrollHandler||(i.scrollHandler=i.onScroll.bind(i)),s=i.resizeHandler||(i.resizeHandler=i.onElResize.bind(i));if(r&&(i.translate?(t=i.mutationObserver)==null||t.disconnect():(r.removeEventListener("scroll",n),r.classList.remove(Sw),r.style.overflowX=r.style.overflowY=""),st.removeResizeListener(r,s)),e){if(i.translate){if(i.mutationObserver||(i.mutationObserver=new MutationObserver(i.mutationHandler||(i.mutationHandler=i.onElMutation.bind(i)))),i._x=i._y=0,document.contains(e)){const[a,o]=w.getTranslateXY(e);i._x=-a,i._y=-o}i.mutationObserver.observe(e,{attributes:!0})}else e.addEventListener("scroll",n),e.classList.add(Sw);st.addResizeListener(e,s),i.widget||(i.rtlSource={get rtl(){return w.getStyleValue(e,"direction")==="rtl"}}),i.isRTL&&e.classList.add("b-rtl"),i.positionDirty&&(i.updateOverflowX(i.overflowX),i.updateOverflowY(i.overflowY)),i.syncOverflowState(),i.isConfiguring&&(i._x&&i.updateX(i._x),i._y&&i.updateY(i._y))}i.positionDirty=!0}get x(){const e=this,{element:r}=e;if(r&&e.positionDirty){if(e.translate){const[t,i]=w.getTranslateXY(r);e._x=-t,e._y=-i}else e._x=Math.abs(r.scrollLeft),e._y=r.scrollTop;e.positionDirty=!1}return e._x}get scrollLeft(){return this.x*(this.isRTL?-1:1)}changeX(e){if(e=Math.max(e,0),!this.isConfiguring||e)return e;this._x=e}updateContentElement(e){e&&(e=typeof e=="string"?this.element.querySelector(e):e,st.addResizeListener(e,this.resizeHandler))}updateX(e){var r;const t=this,{element:i}=t;i&&!((r=t.widget)!=null&&r.isConfiguring)&&(e=Math.round(e),t.trigger("scrollStart",{x:e}),t.translate?w.setTranslateX(i,-e):i.scrollLeft=t.isRTL?-e:e),t.positionDirty=!0}sync(e,r){const t=this,{x:i,y:n}=r;let s=!1;return i!=null&&t.x!==e.x&&(t.controllingPartner=e,t.x=e.x,s=!0),n!=null&&t.y!==e.y&&(t.controllingPartner=e,t.y=e.y,s=!0),s}get y(){const e=this,{element:r}=e;if(r&&e.positionDirty){if(e.translate){const[t,i]=w.getTranslateXY(r);e._x=-t,e._y=-i}else e._x=r.scrollLeft,e._y=r.scrollTop;e.positionDirty=!1}return e._y}changeY(e){if(!this.isConfiguring||e)return e;this._y=e}updateY(e){const{element:r,widget:t}=this;r&&!(t!=null&&t.isConfiguring)&&(this.trigger("scrollStart",{y:e}),this.translate?w.setTranslateY(r,-e):r.scrollTop=e),this.positionDirty=!0}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}get lastScrollLeft(){return(this.scrollWidth-this.clientWidth)*(this.isRTL?-1:1)}updateOverflowX(e,r){const t=this,{element:i,translate:n}=t,{style:s,classList:a}=i;r==="hidden-scroll"&&a.remove("b-hide-scroll"),e==="hidden-scroll"&&!n&&(Wd[s.overflowY]?(e="hidden",t.enableWheel()):a.add("b-hide-scroll")),n||(s.overflowX=Cw[e]||e),t.isConfiguring||(t.positionDirty=!0,t.syncOverflowState())}updateOverflowY(e,r){const t=this,{element:i,translate:n}=t,{style:s,classList:a}=i;r==="hidden-scroll"&&a.remove("b-hide-scroll"),e==="hidden-scroll"&&!n&&(Wd[s.overflowX]?(e="hidden",t.enableWheel()):a.add("b-hide-scroll")),n||(s.overflowY=Cw[e]||e),t.isConfiguring||(t.positionDirty=!0,t.syncOverflowState())}enableWheel(){this.wheelListenerRemover||(this.wheelListenerRemover=B.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&this.overflowX==="hidden-scroll"?this.x+=e.deltaX:this.overflowY==="hidden-scroll"&&(this.y+=e.deltaY)}get scrollWidth(){var e,r;return(r=(e=this.element)==null?void 0:e.scrollWidth)!=null?r:0}set scrollWidth(e){const r=this,{element:t,isRTL:i}=r;let n=r.widthStretcher;n&&e==null?(n.remove(),r.widthStretcher=null):e&&(e=Math.abs(e),n||(n=r.widthStretcher=w.createElement({className:"b-scroller-stretcher b-horizontal-stretcher",retainElement:!0})),n.style.transform=`translateX(${(e-1)*(i?-1:1)}px)`,t&&!t.contains(n)&&t.insertBefore(n,t.firstElementChild)),r.propagate!==!1&&r.eachPartner(({scroller:s})=>{s.propagate=!1,s.scrollWidth=e,delete s.propagate}),r.positionDirty=!0,r.syncOverflowState()}get scrollHeight(){var e,r;return(r=(e=this.element)==null?void 0:e.scrollHeight)!=null?r:0}set scrollHeight(e){const r=this,t=r.stretcher||(r.stretcher=w.createElement({className:"b-scroller-stretcher"}));t.style.transform=`translateY(${e-1}px)`,r.element&&r.element.lastChild!==t&&r.element.appendChild(t),r.positionDirty=!0,r.syncOverflowState()}get clientWidth(){var e;return((e=this.element)==null?void 0:e.clientWidth)||0}get clientHeight(){var e;return((e=this.element)==null?void 0:e.clientHeight)||0}get id(){return this._id||(this.widget?this._id=`${this.widget.id}-scroller`:this._id=ti.generateId("scroller-")),this._id}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(),delete e.widget,delete e.element}};xr._$name="Scroller";var gl=class{constructor(e){this.promise=new Promise((r,t)=>{this.resolve=r,this.reject=t}),e&&e(this)}};gl._$name="Promissory";var{defineProperty:gm}=Reflect,Tn=class extends F.mixin(We,Le,fe,ea){static get configurable(){return{element:null}}static get delayable(){return{refreshDom:"raf"}}static get identifiable(){return{}}static get renderConfigs(){const e=this,r=e.$meta;let t=r.renderConfigs,i,n;if(t===void 0){t=null,i=r.configs;for(n in i)i[n].render&&(t||(t=new Set)).add(n);r.renderConfigs=e.prototype.$renderConfigs=t}return t}construct(...e){this.$iid=++Tn.$idSeed,this.byRef={},super.construct(...e),this.onDraw!==Tn.prototype.onDraw&&this.initDrawable()}startConfigure(e){this.element=this.renderContext.renderDom(),super.startConfigure(e)}get element(){return this.refreshDom.flush(),this._element}changeElement(e,r){const t=this;return r&&r.remove(),e&&(e.id=t.id,e=w.createElement(e,{refOwner:t})),e}updateId(e,r){const t=this;if(r){const i=t.element;i.id=e,t.fixRefOwnerId(i,e,r)}}get classes(){return this.element.classList}fixRefOwnerId(e,r,t){if(e.$refOwnerId===t){e.$refOwnerId=r;const i=e.$reference;i&&(e.id=`${r}-${i}`);for(const n of e.childNodes)this.fixRefOwnerId(n,r,t)}}onConfigChange({name:e}){!this.isConfiguring&&this.$renderConfigs.has(e)&&this.refreshDom()}attachRef(e,r,t){const i=this,n="_"+e,{listeners:s}=t;n in i||gm(i,e,{get(){return i.refreshDom.flush(),i[n]},set(a){i[n]=a}}),r.id=`${i.id}-${e}`,i.byRef[e]=r,i[e]=r,s&&(t.listeners={on:s,un:B.on(Object.assign({element:r,thisObj:i},s))})}detachRef(e,r,t){t.listeners&&(t.listeners.un(),t.listeners=null),this[e]=null,delete this.byRef[e]}renderDom(){return{}}get renderContext(){const e=this,r=e.$meta,t=e.constructor;let i=r.renderConfigs||t.renderConfigs,n=e;if(!i){n=Object.create(e),i=new Set;for(const s in r.configs)gm(n,s,{get(){return i.add(s),e[s]}});n.renderDom=()=>e.renderDom.call(n),e.$renderConfigs=i}return gm(e,"renderContext",{value:n}),n}refreshDom(){X.sync({targetElement:this.element,domConfig:this.renderContext.renderDom(),refOwner:this,strict:!0})}onListen(e){e==="draw"&&this.initDrawable()}initDrawable(){const e=this;if(!e.intersector){let r=Object.values(e.byRef).find(t=>t.classList.contains("b-drawable"));r||(r=e.element,r.classList.add("b-drawable")),e.intersector=new IntersectionObserver(t=>{e.isDestroyed||t.forEach(i=>{i.isIntersecting&&e.onDraw({count:++e.drawCounter})})}),e.intersector.observe(r)}}onDraw(e){this.trigger("draw",e)}};Tn.$idSeed=0,Object.assign(Tn.prototype,{drawCounter:0,hasGeneratedId:!1,intersector:null}),Tn._$name="Renderable";var fl=class extends Tn{construct(e){if(e){let i=e.element,n;i&&(ne.deprecate("Core","4.0.0",'Mask "element" config has been renamed to "target"'),e=n=Object.assign({},e),delete n.element,n.target=i),i=e.target,typeof i=="string"&&(e=n=n||Object.assign({},e),n.target=e.owner[i])}super.construct(e);const r=this,{type:t}=r;r.target||(r.target=document.body),r.maskName=`mask${typeof t=="string"?t.trim():""}-${fl.counter++}`,r.show()}doDestroy(){const e=this,{element:r}=e;if(e.type==="trial")return!1;r&&(e.element=null,e.mode.endsWith("blur")&&w.forEachChild(r,t=>{t.classList.remove(`b-masked-${e.mode}`)}),e.target.classList.remove("b-masked"),e.target[e.maskName]=null,H.remove(fl.masks,e)),super.doDestroy()}get maskElement(){return this.element}set error(e){this.setConfig(this.errorDefaults),this.text=e}renderDom(){const e=this,{maxProgress:r}=e;return{class:{"b-mask":1,"b-delayed-show":e.showDelay,"b-widget":1,[`b-mask-${e.mode}`]:1,"b-progress":r,"b-prevent-transitions":!e.useTransition},children:[{reference:"maskContent",class:"b-mask-content b-drawable",children:[r?{reference:"progressElement",class:"b-mask-progress-bar",style:{width:`${Math.max(0,Math.min(100,Math.round(e.progress/r*100)))}%`}}:null,{reference:"maskText",class:"b-mask-text",html:(e.icon?`<i class="b-mask-icon ${e.icon}"></i>`:"")+e.text}]}]}}static mergeConfigs(...e){const r={};for(const t of e)typeof t=="string"?r.text=t:T.assign(r,t);return r}static mask(e,r=document.body){return fl.new({target:r},typeof e!="string"?{...e}:{text:e})}static unmask(e=document.body){const r=this.getElementMasks(e);return r.length>0?r[r.length-1].close():null}static unmaskAll(e=document.body){return this.getElementMasks(e).forEach(r=>r.close())}static getElementMasks(e){return this.masks.filter(r=>r.target===e)}updateAutoClose(e){this.deferredClose.cancel(),e&&(this.deferredClose.delay=e,this.deferredClose())}updateCover(){this.syncCover()}syncCover(){var e,r;(r=(e=this.owner)==null?void 0:e.syncMaskCover)==null||r.call(e,this)}onOwnerResize(){this.syncCover()}updateOwner(e){this.detachListeners("cover"),e==null||e.ion({name:"cover",recompose:"onOwnerResize",resize:"onOwnerResize",thisObj:this})}updateShowDelay(e){const{delayedShow:r}=this;r.delay=e,e||r.flush()}deferredClose(){var e;const{owner:r}=this;this.close().then(()=>{var t;(t=r==null?void 0:r.onMaskAutoClose)==null||t.call(r,this)}),(e=r==null?void 0:r.onMaskAutoClosing)==null||e.call(r,this)}delayedShow(){this.classes.remove("b-delayed-show")}show(){const e=this,{element:r,target:t,hiding:i,maskName:n}=e;i&&(i.resolve(),e.hiding=null,e.clearTimeout("hide")),e.showDelay&&(r.classList.add("b-delayed-show"),e.delayedShow()),r.classList.add("b-visible"),r.classList.remove("b-hidden"),t.classList.add("b-masked"),t[n]||(t[n]=e,t.appendChild(r)),H.include(fl.masks,e),e.shown=!0,e.trigger("show"),e.mode.endsWith("blur")&&w.forEachChild(t,s=>{s!==r&&s.classList.add(`b-masked-${e.mode}`)})}hide(){const e=this,{target:r,element:t}=e;let{hiding:i}=e;if(!i){if(!e.shown)return Promise.resolve();e.hiding=i=new gl,e.shown=!1,t.classList.remove("b-visible"),t.classList.add("b-hidden"),r.classList.remove("b-masked"),e.mode.endsWith("blur")&&w.forEachChild(r,n=>{n!==t&&n.classList.remove(`b-masked-${e.mode}`)}),i.promise=i.promise.then(()=>{e.hiding===i&&(e.hiding=null)}),e.setTimeout(()=>i.resolve(),500,"hide")}return i.promise}async close(){await this.hide(),this.destroy()}},Bt=fl;E(Bt,"$name","Mask"),E(Bt,"type","mask"),E(Bt,"configurable",{autoClose:null,cover:null,icon:"b-icon b-icon-spinner",errorDefaults:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},maxProgress:null,mode:"dark",progress:null,owner:{$config:"nullify",value:null},target:null,text:null,type:null,showDelay:null,useTransition:!1}),E(Bt,"delayable",{deferredClose:0,delayedShow:0,syncCover:{type:"throttle",delay:100}}),E(Bt,"counter",0),E(Bt,"masks",[]),Bt._$name="Mask";var Ew=e=>{var r;return r=class extends(e||F){get widgetClass(){}get keyMapElement(){return this.element}get keyMapSubComponents(){return this.features}matchKeyMapEntry(t,i=this.keyMap){if(i&&!t.handled&&t.key!==void 0)return T.keys(i).find(n=>{const s=n.split("+"),a=s.includes("Alt"),o=s.includes("Shift"),l=s.includes("Ctrl");let c=s[s.length-1].toLowerCase();return c==="space"&&(c=" "),c===t.key.toLowerCase()&&(!t.altKey&&!a||t.altKey&&a)&&(!t.ctrlKey&&!l||t.ctrlKey&&l)&&(!t.shiftKey&&!o||t.shiftKey&&o)})}performKeyMapAction(t){var i;const{keyMap:n}=this;let s=!1;if(n&&!t.handled&&t.key!==void 0){const a=this.matchKeyMapEntry(t);if(n[a]){const o=H.asArray(n[a]);t.fromKeyMap=!0;let l;for(let c of o){if(l=!0,T.isObject(c)){if(!c.handler)continue;c.preventDefault===!1&&(l=!1),c=c.handler}if(typeof c=="string"){const{thisObj:d,handler:u}=this.resolveKeyMapAction(c);if(((i=d.isActionAvailable)==null?void 0:i.call(d,{key:a,action:c,event:t,actionName:c.split(".").pop()}))!==!1&&u.call(d,t)!==!1){s=!0;break}}else if(c.call(this)!==!1){s=!0;break}}delete t.fromKeyMap,s&&(l&&t.preventDefault(),t.handled=!0)}}return s}resolveKeyMapAction(t){const{keyMapSubComponents:i}=this;if(t.startsWith("up.")||t.startsWith("this."))return this.resolveCallback(t);if(i&&t.includes(".")){const[n,s]=t.split(".");if(n&&s)return{thisObj:i[n],handler:i[n][s]}}return{thisObj:this,handler:this[t]}}updateKeyMap(t){var i;(i=this.keyMapDetacher)==null||i.call(this),T.isEmpty(t)||(this.keyMapDetacher=B.on({element:this.keyMapElement,keydown:"keyMapOnKeyDown",thisObj:this}))}keyMapOnKeyDown(t){this.performKeyMapAction(t)}mergeKeyMaps(t,i,n=null){const s={};t&&T.assign(s,t);for(const a in i){if(!i[a])continue;const o=H.asArray(t==null?void 0:t[a]),l=[];o!=null&&o.length&&l.push(...o);for(const c of H.asArray(i[a]))T.isObject(c)&&c.handler?l.push(T.assignIf({handler:(n?n+".":"")+c.handler},c)):l.push((n?n+".":"")+c);l.sort((c,d)=>{const u=(c.weight||0)-(d.weight||0);return u===0&&(o!=null&&o.length)?o.indexOf(c)-o.indexOf(d):u}),s[a]=l}return s}},E(r,"$name","KeyMap"),E(r,"configurable",{keyMap:{value:null,$config:{merge:"objects",nullify:!0}}}),r},xw=e=>{var r;return r=class extends(e||F){get widgetClass(){}get isRTL(){return this.rtl}updateRtl(t){const{element:i}=this;i&&(i.classList.toggle("b-rtl",t===!0),i.classList.toggle("b-ltr",t===!1))}startConfigure(t){var i,n;if((i=super.startConfigure)==null||i.call(this,arguments),!t.floating&&t.rtl==null){const s=this,a=t.rootElement||t.forElement||((n=s.parent)==null?void 0:n.contentElement)||(s.floating?s.floatRoot:s.changeElementRef(s.getRenderContext(t)[0]||t.adopt||document.body)),o=t.owner||t.parent||s.constructor.fromElement(a);o?t.rtl=o[o.isConfiguring?"peekConfig":"getConfig"]("rtl"):t.rtl=(a==null?void 0:a.nodeType)===1&&getComputedStyle(a).getPropertyValue("direction")==="rtl",t.rtl&&(s.configDone.rtl=!1)}}render(...t){var i,n;super.render&&super.render(...t),(q.isChrome&&q.chromeVersion<87||q.isFirefox&&q.firefoxVersion<66||q.isSafari&&q.safariVersion<14.1)&&this.element.classList.add("b-legacy-inset"),(getComputedStyle(this.element).direction==="rtl"||(i=this.owner)!=null&&i.rtl)&&(this.rtl=!0,(n=this.childItems)==null||n.forEach(s=>s.rtl=!0))}},E(r,"$name","RTL"),E(r,"configurable",{rtl:null}),r},Rw=Object.freeze({highlight:!1,onlyName:!1}),ml=[],fm="highlightExternalChange",mm=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,Gd=Symbol("renderConfigObserver"),mA={INPUT:1,TEXTAREA:1},pm=(e,r,t,i)=>{let n=(t==null?void 0:t.listeners)||(t==null?void 0:t.internalListeners);if(n=(n==null?void 0:n.on)||n,n){const s=B.on(T.assign({element:r,thisObj:e},n));i?(e._refListeners||(e._refListeners=Object.create(null)))[i]=s:t.listeners={on:n,un:s}}},Tw=(e,r)=>e&&r&&r[T.keys(e)[0]]?Pe.merge(e,r):e,pA=e=>{e.isVisible&&e.triggerPaint()},vA=/^:not\((.+)\)$/,yA=/absolute|fixed/i,bA=e=>e.scale!=null,{hasOwn:Mn}=T,{defineProperty:Mw}=Reflect,Iw=e=>parseFloat(e)*(e.endsWith("ms")?1:1e3),Pw=["b-aligned-above","b-aligned-right","b-aligned-below","b-aligned-left"],CA={configurable:!0,get(){return!1}},Ud=/(?:L\{([^}.]+)\})/,SA=(e,r)=>"L{Tooltip."+r+"}",Aw=/^([trblc])(\d*)-([trblc])(\d*)$/i,DA=(e,r)=>(Aw.test(e)&&(e={align:e}),Aw.test(r)&&(r={align:r}),Pe.merge(e,r)),wA=/^[\w.]+$/,_w={1:"maxHeight",2:"height",4:"maxWidth",8:"width"},$=class extends F.mixin(We,Le,fe,ea,En,Ew,xw){static mergeCls(e,r){return r&&e?e=new J(r).assign(typeof e=="string"?new J(e):e):e&&!e.isDomClassList&&(e=new J(e)),e}static get $name(){return"Widget"}static get type(){return"widget"}static get configurable(){return{element:!0,callOnFunctions:!0,id:"",html:null,content:null,cls:{$config:{merge:"classList"},value:null},ui:{$config:{merge:"classList"},value:null},collapsify:null,contentElementCls:{$config:{merge:"classList"},value:null},defaultCls:{$config:{merge:"classList"},value:null},dock:null,forwardTwinEvents:{$config:{merge:"classList"},value:null},parent:null,tab:null,elementAttributes:null,htmlCls:{$config:{merge:"classList"},value:{"b-html":1}},style:null,disabled:null,readOnly:{value:null,default:!1,$config:null},ignoreParentReadOnly:null,adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:{$config:["lazy","nullify"],value:null},showTooltipWhenDisabled:!0,preventTooltipOnTouch:null,monitorResize:{$config:["lazy","nullify"],value:null},masked:{$config:"nullify",value:null},maskDefaults:{target:"element"},cache:{},floating:null,positioned:null,draggable:null,align:{$config:{merge:DA},value:"t-b"},centered:null,constrainTo:void 0,anchor:null,owner:null,scrollAction:null,hideAnimation:{$config:{merge:Tw},value:null},showAnimation:{$config:{merge:Tw},value:null},x:null,y:null,scrollable:{$config:["lazy","nullify"],value:null},scrollerClass:xr,defaultBindProperty:"html",defaultAction:null,overflowable:{value:null,default:!0,$config:null},width:null,height:null,maxHeight:null,maxWidth:null,minWidth:null,minHeight:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,weight:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title","ariaLabel","ariaDescription"],requireSize:!1,ref:null,hidden:null,textAlign:null,ignoreScrollDuration:500,tag:"div",recomposeAsync:null,rootElement:null,htmlMutationObserver:{$config:["lazy","nullify"],value:{childList:!0,subtree:!0}},role:{$config:"lazy",value:"presentation"},ariaLabel:{$config:"lazy",value:null},ariaDescription:{$config:"lazy",value:null},ariaElement:"element",ariaHasPopup:null,realignTimeout:300,testConfig:{ignoreScrollDuration:100,realignTimeout:50},maximizeOnMobile:null}}static get prototypeProperties(){return{hasGeneratedId:!1,innerItem:!0}}static get declarable(){return["renderConfigs"]}static get delayable(){return{recompose:"raf",doHideOrRealign:"raf",onAlignConstraintChange:"raf"}}static get factoryable(){return{defaultType:"widget"}}static get identifiable(){return{}}static get all(){return super.all}static get recomposeAsync(){return $._recomposeAsync}static set recomposeAsync(e){if($._recomposeAsync=e,e!=null){const{all:r}=$;for(let t=0;t<r.length;++t)r[t].isComposable&&(r[t].recomposeAsync=e)}}isType(e,r){return $.isType(this,e,r)}static setupRenderConfigs(e,r){const t=r.getInherited("renderConfigs"),{renderConfigs:i}=e;if(i){if(Array.isArray(i))for(const n of i)t[n]=!0;else T.assign(t,i);t[Gd]=null}}construct(e={},...r){const t=this,{domSyncCallback:i}=t;if(!globalThis.bryntum.cssVersion){const s=globalThis.bryntum.cssVersion=cm.getCSSVersion(),a=ne.getVersion("core");s&&s!==a&&console.warn(`CSS version ${s} doesn't match bundle version ${a}!
Make sure you have imported css from the appropriate product version.`)}t.configureAriaDescription=e.ariaDescription,t._isAnimatingCounter=0,t.alignmentChanges=0,t.byRef=Object.create(null),t.onTargetResize=t.onTargetResize.bind(t),t.onFullscreenChange=t.onFullscreenChange.bind(t),t.domSyncCallback=i.$nullFn?null:i.bind(t),t._isUserAction=!1,super.construct(e,...r);const{recomposeAsync:n}=$;n!=null&&t.recomposeAsync==null&&(t.recomposeAsync=n),t.finalizeInit()}startConfigure(e){super.startConfigure(e);const r=this,{adopt:t,element:i}=r;t&&(r.adoptElement(i,t,e.id),r.updateElement(r._element,i))}finalizeInit(){var e;const r=this,t=r.insertBefore||r.appendTo||r.insertFirst||r.adopt;t&&(r.owner||(e=t.nodeType?t:document.getElementById(t))!=null&&e.isConnected?r.render():(r.onFirstResizeAfterConnect=r.onFirstResizeAfterConnect.bind(r),st.addResizeListener(t,r.onFirstResizeAfterConnect)))}onFirstResizeAfterConnect(e){st.removeResizeListener(e,this.onFirstResizeAfterConnect),!this.isDestroyed&&!this.rendered&&this.render()}doDestroy(){var e,r,t,i;const n=this,{preExistingElements:s,element:a,adopt:o,_refListeners:l,_rootElement:c}=n;if(Or.element===a&&Or.exit(),l&&(Object.values(l,d=>d()),n._refListeners=null),a){const d=!n._tooltip&&c&&((e=$.Tooltip)==null?void 0:e.getSharedTooltip(c,n.eventRoot,!0));if((d==null?void 0:d.owner)===n&&(d.owner=null,d.hide()),n.onExitFullscreen(),n.clearTimeout(n.scrollListenerTimeout),n.clearTimeout(n.resizeListenerTimeout),n.removeTransientListeners(),n.floating||n.positioned?n.hide(!1):n.revertFocus(),st.removeResizeListener(a.parentElement,n.onParentElementResize),st.removeResizeListener(a,n.onElementResize),o){for(let u=Array.from(a.childNodes),h=0,{length:g}=u;h<g;h++){const f=u[h];!s.includes(f)&&f!==n.floatRoot&&f.remove()}a.className=n.adoptedElementClassName,a.style.cssText=n.adoptedElementCssText}(r=n.dragEventDetacher)==null||r.call(n),(t=n.dragOverEventDetacher)==null||t.call(n),n.dragGhost.remove()}(i=n.connectedObserver)==null||i.disconnect(),super.doDestroy(),o||a.remove()}get assignValueDefaults(){return Rw}get valueName(){return this.name||this.ref||this.id}getValueName(e){return e=e&&typeof e=="object"?e.onlyName:e,e?this.name:this.valueName}assignFieldValue(e,r,t){const i=this,n=i.defaultBindProperty;n in i&&(i[n]=t)}assignValue(e,r=Rw){const t=this,i=t[fm],n=t.getValueName(r);n&&(!e||n in e)&&(r.highlight===!1&&(t[fm]=!1),t.assignFieldValue(e,n,e?e[n]:null),t[fm]=i)}gatherValue(e){const r=this,t=r.defaultBindProperty;r.constructor!==$&&t in r&&(e[r.name||r.ref||r.id]=r[t])}gatherValues(e){this.eachWidget(r=>r.gatherValue(e),!1)}get forwardTwinEvents(){const e=this._forwardTwinEvents;return e&&T.getTruthyKeys(e)}configureOverflowTwin(e){var r;const t=this;let i=T.clone(t.initialConfig);return delete i.id,i.hidden=!1,i.type=t.type,i._overflowTwinOrigin=t,i.disabled=t.disabled,"value"in t&&(i.value=t.value),(r=t.forwardTwinEvents)==null||r.forEach(n=>{delete i[`on${O.capitalize(n)}`]}),e&&(i=typeof e=="function"?e(i)||i:T.assign(i,e)),i}createOverflowTwin(e){var r;const t=this,i=t.configureOverflowTwin(e),n=$.create(i);return(r=t.forwardTwinEvents)==null||r.forEach(s=>{n.ion({[s]:a=>{t.overflowTwin===a.source&&(a=T.assign({},a),delete a.source,t.trigger(a.eventName,a))}})}),n}ensureOverflowTwin(e,r){let{overflowTwin:t}=this;return t||(this.overflowTwin=t=this.createOverflowTwin(e),r==null||r(t)),t}get isComposable(){return!this.compose.$nullFn}adoptElement(e,r,t){var i;const n=this,s=typeof r=="string"?document.getElementById(r):r,a=$.fromElement(s);a&&a.adopt&&a!==n&&(typeof a.adopt=="string"?document.getElementById(a.adopt):a.adopt)===s&&a.destroy(),n.preExistingElements=Array.from(s.childNodes),n.adoptedElementClassName=s.className,n.adoptedElementCssText=s.style.cssText,s.id&&!t&&(n.id=e.id=s.id),w.syncAttributes(e,s);for(let c=0,{length:d}=e.childNodes;c<d;c++)s.appendChild(e.childNodes[0]);delete n._contentRange,n._element=s;const o=e.lastDomConfig,l=o==null?void 0:o.listeners;l&&n.isComposable&&((i=l.un)==null||i.call(l),pm(n,s,o)),s.lastDomConfig=o||s.lastDomConfig,s.$refOwnerId=n.id,n.scaleToFitWidth||n.getConfig("monitorResize")}addRefAccessor(e,r){const{prototype:t}=this.constructor;Mw(t,r,{writable:!0,value:null}),Mw(t,e,{get(){return this.recompose.flush(),this[r]},set(i){this[r]=i}})}attachRef(e,r,t){const i=this,n="_"+e;r.dataset&&(r.dataset.ownerCmp=i.id),i.isComposable&&(n in i||i.addRefAccessor(e,n),pm(i,r,t,e)),i.byRef[e]=r,i[e]=r}detachRef(e,r,t){const i=this,n=i._refListeners;n!=null&&n[e]&&(n[e](),delete n[e]),i[e]=null,delete i.byRef[e]}afterRecompose(){}compose(){return{class:J.normalize(this.widgetClassList,"object")}}doCompose(){const e=this,{$meta:r}=e,t=r.hierarchy,i=r.renderConfigs||r.getInherited("renderConfigs");let{composers:n}=r,s=null,a,o,l,c;if(e.recompose.suspend(),!n){for(r.composers=n=[],l=t.indexOf($);l<t.length;++l)c=t[l].prototype,Mn(c,"compose")&&n.push(c);Mn(i,Gd)||(i[Gd]={get(d){i[d]=!0}})}for(e.configObserver=i[Gd],l=0;l<n.length;++l)a=n[l].compose.call(e,s),s=s?w.merge(s,a):a;return Mn(e,"compose")&&(a=e.compose)&&(a=a.call(e,s),w.merge(s,a)),e.configObserver=null,w.normalizeChildren(s,(d,u)=>{u&&(o="_"+d,o in e||e.addRefAccessor(d,o))})}get element(){return this.isComposable&&!this.isDestroying&&this.recompose.flush(),this._element}domSyncCallback(e){}changeElement(e){const r=this,t=r.isComposable;return t&&(e=r.doCompose()),typeof e=="string"?e=w.createElementFromTemplate(e):T.isObject(e)?(e=w.createElement(e,{refOwner:r,callback:r.domSyncCallback}),r.recompose.resume(),t&&pm(r,e,e.lastDomConfig)):w.isReactElement(r.peekConfig("html"))?e=document.createElement("div"):e.nodeType!==1&&(e=w.createElementFromTemplate(r.template(r))),e.id=r.id,r.elementAttributes&&w.setAttributes(e,r.elementAttributes),e}updateElement(e){const r=this,{className:t}=e,{contentElement:i,contentElementCls:n,isComposable:s}=r,a=i!==e,o=!s&&e.querySelectorAll("[data-reference]"),l=s?[]:r.widgetClassList;let c=(a||!s)&&r.uiClasses;if(t&&l.unshift(t),r._hidden&&l.push("b-hidden"),r._readOnly&&l.push("b-readonly"),Te.noThrow(e,"remove"),c?(n!=null&&n.value&&(c=c.slice(),c.push(n.value)),c=c.join(" ")):c=n==null?void 0:n.value,c&&(a?i.className+=" "+c:l.push(c)),!r.parent){const{defaultCls:d}=r,{outerCls:u}=$;l.push(...d?u.filter(h=>!(h in d)||d[h]):u)}if(e.className=l.join(" "),o)for(let d,u=0;u<o.length;++u)d=o[u],r.attachRef(d.getAttribute("data-reference"),d),d.removeAttribute("data-reference");!r.adopt&&!r.scaleToFitWidth&&r.getConfig("monitorResize"),r.getConfig("role"),r.getConfig("ariaLabel"),r.getConfig("ariaDescription"),r._html&&r.getConfig("htmlMutationObserver"),r.trigger("elementCreated",{element:e})}updateAriaDescription(e){const{ariaElement:r}=this,t=`${this.id}-aria-desc-el`;if(e){const i=this._ariaDescEl||(this._ariaDescEl=w.createElement({className:"b-aria-desc-element",id:t,parent:r}));i.innerText=e.match(Ud)?this.L(e,this):e,r.setAttribute("aria-describedBy",i.id)}else r.getAttribute("aria-describedby")===t&&r.removeAttribute("aria-describedBy")}updateAriaLabel(e){w.setAttributes(this.ariaElement,{"aria-label":e!=null&&e.match(Ud)?this.L(e,this):e})}updateAriaHasPopup(e){w.setAttributes(this.ariaElement,{"aria-haspopup":e})}updateRole(e){var r,t;e?(r=this.ariaElement)==null||r.setAttribute("role",e):(t=this.ariaElement)==null||t.removeAttribute("role")}get ariaElement(){this.getConfig("element");const{_ariaElement:e}=this;return e.nodeType===Node.ELEMENT_NODE?e:T.getPath(this,e)}isCollapsified({collapsed:e,alt:r}){const{collapsify:t}=this,i=t==="hide",n=t===!1,s=t==null;return r?t==="overlay"||s&&e:n||i||s&&!e}async recompose(){const e=this,r={targetElement:e.element,domConfig:e.doCompose(),refOwner:e,callback:e.domSyncCallback,strict:!0};if(e.transitionRecompose){if(e.isTransitioningDom=!0,await w.transition(T.assign({element:e.element,action(){X.sync(r)}},e.transitionRecompose)),e.isDestroyed)return;e.isTransitioningDom=!1,e.trigger("transitionedRecompose")}else X.sync(r);r.changed&&(e.afterRecompose(),e.trigger("recompose")),e.resumeRecompose()}resumeRecompose(){this.recompose.resume()}changeElementRef(e){if(typeof e=="string"){const r=e;if(!(e=document.getElementById(r)))throw new Error(`No element found with id '${r}'`)}return e}changeAppendTo(e){return this.changeElementRef(e)}updateAppendTo(e){!this.isConfiguring&&e&&this.render()}changeInsertBefore(e){return this.changeElementRef(e)}updateInsertBefore(e){!this.isConfiguring&&e&&this.render()}changeInsertFirst(e){return this.changeElementRef(e)}updateInsertFirst(e){!this.isConfiguring&&e&&this.render()}getRenderContext(e=this,r){let t=r||e.appendTo,{insertFirst:i,insertBefore:n}=e;return i&&(t=i,n=t.firstChild),n&&(t||(t=n.parentElement)),[t,n||void 0]}render(e,r=!0){const t=this,{element:i}=t,[n,s]=t.getRenderContext(t,e);t.emptyCache(),t.syncElement&&t.currentElement?w.sync(i,t.currentElement):(n==null||n.insertBefore(i,s),t.currentElement=i),$.fromElement(i.parentElement)&&i.classList.remove(...$.outerCls),super.render(n,r),t.rendered=!0,t.getConfig("role"),r&&(t.getConfig("contentRange"),t.triggerPaint()),t.setupFocusListeners()}template({tag:e,html:r,htmlCls:t,name:i}){const n=this;typeof r=="string"&&wA.test(r)&&n.resolveCallback(r,n,!1)&&(r=n.callback(r,n,[n]));const s=r!=null&&r.call?r.call(n,n):r;return`<${e} class="${s?t:""}" ${i?`data-name="${i}"`:""}>${s||""}</${e}>`}updateRecomposeAsync(e){this.recompose.immediate=!e}onConfigChange({name:e}){var r;this._element&&!this.isDestroying&&((r=this.$meta.renderConfigs)!=null&&r[e])&&this.recompose()}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.parent}getConfigValue(e,r){return e==="style"?this._style:super.getConfigValue(e,r)}getCurrentConfig(e){const r=super.getCurrentConfig(e);return(e==null?void 0:e.depth)>0&&(r.type=this.type),r}get dataset(){return this.element.dataset}changeDataset(e){T.assign(this.dataset,e)}get dragGhost(){return this.constructor._dragGhost||(this.constructor._dragGhost=w.createElement({html:"\xA0",style:"position:absolute;top:-10000em;left:-10000em"}))}updateParent(e){const{_element:r}=this;r&&r.classList[e?"remove":"add"](...$.outerCls)}get constrainTo(){let e=this._constrainTo;if(e=e===void 0?globalThis:(e==null?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?e.host||e.ownerDocument:e,this.positioned){const{offsetParent:r}=this.element;if(r&&w.getStyleValue(r,"overflow")==="hidden")e=k.from(r).moveTo(0,0);else if(e&&!e.isRectangle){const t=e===document||e===globalThis;e=k.from(e,r),t&&e.translate(globalThis.pageXOffset,globalThis.pageYOffset)}}return e}updateCentered(e){const{element:r,_anchorElement:t}=this;if(e&&!this.floating&&!this.positioned)throw new Error("`centered` is only relevant when a Widget is `floating` or `positioned`");e?(r.classList.add("b-centered"),r.style.transform=r.style.left=r.style.top="",t==null||t.classList.add("b-hide-display"),r.classList.remove("b-anchored")):r.classList.remove("b-centered")}get contentElement(){return this.element}get contentRange(){const e=this,{contentElement:r}=e,t=e._contentRange||(e._contentRange=new Range);return t.collapsed&&(t.setStart(r,e.contentRangeStartOffset||0),t.setEnd(r,e.contentRangeEndOffset||r.childNodes.length)),t}fixRefOwnerId(e,r,t){if(e.$refOwnerId===t){e.$refOwnerId=r;for(let{childNodes:i}=e,n=i.length;n-- >0;)this.fixRefOwnerId(i[n],r,t)}}get placement(){var e;const r=this,{element:t}=r;let i,n,s;if(t!=null&&t.offsetParent&&!yA.test(w.getStyleValue(t,"position"))){const a=t.nextElementSibling,o=t.previousElementSibling,l=!a&&o;n=w.getStyleValue(t.parentElement,"flex-direction"),n?n=n.startsWith("row")?"h":"v":(i=(e=a||o)==null?void 0:e.getBoundingClientRect(),s=i&&t.getBoundingClientRect(),n=i&&Math.abs(i.top-s.top)<Math.abs(i.left-s.left)?"h":"v"),n+=n==="h"?l?"r":"l":l?"b":"t"}return n}updateId(e,r){if(super.updateId(e,r),r){const{byRef:t,element:i}=this;for(const n in t)t[n].dataset&&(t[n].dataset.ownerCmp=e);i.id=e,this.fixRefOwnerId(i,e,r)}}get style(){const{element:e}=this;return(e==null?void 0:e.ownerDocument.defaultView.getComputedStyle(e))||this._style}updateStyle(e){this.element&&w.applyStyle(this.element,e)}updateTitle(e){this.titleElement&&(this.titleElement.innerHTML=e)}beforeAlignTo(e){}alignTo(e){var r;const t=this,{lastAlignSpec:i,element:n}=t,{offsetParent:s,style:a,classList:o}=n;if(i&&(i.monitorIntersection&&t.intersectionObserver.unobserve(i.target),isFinite(i.zone)&&n.classList.remove(Pw[i.zone])),!e){t.removeTransientListeners(),t.anchor=t.lastAlignSpec=null;return}t.beforeAlignTo(e),(e.nodeType===Element.ELEMENT_NODE||e.isWidget||e.$$name==="Point")&&(e={target:e}),t.releaseSizeConstraints();const{scrollable:l,constrainTo:c}=t,d=w.measureSize(w.getStyleValue(n,"minHeight"),n),u=w.measureSize(w.getStyleValue(n,"minWidth"),n),h=t.positioned&&w.getStyleValue(n,"position")!=="fixed",g=t.scale||1,f=e.target,m=e.domEvent||e.event||f,p=f!=null&&f.isRectangle?f:(f==null?void 0:f.element)||f,v=k.from(n,h?s:null,!0),{width:y,height:C}=v,D=(p==null?void 0:p.nodeType)===Element.ELEMENT_NODE,S=((r=m==null?void 0:m.target)==null?void 0:r.nodeType)===Element.ELEMENT_NODE;e=e.realignTarget?e:T.assign({aligningToEvent:S,aligningToElement:D,constrainTo:c,align:"b-t",axisLock:t.axisLock,anchor:t.anchor},t.align,e);const x=e.minWidth||u,R=e.minHeight||d;if(v.isAlignRectangle=!0,x&&(v.minWidth=x*g),R&&(v.minHeight=R*g),t.lastAlignSpec=e,S)delete e.target,e.domEvent=m,e.anchoredTo=m.target,e.position=new Sr(m.clientX+1,m.clientY+1);else if(D&&(e.target=p,Ii(p instanceof SVGElement?p.closest("svg"):p))){if(e=Object.setPrototypeOf({},e),e.target=t.lastAlignSpec.targetRect=e.realignTarget||(e.allowTargetOut?k.from(p,h?s:null,!h):w.isInView(p,!1,t)),!e.target){const U=t.hide();return t.isDestroyed||(t.lastAlignSpec.targetOutOfView=!0),U}e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1),t.lastAlignSpec.anchoredTo=p}e.anchor&&(e.anchorSize=t.anchorSize,n.contains(t.anchorPathElement)||n.appendChild(t.anchorElement)),t.isAligning=!0,t.trigger("beforeAlign",e),t.isAligning=!1,e.rtl=t.rtl,(e.align.includes("s")||e.align.includes("e"))&&(t.rtl?e.align=e.align.replace(/s/g,"r").replace(/e/g,"l"):e.align=e.align.replace(/s/g,"l").replace(/e/g,"r"));const I=t.lastAlignSpec.result=v.alignTo(e);let{align:M,anchor:P,x:_,y:A,width:z,height:Y,overlap:V}=I;if(t.lastAlignSpec.zone=I.zone,Y!=C){const U=Y<C;t.alignmentChanges=t.alignmentChanges|(U?1:2),a[t.alignedHeightStyle=_w[t.alignmentChanges&3]]=`${Y/g}px`,U&&!t._minHeight&&d&&(a.minHeight=`${Math.min(Y,d)/g}px`),l&&(l.overflowY=U)}if(z!=y){const U=z<y;t.alignmentChanges=t.alignmentChanges|(U?4:8),a[t.alignedWidthStyle=_w[t.alignmentChanges&12]]=`${z/g}px`,U&&!t._minWidth&&u&&(a.minWidth=`${Math.min(z,u)/g}px`),l&&(l.overflowX=U)}if(M&&t.alignmentChanges){const U=k.from(n,h?s:null,!0);U.minWidth=I.minWidth,U.minHeight=I.minHeight,e.align=M;const K=t.lastAlignSpec.result=U.alignTo(e);P=K.anchor,_=K.x,A=K.y,z=K.width,Y=K.height}if(t.centered||t.setXY(_,A),!I.overlap&&isFinite(I.zone)&&o.add(Pw[I.zone]),P!=null&&P.edge){const{edge:U}=P,{anchorElement:K}=t,{style:le}=K,Ce=k.from(n),Me=[];U==="top"||U==="bottom"?(Me[0]=P.x,Me[1]=U==="top"?1:Ce.height-1):(Me[0]=U==="left"?1:Ce.width-1,Me[1]=P.y),le.display="none";let te=w.childFromPoint(n,...Me);if(te!=null&&te.matches(":hover,:focus")&&n.compareDocumentPosition(te)&Node.DOCUMENT_POSITION_CONTAINED_BY&&(te=te.parentNode),te&&te!==document){let Ie=w.getStyleValue(te,"background-color");for(;Ie.match(mm)&&w.getStyleValue(te,"position")!=="absolute"&&(te=te.parentNode,te!==document);)Ie=w.getStyleValue(te,"background-color");Ie.match(mm)?t.anchorPathElement.setAttribute("fill",t.defaultAnchorBackgroundColor):t.anchorPathElement.setAttribute("fill",Ie)}le.transform=le.display="",K.className=`b-anchor b-anchor-${U}`,P.x&&(P.x/=g),P.y&&(P.y/=g),w.setTranslateXY(K,P.x,P.y),o.add("b-anchored")}else t._anchorElement&&(t.anchorElement.classList.add("b-hide-display"),o.remove("b-anchored"));if(!D){a.pointerEvents="none";const U=w.elementFromPoint(_,A);t.owns(U)||(t.lastAlignSpec.anchoredTo=U),a.pointerEvents=""}if((t.scrollAction==="realign"&&D||t.scrollAction==="hide")&&!t.documentScrollListener&&(t.clearTimeout(t.scrollListenerTimeout),e.monitorTargetMutation&&!t.targetObserver&&(t.targetObserver||(t.targetObserver=new MutationObserver(t.onTargetParentMutation.bind(t)))).observe(w.getRootElement(p),{childList:!0,attributes:!0,subtree:!0}),t.scrollListenerTimeout=t.setTimeout(()=>{var U,K;const le=(K=(U=D?p:t.lastAlignSpec.anchoredTo).getRootNode)==null?void 0:K.call(U);t.documentScrollListener=B.addListener(document,"scroll","doHideOrRealign",{capture:!0,thisObj:t}),le!=null&&le.mode&&(t.targetRootScrollListener=B.addListener(le,"scroll","doHideOrRealign",{capture:!0,thisObj:t}))},t.scrollAction==="hide"?t.ignoreScrollDuration:0)),D&&(e.monitorResize&&!t.targetResizeListener&&(st.addResizeListener(p,t.onTargetResize),t.targetResizeListener=!0),e.monitorIntersection&&!(V||p.contains(n)||p.ownerSVGElement)&&t.intersectionObserver.observe(p)),!q.isAndroid&&!t.constrainListeners){const U=c!=null&&c.isRectangle?globalThis:c;t.clearTimeout(t.resizeListenerTimeout),t.resizeListenerTimeout=t.setTimeout(()=>{t.constrainListeners=!0,st.addResizeListener(U||globalThis,t.onAlignConstraintChange)},t.ignoreScrollDuration)}}onTargetParentMutation(e){var r;const{element:t,lastAlignSpec:i}=this;i!=null&&i.aligningToElement&&((r=i.target)!=null&&r.isConnected?e.some(({target:n})=>n.contains(i.target)&&!t.contains(n))&&this.realign():this.hide())}get intersectionObserver(){return this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.onTargetIntersectionchange.bind(this),{root:q.isSafari?this.rootElement:this.rootElement.ownerDocument}))}onTargetIntersectionchange(e){if(!this.isDestroyed){const r=e[e.length-1];r.isIntersecting||this.onAlignTargetOutOfView(r.target)}}onTargetResize(){const{lastAlignSpec:e}=this;if(e){const{width:r,height:t}=e.targetRect,{width:i,height:n}=e.target.getBoundingClientRect();(i!==r||n!==t)&&this.onAlignConstraintChange(...arguments)}}onAlignTargetOutOfView(e){this.hide(),this.lastAlignSpec&&(this.lastAlignSpec.targetOutOfView=!0)}onAlignConstraintChange(e,r,{height:t}){const{style:i}=this.contentElement,{overflowY:n}=i;this.setTimeout(this.realign,50),r&&t>r.height&&(i.overflowY="hidden",this.requestAnimationFrame(()=>i.overflowY=n))}realign(){const e=this,{lastAlignSpec:r}=e;if((e.floating||e.positioned)&&r&&e.isVisible){if(r.aligningToElement){const t=r.target.contains(this.element),i=w.isInView(r.target,!1,e);if(!r.allowTargetOut&&(!Ii(r.target)||!i)){e.hide(),e.isDestroyed||(e.lastAlignSpec.targetOutOfView=!0);return}r.realignTarget=t?null:i}w.addTemporaryClass(e.element,"b-realigning",e.realignTimeout,e),e.alignTo(r)}}rectangle(e,r,t){return this.rectangleOf("element",e,r,t)}rectangleOf(e,r,t,i){return typeof r!="string"?(i=t,t=r,r=""):r==="border"&&(r=""),typeof t=="boolean"&&(i=t,t=void 0),e!=="element"&&t===void 0&&(t=this.element),t=t!=null&&t.isWidget?t.element:t,k[r||"from"](this[e],t,i)}releaseSizeConstraints(){const e=this,{scrollable:r,element:t,alignmentChanges:i}=e,{style:n}=t;i&12&&(w.setLength(t,e.alignedWidthStyle,e[`_last${O.capitalize(e.alignedWidthStyle)}`]||""),n.minWidth=e._minWidth||"",r&&(r.overflowY=r.config.overflowY)),i&3&&(w.setLength(t,e.alignedHeightStyle,e[`_last${O.capitalize(e.alignedHeightStyle)}`]||""),n.minHeight=e._minHeight||"",r&&(r.overflowX=r.config.overflowX)),e.alignmentChanges=0}toFront(){const{element:e}=this,r=this.floating?this.floatRoot:this.positioned?e==null?void 0:e.parentNode:null,t=document.createDocumentFragment();if(this.containsFocus){for(let i=e.nextSibling,n;i;i=n)n=i.nextSibling,r.contains(i)&&!this.owns(i)&&t.appendChild(i);r.insertBefore(t,e)}else r.appendChild(e)}updateRef(e){this.element.dataset.ref=e}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}changeAlign(e){return typeof e=="string"?{align:e}:e}changeScrollable(e,r){return typeof e=="boolean"&&(e={overflowX:e,overflowY:e}),e?(e.element=this.overflowElement,e.widget=this,e.isScroller||(e=r?r.setConfig(e):new this.scrollerClass(e)),e.syncOverflowState()):r==null||r.destroy(),e}handleReactElement(e){const r=this.closest(t=>t.reactComponent);r!=null&&r.reactComponent&&r.reactComponent.processWidgetContent({reactElement:e,widget:this,reactComponent:r.reactComponent})}get html(){return this.initializingElement||!this.element?this.content||this._html:this.contentElement.innerHTML}updateHtml(e){const r=this,t=e==null,{element:i,contentElement:n,htmlCls:s}=r;if(!i&&w.isReactElement(e)){r.whenVisible(()=>r.handleReactElement(e));return}if(i){r.updatingHtml=!0;const a=n===i&&r._anchorElement;s&&s.values.forEach(o=>i.classList[t?"remove":"add"](o)),a&&i.removeChild(a),e&&typeof e=="object"?w.isReactElement(e)?r.handleReactElement(e):X.sync({domConfig:{...e,onlyChildren:!0},targetElement:r.contentElement}):r.contentElement.innerHTML=t?"":e,r.getConfig("htmlMutationObserver"),a&&i.appendChild(a),r.isComposable?r.recompose():(r.floating||r.positioned)&&(r.isAligning||r.realign())}}changeHtmlMutationObserver(e,r){const t=this,{contentElement:i}=t;if(r==null||r.disconnect(),e){const n=new MutationObserver(()=>{t.updatingHtml?t.updatingHtml=!1:t._html=i.innerHTML});return n.observe(i,e),n}}updateContent(e){const r=this,t=e==null,{element:i,htmlCls:n}=r;if(i){const{contentRange:s}=r;n&&n.values.forEach(a=>i.classList[t?"remove":"add"](a)),i.isConnected?(s.deleteContents(),t||s.insertNode(w.createElementFromTemplate(e,{fragment:!0}))):r.contentElement.innerHTML=e,r.contentRangeStartOffset=s.startOffset,r.contentRangeEndOffset=s.endOffset,(r.floating||r.positioned)&&!r.isAligning&&r.realign()}}onThemeChange(){var e;(e=this.anchorElement)!=null&&e.offsetParent&&(this._anchorSize=null,this.realign())}get anchorSize(){const e=this;let r=this._anchorSize;if(!r){const t=parseFloat(w.getStyleValue(e.element,"border-top-width")),i=w.getStyleValue(e.element,"border-top-color"),n=e.anchorElement,{className:s}=n,a=n.firstElementChild,o=e.anchorPathElement=a.lastElementChild,l=e._hidden;n.className="b-anchor b-anchor-top";let c=w.getStyleValue(e.contentElement,"background-color");c.match(mm)&&(c=w.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=c,r=n.getBoundingClientRect();const[d,u]=r=e._anchorSize=[r.width,r.height];n.className=s,a.setAttribute("height",u+t),a.setAttribute("width",d),o.setAttribute("d",`M0,${u}L${d/2},0.5L${d},${u}`),t&&(o.setAttribute("stroke-width",t),o.setAttribute("stroke",i)),r[1]-=t,l&&e.element.classList.add("b-hidden"),e.themeChangeListener||(e.themeChangeListener=be.ion({theme:"onThemeChange",thisObj:e})),e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}return r}get anchorElement(){const e=this;if(!e._anchorElement){const r=e.floating,t=`${e.id}-shadow-filter`;e._anchorElement=w.createElement({parent:e.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[r?{tag:"defs",children:[{tag:"filter",id:t,children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:1,"flood-opacity":.2}]}]}:null,{tag:"path",[r?"filter":""]:`url(#${t})`}]}]})}return e._anchorElement}updateAnchor(e){this._anchorElement&&this._anchorElement.classList[e?"remove":"add"]("b-hide-display")}updateDraggable(e){var r,t,i;const n=this,{element:s}=n;e?(n.dragEventDetacher=B.addListener({element:s,dragstart:"onWidgetDragStart",dragend:"onWidgetDragEnd",thisObj:n}),n.dragDetacher=B.on({element:s,mousedown(a){const{target:o}=a,l=$.fromElement(o);(!a.target.closest(".b-field-inner")&&l===this||this.strips&&Object.values(this.strips).includes(l))&&s.setAttribute("draggable","true")},thisObj:n})):((r=n.dragEventDetacher)==null||r.call(n),(t=n.dragOverEventDetacher)==null||t.call(n),(i=n.dragDetacher)==null||i.call(n))}onWidgetDragStart(e){var r;const t=this;if(!t.validateDragStartEvent(e))return;const{element:i,align:n,constrainTo:s}=t,a=t.positioned&&w.getStyleValue(i,"position")!=="fixed",o=a?i.parentElement:t.rootElement,l=k.from(i,a?o:null),c=e.clientX,d=e.clientY,u=document.scrollingElement||document.body,[h,g]=a?w.getOffsetXY(i,o):t.getXY(),f=(r=a?k.content(o).moveTo(0,0):s&&(s!=null&&s.isRectangle?s:k.from(s)))==null?void 0:r.deflate(n.constrainPadding||0),m={element:o,dragover:p=>{i.classList.remove("b-centered"),l.moveTo(h+p.clientX-c-(a?0:u.scrollLeft),g+p.clientY-d-(a?0:u.scrollTop)),f&&l.constrainTo(f),w.setTranslateXY(i,l.x,l.y)}};q.isTouchDevice&&(m.touchmove=p=>p.preventDefault()),t.floatRoot.appendChild(t.dragGhost),t.setDragImage(e),e.dataTransfer.effectAllowed="none",t.dragOverEventDetacher=B.addListener(m),t.alignTo()}validateDragStartEvent(e){var r;const t=this,{element:i}=t,n=w.elementFromPoint(e.clientX,e.clientY),{handleSelector:s}=t.draggable;if(s){const a=(r=vA.exec(s))==null?void 0:r[1];if(a){if(n.closest(`#${i.id} ${a}`))return e.preventDefault(),!1}else if(!n.closest(`#${i.id} ${s}`))return e.preventDefault(),!1}return!0}setDragImage(e){e.dataTransfer.setDragImage&&(e.dataTransfer.setData("application/node type",""),e.dataTransfer.setDragImage(this.dragGhost,-9999,-9999))}setStyle(e,r){return w.applyStyle(this.element,T.isObject(e)?e:{[e]:r}),this}onWidgetDragEnd(){this.dragGhost.remove(),this.dragOverEventDetacher(),this.element.removeAttribute("draggable")}changeFloating(e){return!!e}changePositioned(e){return!!e}updatePositioned(e){this.element.classList[e?"add":"remove"]("b-positioned")}getXY(){return[w.getPageX(this.element),w.getPageY(this.element)]}setXY(e,r){const t=this,{element:i}=t;if(t.floating||t.positioned){if(e!=null&&(t._x=e),r!=null&&(t._y=r),w.getStyleValue(i,"position")==="fixed"){const n=i.getBoundingClientRect(),[s,a]=w.getTranslateXY(i),o=e-n.x,l=r-n.y;w.setTranslateXY(i,s+o,a+l)}else w.setTranslateXY(i,t._x||0,t._y||0);t.isConstructing?t.centered=!1:i.classList.remove("b-centered")}}get x(){return this.getXY()[0]}changeX(e){this.setXY(e)}get y(){return this.getXY()[1]}changeY(e){this.setXY(null,e)}get width(){const e=this,r=e.element;return e.monitorResize?(e._width==null&&(e._width=r.offsetWidth),e._width):r.offsetWidth}changeWidth(e){const r=this;w.setLength(r.element,"width",e),r._lastWidth=e,r._width=null,r._flex=null,r.element.style.flex=""}clearWidthCache(){this._width=null}get maxWidth(){return w.measureSize(this.element.style.maxWidth,this.element)}updateMaxWidth(e){this._lastMaxWidth=e,w.setLength(this.element,"maxWidth",e)}get minWidth(){return w.measureSize(this.element.style.minWidth,this.element)}updateMinWidth(e){w.setLength(this.element,"minWidth",e)}updateFlex(e){this.getConfig("width"),(typeof e=="number"||!isNaN(e))&&(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=""}updateAlignSelf(e){this.element.style.alignSelf=e}updateMargin(e){this.element.style.margin=this.parseTRBL(e).join(" ")}updateTextAlign(e,r){r&&this.element.classList.remove(`b-text-align-${r}`),this.element.classList.add(`b-text-align-${e}`)}updatePlaceholder(e){this.input&&(e==null?this.input.removeAttribute("placeholder"):this.input.placeholder=e)}get height(){const e=this,r=e.element;return e.monitorResize?(e._height==null&&(e._height=r.offsetHeight),e._height):r.offsetHeight}changeHeight(e){w.setLength(this.element,"height",e),this._lastHeight=e,this._height=null}get maxHeight(){return w.measureSize(this.maxHeightElement.style.maxHeight,this.element)}updateMaxHeight(e){this._lastMaxHeight=e,w.setLength(this.maxHeightElement,"maxHeight",e)}get minHeight(){return w.measureSize(this.element.style.minHeight,this.element)}updateMinHeight(e){w.setLength(this.element,"minHeight",e)}updateDisabled(e=!1){const{element:r,focusElement:t,ariaElement:i}=this;this.trigger("beforeUpdateDisabled",{disabled:e}),!(e&&(this.revertFocus(),this._disabled!==e))&&(r&&(r.classList[e?"add":"remove"]("b-disabled"),t&&(t.disabled=e),i&&i.setAttribute("aria-disabled",e)),this.onDisabled(e))}onDisabled(e){}disable(){this.disabled=!0}enable(){this.disabled=!1}requestFullscreen(){const e=this,r=Or.request(e.floating?e.floatRoot:e.element);return Or.onFullscreenChange(e.onFullscreenChange),e.element.classList.add("b-fullscreen"),r}exitFullscreen(){return Or.exit()}onFullscreenChange(){Or.isFullscreen||this.onExitFullscreen()}onExitFullscreen(){Or.unFullscreenChange(this.onFullscreenChange),this.element.classList.remove("b-fullscreen")}get tooltip(){var e;const r=this;if(r._tooltip)return r._tooltip;{const t=(e=$.Tooltip)==null?void 0:e.getSharedTooltip(r.rootElement,r.eventRoot);if(t&&t.activeTarget===r._element&&t.isVisible)return t}}changeTooltip(e,r){var t;const i=this,{element:n}=i;if(e){if(!(i.preventTooltipOnTouch&&q.isTouchDevice))if(!e.isTooltip&&e.constructor.name!=="Object"&&(e={html:typeof e=="string"?e:i.placeholder,textContent:!0}),i.configureAriaDescription||(i.ariaDescription=(t=e.html)!=null&&t.match(Ud)?e.html.replace(Ud,SA):e.html),r!=null&&r.isTooltip||e.newInstance)e.type="tooltip",e.forElement||(e.forElement=n),!("showOnHover"in e)&&!e.forSelector&&(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),e=$.reconfigure(r,e,i),i.detachListeners("tooltipValueListener"),i.configureAriaDescription||e.ion({name:"tooltipValueListener",innerHtmlUpdate:"onTooltipValueChange",thisObj:i});else{n.dataset.btip=!0,i.tipConfig=e;return}}else if(r)if(e==null&&r.isTooltip)r.destroy();else{r.html=null;return}else delete n.dataset.btip;return e}onTooltipValueChange({value:e,source:r}){this.ariaDescription=typeof e=="string"?e:r.contentElement.innerText}get tooltipText(){const e=this._tooltip;if(e)return e.isTooltip?e.contentElement.innerText:typeof e=="string"?e:e.html;if(this.tipConfig)return this.tipConfig.html}get isVisible(){const e=this,{element:r}=e;let t;return!!(r&&!e._hidden&&!e.isDestroying&&r.isConnected&&(!e.requireSize||Ii(r))&&(!(t=e.containingWidget)||t.isVisible))}whenVisible(e,r=this,t,i=e){const n=this;n.isVisible&&n.isPainted?n.callback(e,r,t):(n.toCallWhenVisible||(n.toCallWhenVisible=new Map)).set(i,{callback:e,thisObj:r,args:t})}focus(){this.isFocusable&&w.focusWithoutScrolling(this.focusElement)}get focusElement(){}get isFocusable(){const e=!this.isDestroying&&this.isVisible&&!this.disabled&&this.focusElement;return e&&(e===document.body||e.offsetParent)}async show({align:e,animate:r=!0}={}){const t=this,{element:i,floating:n}=t,{style:s}=i,a=r&&t.showAnimation;let o,l,c=!t.isVisible;return c&&(c=t.trigger("beforeShow"),T.isPromise(c)&&(c=await c)),c!==!1&&(!t.internalBeforeShow||t.internalBeforeShow()!==!1)?new Promise(d=>{if(t.cancelHideShowAnimation(),t.updateCentered(t._centered),n){const u=t.floatRoot;u.contains(i)||(t.rendered?u.appendChild(t.element):t.render(u,!1)),s.transform.includes("scale")&&(t.scale=null,s.transform=s.transformOrigin="");const h=t.closest(bA);if(h){const{scale:g}=h;t.scale=g,s.transform=`scale(${g})`,s.transformOrigin="0 0"}}if(t._hidden=!1,i.classList.remove("b-hidden"),n&&!Vf(i)&&(t.hide(!1),d()),t.onConfigChange({name:"hidden",value:!1,was:!0,config:t.$meta.configs.hidden}),a){o=Object.keys(a)[0],l=a[o];const u=t.currentAnimation={showing:!0,styleProp:o,resolve:d};t.isAnimating=!0,s.transition="none",s[o]=l.from,w.getStyleValue(i,o),t.currentAnimation.detacher=B.onTransitionEnd({element:i,property:o,duration:Iw(l.duration)+20,handler:()=>t.afterHideShowAnimate(u),thisObj:t}),s.transition=`${o} ${l.duration} ease ${l.delay}`,s[o]=l.to}t.afterShow(e,a?null:d)}):Promise.resolve()}async showBy(e,r,t){const i=this,n=Array.isArray(e);if(n||typeof e=="number"){const s=n?e:[e,r];e=Object.assign({target:new Sr(s[0]+1,s[1]+1),matchSize:!1,align:"t0-b0"},n?r:t)}if(i.requireSize=!0,i.isVisible)w.addTemporaryClass(i.element,"b-realigning",300,i),i.alignTo(e);else return i.show({align:e})}async showByPoint(){return ne.deprecate("Core","6.0.0","Widget.showByPoint() replaced by Widget.showBy() with the same signature"),this.showBy(...arguments)}afterShow(e,r){var t,i;const n=this;n.trigger("show"),n._configuredAnchorState=n.anchor,(i=(t=n.owner)==null?void 0:t.onChildShow)==null||i.call(t,n),n.triggerPaint(),(n.floating||n.positioned)&&(e?n.alignTo(e):n.centered?n.alignTo({target:n.constrainTo,align:"c-c"}):n.forElement&&n.alignTo(n.forElement)),r==null||r()}onChildHide(e){e.floating&&this.ariaElement.removeAttribute("aria-owns")}onChildShow(e){e.floating&&(this.ariaHasPopup=e.role,this.ariaElement.setAttribute("aria-owns",e.id))}triggerPaint(){const e=this,{element:r,toCallWhenVisible:t}=e,i=!e.isPainted;if(e.isVisible){if(i&&(e.getConfig("scrollable"),e.scaleToFitWidth&&!e.monitorResize&&(e.onParentElementResize=e.onParentElementResize.bind(e),st.addResizeListener(r.parentElement,e.onParentElementResize),e.updateScale()),!e.hideBryntumDomMessage&&(e.isTaskBoardBase||e.isGridBase||e.isCalendar)&&r.insertBefore(new Comment("POWERED BY BRYNTUM (https://bryntum.com)"),r.firstChild),e.onConnectedCallback&&globalThis.ResizeObserver&&(e.connectedObserver=new ResizeObserver(()=>{e.isElementConnected&&!r.isConnected?(e.onConnectedCallback(!1),e.isElementConnected=!1):!e.isElementConnected&&r.isConnected&&(e.onConnectedCallback(!0,e.isElementConnected==null),e.isElementConnected=!0)}),e.connectedObserver.observe(r))),e.eachWidget(pA,!1),i&&(e.getConfig("tooltip"),!$.Ripple&&$.RippleClass&&($.Ripple=new $.RippleClass({rootElement:e.rootElement})),globalThis.DocsBrowser&&e.floating&&e.closest(n=>{var s;return(s=n.element)==null?void 0:s.closest(".fiddlePanelResult,.b-owned-by-fiddle")})&&r.classList.add("b-owned-by-fiddle")),e.isPainted=!0,i&&e.triggerConfigs("paint"),e.trigger("paint",{firstPaint:i}),t!=null&&t.size){for(const{callback:n,thisObj:s,args:a}of t.values())e.callback(n,s,a);t.clear()}i&&e.monitorResize&&!e.scaleToFitWidth&&st.onElementResize([{target:r}])}}cancelHideShowAnimation(){const e=this,{currentAnimation:r,element:t}=e;r&&(e.isAnimating=!1,t.classList.contains("b-hiding")&&(t.classList.remove("b-hiding"),e._hidden=!1),r.detacher(),r.resolve(),t.style.transition=t.style[r.styleProp]="",e.currentAnimation=null,e.trigger(`${r.showing?"show":"hide"}AnimationEnd`))}afterHideShowAnimate(e){const r=this;e===r.currentAnimation&&(r.element.classList.remove("b-hiding"),r.cancelHideShowAnimation(),r._hidden&&r.afterHideAnimation())}suspendVisibility(){this._visibilitySuspended=(this._visibilitySuspended||0)+1,Object.defineProperty(this,"isVisible",CA)}resumeVisibility(e=!0){--this._visibilitySuspended||(delete this.isVisible,e&&this.triggerPaint())}hide(e=!0){return new Promise(r=>{const t=this,{element:i,lastAlignSpec:n}=t,{style:s}=i,a=e&&t.hideAnimation;if(t.clearTimeout(t.scrollListenerTimeout),t.clearTimeout(t.resizeListenerTimeout),!t._hidden&&t.trigger("beforeHide",{animate:e})!==!1){if(t._hidden=!0,n&&(n.targetOutOfView=null,n.monitorIntersection&&(t.intersectionObserver.takeRecords(),t.intersectionObserver.unobserve(n.target))),t.onConfigChange({name:"hidden",value:!0,was:!1,config:t.$meta.configs.hidden}),!i){r();return}if(i.contains(w.getActiveElement(i))&&t.revertFocus(!0),t.isDestroyed){r();return}if(t.cancelHideShowAnimation(),a){const o=Object.keys(a)[0],l=a[o];if(Number(getComputedStyle(t.element)[o])!==l.to){const c=t.currentAnimation={hiding:!0,styleProp:o,resolve:r};i.classList.add("b-hiding"),t.isAnimating=!0,t.currentAnimation.detacher=B.onTransitionEnd({element:i,property:o,duration:Iw(l.duration)+20,handler:()=>t.afterHideShowAnimate(c),thisObj:t}),s[o]=l.from,w.getStyleValue(i,o),s.transition=`${o} ${l.duration} ease ${l.delay}`,s[o]=l.to}else i.classList.add("b-hidden")}else i.classList.add("b-hidden");t.afterHide(!a&&r,a)}})}doHideOrRealign({target:e,isTrusted:r}){const t=this,{lastAlignSpec:i,element:n}=t,s=i==null?void 0:i.anchoredTo,a=i==null?void 0:i.target,o=i==null?void 0:i.position,l=w.getActiveElement(t);if(!r||!Ii(n)||e&&(n.contains(e)||e.nodeType===Element.ELEMENT_NODE&&t.owns(e)||e.nodeType===Element.DOCUMENT_NODE&&n.contains(l)&&mA[l]&&globalThis.innerHeight<document.body.offsetHeight))return;if(i.aligningToElement){const d=w.isInView(a,!1,t);if(d&&d.equals(i.targetRect))return}const c=t.scrollAction==="hide"&&t.getXY();if(t.realign(),!t.isDestroyed&&Vf(n)&&t.scrollAction==="hide"){const[d,u]=t.getXY(),h=d!==c[0]||u!==c[1];(i!=null&&i.aligningToEvent||(h||(a==null?void 0:a.$$name)==="Point"||o)&&(!s||!Ii(s)||e&&w.isDescendant(e,s)))&&t.hide()}}afterHide(e=null,r=this.hideAnimation){var t,i;const n=this;n._anchor=n._configuredAnchorState,n.removeTransientListeners(),r||n.afterHideAnimation(),n.trigger("hide"),(i=(t=n.owner)==null?void 0:t.onChildHide)==null||i.call(t,n),e&&e()}removeTransientListeners(){var e,r,t;const i=this,{targetObserver:n,lastAlignSpec:s}=i;if(i.clearTimeout(i.resizeListenerTimeout),i.clearTimeout(i.scrollListenerTimeout),n&&(n.disconnect(),delete i.targetObserver),i.documentScrollListener=(e=i.documentScrollListener)==null?void 0:e.call(i),i.targetRootScrollListener=(r=i.targetRootScrollListener)==null?void 0:r.call(i),i.targetResizeListener&&(st.removeResizeListener(s.target,i.onTargetResize),i.targetResizeListener=!1),i.constrainListeners){const a=(t=s.constrainTo)!=null&&t.isRectangle?globalThis:s.constrainTo;st.removeResizeListener(a||globalThis,i.onAlignConstraintChange),i.constrainListeners=!1}}afterHideAnimation(){const e=this,{element:r}=e;e.floating&&e.floatRoot.contains(r)?r.remove():r.classList.add("b-hidden"),e.defaultAnchorBackgroundColor&&e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}changeHidden(e){const r=this;let t;return r.isConfiguring?(t=!!e,r.element.classList[e?"add":"remove"]("b-hidden")):(r.trigger("beforeChangeHidden",{hidden:e}),e?r.hide():r.show()),t}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){return this.parent||this._owner||this.containingWidget}get containingWidget(){var e,r;let t=this.parent;if(!t){const i=((e=this.forElement)==null?void 0:e.nodeType)===Element.ELEMENT_NODE?this.forElement:(r=this.element)==null?void 0:r.parentNode;t=(i==null?void 0:i.closest(".b-widget"))&&$.fromElement(i)}return t}get previousSibling(){return this.getSibling(-1)}get nextSibling(){return this.getSibling(1)}getSibling(e){const r=this,{parent:t}=r,i=t?t.childItems:Array.from(r.element.parentElement.querySelectorAll(".b-widget"));return t?i[i.indexOf(r)+e]:$.fromElement(i[i.indexOf(r.element)+e])}up(e,r,t){var i;const{owner:n}=this;return e?(i=n==null?void 0:n.closest)==null?void 0:i.call(n,e,r,t):n}closest(e,r,t){const i=typeof t,n=i==="number",s=i==="string";for(let a=this,o=1;a;a=a.owner,o++){if($.widgetMatches(a,e,r))return a;if(n&&o>=t)return;if(s&&$.widgetMatches(a,t,r))return;if(a===t)return}}owns(e){if(e){if("eventPhase"in e&&(e=e.target),e.nodeType===Element.ELEMENT_NODE){if(this.element.contains(e))return!0;e=$.fromElement(e)}for(;e;){if(e===this)return!0;e=e.owner}}return!1}eachAncestor(e){let r=this.owner;for(;r;){if(e(r)===!1)return!1;r=r.owner}return!0}changeMaximizeOnMobile(e){const r=this;if(r.floating&&q.isMobile){const{initialConfig:t}=r;e?(r.centered=r.modal=!1,r.maximized=!0):(r.centered=t.modal,r.modal=t.centered,r.maximized=t.maximized)}}changeMonitorResize(e,r){const t=this.scaleToFitWidth?!1:!!e;if(t!==!!r)return t}updateMonitorResize(e){const r=this;Mn(r,"onElementResize")||(r.onElementResize=r.onElementResize.bind(r)),st[e?"addResizeListener":"removeResizeListener"](r.element,r.onElementResize)}changeReadOnly(e){if(e=!!e,!!this._readOnly!==e)return e}updateReadOnly(e){var r;(r=this.element)==null||r.classList[e?"add":"remove"]("b-readonly"),this.isConfiguring||(this.eachWidget(t=>{t.ignoreParentReadOnly||("_originalReadOnly"in t||(t._originalReadOnly=t.config.readOnly||!1),t.readOnly=e||t._originalReadOnly)},!1),this.trigger("readOnly",{readOnly:e}))}eachWidget(e,r=!0){const t=this.childItems,i=(t==null?void 0:t.length)||0,n={};for(let s=0;s<i;s++){const a=t[s];if(n.down=r,e(a,n)===!1||n.down&&a.eachWidget&&a.eachWidget(e,r)===!1)return!1}return!0}queryAll(e){const r=[];return this.eachWidget(t=>{e(t)&&r.push(t)}),r}query(e){let r=null;return this.eachWidget(t=>{if(e(t))return r=t,!1}),r}getWidgetByRef(e){var r,t;return e instanceof $?e:((r=this==null?void 0:this.widgetMap)==null?void 0:r[e])||((t=this==null?void 0:this.owner)==null?void 0:t.getWidgetByRef(e))}onFocusIn(e){const r=this,{element:t}=r;r.containsFocus=!0,r.focusInEvent=e,(r.floating||r.positioned)&&r.toFront(),t.classList.add("b-contains-focus"),r.updateAriaLabel(r.localizeProperty("ariaLabel")),r.updateAriaDescription(r.localizeProperty("ariaDescription")),t.contains(e._target)&&r.onInternalKeyDown&&!r.keyDownListenerRemover&&(r.keyDownListenerRemover=B.on({element:t,keydown:"onInternalKeyDown",thisObj:r})),r.trigger("focusin",e)}onFocusOut(e){const r=this;r.keyDownListenerRemover&&(r.keyDownListenerRemover(),r.keyDownListenerRemover=null),r.isDestroyed||(e.relatedTarget||r.revertFocus(!r.isVisible),r.containsFocus=!1,r.element.classList.remove("b-contains-focus"),r.updateAriaLabel(r.localizeProperty("ariaLabel")),r.updateAriaDescription(r.localizeProperty("ariaDescription")),r.trigger("focusout",e))}captureFocus(){const e=this,r=w.getActiveElement(e),t=e.contains(r)&&e.captureFocusItem(r);return(i,n)=>{t&&!e.isDestroying&&(w.getActiveElement(e)!==r||n)&&t(i)}}captureFocusItem(e){return(r=!0)=>{this.contains(e)&&(r?e.focus():w.focusWithoutScrolling(e))}}contains(e,r){const{element:t}=this;if(e&&t)return e.isWidget&&(e=e.element),t.contains(e)&&(!r||t!==e)}revertFocus(e){var r;const t=this,i=w.getActiveElement(t);let n=(r=t.focusInEvent)==null?void 0:r.relatedTarget;(e||t.containsFocus&&(n==null?void 0:n.nodeType)===Element.ELEMENT_NODE&&t.element.contains(i))&&((!n||!w.isFocusable(n))&&(n=t.getFocusRevertTarget()),t._isRevertingFocus=!0,n&&w.isFocusable(n)?(n._isRevertingFocus=!0,w.focusWithoutScrolling(n),n._isRevertingFocus=!1):i==null||i.blur(),t._isRevertingFocus=!1)}getFocusRevertTarget(){var e;const r=this,{owner:t,focusInEvent:i}=r,n=i&&i.backwards?1:-1;let s=i&&i.relatedTarget;const a=s&&$.fromElement(s);if(t&&!t.isDestroyed&&(!s||!w.isFocusable(s)||a&&!a.isFocusable)){if(s=null,t.eachWidget){const o=[];if(t.eachWidget(l=>{(l===r||l.isFocusable)&&o.push(l)},!1),o.length>1){const l=o.indexOf(r);s=o[l+n]||o[l-n]}}!s&&t.isFocusable&&(s=t),s=s?s.focusElement:(e=t.getFocusRevertTarget)==null?void 0:e.call(t)}return s}getStaticWidgetClasses(e,r){const t=new J,i=this.$meta.hierarchy;let n,s,a,o,l;for(s=i.indexOf(e);s<i.length;++s)n=i[s],l=Reflect.getOwnPropertyDescriptor(n.prototype,"widgetClass"),l!=null&&l.get?o=l.get.call(this):(a=Mn(n,"$$name")||Mn(n,"$name")||Mn(n,"_$name")?n.$$name:n.name,(a.length<3||a.includes("$"))&&console.warn(`Class "${a}" extending "${n.$name}" should have "$name" static getter with no less than 3 chars.`),o=`b-${a.toLowerCase()}`),o&&t.add(r?o+r:o);return t}get rootUiClass(){return $}get staticClassList(){const{$meta:e}=this;let r=e.staticClassList;return r||(e.staticClassList=r=this.getStaticWidgetClasses($),q.isTouchDevice&&r.add("b-touch")),r}get uiClasses(){return this.getConfig("ui"),this._uiClasses}get uiClassList(){return this.getConfig("ui"),this._uiClassList}get widgetClassList(){const e=this,{cls:r,defaultCls:t,uiClasses:i}=e;let{staticClassList:n}=e;(t||r)&&(n=n.clone(),t&&n.assign(t),r&&n.assign(r));const s=n.values;return i&&s.push(...i),e.floating&&s.push("b-floating"),e.collapsify==="hide"&&s.push("b-collapsify-hide"),s}changeCls(e){return J.from(e)}updateCls(e,r){if(!this.isConfiguring&&!this.isComposable){const{element:t}=this;r&&T.getTruthyKeys(r).forEach(i=>t.classList.remove(i)),e.assignTo(t)}}changeContentElementCls(e){return J.from(e)}changeHtmlCls(e){return J.from(e)}changeDefaultCls(e){return J.from(e,!0)}changeUi(e){return J.from(e)}updateUi(e){let r=null,t,i;if(e){const n=this.getStaticWidgetClasses(this.rootUiClass);for(i in e)if(e[i])for(t in n)n[t]&&((r||(r=new J))[`${t}-ui-${i}`]=1)}this._uiClasses=r==null?void 0:r.values,this._uiClassList=r}fromCache(e,r=!1,t=this.element){if(!t)return null;const i=this;return i.cache[e]||(i.cache[e]=r?w.children(t,e):w.down(t,e)),i.cache[e]}emptyCache(){this.cache={}}changeMasked(e,r){var t;if(((t=this.masked)==null?void 0:t.type)!=="trial"){if((e===!0||e==="")&&(e="\xA0"),r&&!r.isDestroyed)typeof e=="string"?(r.text=e,e=r):e?(r.setConfig(e),e=r):r.destroy();else if(e){const i=$.resolveType("mask");e=i.mergeConfigs(this.maskDefaults,e),e.owner=this,e=i.mask(e)}return e||null}}onMaskAutoClose(e){e.isDestroyed&&e===this.masked&&(this.masked=null)}mask(e){return this.masked=e,this.masked}unmask(){this.masked=null}onInternalResize(e,r,t,i,n){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e,r){const t=this,{element:i}=t,n=t._width,s=t._height,a=i.offsetWidth,o=i.offsetHeight;t.floating&&r&&t.onFloatingWidgetResize(...arguments),!t.suspendResizeMonitor&&(n!==a||s!==o)&&(t.onInternalResize(i,a,o,n,s),t.trigger("resize",{width:a,height:o,oldWidth:n,oldHeight:s}))}onFloatingWidgetResize(e,r,t){const i=this,{lastAlignSpec:n,constrainTo:s}=i;if(i.isVisible&&n&&n.target){const a=!r||t.height!==r.height,o=!r||t.width!==r.width,l=s&&!k.from(s).contains(k.from(i.element,null,!0));(a&&n.zone!==2||o&&n.zone!==1||l)&&i.requestAnimationFrame(()=>i.realign())}}updateScale(){const e=this,r=e.element,t=r.parentElement;e.configuredWidth||(e.configuredWidth=e.width),r.style.display="none";const i=k.client(t),n=i.width/e.configuredWidth,s=e.scale=e.allowGrowWidth?Math.min(n,1):n;r.style.transform=`scale(${s})`,r.style.transformOrigin="top left",r.style.display="",e.allowGrowWidth&&n>1&&(e.width=e.configuredWidth*n)}onParentElementResize(e){this.updateScale()}parseTRBL(e,r="px"){if(e=e||0,typeof e=="number")return[`${e}${r}`,`${e}${r}`,`${e}${r}`,`${e}${r}`];const t=e.split(" "),i=t.length;return i===1?t[1]=t[2]=t[3]=t[0]:i===2?(t[2]=t[0],t[3]=t[1]):i===3&&(t[3]=t[1]),[isFinite(t[0])?`${t[0]}${r}`:t[0],isFinite(t[1])?`${t[1]}${r}`:t[2],isFinite(t[2])?`${t[2]}${r}`:t[3],isFinite(t[3])?`${t[3]}${r}`:t[4]]}get documentRoot(){var e;return((e=this.owner)==null?void 0:e.documentRoot)||this.element.getRootNode()}get eventRoot(){var e,r;return(e=this.element)!=null&&e.isConnected?w.getRootElement(this.element):((r=this.owner)==null?void 0:r.eventRoot)||this._rootElement}get rootElement(){var e,r;const t=this;if(!t._rootElement){let i=((e=t.owner)==null?void 0:e.rootElement)||w.getRootElement(t.forElement||((r=t.element)!=null&&r.isConnected?t.element:t.getRenderContext()[0]||t.element));i||(i=document.body),t._rootElement=i}return t._rootElement}get floatRoot(){var e;const r=this,{rootElement:t}=r;let{floatRoot:i}=t;if(i)t.contains(i)||t.appendChild(i);else{const{outerCls:n}=$,s=(e=w.getThemeInfo(null,t))==null?void 0:e.name;if(!w.isValidFloatRootParent(t))throw new Error("Attaching float root to wrong root");s&&n.push(`b-theme-${s.toLowerCase()}`),i=t.floatRoot=w.createElement({className:`b-float-root ${n.join(" ")}`,parent:t}),ml.push(i),q.isAndroid&&(i.style.height=`${screen.height}px`,B.on({element:globalThis,orientationchange:()=>i.style.height=`${screen.height}px`,thisObj:this})),be.ion({theme:({theme:a,prev:o})=>{i.classList.add(`b-theme-${a.toLowerCase()}`),i.classList.remove(`b-theme-${o.toLowerCase()}`)}})}return i}get floatRootMaxZIndex(){let e=1;return Array.from(this.floatRoot.children).forEach(r=>{const t=parseInt(getComputedStyle(r).zIndex||0,10);t>e&&(e=t)}),e}static resetFloatRootScroll(){ml.forEach(e=>e.scrollTop=e.scrollLeft=0)}static get floatRoots(){return ml}static removeFloatRoot(e){ml.splice(ml.indexOf(e),1)}static get outerCls(){const e=["b-outer"],{platform:r}=q;return r&&e.push(`b-${r}`),q.isTouchDevice&&e.push("b-touch-events"),q.isMobile&&e.push("b-mobile"),w.scrollBarWidth?e.push("b-visible-scrollbar"):e.push("b-overlay-scrollbar"),q.isChrome?e.push("b-chrome"):q.isSafari?e.push("b-safari"):q.isFirefox&&e.push("b-firefox"),q.isPhone&&e.push("b-phone"),globalThis.ResizeObserver||e.push("b-no-resizeobserver"),e}get isAnimating(){return this._isAnimatingCounter>0}set isAnimating(e){const r=this,{_isAnimatingCounter:t}=r;r._isAnimatingCounter=Math.max(0,t+(e?1:-1)),t===0&&e?(r.element.classList.add("b-animating"),r.trigger("animationStart")):t===1&&!e&&(r.element.classList.remove("b-animating"),r.trigger("animationEnd"))}async waitForAnimations(){this.isAnimating&&await this.await("animationend",{checkLog:!1})}static query(e,r=!1){const{idMap:t}=$.identifiable;for(const i in t)if($.widgetMatches(t[i],e,r))return t[i];return null}static queryAll(e,r=!1){const{idMap:t}=$.identifiable,i=[];for(const n in t)$.widgetMatches(t[n],e,r)&&i.push(t[n]);return i}static fromElement(e,r,t){const i=typeof r;e&&!e.nodeType&&(e=e.target),(i==="number"||r&&r.nodeType===Element.ELEMENT_NODE)&&(t=r,r=null);let n=e,s=0,a,o,l;for(typeof t!="number"&&(a=t,t=Number.MAX_VALUE),i==="string"&&(r=r.toLowerCase());n&&n.nodeType===Element.ELEMENT_NODE&&s<t&&n!==a;){if(o=n.dataset&&n.dataset.ownerCmp||n.id,o){if(l=$.getById(o),l)if(r){if(i==="function"){if(r(l))return l}else if($.widgetMatches(l,r,!0))return l}else return l;s++}n=n.parentNode}return null}static fromSelector(e){const r=document.querySelector(e);return r?$.fromElement(r):null}triggerFieldChange(e,r=!0){var t;r&&this.trigger("change",e),(t=this.eachAncestor)==null||t.call(this,i=>{var n,s;if((n=i.onFieldChange)==null||n.call(i,e),(s=i.isolateFieldChange)!=null&&s.call(i,this))return!1})}isolateFieldChange(e){return this.isolateFields}setupFocusListeners(){be.setupFocusListenersOnce(this.eventRoot,B)}static widgetMatches(e,r,t){return r==="*"?!0:typeof r=="function"?r(e):$.isType(e,r,t)}static attachTooltip(e,r){return typeof r=="string"&&(r={html:r}),$.create(Object.assign({forElement:e},r),"tooltip"),e}changeDock(e){return e==="start"?"left":e==="end"?"right":e}updateRtl(e){super.updateRtl(e),this.eachWidget(r=>{"rtl"in r.initialConfig||(r.rtl=e)})}},EA=$.prototype;["compose","domSyncCallback"].forEach(e=>EA[e].$nullFn=!0),$.initClass(),$.register("mask",Bt),w.Widget=$,be.Widget=$,Bt.identifiable.idMap=$.identifiable.idMap,Object.assign(globalThis.bryntum||(globalThis.bryntum={}),{get:$.getById.bind($),query:$.query,queryAll:$.queryAll,fromElement:$.fromElement,fromSelector:$.fromSelector}),$._$name="Widget";var Lr=class extends F.mixin(Le,En){get contentElement(){var e;return(e=this.owner)==null?void 0:e.contentElement}onChildAdd(e){}onChildRemove(e){}renderChildren(){const e=this,{owner:r,itemCls:t}=e,{contentElement:i,items:n}=r,s=r.itemCls,a=n==null?void 0:n.length;if(a){r.textContent=!1;for(let o=0;o<a;o++){const l=n[o],{element:c}=l,{classList:d}=c;c.dataset.itemIndex=o,d.contains("b-outer")&&d.remove(...$.outerCls),t&&d.add(t),s&&d.add(s),l.render(i,!!r.isPainted)}}e.syncPendingConfigs(),e.syncChildCount()}removeChild(e){const r=this,{element:t}=e,{owner:i,itemCls:n}=r,{contentElement:s}=i,a=i.itemCls;s.contains(t)&&t.remove(),delete t.dataset.itemIndex,n&&t.classList.remove(n),a&&t.classList.remove(a),r.fixChildIndices(),r.syncChildCount()}appendChild(e){const{element:r}=e,{owner:t,itemCls:i}=this,{contentElement:n}=t,s=t.itemCls;r.dataset.itemIndex=t.indexOfChild(e),t.textContent=!1,i&&r.classList.add(i),s&&r.classList.add(s),e.render(n,!!t.isPainted),this.syncChildCount()}insertChild(e,r){const t=this,{element:i}=e,{owner:n,itemCls:s}=t,{contentElement:a}=n,o=w.getChild(a,`[data-item-index="${r}"]`),l=n.itemCls;n.textContent=!1,s&&i.classList.add(s),l&&i.classList.add(l),a.insertBefore(i,o),e.render(null,!!n.isPainted),t.fixChildIndices(),t.syncChildCount()}fixChildIndices(){this.owner.items.forEach((e,r)=>{e.element.dataset.itemIndex=r})}syncChildCount(){var e;const{owner:r}=this,{length:t}=r.items;(e=r.contentElement)==null||e.classList[t===1?"add":"remove"]("b-single-child")}syncConfigLater(e){const r=this.pendingConfigs||(this.pendingConfigs=[]);r.includes(e)||r.push(e)}syncConfigStyle({name:e,style:r,classes:t,map:i}){const n=this,s=`b-box-${e}-`,{contentElement:a}=n,o=n[e];let l=(i==null?void 0:i[o])||o;if(a){if(t){const{classList:c}=a;t.forEach(d=>{d!==l&&c.remove(s+d)}),t.includes(l)&&(c.add(s+l),l="")}a.style[r]=l}else n.syncConfigLater(e)}syncPendingConfigs(){const e=this,{pendingConfigs:r}=e;let t;if(r)for(e.pendingConfigs=null;t=r.pop();)e[e.$meta.configs[t].updater](e[t])}};E(Lr,"type","default"),E(Lr,"configurable",{owner:null,containerCls:"b-auto-container",itemCls:null}),E(Lr,"factoryable",{defaultType:"default"}),Lr.initClass(),Lr._$name="Layout";var kw=0,xA=e=>e.ripple,vm=class extends ${static get defaultConfig(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,scrollAction:"realign",color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}static get $name(){return"Ripple"}afterConstruct(){super.afterConstruct(),B.on({element:this.rootElement,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}onRippleControllingEvent(e){var r;const t=this;t.show();const i=w.getStyleValue(t.circleElement,"animationName");t.hide(),(r=t.listenerDetacher)==null||r.call(t),i&&i!=="none"&&(t.listenerDetacher=B.on({mousedown:{element:t.rootElement,capture:!0,handler:"onMousedown"},touchstart:{element:t.rootElement,capture:!0,handler:"onTouchStart"},animationend:{element:t.circleElement,handler:"onAnimationEnd"},thisObj:t}),e.type==="mousedown"&&(t.onMousedown(e),be.ion({theme:"onRippleControllingEvent",thisObj:this})))}onTouchStart(e){kw=performance.now(),this.handleTriggerEvent(e)}onMousedown(e){performance.now()-kw>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const r=$.fromElement(e.target,xA);if(r){const t=r.ripple,i=t.delegate?e.target.closest(t.delegate):r.focusElement||r.element;if(i){const n=T.assign({event:e,target:i,radius:this.radius},t);if(typeof n.clip=="string"&&(n.clip=r[n.clip]||e.target.closest(n.clip),!n.clip))return;this.ripple(n)}}}ripple({event:e,point:r=B.getClientPoint(e),target:t=e.target,clip:i=t,radius:n=this.radius,color:s=this.color}){this.clip=i,i=k.from(i,null,!0);const a=this,o=i.getDelta(r),l=a.rippleElement.style,c=a.circleElement,d=w.getStyleValue(t,"border-radius");a.hide(),l.transform=`translateX(${o[0]}px) translateY(${o[1]}px)`,l.height=l.width=`${n}px`,a.element.style.borderRadius=d,c.setAttribute("r",n),c.setAttribute("fill",s),a.showBy({target:i,align:"c-c",matchSize:!0})}onAnimationEnd(e){e.animationName==="b-ripple-expand"&&this.hide()}};$.RippleClass=vm,vm._$name="Ripple";var RA=Object.freeze({}),{isArray:na}=Array,TA=e=>e.weight,Fw=({weight:e},{weight:r})=>typeof e=="string"||typeof r=="string"?String(e).localeCompare(String(r)):(e!=null?e:Number.MAX_SAFE_INTEGER)-(r!=null?r:Number.MAX_SAFE_INTEGER),Ow=e=>e&&!e.hidden,MA=["display","flex-direction"],IA={default:1,box:1},Ht=class extends ${static get $name(){return"Container"}static get type(){return"container"}static get configurable(){return{items:null,lazyItems:{$config:["lazy"],value:null},defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:{type:"default"},namedItems:null,overflowable:{value:null,default:!1,$config:null},textContent:!0,record:null,strictRecordMapping:null,autoUpdateRecord:null,autoUpdateFields:null,hideWhenEmpty:null,contentElMutationObserver:{$config:["lazy","nullify"],value:!0},isolateFields:!1,focusDescendant:!1,defaultBindProperty:null,defaultFocus:null}}static get prototypeProperties(){return{flexRowCls:"b-flex-row",flexColCls:"b-flex-column",initialItems:!0}}startConfigure(e){const r=e.items||e.lazyItems;(this.hasItems=!!(r&&(na(r)?r:Object.keys(r)).length))||(this.initialItems=!1),super.startConfigure(e)}get firstItem(){return this.getAt(0)}get lastItem(){return this.getAt(-1)}getAt(e){return this.ensureItems().at(e)}remove(...e){let r=!0;e.length===1&&(na(e[0])?e=e[0]:r=!1);const t=this,{_items:i}=t,n=[];for(let s=0;s<e.length;s++){const a=e[s];i.includes(a)&&(i.remove(a),t.layout.removeChild(a),n.push(a),t.onChildRemove(a))}return r?n:n[0]}removeAll(){return this.remove(this.items)}add(...e){const r=this,t=r.ensureItems(),i=[];let n=!0,s,a,o;for(e.length===1&&(na(e[0])?e=e[0]:n=!1),a=0;a<e.length;a++)s=e[a],s.isWidget?s.parent=r:s=r.createWidget(s),(s==null?void 0:s.weight)!=null?(o=H.findInsertionIndex(s,t.values,Fw),i.push(r.insert(s,o))):s&&(t.includes(s)||(t.add(s),r.onChildAdd(s),r.layout.appendChild(s),i.push(s)));return n?i:i[0]}ensureItems(){const e=this;return e.getConfig("items"),e.getConfig("lazyItems"),e._items||(e.items=[]),e._items}insert(e,r){const t=this,i=t.ensureItems();e instanceof $?e.parent=t:e=t.createWidget(e),i.includes(r)&&(r=t.indexOfChild(r)),r=Math.min(r,i.count);const n=i.values;return n.splice(r,0,e),i.values=n,t.onChildAdd(e),t.layout.insertChild(e,r),e}indexOfChild(e){return this.items.indexOf(e)}changeLazyItems(e){this.items=e,this.layout.renderChildren()}changeItems(e,r){const t=this,i=[],n=new ll;return na(e)?t.processItemsArray(e,i):e&&t.processItemsObject(e,t.namedItems,i),i.some(TA)&&i.sort(Fw),n.add(i),r&&r.forEach(s=>{t.remove(s),!n.includes(s)&&s._createdBy===t&&s.destroy()}),n}afterConstruct(){const{rtl:e}=this,{classList:r}=this.contentElement;r.toggle("b-rtl",e===!0),r.toggle("b-ltr",e===!1)}updateRtl(e){super.updateRtl(e);const{contentElement:r}=this;r&&(r.classList.toggle("b-rtl",e===!0),r.classList.toggle("b-ltr",e===!1))}updateItems(e,r){let t=0;e.forEach(i=>{this.onChildAdd(i),r&&!r.temporary&&this.layout.insertChild(i,t),++t}),this.initialItems=!1}updateHideWhenEmpty(){this.syncChildCount(this.rendered)}get items(){const e=this;if(e.getConfig("lazyItems"),!e._items){if(e.initializingItems)return[];e._items=new ll,e._items.temporary=!0}return e._items.values}processItemsArray(e,r){const t=e.length;let i,n;for(i=0;i<t;i++)n=e[i],n instanceof $?(n.parent=this,n.element.classList.remove(...$.outerCls)):n=this.createWidget(n),n&&((n.ref||n.id)&&this.addDescendant(n),r.push(n))}processItemsObject(e,r,t){let i,n;for(n in e)i=e[n],i&&(r&&n in r&&(i=typeof i=="object"?T.merge(T.clone(r[n]),i):r[n]),i&&(i instanceof $?i.parent=this:(i instanceof Object&&(i.ref=n),i=this.createWidget(i)),i&&(i.ref=n,this.addDescendant(i),t.push(i))))}onChildAdd(e){if(e.innerItem&&this.readOnly&&!e.ignoreParentReadOnly&&(e.readOnly=!0),this.onChildAddLayout(e),e.ref||e.id)for(let r=this;r;r=r.parent)r.addDescendant(e);this.syncChildCount(!0)}onChildAddLayout(e){e.innerItem&&this.layout.onChildAdd(e)}onChildHide(e){var r;super.onChildHide(e),(r=this._items)!=null&&r.includes(e)&&this.syncChildCount(!0)}onChildShow(e){var r;super.onChildShow(e),(r=this._items)!=null&&r.includes(e)&&this.syncChildCount(!0)}syncChildCount(e){if(!this.isConfiguring){const r=this,{items:t,hasItems:i}=r,n=t.filter(Ow),{length:s}=n;if(r.visibleChildCount=s,r.hideWhenEmpty&&e){const a=!s;!!r._hidden!==a&&(r.hidden=a)}t.forEach(a=>a.element.classList.remove("b-last-visible-child","b-first-visible-child")),s&&(n[0].element.classList.add("b-first-visible-child"),n[s-1].element.classList.add("b-last-visible-child")),r.hasItems=!!r.childItems.length,r.contentElement.classList[s?"remove":"add"]("b-no-visible-children"),r.isComposable?i!==r.hasItems&&r.recompose():r.updateTextContent(r._textContent)}}syncFlexDirection(){const e=this,{contentElement:r,flexColCls:t,flexRowCls:i}=e,n=new J(r.className),s=w.getStyleValue(r,MA);n[i]=n[t]=0,s.display==="flex"&&(n[s["flex-direction"]==="row"?i:t]=1),w.syncClassList(r,n)}addDescendant(e){const r=e.ref||e.id,t=this._widgetMap||(this._widgetMap={});t[r]||(t[r]=e)}onChildRemove(e){const r=this,t=e.ref||e.id;if(t)for(let i=r;i;i=i.parent)i.widgetMap[t]===e&&delete i.widgetMap[t];r.layout.onChildRemove(e),r.syncChildCount(!0)}get widgetMap(){return this._widgetMap||(this._widgetMap={}),this.initializingItems||this.getConfig("items"),this._widgetMap}changeRecord(e){return this._record=e==null?RA:null,e}updateRecord(e){var r;const t=this;(r=t.recordUpdateDetacher)==null||r.call(t),t.trigger("beforeSetRecord",{record:e}),t.setValues(e,{onlyName:t.strictRecordMapping,highlight:!!t.$highlight}),t.autoUpdateFields&&(e!=null&&e.firstStore)&&(t.recordUpdateDetacher=e.firstStore.ion({update:t.onRecordUpdated,thisObj:t}))}setRecord(e,r){this.$highlight=r,this.record=e,this.$highlight=!1}onRecordUpdated({record:e}){e===this.record&&this.setValues(this.record,!0,!0)}onFieldChange({source:e,userAction:r}){if(this.autoUpdateRecord&&r){const{record:t,strictRecordMapping:i}=this,{name:n,ref:s,isValid:a=!0,value:o}=e,l=i?n:n||s;t&&l&&a&&(t.isModel?t.setValue(l,o):t[l]=o)}}getValues(e){const r={};return this.eachWidget((t,i)=>{t.isolateFields?i.down=!1:"name"in t&&(!e||e(t))&&(r[t.name]=t.value)},!0),r}get values(){const e={};return this.gatherValue(e),e}set values(e){this.assignValue(e)}get isSettingValues(){return!!this.assigningValues}get assigningValues(){var e;return this._assigningValues||((e=this.parent)==null?void 0:e.assigningValues)}set assigningValues(e){this._assigningValues=e}assignValue(e,r){super.assignValue(e,r),this.isolateFields||this.setValues(e,r)}gatherValue(e){super.gatherValue(e),this.isolateFields||this.gatherValues(e)}setValues(e,r=this.assignValueDefaults){this.assigningValues=r,this.eachWidget(t=>t.assignValue(e,r),!1),this.assigningValues=!1}get hasNoChildren(){const e=this,{items:r,lazyItems:t}=e.initialConfig,i=r&&(na(r)?r:T.values(r)),n=t&&(na(t)?t:T.values(t)),s=e.isConfiguring?n||i:e.items;return!(s!=null&&s.filter(Ow).length)}afterRecompose(){super.afterRecompose(),this.realign()}updateTextContent(e){const r=this;if(!r.isComposable){const t=!!(e&&r.hasNoChildren),{classList:i}=r.contentElement;t!==i.contains("b-text-content")&&(i[t?"add":"remove"]("b-text-content"),r.rendered&&r.realign())}}updateLayoutStyle(e){w.applyStyle(this.contentElement,e)}updateElement(e){if(super.updateElement(...arguments),e){const{classList:r}=this.contentElement,{containerCls:t}=this.layout;r.add("b-content-element"),t&&r.add(t)}}onPaint(){var e;(e=super.onPaint)==null||e.call(this,...arguments),this.getConfig("contentElMutationObserver")}changeContentElMutationObserver(e,r){if(r&&(r.takeRecords(),r.disconnect()),e){const t=this,{element:i,contentElement:n}=t;e=new MutationObserver(s=>t.onContentElMutation(s)),e.observe(n,{attributes:!0}),n!==i&&e.observe(i,{attributes:!0}),t.syncFlexDirection()}return e}onContentElMutation(){IA[this.layout.type]&&this.isVisible&&this.syncFlexDirection()}changeLayout(e,r){return Lr.reconfigure(r,e,{owner:this,defaults:{owner:this}})}get childItems(){return this.items}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}setupWidgetConfig(e,r){const t=this;typeof e=="string"?e={html:e}:e.nodeType===Element.ELEMENT_NODE&&(e={element:e,id:e.id}),(typeof r=="string"||!r&&(r=e.type))&&(r==="checkbox"&&q.isMobile&&$.resolveType("slidetoggle",!0)&&(r=e.type="slidetoggle"),r=$.resolveType(r,!0)),e=(r||$).mergeConfigs(t.defaults,e,{parent:t});for(let i=e.parent;i;i=i.parent)if(i.processWidgetConfig(e)===!1)return null;return t.trigger("beforeWidgetCreate",{widgetConfig:e})===!1?null:e}createWidget(e){const r=$.create(this.setupWidgetConfig(e),this.defaultType);return r&&(r._createdBy=this),r}updateDefaults(e,r){if(!this.isConfiguring&&e){const t=Object.entries(e);this.eachWidget(i=>{t.forEach(([n,s])=>{(!r||i[n]===r[n])&&(i[n]=s)})},!1)}}render(){this.getConfig("lazyItems"),this.layout.renderChildren(),this.syncChildCount(),super.render(...arguments)}get focusElement(){const e=this.query(this.defaultFocus||(r=>{var t;return r.isFocusable&&r.ref!=="close"&&!((t=r.ref)!=null&&t.endsWith("collapse"))}));return e?e.focusElement:super.focusElement}doDestroy(){var e;(e=this._items)==null||e.forEach(r=>{var t;return(t=r.destroy)==null?void 0:t.call(r)}),this.layout.destroy(),super.doDestroy()}get isValid(){let e=!0;return this.eachWidget(r=>{r.isVisible&&"isValid"in r&&!r.isValid&&(e=!1)},!0),e}};Ht.initClass(),Ht._$name="Container";var{assign:pl}=T,Lw=()=>performance.now(),PA={start:!1},AA=/^[.\d]+([^\d].*)?$/,$w=e=>{const r=e.$bryntum||(e.$bryntum={});return r.transitions||(r.transitions=Object.create(null))},jw=(e,r)=>{var t;return typeof e=="string"&&(r=(t=AA.exec(e))==null?void 0:t[1],e=parseFloat(e)),e&&e*(r==="s"||!r&&e<10?1e3:1)},ym=e=>{const r=T.values($w(e)).filter(t=>t.completed==null).map(t=>t.toString());e.style.transition=r.join(", ")},Bw=e=>class extends e{static get prototypeProperties(){return{_delay:null,_duration:null,_retain:null,_timing:null,_unit:null,owner:null,reverting:null}}constructor(...t){super(...t),this.id=++_A}start(){this.startTime=Lw()}get delay(){var t,i,n;return jw((n=(i=this._delay)!=null?i:(t=this.owner)==null?void 0:t.delay)!=null?n:0,this.unit)}set delay(t){this._delay=t}get duration(){var t;const{owner:i,unit:n}=this;return jw((t=this._duration)!=null?t:i?i.duration:je.defaultDuration,n)}set duration(t){this._duration=t}get elapsed(){return Lw()-this.startTime}get remaining(){return this.duration-this.elapsed}get retain(){var t,i;return(i=this._retain)!=null?i:(t=this.owner)==null?void 0:t.retain}set retain(t){this._retain=t}get timing(){var t,i;return(i=this._timing)!=null?i:(t=this.owner)==null?void 0:t.timing}set timing(t){this._timing=t}get unit(){var t,i;return(i=this._unit)!=null?i:(t=this.owner)==null?void 0:t.unit}set unit(t){this._unit=t}},_A=0,Yd=class extends F.mixin(Bw){static get $name(){return"AnimatorTransition"}static get prototypeProperties(){return{element:null,property:null,from:null,to:null,completed:null,promissory:null,reverting:null}}afterConstruct(){super.afterConstruct();const e=this,{element:r,transitions:t}=e;let{property:i}=e;[i,e.to]=w.unitize(i,e.to),e.from=w.unitize(i,e.from)[1],e.promissory=new gl,e.property=i;const n=t[i];t[i]=e;let{from:s}=e;n&&(e.from=n.to,s=null,n.destroy()),s===null&&(s=e.getCurrentStyleValue(),n||(e.from=s)),r.style[i]=s,e.getCurrentStyleValue()}doDestroy(){const e=this;e.finish(!1),e.completed&&!e.retain&&e.clearStyle(),super.doDestroy()}get promise(){var e;return(e=this.promissory)==null?void 0:e.promise}get transitions(){return $w(this.element)}clearStyle(){this.setStyle("")}finish(e){const r=this,{transitions:t,promissory:i,property:n}=r;i&&(r.completed=e,r.promissory=null,i.resolve(e),t[n]===r?(delete t[n],e||(ym(r.element),r.clearStyle())):r.completed=!1)}getCurrentStyleValue(){return w.getStyleValue(this.element,this.property)}revert(){const{duration:e,elapsed:r,element:t,from:i,property:n,_retain:s,_timing:a}=this;return new Yd({element:t,property:n,retain:s,timing:a,duration:Math.round(Math.min(e,r)),reverting:this,to:i,unit:"ms"})}setStyle(e){this.element.style[this.property]=e}start(){const e=this,{delay:r,duration:t,element:i,property:n}=e;B.onTransitionEnd({element:i,property:n,duration:r+t+20,thisObj:e.owner,handler:()=>{var s;return(s=e.finish)==null?void 0:s.call(e,!0)}}),super.start(),e.setStyle(e.to)}toString(){const{delay:e,duration:r,property:t,timing:i}=this;return`${t} ${r}ms ${i||"ease-in-out"}${e?` ${e}ms`:""}`}};Yd.initClass();var je=class extends F.mixin(Bw){static get $name(){return"Animator"}static get prototypeProperties(){return{element:null,finalize:null,prefinalize:null,completed:null,items:null}}static register(e,r){if(T.isObject(e)){T.entries(e).forEach(t=>je.register(...t));return}je.fx[e]=r,je[e]=t=>(w.isElement(t)?t={element:t,[e]:{}}:(t={element:t.element,[e]:t},delete t[e].element),je.run(t))}static run(e){return new je(e).start()}constructor(e){var r;super(null);const t=this,i=[],n={};let s,a,o,l;if(Array.isArray(e))t.items=e;else for(o in e)(je.specialPropsRe.test(o)?t:n)[o]=e[o];T.keys(n).forEach(c=>{l=n[c],l!=null&&l!==!1&&l===l&&((a=je.fx[c])?(l=pl(t.defaults,a(l,t,c)),l.owner=t,s=new je(l)):(l=pl(t.defaults,typeof l=="object"?l:{to:l}),l.owner=t,l.property=c,s=new Yd(l)),i.push(s))}),(r=t.items)==null||r.forEach(c=>{T.isInstantiated(c)?c.owner=t:(c=pl(t.defaults,c),c.owner=t,c=new je(c)),i.push(c)}),t.items=i,t.promise=(i.length===1?i[0].promise:Promise.all(i.map(c=>c.promise))).then(c=>{var d;return(d=t.finish)==null||d.call(t,c),t.completed||!1})}doDestroy(){this.items.forEach(e=>e.destroy()),super.doDestroy()}get defaults(){return{element:this.element}}get retain(){const{_retain:e,finalize:r,owner:t}=this;return e!=null?e:r?!1:t?t.retain:!0}set retain(e){super.retain=e}done(){return this.promise}finish(e){var r,t;const i=this,{items:n}=i;for(ym(i.element),i.completed=typeof e=="boolean"?e:!e.some(s=>!s),(r=i.prefinalize)==null||r.call(i,i.completed,i);n.length;)n.pop().destroy();(t=i.finalize)==null||t.call(i,i.completed,i)}revert(e){var r;const t=this,{reverting:i}=t,n=!e||((r=e.start)!=null?r:!0);let s=t.defaults;return i&&(i.finalize&&(s.finalize=i.finalize),i.prefinalize&&(s.prefinalize=i.prefinalize),s.retain=i._retain),s=pl(s,e,{items:t.items.map(a=>a.revert(PA)),reverting:t}),s=new je(s),n&&s.start(),s}start(){const{element:e,items:r}=this;return super.start(),r.length&&(ym(e),r.forEach(t=>t.start())),this}};je.initClass().Transition=Yd,je.specialPropsRe=new RegExp(`^(?:${Object.keys(je.prototypeProperties).concat(Object.keys(je.superclass.prototypeProperties)).map(e=>e[0]==="_"?e.substr(1):e).join("|")})$`),je.defaultDuration=200,je.fx={},je.register({puff(e){return e===!0?e={}:typeof e!="object"?e={transform:`scale(${e})`}:e.scale&&(e=T.clone(e),e.transform=`scale(${e.scale})`,delete e.scale),pl({opacity:0,transform:"scale(8)"},e)}}),je._$name="Animator";var qd=class extends F.mixin(fe){static get configurable(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3,pressedCls:"b-pressed"}}doDestroy(){var e;(e=this.mousedownRemover)==null||e.call(this),this.cancel(),super.doDestroy()}cancel(){var e,r,t;const i=this;(e=i.activeElement)==null||e.classList.remove(i.pressedCls),i.activeElement=null,(r=i.acceleration)==null||r.cancel(),i.activeListenerRemover=(t=i.activeListenerRemover)==null?void 0:t.call(i),i.clearTimeout(i.autoRepeatTimer),i.clearTimeout(i.repeatTimer)}updateElement(e){var r;(r=this.mousedownRemover)==null||r.call(this),this.mousedownRemover=B.on({element:e,mousedown:"onMouseDown",thisObj:this})}onMouseDown(e){const r=this,t=r.delegate?e.target.closest(r.delegate):r.element;r.cancel(),t&&(r.activeElement=t,r.triggerEvent=e,t.classList.add(r.pressedCls),r.activeListenerRemover=B.on({mouseup:{element:document,capture:!0,handler:"onMouseUp"},mousemove:{element:t,handler:"onTargetMouseMove"},mouseleave:{element:t,handler:"onTargetMouseLeave"},mouseenter:{element:t,handler:"onTargetMouseEnter"},thisObj:r}),r.autoRepeatTimer=r.setTimeout("startAutoRepeat",r.delay))}onMouseUp(){this.cancel()}onTargetMouseLeave(){this.activeElement.classList.remove(this.pressedCls),this.clearTimeout(this.repeatTimer)}onTargetMouseEnter(e){const r=this;e.buttons?(r.activeElement.classList.add(r.pressedCls),r.triggerEvent=e,r.fireClick()):r.cancel()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=Te.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,r=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(r),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}};qd._$name="ClickRepeater";var kA=/^(?:undefined|null|LEFT|RIGHT)$/,FA={TOP:"BOTTOM",RIGHT:"LEFT",BOTTOM:"TOP",LEFT:"RIGHT"},Hw=e=>{const r=e==null?void 0:e.toUpperCase();return[r,r==="LEFT"||r==="RIGHT"]},Kd=e=>class extends(e||F){static get $name(){return"Rotatable"}static get configurable(){return{rotate:null,invertRotate:null}}compose(){const{rotate:t}=this;return{class:{[`b-rotate-${(t||"").toLowerCase()}`]:t,"b-rotate-vertical":t}}}syncRotationToDock(t){if(kA.test(String(this.rotate))){const[i,n]=Hw(t);this.rotate=n?this.invertRotate?FA[i]:i:null}}get widgetClass(){return null}},In=class extends $.mixin(Kd){compose(){const{align:e,href:r}=this;return{tag:r!=null?"a":"button",class:{[`b-align-${e||"end"}`]:1,"b-icon":1},listeners:{click:"onInternalClick"}}}get focusElement(){return this.element}get panel(){var e,r;if((e=this.parent)!=null&&e.isPanel&&((r=this.element)!=null&&r.parentNode.matches(".b-panel-header")))return this.parent}changeAlign(e){return e}onInternalClick(e){const r=this,{handler:t,panel:i}=r,n={domEvent:e,tool:r};r.disabled||(r.trigger("click",n),r.isDestroyed||(r.trigger("action",n),!r.isDestroyed&&(i==null?void 0:i.trigger("toolClick",n))!==!1&&t&&r.callback(t,i,[e,i,r])))}onInternalKeyDown(e){(e.key.trim()||e.code)==="Enter"&&(e.cancelBubble=!0,e.stopPropagation())}updateDisabled(e,r){var t;super.updateDisabled(e,r),e&&((t=this.repeat)==null||t.cancel())}changeRepeat(e,r){return r==null||r.destroy(),e&&qd.new({element:this.element},e)}};E(In,"$name","Tool"),E(In,"type","tool"),E(In,"configurable",{align:{value:null,$config:{merge:"replace"}},href:null,repeat:null,defaultBindProperty:null}),In.initClass(),In._$name="Tool";var OA=/right/i,LA=e=>(e.collapsed||e.collapsing)&&e.owner.expandedHeaderDock==="top"&&e.owner.collapsible.direction.match(OA)?"start":"end",bm=class extends In{static get $name(){return"CollapseTool"}static get type(){return"collapsetool"}static get configurable(){return{autoAlign:!0,collapsed:null,collapsing:null,collapsify:!1,direction:"up",defaultBindProperty:null}}compose(){const{collapsed:e,direction:r}=this;return{class:{[`b-icon-collapse-${r}`]:1,"b-collapsed":e}}}changeAutoAlign(e){return e===!0?LA:e}syncAutoAlign(){const{autoAlign:e}=this;e&&(this.align=e(this))}updateAutoAlign(){this.syncAutoAlign()}updateCollapsed(){this.syncAutoAlign()}updateCollapsing(){this.syncAutoAlign()}updateDirection(){this.syncAutoAlign()}};bm.initClass(),bm._$name="CollapseTool";var Vw=/^(?:UP|DOWN|LEFT|RIGHT)$/,$A=/^(left|top)$/i,jA={},Nw=/^b-dock-(top|left|right|bottom)$/,Cm="b-panel-collapse-revealer",BA=/^(?:left|right)$/i,Xd="b-collapse-unflex",{round:_i}=Math,zw=["up","down","left","right"].reduce((e,r)=>(e[r.toUpperCase()]=e[r]=r,e),{}),Sm={top:["top","bottom"],right:["right","left"],bottom:["bottom","top"],left:["left","right"]},HA={hl:"LEFT",hr:"RIGHT",vb:"DOWN",vt:"UP"},VA={h:"w",w:"h"},Ww={up:"top",right:"right",down:"bottom",left:"left"},Zd={top:!1,right:!0,bottom:!1,left:!0},NA={top:"UP",right:"RIGHT",bottom:"DOWN",left:"LEFT"},Gw={top:e=>`translate(0, -${_i(e.height||0)}px)`,bottom:e=>`translate(0, ${_i(e.height||0)}px)`,right:e=>`translate(${_i(e.width||0)}px, 0)`,left:e=>`translate(-${_i(e.width||0)}px, 0)`},zA=0,Pn=class extends F.mixin(En){static get $name(){return"PanelCollapser"}static get type(){return"inline"}static get configurable(){return{animation:{duration:200},collapsed:{value:null,$config:null,default:!1},direction:null,collapseTooltip:"L{Collapse}",expandTooltip:"L{Expand}",panel:{value:null,$config:"nullify"},supportAxis:null,tool:{type:"collapsetool",handler(e){var r;(r=this.collapsible)==null||r.onCollapseClick(e)}}}}static get factoryable(){return{defaultType:"inline"}}get collapsing(){return this.collapsingExpanding==="collapsing"}get collapsingExpanding(){var e;const r=(e=this.currentOperation)==null?void 0:e.collapsing;return r==null?null:r?"collapsing":"expanding"}get currentDock(){var e,r,t,i;return(i=(t=(r=(e=this.panel)==null?void 0:e.header)==null?void 0:r.dock)==null?void 0:t.toLowerCase())!=null?i:"top"}get expanding(){return this.collapsingExpanding==="expanding"}get collapseTool(){var e,r;return(r=(e=this.panel)==null?void 0:e.tools)==null?void 0:r.collapse}get collapseDim(){return BA.test(this.collapseDir)?"width":"height"}getCollapseDir(e){var r;let{direction:t,panel:i}=this;if(!t||Vw.test(t)){const n=i==null?void 0:i.placement;n?t=HA[n]:t=NA[((r=i==null?void 0:i.header)==null?void 0:r.dock)||"top"]}return e?zw[t]:t}get collapseDir(){return this.getCollapseDir(!0)}get collapseDock(){return this.collapseInfo[0]}get collapseInfo(){const{panel:e}=this,r=e.hasHeader&&e.expandedHeaderDock;let t=Ww[this.collapseDir],i=!1;return r&&((i=Zd[t]!==Zd[r])||(t=r)),[t,i]}get toolsConfig(){const{direction:e,tool:r}=this;return r&&{collapse:T.assign({direction:e.toLowerCase()},r)}}beforeCollapse(e){const{panel:r}=this,{element:t}=r;t.contains(w.getActiveElement(t))&&r.revertFocus(!0)}changeTool(e){const r=this,{panel:t}=r;if(r.isConfiguring||r.isDestroying||!t||t.isDestroying)return e;t.tools={collapse:e}}collapse(e){var r,t;const i=this,{panel:n}=i,s={id:++zA,completed:!1,panel:n};let{currentOperation:a}=i;return e=e!=null?e:!0,T.isObject(e)&&(s.collapsed=!0,T.assign(s,e),e=s.collapsed,delete s.collapsed),s.collapsing=e,s.previous=a!=null?a:null,e!==i.collapsed?a?a.collapsing!==e&&(s.animation=a.animation.revert({finalize(){var o;(o=i.collapseFinalize)==null||o.call(i,s,!0)}}),s.collapsing=e,a=s):(s.animation=T.clone(("animation"in s?s:i).animation),i.beforeCollapse(s)!==!1&&(s.animation&&(s.animation.finalize=o=>{var l;return(l=i.collapseFinalize)==null?void 0:l.call(i,s,o)}),n.changingCollapse=!0,i[e?"collapseBegin":"expandBegin"](s),s.animation?a=s:(s.completed=!0,i[e?"collapseEnd":"expandEnd"](s)),n.changingCollapse=!1,s.animation||i.onComplete(e?"collapse":"expand"))):a&&a.collapsing!==e&&(i[e?"expandRevert":"collapseRevert"](s),s.animation=a.animation.revert({finalize(){var o;(o=i.collapseFinalize)==null||o.call(i,s,!1)}}),a=s),i.currentOperation=a,(t=(r=a==null?void 0:a.animation)==null?void 0:r.done())!=null?t:Promise.resolve(e===i.collapsed)}collapseFinalize(e,r){const t=this,{currentOperation:i,panel:n}=t,s=n.collapsed?"expand":"collapse";i===e&&(t.currentOperation=null,e.completed=r,n.changingCollapse=!0,t[s+"End"](e),n.changingCollapse=!1,r&&t.onComplete(s))}applyHeaderDock(e,r=!0){const t=this,{currentDock:i,panel:n}=t,s=e?t.collapseDock:n.expandedHeaderDock;s!==i&&n.hasHeader&&(n.header={dock:s},r&&n.recompose.flush())}composeHeader(e){const{panel:r}=this,{class:t}=e,i=r.expandedHeaderDock||Object.keys(t).filter(n=>t[n]&&Nw.test(n)).map(n=>Nw.exec(n)[1][0]);return t[Cm]=1,t[`b-collapsible-${i[0]}${this.collapseDir[0]}`]=1,e}composeTitle(e){return e.class[Cm]=1,e}collapseBegin(e){var r;const t=this,{animation:i}=e,{collapseDim:n,collapseTool:s,panel:a}=t,{element:o,placement:l}=a,[c,d]=t.collapseInfo,u=s==null?void 0:s.element.classList,h=!l||l[0]==="h"&&n==="width"||l[0]==="v"&&n==="height";t.configuredWidth=a._lastWidth,t.configuredHeight=a._lastHeight,t.transverseCollapse=d,t.applyHeaderDock(!0);const g=a.rectangle(),f=t.lockInnerSize().moveTo(0,0),m=f.clone(),p=Sm[c],v=(r=a.headerElement)==null?void 0:r.getBoundingClientRect(),y=_i((v==null?void 0:v[n])||0);o.classList.toggle(Xd,h),i?(m[p[0]]=m[p[1]],o.classList.add("b-collapsing"),u==null||u.add("b-collapsed","b-collapsing"),s&&(s.collapsing=!0),u&&(u.remove("b-collapsed"),a.rectangle(),u.remove("b-collapsing"),u.add("b-collapsed")),i.element=o,i.retain=!0,i[n]={from:_i(g[n]),to:y},i.items=[{element:t.innerElement,retain:!1,clip:{from:`rect(${f})`,to:`rect(${m})`}}],d&&i.items.push({element:a.headerElement,duration:i.duration,retain:!1,transform:{from:Gw[c](v),to:"translate(0, 0)"}}),e.animation=je.run(i)):(o.style[n]=`${y}px`,s&&(u.add("b-collapsing","b-collapsed"),s.rectangle(),u.remove("b-collapsing")))}collapseEnd(e){const r=this,{collapseTool:t}=r;r.panel.element.classList.remove("b-collapsing"),t&&(t.collapsing=!1),e.completed?r.collapsed=!0:(r.applyHeaderDock(!1),r.restoreConfiguredSize(),r.lockInnerSize(!1))}collapseRevert(e){var r;(r=this.collapseTool)==null||r.element.classList.remove("b-collapsed")}expandBegin(e){const r=this,{animation:t}=e,{collapseDim:i,collapseTool:n,panel:s}=r,[a,o]=r.collapseInfo,{element:l}=s,c=l.classList,d=c.contains(Xd),u=s.rectangle();c.remove("b-collapsed","b-collapsing"),s.element.style[i]="",r.restoreConfiguredSize(),r.lockInnerSize(!1);const h=s.rectangle(),g=r.lockInnerSize().moveTo(0,0),f=g.clone(),m=Sm[r.collapseDock];n==null||n.element.classList.remove("b-collapsed"),t&&(f[m[0]]=f[m[1]],c.add("b-collapsed","b-expanding"),d&&c.add(Xd),t.element=l,t[i]={from:_i(u[i]),to:_i(h[i])},t.items=[{element:r.innerElement,retain:!1,clip:{from:`rect(${f})`,to:`rect(${g})`}}],o&&t.items.push({element:s.headerElement,duration:t.duration,retain:!1,transform:{from:"translate(0, 0)",to:Gw[a](u)}}),e.animation=je.run(t))}expandEnd(e){const r=this;r.panel.element.classList.remove("b-expanding"),e.completed&&(r.collapsed=!1,r.applyHeaderDock(!1),r.restoreConfiguredSize(),r.lockInnerSize(!1))}expandRevert(e){var r;(r=this.collapseTool)==null||r.element.classList.add("b-collapsed")}get innerElement(){return this.panel.collapseWrapElement||this.panel.bodyWrapElement}get innerSizeElement(){return this.transverseCollapse?this.panel.element:this.innerElement}get supportAxis(){let{_supportAxis:e}=this;const r=e===!0;return(r||e==null)&&(e=this.collapseDim[0],(r||w.getStyleValue(this.panel.element,"position")==="absolute")&&(e+=VA[e])),e||""}lockInnerSize(e=!0){const r=this,{innerElement:t,panel:i}=r,n=e?r.supportAxis:"",s=i.element,a=i.headerElement,o=e&&a&&k.from(a,s),l=e&&k.from(r.innerSizeElement,s),c=t.style;return a&&(a.style.minWidth=n.includes("w")?`${o.width}px`:"",a.style.minHeight=n.includes("h")?`${o.height}px`:""),c.width=e?`${l.width}px`:"",c.height=e?`${l.height}px`:"",t.classList[e?"add":"remove"]("b-panel-collapse-size-locker"),l}onCollapseClick(e){let r=this.collapsing?!1:this.expanding?!0:!this.collapsed;e.altKey&&(r={animation:null,collapsed:r}),this.collapse(r)}onComplete(e){var r;(r=this.panel)==null||r.trigger(e)}onHeaderClick({event:e}){e.button===0&&this.panel.collapsed&&e.target.classList.contains(Cm)&&this.onRevealerClick()}onPanelConfigChange({name:e,value:r}){const t=this,{panel:i}=t;e==="collapsed"?i.isPainted&&(t.collapsed=r):e==="header"&&!i.changingCollapse&&t.syncDirection()}onPanelPaint(){this.syncDirection(),this.panel.collapsed&&!this.collapsed&&this.collapse({animation:null,collapsed:!0})}onRevealerClick(){this.panel._collapse({collapsed:!1})}restoreConfiguredSize(e){const{configuredHeight:r,configuredWidth:t,panel:i}=this;e=e!=null?e:"wh",i.element.classList.remove(Xd),t!=null&&e.includes("w")&&(i.width=t),r!=null&&e.includes("h")&&(i.height=r)}splitHeaderItems({as:e,dock:r}=jA){var t;return(t=this.panel)==null?void 0:t.splitHeaderItems({as:e,dock:r,alt:!0})}syncDirection(){const e=this,{direction:r}=e;(!r||Vw.test(r))&&(e.direction=e.getCollapseDir())}changeCollapsed(e){return!!e}updateCollapsed(e){const{collapseTool:r,panel:t}=this;t&&(t.collapsed=e,t.element.classList[e?"add":"remove"]("b-collapsed")),r&&(r.collapsed=e)}updateDirection(e){const{collapseTool:r,panel:t}=this;r&&(r.direction=zw[e]),t!=null&&t.rendered&&t.recompose()}updatePanel(e){var r;const t=this;t.syncDirection(),(r=t.panelChangeDetacher)==null||r.call(t),t.panelChangeDetacher=e&&Te.after(e,"onConfigChange","onPanelConfigChange",t,{return:!1})}wrapCollapser(e,r){var t;const i=this,[n,s]=i.collapseInfo;if(!s)return[e,r];const{collapseDir:a,panel:o}=i,{expandedHeaderDock:l,header:c,uiClassList:d}=o,u=(t=o.tools)==null?void 0:t.recollapse,[h,g]=i.splitHeaderItems({as:"element",dock:n}),f=o.hasHeader?o.title||(c==null?void 0:c.title)||"\xA0":null,m=f&&{tag:"header",class:new J({...d,[`b-dock-${l}`]:1,"b-panel-header":1,"b-panel-collapser-header":1},c==null?void 0:c.cls),children:[...h,{reference:"collapserTitleElement",html:f,class:{...d,[`b-align-${(c==null?void 0:c.titleAlign)||"start"}`]:1,"b-header-title":1}},...g]};return u&&(u.direction=a),["collapseWrapElement",{class:{...d,[`b-panel-collapser-header-${l}`]:1,[`b-panel-collapser-${a}`]:1,[`b-${Zd[l]?"h":"v"}box`]:1,"b-panel-collapser":1,"b-box-center":1},children:$A.test(l)?{collapserHeaderElement:m,[e]:r}:{[e]:r,collapserHeaderElement:m}}]}};Pn.maps={clipByDock:Sm,dockByDirection:Ww,dockIsHorz:Zd},Pn.initClass(),Pn._$name="PanelCollapser";var vl=Symbol("pendingCreate"),An=class extends F{static get prototypeProperties(){return{cleanup:null,configName:null,created:null,factory:null,inferType:"name",owner:null,ownerName:null,proxyable:typeof Proxy!="undefined",setup:null,transform:null}}static get properties(){return{defaults:{},instances:{},object:Object.create({})}}get proxy(){const e=this;let r=null;return e.proxyable&&(r=new Proxy(e.instances,{get(t,i){return e.get(i)},set(t,i,n){return e.set(i,n),!0},deleteProperty(t,i){return e.set(i,null),!0}})),Reflect.defineProperty(e,"proxy",{configurable:!0,value:r}),r}get target(){return this.proxy||this.object}define(e,r){const t=this,{transform:i}=t,n=i?i(r,e):r,s=T.isInstantiated(n);t.instances[e]=vl,s||t.setDefaults(e,n),t.defineProp(e,!0),s&&t.set(e,n)}defineProp(e,r){const t=this,{object:i}=t;t.proxy||Reflect.defineProperty(r?Object.getPrototypeOf(i):i,e,{configurable:!r,enumerable:!0,get(){return t.get(e)},set(n){return t.set(e,n)}})}flush(){var e;const r=this;try{r.updating=!0;for(const t in r.defaults)r.get(t);r.afterConfigureOwner=(e=r.afterConfigureOwner)==null?void 0:e.call(r)}finally{r.updating=!1}}get(e){const{defaults:r,instances:t}=this;return t[e]===vl&&this.set(e,vl),t[e]||r[e]&&null}set(e,r){var t;const i=this,{cleanup:n,configName:s,defaults:a,factory:o,instances:l,owner:c,setup:d,transform:u,updating:h}=i,g=c&&s&&!h,f=l[e]===vl?null:l[e],m=o.reconfigure(f,r===vl?{}:r||null,{cleanup:n&&(p=>n(p,e)),defaults:a[e]||i.setDefaults(e,{}),owner:i.owner,setup:d&&((p,v,y)=>d(p,e,v,y)),transform:u&&(p=>u(p,e))});if(m!==f){const p=g&&{...l};l[e]=m,m?(i.defineProp(e),(t=i.created)==null||t.call(i,m,e)):(delete i.object[e],delete l[e]),g&&c.onConfigChange({name:s,config:c.$meta.configs[s],value:i.target,was:p})}}setDefaults(e,r){const{defaults:t,factory:i,inferType:n,instances:s,owner:a,ownerName:o}=this,{typeKey:l}=i.factoryable;return r=r===!0?{}:T.assign({},r),(n==="name"||n===!0&&!r[l])&&(r[l]=e),o&&(r[o]=a),r.beforeConfigure=c=>{s[e]=c},t[e]=r}update(e){const r=this,{owner:t}=r;let i,n;try{if(r.updating=!0,e)for(i in e)n=e[i],r.defaults[i]?r.set(i,n):n&&r.define(i,n);else for(i in r.instances)r.set(i,null)}finally{r.updating=!1}t&&(t.isConfiguring?r.afterConfigureOwner||(r.afterConfigureOwner=Te.before(t,"afterConfigure","flush",r)):r.flush())}};An.initClass(),An._$name="DynamicObject";var WA=[],Dm={},GA={align:1,weight:1},wm=e=>class extends(e||$){static get $name(){return"Toolable"}static get configurable(){return{tools:{value:null,$config:{nullify:!0}},toolDefaults:{"*":{type:"tool",align:"end"}}}}byWeightSortFn(t,i){return(t.weight||0)-(i.weight||0)}byWeightReverseSortFn(t,i){return(i.weight||0)-(t.weight||0)}gatherTools({align:t,alt:i,refs:n}=Dm){var s,a,o;const{collapsed:l,tools:c}=this,d={collapsed:l,alt:i};let u=[],h,g,f,m,p;for(g in c)p=c[g],h=(o=(a=(s=p==null?void 0:p.align)==null?void 0:s.align)!=null?a:p==null?void 0:p.align)!=null?o:"end",h===t&&p.isCollapsified(d)&&u.push(p);if(u.sort(this[t==="end"?"byWeightReverseSortFn":"byWeightSortFn"]),n){const v=n==="widget",y={};for(f=0;f<u.length;++f)m=u[f],y[m.ref]=v?m:m.element;u=y}return u}getEndTools({alt:t,refs:i}=Dm){return this.gatherTools({align:"end",alt:t,refs:i})}getStartTools({alt:t,refs:i}=Dm){return this.gatherTools({align:"start",alt:t,refs:i})}get childItems(){return[...this.getStartTools(),...this._items||WA,...this.getEndTools()]}changeTools(t,i){const n=this,s=n.$tools||(n.$tools=new An({configName:"tools",factory:$,inferType:!1,owner:n,created(a){var o,l;a.innerItem=!1,(l=a.syncRotationToDock)==null||l.call(a,(o=n.header)==null?void 0:o.dock),Te.after(a,"onConfigChange",(c,{name:d})=>{GA[d]&&n.onConfigChange({name:"tools",value:s.target})}),n.onChildAdd(a)},setup(a,o){return a=T.merge({},n.toolDefaults["*"],n.toolDefaults[o],a),a.parent=n,a.ref=o,a}}));if(s.update(t),!i)return s.target}get widgetClass(){}},Uw=["b-hbox","b-vbox"],UA={name:"align",style:"alignItems"},YA={name:"contentAlign",style:"alignContent"},qA={name:"direction",style:"flexDirection"},KA={name:"justify",style:"justifyContent",classes:["stretch"]},XA={name:"wrap",style:"flexWrap",map:{false:"nowrap",true:"wrap",reverse:"wrap-reverse"}},_n=class extends Lr{get vertical(){return this.horizontal===!1}set vertical(e){return this.horizontal=!e}updateAlign(){this.syncConfigStyle(UA)}updateContentAlign(){this.syncConfigStyle(YA)}updateDirection(){this.syncConfigStyle(qA)}updateHorizontal(){var e;const r=this,t=(e=r.contentElement)==null?void 0:e.classList,i=Number(r.vertical);t?(t.remove(Uw[1-i]),t.add(Uw[i])):r.syncConfigLater("horizontal"),r.syncDirection()}updateJustify(){this.syncConfigStyle(KA)}updateReverse(){this.syncDirection()}updateWrap(){this.syncConfigStyle(XA)}syncDirection(){const e=this,{reverse:r}=e;e.direction=r?`${e.vertical?"column":"row"}${r?"-reverse":""}`:null}};E(_n,"$name","Box"),E(_n,"type","box"),E(_n,"alias","hbox"),E(_n,"configurable",{containerCls:"b-box-container",itemCls:"b-box-item",align:null,contentAlign:null,direction:null,horizontal:!0,justify:null,reverse:null,wrap:null}),_n.initClass(),_n._$name="Box";var yl=class extends _n{};E(yl,"$name","VBox"),E(yl,"type","vbox"),E(yl,"configurable",{horizontal:!1}),yl.initClass(),yl._$name="VBox";var Em=e=>class extends(e||F){static get $name(){return"Badge"}static get configurable(){return{badge:null}}compose(){const{badge:t}=this;return{dataset:{badge:t},class:{"b-badge":t!=null&&t!==""}}}},Yw=/(?:^|\s)b-icon-/,qw=/(?:^|\s)b-fa-/,Kw=Symbol("defaultToggleable"),ZA=["items","type","widgets","html","listeners"],Xw=Symbol("defaultListener"),bl=class extends $.mixin(Em,Kd){static get $name(){return"Button"}static get type(){return"button"}static get configurable(){return{icon:null,menuIcon:"b-icon-picker",pressedIcon:null,iconAlign:"start",behaviorType:"button",text:{value:null,$config:null,default:""},color:null,toggleable:Kw,pressed:!1,toggleGroup:null,supportsPressedClick:!1,ripple:{radius:75},forwardTwinEvents:["action","toggle"],localizableProperties:["text"],menu:{$config:["lazy","nullify"],value:null},menuDefaults:{type:"menu",autoShow:!1,autoClose:!0,floating:!0,scrollAction:"realign",align:"t0-b0"},href:null,target:null,defaultBindProperty:null}}updateElement(e,r){var t,i,n;const s=this,{constructor:a}=s,o=super.updateElement(e,r),l=s.peekConfig("menu"),c=l?l.isWidget?l.role:((i=(t=a.resolveType(l.type))==null?void 0:t.configurable)==null?void 0:i.role)||((n=a.configurable.menuDefaults)==null?void 0:n.type)||"menu":!1;return s.ariaHasPopup=c,o}compose(){const{color:e,href:r,icon:t,iconAlign:i,pressed:n,pressedIcon:s,target:a,text:o,toggleable:l,toggleGroup:c,menuIcon:d,behaviorType:u}=this,h=this.hasConfig("menu"),g=n&&s?s:t;return{tag:r?"a":"button",href:r,target:a,type:u,class:{[`b-icon-align-${i}`]:t,[e]:!!e,"b-pressed":n&&l,"b-text":!!o,"b-has-menu":h},"aria-pressed":n,dataset:{group:c},listeners:{click:"onInternalClick",mousedown:"onInternalMousedown"},children:{iconElement:(t||s)&&{"aria-hidden":!0,tag:"i",class:{...J.normalize(g,"object"),"b-icon":Yw.test(g),"b-fa":qw.test(g)}},label:o&&{tag:"label",text:o},menuIconElement:h&&d&&{tag:"i",class:{"b-icon":Yw.test(d),"b-fa":qw.test(d),"b-button-menu-icon":1,[d]:1}}}}}configureOverflowTwin(e){const r=this,t=super.configureOverflowTwin(e);return t.text||(t.text=r.text||r.tooltipText),t}onHide(){var e;(e=this._menu)==null||e.hide()}get childItems(){return this._menu&&[this.menu]}onFocusOut(e){var r;super.onFocusOut(e),(r=this.menu)==null||r.hide()}get focusElement(){return this.element}changeText(e){return e==null?"":e}changeToggleable(e){return e===Kw?this.toggleGroup||this.config.menu:e}changeMenu(e,r){const t=this,{element:i}=t;return e?(e.isWidget?(e.forElement=i,e.owner=t,e.constrainTo=t.rootElement):(typeof e=="object"&&!ZA.some(n=>n in e)&&(e={lazyItems:e}),e=$.reconfigure(r,e?T.merge({owner:t,constrainTo:t.rootElement,forElement:i},t.menuDefaults,e):null,t)),e.align.constrainPadding=10,t.detachListeners(Xw),e.ion({name:Xw,beforeShow:"onMenuBeforeShow",hide:"onMenuHide",show:"onMenuShow",thisObj:this})):r==null||r.destroy(),e}onMenuBeforeShow({source:e}){return this.trigger("beforeShowMenu",{menu:e})}onMenuShow(){this.ariaElement.setAttribute("aria-expanded",!0)}onMenuHide(){this.ariaElement.setAttribute("aria-expanded",!1),this.toggle(!1)}updateMenu(e){this.toggleable=!!e}updatePressed(e){var r,t;const i=this;if(!i.toggleable||i.isConfiguring)return;const{menu:n}=i;e&&w.forEachSelector(i.rootElement,`button[data-group=${i.toggleGroup}]`,s=>{s!==i.element&&($.getById(s.id).pressed=!1)}),n&&(n.initialConfig.minWidth||(n.minWidth=i.width),n.align.minHeight=(r=n._minHeight)!=null?r:100,n.align.minWidth=(t=n._minWidth)!=null?t:100,n[e?"show":"hide"]()),i.trigger("toggle",{pressed:e,userAction:i._isUserAction})}onInternalMousedown(e){var r;(r=this._menu)!=null&&r.containsFocus&&this.pressed&&e.preventDefault()}onInternalClick(e){const r=this,t={event:e};r.disabled||(r._isUserAction=!0,!(r.toggleable&&(r.toggleGroup&&r.pressed&&!r.supportsPressedClick||((!r.toggleGroup||!r.pressed)&&r.toggle(!r.pressed),r.isDestroyed)))&&(r.trigger("click",t),r.isDestroyed||r.trigger("action",t),r.href||(e.preventDefault(),e.stopPropagation()),r._isUserAction=!1))}toggle(e=!this.pressed){this.trigger("beforeToggle",{pressed:e,userAction:this._isUserAction})!==!1&&(this.pressed=e)}};bl.initClass(),bl._$name="Button";var Zw={refs:"element"},JA=e=>e.element.style.margin="",QA=e=>e.isToolbar,Jw=e=>e[0]+(e[1].minifiable?0:9e9),Qw={hidden:!1,width:""},e_={...Qw,flex:""},t_=[{box:"hbox",clientSizeProp:"clientWidth",edgeProp:"right",flexDir:"row",horizontal:!0,max:"maxX",overflow:"overflowX",pos:"x",scrollSize:"scrollWidth",sizeProp:"width"},{box:"vbox",clientSizeProp:"clientHeight",edgeProp:"bottom",flexDir:"column",horizontal:!1,max:"maxY",overflow:"overflowY",pos:"y",scrollSize:"scrollHeight",sizeProp:"height"}],r_={delay:0,startRate:40,endRate:200,accelerateDuration:500},i_={menu:1,pressed:1},sa=class extends Ht.mixin(wm){static get $name(){return"Toolbar"}static get type(){return"toolbar"}static get delayable(){return{syncOverflowVisibility:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{defaultType:"button",dock:"top",layout:{type:"box"},overflow:{$config:["lazy","nullify"],value:{type:"menu"}},toolDefaults:{overflowMenuButton:{type:"button",hidden:!0,icon:"b-icon-menu",menuIcon:null,defaultCls:{"b-overflow-button":1}},overflowScrollEnd:{handler:"up.onEndScrollClick",hidden:!0,defaultCls:{"b-icon-angle-right":1,"b-overflow-button":1,"b-icon":1}},overflowScrollStart:{align:"start",handler:"up.onStartScrollClick",hidden:!0,defaultCls:{"b-icon-angle-left":1,"b-overflow-button":1,"b-icon":1}}},widgetCls:null,ignoreParentReadOnly:!0}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}static getEvictionList(e){const r=e.filter(t=>t.overflowable!=="none");return r.forEach((t,i)=>r[i]=[i,t]),r.sort((t,i)=>Jw(i)-Jw(t)),r}compose(){const e=this,{axisProps:r,dock:t}=e,i=e.getEndTools(Zw),n=e.getStartTools(Zw);return{class:{[`b-dock-${t}`]:1,[`b-${t}-toolbar`]:1,[`b-${r.box}`]:1},children:{...n,toolbarContent:{class:{"b-box-center":1,"b-toolbar-content":1}},...i}}}get axisProps(){return t_[this.layout.horizontal?0:1]}get contentElement(){return this.toolbarContent}get overflowMenuButton(){var e;return(e=this.tools)==null?void 0:e.overflowMenuButton}get overflowType(){const{overflow:e}=this;return typeof e=="string"?e:e==null?void 0:e.type}onChildAdd(e){var r;super.onChildAdd(e),this.processAddedLeafItem(e),(r=e.syncRotationToDock)==null||r.call(e,this.dock)}onChildRemove(e){super.onChildRemove(e),this.syncOverflowVisibility()}processAddedLeafItem(e){Te.after(e,"onConfigChange",this.onLeafItemConfigChange,e),e.isContainer&&e.eachWidget(r=>this.processAddedLeafItem(r))}onPaint({firstPaint:e}){var r;(r=super.onPaint)==null||r.call(this,...arguments),e&&this.getConfig("overflow")}updateDock(e){var r;const t=this,{layout:i}=t,{vertical:n}=i;if(i.vertical=Hw(e)[1],!t.initialItems){n!==i.vertical&&t.updateOverflow(t.overflow);for(const s of t.childItems)(r=s.syncRotationToDock)==null||r.call(s,e)}}updateOverflow(e,r){var t,i;const n=this,{axisProps:s,contentElement:a,overflowType:o}=n,{flexDir:l}=s,c=(t=n.overflowMenuButton)==null?void 0:t._menu,d={};if(c&&(e?c==null||c.removeAll():c.eachWidget(u=>{u._overflowTwinOrigin.overflowTwin=null})),r==="menu"?d.overflowMenuButton=null:r==="scroll"&&(d.overflowScrollStart=d.overflowScrollEnd=null),o==="menu")(i=n.scrollable)==null||i.destroy(),a.style.overflow=a.style.overflowX=a.style.overflowY="",d.overflowMenuButton={cls:{[`b-${l}-menu`]:1}};else if(o==="scroll"){const u=typeof e=="object"&&(e==null?void 0:e.repeat)||r_;n.scrollable={[s.overflow]:"hidden-scroll",element:a,internalListeners:{scroll:"onContentScroll",thisObj:n}},d.overflowScrollStart={repeat:u,invertRotate:!0,cls:{[`b-${l}-start-scroller`]:1}},d.overflowScrollEnd={repeat:u,invertRotate:!0,cls:{[`b-${l}-end-scroller`]:1}}}n.tools=d,o?(a.classList.add("b-overflow"),n.monitorResize=!0,n.syncOverflowVisibility()):(a.classList.remove("b-overflow"),n.monitorResize=!1)}onContentScroll(){this.syncScrollerState()}onStartScrollClick(){this.scrollable[this.axisProps.pos]-=2}onEndScrollClick(){this.scrollable[this.axisProps.pos]+=2}onInternalResize(){super.onInternalResize(...arguments),this.isPainted&&this.syncOverflowVisibility()}syncOverflowVisibility(){const e=this,{overflowType:r,contentElement:t,isVisible:i}=e,{clientSizeProp:n,edgeProp:s,sizeProp:a}=e.axisProps,{overflowMenuButton:o,overflowScrollStart:l,overflowScrollEnd:c}=e.tools,d=e.rtl&&e.layout.horizontal,u=r==="menu",h=()=>Math.ceil(t[n]+(!l||l.hidden?0:l.rectangle("outer")[a])+(!c||c.hidden?0:c.rectangle("outer")[a])),g=()=>{if(M.length===0)return 0;const P=M[M.length-1].rectangle(t);return Math.floor(d?t[n]-P.left:P[s])};let f,m,p,v,y,C,D,S,x,R,I,M;if(!(!i||!r||e.items.length===0)){if(e.inSyncOverflowVisibility=!0,o==null||o.hide(),e.eachWidget((P,_)=>{D=P.minifiable,R=P.overflowable,R=D?R||D:R,P.floating?_.down=!1:(_.down=!R,P.innerItem&&(P._toolbarOverflow&&(P.hidden=P._toolbarOverflow=!1),P._toolbarMinified&&(P.minified=P._toolbarMinified=!1),P.isVisible&&(D&&(S||(S=[])).push(P),R&&(M||(M=[])).push(P))))}),M&&(f=h(),m=g()),M&&m>f)if(u){for(;m>f&&(y=S==null?void 0:S.pop());)C=m,y._toolbarMinified=!0,y.minified=!0,m=g(),C-=m,(x||(x=[])).push([y,C]);if(m>f){o.show(),f=h(),v=sa.getEvictionList(M);for(p of v)m>f&&(y=p[1],y._toolbarOverflowWidth=y.width,y._toolbarOverflow=!0,y.hidden=!0,M.splice(M.indexOf(y),1),(I||(I=[])).push(p),m=g());if(I){for(I.sort((P,_)=>P[0]-_[0]).forEach((P,_)=>I[_]=P[1]);x!=null&&x.length;)[y,C]=x.pop(),m+C<=f&&!y._toolbarOverflow&&(m+=C,y.minified=y._toolbarMinified=!1);e.syncOverflowMenuButton(I)}else o.hide()}}else c.show(),l.show(),e.syncScrollerState();else u||(c==null||c.hide(),l==null||l.hide());e.inSyncOverflowVisibility=!1}}syncOverflowMenuButton(e){var r;const t=this,{axisProps:i,overflowMenuButton:n}=t,s={cls:"b-toolbar-overflow-menu",minWidth:280,items:[],align:{align:i.horizontal?"t100-b100":"r100-l100",axisLock:"flexible"}};if(t.addToMenu(s,e.filter(a=>t.overflowItemFilter(a))),(r=n._menu)!=null&&r.isMenu){const a=n.menu,{toAdd:o,toRemove:l}=H.delta(s.items,a.items,1);if(a.remove(l),a.items.length)for(let c=o.length-1;c>=0;c--)a.insert(o[c],0);else a.add(o)}else n.menu=s}syncScrollerState(){const e=this,{axisProps:r,scrollable:t}=e,{overflowScrollStart:i,overflowScrollEnd:n}=e.tools,s=t[r.pos],a=t[r.max];i.disabled=!s,n.disabled=Math.abs(Math.ceil(s))>=Math.abs(a)}overflowItemFilter(e){const{filter:r}=this.overflow;return!!(r?r.call(this,e):w.getChildElementCount(e.element))}addToMenu(e,r){const t=this.horizontal?e_:Qw;for(const i of r){const n=i.ensureOverflowTwin(t,JA);e.items.push(n)}}onLeafItemConfigChange(e,{name:r,value:t}){const i=this,n=i.up(QA),s=n.hasConfig("overflow"),{overflowTwin:a}=i;!s||n!=null&&n.inSyncOverflowVisibility||r==="hidden"&&t===i._toolbarOverflow||(a&&!i_[r]&&(a[r]=t),n!=null&&n.isPainted&&i.ref!=="overflowMenuButton"&&(i.isTextField&&r==="value"&&(i.containsFocus||a!=null&&a.containsFocus)||n.syncOverflowVisibility()))}createWidget(e){e==="->"?e={type:"widget",cls:"b-toolbar-fill"}:e==="|"?e={type:"widget",cls:"b-toolbar-separator"}:typeof e=="string"&&(e={type:"widget",cls:"b-toolbar-text",html:e});const r=super.createWidget(e);return this.widgetCls&&r.element.classList.add(this.widgetCls),r}};sa.initClass(),sa._$name="Toolbar";var n_=e=>!e.classList.contains("b-focus-trap")&&w.isFocusable(e)?w.NodeFilter.FILTER_ACCEPT:w.NodeFilter.FILTER_SKIP,xm=[],s_={},eE=[xm,xm],tE=(e,r,t)=>{const{vertical:i}=e;return delete e.vertical,{...e,class:{...r,[`b-${i?"v":"h"}box`]:1,"b-box-center":1,"b-panel-bar-wrap":!t}}},Rm=(e,r,t=!1)=>{const i={vertical:t,children:e?[e]:[]};return r&&(i.tag=r),i},Jd=(e,r)=>{e!=null&&e.classList?e==null||e.classList.add(r):e!=null&&e.class&&(typeof e.class=="string"&&(e.class={[e.class]:1}),e.class[r]=1)},a_={dock:1,hidden:1,weight:1},kn={top:[!0,!0],bottom:[!0,!1],left:[!1,!0],right:[!1,!1]},rE={header:1,"pre-header":1},Vt=class extends Ht.mixin(Ld,wm){static get $name(){return"Panel"}static get type(){return"panel"}static get configurable(){return{localizableProperties:["title"],collapsed:{value:null,$config:null,default:!1},collapsible:{value:null,$config:"nullify"},bodyCls:{$config:{merge:"classList"},value:null},bodyTag:null,bodyWrapTag:null,trapFocus:null,title:null,header:null,stateful:["collapsed"],stripDefaults:{"*":{type:"toolbar",dock:"top"},bbar:{dock:"bottom",weight:-1e3},tbar:{weight:-1e3}},strips:{value:null,$config:"nullify"},toolDefaults:{close:{weight:-1e3},collapse:{weight:-990}},footer:null,revealed:null,tbar:null,bbar:null,role:"region"}}updateElement(e,r){const t=super.updateElement(e,r);return this.titleElement&&w.setAttributes(this.ariaElement,{"aria-describedby":this.titleElement.id}),t}compose(){const e=this,{collapsible:r,focusable:t,hasItems:i,revealed:n,tools:s}=e,a=e.composeHeader(),o=(a==null?void 0:a.class["b-dock-left"])||(a==null?void 0:a.class["b-dock-right"]);let l=e.composeBody(),c="bodyWrapElement";return r&&([c,l]=r.wrapCollapser(c,l)),{tabIndex:i&&t!==!1||t?0:null,class:{[`b-panel-collapsible-${r==null?void 0:r.type}`]:r,[`b-panel-collapse-${r==null?void 0:r.collapseDir}`]:r,[`b-${o?"h":"v"}box`]:1,"b-panel-collapsible":r,"b-panel-has-header":a,"b-panel-has-tools":s?1:0,"b-panel-overlay-revealed":n},children:{topFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1}},headerElement:a,[c]:l,bottomFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-end-focus-trap":1}}}}}composeBody(){var e,r;const t=this,{bodyCls:i,bodyConfig:n,bodyWrapTag:s,footer:a,uiClassList:o}=t,l=T.values(t.strips,(y,C)=>!kn[C==null?void 0:C.dock]).sort(t.byWeightSortFn),c={top:null,right:null,bottom:null,left:null};let d,u,h,g,f,m,p;for(a&&(h=a.dock||"bottom",l.unshift({dock:h,element:{tag:"footer",reference:"footerElement",html:typeof a=="string"?a:a.html,class:{...o,[`b-dock-${h}`]:1,[`${a.cls||""}`]:1}}})),i&&(n[f="className"]||(f="class"),n[f]=new J(n[f]).assign(i)),g=l.length;g-- >0;)d=l[g],[m,u]=kn[d.dock],p?p.vertical!==m&&(p=Rm(tE(p,o),"",m)):p=Rm(n,s,m),p.children[u?"unshift":"push"](d.element),c[d.dock]=d;Jd(c.top,"b-innermost"),Jd(c.right,"b-innermost"),Jd(c.bottom,"b-innermost"),Jd(c.left,"b-innermost");const v=tE(p||Rm(n,s),o,!0);return v.class[`${(e=t.layout)==null?void 0:e.containerCls}-panel`]=!!((r=t.layout)!=null&&r.containerCls),v.class["b-panel-body-wrap"]=1,v.class[`b-${t.$$name.toLowerCase()}-body-wrap`]=1,v}get hasHeader(){if(this.header===!1)return!1;const{header:e,title:r,tools:t,parent:i}=this,n=this.maximizable||Object.values(t||{}).some(s=>!s.hidden);return e||!(i!=null&&i.suppressChildHeaders)&&(r||n)}get rootUiClass(){return Vt}composeHeader(e){var r;const t=this;if(!t.hasHeader&&!e)return;const i=t.header||{},n=i.dock||"top",[s,a]=t.splitHeaderItems({as:"element",dock:n}),o=t.$meta.hierarchy,l=t.composeTitle(i),c=new J({[`b-dock-${n}`]:1,...t.uiClassList},i.cls);let d,u;for(d=o.indexOf(Vt);d<o.length;++d)u=o[d].$$name,u!=="Grid"&&(c[`b-${u.toLowerCase()}-header`]=1);const h={tag:"header",class:c,children:[...s,l,...a]};return((r=t.collapsible)==null?void 0:r.composeHeader(h))||h}composeTitle(e){var r;const t=typeof e=="string"?e:this.title||e.title,i={reference:"titleElement",id:`${this.id}-panel-title`,html:t!=null?t:"\xA0",class:{[`b-align-${e.titleAlign||"start"}`]:1,"b-header-title":1,...this.uiClassList}};return T.isObject(t)&&(delete i.html,T.merge(i,t)),((r=this.collapsible)==null?void 0:r.composeTitle(i))||i}updateTitle(){}afterRecompose(){var e;super.afterRecompose();const r=this,{headerElement:t}=r;(e=r._headerClickDetacher)==null||e.call(r),r._headerClickDetacher=t&&B.on({element:t,click:i=>{var n;return(n=r.trigger)==null?void 0:n.call(r,"headerClick",{event:i})}})}onHeaderClick(e){var r;(r=this.collapsible)==null||r.onHeaderClick(e)}onPaint(){var e;super.onPaint(...arguments),(e=this.collapsible)==null||e.onPanelPaint(this)}splitHeaderItems({as:e,dock:r,alt:t}=s_){var i,n,s,a;const o=this,l=e==="element",{collapsed:c}=o,d=o.getEndTools({alt:t}),u=o.getStartTools({alt:t}),h=T.values(o.strips,(v,y)=>!rE[y==null?void 0:y.dock]&&y.isCollapsified({collapsed:c,alt:t}));let g=eE,f,m,p;if(h.length+d.length+u.length){for(g=[m=[...u,...h.filter(v=>v.dock==="pre-header").sort(o.byWeightSortFn)],f=[...h.filter(v=>v.dock==="header").sort(o.byWeightReverseSortFn),...d]],p=0;p<m.length;++p)r&&((n=(i=m[p]).syncRotationToDock)==null||n.call(i,r)),l&&(m[p]=m[p].element);for(p=0;p<f.length;++p)r&&((a=(s=f[p]).syncRotationToDock)==null||a.call(s,r)),l&&(f[p]=f[p].element)}return g}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){const e=this,{bodyTag:r}=e,t=T.merge({reference:"bodyElement",className:{...e.getStaticWidgetClasses(Vt,"-content"),"b-box-center":1,"b-text-content":e.textContent&&e.hasNoChildren}},e._bodyConfig);return r&&(t.tag=r),(e.initializingElement||!e._element)&&(t.html=e.content||e._html),t}changeBodyCls(e){return J.from(e)}changeTbar(e){return this.getConfig("strips"),this.strips={tbar:e},this.strips.tbar}changeBbar(e){return this.getConfig("strips"),this.strips={bbar:e},this.strips.bbar}get childItems(){var e;const r=this,t=T.values(r.strips,(o,l)=>!kn[l==null?void 0:l.dock]).sort(r.byWeightSortFn),[i,n]=r.splitHeaderItems(),[s,a]=((e=r.collapsible)==null?void 0:e.splitHeaderItems())||eE;return[...i,...s,...n,...a,...t.filter(o=>kn[o.dock][1]),...r._items||xm,...t.filter(o=>!kn[o.dock][1]).reverse()]}changeStrips(e,r){const t=this,i=t.$strips||(t.$strips=new An({configName:"strips",factory:$,inferType:!1,owner:t,created(n){var s;const{dock:a}=n;if(!rE[a]&&!kn[a])throw new Error(`Invalid dock value "${a}"; must be: top, left, right, bottom, header, or pre-header`);Te.after(n,"onConfigChange",(o,{name:l})=>{a_[l]&&t.onConfigChange({name:"strips",value:i.target})}),n.innerItem=!1,t.onChildAdd(n),n.parent=t,(s=n.layout)==null||s.renderChildren(),n.hasItems&&(t.hasItems=!0)},setup(n,s){return n=T.merge(T.clone(t.stripDefaults["*"]),t.stripDefaults[s],n),n.parent=t,n.ref=s,n},transform(n){return Array.isArray(n)&&(n={items:n}),n||null}}));if(i.update(e),!r)return i.target}get collapsing(){var e;return(e=this.collapsible)==null?void 0:e.collapsing}get collapsingExpanding(){var e;return(e=this.collapsible)==null?void 0:e.collapsingExpanding}get expanding(){var e;return(e=this.collapsible)==null?void 0:e.expanding}changeCollapsed(e){const r=this,{collapsible:t}=r;if(r.recompose.flush(),e=!!e,!t||r.changingCollapse||!r.isPainted)return e;t==null||t.collapse({animation:null,collapsed:e})}changeCollapsible(e,r){const t=this;return t.getConfig("tools"),e&&(e===!0?e={}:typeof e=="string"&&(e={[kn[e]?"direction":"type"]:e})),Pn.reconfigure(r,e,{owner:t,defaults:{panel:t},cleanup(){t.collapsed&&(r.collapse({animation:null,collapsed:!1}),t._collapsed=1)}})}updateCollapsible(e){const r=this,t=e==null?void 0:e.toolsConfig;r.tools={collapse:(t==null?void 0:t.collapse)||null,recollapse:(t==null?void 0:t.recollapse)||null},e&&r.isPainted&&r.collapsed&&(r._collapsed=1),r.collapsed===1&&(r.collapsed=!0)}_collapse(e,r){var t;return r!==!0&&r!==void 0&&(r===!1?e.collapsed=!e.collapsed:typeof r=="number"?e.animation={duration:r}:r===null?e.animation=r:r===!0||("animation"in r?T.merge(e,r):e.animation=r)),(t=this.collapsible)==null?void 0:t.collapse(e)}collapse(e){return this._collapse({collapsed:!0},e)}expand(e){return this._collapse({collapsed:!1},e)}toggleCollapsed(e){return this.collapsed?this.expand(e):this.collapse(e)}get expandedHeaderDock(){var e,r,t;return(t=(r=this._expandedHeaderDock)!=null?r:(e=this.initialConfig.header)==null?void 0:e.dock)!=null?t:"top"}set expandedHeaderDock(e){this._expandedHeaderDock=e==null?void 0:e.toLowerCase()}updateHeader(e){this.changingCollapse||(this.expandedHeaderDock=e==null?void 0:e.dock)}updateTrapFocus(e){var r;const t=this;t.element.classList[e?"add":"remove"]("b-focus-trapped"),t.focusTrapListener=(r=t.focusTrapListener)==null?void 0:r.call(t),e&&(t.focusTrapListener=B.on({element:t.element,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:t}),t.treeWalker||(t.treeWalker=this.setupTreeWalker(t.element,w.NodeFilter.SHOW_ELEMENT,n_)))}setupTreeWalker(e,r,t){return document.createTreeWalker(e,r,t)}onFocusTrapped(e){const r=this,t=r.treeWalker;if(e.target===r.bottomFocusTrap)t.currentNode=r.topFocusTrap,t.nextNode();else if(e.target===r.topFocusTrap)t.currentNode=r.bottomFocusTrap,t.previousNode();else return;r.requestAnimationFrame(()=>t.currentNode.focus())}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}get widgetClassList(){var e;const r=this,t=super.widgetClassList;return r.hasHeader&&t.push("b-panel-has-header",`b-header-dock-${((e=r.header)==null?void 0:e.dock)||"top"}`),r.tbar&&t.push("b-panel-has-top-toolbar"),r.bbar&&t.push("b-panel-has-bottom-toolbar"),t}};Vt.initClass(),Vt._$name="Panel";var ht=class extends Vt{static get $name(){return"Popup"}static get type(){return"popup"}static get configurable(){return{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,hideAnimation:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},stripDefaults:{bbar:{layout:{justify:"flex-end"}}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,maximizable:null,modal:null,maximized:null,tools:{close:{cls:"b-popup-close",handler:"close",weight:-1e3,ariaLabel:"L{Popup.close}",hidden:!0},maximize:{cls:"b-popup-expand",handler:"toggleMaximized",weight:-999,hidden:!0}},highlightReturnedFocus:!0,role:"dialog"}}finalizeInit(){const e=this,{forElement:r}=e;e.anchoredTo=r,e.initialAnchor=e.anchor,r&&e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),B.on({element:r,click:"onElementUserAction",thisObj:e})),super.finalizeInit(),e.autoShow&&(!r||w.isVisible(r))&&(e.autoShow===!0?e.show():e.setTimeout(()=>e.show(),e.autoShow))}onPaint({firstPaint:e}){var r;(r=super.onPaint)==null||r.call(this,...arguments);const t=this;e&&t.headerElement&&B.on({element:t.headerElement,dblclick:t.onHeaderDblClick,thisObj:t})}doDestroy(){this.syncModalMask(),super.doDestroy()}compose(){const{hasNoChildren:e,textContent:r}=this;return{class:{"b-text-popup":!!(r&&e)}}}close(){const e=this;if(!e._hidden&&e.trigger("beforeClose")!==!1||e._hidden&&e.closeAction==="destroy")return e.modal&&e.closeAction==="destroy"&&e.revertFocus(),e.unmask(),e.containsFocus&&e.highlightReturnedFocus&&e.setTimeout(()=>e.element.classList.add("b-using-keyboard"),0),e[e.closeAction]()}toggleMaximized(){this.maximized=!this.maximized}updateMaximized(e){w.toggleClasses(this.element,["b-maximized"],e)}onInternalKeyDown(e){const r=this;e.key==="Escape"&&(e.stopImmediatePropagation(),r.floating||r.positioned?r.close(!0):r.collapsible&&(r.revealed?r.collapsible.toggleReveal():r.collapse()))}onDocumentMouseDown({event:e}){const r=this,{owner:t}=r,{target:i}=e;if(e.type!=="touchend"&&(t!=null&&t.isButton)&&t._menu===r&&t.element.contains(i))return e.preventDefault(),!1;r.modal&&i===ht.modalMask?(e.preventDefault(),r.modal.closeOnMaskTap?r.close():r.containsFocus||r.focus()):!r.owns(i)&&r.autoClose&&!r.containsFocus&&r.close()}get isTopModal(){return w.isVisible(ht.modalMask)&&this.element.previousElementSibling===ht.modalMask}onFocusIn(e){const r=w.getActiveElement(this);super.onFocusIn(e),w.getActiveElement(this)===r&&e.target===this.element&&this.focus()}onFocusOut(e){!(globalThis.visualViewport&&globalThis.visualViewport.height<document.documentElement.clientHeight-1)&&!this.modal&&this.autoClose&&this.close(),super.onFocusOut(e)}onShow(){var e;const r=this;r.autoClose&&r.addDocumentMouseDownListener(),r.focusOnToFront&&r.focus(),(e=super.onShow)==null||e.call(this),r.syncModalMask()}addDocumentMouseDownListener(){this.mouseDownRemover||(this.mouseDownRemover=be.ion({globaltap:"onDocumentMouseDown",thisObj:this}))}updateModal(e){e&&(this.floating=!0)}syncModalMask(){const e=this,{modal:r,element:t}=e;if(t.setAttribute("aria-modal",!!r),r&&e.isVisible)typeof e._x!="number"&&typeof e._y!="number"&&(e.centered=!0,e.anchor=!1),e.modalMask.classList.remove("b-hide-display"),t.classList.add("b-modal");else if(e.isPainted){t.classList.remove("b-modal");const i=e.floatRoot.querySelectorAll(".b-modal"),n=i.length?ht.fromElement(i[i.length-1],"popup"):null;n?n.syncModalMask():ht.modalMask.classList.add("b-hide-display")}}onHide(){var e,r;const t=this;(e=t.mouseDownRemover)==null||e.call(t),t.mouseDownRemover=null,(r=super.onHide)==null||r.call(this),t.syncModalMask()}onElementUserAction(){this.show()}onHeaderDblClick(){this.maximizable&&this.toggleMaximized()}updateClosable(e){this.tools.close.hidden=!e}updateMaximizable(e){this.tools.maximize.hidden=!e}get modalMask(){const{modalMask:e}=ht;return e.nextElementSibling!==this.element&&this.floatRoot.insertBefore(e,this.element),e}static get modalMask(){return this._modalMask||(this._modalMask=w.createElement({className:"b-modal-mask b-hide-display"}),B.on({element:this._modalMask,wheel:e=>e.preventDefault()})),this._modalMask}};ht.initClass(),ht._$name="Popup";var o_=/^b-icon-/,l_=/^b-fa-/,Cl=class extends ${static get $name(){return"MenuItem"}static get type(){return"menuitem"}static get configurable(){return{checked:null,separator:null,toggleGroup:null,menu:{value:null,$config:["lazy","nullify"]},icon:null,closeParent:null,href:null,target:null,localizableProperties:["text"],role:"menuitem",closeMenuDelay:200}}updateElement(e,r){const t=super.updateElement(e,r);return typeof this.checked=="boolean"&&(this.role="menuitemcheckbox"),this.ariaHasPopup=this.hasMenu?"menu":!1,t}compose(){var e;const r=this,{checked:t,href:i,hasMenu:n,separator:s,target:a,text:o,toggleGroup:l}=r,c=typeof t=="boolean",d=r.icon||(c?"b-fw-icon":""),u=`b-icon-${l?"radio-":""}`,h=typeof o=="object";return{tag:i?"a":"div",tabIndex:-1,href:i,target:a,class:{"b-has-submenu":n,"b-checked":t,"b-separator":s||((e=r.cls)==null?void 0:e["b-separator"])},dataset:{group:r.toggleGroup},[c?"aria-checked":""]:t,[n?"aria-expanded":""]:!1,children:{iconElement:d&&{"aria-hidden":!0,tag:"i",class:{"b-fa":l_.test(d),"b-icon":o_.test(d),"b-menuitem-icon":1,[`${u}checked`]:t===!0,[`${u}unchecked`]:t===!1,...J.normalize(d,"object")}},textElement:{tag:"span",html:h?null:o,class:{"b-menu-text":1,"b-menu-custom-content":h},children:h?[o]:null},subMenuIcon:n&&{"aria-hidden":!0,tag:"i",class:{"b-fw-icon":1,"b-icon-sub-menu":1}}}}}doAction(e){const r=this,t=this.parent,i={menu:t,item:r,element:r.element,bubbles:!0,domEvent:e};if(typeof r.checked=="boolean"){const n=!r.checked;(!r.toggleGroup||n)&&(r.checked=!r.checked)}r.trigger("beforeItem",i),r.trigger("item",i),r.closeParent&&t&&(t.rootMenu.close(),e&&!r.href&&e.preventDefault())}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const{focusElement:e}=this;return e&&this.isVisible&&(e===document.body||e.offsetParent)}get hasMenu(){return this.hasConfig("menu")}get childItems(){const{_menu:e}=this;return e?[e]:[]}get text(){return this.html}set text(e){this.html=e}onFocusIn(e){super.onFocusIn(e),!this.disabled&&this.menu&&this.delay("openMenu",200)}onFocusOut(e){this.clearTimeout("openMenu"),super.onFocusOut(e),this._menu&&(this.menu.closeTimer=this.menu.setTimeout(()=>this.closeMenu(),this.closeMenuDelay))}openMenu(e){const{menu:r}=this;!this.disabled&&r&&(r.focusOnToFront=e,r.show())}onChildShow(e){super.onChildShow(e),this.ariaElement.setAttribute("aria-expanded",!0)}closeMenu(){this._menu instanceof $&&this.menu.close()}onChildHide(e){super.onChildHide(e),this.ariaElement.setAttribute("aria-expanded",!1)}changeToggleGroup(e){return e&&typeof this.checked!="boolean"&&(this.checked=!1),e}changeChecked(e,r){if(this.isConfiguring||typeof r=="boolean")return!!e}updateChecked(e){const r=this;r.isConfiguring||(r.toggleGroup&&r.uncheckToggleGroupMembers(),r.element.setAttribute("aria-checked",e),r.trigger("toggle",{menu:r.owner,item:r,element:r.element,bubbles:!0,checked:e}))}getToggleGroupMembers(){const e=this,{checked:r,toggleGroup:t,element:i}=e,n=[];return r&&t&&w.forEachSelector(e.rootElement,`[data-group=${t}]`,s=>{if(s!==i){const a=$.fromElement(s);a&&n.push(a)}}),n}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach(e=>e.checked=!1)}get closeParent(){return(typeof this.checked=="boolean"?this._closeParent:this._closeParent!==!1)&&!this.hasMenu}changeMenu(e,r){const t=this,{constrainTo:i,scrollAction:n}=t.owner;return e&&typeof e=="object"&&!("items"in e)&&!("widgets"in e)&&!("html"in e)&&(e={lazyItems:e}),Fn.reconfigure(r,e,{owner:t,defaults:{type:"menu",align:"s0-e0",anchor:!0,autoClose:!0,autoShow:!1,cls:"b-sub-menu",forElement:t.element,owner:t,ariaLabel:t.text,constrainTo:i,scrollAction:n}})}};Cl.initClass(),Cl._$name="MenuItem";var c_={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1},Fn=class extends ht{static get $name(){return"Menu"}static get type(){return"menu"}static get configurable(){return{layout:"vbox",focusable:!0,align:"t-b",scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem",tools:{close:!1},role:"menu",ariaElement:"bodyElement"}}construct(e){Array.isArray(e)&&(e={lazyItems:e}),super.construct(e),B.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",thisObj:this})}afterShow(){const{items:e,element:r}=this;e.some(n=>!!n._menu)&&r.classList.add("b-menu-with-submenu"),e.some(n=>n.icon)&&r.classList.add("b-menu-with-icon"),super.afterShow(...arguments)}createWidget(e){return typeof e=="string"&&(e={text:e}),super.createWidget(e)}get focusElement(){var e;const r=this,t=(e=r.parentMenu)==null?void 0:e.element.contains(w.getActiveElement(r.parentMenu)),i=r.items[0];return t||w.usingKeyboard||!(i instanceof Cl)?super.focusElement:r.element}onDocumentMouseDown({event:e}){if(!this.parentMenu||!this.parentMenu.owns(e.target))return super.onDocumentMouseDown(...arguments)}hide(e){var r,t;const i=this;super.hide(e),i.isVisible||((t=(r=i.currentSubMenu)==null?void 0:r.hide)==null||t.call(r,e),i.parentMenu&&(i.parentMenu.currentSubMenu=null))}show(){super.show(...arguments);const{parentMenu:e}=this;this.isVisible&&e&&(e.currentSubMenu=this)}onMouseClick(e){const r=e.target.closest(".b-menuitem");r&&this.triggerElement(r,e)}onMouseOver(e){var r;if(this.focusOnHover!==!1){const t=(r=e.relatedTarget)==null?void 0:r.closest(".b-widget"),i=e.target.closest(".b-widget"),n=$.fromElement(i);!w.isTouchEvent&&i&&i!==t&&n.parent===this&&this.setTimeout({fn:"handleMouseOver",delay:30,args:[n],cancelOutstanding:!0})}}handleMouseOver(e){e.focus()}onMouseEnter(){this.clearTimeout(this.closeTimer)}onMouseLeave(e){const r=this,{relatedTarget:t}=e,i=t&&r.owns(t);let n=t instanceof HTMLElement&&$.fromElement(t),s=!i;if(n){for(;n.ownerCmp;)n=n.ownerCmp;s&=!w.getAncestor(n.element,[e.target])}!i&&s&&(r.currentSubMenu&&!r.currentSubMenu.closeTimer&&r.currentSubMenu.hide(),r.element.contains(w.getActiveElement(r))&&w.getActiveElement(r).matches(".b-menuitem")&&r.focusElement.focus())}onInternalKeyDown(e){const r=$.fromElement(e),t=r&&r!==this&&!(r instanceof Cl);if(e.key==="Escape"){(t?this:this.rootMenu).close();return}if(super.onInternalKeyDown(e),t)return;c_[e.key]&&e.preventDefault();const i=this.element,n=w.getActiveElement(i);this.navigateFrom(n!==i&&i.contains(n)?n:null,e.key,e)}navigateFrom(e,r,t){const i=this,{treeWalker:n}=i,s=e&&i.getItem(e),a=i.rtl?"ArrowLeft":"ArrowRight",o=i.rtl?"ArrowRight":"ArrowLeft";let l;switch(r){case"ArrowUp":n.currentNode=e||(e=i.bottomFocusTrap),n.previousNode(),l=n.currentNode;break;case"ArrowDown":n.currentNode=e||(e=i.topFocusTrap),n.nextNode(),l=n.currentNode;break;case" ":e&&!e.classList.contains("b-disabled")&&(s!=null&&s.menu?i.openSubMenu(e,s):i.triggerElement(e,t));break;case a:if(e&&(s!=null&&s.menu)&&!e.classList.contains("b-disabled")){const c=i.openSubMenu(e,s);c==null||c.focus()}else n.currentNode=e||(e=i.topFocusTrap),n.nextNode(),l=n.currentNode;break;case o:i.isSubMenu?i.hide():e||(n.currentNode=e||(e=i.topFocusTrap),n.nextNode(),l=n.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&i.triggerElement(e,t);break}l&&(l===i.element?i.navigateFrom(i.bottomFocusTrap,"ArrowUp",t):l===e?i.navigateFrom(i.topFocusTrap,"ArrowDown",t):l.focus())}getItem(e){if(e!=null)return typeof e=="number"?this.items[e]:e.nodeType===Element.ELEMENT_NODE?$.fromElement(e,"menuitem",this.contentElement):this.items.find(r=>r.id==e)}triggerElement(e,r){const t=this.getItem(e);t&&!t.disabled&&t.doAction(r)}get isSubMenu(){var e;return this===((e=this.owner)==null?void 0:e.menu)}openSubMenu(e,r){var t;const i=this,n=r.menu;if(n){if(!n.isVisible){const s={item:r,element:e};if(i.trigger("beforeSubMenu",s)===!1||((t=r.onBeforeSubMenu)==null?void 0:t.call(r,s))===!1)return;n.show()}return i.currentSubMenu=n}}set selectedElement(e){const r=this,t=r._selectedElement;if(t){const i=r.getItem(t),n=i==null?void 0:i.menu;n==null||n.hide(),t.classList.remove("b-active")}if(r._selectedElement=e,e){const i=w.isFocusable(e);e.classList.add("b-active"),r.scrollable.scrollIntoView(e,{animate:!i,focus:i})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame(()=>e.currentNode.focus())}get parentMenu(){var e;const r=this.owner;return r&&(r.isMenu?r:(e=r.up)==null?void 0:e.call(r,"menu"))}get rootMenu(){let e=this;for(;e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}};Fn.initClass(),Fn._$name="Menu";var Qd,aa=class extends Q{static get $name(){return"ContextMenuBase"}static get configurable(){return{type:null,menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",scrollAction:"hide",constrainTo:globalThis}},items:{},triggerEvent:!1,clickTriggerSelector:null,keyMap:{" ":{handler:"showContextMenuByKey",weight:100},"Ctrl+Space":"showContextMenuByKey"}}}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick"]}}construct(...e){var r;if(super.construct(...e),!((r=this.type)!=null&&r.length))throw new Error("Config 'type' is required to be specified for context menu")}onElementContextMenu(e){this.onElementEvent(e)}onElementClick(e){this.onElementEvent(e)}onElementDblClick(e){this.onElementEvent(e)}onElementEvent(e){if(!e.handled&&this.triggerEvent===e.type){if(e.ctrlKey===!0&&!q.isMac){e.preventDefault();return}const r=e;if(Qd){const{target:t}=Qd;e=B.fixEvent(new MouseEvent(e.type,e)),Object.defineProperty(e,"target",{get:()=>t,configurable:!0}),e.preventDefault=function(){r.preventDefault(),r.handled=!0}}this.internalShowContextMenu(e)}else e.type==="click"&&this.clickTriggerSelector&&e.target.matches(this.clickTriggerSelector)&&this.internalShowContextMenu(e)}showContextMenuByKey(e){if(!w.isEditable(e.target)){const r=this.getKeyboardContextMenuTarget(e.target);if(r)return Qd=e,w.triggerMouseEvent(r,this.triggerEvent),e.handled=!0,e.preventDefault(),e.stopImmediatePropagation(),Qd=null,!0}return!1}getKeyboardContextMenuTarget(e){const r=w.isInView(e);return e.children.length?w.childFromPoint(e,r.width/2,r.height/2):e}internalShowContextMenu(e){const r=this;if(r.disabled)return;const t=r.getDataFromEvent(e);!e.handled&&!e.defaultPrevented&&t&&r.shouldShowMenu(t)&&(e.type==="contextmenu"&&q.isSafari&&e.ctrlKey&&!e.metaKey&&B.on({element:e.target,capture:!0,once:!0,thisObj:this,click(i){i.preventDefault(),i.stopImmediatePropagation()}}),t.domEvent=e,r.showContextMenu(t))}getDataFromEvent(e){return{event:e,targetElement:this.getTargetElementFromEvent(e)}}getTargetElementFromEvent(e){return e.target}async showContextMenu(e,r){var t,i;const n=this,s=w.isDOMEvent(e),a=s?n.getDataFromEvent(e):e,o=s?e:a.domEvent;if((t=n._menu)==null||t.hide(),n.disabled)return;n.menuContext=a;const{type:l,client:c,processItems:d}=n,u=w.isInView(a.targetElement).center;if(N.assign(a,{feature:n,point:o!=null&&o.clientX?[o.clientX+1,o.clientY+1]:[u.x,u.y],menu:n,items:{},selection:c.selectedRecords}),n.callChainablePopulateMenuMethod(a),N.merge(a.items,n.baseItems),n.preventDefaultEvent(a),(!d||n.callback(d,c,[a])!==!1)&&n.hasActiveMenuItems(a)&&(n.populateItemsWithData(a),n.beforeContextMenuShow(a)!==!1)){const{menu:h}=n;let g=c.trigger(`${l}MenuBeforeShow`,a);T.isPromise(g)&&(o.handled=!0,g=await g),g!==!1&&(h.items=a.items,h.showBy(r||{target:a.domEvent}),(i=n.touchMoveDetacher)==null||i.call(n),n.touchMoveDetacher=B.on({element:c.element,touchmove:()=>h.hide(),thisObj:h,once:!0}),o&&(o.preventDefault(),o.handled=!0))}}get baseItems(){if(!this._baseItems){const e=this,{namedItems:r}=e,t=e._baseItems=N.assign({},e.items);for(const i in t){const n=t[i];n&&(r&&i in r?t[i]=typeof n=="object"?N.merge(N.clone(r[i]),n):r[i]:n===!0&&delete t[i])}}return this._baseItems}hideContextMenu(e){var r;(r=this.menu)==null||r.hide(e)}callChainablePopulateMenuMethod(e){var r,t;(t=(r=this.client)[`populate${O.capitalize(this.type)}Menu`])==null||t.call(r,e)}hasActiveMenuItems(e){return Object.values(e.items).some(r=>r&&!r.hidden)}shouldShowMenu(){return!0}beforeContextMenuShow(e){}populateItemsWithData(e){}preventDefaultEvent(e){var r;(r=e.event)==null||r.preventDefault()}changeTriggerEvent(e){return e||this.client.contextMenuTriggerEvent}changeMenu(e,r){const t=this,{client:i,type:n}=t;if(e)return Fn.reconfigure(r,e?Fn.mergeConfigs({owner:i,rootElement:i.rootElement,onItem(s){i.trigger(`${n}MenuItem`,s)},onToggle(s){i.trigger(`${n}MenuToggleItem`,s)},onDestroy(){t.menu=null},onBeforeItem(s){Object.assign(s,t.menuContext)},onShow({source:s}){t.menuContext.menu=s,i.trigger(`${n}MenuShow`,t.menuContext)}},e):null,t);r!=null&&r.isWidget&&r.destroy()}};aa._$name="ContextMenuBase";var d_=e=>class extends(e||F){static get $name(){return"DragHelperContainer"}initContainerDrag(){const t=this;if(t.mode||(t.mode="container"),t.mode==="container"&&!t.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(t){const i=this;if(!i.ignoreSelector||!t.target.closest(i.ignoreSelector)){const n=w.getAncestor(t.target,i.containers,i.outerElement);if(n){const s=n.getBoundingClientRect();i.context={element:n,valid:!0,action:"container",offsetX:t.pageX-s.left,offsetY:t.pageY-s.top,originalPosition:{parent:n.parentElement,prev:n.previousElementSibling,next:n.nextElementSibling}}}return!0}return!1}startContainerDrag(t){var i;const n=this,{context:s,floatRootOwner:a}=n,{element:o}=s,l=o.cloneNode(!0),c=a==null?void 0:a.element.closest(".b-outer");l.classList.add(n.dragProxyCls,n.draggingCls),((a==null?void 0:a.floatRoot)||w.getRootElement(o)).appendChild(l),s.dragProxy=l,s.dragging=o,o.classList.add(n.dropPlaceholderCls),(i=c==null?void 0:c.parentElement)!=null&&i.matches(".b-float-root")&&(l.style.zIndex=a.floatRootMaxZIndex+1)}onContainerDragStarted(t){const i=this,{context:n}=i,{element:s,dragProxy:a}=n,o=s.getBoundingClientRect();if(i.autoSizeClonedTarget)a.style.width=o.width+"px",a.style.height=o.height+"px",w.setTranslateXY(n.dragProxy,o.left,o.top);else{const l=a.getBoundingClientRect();Object.assign(n,{offsetX:l.width/2,offsetY:l.height/2}),w.setTranslateXY(a,t.clientX,t.clientY)}}updateContainerDrag(t){var i;const n=this,{context:s}=n;if(!s.started||!s.targetElement)return;const a=w.getAncestor(s.targetElement,n.containers,"b-gridbase"),o=(i=s.dragging)==null?void 0:i.contains(w.getActiveElement(s.dragging));a&&w.isDescendant(s.element,a)||(o&&be.suspendFocusEvents(),a&&s.valid?n.moveNextTo(a,t):n.revertPosition(),o&&be.resumeFocusEvents(),t.preventDefault())}finishContainerDrag(t){const i=this,{context:n}=i,{dragging:s,dragProxy:a,valid:o,draggedTo:l,insertBefore:c,originalPosition:d}=n;s&&(n.valid=!!(o&&(l||i.externalDropTargetSelector&&t.target.closest(i.externalDropTargetSelector))&&(s!==c||d.parent!==l)),n.finalize=(u=n.valid)=>{!u&&i.context&&i.revertPosition(),s.classList.remove(i.dropPlaceholderCls),a.remove(),i.reset()},n.async=!1,i.trigger("drop",{context:n,event:t}),n.async||n.finalize())}abortContainerDrag(t=!1,i=null,n=!1){const s=this,{context:a}=s;a.dragging&&(a.dragging.classList.remove(s.dropPlaceholderCls),a.dragProxy.remove(),s.revertPosition()),n||s.trigger(t?"drop":"abort",{context:a,event:i}),s.reset()}updateContainerProxy(t){const i=this,{context:n}=i,s=n.dragProxy;let a=t.pageX-n.offsetX,o=t.pageY-n.offsetY;typeof i.minX=="number"&&(a=Math.max(i.minX,a)),typeof i.maxX=="number"&&(a=Math.min(i.maxX-s.offsetWidth,a)),typeof i.minY=="number"&&(o=Math.max(i.minY,o)),typeof i.maxY=="number"&&(o=Math.min(i.maxY-s.offsetHeight,o)),i.lockX?w.setTranslateY(s,o):i.lockY?w.setTranslateX(s,a):w.setTranslateXY(s,a,o);let l;if(t.type==="touchmove"){const c=t.changedTouches[0];l=w.elementFromPoint(c.clientX,c.clientY)}else l=t.target;n.targetElement=l}moveNextTo(t,i){const{context:n}=this,s=n.dragging,a=t.parentElement;if(t!==s){const o=k.from(t).center.x;this.isRTL&&i.pageX>o||!this.isRTL&&i.pageX<o?(a.insertBefore(s,t),n.insertBefore=t):t.nextElementSibling?t.nextElementSibling!==s?(n.insertBefore=t.nextElementSibling,a.insertBefore(s,t.nextElementSibling)):!n.insertBefore&&s.parentElement.lastElementChild!==s&&(n.insertBefore=t.nextElementSibling):(a.appendChild(s),n.insertBefore=null),n.draggedTo=a}}revertPosition(){const{context:t}=this,{dragging:i}=t,{parent:n,next:s}=t.originalPosition;s?s.previousSibling===i||!s&&i===n.lastChild||n.insertBefore(i,s):n.appendChild(i),t.draggedTo=null}},u_={pageXOffset:0,pageYOffset:0},h_=e=>class extends fe(e||F){static get $name(){return"DragHelperTranslate"}static get configurable(){return{positioning:null,skipUpdatingElement:null}}initTranslateDrag(){const t=this;!t.isElementDraggable&&t.targetSelector&&(t.isElementDraggable=i=>i.closest(t.targetSelector))}grabTranslateDrag(t){const i=this.getTarget(t);return i?(this.context={valid:!0,element:i,startPageX:t.pageX,startPageY:t.pageY,startClientX:t.clientX,startClientY:t.clientY},!0):!1}getTarget(t){return t.target.closest(this.targetSelector)}getX(t){return this.positioning==="absolute"?parseFloat(t.style.left,10):w.getTranslateX(t)}getY(t){return this.positioning==="absolute"?parseFloat(t.style.top,10):w.getTranslateY(t)}getXY(t){return this.positioning==="absolute"?[t.offsetLeft,t.offsetTop]:w.getTranslateXY(t)}setXY(t,i,n){this.skipUpdatingElement||(this.positioning==="absolute"?(t.style.left=i+"px",t.style.top=n+"px"):w.setTranslateXY(t,i,n))}startTranslateDrag(t){const i=this,{context:n,outerElement:s,proxySelector:a}=i,o=i.dragWithin=i.dragWithin||i.cloneTarget&&document.body;let l=n.dragProxy||n.element;const c=l,d=l.parentElement;if(i.cloneTarget){const u=a?l.querySelector(a):l,{width:h,height:g,x:f,y:m}=k.from(u,o);l=i.createProxy(l);let p=f,v=m;if(i.autoSizeClonedTarget&&(l.style.width=`${h}px`,l.style.height=`${g}px`),l.classList.add(i.dragProxyCls,i.draggingCls),l.classList.remove("b-hover","b-selected","b-focused"),o.appendChild(l),!i.autoSizeClonedTarget||a){const y=l.getBoundingClientRect(),{x:C,y:D}=o.getBoundingClientRect(),S=t.clientX-C,x=t.clientY-D+(o!==document.body?document.body.getBoundingClientRect().y:0);p=S-y.width/2,v=x-y.height/2,n.startPageX=t.pageX,n.startPageY=t.pageY}i.setXY(l,p,v),c.classList.add("b-drag-original"),i.hideOriginalElement&&c.classList.add("b-hidden")}l.classList.add(i.draggingCls),Object.assign(n,{element:l,grabbed:c,grabbedParent:d,grabbedNextSibling:l.nextElementSibling,elementStartX:i.getX(l),elementStartY:i.getY(l),elementX:w.getOffsetX(l,o||s),elementY:w.getOffsetY(l,o||s),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!i.cloneTarget||o===s}),o&&(n.parentElement=l.parentElement,o!==l.parentElement&&o.appendChild(l),i.updateTranslateProxy(t))}onTranslateDragStarted(){const t=this,{context:i}=t;let{relatedElements:n}=i;if(t.unifiedProxy&&i.element.classList.add("b-drag-main","b-drag-unified-proxy"),(n==null?void 0:n.length)>0){i.relatedElStartPos=[],i.relatedElDragFromPos=[];const{proxySelector:s}=t;let[a,o]=[i.elementStartX,i.elementStartY];i.originalRelatedElements=n,n=i.relatedElements=n.map((l,c)=>{const d=s?l.querySelector(s):l,{x:u,y:h,width:g,height:f}=k.from(d,t.dragWithin),m=t.cloneTarget?t.createProxy(l):l;return m.classList.add(t.draggingCls),m.classList.remove("b-hover","b-selected","b-focused"),t.cloneTarget&&(t.setXY(m,u,h),t.dragWithin.appendChild(m),m.classList.add(t.dragProxyCls),t.autoSizeClonedTarget&&(m.style.width=`${g}px`,m.style.height=`${f}px`),t.hideOriginalElement&&l.classList.add("b-hidden"),l.classList.add("b-drag-original")),i.relatedElStartPos[c]=i.relatedElDragFromPos[c]=t.getXY(m),t.unifiedProxy&&(m.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),a+=t.unifiedOffset,o+=t.unifiedOffset,t.setXY(m,a,o),i.relatedElDragFromPos[c]=[a,o],m.style.zIndex=100-c),m}),t.unifiedProxy&&n&&n.length>0&&B.onTransitionEnd({element:n[0],property:"transform",handler(){n.forEach(l=>l.classList.remove("b-drag-unified-animation"))},thisObj:t,once:!0})}}applyConstraints(t,i,n){const s=this,{constrain:a,dragWithin:o}=s,{pageXOffset:l,pageYOffset:c}=o===document.body?globalThis:u_;return o&&a&&(i<0&&(i=0),i+t.offsetWidth>o.scrollWidth&&(i=o.scrollWidth-t.offsetWidth),n<0&&(n=0),n+t.offsetHeight>o.scrollHeight&&(n=o.scrollHeight-t.offsetHeight)),typeof s.minX=="number"&&(i=Math.max(s.minX+l,i)),typeof s.maxX=="number"&&(i=Math.min(s.maxX+l,i)),typeof s.minY=="number"&&(n=Math.max(s.minY+c,n)),typeof s.maxY=="number"&&(n=Math.min(s.maxY+c,n)),{constrainedX:i,constrainedY:n}}updateTranslateProxy(t,i){const n=this,{lockX:s,lockY:a,context:o}=n,l=o.dragProxy||o.element,{relatedElements:c,relatedElDragFromPos:d}=o;o.scrollManagerElementContainsDragProxy&&i&&(o.scrollX=i.getRelativeLeftScroll(l),o.scrollY=i.getRelativeTopScroll(l)),o.pageX=t.pageX,o.pageY=t.pageY,o.clientX=t.clientX,o.clientY=t.clientY;let u=o.elementStartX+t.pageX-o.startPageX+o.scrollX,h=o.elementStartY+t.pageY-o.startPageY+o.scrollY;if(n.snapCoordinates){const m=n.snapCoordinates({element:l,newX:u,newY:h});u=m.x,h=m.y}const{constrainedX:g,constrainedY:f}=n.applyConstraints(l,u,h);if((o.started||g!==u||f!==h)&&n.setXY(l,s?void 0:g,a?void 0:f),c){const m=s?0:g-o.elementStartX,p=a?0:f-o.elementStartY;c.forEach((v,y)=>{const[C,D]=d[y];n.setXY(v,C+m,D+p)})}o.newX=g,o.newY=f}async finishTranslateDrag(t){const i=this,n=i.context,{target:s}=t,a=!i.lockX&&Math.round(n.newX)!==Math.round(n.elementStartX),o=!i.lockY&&Math.round(n.newY)!==Math.round(n.elementStartY),l=n.dragProxy||n.element,{relatedElements:c}=n;if(!i.ignoreSamePositionDrop||a||o)if(n.valid===!1)await i.abortTranslateDrag(!0,t);else{const d=!i.allowDropOutside&&k.from(i.dragWithin||i.outerElement);d&&(typeof i.minX!="number"&&i.minX!==!0&&t.pageX<d.left||typeof i.maxX!="number"&&i.maxX!==!0&&t.pageX>d.right||typeof i.minY!="number"&&i.minY!==!0&&t.pageY<d.top||typeof i.maxY!="number"&&i.maxY!==!0&&t.pageY>d.bottom)?await i.abortTranslateDrag(!0,t):(n.finalize=async(u=n.valid)=>{if(n.finalized){console.warn("DragHelper: Finalizing already finalized drag");return}n.finalized=!0,!u&&i.context&&await i.abortTranslateDrag(!0,null,!0),i.isDestroyed||(i.trigger("dropFinalized",{context:n,event:t,target:s}),i.reset()),!i.cloneTarget&&l.parentElement!==n.grabbedParent&&[l,...c||[]].forEach(h=>h.style.transform="")},n.async=!1,await i.trigger("drop",{context:n,event:t,target:s}),n.async||await n.finalize())}else i.abortTranslateDrag(!1,t)}async abortTranslateDrag(t=!1,i=null,n=!1){var s,a;const o=this,{cloneTarget:l,context:c,proxySelector:d,dragWithin:u,draggingCls:h}=o,{relatedElements:g,relatedElStartPos:f,grabbed:m}=c,p=c.dragProxy||c.element;if(c.valid=!1,(s=o.scrollManager)==null||s.stopMonitoring(),c.aborted){console.warn("DragHelper: Aborting already aborted drag");return}let{elementStartX:v,elementStartY:y}=c;const C=v!==o.getX(p)||y!==o.getY(p);if(p&&c.started){if(!l&&u&&u!==c.grabbedParent&&c.grabbedParent.insertBefore(p,c.grabbedNextSibling),l&&d){const D=m.querySelector(d)||m,{x:S,y:x}=k.from(D);v=S,y=x}p.classList.add("b-aborting"),o.setXY(p,v,y),g==null||g.forEach((D,S)=>{D.classList.remove(h),D.classList.add("b-aborting"),o.setXY(D,f[S][0],f[S][1])}),n||o.trigger(t?"drop":"abort",{context:c,event:i}),p.isConnected&&!o.isDestroying&&C&&await B.waitForTransitionEnd({element:p,property:w.getPropertyTransitionDuration(p,"transform")?"transform":"all",thisObj:o,once:!0,runOnDestroy:!0}),o.isDestroyed||o.trigger("abortFinalized",{context:c,event:i})}(a=o.context)!=null&&a.started&&o.reset()}cleanUp(){const t=this,{context:i,cloneTarget:n,draggingCls:s,dragProxyCls:a}=t,o=i.dragProxy||i.element,{relatedElements:l,originalRelatedElements:c,grabbed:d}=i,u=n&&(t.removeProxyAfterDrop||!i.valid),h=[s,"b-aborting",a,"b-drag-main","b-drag-unified-proxy"];o.classList.remove(...h),u&&o.remove(),l==null||l.forEach(g=>{u?g.remove():g.classList.remove(...h)}),d.classList.remove("b-drag-original","b-hidden"),c==null||c.forEach(g=>g.classList.remove("b-hidden","b-drag-original"))}},oa={move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"},ki=class extends F.mixin(Le,d_,h_){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,allowDropOutside:null,floatRootOwner:null,mouseMoveListenerElement:document,externalDropTargetSelector:null,testConfig:{transitionDuration:10,clickSwallowDuration:50,touchStartDelay:100},rtlSource:null,createProxy:null}}construct(e){const r=this;super.construct(e),r.initListeners(),r.isContainerDrag?r.initContainerDrag():r.initTranslateDrag(),r.onScrollManagerScrollCallback=r.onScrollManagerScrollCallback.bind(r)}doDestroy(){this.reset(!0),super.doDestroy()}initListeners(){const e=this,{outerElement:r}=e,t={element:r,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(r),B.on(t)}getMouseMoveListenerTarget(e){const r=e.getRootNode();let t=this.mouseMoveListenerElement;return r.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&r.mode==="closed"&&(t=e.closest(".b-outer")||t),t}get isRTL(){var e;return!!((e=this.rtlSource)!=null&&e.rtl)}onPointerDown(e){const r=this;if(e.button!==0||r.context||r.isElementDraggable&&!r.isElementDraggable(e.target,e))return;if(r.startEvent=e,r.isContainerDrag?r.grabContainerDrag(e):r.grabTranslateDrag(e)){r.blurDetacher=B.on({element:globalThis,blur:r.onWindowBlur,thisObj:r});const i={element:r.mouseMoveListenerElement,thisObj:r,capture:!0,keydown:oa.keydown};if(e.pointerType==="touch"?(r.touchStartTimer=r.setTimeout(()=>r.touchStartTimer=null,r.touchStartDelay,"touchStartDelay"),i.touchmove={handler:oa.touchmove,passive:!1},i.touchend=i.pointerup=oa.touchend):(i.pointermove=oa.move,i.pointerup=oa.up),r.dragListenersDetacher=B.on(i),r.dragWithin&&r.dragWithin!==r.outerElement&&r.outerElement.contains(r.dragWithin)){const n=k.from(r.dragWithin,r.outerElement);r.minY=n.top,r.maxY=n.bottom,r.minX=n.left,r.maxX=n.right}}}async internalMove(e){var r,t;if(e.scrollInitiated)return;const i=this,{context:n}=i,s=B.getDistanceBetween(i.startEvent,e);if(i.touchStartTimer&&s>i.dragThreshold){i.abort(!0);return}if(!i.touchStartTimer&&(n!=null&&n.element)&&(n.started||s>=i.dragThreshold)&&((r=e.target)==null?void 0:r.nodeType)===Node.ELEMENT_NODE){if(!n.started){if(i.trigger("beforeDragStart",{context:n,event:e})===!1)return i.abort();i.isContainerDrag?i.startContainerDrag(e):i.startTranslateDrag(e),n.started=!0,(t=i.scrollManager)==null||t.startMonitoring(T.merge({scrollables:[{element:i.dragWithin||i.outerElement}],callback:i.onScrollManagerScrollCallback},i.monitoringConfig)),n.outermostEl=w.getOutermostElement(e.target),n.outermostEl.classList.add("b-draghelper-active"),i.dropTargetSelector&&i.dropTargetCls&&w.getRootElement(i.outerElement).querySelectorAll(i.dropTargetSelector).forEach(l=>l.classList.add(i.dropTargetCls));const o=i.trigger("dragStart",{context:n,event:e});T.isPromise(o)&&await o,n.moveUnblocked=!0,i.isContainerDrag?i.onContainerDragStarted(e):i.onTranslateDragStarted(e),i.trigger("afterDragStart",{context:n,event:e})}n.moveUnblocked?i._cachedMouseEvent?(i.update(e),i.update(i._cachedMouseEvent),delete i._cachedMouseEvent):i.update(e):i._cachedMouseEvent=e,e.type==="touchmove"&&(e.preventDefault(),e.stopImmediatePropagation())}}onScrollManagerScrollCallback(e){var r;const{lastMouseMoveEvent:t}=this;(r=this.context)!=null&&r.element&&t&&(t.isScroll=!0,this.update(t,e))}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,r){const t=this,{context:i}=t,n=document.scrollingElement||document.body;let s=t.getMouseMoveEventTarget(e);if(e.type==="touchmove"){const o=e.changedTouches[0];s=w.elementFromPoint(o.clientX+n.scrollLeft,o.clientY+n.scrollTop)}i.target=s;let a=t.allowDropOutside||!t.dragWithin||t.dragWithin.contains(e.target);a&&t.dropTargetSelector&&(a=a&&!!(s!=null&&s.closest(t.dropTargetSelector))),t.isContainerDrag?t.updateContainerProxy(e,r):t.updateTranslateProxy(e,r),i.valid=a,t.trigger("drag",{context:i,event:e}),t.isContainerDrag&&t.updateContainerDrag(e,r),i.valid=i.valid&&a;for(const o of t.draggedElements)o.classList.toggle(t.invalidCls,!i.valid);e&&(t.lastMouseMoveEvent=e)}get draggedElements(){var e;const{context:r}=this;return[r.dragProxy||r.element,...(e=r.relatedElements)!=null?e:[]]}async abort(e=!1){var r,t;const i=this,{context:n}=i;(t=(r=i.scrollManager)==null?void 0:r.stopMonitoring)==null||t.call(r),i.removeListeners(),n!=null&&n.started&&!n.aborted?(n.element.getBoundingClientRect(),n.valid=!1,i.isContainerDrag?i.abortContainerDrag(void 0,void 0,e):i.abortTranslateDrag(void 0,void 0,e),n.aborted=!0):i.reset(!0)}removeListeners(){var e,r;(e=this.dragListenersDetacher)==null||e.call(this),(r=this.blurDetacher)==null||r.call(this)}reset(e){const r=this,{context:t}=r;if(t!=null&&t.started){for(const i of r.draggedElements)i.classList.remove(r.invalidCls);t.outermostEl.classList.remove("b-draghelper-active"),r.isContainerDrag?t.dragProxy.remove():r.cleanUp(),r.dropTargetSelector&&r.dropTargetCls&&w.getRootElement(r.outerElement).querySelectorAll(r.dropTargetSelector).forEach(i=>i.classList.remove(r.dropTargetCls))}r.removeListeners(),e||r.trigger("reset"),r.context=r.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){var r;const t=this,{context:i}=t;t.removeListeners(),i&&((r=t.scrollManager)==null||r.stopMonitoring(),i.started?i.moveUnblocked?(e.stopPropagation(),i.finalizing=!0,t.isContainerDrag?t.finishContainerDrag(e):t.finishTranslateDrag(e),B.on({element:document,thisObj:t,click:oa.docclick,capture:!0,expires:t.clickSwallowDuration,once:!0})):t.ion({drag(){t.onMouseUp(e)},once:!0}):t.reset(!0))}onKeyDown(e){var r;(r=this.context)!=null&&r.started&&e.key==="Escape"&&(e.stopImmediatePropagation(),this.abort())}onWindowBlur(){this.context&&!this.context.finalizing&&this.abort()}createProxy(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);const r=e.cloneNode(!0);return r.removeAttribute("id"),r}get isContainerDrag(){return this.mode==="container"}async animateProxyTo(e,r={align:"c-c"}){const{context:t,draggedElements:i}=this,{element:n}=t,s=e.isRectangle?e:k.from(e);i.forEach(a=>{a.classList.add("b-drag-final-transition"),w.alignTo(a,s,r)}),await B.waitForTransitionEnd({element:n,property:"all",thisObj:this,once:!0}),i.forEach(a=>a.classList.remove("b-drag-final-transition"))}get isDragging(){var e;return!!((e=this.context)!=null&&e.started)}getMouseMoveEventTarget(e){return e.isScroll?w.elementFromPoint(e.clientX,e.clientY):e.target}};ki._$name="DragHelper";var ii={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"},Sl=class extends Le(F){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,rtlSource:null}}construct(e){const r=this;super.construct(e),!r.handleSelector&&!q.isHoverableDevice&&(r.handleSize=r.touchHandleSize),r.handleVisibilityThreshold=r.handleVisibilityThreshold||2*r.handleSize,r.initListeners(),r.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}updateSkipUpdatingElement(e){e&&(this.skipTranslate=!0)}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=r=>r.closest(e.targetSelector)),e.grab){const{edge:r,element:t,event:i}=e.grab;e.startEvent=i;const n=e.getCursorOffsetToElementEdge(i,t,r);e.context={element:t,edge:r,valid:!0,async:!1,elementStartX:w.getTranslateX(t)||t.offsetLeft,elementStartY:w.getTranslateY(t)||t.offsetTop,newX:w.getTranslateX(t)||t.offsetLeft,newY:w.getTranslateY(t)||t.offsetTop,elementWidth:t.offsetWidth,elementHeight:t.offsetHeight,cursorOffset:n,startX:i.clientX+n.x+e.scrollLeft,startY:i.clientY+n.y+e.scrollTop,finalize:()=>{var s;return(s=e.reset)==null?void 0:s.call(e)}},t.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,r={element:e.outerElement,mousedown:ii.down,touchstart:ii.touchstart,thisObj:e};!e.handleSelector&&q.isHoverableDevice&&(r.mousemove={handler:ii.move,delegate:e.targetSelector},r.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),B.on(r)}get isRTL(){var e;return!!((e=this.rtlSource)!=null&&e.rtl)}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const r={element:document,keydown:ii.keydown,thisObj:this};e?(r.touchmove=ii.touchmove,r.touchend=r.pointerup=ii.touchend):(r.mousemove=ii.move,r.mouseup=ii.up),this.removeDragListeners=B.on(r)}removeDragListeners(){}reset(){var e;(e=this.removeDragListeners)==null||e.call(this),this.context=null,this.trigger("reset")}canResize(e,r){return!this.isElementResizable||this.isElementResizable(e,r)}onPointerDown(e,r){const t=this;t.startEvent=r,t.canResize(r.target,r)&&t.grabResizeHandle(e,r)&&(r.stopImmediatePropagation(),r.type==="touchstart"&&r.preventDefault(),t.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){e.button===0&&this.onPointerDown(!1,e)}internalMove(e,r){var t;const i=this,{context:n,direction:s}=i;n!=null&&n.element&&(n.started||B.getDistanceBetween(i.startEvent,r)>=i.dragThreshold)?(n.started||((t=i.scrollManager)==null||t.startMonitoring(T.merge({scrollables:[{element:i.dragWithin||i.outerElement,direction:s}],callback:a=>{var o;return((o=i.context)==null?void 0:o.element)&&i.lastMouseMoveEvent&&i.update(i.lastMouseMoveEvent,a)}},i.monitoringConfig)),i.trigger("resizeStart",{context:n,event:r}),n.started=!0),i.update(r)):!e&&!i.handleSelector&&i.checkResizeHandles(r)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,r){var t,i,n;const s=this,a=s.context;(t=s.removeDragListeners)==null||t.call(s),a?((i=s.scrollManager)==null||i.stopMonitoring(),a.started&&B.on({element:document,thisObj:s,click:ii.docclick,expires:s.clickSwallowDuration,capture:!0,once:!0}),s.finishResize(r)):(n=s.reset)==null||n.call(s)}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){e.key==="Escape"&&this.abort()}update(e){const r=this,t=r.context,i=k.from(r.outerElement);t.currentX=Math.max(Math.min(e.clientX+t.cursorOffset.x,i.right),i.x)+r.scrollLeft,t.currentY=Math.max(Math.min(e.clientY+t.cursorOffset.y,i.bottom),i.y)+r.scrollTop,e&&(r.updateResize(e)&&(r.trigger("resizing",{context:t,event:e}),t.element.classList.toggle(r.invalidCls,t.valid===!1)),r.lastMouseMoveEvent=e)}abort(e=!1){var r,t;const i=this;(t=(r=i.scrollManager)==null?void 0:r.stopMonitoring)==null||t.call(r),i.context?i.abortResize(null,e):i.isDestroyed||i.reset()}grabResizeHandle(e,r){const t=this;if(t.allowResize&&!t.allowResize(r.target,r))return!1;const i=t.handleSelector,n=r.type==="touchstart"?r.changedTouches[0]:r,s=n.clientX,a=n.clientY,o=t.targetSelector?r.target.closest(t.targetSelector):r.target;if(o){let l;if(i)if(r.target.matches(i))t.direction==="horizontal"?r.pageX<w.getPageX(o)+o.offsetWidth/2?l=t.isRTL?"right":"left":l=t.isRTL?"left":"right":r.pageY<w.getPageY(o)+o.offsetHeight/2?l="top":l="bottom";else return!1;else if(t.direction==="horizontal"?t.overLeftHandle(r,o)?l=t.isRTL?"right":"left":t.overRightHandle(r,o)&&(l=t.isRTL?"left":"right"):t.overTopHandle(r,o)?l="top":t.overBottomHandle(r,o)&&(l="bottom"),!l)return t.context=null,!1;r.type==="touchstart"&&r.preventDefault();const c=t.getCursorOffsetToElementEdge(n,o,l);if(t.trigger("beforeResizeStart",{element:o,event:r})!==!1)return t.context={element:o,edge:l,isTouch:e,valid:!0,async:!1,direction:t.direction,elementStartX:w.getTranslateX(o)||o.offsetLeft,elementStartY:w.getTranslateY(o)||o.offsetTop,newX:w.getTranslateX(o)||o.offsetLeft,newY:w.getTranslateY(o)||o.offsetTop,elementWidth:o.offsetWidth,elementHeight:o.offsetHeight,cursorOffset:c,startX:s+c.x+t.scrollLeft,startY:a+c.y+t.scrollTop,finalize:()=>{var d;return(d=t.reset)==null?void 0:d.call(t)}},o.classList.add(t.resizingCls),!0}return!1}getCursorOffsetToElementEdge(e,r,t){const i=k.from(r);let n=0,s=0;switch(t){case"left":n=i.x-(this.isRTL?i.width:0)-e.clientX;break;case"right":n=i.x+(this.isRTL?0:i.width)-e.clientX;break;case"top":s=i.y-e.clientY;break;case"bottom":s=i.y+i.height-e.clientY;break}return{x:n,y:s}}checkResizeHandles(e){const r=this,t=r.targetSelector?e.target.closest(r.targetSelector):e.target;if(t&&(!r.allowResize||r.allowResize(e.target,e))){if(r.currentElement=r.handleContainerSelector?e.target.closest(r.handleContainerSelector):e.target,r.currentElement){let i;r.direction==="horizontal"?i=r.overLeftHandle(e,t)||r.overRightHandle(e,t):i=r.overTopHandle(e,t)||r.overBottomHandle(e,t),i?r.highlightHandle():r.unHighlightHandle()}}else r.currentElement&&r.unHighlightHandle()}onMouseLeaveTarget(e){const r=this;r.currentElement=r.handleContainerSelector?e.target.closest(r.handleContainerSelector):e.target,r.currentElement&&r.unHighlightHandle()}updateResize(e){const r=this,{context:t,allowEdgeSwitch:i,skipTranslate:n,skipUpdatingElement:s}=r;let a;i&&(r.direction==="horizontal"?t.edge=t.currentX>t.startX?"right":"left":t.edge=t.currentY>t.startY?"bottom":"top");const{element:o,elementStartX:l,elementStartY:c,elementWidth:d,elementHeight:u,edge:h}=t,{style:g}=o,f=t.currentX-t.startX,m=t.currentY-t.startY,p=w.getExtremalSizePX(o,"minWidth")||r.minWidth,v=w.getExtremalSizePX(o,"maxWidth")||r.maxWidth,y=w.getExtremalSizePX(o,"minHeight")||r.minHeight,C=w.getExtremalSizePX(o,"maxHeight")||r.maxHeight,D=h==="right"&&!r.isRTL||h==="bottom"?1:-1,S=d+f*D,x=u+m*D;let R=Math.max(p,S),I=Math.max(y,x);if(v>0&&(R=Math.min(R,v)),C>0&&(I=Math.min(I,C)),g.flex&&(g.flex=""),r.direction==="horizontal"&&d!==R){if(s||(g.width=Math.abs(R)+"px"),t.newWidth=R,h==="left"||R<0){const M=Math.max(Math.min(l+d-r.minWidth,l+f),0);n||w.setTranslateX(o,Math.round(M)),t.newX=M}else h==="right"&&i&&!n&&w.setTranslateX(o,l);a=!0}else r.direction==="vertical"&&u!==x&&(s||(g.height=Math.abs(I)+"px"),t.newHeight=I,h==="top"||I<0?(t.newY=Math.max(Math.min(c+u-r.minHeight,c+m),0),n||w.setTranslateY(o,t.newY)):h==="bottom"&&i&&!n&&w.setTranslateY(o,c),a=!0);return a}finishResize(e){var r;const t=this,i=t.context,n={context:i,event:e};if(i.element.classList.remove(t.resizingCls),i.started){let s=!1;t.direction==="horizontal"?s=i.newWidth&&i.newWidth!==i.elementWidth:s=i.newHeight&&i.newHeight!==i.elementHeight,t.trigger(s?"resize":"cancel",n),i.async||i.finalize()}else(r=t.reset)==null||r.call(t)}abortResize(e=null,r=!1){const t=this,i=t.context;i.element.classList.remove(t.resizingCls),t.direction==="horizontal"?((i.edge==="left"||i.allowEdgeSwitch&&!i.skipTranslate)&&w.setTranslateX(i.element,i.elementStartX),i.element.style.width=i.elementWidth+"px"):(w.setTranslateY(i.element,i.elementStartY),i.element.style.height=i.elementHeight+"px"),!r&&t.trigger("cancel",{context:i,event:e}),t.isDestroyed||t.reset()}highlightHandle(){const e=this,r=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),r.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,r=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;r&&r.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,r){return this.overStartHandle(e,r)||this.overEndHandle(e,r)}overStartHandle(e,r){return this.direction==="horizontal"?this.overLeftHandle(e,r):this.overTopHandle(e,r)}overEndHandle(e,r){return this.direction==="horizontal"?this.overRightHandle(e,r):this.overBottomHandle(e,r)}getDynamicHandleSize(e,r){const t=e?2:1,{handleSize:i}=this;return this.dynamicHandleSize&&i*t>r-this.reservedSpace?Math.max(Math.floor((r-this.reservedSpace)/t),0):i}overLeftHandle(e,r){const t=this,{offsetWidth:i}=r;if(t.leftHandle&&t.canResize(r,e)&&(i>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=k.from(r);return n.width=t.getDynamicHandleSize(t.rightHandle,i),n.width>0&&n.contains(B.getPagePoint(e))}return!1}overRightHandle(e,r){const t=this,{offsetWidth:i}=r;if(t.rightHandle&&t.canResize(r,e)&&(i>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=k.from(r);return n.x=n.right-t.getDynamicHandleSize(t.leftHandle,i),n.width>0&&n.contains(B.getPagePoint(e))}return!1}overTopHandle(e,r){const t=this,{offsetHeight:i}=r;if(t.topHandle&&t.canResize(r,e)&&(i>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=k.from(r);return n.height=t.getDynamicHandleSize(t.bottomHandle,i),n.height>0&&n.contains(B.getPagePoint(e))}return!1}overBottomHandle(e,r){const t=this,{offsetHeight:i}=r;if(t.bottomHandle&&t.canResize(r,e)&&(i>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=k.from(r);return n.y=n.bottom-t.getDynamicHandleSize(t.bottomHandle,i),n.height>0&&n.contains(B.getPagePoint(e))}return!1}};E(Sl,"configurable",{skipUpdatingElement:null}),Sl._$name="ResizeHelper";var iE=/>[ \t\r\n]+</g,g_=/\s\s+/g,tr=class{static tpl(e,...r){let t=0,i=r.map((n,s)=>{let a=e[s];return Array.isArray(n)?a+=n.reduce((o,l)=>o+=(typeof l=="string"?l.trim():l)+`
`,""):(n===void 0&&(n=""),a+=typeof n=="string"?n.trim():n),t++,a}).join("");return t<=e.length&&(i+=e[e.length-1]),i.replace(iE,"><").replace(g_," ").trim()}static docsTpl(e,...r){let t=0,i=r.map((n,s)=>{let a=e[s];return Array.isArray(n)?a+=n.reduce((o,l)=>o+=(typeof l=="string"?l.trim():l)+`
`,""):(n===void 0&&(n=""),a+=typeof n=="string"?n.trim():n),t++,a}).join("");return t<=e.length&&(i+=e[e.length-1]),i.replace(iE,"><").trim()}static repeat(e){return function(...r){return tr.tpl(...r).repeat(e)}}static loop(e){}};tr._$name="TemplateHelper";var f_=class extends Array{constructor(e,r){super(),this.timeZone=e,this.year=r}},m_=class{constructor(e,r){this.asString=e,this.timeZone=r,this.asArray=v_(e)}get asLocalDate(){return this._asLocalDate||(this._asLocalDate=new Date(...this.asArray)),this._asLocalDate}get asTicksUtc(){return this._asTicksUtc||(this._asTicksUtc=new Date(Date.UTC(...this.asArray)).getTime()),this._asTicksUtc}},nE=(e,r)=>{const t=e.toLocaleString("sv-SE",{timeZone:r});return new m_(t,r)},p_=(e,r)=>{const{asTicksUtc:t,asString:i}=nE(new Date(e),r);return{offset:(e-t)/6e4,tzTicksUtc:t,tzString:i}},v_=e=>{const r=e.split(/[\s-:]/).map(t=>t*1);return r[1]-=1,r},y_=-6e4,b_=36e5,sE=-864e5,Dl=2592e6,aE=(e,r)=>{const t=oE.get(e,r);if(t)return t;const i=new f_(e,r),n=new Date(Date.UTC(r,0,1)).getTime();let s=n,a=Dl,o=0,l=[],c=null,d,u,h,g;for(;!g;)({offset:h,tzTicksUtc:d,tzString:u}=p_(s,e)),c==null?(c=h,i.push({offset:h})):a>0&&h!==c?a=a===Dl?sE:y_:a<0&&h===c&&(a===sE?a=b_:(i.length===1?(i.push(l),c=l.offset):(i[0].startTicks=l.startTicks,i[0].startDateString=l.startDateString,g=!0),a=Dl)),l={offset:h,startDateString:u,startTicks:d},a===Dl&&(s=n,s+=o*Dl,o+=1),s+=a,o>11&&(g=!0);return oE.set(i),i},oE={_cache:{},get(e,r){var t;return(t=this._cache[e])==null?void 0:t[r]},set(e){const{timeZone:r}=e,{_cache:t}=this;t[r]||(t[r]={}),t[r][e.year]=e}},Mt=class{static get $name(){return"TimeZoneHelper"}static toTimeZone(e,r){if(typeof r=="number")return this.toUtcOffset(e,r);const t=nE(e,r);return t.asArray[3]!==t.asLocalDate.getHours()&&console.warn("Incorrect time zone conversion due to local DST-switch detected"),t.asLocalDate}static fromTimeZone(e,r){if(typeof r=="number")return this.fromUtcOffset(e,r);const t=this.dateAsArray(e),i=aE(r,e.getUTCFullYear());let n=i[0].offset;if(i.length===2){const s=Date.UTC(...t);s>=i[1].startTicks&&s<i[0].startTicks&&(n=i[1].offset)}return t[4]+=n,new Date(Date.UTC(...t))}static toUtcOffset(e,r){const t=e.getTimezoneOffset()+r;return new Date(e.getTime()+t*60*1e3)}static fromUtcOffset(e,r){const t=-e.getTimezoneOffset()-r;return new Date(e.getTime()+t*60*1e3)}static dateAsArray(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}};Mt.findOffsetDates=aE,Mt._$name="TimeZoneHelper";var It=class extends ${static get $name(){return"Toast"}static get type(){return"toast"}static get configurable(){return{testConfig:{destroyTimeout:1,timeout:1e3},floating:!0,timeout:2500,autoDestroy:null,destroyTimeout:200,showProgress:!0,color:null,bottomMargin:20}}compose(){const{appendTo:e,color:r,html:t,showProgress:i,style:n,timeout:s}=this;return{parent:e||this.floatRoot,class:{...J.normalize(r,"object"),"b-toast-hide":1},html:t,style:n,children:{progressElement:i&&{style:`animation-duration:${s/1e3}s;`,class:{"b-toast-progress":1}}},listeners:{click:"hide"}}}doDestroy(){this.untoast(),super.doDestroy()}get nextBottom(){const{bottomMargin:e,element:r}=this;return parseInt(r.style.bottom,10)+r.offsetHeight+e}async show(){var e,r;await super.show(...arguments);const t=this,{element:i}=t,{toasts:n}=It;n.includes(t)||(i.style.bottom=((r=(e=n[0])==null?void 0:e.nextBottom)!=null?r:t.bottomMargin)+"px",n.unshift(t),i.getBoundingClientRect(),i.classList.remove("b-toast-hide"),t.timeout>0&&(t.hideTimeout=t.setTimeout("hide",t.timeout)))}async hide(){const e=this;e.untoast(),e.element.classList.add("b-toast-hide"),e.autoDestroy&&!e.destroyTimer&&(e.destroyTimer=e.setTimeout("destroy",e.destroyTimeout))}untoast(){const{toasts:e}=It;e.includes(this)&&e.splice(e.indexOf(this),1)}static hideAll(){It.toasts.slice().reverse().forEach(e=>e.hide())}static show(e){const r=It.new({autoDestroy:!0,rootElement:document.body},typeof e=="string"?{html:e}:e);return r.show(),r}};It.toasts=[],It.initClass(),It._$name="Toast";var la=class{static getById(e){return $.getById(e)}static fromElement(e,r,t){return $.fromElement(e,r,t)}static createWidget(e={}){return e.isWidget?e:$.create(e)}static append(e,r){if(e=Array.isArray(e)&&e||[e],(r instanceof HTMLElement||typeof r=="string")&&(r={appendTo:r}),r.insertFirst){const t=typeof r.insertFirst=="string"?document.getElementById(r.insertFirst):r.insertFirst;t.firstChild?r.insertBefore=t.firstChild:r.appendTo=t}return e.map(t=>$.create(T.assign({},r||{},t)))}static openPopup(e,r){return $.create(T.assign({forElement:e},typeof r=="string"?{html:r}:r),"popup")}static showContextMenu(e,r){const t=this;return t.currentContextMenu&&t.currentContextMenu.destroy(),e instanceof HTMLElement?r.forElement=e:(r.forElement=document.body,Array.isArray(e)&&(e=new Sr(...e)),e instanceof Sr&&(r.align={position:e})),r.internalListeners={destroy:t.currentContextMenu=null},t.currentContextMenu=$.create(r,"menu")}static attachTooltip(e,r){return $.attachTooltip(e,r)}static hasTooltipAttached(e){return $.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return $.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,r="Loading"){if(e)return e instanceof HTMLElement&&(e={target:e,text:r}),Bt.mask(e,e.target)}static unmask(e,r=!0){e.mask&&(r?e.mask.close():e.mask.hide())}static toast(e){return It.show(e)}};la._$name="WidgetHelper";var Tm=class{static convertFromObject(e,r={}){N.assignIf(r,{rootName:"root",elementName:"element",includeHeader:!0,rootElementForArray:!0});const{rootName:t,elementName:i,includeHeader:n,rootElementForArray:s}=r;let{xmlns:a}=r;a=a?` xmlns="${a}"`:"";const o=n?'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>':"",l=c=>{const d=[];for(const u in c){const h=c[u];if(Array.isArray(h)){s&&d.push(`<${u}>`);for(const g of h)i.length?d.push(`<${i}>`):d.push(`<${u}>`),d.push(l(g)),i.length?d.push(`</${i}>`):d.push(`</${u}>`);s&&d.push(`</${u}>`)}else N.isObject(h)?d.push(`<${u}>${l(h)}</${u}>`):h==null?d.push(`<${u}/>`):d.push(`<${u}>${O.encodeHtml(h)}</${u}>`)}return d.join("")};return`${o}<${t}${a}>${l(e)}</${t}>`}};Tm._$name="XMLHelper";var On=class{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){const{randomCache:r}=this;let t;return r[e]?t=r[e]:(t=this.random100.filter(i=>i<e),r[e]=t),t[this.rndIndex++%t.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}randomArray(e,r){const t=[],i=this.nextRandom(r+1),n={};for(let s=0,a=this.nextRandom(e.length);s<i;s++){for(;n[a];)a=this.nextRandom(e.length);n[a]=!0,t.push(e[a])}return t}};On._$name="RandomGenerator";var C_=["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.","Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.","Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.","Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.","Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui atione voluptatem sequi nesciunt.","Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.","Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur?","Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"],ca=class{static reset(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}static*generate(e,r=!1,t=1){var i;let n,s;typeof e=="object"&&(r=e.randomHeight,t=(i=e.initialId)!=null?i:1,n=e.addSkills,s=e.rowCallback,e=e.count);const a=this,{rnd:o,rndTime:l,rndRating:c,rndText:d,firstNames:u,surNames:h,teams:g,foods:f,colors:m,cities:p,skills:v}=a;for(let y=0;y<e;y++){const C=o.fromArray(u),D=o.fromArray(h),S=`${C} ${String.fromCharCode(65+y%25)} ${D}`,x=o.nextRandom(60)+1,R=new Date(2019,0,x),I=new Date(2019,0,x+o.nextRandom(30)+2),M={id:t>-1?y+t:void 0,title:"Row "+y,name:S,firstName:C,surName:D,city:o.fromArray(p),team:o.fromArray(p)+" "+o.fromArray(g),age:10+o.nextRandom(80),food:o.fromArray(f),color:o.fromArray(m),score:o.nextRandom(100)*10,rank:o.nextRandom(100)+1,start:R,finish:I,time:b.getTime(l.nextRandom(24),l.nextRandom(12)*5),percent:o.nextRandom(100),done:o.nextRandom(100)<50,rating:c.nextRandom(5),active:x>30,relatedTo:Math.min(e-1,y+t+o.nextRandom(10)),notes:C_[d.nextRandom(7)+1]};n&&(M.skills=o.randomArray(v,typeof n=="number"?n:7));const P=s==null?void 0:s(M);P&&Object.assign(M,P),r&&(M.rowHeight=o.nextRandom(r===!0?20:r)*5+20),yield M}}static generateData(e,r=!1,t=1,i=!0){let n=e;typeof e!="object"&&(n={count:e,randomHeight:r,initialId:t,reset:i}),n.reset!==!1&&this.reset(),ca.overrideRowCount&&(n.count=ca.overrideRowCount);const s=[],a=this.generate(n);for(let o=0;o<n.count;o++)s.push(a.next().value);return s}static generateEvents({viewStartDate:e,viewEndDate:r,nbrResources:t=50,nbrEvents:i=5,dependencies:n,tickUnit:s="days",minDuration:a=2,maxDuration:o=10}){const l=this.generateData(t),c=[];n=[];for(let d=0;d<t;d++)for(let u=0;u<i;u++){const h=b.getDurationInUnit(e,r,s),g=b.add(e,Math.round(Math.random()*.9*h),s),f=Math.round(Math.random()*(o-a))+a,m=b.add(g,f,"days"),p=c.length+1;c.push({id:p,name:this.tasks[(d+u)%(this.tasks.length-1)],startDate:g,duration:f,endDate:m,resourceId:d}),n&&d>0&&n.push({id:n.length+1,from:p-1,to:p})}return{resources:l,events:c,dependencies:n}}static generateOneEventPerTickAndResource({startDate:e,endDate:r,nbrResources:t=50,tickUnit:i="days"}){const n=this.generateData(t),s=[],a=b.getDurationInUnit(e,r,i);for(let o=0;o<=t;o++)for(let l=0;l<a;l++)s.push({id:s.length+1,resourceId:o,name:this.tasks[(o+l)%(this.tasks.length-1)],startDate:b.add(e,l,i),duration:1,durationUnit:i});return{resources:n,events:s}}static generateRow(){return ca.generateData(1,!1,-1,!1)[0]}};Object.assign(ca,{rnd:new On,rndTime:new On,rndRating:new On,rndText:new On,cities:["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Moscow"],firstNames:["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"],surNames:["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"],teams:["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"],foods:["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"],colors:["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"],skills:["JavaScript","CSS","TypeScript","React","Vue","Angular","Java","PHP","Python","C#","C++","BASIC","COBOL","FORTRAN","PASCAL","SQL"],tasks:["Meetings","Documentation","Email communication","Project management","Budgeting","Marketing and advertising","Customer service","Research and analysis","Data entry","IT support","Employee management","Sales and business development","Event planning","Graphic design","Writing and editing","Presentation","Travel arrangements and expense management","Training and development","Quality assurance","Customer support","Technical writing","Social media management","Translation","Legal research","Data analysis and visualization","Video editing and production","Network admin","Content creation","Market research","Public relations","Teaching and training","Recruiting","Product development"]}),ca._$name="DataGenerator";var S_=["action","target","to","deltaX","deltaY","x","y","text"],lE=class extends Le(fe()){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(e){super.construct(e);const r=this;r.widget&&(r.outerElement=r.widget.element,r.widget.playingDemo=!0),B.playingDemo=!0,Object.assign(r,{prevTarget:null,currentStep:0,mouse:w.createElement({parent:r.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),r.intervalId=r.setInterval(r.nextStep.bind(r),1e3),r.outerElement.classList.add("b-playing-demo"),r.outerElement.addEventListener("click",t=>{t.isTrusted&&r.abort()})}doDestroy(){this.abort()}abort(e=!1){const r=this;r.mouse.style.top="-100px",r.clearInterval(r.intervalId),r.timeoutId&&r.clearTimeout(r.timeoutId),r.innerIntervalId&&r.clearInterval(r.innerIntervalId),r.outerElement.classList.remove("b-playing-demo"),r.widget&&(r.widget.playingDemo=!1),B.playingDemo=!1,r.trigger(e?"done":"abort")}triggerEvent(e,r,t){if(!e)return null;let i;if(r.startsWith("mouse")){const n=this.mouse.getBoundingClientRect();i=new MouseEvent(r,Object.assign({view:globalThis,bubbles:!0,cancelable:!0,clientX:n.left,clientY:n.top},t||{}))}else i=document.createEvent("Event"),i.initEvent(r,!0,!1);return e.dispatchEvent(i),i}handleMouseMove(e,r){const t=this,i=t.mouse;i.classList.add("quick"),t.mouseDown&&i.classList.add("drag");const n=k.from(i,t.outerElement),s=n.x,a=n.y;let o=0,l=0;if(e.to)if(typeof e.to=="string"){const d=t.outerElement.querySelector(e.to);if(d){const u=k.from(d,t.outerElement),h=u.x+u.width/2,g=u.y+u.height/2;o=(h-s)/10,l=(g-a)/10}}else e.to.x?o=(e.to.x-s)/10:(o=e.to[0]/10,l=e.to[1]/10);else e.deltaX?o=e.deltaX/10:e.x&&(o=(e.x-s)/10);e.deltaY&&(l=e.deltaY/10);let c=0;t.innerIntervalId=t.setInterval(()=>{if(t.shouldPause)return;c++===9&&(clearInterval(t.innerIntervalId),e.then&&e.then());const d=s+o*c,u=a+l*c;i.style.left=d+"px",i.style.top=u+"px";const h=i.getBoundingClientRect(),g=h.left,f=h.top,m=w.elementFromPoint(g,f);m!==t.prevTarget&&(t.prevTarget&&(t.mouseOutElements.push(t.prevTarget),w.isDescendant(t.mouseOutElements[0],m)||(t.mouseOutElements.forEach(p=>t.triggerEvent(p,"mouseout")),t.mouseOutElements.length=0)),t.prevTarget=m,t.triggerEvent(m,"mouseover")),t.triggerEvent(m,e.action,{clientX:g,clientY:f})},50)}getTarget(e){const r=this,t=e.target;return t?typeof t=="function"?t(e):document.querySelector(t):r.prevTarget||r.outerElement}normalizeStep(e){if(e.action)return typeof e.action=="function"?e.action(e):e;if(typeof e=="function")return e(),e;for(const r in e)Object.hasOwnProperty.call(e,r)&&!S_.includes(r)&&(e.action=r.toLowerCase(),e.to=e[r]);return!e.target&&(typeof e.to=="string"||typeof e.to=="function")&&(e.target=e.to),e}get isScrolling(){const e=this,r=e.outerElement.getBoundingClientRect(),t=e.lastTop&&r.top!==e.lastTop;return e.lastTop=r.top,t}get isInView(){const e=this.outerElement.getBoundingClientRect();return e.top<globalThis.innerHeight&&e.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const e=this;if(e.shouldPause)return;if(e.currentStep===e.steps.length)if(e.repeat)e.currentStep=0;else return e.abort(!0);e.currentStep===0&&e.trigger("initialize");const r=e.mouse,t=e.normalizeStep(e.steps[e.currentStep++]),i=e.getTarget(t),n=t.action;if(i&&n)if(r.className="simulated-mouse",n==="mousemove")e.handleMouseMove(t,i);else{if(i!==e.prevTarget){const s=k.from(i,e.outerElement);r.style.left=s.x+s.width/2+"px",r.style.top=s.y+s.height/2+"px"}n==="mousedown"&&(e.mouseDown=!0),n==="mouseup"&&(e.mouseDown=!1),e.timeoutId=e.setTimeout(()=>{if(e.prevTarget=i,r.classList.add(n),n==="type"){const s=$.fromElement(i),a=t.text.split("|");s.value=a[a.length===1||s.value!=a[0]?0:1]}else e.triggerEvent(i,n)},n==="type"?100:550)}}};lE._$name="DemoBot";var cE=Object.prototype.hasOwnProperty,Mm=null;function D_(e,r){return Object.defineProperty(e,"parser",{value:r}),r}var w_=class{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,r){return this.formatter.defaultParse(e,r)}resolvedOptions(){return null}},eu=class{static get(e){if(e==null)return this.NULL;if(e instanceof this)return e;const r=typeof e=="string"?e:JSON.stringify(e),t=this.cache;let i=t.get(r);return i||(Mm=r,i=new this(e),t.set(r,i)),i}static get cache(){return cE.call(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return cE.call(this,"_null")?this._null:this._null=new this(null)}constructor(e){const r=this;if(r.cacheKey=Mm,Mm=null,r.initialize(),e===null)r.formatter=new w_(r);else{r.configure(e);for(const[t,i]of Object.entries(r.resolvedOptions()))i!=null&&t in r.defaults&&(r[t]=i)}}get parser(){return D_(this,new this.constructor.Parser(this))}defaultFormat(e){return e==null?e:String(e)}defaultParse(e){return e}format(e){return e==null?e:this.formatter.format(e)}parse(e,r){return e==null?e:this.parser.parse(e,r)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}};eu._$name="Formatter";var Ln=class extends F.mixin(Le,En){static get $name(){return"Navigator"}static get type(){return"navigator"}static get configurable(){return{ownerCmp:null,itemsTabbable:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,activeItem:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,scrollDuration:50,disabled:null,datasetIdProperty:"id",testConfig:{scrollDuration:1}}}static get factoryable(){return{defaultType:"navigator"}}get activeItem(){const{_activeItem:e}=this;if(this.target.contains(e))return e;this._activeItem=null}updateOwnerCmp(e){this.itemSelector||(this.itemSelector=`.${this.ownerCmp.itemCls}`),w.setAttributes(this.keyEventTarget,{"aria-activedescendant":`${this.owner.id}-active-descendant`})}set navigationEvent(e){const{owner:r}=this;this._navigationEvent=r.navigationEvent=e,e&&Promise.resolve(1).then(()=>this.navigationEvent=null)}get navigationEvent(){return this._navigationEvent}static getComposedKeyName(e){const r=(e.key||"").trim()||e.code;return`${e.ctrlKey?"CTRL+":""}${e.shiftKey?"SHIFT+":""}${e.altKey?"ALT+":""}${r}`}onKeyDown(e){var r;const t=this,{ownerCmp:i,itemSelector:n,activeItem:s,itemsTabbable:a}=t,{target:o}=e,l=t.target.querySelector(n),c=(e.key||"").trim()||e.code,d=t.constructor.getComposedKeyName(e),u=o.matches(n)||o===t.keyEventTarget;if(!t.disabled&&t.processEvent&&(e=t.processEvent.call(i,e)),e&&!t.disabled&&l&&t.target.offsetParent&&u){if(!a){if(t.inlineFlow==null){const h=l.parentNode,g=w.getStyleValue(l,"position"),f=w.getStyleValue(l,"display"),m=w.getStyleValue(l,"float");t.inlineFlow=g==="absolute"||f==="inline"||f==="inline-block"||m==="left"||m==="right"||w.getStyleValue(h,"display")==="flex"&&w.getStyleValue(h,"flex-direction")==="row"}t.prevKey||(t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown"))}if(t.navigationEvent=e,s)switch(c){case t.prevKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigatePrevious(e);break;case t.nextKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigateNext(e);break;default:{const h=(r=t.keys)==null?void 0:r[d];if(h&&!t.disabled){if(t.callback(h,t.thisObj||i,[e])===!1)return}else i.onInternalKeyDown&&i.onInternalKeyDown(e);if(w.getActiveElement(o)!==o&&e.preventDefault(),a)return}}else{if(a)return;(c===t.nextKey||c===t.prevKey)&&(t.activeItem=t.getDefaultNavigationItem(e))}t.activeItem!==s&&t.triggerNavigate(e)}}getDefaultNavigationItem(e){const{target:r,itemSelector:t,prevKey:i,nextKey:n}=this;if(r.compareDocumentPosition(e.target)&4&&e.key===i)return r.querySelector(`${t}:last-of-type`);if(r.compareDocumentPosition(e.target)&2&&e.key===n)return r.querySelector(`${t}`)}navigatePrevious(e){const r=this,t=r.previous;e.preventDefault(),t&&r.ownerCmp.scrollable.scrollIntoView(t,{animate:r.scrollDuration}).then(()=>{r.activeItem=t,r.triggerNavigate(e)})}navigateNext(e){const r=this,t=r.next;e.preventDefault(),t&&r.ownerCmp.scrollable.scrollIntoView(t,{animate:r.scrollDuration}).then(()=>{r.activeItem=t,r.triggerNavigate(e)})}get owner(){return this.ownerCmp}get previous(){return this.getAdjacent(-1)}get next(){return this.getAdjacent(1)}getAdjacent(e=1,r=this.activeItem){const t=this.treeWalker;if(t.currentNode=r,t[e<0?"previousNode":"nextNode"](),t.currentNode!==this.activeItem)return t.currentNode}onTargetFocusIn(e){var r;const t=this,{target:i,relatedTarget:n}=e,{owner:s,itemsTabbable:a,skipScrollIntoView:o,previousActiveItem:l}=t;i.matches(".b-focus-trap")||(i.matches(t.itemSelector)?(t.skipScrollIntoView=!0,t.activeItem=i,t.skipScrollIntoView=o,t.activeItem&&a&&t.triggerNavigate(e)):i===t.target&&((n?i.compareDocumentPosition(n):0)&Node.DOCUMENT_POSITION_CONTAINED_BY?(r=s.previousSibling)==null||r.focus():t.activeItem=l&&t.target.contains(l)?l:0))}onTargetFocusOut(e){const r=this,{relatedTarget:t}=e;t!=null&&t.matches(".b-focus-trap")||(!t||!r.target.contains(t)||!t.matches(r.itemSelector))&&r.activeItem&&(r.activeItem=null,r.itemsTabbable&&r.triggerNavigate(e))}onTargetMouseDown(e){const r=this,t=e.target.closest(r.itemSelector);r.navigationEvent=e,r.itemsTabbable?t===r.activeItem&&r.triggerNavigate(e):r.ownerCmp.itemsFocusable===!1?r.onFocusGesture(e):t&&(e.preventDefault(),w.focusWithoutScrolling(t))}onTargetClick(e){var r;const t=this,{skipScrollIntoView:i}=t;if(t.skipNextClick||(r=t.navigationEvent)!=null&&r.ignoreNavigation){t.skipNextClick=!1;return}t.disabled||(t.skipScrollIntoView=!0,t.processEvent&&(e=t.processEvent.call(t.ownerCmp,e)),e&&(t.activeItem=e.target.closest(t.itemSelector),t.triggerNavigate(e)),t.skipScrollIntoView=i)}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&this.ownerCmp.itemsFocusable===!1)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?w.NodeFilter.FILTER_ACCEPT:w.NodeFilter.FILTER_SKIP}changeActiveItem(e){return e!=null&&this.ownerCmp.getItem&&(e=this.ownerCmp.getItem(e)),e}updateActiveItem(e,r){var t;const i=this,{ownerCmp:n}=i,s=r&&i.target.contains(r),a=e&&w.isFocusable(e)&&e!==w.getActiveElement(e);if(s&&(i.previousActiveItem=r),r&&(r.classList.remove(i.focusCls),r.removeAttribute("id")),e!=null){if(i.skipScrollIntoView?a&&w.focusWithoutScrolling(e):(t=n.scrollable)==null||t.scrollIntoView(e,{block:"nearest",focus:a,silent:i.scrollSilently}),e===r&&s)return;e.classList.add(i.focusCls),e.id=`${i.owner.id}-active-descendant`,i._activeItem=e}else i._activeItem=null,r===w.getActiveElement(r)&&n.revertFocus()}updateTarget(e,r){const t=this,i={element:e,thisObj:t,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",mousedown:{handler:"onTargetMouseDown",delegate:t.itemSelector}};!t.itemsTabbable&&!t.itemsFocusable&&(i.click="onTargetClick"),Object.prototype.hasOwnProperty.call(t,"acceptNode")||(t.acceptNode=t.acceptNode.bind(t),t.acceptNode.acceptNode=t.acceptNode),B.on(i),t.treeWalker=t.setupTreeWalker(e,w.NodeFilter.SHOW_ELEMENT,t.acceptNode),t.keyEventTarget||(t.keyEventTarget=e),(t.targetMutationMonitor=new MutationObserver(t.onTargetChildListChange.bind(t))).observe(e,{childList:!0,subtree:!0})}setupTreeWalker(e,r,t){return document.createTreeWalker(e,r,t)}onTargetChildListChange(){var e;const r=this,{activeItem:t,datasetIdProperty:i}=r;t&&(r.target.contains(t)?t.classList.contains(r.focusCls)||t.classList.add(r.focusCls):r.activeItem=r.target.querySelector(`${r.itemSelector}.${r.focusCls}[data-${O.hyphenate(i)}="${t.dataset[i]}"]`)||((e=r.target.querySelector(`${r.itemSelector}.${r.focusCls}`))==null?void 0:e[t.dataset.index])||null)}changeKeyEventTarget(e){this._keyEventTarget=e,B.on({element:e,keydown:"onKeyDown",thisObj:this})}triggerNavigate(e,r=this.activeItem){var t;const i={event:e,item:r,oldItem:this.previousActiveItem};this.trigger("navigate",i),(t=this.ownerCmp)==null||t.trigger("navigate",i)}};Ln._$name="Navigator";var tu=O.escapeRegExp,dE=/[\d+-]/g,ru=(e,r)=>new Intl.NumberFormat(e||void 0,r),E_=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/,x_="\u2212",R_=class{constructor(e){const r=this,t=e.locale,i=ru(t,{maximumFractionDigits:3}),n=e.is.currency?r._decodeStyle(t,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,s=e.is.percent?r._decodeStyle(t,{style:"percent"}):null,a=i.format(1.2).replace(dE,"")[0],o=i.format(1e9).replace(dE,"")[0]||"";Object.assign(r,{currency:n,decimal:a,formatter:e,grouper:o,percent:s}),r.decimal=a,r.decimalRe=tu(a,"g"),r.grouper=o,r.stripRe=new RegExp(`(?:\\s+|${tu(o)})`+(n?`|(?:${tu(n.text)})`:"")+(s?`|(?:${tu(s.text)})`:""),"g")}decimalPlaces(e){e=e.replace(this.stripRe,"");const r=e.indexOf(this.decimal)+1;return r&&e.length-r}parse(e,r){return typeof e=="string"&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,".").replace(x_,"-"),e=r?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,r){const t=ru(e,r),i=ru(e,Object.assign(t.resolvedOptions(),{style:"decimal"})),n=t.format(0),s=i.format(0);return{suffix:n.startsWith(s),text:n.replace(s,"").trim()}}},Rr=class extends eu{static get $name(){return"NumberFormat"}initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits;return e==null?null:this.as({style:"decimal",maximumFractionDigits:Math.min(20,e+1)},"truncator")}configure(e){const r=this;typeof e!="string"?Object.assign(r,e):r.template=e;const t={},i=r.locale?ze.locales[r.locale]:ze.locale,n=i&&i.NumberFormat,s=r.template;if(n)for(const a in n)r[a]==null&&typeof n[a]!="function"&&(r[a]=n[a]);if(s){const a=E_.exec(s),o=a[2],l=a[4];r.useGrouping=!!a[3],r.style=a[1]?"currency":a[6]?"percent":"decimal",o&&(r.integer=+o),l==="*"?r.fraction=[0,20]:l!=null&&(r.fraction=[a[5].length,l.length])}r._minMax("fraction",!0,!0),r._minMax("integer",!0,!1),r._minMax("significant",!1,!0);for(const a in r.defaults)r[a]!=null&&(t[a]=r[a]);r.is.from=r.from&&r.from.is,r.is[r.style]=!(r.is.null=!1),r.formatter=ru(r.locale,t)}as(e,r=null){const t=this.resolvedOptions()||{template:"9.*"},i=this._as;let n=r&&i[r];return n||(typeof e=="string"?t.style=e:Object.assign(t,e),t.from=this,n=new Rr(t)),r&&(i[r]=n),n}defaultParse(e,r){return e==null?e:r?Number(e):parseFloat(e)}format(e){if(typeof e=="string"){const r=Number(e);e=isNaN(r)?this.parse(e):r}return super.format(e)}round(e){return this.parse(this.format(e))}truncate(e){const r=this,t=r.maximumFractionDigits,{truncator:i}=r;let n=r.parse(e),s;return i&&(n=i.format(n),s=n.indexOf(i.parser.decimal),s>-1&&n.length-s-1>t&&(n=n.substr(0,s+t+1)),n=i.parse(n)),n}resolvedOptions(){const e=super.resolvedOptions();for(const r in e)e[r]===void 0&&(e[r]=this[r]);return e}_minMax(e,r,t){const i=this,n=i[e];if(n!=null){const s=O.capitalize(e),a=`maximum${s}Digits`,o=`minimum${s}Digits`;typeof n=="number"?(r&&(i[o]=n),t&&(i[a]=n)):(i[o]=n[0],i[a]=n[1])}}};Rr.Parser=R_,Object.assign(Rr.prototype,{defaults:{style:"decimal",currency:null,currencyDisplay:"symbol",locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,useGrouping:!0},fraction:null,from:null,integer:null,significant:null,template:null}),Object.assign(Rr.prototype,Rr.prototype.defaults),eu.number=(e,r)=>Rr.format(e,r),Rr._$name="NumberFormat";var wl=class extends Le(F){construct(e={}){const r=this;super.construct(e),r.onWsOpen=r.onWsOpen.bind(r),r.onWsClose=r.onWsClose.bind(r),r.onWsMessage=r.onWsMessage.bind(r),r.onWsError=r.onWsError.bind(r),r.autoConnect&&r.address&&r.open()}doDestroy(){const e=this;e.connector&&(e.detachSocketListeners(e.connector),e.connector.close(),e.connector=null),super.doDestroy()}get isConnecting(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.CONNECTING}get isOpened(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.OPEN}get isClosing(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSING}get isClosed(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSED}createWebSocketConnector(){const e=this.connector=new this.constructor.webSocketImplementation(this.address);this.attachSocketListeners(e)}destroyWebSocketConnector(){this.detachSocketListeners(this.connector),this.connector.close(),this.connector=null}attachSocketListeners(e){const r=this;e.addEventListener("open",r.onWsOpen),e.addEventListener("close",r.onWsClose),e.addEventListener("message",r.onWsMessage),e.addEventListener("error",r.onWsError)}detachSocketListeners(e){const r=this;e.removeEventListener("open",r.onWsOpen),e.removeEventListener("close",r.onWsClose),e.removeEventListener("message",r.onWsMessage),e.removeEventListener("error",r.onWsError)}async open(){const e=this;if(e._openPromise)return e._openPromise;if(!e.address){console.warn("Server me.address cannot be empty");return}if(e.isOpened)return!0;e.createWebSocketConnector();let r;return e._openPromise=new Promise(t=>{r=e.ion({open(){t(!0)},error(){t(!1)}})}).then(t=>(r(),e._openPromise=null,t||e.destroyWebSocketConnector(),t)).catch(()=>{e._openPromise=null,e.destroyWebSocketConnector()}),e._openPromise}close(){this.connector&&(this.destroyWebSocketConnector(),this.trigger("close"))}send(e,r={}){var t;(t=this.connector)==null||t.send(JSON.stringify({command:e,...r}))}onWsOpen(e){this.trigger("open",{event:e})}onWsClose(e){this.trigger("close",{event:e})}onWsMessage(e){try{const r=JSON.parse(e.data);this.trigger("message",{data:r})}catch(r){this.trigger("error",{error:r})}}onWsError(e){this.trigger("error",{error:e})}};E(wl,"webSocketImplementation",typeof WebSocket=="undefined"?null:WebSocket),E(wl,"configurable",{address:"",userName:"User",autoConnect:!0}),wl._$name="WebSocketManager";var T_=class extends F.mixin(Le){constructor(){super(...arguments),E(this,"hasNativeAccess",!0),E(this,"_content",null)}async writeText(e,r){const t=this,{_content:i}=t;if(r&&t.hasNativeAccess)try{await navigator.clipboard.writeText(e)}catch(n){t.hasNativeAccess=!1}i!==e&&(t._content=e,t.triggerContentChange(i,!1,!0))}async readText(e){const r=this,{_content:t}=r;if(e&&r.hasNativeAccess)try{const i=await navigator.clipboard.readText();return t!==i&&(r._content=i,r.triggerContentChange(t,!0)),i}catch(i){r.hasNativeAccess=!1}return t}triggerPaste(e){this.trigger("paste",{source:e,text:this._content})}triggerContentChange(e,r=!1,t=!1){this.trigger("contentChange",{fromRead:r,fromWrite:t,oldText:e,newText:this._content})}async clear(e){await this.writeText("",e)}},uE=e=>{var r;return r=class extends(e||F){construct(...t){super.construct(...t),globalThis.bryntum.clipboard||(globalThis.bryntum.clipboard=new T_),globalThis.bryntum.clipboard.ion({paste:"onClipboardPaste",contentChange:"onClipboardContentChange",thisObj:this})}get clipboard(){return globalThis.bryntum.clipboard}onClipboardPaste({text:t,source:i}){var n;const s=this,{clipboardText:a,isCut:o}=s,l=s.compareClipboardText(a,t);l&&o?((n=s.handleCutData)==null||n.call(s,{text:t,source:i}),s.isCut=!1,s.cutData=null):l||s.clearClipboard(!1)}onClipboardContentChange({newText:t}){this.compareClipboardText(this.clipboardText,t)||this.clearClipboard(!1)}set cutData(t){var i,n;const s=this;(i=s._cutData)==null||i.forEach(a=>s.setIsCut(a,!1)),s._cutData=H.asArray(t),(n=s._cutData)==null||n.forEach(a=>s.setIsCut(a,!0))}get cutData(){return this._cutData}setIsCut(){}async writeToClipboard(t,i,n={}){if(await this.beforeCopy({data:t,isCut:i,...n})===!1)return;const s=this,a=typeof t=="string",o=a?t:s.stringConverter?s.stringConverter(t):O.safeJsonStringify(t);return s.clipboardText=o,await s.clipboard.writeText(o,s.useNativeClipboard),s.clipboardData=t,s.isCut=i,s.cutData=i&&!a?t:null,o}async readFromClipboard(t={},i=!1){var n;const s=this,{clipboard:a}=s,o=await a.readText(s.useNativeClipboard),{isOwn:l,data:c}=s.transformClipboardText(o),d=o&&l&&s.isCut;if(!(c==null||Array.isArray(c)&&c.length==0||await((n=s.beforePaste)==null?void 0:n.call(s,{data:c,text:o,...t,isCut:d}))===!1))return l||s.clearClipboard(!1),i||a.triggerPaste(s),c}async clearClipboard(t=!0){const i=this;i.clipboardData=i.clipboardText=i.cutData=null,i.isCut=!1,t&&await i.clipboard.clear(i.useNativeClipboard)}compareClipboardText(t,i){const n=/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/g;return(t==null?void 0:t.replace(n,`
`))===(i==null?void 0:i.replace(n,`
`))}transformClipboardText(t){const i=this,n=i.compareClipboardText(i.clipboardText,t),s=n?i.clipboardData:i.stringParser&&t?i.stringParser(t):t;return{isOwn:n,data:s}}hasClipboardData(){const{clipboard:t}=this,{_content:i}=t;if(!(this.useNativeClipboard&&t.hasNativeAccess))return!!(i&&this.transformClipboardText(i).data)}},E(r,"$name","Clipboardable"),E(r,"configurable",{useNativeClipboard:!1}),r},hE=e=>class extends(e||F){static get $name(){return"Finalizable"}construct(...t){super.construct(...t),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}doFinalize(){this.destroy()}finalize(){const t=this;let i=t.finalizing;return!i&&!t.isFinalized&&(t.isFinalizing=!0,t.finalizing=i=t._awaitFinalizer()),i}async _awaitFinalizer(){const t=this;try{await t.finalizer}finally{t.finalizing=null,t.isFinalized=!0,t.doFinalize()}}},Im=Symbol("dragAbort"),iu=Symbol("dragInit"),gE=Symbol("dragDrag"),Pm=Symbol("dragDrop"),M_={x:"horizontal",y:"vertical"},da=class extends F.mixin(hE,fe,ea){static get configurable(){return{itemElement:null,scrollManager:null,monitoringConfig:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300}}static get identifiable(){return{}}construct(...e){super.construct(...e);const r=this,{event:t}=r;Object.assign(r,{altKey:null,cleaners:[],ctrlKey:null,data:new Map,element:t.target,endEvent:null,lastMoveEvent:null,metaKey:null,previousTarget:null,scrollerAction:null,shiftKey:null,state:iu,startEvent:t,touchStartTimer:null,_valid:!0}),"touches"in t&&r.touchStartDelay&&(r.touchStartTimer=r.setTimeout(()=>r.touchStartTimer=null,r.touchStartDelay,"touchStartDelay")),B.on({element:globalThis,blur:"onWindowBlur",thisObj:r})}doDestroy(){const e=this,{source:r,target:t}=e;e.cleanup(),(t==null?void 0:t.dropping)===e&&(t.dropping=null),(r==null?void 0:r.dragging)===e&&(r.dragging=null),super.doDestroy()}onWindowBlur(){this.started&&this.abort()}get aborted(){return this.state===Im}get completed(){return this.isDestroying||this.aborted||this.endEvent!==null}get pending(){return this.state===iu}get started(){return this.state!==iu&&!this.aborted}get valid(){return this.started&&this.targetElement!=null&&this._valid}set valid(e){this._valid=e}async get(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(!this.completed)throw new Error("Data is not available until drag completion");if(Array.isArray(e))return Promise.all(e.map(t=>this.get(t)));let r=this.data.get(e);return typeof r=="function"&&(r=await r(),this.data.set(e,r)),r}has(e){return this.data.has(e)}peek(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(e))return e.map(t=>this.peek(t));let r=this.data.get(e);return typeof r=="function"&&(r=!0),r}set(e,r){this.data.set(e,r)}changeTarget(e,r){if(e!==r){const t=this;t._target=e,t.previousTarget=r,r&&(r.dropping=null),e&&(e.dropping=t,e.dropping!==t&&(e=null,t.valid=!1)),t._target=r}return e}updateTarget(e,r){const t=this;r&&t.source.dragLeaveTarget(t,r),e&&(t.valid=!0,e.dragMove(t),t.source.dragEnterTarget(t))}updateTargetElement(e){let r,t,i,n,s;for(s=e;s;s=s.parentElement)if(t=Ge.get(s,"droppables"),t){for(n=0;n<t.length;++n)if(r=t[n],r.dropRootElement.contains(e)&&(i=r.droppableSelector,(!i||e.closest(`#${w.getId(r.dropRootElement)} ${i}`))&&(this.target=r,this.target===r)))return}}abort(){const e=this,{element:r,source:t}=e;r==null||r.getBoundingClientRect(),e.state!==Pm&&(e.state=Im,e.cleanup()),t==null||t.endDrag(e)}begin(){const e=this,{source:r}=e,t=r.beforeDrag(e);return t!==!1&&(r.dragging=e),t}cleanup(){let e;for(;e=this.cleaners.pop();)e()}end(e){const r=this,{lastMoveEvent:t,target:i}=r,{dragSwallowClickTime:n}=r.source;r.event=r.endEvent=e,r.syncFlags(),r.started&&(((t==null?void 0:t.clientX)!==e.clientX||(t==null?void 0:t.clientY)!==e.clientY||(t==null?void 0:t.target)!==e.target)&&r.track(),n&&B.on({element:document,capture:!0,expires:n,once:!0,click(s){s.stopPropagation()}}),r.state=Pm,i!==r.source&&(i==null||i.dragDrop(r)))}fakeKey(e,r){const t=this,{lastMoveEvent:i}=t;if(i&&t.element){let n;i.isKey=!0,e.key==="Alt"?t.altKey!==r&&(t.altKey=r,n=!0):e.key==="Control"&&t.ctrlKey!==r&&(t.ctrlKey=r,n=!0),n&&(t.event=i,t.track())}}keyDown(e){this.completed||(e.key==="Escape"?this.abort():this.isDragToggleKey(e.key)&&this.fakeKey(e,!0))}keyUp(e){!this.completed&&this.isDragToggleKey(e.key)&&this.fakeKey(e,!1)}getDistance(e){return B.getDistanceBetween(this.startEvent,e)}isDragToggleKey(e){return e==="Control"||e==="Alt"}move(e){const r=this,{target:t}=e,i=r.getDistance(e),n=i>=r.threshold;if(r.syncFlags(),r.touchStartTimer){n&&r.abort();return}if(t&&t.nodeType===Node.ELEMENT_NODE){if(n&&!r.started&&(r.event=e,r.start()===!1)){r.abort();return}r.started&&!r.completed&&(r.lastMoveEvent=r.event=e,e.type==="touchmove"&&(e.preventDefault(),e.stopImmediatePropagation()),r.track())}}start(){const e=this,{scrollManager:r,monitoringConfig:t,source:i}=e,{draggingBodyCls:n,dragLock:s}=i,a=i.dragRootElement;if(e.state=gE,r){const l=r.startMonitoring(N.merge({scrollables:[{element:a}],direction:M_[s]||s||"both",callback(c){const{lastMoveEvent:d}=e;d&&e.element&&(d.isScroll=!0,e.event=d,e.scrollerAction=c,e.track(),e.scrollerAction=null)}},t));e.cleaners.push(l)}const o=i.dragRootElement.closest(".b-outer")||document.body;if(o.classList.add(n),e.cleaners.push(()=>o.classList.remove(n)),i.startDrag(e)===!1)return e.cleanup(),!1}syncFlags(){const e=this,{event:r}=e;e.altKey=r.altKey,e.ctrlKey=r.ctrlKey||r.metaKey,e.metaKey=r.metaKey,e.shiftKey=r.shiftKey}track(){const e=this,{event:r,source:t,target:i}=e;let n=r.target,s;r.type==="touchmove"&&(s=r.changedTouches[0],n=w.elementFromPoint(s.clientX,s.clientY)),e.targetElement=n,i===e.target&&(i==null||i.dragMove(e)),t.trackDrag(e)}};E(da,"$name","DragContext"),da.prototype.STATE=da.STATE=Object.freeze({ABORTED:Im,INIT:iu,DRAGGING:gE,DROPPED:Pm}),da._$name="DragContext";var ua=class extends F.mixin(En){static get type(){return"default"}static get configurable(){return{dragging:null}}static get factoryable(){return{defaultType:ua}}updateDragging(e,r){r&&this.close(r),e&&this.open(e)}close(e){}open(e){}dragStart(e){this.dragging=e}dragMove(e){}dragEnd(e){this.dragging=null}};ua.initClass(),ua._$name="DragProxy";var nu=e=>class extends(e||F){static get $name(){return"Draggable"}static get configurable(){return{dragging:{$config:"nullify",value:null},draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragItemOverCls:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,ignoreSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,overItem:null,testConfig:{dragSwallowClickTime:50}}}static get properties(){return{draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started",draggableCls:"b-draggable"}}beforeDrag(t){const{dragRootElement:i,dragSelector:n,ignoreSelector:s}=this,a=n&&t.element.closest(n);return!n||!!(a&&a===i||i.contains(a)&&(!s||!t.element.matches(s)))}dragStart(t){}dragOver(t){}dragEnterTarget(t){}dragLeaveTarget(t,i){}dragDrop(t){}dragEnd(t){}get activeDrag(){const{dragging:t}=this;return t!=null&&t.started&&!t.completed?t:null}get dragEventer(){return this.trigger?this:null}get draggingClassElement(){const{draggingClsSelector:t,dragRootElement:i}=this;return t?i==null?void 0:i.closest(t):i}beginDrag(t){const{draggingCls:i,draggingClassElement:n}=this;i&&n&&(n.classList.add(i),t.cleaners.push(()=>n.classList.remove(i)))}async endDrag(t){const i=this,{dragEventer:n,dragProxy:s}=i;t.valid&&await i.dragDrop(t),!i.isDestroyed&&(t.pending?t.destroy():(i.dragEnd(t),s==null||s.dragEnd(t),n==null||n.trigger(t.valid?"drop":"dragCancel",{drag:t,event:t.event}),i.finalizeDrag(t)))}async finalizeDrag(t){var i;await((i=t.finalize)==null?void 0:i.call(t))}moveDrag(t){if(this.dragOver(t)!==!1){const{dragEventer:i,dragProxy:n}=this;n==null||n.dragMove(t),i==null||i.trigger("drag",{drag:t,event:t.event})}}setupDragContext(t){const i=this,{dragItemSelector:n,id:s}=i,{target:a}=t;return{event:t,id:s?`${s}-drag-${i._nextDragId=(i._nextDragId||0)+1}`:null,itemElement:n?a.closest(n):a,touchStartDelay:i.dragTouchStartDelay,source:i,threshold:i.dragThreshold}}startDrag(t){const{draggingStartedCls:i,draggingClassElement:n,draggingItemCls:s,dragEventer:a,dragProxy:o}=this,{itemElement:l}=t;if((a==null?void 0:a.trigger("beforeDragStart",{drag:t,event:t.event}))===!1)return!1;i&&n&&(n.classList.add(i),t.cleaners.push(()=>n.classList.remove(i))),s&&l&&(l.classList.add(s),t.cleaners.push(()=>l.classList.remove(s))),o==null||o.dragStart(t);const c=this.dragStart(t);return c!==!1&&(a==null||a.trigger("dragStart",{drag:t,event:t.event})),c}trackDrag(t){var i;const{dropTargetSelector:n}=this;t.valid=!(n&&!((i=t.targetElement)!=null&&i.closest(n))),this.moveDrag(t)}configureListeners(t){const i=this,n=T.assign({thisObj:i},i.dragDocumentListeners);return"touches"in t.startEvent?(delete n.mousemove,delete n.mouseup):(delete n.contextmenu,delete n.touchmove,delete n.touchend,delete n.pointerup),n}updateDragging(t,i){const n=this;if(t){const s=n.configureListeners(t);t.cleaners.push(B.on(s)),n.beginDrag(t)}else i&&i.destroy()}changeDragProxy(t,i){return ua.reconfigure(i,t,{owner:this,defaults:{owner:this}})}updateDragRootElement(t,i){var n;const s=this,{draggableCls:a,dragItemSelector:o,onDragItemMouseMove:l}=s;if(i==null||i.classList.remove(a),(n=s._dragRootDetacher)==null||n.call(s),t){const c={thisObj:s,element:t,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart",pointerdown:d=>{var u,h;return d.pointerId&&((h=(u=d.target).releasePointerCapture)==null?void 0:h.call(u,d.pointerId))}};l&&(c.mousemove={delegate:o,handler:"onDragItemMouseMove"}),(s.dragItemOverCls||l||s.onDragItemMouseEnter||s.onDragItemMouseLeave)&&Object.assign(c,{mouseover:{delegate:o,handler:"onDragItemMouseOver"},mouseout:{delegate:o,handler:"onDragItemMouseOut"}}),t.classList.add(a),s._dragRootDetacher=B.on(c)}}onDragItemMouseOver(t){this.overItem=t}onDragItemMouseOut(t){this.dragging||(this.overItem=t)}changeOverItem(t){var i;return this.enterLeaveEvent=t,t.type==="mouseout"?((i=t.relatedTarget)==null?void 0:i.closest(this.dragItemSelector))||null:t.target.closest(this.dragItemSelector)}updateOverItem(t,i){var n,s;const a=this,{dragItemOverCls:o}=a;i&&(o&&i.classList.remove(o),(n=a.onDragItemMouseLeave)==null||n.call(a,a.enterLeaveEvent,i)),t&&(o&&t.classList.add(o),(s=a.onDragItemMouseEnter)==null||s.call(a,a.enterLeaveEvent,t))}onDragContextMenu(t){t.preventDefault()}onDragKeyDown(t){this.dragging.keyDown(t)}onDragKeyUp(t){this.dragging.keyUp(t)}onDragMouseDown(t){t.button===0&&this.onDragPointerDown(t)}onDragPointerDown(t){let{dragging:i}=this;i?i.isFinalizing||i.abort():(i=this.setupDragContext(t),i&&(i=new da(i),i.begin()===!1&&i.destroy()))}changeDragging(t,i){return i==null||i.destroy(),t}onDragPointerMove(t){const{dragging:i}=this;i&&!i.completed&&(i==null||i.move(t))}onDragPointerUp(t){const{dragging:i}=this;i&&!i.completed&&(i.end(t),this.endDrag(i))}onDragTouchStart(t){t.touches.length===1&&this.onDragPointerDown(t)}},fE=e=>class extends(e||F){static get $name(){return"Droppable"}static get configurable(){return{droppableSelector:null,dropping:null,dropRootElement:{$config:"nullify",value:null}}}get dropEventer(){return this.trigger?this:null}get droppableCls(){return"b-droppable"}dragEnter(t){var i;return(i=this.dropEventer)==null?void 0:i.trigger("dragEnter",{drag:t,event:t.event})}dragMove(t){var i;return(i=this.dropEventer)==null?void 0:i.trigger("dragMove",{drag:t,event:t.event})}dragDrop(t){var i;return(i=this.dropEventer)==null?void 0:i.trigger("drop",{drag:t,event:t.event})}dragLeave(t){var i;return(i=this.dropEventer)==null?void 0:i.trigger("dragLeave",{drag:t,event:t.event})}changeDropping(t,i){if(t!==i){const n=this;i&&(i.aborted||!i.completed)&&n.dragLeave(i),t&&(n._dropping=t,n.dragEnter(t)===!1&&(t=null),n._dropping=i)}return t}updateDropRootElement(t,i){const n=this,{droppableCls:s}=n;let a,o,l;i&&(a=Ge.get(i,"droppables"),l=!0,Array.isArray(a)&&(o=a.indexOf(n))>-1&&(a.length<2?Ge.remove(i,"droppables"):(a.splice(o,1),a.forEach(c=>{s===c.droppableCls&&(l=!1)}))),l&&i.classList.remove(s)),t&&(a=Ge.get(t,"droppables"),a?a.push(n):Ge.set(t,"droppables",[n]),t.classList.add(s))}},I_=e=>class extends(e||F){static get $name(){return"Featureable"}static get configurable(){return{features:null}}static get declarable(){return["featureable"]}static setupFeatureable(t){const i={ownerName:"client",...t.featureable};i.factory.initClass(),Reflect.defineProperty(t,"featureable",{get(){return i}})}doDestroy(){var t;const i=this.features;super.doDestroy();for(const n in i){const s=i[n];(t=s.destroy)==null||t.call(s)}}hasFeature(t){var i;return!!((i=this.features)!=null&&i[t])}changeFeatures(t,i){if(this.isDestroying)return;const n=this,{featureable:s}=n.constructor,a=n.$features||(n.$features=new An({configName:"features",factory:s.factory,owner:n,ownerName:s.ownerName}));if(a.update(t),!i)return a.target}get widgetClass(){}getCurrentConfig(t){const i=super.getCurrentConfig(t),{features:n}=i;if(n)for(const s in n)Object.keys(n[s]).length===0&&(n[s]=!0);return i}},Be={e:"b-hover-edge",t:"b-hover-top",r:"b-hover-right",b:"b-hover-bottom",l:"b-hover-left"},P_={[Be.e]:1,[Be.t]:1,[Be.r]:1,[Be.b]:1,[Be.l]:1},A_={t:[Be.e,Be.t],r:[Be.e,Be.r],b:[Be.e,Be.b],l:[Be.e,Be.l],tr:[Be.e,Be.t,Be.r],bl:[Be.e,Be.b,Be.l],tl:[Be.e,Be.t,Be.l],br:[Be.e,Be.b,Be.r]},__=e=>class extends e.mixin(fe){static get $name(){return"Hoverable"}static get configurable(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}static get delayable(){return{setHoverTarget:0}}hoverEnter(t){}hoverIgnore(t){var i;return(i=this.hoverIgnoreElement)==null?void 0:i.contains(t)}hoverLeave(t){}hoverMove(t){}onHoverMouseMove(t){const i=this,{hoverEdges:n,hoverEdgeSize:s,hoverTarget:a}=i;if(a){if(n){const{top:o,left:l,width:c,height:d,right:u,bottom:h}=a.getBoundingClientRect(),{clientX:g,clientY:f}=t,m=l+c/2,p=o+d/2,v=f<(s?o+s:p),y=g>=(s?u-s:m),C=f>=(s?h-s:p),D=g<(s?l+s:m),S=v||C?v?"t":"b":"",x=y||D?y?"r":"l":"";i.hoverZone=(n.includes(S)?S:"")+(n.includes(x)?x:"")}i.hoverEvent=t,i.hoverTrack&&i.hoverMove(t)}}onHoverMouseOver(t){this.hoverEvent=t,this.hoverElement=t.target}onHoverMouseOut(t){this.hoverEvent=t,this.hoverElement=t.relatedTarget}updateHoverDelay(t){this.setHoverTarget.delay=t}changeHoverEdges(t){return t===!0?"trbl":(t||"").replace("v","tb").replace("h","lr")}updateHoverEdges(){this.syncHoverListeners()}changeHoverElement(t){if(!this.hoverIgnore(t))return t}updateHoverElement(t){const{hoverSelector:i}=this;i&&(t=t==null?void 0:t.closest(i)),this.setHoverTarget(t)}updateHoverRootElement(t,i){const{hoverRootCls:n}=this;n&&(i==null||i.classList.remove(n),t==null||t.classList.add(n)),this.syncHoverListeners()}changeHoverTarget(t,i){return i&&(this.hoverZone=null),t}updateHoverTarget(t,i){const n=this,{hoverCls:s,hoverAnimationCls:a,hoverRootActiveCls:o,hoverRootElement:l}=n;o&&(l==null||l.classList[t?"add":"remove"](o)),i&&(s&&i.classList.remove(s),a&&i.classList.remove(a),n.hoverLeave(i)),t&&(s&&t.classList.add(s),n.hoverEnter(i),n.hoverTrack&&n.hoverMove(n.hoverEvent),a&&(t.getBoundingClientRect(),t.classList.add(a)))}updateHoverTrack(){this.syncHoverListeners()}updateHoverZone(t){const{hoverAnimationCls:i,hoverTarget:n}=this;if(n){const{className:s}=n,a=J.change(s,t?A_[t]:null,P_);s!==a&&(n.className=a,t&&i&&(n.classList.remove(i),n.getBoundingClientRect(),n.classList.add(i)))}}setHoverTarget(t){this.hoverTarget=t}syncHoverListeners(){var t;const i=this,n=i.hoverRootElement,s={element:n,thisObj:i,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(i.hoverTrack||i.hoverEdges)&&(s.mousemove="onHoverMouseMove"),(t=i._hoverRootDetacher)==null||t.call(i),i._hoverRootDetacher=n&&B.on(s)}},Am=e=>{var r;return r=class extends e{static get configurable(){return{loadMaskDefaults:{useTransition:!0,showDelay:1e3},loadMaskError:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},loadMask:{text:"L{GridBase.loadMask}"},syncMask:{text:"L{GridBase.syncMask}"},localizableProperties:["loadMask.text","syncMask.text"],testConfig:{loadMaskError:{icon:"b-icon b-icon-warning",autoClose:500,showDelay:0}}}}applyLoadMask(){const t=this,{loadMask:i}=t;return i&&(t.masked=Bt.mergeConfigs(t.loadMaskDefaults,i)),t.masked}applyMaskError(t){const{loadMaskError:i,masked:n}=this;return i===!1?n.hide():n&&(T.assign(n.errorDefaults,i),n.error=t),n}get widgetClass(){}},E(r,"$name","LoadMaskable"),r},k_={constructor:1,prototype:1,name:1,length:1,arguments:1,caller:1,callee:1,__proto__:1},mE=class{static apply(e){if(!e.target)throw new Error("Override must specify what it overrides, using static getter target");if(!e.target.class)throw new Error("Override must specify which class it overrides, using target.class");if(!this.shouldApplyOverride(e))return!1;const r=Object.getOwnPropertyNames(e),t=Object.getOwnPropertyNames(e.prototype);return r.splice(r.indexOf("target"),1),this.internalOverrideAll(e.target.class,r,e),this.internalOverrideAll(e.target.class.prototype,t,e.prototype),!0}static internalOverrideAll(e,r,t){Reflect.ownKeys(t).forEach(i=>{if(r.includes(i)&&!k_[i]){const n=Object.getOwnPropertyDescriptor(t,i);let s=e,a=null;for(;!a&&s;)a=Object.getOwnPropertyDescriptor(s,i),a||(s=Object.getPrototypeOf(s));a&&this.internalOverride(s,i,n,a)}})}static internalOverride(e,r,t,i){const n=e._overridden=e._overridden||{};n[r]=e[r],i.get?Object.defineProperty(e,r,{enumerable:!1,configurable:!0,get:t.get}):e[r]=t.value}static shouldApplyOverride(e){const r=e.target;if(!r.maxVersion&&!r.minVersion)return!0;if(!r.product)throw new Error("Override must specify product when using versioning");return!(r.maxVersion&&ne[r.product].isNewerThan(r.maxVersion)||r.minVersion&&ne[r.product].isOlderThan(r.minVersion))}};mE._$name="Override";var{defineProperty:pE}=Object,{hasOwn:F_}=T,_m=Symbol("fencible"),O_=[],vE=e=>Array.from(new Set(e)),km=e=>e?vE(O.split(e)):O_,L_=(e,r,t)=>{t===!0&&(t=r),T.isObject(t)||(t={all:t});let i=km(t.any);const n=km(t.all),s=t.lock?km(t.lock):vE(n.concat(i)),a=r+"Impl",o=function(...l){const c=this,d=F_(c,_m)?c[_m]:c[_m]={},u=h=>!d[h];if(n.every(u)&&(!i||i.some(u)))try{return s.forEach(h=>d[h]=(d[h]||0)+1),c[a](...l)}finally{s.forEach(h=>--d[h])}};i=i.length?i:null,!e[a]&&pE(e,a,{configurable:!0,value:e[r]}),pE(e,r,{configurable:!0,value:o})},yE=e=>{var r;return r=class extends(e||F){static setupFenced(t){let{fenced:i}=t;const n=i.static,s=[];n&&(i={...i},delete i.static,s.push([n,t])),s.push([i,t.prototype]);for(const[a,o]of s)for(const l in a)L_(o,l,a[l])}get widgetClass(){}},E(r,"$name","Fencible"),E(r,"declarable",["fenced"]),r},su=60*1e3,$n=60*su,ni=24*$n,$_=/(\d+)?:?(\d*)/,gt=class{static format(e){const r=Math.floor(e/$n),t=Math.floor(e/su)%60;return`${r}:${t<10?"0":""}${t}`}static parse(e){const r=typeof e;if(r==="string"){const t=$_.exec(e);e=Number(t[1]||0)*$n+Number(t[2]||0)*su}else r!=="number"?e=b.getTimeOfDay(e):e<=24&&(e*=$n);return Math.min(Math.max(Math.floor(e),0),ni)}constructor(e){let r=0,t,i;e!=null&&e.isDayView?(r=e.dayStartShift,t=e.dayStartTime,i=e.dayEndTime):typeof e=="number"?r=t=i=e:e&&(r=e.startShift,t=e.timeStart,i=e.timeEnd),this.startShift=r=gt.parse(r||0),this.timeEnd=(i==null?(r+ni)%ni:gt.parse(i))||ni,this.timeStart=t==null?r:gt.parse(t)}get startHour(){return Math.floor(this.timeStart/$n)}get endHour(){return Math.floor(this.timeEnd/$n)}get startTimeOffsetMs(){const{startShift:e,timeStart:r}=this;return r<e?ni-e+r:r-e}get today(){return this.startOfDay(new Date)}ceil(e){const r=this.startOfDay(e);return r<e&&r.setDate(r.getDate()+1),r}contains(e){return!this.outside(e)}dateKey(e){return e=this.shiftDate(e,-1),b.makeKey(e)}dayOfDate(e){return this.shiftDate(b.clearTime(e))}dayOfWeek(e){return e=this.shiftDate(e,-1),e.getDay()}delta(e,r="ms"){const{timeStart:t}=this,i=gt.parse(e),n=(this.startShift&&i<t?i+ni:i)-t;return r==="ms"?n:b.as(r,n,"ms")}duration(e="ms"){const{timeStart:r,timeEnd:t}=this,i=r<t?t-r:ni-r+t;return e==="ms"?i:b.as(e,i,"ms")}equals(e){return this.startShift===(e==null?void 0:e.startShift)&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}intersects(e,r){const t=this,{timeStart:i,timeEnd:n}=t,[s,a]=t._dateRangeArgs(e,r),[o,l]=t.timeRange(s,a);return i<n?o<l?o<n&&i<=l:o<n||i<=l:!(o<l)||o<n||i<=l}isIntraDay(e,r){const t=this,[i,n]=t._dateRangeArgs(e,r),s=t.startOfDay(i),a=ni-b.diff(s,n,"ms");return a<0?!1:a>0||s<i}isInterDay(e){return e.allDay||!this.isIntraDay(...arguments)}outside(e){const{startShift:r,timeStart:t,timeEnd:i}=this,n=gt.parse(e);return t<i?n<t?n<r?1:-1:n<i?0:n<r?-1:1:n<i||n>=t?0:n<r?1:-1}parseKey(e){return this.dayOfDate(b.parseKey(e))}shiftDate(e,r=1){const{startShift:t}=this,i=typeof e;return e=i==="number"?new Date(e):i==="string"?b.parse(e):new Date(e.getTime()),r&&t&&e.setMilliseconds(r>0?t:-t),e}sortEvents(e,r){const t=this.startOfDay(e);return r==null?void 0:r.sort((i,n)=>{i=i.eventRecord||i,n=n.eventRecord||n;let{startDate:s}=i,{startDate:a}=n;return s?a?(s=s<t?t:s,a=a<t?t:a,s-a||n.endDate-a-(i.endDate-s)):1:-1})}startOfDay(e){return e=this.shiftDate(e,-1),e=b.clearTime(e),e=this.shiftDate(e),e}timeRange(e,r){const[t,i]=this._dateRangeArgs(e,r);return[b.getTimeOfDay(t),b.getTimeOfDay(i)]}toString(){const{startShift:e,timeEnd:r,timeStart:t}=this,i=e?`@${gt.format(e)}`:"",n=gt.format(t);return t===r?e?i:n:`${n}-${gt.format(r)}${i}`}_dateRangeArgs(e,r){return e.isModel?[e.startDate,e.endingDate]:[e,r]}};gt.MIDNIGHT=new gt({startShift:0,timeStart:0,timeEnd:24}),gt.MILLIS_PER_MINUTE=su,gt.MILLIS_PER_HOUR=$n,gt.MILLIS_PER_DAY=ni,gt._$name="DayTime";var bE=class extends Le(F){static get configurable(){return{date:{$config:{equal:"date"},value:b.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}changeDate(e){if(!this.isConfiguring){if(e=typeof e=="string"?b.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,r){const t=this,{dayColumnIndex:i,weekCount:n}=t,s=b.getFirstDateOfMonth(e),a=b.getLastDateOfMonth(s),o=i[s.getDay()],l=i[a.getDay()],c=!r||e.getFullYear()!==r.getFullYear(),d=!r||e.getMonth()!==r.getMonth(),u=t.eventListeners&&(r?e.getDate()!==r.getDate()|(t.getWeekId(e)!==t.getWeekId(r))<<1|d<<2|c<<3:15);if(t._year=e.getFullYear(),t._month=e.getMonth(),t.startDayOfMonth=1-o,t.endDayOfMonth=a.getDate()+(6-l),t.sixWeeks&&(t.endDayOfMonth+=(6-t.weekCount)*7),(!t.weekBase||c)&&t.calculateWeekBase(),(d||c)&&t.generation++,u){const h={newDate:e,oldDate:r,changes:{d:!0,w:!!(u&2),m:!!(u&12),y:!!(u&8),r:t.weekCount!==n}};t.trigger("dateChange",h),u&2&&t.trigger("weekChange",h),u&12&&t.trigger("monthChange",h),u&8&&t.trigger("yearChange",h)}}calculateWeekBase(){const e=this,{dayColumnIndex:r}=e,t=new Date(e.year,0,1),i=new Date(e.year,11,31),n=e.month?e.getOtherMonth(t):e;e.dayColumnIndex[t.getDay()]>3?e.weekBase=n.startDate:e.weekBase=new Date(e.year,0,n.startDayOfMonth-7);const s=Math.floor(b.diff(e.weekBase,i,"day")/7);e.has53weeks=s===53&&r[i.getDay()]>2}getWeekStart(e){if(typeof e=="number")return b.add(this.weekBase,Math.max(e,1)*7,"day");const r=this,[t,i]=e;return t===r.year?r.getWeekStart(i):r.getOtherMonth(new Date(t,0,1)).getWeekStart(i)}getOtherMonth(e){const r=this,t=r===CE?new bE(null):CE;return t.configure({weekBase:null,weekStartDay:r.weekStartDay,nonWorkingDays:r.nonWorkingDays,hideNonWorkingDays:r.hideNonWorkingDays,sixWeeks:r.sixWeeks,date:new Date(e.getFullYear(),0,1)}),t.date=e,t.updateDate(t.date,t.date),t}changeYear(e){const r=new Date(this.date);r.setFullYear(e),this.date=r}changeMonth(e){const r=new Date(this.date);r.setMonth(e),this.date=r}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:b.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||b.nonWorkingDays}changeNonWorkingDays(e){return T.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date,this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.endDayOfMonth)}eachDay(e){for(let r=this.startDayOfMonth;r<=this.endDayOfMonth;r++)e(new Date(this.year,this.month,r))}eachWeek(e){const r=this,{weekCount:t}=r;for(let i=r.startDayOfMonth,n=0;n<t;n++){const s=[],a=r.getWeekNumber(new Date(r.year,r.month,i));for(let o=0;o<7;o++,i++)s.push(new Date(r.year,r.month,i));e(a,s)}}getWeekNumber(e){const r=this;if(e=b.clearTime(e),e.getFullYear()!==r.year)return r.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let t=Math.floor(b.diff(r.weekBase,e,"day")/7),i=e.getFullYear();if(t)t===53&&!r.has53weeks?(t=1,i++):t>53&&(t=t%52);else return r.getOtherMonth(new Date(r.year-1,0,1)).getWeekNumber(new Date(r.year,0,0));return[i,t]}getWeekId(e){const r=this.getWeekNumber(e);return r[0]*100+r[1]}getCellData(e,r,t=gt.MIDNIGHT){const i=this,n=e.getDay(),s=i.visibleDayColumnIndex[n],a=i.nonWorkingDays[n],o=i.hideNonWorkingDays&&a;return(e<i.startDate||e>i.endDate)&&(i.month=e.getMonth()),{day:n,dayTime:t,visibleColumnIndex:s,isNonWorking:a,week:i.getOtherMonth(e).getWeekNumber(e),key:b.format(e,"YYYY-MM-DD"),columnIndex:i.dayColumnIndex[n],date:new Date(e),dayEnd:t.duration("s"),tomorrow:t.dayOfDate(b.add(e,1,"day")),isOtherMonth:Math.sign(e.getMonth()+e.getFullYear()*12-(r.month+r.year*12)),visible:!o&&e>=r.startDate&&e<b.add(r.endDate,1,"day"),isRowStart:s===0,isRowEnd:s===i.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:r,nonWorkingDays:t,hideNonWorkingDays:i}=e,n=e.dayColumnIndex=[],s=e.canonicalDayNumbers=[],a=e.visibleDayColumnIndex=[];let o=0;for(let l=0;l<7;l++){const c=(r+l)%7;s[l]=c,n[c]=l,(!i||!t[c])&&(a[c]=o++)}e.visibleColumnCount=o,e.weekLength=i?7-T.keys(t).length:7}},ha=bE;E(ha,"$name","Month");var CE=new ha(null);ha._$name="Month";var j_=0,SE=new WeakMap,B_=(...e)=>e.map(r=>{let t;return r&&typeof r=="object"||typeof r=="function"?(t=SE.get(r),t===void 0&&(t=++j_,SE.set(r,t))):t=String(r),t}).join("-"),Fi=e=>{const r=new Map;return(...t)=>{const i=B_(t);let n=r.get(i);return n===void 0&&(n=e(...t),r.set(i,n)),n}},El=e=>{const r=new Map,t=d=>d[0],i=d=>d[1],n=(d,u)=>t(d).push(u),s=(d,u)=>i(d).push(u),a=(d,u)=>i(d).some(h=>T.isEqual(h,u)),o=()=>[[],[]],l=d=>!i(d).length&&!t(d).length,c=d=>{let u=r.get(d);return u===void 0&&(u=o(),r.set(d,u)),u};return(d,u)=>{const h=c(d);l(h)?(n(h,u),e(d,g=>{a(h,g)||(s(h,g),t(h).forEach(f=>f(g)))})):(n(h,u),i(h).forEach(g=>u(g)))}},DE=Symbol("success"),H_=Symbol("failure"),au=(e,r)=>[DE,e,r],Fm=e=>[H_,e],Om=e=>e.length&&e[0]===DE,xl=e=>typeof e=="function"&&!e.length?e():e,ou=Fi(e=>El((r,t)=>t(au(e,r)))),V_=Fi(e=>El((r,t)=>{const i=Math.min(e.length,r.length),n=r.substr(0,i),s=r.substr(i);t(n===e?au(n,s):Fm(s))})),lu=(e,r)=>(t,i)=>xl(e)(t,n=>{if(Om(n)){const[,s,a]=n;r(s)(a,i)}else i(n)}),N_=Fi((...e)=>{const r=Fi((t,i)=>El(lu(t,n=>lu(i,s=>ou([].concat(n,s))))));return e.reduce(r,ou([]))}),z_=Fi((...e)=>El((r,t)=>e.forEach(i=>xl(i)(r,t)))),W_=Fi(e=>(r,t)=>{const i=new RegExp(`^${e}`),n=i.exec(r);if(n){const s=n[0],a=r.substr(s.length);t(au(s,a))}else t(Fm(r))}),G_=Fi((e,r)=>lu(e,(...t)=>ou(r(...[].concat.apply([],t))))),wE=(e,r)=>{const t=[];return e(r,i=>{if(Om(i)){const[,,n]=i;n===""&&t.push(i)}}),t},U_=e=>(r,t)=>t?xl(e)(r,t):wE(xl(e),r),EE={memo:Fi,memoCps:El,success:au,failure:Fm,isSuccess:Om,resolveParser:xl,succeed:ou,string:V_,bind:lu,seq:N_,alt:z_,regexp:W_,red:G_,runParser:wE,defineParser:U_},cu=class extends fe(F){static get configurable(){return{element:null,zoneWidth:50,scrollSpeed:5,direction:"both",startScrollDelay:500,stopScrollWhenPointerOut:!1,testConfig:{scrollSpeed:2,startScrollDelay:100},activeScroll:{$config:["lazy"],value:{}},monitoring:{$config:["lazy","nullify"],value:!0},owner:null}}changeMonitoring(e,r){return r==null||r.clear(),new Map}doDestroy(){this.stopMonitoring(),super.doDestroy()}get isScrolling(){return Object.keys(this.activeScroll).length!==0}get rtl(){var e;return(e=this.owner)==null?void 0:e.rtl}startMonitoring(e={}){const r=this,{element:t,direction:i}=r,{scrollables:n=[],direction:s=i,callback:a}=e,o=[];return n.length||n.push({element:t}),n.forEach(l=>{const c=l.element;typeof c=="string"?w.forEachSelector(t,c,d=>{r.createMonitor(d,l.direction||s,l.callback||a),o.push(d)}):(r.createMonitor(c,l.direction||s,l.callback||a),o.push(c))}),function(){var c;(c=r.stopMonitoring)==null||c.call(r,o)}}createMonitor(e,r,t){const{monitoring:i}=this;i.has(e)||i.set(e,new Y_({scrollManager:this,element:e,direction:r,callback:t}))}stopMonitoring(e){const r=this,{monitoring:t}=r;if(e=H.asArray(e),t){if(!e){t.forEach(i=>r.stopMonitoring(i.element));return}e.forEach(i=>{const n=t.get(i);i.classList.remove("b-scrolling"),n&&(n.destroy(),t.delete(i))})}}requestScroll(e,r){const{activeScroll:t}=this;return e in t&&t[e]!==r?!1:(t[e]=r,!0)}releaseScroll(e){const{activeScroll:r={}}=this;Object.keys(r).forEach(t=>{r[t]===e&&delete r[t]})}getRelativeScroll(e,r="left"){let t=0;return this.monitoring.forEach((i,n)=>{w.isDescendant(n,e)&&(t+=r==="left"?i.scrollRelativeLeft:i.scrollRelativeTop)}),t}},Y_=class extends F{construct(e){const r=this,{element:t}=e,i=t.scrollLeft,n=t.scrollTop;Object.assign(e,{startScrollLeft:i,startScrollTop:n}),super.construct(e),B.on({element:t,scroll:"onElementScroll",pointermove:"onMouseMove",capture:!0,thisObj:r}),B.on({element:t,pointerleave:"onPointerLeave",thisObj:r})}doDestroy(){this.stopScroll(),super.doDestroy()}startScroll(){const e=this;e.pendingScrollFinalize&&(e.scrollManager.releaseScroll(e),e.pendingScrollFinalize=!1),e.scrolling=!0,e.performScroll()}stopScroll(e=null){const r=this,t=()=>{r.pendingScrollFinalize=!1,r.isDestroyed||(r.scrollManager.releaseScroll(r),r.scrolling=!1)};r.scrollRequested&&(r.scrollManager.cancelAnimationFrame(r.frameId),r.scrollRequested=!1),r.scrollManager.clearTimeout(r.scrollTimeout),r.scrollTimeout=null,!e&&(r.ongoingScrollTop||r.ongoingScrollLeft)?(r.pendingScrollFinalize=!0,Promise.all([r.ongoingScrollTop,r.ongoingScrollLeft].filter(Boolean)).then(()=>r.pendingScrollFinalize&&t())):(r.ongoingScrollTop=r.ongoingScrollLeft=null,t())}onPointerLeave(){this.scrollManager.stopScrollWhenPointerOut&&this.stopScroll()}onMouseMove(e){const r=this,{scrollManager:t}=r,i=r.element.getBoundingClientRect(),n=t.zoneWidth,s=t.scrollSpeed;if(r.scrollDeltaX=r.scrollDeltaY=0,r.direction!=="vertical"){const{scrollLeft:a,scrollWidth:o,clientWidth:l}=r.element;t.rtl?e.clientX<i.left+n&&o+a-l>=1?r.scrollDeltaX=-Math.round((n+(i.left-e.clientX))/s)-1:e.clientX>i.right-n&&a<0&&(r.scrollDeltaX=Math.round((n-(i.right-e.clientX))/s)+1):e.clientX>i.right-n&&o-a-l>=1?r.scrollDeltaX=Math.round((n-(i.right-e.clientX))/s)+1:e.clientX<i.left+n&&a>0&&(r.scrollDeltaX=-Math.round((n+(i.left-e.clientX))/s)-1)}if(r.direction!=="horizontal"){const{scrollTop:a,scrollHeight:o,clientHeight:l}=r.element;e.clientY>i.bottom-n&&o-a-l>=1?r.scrollDeltaY=Math.round((n-(i.bottom-e.clientY))/s)+1:e.clientY<i.top+n&&a>0&&(r.scrollDeltaY=-Math.round((n+(i.top-e.clientY))/s)-1)}r.scrollDeltaX!==0&&!t.requestScroll("horizontal",r)&&(r.scrollDeltaX=0),r.scrollDeltaY!==0&&!t.requestScroll("vertical",r)&&(r.scrollDeltaY=0),r.scrollDeltaX===0&&r.scrollDeltaY===0?r.scrolling&&r.stopScroll():r.scrollTimeout||(r.scrollTimeout=t.setTimeout(()=>r.startScroll(),t.startScrollDelay))}performScroll(){const e=this,{element:r}=e;if(e.scrolling&&!e.scrollRequested){if(e.scrollDeltaX!==0){const t=r.scrollLeft,i=Math.min(t+e.scrollDeltaX,r.scrollWidth-r.clientWidth);r.scrollLeft=i,r.scrollLeft!==t?e.ongoingScrollLeft=new Promise(n=>r.addEventListener("scroll",n,{once:!0})):(e.ongoingScrollLeft=null,e.scrollDeltaX=0)}if(e.scrollDeltaY!==0){const t=r.scrollTop,i=Math.min(t+e.scrollDeltaY,r.scrollHeight-r.clientHeight);r.scrollTop=i,r.scrollTop!==t?e.ongoingScrollTop=new Promise(n=>r.addEventListener("scroll",n,{once:!0})):(e.ongoingScrollTop=null,e.scrollDeltaY=0)}e.scrollDeltaX!==0||e.scrollDeltaY!==0?(e.scrollRequested=!0,e.frameId=e.scrollManager.requestAnimationFrame(()=>{e.scrollRequested=!1,e.performScroll(e)})):e.stopScroll()}}onElementScroll(){var e,r;(r=(e=this.config)==null?void 0:e.callback)==null||r.call(this.thisObj||this.scrollManager,this)}get scrollLeft(){return this.element.scrollLeft}get scrollTop(){return this.verticalElement?this.verticalElement.scrollTop:this.element.scrollTop}get scrollRelativeLeft(){return this.scrollLeft-this.startScrollLeft}get scrollRelativeTop(){return this.scrollTop-this.startScrollTop}getRelativeLeftScroll(e){return this.scrollManager.getRelativeScroll(e,"left")}getRelativeTopScroll(e){return this.scrollManager.getRelativeScroll(e,"top")}};cu._$name="ScrollManager";var q_={left:!0,right:!0,top:!0,bottom:!0,transform:!0},K_={true:1,false:1},X_=Promise.resolve(),ve=class extends ht{static get $name(){return"Tooltip"}static get type(){return"tooltip"}static get configurable(){return{mouseOffsetX:15,mouseOffsetY:15,html:{$config:{equals:()=>!1}},getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:!1,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:null,anchor:!0,align:{align:"b-t",minHeight:300},axisLock:!0,activeTarget:null,testConfig:{hideDelay:100,hoverDelay:100,showAnimation:null,hideAnimation:null}}}afterConfigure(){const e=this,{forSelector:r}=e;r&&(e.showOnHover=!0,e.forElement||(e.anchorToTarget||(e.trackMouse=!0),e.forElement=e.rootElement.host||e.rootElement)),super.afterConfigure(),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=B.on({element:e.forElement,pointerover:"internalOnPointerOver",pointerout:"internalOnPointerOut",thisObj:e}))}doDestroy(){var e;(e=this.pointerOverOutDetacher)==null||e.call(this),super.doDestroy()}set focusOnToFront(e){super.focusOnToFront=e}get focusOnToFront(){return super.focusOnToFront&&w.usingKeyboard}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get anchorToTarget(){return this._anchorToTarget&&!this.trackMouse}get anchor(){return super.anchor&&!this.trackMouse}set anchor(e){super.anchor=e}onDocumentMouseDown({event:e}){const r=this,{triggeredByEvent:t}=r;t&&w.isTouchEvent&&e.pageX===t.pageX&&e.pageY===t.pageY&&r.activeTarget.contains(e.target)&&performance.now()-t.timeStamp<500||(r.abortDelayedShow(),super.onDocumentMouseDown({event:e}))}internalOnPointerOver(e){const r=this,{target:t,relatedTarget:i}=e,{forElement:n,forSelector:s,activeTarget:a}=r;let o;if(!(r.disabled||r.owner&&!r.owner.showTooltipWhenDisabled&&r.owner.disabled)&&!(r.allowOver&&r.element.contains(t))){if(s){if(o=r.filterTarget(t),a!=null&&a.contains(t)&&a.contains(i)&&o===a||o&&(i==null?void 0:i.closest(s))===o)return}else if(!n.contains(i))o=n;else return;o?r.handleForElementOver(e,o):a&&r.handleForElementOut()}}filterTarget(e){return e.closest(this.forSelector)}onTransitionEnd(e){var r;const t=this,{currentOverElement:i}=ve;if(q_[e.propertyName]){if(t.allowOver&&t.element.contains(i))return;(r=t.activeTarget)!=null&&r.contains(i)&&!t.trackMouse&&t.realign()}}async handleForElementOver(e,r){const t=this,{activeTarget:i,hideOnDelegateChange:n,anchorToTarget:s}=t,a=r!==i,o=a&&n;if(t.trigger("pointerOver",{event:e,target:r})===!1)t.internalOnPointerOut(e);else{if(t.triggeredByEvent=e,t.hasTimeout("hide")&&(t.abortDelayedHide(),!a))return;if(!n&&t.element.classList.contains("b-hiding")&&t.cancelHideShowAnimation(),!t._hidden&&o&&t.hide(!1),t.activeTarget=r,t.isVisible){const l=t.updateContent();if(N.isPromise(l)&&!t.loadingMsg&&await l,t.trigger("beforeShow")===!1)return t.hide();t.alignTo({[s?"target":"position"]:s?r:"mouse",overlap:!(s&&t.anchor)}),t.trigger("show"),t.afterShowByTarget()}else t.delayShow(r)}}async delayShow(e){var r;const t=this;if((r=t.currentAnimation)!=null&&r.showing&&t.cancelHideShowAnimation(),!t.isVisible&&!t.hasTimeout("show"))if(!t.hoverDelay||t.forSelector&&Date.now()-t.lastHidden<t.quickShowInterval){const i=t.updateContent();N.isPromise(i)&&!t.loadingMsg&&await i,t.showByTarget(e)}else t.addDocumentMouseDownListener(),!t.listeningForMouseMove&&!t.anchorToTarget&&(t.mouseMoveRemover=B.on({element:t.rootElement,mousemove:"onMouseMove",thisObj:t})),t.setTimeout(async()=>{if(e.isConnected){const i=t.updateContent();N.isPromise(i)&&!t.loadingMsg&&await i,t.showByTarget(e)}},!t.triggeredByEvent||t.triggeredByEvent.type==="pointerover"?t.hoverDelay:0,"show");else t.isVisible&&t.showByTarget(e)}changeAllowOver(e){return this.inAfterShow||(this.configuredAllowOver=e),e}updateAllowOver(e){var r;const t=this,{element:i}=t;i.classList.toggle("b-allow-over",!!e),e?t.allowOverlisteners=B.on({element:i,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:t}):(r=t.allowOverlisteners)==null||r.call(t)}updateContent(){const e=this;if(e.getHtml){const r=e.callback(e.getHtml,e,[{tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent}]);return e.html=r,r}}get hasContent(){return!!(w.isReactElement(this._html)||this._html!==""&&typeof this.html=="string"&&this.html.length||this.items.length)}internalBeforeShow(){return(this.updateContentOnMouseMove||this.hasContent)&&!this.disabled}showAsyncMessage(e=this.optionalL(this.loadingMsg)){e&&(this.html=`
                <div class="b-tooltip-loading">
                    <i class="b-icon b-icon-spinner"></i>
                    ${e}
                </div>
            `)}showByTarget(e){var r;const t=this,{anchorToTarget:i}=t;t.mouseMoveRemover=(r=t.mouseMoveRemover)==null?void 0:r.call(t),t.showBy({[i?"target":"position"]:i?e:"mouse",overlap:!(i&&t.anchor)})}afterShowByTarget(){const e=this,{dismissDelay:r}=e;e.abortDelayedShow(),r&&e.setTimeout("hide",r),e.element.parentNode&&e.toFront(),!e.mouseMoveRemover&&(e.trackMouse||e.updateContentOnMouseMove)&&(e.mouseMoveRemover=B.on({element:e.rootElement,pointermove:"onMouseMove",thisObj:e})),e.inAfterShow=!0,e.allowOver=e.allowOver||e.configuredAllowOver!=!1&&e.childItems.some(t=>t.isVisible&&!t.disabled&&t.focusElement),e.inAfterShow=!1}updateActiveTarget(e,r){e&&!this.isConfiguring&&this.trigger("overTarget",{newTarget:e,lastTarget:r})}internalOnPointerOut(e){var r;const t=this,i=e.relatedTarget;t.allowOver&&t.element.contains(i)||t.element.contains(e.target)&&((r=t.activeTarget)!=null&&r.contains(i))||t.activeTarget&&!t.activeTarget.contains(i)&&t.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:r}=e;if(e.trigger("pointerOut")===!1){e.activeTarget=null;return}e.abortDelayedShow(),e.isVisible&&r!==!1&&(e.abortDelayedHide(),r>0?e.setTimeout("hide",r):e.hide())}show(e){const r=this;!e&&r.forElement&&r.anchorToTarget&&!r.forSelector?r.showByTarget(r.forElement):super.show(...arguments),r.isVisible&&(r.afterShowByTarget(),r.forElement&&!r.transitionEndDetacher&&!r._hidden&&(r.transitionEndDetacher=B.on({element:r.forElement,transitionend:"onTransitionEnd",thisObj:r})))}hide(){var e,r;const t=this;if(t.abortDelayedShow(),t._hidden)return X_;{t.abortDelayedHide();const i=super.hide(...arguments);return t.lastHidden=Date.now(),t.activeTarget=null,(e=t.mouseMoveRemover)==null||e.call(t),t.mouseMoveRemover=null,(r=t.transitionEndDetacher)==null||r.call(t),t.transitionEndDetacher=null,i}}abortDelayedShow(){var e,r,t;const i=this;i.hasTimeout("show")&&((e=i.mouseDownRemover)==null||e.call(i),i.mouseDownRemover=null,i.clearTimeout("show"),(r=i.mouseMoveRemover)==null||r.call(i),i.mouseMoveRemover=null,(t=i.transitionEndDetacher)==null||t.call(i),i.transitionEndDetacher=null)}abortDelayedHide(){this.clearTimeout("hide")}realign(){const e=this,r=e.lastAlignSpec;!e.isConfiguring&&!e.isVisible&&(r!=null&&r.targetOutOfView)&&(r.allowTargetOut||w.isInView(r.target,!1,e))&&(e.show(),r.targetOutOfView=!1),super.realign()}alignTo(e){const r=this,{mouseOffsetX:t,mouseOffsetY:i}=r;if(!r.isVisible)return;let n;!r.anchorToTarget&&e.position==="mouse"&&(n=new Sr(r.triggeredByEvent.pageX-globalThis.scrollX,r.triggeredByEvent.pageY-globalThis.scrollY),e.position=new Sr(n.x+r.mouseOffsetX*(r.rtl?-1:1),n.y+r.mouseOffsetY)),e&&!(r.triggeredByEvent&&r.element.contains(r.triggeredByEvent.target))&&e.nodeType===Node.ELEMENT_NODE&&(e={target:e}),super.alignTo(e),n&&r.lastAlignSpec.result.inflate(5).contains(n)&&(r.lastAlignSpec.position="mouse",r.mouseOffsetY=-i-r.height,r.mouseOffsetX=-t-r.width,r.realign(),r.mouseOffsetY=i,r.mouseOffsetX=t)}changeHtml(e){const r=this;if(N.isPromise(e)){r.showAsyncMessage(),e.target=r.activeTarget,e.then(t=>{e.target===r.activeTarget&&(r.html=t)});return}return typeof e!="object"&&(e=e!=null?r.optionalL(String(e)):""),e}updateHtml(e,r){const t=this;let i=e==="";i||(super.updateHtml(e,r),t.hasContent?(t.isVisible&&t.realign(),N.isPromise(e)||t.trigger("innerHtmlUpdate",{value:e})):i=!0),i&&t.hide()}onMouseMove(e){const r=this,{forElement:t,activeTarget:i}=r,n=r.hasTimeout("hide"),s=e.target;if(r.triggeredByEvent=e,!r._hidden){let a;const o=i==null?void 0:i.contains(s),l=!o&&r.forSelector&&i&&!n&&s.nodeType===Node.ELEMENT_NODE&&!s.matches(r.forSelector)&&!(r.allowOver&&r.element.contains(s)),c=t!=null&&t.document?t.document.documentElement:t,d=c&&(c.contains?c.contains(s):c.compareDocumentPosition(s)&16);if(l&&(a=r.handleForElementOut()),a||!n||d){if(r.dismissDelay&&!n&&r.setTimeout("hide",r.dismissDelay),r.updateContentOnMouseMove&&r.getHtml&&(r.html=r.callback(r.getHtml,r,[{tip:r,element:r.element,forElement:i,event:e}]),!r.html)){r.hide();return}r.trackMouse&&r.alignTo({position:"mouse",ignorePageScroll:!0})}}}onOwnElementMouseEnter(e){this.abortDelayedHide()}static getSharedTooltip(e,r,t){var i,n,s;let a=(n=(i=r.bryntum)==null?void 0:i.tooltip)==null?void 0:n.get(ve);if(!a&&!t){(s=r.bryntum)!=null&&s.tooltip||T.setPath(r,"bryntum.tooltip",new Map);const o=r.bryntum.tooltip;o.set(ve,!0),a=new ve({forElement:r,rootElement:e,forSelector:"[data-btip]",resetCfg:{},isShared:!0,cls:"b-tooltip-shared",internalListeners:{pointerOver({source:l,target:c}){for(const h in l.resetCfg)h==="listeners"?l.un(l.resetCfg[h].set):h!=="html"&&(l[h]=l.resetCfg[h].was);l.resetCfg={};const d=$.getById(c.id),u=(d==null?void 0:d.tipConfig)||l.gatherDataConfigs(c.dataset);if(d&&d.element!==c||!d&&c.matches(".b-widget")||d!=null&&d.disabled&&!d.showTooltipWhenDisabled)return!1;l.owner=d;for(const h in u)l.resetCfg[h]={set:u[h],was:l[h]},h==="listeners"?l.ion(u[h]):l[h]=u[h]},hide({source:l}){l.owner=null}},gatherDataConfigs(l){const c=this,d={};for(const u in l)if(u.startsWith("btip"))if(u.length>4){const h=O.uncapitalize(u.substr(4));if(h in c.getDefaultConfiguration()){const g=l[u];d[h]=K_[g]?g==="true":isNaN(g)?g:parseInt(g,10)}}else d.html=l[u];return d},filterTarget(l){const c=l.closest(this.forSelector);if(c)return c;if(ve.showOverflow)for(;(l==null?void 0:l.nodeType)===Element.ELEMENT_NODE;){if(w.getStyleValue(l,"text-overflow")==="ellipsis"&&l.clientWidth<l.scrollWidth)return this.html=O.encodeHtml(l.textContent),l;l=l.parentNode}}}),B.on({element:r,mouseenter:l=>ve.currentOverElement=l.target,keydown:l=>ve.currentOverElement=l.target,capture:!0,thisObj:a}),o.set(ve,a)}return a}static encodeConfig(e){const r={};if(typeof e=="string")r.btip=e;else for(const t in e)r[`btip${t==="html"?"":O.capitalize(t)}`]=e[t];return r}};ve.initClass(),Object.defineProperty($,"tooltip",{get(){return ve.getSharedTooltip(document.body,document.body)}}),$.Tooltip=ve,ve._$name="Tooltip";var Lm=class extends ua{static get type(){return"tip"}static get configurable(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}open(){this.getConfig("tooltip")}close(){var e;(e=this.tooltip)==null||e.hide()}dragMove(e){const{offset:r,tooltip:t}=this,{event:i}=e;t&&(t.isVisible||t.show(),t.alignTo({align:this.align,target:new k(i.clientX-r,i.clientY-r,r*2,r*2)}))}changeTooltip(e,r){return $.reconfigure(r,e,this)}};Lm.initClass(),Lm._$name="DragTipProxy";var $m=e=>class extends(e||F){static get $name(){return"Labelable"}static get configurable(){return{label:null,labelPosition:"before",labelCls:null,labelWidth:{value:null,$config:{localeKey:"L{labelWidth}"}}}}get hasLabel(){return!!this.label}compose(){const{hasLabel:t,labelPosition:i}=this;return{class:{[`b-label-${i}`]:t,"b-has-label":t}}}changeLabel(t){return t||""}setupLabel(t){return T.assign({tag:"label",for:`${this.id}-input`,class:`b-label b-align-${t.align||"start"}`},t)}updateLabelWidth(t){this.labelElement&&(this.labelElement.style.flex=`0 0 ${w.setLength(t)}`,this.inputWrap.style.flexBasis=t==null?"":"auto")}get widgetClass(){}},jm=class extends Ht{static get $name(){return"FieldContainer"}static get type(){return"fieldcontainer"}static get configurable(){return{animation:{duration:300},collapsed:null,collapser:{value:null,$config:"nullify"},syncableConfigs:null,syncConfigTriggers:{$config:{merge:"classList"},value:null},testConfig:{animation:{duration:10}}}}static get delayable(){return{syncChildConfigs:"raf"}}get inline(){var e;return(e=this.owner.inline)!=null?e:this.ensureItems().count===1}changeCollapsed(e){if(this.togglingCollapse)return this.togglingCollapse=!1,e;this.toggleCollapse(!!e)}updateCollapsed(e){var r;this.collapser=(r=this.collapser)==null?void 0:r.destroy(),this.setCollapsedCls(e)}updateCollapser(e,r){r&&r.completed==null&&(!r.reverting||!e)&&r.destroy(),this.setOwnerCls("b-collapsing",e)}get collapsing(){const{collapser:e}=this;return e!=null&&e.collapsed}get collapsingExpanding(){return this.collapser!=null}get expanding(){const{collapser:e}=this;return e!=null&&!e.collapsed}collapse(e){this.toggleCollapse(!0,e)}expand(e){this.toggleCollapse(!1,e)}setCollapsedCls(e){this.setOwnerCls("b-collapsed",e)}setOwnerCls(e,r){var t,i;(i=(t=this.owner)==null?void 0:t.element)==null||i.classList[r?"add":"remove"](e)}syncChildConfigs(){const e=this,{owner:r,syncableConfigs:t}=e;if(t){let i,n;for(i in t)n=t[i](r),e.eachWidget(s=>{s[i]=n},!1)}r.afterSyncChildConfigs(e)}syncContainer(){const{inline:e,layout:r}=this;this.autoLayout&&(r.horizontal=e,r.justify=e?"center":"stretch")}toggleCollapse(e,r){const t=this,{animation:i,collapser:n,inline:s}=t,{containerWrapElement:a}=t.owner,o=l=>{l&&(t.element.style.height="",t.togglingCollapse=!0,t.collapsed=e,t.collapser=null)};if(e==null&&(e=!t.collapsed),r!==!1&&r!==null&&(!a||!t.isVisible?r=null:(r===!0?r={}:typeof r=="number"&&(r={duration:r}),r=i||r?T.merge({},i,r):null)),!r)t.togglingCollapse=!0,t.collapsed=e;else if(n&&e!==n.collapsed)t.collapser=n.revert({finalize:o}),t.collapser.collapsed=e;else if(!n&&e!==t.collapsed){!e&&t.setCollapsedCls(!1);const{element:l}=t,{height:c}=l.getBoundingClientRect(),d=s?1:c;!e&&t.setCollapsedCls(!0),l.style.height=`${c}px`,t.collapser=je.run(T.merge({finalize:o,element:a,[s?"opacity":"height"]:{from:e?d:0,to:e?0:d}},r)),t.collapser.collapsed=e}}};jm.initClass(),jm._$name="FieldContainer";var Z_=(e,r)=>(e.weight||0)-(r.weight||0),J_=(e,r)=>(r.weight||0)-(e.weight||0),Bm=[],Q_={align:!0,weight:!0},Ue=class extends $.mixin(Em,$m){static get $name(){return"Field"}static get type(){return"field"}static get configurable(){return{defaultBindProperty:"value",placeholder:null,value:"",name:null,labels:null,required:null,clearable:null,revertOnEscape:null,hint:null,hintHtml:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",triggers:null,highlightExternalChange:!0,localizableProperties:["label","title","placeholder","labelWidth"],autoSelect:!1,autoComplete:"off",spellCheck:null,validateOnInput:!0,inputAttributes:null,inputType:"text",inputAlign:null,attributes:{value:["placeholder","autoComplete","spellCheck","minLength","maxLength","pattern","tabIndex","min","max"],$config:{merge:"distinct"}},nullValue:{$config:null,value:null,default:null},updatedClsDuration:500,inputReadOnly:!1,ariaElement:"input",container:{$config:"nullify",value:null},containerDefaults:{type:"fieldcontainer",syncableConfigs:{disabled:e=>e.disabled},syncConfigTriggers:{disabled:1}},containValues:null,inline:null,testConfig:{updatedClsDuration:10},keyMap:{}}}static get delayable(){return{highlightChanged:"raf"}}doDestroy(){var e,r,t;const i=this,{triggers:n}=i,s=i.isPainted&&Ue.getSharedErrorTooltip(i.rootElement,!0);if((e=i.inputListenerRemover)==null||e.call(i),(r=i.keyListenerRemover)==null||r.call(i),(t=i.container)==null||t.destroy(),super.doDestroy(),n)for(const a of Object.values(n))a.destroy();(s==null?void 0:s.field)===i&&s.hide()}get childItems(){const{container:e,triggers:r}=this,t=r?Object.values(r):[];return e?[...t,...e.childItems]:t}get invalidValueError(){return"L{invalidValue}"}get errorTip(){return this.constructor.getSharedErrorTooltip(this.rootElement)}static getSharedErrorTooltip(e,r){var t;let i=(t=e.bryntum)==null?void 0:t.errorTooltip;return!i&&!r&&(e.bryntum=e.bryntum||{},i=new ve({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:{align:"l-r",monitorTargetMutation:!0},scrollAction:"realign",trapFocus:!1,rootElement:e,onBeforeShow(){const n=this,s=$.fromElement(n.activeTarget);if(s){const a=s.getErrors();if(a)return n.html=a.join("<br>"),n.field=s,!0}return!1}}),e.bryntum.errorTooltip=i),i}static get errorTip(){return this.getSharedErrorTooltip(document.body)}construct(e){super.construct(e);const r=this;r.keyStrokeChangeDelay&&(r.changeOnKeyStroke=r.buffer(r.internalOnChange,r.keyStrokeChangeDelay))}changeKeyMap(e){var r;const t=this;let i={};e&&(t._fieldKeyMap?T.assign(i,t._fieldKeyMap):(t._fieldKeyMap=e,T.assign(i,e)));for(const n in t.triggers)(r=t.triggers[n])!=null&&r.keyMap&&(i=t.mergeKeyMaps(i,t.triggers[n].keyMap,n));return i}get keyMapSubComponents(){return this.triggers}onFocusIn(e){const r=this;r.valueOnFocus=T.clone(r.value),r.validOnFocus=!(r.errors&&Object.keys(r.errors).length),super.onFocusIn(e),r.focusing=!0,r.syncInvalid(),r.focusing=!1}onFocusOut(e){super.onFocusOut(e),this.syncRequired(),this.onEditComplete()}onEditComplete(){}get rootUiClass(){return Ue}compose(){this.getConfig("clearable");const e=this,{container:r,innerElements:t,label:i,labels:n,labelCls:s,readOnly:a,triggers:o}=e,l=T.values(o,(g,f)=>!f),c=l.filter(g=>g.align==="start").sort(Z_),d=l.filter(g=>g.align!=="start").sort(J_),u=e.setupLabel.bind(e),h=[...c.map(g=>g.element),...t,...d.map(g=>g.element)];return{class:{"b-has-start-trigger":c.length,"b-no-input":!t.length,"b-readonly":a,"b-field-container":!!r,"b-field-container-inline":r==null?void 0:r.inline},children:[...(n||Bm).filter(g=>g&&g.align!=="end").map(u),(i||null)&&u({reference:"labelElement",class:`b-label b-align-start ${s||""}`,html:i}),h.length?{class:"b-field-inner",reference:"inputWrap",children:h}:null,...(n||Bm).filter(g=>(g==null?void 0:g.align)==="end").map(u),...r?[{reference:"containerWrapElement",children:[r.element],class:{"b-field-container-wrap":1}}]:Bm]}}updateElement(e,r){var t;const i=this,n=i.initialConfig.value,{input:s}=i;super.updateElement(e,r),n!=null&&(i.value=n),i.syncEmpty(),i.updateInputReadOnly(i.inputReadOnly),i.syncInvalid();const a=s||i.focusElement;(t=i.keyListenerRemover)==null||t.call(i),i.keyListenerRemover=a&&B.on({element:a,thisObj:i,keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}get innerElements(){return[this.inputElement]}get inputElement(){const{attributes:e,inputAttributes:r,id:t,inputCls:i,inputType:n,name:s}=this,a=T.assign({reference:"input",tag:"input",type:n,name:s||t,id:`${t}-input`,retainElement:!0},r);i&&(a.class=i);for(let o,l,c=e.length;c-- >0;)o=e[c],l=this[o],l!=null&&(a[o]=l);return a}get caretPos(){return this.textSelection[0]}set caretPos(e){this.textSelection=e}get focusElement(){return this.input}get textSelection(){var e;const r=this.input;let t;try{t=[r.selectionStart,r.selectionEnd,r.selectionDirection]}catch(i){t=((e=r.value)==null?void 0:e.length)||0,t=[t,t]}return t}set textSelection(e){typeof e=="number"?this.select(e,e):this.select(...e)}get hasTextSelection(){const[e,r]=this.textSelection;return e&&r-e>0}getAfterValue(e){const[r,t]=this.textSelection,i=this.input.value;return`${i.substr(0,r)}${e}${i.substr(t||r)}`}select(e,r){const t=this.focusElement;if(t.value.length){if(arguments.length===0){this.selectAll();return}if(!this.supportsTextSelection)return;t.setSelectionRange(e,r)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const r=e.createTextRange();r.collapse(!1),r.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}syncEmpty(){var e;const{isEmptyInput:r,isEmpty:t,element:i}=this,n=(e=this.triggers)==null?void 0:e.clear,s=r&&t;i&&(n&&n[s?"hide":"show"](),i.classList.toggle("b-empty",s))}updateHint(){this.syncHint()}updateHintHtml(){this.syncHint()}syncHint(){const e=this,{input:r,hint:t,hintHtml:i}=e,n=r==null?void 0:r.parentElement;if(r){let s=i||t;const a=e.hintElement||s&&(e.hintElement=w.createElement({parent:n,className:"b-field-hint",nextSibling:r.nextSibling,children:[{className:"b-field-hint-content"}]}));a&&(typeof s=="function"&&(s=s({source:e,value:e.value})),a.firstChild[i?"innerHTML":"textContent"]=s||""),e.element.classList[s?"remove":"add"]("b-field-no-hint")}}syncInvalid(){const e=this,{isPainted:r}=e;if(e.updatingInvalid=!0,r){const{isValid:t,element:i,inputWrap:n}=e;if(i.classList[t?"remove":"add"]("b-invalid"),t){const s=e.constructor.getSharedErrorTooltip(e.rootElement,!0);s!=null&&s.isVisible&&s.field===e&&s.hide()}else{const s=e.errorTip;s&&(e.containsFocus||e.isVisible&&n.contains(ve.currentOverElement))&&(s.activeTarget===n&&s.isVisible?s.onBeforeShow():(s.activeTarget=n,s.showBy(n)))}}e.updatingInvalid=!1}updateEditable(){this.syncInputReadOnly()}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly||this.editable===!1}updateInputReadOnly(e){const r=this,{input:t,inputListenerRemover:i}=r;t&&(t.readOnly=e?"readOnly":null,e?r.inputListenerRemover=i==null?void 0:i():i||(r.inputListenerRemover=B.on({element:t,thisObj:r,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"})))}changeReadOnly(e){return!!e}updateReadOnly(e){this.syncInputReadOnly()}updateClearable(e){const r=this;r.getConfig("triggers"),r.triggers={clear:e&&T.assign({cls:"b-icon-remove",weight:1e3,key:"Shift+backspace",handler(){r._isUserAction=!0,r.clear(...arguments),r._isUserAction=!1}},e)||null}}changeTriggers(e,r){const t=this,i=t.$triggers||(t.$triggers=new An({configName:"triggers",factory:Ue.Trigger,inferType:!1,owner:t,created(n){Te.after(n,"onConfigChange",(s,{name:a})=>{Q_[a]&&t.onConfigChange({name:"triggers",value:i.target})})},setup(n,s){n.reference=n.ref=s,n.parent=t}}));if(t.stepTriggers===!1&&(e.back||e.forward)&&(e=T.assign({},e),delete e.back,delete e.forward),i.update(e),t.element&&(t.keyMap=t.keyMap),!r)return i.target}updateInputWidth(e){this.input.style.width=w.setLength(e),this.element.classList.add("b-has-width")}updateInputAlign(e){this.input.style.textAlign=e}get isValid(){const e=this;if(!e.disabled){if(e.syncRequired(),e.errors&&Object.keys(e.errors).length)return!1;const r=e.validity;if(r)return r.valid}return!0}get isEmpty(){return this.value==null||this.value===""}get isEmptyInput(){return!this.input||this.input.value==null||this.input.value===""}get validity(){const e=this.input;return e==null?void 0:e.validity}async setValue(e){this.value=e}changeValue(e,r){return e==null&&(e=this.nullValue),this.hasChanged(r,e)?e:(e===""&&this.syncRequired(),r)}updateValue(e,r){const t=this;t.isConfiguring||(t.syncRequired(),t.inputting||t.triggerChange()),t.inputting||(t._lastValue=e),t.syncInputFieldValue(),t.overflowTwin&&!t._overflowTwinSync&&(t._overflowTwinSync=!0,t.overflowTwin.value=e,t._overflowTwinSync=!1)}hasChanged(e,r){return r!==e}syncInputFieldValue(e=!1){const r=this,{input:t,parent:i,inputValueAttr:n,inputValue:s}=r;if(t&&!r.inputting&&t[n]!==s&&(t[n]=s,!r.isConfiguring&&!r.containsFocus&&r.highlightExternalChange)){if(t.classList.remove("b-field-updated"),r.clearTimeout("removeUpdatedCls"),i){const{assigningValues:a}=i;(a===!0||(a==null?void 0:a.highlight)===!1)&&(e=!0)}e||r.highlightChanged()}r.syncEmpty(),r.syncInvalid()}highlightChanged(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return this.value==null?"":this.value}get inputValueAttr(){return"value"}get supportsTextSelection(){const e=this.focusElement;return e&&(e.tagName.toLowerCase()==="textarea"||e.type&&/text|search|password|tel|url/.test(e.type))}internalOnInputFocus(){this.autoSelect&&this.selectAll()}internalOnChange(e){const r=this;r.hasChanged(r._lastValue,r.value)&&r.isValid&&(r.triggerChange(e,!0),r._lastValue=r.value)}triggerChange(e,r=!!this._isUserAction){const t=this,{value:i,_lastValue:n,isValid:s}=t;t.syncHint(),t.triggerFieldChange({value:i,oldValue:n,event:e,userAction:r,valid:s}),t.defaultAction==="change"&&t.trigger("action",{value:i,oldValue:n,event:e,userAction:r,valid:s})}fetchInputValue(){this.value=this.input[this.inputValueAttr]}internalOnInput(e){var r;const t=this;t.validateOnInput||t.errorTip.hide(),t.inputting=!0,t.fetchInputValue(),t.inputting=!1,t.trigger("input",{value:t.value,event:e}),(r=t.changeOnKeyStroke)==null||r.call(t,e)}get needsInputSync(){var e;return this.input[this.inputValueAttr]!==String((e=this.inputValue)!=null?e:"")}internalOnKeyEvent(e){const r=this,{value:t}=r;let i=!1;if(e.type==="keydown"&&e.key==="Escape"&&!(r.readOnly||r.disabled)){const n=r.isValid,s="initialValue"in r?r.initialValue:r.valueOnFocus,a=r.hasChanged(s,t),{needsInputSync:o}=r;r.revertOnEscape&&(!n||a||o)&&(a&&(r.value=s),o&&r.syncInputFieldValue(!0),r.clearError(),i=(a||o)&&r.isValid||n!==r.validOnFocus)}r.isDestroyed||(i&&e.stopImmediatePropagation(),r.trigger(e.type,{event:e}))}clear(e){const r=this,{value:t}=r;(t!==r.nullValue||r.input.value.length>0)&&(r.value=r.nullValue,r.clearError(),r.syncInvalid(),r.trigger("clear",{event:e}))}onDisabled(){this.syncInvalid()}syncRequired(){var e;const r=this;!r.isConfiguring&&!r.focusing&&r.required&&r.isEmpty&&!((e=r.parent)!=null&&e.isSettingValues)?r.setError("L{fieldRequired}",r.updatingInvalid):r.clearError("L{fieldRequired}",r.updatingInvalid)}setError(e,r,t){const i=this;if((i.errors||(i.errors={}))[i.optionalL(e)]=1,r||i.syncInvalid(),t){const n=()=>{i.clearError(e),s()},s=i.ion({keydown:n,focusOut:n})}}clearError(e,r){const t=this;t.errors&&(e?delete this.errors[this.optionalL(e)]:t.errors={}),r||t.syncInvalid()}getErrors(){const e=this;if(!e.isValid){const r=e.validity,t=T.keys(r).find(s=>s!=="valid"&&s!=="customError"&&r[s]),i=e.errors&&Object.keys(e.errors);let n;if(i!=null&&i.length?n=i:r.customError?n=[e.input.validationMessage]:t?n=[e.L(t,{min:e.min,max:e.max})]:n=[e.L(e.invalidValueError)],(n==null?void 0:n.length)>0)return n}}createOverflowTwin(e){const r=this,t=super.createOverflowTwin(e);return t.ion({change({value:i}){r._overflowTwinSync=!0,r.value=i,r._overflowTwinSync=!1}}),t}get containerCollapsed(){var e;return(e=this.container)==null?void 0:e.collapsed}set containerCollapsed(e){const{container:r}=this;r&&(r.collapsed=e)}afterSyncChildConfigs(e){}changeContainer(e,r){e&&(Array.isArray(e)||!("type"in e||"items"in e))&&(e={items:e});const t=this,i=e&&T.merge({owner:t,layout:"box"},t.containerDefaults),n=$.reconfigure(r,e,{owner:t,defaults:i});if(n&&(n.autoLayout=(i==null?void 0:i.layout)==="box",n===r)){n.syncContainer();return}return n}onConfigChange(e){var r,t;super.onConfigChange(e),(t=(r=this.container)==null?void 0:r.syncConfigTriggers)!=null&&t[e.name]&&this.container.syncChildConfigs()}assignValue(e,r){const t=this,{container:i,containValues:n}=t,s=t.getValueName(r),a=e&&s in e;i&&n!==!1?e&&n==="nested"?a&&(e=T.clone(e[s]),super.assignValue({[s]:e&&!("value"in e)||e.value},r),e&&delete e.value,i.assignValue(e,r)):(super.assignValue(e,r),i.assignValue(e,r)):super.assignValue(e,r)}gatherValue(e){super.gatherValue(e),this.gatherValues(e)}gatherValues(e,r){const t=this,{container:i,containValues:n,valueName:s}=t,a=typeof n;r=r!=null?r:s in e,i&&n!==!1&&(n==="nested"?r&&(e[s]={value:e[s],...i.values}):(n===!0||n==null&&r||a==="string"&&t[n]||a==="function"&&n(t))&&i.gatherValues(e))}updateContainer(e,r){r&&this.detachListeners(r.id),e&&(e.rendered||e.render(),e.syncContainer(),e.syncChildConfigs())}};Ue.Trigger=class extends ${static get $name(){return"FieldTrigger"}static get factoryable(){return{defaultType:Ue.Trigger,extends:null}}static get type(){return"trigger"}static get configurable(){return{align:null,weight:null,role:void 0}}get field(){return this.parent}construct(){super.construct(...arguments),this.key&&(this.keyMap={[this.key]:"onClick"})}compose(){return{"aria-hidden":!0,class:{[`b-align-${this.align||"end"}`]:1,"b-icon":1},listeners:{click:"onClick",mousedown:"onMousedown"}}}changeAlign(r){return r}onClick(r){const t=this,{field:i}=t;i.disabled||i.readOnly||(r.key&&r.preventDefault(),i.trigger("trigger",{trigger:t})!==!1&&t.handler&&i.callback(t.handler,i,[r,t]))}onMousedown(r){const t=this.field;!("key"in r)&&w.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout(()=>t.editable=!0,500)),r.preventDefault(),w.getActiveElement(t.input)!==t.input&&t.focus()}},Ue.SpinTrigger=class extends Ue.Trigger{static get $name(){return"SpinTrigger"}static get type(){return"spintrigger"}static get configurable(){return{repeat:{$config:["nullify"],value:!0}}}compose(){return{children:{upButton:{class:{"b-icon":1,"b-spin-up":1}},downButton:{class:{"b-icon":1,"b-spin-down":1}}}}}updateRepeat(r){var t;(t=this.clickRepeater)==null||t.destroy(),this.clickRepeater=r?qd.new({element:this.element},r):null}onClick(r){const t=this,{field:i}=t;i.disabled||i.readOnly||(r.target===t.upButton?i.doSpinUp(r.shiftKey):r.target===t.downButton&&i.doSpinDown(r.shiftKey))}},Ue.Trigger.initClass(),Ue.SpinTrigger.initClass(),$.register(Ue.Trigger,"trigger"),$.register(Ue.SpinTrigger,"spintrigger"),Ue._$name="Field";var si=class extends Ue{static get type(){return"textfield"}static get alias(){return"text"}static get configurable(){return{nullValue:""}}static get $name(){return"TextField"}construct(e){(e==null?void 0:e.inputType)==="hidden"&&(e.hidden=!0),super.construct(...arguments)}};si.initClass(),si._$name="TextField";var jn=class extends si{static get $name(){return"PickerField"}static get type(){return"pickerfield"}static get configurable(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoClose:!0,autoExpand:null,picker:{value:{floating:!0},$config:["lazy","nullify"]},inputType:"text",monitorResize:!0,nullValue:null}}doDestroy(){var e;(e=this.globalTapListener)==null||e.call(this),super.doDestroy()}changeEditable(e){return q.isMobile&&this.initialConfig.editable!==!0&&(e=!1),e}updateEditable(e){var r;const t=this,{element:i,ariaElement:n,nonEditableClickTarget:s}=t,{expand:a}=t.triggers,o=globalThis.matchMedia("(max-width: 410px)").matches;super.updateEditable(...arguments),i.classList.toggle("b-not-editable",!e),e===!1?(q.isMobile&&o&&(a==null||a.hide()),n.removeAttribute("aria-autocomplete"),(r=t.globalTapListener)==null||r.call(t),B.on({element:s,click:l=>{const c=s.getRootNode().elementFromPoint(l.clientX,l.clientY);l.target===s&&c===s&&t.onTriggerClick(l)},thisObj:t})):(a==null||a.show(),n.setAttribute("aria-autocomplete","list"),t.globalTapListener=be.ion({globaltap:"showKeyboard",thisObj:t}))}get nonEditableClickTarget(){return this.input}updateElement(e,r){var t;const i=super.updateElement(e,r),n=this.peekConfig("picker"),s=n?n.isWidget?n.role:(t=this.constructor.resolveType(n.type))==null?void 0:t.$meta.config.role:!1;return this.ariaHasPopup=s,i}changePicker(e,r){throw new Error("changePicker(oldPicker, newPicker) must be implemented in PickerField subclass implementations")}get childItems(){const e=super.childItems;return this._picker&&e.push(this.picker),e}onEditComplete(){super.onEditComplete(),this.autoClosePicker()}onElementResize(e){const r=this;r.pickerVisible&&r.picker.requestAnimationFrame(r.picker.realign,null,r.picker),super.onElementResize(e)}internalOnKeyEvent(e){const r=this;let t=!0;if(e.type==="keydown"&&!r.disabled&&!e.shiftKey&&!e.ctrlKey)if(r.pickerVisible){const{picker:i}=r;e.key==="Escape"?(e.preventDefault(),e.stopImmediatePropagation(),r.hidePicker(),t=!1):i.onInternalKeyDown?i.onInternalKeyDown(e):e.key==="ArrowDown"&&i.focusable&&i.focus()}else e.key==="ArrowDown"&&(e.stopImmediatePropagation(),e.preventDefault(),r.onTriggerClick(e));t&&super.internalOnKeyEvent(e)}onFocusIn(e){const r=this;super.onFocusIn(e),r.autoExpand&&(r.minChars=0,r.onTriggerClick(e),r.ignoreTriggerClick=!0,r.setTimeout(()=>r.ignoreTriggerClick=!1,100))}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}showKeyboard({event:e}){const r=this.input;w.isTouchEvent&&w.getActiveElement(r)===r&&e.target===r&&(be.suspendFocusEvents(),r.blur(),r.focus(),be.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const r=this,{picker:t}=r;r.pickerHideShowListenersAdded||(t.ion({show:"onPickerShow",hide:"onPickerHide",thisObj:r}),r.pickerHideShowListenersAdded=!0),w.setAttributes(r.ariaElement,{"aria-controls":t.id,"aria-expanded":!0}),t.autoClose=r.autoClose,t.show(),t.isVisible&&e&&r.focusPicker()}onPickerShow(){const e=this;e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=be.ion({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=B.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){var e,r;const t=this;t.ariaElement.setAttribute("aria-expanded",!1),t.pickerVisible=!1,t.element.classList.remove("b-open"),t.trigger("togglePicker",{show:!1}),(e=t.pickerTapOutRemover)==null||e.call(t),(r=t.pickerKeyDownRemover)==null||r.call(t)}onPickerTapOut({event:e}){!this.containsFocus&&!this.owns(e.target)&&this.autoClosePicker()}onPickerKeyDown(e){if(e.key==="Tab"&&!this.picker.trapFocus){const r=w.getActiveElement(this.input),t=new KeyboardEvent("keydown",e);this.input.dispatchEvent(t),t.defaultPrevented&&e.preventDefault(),w.getActiveElement(this.input)===r?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}autoClosePicker(){this.autoClose&&this.hidePicker()}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;w.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout(()=>e.readOnly=!1,500)),super.focus()}};jn._$name="PickerField";var Oi=document.createRange(),$r=class extends ${static get $name(){return"List"}static get type(){return"list"}static get configurable(){return{itemCls:"b-list-item",selectedCls:"b-selected",selectIconCls:"b-icon-check",tag:"ul",items:null,displayField:"text",store:null,navigator:!0,scrollable:{overflowX:!1,overflowY:!0},itemsFocusable:!0,multiSelect:!1,toggleAllIfCtrlPressed:!1,selectAllItem:!1,itemTpl(e){let r=O.encodeHtml(e.getValue(this.displayField));return(r==null||r==="")&&(r="&nbsp;"),r},getItemStyle:null,getItemCls:null,groupHeaderTpl(e,r){let t=O.encodeHtml(r);return(t==null||t==="")&&(t="&nbsp;"),`${this.allowGroupSelect?this.itemIconTpl(e):""}${t}`},allowGroupSelect:!0,selected:{$config:"nullify",value:{}},activateOnMouseover:null,role:"listbox",keyMap:{"Ctrl+a":"selectAll"}}}construct(e,...r){var t;const i=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...r);const{element:n}=i,{classList:s}=n;i.multiSelect&&s.add("b-multiselect"),(t=i.store)!=null&&t.count?i.refresh():s.add("b-empty"),B.on({element:n,delegate:i.itemSelector,mouseover:"onMouseOver",click:"onClick",thisObj:i})}doDestroy(){var e;this.detachListeners("store"),(e=this.navigator)==null||e.destroy(),super.doDestroy()}onFocusIn(e){var r;this.restoreActiveItem((r=e._target)==null?void 0:r.closest(this.itemSelector)),super.onFocusIn(e)}contentTpl(){const e=this,r=e.store.records.map((t,i)=>e.itemWrapperTpl(t,i));return e.multiSelect&&e.selectAllItem!==!1&&r.unshift(e.selectAllItemTpl()),tr.tpl`${r}`}itemWrapperTpl(e,r){const{selected:t,getItemStyle:i}=this,n=i?`style="${this.callback(i,this,[e])}"`:"";return tr.tpl`<li ${n} class="${this.getItemClasses(e,r)}" role="option" aria-selected="${t.includes(e)}" data-index="${r}" data-id="${O.encodeHtml(e.id)}" ${this.itemsFocusable?'tabindex="-1"':""}>${this.itemContentTpl(e,r)}</li>`}itemContentTpl(e,r){return"groupRowFor"in e.meta?this.groupHeaderTpl(e,O.capitalize(e.groupChildren[0][e.meta.groupField])):`${this.itemIconTpl(e,r)}${this.itemTpl(e,r)}`}itemIconTpl(e,r){return this.multiSelect?`<i class="b-selected-icon b-icon ${this.selectIconCls}"></i>`:""}selectAllItemTpl(){const e=this.allSelected?"b-selected":"";return`<li class="${this.itemCls} b-select-all-item ${e}" data-noselect data-select-all data-id="select-all">${this.itemIconTpl({})}<div>${this.L("selectAll")}</div></li>`}getItemClasses(e){var r;const t=this,{getItemCls:i}=t,n=(r=t._navigator)==null?void 0:r.activeItem,s=(n==null?void 0:n.dataset.id)==e.id,a="groupRowFor"in e.meta?"b-list-item-group-header":"",o=t.selected.includes(e)||e.isSpecialRow&&e.groupChildren.every(c=>t.selected.includes(c)),l=i?this.callback(i,this,[e]):"";return`${t.itemCls} ${e.cls||""} ${l} ${o?t.selectedCls:""} ${s?t.navigator.focusCls:""} ${a}`}onBeforeStoreLoad(){this.mask(this.L("L{loading}"))}onAfterStoreRequest(){this.unmask()}onStoreChange({source:e,action:r,records:t,record:i,changes:n}){const s=this,{selected:a}=s;switch(r){case"dataset":{a.match(e.storage,!s._externallyOwnedSelection);break}case"remove":a.remove(t);break;case"clear":s.deselectAll();break;case"update":{const{id:o}=n;o&&w.setAttributes(s.contentElement.querySelector(O.encodeAttributeSelector("data-id",o.oldValue)),{"data-id":o.value}),s.refreshItem(i);return}}s.refresh()}onStoreRefresh(){this.refresh()}refresh(){var e;const r=this;if(r.isVisible){const t=(e=r.navigator)==null?void 0:e.activeItem;r.paintListener=null;const i=w.createElementFromTemplate(r.contentTpl(),{fragment:!0});r.clearItems().insertNode(i),t&&r.restoreActiveItem(t),r.refreshCount=(r.refreshCount||0)+1,r.element.classList[r.store.count>0?"remove":"add"]("b-empty"),r.updateSelectAllState()}else r.paintListener||(r.paintListener=r.ion({paint:"refresh",thisObj:r,once:!0}))}clearItems(){const e=this,r=e.contentElement.querySelector(e.itemSelector),t=e.contentElement.lastChild;if(r){const i=e.contentElement.querySelectorAll(`${e.itemSelector}:not(.b-mask)`);Oi.setStartBefore(r),Oi.setEndAfter(i[i.length-1]),Oi.deleteContents()}else t?(Oi.setStartAfter(t),Oi.setEndAfter(t)):(Oi.setStart(e.contentElement,0),Oi.setEnd(e.contentElement,0));return Oi}refreshItem(...e){for(const r of e){const t=this.getItem(r);if(t){const i=this.store.indexOf(r),n=w.createElementFromTemplate(this.itemWrapperTpl(r,i));w.sync(n,t)}}}getItem(e){if(e!=null)return typeof e=="number"?this.contentElement.querySelector(`[data-index="${e<0?this.store.count+e:e}"]`):(e.nodeType===Element.ELEMENT_NODE&&(e=e.dataset.id),(e==null?void 0:e.id)!=null&&(e=e.id),this.contentElement.querySelector(O.encodeAttributeSelector("data-id",e)))}getRecordFromElement(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}updateItems(e){const r=this;r.store&&r.store.autoCreated&&r.store.destroy(),r.store=re.getStore(e)}updateDisabled(e){super.updateDisabled(...arguments),this.navigator&&(this.navigator.disabled=e)}changeSelected(e,r){if(e){let t;e.isCollection?this._externallyOwnedSelection=!0:(Array.isArray(e)?(t=e,e={}):e.values&&(t=e.values,e={...e,values:[]}),e=new $t(e)),e.ion({change:"onSelectionChange",thisObj:this}),this.initialSelection=t}else r==null||r.destroy();return e}get itemSelector(){return`.${this.itemCls}`}get selected(){return this._selected}get store(){return this.getConfig("items"),this._store}changeStore(e){const r=this;if(e instanceof re||(Array.isArray(e)&&(e={data:e}),e=new re(e)),r.detachListeners("store"),e){const t={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:r};e.readUrl&&(t.beforeLoad="onBeforeStoreLoad",t.afterRequest="onAfterStoreRequest"),e.isGrouped&&(r.element.classList.add("b-grouped"),t.groupchange="onStoreRefresh"),e.ion(t)}return e}updateStore(e){const{initialSelection:r}=this;Array.isArray(r)&&(e.count?(this.select(r),this.selected.count||this.onSelectionChange({action:"clear",removed:[]})):e.ion({refresh:()=>this.select(r),once:!0})),this.refresh()}changeNavigator(e,r){const t=this,{element:i}=t;return i&&(e=Ln.reconfigure(r,e?Ln.mergeConfigs({ownerCmp:t,disabled:t.disabled,target:i,keyEventTarget:i},e):null,t),(e==null?void 0:e.keyEventTarget)===i&&!t.itemsTabbable&&(i.tabIndex=0)),e}get minAlignHeight(){const e=this.element.lastElementChild,r=this.minHeight;if(r!=null)return e?Math.min(e.offsetTop+e.offsetHeight,r):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(...e){return this.navigator&&(this.navigator.activeItem=null),super.hide(...e)}show(){const{refreshCount:e}=this,{previousActiveItem:r}=this.navigator;super.minHeight=this._minHeight;const t=super.show(...arguments);return this.refreshCount===e&&this.restoreActiveItem(r,!0),t}restoreActiveItem(e=this.navigator.previousActiveItem,r="nearest"){const t=this,{navigator:i,lastAlignSpec:n}=t;if(e!=null){if(typeof r!="string"){const s=n?n.zone:1;r=s&1?"nearest":s?"start":"end"}e=t.getItem(e),e&&!t.disabled&&(t.scrollable.scrollIntoView(e,{block:r}),i.activeItem=e)}}onMouseOver(e){const r=this,t=e.currentTarget;!w.isTouchEvent&&t&&r.navigator&&r.activateOnMouseover&&r.setTimeout({fn:"handleMouseOver",delay:30,args:[t],cancelOutstanding:!0})}handleMouseOver(e){this.navigator.activeItem=e}onClick(e){const r=e.target.closest(this.itemSelector);r&&this.onItemClick(r,e)}onInternalKeyDown(e){const r=this,t=r.navigator.activeItem;if(!r.disabled)switch(e.key){case" ":if(e.target.nodeName.toUpperCase()==="INPUT"&&!e.target.readOnly)break;case"Enter":t&&(this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}}onItemClick(e,r){const t=this,{allowGroupSelect:i}=t,n=parseInt(e.dataset.index),s=t.store.getAt(n),a=s==null?void 0:s.isSpecialRow;if(!(t.disabled||t.trigger("beforeItem",{item:e,record:s,index:n,event:r,userAction:!0})===!1)){if(t._isUserAction=!0,e.contains(r.target.closest("[data-select-all]")))t.onSelectAllClick(e,r);else if(s&&!e.contains(r.target.closest("[data-noselect]"))&&(!a||i)){const{selected:o}=t,{groupParent:l}=s.instanceMeta(this.store);if(t.multiSelect){let c=o.includes(s),d=s;t.toggleAllIfCtrlPressed&&r.ctrlKey?d=t.store.records:i&&a&&(c=!s.groupChildren.some(u=>!o.includes(u)),e.classList.toggle("b-selected",!c),d=s.groupChildren),o[c?"remove":"add"](d),!a&&l&&i&&t.getItem(l).classList.toggle("b-selected",l.groupChildren.every(h=>o.includes(h)))}else o.splice(0,o.count,s)}t.isDestroyed||(t.lastClicked=s,t.trigger("item",{item:e,record:s,index:n,event:r,userAction:!0}),t._isUserAction=!1)}}onSelectionChange({action:e,removed:r,added:t,replaced:i}){const n=this,{selectedCls:s,unselectedCls:a}=n;let o,l;if(e==="clear")for(l of n.element.querySelectorAll(`.${s}`))l.classList.remove(s),l.setAttribute("aria-selected",!1),a&&l.classList.remove(a);else if(e!=="replaceValues"){for(o of r)l=n.getItem(o),l&&(l.classList.remove(s),l.setAttribute("aria-selected",!1));for(o of t)l=n.getItem(o),l&&(l.classList.add(s),l.setAttribute("aria-selected",!0))}n.selectAllItem&&n.updateSelectAllState()}onSelectAllClick(e){e.classList.contains(this.selectedCls)?this.deselectAll():this.selectAll()}updateSelectAllState(){var e;(e=this.element.querySelector(".b-select-all-item"))==null||e.classList.toggle(this.selectedCls,this.allSelected)}get allSelected(){const{selected:e,store:r}=this;return e.count&&(r.isFiltered?r.records.every(t=>e.includes(t)):r.count===e.count)}selectAll(e){const r=this;(r.multiSelect||!e)&&(r.selected.add(r.store.records),e&&!r.navigator.activeItem&&(r.navigator.activeItem=r.getItem(-1)))}deselectAll(){this.selected.clear()}select(e){const{store:r}=this,{modelClass:t}=r;e=H.asArray(e).reduce((i,n)=>(n=r.getById(t.asId(n)),n&&i.push(n),i),[]),this.selected.add(e)}deselect(e){const{modelClass:r}=this.store;e=H.asArray(e).reduce((t,i)=>(i=this.selected.get(r.asId(i)),i&&t.push(i),t),[]),this.selected.remove(e)}};$r.initClass(),$r.prototype.navigatorClass=Ln,$r._$name="List";var Bn=class extends $r{static get $name(){return"ChipView"}static get configurable(){return{itemCls:"b-chip",multiSelect:!1,closable:!0,iconTpl:null,closeHandler:null}}itemContentTpl(e,r){const t=this;return tr.tpl`${t.iconTpl?this.iconTpl(e):""}
            ${t.itemTpl(e,r)}
            ${t.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){const r=this;r.closable&&r.selected.count&&(e.key==="Delete"||e.key==="Backspace")?r.callback(r.closeHandler,r.owner,[r.selected.values,{isKeyEvent:!0}]):super.onInternalKeyDown(e)}updateClosable(e){this.element.classList[e?"add":"remove"]("b-chips-closable"),this.navigator&&(this.navigator.disabled=!e),this.isConfiguring||this.refresh()}onClick(e){const r=this,t=e.target.closest(`.${r.itemCls}`);if(r.closable&&e.target.classList.contains("b-close-icon")){const i=r.store.getAt(parseInt(t.dataset.index));r.closeHandler?r.callback(r.closeHandler,r.owner,[[i]]):r.store.remove(i)}else super.onClick(e)}};E(Bn,"type","chipview"),Bn.initClass(),Bn._$name="ChipView";var Hm="L{Field.fieldRequired}",ga="L{Field.validateFilter}",ek="L{Combo.recordNotCommitted}",Fe=class extends jn{static get $name(){return"Combo"}static get type(){return"combo"}static get alias(){return"combobox,dropdown"}static get configurable(){return{primaryFilter:{},picker:{type:"list",floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},multiSelect:null,items:null,store:null,valueField:void 0,displayField:"text",pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:e=>e.map(r=>r.value),filterOnEnter:!1,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:"all",filterOperator:"startsWith",caseSensitive:!1,hidePickerOnSelect:null,chipView:{$config:["lazy","nullify"],value:{type:"combochipview"}},chipStore:{$config:["lazy","nullify"],value:{}},filterSelected:null,emptyText:null,value:null,valueCollection:{$config:["nullify","lazy"],value:{}},validateFilter:!0,clearTextOnPickerHide:!0,destroyStore:!1,multiValueSeparator:",",createOnUnmatched:null,role:"combobox",inlinePicker:null,testConfig:{keyStrokeFilterDelay:0},localizeDisplayFields:!1,buildItems:null}}static get queryLast(){return"last"}construct(e){super.construct(...arguments),this.store||(this.items=[]),this.filterOnEnter&&(this.hideTrigger=!0)}startConfigure(e){this.usingRecordAsValue=e.valueField===null,super.startConfigure(...arguments)}afterConfigure(){super.afterConfigure();const e=this;T.hasOwn(e,"_value")||(e._value=e.valueField===e.displayField?"":null,e._lastValue=e._lastValue||e._value)}get childItems(){const{_chipView:e,_picker:r}=this,t=super.childItems;return e&&t.push(e),r&&t.push(r),t}get innerElements(){var e;const r=(e=this._chipView)==null?void 0:e.element,{input:t,inputElement:i}=this;return r&&X.sync({targetElement:t,domConfig:i}),[r||i]}updateInlinePicker(e){e&&(this.element.classList.add("b-inline-picker"),this.getConfig("picker"),this.triggers.expand=null,this.pickerVisible=!0)}hidePicker(){if(!this.inlinePicker)return super.hidePicker(...arguments)}changeChipStore(e){return e&&!(e instanceof re)&&(e=new re(re.mergeConfigs({storage:this.valueCollection},e))),e}updateChipStore(e,r){r==null||r.destroy()}changeChipView(e,r){const t=this;if(t.element.classList[e?"add":"remove"]("b-uses-chipview"),e){const{input:i}=t;return t.chipStore||(t.chipStore={}),xE.reconfigure(r,e,{defaults:{parent:t,insertBefore:i,store:t.chipStore,closable:!t.readOnly,navigator:{type:"combochipnavigator",keyEventTarget:i}}})}r==null||r.destroy()}updateChipView(e){var r;const t=this;t._chipViewEventDetacher=(r=t._chipViewEventDetacher)==null?void 0:r.call(t),t.chipStore=e==null?void 0:e.store,e&&(e.element.appendChild(t.input),t._chipViewEventDetacher=B.on({element:e.element,mousedown:"onChipViewMousedown",thisObj:t}))}updateMultiSelect(e,r){const t=this,{input:i,element:n}=t,s=!t.isConfiguring;let{value:a}=t;if(n.classList[e?"add":"remove"]("b-multiselect"),e){const{chipView:o}=t,{parentNode:l}=i,c=o==null?void 0:o.element;c&&c!==l&&(l.insertBefore(c,i),c.appendChild(i),t.chipView.refresh()),i.value="",s&&(a=H.asArray(a))}else{const o=t._chipView,{parentNode:l}=i,c=o==null?void 0:o.element;c===l&&(c.parentNode.insertBefore(i,c),c.remove(),n.classList.remove("b-uses-chipview")),s&&typeof a!="string"&&(a=a!=null&&a.length?a[0]:null)}s&&(t.value=a)}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(e,r={}){(r.isKeyEvent&&this.input.value===""||!r.isKeyEvent)&&(this._isUserAction=!0,this.valueCollection.remove(e),this._isUserAction=!1)}updateFilterParamName(e){this.hideTrigger!==!1&&(this.hideTrigger=!!e)}updateHideTrigger(e){this.element.classList[e?"add":"remove"]("b-hide-trigger")}updateKeyStrokeFilterDelay(e){this.filterOnInput.delay=e}updateReadOnly(e){super.updateReadOnly(...arguments),this._chipView&&(this._chipView.closable=!e)}updateDisabled(e){super.updateDisabled(...arguments),this._chipView&&(this._chipView.closable=!e)}updateFilterOperator(e){this.primaryFilter&&(this.primaryFilter.operator=e)}get minChars(){const e=this._minChars;return e!=null?e:this.remoteFilter?4:1}get validateFilter(){return this._validateFilter&&!this.createOnUnmatched}get items(){return this.store.allRecords}updateBuildItems(e){e&&(this.items=e.call(this))}changeItems(e){const r=this;if(e==null){if(r.store&&!r.store.isItemStore)return;e=[]}if(r.buildItems&&!(e!=null&&e.length)&&(e=r.buildItems()),e instanceof re){r.store=e;return}const t=r.displayField;let i,n=r.valueField,s;if(Array.isArray(e)?s=e.map(a=>{let o=a;return a instanceof ce?(i=a.constructor,n||(r.valueField=n=i.idField)):typeof a=="string"||typeof a=="number"?(n||(r.valueField=n=r.displayField),o={[n]:a,[t]:a}):(n||(r.valueField=n="value"),Array.isArray(a)&&(o={[n]:a[0],[t]:a[1]})),a.selected&&(r.value=o),o}):(n||(r.valueField=n="value"),s=[],Object.entries(e).forEach(([a,o])=>{s.push({[n]:a,[t]:o})})),r.store)r.store.data=s;else{const a=n===t?{name:"value",dataSource:t}:n;if(!i){class o extends ce{static get idField(){return r.valueField}static set idField(c){super.idField=c}static get fields(){return[a,t]}}i=o}r.store=new re({isItemStore:!0,data:s,idField:n,verifyNoGeneratedIds:!1,modelClass:i})}}get value(){const e=this,{valueCollection:r,valueField:t}=e;if(t==null)return e.multiSelect?r.values.slice():r.first;let i;return e.multiSelect?i=r.count?r.map(n=>n[t]):e._lastValue||[]:i=r.count?r.first[t]:e._lastValue,i}set value(e){super.value=e}get needsInputSync(){return this.usesChipView?!1:!this.editable}changeValue(e,r){var t,i;const n=this;if(e===r){n.syncInputFieldValue(!0);return}if(!n.multiSelect&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiSelect Combo");n.triggerConfig("items"),n.inputting||(t=n._chipView)==null||t.selected.clear(),n.store||(n.items=[]);const{valueField:s,displayField:a,store:o,valueCollection:l,_picker:c}=n,{storage:d}=o,u=(i=n.hidePickerOnSelect)!=null?i:!n.multiSelect,h=n._isUserAction||(c==null?void 0:c._isUserAction)||u&&n.pickerVisible||!1;if(!n.remoteFilter&&o.isAjaxStore&&!o.count){o.ion({load:()=>n.value=e,once:!0,thisObj:n}),n._lastValue=e;return}let g;if(e!=null){const f=Array.isArray(e),m=f?e.slice():[e];if(n.remoteFilter){if(e!=null){if(T.isObject(e)||e.isModel)n.store.data=[e],n.valueCollection.splice(0,n.valueCollection.count,n.store.first);else{const y=n.isConfiguring;n.primaryFilter.setConfig({value:e,disabled:!1}),o.performFilter(!0).then(()=>{if(n.isDestroyed)return;const{isConfiguring:C}=n;n.isConfiguring=y,l.splice(0,l.count,o.allRecords),n.isConfiguring=C})}return}}else o.isFiltered&&(n.primaryFilter.disabled=!0,o.filter());for(let y=0,C=m.length;y<C;y++){let D=m[y];if(D instanceof ce)d.includes(D,!0)||o.add(D);else{const S=T.isObject(D);S&&(D=D[o.modelClass.fieldMap[s].dataSource]),g=d.getBy(a,D)||d.getBy(s,D)||l.getBy(a,D)||l.getBy(s,D),g instanceof Set&&(g=[...g][0]),g?(S&&g.set(m[y]),m[y]=g):(m.splice(y,1),C--,y--)}}const p=!m.length,v=l.generation;l.splice(0,l.count,m),p&&(n._value=f&&e.length===0?null:e,n._lastValue=n._value),(p||l.generation===v)&&n.syncInputFieldValue(),n.syncEmpty(),p&&!n.isConfiguring&&n.triggerFieldChange({value:e,oldValue:r,userAction:h,valid:n.isValid})}else if(l.count)l.clear();else{const f=n._value;n._value=null,n.syncInputFieldValue(),n.syncEmpty(),n.isConfiguring||n.triggerFieldChange({value:e,oldValue:f,userAction:h,valid:n.isValid})}n._lastValue=n._value}hasChanged(e,r){return this.multiSelect?!T.isEqual(e,r):super.hasChanged(...arguments)}onComboStoreChange({action:e}){e!=="filter"&&this.syncInputFieldValue(!0)}syncInputFieldValue(e){var r;this.usesChipView?(r=this.chipView)==null||r.refresh():super.syncInputFieldValue(e)}get usesChipView(){return!!(this.multiSelect&&this._chipView)}get isEmpty(){return this.valueCollection.count===0}get inputValue(){const e=this;let r=e.selected?e.selected[e.displayField]:e.value;return e.displayValueRenderer&&(r=e.callback(e.displayValueRenderer,e,[e.selected,e])),r==null?"":r}get nonEditableClickTarget(){var e;return this.multiSelect&&((e=this.chipView)==null?void 0:e.element)||super.nonEditableClickTarget}changeValueCollection(e,r){if(r==null||r.destroy(),e)return e.isCollection||(e=new $t({internalListeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),e}changePrimaryFilter(e){return e.isCollectionFilter?e.setConfig({disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive}):(typeof e=="function"&&(e={filterBy:e}),e=new dt({id:"primary",disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive,...e})),e}changeStore(e){const r=this,t=[],{valueCollection:i,keyStrokeFilterDelay:n,filterParamName:s}=r;if(Array.isArray(e)){r.items=e;return}let a;if(e){if(e.isStore){const o=e.filters.get("primary");r.remoteFilter&&(e.filterParamName=s),a=e.remoteFilter||e.restfulFilter,o?r.primaryFilter=o:t.push(r.primaryFilter)}else typeof e=="string"?e=re.getStore(e):(e=new(e.readUrl?bt:re)(e),r.destroyStore=!0),a=r.remoteFilter||e.restfulFilter,a&&s&&(e.filterParamName=s,r.encodeFilterParams&&(e.encodeFilterParams=r.encodeFilterParams)),t.push(r.primaryFilter);if(!r.valueField&&!r.usingRecordAsValue&&(r.valueField=e.modelClass.idField),r.filterSelected){const o=l=>!r.containsFocus||!i.includes(l);a?(e.storage.autoFilter=!0,e.storage.addFilter({id:`${r.id}-selected-filter`,filterBy:o})):(t.push(o),e.reapplyFilterOnAdd=!0)}i.addIndex({property:r.displayField,unique:!1}),i.addIndex({property:r.valueField,unique:!0}),t.forEach(o=>e.addFilter(o,!0)),a?r.keyStrokeFilterDelay=Math.max(300,n||0):r.keyStrokeFilterDelay=n!=null?n:10}return e}updateStore(e,r){const t=this,{_picker:i}=t;let n;t.destroyStore&&r&&r.destroy(),i&&(i.store=e),e.storage.addIndex({property:t.displayField,unique:!1}),e.storage.addIndex({property:t.valueField,unique:!0}),n={filter:"onStoreFilter"},t.displayValueRenderer&&((n||(n={})).change="onComboStoreChange"),t.detachListeners("store"),e!=null&&e.storage&&t.valueCollection.match(e.storage),t.syncInputFieldValue(),n&&(n.name="store",n.thisObj=t,e.ion(n))}get remoteFilter(){var e;return!!(this.filterParamName||(e=this._store)!=null&&e.restfulFilter)}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){const{store:e}=this;return this.multiSelect?this.valueCollection.values.slice().sort((r,t)=>e.indexOf(r)-e.indexOf(t))[0]:this.valueCollection.first}onEditComplete(){const e=this,r=e.valueCollection.count;super.onEditComplete(),r&&(e.clearError(ga),e.syncInputFieldValue()),e.required&&!r&&e.setError(Hm)}onTriggerClick(e){var r;const t=this,i="key"in e;if(!(t.ignoreTriggerClick||t.remoteFilter&&t.filterOnEnter)){if(t.pickerVisible)t.hidePicker();else if(!t.readOnly&&!t.disabled)switch((r=t.triggerAction)==null?void 0:r.toLowerCase()){case"all":t.doFilter(null,i);break;case"last":t.doFilter(t.lastQuery,i);break;default:t.doFilter(t.input.value,i)}}}internalOnInput(e){const r=this;r.syncEmpty(),r.syncInputWidth(),r.filterOnInput(e),r.trigger("input",{value:r.input.value,event:e})}filterOnInput(e){const r=this,{value:t}=e.type==="input"?e.target:r.input,i=t.length;r.inputting=!0,r.inlinePicker||i>=r.minChars&&(!r.filterOnEnter||e.key==="Enter")?r.doFilter(t):(r.validateFilter&&!r.remoteFilter&&r[i?"setError":"clearError"](ga),r.hidePicker()),r.inputting=!1}syncInputWidth(){const e=this;if(e.usesChipView){const r=e.input,t=e._inputPadding||(e._inputPadding=w.getEdgeSize(r,"padding","lr")),i=r.value||"",n=w.measureText(i+"W",r,!1,e.element)+t.width;r.style.flex=`1 1 ${Math.ceil(n)}px`}}doFilter(e,r){var t;const i=this,{store:n,picker:s}=i,a=e==null||e==="";i.lastQuery=e,i.primaryFilter.setConfig({value:e,disabled:a}),i.remoteFilter&&n.clear(!0);const o=()=>{const{navigator:l,isVisible:c}=s;n.count?!a&&l&&(l.activeItem=0):!i.remoteFilter&&!a&&(l&&(l.activeItem=null),i.validateFilter&&i.setError(ga)),c&&s.realign()};(t=i.filterPromise=n.filter())==null||t.then(()=>{i.filterPromise=null,o()}),i.inlinePicker||(s!=null&&s.isVisible?s.lastAlignSpec.zone===0&&s.realign():i.showPicker(r)),i.filterPromise||o()}onStoreFilter({source:e}){const r=this,t=r._picker,i=t==null?void 0:t.element.dataset,{count:n}=e;r.remoteFilter&&(n?t&&(t.navigator.activeItem=0):r.validateFilter&&r.setError(ga),r.filterSelected&&r.valueCollection.count&&(e.storage.onFiltersChanged({action:"splice",oldCount:1}),t&&t.refresh())),i&&(r.createOnUnmatched&&!n?i.addNewValue=r.L("L{addNewValue}")(r.primaryFilter.value):i==null||delete i.addNewValue)}onValueCollectionChange({source:e}){var r,t;const i=this,{multiSelect:n,_picker:s}=i,a=(r=i.hidePickerOnSelect)!=null?r:!n,o=n?e.values.slice():e.first,l=e.values.slice(),c=i._isUserAction||(s==null?void 0:s._isUserAction)||a&&i.pickerVisible||!1,d=i._value;a&&i.hidePicker(),!e.count&&i.required?i.setError(Hm):(i.clearError(Hm),i.clearError(ga)),i.validateFilter&&o&&i.clearError(ga),i.filterSelected&&(i.remoteFilter?(i.store.storage.onFiltersChanged({action:"splice",oldCount:1}),i._picker&&i._picker.refresh()):i.store.filter()),i._value=null,i._lastValue=null;const u=i.cacheCurrentValue(i.value);i.syncInputFieldValue(),i.syncEmpty(),i.isConfiguring||(i.triggerFieldChange({value:u,oldValue:d,userAction:c,valid:i.isValid}),(t=i.trigger)==null||t.call(i,"select",{record:o,records:l,userAction:c}),i.defaultAction==="select"&&i.trigger("action",{value:u,record:o,records:l,userAction:c}))}cacheCurrentValue(e){return this._value=e}onValueCollectionNoChange({toAdd:e}){!this.inlinePicker&&!this.multiSelect&&e.length&&this.pickerVisible&&this.picker.hide()}showPicker(){var e;const r=this,{picker:t}=r;r.readOnly||r.inlinePicker||(t.multiSelect=r.multiSelect,super.showPicker(...arguments),r.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),t.restoreActiveItem&&(r.multiSelect?t.restoreActiveItem(((e=t.navigator)==null?void 0:e.previousActiveItem)||r.selected||0,!0):t.restoreActiveItem(r.selected||0,!0)),r.input.focus())}changePicker(e,r){const t=this,i=t.pickerWidth||(e==null?void 0:e.width),n=$r.mergeConfigs({owner:t,store:t.store,selected:t.valueCollection,multiSelect:t.multiSelect,cls:t.listCls,displayField:t.displayField,forElement:t[t.pickerAlignElement],align:{matchSize:i==null,anchor:t.overlayAnchor,target:t[t.pickerAlignElement],minHeight:t.inlinePicker?null:Math.min(3,t.store.count)*40},[t.listItemTpl?"itemTpl":void 0]:t.listItemTpl,width:i,navigator:{keyEventTarget:t.input}},e);return t.inlinePicker&&Object.assign(n,{floating:!1,align:null,activateOnMouseover:!1,maxHeight:null,appendTo:t.element}),e=$r.reconfigure(r,e?n:null,t),e&&(e.element.classList.add("b-combo-picker"),e.element.dataset.emptyText=t.emptyText?t.L(t.emptyText):t.L("L{noResults}"),e.ion({navigate:"onPickerNavigate",thisObj:t}),B.on({element:e.element,pointerdown:s=>t.onPickerNavigate({event:s}),thisObj:t})),e}onPickerNavigate({event:e}){e.target.matches("[data-add-new-value]")&&this.addNewRecord(this.primaryFilter.value)}onPickerHide(){const e=this;super.onPickerHide(),e.multiSelect&&e.clearTextOnPickerHide&&(e.input.value="")}async internalOnKeyEvent(e){const r=this,t=r.input[r.inputValueAttr],i=t.length,{key:n}=e,{store:s,_picker:a,multiSelect:o}=r;if(e.type==="keydown"&&(a!=null&&a.isVisible)&&a.navigator){const{activeItem:l}=a.navigator;if(l&&o&&n===r.multiValueSeparator){r.input.value="",r.primaryFilter.setConfig({value:"",disabled:!0}),s.filter(),a.onItemClick(l,e),a.hide(),e.preventDefault();return}if(!l&&r.createOnUnmatched&&(o&&n===r.multiValueSeparator||n==="Enter")){e.preventDefault(),await r.addNewRecord(t);return}}super.internalOnKeyEvent(...arguments),e.type==="keydown"&&n==="Enter"&&r.filterOnEnter&&i>=r.minChars&&(e.stopPropagation(),r.filterOnInput.now(e))}async addNewRecord(e){var r,t;const i=this,{store:n,_picker:s,valueCollection:a,multiSelect:o,primaryFilter:l}=i,c=n.remoteFilter&&n.autoCommit;i.filterPromise&&await i.filterPromise,c||(l.setConfig({value:"",disabled:!0}),n.filter());const[d]=n.add(i.callback(i.createOnUnmatched,i,[e,i]));if(n.isCommitting){let u;try{await n.commitPromise}catch(h){u=(t=(r=h.response)==null?void 0:r.parsedJson)==null?void 0:t.error}d.isPhantom&&(i.clearError(),i.setError(u||ek,!1,!0),n.remove(d),n.removed.remove(d))}c&&(l.setConfig({value:"",disabled:!0}),n.filter()),i.input.value="",n.includes(d)&&a.splice(o?a.count:0,o?0:a.count,d),s==null||s.hide()}changeCreateOnUnmatched(e){return e===!0&&(e=this.defaultRecordCreater),e}defaultRecordCreater(e){return this.store.createRecord({[this.displayField]:e})}updateLocalization(){var e;super.updateLocalization();const r=this,{displayField:t}=r;let{localizedDisplayFieldsMap:i}=r;if(r.localizeDisplayFields===!0){i||(r.localizedDisplayFieldsMap=i=new Map),!r.store&&r.buildItems&&(r.items=r.buildItems());for(const n of r.items)if(n.id){let s=i.get(n.id);!s&&((e=n[t])!=null&&e.startsWith("L{"))&&(s=n[t],i.set(n.id,s)),s&&(n[t]=r.L(s))}r.syncInputFieldValue()}}};E(Fe,"delayable",{filterOnInput:0});var xE=class extends Bn{static get $name(){return"ComboChipView"}static get type(){return"combochipview"}static get defaultConfig(){return{closeHandler:"up.onChipClose",itemsFocusable:!1,multiSelect:!0,itemTpl(e){return O.encodeHtml(e.getValue(this.owner.displayField))},scrollable:{overflowY:"auto"}}}},tk=class extends Ln{static get $name(){return"ComboChipNavigator"}static get type(){return"combochipnavigator"}static get configurable(){return{allowShiftKey:!0}}onTargetClick(e){const r=this,t=e.target.closest(r.itemSelector);t&&!e.target.classList.contains("b-close-icon")&&(!e.shiftKey&&!t.contains(e.target.closest("[data-noselect]"))&&r.ownerCmp.selected.clear(),r.inClickHandler=!0,r.activeItem=t,r.inClickHandler=!1)}onKeyDown(e){e.key!=="Enter"&&!e.target.selectionStart&&!e.target.selectionEnd&&super.onKeyDown(e)}updateActiveItem(e,r){const t=this.ownerCmp;super.updateActiveItem(e,r),e&&!this.inClickHandler&&t.selected.add(t.getRecordFromElement(e))}navigatePrevious(e){const r=this.ownerCmp;r.navigator.activeItem&&!e.shiftKey&&r.selected.clear(),this.previous?super.navigatePrevious(e):this.activeItem=null}navigateNext(e){const r=this.ownerCmp;r.navigator.activeItem&&!e.shiftKey&&r.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}};Fe.initClass(),xE.initClass(),tk.initClass(),Fe._$name="Combo";var du=class extends Ht{static get $name(){return"UndoRedoBase"}static get type(){return"undoredobase"}static get configurable(){return{project:null,stm:null,text:null,color:null,showZeroActionBadge:null,cls:"b-undo-controls b-toolbar",layoutStyle:{alignItems:"stretch",flexFlow:"row nowrap",overflow:"visible"},items:{undoBtn:{type:"button",icon:"b-icon-undo",tooltip:"L{UndoRedo.UndoLastAction}",onAction:"up.onUndo"},transactionsCombo:{type:"combo",valueField:"idx",editable:!1,store:{},emptyText:"L{UndoRedo.NoActions}",onAction:"up.onTransactionSelected",displayValueRenderer:"up.transactionsDisplayValueRenderer"},redoBtn:{type:"button",icon:"b-icon-redo",tooltip:"L{UndoRedo.RedoLastAction}",onAction:"up.onRedo"}},overflowable:!0}}afterConstruct(){this.updateUndoRedoControls()}updateStm(e){this.detachListeners("undoredo"),e==null||e.ion({name:"undoredo",recordingstop:"updateUndoRedoControls",restoringstop:"updateUndoRedoControls",queueReset:"updateUndoRedoControls",disabled:"updateUndoRedoControls",thisObj:this})}changeItems(e){const{undoBtn:r,redoBtn:t}=e;return this.color&&(r&&(r.color=this.color),t&&(t.color=this.color)),this.text&&(r&&(r.text="L{UndoRedo.Undo}"),t&&(t.text="L{UndoRedo.Redo}")),super.changeItems(e)}updateProject(e){this.stm=e.stm}fillUndoRedoCombo(){const{transactionsCombo:e}=this.widgetMap;e&&(e.items=[[0,"Original data"],...this.stm.queue.map((r,t)=>[t+1,r||`Transaction ${t+1}`])])}updateUndoRedoControls(){const{stm:e,showZeroActionBadge:r}=this,{undoBtn:t,redoBtn:i,transactionsCombo:n}=this.widgetMap;t.badge=e.position||(r?"0":""),i.badge=e.length-e.position||(r?"0":""),t.disabled=!e.canUndo,i.disabled=!e.canRedo,this.fillUndoRedoCombo(),n&&(n.disabled=n.store.count<=1)}transactionsDisplayValueRenderer(e,r){var t;const i=((t=this.stm)==null?void 0:t.position)||0;return`${i} undo actions / ${r.store.count-i-1} redo actions`}onUndo(){this.stm.canUndo&&this.stm.undo()}onRedo(){this.stm.canRedo&&this.stm.redo()}onTransactionSelected(e){const{stm:r}=this,t=r.position-e.value;t>0?r.canUndo&&r.undo(t):t<0&&r.canRedo&&r.redo(-t)}};du.initClass(),du._$name="UndoRedoBase";var Vm=class extends Fe{static get $name(){return"BooleanCombo"}static get type(){return"booleancombo"}static get configurable(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,store:{value:[],$config:"lazy"},value:!1}}changeStore(e,r){const t=this;return super.changeStore(new re({data:[{id:t.positiveValue,text:t.positiveText||t.L("L{Object.Yes}")},{id:t.negativeValue,text:t.negativeText||t.L("L{Object.No}")}]}),r)}};Vm.initClass(),Vm._$name="BooleanCombo";var RE=class extends Ht.mixin(Kd){onChildAdd(e){super.onChildAdd(e),e.ion({click:"resetValueCache",toggle:"onItemToggle",thisObj:this,prio:1e4})}onChildRemove(e){e.un({toggle:"resetValueCache",click:"resetValueCache",thisObj:this}),super.onChildRemove(e)}onItemToggle(e){const r=this;r.resetValueCache(),!r.isSettingValue&&(!r.toggleGroup||e.pressed)&&r.triggerFieldChange({value:r.value,userAction:!0,event:e})}resetValueCache(){this._value=null}createWidget(e){const r=this;return r.constructor.resolveType(e.type||"button").isButton&&(r.color&&!e.color&&(e.color=r.color),r.toggleGroup&&!e.toggleGroup&&(typeof r.toggleGroup=="boolean"&&(r.toggleGroup=RE.generateId("toggleGroup")),e.toggleGroup=r.toggleGroup)),r.columns&&(e.width=`${100/r.columns}%`),e=super.createWidget(e),r.relayEvents(e,["click","action","toggle"]),e}updateRotate(e){this.eachWidget(r=>{r.rotate!==!1&&(r.rotate=e)})}get value(){if(!this._value){const e=[];this.items.forEach(r=>{r.pressed&&r.value!==void 0&&e.push(r.value)}),this._value=e.join(this.valueSeparator)}return this._value}set value(e){const r=this,t=r.value;Array.isArray(e)||(e==null?e=[]:typeof e=="string"?e=e.split(r.valueSeparator):e=[e]),r._value=e.join(r.valueSeparator),r.isSettingValue=!0,r.items.forEach(i=>{i.value!==void 0&&(i.pressed=e.includes(i.value))}),r.isSettingValue=!1,!r.isConfiguring&&t!==r.value&&r.triggerFieldChange({value:r.value,userAction:!1})}updateDisabled(e){this.items.forEach(r=>r.disabled=e||!r.ignoreParentReadOnly&&this.readOnly)}updateReadOnly(e){super.updateReadOnly(e),this.updateDisabled(this.disabled)}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}},ai=RE;E(ai,"$name","ButtonGroup"),E(ai,"type","buttongroup"),E(ai,"configurable",{defaultType:"button",cls:null,items:null,color:null,toggleGroup:null,valueSeparator:",",columns:null,hideWhenEmpty:!0,defaultBindProperty:"value"}),ai.initClass(),ai._$name="ButtonGroup";var fa=class extends Vt{static get $name(){return"CalendarPanel"}static get type(){return"calendarpanel"}static get configurable(){return{layout:"vbox",textContent:!1,date:{$config:{equal:"date"},value:null},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekNumber:null,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onPaint({firstPaint:e}){var r;(r=super.onPaint)==null||r.call(this,...arguments),e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var e;(e=this.tip)==null||e.destroy(),super.doDestroy()}changeMinRowHeight(e){const r=parseInt(w.getStyleValue(this.element,"--min-row-height"),10)||75;return isNaN(e)?e:Math.max(parseInt(e)||0,r)}updateMinRowHeight(e){this.weekElements.forEach(r=>w.setLength(r,"minHeight",e)),this.scrollable={overflowY:e?"auto":!1}}changeMinColumnWidth(e){const r=parseInt(w.getStyleValue(this.element,"--min-column-width"),10)||75;return e==null?e:Math.max(parseInt(e)||0,r)}updateMinColumnWidth(e){const r=this;r.weekdayCells.forEach(t=>w.setLength(t,"minWidth",e)),r.cellElements.forEach(t=>t.matches(`.${r.dayCellCls}`)&&w.setLength(t,"minWidth",e)),r.scrollable={overflowX:e?"auto":!1},r.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromDomEvent(e){const r=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest(`#${this.id} [data-date]`);if(r)return b.parseKey(r.dataset.date)}changeTip(e,r){const t=this;return ve.reconfigure(r,e,{owner:t,defaults:{type:"tooltip",owner:t,id:`${t.id}-cell-tip`,forElement:t.bodyElement,forSelector:`.${t.dayCellCls}`}})}updateTip(e){this.detachListeners("tip"),e==null||e.ion({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(e,r){const t=this;super.updateElement(e,r),t.updateHideNonWorkingDays(t.hideNonWorkingDays),t.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),t.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),t.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),t.cellElements=[];for(let i=0,{length:n}=t.weekDayElements;i<n;i++)t.cellElements.push(t.weekDayElements[i].previousSibling,...t.weekDayElements[i].children)}changeDate(e){if(e=typeof e=="string"?b.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return b.clearTime(e)}updateDate(e){this.month.date=e}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let r=4;r<11;r++)e.setDate(r),this.shortDayNames.push(b.format(e,this.dayNameFormat))}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:b.weekStartDay}updateWeekStartDay(e){const r=this;if(r._month){r.month.weekStartDay=e,r.dayNames=[];for(let t=0;t<7;t++)r.dayNames[t]=r.shortDayNames[r.canonicalDayNumbers[t]];r.refreshCount&&r.refresh()}}updateHideNonWorkingDays(e){var r;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,!!e),(r=this.scrollable)==null||r.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e),this.isConfiguring||this.refresh()}updateHideOtherMonthCells(e){var r;this.element.classList.toggle(this.hideOtherMonthCellsCls,!!e),(r=this.scrollable)==null||r.syncOverflowState()}updateDisableOtherMonthCells(e){var r;this.element.classList.toggle(this.disableOtherMonthCellsCls,!!e),(r=this.scrollable)==null||r.syncOverflowState()}get nonWorkingDays(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=b.nonWorkingDays)}get weekends(){return this._localeWeekends||(this._localeWeekends=b.weekends)}changeNonWorkingDays(e){return T.assign({},e)}updateNonWorkingDays(e){var r;this._month&&(this.month.nonWorkingDays=e,this.refresh(),(r=this.scrollable)==null||r.syncOverflowState())}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return b.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return b.add(e,1,"day")}changeMonth(e,r){const t=this;if(!(e instanceof ha)){if(typeof e=="number"){if(r){r.month=e;return}const i=t.date||b.clearTime(new Date);i.setMonth(e),e={date:i}}e=ha.new({weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks},e)}return e.ion({dateChange:"onMonthDateChange",thisObj:t}),e}onMonthDateChange({source:e,newDate:r,oldDate:t,changes:i}){const n=this;if(n.year=e.year,!n.isConfiguring){if(!n.getCell(r)||i.m||i.y){const{isVisible:s}=n;n.refresh(),n.animateTimeShift&&s&&w.slideIn(n.contentElement,r>t?1:-1)}n.trigger("dateChange",{changes:i,value:r,oldValue:t})}}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const r=this;r.element.classList[e?"add":"remove"]("b-show-week-column"),r.floating&&(r.isAligning||r.realign())}updateSixWeeks(e){this.month&&(this.month.sixWeeks=e,this.refresh())}refresh(){this.doRefresh()}doRefresh(){var e;this.getConfig("element");const r=this,t=r.timeZone!=null?r.timeZone:(e=r.project)==null?void 0:e.timeZone,i=t!=null?Mt.toTimeZone(new Date,t):new Date,{weekElements:n,weekDayElements:s,date:a,month:o,dayCellCls:l,dayHeaderCls:c,disabledCls:d,otherMonthCls:u,weekendCls:h,todayCls:g,nonWorkingDayCls:f,nonWorkingDays:m,canonicalDayNumbers:p,sixWeeks:v}=r;if(i.setHours(0,0,0,0),!a){r.date=i;return}r.trigger("beforeRefresh"),r.getConfig("dayNameFormat");for(let S=0;S<7;S++){const x=r.weekdayCells[S],R=r.canonicalDayNumbers[S],I={[c]:1,[h]:b.weekends[R],[f]:m[R]};r.headerRenderer?(x.innerHTML="",r.callback(r.headerRenderer,r,[x,S,R])):w.setInnerText(x,r.shortDayNames[R]),w.syncClassList(x,I),x.dataset.columnIndex=S,x.dataset.cellDay=R}let y=0,C=0,D=6;for(let S=6;S>=0;S--)if(!m[p[S]]){D=S;break}n[4].classList.toggle("b-hide-display",o.weekCount<5&&!v),n[5].classList.toggle("b-hide-display",o.weekCount<6&&!v),o.eachWeek((S,x)=>{const R=s[y],I=[R.previousSibling,...R.children];n[y].dataset.week=`${S[0]},${S[1]}`,r.weekRenderer?r.callback(r.weekRenderer,r,[I[0],S]):I[0].innerText=S[1];for(let M=0;M<7;M++){const P=x[M],_=P.getDay(),A=b.makeKey(P),z=m[_],Y=I[M+1],V={[l]:1,[d]:r.isDisabledDate(P),[u]:P.getMonth()!==o.month,[h]:b.weekends[_],[g]:P.getTime()===i.getTime(),[f]:z,"b-last-working-day":M===D,"b-first-visible-cell":!(P-(r.firstVisibleDate||-1)),"b-last-visible-cell":!(P-(r.lastVisibleDate||-1)),[`b-day-of-week-${_}`]:1};w.syncClassList(Y,V),Y.dataset.date=A,Y.dataset.cellIndex=C,Y.dataset.columnIndex=M,Y.lastDomConfig&&(delete Y.lastDomConfig.class,delete Y.lastDomConfig.className),r.cellRenderer?r.callback(r.cellRenderer,r,[{cell:Y,date:P,day:_,row:n[y],rowIndex:y,cellIndex:C,columnIndex:M,visibleColumnIndex:r.visibleDayColumnIndex[_],week:S,key:A}]):Y.innerHTML=P.getDate(),C++}y++}),r.visibleWeekCount=y,r.floating&&(r.isAligning||r.realign()),r.refreshCount=(r.refreshCount||0)+1,r.trigger("refresh")}isDisabledDate(e){const r=e.getDay(),{disabledDates:t,nonWorkingDays:i}=this;if(this.disableWeekends&&i[r])return!0;if(t)return Array.isArray(t)?(e=b.clearTime(e,!0),t.some(n=>!(b.clearTime(n,!0)-e))):this.callback(this.disabledDates,this,[e])}get bodyConfig(){const e=super.bodyConfig,r=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...H.fill(7,{class:this.dayHeaderCls}),w.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:r}];for(let t=0;t<6;t++){const i={className:"b-calendar-row b-calendar-week",dataset:{rowIndex:t},children:[{className:"b-week-number-cell"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};r.push(i)}return e}get firstVisibleDate(){if(this.hideOtherMonthCells){const{year:e,month:r}=this.month;return new Date(e,r,1)}for(const e=this,r=e.month.startDate;;r.setDate(r.getDate()+1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[r.getDay()])return r}get lastVisibleDate(){const e=b.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return e;for(const r=this,t=e;;t.setDate(t.getDate()-1))if(!r.hideNonWorkingDays||!r.nonWorkingDays[t.getDay()])return t}getCell(e,r){typeof e!="string"&&(e=b.makeKey(e));const t=this.weeksElement.querySelector(`[data-date="${e}"]`);if(t&&(!r||!t.classList.contains(this.otherMonthCls)))return t}onTipOverCell({source:e,target:r}){e.date=b.parseKey(r.dataset.date)}updateLocalization(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}};fa.initClass(),fa._$name="CalendarPanel";var rk=e=>!e.value,Hn=class extends Ue{static get $name(){return"Checkbox"}static get type(){return"checkbox"}static get alias(){return"check"}static get configurable(){return{inputType:"checkbox",autoCollapse:null,containerDefaults:{syncableConfigs:{disabled:e=>e.disabled||!e.value},syncConfigTriggers:{autoCollapse:1,value:1}},text:"",checkedValue:!0,uncheckedValue:!1,color:null,value:"",toggleGroup:null,localizableProperties:["label","text"]}}construct(e){"checked"in e&&(e=T.assign({},e),e.value=e.checked,delete e.checked),super.construct(e),this.syncHasText()}get textLabelCls(){return"b-checkbox-label"}get innerElements(){return[this.inputElement,{tag:"label",class:this.textLabelCls,for:`${this.id}-input`,reference:"textLabel",html:this.text||""}]}get inputElement(){const e=super.inputElement;return this.toggleGroup&&(e.dataset={group:this.toggleGroup}),e.listeners={click:"internalOnClick",change:"internalOnChange",input:"internalOnInput"},e}get checked(){return this.value}set checked(e){this.value=e}syncHasText(){this.element.classList[this.text?"add":"remove"]("b-text")}updateText(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}afterSyncChildConfigs(e){super.afterSyncChildConfigs(e);let{autoCollapse:r}=this;r&&(r=r===!0?rk:r,e.collapsed=r(this))}assignFieldValue(e,r,t){this.value=t===this.checkedValue||(t===this.uncheckedValue?!1:null)}fetchInputValue(){this.readOnly||(this.value=this.input.checked)}gatherValue(e){var r;const t=this,i=t.value?t.checkedValue:t.uncheckedValue,n=i!==void 0,{valueName:s}=t;n&&(e[s]=i),t.gatherValues(e,n),i===!0&&((r=e[s])==null?void 0:r.value)===i&&delete e[s].value}changeValue(e){return e==="false"?!1:!!e}updateValue(e){var r;const t=this,i=t.input.checked!==e;t.input.checked=e,(r=t.container)==null||r.syncChildConfigs(),i&&!t.inputting&&!t.isConfiguring&&(t.uncheckToggleGroupMembers(),t.triggerChange(!1))}get inputValueAttr(){return"checked"}updateColor(e,r){const t=this.element.classList;r&&t.remove(r),e&&t.add(e)}getToggleGroupMembers(){const e=this,{checked:r,toggleGroup:t,input:i,type:n}=e,s=[];return r&&t&&w.forEachSelector(e.rootElement,`input[type=${n}][data-group=${t}]`,a=>{if(a!==i){const o=$.fromElement(a);o&&s.push(o)}}),s}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach(e=>e.checked=!1)}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnClick(e){return this.readOnly?(e.preventDefault(),!1):this.trigger("click",{event:e})}internalOnChange(e){const r=this;if(r.readOnly&&r.value!==r.input.checked){r.input.checked=r.value;return}r.value=r.input.checked,r.inputting||(r.inputting=!0,r.triggerChange(!0),r.inputting=!1)}updateInputReadOnly(e){}triggerChange(e){const r=this,{checked:t}=r.input,i={checked:t,value:t,userAction:e,valid:!0};if(!t&&e&&r.toggleGroup&&r.getToggleGroupMembers().filter(s=>s.isVisible&&!s.disabled).length||r.trigger("beforeChange",i)===!1)r.input.checked=r._value=!t;else return r.triggerFieldChange(i,!1),e&&r.uncheckToggleGroupMembers(),r.trigger("action",i),r.trigger("change",i),!0}};Hn.initClass(),Hn._$name="Checkbox";var Vn=class extends $r{configure(e){super.configure(e),this.setItems(),this.ion({item:"onColorSelect"})}setItems(){const e=this,{colors:r,colorClasses:t}=e;let i=t||r;e.addNoColorItem&&(i=[...i],i.push(null)),e.items=i.map(n=>!n||typeof n=="string"?{color:n,text:(t?O.capitalize(n):n)||e.L("L{noColor}")}:n)}afterConfigure(){var e;super.afterConfigure(...arguments),(this.addNoColorItem||this.value)&&this.select((e=this.value)!=null?e:null)}updateColors(){this.isConfiguring||this.setItems()}updateAddNoColorItem(){this.isConfiguring||this.setItems()}onColorSelect({record:e}){var r;this.refresh();const t={color:e.color,record:e,bubbles:!0};(r=this.colorSelected)==null||r.call(this,t),this.trigger("colorSelected",t)}select(e){(!e||typeof e=="string")&&(e=this.store.findRecord("color",e!=null?e:null)),e&&super.select(e)}updateColumns(e){this.style=`grid-template-columns:repeat(${e}, 1fr);`}getColorClassName(e){var r,t;return(r=this.colorClasses)!=null&&r.includes(e)||(t=this.colorClasses)!=null&&t.find(i=>i&&i.color===e)?this.colorClassPrefix+e:e?"":"b-no-color"}};E(Vn,"$name","ColorPicker"),E(Vn,"type","colorpicker"),E(Vn,"configurable",{itemsFocusable:!1,navigator:{focusCls:"b-color-active"},itemWrapperTpl(e,r){const{selected:t}=this,{color:i,text:n}=e,s=this.getColorClassName(i);return tr.tpl`
                    <li
                        class="${this.getItemClasses(e,r)} ${s}"
                        role="option"
                        aria-selected="${t.includes(e)}"
                        data-index="${r}"
                        data-id="${O.encodeHtml(i)}"
                        data-btip="${n}"
                        ${this.itemsFocusable?'tabindex="-1"':""}
                        style="${s?"":"background-color: "+i}"
                    ></li>`},colorClasses:null,colorClassPrefix:null,colors:["#45171D","#F03861","#FF847C","#FECEA8","#A5F2E7","#AA83F3","#8983F3","#A10054","#073059","#2866AB","#5FBDC5","#D8D95C","#FFDEDE","#F7F3CE","#C5ECBE","#3E3E3E","#405559","#68868C","#EDEDED","#D3D6DB","#3A4750","#303841","#BE3144"],addNoColorItem:!0,columns:6,colorSelected:null}),Vn.initClass(),Vn._$name="ColorPicker";var Nn=class extends Fe{configure(e){var r;const t=(r=e.picker)!=null?r:{};e.colors&&(t.colors=e.colors),"addNoColorItem"in e&&(t.addNoColorItem=e.addNoColorItem),e.picker=t,super.configure(e)}updatePicker(e){e&&(this.items=e.store.records)}updateColors(e){this.isConfiguring||(this.picker.colors=e)}updateAddNoColorItem(e){this.isConfiguring||(this.picker.addNoColorItem=e)}set value(e){this.store||(this.items=[],this.store=this.picker.store),e||(e=this.store.findRecord("color",null)),super.value=e}showPicker(){this.picker.refresh(),super.showPicker(...arguments)}get value(){return super.value}syncInputFieldValue(...e){var r;const t=this,{value:i}=t;let n=(r=t.picker)==null?void 0:r.getColorClassName(i);n||(t.colorBox.style.color=i),n="b-colorbox "+n,t.colorBox.className=n,t.showBoxForNoColor||t.element.classList.toggle("b-colorless",!i),super.syncInputFieldValue(...e)}get innerElements(){return[{reference:"colorBox",className:"b-colorbox"},...super.innerElements]}};E(Nn,"$name","ColorField"),E(Nn,"type","colorfield"),E(Nn,"configurable",{displayField:"text",valueField:"color",editable:!1,picker:{type:"colorpicker",align:{align:"t100-b100",matchSize:!1}},showBoxForNoColor:!0,colors:null,addNoColorItem:!0}),Nn.initClass(),Nn._$name="ColorField";var Li=class extends Vt{construct(e){super.construct({year:new Date().getFullYear(),...e}),B.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}get focusElement(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}getYearButton(e){return this.contentElement.querySelector(`.b-yearpicker-year[data-year="${e}"]`)}get value(){return this.year}set value(e){this.year=e}onYearClick({target:e}){const r=Math.min(Math.max(parseInt(e.innerText),this.minYear||1),this.maxYear||9999);this.year===r?this.trigger("select",{oldValue:r,value:r}):this.year=r}handleTitleClick(e){this.trigger("titleClick",e)}previous(){this.startYear=this.startYear-this.yearButtonCount}next(){this.startYear=this.endYear+1}ingestYear(e){if(!isNaN(e))return T.isDate(e)?e.getFullYear():e}changeYear(e){if(e=this.ingestYear(e))return Math.min(Math.max(e,this.minYear||1),this.maxYear||9999)}updateYear(e,r){const t=this;!t.startYear||e>t.endYear?t.startYear=e:e<t.startYear&&(t.startYear=e-(t.yearButtonCount-1)),t.isConfiguring||t.trigger("select",{oldValue:r,value:e})}get endYear(){return this.startYear+this.yearButtonCount-1}changeStartYear(e){if(e=this.ingestYear(e))return e=this.minYear?Math.max(e,this.minYear):e,this.maxYear?Math.min(e,this.maxYear-(this.yearButtonCount-1)):e}async updateStartYear(e,r){this.isVisible&&w.slideIn(this.contentElement,Math.sign(e-r))}composeBody(){this.getConfig("year");const{startYear:e}=this,r=super.composeBody(),t=r.children[this.tbar?1:0].children=[];this.widgetMap.title.text=`${`000${e}`.slice(-4)} - ${`000${this.endYear}`.slice(-4)}`;for(let i=0,n=e;i<this.yearButtonCount;i++,n++)t.push({tag:"button",dataset:{year:n},class:{"b-yearpicker-year":1,"b-selected":n===this.year},text:`000${n}`.slice(-4)});return r}};E(Li,"$name","YearPicker"),E(Li,"type","yearpicker"),E(Li,"configurable",{textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"b-icon b-icon-previous",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"b-icon b-icon-next",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null}),Li.initClass(),Li._$name="YearPicker";var Nm=class extends si{static get $name(){return"DisplayField"}static get type(){return"displayfield"}static get alias(){return"display"}static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",id:`${this.id}-input`,reference:"displayElement",html:this.template?this.template(this.value):O.encodeHtml(this.value)}}};Nm.initClass(),Nm._$name="DisplayField";var TE=()=>b.getMonthNames().map((e,r)=>[r,e]),ME=(e,r)=>e.valueOf()-r.valueOf(),ik=Object.freeze([]),nk=class extends Fe{static get $name(){return"ReadOnlyCombo"}static get type(){return"readonlycombo"}static get configurable(){return{editable:!1,inputAttributes:{tag:"div",tabIndex:-1},inputValueAttr:"innerHTML",highlightExternalChange:!1,monitorResize:!1,triggers:{expand:!1},picker:{align:{align:"t-b",axisLock:!0,matchSize:!1},cls:"b-readonly-combo-list",scrollable:{overflowX:!1}}}}};nk.initClass();var Rl=class extends fa{static get $name(){return"DatePicker"}static get type(){return"datepicker"}static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{value:new Date,$config:{equal:"date"}},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"b-icon b-icon-first",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}"},prevMonth:{cls:"b-icon b-icon-previous",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}"},fields:{type:"container",cls:"b-datepicker-title",items:{monthField:{type:"readonlycombo",cls:"b-datepicker-monthfield",items:TE(),internalListeners:{select:"up.onMonthPicked"}},yearButton:{type:"button",cls:"b-datepicker-yearbutton",internalListeners:{click:"up.onYearPickerRequested"}}}},nextMonth:{cls:"b-icon b-icon-next",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}"},nextYear:{cls:"b-icon b-icon-last",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}"}}},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{value:null,$config:{equal:"date"}},maxDate:{value:null,$config:{equal:"date"}},focusDisabledDates:null,multiSelect:!1,selection:{$config:{equal:(e,r)=>e&&e.equals(r)},value:null},editMonth:!0,dayNameFormat:"dd",trapFocus:!0,role:"grid",focusDescendant:!0,alwaysRefreshOnMonthChange:null}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}construct(e){const r=this;super.construct(e),r.externalCellRenderer=r.cellRenderer,r.cellRenderer=r.internalCellRenderer,r.element.setAttribute("aria-activedescendant",`${r.id}-active-day`),r.weeksElement.setAttribute("role","grid"),r.weekElements.forEach(t=>t.setAttribute("role","row")),r.element.setAttribute("ariaLabelledBy",r.widgetMap.fields.id),B.on({element:r.weeksElement,click:{handler:"onCellClick",delegate:`.${r.dayCellCls}:not(.${r.disabledCls}):not(.${r.outOfRangeCls})`},mousedown:{handler:"onCellMousedown",delegate:`.${r.dayCellCls}`},thisObj:r}),r.widgetMap.monthField.readOnly=r.widgetMap.yearButton.disabled=!r.editMonth,r.refresh.flush()}afterHide(){var e;(e=this._yearPicker)==null||e.hide(),super.afterHide(...arguments)}doDestroy(){var e,r;(e=this.yearButton)==null||e.destroy(),(r=this.monthField)==null||r.destroy(),super.doDestroy()}get focusElement(){return this.weeksElement.querySelector(`.${this.dayCellCls}[tabIndex="0"]`)}doRefresh(){const e=this,r=e.focusElement,t=b.betweenLesser(e.activeDate,e.month.startDate,e.month.endDate)?e.activeDate:e._activeDate=e.date;super.doRefresh(...arguments);const i=b.parseKey(r==null?void 0:r.dataset.date);t-i&&e.syncActiveDate(t,i)}internalCellRenderer({cell:e,date:r}){const t=this,{activeCls:i,selectedCls:n,externalCellRenderer:s}=t,a=t.isSelectedDate(r),o={[i]:i&&t.isActiveDate(r),[n]:a,[t.outOfRangeCls]:t.minDate&&r<t.minDate||t.maxDate&&r>t.maxDate};if(a&&t.multiSelect){const l=!t.isSelectedDate(b.add(r,-1,"d")),c=!t.isSelectedDate(b.add(r,1,"d"));o["b-range-start"]=l,o["b-range-end"]=c,o["b-in-range"]=!l&&!c}w.updateClassList(e,o),e.innerHTML=`<div class="b-datepicker-cell-inner">${r.getDate()}</div>`,e.setAttribute("role","gridcell"),e.setAttribute("aria-label",b.format(r,"MMMM D, YYYY")),t.isActiveDate(r)?e.id=`${t.id}-active-day`:e.removeAttribute("id"),s&&(arguments[0].cell=e.firstChild,t.callback(s,this,arguments))}onCellMousedown(e){const r=e.target.closest("[data-date]");e.preventDefault(),r.focus(),this.activeDate=b.parseKey(r.dataset.date)}onCellClick(e){const r=e.target.closest("[data-date]");this.onUIDateSelect(b.parseKey(r.dataset.date),e)}onMonthDateChange({newDate:e,changes:r}){this.getConfig("tbar"),super.onMonthDateChange(...arguments),(r.m||r.y)&&(this.widgetMap.monthField.value=e.getMonth(),this.widgetMap.yearButton.text=e.getFullYear())}onUIDateSelect(e,r){const t=this,{lastClickedDate:i,multiSelect:n}=t;t.lastClickedDate=e,t.isDisabledDate(e)||(t.activatingEvent=r,n?t.handleMultiSelect(i,e,r):(t.selection=e,t.floating&&t.hide()),t.activatingEvent=null)}handleMultiSelect(e,r,t){const i=this,{multiSelect:n}=i,s=i._selection||(i._selection=new Tl),a=s.dates,o=n==="range",{size:l,generation:c}=s,d=l&&{[b.makeKey(b.add(a[0],-1,"d"))]:1,[b.makeKey(a[0])]:1,[b.makeKey(a[a.length-1])]:1,[b.makeKey(b.add(a[a.length-1],1,"d"))]:1},u=s.has(r),h=u?"delete":"add",g=o&&(d==null?void 0:d[b.makeKey(r)]);if(t.ctrlKey)(n===!0||!l||g)&&(s[h](r),o&&!s.has(i.rangeStartDate)&&i.rangeStartDate.setDate(i.rangeStartDate.getDate()+(r<a[1]?1:-1)));else if(t.shiftKey&&l){const[m,p]=[new Date(o?i.rangeStartDate||(i.rangeStartDate=a[0]):e),r].sort(ME);o&&s.clear();for(const v=m;v<=p;v.setDate(v.getDate()+1))s.add(v)}else s.has(r)&&s.size===1||(s.clear(),s.add(r));const f=s.size;f===1?i.rangeStartDate=r:f||(i.rangeStartDate=null),s.generation!==c&&i.updateSelection(s)}changeSelection(e){const r=this;let t,i;if(e)if(e.forEach||(e=[e]),e.forEach((n,s)=>e[s]=r.changeDate(n)),i=e[0],e.sort(ME),r.multiSelect==="range"&&e.length===2){t=new Tl;for(const n=new Date(e[0]);n<=e[1];n.setDate(n.getDate()+1))t.add(n)}else i=e[0],t=new Tl(e);else t=new Tl;return i&&(r.activeDate=r.rangeStartDate=b.clearTime(i)),t}updateMultiSelect(e){this.element.classList.toggle("b-multiselect",!!e),e||(this.selection=[...this.selection][0])}updateSelection(e){const r=this,{dates:t}=e,i=r.multiSelect==="range"?[t[0],t[t.length-1]]:t;t.length&&(r.date=t[0]),r.isConfiguring||(r.refresh.now(),r.trigger("selectionChange",{selection:i,userAction:!!r.activatingEvent}))}get selection(){const{_selection:e}=this,r=e?e.dates:ik;return this.multiSelect==="range"&&r.length?[r[0],r[r.length-1]]:r}onInternalKeyDown(e){const r=this,t=e.key.trim()||e.code,i=r.activeDate;let n=new Date(i);if(t==="Escape"&&r.floating)return r.hide();if(i&&r.weeksElement.contains(e.target)){do switch(t){case"ArrowLeft":e.preventDefault(),e.ctrlKey?n=r.gotoPrevMonth():n.setDate(n.getDate()-1);break;case"ArrowUp":e.preventDefault(),n.setDate(n.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?n=r.gotoNextMonth():n.setDate(n.getDate()+1);break;case"ArrowDown":e.preventDefault(),n.setDate(n.getDate()+7);break;case"Enter":return r.onUIDateSelect(i,e)}while(r.isDisabledDate(n)&&!r.focusDisabledDates);if(r.minDate&&n<r.minDate||r.maxDate&&n>r.maxDate)return;r.activeDate=n}}changeMinDate(e){return e&&fa.prototype.changeDate.apply(this,arguments)}updateMinDate(e){this._yearpicker&&(this._yearpicker.minYear=e==null?void 0:e.getFullYear()),this.refresh()}changeMaxDate(e){return e&&fa.prototype.changeDate.apply(this,arguments)}updateMaxDate(e){this._yearpicker&&(this._yearpicker.maxYear=e==null?void 0:e.getFullYear()),this.refresh()}changeDate(e){return b.clamp(super.changeDate(e),this.minDate,this.maxDate)}updateDate(e){const r=this;r.isConfiguring&&!r.initializingActiveDate&&(r.selection=e),(!r.month.date||e.getMonth()===r.month.month||!r.getCell(e)||r.alwaysRefreshOnMonthChange||r.isNavigating)&&super.updateDate(e)}changeActiveDate(e,r){if(this.trigger("beforeActiveDateChange",{activeDate:e,oldActiveDate:r})!==!1){if(e=e?this.changeDate(e):this.date||(this.date=b.clearTime(new Date)),isNaN(e))throw new Error("DatePicker date ingestion must be passed a Date, or a YYYY-MM-DD date string");return b.clamp(e,this.minDate,this.maxDate)}}updateActiveDate(e,r){const t=this,{isConfiguring:i}=t;(i||!t.getCell(e))&&(t.initializingActiveDate=i,t.date=e,t.initializingActiveDate=!1),!i&&!t.refresh.isPending&&t.syncActiveDate(e,r)}syncActiveDate(e,r){const t=this,{activeCls:i}=t,n=t.getCell(e),s=r&&t.getCell(r),a=w.getActiveElement(t.element);n.setAttribute("tabIndex",0),i&&n.classList.add(i),n.id=`${t.id}-active-day`,t.weeksElement.contains(a)&&n.focus(),s&&s!==n&&(s.removeAttribute("tabIndex"),i&&s.classList.remove(i),s.removeAttribute("id"))}set value(e){const r=this,{selection:t,duration:i}=r;if(e){if(e=r.changeDate(e,r.value),r.multiSelect==="range"&&(t==null?void 0:t.length)===2){b.betweenLesserEqual(e,...t)||(e<t[0]?r.selection=[e,b.add(e,i-1,"d")]:r.selection=[b.add(e,-(i-1),"d"),e]),r.date=r.activeDate=e;return}e!==void 0&&(r.selection=e)}else r.date=new Date,r.selection=null}get value(){return this.selection[this.selection.length-1]}get duration(){return this.multiSelect==="range"?b.diff(...this.selection,"d")+1:1}gotoPrevYear(){return this.goto(-1,"year")}gotoPrevMonth(){return this.goto(-1,"month")}gotoNextMonth(){return this.goto(1,"month")}gotoNextYear(){return this.goto(1,"year")}goto(e,r){const t=this,{activeDate:i}=t,n=i&&t.getCell(i);let s;r==="month"&&n&&(i==null?void 0:i.getMonth())===t.month.month+e?s=i:s=b.add(n?i:t.date,e,r);const a=new Date(s);a.setDate(1);const o=b.add(b.add(a,1,"month"),-1,"day");if(t.minDate&&e<0&&o<t.minDate||t.maxDate&&e>0&&a>t.maxDate)return;t.isNavigating=!0;const l=t.date=s;return n&&(t.activeDate=s),t.isNavigating=!1,l}isActiveDate(e){return!(e-this.activeDate)}isSelectedDate(e){var r;return(r=this._selection)==null?void 0:r.has(e)}onMonthPicked({record:e,userAction:r}){var t;r&&(this.activeDate=b.add(this.activeDate,e.value-this.activeDate.getMonth(),"month"),(t=this.focusElement)==null||t.focus())}onYearPickerRequested(){const{yearPicker:e}=this;e.isVisible?e.hide():(e.year=e.startYear=this.activeDate.getFullYear(),e.show(),e.focus())}onYearPickerTitleClick(){this.yearPicker.hide()}onYearPicked({value:e,source:r}){const t=new Date(this.activeDate);t.setFullYear(e),this.activeDate=t,this.focusElement&&w.focusWithoutScrolling(this.focusElement),r.hide()}changeYearPicker(e,r){var t,i;return Li.reconfigure(r,e?Li.mergeConfigs({owner:this,appendTo:this.element,minYear:(t=this.minDate)==null?void 0:t.getFullYear(),maxYear:(i=this.maxDate)==null?void 0:i.getFullYear()},e):null,this)}get childItems(){const{_yearPicker:e}=this,r=super.childItems;return e&&r.push(e),r}updateLocalization(){const{monthField:e}=this.widgetMap,r=TE();!this.isConfiguring&&!r.every((t,i)=>t[1]===e.store.getAt(i).text)&&(r[e.value].selected=!0,e.items=r),super.updateLocalization()}},Tl=class extends Set{add(e){return e=b.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.add(e)}delete(e){return e=b.makeKey(e),this.has(e)&&this.generation++,super.delete(e)}has(e){return super.has(b.makeKey(e))}clear(){return this.size&&this.generation++,super.clear()}equals(e){return Array.isArray(e)&&(e=new Tl(e)),e.size===this.size&&[...this].every(r=>e.has(r))}get dates(){return[...this].sort().map(e=>b.parseKey(e))}};Rl.initClass(),Rl._$name="DatePicker";var ma=class extends jn{static get $name(){return"DateField"}static get type(){return"datefield"}static get alias(){return"date"}static get configurable(){return{format:"L",strictParsing:!1,fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:null,weekStartDay:null,picker:{type:"datepicker",role:"dialog",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null}}changePicker(e,r){const t=this,i={owner:t,forElement:t[t.pickerAlignElement],minDate:t.min,maxDate:t.max,weekStartDay:t._weekStartDay,align:{anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},onSelectionChange:({selection:s,source:a})=>{a.isVisible&&(t._isUserAction=t._isPickerInput=!0,t.value=s[0],t._isPickerInput=t._isUserAction=!1,a.hide())}};t.calendarContainerCls&&(i.cls=t.calendarContainerCls),t.value?i.value=t.value:i.activeDate=new Date;const n=Rl.reconfigure(r,e,{owner:t,defaults:i});return n==null||n.refresh.flush(),n}get backShiftDate(){return b.add(this.value,-1*this._step.magnitude,this._step.unit)}onBackClick(){const e=this,{min:r}=e;if(!e.readOnly&&e.value){const t=e.backShiftDate;(!r||r.getTime()<=t)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}get forwardShiftDate(){return b.add(this.value,this._step.magnitude,this._step.unit)}onForwardClick(){const e=this,{max:r}=e;if(!e.readOnly&&e.value){const t=e.forwardShiftDate;(!r||r.getTime()>=t)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}showPicker(e){if(this.readOnly)return;const r=this,{_picker:t}=r;if(t){const i={minDate:r.min,maxDate:r.max};r.value?i.value=r.value:t.activeDate||(i.activeDate=new Date),t.setConfig(i)}super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let r=e.value;if(r){const{min:t,max:i,validateDateOnly:n}=e;if(n&&(r=b.clearTime(r,!1)),t&&r<t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(i&&r>i)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e){const r=this;return e!=null&&(b.isDate(e)||(typeof e=="string"?e=b.parse(e,r.format,r.strictParsing)||b.parse(e,r.fallbackFormat,r.strictParsing):e=new Date(e)),b.isValidDate(e))?(!r.min||e-r.min>-b.MS_PER_DAY)&&(!r.max||e<=r.max)?r.transformTimeValue(e):e:null}transformTimeValue(e){const r=this,{keepTime:t}=r;if(e=b.clone(e),!t)b.clearTime(e,!1);else if(t!=="entered"){const i=b.parse(t,r.timeFormat);b.isValidDate(i)?b.copyTimeValues(e,i):b.isValidDate(r.value)&&b.copyTimeValues(e,r.value)}else r._isPickerInput&&b.isValidDate(r.value)&&b.copyTimeValues(e,r.value);return e}changeMin(e){return this.transformDateValue(e)}updateMin(e){const{input:r,_picker:t}=this;r&&(e==null?r.removeAttribute("min"):r.min=e),t&&(t.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e)}updateMax(e){const{input:r,_picker:t}=this;r&&(e==null?r.removeAttribute("max"):r.max=e),t&&(t.maxDate=e),this.syncInvalid()}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:b.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,r){const t=this,i=t.transformDateValue(e);if(e&&!i){t.setError("L{invalidDate}");return}if(t.clearError("L{invalidDate}"),t.hasChanged(r,i))return super.changeValue(i,r);t.inputting||t.syncInputFieldValue()}updateValue(e,r){const t=this._picker;t&&!this.inputting&&(t.value=t.activeDate=e),super.updateValue(e,r)}changeStep(e,r){const t=typeof e;if(!e)return null;if(t==="number"?e={magnitude:Math.abs(e),unit:r?r.unit:"day"}:t==="string"&&(e=b.parseDuration(e)),e&&e.unit&&e.magnitude)return e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,r){return e!=null&&e.getTime&&(r!=null&&r.getTime)&&this.keepTime!=="entered"?!b.isEqual(b.clearTime(e),b.clearTime(r)):super.hasChanged(e&&e.getTime(),r&&r.getTime())}get inputValue(){const e=this.value;return e?b.format(e,this.format):""}updateFormat(){this.isConfiguring||this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){super.internalOnKeyEvent(e),e.key==="Enter"&&this.isValid&&this.picker.hide()}};ma.initClass(),ma._$name="DateField";var sk=e=>e.ctrlKey&&e.preventDefault(),zm=class extends Ue{static get $name(){return"NumberField"}static get type(){return"numberfield"}static get alias(){return"number"}static get configurable(){return{min:null,max:null,step:1,largeStep:0,value:null,format:"",decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const r=this;r.input.addEventListener("dblclick",()=>{r.select()}),typeof r.changeOnSpin=="number"&&(r.bufferedSpinChange=r.buffer(r.triggerChange,r.changeOnSpin))}acceptValue(e,r){let t=!isNaN(e);if(t&&!this.hasTextSelection){t=!1;const i=this.input.value,n=parseFloat(i);i!==r&&(t=!this.acceptValue(n,i))}return t}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if(e.type==="keydown"){const r=this,t=e.key;let i;if(t==="ArrowUp")r.doSpinUp(e.shiftKey),i=!0;else if(t==="ArrowDown")r.doSpinDown(e.shiftKey),i=!0;else if(!e.altKey&&!e.ctrlKey&&t&&t.length===1){const n=r.getAfterValue(t),s=r.formatter.parseStrict(n);i=!(s===r.value||n==="-"&&(isNaN(r.min)||r.min<0))&&!r.acceptValue(s,n)}t==="Enter"&&r._changedBySilentSpin&&(r.triggerChange(e,!0),r._changedBySilentSpin=!1),i&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const r=this;if(r.readOnly)return;let t=(r.value||0)+(e?r.largeStep:r.step);r.okMin(t)||(t=r.min),r.okMax(t)&&r.applySpinChange(t)}doSpinDown(e=!1){const r=this;if(r.readOnly)return;let t=(r.value||0)-(e?r.largeStep:r.step);r.okMax(t)||(t=r.max),r.okMin(t)&&r.applySpinChange(t)}applySpinChange(e){const r=this;r._isUserAction=!0,r.changeOnSpin!==!0&&(r._changedBySilentSpin=!0,r.silenceChange=!0,r.bufferedSpinChange&&r.bufferedSpinChange(null,!0)),r.value=e,r._isUserAction=!1,r.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){var r,t,i;super.onFocusOut(...arguments);const n=this,{input:s}=n,a=s.value,o=n.formatter.truncate(a),l=isNaN(o)?a:n.formatValue(o);(i=(t=(r=n.triggers)==null?void 0:r.spin)==null?void 0:t.clickRepeater)==null||i.cancel(),n.lastTouchmove=null,a!==l&&(s.value=l),n._changedBySilentSpin&&(n.triggerChange(e,!0),n._changedBySilentSpin=!1)}internalOnInput(e){const r=this,{formatter:t,input:i}=r,{parser:n}=t,s=i.value,a=n.decimalPlaces(s);if(t.truncator&&a){let o=s;const l=t.truncate(s);if(!isNaN(l)&&(o=r.formatValue(l),n.decimalPlaces(o)<a)){const c=s.length-r.caretPos;i.value=o,r.caretPos=o.length-c}}super.internalOnInput(e)}formatValue(e){return this.formatter.format(e)}changeFormat(e){const r=this;if(e===""){const{leadingZeroes:t,decimalPrecision:i}=r;e=t?`${t}>9`:null,i!=null?e=`${e||""}9.${"#".repeat(i)}`:e&&(e+=".*")}return e}get formatter(){const e=this,r=e.format;let t=e._formatter;return(!t||e._lastFormat!==r)&&(t=Rr.get(e._lastFormat=r),e._formatter=t),t}updateStep(e){var r;const t=this;t.element.classList.toggle("b-hide-spinner",!e),t._step=e,e&&q.isMobile?t.touchMoveListener||(t.touchMoveListener=B.on({element:t.input,touchmove:"onInputSwipe",thisObj:t,throttled:{buffer:150,alt:sk}})):(r=t.touchMoveListener)==null||r.call(t)}onInputSwipe(e){const{lastTouchmove:r}=this;if(r){const t=e.screenX-r.screenX,i=r.screenY-e.screenY,n=Math.abs(t)>Math.abs(i)?t:i;this[`doSpin${n>0?"Up":"Down"}`]()}e.preventDefault(),this.lastTouchmove=e}changeLargeStep(e){return e||this.step*10}get validity(){const e=this.value,r={};return e!=null&&(r.rangeUnderflow=!this.okMin(e),r.rangeOverflow=!this.okMax(e)),r.valid=!r.rangeUnderflow&&!r.rangeOverflow,r}changeValue(e,r){const t=this;if(e||e===0){let i;typeof e!="number"&&(e=typeof e=="string"?t.formatter.parse(e):Number(e),i=isNaN(e),i&&(e="")),!i&&t.format&&(e=t.formatter.round(e))}else e=void 0;return super.changeValue(e,r)}get inputValue(){let e=this.value;return e!=null&&this.format&&(e=this.formatValue(e)),e}};zm.initClass(),zm._$name="NumberField";var zn=class extends Vt{construct(e){super.construct(e),this.refresh()}updateSeconds(e){this.widgetMap.second[e?"show":"hide"]()}onFieldChange(){!this.isConfiguring&&!this.isRefreshing&&(this.value=this.pickerToTime())}onAmPmButtonClick({source:e}){this._pm=e.ref==="pmButton",this._value&&(this.value=this.pickerToTime())}onInternalKeyDown(e){var r;const t=this;switch(e.key){case"Escape":t.triggerTimeChange(t._initialValue),t.hide(),e.preventDefault();return;case"Enter":t.value=t.pickerToTime(),t.hide(),e.preventDefault();return}(r=super.onInternalKeyDown)==null||r.call(this,e)}pickerToTime(){const e=this,r=e._pm,{hour:t,minute:i,second:n}=e.widgetMap;t.format=e._is24Hour?"2>9":null;let s=t.value,a=new Date(e.value);return e._is24Hour||(r&&s<12&&(s=s+12),!r&&s===12&&(s=0)),a.setHours(s),a.setMinutes(i.value),e.seconds&&a.setSeconds(n.value),e._min&&(a=b.max(e._min,a)),e._max&&(a=b.min(e._max,a)),a}triggerTimeChange(e){this.trigger("timeChange",{time:e})}updateInitialValue(e){this.value=e}changeValue(e){return e&&(e=typeof e=="string"?b.parse(e,this.format):e),this.isVisible||(this._initialValue=e),e!=null?e:b.getTime(0)}updateValue(e){this.isVisible&&this.triggerTimeChange(e),this.refresh()}updateFormat(e){this._is24Hour=b.is24HourFormat(e),this.refresh()}changeMin(e){return typeof e=="string"?b.parse(e,this.format):e}changeMax(e){return typeof e=="string"?b.parse(e,this.format):e}refresh(){const e=this;if(!e.isConfiguring&&e.value){e.isRefreshing=!0;const{hour:r,minute:t,second:i,amButton:n,pmButton:s}=e.widgetMap,a=e.value,o=e._is24Hour,l=a.getHours(),c=e._pm=l>=12;e.element.classList[o?"add":"remove"]("b-24h"),r.min=o?0:1,r.max=o?23:12,r.value=o?l:l%12||12,t.value=a.getMinutes(),i.value=a.getSeconds(),n.pressed=!c,s.pressed=c,n.hidden=s.hidden=o,e.isRefreshing=!1}}};E(zn,"$name","TimePicker"),E(zn,"type","timepicker"),E(zn,"configurable",{floating:!0,layout:"hbox",items:{hour:{label:"L{TimePicker.hour}",type:"number",min:0,max:23,highlightExternalChange:!1,format:"2>9"},minute:{label:"L{TimePicker.minute}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},second:{hidden:!0,label:"L{TimePicker.second}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},amPm:{type:"buttongroup",items:{amButton:{type:"button",text:"AM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"},pmButton:{type:"button",text:"PM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"}}}},autoShow:!1,trapFocus:!0,seconds:null,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,initialValue:null}),zn.initClass(),zn._$name="TimePicker";var Ml=class extends jn{static get $name(){return"TimeField"}static get type(){return"timefield"}static get alias(){return"time"}static get configurable(){return{picker:{type:"timepicker",align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",compose:()=>({children:[{class:{"b-icon-clock-live":1}}]})},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:null,value:null,keepDate:!1}}changePicker(e,r){const t=this;return zn.reconfigure(r,e,{owner:t,defaults:{value:t.value,forElement:t[t.pickerAlignElement],owner:t,align:{anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},onTimeChange({time:i}){t._isUserAction=!0,t.value=i,t._isUserAction=!1}}})}onBackClick(){const e=this,{min:r}=e;if(!e.readOnly&&e.value){const t=b.add(e.value,-1*e.step.magnitude,e.step.unit);(!r||r.getTime()<=t)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:r}=e;if(!e.readOnly&&e.value){const t=b.add(e.value,e.step.magnitude,e.step.unit);(!r||r.getTime()>=t)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let r=e.value;if(r){if(r=r.getTime(),e._min&&e._min.getTime()>r)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<r)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,r){return e!=null&&e.getTime&&(r!=null&&r.getTime)?e.getHours()!==r.getHours()||e.getMinutes()!==r.getMinutes()||e.getSeconds()!==r.getSeconds()||e.getMilliseconds()!==r.getMilliseconds():super.hasChanged(e,r)}showPicker(){const e=this,{picker:r,value:t}=e;e.readOnly||(r.value=t,r.format=e.format,r.maxTime=e.max,r.minTime=e.min,t||(e.value=r.value),super.showPicker(!0))}onPickerShow(){var e;super.onPickerShow(),this.pickerKeyDownRemover=(e=this.pickerKeyDownRemover)==null?void 0:e.call(this)}focusPicker(){this.picker.focus()}transformTimeValue(e){return e!=null&&(typeof e=="string"?(e=b.parse(e,this.format),this.keepDate&&(e=b.copyTimeValues(new Date(this.value),e))):e=new Date(e),b.isValidDate(e))?this.keepDate?e:b.getTime(e):null}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:r}=this;r&&(e==null?r.removeAttribute("min"):r.min=e),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:r}=this;r&&(e==null?r.removeAttribute("max"):r.max=e),this.syncInvalid()}changeValue(e,r){const t=this,i=t.transformTimeValue(e);if(e&&!i||t.isRequired&&e===""){t.setError("L{invalidTime}");return}if(t.clearError("L{invalidTime}"),t.hasChanged(r,i))return super.changeValue(i,r);t.inputting||t.syncInputFieldValue(!0)}updateValue(e,r){const{expand:t}=this.triggers;t&&e&&(t.element.firstElementChild.style.animationDelay=-((e.getHours()*60+e.getMinutes())/10)+"s"),super.updateValue(e,r)}changeStep(e,r){const t=typeof e;if(!e)return null;if(t==="number"?e={magnitude:Math.abs(e),unit:r?r.unit:"hour"}:t==="string"&&(e=b.parseDuration(e)),e!=null&&e.unit&&(e!=null&&e.magnitude))return e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}updateFormat(){this.syncInputFieldValue(!0)}get inputValue(){return b.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}};Ml.initClass(),Ml._$name="TimeField";var Wm=new Date(2e3,0,1),Wn=class extends Ue{doDestroy(){this.dateField.destroy(),this.timeField.destroy(),super.doDestroy()}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}changeTimeField(e){const r=this,t=Ml.new({revertOnEscape:r.revertOnEscape,syncInvalid(...i){const n=r.updatingInvalid;Ml.prototype.syncInvalid.apply(this,i),r.timeField&&!n&&r.syncInvalid()}},e);return B.on({element:t.element,keydown:"onTimeFieldKeyDown",thisObj:r}),r.readOnly&&(t.readOnly=!0),t}updateTimeField(e){const r=this;e.ion({change({userAction:t,value:i}){if(t&&!r.$settingValue){const n=r.dateField.value;r._isUserAction=!0,r.value=n?b.copyTimeValues(n,i||Wm):null,r._isUserAction=!1}},thisObj:r})}changeDateField(e){const r=this,t=(e==null?void 0:e.type)||"datefield",i=$.resolveType(e.type||"datefield"),n=$.create(T.assign({type:t,revertOnEscape:r.revertOnEscape,syncInvalid(...s){const a=r.updatingInvalid;i.prototype.syncInvalid.apply(this,s),r.dateField&&!a&&r.syncInvalid()}},e));return B.on({element:n.element,keydown:"onDateFieldKeyDown",thisObj:r}),r.readOnly&&(n.readOnly=!0),n.ion({keydown:({event:s})=>{var a;s.key==="Tab"&&!s.shiftKey&&((a=this.timeField)!=null&&a.isVisible)&&(s.stopPropagation(),s.cancelBubble=!0)}}),n}get childItems(){return[this.dateField,this.timeField]}updateDateField(e){const r=this;e.ion({change({userAction:t,value:i}){t&&!r.$isInternalChange&&(r._isUserAction=!0,r.timeField.value?i&&b.copyTimeValues(i,r.timeField.value||Wm):r.timeField.value=i,r.value=i,r._isUserAction=!1)},thisObj:r})}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var r,t;return typeof e=="number"?e:(t=(r=this.dateField)==null?void 0:r.weekStartDay)!=null?t:b.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0);const r=this,{dateField:t,timeField:i}=r,n=t.highlightExternalChange,s=i.highlightExternalChange;!e&&!r.highlightExternalChange&&(e=!0),r.$isInternalChange=!0,t.highlightExternalChange=!1,t.value=null,t.highlightExternalChange=n,e&&(i.highlightExternalChange=t.highlightExternalChange=!1),i.value=t.value=r.inputValue,t.highlightExternalChange=n,i.highlightExternalChange=s,r.$isInternalChange=!1,r.syncInvalid()}onTimeFieldKeyDown(e){const r=this;if(e.key==="Enter"||e.key==="Tab"){const t=r.dateField.value;r._isUserAction=!0,r.value=t?b.copyTimeValues(t,r.timeField.value||Wm):null,r._isUserAction=!1}}onDateFieldKeyDown(e){const r=this;e.key==="Tab"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),r.timeField.focus()):e.key==="Enter"&&(r.value=r.dateField.value)}updateRequired(e,r){this.timeField.required=this.dateField.required=e}updateReadOnly(e,r){super.updateReadOnly(e,r),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}focus(){this.dateField.focus()}hasChanged(e,r){return!b.isEqual(e,r)}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,r){[this.dateField,this.timeField].forEach(t=>t.setError(e,r))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,r){[this.dateField,this.timeField].forEach(t=>t.clearError(e,r))}updateInvalid(){this.updatingInvalid=!0,[this.dateField,this.timeField].forEach(e=>e.updateInvalid()),this.updatingInvalid=!1}};E(Wn,"configurable",{timeField:{},dateField:{keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>"",ariaElement:"element"}),E(Wn,"$name","DateTimeField"),E(Wn,"type","datetimefield"),E(Wn,"alias","datetime"),Wn.initClass(),Wn._$name="DateTimeField";var Il=class extends si{static get $name(){return"DurationField"}static get type(){return"durationfield"}static get alias(){return"duration"}static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null}}changeMin(e){return typeof e=="string"?new _e(e):e}changeMax(e){return typeof e=="string"?new _e(e):e}changeAllowedUnits(e){return typeof e=="string"&&(e=e.split(",")),e}updateAllowedUnits(e){this.allowedUnitsRe=new RegExp(`(${e.join("|")})`,"i")}get inputValue(){return this.value==null?"":this.calcValue(!0).toString(this.useAbbreviation)}set unit(e){this._unit=e,this.value=this.calcValue()}get unit(){return this._unit}get unitWithDefault(){return this._unit||Il.defaultConfig.defaultUnit}set magnitude(e){this.clearError("L{invalidUnit}"),this._magnitude=e,super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&this.decimalPrecision!=null?T.round(e,this.decimalPrecision):e}get allowDecimals(){return this.decimalPrecision!==0}get isValid(){const e=this,r=e.value==null||e.value&&e.value.magnitude==null;return super.isValid&&(r&&!e.required||!r&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const r=this,t=r.value,i=r._lastValue;r.hasChanged(i,t)&&(r._lastValue=t,r.triggerFieldChange({value:t,event:e,userAction:!0,valid:r.isValid}))}onFocusOut(e){var r,t,i;return this.syncInputFieldValue(!0),(i=(t=(r=this.triggers)==null?void 0:r.spin)==null?void 0:t.clickRepeater)==null||i.cancel(),super.onFocusOut(e)}set value(e){const r=this;let t,i;if(this.clearError("L{invalidUnit}"),typeof e=="number")t=e,i=r._unit;else if(typeof e=="string")if(/^\s*$/.test(e))t=null;else{const n=b.parseDuration(e,r.allowDecimals,r.unitWithDefault);n&&(!r.allowedUnitsRe||r.allowedUnitsRe.test(n.unit)?(i=n.unit,t=n.magnitude):r.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(i=e.unit,t=e.magnitude):(i=null,t=null);(r._magnitude!==t||r._unit!=i)&&(r._magnitude=t,i&&(r._unit=i),super.value=r.calcValue())}okMax(e){return typeof e=="number"&&(e=new _e({unit:this.unitWithDefault,magnitude:e})),this.max==null||e<=this.max}okMin(e){return typeof e=="number"&&(e=new _e({unit:this.unitWithDefault,magnitude:e})),this.min==null||e>=this.min}get validity(){const e=this.value,r={};return e!=null&&(r.rangeUnderflow=!this.okMin(e),r.rangeOverflow=!this.okMax(e)),r.valid=!r.rangeUnderflow&&!r.rangeOverflow,r}get value(){return super.value}calcValue(e=!1){const r=this;return(!r._unit||r._magnitude==null)&&r.clearable?null:new _e(e?this.roundMagnitude(r._magnitude):this._magnitude,r.unitWithDefault)}hasChanged(e,r){return r&&!e||!r&&e||r&&e&&!e.isEqual(r)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){e.key==="ArrowUp"?this.doSpinUp():e.key==="ArrowDown"&&this.doSpinDown()}doSpinUp(){const e=this;if(e.readOnly)return;let r=(e.magnitude||0)+e.step;e._isUserAction=!0,e.okMin(r)||(r=e.min),e.okMax(r)&&(e.value=r),e._isUserAction=!1}doSpinDown(){const e=this;if(e.readOnly)return;let r=(e.magnitude||0)-e.step;e.okMax(r)||(r=e.max),e.okMin(r)&&(e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}};Il.initClass(),Il._$name="DurationField";var Pl=class extends Lr{};E(Pl,"$name","Fit"),E(Pl,"type","fit"),E(Pl,"configurable",{containerCls:"b-fit-container",itemCls:"b-fit-item"}),Pl.initClass(),Pl._$name="Fit";var hr=class extends Ht{afterConfigure(){const e=this;super.afterConfigure(),e.onTargetSizeChange=e.onTargetSizeChange.bind(e),B.on({element:e.element,keydown:"onKeyDown",contextmenu:"stopMouseEvents",mousedown:"stopMouseEvents",mouseover:"stopMouseEvents",mouseout:"stopMouseEvents",mouseup:"stopMouseEvents",click:"stopMouseEvents",dblclick:"stopMouseEvents",thisObj:e}),e.ion({beforeHide:"beforeEditorHide",hide:"afterEditorHide",thisObj:e}),ze.ion({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){const{inputField:e}=this;e&&!e.isDestroyed&&(e.syncInputFieldValue?e.syncInputFieldValue(!0):e instanceof Ue)}render(e){const r=this.element.parentNode,[t]=this.getRenderContext(this,e);t.classList.add("b-editing"),super.render(...arguments),r!=null&&r.classList&&t!==r&&r.classList.remove("b-editing")}async startEdit(e){var r,t,i;const n=this;if(e=T.assignIf(e,{align:n.align,hideTarget:n.hideTarget,matchSize:n.matchSize,matchFont:n.matchFont,fitTargetContent:n.fitTargetContent,focus:!0}),n.trigger("beforeStart",e)!==!1){const{target:s,hideTarget:a,matchSize:o,matchFont:l,fitTargetContent:c,record:d,field:u=n.inputField.name,focus:h}=e,{inputField:g}=n,{input:f}=g,m=w.getStyleValue(s,"font-size"),p=w.getStyleValue(s,"font-family");let{value:v,align:y}=e;if(d&&u&&(n.record=d,n.dataField=u,v===void 0&&(v=d.getValue(u))),o&&(s instanceof HTMLElement&&n.updateSize(s,o),s instanceof HTMLElement&&st.addResizeListener(s,n.onTargetSizeChange)),f&&(l?(f.style.fontSize=m,f.style.fontFamily=p):f.style.fontSize=f.style.fontFamily=""),n.assigningValues=!0,(r=g.clearError)==null||r.call(g),"setValue"in g?await g.setValue(v):g.value=v,n.assigningValues=!1,typeof y=="string"&&(y={align:y}),await n.showBy({target:s,allowTargetOut:!0,...y}),c){const D=f.scrollWidth-f.clientWidth;D>0&&(n.width+=D+w.scrollBarWidth)}h&&((t=g.focus)==null||t.call(g)),s.nodeType===Element.ELEMENT_NODE&&a&&s.classList.add("b-hide-visibility"),n.editing=!0;const C=g.value;return n.trigger("start",{value:C}),Array.isArray(C)&&g.editingRecords&&((i=C[0])!=null&&i.isModel)?n.oldValue=C.map(D=>D.copy(D.id)):(n.oldValue=C,Array.isArray(n.oldValue)&&(n.oldValue=n.oldValue.slice())),g.initialValue=n.oldValue,!0}return!1}async refreshEdit(){if(this.isVisible){const{record:e,dataField:r,inputField:t}=this;if(e&&r){const i=e.getValue(r);T.isEqual(t.value,i)||await t.setValue(i)}}}finishEdit(){const{target:e,aligningToElement:r}=this.lastAlignSpec;r&&(e.classList.remove("b-editing"),e.classList.remove("b-hide-visibility")),this.editing=!1,this.trigger("finishEdit")}onKeyDown(e){var r;const t=this;switch(e.key){case t.completeKey:t.completeEdit(null,e),e.stopImmediatePropagation();break;case t.cancelKey:t.cancelEdit(e),e.stopImmediatePropagation();break}(r=t.trigger)==null||r.call(t,"keydown",{event:e})}stopMouseEvents(e){this.allowMouseEvents||e.stopPropagation()}onFocusOut(e){super.onFocusOut(e);const r=this;if(!r.isFinishing&&r.editing)switch(r.blurAction){case"cancel":r.cancelEdit(e);break;case"complete":r.completeEdit(null,e)}}async completeEdit(e,r){var t,i,n,s;const a=this,{inputField:o,oldValue:l,record:c}=a,d=o.invalidAction||(o.allowInvalid===!1?"block":a.invalidAction),{value:u}=o;if(a.isVisible){if(!o.isValid&&d!=="allow"){if(d==="block")return(t=o.focus)==null||t.call(o),!1;if(d==="revert")return a.cancelEdit(r),!0}else{if(T.isEqual(u,l))return a.cancelEdit(r),!0;{const h={inputField:o,record:c,value:u,oldValue:l};if(a.trigger("beforeComplete",h)===!1)(i=o.focus)==null||i.call(o);else if(e||(e=h.finalize||((n=h.editorContext)==null?void 0:n.finalize)),e){let g=await e(h);if(g===!0)a.onEditComplete();else{if(o.setError){const f=g||o.invalidValueError,m=()=>{p(),o.clearError(f)},p=o.ion({change:m,input:m});o.setError(f)}d==="block"?(s=o.focus)==null||s.call(o):d==="revert"&&(await o.setValue(l),g=!0),g=!1}return g}else return a.onEditComplete(),!0}}return!1}}cancelEdit(e){var r;const t=this,{inputField:i,oldValue:n}=t,{value:s}=i;t.editing&&!t.isFinishing&&t.trigger("beforeCancel",{value:s,oldValue:n,event:e})!==!1&&((r=i.clearError)==null||r.call(i),t.isFinishing=!0,t.hide(),t.trigger("cancel",{value:s,oldValue:n,event:e}),t.finishEdit(),t.isFinishing=!1)}onEditComplete(){const e=this,{record:r,dataField:t,inputField:i,oldValue:n}=e,{value:s}=i;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),r){const a=`set${O.capitalize(t)}`;r[a]?r[a](s):r.setValue(t,s)}e.trigger("complete",{value:s,oldValue:n}),e.finishEdit(),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||$.fromElement(this.element.parentNode)}changeInputField(e,r){const t=this;return r&&r.destroy(),typeof e=="string"&&(e={type:e}),e instanceof $||(e=$.create(e),t.createdInputField=!0),t.completeOnChange&&e.ion({change:"onInputFieldChange",thisObj:t}),e.parent=t,e}updateInputField(e){this.removeAll(),this.add(e)}get inputField(){return this.items[0]}onInputFieldChange(){this.containsFocus&&this.completeEdit()}onTargetSizeChange(e,r,t){r&&t&&this.updateSize(e)}updateSize(e,r=this.lastMatchSize){const t=this,i=k.inner(e);t.width=r.width===!1?"auto":i.width-t.align.offset[0],t.height=r.height===!1?"auto":i.height,t.lastMatchSize=r}beforeEditorHide(){if(this.editing&&!this.isFinishing)return this.cancelEdit(),!1}afterEditorHide(){this.positioned&&this.element.remove(),st.removeResizeListener(this.lastAlignSpec.target,this.onTargetSizeChange)}};E(hr,"$name","Editor"),E(hr,"type","editor"),E(hr,"configurable",{positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},hideTarget:!1,matchSize:!0,matchFont:!0,fitTargetContent:!1,inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",invalidAction:"block",completeOnChange:null,isolateFields:!0}),hr.initClass(),hr._$name="Editor";var IE=["number","boolean","string","date","duration"],Gm=e=>{var r;return((r=e.column)==null?void 0:r.type)==="duration"},PE="",AE="fieldfilterpicker",gr=`b-${AE}`,ak={between:!0,notBetween:!0,isIncludedIn:!0,isNotIncludedIn:!0},ok={textfield:!0,datefield:!0,numberfield:!0,durationfield:!0,combo:!0},ge=class extends Ht{static get $name(){return"FieldFilterPicker"}static get type(){return AE}static get defaultValueFieldPlaceholders(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}"}}afterConstruct(){const e=this;if(!e._fields)throw new Error(`${ge.name} requires 'fields' to be configured.`);if(!e._filter)throw new Error(`${ge.name} requires 'filter' to be configured.`);super.afterConstruct();const{widgetMap:{propertyPicker:r,operatorPicker:t,caseSensitive:i}}=e;r.ion({select:"onPropertySelect",thisObj:e}),t.ion({select:"onOperatorSelect",thisObj:e}),i.ion({change:"onCaseSensitiveChange",thisObj:e}),e.propertyFieldConfig&&r.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&t.setConfig(e.operatorFieldConfig),r.cls=e.allPropertyPickerClasses,t.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}changeDateFormat(e){return this.L(e)}get allChildInputs(){const{propertyPicker:e,operatorPicker:r,caseSensitive:t}=this.widgetMap;return[e,r,...this.valueFields,t]}updateDisabled(e){this.allChildInputs.forEach(r=>r.disabled=e)}updateReadOnly(e){const{propertyPicker:r,operatorPicker:t}=this.widgetMap;this.allChildInputs.forEach(i=>i.readOnly=e),r.readOnly=r.readOnly||e,t.readOnly=t.readOnly||e}updatePropertyLocked(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}updateOperatorLocked(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}changeOperators(e){const r=e!=null?e:ge.defaultOperators;return Object.keys(r).reduce((t,i)=>({...t,[i]:r[i].map(n=>({...n,text:this.L(n.text)}))}),{})}changeFields(e){let r=e;return Array.isArray(e)&&(ne.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption> keyed by field name instead"),r=H.keyBy(r,"name")),r}get isMultiSelectValueField(){var e;return["isIncludedIn","isNotIncludedIn"].includes((e=this._filter)==null?void 0:e.operator)}get allPropertyPickerClasses(){var e;return new J(`${gr}-property`,(e=this.propertyFieldConfig)==null?void 0:e.cls,{[`${gr}-combo-locked`]:this.propertyLocked})}get allOperatorPickerClasses(){var e;return new J(`${gr}-operator`,(e=this.operatorFieldConfig)==null?void 0:e.cls,{[`${gr}-combo-locked`]:this.operatorLocked})}getValueFieldConfigs(){const e=this,{valueFieldCls:r,fieldType:t,_filter:{operator:i},onValueChange:n,filterValues:s,isMultiSelectValueField:a,operatorArgCount:o,getValueFieldConfig:l}=e,c=T.merge({},ge.defaultValueFieldPlaceholders,e.valueFieldPlaceholders);if(!t||!i||o===0)return[];let d={type:"textfield",internalListeners:{change:n,input:n,thisObj:e},cls:r,dataset:{type:t},placeholder:e.L(c[a?"list":t])};return a?d={...d,type:"combo",multiSelect:!0,createOnUnmatched:!0,items:this.getUniqueDataValues(s),value:s!=null?s:[]}:["number","date","boolean"].includes(t)?d.type=`${t}field`:t==="duration"&&(d.type="durationfield"),l&&(d=e.callback(l,e,[e.filter,d])),a?[d]:H.populate(o,u=>[{type:"widget",tag:"div",cls:`${gr}-value-separator`,content:e.L("L{FieldFilterPicker.and}")},{...d,value:s[u]}]).flat().slice(1)}getUniqueDataValues(e=[]){var r;const t=this,{fieldType:i}=t;if(!t.store||!((r=t._filter)!=null&&r.property))return[];const{relatedDisplayField:n}=t.selectedField;let s,a;if(t.fieldIsRelation){const{foreignStore:o}=t.currentPropertyRelationConfig;n?(s=o.allRecords.reduce((l,c)=>(c.id!=null&&l.push({text:c.getValue(n),value:c.id}),l),[]),a=s.sort((l,c)=>t.sortStrings(l.text,c.text))):s=o.allRecords.map(l=>l.id)}else s=t.store.allRecords.map(o=>o.getValue(t._filter.property));if(!a){s.push(...e);const o=H.unique(s.reduce((l,c)=>(c!=null&&String(c).trim()!==""&&(i==="date"?l.push(c.valueOf()):i==="duration"?l.push(c.toString()):l.push(c)),l),[]));i==="string"?a=o.sort(t.sortStrings):i==="duration"?a=o.map(l=>new _e(l)).filter(l=>l.isValid).sort(t.sortDurations):a=o.sort(t.sortNumerics),i==="date"?a=a.map(l=>{const c=new Date(l);return{text:b.format(c,t.dateFormat),value:l}}):i==="duration"&&(a=a.map(l=>l.toString()))}return a}sortStrings(e,r){return(e!=null?e:PE).localeCompare(r!=null?r:PE)}sortNumerics(e,r){return e-r}sortDurations(e,r){return e.valueOf()-r.valueOf()}get fieldType(){var e;return(e=this.selectedField)==null?void 0:e.type}get selectedField(){var e,r;return(r=this.fields)==null?void 0:r[(e=this._filter)==null?void 0:e.property]}get propertyOptions(){var e;return Object.entries((e=this.fields)!=null?e:{}).filter(([,r])=>IE.includes(r.type)||Gm(r)).map(([r,{title:t}])=>({value:r,text:t!=null?t:r})).sort((r,t)=>r.text.localeCompare(t.text))}get operatorOptions(){return this.operators[this.fieldIsRelation?"relation":this.fieldType]}get fieldIsRelation(){return!!this.currentPropertyRelationConfig}get currentPropertyRelationConfig(){var e,r;return(r=(e=this.store)==null?void 0:e.modelRelations)==null?void 0:r.find(({foreignKey:t})=>{var i;return t===((i=this._filter)==null?void 0:i.property)})}updateOperators(){delete this._operatorArgCountLookup}get operatorArgCountLookup(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=ge.buildOperatorArgCountLookup(this.operators))}updateFilter(){this._filter&&this.onFilterChange()}updateStore(e){var r;(r=this._store)==null||r.un(this),e==null||e.ion({refresh:"onStoreRefresh",thisObj:this})}onStoreRefresh({action:e}){this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(e)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}refreshValueFields(){const e=this,{valueFields:r}=e.widgetMap,{fieldType:t,operatorArgCount:i,_filter:{property:n,operator:s}}=e,a=ak[s],o=t==="string";r.element.className=new J(r.cls,{[`${gr}-values-multiple`]:a,[`${gr}-values-string`]:o,"b-hidden":n==null||s==null||i===0}),r.removeAll(),r.add(e.getValueFieldConfigs()),delete e._valueFields,e.refreshCaseSensitive()}refreshCaseSensitive(){var e,r;const t=this,{fieldType:i,operatorArgCount:n,isMultiSelectValueField:s}=t,a=(e=t._filter)==null?void 0:e.operator,{caseSensitive:o}=t.widgetMap;o.hidden=i!=="string"||!a||s||n===0,o.checked=((r=t._filter)==null?void 0:r.caseSensitive)!==!1}onPropertySelect(e){var r;const t=this,{_filter:i}=t;i.property=((r=e.record)==null?void 0:r.data.value)||null,t.fieldType!==t._fieldType&&(i.operator=null,i.value=null),t._fieldType=i.type=t.fieldType,t.refreshOperatorPicker(),t.refreshValueFields(),t.triggerChange()}onCaseSensitiveChange({checked:e}){this._filter.caseSensitive=e,this.triggerChange()}onOperatorSelect(e){var r;const t=this,i=t.isMultiSelectValueField,n=this.operatorArgCount;t._filter.operator=((r=e.record)==null?void 0:r.data.value)||null,t.operatorArgCount!==n&&(t._filter.value=null),t.isMultiSelectValueField&&!i&&(t._filter.value=[]),t.refreshValueFields(),t.triggerChange()}triggerChange(){const{filter:e,isValid:r}=this;this.trigger("change",{filter:e,isValid:r})}onValueChange(){const e=this,{isMultiSelectValueField:r,fieldType:t,_filter:i}=e,n=this.valueFields.map(s=>s.value);r&&t==="date"?i.value=n[0].map(s=>new Date(s)):r&&t==="duration"?i.value=n[0].map(s=>new _e(s)):(t==="date"&&i.operator==="between"&&b.isValidDate(n[1])&&n[1].setHours(23,59,59,999),i.value=n.length===1?n[0]:n),e.triggerChange()}refreshOperatorPicker(){const{operatorPicker:e}=this.widgetMap,{_filter:{operator:r,property:t},operatorOptions:i}=this;e.items=i,e.value=r,e.hidden=t===null}populateUIFromFilter(e=!1){const r=this,{filterValues:t,widgetMap:{propertyPicker:i,operatorPicker:n},_filter:{property:s,operator:a,disabled:o},propertyOptions:l,operatorOptions:c,isMultiSelectValueField:d}=r;i.items=l,n.items=c,n.hidden=s===null;let u=e;i.value!==s&&(i.value=s,r.refreshOperatorPicker(),u=!0),n.value!==a&&(a===null||!n.items.find(({value:h})=>h===a)?n.clear():n.value=a,u=!0),u&&r.refreshValueFields(),r.refreshCaseSensitive(),r.valueFields.forEach((h,g)=>{d&&(h.value.length>0||t.length>0)?r.fieldType==="date"?h.value=t.map(f=>f==null?void 0:f.valueOf()):r.fieldType==="duration"?h.value=t.map(f=>f==null?void 0:f.toString()):h.value=t:g>=t.length?h.clear():h.value=t[g]}),r.allChildInputs.forEach(h=>h.disabled=r.disabled||o)}get valueFields(){return this._valueFields||(this._valueFields=this.widgetMap.valueFields.queryAll(e=>ok[e.type]))}get filterValues(){var e;return((e=this._filter)==null?void 0:e.value)==null?[]:H.asArray(this._filter.value)}onFilterChange(){const e=this,r=e.fieldType,t=r!==e._fieldType;e._fieldType=e._filter.type=r,e.populateUIFromFilter(t)}get operatorArgCount(){const{fieldType:e,filter:{operator:r},operatorArgCountLookup:t}=this;return e&&r?t[e][r]:1}get isValid(){const e=this,{filter:r,fieldType:t,filterValues:i,isMultiSelectValueField:n,operatorArgCount:s}=e,{operator:a}=r,o=s>0&&(r==null?void 0:r.value)==null;return t&&a&&!o&&(n&&i.length>0||i.length===s)&&i.every(l=>l!=null&&(t!=="duration"||l.isValid))}},$i=ge;E($i,"operators",{empty:{value:"empty",text:"L{isEmpty}",argCount:0},notEmpty:{value:"notEmpty",text:"L{isNotEmpty}",argCount:0},"=":{value:"=",text:"L{equals}"},"!=":{value:"!=",text:"L{doesNotEqual}"},">":{value:">",text:"L{isGreaterThan}"},"<":{value:"<",text:"L{isLessThan}"},">=":{value:">=",text:"L{isGreaterThanOrEqualTo}"},"<=":{value:"<=",text:"L{isLessThanOrEqualTo}"},between:{value:"between",text:"L{isBetween}",argCount:2},notBetween:{value:"notBetween",text:"L{isNotBetween}",argCount:2},isIncludedIn:{value:"isIncludedIn",text:"L{isOneOf}"},isNotIncludedIn:{value:"isNotIncludedIn",text:"L{isNotOneOf}"}}),E($i,"defaultOperators",{string:[ge.operators.empty,ge.operators.notEmpty,ge.operators["="],ge.operators["!="],{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},ge.operators.isIncludedIn,ge.operators.isNotIncludedIn],number:[ge.operators.empty,ge.operators.notEmpty,ge.operators["="],ge.operators["!="],ge.operators[">"],ge.operators["<"],ge.operators[">="],ge.operators["<="],ge.operators.between,ge.operators.notBetween,ge.operators.isIncludedIn,ge.operators.isNotIncludedIn],date:[ge.operators.empty,ge.operators.notEmpty,ge.operators["="],ge.operators["!="],{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},ge.operators.between,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},ge.operators.isIncludedIn,ge.operators.isNotIncludedIn],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[ge.operators.empty,ge.operators.notEmpty,ge.operators["="],ge.operators["!="],ge.operators[">"],ge.operators["<"],ge.operators[">="],ge.operators["<="],ge.operators.between,ge.operators.notBetween,ge.operators.isIncludedIn,ge.operators.isNotIncludedIn],relation:[ge.operators.isIncludedIn,ge.operators.isNotIncludedIn]}),E($i,"configurable",{fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,items:{inputs:{type:"container",layout:"hbox",cls:`${gr}-inputs`,items:{propertyPicker:{type:"combo",items:{},cls:`${gr}-property`,placeholder:"L{FieldFilterPicker.selectAProperty}"},operatorPicker:{type:"combo",editable:!1,items:{},cls:`${gr}-operator`,placeholder:"L{FieldFilterPicker.selectAnOperator}"},valueFields:{type:"container",cls:`${gr}-values`,items:{}}}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:`${gr}-case-sensitive`}},operators:ge.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null}),E($i,"buildOperatorArgCountLookup",e=>H.keyBy(Object.entries(e),([r])=>r,([,r])=>H.keyBy(r,({value:t})=>t,({argCount:t})=>t===void 0?1:t))),$i.initClass(),$i._$name="FieldFilterPicker";var pa=class extends ${compose(){const{text:e,html:r}=this;return{tag:"label",text:e,html:r}}};E(pa,"$name","Label"),E(pa,"type","label"),E(pa,"configurable",{text:null,localizableProperties:["text"]}),pa.initClass(),pa._$name="Label";var ji=class extends Ht{static get $name(){return"FieldFilterPickerGroup"}static get type(){return"fieldfilterpickergroup"}afterConstruct(){const e=this;e.validateConfig();const{addFilterButton:r}=e.widgetMap;r.ion({click:"addFilter",thisObj:e}),r.text=e.L(r.text),e.store&&e.updateStore(e.store),super.afterConstruct()}changeDateFormat(e){return this.L(e)}validateConfig(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup requires either a 'fields' or 'store' config property.")}updateFields(e){this.widgetMap.pickers.childItems.forEach(r=>r.fields=e)}updateFilters(e,r){const t=this;r&&r.filter(i=>!e.find(n=>n.id===i.id)).forEach(i=>{var n;return(n=t.store)==null?void 0:n.removeFilter(i.id)}),e.forEach(i=>i.id=i.id||t.nextFilterId),t.widgetMap.pickers.items=(e==null?void 0:e.map(i=>t.getPickerRowConfig(i)))||[]}changeFilters(e){const{canManageFilter:r}=this;return e&&r?e.filter(t=>this.callback(r,this,[t])):e}updateStore(e){const r=this;r.detachListeners("store"),e&&(r.widgetMap.pickers.childItems.forEach(({widgetMap:{filterPicker:{filter:t,isValid:i}}})=>{e.removeFilter(t.id,!0),i&&e.addFilter(t,!0)}),e.filter(),r.appendFiltersFromStore(),e.ion({name:"store",filter:"onStoreFilter",thisObj:r})),r.widgetMap.pickers.childItems.forEach(t=>t.store=e)}updateShowAddFilterButton(e){this.widgetMap.addFilterButton.hidden=!e}updateAddFilterButtonText(e){this.widgetMap.addFilterButton.text=e!=null?e:ji.addFilterButtonDefaultText}appendFiltersFromStore(){const e=this;e.store.filters.forEach(r=>{var t;const i=e.canManage(r),{property:n,operator:s,value:a,id:o,disabled:l=!1,caseSensitive:c}=r;i&&n&&s&&!((t=e.filters)!=null&&t.find(d=>d.id===o))&&e.appendFilter({id:o,property:n,operator:s,value:a,disabled:l,caseSensitive:c})})}canManage(e){const r=this;return!r.canManageFilter||r.callback(r.canManageFilter,r,[e])===!0}getFilterPickerConfig(e){const r=this,{fields:t,store:i,disabled:n,readOnly:s,valueFieldCls:a,operators:o,limitToProperty:l,dateFormat:c,getFieldFilterPickerConfig:d}=r;return{type:r.constructor.childPickerType,fields:t!=null?t:r.getFieldsFromStore(i),filter:e,store:i,disabled:n,readOnly:s,propertyLocked:!!l,valueFieldCls:a,operators:o,dateFormat:c,internalListeners:{change:"onFilterPickerChange",thisObj:r},flex:1,...d?r.callback(d,r,[e]):void 0}}getFieldsFromStore(e){var r,t;return Object.fromEntries((t=(r=e.fields)==null?void 0:r.map(({name:i,type:n})=>[i,{type:n}]))!=null?t:[])}getPickerRowConfig(e){const r=this,{disabled:t,readOnly:i,canDeleteFilter:n}=r,s=!(n&&r.callback(n,r,[e])===!1);return{type:"container",layout:"box",cls:{[`b-${ji.type}-row`]:!0,[`b-${ji.type}-row-removable`]:s},dataset:{separatorText:r.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:t,readOnly:i,checked:!e.disabled,internalListeners:{change:"onFilterActiveChange",thisObj:r},cls:`b-${ji.type}-filter-active`},filterPicker:r.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:t,readOnly:i,hidden:!s,cls:`b-transparent b-${ji.type}-remove`,icon:"b-fa-trash",internalListeners:{click:"removeFilter",thisObj:r}}}}}get allInputs(){const e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll(r=>e.includes(r.type))}updateDisabled(e){this.allInputs.forEach(r=>r.disabled=e)}updateReadOnly(e){this.allInputs.forEach(r=>r.readOnly=e)}onFilterActiveChange({source:e,checked:r}){const t=this,i=t.getFilterIndex(e),n=t.filters[i],s=t.getFilterPicker(i);n.disabled=!r,s.onFilterChange(),t.store&&s.isValid&&t.store.addFilter(n,!0),t.updateStoreFilter(),t.triggerChange()}onFilterPickerChange({source:e,filter:r,isValid:t}){const i=this,{store:n}=i,s=i.getFilterIndex(e);n&&(n.removeFilter(r.id,!0),t&&n.addFilter(r,!0),i.updateStoreFilter()),Object.assign(i.filters[s],r),i.triggerChange()}getFilterIndex(e){return this.widgetMap.pickers.childItems.indexOf(e.containingWidget)}getPickerRow(e){return this.widgetMap.pickers.childItems[e]}getFilterPicker(e){return this.getPickerRow(e).widgetMap.filterPicker}get nextFilterId(){return this._nextId=(this._nextId||0)+1,`${this.id}-filter-${this._nextId}`}removeFilter({source:e}){const r=this,t=r.getFilterIndex(e),i=r.filters[t],n=r.getPickerRow(t),s=r.query(a=>a.isFocusable&&a.type!=="container"&&!n.contains(a));s&&s.focus(),r.removeFilterAt(t),r.store&&(r.store.removeFilter(i.id,!0),r.updateStoreFilter()),r.trigger("remove",{filter:i}),r.triggerChange()}addFilter({property:e=null,operator:r=null,value:t=null}={}){var i;const n=this,{filters:s}=n,a={property:n.limitToProperty||e,operator:r,value:t,disabled:!1,id:n.nextFilterId,caseSensitive:!1};n.appendFilter(a),n.getFilterPicker(s.length-1).isValid&&((i=n.store)==null||i.addFilter(a,!0),n.store&&n.updateStoreFilter()),n.trigger("add",{filter:a}),n.triggerChange()}appendFilter(e){const r=this;(!r.limitToProperty||e.property===r.limitToProperty)&&(r.filters.push(e),r.widgetMap.pickers.add(r.getPickerRowConfig(e,r.filters.length-1)))}onStoreFilter(e){const r=this;if(r._isUpdatingStore)return;const{filters:t}=e,i=t.values.reduce((n,s)=>({...n,[s.id]:s}),{});for(let n=r.filters.length-1;n>=0;n--){const s=r.filters[n],a=i[s.id],o=r.getPickerRow(n);if(o){const{filterPicker:l,activeCheckbox:c}=o.widgetMap;if(!a&&l.isValid)r.removeFilterAt(n);else if(a!==void 0){const{operator:d,value:u,property:h,disabled:g,caseSensitive:f}=a;s!==a&&Object.assign(s,{operator:d,value:u,property:h,disabled:g,caseSensitive:f}),l.filter=s,l.onFilterChange(),c.checked=!g}}}r.appendFiltersFromStore(),r.triggerChange()}removeFilterAt(e){const{widgetMap:{pickers:r},filters:t}=this;r.remove(r.childItems[e]),t.splice(e,1),this.triggerChange()}updateStoreFilter(){var e;this._isUpdatingStore=!0,(e=this.store)==null||e.filter(),this._isUpdatingStore=!1}get value(){return this.filters}triggerChange(){const{filters:e}=this,r=e.filter((t,i)=>this.getPickerRow(i).widgetMap.filterPicker.isValid);this.trigger("change",{filters:e,validFilters:r})}activateAll(){this.setAllActiveStatus(!0)}deactivateAll(){this.setAllActiveStatus(!1)}setAllActiveStatus(e){const r=this,{_filters:t,store:i}=r;t.forEach((n,s)=>{if(e===n.disabled){const{filterPicker:a,activeCheckbox:o}=r.getPickerRow(s).widgetMap;n.disabled=!e,a.onFilterChange(),o.checked=e,e&&i&&a.isValid&&i.addFilter(n,!0)}}),r.updateStoreFilter()}},Gn=ji;E(Gn,"addFilterButtonDefaultText","L{FieldFilterPickerGroup.addFilter}"),E(Gn,"configurable",{filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:ji.addFilterButtonDefaultText,cls:`b-${ji.type}-add-button`,hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"}),E(Gn,"childPickerType","fieldfilterpicker"),Gn.initClass(),Gn._$name="FieldFilterPickerGroup";var uu=class extends Vt.mixin($m){static get $name(){return"FieldSet"}static get type(){return"fieldset"}static get configurable(){return{bodyTag:"fieldset",focusable:!1,inline:null,inlineInternal:null,layout:{type:"box",horizontal:!1}}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}get bodyConfig(){const e=super.bodyConfig,{className:r}=e,{inlineInternal:t,hasLabel:i,title:n}=this;return delete e.html,r["b-inline"]=t,r["b-fieldset-has-label"]=i,n&&(e.children={legendElement:{tag:"legend",text:n,class:{"b-fieldset-legend":1}}}),e}compose(){const{inlineInternal:e,label:r,labelCls:t,labelWidth:i}=this;return{class:{"b-field":r,"b-vbox":!e},children:{"labelElement > headerElement":(r||null)&&{tag:"label",html:r,class:{"b-label":1,"b-align-start":1,[t]:t},style:{width:w.unitize("width",i)[1]}}}}}syncInlineInternal(){var e;this.inlineInternal=(e=this.inline)!=null?e:this.label!=null&&this.labelPosition==="before"}updateDisabled(e,r){super.updateDisabled(e,r),this.eachWidget(t=>{t.disabled=e},!1)}updateInline(){this.syncInlineInternal()}updateInlineInternal(e){this.layout.horizontal=e}updateLabel(){this.syncInlineInternal()}updateLabelPosition(){this.syncInlineInternal()}};uu.initClass(),uu._$name="FieldSet";var Um=class extends Ue{static get $name(){return"FileField"}static get type(){return"filefield"}static get configurable(){return{multiple:null,accept:null,inputType:"file",attributes:["multiple","accept"]}}get files(){return this.input.files}pickFile(){this.input.click()}get multiple(){return this._multiple?"":null}clear(){this.input.value=null}triggerChange(e){this.triggerFieldChange({event:e,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}};Um.initClass(),Um._$name="FileField";var Ym=class extends Ht{static get $name(){return"FilePicker"}static get type(){return"filepicker"}static get defaultConfig(){return{defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null}}construct(e={}){const r=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),super.construct(e),r.button.ion({click:r.onButtonClick,thisObj:r}),r.fileField.ion({change:r.onFileFieldChange,thisObj:r}),r._thisIsAUsedExpression(r.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const e=this;return e._fileTip||(e._fileTip=new ve({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",internalListeners:{beforeshow(){const r=this,t=e.files;return t&&t.length?(r.html=`${Array.from(t).map(i=>i.name).join("<br>")}`,!0):!1}}}))}clear(){const e=this;e.fileField.clear(),e.button.badge="",e.trigger("clear")}onButtonClick({event:e}){this.fileField.pickFile(),e.preventDefault()}onFileFieldChange({valid:e}){const r=this;r.button.badge=r.files.length||"",r.triggerFieldChange({files:r.files,valid:e})}};Ym.initClass(),Ym._$name="FilePicker";var qm=class extends si{static get $name(){return"FilterField"}static get type(){return"filterfield"}static get configurable(){return{field:null,store:null,filterFunction:null,clearable:!0,revertOnEscape:!0,keyStrokeChangeDelay:100,onChange({value:e}){const{store:r,field:t,filterFunction:i}=this;if(r){const n=`${t||this.id}-Filter`;if(e.length===0)r.removeFilter(n);else{let s;i?s=a=>i(a,e):(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=a=>{var o;return(o=a.getValue(t))==null?void 0:o.match(new RegExp(e,"i"))}),r.filter({id:n,filterBy:s})}}}}}updateValue(e,r){super.updateValue(e,r),e&&this.isConfiguring&&this.onChange({value:e})}};qm.initClass(),qm._$name="FilterField";var _E=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];q.isWindows&&_E.reverse();var Km=class extends ht{static get $name(){return"MessageDialog"}static get type(){return"messagedialog"}static get configurable(){return{centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:"\xA0",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:_E}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}destroy(){}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const r=this.widgetMap.input;return $.reconfigure(r,e),r.value="",this.showDialog("prompt",...arguments)}showDialog(e,{message:r="",title:t="\xA0",cancelButton:i,okButton:n,rootElement:s=document.body}){const a=this;return a.rootElement=s,a.getConfig("lazyItems"),a.title=a.optionalL(t),a.widgetMap.message.html=a.optionalL(r),a.showClass=`b-messagedialog-${e}`,n&&(n=typeof n=="string"?{text:n}:n),i&&(i=typeof i=="string"?{text:i}:i),n=Object.assign({},a.widgetMap.okButton.initialConfig,n),i=Object.assign({},a.widgetMap.cancelButton.initialConfig,i),n.text=a.optionalL(n.text),i.text=a.optionalL(i.text),$.reconfigure(a.widgetMap.okButton,n),$.reconfigure(a.widgetMap.cancelButton,i),a.show(),a.promise=new Promise(o=>{a.resolve=o})}show(){const e=w.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:Km.fromElement(document.activeElement),super.show(...arguments)}updateShowClass(e,r){const{classList:t}=this.element;r&&t.remove(r),e&&t.add(e)}doResolve(e){const r=this,{resolve:t}=r;if(t){const i=r.showClass==="b-messagedialog-prompt";if(i&&e===r.okButton&&!r.widgetMap.input.isValid)return;r.resolve=r.reject=r.promise=null,t(i?{button:e,text:r.widgetMap.input.value}:e),r.hide()}}onInternalKeyDown(e){e.key==="Escape"&&(e.stopImmediatePropagation(),this.onCancelClick()),e.key==="Enter"&&(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve(Xm.okButton)}onCancelClick(){this.doResolve(Xm.cancelButton)}};Km.initClass();var Xm=new Proxy({},{get(e,r){const t=e.instance||(e.instance=new Km({rootElement:document.body})),i=t[r];return typeof i=="function"?i.bind(t):i}}),Bi=Xm,Zm=class extends sa{static get $name(){return"PagingToolbar"}static get type(){return"pagingtoolbar"}static get defaultConfig(){return{store:null,defaults:{localeClass:this},items:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"b-icon-first",weight:100,tooltip:"L{PagingToolbar.firstPage}"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"b-icon-previous",weight:110,tooltip:"L{PagingToolbar.prevPage}"},pageNumber:{type:"numberfield",label:"L{page}",min:1,max:1,triggers:null,onChange:"up.onPageNumberChange",highlightExternalChange:!1,weight:120},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text",weight:130},nextPageButton:{onClick:"up.onNextPageClick",icon:"b-icon-next",weight:140,tooltip:"L{PagingToolbar.nextPage}"},lastPageButton:{onClick:"up.onLastPageClick",icon:"b-icon-last",weight:150,tooltip:"L{PagingToolbar.lastPage}"},separator:{type:"widget",cls:"b-toolbar-separator",weight:151},reloadButton:{onClick:"up.onReloadClick",icon:"b-icon-reload",weight:160,tooltip:"L{PagingToolbar.reload}"},spacer:{type:"widget",cls:"b-toolbar-fill",weight:161},dataSummary:{type:"widget",cls:"b-toolbar-text",weight:170}}}}set parent(e){super.parent=e,this.store||(this.store=e.store)}get parent(){return super.parent}set store(e){const r=this;r.detachListeners("store"),r._store=e,e&&(e.ion({name:"store",beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:r}),e.isLoading&&r.onStoreBeforeRequest())}get store(){return this._store}onStoreBeforeRequest(){this.eachWidget(e=>e.disable())}updateLocalization(){this.updateSummary(),super.updateLocalization()}updateSummary(){const e=this,{pageCount:r,dataSummary:t}=e.widgetMap;let i=0,n=0,s=0,a=0,o=0;if(e.store){const{store:l}=e,{pageSize:c,currentPage:d}=l;i=l.count,n=l.lastPage,o=l.allCount,s=Math.max(0,(d-1)*c+1),a=Math.min(o,s+c-1)}r.html=e.L("L{pageCountTemplate}")({lastPage:n}),t.html=i?e.L("L{summaryTemplate}")({start:s,end:a,allCount:o}):e.L("L{noRecords}")}onStoreChange(){const e=this,{widgetMap:r,store:t}=e,{count:i,lastPage:n,currentPage:s}=t,{pageNumber:a,pageCount:o,firstPageButton:l,previousPageButton:c,nextPageButton:d,lastPageButton:u,dataSummary:h}=r;e.eachWidget(g=>g.enable()),a.value=s,a.max=n,h.disabled=a.disabled=o.disabled=!i,l.disabled=c.disabled=s<=1||!i,d.disabled=u.disabled=s>=n||!i,e.updateSummary()}onPageNumberChange({value:e}){this.store.currentPage!==e&&this.store.loadPage(e)}onFirstPageClick(){this.store.loadPage(1)}onPreviousPageClick(){this.store.previousPage()}onNextPageClick(){this.store.nextPage()}onLastPageClick(){this.store.loadPage(this.store.lastPage)}onReloadClick(){this.store.loadPage(this.store.currentPage)}};Zm.initClass(),Zm._$name="PagingToolbar";var{dockIsHorz:lk}=Pn.maps,ck={top:0,down:0,left:1,bottom:2,up:2,right:3},Jm={up:{from:"translate(0,0)",to:"translate(0,-100%)"},down:{from:"translate(0,0)",to:"translate(0,100%)"},left:{from:"translate(0,0)",to:"translate(-100%,0)"},right:{from:"translate(0,0)",to:"translate(100%,0)"}},Qm=class extends Pn.mixin(fe){static get $name(){return"PanelCollapserOverlay"}static get type(){return"overlay"}static get configurable(){return{autoCloseDelay:1e3,autoClose:!0,revealing:{value:null,$config:null,default:!1},recollapseTool:{type:"collapsetool",cls:"b-recollapse",collapsify:"overlay",handler(){var e;(e=this.collapsible)==null||e.toggleReveal()}}}}static get delayable(){return{doAutoClose:0}}doAutoClose(){this.toggleReveal(!1)}updateAutoCloseDelay(e){const{doAutoClose:r}=this;(r.suspended=e==null||e<0)||(r.delay=e,r.immediate=!e)}changeRecollapseTool(e){const r=this,{panel:t}=r;if(r.isConfiguring||r.isDestroying||!t||t.isDestroying)return e;t.tools={recollapse:e}}beforeCollapse(e){if(super.beforeCollapse(e)===!1)return!1;this.panel.revealed&&(e.animation=null)}applyHeaderDock(e,r=!0){var t;(t=this.panel)==null||t.recompose(),super.applyHeaderDock(e,r)}collapseBegin(e){const r=this,{collapseDir:t,innerElement:i}=r,{animation:n}=e,{collapseTool:s,panel:a}=r;r.configuredWidth=a._lastWidth,r.configuredHeight=a._lastHeight,r.applyHeaderDock(!0),r.lockInnerSize(),s==null||s.element.classList.add("b-collapsed"),n&&(a.element.classList.add("b-collapsing"),n.element=i,n.transform=Jm[t],e.animation=je.run(n))}onComplete(e){var r,t;super.onComplete(e);const i=this,{panel:n}=i,{element:s}=n;i.autoCloseLeaveDetacher=(r=i.autoCloseLeaveDetacher)==null?void 0:r.call(i),i.autoCloseClickDetacher=(t=i.autoCloseClickDetacher)==null?void 0:t.call(i),i.doAutoClose.cancel(),e==="reveal"&&i.autoClose&&(n.containsFocus&&(i.autoCloseLeaveDetacher=B.on({element:s,mouseenter:a=>{i.doAutoClose.cancel()},mouseleave:a=>{i.doAutoClose()}})),i.autoCloseClickDetacher=B.on({element:document.body,thisObj:n,mousedown:a=>{var o;!n.owns(a)&&!((o=i.revealer)!=null&&o.contains(a.target))&&i.autoCloseDelay!=null&&i.doAutoClose.now()}}))}expandBegin(e){const r=this,{animation:t}=e,{collapseDir:i,collapseTool:n,innerElement:s,panel:a}=r,{element:o}=a;o.classList.remove("b-collapsed","b-collapsing"),r.restoreConfiguredSize(),r.lockInnerSize(!1),r.lockInnerSize(),n==null||n.element.classList.remove("b-collapsed"),t&&(o.classList.add("b-collapsed","b-expanding"),t.element=s,t.transform={from:Jm[i].to,to:Jm[i].from},e.animation=je.run(t))}expandEnd(e){super.expandEnd(e);const{panel:r}=this;e.completed&&(r.revealed=!1),r.element.classList.remove("b-expanding")}expandRevert(e){super.expandRevert(e),this.panel.element.classList.add("b-expanding")}get innerElement(){return this.panel.overlayElement}get innerSizeElement(){return this.panel.element}get toolsConfig(){const e=this,{direction:r}=e,t=super.toolsConfig,i=e.recollapseTool;return i?{...t,recollapse:i&&T.assign({direction:r.toLowerCase()},i)}:t}lockInnerSize(e=!0){const r=this,{panel:t}=r,i=e&&t.rectangle(),n=e?[0,0,0,0]:"",s=super.lockInnerSize(e);return e&&(n[ck[r.collapseDir]]=`-${i[r.collapseDim]+10}px`),t.element.style.clipPath=e?`inset(${n.join(" ")})`:"",s}onOverlayTransitionDone(e){const r=this,{panel:t}=r;e.srcElement===t.overlayElement&&r.revealing&&(r.revealing=!1,r.onComplete(t.revealed?"reveal":"unreveal"))}onRevealerClick(){this.toggleReveal()}toggleReveal(e){const{panel:r}=this,{element:t}=r;r.collapsed&&(this.revealer=w.getActiveElement(t),e==null&&(e=!r.revealed),r.revealed!==e&&r.trigger("beforeToggleReveal",{reveal:e})!==!1&&(!e&&t.contains(this.revealer)&&r.revertFocus(!0),this.revealing=!0,r.revealed=e))}updateRevealing(e){const r=this,t=/left|right/i,{panel:i}=r,n=t.test(r.collapseDir)?"height":"width";i&&(r.innerElement.style[n]="0px",r.innerElement.style[`min-${n}`]="100%",i.element.classList[e?"add":"remove"]("b-panel-overlay-revealing"))}wrapCollapser(e,r){var t;const i=this,{collapseDir:n,panel:s}=i,{expandedHeaderDock:a,header:o,uiClassList:l}=s,c=(t=s.tools)==null?void 0:t.recollapse,[d,u]=i.splitHeaderItems({as:"element",dock:i.collapseDock}),h=lk[a],g=s.hasHeader?s.title||(o==null?void 0:o.title)||"\xA0":null;return c&&(c.direction=n),["overlayElement",{class:{...l,[`b-panel-overlay-header-${a}`]:1,[`b-panel-overlay-${n}`]:1,[`b-${h?"h":"v"}box`]:1,"b-panel-overlay":1,"b-box-center":1},listeners:{transitionend:f=>i.onOverlayTransitionDone(f)},children:{overlayHeaderElement:g&&{tag:"header",class:new J({...l,[`b-dock-${a}`]:1,"b-panel-header":1,"b-panel-overlay-header":1},o==null?void 0:o.cls),children:[...d,{reference:"overlayTitleElement",html:g,class:{...l,[`b-align-${(o==null?void 0:o.titleAlign)||"start"}`]:1,"b-header-title":1}},...u]},[e]:r}}]}};Qm.initClass(),Qm._$name="PanelCollapserOverlay";var ep=class extends Ue{static get type(){return"passwordfield"}static get alias(){return"password"}static get $name(){return"PasswordField"}construct(e={}){e.inputType="password",super.construct(...arguments),this.element.classList.add("b-textfield")}};ep.initClass(),ep._$name="PasswordField";var tp=class extends Hn{static get $name(){return"Radio"}static get type(){return"radio"}static get alias(){return"radiobutton"}static get configurable(){return{inputType:"radio",clearable:null,uncheckedValue:void 0}}get textLabelCls(){return super.textLabelCls+" b-radio-label"}internalOnClick(e){super.internalOnClick(e)!==!1&&this.checked&&this.clearable&&(this.checked=!1)}updateName(e){this.toggleGroup=e}updateClearable(){}};tp.initClass(),tp._$name="Radio";var hu=class extends uu{static get $name(){return"RadioGroup"}static get type(){return"radiogroup"}static get configurable(){return{defaultType:"radio",clearable:null,name:null,options:{value:null,$config:{merge:"items"}},defaultBindProperty:"value"}}get existingOptions(){const{name:e}=this;return this.ensureItems().filter(r=>r.name===e)}get refPrefix(){return`${this.name||this.ref||this.id}_`}get selected(){return this.existingOptions.filter(e=>e.input.checked)[0]||null}get value(){const{selected:e}=this;return e?e.checkedValue:null}set value(e){this.existingOptions.forEach(r=>{r.isConfiguring=this.isConfiguring,r.checked=r.checkedValue===e,r.isConfiguring=!1})}ensureItems(){return this.getConfig("options"),super.ensureItems()}changeOptions(e,r){if(!(e&&r&&T.isDeeplyEqual(r,e)))return e}convertOption(e,r,t){const i=this,{name:n}=i,s={name:n,type:"radio",value:e===i.value,ref:`${i.refPrefix}${e}`,checkedValue:e};return typeof r=="string"?s.text=r:T.assign(s,r),t?$.reconfigure(t,s):s}isOurRadio(e){return e.isRadio&&e.name===this.name}isolateFieldChange(e){return this.isOurRadio(e)}onChildAdd(e){super.onChildAdd(e),this.isOurRadio(e)&&e.ion({name:e.id,beforeChange:"onRadioItemBeforeChange",change:"onRadioItemChange",click:"onRadioClick",thisObj:this})}onChildRemove(e){this.isOurRadio(e)&&this.detachListeners(e.id),super.onChildRemove(e)}onRadioClick(e){const{source:r}=e;r.checked&&this.clearable&&r.clearable==null&&(r.checked=!1)}onRadioItemBeforeChange(e){if(e.checked){const r=this,{lastValue:t}=r;if(!r.reverting&&r.trigger("beforeChange",r.wrapRadioEvent(e))===!1&&t!=null&&t!==r.value)return r.reverting=!0,e.source.uncheckToggleGroupMembers(),r.value=t,r.lastValue=t,r.reverting=!1,!1}}onRadioItemChange(e){const r=this;e.checked&&!r.reverting&&(r.triggerFieldChange(r.wrapRadioEvent(e)),r.lastValue=r.value)}wrapRadioEvent(e){return{from:e,item:e.source,userAction:e.userAction,lastValue:this.lastValue,value:this.value}}updateOptions(){const e=this,{options:r,refPrefix:t}=e,i=e.existingOptions.reduce((l,c)=>(l[c.ref.substring(t.length)]=c,l),{});let n=0,s,a;if(r)for(s in r)a=e.convertOption(s,r[s],i[s]),delete i[s],e.insert(a,n++);const o=Object.values(i);o!=null&&o.length&&(e.remove(o),o.forEach(l=>l.destroy()))}};hu.initClass(),hu._$name="RadioGroup";var dk={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1},rp=class extends ${static get $name(){return"Slider"}static get type(){return"slider"}static get configurable(){return{text:null,showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:50,unit:null,thumbSize:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",align:"b-t",anchor:!1,axisLock:!0}},localizableProperties:["text"],triggerChangeOnInput:null,defaultBindProperty:"value"}}compose(){const{id:e,min:r,max:t,showValue:i,step:n,text:s,value:a,unit:o="",disabled:l}=this,c=`${e}-input`,d=!!(s||i);return{class:{"b-has-label":d,"b-text":d,"b-disabled":l},children:{input:{tag:"input",type:"range",id:c,reference:"input",disabled:l,min:r,max:t,step:n,value:a,listeners:{input:"onInternalInput",change:"onInternalChange",mouseover:"onInternalMouseOver",mouseout:"onInternalMouseOut"}},label:{tag:"label",for:c,html:i?s?`${s} (${a}${o})`:a+o:s}}}}get focusElement(){return this.input}get percentProgress(){return(this.value-this.min)/(this.max-this.min)*100}onInternalKeyDown(e){!this.readOnly&&dk[e.key]&&e.stopImmediatePropagation()}onInternalChange(){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalInput(){const e=this;if(e.readOnly){e.input.value=e.value;return}e.value=parseInt(e.input.value,10),e.trigger("input",{value:e.value}),e.triggerChangeOnInput&&e.triggerChange(e)}onInternalMouseOver(){var e;const r=this,t=r.rtl?100-r.percentProgress:r.percentProgress;(e=r.tooltip)==null||e.showBy({target:k.from(r.input).inflate(r.thumbSize/2,-r.thumbSize/2),align:`b-t${Math.round(t)}`})}onInternalMouseOut(){var e;(e=this.tooltip)==null||e.hide()}triggerChange(e){this.triggerFieldChange({value:this.value,valid:!0,userAction:e})}updateMax(e){const r=this;r.input&&r._value>e&&(r.value=e,r.trigger("input",{value:r.value}))}updateMin(e){const r=this;r.input&&r._value<e&&(r.value=e,r.trigger("input",{value:r.value}))}changeTooltip(e,r){var t;return e&&(e.owner=this),this.showTooltip?ve.reconfigure(r,e,{owner:this,defaults:{forElement:this.input,html:String(this.value)+((t=this.unit)!=null?t:"")}}):null}changeValue(e){const r=this,{min:t,step:i}=r;return e=Math.min(Math.max(e,t),r.max),e>t?t+T.roundTo(e-t,i):T.roundTo(e,i)}updateValue(e){var r;const t=this,{input:i,_tooltip:n}=t;n&&(n.html=t.value+((r=t.unit)!=null?r:"")),i&&i.value!==String(e)&&(i.value=e,t.triggerChange(!1)),t.updateUI()}updateUI(){var e,r;const t=this;(e=t._tooltip)!=null&&e.isVisible&&((r=t._tooltip)==null||r.alignTo({target:k.from(t.input).inflate(t.thumbSize/2,-t.thumbSize/2),align:`b-t${Math.round(t.percentProgress)}`}))}};rp.initClass(),rp._$name="Slider";var ip=class extends Hn{static get $name(){return"SlideToggle"}static get type(){return"slidetoggle"}static get properties(){return{toggledCls:"b-slidetoggle-checked"}}construct(e){e!=null&&e.checked&&(e.cls=(e.cls||"")+" "+this.constructor.properties.toggledCls),super.construct(e)}get innerElements(){const e=super.innerElements;return e.splice(1,0,this.toggleElement),this.text?e[e.length-1].class="b-slidetoggle-label":e.pop(),e}get toggleElement(){return{class:"b-slidetoggle-toggle",reference:"slideToggle",children:[{class:"b-slidetoggle-thumb",reference:"slideThumb"}]}}internalOnChange(){super.internalOnChange(),this.element.classList[this.value?"add":"remove"](this.toggledCls)}};ip.initClass(),ip._$name="SlideToggle";var kE=["b-horizontal","b-vertical"],np=e=>w.getStyleValue(e.parentElement,"display")==="flex"&&(parseInt(w.getStyleValue(e,"flex-basis"),10)||parseInt(w.getStyleValue(e,"flex-grow"),10)),uk={horizontal:!1,vertical:!0},Un=class extends ${static get $name(){return"Splitter"}static get type(){return"splitter"}static get configurable(){return{orientation:"auto",vertical:null,containerElement:{$config:"nullify",value:null},nextNeighbor:{$config:"nullify",value:null},previousNeighbor:{$config:"nullify",value:null}}}static get delayable(){return{syncState:"raf"}}doDestroy(){var e;(e=this.mouseDetacher)==null||e.call(this),super.doDestroy()}compose(){return{class:{"b-splitter":1},listeners:{pointerdown:"onMouseDown",mouseenter:"syncState",...!q.supportsPointerEvents&&{mousedown:"onMouseDown",touchstart:"onMouseDown"}}}}get currentOrientation(){return this.vertical?"vertical":"horizontal"}getSibling(e=!0){let{element:r}=this,t;for(;!t&&(r=r[`${e?"next":"previous"}ElementSibling`]);)(!r.isConnected||w.isVisible(r))&&(t=r);return t}get nextWidget(){let{element:e}=this,r;for(;!r&&(e=e.nextElementSibling);)r=$.fromElement(e,this.element.parentElement);return r}get previousWidget(){let{element:e}=this,r;for(;!r&&(e=e.previousElementSibling);)r=$.fromElement(e,this.element.parentElement);return r}updateContainerElement(e){var r;const t=this;t.stateDetector=(r=t.stateDetector)==null?void 0:r.disconnect(),e&&(t.stateDetector=new MutationObserver(()=>t.syncState()),t.stateDetector.observe(e,{attributes:!0,childList:!0}))}updateNextNeighbor(e){this.watchNeighbor(e,"next")}updatePreviousNeighbor(e){this.watchNeighbor(e,"previous")}watchNeighbor(e,r){this.detachListeners(r),e==null||e.ion({name:r,thisObj:this,collapse:"syncState",expand:"syncState",hide:"syncState",show:"syncState"})}updateOrientation(){this.syncState.now()}updateVertical(e){var r;const t=(r=this.element)==null?void 0:r.classList;t==null||t.add(kE[e?1:0]),t==null||t.remove(kE[e?0:1])}syncState(){var e;const r=this,{element:t,nextWidget:i,previousWidget:n}=r;let s=(e=uk[r.orientation])!=null?e:null;if(r.nextNeighbor=i,r.previousNeighbor=n,r.disabled=i&&(i.collapsible&&i.collapsed||i.hidden)||n&&(n.collapsible&&n.collapsed||n.hidden),s!==null&&i&&n)r.containerElement=null;else if(r.containerElement=t.parentElement,r.rendered&&t.offsetParent){const a=w.getStyleValue(t.parentElement,"flex-direction");if(a)s=!a.startsWith("column");else{const o=t.previousElementSibling,l=t.nextElementSibling;if(!o||!l)return;const c=o.getBoundingClientRect(),d=l.getBoundingClientRect(),u=c.top<d.top?c:d,h=u===d?c:d;s=u.top===h.top}}r.vertical=s}onMouseDown(e){var r;e.preventDefault(),e.touches&&(e=e.touches[0]);const t=this,{element:i,nextNeighbor:n,previousNeighbor:s}=t,a=s?s.element:t.getSibling(!1),o=n?n.element:t.getSibling(),l=np(a),c=np(o),d=[];(r=t.mouseDetacher)==null||r.call(t);for(const h of i.parentElement.children)np(h)&&h!==i&&d.push({element:h,width:h.offsetWidth,height:h.offsetHeight});t.context={startX:e.pageX,startY:e.pageY,prevWidth:a.offsetWidth,prevHeight:a.offsetHeight,nextWidth:o.offsetWidth,nextHeight:o.offsetHeight,prevHasFlex:l,nextHasFlex:c,flexed:d,prev:a,next:o};const u={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:t};q.supportsPointerEvents||(u.mousemove=u.touchmove="onMouseMove",u.mouseup=u.touchend="onMouseUp"),i.classList.add("b-moving"),t.mouseDetacher=B.on(u),t.trigger("splitterMouseDown",{event:e})}onMouseMove(e){const r=this,{context:t,nextWidget:i,previousWidget:n}=r,s=t.prev.style,a=t.next.style,o=(e.pageX-t.startX)*(r.rtl?-1:1),l=e.pageY-t.startY;if(e.preventDefault(),Object.assign(t,{deltaX:o,deltaY:l}),t.started||(t.started=!0,r.trigger("dragStart",{context:t,event:e}),t.flexed.forEach(c=>{c.element.style.flexGrow=r.vertical?c.width:c.height,c.element.style.flexBasis="0"})),r.vertical){const c=t.prevWidth+o,d=t.nextWidth-o;t.prevHasFlex?s.flexGrow=c:n?n.width=c:s.width=`${c}px`,t.nextHasFlex?a.flexGrow=d:i?i.width=d:a.width=`${d}px`}else{const c=t.prevHeight+l,d=t.nextHeight-l;t.prevHasFlex?s.flexGrow=c:n?n.height=c:s.height=`${c}px`,t.nextHasFlex?a.flexGrow=d:i?i.height=d:a.height=`${d}px`}r.trigger("drag",{context:t,event:e})}onMouseUp(e){var r;const t=this;(r=t.mouseDetacher)==null||r.call(t),t.mouseDetacher=null,t.element.classList.remove("b-moving"),t.context.started&&t.trigger("drop",{context:t.context,event:e}),t.context=null}render(){super.render(...arguments),this.syncState.now(),this.vertical===null&&this.syncState()}};Un.initClass(),Un._$name="Splitter";var gu=class extends bl{static get $name(){return"Tab"}static get type(){return"tab"}static get configurable(){return{active:null,index:null,isFirst:null,isLast:null,item:{value:null,$config:"nullify"},itemCls:null,tabPanel:null,titleProperty:"text",titleSource:"title",role:"tab"}}compose(){const{active:e,cls:r,index:t,isFirst:i,isLast:n}=this,s=this.owner.visibleChildCount;return{tabindex:0,"aria-selected":e,"aria-setsize":s,"aria-posinset":t+1,class:{"b-tabpanel-tab":1,"b-active":e,"b-tab-first":i,"b-tab-last":n,...r},dataset:{index:t}}}updateIndex(e){this.isFirst=!e}updateItem(e,r){var t,i;const n=this;(r==null?void 0:r.tab)===n&&(r.tab=null),e&&(e.tab=n,n[n.titleProperty]=e[n.titleSource],n.itemCls=e.cls,n.ariaElement.setAttribute("aria-controls",e.id),e.role="tabpanel"),(t=n.itemChangeDetacher)==null||t.call(n),n.itemChangeDetacher=e&&Te.after(e,"onConfigChange","onItemConfigChange",n,{return:!1}),(i=n.itemHideDetacher)==null||i.call(n),n.itemHideDetacher=e==null?void 0:e.ion({beforeChangeHidden:"onItemBeforeChangeHidden",beforeHide:"onItemBeforeHide",beforeUpdateDisabled:"onItemBeforeUpdateDisabled",thisObj:n,prio:1e3}),n.syncMinMax()}updateItemCls(e,r){const{element:t}=this,i=t&&J.from(t==null?void 0:t.classList,!0);t&&(i.remove(r).add(e),t.className=i.value)}updateRotate(e,r){!e!=!r&&this.syncMinMax()}syncMinMax(){const e=this,{rotate:r,tabPanel:t}=e;let{_minWidth:i,_minHeight:n,_maxWidth:s,_maxHeight:a}=e;if(t){const{tabMinWidth:o,tabMaxWidth:l}=t;o!=null&&(r?(i===o&&(i=null),n=o):(n===o&&(n=null),i=o)),l!=null&&(r?(s===l&&(s=null),a=l):(a===l&&(a=null),s=l)),e.minWidth=i,e.minHeight=n,e.maxWidth=s,e.maxHeight=a}}onItemBeforeChangeHidden({source:e,hidden:r}){if(!e.$isDeactivating&&!e.$isActivating){const{tabPanel:t}=this;this.hidden=r,r&&e===t.activeItem&&t.activateAvailableTab(e)}}onItemBeforeHide(){this.item.$isDeactivating||this.hide()}onItemBeforeUpdateDisabled({source:e,disabled:r}){const{tabPanel:t}=this;this.disabled=r,e===t.activeItem&&t.activateAvailableTab(e)}onItemConfigChange({name:e,value:r}){e===this.titleSource&&(this[this.titleProperty]=r)}};gu.initClass(),gu._$name="Tab";var fu=e=>e.isTab,sp=class extends sa{static get $name(){return"TabBar"}static get type(){return"tabbar"}static get configurable(){return{defaultType:"tab",overflow:"scroll",role:"tablist",ignoreParentReadOnly:!0}}get firstTab(){return this.tabAt(0)}get lastTab(){return this.tabAt(-1)}get tabCount(){return this._items.countOf(fu)}get tabs(){return H.from(this._items,fu)}compose(){return{children:{toolbarContent:{class:{"b-tabpanel-tabs":1}}}}}indexOfTab(e){return this._items.indexOf(e,fu)}onChildAdd(e){super.onChildAdd(e),e.index==null&&this.syncTabs()}onChildRemove(e){super.onChildRemove(e),this.syncTabs()}onFocusIn(){const{activeIndex:e}=this.owner;isNaN(e)||this.tabs[e].focus()}syncTabs(){const{tabs:e}=this;for(let r=0,t=e.length;r<t;++r)e[r].index=r,e[r].isFirst=!r,e[r].isLast=r===t-1}tabAt(e){return this._items.find(fu,e)||null}};sp.initClass(),sp._$name="TabBar";var mu=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"],Al=class extends Lr{onChildAdd(e){super.onChildAdd(e);const r=this,{activeItem:t,owner:i}=r,n=i.activeIndex!=null?i.activeIndex:r.activeIndex||0,s=i.items.indexOf(e),a=t!=null?e===t:s===n;e.ion({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:r}),a?(r._activeIndex=s,r._activeItem=e,e.show()):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}onChildRemove(e){super.onChildRemove(e);const r=this;r._activeItem===e&&r.activateSiblingOf(e),r._activeIndex=r.owner.items.indexOf(r._activeItem),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:r})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:r}=this,t=r.items.slice(),i=t.indexOf(e);t.splice(i,1),this.activeIndex=Math.min(i,t.length-1)}setActiveItem(e,r=this.activeIndex,t){var i;const n=this,{owner:s}=n,{items:a}=s,o=e instanceof $,l=a[r],c=s.items[e=o?a.indexOf(e):parseInt(e,10)],d=(t==null?void 0:t.animation)!==!1,u=!(t!=null&&t.silent),h={prevActiveIndex:r,prevActiveItem:l};if(c&&!c.$isActivating&&c!==l){const g=l&&l.element,f=c&&c.element;if(n.animateDetacher){const p=n.animateDetacher.event;if(p.activeItem===c)return p.promise;n.animateDetacher(),p.prevActiveItem.element.classList.remove(...mu),p.activeItem.element.classList.remove(...mu),n.animateDetacher=null}if(h.activeIndex=e,h.activeItem=c,u&&s.trigger("beforeActiveItemChange",h)===!1)return null;const m=n._activeIndex!==h.activeIndex;m&&(n._activeIndex=h.activeIndex),u&&((i=s.onBeginActiveItemChange)==null||i.call(s,h)),m&&(n._activeIndex=h.prevActiveIndex),d&&g&&s.isVisible&&n.animateCardChange?h.promise=n.cardChangeAnimation=new Promise((p,v)=>{const y=l.monitorResize;l.monitorResize=!1,n.contentElement.style.overflowX="hidden",l._hidden=!0,c.$isActivating=!0,c.show(),c.$isActivating=!1,g.classList.add(e>r?"b-slide-out-left":"b-slide-out-right"),f.classList.add(e<r?"b-slide-in-left":"b-slide-in-right"),s.isAnimating=!0,n.animateDetacher=B.onTransitionEnd({mode:"animation",element:f,thisObj:l,handler(){if(s.isAnimating=n.cardChangeAnimation=!1,!n.animateDetacher){n.setActiveItem(e,r,t);return}n.animateDetacher=null,f.classList.remove(...mu),g&&(g.classList.remove(...mu),l.$isDeactivating=!0,l._hidden=!1,l.hide(),l.monitorResize=y,l.$isDeactivating=!1),n.contentElement.style.overflowX="",n.onActiveItemChange(h,p,!u)}}),n.animateDetacher.reject=v,n.animateDetacher.event=h}):(c.$isActivating=!0,c.show(),c.focus(),c.$isActivating=!1,l&&(l.$isDeactivating=!0,l.hide(),l.$isDeactivating=!1),n.onActiveItemChange(h,null,!u))}return h}onActiveItemChange(e,r,t){const i=this;i._activeItem=e.activeItem,i._activeIndex=e.activeIndex,!t&&i.owner.trigger("activeItemChange",e),i.owner.containsFocus&&e.activeItem.focus(),r==null||r(e)}renderChildren(){const{owner:e}=this;e.contentElement.classList.toggle(this.hideChildHeaderCls,e.suppressChildHeaders),super.renderChildren()}changeActiveIndex(e){const{owner:r}=this;return r.isConfiguring&&!r._items?e:Math.min(e,r.items.length-1)}updateActiveIndex(e,r){this.owner.isConfiguring||this.setActiveItem(e,r)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}get isChangingCard(){return!!this.animateDetacher}};E(Al,"$name","Card"),E(Al,"type","card"),E(Al,"configurable",{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null}),Al.initClass(),Al._$name="Card";var hk=e=>e.maximized,ap=class extends Vt{static get $name(){return"TabPanel"}static get type(){return"tabpanel"}static get alias(){return"tabs"}static get configurable(){return{activeTab:0,animateTabChange:!0,autoHeight:!1,defaultType:"container",focusable:!1,itemCls:"b-tabpanel-item",layout:{type:"card"},suppressChildHeaders:!0,tabBar:{type:"tabbar",weight:-2e3},tabMinWidth:null,tabMaxWidth:null}}get activeIndex(){return this.layout.activeIndex}get activeItem(){return this.layout.activeItem}get activeTabItemIndex(){var e;const{activeTab:r,items:t,tabBar:i}=this;return t.indexOf((e=i.tabs[r])==null?void 0:e.item)}get bodyConfig(){return T.merge({className:{"b-tabpanel-body":1}},super.bodyConfig)}get focusElement(){var e;const r=this.items[this.activeTab||0];return(r==null?void 0:r.focusElement)||((e=r==null?void 0:r.tab)==null?void 0:e.focusElement)}get tabPanelBody(){return this.bodyElement}finalizeInit(){super.finalizeInit();const e=this,{activeTab:r,layout:t}=e,{activeIndex:i}=t,{tabs:n}=e.tabBar,s=r>=0&&r<n.length&&e.items.indexOf(n[r].item);if(n.length>0&&(s===!1||s<0))throw new Error(`Invalid activeTab ${r} (${n.length} tabs)`);s!==i&&t.setActiveItem(s,i,{animation:!1,silent:!0}),t.animateCardChange=e.animateTabChange}onChildAdd(e){if(super.onChildAdd(e),!this.initialItems){const r=this,{tabBar:t}=r,i=r.makeTabConfig(e),n=i&&(t==null?void 0:t.firstTab),s=n&&t._items,a=n&&H.from(r._items,l=>l.tab||l===e),o=n?a.indexOf(e)+s.indexOf(n):0;i&&t&&(n&&e.weight==null&&o<s.count-1?t.insert(i,o):t.add(i))}}onChildRemove(e){const{tab:r}=e,{items:t}=this;r&&(this.tabBar.remove(r),r.destroy()),e===this.activeItem&&(this._activeTab=null,t.length&&(this.activeTab=t[Math.min(this.activeIndex,t.length-1)])),super.onChildRemove(e)}isDisabledOrHiddenTab(e){const{tabs:r}=this.tabBar,t=r==null?void 0:r[e];return t&&(t.disabled||t.hidden)}findAvailableTab(e,r=1){const{tabs:t}=this.tabBar,i=t.length,n=Math.max(0,t.indexOf(e.tab));n&&(r=-r);let s;for(let a=1;a<=i&&(s=(n+(r<0?i:0)+a*r)%i,!!this.isDisabledOrHiddenTab(s));++a);return s}activateAvailableTab(e,r=1){this.activeTab=this.findAvailableTab(e,r)}changeActiveTab(e,r){const t=this,{tabBar:i,layout:n}=t,{tabCount:s}=i;if(e.isWidget||T.isObject(e)?(t.items.indexOf(e)===-1&&(e=t.add(e)),e=i.indexOfTab(e.tab)):e=parseInt(e,10),!t.initialItems&&s>0&&(e<-1||e>=s))throw new Error(`Invalid activeTab ${e} (${s} tabs)`);if(t.isDisabledOrHiddenTab(e)&&(e=t.findAvailableTab(e)),n.animateCardChange&&n.cardChangeAnimation)n.cardChangeAnimation.then(a=>{(a==null?void 0:a.activeIndex)!==e&&(t._activeTab=e,t.updateActiveTab(e,r))});else return e}async updateActiveTab(e,r){var t;if(!this.initialItems){const{activeTabItemIndex:i,layout:n}=this;if(i>-1){const s=this.items[r],a=this.items[i];n.activeItem!==a&&(n.animateCardChange&&await this.tabSelectionPromise,s!=null&&s.containsFocus&&s.tab.focus(),this.tabSelectionPromise=(t=n.setActiveItem(a))==null?void 0:t.promise)}}}changeTabBar(e){return this.getConfig("strips"),this.strips={tabBar:e},this.strips.tabBar}makeTabConfig(e){const{tab:r}=e,t={item:e,type:"tab",tabPanel:this,disabled:!!e.disabled,hidden:e.initialConfig.hidden,weight:e.weight||0,internalListeners:{click:"onTabClick",thisObj:this},localizableProperties:{text:!1}};return r===!1?null:T.isObject(r)?gu.mergeConfigs(t,r):t}updateItems(e,r){const t=this,{activeTab:i,initialItems:n}=t;let s=0,a;super.updateItems(e,r),n&&(a=Array.from(e,o=>t.makeTabConfig(o)).filter(o=>{if(o)return o.index=s++,!0}),s&&(a[0].isFirst=!0,a[s-1].isLast=!0,a[i].active=!0,t.tabBar.add(a),t.activeTab=i))}updateTabMinWidth(e){var r;(r=this.tabBar)==null||r.items.forEach(t=>{t.isTab&&(t.minWidth=e)})}updateTabMaxWidth(e){var r;(r=this.tabBar)==null||r.items.forEach(t=>{t.isTab&&(t.maxWidth=e)})}updateAutoHeight(e){this.detachListeners("themeAutoHeight"),e&&be.ion({name:"themeAutoHeight",theme:"internalOnThemeChange",thisObj:this}),this.$measureHeight=e}applyAutoHeight(){const e=this,{layout:r,activeTab:t,element:i}=e,{animateCardChange:n}=r;r.animateCardChange=!1,e.height=null,e.up(hk)||(e.height=Math.max(...e.items.map(s=>(e.activeTab=s,i.clientHeight)))+1),e.activeTab=t,r.animateCardChange=n,e.$measureHeight=!1}internalOnThemeChange(){this.isVisible?this.applyAutoHeight():this.$measureHeight=!0}onBeginActiveItemChange(e){const r=this.tabBar.tabs,{activeItem:t,prevActiveItem:i}=e;this.activeTab=r.indexOf(t==null?void 0:t.tab),i!=null&&i.tab&&(i.tab.active=!1),t!=null&&t.tab&&(t.tab.active=!0,t.tab.show())}onBeforeActiveItemChange(e){return this.trigger("beforeTabChange",e)}onActiveItemChange(e){this.trigger("tabChange",e)}onTabClick(e){this.activeTab=e.source.item}onPaint(){super.onPaint(...arguments),this.$measureHeight&&this.applyAutoHeight()}};ap.initClass(),ap._$name="TabPanel";var op=class extends Ue{static get $name(){return"TextAreaField"}static get type(){return"textareafield"}static get alias(){return"textarea"}static get configurable(){return{resize:"none",inputAttributes:{tag:"textarea"}}}updateResize(e){this.input.style.resize=e}};op.initClass(),op._$name="TextAreaField";var pu=class extends jn{static get $name(){return"TextAreaPickerField"}static get type(){return"textareapickerfield"}static get configurable(){return{picker:{type:"widget",tag:"textarea",cls:"b-textareapickerfield-picker",scrollAction:"realign",align:{align:"t-b",axisLock:!0},autoShow:!1},triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},resize:"none",inputType:null}}startConfigure(e){typeof e.inline=="boolean"&&ne.deprecate("Core","6.0.0","TextAreaPickerField.inline config is no longer supported"),super.startConfigure(e)}get inputElement(){const e=super.inputElement;return e.readOnly="readonly",e.reference="displayElement",this.ariaElement="displayElement",e}get focusElement(){var e;return(e=this._picker)!=null&&e.isVisible?this.input:this.displayElement}get needsInputSync(){var e;return this.displayElement[this.inputValueAttr]!==String((e=this.inputValue)!=null?e:"")}showPicker(){const e=this,{picker:r}=e;e.inline||(r.width=e.pickerWidth||e[e.pickerAlignElement].offsetWidth,super.showPicker(!0))}focusPicker(){this.input.focus()}onPickerKeyDown(e){const r=this,t=r.input;switch(e.key.trim()||e.code){case"Escape":r.picker.hide();return;case"Enter":e.ctrlKey&&(r.syncInputFieldValue(),r.picker.hide());break}r.input=r.displayElement;const i=super.onPickerKeyDown(e);return r.input=t,i}syncInputFieldValue(e){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue(e)}changeValue(e){return e==null?"":e}changePicker(e,r){var t;const i=this,n=i.pickerWidth||(e==null?void 0:e.width);if(e=pu.reconfigure(r,e?N.merge({owner:i,forElement:i[i.pickerAlignElement],align:{matchSize:n==null,anchor:i.overlayAnchor,target:i[i.pickerAlignElement]},id:i.id+"-input",style:{resize:i.resize},html:(t=i.value)!=null?t:""},e):null,i),e){const s=i.input=e.element;i.inputListenerRemover=B.on({element:s,thisObj:i,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}return e}};pu.initClass(),pu._$name="TextAreaPickerField";var gk=e=>{var r;return r=class extends(e||F){compose(){const{minified:t}=this;return{class:{"b-minified":t}}}get widgetClass(){}},E(r,"$name","Minifiable"),E(r,"configurable",{minifiable:!0,minified:null}),r},fk=[],mk=e=>e[0]!=="*",FE=(e,r)=>{const t=e[r]||null;return delete e[r],t},pk=e=>e.responsiveRoot,OE={number:e=>({width:r})=>r<=e&&e},LE=e=>(delete e.once,{callback:FE(e,"callback"),configs:e,when:FE(e,"when")}),$E=(e,...r)=>{const t=r.flatMap(s=>(s==null?void 0:s.once)||fk),i=e.mergeConfigs(...r),n=LE(i);return n.once=t.length?LE(e.mergeConfigs(...t)):null,n},vk=(e,r)=>{let t,i=Proxy.revocable(e,{get(a,o){return t&&(t[o]=!0),e[o]}}),n=Te.after(e,"onConfigChange",(a,{name:o})=>{t!=null&&t[o]&&r()}),s=e.ion({resize:()=>{r()}});return e.monitorResize=!0,{widget:e,get object(){return i==null?void 0:i.proxy},destroy(){i&&(i.revoke(),n(),s(),i=n=s=null)},reset(){t=Object.create(null)}}},yk=e=>{var r;return r=class extends(e||F).mixin(fe,yE){get isResponsivePending(){return this.responsiveUpdateCount===0&&this.hasConfig("responsive")}get isResponsiveUpdating(){var t;return this._responsiveUpdating||((t=this.responsiveWidget)==null?void 0:t._responsiveUpdating)}updateResponsive(t){var i;const n=this,s=n.constructor,{responsiveDefaults:a}=n,o=Array.from(new Set(T.keys(t).concat(T.keys(a)))).filter(mk);let l=null,c,d,u,h;if(t){l={"*":$E(s,a["*"],t["*"])};for(d of o)u=t[d],u!==null&&u!==!1&&(c=c||u&&"when"in u,l[d]=$E(s,a["*"],a[d],t["*"],u),h=l[d].when,l[d].when=((i=OE[typeof h])==null?void 0:i.call(OE,h))||h)}n.$responsiveStates=l,n.$responsiveWhen=c,n.syncResponsiveWidget()}updateResponsiveState(t,i){var n,s,a,o,l;const c=this,{$responsiveStates:d}=c,u=++c.responsiveStateChanges===1,h=(n=c.element)==null?void 0:n.classList,g=d["*"],f=d[t]||g,m=u&&(f.once||g.once),p=u&&c.isStateful,v=c.responsiveWidget;let y=f.configs,C=m==null?void 0:m.configs;C&&(y=y?c.constructor.mergeConfigs(y,C):C),i&&(h==null||h.remove(`b-responsive-${i.toLowerCase()}`)),t&&(h==null||h.add(`b-responsive-${t.toLowerCase()}`)),p&&(C=c.loadStatefulData(),C&&(y=y?c.constructor.mergeConfigs(y,C):C),c.suspendStateful()),c._responsiveUpdating=!0;try{(s=c.trigger)==null||s.call(c,"beforeResponsiveStateChange",{state:t,oldState:i,target:v}),y&&c.setConfig(y),(a=f.callback)==null||a.call(f,{source:c,state:t,oldState:i,target:v,initial:u}),(o=m==null?void 0:m.callback)==null||o.call(m,{source:c,state:t,oldState:i,target:v,initial:u}),(l=c.trigger)==null||l.call(c,"responsiveStateChange",{state:t,oldState:i,target:v})}finally{c._responsiveUpdating=!1,p&&c.resumeStateful()}}get responsiveTarget(){return this.responsiveWidget||this._responsiveTarget}updateResponsiveTarget(){this.syncResponsiveWidget()}updateResponsiveWidget(t){var i;const n=this,s=t&&n.responsiveUpdate;(i=n.$responsiveWrapper)==null||i.destroy(),n.$responsiveWrapper=t&&vk(t,s),s==null||s.now()}responsiveUpdate(){const t=this,{$responsiveStates:i,$responsiveWrapper:n}=t,s=n==null?void 0:n.widget;if(i&&n){let a=null,o=0,l=i,c,d;s&&s!==t&&!t.$responsiveWhen&&(s.getConfig("responsive"),l=s.$responsiveStates||l),n.reset();for(d in i)d!=="*"&&(c=l[d].when(n.object,q),c!=null&&c!==!1&&(!a||c<o)&&(a=d,o=c));++t.responsiveUpdateCount,t.responsiveState=a}}syncResponsiveWidget(){var t;const i=this;let n=null,s;if(!i.isDestroying&&i.responsive){if(s=i.responsiveTarget,!(n=s))n=!i.responsiveRoot&&((t=i.up)==null?void 0:t.call(i,pk))||i;else if(typeof s=="string"&&(n=s==="@"?i:s[0]==="@"?i[s.substring(1)]:i.up(s),!n))throw new Error(`No match for responsiveTarget="${s}"`);if(!n.isWidget)throw new Error(`${n.constructor.$$name} is not a widget and cannot be a responsiveTarget`)}return i.responsiveWidget=n,n}changeBreakpoints(t){return T.assertObject(t,"breakpoints"),t!=null&&t.width&&Object.keys(t.width).forEach(i=>{t.width[i].maxWidth=i}),t!=null&&t.height&&Object.keys(t.height).forEach(i=>{t.height[i].maxHeight=i}),t}updateBreakpoints(t){t&&(this.monitorResize=!0)}getBreakpoint(t,i){const n=Object.keys(t).map(a=>parseInt(a)).sort(),s=n.find(a=>i<=a);return t[s!=null?s:t["*"]&&"*"]}activateBreakpoint(t,i){var n,s;const a=this,o=a[`current${t}Breakpoint`];i!==o&&(a[`current${t}Breakpoint`]=i,a.setConfig(i.configs),o&&a.element.classList.remove(`b-breakpoint-${o.name.toLowerCase()}`),a.element.classList.add(`b-breakpoint-${i.name.toLowerCase()}`),a.trigger(`responsive${t}Change`,{breakpoint:i,prevBreakpoint:o}),(n=i.callback)==null||n.call(i,{source:a,breakpoint:i,prevBreakpoint:o}),(s=a.recompose)==null||s.call(a))}applyResponsiveBreakpoints(t,i){var n;const s=this,{width:a,height:o}=(n=s.breakpoints)!=null?n:{};if(a){const l=s.getBreakpoint(a,t);s.activateBreakpoint("Width",l)}if(o){const l=s.getBreakpoint(o,i);s.activateBreakpoint("Height",l)}}onInternalResize(t,i,n,s,a){super.onInternalResize(t,i,n,s,a),this.applyResponsiveBreakpoints(i,n)}},E(r,"$name","Responsive"),E(r,"configurable",{responsive:{$config:{lazy:"paint"},value:null},responsiveDefaults:{small:{when:400},medium:{when:800},large:{when:()=>1/0},"*":{}},responsiveRoot:null,responsiveState:null,responsiveTarget:{value:null,$config:{lazy:"paint"}},responsiveWidget:{value:null,$config:{nullify:!0}},breakpoints:null}),E(r,"delayable",{responsiveUpdate:"raf"}),E(r,"fenced",{syncResponsiveWidget:!0}),E(r,"prototypeProperties",{responsiveStateChanges:0,responsiveUpdateCount:0}),r},bk=e=>{var r;return r=class extends(e||F){changeCssVarPrefix(t){return T.assertString(t,"prefix"),t&&!t.endsWith("-")&&(t=t+"-"),t||""}changeCss(t){T.assertObject(t,"css");const i=this;if(!globalThis.Proxy)throw new Error("Proxy not supported");const n=new Proxy({},{get(s,a){var o;return(o=getComputedStyle(i.element||document.documentElement).getPropertyValue(`--${i.cssVarPrefix}${O.hyphenate(a)}`))==null?void 0:o.trim()},set(s,a,o){return(i.element||document.documentElement).style.setProperty(`--${i.cssVarPrefix}${O.hyphenate(a)}`,o),!0}});return t&&(i._element?T.assign(n,t):i.$initialCSS=t),n}updateElement(t,...i){super.updateElement(t,...i),this.$initialCSS&&T.assign(this.css,this.$initialCSS)}get widgetClass(){}},E(r,"$name","Styleable"),E(r,"configurable",{cssVarPrefix:"",css:{}}),r},Hi="http://www.w3.org/2000/svg",Ck={bar:1,outline:2,text:3},Sk=(e,r)=>parseInt(e.order,10)-parseInt(r.order,10),jE=(e,r)=>parseInt(e.dataset.order,10)-parseInt(r.dataset.order,10),Dk=e=>e.field,wk=()=>!1,Ek=/\s+/,Yn=class extends ${static get configurable(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:Hi,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:Hi,tag:"g",reference:"scaledSvgGroup"},{ns:Hi,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:!1,singleTextForAllBars:!0,monitorResize:!0,getRectClass(e,r,t,i){return""},getOutlineClass(e,r){return""},getBarTip(e,r,t,i){},getBarText(e,r,t){return""},getRectConfig:null,getBarTextRenderData(e,r,t,i){return e},getBarTextTip(e,r,t,i){}}}construct(e){const r=this;super.construct(e),r.scheduleRefresh=r.createOnFrame(r.refresh,[],r,!0),r.refresh()}set tip(e){var r;const t=this;(r=t.tip)==null||r.destroy(),e?t._tip=ve.new({owner:t,forElement:t.svgElement,forSelector:"rect",internalListeners:{beforeShow:"up.onBeforeTipShow"}},e):t._tip=null}onElementResize(){super.onElementResize(...arguments);const e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform",`scale(${e.width} ${e.height})`)}onBeforeTipShow({source:e}){const r=parseInt(e.activeTarget.dataset.index);e.html=e.contentTemplate({histogram:this,index:r})}updateSeries(e){const r=this,t=r._series={};let i=0,n=0;for(const s in e)if(e[s]!==!1){const a=t[s]=N.merge({},e[s]);a.field||(a.field=s),a.type||(a.type="bar"),"order"in a||(a.order=Ck[a.type]*10+i),"index"in a||(a.index=i),a.type==="bar"&&(a.index=n++),a.id=s,i++}!r.topValue&&r._data&&(r.topValue=r.getDataTopValue(r._data)),r.refreshSuspended||r.scheduleRefresh()}getDataTopValue(e,r){const t=Object.values(r||this.series).map(Dk);let i=0,n;for(let s=0,{length:a}=e;s<a;s++){n=e[s];for(let o=0,{length:l}=t;o<l;o++)i=Math.max(i,n[t[o]])}return i}updateData(e){const r=this;r._data=e,!r.topValue&&r._data&&r._series&&(r.topValue=r.getDataTopValue(e)),r.refreshSuspended||r.scheduleRefresh()}updateTopValue(e){const r=this;r._topValue=e,!e&&r._data&&(r._topValue=r.getDataTopValue(r._data)),r.refreshSuspended||r.scheduleRefresh()}scheduleRefresh(){}suspendRefresh(){this.refreshSuspended++}resumeRefresh(){this.refreshSuspended&&this.refreshSuspended--}refresh(e){const r=this,{series:t,_tip:i,topValue:n,singleTextForAllBars:s}=r,a=(e==null?void 0:e.args)||[],o=[],l=[];if(t){for(const c of Object.values(t).sort(Sk)){const d=r[`draw${O.capitalize(c.type)}`](c,...a);Array.isArray(d)?o.push.apply(o,d):o.push(d),!s&&c.type==="bar"&&l.push(...r.drawText(c,...a))}o.sort(jE),s?l.push(...r.drawText(null,...a)):l.sort(jE),X.sync({domConfig:{width:"100%",height:"100%",preserveAspectRatio:"none",dataset:{topValue:n},children:[{ns:Hi,tag:"g",reference:"scaledSvgGroup",children:o},{ns:Hi,tag:"g",reference:"unscaledSvgGroup",children:l}]},configEquality:wk,targetElement:r.svgElement}),i&&i.isVisible&&r.onBeforeTipShow({source:i})}}drawBar(e,...r){const t=this,{topValue:i,data:n,omitZeroHeightBars:s,barStyle:a}=t,{field:o,order:l,stretch:c}=e,{length:d}=n,u=1/d,h=[],g=O.createId(e.id),f=e.index,m=c?1:void 0;let p;for(let v=0,y=0,{length:C}=n;v<C;v++,y+=p){const D=n[v];let S=D.rectConfig={ns:Hi,tag:"rect",dataset:{}};const x=D[o],R=x?m||D.height||(x>i?i:x)/i:0,I=1-R,M=t.callback("getBarTip",t,[e,S,D,v,...r]);p=D.width||u,a?S.style=a:delete S.style,Object.assign(S.dataset,{index:v,order:l,series:g});const P={[`b-series-${g}`]:1,[`b-series-index-${f}`]:1},_=t.callback("getRectClass",t,[e,S,D,v,...r]);_&&_.split(Ek).forEach(A=>P[A]=1),Object.assign(S,{x:y,y:I,width:p,height:R,class:P}),M?S.dataset.btip=M:delete S.dataset.btip,t.getRectConfig&&(S=t.getRectConfig(S,D,v,e,...r)),S&&(S.height||!s)&&h.push(S)}return h}changeGetRectConfig(e){return e?this.bindCallback(e):null}drawOutline(e,...r){const t=this,{topValue:i,data:n}=t,{field:s,order:a,id:o}=e,l=1/n.length,c=["M 0,1"],d={ns:Hi,tag:"path",dataset:{order:a,id:o}};let u,h="M",g="L";for(let f=0,m=0,{length:p}=n;f<p;f++){const v=1-n[f][s]/i;u=n[f].width||l,c.push(`${h} ${m},${v} ${g} ${m+=u},${v}`),h=g=""}return d.class=`b-series-${e.id} b-series-index-${e.index} `+t.callback("getOutlineClass",t,[e,n,...r]),d.d=c.join(" "),d}drawText(e,...r){const t=this,{data:i}=t,n=1/i.length,s="100%",a=[];for(let o=0,l,c=0,{length:d}=i;o<d;o++,c+=l){l=i[o].width||n;const u=t.callback("getBarText",t,[i[o],o,e,...r]);if(u){const h=t.callback("getBarTextRenderData",t,[{ns:Hi,tag:"text",className:"b-bar-legend",html:u,left:c,width:l,x:`${(c+l/2)*100}%`,y:i[o].y!==void 0?i[o].y:s,dataset:{index:o,series:e}},i[o],o,e,...r]),g=t.callback("getBarTextTip",t,[h,i[o],o,e,...r]);g?h.dataset.btip=g:delete h.dataset.btip,a.push(h)}}return a}};E(Yn,"type","histogram"),E(Yn,"$name","Histogram"),E(Yn,"properties",{refreshSuspended:0}),Yn.initClass(),Yn._$name="Histogram";var _l="http://www.w3.org/2000/svg",vu=class extends ${static get type(){return"scale"}static get $name(){return"Scale"}static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:_l,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:_l,tag:"g",reference:"scaledSvgGroup",children:[{ns:_l,tag:"path",reference:"pathElement"}]},{ns:_l,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(e){return e||(e=this.horizontal?"bottom":"right"),e}updateAlign(e,r){this.element.classList.remove(`b-align-${r}`),this.element.classList.add(`b-align-${e}`)}updateHorizontal(e,r){this.element.classList.remove(`b-scale-${r?"horizontal":"vertical"}`),this.element.classList.add(`b-scale-${e?"horizontal":"vertical"}`)}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){var e;if(!this.scalePoints)return;const r=this,{horizontal:t,width:i,height:n,align:s,scalePoints:a,scaleMaxPadding:o}=r,l=(e=a[a.length-1])==null?void 0:e.value,c=[],d=[],u=1/(l+o*l);r.scaledSvgGroup.setAttribute("transform",`scale(${t?i:1} ${t?1:n})`);for(const h of a){const g=!!h.text,f=u*h.value;if(g){const m={ns:_l,tag:"text",className:"b-scale-tick-label",html:h.text,dataset:{tick:h.value}};t?(m.x=`${f*100}%`,m.y=s==="top"?"1.6em":n-12):(m.x=s==="left"?"12":`${i-12}`,m.y=`${(1-f)*100}%`),d.push(m)}t?s==="top"?c.push(`M${f},0 L${f},${g?10:5}`):c.push(`M${f},${n} L${f},${n-(g?10:5)}`):s==="left"?c.push(`M0,${1-f} L${g?10:5},${1-f}`):c.push(`M${i},${1-f} L${i-(g?10:5)},${1-f}`)}r.pathElement.setAttribute("d",c.join("")),X.syncChildren({domConfig:{children:d}},r.unscaledSvgGroup)}};vu.initClass(),vu._$name="Scale";var qn=class extends F{static get $name(){return"AvatarRendering"}static get configurable(){return{element:null,colorPrefix:"b-sch-",tooltip:null,size:null}}doDestroy(){var e;(e=this.tooltip)==null||e.destroy(),super.doDestroy()}updateElement(e){B.on({element:e,delegate:".b-resource-image",error:"onImageErrorEvent",thisObj:this,capture:!0})}changeTooltip(e){return ve.new({forElement:this.element,forSelector:".b-resource-avatar",cls:"b-resource-avatar-tooltip"},e)}static get failedUrls(){return this._failedUrls||(this._failedUrls=new Set),this._failedUrls}getResourceAvatar(e){if(Array.isArray(e))return e.map(u=>this.getResourceAvatar(u));const{initials:r,color:t,iconCls:i,imageUrl:n,defaultImageUrl:s,dataset:a={},resourceRecord:o,alt:l=O.encodeHtml(o==null?void 0:o.name)}=e,c=this.getImageConfig(r,t,n,s,a,l)||this.getIconConfig(i,a)||this.getResourceInitialsConfig(r,t,a),{size:d}=this;return Object.assign(c.style,{...d?{height:d,width:d}:void 0}),c}getImageConfig(e,r,t,i,n,s){if(t=qn.failedUrls.has(t)?i:t||i,t)return{tag:"img",draggable:"false",loading:"lazy",class:{"b-resource-avatar":1,"b-resource-image":1},style:{},alt:s,elementData:{defaultImageUrl:i,imageUrl:t,initials:e,color:r,dataset:n},src:t,dataset:n}}getIconConfig(e,r){if(e)return e&&{tag:"i",style:{},class:{"b-resource-avatar":1,"b-resource-icon":1,[e]:1},dataset:r}}getResourceInitialsConfig(e,r,t){const i=w.isNamedColor(r)&&r,n=!i&&r,{size:s}=this;return{tag:"div",class:{"b-resource-avatar":1,"b-resource-initials":1,[`${this.colorPrefix}${i}`]:i},style:{backgroundColor:n||null,...s?{height:s,width:s}:void 0},children:[e],dataset:t}}onImageErrorEvent({target:e}){if(!e.matches(".b-resource-avatar"))return;const{defaultImageUrl:r,initials:t,color:i,imageUrl:n,dataset:s}=e.elementData;if(r&&!e.src.endsWith(r.replace(/^[./]*/gm,"")))e.src=r;else{const a=w.createElement(this.getResourceInitialsConfig(t,i,s));a.elementData=e.elementData,e.parentElement.replaceChild(a,e)}qn.failedUrls.add(n)}};qn._$name="AvatarRendering",window&&!window.bryntum&&(window.bryntum={});var oe=class{constructor(e){if(e){if(e.isLocation)return e;if(e.nodeType===Node.ELEMENT_NODE){const r=$.fromElement(e,"gridbase"),t=r&&e.closest(r.focusableSelector);if(t){const{dataset:i}=t.parentNode;this.init({grid:r,rowIndex:r.store.includes(i.id)?r.store.indexOf(i.id):i.index||-1,columnId:t.dataset.columnId}),this.initialTarget=e}}else this.init(e)}}init(e){var r,t;const i=this,n=i.grid=e.grid,{store:s,columns:a}=n,{visibleColumns:o}=a;if(e.target&&(i.actionTargets=[i._target=e.target]),e.record)i._id=e.record.id;else if("id"in e)i._id=e.id,e.id==null&&(i._rowIndex=-1);else{const l=isNaN(e.row)?isNaN(e.rowIndex)?NaN:e.rowIndex:e.row;i._rowIndex=Math.max(Math.min(Number(l),s.count-1),n.hideHeaders?0:-1),i._id=(r=s.getAt(i._rowIndex))==null?void 0:r.id}if("_rowIndex"in i||(i._rowIndex=s.indexOf(i.id)),i.isSpecialRow=(t=i.record)==null?void 0:t.isSpecialRow,"columnId"in e)i._column=a.getById(e.columnId);else if("field"in e)i._column=a.get(e.field);else{const l=isNaN(e.column)?isNaN(e.columnIndex)?NaN:e.columnIndex:e.column;isNaN(l)?i._column="column"in e?isNaN(e.column)?e.column:o[e.column]:o[0]:(i._columnIndex=Math.min(Number(l),o.length-1),i._column=o[i._columnIndex])}"_columnIndex"in i||(i._columnIndex=o.indexOf(i._column))}get isLocation(){return!0}equals(e,r=!1){const t=this;return(e==null?void 0:e.isLocation)&&e.grid===t.grid&&(r?t.id===e.id&&t._column===e._column:e.record===t.record&&e.column===t.column&&e.target===t.target)}get rowIndex(){const{_id:e}=this,{store:r}=this.grid;return r.includes(e)?r.indexOf(e):Math.min(this._rowIndex,r.count-1)}get visibleRowIndex(){const{rowManager:e}=this.grid,{rowIndex:r}=this;return r===-1?r:Math.max(Math.min(r,e.lastFullyVisibleTow.dataIndex),e.firstFullyVisibleTow.dataIndex)}get isSelectable(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}get record(){if(this._rowIndex>-1){const{store:e}=this.grid;return e.includes(this._id)?e.getById(this._id):e.getAt(this._rowIndex)}}get id(){return this._id}get column(){const{visibleColumns:e}=this.grid.columns;return e!=null&&e.includes(this._column)?this._column:e==null?void 0:e[this.columnIndex]}get columnId(){var e;return(e=this.column)==null?void 0:e.id}get columnIndex(){var e;return Math.min(this._columnIndex,((e=this.grid.columns.visibleColumns)==null?void 0:e.length)-1)}move(e){const r=this,{record:t,column:i,grid:n}=r,{store:s}=n,a=n.columns.visibleColumns,o=new oe;let l=s.includes(t)?s.indexOf(t):r.rowIndex,c=a.includes(i)?a.indexOf(i):r.columnIndex;const d=n.hideHeaders?0:-1,u=s.count-1,h=a.length-1,g=l===d,f=l===u,m=c===0,p=c===h;switch(e){case oe.PREV_CELL:m?g||(c=h,l--):c--;break;case oe.NEXT_CELL:p?f||(c=0,l++):c++;break;case oe.UP:g||l--;break;case oe.DOWN:f||(l===-1?l=n.rowManager.firstFullyVisibleRow.dataIndex:l++);break;case oe.FIRST_COLUMN:c=0;break;case oe.LAST_COLUMN:c=h;break;case oe.FIRST_CELL:l=d,c=0;break;case oe.LAST_CELL:l=u,c=h;break;case oe.PREV_PAGE:l=Math.max(d,l-Math.floor(n.scrollable.clientHeight/n.rowHeight));break;case oe.NEXT_PAGE:l=Math.min(u,l+Math.floor(n.scrollable.clientHeight/n.rowHeight));break}return o.init({grid:n,rowIndex:l,columnIndex:c}),o}get cell(){var e,r;const t=this,{grid:i,id:n,_cell:s}=t;if(s)return s;if(n==null)return(e=i.columns.getById(t.columnId))==null?void 0:e.element;{const{row:a}=t;if(a)return a.getCell(t.columnId)||a.getCell((r=i.columns.getAt(t.columnIndex))==null?void 0:r.id)}}get row(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}get target(){const{cell:e,_target:r}=this,{focusableFinder:t}=this.grid;if(e)return r||(t.currentNode=this.grid.focusableFinderCell=e,t.nextNode()||e)}get isActionable(){const{cell:e,_target:r}=this,t=e&&w.getActiveElement(e);return!!(t&&e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY||r&&r!==this.cell)}get isColumnHeader(){return this.cell&&this.rowIndex===-1}get isCell(){return this.cell&&this.record}};oe.UP=1,oe.NEXT_CELL=2,oe.DOWN=3,oe.PREV_CELL=4,oe.FIRST_COLUMN=5,oe.LAST_COLUMN=6,oe.FIRST_CELL=7,oe.LAST_CELL=8,oe.PREV_PAGE=9,oe.NEXT_PAGE=10,oe._$name="Location";var BE=e=>typeof e=="number"||(e==null?void 0:e.endsWith("px")),jr=class extends ce.mixin(Le,We){static get fields(){return["type","text","field","renderer","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},"readOnly",{name:"editor",defaultValue:{}},"cellEditor","finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(e,r,t){if(!e)return!1;if(e===!0)return!0;const i={};return typeof e=="function"?(i.originalSortFn=e,i.sortFn=e.bind(t)):typeof e=="object"&&(Object.assign(i,e),i.fn&&(i.sortFn=i.fn,delete i.fn)),i}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert(e){if(!e)return!1;if(e===!0)return!0;const r={columnOwned:!0};return typeof e=="function"?r.filterFn=e:typeof e=="object"&&Object.assign(r,e),r}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"alwaysClearCell",defaultValue:!1},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{cellLabel}"}]}static get autoExposeFields(){return!1}construct(e,r){const t=this;t.masterStore=r,r&&(t._grid=Array.isArray(r)?r[0].grid:r.grid),t.localizableProperties=Pe.mergeMethods.distinct(e.localizableProperties,["text","ariaLabel","cellAriaLabel"]),e.localeClass&&(t.localeClass=e.localeClass),super.construct(...arguments),t.isLeaf&&!("field"in t.data)&&(t.field="_"+(t.type||"")+ ++jr.emptyCount,t.noFieldSpecified=!0),!t.width&&!t.flex&&!t.children&&t.set({width:jr.defaultWidth,flex:null},null,!0),t.headerWidgets&&t.initHeaderWidgets(t.headerWidgets),t.isParent&&(t.meta.visibleChildren=new Set,t.collapsible&&(t.collapsible=!0))}shouldSync(e){return e.isColumn&&e.text===this.text&&(e.field===this.field||String(e.renderer)===String(this.renderer))&&(!e.previousSibling&&!this.previousSibling||e.previousSibling.shouldSync(this.previousSibling))}get isCollapsible(){var e;return((e=this.children)==null?void 0:e.length)>1&&this.collapsible}get collapsed(){return this.get("collapsed")}set collapsed(e){this.set("collapsed",e,!0),this.onCollapseChange(!e),this.trigger("toggleCollapse",{collapsed:e})}onCellFocus(e){this.location=e,this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel")),e.rowIndex!==-1&&this.updateCellAriaLabel(this.localizeProperty("cellAriaLabel"))}updateHeaderAriaLabel(e){w.setAttributes(this.element,{"aria-label":e})}updateCellAriaLabel(e){var r,t;!((r=this.location)!=null&&r.isSpecialRow)&&((t=this.location)!=null&&t.cell)&&(e!=null&&e.length||(e=this.location.column.text),w.setAttributes(this.location.cell,{"aria-label":e}))}doDestroy(){var e,r,t;(t=(r=(e=this.data)==null?void 0:e.editor)==null?void 0:r.destroy)==null||t.call(r),this.destroyHeaderWidgets(),super.doDestroy()}set headerWidgets(e){this.initHeaderWidgets(e),this.set("headerWidgets",e)}get headerWidgets(){return this.get("headerWidgets")}initHeaderWidgets(e){this.destroyHeaderWidgets();const r=this.headerWidgetMap={};for(const t of e){const i=$.create({owner:this,...t});r[i.ref||i.id]=i}}destroyHeaderWidgets(){var e;for(const r of Object.values(this.headerWidgetMap||{}))(e=r.destroy)==null||e.call(r)}static generateAutoCls(){const e=[];for(let t=this;t!==jr;t=t.superclass)t.type&&t.type!==t.superclass.type&&e.push(`b-${t.type.toLowerCase()}-cell`);const r=e.join(" ");return(jr.autoClsMap||(jr.autoClsMap=new Map)).set(this,r),r}getCellClass(e){var r,t;const{record:i,column:n}=e,{cellCls:s,internalCellCls:a,grid:o,constructor:l,align:c}=n,d=((r=jr.autoClsMap)==null?void 0:r.get(l))||l.generateAutoCls(),u=e.cell.classList.contains("b-editing"),h={[o.cellCls]:o.cellCls,[d]:d,[s]:s,[a]:a,"b-cell-dirty":i.isFieldModified(n.field)&&(n.compositeField||((t=i.fieldMap[n.field])==null?void 0:t.persist)!==!1),[`b-grid-cell-align-${c}`]:c,"b-selected":o.selectionMode.cell&&o.isCellSelected(e),"b-focused":o.isFocused(e),"b-auto-height":n.autoHeight,"b-editing":u};return i.isSpecialRow&&h["b-checkbox-selection"]&&(h["b-checkbox-selection"]=!1),h}get locked(){return this.data.region==="locked"}set locked(e){this.region=e?"locked":"normal"}get region(){return this.parent.isRoot?this.get("region"):this.parent.region}set region(e){this.set("region",e)}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.field&&this.data.groupable}set groupable(e){this.set("groupable",e)}get editor(){const e=this;let{editor:r}=e.data;if(r&&!r.isWidget){const t=e.grid.processCellEditor({editor:r,field:e.field});t?r=e.data.editor=t.editor:(typeof r=="string"&&(r={type:r}),r=e.data.editor=$.create(T.merge(e.defaultEditor,{owner:e.grid,label:O.encodeHtml(e.text)},r)))}return r}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}getFilterableValue(e){return this.getRawValue(e)}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get grid(){var e;return this._grid||((e=this.parent)==null?void 0:e.grid)}set subGrid(e){this._subGrid=e}get subGrid(){var e;return this._subGrid||((e=this.grid)==null?void 0:e.getSubGridFromColumn(this))}get subGridElement(){return this.subGrid.element}get element(){return this.grid.getHeaderElement(this)}get previousVisibleSibling(){const e=this.region;let r=this.previousSibling;for(;r&&(r.hidden||r.region!==e);)r=r.previousSibling;return r}get nextVisibleSibling(){const e=this.region;let r=this.nextSibling;for(;r&&(r.hidden||r.region!==e);)r=r.nextSibling;return r}get isLastInSubGrid(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}get allowDrag(){return!this.parent.isRoot||!!(this.nextVisibleSibling||this.previousVisibleSibling)}get textWrapper(){return w.getChild(this.element,".b-grid-header-text")}get textElement(){return w.down(this.element,".b-grid-header-text-content")}get contentElement(){return w.down(this.element,".b-grid-header-children")}get isSorted(){return this.grid.store.sorters.some(e=>e.field===this.field)}get isFocusable(){return this.isLeaf}static get text(){return this.$meta.fields.defaults.text}get headerText(){return this.htmlEncodeHeaderText?O.encodeHtml(this.text):this.text}get isVisible(){return!this.hidden&&(!this.parent||this.parent.isVisible)}hide(e=!1,r=!1){const t=this,{parent:i}=t;t.hidden||(t.hidden=!0,i&&!i.isRoot&&!i.isTogglingAll&&!i.children.some(s=>s.hidden!==!0)&&!i.hidden&&(e=!0,i.hide()),t.isParent?t.children.forEach(n=>n.hide(!0,!0)):i.isRoot||i.meta.visibleChildren[r?"add":"delete"](t),e||t.stores.forEach(n=>n.trigger("columnHide",{column:t})))}show(e=!1){var r;const t=this,{parent:i}=t;t.hidden&&(t.hidden=!1,i!=null&&i.hidden&&i.show(),t.isParent&&((r=t.meta.visibleChildren)==null||r.forEach(n=>n.show(!0))),e||t.stores.forEach(n=>n.trigger("columnShow",{column:t})))}toggle(e){if(this.hidden&&e===void 0||e===!0)return this.show();if(!this.hidden&&e===void 0||e===!1)return this.hide()}toggleChildren(e=this.children,r=void 0){var t,i;const n=this;(t=n.grid.columns)==null||t.beginBatch(),n.isTogglingAll=!0,e.forEach(s=>s.toggle(r)),n.isTogglingAll=!1,(i=n.grid.columns)==null||i.endBatch()}onCollapseChange(e=void 0){var r,t;const i=this;if(i.collapseMode==="toggleAll")i.toggleChildren();else{const{firstChild:n}=i;n.flex!=null&&i.collapsed?(n.oldFlex=n.flex,n.width=n.element.offsetWidth):!i.collapsed&&n.oldFlex&&(n.flex=n.oldFlex,n.oldFlex=null),(r=i.grid.columns)==null||r.beginBatch(),i.isTogglingAll=!0,i.children.slice(1).forEach(s=>s.toggle(e)),i.isTogglingAll=!1,(t=i.grid.columns)==null||t.endBatch()}}set collapsible(e){const r=this;if(r.set("collapsible",e),r.isParent){const{headerWidgets:t=[]}=r;if(e)t.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:r.collapsed,icon:`b-icon-collapse-${r.grid.rtl?"right":"left"}`,pressedIcon:`b-icon-collapse-${r.grid.rtl?"left":"right"}`,cls:"b-grid-header-collapse-button b-transparent",onToggle:({pressed:i})=>r.collapsed=i});else{const i=t.findIndex(n=>n.ref==="collapseExpand");i>-1&&t.splice(i,1)}r.headerWidgets=t,r.collapsed&&r.onCollapseChange(!1)}}get collapsible(){return this.get("collapsible")}generateId(){return jr.generatedIdIndex||(jr.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++jr.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}measureSize(e){var r;return w.measureSize(e,(r=this.subGrid)==null?void 0:r.element)}get calcMinWidth(){const{width:e,minWidth:r}=this.data;return BE(e)&&BE(r)?Math.max(parseInt(e)||0,parseInt(r)||0):e}get width(){return this.data.width}set width(e){const r={width:e};e&&"flex"in this.data&&(r.flex=null),this.set(r)}set flex(e){const r={flex:e};e&&"width"in this.data&&(r.width=null),this.set(r)}get flex(){return this.data.flex}calculateMinWidth(){const e=this,r=e.measureSize(e.width),t=e.measureSize(e.minWidth);let i=0;return e.children&&(i=e.children.reduce((n,s)=>n+s.calculateMinWidth(),0)),Math.max(r,t,i)}resizeToFitContent(e,r,t=!1){const i=this,{grid:n,element:s,fitMode:a}=i,{rowManager:o,store:l}=n,{count:c}=l;if(c<=0||i.fitMode==="none"||!i.fitMode)return;const[d]=o.rows,{rowElement:u,cellElement:h}=n.beginGridMeasuring(),g=new oe({grid:n,column:i,id:null});let f=0,m,p,v,y,C,D,S={length:0,record:null};if(h._domData={columnId:i.id,row:d,rowElement:u},g._cell=h,g.updatingSingleRow=!0,g.isMeasuring=!0,h.innerHTML="",n.resizeToFitIncludesHeader&&!n.hideHeaders){if(!n.$headerPadding){const R=globalThis.getComputedStyle(s);n.$headerPadding=parseInt(R.paddingLeft)}const x=s.querySelector(".b-grid-header-text-content");x.style.cssText="flex: none; width: auto",f=x.offsetWidth+n.$headerPadding*2+2,x.style.cssText=""}for(c>1e3?(m=Math.max(Math.min(o.topIndex+Math.round(o.rowCount/2)-500,c-1e3),0),p=m+1e3):(m=0,p=c),v=m;v<p;v++){if(y=l.getAt(v),C=i.getRawValue(y),a==="value")D=String(C).length;else if(g._record=S.record,g._id=y.id,g._rowIndex=v,d.renderCell(g),a==="textContent")D=h.textContent.length;else{const x=h.offsetWidth;x>f&&(f=x)}D>S.length&&(S={record:y,length:D,rowIndex:v})}return S.length>0&&(a==="value"||a==="textContent")&&(g._record=S.record,g._id=S.record.id,g._rowIndex=S.rowIndex,d.renderCell(g),f=Math.max(f,h.offsetWidth)),Array.isArray(e)&&([e,r]=e),f=Math.max(f,e||0),f=Math.min(f,r||1e6),t||n.endGridMeasuring(),i.width=i.maxWidth?f=Math.min(f,i.maxWidth):f,f}getState(){const e=this,r={id:e.id,hidden:e.hidden,region:e.region,locked:e.locked};return e.children||(r[e.flex?"flex":"width"]=e.flex||e.width),e.isCollapsible&&(r.collapsed=e.collapsed),r}applyState(e){const r=this;r.beginBatch(),"locked"in e&&(r.locked=e.locked),"width"in e&&(r.width=e.width),"flex"in e&&(r.flex=e.flex),"width"in e&&r.flex?r.flex=void 0:"flex"in e&&r.width&&(r.width=void 0),"region"in e&&(r.region=e.region),r.endBatch(),"hidden"in e&&r.toggle(e.hidden!==!0),"collapsed"in e&&(r.collapsed=e.collapsed)}remove(){const{subGrid:e,grid:r}=this,t=e&&(r==null?void 0:r.focusedCell);(t==null?void 0:t.columnId)===this.id&&(r.owns(w.getActiveElement(r))?r.navigateRight():r._focusedCell=new oe({grid:r,rowIndex:t.rowIndex,column:e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),super.remove()}getRawValue(e){return e.getValue(this.field)}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}clearCell(e){e.innerHTML="",delete e._content}canEdit(e){if(e.isEditable){const r=e.isEditable(this.field);if(r!==void 0)return r}return!0}insertChild(e,r=null,t=!1){return e=Array.isArray(e)?e:[e],e.forEach(i=>{const{parent:n}=i;n!=null&&n.collapsed&&i===n.firstChild&&n.children.length>1&&n.children.filter(s=>!s.hidden).length===1&&(i.nextSibling.hidden=!1)}),this.sealed&&!this.inProcessChildren?null:super.insertChild(...arguments)}canFillValue(){return!0}getCurrentConfig(e){var r;const t=super.getCurrentConfig(e);return(r=this.sortable)!=null&&r.originalSortFn&&(t.sortable=this.sortable.originalSortFn),t.renderer===this.internalRenderer&&delete t.renderer,t.headerRenderer===this.internalHeaderRenderer&&delete t.headerRenderer,delete t.ariaLabel,delete t.cellAriaLabel,t}},ye=jr;E(ye,"$name","Column"),E(ye,"type","column"),ye.emptyCount=0,ye.defaultWidth=100,ye.exposeProperties(),ye._$name="Column";var xk={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},Rk=[{field:"region"}],Z=class extends We(re){static get defaultConfig(){return{modelClass:ye,tree:!0,autoAddField:!1,syncDataOnLoad:{threshold:1},sorters:Rk,reapplySortersOnAdd:!0}}construct(e){const r=this;e.grid&&(e.grid._columnStore=r,r.id=`${e.grid.id}-columns`,e.grid.ion({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:r})),super.construct(e),r.ion({change:r.onStoreChange,sort:()=>r.updateChainedStores(),thisObj:r,prio:1})}doDestroy(){const e=[];this.isChained||this.traverse(r=>e.push(r)),super.doDestroy(),this.isChained||e.forEach(r=>r.destroy())}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,r=this){this.traverseWhile((t,i)=>e.call(r,t,i),!0)}get totalFixedWidth(){let e=0;for(const r of this)r.hidden||(r.children?r.children.forEach(t=>e+=this.calculateFixedWidth(t)):e+=this.calculateFixedWidth(r));return e}get hasFlex(){return this.visibleColumns.some(e=>e.flex)}calculateFixedWidth(e){return e.flex?e.measureSize(ye.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter(r=>r.isVisible&&(!r.subGrid||!r.subGrid.collapsed))),e._visibleColumns}onStoreChange({action:e,changes:r}){e==="update"&&!("hidden"in r)||this.clearCaches()}clearSubGridCaches({subGrid:e}){e.columns.clearCaches(),this.clearCaches()}clearCaches(){var e;this._visibleColumns=null,(e=this.masterStore)==null||e.clearCaches()}onMasterDataChanged(e){super.onMasterDataChanged(e),(e.action!=="update"||"hidden"in e.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(e,r=!0,t=!1){const i=this.visibleColumns,n=e instanceof ye?e:this.getById(e);let s=i.indexOf(n)+(r?1:-1);if(!i[s])if(t)s=r?0:i.length-1;else return null;return i[s]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){var r,t;const{grid:i={}}=this,{store:n}=i,s=(t=(r=n==null?void 0:n.modelClass)==null?void 0:r.fieldMap)==null?void 0:t[e.field];let a=this.modelClass;if(s!=null&&s.column&&(e=N.merge({},s.column,e)),e.type&&(a=Z.getColumnClass(e.type),!a))throw new Error(`Column type '${e.type}' not registered`);e.locked&&(e.region="locked",delete e.locked);const o=new a(e,this);if(o.data.region||(o.data.region=i.defaultRegion||"normal"),this.autoAddField&&!o.noFieldSpecified&&n&&!s){let l=o.field;o.constructor.fieldType&&(l={name:o.field,type:o.constructor.fieldType}),n.modelClass.addField(l)}return o}indexOf(e){if(e==null)return-1;const r=super.indexOf(e);return r>-1?r:this.records.findIndex(t=>t.field===e)}get usesAutoHeight(){return this.find(e=>e.autoHeight)}get usesFlexAutoHeight(){return this.find(e=>e.autoHeight&&e.flex!=null)}resolveSyncNode(e){return e.id?super.resolveSyncNode(e):e.field?{id:e.field,node:this.allRecords.find(r=>r.field===e.field)}:e.type?{id:e.type,node:this.allRecords.find(r=>r.type===e.type)}:{id:null,node:null}}static registerColumnType(e,r=!1){e.simpleRenderer=r,(Z.columnTypes||(Z.columnTypes={}))[e.type]=e}static getColumnClass(e){return Z.columnTypes&&Z.columnTypes[e]}generateColumnForField(e,r){var t;typeof e=="string"&&this.grid&&(e=(t=this.grid.store)==null?void 0:t.modelClass.fieldMap[e]);let i=e.column||xk[e.type]||{};return typeof i=="string"&&(i={type:i}),i=Object.assign({text:e.text||O.separate(e.name),field:e.name},r,i),e.precision!=null&&(i.format.maximumFractionDigits=e.precision),e.columnType&&(i.type=e.columnType),this.createRecord(i)}},Tk=(e,r)=>({update:({store:t,record:i,changes:n})=>{let s=!0;return("width"in n||"minWidth"in n||"maxWidth"in n||"flex"in n)&&(s=e.call(r,{store:t,record:i,changes:n})),s}});Z.registerColumnType(ye,!0),Z._$name="ColumnStore";var Kn=class extends ye{get groupHeaderReserved(){return!0}construct(e,r){const t=this;super.construct(...arguments),!e.width&&!e.flex&&t.grid.ion({paint:"updateAutoWidth",thisObj:t}),t.disableIfGridReadOnly&&t.grid.element.classList.add("b-actioncolumn-readonly"),t.renderer!==t.internalRenderer&&(t.externalRenderer=t.renderer,t.renderer=t.internalRenderer)}internalRenderer({grid:e,column:r,record:t,callExternalRenderer:i=!0}){var n,s;const a=t&&"groupRowFor"in t.meta,{subGrid:o}=r;return i&&((n=this.externalRenderer)==null||n.call(this,...arguments)),{className:{"b-action-ct":1},children:(s=r.actions)==null?void 0:s.map((l,c)=>{var d;if("visible"in l&&(typeof l.visible=="function"&&l.visible({record:t})===!1||l.visible===!1)||a&&!l.showForGroup||!a&&l.showForGroup)return"";const{tooltip:u,renderer:h}=l,g=typeof u=="function"||(d=u==null?void 0:u.startsWith)!=null&&d.call(u,"up.")?o.callback(u,o,[{record:t}]):u||"";if(h){const f=o.callback(h,o,[{index:c,record:t,column:r,tooltip:g,action:l}]);return typeof f=="string"?{tag:"span",dataset:{...ve.encodeConfig(g),index:c},html:f}:(f.dataset=f.dataset||{},f.dataset.index=c,f)}else return{tag:"button",dataset:{...ve.encodeConfig(g),index:c},"aria-label":g,className:{"b-tool":1,"b-action-item":1,[l.cls]:l.cls}}})}}onCellClick({column:e,record:r,target:t}){var i;if(e!==this||!t.classList.contains("b-action-item"))return;let n=t.dataset.index;n||(n=t.parentElement.dataset&&t.parentElement.dataset.index);const s=(i=e.actions)==null?void 0:i[n],a=s==null?void 0:s.onClick;a&&this.callback(a,e,[{record:r,action:s,target:t}])}updateAutoWidth(){const e=this,r=[],{actions:t}=e;if(!e.element)return;const i=e.actions=[];t==null||t.forEach(s=>{const a={...s};delete a.visible,a.showForGroup?(delete a.showForGroup,r.push(a)):i.push(a)}),r.length>i.length&&(e._actions=r);const n=w.createElement(e.internalRenderer({column:e,callExternalRenderer:!1})).outerHTML;e.width=w.measureText(n,e.element,!0,e.element.parentElement),e.actions=t}};E(Kn,"type","action"),E(Kn,"fields",[{name:"actions",type:"array"},{name:"disableIfGridReadOnly",defaultValue:!1}]),E(Kn,"defaults",{filterable:!1,groupable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,minWidth:30}),Z.registerColumnType(Kn),Kn.exposeProperties(),Kn._$name="ActionColumn";var rr=class extends ye{static get defaults(){return{filterType:"number",format:""}}get defaultEditor(){const{format:e,name:r,max:t,min:i,step:n,largeStep:s,align:a}=this;return T.cleanupProperties({type:"numberfield",format:e,name:r,max:t,min:i,step:n,largeStep:s,textAlign:a})}get formatter(){const e=this,{format:r}=e;let t=e._formatter;return(!t||e._lastFormat!==r)&&(e._formatter=t=Rr.get(e._lastFormat=r)),t}formatValue(e){return e!=null&&(e=this.formatter.format(e),this.unit&&(e=`${e}${this.unit}`)),e!=null?e:""}defaultRenderer({value:e}){return this.formatValue(e)}};E(rr,"type","number"),E(rr,"fieldType","number"),E(rr,"fields",["format","min","max","step","largeStep","unit"]),Z.registerColumnType(rr,!0),rr.exposeProperties(),rr._$name="NumberColumn";var va=class extends rr{static get defaults(){return{function:"sum",includeParentInChangeSet:!1}}construct(e,r){const t=this;t.configuredAlign="align"in e,t.configuredEditor="editor"in e,super.construct(...arguments);const{grid:i}=r;t.function==="sum"&&(t.function="sumChildren"),i&&(t.store=i.store)}set store(e){const r=this,t={update:"onRecordUpdate",thisObj:r,prio:1e3},i=r._store;if(e!==i){i&&i.un(t),r._store=e;const{modelClass:n}=e,s=n.fieldMap[r.field];s&&s.type==="number"&&(r.configuredAlign||(r.align="end"),r.configuredEditor||(r.editor="number")),e.ion(t)}}canEdit(e){return e.isLeaf}get store(){return this._store}sumChildren(...e){let r=0;for(let t=0,{length:i}=e;t<i;t++)r+=parseFloat(e[t]||0,10);return r}avg(...e){let r=0;const{length:t}=e;for(let i=0;i<t;i++)r+=parseFloat(e[i]||0,10);return r/t}onRecordUpdate({record:e,changes:r}){const t=this,{rowManager:i}=t.grid;t.field in r&&e.isLeaf&&e.bubble(n=>{const s=i.getRowFor(n);if(s){const a=s.getCell(t.field);a&&s.renderCell(a)}},!0)}getRawValue(e){var r;let t;const i=this,{field:n}=i;if((r=e.children)!=null&&r.length){const s=i.function,a=typeof s=="string"&&typeof Math[s]=="function",{handler:o,thisObj:l}=a?{handler:Math[s],thisObj:Math}:i.resolveCallback(s);t=o.apply(l,e.children.map(c=>i.getRawValue(c))),i.includeParentInChangeSet?e.set(n,t,!0):e.setData(n,t)}else t=e.getValue(n);return t}canFillValue(){return!1}};E(va,"type","aggregate"),E(va,"fields",["function","includeParentInChangeSet"]),Z.registerColumnType(va,!0),va.exposeProperties(),va._$name="AggregateColumn";var oi=class extends ye{static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1,alwaysClearCell:!1}}construct(e,r){const t=this;t.widgetMap={},super.construct(...arguments),t.renderer!==t.internalRenderer&&(t.externalRenderer=t.renderer,t.renderer=t.internalRenderer)}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}updateReadOnly(e){for(const r of Object.values(this.widgetMap))r.cellInfo.record.readOnly||(r.readOnly=e)}internalRenderer(e){var r;const t=this,{cellElement:i,column:n,record:s,isExport:a}=e,{widgets:o}=n;if(!a&&o&&(i.widgets||t.clearCell(i),i.widgets=e.widgets=o.map((c,d)=>{var u,h;let g,f;if(i.widgets&&(g=i.widgets[d],f=g.element.nextElementSibling,c.recreate&&g&&(delete t.widgetMap[g.id],g.destroy(),i.widgets[d]=null)),g||(t.onBeforeWidgetCreate(c,e),c.recomposeAsync=!1,c.owner=t.grid,g=la.append(c,f?{insertBefore:f}:i)[0],t.widgetMap[g.id]=g,t.onAfterWidgetCreate(g,e),g.name&&g.ion({change:({value:m,userAction:p})=>{p&&g.cellInfo.record.setValue(g.name,m)}})),g.cellInfo={record:s,column:n},t.grid&&!t.meta.isSelectionColumn&&(g.readOnly=t.grid.readOnly||s.readOnly),((u=t.onBeforeWidgetSetValue)==null?void 0:u.call(t,g,e))!==!1){const m=c.valueProperty||"value"in g&&"value"||g.defaultBindProperty;if(m){const p=g.name?s.getValue(g.name):e.value;g[m]=p}}return(h=t.onAfterWidgetSetValue)==null||h.call(t,g,e),g})),a)return null;const l=(r=t.externalRenderer)==null?void 0:r.call(t,e);return!l&&!o?"":l}onBeforeWidgetCreate(e,r){}onAfterWidgetCreate(e,r){}clearCell(e){e.widgets&&(e.widgets.forEach(r=>{delete this.widgetMap[r.id],r.destroy()}),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}};E(oi,"$name","WidgetColumn"),E(oi,"type","widget"),E(oi,"fields",["widgets"]),Z.registerColumnType(oi),oi.exposeProperties(),oi._$name="WidgetColumn";var Nt=class extends oi{construct(e,r){var t;super.construct(...arguments);const i=this;if(Object.assign(i,{externalHeaderRenderer:i.headerRenderer,externalOnBeforeWidgetSetValue:i.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:i.onAfterWidgetSetValue,onBeforeWidgetSetValue:i.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:i.internalOnAfterWidgetSetValue,headerRenderer:i.internalHeaderRenderer}),!i.meta.isSelectionColumn){const n=(t=i.grid)==null?void 0:t.store.modelClass;i.field?n&&!n.fieldMap[i.field]&&!i.constructor.suppressNoModelFieldWarning&&(console.warn(i.$$name+" is configured with a field, but this is not part of your Model `fields` collection."),n.addField({name:i.field,type:"boolean"})):console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}}doDestroy(){var e;(e=this.headerCheckbox)==null||e.destroy(),super.doDestroy()}internalHeaderRenderer({headerElement:e,column:r}){let t;return e.classList.add("b-check-header"),r.showCheckAll?(e.classList.add("b-check-header-with-checkbox"),r.headerCheckbox?e.appendChild(r.headerCheckbox.element):r.headerCheckbox=new Hn({appendTo:e,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",internalListeners:{change:"onCheckAllChange",thisObj:r}})):t=r.headerText,t=r.externalHeaderRenderer?r.externalHeaderRenderer.call(this,...arguments):t,r.showCheckAll?void 0:t}updateCheckAllState(e){this.headerCheckbox&&(this.headerCheckbox.suspendEvents(),this.headerCheckbox.checked=e,this.headerCheckbox.resumeEvents())}onCheckAllChange({checked:e}){const r=this;if(r.field){const{store:t}=r.grid;t.beginBatch(),t.forEach(i=>r.updateRecord(i,r.field,e)),t.endBatch()}r.trigger("toggleAll",{checked:e})}internalRenderer({value:e,isExport:r,record:t,cellElement:i}){if(r)return e==null?"":e;const n=super.internalRenderer(...arguments);return t.readOnly&&!this.meta.isSelectionColumn&&(i.widgets[0].readOnly=!0),e?i.widgets[0].input.setAttribute("checked",!0):i.widgets[0].input.removeAttribute("checked"),n}onBeforeWidgetCreate(e,r){e.cls=this.checkCls}onAfterWidgetCreate(e,r){r.cellElement.widget=e,e.ion({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(e){var r;e.record=e.cellInfo.record,this.isInitialSet=!0,(r=this.externalOnBeforeWidgetSetValue)==null||r.call(this,...arguments)}internalOnAfterWidgetSetValue(e){var r;this.isInitialSet=!1,(r=this.externalOnAfterWidgetSetValue)==null||r.call(this,...arguments)}onBeforeCheckboxChange({source:e,checked:r,userAction:t}){const i=this,{grid:n}=i,{record:s}=e.cellInfo;if(t&&i.field&&(!n.features.cellEdit||n.features.cellEdit.disabled)||i.meta.isSelectionColumn&&!n.isSelectable(s)&&r)return!1;if(!i.isInitialSet)return i.trigger("beforeToggle",{record:s,checked:r})}onCheckboxChange({source:e,checked:r}){if(!this.isInitialSet){const t=this,{record:i}=e.cellInfo,{field:n}=t;n&&(t.updateRecord(i,n,r),r?t.updateCheckAllState(t.grid.store.every(s=>s[n],null,!0)):t.updateCheckAllState(!1)),t.trigger("toggle",{record:i,checked:r})}}updateRecord(e,r,t){const i=`set${O.capitalize(r)}`;e[i]?e[i](t):e.set(r,t)}onCellKeyDown({event:e,cellElement:r}){if(e.key===" "){const t=r.widget;t==null||t.toggle(),e.preventDefault(),e.handled=!0}}getCurrentConfig(e){const r=super.getCurrentConfig(e);return delete r.onBeforeWidgetSetValue,delete r.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(r.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(r.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),r}};E(Nt,"$name","CheckColumn"),E(Nt,"type","check"),E(Nt,"fields",["checkCls","showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"]),E(Nt,"defaults",{align:"center",checkCls:null,showCheckAll:!1,sortable:!0,filterable:!0,widgets:[{type:"checkbox",valueProperty:"checked"}]}),Z.registerColumnType(Nt,!0),Nt._$name="CheckColumn";var Vi=class extends ye{construct(){var e;super.construct(...arguments);const r=this,{grid:t}=r;r.menu=new Fn({owner:t,rootElement:t.rootElement,autoShow:!1,align:"t50-b50",anchor:!0,internalListeners:{hide(){r.picker.navigator.activeItem=null,delete r._editingRecord}},items:[Object.assign({type:r.colorEditorType,ref:"list",addNoColorItem:r.addNoColorItem,colorSelected({color:i}){var n;(n=r._editingRecord)==null||n.set(r.field,i),r.menu.hide()}},(e=r.colors)!=null&&e.length?{colors:r.colors}:{})]})}applyValue(e,r,t){if(!this.isConstructing){const{picker:i}=this;r==="colors"?i.colors=t:r==="addNoColorItem"&&(i.addNoColorItem=t)}super.applyValue(...arguments)}get picker(){return this.menu.widgetMap.list}renderer({value:e}){let r="b-empty",t=e;if(e){const i=this.picker.getColorClassName(e);i?(r=i,t=null):r=""}return{className:"b-color-cell-inner "+r,style:{backgroundColor:t},"data-btip":e}}onCellClick({grid:e,record:r,target:t}){if(t.classList.contains("b-color-cell-inner")&&!this.readOnly&&!e.readOnly&&!r.isSpecialRow&&!r.readOnly){const{picker:i,menu:n}=this,s=r.get(this.field);this._editingRecord=r,i.deselectAll(),i.select(s),i.refresh(),n.showBy(t)}}};E(Vi,"$name","ColorColumn"),E(Vi,"type","color"),E(Vi,"fields",[{name:"colorEditorType",defaultValue:"colorpicker"},"colors",{name:"addNoColorItem",defaultValue:!0}]),E(Vi,"defaults",{align:"center",editor:null}),Z.registerColumnType(Vi),Vi._$name="ColorColumn";var li=class extends ye{static get defaults(){return{format:"L",step:1,minWidth:85,filterType:"date"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:r}){e.innerHTML=this.formatValue(r)}formatValue(e){return typeof e=="string"&&(e=b.parse(e,this.format||void 0)),b.format(e,this.format||void 0)}set format(e){const{editor:r}=this.data;this.set("format",e),r&&(r.format=e)}get format(){return this.get("format")}get defaultEditor(){const e=this,{min:r,max:t,step:i,format:n}=e;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:e.grid.weekStartDay,format:n,max:t,min:r,step:i}}};E(li,"$name","DateColumn"),E(li,"type","date"),E(li,"fieldType","date"),E(li,"fields",["format","pickerFormat","step","min","max"]),Z.registerColumnType(li,!0),li.exposeProperties(),li._$name="DateColumn";var Xn=class extends rr{static get defaults(){return{min:0,max:100,showValue:!1,lowThreshold:20,htmlEncode:!1,searchable:!1,summaryRenderer:({sum:e})=>`${e}%`,fitMode:!1}}constructor(e,r){super(...arguments),this.internalCellCls="b-percent-bar-cell"}defaultRenderer({value:e}){return e=e||0,{className:"b-percent-bar-outer",role:"progressbar","aria-Valuemin":0,"aria-Valuemax":100,"aria-Valuenow":e,tabIndex:0,children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":e===0,"b-low":e<this.lowThreshold},style:{width:e+"%"},children:[this.showValue?{tag:"span",text:e+"%"}:void 0]}]}}resizeToFitContent(){}};E(Xn,"type","percent"),E(Xn,"fieldType","number"),E(Xn,"fields",["showValue","lowThreshold"]),Xn.sum="average",Z.registerColumnType(Xn,!0),Xn._$name="PercentColumn";var Ni=class extends rr{static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,minWidth:"11.2em",editor:!1,fitMode:"value"}}renderer({value:e}){return{className:{"b-rating-cell-inner":1,"b-not-editable":!this.editable},children:H.populate(this.max,r=>{const t=r<e;return{tag:"i",className:{"b-rating-icon":!0,"b-filled":t,"b-empty":!t,[t?this.filledIcon:this.emptyIcon]:!0}}})}}onCellClick({grid:e,column:r,record:t,target:i,event:n}){if(i.classList.contains("b-rating-icon")&&!e.readOnly&&r.editable){let s=[].indexOf.call(i.parentNode.childNodes,i);i.classList.contains("b-filled")&&(n.metaKey||n.shiftKey)&&(s=s-1),t.getValue(r.field)===1&&s===0&&(s=-1),t.set(r.field,s+1)}}};E(Ni,"$name","RatingColumn"),E(Ni,"type","rating"),E(Ni,"fieldType","number"),E(Ni,"fields",["emptyIcon","filledIcon","editable"]),Z.registerColumnType(Ni,!0),Ni.exposeProperties(),Ni._$name="RatingColumn";var kl=class extends ye{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,draggable:!1,minWidth:50,width:50,align:"center",text:"#",editor:!1,readOnly:!0}}construct(e){super.construct(...arguments);const r=this,{grid:t}=r;r.internalCellCls="b-row-number-cell",r.externalHeaderRenderer=r.headerRenderer,r.headerRenderer=r.internalHeaderRenderer,t&&(t.ion({bindStore:"bindStore",thisObj:r}),r.bindStore({store:t.store,initial:!0}),t.store.count&&!t.rendered&&t.ion({paint:"resizeToFitContent",thisObj:r,once:!0}))}get groupHeaderReserved(){return!0}bindStore({store:e,initial:r}){const t=this;t.detachListeners("grid"),e.ion({name:"grid",[`change${t.grid.asyncEventSuffix}`]:"onStoreChange",thisObj:t}),!r&&!t.resizeToFitContent()&&t.measureOnRender()}onStoreChange({action:e,isMove:r}){if(e==="dataset"||e==="add"||e==="remove"||e==="removeall"){if(e==="remove"&&r)return;const t=this.resizeToFitContent();e==="dataset"&&!t&&this.grid.store.count&&this.measureOnRender()}}measureOnRender(){this.grid.rowManager.ion({renderDone(){this.resizeToFitContent()},once:!0,thisObj:this})}renderer({record:e,grid:r}){return e.isSpecialRow?"":r.store.indexOf(e,!0)+1}resizeToFitContent(){const{grid:e}=this,{store:r}=e,{count:t}=r;if(t&&!this.hidden){const i=e.element.querySelector(`.b-grid-cell[data-column-id="${this.id}"]`);if(i){const n=parseInt(w.getStyleValue(i,"padding-left")),s=w.measureText(t,i);return this.width=Math.max(this.minWidth,s+2*n),!0}}return!1}set flex(e){}internalHeaderRenderer({headerElement:e,column:r}){var t;return e.classList.add("b-rownumber-header"),((t=r.externalHeaderRenderer)==null?void 0:t.call(this,...arguments))||r.headerText}};E(kl,"$name","RowNumberColumn"),E(kl,"type","rownumber"),Z.registerColumnType(kl,!0),kl._$name="RowNumberColumn";var ya=class extends ye{static get defaults(){return{htmlEncode:!1}}constructor(e,r){super(...arguments);const t=this;if(!t.template)throw new Error("TemplateColumn needs a template");if(typeof t.template!="function")throw new Error("TemplateColumn.template must be a function")}renderer(e){if(!e.record.isSpecialRow)return this.template({value:e.value,record:e.record,field:this.field})}};E(ya,"type","template"),E(ya,"fields",["template"]),Z.registerColumnType(ya,!0),ya.exposeProperties(),ya._$name="TemplateColumn";var Zn=class extends ye{static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:r}){e.innerHTML=this.formatValue(r)}formatValue(e){return typeof e=="string"&&(e=b.parse(e,this.format)),b.format(e,this.format)}set format(e){const{editor:r}=this;this.set("format",e),r&&(r.format=e)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"time",format:this.format}}};E(Zn,"type","time"),E(Zn,"fieldType","date"),E(Zn,"fields",["format"]),Z.registerColumnType(Zn,!0),Zn.exposeProperties(),Zn._$name="TimeColumn";var HE=!1,Jn=class extends ye{static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.7},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"},"renderer"]}constructor(e,r){super(...arguments);const t=this;t.shouldHtmlEncode=t.htmlEncode,t.setData("htmlEncode",!1),t.renderer&&(t.originalRenderer=t.renderer),t.renderer=t.treeRenderer.bind(t)}treeRenderer(e){var r,t,i,n,s,a;const o=this,{grid:l,cellElement:c,row:d,record:u,isExport:h}=e,g=u.instanceMeta(l.store),f=!u.isLeaf&&g.collapsed,m={className:"b-tree-cell-value"},p=[m],v={className:{"b-tree-cell-inner":1},tag:u.href?"a":"div",href:u.href,target:u.target,children:p},y={"b-tree-parent-row":0,"b-tree-collapsed":0,"b-tree-expanded":0,"b-loading-children":0};let C,D,{value:S}=e,x=o;const R=l.isTreeGrouped&&!u.isLeaf&&l.features.treeGroup.parentRenderer;if(o.originalRenderer||R){let M;R?(u.field&&(x=l.columns.get(u.field),S=x.isWidgetColumn?S:(t=(r=x.renderer||x.defaultRenderer)==null?void 0:r.call(x,{...e,column:x,value:u.name,isTreeGroup:!0}))!=null?t:u.name),M=l.features.treeGroup.parentRenderer({field:u.field,value:S,column:x,record:u.firstGroupChild,grid:l})):M=o.originalRenderer(e);const P=(i=l.hasFrameworkRenderer)==null?void 0:i.call(l,{cellContent:M,renderingColumn:x});C=typeof M=="object"&&!P,S=P?"":M===!1?c.innerHTML:M,e.rendererHtml=M}if(C||(S=String(S!=null?S:"")),h)return S;if(u.isLeaf)c.classList.add("b-tree-leaf-cell"),D=e.iconCls||u.iconCls||o.leafIconCls;else{const M=!u.isExpanded(l.store),P=M?o.expandIconCls:o.collapseIconCls,_=M?o.collapsedFolderIconCls:o.expandedFolderIconCls;y["b-tree-parent-row"]=1,y["b-tree-collapsed"]=M,y["b-tree-expanded"]=!M,y["b-loading-children"]=g.isLoadingChildren,c.classList.add("b-tree-parent-cell"),p.unshift({tag:"i",className:{"b-tree-expander":1,[P]:1,"b-empty-parent":!g.isLoadingChildren&&u.children!==!0&&!((n=u.children)!=null&&n.length)}}),HE=D=e.iconCls||u.iconCls||_}if(D&&p.splice(p.length-1,0,{tag:"i",className:{"b-tree-icon":1,[D]:1}}),d.isRow&&(d.assignCls(y),!u.isLeaf))if(d.setAttribute("aria-expanded",!f),f)d.removeAttribute("aria-owns");else for(const M in l.subGrids){const P=d.elements[M];w.setAttributes(P,{"aria-owns":(s=u.children)!=null&&s.length?(a=u.children)==null?void 0:a.map(_=>`${l.id}-${M}-${_.id}`).join(" "):null})}Array.isArray(S)?m.children=S:C?Object.assign(m,S):x.shouldHtmlEncode||!S.includes("<")?(v.className["b-text-value"]=1,m.text=S):m.html=S;const I=u.childLevel*o.indentSize+(u.isLeaf?HE?2:D?.5:.4:0);return v.style=`padding-inline-start:${I}em`,v}getCurrentConfig(e){const r=super.getCurrentConfig(e);return r.renderer=this.originalRenderer,r}};E(Jn,"$name","TreeColumn"),E(Jn,"type","tree"),Z.registerColumnType(Jn,!0),Jn.exposeProperties(),Jn._$name="TreeColumn";var zi=class extends ce{static get fields(){return[{name:"iconCls",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0}]}};zi.exposeProperties(),zi._$name="GridRowModel";var ba=class extends Q.mixin(uE){get clipboardRecords(){return this.clipboardData||[]}cellsToString(e){var r;const t=this;let i=0,n=0,s="";e.sort((a,o)=>a.rowIndex===o.rowIndex?a.columnIndex-o.columnIndex:a.rowIndex-o.rowIndex);for(const a of e){const{record:o,column:l,rowIndex:c,columnIndex:d}=a;c>i?(s.length>0&&(s+=`
`.repeat(c-i)),i=c,n=d):d>n&&(s.length>0&&(s+="	".repeat(d-n)),n=d);let u=(r=l.toClipboardString)==null?void 0:r.call(l,a);u===void 0&&(u=o.getValue(l.field),u instanceof Date?u=b.format(u,t.dateFormat):u=u==null?void 0:u.toString()),t.toCopyString&&(u=t.toCopyString({currentValue:u,column:l,record:o})),u=u==null?void 0:u.replace(/[\n\t]/," "),s+=u||t.emptyValueChar}return s}setFromStringData(e,r=!1,t=this.client.store,i){var n;const s=this,{client:a}=s,{columns:o,_shiftSelectRange:l}=a,c=new Set,d=s.stringAs2dArray(e),u=a.selectedCells[0],h=[],g=[];if(!r&&(l!=null&&l.some(f=>f.equals(u)))){const f=s.cellSelectorsAs2dArray(l);if((f==null?void 0:f.length)%d.length===0&&f.columnCount%d.columnCount===0)for(let m=0;m<f.length;m+=d.length)for(let p=0;p<f.columnCount;p+=d.columnCount)h.push(f[m][p])}h.length||h.push(u);for(const f of h)for(let m=0;m<d.length;m++){const p=d[m],v=r?new t.modelClass:t.getAt(f.rowIndex+m);if(v&&!v.readOnly){for(let y=0;y<p.length;y++){const C=i?null:o.visibleColumns[r?y:f.columnIndex+y],D=(C==null?void 0:C.field)||(i==null?void 0:i[y]);let S=p[y];if(D&&S&&!(C!=null&&C.readOnly)){if(S===s.emptyValueChar&&(S=null),C!=null&&C.fromClipboardString&&(S=C.fromClipboardString({string:S,record:v})),s.toPasteValue&&(S=s.toPasteValue({currentValue:S,record:v,column:C,field:D})),typeof S=="string"&&((n=v.getFieldDefinition(D))!=null&&n.isDateDataField)){const x=b.parse(S,s.dateFormat);isNaN(x.getTime())||(S=x)}v.set(D,S,!1,!1,!1,!0),g.push(a.normalizeCellContext({column:C,record:v}))}}c.add(v)}}return{modifiedRecords:[...c],targetCells:g}}cellSelectorsAs2dArray(e){const r=[];let t=null,i;for(const n of e)n.id!==t&&(t=n.id,i=[],r.push(i)),i.push(n);return r.columnCount=r[0].length,r.some(n=>n.length!==r.columnCount)?!1:r}stringAs2dArray(e){const r=[],t=e.split(/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/).filter(i=>i.length);for(const i of t){const n=i.split("	");if(r.columnCount&&n.length!==r.columnCount)return!1;r.columnCount=n.length,r.push(n)}return r}};E(ba,"configurable",{copyOnly:null,keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},useNativeClipboard:!1,toCopyString:null,toPasteValue:null,emptyValueChar:" ",dateFormat:"lll"}),ba._$name="CopyPasteBase";var Fl=new Map,Ca=new Map,yu="Grid",bu={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},Mk=/\$\d+$/,j=class{static registerFeature(e,r=!1,t=null,i=null){i=O.uncapitalize(i||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name),i=i.replace(Mk,""),Array.isArray(t)||(t=[t||yu]),t.forEach(n=>{const s=bu[n]||n,a=Fl.get(s)||new Map,o=Ca.get(s)||new Map;a.set(i,e),o.set(e,r),Fl.set(s,a),Ca.set(s,o)})}static getTypeNameFeatures(e=yu){const r=bu[e]||e,t=Fl.get(r),i={};return t&&t.forEach((n,s)=>i[s]=n),i}static getTypeNameDefaultFeatures(e=yu){const r=bu[e]||e,t=Fl.get(r),i=Ca.get(r),n={};return t&&i&&t.forEach((s,a)=>{i.get(s)&&(n[a]=s)}),n}static getInstanceFeatures(e){return e.$meta.names.reduce((r,t)=>Object.assign(r,this.getTypeNameFeatures(t)),{})}static getInstanceDefaultFeatures(e){return e.$meta.names.reduce((r,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce((i,[n,s])=>(this.isDefaultFeatureForTypeName(s,t)?i[n]=s:delete i[n],i),r),{})}static isDefaultFeatureForTypeName(e,r=yu){const t=bu[r]||r,i=Ca.get(t);return i&&i.get(e)||!1}static isDefaultFeatureForInstance(e,r){const t=r.$meta.names.slice().reverse();let i=null;for(let n=0,s=t.length;n<s&&i===null;++n){const a=Ca.get(t[n]);a&&a.has(e)&&(i=a.get(e))}return i||!1}static reset(){Fl.clear(),Ca.clear()}},Sa=class extends ba{constructor(){super(...arguments),E(this,"entityName","cell")}afterConstruct(){super.afterConstruct(),this.afterSelectionModeChange()}afterSelectionModeChange(){const e=this;e.client.selectionMode.cell?e._disabledBySelectionMode&&(e.disabled=!1,delete e._disabledBySelectionMode):e.disabled=!0}set copyOnly(e){this._copyOnly=e}get copyOnly(){var e;return this._copyOnly==null?!((e=this.client.features.cellEdit)!=null&&e.enabled):!!this._copyOnly}get canCopy(){var e;const{client:r}=this;return!!(!this.disabled&&r.selectedCells.length&&(!r._selectedRows.length||(e=r.features.rowCopyPaste)!=null&&e.disabled||r.focusedCell&&r.isCellSelected(r.focusedCell)))}get canCutPaste(){var e;return this.canCopy&&!this.copyOnly&&!((e=this.client.features.cellEdit)!=null&&e.isEditing)&&!this.client.readOnly}isActionAvailable({actionName:e}){return this.canCopy&&(e==="copy"||this.canCutPaste)}async cut(){await this.copy(!0)}async copy(e=!1){typeof e!="boolean"&&(e=!1);const r=this,{selectedCells:t}=r.client,i=e?t.filter(n=>{var s;return!((s=n.record)!=null&&s.readOnly)}):t;if(i){if(e?!r.canCutPaste:!r.canCopy)return;const n=r.cellsToString(i);if(await r.writeToClipboard(n,e,{cells:i}),e===!0)for(const s of i)s.column.readOnly||s.record.set(s.column.field,null);r.client.trigger("copy",{cells:i,copiedDataString:n,isCut:e,entityName:r.entityName})}}async beforeCopy({data:e,isCut:r,cells:t}){return await this.client.trigger("beforeCopy",{cells:t,data:e,isCut:r,entityName:this.entityName})}async paste(){const e=this,{client:r,entityName:t}=e,i=r.selectedCells[0];if(!e.canCutPaste||!i)return;const n=await e.readFromClipboard({},!0);if(!n)return;const{modifiedRecords:s,targetCells:a}=e.setFromStringData(n);r.selectedCells.length===1&&a.length>1&&r.selectCellRange(a[0],a[a.length-1]),r.trigger("paste",{clipboardData:n,targetCell:i,modifiedRecords:[...s],entityName:t})}async beforePaste({data:e}){return await this.client.trigger("beforePaste",{clipboardData:e,targetCell:this.client.selectedCell,entityName:this.entityName})}populateCellMenu({record:e,items:r}){const t=this;t.canCopy&&(r.cutCell={text:t.cutText,localeClass:t,icon:"b-icon b-icon-cut",weight:115,disabled:e.readOnly||!t.canCutPaste,onItem:()=>t.cut()},r.pasteCell={text:t.pasteText,localeClass:t,icon:"b-icon b-icon-paste",weight:120,disabled:e.readOnly||!t.canCutPaste||t.hasClipboardData()===!1,onItem:()=>t.paste()},r.copyCell={text:t.copyText,localeClass:t,cls:"b-separator",icon:"b-icon b-icon-copy",weight:110,onItem:()=>t.copy()})}};E(Sa,"$name","CellCopyPaste"),E(Sa,"pluginConfig",{chain:["populateCellMenu","afterSelectionModeChange"]}),E(Sa,"configurable",{useNativeClipboard:!ne.isTestEnv,copyText:"L{copy}",cutText:"L{cut}",pasteText:"L{paste}"}),Sa._$name="CellCopyPaste",j.registerFeature(Sa);var Ik={finishAndEditNextRow:1,finishAndEditPrevRow:1,finishEditing:1,cancelEditing:1,finishAndEditNextCell:1,finishAndEditPrevCell:1},Ol=class extends fe(Q){static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",continueEditingOnCellClick:!0,addNewAtEnd:null,addToCurrentParent:!1,autoEdit:null,editNextOnEnterPress:!0,editorClass:hr,triggerEvent:"celldblclick",touchEditDelay:300,focusCellAnimationDuration:!1,multiEdit:!0,keyMap:{Enter:["startEditingFromKeyMap","finishAndEditNextRow"],"Ctrl+Enter":["finishAllSelected","finishEditing"],"Shift+Enter":"finishAndEditPrevRow","Alt+Enter":"finishEditing",F2:["startEditingFromKeyMap","finishEditing"],Escape:"cancelEditing",Tab:{handler:"finishAndEditNextCell",weight:100},"Shift+Tab":{handler:"finishAndEditPrevCell",weight:100}},ignoreCSSSelector:"button,.b-icon,.b-fa,svg"}}static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(e,r){super.construct(e,r);const t=this,i={renderRows:"onGridRefreshed",cellClick:"onCellClick",thisObj:t};t.grid=e,t.triggerEvent!=="cellclick"&&(i[t.triggerEvent]="onTriggerEditEvent"),t.autoEdit&&!("editNextOnEnterPress"in r)&&(t.editNextOnEnterPress=!1),e.ion(i),e.rowManager.ion({changeTotalHeight:"onGridRefreshed",thisObj:t}),t.bindStore(e.store)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",beforeSort:"onStoreBeforeSort",thisObj:this})}async confirm(e){let r=!0;return this.editorContext&&(Bi.owner=this.editorContext.editor.inputField,e.rootElement=this.grid.rootElement,r=await Bi.confirm(e),Bi.owner=null),r===Bi.yesButton}doDestroy(){this.grid.columns.allRecords.forEach(e=>{var r;(r=e._cellEditor)==null||r.destroy()}),super.doDestroy()}doDisable(e){e&&!this.isConfiguring&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return!!(super.disabled||e.disabled||e.readOnly)}get isEditing(){return!!this.editorContext}get activeRecord(){var e;return((e=this.editorContext)==null?void 0:e.record)||null}getEditorForCell({id:e,cell:r,column:t,columnId:i,editor:n}){const s=this,{grid:a,editorClass:o}=s;let l=t.cellEditor,c=0;return t.editTargetSelector&&(c=r.querySelector(t.editTargetSelector).offsetLeft),n.autoSelect=s.autoSelect,l!=null&&l.isEditor||(l=t.data.cellEditor=o.create(o.mergeConfigs({type:o.type,constrainTo:null,cls:"b-cell-editor",inputField:n,blurAction:"none",invalidAction:t.invalidAction,completeKey:!1,cancelKey:!1,owner:a,align:{align:"t0-t0",offset:[c,0]},internalListeners:s.getEditorListeners(),onInternalKeyDown:s.onEditorKeydown.bind(s),allowMouseEvents:n.allowMouseEvents},l))),l.minHeight=a.rowHeight,l.inputField!==n&&(l.remove(l.items[0]),l.add(n)),l.align.offset[0]=c,t.instantUpdate&&!n.cellEditValueSetter&&(T.wrapProperty(n,"value",null,d=>{const{editorContext:u}=s,h=u==null?void 0:u.editor.inputField;u!=null&&u.editor.isValid&&!T.isEqual(u.record.getValue(u.column.field),d)&&(!(h!=null&&h.isDateField)||h._isPickerInput)&&u.record.setValue(u.column.field,d)}),n.cellEditValueSetter=!0),Object.assign(l.element.dataset,{rowId:e,columnId:i,field:t.field}),l.inputField.revertOnEscape=t.revertOnEscape,s.editor=l}getEditorListeners(){return{focusOut:"onEditorFocusOut",focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",finishEdit:"onEditorFinishEdit",thisObj:this}}onEditorStart({source:e}){var r;const t=this,i=t.editorContext=e.cellEditorContext;if(i){const{grid:n}=t;t.triggerEvent!=="cellclick"&&(t.detachListeners("cellClickWhileEditing"),n.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:t})),(r=t.removeEditingListeners)==null||r.call(t),t.removeEditingListeners=be.addListener({globaltap:"onTapOut",thisObj:t}),n.trigger("startCellEdit",{grid:n,editorContext:i})}}onEditorBeforeComplete(e){const{grid:r}=this,t=e.source,i=t.cellEditorContext;return e.grid=r,e.editorContext=i,r.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:r}=this,t=e.cellEditorContext;t.value=e.inputField.value,r.trigger("finishCellEdit",{grid:r,editorContext:t})}onEditorBeforeCancel(){const{editorContext:e}=this;return this.grid.trigger("beforeCancelCellEdit",{editorContext:e})}onEditorCancel({event:e}){const{editorContext:r,muteEvents:t,grid:i}=this;t||i.trigger("cancelCellEdit",{grid:i,editorContext:r,event:e})}onBeforeEditorHide({source:e}){const r=this,{row:t,cell:i}=e.cellEditorContext;i==null||i.classList.remove("b-editing"),t==null||t.removeCls("b-editing"),r.detachListeners("cellClickWhileEditing"),r.removeEditingListeners()}onEditorFinishEdit({source:e}){e.cellEditorContext=this.editorContext=null}getAdjacentEditableCell(e,r){const{grid:t}=this,{store:i,columns:n}=t,{visibleColumns:s}=n;let a=e.id,o=n.getAdjacentVisibleLeafColumn(e.columnId,r);for(;a;)if(o){if(o.editor&&o.canEdit(i.getById(a)))return{id:a,columnId:o.id};o=n.getAdjacentVisibleLeafColumn(o,r)}else{const l=i.getAdjacent(e.id,r,!1,!0);a=l==null?void 0:l.id,l&&(o=r?s[0]:s[s.length-1])}return null}doAddNewAtEnd(){const e=typeof this.addNewAtEnd=="object"?T.clone(this.addNewAtEnd):{},{grid:{store:r,rowManager:t},addToCurrentParent:i}=this;let n;return r.tree&&i?n=r.last.parent.appendChild(e):n=r.add(e)[0],t.getRowFor(n)||t.displayRecordAtBottom(),n}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{column:r,record:t}=e;if(r!=null&&r.isVisible&&r.editor&&!r.readOnly&&t&&!t.isSpecialRow&&!t.readOnly&&r.canEdit(t)){const i=t&&r.getRawValue(t);return Object.assign(e,{value:i===void 0?null:i,editor:r.editor}),e}else return!1}startEditingFromKeyMap(){return this.startEditing(this.grid.focusedCell)}async startEditing(e={}){var r,t,i;const n=this;if(!n.disabled){const{grid:s}=n;if(e!=null&&e.fromKeyMap&&(e=n.grid.focusedCell),T.isEmpty(e)&&(e.id=s.firstVisibleRow.id),s.store.isTree&&s.features.tree){const u=e.id?s.store.getById(e.id):(r=e.record)!=null?r:s.store.getAt(e.row);if(u)await s.expandTo(u);else return!1}const a=n.getEditingContext(e);if(!a||(n.editorContext&&n.cancelEditing(),(t=s.focusedCell)!=null&&t.equals(a)||s.focusCell(a),s.trigger("beforeCellEditStart",{grid:s,editorContext:a})===!1))return!1;const o=a.editor=n.getEditorForCell(a),{row:l,cell:c,record:d}=a;return o.inputField.highlightExternalChange=!1,o.cellEditorContext=a,o.render(c),c.classList.add("b-editing"),l.addCls("b-editing"),await o.startEdit({target:c,field:o.inputField.name||a.column.field,value:a.value,record:d})||(c.classList.remove("b-editing"),l.removeCls("b-editing")),(i=n.onCellEditStart)==null||i.call(n),!0}return!1}cancelEditing(e=!1,r){var t;const i=this,{editor:n}=i;i.isEditing&&(e.fromKeyMap&&(r=e,e=!1),i.muteEvents=e,n.cancelEdit(r),i.muteEvents=!1,i.finishEditingPromise=!1,(t=i.afterCellEdit)==null||t.call(i))}async finishEditing(){var e;const r=this,{editorContext:t,grid:i}=r;let n=!1;if(r.finishEditingPromise)return r.finishEditingPromise;if(t){const{column:s}=t;r.finishEditingPromise=t.editor.completeEdit(s.bindCallback(s.finalizeCellEdit)),n=await r.finishEditingPromise,await i.waitForAnimations(),r.finishEditingPromise=null,n&&((e=r.afterCellEdit)==null||e.call(r))}return n}async onCellClickWhileEditing({event:e,cellSelector:r}){const t=this;if(!e.target.closest(".b-editor")){if(w.isTouchEvent||e.target.matches(t.ignoreCSSSelector)){await t.finishEditing();return}t.finishEditingPromise||t.editorContext&&!t.editorContext.editor.owns(e.target)&&(t.getEditingContext(r)?await t.finishEditing()?t.continueEditingOnCellClick&&await t.startEditing(r):(t.grid.focusCell(t.editorContext),t.editor.inputField.focus()):await t.finishEditing())}}async onCellClick({cellSelector:e,target:r,event:t,column:i}){if(i.onCellClick)return;const n=this,{focusedCell:s}=n.client;if(r.closest(".b-tree-expander"))return!1;w.isTouchEvent&&n._lastCellClicked===(s==null?void 0:s.cell)&&t.timeStamp-n.touchEditDelay>n._lastCellClickedTime?await n.startEditing(e):this.triggerEvent==="cellclick"&&await n.onTriggerEditEvent({cellSelector:e,target:r}),n._lastCellClicked=s==null?void 0:s.cell,n._lastCellClickedTime=t.timeStamp}onElementPointerUp(e){e.target.closest(".b-tree-expander")&&this.cancelEditing(void 0,e)}async onTriggerEditEvent({cellSelector:e,target:r,event:t}){var i;const{editorContext:n,client:s}=this;r.closest(".b-tree-expander")||w.isTouchEvent&&t.type==="dblclick"||t&&((i=s.features.cellMenu)==null?void 0:i.triggerEvent)===t.type||n&&(n.equals(this.grid.normalizeCellContext(e))||!await this.finishEditing())||await this.startEditing(e)}onStoreUpdate({changes:e,record:r}){const{editorContext:t}=this;t!=null&&t.editor.isVisible&&r===t.record&&t.editor.dataField in e&&t.editor.refreshEdit()}onStoreBeforeSort(){var e;const r=(e=this.editorContext)==null?void 0:e.editor;this.isEditing&&!(r!=null&&r.isFinishing)&&!r.isValid&&this.cancelEditing()}onGridRefreshed(){const e=this,{grid:r,editorContext:t}=e;if(t&&r.isVisible&&r.focusedCell){const i=r.getCell(r.focusedCell),{editor:n}=t;i&&w.isInView(i)&&!n.isFinishing?(t._cell=i,be.suspendFocusEvents(),n.render(i),n.showBy(i),n.focus(),be.resumeFocusEvents()):e.cancelEditing()}}get gridSelection(){return[...this.grid.selectedRows,...this.grid.selectedCells]}isActionAvailable({actionName:e,event:r}){const t=this;if(!t.disabled&&!r.target.closest(".b-grid-header")){if(t.isEditing){if(e==="finishAllSelected")return t.multiEdit&&t.gridSelection.length>1;if(Ik[e])return!0}else if(e==="startEditingFromKeyMap")return t.grid.focusedCell.cell===r.target}return!1}async finishAllSelected(){const e=this,{dataField:r,record:t}=e.editor;if(await e.finishEditing()&&!e.isDestroyed){const i=t.getValue(r);for(const n of e.gridSelection)n.isModel?n!==t&&n.setValue(r,i):n.record.set(n.column.field,i)}}async finishAndEditNextRow(e,r=!1){const t=this,{grid:i}=t,{record:n}=t.editorContext;let s;if(await t.finishEditing()){if(t.isDestroyed)return;t.isEditing||(r?s=i.internalNextPrevRow(!1,!0,!1):(t.addNewAtEnd&&n===i.store.last&&await t.doAddNewAtEnd(),t.isDestroyed||(s=i.internalNextPrevRow(!0,!0))),s&&t.editNextOnEnterPress&&!i.touch&&await t.startEditing(s))}}finishAndEditPrevRow(e){return this.finishAndEditNextRow(e,!0)}async finishAndEditNextCell(e,r=!1){var t,i;const n=this,{grid:s}=n,{focusedCell:a}=s;if(a){let o=n.getAdjacentEditableCell(a,!r);!o&&!r&&n.addNewAtEnd&&await n.finishEditing()===!0&&(await this.doAddNewAtEnd(),o=!n.isDestroyed&&n.getAdjacentEditableCell(a,!r));let l=!0;n.isEditing&&(l=await n.finishEditing()),o?!n.isDestroyed&&l&&(s.focusCell(o,{animate:n.focusCellAnimationDuration}),await n.startEditing(o)||await n.finishAndEditNextCell(e,r)):s.isNested&&s.owner&&!((i=(t=s.owner).catchFocus)!=null&&i.call(t,{source:s,navigationDirection:r?"up":"down",editing:!0}))&&s.onTab(e)}}finishAndEditPrevCell(e){return this.finishAndEditNextCell(e,!0)}async onElementKeyDown(e){const r=this,{grid:t}=r,{focusedCell:i}=t;if(e.handled||!r.autoEdit||r.isEditing||!i||i.isActionable||e.ctrlKey)return;const{key:n}=e,s=e.key==="Delete"||e.key==="Backspace",{gridSelection:a}=s?r:{},o=r.multiEdit&&(a==null?void 0:a.length)>1;if((n.length<=1||s&&!o)&&await r.startEditing(i)){const{inputField:l}=r.editor,{input:c}=l;c&&(l.internalOnKeyEvent(e),e.defaultPrevented||(c.value=s?"":n,l.internalOnInput(e))),e.preventDefault()}else if(o&&t.trigger("beforeCellRangeDelete",{grid:t,gridSelection:a})!==!1)for(const l of a)l.isModel?t.columns.visibleColumns.forEach(c=>{!c.readOnly&&l.set(c.field,null)}):l.column.readOnly||l.record.set(l.column.field,null)}onEditorKeydown(e){if(e.key.length!==1&&this.grid.matchKeyMapEntry(e)&&!this.grid.matchKeyMapEntry(e,this.keyMap))return!e.key.startsWith("Arrow")&&!e.key==="Backspace"&&e.preventDefault(),e.handled=!0,e.stopPropagation(),!1}async onEditorFocusOut(e){const r=this,{grid:t,editor:i,editorContext:n}=r,s=new oe(e.relatedTarget),a=s.grid===t&&r.getEditingContext(s);n&&!i.isFinishing&&i.owns(e._target)&&(r.blurAction==="cancel"?r.cancelEditing(void 0,e):!r.finishEditingPromise&&(r.triggerEvent==="cellclick"||r.triggerEvent!=="cellclick"&&!a)&&await r.finishEditing())}onEditorFocusIn(e){const r=e.toWidget;r===this.editor.inputField&&this.autoSelect&&r.selectAll&&!r.readOnly&&!r.disabled&&r.selectAll()}async onTapOut({event:e}){const r=this,{target:t}=e;!t._shadowRoot&&!r.editor.owns(t)&&(!r.grid.bodyContainer.contains(t)||e.button)&&(r.editingStoppedByTapOutside=!0,r.blurAction==="cancel"?r.cancelEditing(void 0,e):await r.finishEditing(),delete r.editingStoppedByTapOutside)}async onElementClick(e){e.target.classList.contains("b-grid-body-container")&&this.editorContext&&await this.finishEditing()}};E(Ol,"$name","CellEdit"),Ol._$name="CellEdit",j.registerFeature(Ol,!0);var Ll=class extends aa{static get $name(){return"CellMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateCellMenu"),e}showContextMenu(e){const r=this,{cellSelector:t,event:i}=e;r.client.focusCell(t,{doSelect:!r.client.isSelected(t),event:i}),super.showContextMenu(e)}shouldShowMenu({column:e}){return e&&e.enableCellContextMenu!==!1}getDataFromEvent(e){const r=this.client.getCellDataFromEvent(e);if(r)return T.assign(super.getDataFromEvent(e),r)}beforeContextMenuShow({record:e,items:r,column:t}){if(t.cellMenuItems===!1)return!1;(!e||e.isSpecialRow)&&(r.removeRow=!1)}populateCellMenu({items:e,column:r,record:t}){const{client:i}=this;r!=null&&r.cellMenuItems&&T.merge(e,r.cellMenuItems),i.readOnly||(e.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:t.readOnly,onItem:()=>i.store.remove(i.selectedRecords.filter(n=>!n.readOnly))})}get showMenu(){return!0}};Ll.featureClass="",Ll._$name="CellMenu",j.registerFeature(Ll,!0,["Grid","Scheduler"]),j.registerFeature(Ll,!1,["Gantt"]);var $l=class extends Q{construct(e,r){super.construct(e,this.processConfig(r))}initTip(){const e=this;e.tip=ve.new({forElement:e.client.element,forSelector:".b-grid-row:not(.b-group-row) .b-grid-cell, .b-grid-merged-cells",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:e.getTooltipContent.bind(e),internalListeners:{pointerOver:"onPointerOver",thisObj:e},listeners:e.configuredListeners},e.initialConfig),e.relayEvents(e.tip,["beforeShow","show"])}onPointerOver({target:e}){const r=this.client.getColumnFromElement(e);return r.tooltipRenderer!==!1&&!!(r.tooltipRenderer||this.tooltipRenderer)}processConfig(e){return typeof e=="function"?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.tip&&this.tip.destroy(),super.doDestroy()}doDisable(e){e?this.tip&&(this.tip.destroy(),this.tip=null):this.initTip(),super.doDisable(e)}getTooltipContent({tip:e,activeTarget:r,event:t}){const i=this,n=i.client.getRecordFromElement(r),s=i.client.getColumnFromElement(r),a={cellElement:r,record:n,column:s,event:t,tip:e,cellTooltip:i};let o;return!i.forSelector&&n===i.lastRecord&&n.generation===i.lastRecordGeneration&&s===i.lastColumn?i.tip._html:(i.lastRecord=n,i.lastRecordGeneration=n.generation,i.lastColumn=s,s.tooltipRenderer?o=s.tooltipRenderer(a):i.tooltipRenderer&&s.tooltipRenderer!==!1&&(o=i.tooltipRenderer(a)),N.isPromise(o)&&(i.lastRecord=i.lastRecordGeneration=i.lastColumn=null),o||e.hide(),o)}};E($l,"$name","CellTooltip"),E($l,"configurable",{tooltipRenderer:null}),$l._$name="CellTooltip",j.registerFeature($l);var VE="store",Da=class extends fe(Q){static get pluginConfig(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns",onInternalResize:"onInternalResize"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}construct(e){super.construct(e);const{store:r}=this.client;r&&this.bindStore(r)}doDestroy(){this.unbindStore(),super.doDestroy()}bindStore(e){this.lastSync=null,e.ion({name:VE,[`change${this.client.asyncEventSuffix}`]:"onStoreChange",thisObj:this})}unbindStore(){this.detachListeners(VE)}get columnAutoWidthPending(){return this.lastSync===null||this.hasTimeout("syncAutoWidthColumns")}onStoreChange({action:e}){if(e!=="move"){const r=this,{cellEdit:t}=r.client.features;++r.storeGeneration,t!=null&&t.isEditing&&!t.editingStoppedByTapOutside?r.syncAutoWidthColumns():r.hasTimeout("syncAutoWidthColumns")||r.setTimeout("syncAutoWidthColumns",r.delay)}}onInternalResize(e,r,t,i){i===0&&(this.lastSync=null,this.syncAutoWidthColumns())}syncAutoWidthColumns(){const e=this,{client:r,storeGeneration:t}=e;if(!r.splitFrom){if(e.lastSync!==t){e.lastSync=t;let i,n;for(const s of r.columns.visibleColumns)i=s.autoWidth,i&&(i===!0&&(i=e.default),r.resizingColumns=n=!0,s.resizeToFitContent(i));n&&(r.resizingColumns=!1,r.afterColumnsResized())}e.hasTimeout("syncAutoWidthColumns")&&e.clearTimeout("syncAutoWidthColumns")}}};E(Da,"$name","ColumnAutoWidth"),E(Da,"configurable",{default:null,delay:0}),Da.prototype.storeGeneration=0,Da._$name="ColumnAutoWidth",j.registerFeature(Da,!0);var Cu=class extends fe(Q){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(e,r){e.features.columnReorder&&e.features.columnReorder.ion({beforeDestroy:"onColumnReorderBeforeDestroy",thisObj:this}),this.grid=e,super.construct(e,r)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,r=e.grid;r.features.columnReorder&&(e.reorderDetacher=r.features.columnReorder.ion({gridheaderdragstart({context:t}){const i=r.columns.getById(t.element.dataset.columnId);e.showToolbar(i)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridHeaderDrop:e.onDrop,thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const r=this,t=r.grid.getColumnDragToolbarItems(e,[]),i=[];r.clearTimeout(r.buttonHideTimer),t.forEach(n=>{n.text=n.localeClass.L(n.text);let s=i.find(a=>a.text===n.group);s||(s={text:n.localeClass.L(n.group),buttons:[]},i.push(s)),s.buttons.push(n)}),r.element=w.append(r.grid.element,r.template(i)),r.groups=i,r.buttons=t,r.column=e}async hideToolbar(){const e=this,r=e.element;r&&(r.classList.add("b-remove"),await B.waitForTransitionEnd({element:r,mode:"animation",thisObj:e.client}),r.remove(),e.element=null)}onDrag(e){var r;const t=this;if(e.dragProxy.getBoundingClientRect().top-t.grid.element.getBoundingClientRect().top>100?t.element.classList.add("b-closer"):t.element.classList.remove("b-closer"),t.hoveringButton&&(t.hoveringButton.classList.remove("b-hover"),t.hoveringButton=null),(r=e.targetElement)!=null&&r.closest(".b-columndragtoolbar")){t.element.classList.add("b-hover");const i=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");i&&(i.classList.add("b-hover"),t.hoveringButton=i)}else t.element.classList.remove("b-hover")}onDrop({context:e}){const r=this,{targetElement:t}=e;if(t&&t.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const i=r.buttons.find(n=>n.ref===t.dataset.ref);i&&(t.classList.add("b-activate"),r.buttonHideTimer=r.setTimeout(()=>{r.hideToolbar(),i.onDrop({column:r.column})},100))}else r.hideToolbar()}template(e){return tr.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${e.map(r=>tr.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${r.buttons.map(t=>tr.tpl`
                        <div class="b-target-button" data-ref="${t.ref}" data-disabled="${t.disabled}">
                            <i class="${t.icon}"></i>
                            ${t.text}
                        </div>
                    `)}
                    </div>
                    <div class="b-title">${r.text}</div>
                </div>
            `)}
            </div>`}};Cu.featureClass="b-hascolumndragtoolbar",Cu._$name="ColumnDragToolbar",j.registerFeature(Cu,q.isTouchDevice);var jl=class extends Q{static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}get grid(){return this.client}getColumnPickerItems(e){const r=this,{createColumnsFromModel:t}=r;let i;if(r.groupByRegion)i=r.grid.regions.map(n=>{const s=r.grid.getSubGrid(n).columns.topColumns;return{text:O.capitalize(n),menu:r.buildColumnMenu(s),disabled:s.length===0,region:n}}),t&&i.push({text:r.L("L{newColumns}"),menu:r.createAutoColumnItems()});else if(r.groupByTag){const n={};e.topColumns.forEach(s=>{s.tags&&Array.isArray(s.tags)&&s.hideable!==!1&&s.tags.forEach(a=>{n[a]||(n[a]=1)})}),i=Object.keys(n).sort().map(s=>({text:O.capitalize(s),menu:r.buildColumnMenu(r.getColumnsForTag(s)),tag:s,onBeforeSubMenu:({item:a,itemEl:o})=>{r.refreshTagMenu(a,o)}})),t&&i.push({text:r.L("L{newColumns}"),menu:r.createAutoColumnItems()})}else i=r.buildColumnMenu(e.topColumns),t&&i.items.push(...T.transformNamedObjectToArray(r.createAutoColumnItems()));return i}createAutoColumnItems(){const e=this,{grid:r}=e,{columns:t,store:i}=r,{modelClass:n}=i,{allFields:s}=n,a={};for(let o=0,{length:l}=s;o<l;o++){const c=s[o],d=c.name;t.get(d)||c.internal||(a[d]={text:c.text||O.separate(c.name),checked:!1,onToggle:u=>{const h=t.get(d);h?h[u.checked?"show":"hide"]():t.add(t.generateColumnForField(c,{region:e.forColumn.region})),u.bubbles=!1}})}return a}getColumnsForTag(e){return this.grid.columns.records.filter(r=>r.tags&&Array.isArray(r.tags)&&r.tags.includes(e)&&r.hideable!==!1)}refreshTagMenu(e,r){this.getColumnsForTag(e.tag).forEach(i=>{const n=e.items.find(s=>s.column===i);n&&(n.checked=i.hidden!==!0)})}buildColumnMenu(e){let r=e.length>0&&e[0].region;const{grid:t}=this,i=e.reduce((n,s)=>{const a=t.columns.visibleColumns.filter(o=>o.region===s.region);if(s.hideable!==!1){const o={grid:t,column:s,text:s.headerText,checked:s.hidden!==!0,disabled:s.hidden!==!0&&a.length===1,cls:s.region!==r?"b-separator":""};r=s.region,s.children&&!s.isCollapsible&&(o.menu=this.buildColumnMenu(s.children)),n.push(o)}return n},[]);return{cls:this.menuCls,items:i}}populateHeaderMenu({column:e,items:r}){const t=this,{columns:i}=t.grid;t.forColumn=e,e.showColumnPicker!==!1&&i.some(n=>n.hideable)&&(r.columnPicker={text:"L{columnsMenu}",localeClass:t,icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:t.getColumnPickerItems(i),onToggle:t.onColumnToggle,disabled:t.disabled}),e.hideable!==!1&&!e.parent.isCollapsible&&(r.hideColumn={text:"L{hideColumn}",localeClass:t,icon:"b-fw-icon b-icon-hide-column",weight:210,disabled:!e.allowDrag||t.disabled,onItem:()=>e.hide()})}onColumnToggle({menu:e,item:r,checked:t}){var i,n;if(!!r.column.hidden!=!t){r.column[t?"show":"hide"]();const{grid:s,column:a}=r,{columns:o,features:l}=s,c=e.items,d=o.visibleColumns.filter(g=>g.region===r.column.region),u=((i=l.headerMenu)==null?void 0:i.enabled)&&l.headerMenu.menu.widgetMap.hideColumn;if(d.length===1){const g=c.find(f=>f.column===d[0]);g&&(g.disabled=!0),u&&a.region===r.column.region&&(u.disabled=!0)}else d.forEach(g=>{const f=c.find(m=>m.column===g);f&&(f.disabled=!1)}),u&&a.region===r.column.region&&(u.disabled=!1);(n=r.menu)==null||n.eachWidget(g=>{g.checked=t});const h=e.owner;h&&h.column===a.parent&&(h.checked=c.some(g=>g.checked===!0))}}getColumnDragToolbarItems(e,r){const t=this.grid.columns.visibleColumns.filter(i=>i.region===e.region);return e.hideable!==!1&&t.length>1&&r.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,onDrop:({column:i})=>i.hide()}),r}};E(jl,"$name","ColumnPicker"),E(jl,"configurable",{groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"}),jl._$name="ColumnPicker",j.registerFeature(jl,!0);var Bl=class extends Q{doDestroy(){var e;(e=this.editor)==null||e.destroy(),super.doDestroy()}static get pluginConfig(){return{after:["populateHeaderMenu"]}}populateHeaderMenu({items:e,column:r}){e.rename={weight:215,icon:"b-fw-icon b-icon-edit",text:this.L("L{rename}"),disabled:r.readOnly,onItem:()=>this.startEdit(r)}}startEdit(e){var r;if(e instanceof Event&&(e=(r=this.client.getHeaderDataFromEvent(e))==null?void 0:r.column),e){if(e.readOnly)return!1;const{textWrapper:t}=e;let{editor:i}=this;i||(this.editor=i=new hr({owner:this.client,align:{align:"t0-t0"}})),i.render(t),i.startEdit({target:t,record:e,field:"text"})}}};E(Bl,"$name","ColumnRename"),E(Bl,"configurable",{keyMap:{F2:"startEdit"}}),Bl._$name="ColumnRename",j.registerFeature(Bl,!1);var wa=class extends fe(Q){constructor(){super(...arguments),E(this,"ignoreSelectors",[".b-grid-header-resize-handle",".b-field"])}init(){const e=this,{grid:r}=e,t=r.element,i=w.children(t,".b-grid-headers");i.push(...w.children(t,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=i:r.whenVisible(()=>e.createDragHelper())}createDragHelper(){const e=this,{grid:r}=e,t=r.element,i=w.children(t,".b-grid-headers");return i.push(...w.children(t,".b-grid-header-children")),e.dragHelper=new ki({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:r,rtlSource:r,outerElement:r.headerContainer,dropTargetSelector:".b-grid-headers, .b-groupbar, .b-columndragtoolbar",externalDropTargetSelector:".b-groupbar, .b-columndragtoolbar",monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:cu.new({direction:"horizontal",element:r.headerContainer}),containers:i,isElementDraggable(n){if(!!n.closest(e.ignoreSelectors.join(","))||e.disabled)return!1;const a=n.closest(this.targetSelector),o=a&&r.columns.getById(a.dataset.columnId),l=(o==null?void 0:o.childLevel)===0&&r.subGrids[o.region].columns.count===1;return!!o&&o.draggable!==!1&&!l},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",internalListeners:{beforeDragStart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,abort:e.onAbort,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"),e.dragHelper}doDestroy(){var e,r;(e=this.dragHelper)==null||e.scrollManager.destroy(),(r=this.dragHelper)==null||r.destroy(),super.doDestroy()}get grid(){return this.client}onBeforeDragStart({context:e,event:r}){const t=this,{element:i}=e,n=e.column=t.client.columns.getById(i.dataset.columnId);return t.dragHelper.autoSizeClonedTarget=!t.usingGroupBarWidget,n.allowDrag&&t.client.trigger("beforeColumnDragStart",{column:n,event:r})}onDragStart({context:e,event:r}){const t=this,{grid:i,usingGroupBarWidget:n}=t,{column:s,dragProxy:a}=e;if(!i.features.columnDragToolbar&&!n){const o=i.element.querySelector(".b-grid-header-container").getBoundingClientRect();t.dragHelper.minY=o.top,t.dragHelper.maxY=o.bottom}i.element.classList.add("b-dragging-header"),n&&a.classList.add("b-grid-reordering-columns-with-groupbar"),i.features.filterBar&&i.features.filterBar.compactMode&&a.classList.add("b-filter-bar-compact"),a.style.fontSize=w.getStyleValue(e.element,"fontSize"),i.trigger("columnDragStart",{column:s,event:r})}onDrag({context:e,event:r}){const t=this,i=t.client,{column:n,insertBefore:s}=e,a=i.columns.getById(s==null?void 0:s.dataset.columnId),o=$.fromElement(r.target,"gridheader");o!=null&&o.subGrid.sealedColumns&&(e.valid=!1),i.trigger("columnDrag",{column:n,insertBefore:a,event:r,context:e})}onDrop({context:e,event:r}){var t;if(!e.valid)return this.onInvalidDrop({context:e,event:r});const i=this,{grid:n}=i,{column:s}=e,a=e.dragging,o=e.target.closest(".b-grid-header"),l=(t=e.draggedTo)==null?void 0:t.dataset.region,c=l||o;let d,u,h,g,f;if(n.element.classList.remove("b-dragging-header"),c){const m=o?n.columns.get(o.dataset.column):n.subGrids[l].columns.last,p=e.insertBefore;if(g=l||m.region,f=s.parent,h=p?n.columns.getById(p.dataset.columnId):n.subGrids[g].columns.last.nextSibling,h)u=h.parent;else{const v=o==null?void 0:o.parentElement.closest(".b-grid-header");v?u=n.columns.getById(v.dataset.columnId):u=n.columns.rootNode}d=g===s.region&&f===u&&(m===s.previousSibling||h===s.nextSibling),a.remove()}d=d||n.trigger("beforeColumnDropFinalize",{column:s,newParent:u,insertBefore:h,event:r,region:g})===!1,!d&&c&&(d=!u.insertChild(s,h)),e.valid=!d,!d&&c&&(s.region=g,f.children.length===0&&f.parent.removeChild(f)),n.trigger("columnDrop",{column:s,newParent:u,insertBefore:h,valid:e.valid,event:r,region:g})}onAbort({context:e,event:r}){this.onInvalidDrop({context:e,event:r})}onInvalidDrop({context:e,event:r}){const{grid:t}=this,{column:i}=e;t.trigger("columnDrop",{column:i,valid:!1,event:r}),t.element.classList.remove("b-dragging-header")}renderContents(){this.init()}onPaint(){this.init()}get isReordering(){var e;return!!((e=this.dragHelper)!=null&&e.isDragging)}};E(wa,"$name","ColumnReorder"),E(wa,"pluginConfig",{after:["onPaint","renderContents"]}),wa.featureClass="b-column-reorder",wa._$name="ColumnReorder",j.registerFeature(wa,!0);var lp=class extends Q{static get $name(){return"ColumnResize"}static get configurable(){return{liveResize:"auto"}}construct(e,r){const t=this;t.grid=e,super.construct(e,r),t.resizer=new Sl({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,rtlSource:e,internalListeners:{beforeresizestart:t.onBeforeResizeStart,resizestart:t.onResizeStart,resizing:t.onResizing,resize:t.onResize,cancel:t.onCancel,thisObj:t}})}doDestroy(){var e;(e=this.resizer)==null||e.destroy(),super.doDestroy()}changeLiveResize(e){return e==="auto"?!q.isMobileSafari:e}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:e}){const{grid:r,resizer:t}=this,i=e.column=r.columns.getById(e.element.dataset.columnId);t.minWidth=i.minWidth,r.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.resizingColumns=!0,e.column.width=e.newWidth)}onResize({context:e}){const{grid:r}=this,{column:t}=e;r.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(r.resizingColumns=!1,r.afterColumnsResized(t)):t.width=e.newWidth)}onCancel({context:e}){const{grid:r}=this;r.element.classList.remove("b-column-resizing"),e.column.width=e.elementWidth,r.resizingColumns=!1}};lp._$name="ColumnResize",j.registerFeature(lp,!0);var Ea=class extends Q.mixin(fe){constructor(){super(...arguments),E(this,"delayable",{handleSelection:"raf"})}afterConstruct(){super.afterConstruct(),this.client.selectionMode.cell||(this.disabled=!0),this._fillListeners={}}onContentChange(){this.handleSelection()}afterColumnsChange(){this.handleSelection()}fixElementHeights(){this.handleSelection()}getCellDataFromEvent(e,r){return r&&(r=!e.target.classList.contains("b-fill-handle")),this.overridden.getCellDataFromEvent(e,r)}findPatternsIn2dRange(e,r,t){const i={};for(const n of e){const s=r?n.id:n.columnId;let a=n.record.getValue(n.column.field);a&&typeof a=="string"&&!isNaN(a)&&(a=parseFloat(a)),i[s]||(i[s]=[]),i[s].push(a)}for(const n in i)i[n].pattern=this.findPatternsIn1dRange(i[n],t);return i}findPatternsIn1dRange(e,r){const t=e[r?0:e.length-1],i={next:()=>t,lastValue:t};if(e.every(n=>typeof n=="number")||e.every(n=>n instanceof Date)){const n=e.map((s,a)=>s-e[a-1]);n.shift(),new Set(n).size===1&&(i.increaseBy=n[0]*(r?-1:1),i.next=()=>(i.lastValue instanceof Date?i.lastValue=new Date(i.lastValue.getTime()+i.increaseBy):i.lastValue+=i.increaseBy,i.lastValue))}else e.length>1&&(i.stringPattern=[...e],i.next=()=>(i.currentIndex===void 0?i.currentIndex=0:(i.currentIndex+=1,i.currentIndex>=i.stringPattern.length&&(i.currentIndex=0)),i.stringPattern[i.currentIndex]));return i}afterSelectionChange(){const e=this;if(e.client.readOnly){e.removeElements();return}be.isMouseDown()?(e.client.delayUntilMouseUp(()=>e.handleSelection(!0)),e.removeElements()):e.handleSelection(!0)}handleSelection(){if(!this._isExtending){const e=this.rangeSelection;e?this.drawFillHandleAndBorder(e[0],e[e.length-1]):this.removeElements()}}onMouseDown(e){const{client:r}=this;r.readOnly||(this._fillListeners.mouseMoveOrUp=B.on({element:globalThis,mouseover:{handler:"onMouseOver",element:r.selectionDragMouseEventListenerElement},mouseup:"onMouseUp",thisObj:this}),e.preventDefault(),e.stopImmediatePropagation(),e.handled=!0)}onMouseUp(){var e,r;const t=this,{client:i,currentRange:n,_isCropping:s}=t,a=t.rangeSelection,o=a&&n&&i.internalSelectRange(n.from,n.to),l=(o==null?void 0:o.selectedCells)||[],c=s?t.croppingCells:l.filter(d=>!a.some(u=>u.equals(d,!0)));if(delete t._isCropping,t._isExtending&&(i.disableScrollingCloseToEdges(i.items),delete t._isExtending),!(c!=null&&c.length)){t.handleSelection();return}if(i.suspendRefresh(),s)c.forEach(d=>d.record.set(d.column.field,null,!1,!1,!1,!0));else{const[d]=c,u=a.some(m=>m.record===d.record),h=u?d.columnIndex<a[0].columnIndex:d.rowIndex<a[0].rowIndex,g=t.findPatternsIn2dRange(a,u,h),f=new Map;h&&c.reverse();for(const m of c){const{column:p,record:v}=m;if(!p.readOnly&&p.canFillValue({range:a,record:v,cell:m})){let y=(e=t.calculateFillValue)==null?void 0:e.call(t,{range:a,column:p,record:v,cell:m}),C=f.get(v);C||(C={},f.set(v,C)),y===void 0&&(y=g[u?m.id:m.columnId].pattern.next()),C[p.field]=((r=p.calculateFillValue)==null?void 0:r.call(p,{value:y,record:v,range:a}))||y}}for(const[m,p]of f)m.set(p,null,null,null,null,!0)}i.resumeRefresh(!0),i.performSelection(o),delete t.currentRange,t.handleSelection()}onMouseOver(e){var r;const t=this,{client:i,rangeSelection:n}=t,s=n[0],a=n[n.length-1],o=i.getCellDataFromEvent(e,!0);let l=o&&i.normalizeCellContext(o.cellSelector);if(((r=l==null?void 0:l._column)==null?void 0:r.region)===s._column.region){const c=n.some(g=>g.equals(l,!0));let d;t._isExtending||i.enableScrollingCloseToEdges(i.items),c?t._isCropping=t.allowCropping&&(l.rowIndex<a.rowIndex||l.columnIndex<a.columnIndex):l.rowIndex>=s.rowIndex&&l.rowIndex<=a.rowIndex?(d=s.columnIndex>l.columnIndex,l=new oe({grid:i,record:d?s.record:a.record,column:l.column})):(d=s.rowIndex>l.rowIndex,l=new oe({grid:i,record:l.record,column:d?s.column:a.column}));const u=d?l:s,h=d||c&&!t._isCropping?a:l;t.currentRange={from:u,to:h},t._isExtending=!0,t.drawFillHandleAndBorder(u,h,!0)}}drawFillHandleAndBorder(e,r,t=!1){var i;const n=this,{client:s,currentRange:a,_fillListeners:o}=n,l=s.subGrids[e.column.region].element,{x:c}=k.from(e.cell||e.column.element,l),{right:d}=k.from(r.cell||r.column.element,l),{y:u}=s.getRecordCoords(e.record,!0),h=s.getRecordCoords(r.record,!0).bottom-1;let{borderElement:g,handleElement:f}=n;if(n.removeElements(t),g||(n.borderElement=g=w.createElement({className:"b-fill-selection-border"}),n.handleElement=f=w.createElement({className:"b-fill-handle"})),w.setRect(g,{y:u,x:c,width:d-c,height:h-u}),l.appendChild(g),w.setTopLeft(f,h,d>=l.scrollWidth?c:d),l.appendChild(f),n.toggleCroppingCls(!1),delete n.croppingCells,n._isCropping&&((i=n.rangeSelection)!=null&&i.length)){const m=s.getRange(a.from,a.to);n.croppingCells=n.rangeSelection.filter(p=>!m.some(v=>v.equals(p,!0))),n.toggleCroppingCls()}o.handleClick||(o.handleClick=B.on({element:s.rootElement,delegate:".b-fill-handle",mousedown:"onMouseDown",thisObj:n})),n.hasFillElements=!0}toggleCroppingCls(e=!0){var r;(r=this.croppingCells)==null||r.forEach(t=>{var i;return(i=this.client.getCell(t))==null?void 0:i.classList.toggle("b-indicate-crop",e)})}removeElements(e=!1){var r,t;const i=this;(r=i.handleElement)==null||r.remove(),(t=i.borderElement)==null||t.remove(),e||i.removeListeners(),i.hasFillElements=!1}removeListeners(){const e=this;for(const r in e._fillListeners)e._fillListeners[r]();e._fillListeners={}}get rangeSelection(){var e;const{client:r}=this,{selectedCells:t}=r,i=(e=r._shiftSelectRange)!=null?e:t.length===1&&t;return!r._selectedRows.length&&(i!=null&&i.length)&&i.length===t.length&&i.every(n=>t.some(s=>n.equals(s,!0))&&n._column.parent&&n._column.region===i[0]._column.region&&r.store.isAvailable(n.id))?i:null}};E(Ea,"$name","FillHandle"),E(Ea,"configurable",{calculateFillValue:null,allowCropping:!1}),E(Ea,"pluginConfig",{chain:["afterSelectionChange","onContentChange","afterColumnsChange","fixElementHeights"],override:["getCellDataFromEvent"]}),Ea._$name="FillHandle",j.registerFeature(Ea);var cp=class extends $i{static get $name(){return"GridFieldFilterPicker"}static get type(){return"gridfieldfilterpicker"}afterConstruct(){var e;const r=this;if(!r.grid)throw new Error(`${r.constructor.$name} requires 'grid' to be configured.`);r.fields=(e=r.fields)!=null?e:{},super.afterConstruct()}updateGrid(e){var r;if(!((r=e.store)!=null&&r.modelClass))throw new Error("Grid does not have a store with a modelClass defined.");if(!e.columns)throw new Error("Grid does not have a column store.")}static getModelClassFields(e){const r=new Set(e.fields.map(({name:t})=>t));return(e==null?void 0:e.allFields.filter(t=>!t.internal&&(IE.includes(t.type)||Gm(t))&&(t.definedBy!==ce||r.has(t.name))))||[]}static getColumnFields(e,r,t){var i;const n=H.keyBy(cp.getModelClassFields(r),"name"),s=t&&new Set(t);return Object.fromEntries((i=e==null?void 0:e.records.filter(({field:a})=>a&&n[a]&&(!s||s.has(a))).map(({field:a,text:o})=>[a,{title:o||a,type:Gm(n[a])?"duration":n[a].type}]))!=null?i:[])}changeFields(e){var r;let t=e;return Array.isArray(e)&&(ne.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption[]> keyed by field name instead"),t=H.keyBy(t,"name")),T.merge({},cp.getColumnFields(this.grid.columns,(r=this.grid.store)==null?void 0:r.modelClass,this.allowedFieldNames),t)}},Su=cp;E(Su,"configurable",{grid:null,allowedFieldNames:null}),Su.initClass(),Su._$name="GridFieldFilterPicker";var Hl=class extends Gn{static get $name(){return"GridFieldFilterPickerGroup"}static get type(){return"gridfieldfilterpickergroup"}validateConfig(){if(!this.grid)throw new Error(`${this.constructor.$name} requires the 'grid' config property.`)}getFilterPickerConfig(e){const{grid:r,allowedFieldNames:t}=this;return{...super.getFilterPickerConfig(e),grid:r,allowedFieldNames:t}}updateGrid(e){this.store=this.grid.store}canManage(e){const r=this;return super.canManage(e)&&(!r.allowedFieldNames||r.allowedFieldNames.includes(e.property))}};E(Hl,"configurable",{grid:null,allowedFieldNames:null}),E(Hl,"childPickerType","gridfieldfilterpicker"),Hl.initClass(),Hl._$name="GridFieldFilterPickerGroup";var dp={date:"date",int:"number",integer:"number",number:"number",string:"text",duration:"duration"},up=class extends Q{static get $name(){return"Filter"}static get configurable(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},isMulti:!1}}construct(e,r){if(e.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const t=this;if(t.grid=e,t.closeFilterEditor=t.closeFilterEditor.bind(t),super.construct(e,r),t.bindStore(e.store),r&&typeof r=="object"){const i=T.clone(r);delete i.prioritizeColumns,delete i.isMulti,delete i.dateFormat,T.isEmpty(i)||e.store.filter(i,null,e.isConfiguring)}}doDestroy(){var e,r;(e=this.filterTip)==null||e.destroy(),(r=this.filterEditorPopup)==null||r.destroy(),super.doDestroy()}get store(){return this.grid.store}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this}),this.client.isPainted&&this.refreshHeaders(!1)}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(e){const r=this,t=r.grid,i=t.headerContainer;i&&(w.children(i,".b-filter-icon.b-latest").forEach(n=>n.classList.remove("b-latest")),r.filterTip||(r.filterTip=new ve({forElement:i,forSelector:".b-filter-icon",getHtml({activeTarget:n}){return n.dataset.filterText}})),t.store.isFiltered||r.filterTip.hide(),t.columns.visibleColumns.forEach(n=>{if(n.filterable!==!1){const s=r.store.filters.allValues.filter(({property:l,disabled:c,internal:d})=>l===n.field&&!c&&!d),a=s.length>0,o=n.element;if(o){const l=n.textWrapper;let c=l==null?void 0:l.querySelector(".b-filter-icon"),d;if(a){const u="&#x2022 ";d=`${r.L("L{filter}")}: `+(s.length>1?"<br/><br/>":"")+s.map(h=>{var g,f,m,p;let v=(g=h.value)!=null?g:"";const y=Array.isArray(v),C=(m=(f=r.store)==null?void 0:f.modelRelations)==null?void 0:m.find(({foreignKey:D})=>D===h.property);if(h.displayValue)v=h.displayValue;else{if(r.isMulti&&C){const{relatedDisplayField:D}=(p=r.isMulti.fields)==null?void 0:p[h.property];if(D){const S=x=>{var R;return(R=C.foreignStore.getById(x))==null?void 0:R[D]};y?v=v.map(S).sort((x,R)=>(x!=null?x:"").localeCompare(R!=null?R:"")):v=S(v)}}else n.formatValue&&v&&(v=y?v.map(D=>n.formatValue(D)):n.formatValue(v));y&&(v=`[ ${v.join(", ")} ]`)}return(s.length>1?u:"")+(typeof h=="string"?h:`${h.operator} ${v}`)}).join("<br/><br/>")}else d=r.L("L{applyFilter}");c?c.dataset.filterText=d:c=w.createElement({parent:l,tag:"div",className:"b-filter-icon",dataset:{filterText:d}}),n.field===r.store.latestFilterField&&c.classList.add("b-latest"),o.classList.add("b-filterable"),o.classList.toggle("b-filter",a)}n.meta.isFiltered=a}}),e&&t.refreshRows())}applyFilter(e,r){const{store:t}=this,{filterFn:i}=e.filterable;e.$filter=t.addFilter({...e.filterable,...r,property:e.field,[i?"filterBy":"_"]:function(n){return i({value:this.value,record:n,operator:this.operator,property:this.property,column:e})}},!0),t.filter()}removeFilter(e){if(this.isMulti)for(const r of this.getCurrentMultiFilters(e))this.store.removeFilter(r);else this.store.removeFilter(e.field)}disableFilter(e){for(const r of this.getCurrentMultiFilters(e))r.disabled=!0,this.store.filter(r);this.store.filter()}getCurrentMultiFilters(e){return this.store.filters.values.filter(r=>r.property===e.field)}getPopupDateItems(e,r,t,i,n,s,a,o){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:g}){g.key==="Enter"&&s()}function h({source:g,value:f}){f==null?d():(l.clearSiblingsFields(g),l.applyFilter(e,{operator:g.operator,value:f,displayValue:g._value,type:"date"}))}return[T.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(t==null?void 0:t.operator)==="sameDay"?t.value:i,operator:"sameDay",onKeydown:u,onChange:h,onClose:c,onClear:d},o),T.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:(t==null?void 0:t.operator)==="<"?t.value:null,operator:"<",onKeydown:u,onChange:h,onClose:c,onClear:d},o),T.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:(t==null?void 0:t.operator)===">"?t.value:null,operator:">",onKeydown:u,onChange:h,onClose:c,onClear:d},o)]}getPopupNumberItems(e,r,t,i,n,s,a,o){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:g}){g.key==="Enter"&&s()}function h({source:g,value:f}){f==null?d():(l.clearSiblingsFields(g),l.applyFilter(e,{operator:g.operator,value:f}))}return[T.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(t==null?void 0:t.operator)==="="?t.value:i,operator:"=",onKeydown:u,onChange:h,onEsc:c,onClear:d},o),T.assign({type:"number",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:(t==null?void 0:t.operator)==="<"?t.value:null,operator:"<",onKeydown:u,onChange:h,onEsc:c,onClear:d},o),T.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:(t==null?void 0:t.operator)===">"?t.value:null,operator:">",onKeydown:u,onChange:h,onEsc:c,onClear:d},o)]}clearSiblingsFields(e){var r;(r=this.filterEditorPopup)==null||r.items.forEach(t=>{t!==e&&(t==null||t.clear())})}getPopupDurationItems(e,r,t,i,n,s,a,o){const l=this,c=s,d=()=>l.removeFilter(e);function u({source:h,value:g}){g==null?d():(l.clearSiblingsFields(h),l.applyFilter(e,{operator:h.operator,value:g}))}return[T.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(t==null?void 0:t.operator)==="="?t.value:i,operator:"=",onChange:u,onEsc:c,onClear:d},o),T.assign({type:"duration",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:(t==null?void 0:t.operator)==="<"?t.value:null,operator:"<",onChange:u,onEsc:c,onClear:d},o),T.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:(t==null?void 0:t.operator)===">"?t.value:null,operator:">",onChange:u,onEsc:c,onClear:d},o)]}getPopupStringItems(e,r,t,i,n,s,a,o){const l=this;return[T.assign({type:r,cls:"b-last-row",placeholder:"L{filter}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t?t.value||t:i,operator:"*",onChange({source:c,value:d}){d===""?a():(l.applyFilter(e,{operator:c.operator,value:d,displayValue:c.displayField&&c.records?c.records.map(u=>u[c.displayField]).join(", "):void 0}),c.multiSelect||s())},onClose:s,onClear:a},o)]}getPopupItems(e,r,t,i,n,s,a,o){const l=this;if(l.isMulti)return l.getMultiFilterPopupItems(...arguments);switch(r){case"date":return l.getPopupDateItems(...arguments);case"number":return l.getPopupNumberItems(...arguments);case"duration":return l.getPopupDurationItems(...arguments);default:return l.getPopupStringItems(...arguments)}}getMultiFilterPopupItems(e){var r;const{grid:t,isMulti:i}=this,n=(r=t.store)==null?void 0:r.filters.find(s=>s.property===e.field);return[{...typeof i=="object"?i:void 0,type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:e.field,grid:t,filters:n?[]:[{property:e.field}],propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",width:360}]}showFilterEditor(e,r){e=this.grid.columns.getById(e);const t=this,{store:i,isMulti:n}=t,s=e.element,a=i.filters.getBy("property",e.field),o=t.getFilterType(e);if(e.filterable===!1)return;t.closeFilterEditor();const l=t.getPopupItems(e,o,a!=null&&a.internal?null:a,r,i,t.closeFilterEditor,()=>{t.removeFilter(e),t.closeFilterEditor()},e.filterable.filterField,n);l.forEach(c=>c.placeholder=c.placeholder?this.L(c.placeholder):c.placeholder),t.filterEditorPopup=la.openPopup(s,{owner:t.grid,cls:"b-filter-popup",scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:l})}closeFilterEditor(){var e;(e=this.filterEditorPopup)==null||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getFilterType(e){const r=e.field,t=this.client.store.modelClass.getFieldDefinition(r),i=e.filterType;return i?dp[i]:dp[e.type]||t&&dp[t.type]||"text"}populateCellMenuWithDateItems({column:e,record:r,items:t}){const i=e.field;if(this.getFilterType(e)==="date"){const s=this,a=r.getValue(i),o=l=>{s.applyFilter(e,{operator:l,value:a,displayValue:e.formatValue?e.formatValue(a):a,type:"date"})};t.filterDateEquals={text:"L{on}",localeClass:s,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:s.disabled,onItem:()=>o("=")},t.filterDateBefore={text:"L{before}",localeClass:s,icon:"b-fw-icon b-icon-filter-before",weight:310,disabled:s.disabled,onItem:()=>o("<")},t.filterDateAfter={text:"L{after}",localeClass:s,icon:"b-fw-icon b-icon-filter-after",weight:320,disabled:s.disabled,onItem:()=>o(">")}}}populateCellMenuWithNumberItems({column:e,record:r,items:t}){const i=e.field;if(this.getFilterType(e)==="number"){const s=this,a=r.getValue(i),o=l=>{s.applyFilter(e,{operator:l,value:a})};t.filterNumberEquals={text:"L{equals}",localeClass:s,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:s.disabled,onItem:()=>o("=")},t.filterNumberLess={text:"L{lessThan}",localeClass:s,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:s.disabled,onItem:()=>o("<")},t.filterNumberMore={text:"L{moreThan}",localeClass:s,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:s.disabled,onItem:()=>o(">")}}}populateCellMenuWithDurationItems({column:e,record:r,items:t}){if(this.getFilterType(e)==="duration"){const n=this,s=e.getFilterableValue(r),a=o=>{n.applyFilter(e,{operator:o,value:s})};t.filterDurationEquals={text:"L{equals}",localeClass:n,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:n.disabled,onItem:()=>a("=")},t.filterDurationLess={text:"L{lessThan}",localeClass:n,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:n.disabled,onItem:()=>a("<")},t.filterDurationMore={text:"L{moreThan}",localeClass:n,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:n.disabled,onItem:()=>a(">")}}}populateCellMenuWithStringItems({column:e,record:r,items:t}){var i,n;const s=this.getFilterType(e);if(!/(date|number|duration)/.test(s)){const a=this,o=e.getFilterableValue(r),l=(n=(i=e.filterable.filterField)==null?void 0:i.operator)!=null?n:"*";t.filterStringEquals={text:"L{equals}",localeClass:a,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:a.disabled,onItem:()=>a.applyFilter(e,{value:o,operator:l})}}}populateCellMenu({column:e,record:r,items:t}){const i=this;e.filterable!==!1&&!r.isSpecialRow&&(i.populateCellMenuWithDateItems(...arguments),i.populateCellMenuWithNumberItems(...arguments),i.populateCellMenuWithDurationItems(...arguments),i.populateCellMenuWithStringItems(...arguments),e.meta.isFiltered&&(t.filterRemove={text:"L{removeFilter}",localeClass:i,icon:"b-fw-icon b-icon-remove",cls:"b-separator",weight:400,disabled:i.disabled||i.isMulti&&!i.columnHasRemovableFilters(e),onItem:()=>i.removeFilter(e)}),i.isMulti&&(t.filterDisable={text:"L{disableFilter}",localeClass:i,icon:"b-fw-icon b-icon-filter-disable",cls:"b-separator",weight:400,disabled:i.disabled||!i.columnHasEnabledFilters(e),onItem:()=>i.disableFilter(e)}))}columnHasRemovableFilters(e){const r=this;return!!r.getCurrentMultiFilters(e).find(t=>!r.canDeleteFilter||r.callback(r.canDeleteFilter,r,[t])!==!1)}columnHasEnabledFilters(e){return!!this.getCurrentMultiFilters(e).find(r=>!r.disabled)}populateHeaderMenu({column:e,items:r}){const t=this;e.meta.isFiltered?(r.editFilter={text:"L{editFilter}",localeClass:t,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:t.disabled,onItem:()=>t.showFilterEditor(e)},r.removeFilter={text:"L{removeFilter}",localeClass:t,weight:110,icon:"b-fw-icon b-icon-remove",disabled:t.disabled||t.isMulti&&!t.columnHasRemovableFilters(e),onItem:()=>t.removeFilter(e)},t.isMulti&&(r.disableFilter={text:"L{disableFilter}",localeClass:t,icon:"b-fw-icon b-icon-filter-disable",weight:115,disabled:t.disabled||!t.columnHasEnabledFilters(e),onItem:()=>t.disableFilter(e)})):e.filterable!==!1&&(r.filter={text:"L{filter}",localeClass:t,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:t.disabled,onItem:()=>t.showFilterEditor(e)})}onStoreBeforeFilter({filters:e}){var r;const{columns:t}=this.client;for(let i=0;i<e.count;i++){const n=e.getAt(i);if(!n.internal){const s=(n.columnOwned||this.prioritizeColumns)&&t.find(a=>a.filterable!==!1&&a.field===n.property);(r=s==null?void 0:s.filterable)!=null&&r.filterFn&&(s.$filter||(s.$filter=new dt({columnOwned:!0,property:n.property,operator:n.operator,value:n.value,filterBy(a){return s.filterable.filterFn({value:this.value,record:a,operator:this.operator,property:this.property,column:s})}})),s.$filter.value=n.value,s.$filter.displayValue=n.displayValue,s.$filter.operator=n.operator,e.splice(i,1,s.$filter))}}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick({target:e}){if(this.filterEditorPopup&&this.closeFilterEditor(),e.classList.contains("b-filter-icon")){const r=e.closest(".b-grid-header");return this.showFilterEditor(r.dataset.columnId),!1}}showFilterEditorByKey({target:e}){const r=e.matches(".b-grid-header")&&e;return r&&this.showFilterEditor(r.dataset.columnId),!!r}isActionAvailable({event:e}){const r=e.target.closest(".b-grid-header"),t=r&&this.client.columns.find(i=>i.id===r.dataset.columnId);return!!(t!=null&&t.filterable)}};up._$name="Filter",j.registerFeature(up);var Pk={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null},Du=class extends Q{static get $name(){return"FilterBar"}static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}}}}static get pluginConfig(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(e,r){if(e.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const t=this;t.grid=e,t.onColumnFilterFieldChange=t.onColumnFilterFieldChange.bind(t),super.construct(e,Array.isArray(r)?{filter:r}:r),t.bindStore(e.store),t.filter&&e.store.filter(t.filter),t.gridDetacher=e.ion({beforeElementClick:"onBeforeElementClick",thisObj:t})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var e;this.destroyFilterBar(),(e=this.gridDetacher)==null||e.call(this),super.doDestroy()}doDisable(e){const{columns:r}=this.grid;r==null||r.forEach(t=>{const i=this.getColumnFilterField(t);i&&(i.disabled=e)}),super.doDisable(e)}updateCompactMode(e){this.client.headerContainer.classList[e?"add":"remove"]("b-filter-bar-compact");for(const r in this._columnFilters){const t=this._columnFilters[r];t.placeholder=e?t.column.headerText:null}}destroyFilterBar(){var e;(e=this.grid.columns)==null||e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var e;const r=this;r.clearStoreFiltersOnHide&&r.suspendStoreTracking(),(e=r.grid.columns)==null||e.forEach(t=>r.hideColumnFilterField(t,!0)),r.grid.store.filter(),r.clearStoreFiltersOnHide&&r.resumeStoreTracking(),r.hidden=!0}showFilterBar(){this.suspendStoreTracking(),this.renderFilterBar(this.clearStoreFiltersOnHide),this.resumeStoreTracking(),this.hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(e){this.grid.hideHeaders||(this.grid.columns.visibleColumns.forEach(r=>this.renderColumnFilterField(r,e)),this.rendered=!0)}renderColumnFilterField(e,r){const t=this,{grid:i}=t,n=t.getColumnFilterable(e);if(n&&e.isVisible){const s=e.element,a=i.store.filters.get(e.id)||i.store.filters.getBy("property",e.field);let o=t.getColumnFilterField(e);if(o)r&&t.onColumnFilterFieldChange({source:o,value:o.value}),o.render(s),o.show();else{const l=`${e.filterType||"text"}field`,{filterField:c}=n,d=c==null?void 0:c.cls;d&&delete n.filterField.cls,o=la.append(T.assign({type:l,cls:{[t.filterFieldCls]:1,[d]:d},dataset:{column:e.field},column:e,owner:i,clearable:!0,name:e.field,value:a&&!a._filterBy&&!a.internal?t.buildFilterValue(a):"",inputCls:t.filterFieldInputCls,keyStrokeChangeDelay:t.keyStrokeFilterDelay,onChange:t.onColumnFilterFieldChange,onClear:t.onColumnFilterFieldChange,disabled:t.disabled,placeholder:t.compactMode?e.headerText:null,format:e.format},c),s)[0],c!=null&&c.hasOwnProperty("min")||Object.defineProperty(o,"min",{get:()=>{var h;return(h=e.editor)==null?void 0:h.min},set:()=>null}),c!=null&&c.hasOwnProperty("max")||Object.defineProperty(o,"max",{get:()=>{var h;return(h=e.editor)==null?void 0:h.max},set:()=>null}),c!=null&&c.hasOwnProperty("strictParsing")||Object.defineProperty(o,"strictParsing",{get:()=>{var h;return(h=e.editor)==null?void 0:h.strictParsing},set:()=>null}),o.element.retainElement=!0,t.setColumnFilterField(e,o);const u=(c==null?void 0:c.store)&&(c.store.readUrl||c.store.data||c.store.isChained);if(o.isCombo&&!u&&o.store.count===0){const h=o.value,g=()=>{o.store.readUrl||o.store.isChained||(o.store.data=i.store.getDistinctValues(e.field,!0).map(f=>i.store.modelClass.new({id:f,[e.field]:f})))};o.value=null,o.store.isSorted||o.store.sort({field:e.field,ascending:!0}),o.picker.ion({beforeShow:g}),g(),o.value=h}!t.filter&&o.value&&i.store.autoLoad!==!1&&t.onColumnFilterFieldChange({source:o,value:o.value})}s.classList.add(t.filterableColumnCls)}}updateColumnFilterFields(){const e=this,{columns:r,store:t}=e.grid;let i,n;e._updatingFields=!0;for(const s of r.visibleColumns)i=e.getColumnFilterField(s),i&&(n=t.filters.get(s.id)||t.filters.getBy("property",s.field),n&&!n.internal?n._filterBy?i.value=n.value:i.value=e.buildFilterValue(n):i.value="");e._updatingFields=!1}getColumnFilterable(e){if(!e.isRoot&&e.filterable!==!1&&e.field&&e.isLeaf)return typeof e.filterable=="function"&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const r=this.getColumnFilterField(e);r&&(this.hideColumnFilterField(e,!0),r.destroy(),this.setColumnFilterField(e,void 0))}hideColumnFilterField(e,r){const t=this,{store:i}=t.grid,n=e.element,s=t.getColumnFilterField(e);if(s){t.isDestroying||s.hide();const{$filter:a}=e;!i.isDestroyed&&t.clearStoreFiltersOnHide&&a&&i.removeFilter(a,r),n==null||n.classList.remove(t.filterableColumnCls)}}getColumnFilterField(e){var r;return(r=this._columnFilters)==null?void 0:r[e.id]}setColumnFilterField(e,r){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=r}parseFilterValue(e,r,t){var i;if(Array.isArray(r))return{value:r};if(T.isDate(r))return{operator:t.isDateField?"sameDay":t.isTimeField?"sameTime":"=",value:r};const n=String(r).match(this.filterParseRegExp);return{operator:n[1]||((i=e.filterable)==null?void 0:i.operator)||"*",value:n[2]}}buildFilterValue({operator:e,value:r}){return r instanceof Date||Array.isArray(r)?r:(e in Pk?"":e)+r}onStoreBeforeFilter({filters:e}){var r;const{columns:t}=this.client;for(let i=0;i<e.count;i++){const n=e.getAt(i),s=(n.columnOwned||this.prioritizeColumns)&&t.find(a=>a.filterable!==!1&&a.field===n.property);(r=s==null?void 0:s.filterable)!=null&&r.filterFn&&(s.$filter||(s.$filter=new dt({columnOwned:!0,property:n.property,id:s.id,filterBy(a){return s.filterable.filterFn({value:this.value,record:a,property:this.property,column:s})}})),s.$filter.value=n.value,e.splice(i,1,s.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}afterColumnsChange({action:e,changes:r,column:t,columns:i}){!this.hidden&&(r!=null&&r.hidden)&&(r.hidden.value?this.destroyColumnFilterField(t):this.renderColumnFilterField(t)),e==="remove"&&i.forEach(n=>this.destroyColumnFilterField(n))}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}renderContents(){if(this._columnFilters)for(const e of Object.values(this._columnFilters))e==null||e.element.remove()}disableGridNavigation(e){return e.target.matches(this.filterFieldInputSelector)}onBeforeElementClick({event:e}){if(e.target.closest(`.${this.filterFieldCls}`))return!1}onColumnFilterFieldChange({source:e,value:r}){var t,i;const n=this,{column:s}=e,{filterFn:a}=s.filterable,{store:o}=n.grid,l=s.$filter||o.filters.find(d=>(d.id===s.id||d.property===s.field)&&!d.internal);if(n._updatingFields)return;const c=r==null||r===""||Array.isArray(r)&&r.length===0;if(o.removeFilter(l,!0),s.$filter=null,c){if(!l)return}else s.$filter=o.addFilter({property:e.name,...n.parseFilterValue(s,r,e),[typeof((t=s.filterable)==null?void 0:t.caseSensitive)=="boolean"?"caseSensitive":void 0]:(i=s.filterable)==null?void 0:i.caseSensitive,[a?"filterBy":"_"]:function(d){return a({value:this.value,record:d,operator:this.operator,property:this.property,column:s})}},!0);o.filter()}populateHeaderMenu({items:e}){e.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}};Du.featureClass="b-filter-bar",Du._$name="FilterBar",j.registerFeature(Du);var wu=class extends Q{static get $name(){return"Group"}static get configurable(){return{field:null,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"},toggleOnRowClick:!0}}construct(e,r){const t=this;e.features.tree||(t._thisIsAUsedExpression(e.features.groupSummary),r=t.processConfig(r),t.grid=e,super.construct(e,r),t.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:t}))}processConfig(e){return typeof e=="string"?{field:e,ascending:null}:e}setConfig(e){e===null?this.store.clearGroupers():super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",group:"onStoreGroup",change:"onStoreChange",toggleGroup:"onStoreToggleGroup",thisObj:this}),this.onStoreGroup({groupers:e.groupers})}updateRenderer(e){this.groupRenderer=e}updateField(e){var r;(!this.isConfiguring||!((r=this.store.groupers)!=null&&r.some(t=>t.field===e)))&&this.store.group({field:e,ascending:this.ascending,fn:this.groupSortFn})}updateGroupSortFn(e){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:e})}doDestroy(){super.doDestroy()}doDisable(e){const{store:r}=this;if(e&&r.isGrouped){const{sorters:t}=r;t.unshift(...r.groupers),this.currentGroupers=r.groupers,r.clearGroupers(),r.sort(t)}else!e&&this.currentGroupers&&(r.group(this.currentGroupers[0]),this.currentGroupers=null);super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}refreshGrid(e){const{store:r,rowManager:t}=this.grid;t.rowCount>r.count||!t.getRowFor(e)?t.renderFromRow():t.renderFromRecord(e)}toggleCollapse(e,r){this.internalToggleCollapse(e,r)}internalToggleCollapse(e,r,t=!1,i){const n=this,{store:s,grid:a}=n,o=s.getById(e);o.isGroupHeader&&(r=r===void 0?!o.meta.collapsed:r,a.trigger("beforeToggleGroup",{groupRecord:o,collapse:r,domEvent:i})!==!1&&(n.isToggling=!0,r?s.collapse(o):s.expand(o),n.isToggling=!1,t||n.refreshGrid(o),a.trigger("toggleGroup",{groupRecord:o,collapse:r}),a.afterToggleGroup()))}collapseAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach(r=>e.internalToggleCollapse(r,!0,!0)),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach(r=>e.internalToggleCollapse(r,!1,!0)),e.grid.refreshRows())}onBeforeRenderRow({row:e}){const r=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||(r==null?void 0:r.isGroupHeader)}renderCell(e){var r;const t=this,{cellElement:i,row:n,column:s,grid:a}=e,{meta:o}=e.record,l={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped&&"groupRowFor"in o){if(s.type==="action")return;s.clearCell(i),l["b-grid-group-collapsed"]=o.collapsed,l["b-group-row"]=1,a.buildGroupHeader?a.buildGroupHeader(e):t.buildGroupHeader(e),s===t.groupHeaderColumn&&(w.createElement({parent:i,tag:"i",className:"b-group-state-icon",nextSibling:i.firstChild}),i.classList.add("b-group-title"),i.$groupHeader=i._hasHtml=!0)}else i.$groupHeader&&((r=i.querySelector(".b-group-state-icon"))==null||r.remove(),i.classList.remove("b-group-title"),i.$groupHeader=!1);n.assignCls(l)}buildGroupHeader(e){const r=this,{record:t,cellElement:i,column:n,persist:s}=e,{grid:a}=r,o=t.meta,{groupRowFor:l}=o,{groupSummary:c}=a.features,d=o.childCount-(c&&c.target!=="header"?1:0);let u=null,h=!0;if(s||n){const g=a.columns.get(o.groupField),f=e.isFirstColumn=n===r.groupHeaderColumn;g!=null&&g.groupRenderer?f&&(u=g.groupRenderer({...e,groupRowFor:l,groupRecords:t.groupChildren,groupColumn:g,count:d}),h=!1):r.groupRenderer&&(u=r.groupRenderer({...e,groupRowFor:l,groupRecords:t.groupChildren,groupColumn:g,count:d,isFirstColumn:f})),f&&u==null&&h&&w.getChildElementCount(i)===0&&(u=O.encodeHtml(`${l==="__novalue__"?"":l} (${d})`))}else r.groupRenderer&&(u=r.groupRenderer(e));return typeof u=="string"?i.innerHTML=u:typeof u=="object"&&X.sync({targetElement:i,domConfig:{onlyChildren:!0,children:H.asArray(u)}}),w.getChildElementCount(i)>0&&(i._hasHtml=!0),i.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find(e=>!e.groupHeaderReserved)}renderHeader(e){const{store:r,grid:t}=this;if(r.isGrouped)for(const i of r.groupers){const n=t.columns.get(i.field),s=n&&t.getHeaderElement(n.id);if(s==null||s.classList.add("b-group",i.ascending?"b-asc":"b-desc"),!t.features.sort||t.features.sort.disabled){const a=n.textWrapper;a!=null&&a.querySelector(".b-sort-icon")||w.createElement({parent:a,className:"b-sort-icon"})}}}populateHeaderMenu({column:e,items:r}){const t=this;e.groupable!==!1&&(r.groupAsc={text:"L{groupAscending}",localeClass:t,icon:"b-fw-icon b-icon-group-asc",cls:"b-separator",weight:400,disabled:t.disabled,onItem:()=>t.store.group(e.field,!0)},r.groupDesc={text:"L{groupDescending}",localeClass:t,icon:"b-fw-icon b-icon-group-desc",weight:410,disabled:t.disabled,onItem:()=>t.store.group(e.field,!1)}),t.store.isGrouped&&(r.groupRemove={text:"L{stopGrouping}",localeClass:t,icon:"b-fw-icon b-icon-clear",cls:e.groupable?"":"b-separator",weight:420,disabled:t.disabled,onItem:()=>t.store.clearGroupers()})}getColumnDragToolbarItems(e,r){var t;const i=this,{store:n,disabled:s}=i;r.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:i,icon:"b-icon b-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:s,onDrop:({column:o})=>n.group(o.field,!0)}),r.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:i,icon:"b-icon b-icon-group-desc",ref:"groupDesc",weight:110,disabled:s,onDrop:({column:o})=>n.group(o.field,!1)});const a=((t=n.groupers)==null?void 0:t.some(o=>o.field===e.field))&&!s;return r.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:i,icon:"b-icon b-icon-clear",ref:"groupRemove",disabled:!a,weight:110,onDrop:({column:o})=>n.removeGrouper(o.field)}),r}onStoreGroup({groupers:e}){const{grid:r}=this,{element:t}=r,i=t&&w.children(t,".b-grid-header.b-group");if(t){for(const n of i)n.classList.remove("b-group","b-asc","b-desc");if(e)for(const n of e){const s=r.getHeaderElementByField(n.field);s&&s.classList.add("b-group",n.ascending?"b-asc":"b-desc")}}}onStoreChange({action:e,records:r}){const{client:t}=this,{rowManager:i,store:n}=t;if(n.isGrouped&&e==="move"){const{field:s}=n.groupers[0],a=Math.min(...r.reduce((o,l)=>{if(o.push(n.indexOf(l.instanceMeta(n).groupParent)),s in l.meta.modified){const c=n.groupRecords.find(d=>d.meta.groupRowFor===l.meta.modified[s]);c&&o.push(n.indexOf(c))}return o},[]));i.renderFromRow(i.getRow(a))}}onStoreToggleGroup({groupRecord:e}){this.isToggling||this.refreshGrid(e)}onElementTouchStart(e){const r=this,{target:t}=e,i=t.closest(".b-grid-header"),n=i&&r.grid.getColumnFromElement(i);e.touches.length>1&&n&&n.groupable!==!1&&!r.disabled&&r.store.group(n.field)}onElementClick(e){var r;const t=this,{store:i}=t,{target:n}=e,s=n.closest(".b-group-row"),a=n.closest(".b-grid-header"),o=a==null?void 0:a.dataset.column;if(!(n.classList.contains("b-resizer")||t.disabled||n.classList.contains("b-action-item")||e.handled)){if(a&&o){const l=(r=i.groupers)==null?void 0:r.find(c=>c.field===o);if(l&&!e.shiftKey)return l.ascending=!l.ascending,i.group(),!1;e.shiftKey&&t.grid.columns.get(o).groupable!==!1&&(e.altKey?i.removeGrouper(o):i.group(o))}if(s&&(t.toggleOnRowClick||e.target.classList.contains("b-group-state-icon")))return t.internalToggleCollapse(Ge.get(s).id,void 0,void 0,e),!1}}toggleGroup(e){var r;const{grid:t}=this,{focusedCell:i}=t;return!this.disabled&&!i.isActionable&&((r=i.record)!=null&&r.isGroupHeader)?(this.internalToggleCollapse(i.id),!0):!1}};wu._$name="Group",j.registerFeature(wu,!0,["Grid","Scheduler"]),j.registerFeature(wu,!1,["TreeGrid"]);var NE=e=>class extends(e||F){static get $name(){return"SummaryFormatter"}generateHtml(t,i,n,s,a,o){const l=this.store,c=t.summaries||(t.sum?[{sum:t.sum,renderer:t.summaryRenderer}]:[]);let d=`<table class="${n}">`;return c.forEach(u=>{let h=u.sum,g=null;switch(h===!0&&(h="sum"),h){case"sum":case"add":g=l.sum(t.field,i);break;case"max":g=l.max(t.field,i);break;case"min":g=l.min(t.field,i);break;case"average":case"avg":g=l.average(t.field,i);break;case"count":g=i.length;break;case"countNotEmpty":g=i.reduce((f,m)=>{const p=m.getValue(t.field);return f+(p!=null?1:0)},0);break}if(typeof h=="function"&&(g=i.reduce(h,"seed"in u?u.seed:0)),g!==null){const f="b-grid-summary-value",m=u.label?`<td class="b-grid-summary-label">${u.label}</td>`:"";let p=u.renderer?u.renderer({config:u,sum:g}):g,v;p==null&&(p=""),String(p).includes("<td>")?v=p:v=m?`${m}<td class="${f}">${p}</td>`:`<td colspan="2" class="${f}">${p}</td>`,d+=`<tr>${v}</tr>`}}),d+"</table>"}},Vl=class extends NE(Q){static get $name(){return"GroupSummary"}static get configurable(){return{collapseToHeader:null,target:"footer"}}construct(e,r){if(this.grid=e,super.construct(e,r),!e.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}get store(){return this.grid.store}doDisable(e){this.updateTarget(this.target),super.doDisable(e)}changeTarget(e){return T.assertString(e,"target"),e}updateTarget(e){this.store.useGroupFooters=!this.disabled&&e==="footer",this.isConfiguring||this.store.group()}changeCollapseToHeader(e){return T.assertBoolean(e,"collapseToHeader"),e}updateCollapseToHeader(){this.isConfiguring||this.store.group()}static get pluginConfig(){return{chain:["bindStore"]}}onBeforeRenderRow({row:e,record:r}){e.isGroupFooter&&!("groupFooterFor"in r.meta)?(e.isGroupFooter=!1,e.forceInnerHTML=!0):e.isGroupHeader&&!r.meta.collapsed&&e.eachElement(this.removeSummaryElements)}removeSummaryElements(e){}renderCell({column:e,cellElement:r,row:t,record:i,size:n,isFirstColumn:s}){const a=this,{meta:o}=i,{rowHeight:l}=a.grid,c="groupRowFor"in o,d="groupFooterFor"in o,u=a.target==="header",h={"b-group-footer":0,"b-header-summary":0},g=c&&(u||a.collapseToHeader&&o.collapsed)&&!s||d&&!u;if((c||d)&&(n.height=c&&n.height||l),a.store.isGrouped&&g&&!a.disabled){e.clearCell(r);const f=c?i:o.groupRecord;t.isGroupFooter=d,t.isGroupHeader=c,d?h["b-group-footer"]=1:h["b-header-summary"]=1;const m=a.updateSummaryHtml(r,e,f),p=typeof m=="number"?m:m.count;p>1&&(n.height+=o.collapsed&&!u?0:p*l*.1),m.height&&(n.height+=m.height)}t.assignCls(h)}updateSummaryHtml(e,r,t){const i=t.groupChildren.slice();i[i.length-1].isGroupFooter&&i.pop();const n=this.generateHtml(r,i,"b-grid-group-summary",t,t.meta.groupField,t.meta.groupRowFor);return e.children.length?w.sync(n,e.firstElementChild):e.innerHTML=n,r.summaries?r.summaries.length:r.sum?1:0}onStoreUpdate({source:e,changes:r}){if(!this.disabled&&e.isGrouped){if(r&&e.groupers.find(i=>i.field in r))return;Object.keys(r).some(i=>{const n=this.grid.columns.get(i);return!!n&&(!!n.sum||!!n.summaries)})&&(this.grid.forceFullRefresh=!0)}}refresh(){this.grid.columns.visibleColumns.forEach(e=>{this.hasSummary(e)&&this.grid.refreshColumn(e)})}hasSummary(e){return e.sum||e.summaries}};Vl.featureClass="b-group-summary",Vl._$name="GroupSummary",j.registerFeature(Vl);var Nl=class extends aa{static get $name(){return"HeaderMenu"}static get configurable(){return{type:"header",items:null,moveColumns:null}}static get defaultConfig(){return{processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateHeaderMenu"),e}shouldShowMenu(e){const{column:r}=e;return r&&r.enableHeaderContextMenu!==!1&&r!==this.client.timeAxisColumn}getDataFromEvent(e){return T.assign(super.getDataFromEvent(e),this.client.getHeaderDataFromEvent(e))}populateHeaderMenu({items:e,column:r}){const t=this;if(r){if(r.headerMenuItems&&T.merge(e,r.headerMenuItems),r.isCollapsible){const{collapsed:i}=r,n=i?t.client.rtl?"left":"right":t.client.rtl?"right":"left";e.toggleCollapse={weight:215,icon:`b-fw-icon b-icon-collapse-${n}`,text:t.L(i?"L{expandColumn}":"L{collapseColumn}"),onItem:()=>r.collapsed=!i}}if(t.moveColumns){const i=t.getColumnToMoveBefore(r),n=t.getColumnToMoveAfter(r);i&&(e.movePrev={weight:220,icon:"b-fw-icon b-icon-column-move-left",text:t.L("L{moveBefore}",O.encodeHtml(i.text)),onItem:()=>{var s;const{parent:a}=r;i.parent.insertChild(r,i)&&(r.region=i.region,(s=a.children)!=null&&s.length||a.remove())}}),n&&(e.moveNext={weight:230,icon:"b-fw-icon b-icon-column-move-right",text:t.L("L{moveAfter}",O.encodeHtml(n.text)),onItem:()=>{var s;const{parent:a}=r;n.parent.insertChild(r,n.nextSibling)&&(r.region=n.region,(s=a.children)!=null&&s.length||a.remove())}})}}return e}getColumnToMoveBefore(e){const{previousSibling:r,parent:t}=e;if(r)return r.children&&!e.children?r.children[r.children.length-1]:r;if(!t.isRoot)return t}getColumnToMoveAfter(e){const{nextSibling:r,parent:t}=e;if(r)return r;if(!t.isRoot)return t}};Nl.featureClass="",Nl._$name="HeaderMenu",j.registerFeature(Nl,!0);var Ak={mousedown:"mouseDown",mousemove:"mouseMove",mouseup:"mouseUp",touchdown:"touchDown",touchmove:"touchMove",touchup:"touchUp",pointerover:"mouseOver",mouseout:"mouseOut",dblclick:"dblClick",keydown:"keyDown",keypress:"keyPress",keyup:"keyUp",contextmenu:"contextMenu"},zl=class extends Q{constructor(){super(...arguments),E(this,"mergedRanges",[]),E(this,"mergedMap",{})}static get pluginConfig(){return{chain:["beforeRenderCell","afterRenderRow","bindStore","afterColumnsChange","afterRemove","afterToggleGroup","afterToggleSubGrid","handleEvent","populateHeaderMenu","afterSelectionChange"],before:["onInternalResize"],override:["getColumnFromElement","getRecordFromElement"]}}afterConstruct(){const e=this,{client:r}=e;r.eachSubGrid(t=>e.setupSubGrid(t)),r.rowManager.ion({renderDone:"onRenderDone",thisObj:e}),e.bindStore(r.store)}setupSubGrid(e){e.$mergedCellsElement=w.createElement({parent:e.element,className:{"b-grid-merged-cells-container":1}}),e.ion({beforeInternalResize:"refreshBounds",thisObj:this})}doDisable(e){this.isConfiguring||(this.isDisabling=!0,this.reset(),this.isDisabling=!1),super.doDisable(e)}updatePassthrough(e){this.client.element.classList.toggle("b-mergecells-passthrough",e)}updateSortedOnly(e){this.isConfiguring||this.reset(!0,e)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",refresh:{prio:1,fn:"onStoreRefresh"},thisObj:this})}onInternalResize(){this.refreshBounds()}beforeRenderCell(e){const r=this,{column:t,record:i,cellElement:n}=e,s=r.client.subGrids[t.region];if(!r.disabled&&t.mergeCells&&(t.isSorted||!r.sortedOnly)&&!i.isSpecialRow&&!s.collapsed){const a=r.getMergeRange(i,t);a!=null&&a.use&&(n.classList.add("b-merged-cell"),n.innerHTML="",e.cellElement=a.cellElement)}}afterRenderRow({row:e,oldId:r,oldHeight:t}){r===e.id&&t!==e.height&&(this.heightChanged=!0)}afterColumnsChange({action:e,changes:r,column:t}){if(!this.disabled){if(e==="update"&&r.mergeCells&&!t.mergeCells){for(const i of this.mergedRanges.slice())i.column===t&&this.removeRange(i);this.syncDom();return}this.refreshBounds()}}afterRemove(){!this.disabled&&this.reset()}afterToggleGroup(){!this.disabled&&this.reset()}afterToggleSubGrid(){!this.disabled&&this.reset()}afterSelectionChange(){if(!this.passthrough){const{client:e}=this,r=e.selectedRecords.map(i=>e.store.indexOf(i));let t=!1;for(const i of this.mergedRanges){let n=!0;for(let s=i.fromIndex;s<=i.toIndex&&n;s++)n=r.includes(s);i.isSelected!==n&&(i.isSelected=n,t=!0)}t&&this.syncDom()}}getRecordFromElement(e){var r;return(r=e.elementData)!=null&&r.range?this.client.store.getAt(e.elementData.range.fromIndex):this.overridden.getRecordFromElement(e)}getColumnFromElement(e){var r;return(r=e.elementData)!=null&&r.range?e.elementData.range.column:this.overridden.getColumnFromElement(e)}populateHeaderMenu({column:e,items:r}){e.mergeable!==!1&&(r.mergeCells={text:"L{MergeCells.mergeCells}",icon:`b-fw-icon ${e.mergeCells?"b-icon-checked":"b-icon-unchecked"}`,tooltip:"L{MergeCells.menuTooltip}",cls:"b-separator",weight:500,disabled:this.disabled,onItem:()=>e.mergeCells=!e.mergeCells})}async handleEvent(e){var r;if(!this.passthrough){const t=e.target.closest(".b-grid-merged-cells");if(t){const{client:i}=this,{range:n}=t.elementData,{cellEdit:s}=i.features,{column:a}=n,o=O.capitalize((r=Ak[e.type])!=null?r:e.type),l={grid:i,records:[],column:a,cellElement:t.firstElementChild,target:e.target,event:e};for(let c=n.fromIndex;c<=n.toIndex;c++)l.records.push(i.store.getAt(c));if(i.trigger(`mergedCell${o}`,l),(s==null?void 0:s.triggerEvent.toLowerCase())===`cell${o}`.toLowerCase()){const c=i.rowManager.getRowAt(e.clientY);await s.startEditing({id:c.id,columnId:a.id})}else e.type==="click"&&this.onRangeClick({range:n})}}}onRangeClick({range:e}){const r=[];for(let t=e.fromIndex;t<=e.toIndex;t++)r.push(this.client.store.getAt(t));this.client.selectedRecords=r}onStoreChange(){!this.disabled&&this.reset()}onStoreRefresh({action:e}){e!=="filter"&&e!=="dataset"&&!this.disabled&&this.reset(!1)}createRangeElement(e){var r,t,i;const n=this.client.getSubGridFromColumn(e.column).$mergedCellsElement,s=`${e.fromIndex}-@-${e.column.id}`;let a=(i=(r=n.syncIdMap)==null?void 0:r[s])!=null?i:(t=n.releasedIdMap)==null?void 0:t[s];return n.releasedIdMap&&delete n.releasedIdMap[s],a||(a=w.createElement(this.createRangeDomConfig(e))),X.addChild(n,a,s),e.element=a,e.cellElement=a.firstElementChild,a}createRangeDomConfig(e){var r;const{column:t,fromIndex:i,toIndex:n,top:s,left:a,width:o,height:l}=e,{type:c}=t,d=this.client.store.getAt(i),u={className:{"b-grid-merged-cells":1,"b-selected":e.isSelected},elementData:{range:e},style:{top:s,left:a,height:l,width:o},dataset:{syncId:`${i}-@-${t.id}`,fromIndex:i,toIndex:n,column:t.field,columnId:t.id},children:[{className:new J(this.client.cellCls).assign({[`b-${c==null?void 0:c.toLowerCase()}-cell`]:c,[t.cellCls]:t.cellCls,[t.internalCellCls]:t.internalCellCls}).assign(t.autoCls),keepChildren:!0,elementData:{range:e},dataset:{column:t.field,columnId:t.id},style:{height:this.client.rowManager.rowHeight}}]};return(r=t.mergedRenderer)==null||r.call(t,{domConfig:u,value:t.getRawValue(d),record:d,column:t,fromIndex:i,toIndex:n}),u}buildMergedCellsConfig(e,r,t){var i,n;const s=this,{client:a}=s,{rowManager:o}=a;e=e!=null?e:(i=o.topRow)==null?void 0:i.dataIndex,r=r!=null?r:(n=o.bottomRow)==null?void 0:n.dataIndex;const l=a.regions.reduce((c,d)=>(c[d]={className:{"b-grid-merged-cells-container":1},children:[]},c),{});for(const c of s.mergedRanges)c.use&&c.fromIndex<=r&&c.toIndex>=e&&(s.updateRange(c,s.heightChanged,t),l[c.column.region].children.push(s.createRangeDomConfig(c)));return l}syncDom(e=!1){const r=this,{client:t}=r,{rowManager:i}=t;if(!e&&!i.topRow||r.disabled&&!r.isDisabling)return;const n=this.buildMergedCellsConfig();t.eachSubGrid(s=>{X.sync({targetElement:s.$mergedCellsElement,syncIdField:"syncId",domConfig:n[s.region]})}),r.heightChanged=!1}onRenderDone(){this.syncDom()}removeRange(e){H.remove(this.mergedRanges,e);for(let r=e.fromIndex;r<=e.toIndex;r++)delete this.mergedMap[`${r}-@-${e.column.id}`]}reset(e=!0,r=!1){const t=this,i=t.client.columns.visibleColumns.filter(s=>s.mergeCells&&(s.isSorted||!t.sortedOnly||r),!0),n=t.mergedRanges.length;if(t.mergedRanges=[],t.mergedMap={},e&&!t.client.refreshSuspended){for(const s of t.client.rowManager.rows)for(const a of i)s.renderCell(s.getCell(a.id));t.syncDom(n&&!t.client.rowManager.rowCount)}}refreshBounds(){const{mergedRanges:e}=this,r=this.client.rowManager.topRow,t=new Map;for(const i of e.slice()){const{column:n}=i,s=r.getCell(n.id);if(s){let a=t.get(n);a||t.set(n,a=k.from(s,s.parentElement)),i.left=a.left,i.width=a.width}else this.removeRange(i)}this.syncDom()}updateRange(e,r,t=null){const{store:i,rowManager:n}=this.client,{topRendered:s,bottomRendered:a}=e,{rowOffsetHeight:o}=n;let{fromIndex:l,toIndex:c}=e,d,u;if(r=t?t.length>0:r,!(!r&&s&&a)){if(!s||r){if(t){const g=t.findIndex(f=>f.dataIndex>=l);d=t[g],l=d.dataIndex}else do d=n.getRowById(i.getAt(l));while(!d&&l++<c);e.topRendered=l===e.fromIndex;const h=l-e.fromIndex;e.top=d.top-h*(t?d.offsetHeight:o)}if(!a||r){if(t){const g=t.findIndex(f=>f.dataIndex===c);u=t[g===-1?t.length-1:g],l=u.dataIndex}else do u=n.getRowById(i.getAt(c));while(!u&&c-- >l);e.bottomRendered=c===e.toIndex;const h=e.toIndex-c;e.bottom=u.bottom+h*(t?u.offsetHeight:o)}e.height=e.bottom-e.top}}getMergeRange(e,r){if(e.isSpecialRow)return;const t=this,{mergedMap:i}=t,{store:n}=t.client,s=t.client.rowManager.topRow,a=r.id,o=n.indexOf(e),l=`${o}-@-${a}`;let c=i[l];if(!c){const d=r.getRawValue(e);c=i[l]={column:r},t.mergedRanges.push(c);let u,h,g=o;do u=n.getAt(--g),h=u&&r.getRawValue(u),h===d&&(i[`${g}-@-${a}`]=c);while(u&&h===d);let f,m,p=o;do f=n.getAt(++p),m=f&&r.getRawValue(f),m===d&&(i[`${p}-@-${a}`]=c);while(f&&m===d);if(c.fromIndex=g+1,c.toIndex=p-1,c.toIndex-c.fromIndex>0){const v=s.getCell(a),y=k.from(v,v.parentElement);c.left=y.left,c.width=y.width,c.use=!0}}return!c.element&&c.use&&t.createRangeElement(c),c}};E(zl,"$name","MergeCells"),E(zl,"configurable",{passthrough:!0,sortedOnly:!0}),zl._$name="MergeCells",j.registerFeature(zl);var Wl=class extends Q{static get pluginConfig(){return{chain:["onElementKeyPress","onCellNavigate"]}}static get properties(){return{hitCls:"b-quick-hit",hitCellCls:"b-quick-hit-cell",hitCellBadgeCls:"b-quick-hit-cell-badge",hitTextCls:"b-quick-hit-text"}}construct(e,r){super.construct(e,r),Object.assign(this,{grid:e,treeWalker:e.setupTreeWalker(e.element,w.NodeFilter.SHOW_TEXT,()=>w.NodeFilter.FILTER_ACCEPT)})}isActionAvailable(){const{focusedCell:e}=this.grid;return!this.disabled&&(e==null?void 0:e.record)&&!e.isActionable&&this.find.length>0}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}showQuickFind(){const e=this,{grid:r}=e,t=r.getHeaderElement(e.columnId);if(t){if(!e.headerField){const[i,n,s]=w.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},{returnAll:!0});e.mode==="header"?t.appendChild(i):(i.className+=" b-quick-hit-mode-grid",r.element.appendChild(i)),e.headerField={header:i,field:n,badge:s,colHeader:t}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,t.classList.add("b-quick-find-header")}(t||r.hideHeaders)&&!e.renderListenerInitialized&&(r.rowManager.ion({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}hideQuickFind(){const e=this,{grid:r,headerField:t}=e;for(const i of e.prevFound||e.found){const n=r.getRowById(i.id);if(n){n.forceInnerHTML=!0;const s=n.getCell(e.columnId);s._content=null,n.renderCell(s),n.forceInnerHTML=!1}}t&&(t.header.parentNode.removeChild(t.header),t.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(r.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),r.trigger("hideQuickFind")}search(e,r=this.columnId,t=!1){var i;const n=this,{grid:s}=n,a=s.columns.getById(r)||s.columns.get(r),o=n.store.findByField(a.field,e,a.mergeCells&&a.isSorted);let l=1;Object.assign(n,{foundMap:{},prevFound:n.found,found:o,find:e,columnId:a.id,findRe:new RegExp(`(\\s+)?(${O.escapeRegExp(String(e))})(\\s+)?`,"ig")}),e?n.showQuickFind():n.hideQuickFind();for(const c of w.children(s.element,`.${n.hitCls}`))c.classList.remove(n.hitCls,n.hitCellCls),c._originalContent&&(c.innerHTML=c._originalContent,c._originalContent=null);if(o){o.length>0&&!t&&n.gotoClosestHit(s.focusedCell,o);for(const c of o){n.foundMap[c.id]=l++;const d=s.getRowById(c.data.id);if(d==null||d.renderCell(d.getCell(a.id)),l>1e3)break}(i=s.syncSplits)==null||i.call(s,c=>c.features.quickFind.search(e,r,!0)),s.trigger("quickFind",{find:e,found:o})}}clear(){var e;(this.find||(e=this.found)!=null&&e.length)&&this.search("")}get foundCount(){var e,r;return(r=(e=this.found)==null?void 0:e.length)!=null?r:0}gotoHit(e){const r=this.found[e];return r&&this.grid.focusCell({columnId:this.columnId,id:r.id},{doSelect:!0}),!!r}gotoClosestHit(e,r){const t=e?this.grid.store.indexOf(e.id):0,i=r.slice().sort((n,s)=>Math.abs(n.index-t)-Math.abs(s.index-t));this.gotoHit(r.indexOf(i[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){var e,r,t;const i=this,{grid:n}=i,s=(t=(e=n._focusedCell)==null?void 0:e.id)!=null?t:(r=n.lastFocusedCell)==null?void 0:r.id,a=n.store.indexOf(s)||0,o=i.found.find(l=>l.index>a);o?n.focusCell({columnId:i.columnId,id:o.id},{doSelect:!0}):i.gotoFirstHit()}gotoPrevHit(){var e,r,t;const i=this,{grid:n,found:s}=i,a=(t=(e=n._focusedCell)==null?void 0:e.id)!=null?t:(r=n.lastFocusedCell)==null?void 0:r.id,o=n.store.indexOf(a)||0;let l;if(s.length){for(let c=s.length-1;c--;c>=0)if(s[c].index<o){l=s[c];break}l?n.focusCell({columnId:i.columnId,id:l.id},{doSelect:!0}):i.gotoLastHit()}}renderCell({cellElement:e,column:r,record:t}){var i;const n=this,{classList:s}=e,{treeWalker:a,findRe:o,hitTextCls:l}=n,c=n.columnId===r.id&&((i=n.foundMap)==null?void 0:i[t.id]);if(c){s.add(n.hitCls),e.isQuickHit=!0,e._originalContent=e.innerHTML;const d=a.currentNode=w.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;for(let u=a.nextNode();u&&d.contains(u);){const h=u,g=u.nodeValue,f=["<span>"];u=a.nextNode();let m=o.lastIndex;for(let p=o.exec(g);p;p=o.exec(g)){const v=g.substring(m,p.index),y=p[1]?"\xA0":"",C=p[2],D=p[3]?"\xA0":"";f.push(`${O.encodeHtml(v)}${y}<span class="${l}">${C}</span>${D}`),m=o.lastIndex}f.push(O.encodeHtml(g.substring(m)),"</span>"),h.parentNode.insertBefore(w.createElementFromTemplate(f.join(""),{fragment:!0}),h),h.remove()}w.createElement({parent:e,className:n.hitCellBadgeCls,text:c})}}onBackspace(e){const r=this;return r.find?(r.find=r.find.substr(0,r.find.length-1),r.search(r.find),!0):!1}clearSearch(){return this.find?(this.find="",this.search(this.find),!0):!1}showFilterEditor(){const e=this,{filter:r}=e.client.features;r&&e.columnId&&e.foundCount&&(e.clear(),r.showFilterEditor(e.client.columns.getById(e.columnId),e.find))}onElementKeyPress(e){var r;const t=this,{grid:i}=t,{focusedCell:n}=i;if(!e.handled&&!t.disabled&&(n!=null&&n.record)&&!n.isActionable&&((r=e.key)==null?void 0:r.length)===1){const s=i.columns.getById(i._focusedCell.columnId);s&&s.searchable!==!1&&(t.columnId=i._focusedCell.columnId,t.find+=e.key,t.search(t.find))}}onCellNavigate(e,r,t){const i=this;i.find&&(!t||t.columnId!==i.columnId)&&i.clear()}};E(Wl,"$name","QuickFind"),E(Wl,"configurable",{mode:"header",find:"",keyMap:{F3:"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+g":"gotoNextHit","Ctrl+Shift+g":"gotoPrevHit","Ctrl+Shift+f":"showFilterEditor",Escape:"clearSearch",Backspace:"onBackspace"}}),Wl._$name="QuickFind",j.registerFeature(Wl);var Gl=class extends Q{static get pluginConfig(){return{chain:["onElementPointerDown","onElementDblClick","onElementTouchMove","onSubGridCollapse","onSubGridExpand","render"]}}onElementDblClick(e){const r=this,{client:t}=r,i=e.target.closest(".b-grid-splitter-collapsed");if(i&&!r.expanding){r.expanding=!0;let n=i.dataset.region,s=t.getSubGrid(n);s.collapsed||(n=t.getLastRegions()[1],s=t.getSubGrid(n)),s.expand().then(()=>r.expanding=!1)}}startMove(e,r){const t=this,{clientX:i}=r,{client:n}=t,s=e.dataset.region,a=n.element,o=n.regions[n.regions.indexOf(s)+1],l=n.getSubGrid(o),c=n.getSubGrid(s);let d=c,u=1;if(d.flex!=null&&l.flex==null&&(d=l,u=-1),n.rtl&&(u*=-1),e.classList.contains("b-grid-splitter-collapsed"))return;const h=d.element.offsetWidth+l.element.offsetWidth;n.trigger("splitterDragStart",{subGrid:d,domEvent:r}),t.dragContext={element:e,headerEl:d.header.element,subGridEl:d.element,subGrid:d,splitterSubGrid:c,originalWidth:d.element.offsetWidth,originalX:i,minWidth:d.minWidth||0,maxWidth:Math.min(h,d.maxWidth||h),flip:u},a.classList.add("b-moving-splitter"),c.toggleSplitterCls("b-moving"),t.pointerDetacher=B.on({element:document,pointermove:"onPointerMove",pointerup:"onPointerUp",thisObj:t})}endMove(e){const r=this,{dragContext:t,client:i}=r;if(t){const{subGrid:n}=t;e.preventDefault(),r.pointerDetacher(),i.element.classList.remove("b-moving-splitter"),t.splitterSubGrid.toggleSplitterCls("b-moving",!1),r.dragContext=null,i.trigger("splitterDragEnd",{subGrid:n,domEvent:e})}}onCollapseClick(e,r,t){const i=this,{client:n}=i,s=r.dataset.region,a=n.getLastRegions();if(n.trigger("splitterCollapseClick",{subGrid:e,domEvent:t})!==!1){if(a[0]===s){const o=n.getSubGrid(a[1]);if(o.collapsed){o.expand();return}}e.collapse()}}onExpandClick(e,r,t){const i=this,{client:n}=i,s=r.dataset.region,a=n.getLastRegions();if(n.trigger("splitterExpandClick",{subGrid:e,domEvent:t})!==!1){if(a[0]===s&&!e.collapsed){n.getSubGrid(a[1]).collapse();return}e.expand()}}updateMove(e){const{dragContext:r}=this;if(r){const t=e-r.originalX,i=Math.max(Math.min(r.maxWidth,r.originalWidth+t*r.flip),0);r.subGrid.width=Math.max(i,r.minWidth)}}onElementPointerDown(e){const r=this,{target:t}=e,i=e.button===0&&t.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),n=i&&r.client.getSubGrid(i.dataset.region);let s;i&&(t.closest(".b-grid-splitter-button-collapse")?r.onCollapseClick(n,i,e):t.closest(".b-grid-splitter-button-expand")?r.onExpandClick(n,i,e):(r.startMove(i,e),s=i)),e.pointerType==="touch"&&r.toggleTouchSplitter(s)}onPointerMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementTouchMove(e){this.dragContext&&e.preventDefault()}onPointerUp(e){this.endMove(e)}onSubGridCollapse({subGrid:e}){const r=this.client.resolveSplitter(e);this.client.getLastRegions()[1]===e.region&&r.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand({subGrid:e}){this.client.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}toggleTouchSplitter(e){const r=this,{touchedSplitter:t}=r;e&&t&&e.dataset.region!==t.dataset.region&&r.toggleTouchSplitter();const i=r.client.getSubGrid(e?e.dataset.region:t==null?void 0:t.dataset.region);i&&(i.toggleSplitterCls("b-touching",!!e),e?i.startSplitterButtonSyncing():i.stopSplitterButtonSyncing()),r.touchedSplitter=e}render(){const{regions:e,subGrids:r}=this.client;e.length>2&&(r[e[0]].splitterElement.classList.add("b-left-only"),r[e[1]].splitterElement.classList.add("b-right-only"))}};E(Gl,"$name","RegionResize"),Gl.featureClass="b-split",Gl._$name="RegionResize",j.registerFeature(Gl);var fr=class extends ba{constructor(){super(...arguments),E(this,"entityName","row")}construct(e,r){super.construct(e,r),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this}),this.grid=e}onBeforeRenderRow({row:e,record:r}){var t;e.cls["b-cut-row"]=this.isCut&&((t=this.cutData)==null?void 0:t.includes(r))}isActionAvailable({key:e,action:r,event:t}){var i;const{grid:n}=this,{cellEdit:s}=n.features,{target:a}=t;return!this.disabled&&globalThis.getSelection().toString().length===0&&(!s||!s.isEditing)&&(r==="copy"||!this.copyOnly)&&((i=n.selectedRecords)==null?void 0:i.length)>0&&(!a||!!a.closest(".b-gridbase:not(.b-schedulerbase) .b-grid-subgrid,.b-grid-subgrid:not(.b-timeaxissubgrid)"))}async copy(){await this.copyRows()}async cut(){await this.copyRows(!0)}paste(e){return this.pasteRows(e!=null&&e.isModel?e:null)}async copyRows(e=!1){const{client:r,entityName:t}=this,i=this.selectedRecords.filter(n=>!n.readOnly||!e);!i.length||r.readOnly||(await this.writeToClipboard(i,e),r.trigger("copy",{records:i,isCut:e,entityName:t}))}setIsCut(e,r){var t;(t=this.grid.rowManager.getRowById(e))==null||t.toggleCls("b-cut-row",r),e.meta.isCut=r}handleCutData({source:e}){var r;e!==this&&((r=this.cutData)!=null&&r.length)&&this.grid.store.remove(this.cutData)}stringConverter(e){return this.cellsToString(e.flatMap(r=>{var t;return(t=this.grid.rowManager.getRowById(r))==null?void 0:t.cells.map(i=>new oe(i))}))}async beforeCopy({data:e,isCut:r}){return await this.client.trigger("beforeCopy",{records:e,isCut:r,entityName:this.entityName})}async pasteRows(e){var r,t,i;const n=this,{client:s,isCut:a,entityName:o}=n,l=e||s.selectedRecord;if(s.readOnly||s.isTreeGrouped)return[];const c=await n.readFromClipboard({referenceRecord:l},!0),d=n.clipboardData===c;if(!Array.isArray(c)||!(c!=null&&c.length)||s.store.tree&&a&&c.some(g=>g.contains(l,!0)))return[];n.sortByIndex(c);const u={},h=n.extractParents(c,u,d);if(await n.insertCopiedRecords(h,l),!s.isDestroying)return a?await n.clearClipboard():s.selectedRecords=h,s.trigger("paste",{records:h,originalRecords:c,referenceRecord:l,isCut:a,entityName:o}),n.clipboard.triggerPaste(n),(i=(t=(r=s.getRowFor(h[h.length-1]))==null?void 0:r.cells)==null?void 0:t[0])==null||i.focus(),h}async beforePaste({referenceRecord:e,data:r,text:t,isCut:i}){const n=r!==t?r:[];return await this.client.trigger("beforePaste",{records:n,referenceRecord:e,isCut:i,entityName:this.entityName,data:r})}stringParser(e){return this.setFromStringData(e,!0).modifiedRecords}generateNewName(e){const r=e.getValue(this.nameField);let t=2;for(;this.client.store.findRecord(this.nameField,`${r} - ${t}`);)t++;return`${r} - ${t}`}insertCopiedRecords(e,r){const{store:t}=this.client,i=t.indexOf(r)+1;return t.tree?r.parent.insertChild(e,r.nextSibling,!1,{orderedBeforeNode:r.nextOrderedSibling}):t.insert(i,e)}get selectedRecords(){const e=[...this.client.selectedRecords];return this.client.selectedCells.forEach(r=>{e.includes(r.record)||e.push(r.record)}),e}getMenuItemText(e,r=!1){const t=this;let i=t[e+"RecordText"];return r&&(i+=` (${t.selectedRecords.length>1?t.rowSpecifierTextPlural:t.rowSpecifierText})`),i}populateCellMenu({record:e,items:r,cellSelector:t}){var i;const n=this,{client:s,rowOptionsOnCellContextMenu:a}=n,o=((i=s.features.cellCopyPaste)==null?void 0:i.enabled)===!0,l=o&&s.isCellSelected(t);!s.readOnly&&!s.isTreeGrouped&&(e==null?void 0:e.isSpecialRow)===!1&&(o?s.selectedRows.length:s.selectedRecords.length)&&(!l||n.rowOptionsOnCellContextMenu)&&(n.copyOnly||(r.cut={text:n.getMenuItemText("cut",l&&a),localeClass:n,icon:"b-icon b-icon-cut",weight:135,disabled:e.readOnly,onItem:()=>n.cut()},r.paste={text:n.getMenuItemText("paste",l&&a),localeClass:n,icon:"b-icon b-icon-paste",weight:140,onItem:()=>n.paste(e),disabled:n.hasClipboardData()===!1}),r.copy={text:n.getMenuItemText("copy",l&&a),localeClass:n,cls:"b-separator",icon:"b-icon b-icon-copy",weight:120,onItem:()=>n.copy()})}sortByIndex(e){const{store:r}=this.client;return e.sort((t,i)=>{const n=t.indexPath,s=i.indexPath;if(!e.includes(t.parent)&&!e.includes(i.parent))return r.indexOf(t)-r.indexOf(i);if(n.length===s.length){for(let a=0;a<n.length;a++){if(n[a]<s[a])return-1;if(n[a]>s[a])return 1}return 0}else return n.length-s.length})}extractParents(e,r,t=!0){const i=this,{store:n}=i.client;n.tree&&e.forEach(a=>{a.traverse(o=>{const l=o.getTopParent(!0);!e.includes(o)&&(!i.isCut||!e.some(c=>l.includes(c)))&&e.push(o)})});const s=e.reduce((a,o)=>{let l;const c=o.parentId||o.meta.modified;return i.isCut?(l=o,l.meta.isCut=!1):(l=o.copy(),t&&(l[i.nameField]=i.generateNewName(l)),l.data.expanded=o.isExpanded(i.client.store)),r[o.id]=l,o.parent===n.rootNode?a.push(l):c in r?r[c].appendChild(l,!0):a.push(l),a},[]);return s.forEach(a=>{a.sortOrderedChildren(!0,!0)}),s}};E(fr,"$name","RowCopyPaste"),E(fr,"type","rowCopyPaste"),E(fr,"pluginConfig",{assign:["copyRows","pasteRows"],chain:["populateCellMenu"]}),E(fr,"configurable",{nameField:"name",keyMap:{"Ctrl+C":{weight:10,handler:"copy"},"Ctrl+X":{weight:10,handler:"cut"},"Ctrl+V":{weight:10,handler:"paste"}},copyRecordText:"L{copyRecord}",cutRecordText:"L{cutRecord}",pasteRecordText:"L{pasteRecord}",rowSpecifierText:"L{row}",rowSpecifierTextPlural:"L{rows}",localizableProperties:["copyRecordText","cutRecordText","pasteRecordText","rowSpecifierText","rowSpecifierTextPlural"],rowOptionsOnCellContextMenu:!1}),fr.featureClass="b-row-copypaste",fr._$name="RowCopyPaste",j.registerFeature(fr,!0,"Grid"),j.registerFeature(fr,!1,"Gantt"),j.registerFeature(fr,!1,"SchedulerPro"),j.registerFeature(fr,!1,"ResourceHistogram");var _k={remove:1,filter:1,dataset:1,replace:1},Ul=class extends Q.mixin(fe){static get properties(){return{expanderBodyClass:"b-rowexpander-body",expandedRowClass:"b-rowexpander-row-expanded",shadowRootContainerClass:"b-rowexpander-shadowroot-container",recordStateMap:new Map,collapsingStateMap:new Map}}static get pluginConfig(){return{chain:["afterColumnsChange","beforeRenderRow","processRowHeight","bindStore","navigateUp"],override:["onGridBodyFocusIn","navigateDown","catchFocus","keyMapOnKeyDown"]}}afterConstruct(){const e=this,{client:r}=e;if(!e.renderer&&!e.widget){console.warn("RowExpander requires either a widget config or implementing the renderer function.");return}r.isGanttBase&&r.fixedRowHeight!==!1&&console.warn("When using RowExpander on a Gantt, the Gantt`s fixedRowHeight config must be set to false."),e.widget&&be.ion({theme:e.onThemeChange,thisObj:e}),e.bindStore(r.store),e.triggerEvent&&r.ion({[e.triggerEvent]:"onTriggerEvent",thisObj:e}),e.addColumn(),e.resizeObserver=new ResizeObserver(t=>e.onExpanderBodyResize(t))}bindStore(e){const r=this;r.recordStateMap.clear(),r.collapsingStateMap.clear(),r.detachListeners("clientStoreChange"),e.ion({name:"clientStoreChange",change:r.onStoreChange,thisObj:r})}doDisable(e){const{client:r}=this;e&&(this.recordStateMap.clear(),this.collapsingStateMap.clear()),r.isConfiguring||r.rowManager.renderFromRow(),super.doDisable(e)}changeLoadingIndicatorText(e){return e&&this.L(e)}onGridBodyFocusIn(e){var r,t;const i=this;(i.widget?!e.target.matches(`.${i.expanderBodyClass}, .${i.shadowRootContainerClass}`):!((t=(r=i.client.lastMousedownEvent)==null?void 0:r.target)!=null&&t.closest("."+i.expanderBodyClass)))&&i.overridden.onGridBodyFocusIn(e)}keyMapOnKeyDown({target:e}){var r;(!this.widget||!((r=e.classList)!=null&&r.contains(this.shadowRootContainerClass)))&&this.overridden.keyMapOnKeyDown(...arguments)}get isAnimating(){return this.client.isAnimating}set isAnimating(e){const{client:r}=this,t=r.isAnimating;r.isAnimating=e,r.isAnimating!==t&&r.element.classList.toggle("b-rowexpander-animating")}afterColumnsChange(){this.addColumn()}changeColumn(e){return e==null?e:{type:"action",actions:[{cls:"b-icon b-icon-collapse-down",tooltip:({record:r})=>this.L(this.recordStateMap.has(r)?"L{RowExpander.collapse}":"L{RowExpander.expand}"),onClick:({record:r})=>this.toggleExpand(r)}],width:40,hideable:!1,align:"center",region:this.client.regions[0],...e,field:"expanderActionColumn"}}addColumn(){const e=this,{column:r}=e,{columns:t}=e.client;!e._isAddingExpanderColumn&&r&&(!e._expander||!t.includes(e._expander))&&(e._isAddingExpanderColumn=!0,e.columnPosition==="last"?[e._expander]=t.add(r):[e._expander]=t.insert(0,r),e._isAddingExpanderColumn=!1)}onTriggerEvent({target:e}){this.disabled||e!=null&&e.closest(".b-action-cell")||!e.closest(".b-grid-cell")||this.toggleExpand(this.client.getRecordFromElement(e))}toggleExpand(e){e&&(this.recordStateMap.has(e)?this.collapse(e):this.expand(e))}onExpanderBodyResize(e){var r,t;const{client:i}=this,{store:n}=i;for(const s of e){const a=n.getById((t=(r=s.target.parentElement)==null?void 0:r._domData)==null?void 0:t.id),o=a&&this.recordStateMap.get(a);if(o&&!o.ignoreResize){const l=o.expanderBodyHeight;o.expanderBodyHeight=null,this.processRowHeight(a,0)!==l&&this.bufferedRenderer(a)}}}onStoreChange({action:e,source:r,records:t,changes:i}){var n;const s=this,{recordStateMap:a,collapsingStateMap:o}=s,l=i&&Object.keys(i);if(!((l==null?void 0:l.length)===1&&r.modelClass.fieldMap[l[0]].type==="store")&&!s.disabled){if(e==="removeAll")a.clear(),o.clear();else if(_k[e])for(const[c,d]of a)r.includes(c)||((n=d.widget)==null||n.destroy(),a.delete(c),o.delete(c));else if(s.refreshOnRecordChange&&(t!=null&&t.length)){if(e==="update"){const c=a.get(t[0]);c!=null&&c.isCreated&&(c.isCreated=!1,s.client.rowManager.renderFromRecord(t[0]))}else if(e==="updatemultiple"){let c,d;for(const u of t){const h=a.get(u);if(h!=null&&h.isCreated){const g=r.records.indexOf(u);h.isCreated=!1,(!d||c>g)&&(c=g,d=u)}}d&&s.client.rowManager.renderFromRecord(d)}}}}processRowHeight(e,r){var t;const i=this.recordStateMap.get(e);if(i){if(!i.isCreated&&i.isRenderingAsync)return this.loadingIndicatorHeight+r;if(!i.expanderBodyHeight)for(const n of this.client.regions){const s=i.expandedBodyElements[n].offsetHeight;s>i.expanderBodyHeight&&(i.expanderBodyHeight=s)}}return((t=i==null?void 0:i.expanderBodyHeight)!=null?t:0)+r}beforeRenderRow({row:e,record:r}){const t=this,{regions:i}=t.client,{expandedRowClass:n,collapsingStateMap:s}=t,a=t.recordStateMap.get(r);if(e.cls.toggle("b-rowexpander-disabled",t.disabled),e.cls[n]?t.enableAnimations&&t.isAnimating&&s.has(r)?t.waitForTransition(e,()=>{var o;const l=s.get(r);l&&(s.delete(r),t.removeExpander(e),(o=l.widget)==null||o.destroy())}):a||t.removeExpander(e):s.delete(r),!t.disabled&&a){a.isCreated||(a.ignoreResize=!0,t.renderExpander(r,e,a)),e.cls.add(n);for(const o of i){const l=e.getElement(o);if(a.isCreated){const c=a.expandedBodyElements[o];c.parentElement!==l&&(w.removeEachSelector(l,"."+t.expanderBodyClass),l.appendChild(c),t.resizeObserver.observe(c)),a.ignoreResize=!1,a.renderPromiseResolver&&(t.delay(a.renderPromiseResolver),a.renderPromiseResolver=null)}else t.renderLoadingIndicator(l,a);t.lockCellHeight(l,a.cellHeight,!1)}t._shouldScrollIntoView&&t.autoScroll&&(t._shouldScrollIntoView=!1,w.isInView(a.expandedBodyElements[i[0]],!0)||t.client.rowManager.ion({once:!0,thisObj:t,renderDone:()=>t.scrollRowIntoView(e,r)}))}}scrollRowIntoView(e,r){this.isAnimating?this.waitForTransition(e,()=>this.client.scrollRowIntoView(r)):this.client.scrollRowIntoView(r)}waitForTransition(e,r){var t;B.onTransitionEnd({element:e.element,property:"height",handler:r,thisObj:this,duration:(t=w.getPropertyTransitionDuration(e.element,"height"))!=null?t:1})}removeExpander(e,r){var t;e.cls.remove(this.expandedRowClass);for(const i of this.client.regions){const n=e.getElement(i);for(const s of n.querySelectorAll("."+this.expanderBodyClass))r&&((t=s.widget)==null||t.destroy()),this.resizeObserver.unobserve(s),s.remove();n.classList.remove(this.expandedRowClass),this.lockCellHeight(n,null,!1)}}renderLoadingIndicator(e,r){r.loadingIndicators.push(w.createElement({parent:e,className:this.expanderBodyClass+" b-rowexpander-loading",style:{top:r.cellHeight,height:this.loadingIndicatorHeight},children:[{tag:"i",className:"b-icon b-icon-spinner"},this.loadingIndicatorText]}))}renderExpander(e,r,t){var i;const n=this,{client:s,widget:a,dataField:o}=n,l=(i=r.cells[0])==null?void 0:i.offsetHeight,{expandedBodyElements:c={}}=t,d=[],u=(g,f,m)=>{g!=null&&(typeof g=="string"?f.innerHTML=g:g.type&&!g.tag?h(g,f):(g=w.createElement(g),f.appendChild(g))),c[m]=f},h=(g,f)=>{var m;const p=(m=w.getThemeInfo())==null?void 0:m.name,v=w.createElement({parent:f,className:n.shadowRootContainerClass,style:"flex : 1"}),y=v._shadowRoot=v.attachShadow({mode:"closed"});d.push(w.cloneStylesIntoShadowRoot(y).then(()=>{if(!s.isDestroyed){if(o){const C=e.getValue(o);if(C!=null&&C.isStore)g.store=C;else if(s.store[`${o}Store`]){const D=s.store[`${o}Store`];g.store=D.chain(S=>e.getValue(o).includes(S))}else g.data=C}if(p){const{cls:C}=g,D=`b-theme-${p.toLowerCase()}`;g.cls=C?C+" "+D:D}t.widget=f.widget=$.create(T.assign({appendTo:y,owner:s,flex:1,minHeight:"5em",isNested:!0},g)),o&&t.widget.store.ion({change:()=>!r.isDestroyed&&r.render(),thisObj:n})}}).catch(C=>{throw new Error("Could not load stylesheet "+C)}))};if(!t.isRenderingAsync){Object.assign(t,{cellHeight:l,expandedBodyElements:c,expanderBodyHeight:0,loadingIndicators:[]});for(const g of s.regions){const f=r.getElement(g);let m=c[g];r.addCls(n.expandedRowClass),m||(m=w.createElement({parent:f,tabIndex:-1,className:n.expanderBodyClass,style:{top:l+"px"}}),n.resizeObserver.observe(m));let p;a?h(a,m):p=n.renderer({record:e,expanderElement:m,rowElement:f,region:g,grid:s}),N.isPromise(p)?d.push(p.then(v=>u(v,m,g))):u(p,m,g)}d.length?(t.isRenderingAsync=!0,Promise.all(d).then(()=>{Promise.all(d).then(()=>{var g,f;if(!s.isDestroyed){t.isCreated=!0,(g=t.loadingIndicators)==null||g.forEach(m=>m.remove()),t.loadingIndicators.length=0,t.ignoreResize=!1,t.isRenderingAsync=!1;for(const[,m]of n.recordStateMap)if(!m.isCreated)return;(f=n.renderRowsWithAnimation)==null||f.call(n,e,!0)}})})):t.isCreated=!0}}renderRowsWithAnimation(e){const r=this;if(r.enableAnimations){const t=r.client.rowManager.getRowById(e);t&&(r.isAnimating=!0,r.collapsingStateMap.has(e)&&t.addCls("b-row-is-collapsing"),r.waitForTransition(t,()=>{var i;r.isAnimating=!1,t.isDestroyed||(i=t.removeCls)==null||i.call(t,"b-row-is-collapsing")}))}return r.bufferedRenderer(e)}bufferedRenderer(e){var r;return((r=this._bufferedRecords)!=null?r:this._bufferedRecords=[]).push(e),this._rafPromise||(this._rafPromise=new Promise(t=>{requestAnimationFrame(()=>{var i;(i=this.internalRender)==null||i.call(this,t),this._rafPromise=null})})),this._rafPromise}internalRender(e){const r=this,{_bufferedRecords:t}=r,{store:i}=r.client;r.recordStateMap.forEach((s,a)=>{s.renderPromiseResolver&&s.isCreated&&!t.includes(a)&&t.push(a)});const[n]=t.sort((s,a)=>i.indexOf(s)-i.indexOf(a));r.client.rowManager.renderFromRecord(n),t.length=0,r.delay(e)}lockCellHeight(e,r,t){for(let i=0;i<e.children.length;i++){const n=e.children[i];n.classList.contains(this.expanderBodyClass)||(n.style.height=t?"":r+"px")}}async expand(e,r=!1){const t=this;if(t.disabled||t.recordStateMap.has(e)||await t.trigger("beforeExpand",{record:e})===!1)return;let i;return new Promise(n=>{var s,a;i={isCreated:!1,renderPromiseResolver:n},t.recordStateMap.set(e,i),t.collapsingStateMap.delete(e),t._shouldScrollIntoView=!0,t.renderRowsWithAnimation(e),r||(a=(s=t.client).syncSplits)==null||a.call(s,o=>o.features.rowExpander.expand(e,!0))}).then(()=>{var n;(n=t.trigger)==null||n.call(t,"expand",{record:e,expandedElements:i.expandedBodyElements,widget:i.widget})})}async collapse(e,r=!1){var t,i;const n=this,s=n.recordStateMap.get(e);if(!(n.disabled||await n.trigger("beforeCollapse",{record:e})===!1)){if(s!=null&&s.expandedBodyElements)for(const a in s.expandedBodyElements)n.resizeObserver.unobserve(s.expandedBodyElements[a]);n.recordStateMap.delete(e),n.collapsingStateMap.set(e,s),await n.renderRowsWithAnimation(e),n.trigger("collapse",{record:e}),r||(i=(t=n.client).syncSplits)==null||i.call(t,a=>a.features.rowExpander.collapse(e,!0))}}navigateDown(){if(!this.onKeyboardIn())return this.overridden.navigateDown(...arguments)}navigateUp(){this.onKeyboardIn(!0)}catchFocus({navigationDirection:e,source:r,editing:t}){if(this.widget){const{client:i}=this,{focusedCell:n}=i;for(let[s,a]of this.recordStateMap.entries())for(const o in a.expandedBodyElements)if(a.expandedBodyElements[o].widget===r){e==="down"&&(s=i.store.getNext(s,void 0,!0));let l;!t&&n&&!n._isDefaultFocus?l=n.column:l=this.getNavigateableColumn(i,!0,t&&e==="up"),i._focusedCell=null;const c=i.normalizeCellContext({record:s,column:l});return i.focusCell(c),t&&i.startEditing(c),!0}}}onKeyboardIn(e){var r,t,i;if(this.widget){const{focusedCell:n}=this.client,s=n&&this.recordStateMap.get(n.record),a=(i=(t=s==null?void 0:s.expandedBodyElements)==null?void 0:t[(r=n==null?void 0:n.column)==null?void 0:r.region])==null?void 0:i.widget;if(a!=null&&a.isGrid){let o;return a.focusedCell&&!a.focusedCell._isDefaultFocus?o=a.focusedCell.column:o=this.getNavigateableColumn(a),a._focusedCell=null,a.focusCell(a.normalizeCellContext({record:a[`${e?"last":"first"}VisibleRow`],column:o})),!0}}return!1}getNavigateableColumn(e,r=!0,t=!1){var i;const n=t?[...e.columns.visibleColumns].reverse():e.columns.visibleColumns;return(i=n.find(s=>{var a;return s!==e.checkboxSelectionColumn&&s!==((a=e.features.rowExpander)==null?void 0:a._expander)&&(!r||s.editor)}))!=null?i:n[0]}isActionAvailable({action:e}){var r;return this.isDisabled?!1:["rowExpander.onTab","rowExpander.onShiftTab"].includes(e)?(r=this.client.features.cellEdit)==null?void 0:r.isEditing:!0}onTab(e){var r,t;const{client:i}=this,{cellEdit:n}=i.features;if(n!=null&&n.enabled){const s=e!==!0,{activeRecord:a}=n,o=n.getAdjacentEditableCell(i.focusedCell,s),l=s?a:o?i.store.getById(o.id):null,c=l&&((r=this.recordStateMap.get(l))==null?void 0:r.widget);if((a==null?void 0:a.id)!==(o==null?void 0:o.id)&&((t=c==null?void 0:c.features.cellEdit)!=null&&t.enabled))return n.finishEditing().then(()=>{const d=c[`${s?"first":"last"}VisibleRow`],u=this.getNavigateableColumn(c,!0,!s);c.startEditing(c.normalizeCellContext({record:d,column:u}))}),!0}return!1}onShiftTab(){return this.onTab(!0)}doDestroy(){var e,r;(e=this.resizeObserver)==null||e.disconnect(),delete this.resizeObserver;for(const[,t]of this.recordStateMap)(r=t.widget)==null||r.destroy();super.doDestroy()}onThemeChange({prev:e,theme:r}){for(const[,t]of this.recordStateMap)Object.values(t.expandedBodyElements).forEach(i=>{var n,s,a,o;const l=i.querySelector("."+this.shadowRootContainerClass);l!=null&&l._shadowRoot&&(w.cloneStylesIntoShadowRoot(l==null?void 0:l._shadowRoot,!0),(s=(n=i.widget)==null?void 0:n.element)==null||s.classList.remove(`b-theme-${e}`),(o=(a=i.widget)==null?void 0:a.element)==null||o.classList.add(`b-theme-${r}`))})}getExpandedRecord(e){for(const[r,t]of this.recordStateMap.entries())if(e.isWidget&&t.widget){if(t.widget===e)return r}else{const{expandedBodyElements:i}=t;for(const n in i){const s=i[n];if(s===e||s.contains(e))return r}}return null}};E(Ul,"$name","RowExpander"),E(Ul,"configurable",{renderer:null,triggerEvent:null,column:{},columnPosition:"first",refreshOnRecordChange:!1,loadingIndicatorHeight:100,loadingIndicatorText:"L{loading}",enableAnimations:!0,widget:null,dataField:null,keyMap:{Tab:{handler:"onTab",weight:50},"Shift+Tab":{handler:"onShiftTab",weight:50}},autoScroll:!1}),Ul._$name="RowExpander",j.registerFeature(Ul);var Wi=class extends fe(Q){static get deprecatedEvents(){return{gridRowBeforeDragStart:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowBeforeDragStart` event is deprecated, listen on this event on the Grid instead."},gridRowDragStart:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowDragStart` event is deprecated, listen on this event on the Grid instead."},gridRowDrag:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowDrag` event is deprecated, listen on this event on the Grid instead."},gridRowBeforeDropFinalize:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowBeforeDropFinalize` event is deprecated, listen on this event on the Grid instead."},gridRowDrop:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowDrop` event is deprecated, listen on this event on the Grid instead."},gridRowAbort:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowAbort` event is deprecated, listen on this event on the Grid instead."}}}construct(e,r){this.grid=e,super.construct(...arguments)}doDestroy(){var e;(e=this.dragHelper)==null||e.destroy(),super.doDestroy()}init(){const e=this,{grid:r}=e;e.dragHelper=ki.new({name:"rowReorder",cloneTarget:!0,dragThreshold:10,proxyTopOffset:10,targetSelector:".b-grid-row",lockX:!0,dragWithin:r.bodyContainer,allowDropOutside:!0,scrollManager:r.scrollManager,outerElement:e.targetSubGridElement,touchStartDelay:e.touchStartDelay,isElementDraggable:e.isElementDraggable.bind(e),monitoringConfig:{scrollables:[{element:r.scrollable.element,direction:"vertical"}]},setXY(t,i,n){const{context:s}=this;if(!s.started){const a=k.from(s.element,this.dragWithin),o=s.startPageY-globalThis.pageYOffset-s.element.getBoundingClientRect().top;n=a.top+o+this.proxyTopOffset}w.setTranslateXY(t,i,n)},ignoreSamePositionDrop:!1,createProxy(t){const i=t.cloneNode(!0),n=document.createElement("div");if(n.classList.add("b-row-reorder-proxy"),i.removeAttribute("id"),i.style.transform="",i.style.width="",n.appendChild(i),r.selectedRecords.length>1){const s=i.cloneNode(!0);s.classList.add("b-row-dragging-multiple"),n.appendChild(s)}return w.removeClsGlobally(n,"b-selected","b-hover","b-focused"),n},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onAbort",reset:"onReset",prio:1e4,thisObj:e}},e.dragHelperConfig),e.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow"),r.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow"),e.dropIndicator=w.createElement({className:"b-row-drop-indicator"}),e.dropOverTargetCls=["b-row-reordering-target","b-hover"]}get targetSubGridElement(){const e=this.grid.regions[0];return this.grid.subGrids[e].element}isElementDraggable(e,r){if(!e.closest(".b-grid-cell .b-widget"))if(this.gripOnly){const t=e.closest(".b-grid-cell:first-child");if(t){const i=getComputedStyle(t,":before"),n=this.grid.rtl?t.getBoundingClientRect().width-r.borderOffsetX:r.borderOffsetX,s=w.roundPx(n)<=w.roundPx(parseFloat(i.width));return s&&(this.client.preventDragSelect=!0),s}}else return!0}onBeforeDragStart({event:e,source:r,context:t}){const i=this,{grid:n}=i,s=i.targetSubGridElement;if(i.disabled||n.readOnly||n.isTreeGrouped||!s.contains(t.element))return!1;const a=t.startRecord=n.getRecordFromElement(t.element);if(a.readOnly||a.isSpecialRow)return!1;t.originalRowTop=n.rowManager.getRowFor(a).top,n.selectionMode.checkboxOnly||(r.startEvent.pointerType==="touch"?n.isSelected(a)||n.selectRow({record:a,addToSelection:!1}):!n.isSelected(a)&&!e.shiftKey&&!e.ctrlKey&&n.selectRow({record:a}));const o=n.selectedRecords.filter(l=>!l.readOnly);return t.records=[a],o.includes(a)&&(t.records.push(...o.filter(l=>l!==a)),t.records.sort((l,c)=>n.store.indexOf(l)-n.store.indexOf(c))),!0}onDragStart({context:e}){var r,t;const i=this,{grid:n}=i,{cellEdit:s,cellMenu:a,headerMenu:o}=n.features;s&&(i.cellEditDisabledState=s.disabled,s.disabled=!0),(r=a==null?void 0:a.hideContextMenu)==null||r.call(a,!1),(t=o==null?void 0:o.hideContextMenu)==null||t.call(o,!1),n.element.classList.add("b-row-reordering");const l=e.element.querySelector(".b-focused");l==null||l.classList.remove("b-focused"),e.element.firstElementChild.classList.remove("b-selected","b-hover"),n.bodyContainer.appendChild(i.dropIndicator)}onDrag({context:e,event:r}){var t;const i=this,{grid:n}=i,{store:s,rowManager:a}=n,{clientY:o}=r;let l=!0,c=a.getRowAt(o),d,u,h,g,f;if(c){const m=c.top+n.scrollable.element.getBoundingClientRect().top-n.scrollable.y,p=c.height/4,v=m+p,y=m+c.height/2,C=m+p*3;u=c.dataIndex,d=s.getAt(u),s.tree?g=(d.isParent||i.dropOnLeaf)&&o>v&&o<C:s.isGrouped&&(g=d.isGroupHeader&&d.meta.collapsed),h=!g&&r.clientY>=y}else r.pageY<n._bodyRectangle.y?(u=0,d=s.first,h=!1):(u=s.count-1,d=s.last,h=!0),c=n.rowManager.getRow(u);if(d===i.overRecord&&i.after===h&&i.over===g){e.valid=i.reorderValid;return}i.overRecord!==d&&((t=a.getRowById(i.overRecord))==null||t.removeCls(i.dropOverTargetCls)),i.overRecord=d,i.after=h,i.over=g,(d===e.startRecord||!h&&!g&&u===0&&s.isGrouped||h&&d.isGroupHeader&&d.meta.collapsed&&s.indexOf(d)===s.count-1)&&(l=!1),s.tree?(f=h?d.nextSibling:d,e.records.some(m=>m.contains(d))&&(l=!1),e.parent=l&&g?d:d.parent,i.clearTimeout(i.hoverTimer),d&&d.isParent&&!d.isExpanded(s)&&(i.hoverTimer=i.setTimeout(()=>n.expand(d),i.hoverExpandTimeout))):f=h?s.getAt(u+1):d,c.toggleCls(i.dropOverTargetCls,l&&g),!g&&u===s.indexOf(e.startRecord)+(h?-1:1)&&e.parent&&e.startRecord.parent===e.parent&&(l=!1),c&&w.setTranslateY(i.dropIndicator,Math.max(c.top+(h?c.element.getBoundingClientRect().height:0),1)),i.dropIndicator.style.visibility=g?"hidden":"visible",i.dropIndicator.classList.toggle("b-drag-invalid",!l),e.insertBefore=f,e.valid=i.reorderValid=l}async onDrop(e){const r=this,{client:t}=r,{context:i}=e;if(i.valid=i.valid&&r.reorderValid,i.valid){i.async=!0,t.store.tree&&(i.oldPositionContext=i.records.map(s=>{var a;return{record:s,parentId:(a=s.parent)==null?void 0:a.id,parentIndex:s.parentIndex}}));let n=await r.trigger("gridRowBeforeDropFinalize",e);n===!1&&(i.valid=!1),n=await t.trigger("gridRowBeforeDropFinalize",e),n===!1&&(i.valid=!1),await r.dragHelper.animateProxyTo(r.dropIndicator,{align:"l0-l0"}),await r.finalizeReorder(i)}r.clearTimeout(r.hoverTimer),r.overRecord=r.after=r.over=null,r.trigger("gridRowDrop",e),t.trigger("gridRowDrop",e)}onAbort(e){this.client.trigger("gridRowDragAbort",e)}async finalizeReorder(e){var r,t;const i=this,{grid:n}=i,{store:s,focusedCell:a}=n;let{records:o}=e;if(e.valid=e.valid&&!o.some(l=>!s.includes(l)),e.valid){let l;if(s.tree)o=o.filter(c=>!c.parent||c.bubbleWhile(d=>!o.includes(d),!0)),l=await e.parent.tryInsertChild(o,i.over?(r=e.parent.children)==null?void 0:r[0]:e.insertBefore),n.rowManager.forEach(c=>c.removeCls(i.dropOverTargetCls)),!e.parent.isExpanded()&&((t=e.parent.children)!=null&&t.length)&&n.expand(e.parent),e.valid=l!==!1;else if(s.isGrouped&&i.over)s.move(o,s.getAt(s.indexOf(e.insertBefore)+1));else{if(o.length>1)for(;e.insertBefore&&o.includes(e.insertBefore);)e.insertBefore=s.getNext(e.insertBefore,!1,!0);s.move(o,e.insertBefore)}(a==null?void 0:a._rowIndex)>=0&&(n._focusedCell=null,n.focusCell({grid:n,record:a.record,columnId:a.columnId})),s.clearSorters()}e.finalize(e.valid),n.element.classList.remove("b-row-reordering")}onReset(){const e=this,{grid:r}=e,t=r.features.cellEdit;r.element.classList.remove("b-row-reordering"),t&&(t.disabled=e.cellEditDisabledState),e.dropIndicator.remove(),w.removeClsGlobally(r.element,...e.dropOverTargetCls)}onPaint({firstPaint:e}){e&&this.init()}updateShowGrip(e){this.grid.element.classList.toggle("b-row-reorder-with-grip",e)}get isDragging(){return this.dragHelper.isDragging}};E(Wi,"$name","RowReorder"),E(Wi,"configurable",{showGrip:null,gripOnly:null,hoverExpandTimeout:1e3,touchStartDelay:300,dropOnLeaf:!1,dragHelperConfig:null}),E(Wi,"pluginConfig",{after:["onPaint"]}),Wi.featureClass="",Wi._$name="RowReorder",j.registerFeature(Wi,!1);var xa=class extends fe(Q){static get properties(){return{hitCls:"b-search-hit",hitCellCls:"b-search-hit-cell",hitCellBadgeCls:"b-search-hit-cell-badge",hitTextCls:"b-search-hit-text"}}construct(e,r){super.construct(e,r),Object.assign(this,{grid:e,text:"",hitEls:[],treeWalker:e.setupTreeWalker(e.element,w.NodeFilter.SHOW_TEXT,()=>w.NodeFilter.FILTER_ACCEPT)}),e.ion({expandNode:"onTreeNodeExpand",thisObj:this})}isActionAvailable(){return!!this.text}onTreeNodeExpand(){this.text&&this.requestAnimationFrame(this.search,[this.text,!1,!0])}doDestroy(){this.clear(!0),super.doDestroy()}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["populateCellMenu"]}}async search(e,r=!0,t=!1,i,n=!1){var s;const a=this;if(!e)return a.clear();if(!t&&e===a.text||a.disabled)return;const{grid:o,store:l}=a,c=o.columns.visibleColumns.filter(g=>g.searchable!==!1),d=[];i=i||c.map(g=>{var f;return d.push((f=g.formatValue)==null?void 0:f.bind(g)),g.field});const u=l.search(e,i,d);l.isTree&&u.length&&await o.expandTo(u.map(g=>g.id));for(const g of c)if(g.mergeCells&&g.isSorted){let f=null,m=null;for(const p of u)if(p.field===g.field){const v=p.data[p.field];v===f&&(p.belongsTo=m),f=v,m=`${p.field}-${p.id}`}}let h=1;if(Object.assign(a,{foundMap:{},prevFound:a.found,found:u,text:e,findRe:new RegExp(`(\\s+)?(${O.escapeRegExp(String(e))})(\\s+)?`,"ig")}),a.clearHits(),!!u){for(const g of u)if(a.foundMap[`${g.field}-${g.id}`]=g.belongsTo?a.foundMap[g.belongsTo]:h++,h>a.limit)break;return a.listenersInitialized||(o.rowManager.ion({name:"renderCell",renderCell:"renderCell",thisObj:a}),l.ion({name:"storeRefresh",[`refresh${o.asyncEventSuffix}`]:"onStoreRefresh",thisObj:a}),a.listenersInitialized=!0),o.refreshRows(),o.trigger("search",{grid:o,find:e,found:u}),r&&!a.isHitFocused&&!n&&a.gotoNextHit(!0),(s=o.syncSplits)==null||s.call(o,g=>g.features.search.search(e,r,t,i,!0)),u}}clearHits(){for(const e of w.children(this.grid.element,"."+this.hitCls)){e.classList.remove(this.hitCls,this.hitCellCls);const r=Ge.get(e).row;r&&(r.forceInnerHTML=!0,r.renderCell(e),r.forceInnerHTML=!1)}}clear(e=!1){var r;const t=this,{grid:i}=t;t.foundMap&&delete t.foundMap,t.text=null,t.clearHits(),t.listenersInitialized&&(t.detachListeners("renderCell"),t.detachListeners("storeRefresh"),t.listenersInitialized=!1),e||(i.trigger("clearSearch",{grid:i}),(r=i.syncSplits)==null||r.call(i,n=>n.features.search.clear()))}get foundCount(){var e,r;return(r=(e=this.found)==null?void 0:e.length)!=null?r:0}get isHitFocused(){var e;const r=this,{grid:t}=r,{focusedCell:i}=t;if((e=i==null?void 0:i.cell)!=null&&e.contains(w.getActiveElement(t.element))){const{rowIndex:n,column:s}=i;return n!==-1&&r.found.some(a=>a.index===n&&s&&a.field===s.field)}}gotoNextHit(e=!1){var r;const t=this;if(!((r=t.found)!=null&&r.length))return;const{grid:i,store:n}=t,s=i.focusedCell||i.lastFocusedCell,a=s&&e!==!0?n.indexOf(s.record,void 0,!0):-1,o=t.found.findIndex(l=>l.index>a);o!==-1&&t.gotoHit(o)}gotoPrevHit(){var e;const r=this,{store:t}=r;if(!((e=r.found)!=null&&e.length))return;const{grid:i,found:n}=r,s=i.focusedCell||i.lastFocusedCell,a=s?t.indexOf(s.record,void 0,!0):0;for(let o=n.length-1;o--;o>=0)if(n[o].index<a){r.gotoHit(o);break}}gotoHit(e){const{grid:r}=this,t=this.found[e];return t&&r.focusCell({field:t.field,id:t.id}),!!t}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:r,record:t,value:i}){var n,s;const a=this,{treeWalker:o,findRe:l,hitTextCls:c,showHitIndex:d}=a,u=(n=a.foundMap)==null?void 0:n[r.field+"-"+t.id];if(u){e.classList.add(a.hitCls),d&&((s=e.querySelector(`.${a.hitCellBadgeCls}`))==null||s.remove());const h=w.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;if(String(i).toLowerCase()===String(a.text).toLowerCase())h.innerHTML=`<span class="${a.hitTextCls}">${h.innerHTML}</span>${d?`<div class="${a.hitCellBadgeCls}">${u}</div>`:""}`;else{o.currentNode=h;for(let g=o.nextNode();g&&h.contains(g);){const f=g,m=g.nodeValue,p=["<span>"];g=o.nextNode();let v=l.lastIndex;for(let y=l.exec(m);y;y=l.exec(m)){const C=m.substring(v,y.index),D=y[1]?"\xA0":"",S=y[2],x=y[3]?"\xA0":"";p.push(`${O.encodeHtml(C)}${D}<span class="${c}">${O.encodeHtml(S)}</span>${x}`),v=l.lastIndex}p.push(O.encodeHtml(m.substring(v)),"<span>"),f.parentNode.insertBefore(w.createElementFromTemplate(p.join(""),{fragment:!0}),f),f.remove()}d&&w.createElement({parent:e,className:a.hitCellBadgeCls,text:u})}a.hitEls.push(e)}}populateCellMenu({column:e,record:r,items:t,cellElement:i}){const n=this;e.searchable&&(t.search={text:"L{searchForValue}",localeClass:n,icon:"b-fw-icon b-icon-search",cls:"b-separator",weight:200,disabled:n.disabled,onItem:()=>{let s=globalThis.getSelection().toString();s||(s=i.innerText),n.search(s)}})}onStoreRefresh(){this.search(this.text,!1,!0)}};E(xa,"$name","Search"),E(xa,"configurable",{limit:1e3,showHitIndex:!0,keyMap:{F3:"gotoNextHit","Ctrl+g":"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+Shift+g":"gotoPrevHit"}}),xa.featureClass="b-search",xa._$name="Search",j.registerFeature(xa);var Ra=class extends Q{static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,r){r=this.processConfig(r),this.grid=e,this.bindStore(this.store),super.construct(e,r)}processConfig(e){return typeof e=="string"||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}bindStore(e){var r;this.detachListeners("store"),e.ion({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this}),(r=this.client)!=null&&r.isPainted&&this.syncHeaderSortState()}set field(e){var r;const t=this.grid.columns.get(e);t&&typeof t.sortable=="object"&&(t.sortable.field=t.sortable.property||e,e=t.sortable),(r=this.store.sorters)!=null&&r.some(i=>i.field===e)||this.store.sort(e,this.ascending)}get store(){return this.grid[this.grid.sortFeatureStore]}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onPaint","bindStore"]}}syncHeaderSortState(){var e;const r=this,{grid:t}=r;if(!t.hideHeaders&&t.isPainted){const i=r.store.sorters,n=i.length,s=new J;let a;for(const o of t.columns.visibleColumns){if(!o.sortable)continue;const l=o.element,c=o.textWrapper,d=c==null?void 0:c.dataset;let u="none";d!=null&&d.sortIndex&&delete d.sortIndex,s.value=l.classList,o.sortable===!1?(s.remove(r.sortableCls),(e=c==null?void 0:c.querySelector(".b-sort-icon"))==null||e.remove()):(c!=null&&c.querySelector(".b-sort-icon")||w.createElement({parent:c,className:"b-sort-icon"}),s.add(r.sortableCls),a=i.find(h=>h.field===o.field||h.sortFn&&h.sortFn===o.sortable.sortFn),a?(n>1&&d&&(d.sortIndex=i.indexOf(a)+1),s.add(r.sortedCls),a.ascending?(s.add(r.sortedAscCls),s.remove(r.sortedDescCls),u="ascending"):(s.add(r.sortedDescCls),s.remove(r.sortedAscCls),u="descending")):(s.remove(r.sortedCls),s["b-group"]||(s.remove(r.sortedAscCls),s.remove(r.sortedDescCls)))),w.syncClassList(l,s),w.setAttributes(l,{"aria-sort":u})}}}populateHeaderMenu({column:e,items:r}){const t=this,{store:i}=t,n={...e.sortable,field:e.field,columnOwned:!0};if(e.sortable!==!1&&(r.sortAsc={text:"L{sortAscending}",localeClass:t,icon:"b-fw-icon b-icon-sort-asc",cls:"b-separator",weight:300,disabled:t.disabled,onItem:()=>i.sort(n,!0)},r.sortDesc={text:"L{sortDescending}",localeClass:t,icon:"b-fw-icon b-icon-sort-desc",weight:310,disabled:t.disabled,onItem:()=>i.sort(n,!1)},t.multiSort&&t.grid.columns.records.some(s=>s.sortable))){const s=i.sorters.find(a=>a.field===e.field||e.sortable.sortFn&&e.sortable.sortFn===a.sortFn);r.multiSort={text:"L{multiSort}",localeClass:t,icon:"b-fw-icon b-icon-sort",weight:320,disabled:t.disabled,menu:{addSortAsc:{text:s?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:t,icon:"b-fw-icon b-icon-sort-asc",disabled:s&&(s==null?void 0:s.ascending),weight:330,onItem:()=>i.addSorter(n,!0)},addSortDesc:{text:s?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:t,icon:"b-fw-icon b-icon-sort-desc",disabled:s&&!s.ascending,weight:340,onItem:()=>i.addSorter(n,!1)},removeSorter:{text:"L{removeSorter}",localeClass:t,icon:"b-fw-icon b-icon-remove",weight:350,disabled:!s,onItem:()=>{i.removeSorter(n.field)}}}}}}getColumnDragToolbarItems(e,r){const t=this,{store:i,disabled:n}=t;if(e.sortable!==!1){const s=i.sorters.find(a=>a.field===e.field);r.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:t,icon:"b-icon b-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:n,onDrop:({column:a})=>i.sort(a.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:t,icon:"b-icon b-icon-sort-desc",ref:"sortDesc",weight:105,disabled:n,onDrop:({column:a})=>i.sort(a.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:t,icon:"b-icon b-icon-sort-asc",ref:"multisortAddAsc",disabled:n||s&&s.ascending,weight:105,onDrop:({column:a})=>i.addSorter(a.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:t,icon:"b-icon b-icon-sort-desc",ref:"multisortAddDesc",disabled:n||s&&!s.ascending,weight:105,onDrop:({column:a})=>i.addSorter(a.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:t,icon:"b-icon b-icon-remove",ref:"multisortRemove",weight:105,disabled:n||!s,onDrop:({column:a})=>i.removeSorter(a.field)})}return r}onStoreBeforeSort({sorters:e}){var r;const{columns:t}=this.client;for(let i=0;i<e.length;i++){const n=e[i],s=(n.columnOwned||this.prioritizeColumns)&&t.get(n.field);(r=s==null?void 0:s.sortable)!=null&&r.sortFn&&(e[i]={...n,...s.sortable,columnOwned:!0})}}onElementClick(e){const r=this,{store:t}=r,{target:i}=e,n=i.closest(".b-grid-header.b-sortable"),s=n==null?void 0:n.dataset.column;if(!(r.ignoreRe.test(i.className)||r.disabled||e.handled)&&n&&s&&(r.toggleOnHeaderClick||i.closest(".b-sort-icon"))){const a=r.grid.columns.getById(n.dataset.columnId);if(t.isGrouped&&t.groupers.find(l=>l.field===s)&&!e.shiftKey)return;if(a.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)t.removeSorter(a.field);else{const l={columnOwned:!0,field:a.field};typeof a.sortable=="object"&&T.assign(l,a.sortable),t.sort(l,null,e.ctrlKey)}}}renderHeader(){this.syncHeaderSortState()}onPaint(){this.syncHeaderSortState()}};E(Ra,"$name","Sort"),E(Ra,"configurable",{multiSort:!0,prioritizeColumns:!1,toggleOnHeaderClick:!0}),Ra.featureClass="b-sort",Ra._$name="Sort",j.registerFeature(Ra,!0);var hp=class extends Q{static get $name(){return"StickyCells"}static get defaultConfig(){return{contentSelector:null,currentTopRowCls:"b-sticky-cells-current-top-row"}}static get pluginConfig(){return{before:["renderRows"]}}construct(e,r){super.construct(e,r),e.ion({scroll:"onGridScroll",thisObj:this}),Object.assign(this,w.createElement({reference:"element",parent:e.element,className:"b-grid-sticky-row",children:[{reference:"contentElement",className:"b-grid-cell"}]})),this.removeClasses={"b-focused":!1,"b-hover":!1,"b-selected":!1,[this.currentTopRowCls]:!1}}renderRows(){this.element.classList.add("b-hide-visibility")}onGridScroll(){const e=this,{client:r,element:t,contentElement:i}=e,n=k.client(r.bodyContainer).roundPx(),s=r.rowManager.getRowAt(n.y),a=s!==e.currentTopRow;if(s){a&&(e.currentTopRow&&(e.currentTopRow.removeCls(e.currentTopRowCls),e.currentTopRow.removeCls("b-not-enough-height")),e.currentTopRow=s,s.addCls(e.currentTopRowCls),i.innerHTML="",i.appendChild(e.updateStickyContent()));const o=e.currentTopRow.bottom-e.client.scrollable.y<=e.stickyContentHeight;e.element.classList[o?"add":"remove"]("b-hide-visibility"),e.currentTopRow[o?"addCls":"removeCls"]("b-not-enough-height"),n.y+=e.stickyContentTop,w.alignTo(t,e.stickyEls[0],{align:"t0-t0",constrainTo:n},!0)}e.lastProcessedTopRow=s}updateStickyContent(){const e=this,{currentTopRow:r,removeClasses:t}=e,i={"b-grid-sticky-row":1},n={},s=e.stickyContent||(e.stickyContent=document.createDocumentFragment()),a=e.stickyEls||(e.stickyEls=[]);for(a.forEach(o=>{o.classList.remove("b-sticky-content-el")}),a.length=0,r.eachElement(o=>{a.push(...o.querySelectorAll(e.contentSelector))});s.firstChild;)s.remove(s.firstChild);return e.stickyContentHeight=0,e.stickyContentTop=0,a.map(o=>{o.closest(".b-grid-cell").classList.forEach(d=>n[d]=1),o.closest(".b-grid-row").classList.forEach(d=>i[d]=1),Object.assign(n,t),Object.assign(i,t);const l=o.offsetTop;e.stickyContentTop=Math.max(e.stickyContentTop,l),o.style.alignSelf="flex-end",e.stickyContentHeight=Math.max(e.stickyContentHeight,e.currentTopRow.height-o.offsetTop+l),o.style.alignSelf="";const c=o.cloneNode(!0);return o.classList.add("b-sticky-content-el"),s.appendChild(c),c}),n["b-focused"]=!1,w.syncClassList(e.contentElement,n),w.syncClassList(e.element,i),s}};hp._$name="StickyCells",j.registerFeature(hp,!1);var gp=class extends Q{static get $name(){return"Stripe"}construct(e,r){super.construct(e,r),e.ion({renderrow:"onRenderRow",thisObj:this})}doDisable(e){this.isConfiguring||this.client.refreshRows(),super.doDisable(e)}onRenderRow({row:e}){const{disabled:r}=this,t=e.dataIndex%2===0;e.assignCls({"b-even":!r&&t,"b-odd":!r&&!t})}};gp._$name="Stripe",j.registerFeature(gp);var Yl=Object.freeze({animate:!1,block:"start"}),zE=Object.freeze({animate:!1,block:"end"}),fp=7,WE={split:1,unsplit:1},Qn,Gi=class extends Q{constructor(){super(...arguments),NC(this,Qn,!1),E(this,"restorers",[])}doDestroy(){this.unsplit(!0),super.doDestroy()}doDisable(e){const r=this;r.isConfiguring||(e?(r._disabledSplitOptions=r._splitOptions,r.unsplit()):r._disabledSplitOptions&&(r.split(r._disabledSplitOptions),r._disabledSplitOptions=null))}get isSplit(){var e;return!!((e=this.widgets)!=null&&e.length)}getClientConfig(e,r,t,i={}){const{client:n}=this,{subGrids:s,regions:a}=n,o=n.columns.records.slice(),l=T.assign({},n.subGridConfigs);if(n.eachSubGrid(u=>{const h=l[u.region];u.flex?h.flex=u.flex:h.width=u.element.style.width}),t.atColumn&&a.length>1&&r>0){const u=a.indexOf(t.atColumn.region);for(let h=0;h<u;h++){const g=s[a[h]];H.remove(o,...g.columns.records),delete l[a[h]]}}const c=T.assign({},n.initialConfig,{appendTo:e,insertFirst:null,insertBefore:null,splitFrom:n,owner:n.owner,tbar:n.initialConfig.tbar&&r===1?{height:n.tbar.height,items:[" "]}:null,store:n.store,selectedRecordCollection:n.selectedRecordCollection,subGridConfigs:l,columns:this.cloneColumns(o),minHeight:0,minWidth:0},i),d={};for(const u in n.listeners)if(!WE[u]){const[h]=n.listeners[u];h.$internal||(d[u]=h)}return c.listeners=d,(t.direction==="horizontal"||t.direction==="both"&&r!==1)&&(c.hideHeaders=!0),delete c.data,c}cloneColumns(e){return e.flatMap(r=>{if(r.meta.isSelectionColumn||r.field==="expanderActionColumn")return[];const t={...r.data};return r.children&&(t.children=r.children.map(i=>({...i.data}))),delete t.headerRenderer,delete t.parentId,t})}cloneClient(e,r,t,i){const n=this.getClientConfig(e,r,t,i),s=new this.client.constructor(n);return s.element.classList.add("b-split-clone"),s}processOptions(e){var r;const{client:t}=this,{atRecord:i,atColumn:n,direction:s}=e;if(!s)i&&n?e.direction="both":n?e.direction="vertical":e.direction="horizontal";else{if(s!=="vertical"&&!i&&t.store.count){const a=t._bodyRectangle.height/2+t.scrollable.y,o=(r=t.rowManager.getRowAt(a,!0))!=null?r:t.rowManager.rows[Math.ceil(t.rowManager.rows.length/2)];e.atRecord=t.store.getById(o.id)}if(s!=="horizontal"&&!n){const a=k.from(t.element);let o=a.center.x-a.x,l=t.subGrids[t.regions[0]],c=0,d=null;for(;o>l.width;)o-=l.width,l=t.subGrids[t.regions[++c]];o+=l.scrollable.x;const{visibleColumns:u}=l.columns;let h=0,g=0;for(;h<o&&g<u.length;)d=u[g++],h+=d.element.offsetWidth;e.atColumn=d}}return e}createSplitContainer({direction:e}){const{client:r}=this,{element:t}=r;return this.splitContainer=w.createElement({parent:t.parentElement,className:{"b-split-container":1,[`b-split-${e}`]:1,"b-rtl":r.rtl},style:{width:t.style.width,height:t.style.height},children:[e!=="both"&&t,e==="both"&&{className:"b-split-top",children:[t]},e==="both"&&{className:"b-split-bottom"}]})}syncHeaderHeights(){let e=0;for(const r of this.subViews)r.eachSubGrid(t=>{t.header.height>e&&(e=t.header.height)});for(const r of this.subViews)r.eachSubGrid(t=>{t.header.height=e})}toggleOriginalSubGrids(e){const r=this,{client:t}=r,{regions:i}=t;if(e.atColumn&&i.length>1){const n=i.indexOf(e.atColumn.region),s=[t];e.direction==="both"&&s.push(r.subViews[2]);for(const a of s)if(n+1<i.length){const o=a===t,l=a.subGrids[i[n]];l.hideSplitter(),o&&r.restorers.push(()=>l.showSplitter()),l.flex||(t.inForEachOther=!0,l.flex=1,t.inForEachOther=!1,o&&r.restorers.push(()=>{l.flex=null,l.width=l._initialWidth}));for(let c=n+1;c<i.length;c++){const d=a.subGrids[i[c]];d.hide(),o&&r.restorers.push(()=>{d.show()})}i.length===2&&(a._initialWidth=a.element.style.width,a._initialFlex=a.flex,a.width=l._initialWidth,o&&r.restorers.push(()=>{a._initialFlex!==null?a.flex=a._initialFlex:a._initialWidth!==null&&(a.width=a._initialWidth)}))}}}async split(e={}){const r=this,{client:t}=r;if(t.splitFrom)return;r.isSplit&&await r.unsplit(!0);const{rtl:i}=t,{atRecord:n,atColumn:s,direction:a}=r.processOptions(e);let{splitX:o,remainingWidth:l}=e,c=null,d=null;if(n){await t.scrollRowIntoView(n);const v=t.getRowFor(n);if(!v)throw new Error(`Could not find row for record ${n.id}`);c=k.from(v.cells[0],t.element).bottom,d=k.from(t.element).height-c}if(s&&!o&&(o=k.from(s.element,t.element).getEnd(i),l=k.from(t.element).width-o-w.scrollBarWidth,i)){const v=o;o=l+w.scrollBarWidth,l=v-w.scrollBarWidth}const u=[],h=r.createSplitContainer(e),{visibleColumns:g}=t.columns,f=s?g[g.indexOf(s)+1]:null,m=n?t.store.getNext(n):null;if(t.eachSubGrid(v=>v._initialWidth=v.width),a!=="both"){const v={flex:`0 0 ${(c!=null?d:l)-fp}px`,height:null},[,y]=r.widgets=[new Un({appendTo:h}),r.cloneClient(h,a==="vertical"?1:0,e,v)];o!=null&&(t.renderRows(),e.atDate||(u.push(t.scrollColumnIntoView(s,zE)),f&&u.push(y.scrollColumnIntoView(f,Yl)))),c!=null&&u.push(y.scrollRowIntoView(m,Yl)),t.element.classList.add("b-split-start"),y.element.classList.add("b-split-end"),t.scrollable.addPartner(y.scrollable,{x:a==="horizontal",y:a!=="horizontal"})}else{const v={flex:`0 0 ${l-fp}px`};h.lastElementChild.style.flex=`0 0 ${d-fp}px`,r.widgets=[new Un({insertBefore:h.lastElementChild}),r.topSplitter=new Un({appendTo:h.firstElementChild}),r.cloneClient(h.firstElementChild,1,e,v),r.cloneClient(h.lastElementChild,0,e),r.bottomSplitter=new Un({appendTo:h.lastElementChild}),r.cloneClient(h.lastElementChild,2,e,v)];const y=t,C=r.widgets[2],D=r.widgets[3],S=r.widgets[5];y.element.classList.add("b-split-top-start"),C.element.classList.add("b-split-top-end"),D.element.classList.add("b-split-bottom-start"),S.element.classList.add("b-split-bottom-end"),o!=null&&(y.renderRows(),D.renderRows(),s&&!e.atDate&&(u.push(t.scrollColumnIntoView(s,zE)),f&&u.push(C.scrollColumnIntoView(f,Yl)))),c!=null&&u.push(D.scrollRowIntoView(m,Yl),S.scrollRowIntoView(m,Yl)),y.scrollable.addPartner(C.scrollable,"y"),y.scrollable.addPartner(D.scrollable,"x"),C.scrollable.addPartner(S.scrollable,"x"),D.scrollable.addPartner(S.scrollable,"y"),r.topSplitter.ion({splitterMouseDown:"onSplitterMouseDown",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:r}),r.bottomSplitter.ion({splitterMouseDown:"onSplitterMouseDown",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:r})}r.subViews=[t,...r.widgets.filter(v=>v.isGridBase)],r.toggleOriginalSubGrids(e),r.syncHeaderHeights(),r._splitOptions=e,await Promise.all(u);const p=k.from(t.element);return t.onInternalResize(t.element,p.width,p.height),t.eachSubGrid(v=>{const y=k.from(v.element);v.onInternalResize(v.element,y.width,y.height)}),t.scrollable.x+=.5,t.scrollable.y+=.5,r.startSyncingColumns(),t.trigger("split",{subViews:r.subViews,options:e}),r.subViews}async unsplit(e=!1){var r;const t=this,{client:i}=t,{element:n}=i;if(t.isSplit&&(t.stopSyncingColumns(),(r=t.widgets)==null||r.forEach(s=>s.destroy()),t.widgets=null,i.eachSubGrid(s=>s.scrollable.x),i.scrollable.y,t.splitContainer.parentElement.appendChild(n),t.splitContainer.remove(),t.splitContainer=null,n.style.flexBasis=n.style.flexGrow="",n.classList.remove("b-split-top-start","b-split-start"),t.subViews.length=0,!t.isDestroying)){i.renderRows(),t.unsplitCleanup();for(const s of t.restorers)s();if(t.restorers.length=0,await bn.animationFrame(),await bn.animationFrame(),t.isDestroyed)return;!e&&i.trigger("unsplit"),t._splitOptions=null}}unsplitCleanup(){}populateCellMenu({record:e,column:r,items:t}){const i=this,{isSplit:n}=i,{splitFrom:s}=i.client;i.disabled||(t.splitGrid={text:"L{split}",localeClass:i,icon:"b-icon b-icon-split-vertical",weight:500,separator:!0,hidden:n||s,menu:{splitHorizontally:{text:"L{horizontally}",icon:"b-icon b-icon-split-horizontal",localeClass:i,weight:100,onItem(){i.split({atRecord:e})}},splitVertically:{text:"L{vertically}",icon:"b-icon b-icon-split-vertical",localeClass:i,weight:200,onItem(){i.split({atColumn:r})}},splitBoth:{text:"L{both}",icon:"b-icon b-icon-split-both",localeClass:i,weight:300,onItem(){i.split({atColumn:r,atRecord:e})}}}},t.unsplitGrid={text:"L{unsplit}",localeClass:i,icon:"b-icon b-icon-clear",hidden:!(n||s),weight:400,separator:!0,onItem(){(s||i).unsplit()}})}startSyncingColumns(){for(const e of this.subViews)e.columns.ion({name:"columns",change:"onColumnsChange",thisObj:this})}stopSyncingColumns(){this.detachListeners("columns")}onColumnsChange({source:e,isMove:r,action:t,parent:i,records:n,changes:s}){var a,o;const l=this;if(!VC(l,Qn)){Ks(l,Qn,!0);for(const c of l.subViews){const{columns:d}=c;if(e!==d){if(t==="update"&&s.region&&Object.keys(s).length===1){if(d.getById(n[0].id))d.remove(n[0].id);else{const[u]=n,h=(a=d.getById(l.$before.parent.id))!=null?a:d.rootNode,g=l.$before.id!==null&&d.getById(l.$before.id);h.insertChild(u.data,g)}l.$before=null}else if(r!=null&&r[n[0].id]){if(t==="add"){const u=n[0],h=u.nextSibling,g=d.getById(u.id);if(!g){l.$before={id:h==null?void 0:h.id,parent:i},Ks(l,Qn,!1);return}if(u.meta.isSelectionColumn){Ks(l,Qn,!1);return}const f=(o=d.getById(i.id))!=null?o:d.rootNode,m=h&&d.getById(h.id);f.insertChild(g,m)}}else if(t==="add"){const u=n.filter(h=>c.getSubGridFromColumn(h));d.add(l.cloneColumns(u))}else d.applyChangesFromStore(e);d.commit()}}e.commit(),Ks(l,Qn,!1)}}getOtherSplitter(e){return e===this.topSplitter?this.bottomSplitter:this.topSplitter}onSplitterMouseDown({source:e,event:r}){r.handled||(r.handled=!0,this.getOtherSplitter(e).onMouseDown(r))}onSplitterDrag({source:e,event:r}){r.handled||(r.handled=!0,this.getOtherSplitter(e).onMouseMove(r))}onSplitterDrop({source:e,event:r}){r.handled||(r.handled=!0,this.getOtherSplitter(e).onMouseUp(r))}afterConfigChange({name:e,value:r}){this.isSplit&&this.relayProperties[e]&&this.syncSplits(t=>{t[e]=r})}afterAddListener(e,r){this.isSplit&&!r.$internal&&!WE[e]&&this.syncSplits(t=>t.on(e,r))}afterRemoveListener(e,r){r.$internal||this.syncSplits(t=>t.un(e,r))}forEachOther(e){const r=this.client.splitFrom||this.client;if(r.features.split.enabled&&!r.inForEachOther){r.inForEachOther=!0;for(const t of r.subViews)t!==this.client&&e(t);r.inForEachOther=!1}}syncSplits(e){this.forEachOther(e)}};Qn=new WeakMap,E(Gi,"$name","Split"),E(Gi,"featureClass",""),E(Gi,"configurable",{subViews:[],relayProperties:{value:{readOnly:1,rowHeight:1},$config:{merge:"merge"}}}),E(Gi,"pluginConfig",{chain:["populateCellMenu","afterConfigChange","afterAddListener","afterRemoveListener"],assign:["split","unsplit","subViews","syncSplits"]}),Gi._$name="Split",j.registerFeature(Gi,!1);var ql=class extends NE(Q){static get configurable(){return{selectedOnly:null,hideFooters:!1}}static get pluginConfig(){return{chain:["renderRows","bindStore"]}}static get $name(){return"Summary"}construct(e,r){this.grid=e,super.construct(e,r),this.bindStore(e.store),e.hideFooters=this.hideFooters}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",thisObj:this})}get store(){return this.grid.store}doDestroy(){super.doDestroy()}doDisable(e){super.doDisable(e);const{client:r}=this;e?r.element.classList.add("b-summary-disabled"):(this.updateSummaries(),r.element.classList.remove("b-summary-disabled"),r.eachSubGrid(t=>t.scrollable.syncPartners()))}renderRows(){this.updateSummaries()}updateSummaries(){const e=this,{grid:r,store:t}=e,i=w.children(r.element,".b-grid-footer"),n=e.selectedOnly&&r.selectedRecords.length>0,s=(t.isFiltered?t.storage.values:t.allRecords).filter(a=>!a.isSpecialRow&&(!n||r.isSelected(a)));r.columns.forEach(a=>{var o;(o=a.summaries)==null||o.forEach(l=>{"seed"in l&&("initialSeed"in l||(l.initialSeed=l.seed),["number","string","date"].includes(typeof l.initialSeed)?l.seed=l.initialSeed:l.seed=Object.assign({},l.initialSeed))})}),i.forEach(a=>{if(!a.dataset.column)return;const o=r.columns.get(a.dataset.column),l=e.generateHtml(o,s,"b-grid-footer-summary");(o.summaries?o.summaries.length:o.sum)&&(a.children.length?w.sync(l,a.firstElementChild):a.innerHTML=l)})}onStoreChange({action:e,changes:r}){let t=!0;this.disabled||(e==="update"&&(t=Object.keys(r).some(i=>{const n=this.grid.columns.get(i);return!!n&&(!!n.sum||!!n.summaries)})),t&&this.updateSummaries())}updateSelectedOnly(e){const r=this;r.detachListeners("selectionChange"),e&&r.grid.ion({name:"selectionChange",selectionChange:r.refresh,thisObj:r}),r.refresh()}refresh(){this.updateSummaries()}};ql.featureClass="b-summary",ql._$name="Summary",j.registerFeature(ql);var kk=Promise.resolve(),Ui=class extends Q.mixin(fe){static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],chain:["onElementPointerUp","onElementClick","bindStore"]}}construct(e,r){super.construct(e,r),this.treeColumn||console.info("To use the tree feature, one column should be configured with `type: 'tree'`"),e.store&&this.bindStore(e.store)}doDisable(e){if(e)throw new Error("Tree feature cannot be disabled")}get store(){return this.client.store}get treeColumn(){const e=this,{columns:r}=e.client;return(!e._treeColumn||!r.includes(e._treeColumn))&&(e._treeColumn=r.find(t=>t.isTreeColumn)),e._treeColumn}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",thisObj:this})}async toggleCollapse(e,r){if(e==null)throw new Error("Tree#toggleCollapse must be passed a record");const t=this,{store:i,client:n}=t,{rowManager:s}=n,a=i.getById(e),o=a.instanceMeta(i);if(a.generation++,await i.toggleCollapse(a,r)){const l=s.getRowFor(a);if(l&&a.ancestorsExpanded()){const c=t.treeColumn&&!t.treeColumn.subGrid.collapsed&&l.getCell(t.treeColumn.id);c&&l.renderCell(c)}t.isTogglingNode||(n.element.classList.add("b-toggling-node"),t.isTogglingNode=!0,t.requestAnimationFrame(()=>{n.element.classList.remove("b-toggling-node"),t.isTogglingNode=!1})),n.trigger(o.collapsed?"collapseNode":"expandNode",{record:a}),n.trigger("toggleNode",{record:a,collapse:o.collapsed})}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}onBeforeToggleNode({record:e,collapse:r}){this.client.trigger("beforeToggleNode",{record:e,collapse:r})}onBeforeLoadChildren({source:e,params:r}){const t=e.getById(r[e.modelClass.idField]),i=this.client.rowManager.getRowFor(t);i==null||i.addCls("b-loading-children")}onLoadChildren({source:e,params:r}){const t=e.getById(r[e.modelClass.idField]),i=this.client.rowManager.getRowFor(t);i==null||i.removeCls("b-loading-children")}onLoadChildrenException({record:e}){const r=this.client.rowManager.getRowFor(e);r==null||r.removeCls("b-loading-children")}async expandOrCollapseAll(e=!0,r=this.store.rootNode){const{client:t,store:i}=this,n=[],s=[];return t.trigger("beforeToggleAllNodes",{collapse:e}),i.suspendEvents(),i.traverse(a=>{const o=a.instanceMeta(i);a.isLeaf||(e&&!o.collapsed?(this.toggleCollapse(a,!0),s.push(...a.children)):!e&&o.collapsed&&(Array.isArray(a.children)&&s.push(...a.children),n.push(this.toggleCollapse(a,!1))))},r,r===i.rootNode),i.resumeEvents(),(e?kk:Promise.all(n)).then(()=>{t.refreshRows(e),s.length&&(e?i.trigger("remove",{records:s,isCollapse:!0,isCollapseAll:!0}):i.trigger("add",{records:s,isExpand:!0,isExpandAll:!0})),t.trigger("toggleAllNodes",{collapse:e})})}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e,r=!0){var t,i,n,s;const a=this,{store:o,client:l}=a;if(Array.isArray(e)){if(e.length>0){l.suspendRefresh();for(let d=e.length-1;d>=0;d--){const u=o.getById(e[d]);d===0&&((t=l.resumeRefresh)==null||t.call(l),l.rowManager.refresh()),await((i=a.expandTo)==null?void 0:i.call(a,u,d===0))}}return}const c=o.getById(e);if(c.instanceMeta(a.store).hiddenByCollapse!==!1){if(!c.ancestorsExpanded()){const d=[];for(let u=c.parent;u&&!u.isRoot;u=u.parent)u.isExpanded(o)||d.unshift(u);l.suspendRefresh();for(const u of d)a.isDestroyed||await a.toggleCollapse(u,!1);(n=l.resumeRefresh)==null||n.call(l),(s=l.refreshRows)==null||s.call(l)}!a.isDestroyed&&r&&await l.scrollRowIntoView(c)}}onElementPointerUp(e){const r=this,t=e.target,i=r.client.getCellDataFromEvent(e);(t.closest(".b-tree-expander")||r.expandOnCellClick&&(i!=null&&i.record.isParent))&&r.toggleCollapse(i.record)}onElementClick(e){e.target.closest(".b-tree-expander")&&e.preventDefault()}toggleCollapseByKey(){const{focusedCell:e}=this.client;return(e==null?void 0:e.rowIndex)>-1&&!e.isActionable?(this.toggleCollapse(e.id),!0):!1}expandIfSingleColumn(){return this.client.columns.count===1?this.expandByKey():!1}expandByKey(){const e=this,{client:r}=e,{focusedCell:t}=r,i=t==null?void 0:t.record;return i&&(t!=null&&t.column.tree)&&i.isParent&&i.instanceMeta(r.store).collapsed?(e.expand(i),!0):!1}collapseIfSingleColumn(){return this.client.columns.count===1?this.collapseByKey():!1}collapseByKey(){const e=this,{client:r}=e,{focusedCell:t}=r,i=t==null?void 0:t.record;if(t!=null&&t.column.tree&&i){if(i.isParent&&!i.instanceMeta(r.store).collapsed)return e.collapse(i),!0;if(i.parent&&!i.parent.isRoot)return r.deselectAll(),r.focusCell({record:i.parent,column:t.column}),!0}return!1}};E(Ui,"$name","Tree"),E(Ui,"configurable",{expandOnCellClick:!1,keyMap:{" ":"toggleCollapseByKey",ArrowRight:"expandIfSingleColumn","Shift+ArrowRight":"expandByKey",ArrowLeft:"collapseIfSingleColumn","Shift+ArrowLeft":"collapseByKey"}}),Ui.featureClass="b-tree",Ui._$name="Tree",j.registerFeature(Ui,!1,"Grid"),j.registerFeature(Ui,!0,"TreeGrid");var Yi=class extends Q{construct(e,r){if(this.treeColumn=e.columns.find(t=>t.isTreeColumn),super.construct(e,r),this._levels=this._levels||[],!e.hasFeature("tree"))throw new Error("The TreeGroup feature requires the Tree feature to be enabled")}applyPluginConfig(){return this.scheduleRefreshGroups=Te.createBuffered(this.refreshGroups,this.refreshGroupsTimeout,this),super.applyPluginConfig(...arguments)}processParentData(e){const r=this;r.parentCls&&(e.cls=r.parentCls)}processTransformedData(e){}async waitForReadiness(){var e;const r=this;if(r.originalStore.isLoading&&(await r.originalStore.await("load",!1),r.isDestroyed))return;const{crudManager:t}=this.client;if(t){if((t.isLoadingOrSyncing||t._autoLoadPromise)&&await t.await("requestDone"),r.isDestroyed)return;await((e=r.client.project)==null?void 0:e.commitAsync())}}async applyLevels(e){var r;const t=this,{client:i,treeColumn:n}=t;let{store:s}=i,a=null,o;const{modelClass:l}=s;n!=null&&n.field&&l.getFieldDefinition(n.field)&&(o=l.getFieldDataSource(n.field)),e=e||[],!(e.length===0&&this.isConfiguring)&&(t._levels=e,t.isApplying++,i.suspendRefresh(),t.originalStore||(t.originalStore=s,s=new s.constructor({reapplyFilterOnAdd:!0,reapplyFilterOnUpdate:!0,tree:!0,modelClass:s.modelClass,load:(r=s.load)==null?void 0:r.bind(s),commit:s.commit.bind(s),filter:s.filter.bind(s),clearFilters:s.clearFilters.bind(s)}),i.store=s,t.originalStore.ion({name:"originalStore",refresh:t.onOriginalStoreRefresh,add:t.onOriginalStoreChanged,remove:t.onOriginalStoreChanged,removeAll:t.onOriginalStoreChanged,thisObj:t})),await t.waitForReadiness(),!t.isDestroyed&&(e.length>0?(s.data=t.originalStore.getAllDataRecords(!1).flatMap(c=>c.isLeaf?c.link():[]),a=s.treeify(e,c=>{o&&T.setPath(c,o,c.key),t.processParentData(c)}),t.processTransformedData(a),await t.trigger("beforeDataLoad",{store:s,data:a.children}),s.data=a.children):(i.store=t.originalStore,t.detachListeners("originalStore"),t.originalStore=null),t.isApplying--,i.resumeRefresh(),i.isPainted&&i.renderRows(!1),i.trigger("treeGroupChange",{levels:e})))}doDisable(e){e&&this.clearGroups(),super.doDisable(e)}onOriginalStoreChanged(){this.scheduleRefreshGroups()}onOriginalStoreRefresh({action:e}){(e==="dataset"||e==="filter")&&this.scheduleRefreshGroups()}updateLevels(e,r){const t=this,{client:i}=t;t.hideGroupedColumns&&(r==null||r.forEach(n=>{n=n.fieldName||n,e.some(s=>(s.fieldName||s)===n)||i.columns.get(n).show()}),e==null||e.forEach(n=>{n=n.fieldName||n,(!r||!r.some(s=>s.fieldName===n))&&(i._suspendRenderContentsOnColumnsChanged=!0,i.columns.get(n).hide(),i._suspendRenderContentsOnColumnsChanged=!1)})),(e||!t.isConfiguring)&&(t.updatePromise=t.applyLevels(e),i.renderContents())}async group(e){T.assertArray(e,"group()"),await this.applyLevels(e)}async clearGroups(){this.isGrouped&&(this.levels=[],await this.updatePromise)}refreshGroups(){var e;return(e=this.applyLevels)==null?void 0:e.call(this,this._levels)}get isGrouped(){return this._levels.length>0}populateHeaderMenu({column:e,items:r}){const t=this,i=e.groupable!==!1&&!e.isTreeColumn;let n=!1;i&&!t.isGroupedByField(e.field)&&(r.groupAsc={text:"L{group}",localeClass:t,icon:"b-fw-icon b-icon-group-asc",separator:!0,weight:400,disabled:t.disabled,onItem:()=>t.addGrouper(e)},n=!0),t.isGrouped&&(t.isGroupedByField(e.field)&&(r.groupRemove={text:"L{stopGroupingThisColumn}",localeClass:t,icon:"b-fw-icon b-icon-clear",separator:!n,weight:420,disabled:t.disabled,onItem:()=>t.removeGrouper(e)},n=!0),r.groupRemoveAll={text:"L{stopGrouping}",localeClass:t,icon:"b-fw-icon b-icon-clear",separator:!n,weight:420,disabled:t.disabled,onItem:()=>t.clearGroups()})}addGrouper(e){this.levels=this.levels.concat(e.field)}isGroupedByField(e){return this.levels.find(r=>r.fieldName===e)}removeGrouper(e){this.levels.splice(this.levels.findIndex(r=>r.fieldName===e.field),1),this.levels=this.levels.slice()}};E(Yi,"$name","TreeGroup"),E(Yi,"configurable",{levels:[],parentCls:"b-generated-parent",parentRenderer:null,hideGroupedColumns:null,refreshGroupsTimeout:100}),E(Yi,"pluginConfig",{chain:["populateHeaderMenu"],assign:["group","clearGroups","refreshGroups"]}),E(Yi,"properties",{isApplying:0,originalStore:null}),Yi._$name="TreeGroup",j.registerFeature(Yi);var Et={all:"all",visible:"visible"},Kl={A6:{width:4.11,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69},A3:{width:11.69,height:16.49},Legal:{width:8.5,height:14},Letter:{width:8.5,height:11}},Ta={portrait:"portrait",landscape:"landscape"},Eu={pdf:"pdf",png:"png"},Fk={pdf:"application/pdf",png:"image/png"},mp=class extends Fe{static get $name(){return"ExportRowsCombo"}static get type(){return"exportrowscombo"}static get defaultConfig(){return{editable:!1}}buildItems(){const e=this;return[{id:Et.all,text:e.L("L{all}")},{id:Et.visible,text:e.L("L{visible}")}]}};mp.initClass(),mp._$name="ExportRowsCombo";var pp=class extends Fe{static get $name(){return"ExportOrientationCombo"}static get type(){return"exportorientationcombo"}static get defaultConfig(){return{editable:!1}}buildItems(){const e=this;return[{id:Ta.portrait,text:e.L("L{portrait}")},{id:Ta.landscape,text:e.L("L{landscape}")}]}};pp.initClass(),pp._$name="ExportOrientationCombo";function GE(e,r=t=>t){return Object.keys(e).map(t=>({id:t,text:r(t)}))}var Xl=class extends ht{static get $name(){return"ExportDialog"}static get type(){return"exportdialog"}static get configurable(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,autoSelectVisibleColumns:!0,hidePNGMultipageOption:!0,title:"L{exportSettings}",maxHeight:"80%",scrollable:{overflowY:!0},defaults:{localeClass:this},items:{columnsField:{type:"combo",label:"L{ExportDialog.columns}",store:{},valueField:"id",displayField:"text",multiSelect:!0,weight:100,maxHeight:100},rowsRangeField:{type:"exportrowscombo",label:"L{ExportDialog.rows}",value:"all",weight:200},exporterTypeField:{type:"combo",label:"L{ExportDialog.exporterType}",editable:!1,value:"singlepage",displayField:"text",buildItems(){const e=this.parent;return e.exporters.map(r=>({id:r.type,text:e.optionalL(r.title,this)}))},onChange({value:e}){this.owner.widgetMap.alignRowsField.hidden=e==="singlepage",this.owner.widgetMap.repeatHeaderField.hidden=e!=="multipagevertical"},weight:300},alignRowsField:{type:"checkbox",label:"L{ExportDialog.alignRows}",checked:!1,hidden:!0,weight:400},repeatHeaderField:{type:"checkbox",label:"L{ExportDialog.repeatHeader}",localeClass:this,hidden:!0,weight:500},fileFormatField:{type:"combo",label:"L{ExportDialog.fileFormat}",localeClass:this,editable:!1,value:"pdf",items:[],onChange({value:e,oldValue:r}){const t=this.parent;if(t.hidePNGMultipageOption){const i=t.widgetMap.exporterTypeField,n=i.store.find(s=>s.id==="singlepage");e===Eu.png&&n?(this._previousDisabled=i.disabled,i.disabled=!0,this._previousValue=i.value,i.value="singlepage"):r===Eu.png&&this._previousValue&&(i.disabled=this._previousDisabled,i.value=this._previousValue)}},weight:600},paperFormatField:{type:"combo",label:"L{ExportDialog.paperFormat}",editable:!1,value:"A4",items:[],weight:700},orientationField:{type:"exportorientationcombo",label:"L{ExportDialog.orientation}",value:"portrait",weight:800}},bbar:{defaults:{localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100,onClick:"up.onExportClick"},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200,onClick:"up.onCancelClick"}}}}}construct(e={}){const r=this,{client:t}=e;if(!t)throw new Error("`client` config is required");r.columnsStore=t.columns.chain(i=>i.isLeaf&&i.exportable,null,{excludeCollapsedRecords:!1}),r.applyInitialValues(e),super.construct(e),ze.ion({locale:"onLocaleChange",prio:-1,thisObj:r})}applyInitialValues(e){const r=this,t=e.items=e.items||{};e.width=e.width||r.L("L{width}"),e.defaults=e.defaults||{},e.defaults.labelWidth=e.defaults.labelWidth||r.L("L{ExportDialog.labelWidth}"),t.columnsField=t.columnsField||{},t.fileFormatField=t.fileFormatField||{},t.paperFormatField=t.paperFormatField||{},t.fileFormatField.items=GE(Eu,i=>i.toUpperCase()),t.paperFormatField.items=GE(Kl),t.columnsField.store=r.columnsStore}onBeforeShow(){var e;const{columnsField:r,alignRowsField:t,exporterTypeField:i,repeatHeaderField:n}=this.widgetMap;this.autoSelectVisibleColumns&&(r.value=this.columnsStore.query(s=>!s.hidden)),t.hidden=i.value==="singlepage",n.hidden=i.value!=="multipagevertical",(e=super.onBeforeShow)==null||e.call(this,...arguments)}onLocaleChange(){const e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget(r=>{r instanceof Ue&&(r.labelWidth=e)})}onExportClick(){const e=this.values;this.trigger("export",{values:e})}onCancelClick(){this.trigger("cancel"),this.hide()}get values(){const e=/field/i,r={};return this.eachWidget(t=>{e.test(t.ref)&&(r[t.ref.replace(e,"")]=t instanceof Hn?t.checked:t.value)}),r}};Xl.initClass(),Xl._$name="ExportDialog";var Ma=class extends fe(Le(We(F))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0,filterStyles:e=>e}}pageTpl(e){const{title:r,header:t,footer:i,styles:n,htmlClasses:s,bodyStyle:a,bodyClasses:o=[],paperHeight:l,paperWidth:c,html:d}=e;return o.push(`b-${this.constructor.type}`),w.scrollBarWidth?o.push("b-visible-scrollbar"):o.push("b-overlay-scrollbar"),q.isChrome?o.push("b-chrome"):q.isSafari?o.push("b-safari"):q.isFirefox&&o.push("b-firefox"),tr.tpl`
            <!DOCTYPE html>
            <html class="${s}" style="width: ${c}in; height: ${l}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${r}</title>
                    ${n.join("")}
                </head>
                <body class="b-export ${o.join(" ")}" style="width: ${c}in; height: ${l}in; ${a}">
                    <div class="b-export-content">
                        ${t&&`<div class="b-export-header" style="width: 100%">${t}</div>`}
                        <div class="b-export-body"><div class="b-export-viewport">${d}</div></div>
                        ${i&&`<div class="b-export-footer" style="width: 100%">${i}</div>`}
                    </div>
                </body>
            </html>`}get stylesheets(){const e=this;if(e._stylesheets)return e._stylesheets;const r=e.translateURLsToAbsolute,t=globalThis.origin,i=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),n=[];return i.forEach(s=>{if(s=s.cloneNode(!0),r&&s.href){let o;r===!0?o=s.href:this.keepPathName?o=s.href.replace(t,r):o=new URL(s.getAttribute("href"),r),s.setAttribute("href",o)}let a=s.outerHTML;if(r&&/style/i.test(s.tagName)){const o=e.getStyleTagURLConverter(r);a=a.replace(/url\(['"]?(.+?)['"]?\)/g,o)}n.push(a)}),n.push(`<style>
                body, html {
                    overflow: auto;
                }
                body {
                    position: relative;
                    margin: 0;
                }
            </style>`),e._stylesheets=e.filterStyles(n)}set stylesheets(e){this._stylesheets=e&&this.filterStyles(e)}getStyleTagURLConverter(e){return function(r,t){let i;try{let n;/^#/.test(t)?i=r:(e===!0?n=globalThis.location.href:this.keepPathName?n=globalThis.location.href.replace(globalThis.location.origin,e):n=e,i=`url('${new URL(t,n).href}')`)}catch(n){i=r}return i}.bind(this)}saveState({client:e}){this.state=e.state}async restoreState({client:e}){const r=[],t=new Set;t.add(e.scrollable.ion({scroll(){r.push(e.scrollable.await("scrollEnd"))}})),e.eachSubGrid(({header:i,scrollable:n})=>{t.add(n.ion({scroll(){r.push(n.await("scrollEnd"))}})),t.add(i.scrollable.ion({scroll(){r.push(i.scrollable.await("scrollEnd"))}}))}),e.state=this.state,await Promise.all(r),t.forEach(i=>i())}beforeExport(){this.element=document.createElement("div")}cloneElement(e,r=this.element,t=!0){t&&(r.innerHTML=""),r.appendChild(e.cloneNode(!0)),w.removeEachSelector(r,".b-grid-row,.b-grid-merged-cells-container");const i=r.querySelector(".b-gridbase > .b-mask");i&&i.remove()}createPlaceholder(e,r=!0,t={}){return r&&(e.innerHTML=""),w.createElement(Object.assign({parent:e,id:ti.generateId("export")},t))}prepareElement({client:e}){const{tbar:r,bbar:t}=e;r&&this.element.querySelector(`#${r.id}`).remove(),t&&this.element.querySelector(`#${t.id}`).remove()}measureElement(e=""){e instanceof HTMLElement&&(e=e.outerHTML);const r=w.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:`<div style="height: 1px"></div>${e}<div style="height: 1px"></div>`}),t=r.offsetHeight-2;return r.remove(),t}prepareHTML(e){e instanceof HTMLElement&&(e=e.outerHTML);const r=w.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:e}),t=r.querySelectorAll("img");for(let n=0,s=t.length;n<s;n++)t[n].setAttribute("src",t[n].src);const i=r.innerHTML;return r.remove(),i}getVirtualScrollerHeight(e){let r=0;return e.eachSubGrid(t=>{t.overflowingHorizontally&&(r=w.scrollBarWidth)}),r===0?r:r+1}inchToPx(e){return e*96}getScaleValue(e,r){return Math.floor(e*1e4/r)/1e4}getVisibleRowsCount(e){const r=e.rowManager,t=r.rows.indexOf(r.firstVisibleRow),i=r.rows.indexOf(r.lastVisibleRow);let n;return t!==-1?i===-1?n=e.store.count-t:n=i-t+1:n=e.store.count,n}async export(e){const r=this;let t;r.beforeExport(),r.saveState(e),await r.prepareComponent(e);try{t=await r.getPages(e)}finally{await r.restoreComponent(e),r.stylesheets=null,await new Promise(i=>r.requestAnimationFrame(i)),await r.restoreState(e)}return t}async getPages(e){const r=this.pagesExtractor(e),t=[];let i;for(;(i=await r.next())&&!i.done;)t.push(i.value);return t}adjustRowBuffer(e){const{contentHeight:r}=this.exportMeta,{rowManager:t}=e;this.oldRowManagerConfig={prependRowBuffer:t.prependRowBuffer,appendRowBuffer:t.appendRowBuffer};const i=Math.ceil(r/t.rowOffsetHeight);t.prependRowBuffer=i,t.appendRowBuffer=i,e.renderRows(),e.rowManager.jumpToPosition(e.scrollable.y)}restoreRowBuffer(e){e.rowManager.prependRowBuffer=this.oldRowManagerConfig.prependRowBuffer,e.rowManager.appendRowBuffer=this.oldRowManagerConfig.appendRowBuffer}async prepareComponent(e){const r=this,{client:t,columns:i,rowsRange:n,keepRegionSizes:s,enableDirectRendering:a}=e,{rowManager:o}=t,l=r.exportMeta={enableDirectRendering:a,totalWidth:0,totalHeight:0-(a?0:r.getVirtualScrollerHeight(t)),subGrids:{}};t.columns.forEach(u=>{i.includes(u.id)?u.show():u.hide()}),await new Promise(u=>t.requestAnimationFrame(u)),t.rowManager.rowCount>0&&(n===Et.all?l.firstVisibleDataIndex=o.rows[0].dataIndex:(l.firstVisibleDataIndex=o.firstVisibleRow.dataIndex,e.alignRows=!0),a||await t.scrollRowIntoView(t.store.getAt(l.firstVisibleDataIndex),{block:"start"}));const{element:c}=r;r.cloneElement(t.element),r.prepareElement(e);let d;a&&(l.fakeRow=d=t.rowManager.rowClass.new({cls:t.rowCls,rowManager:t.rowManager,grid:t,index:-10,dataIndex:-10})),t.eachSubGrid(u=>{var h,g,f;d&&(u.onAddRow({rows:[d],isExport:!0}),d.element.dataset.ownerCmp=t.id);const m=r.createPlaceholder(c.querySelector(`[id="${u.id}"]`),!1);let p;s!=null&&s[u.region]?p=u.element.offsetWidth:p=u.columns.visibleColumns.reduce((y,C)=>(typeof C.width=="number"?y+=C.width:y+=(t.hideHeaders?t.rowManager.rows[0].getCell(C.id):C.element).offsetWidth,y),0),l.totalWidth+=p;const v=((h=u.splitterElement)==null?void 0:h.offsetWidth)||0;l.totalWidth+=v,l.subGrids[u.region]={id:u.id,headerId:((g=u.header)==null?void 0:g.id)||null,footerId:((f=u.footer)==null?void 0:f.id)||null,rows:[],splitterWidth:v,placeHolder:m,width:p}})}prepareExportElement(){const e=this,{element:r,exportMeta:t}=e;return Object.values(t.subGrids).forEach(({width:i,id:n,headerId:s,footerId:a})=>{[n,s,a].forEach(o=>{if(o){const l=r.querySelector(`[id="${o}"]`);l&&(l.style.width=`${i}px`,l.style.flex="")}})}),r.innerHTML}async restoreComponent(e){this.exportMeta.fakeRow&&(this.exportMeta.fakeRow.destroy(),delete this.exportMeta.fakeRow)}async scrollRowIntoView(e,r){await e.scrollRowIntoView(e.store.getAt(r),{block:"start"}),await new Promise(t=>this.requestAnimationFrame(t))}collectRow(e){const r=this.exportMeta.subGrids,t=/data-owner-cmp=".+?"/;Object.entries(e.elements).forEach(([i,n])=>{r[i].rows.push([n.outerHTML.replace(t,""),e.top,e.offsetHeight,new Map])})}renderMergedCells(e,r,t,i){const n=this,{client:s}=e,{subGrids:a}=n.exportMeta,o=s.features.mergeCells.buildMergedCellsConfig(r,t,i);for(const l in a){const c=a[l],d=document.createElement("div");X.sync({targetElement:d,domConfig:{children:o[l].children}}),d.childNodes.length&&(d.childNodes.forEach(u=>{const{syncId:h}=u.dataset,g=s.features.mergeCells.mergedRanges.find(f=>{var m;return((m=f.cellElement)==null?void 0:m.parentNode.dataset.syncId)===h});g&&(u.innerHTML=g.cellElement.outerHTML)}),c.mergedCellsHtml=[d.innerHTML])}}};Ma.prototype.pagesExtractor=async function*(){throw new Error("Implement this method in a subclass")},Ma._$name="Exporter";var Ia=class extends Ma{static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e,rowsRange:r,enableDirectRendering:t}){const{exportMeta:i}=this;++i.currentPage,++i.verticalPosition,delete i.lastExportedRowBottom,i.verticalPosition>=i.verticalPages&&(Object.assign(i,{verticalPosition:0,horizontalPosition:i.horizontalPosition+1,currentPageTopMargin:0,lastTop:0,lastRowIndex:r===Et.visible?e.rowManager.firstVisibleRow.dataIndex:0}),delete i.lastRowDataIndex,t||await this.scrollRowIntoView(e,i.firstVisibleDataIndex,{block:"start"}))}async prepareComponent(e){await super.prepareComponent(e);const r=this,{exportMeta:t}=r,{client:i,headerTpl:n,footerTpl:s,alignRows:a,rowsRange:o,enableDirectRendering:l}=e,c=Kl[e.paperFormat],d=e.orientation===Ta.portrait,u=d?c.width:c.height,h=d?c.height:c.width,g=r.inchToPx(u),f=r.inchToPx(h),m=o===Et.visible,p=Math.ceil(t.totalWidth/g);let v=f;n&&(v-=r.measureElement(n({totalWidth:t.totalWidth,totalPages:-1,currentPage:-1}))),s&&(v-=r.measureElement(s({totalWidth:t.totalWidth,totalPages:-1,currentPage:-1})));let y,C,D=i.store.count;if(m?(D=r.getVisibleRowsCount(i),y=t.totalHeight+i.headerHeight+i.footerHeight+i.bodyHeight):y=t.totalHeight+i.headerHeight+i.footerHeight+i.scrollable.scrollHeight,a&&!m){const S=i.rowManager.rowOffsetHeight,x=Math.floor((v-i.headerHeight)/S),R=Math.floor(v/S),I=D-x;C=1+Math.ceil(I/R)}else C=Math.ceil(y/v);Object.assign(t,{paperWidth:u,paperHeight:h,pageWidth:g,pageHeight:f,horizontalPages:p,verticalPages:C,totalHeight:y,contentHeight:v,totalRows:D,totalPages:p*C,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:m?i.rowManager.firstVisibleRow.dataIndex:0}),l||this.adjustRowBuffer(i)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const r=this,{exportMeta:t}=r,{client:i,alignRows:n,rowsRange:s}=e,{subGrids:a,currentPageTopMargin:o,verticalPosition:l,contentHeight:c,totalRows:d,lastRowDataIndex:u}=t,{rowManager:h}=i,{rows:g}=h,f=s===Et.visible,m=i.hasActiveFeature("mergeCells");let p,v;f&&u!=null?u===g[g.length-1].dataIndex?v=g.length-1:v=g.findIndex(R=>R.dataIndex===u):v=f?g.findIndex(R=>R.bottom>Math.ceil(i.scrollable.y)):g.findIndex(R=>R.bottom+o+i.headerHeight>0);const y=v,C=f||l===0?0:g[v].top+o+i.headerHeight;p=c-C,l===0&&(p-=i.headerHeight);let D,S=0;for(;p>0;){const R=g[v];n&&p<R.offsetHeight?(S=-p,p=0,r.exportMeta.lastExportedRowBottom=g[v-1].bottom):(r.collectRow(R),p-=R.offsetHeight,D=R.dataIndex,(++v===g.length&&p>0||f&&v-y===d)&&(p=0))}if(m)for(const R in a){const I=a[R],M=i.subGrids[R].element.querySelectorAll(".b-grid-merged-cells");I.mergedCellsHtml=[];for(const P of M)I.mergedCellsHtml.push(P.outerHTML)}const x=g[v-1];if(x&&(t.exactGridHeight=x.bottom+i.footerContainer.offsetHeight+i.headerContainer.offsetHeight,t.lastRowDataIndex=x.dataIndex+1),await r.onRowsCollected(g.slice(y,v),e),f)t.exactGridHeight-=t.scrollableTopMargin=i.scrollable.y;else{const R=h.ion({offsetRows:({offset:I})=>S+=I});await r.scrollRowIntoView(i,D+1),R()}return S}async renderRows(e){const r=this,{exportMeta:t}=r,{client:i,alignRows:n,rowsRange:s}=e,{currentPageTopMargin:a,verticalPosition:o,contentHeight:l,totalRows:c,lastRowIndex:d,fakeRow:u}=t,{store:h}=i,g=i.hasActiveFeature("mergeCells"),f=s===Et.visible;let m=d,{lastTop:p}=t,v;const y=m,C=f||o===0?0:p+a+i.headerHeight,D=[];v=l-C,o===0&&(v-=i.headerHeight);let S,x,R=0;for(;v>0;)u.render(m,h.getAt(m),!0,!1,!0),n&&v<u.offsetHeight?(R=-v,v=0,r.exportMeta.lastExportedRowBottom=p):(x=p,S=m,p=u.translate(p),v-=u.offsetHeight,r.collectRow(u),D.push({top:u.top,bottom:u.bottom,offsetHeight:u.offsetHeight,dataIndex:u.dataIndex}),(++m===h.count&&v>0||f&&m-y===c)&&(v=0));return g&&r.renderMergedCells(e,y,m,D),t.lastRowIndex=n?m:S,t.lastTop=n?p:x,u&&(t.exactGridHeight=u.bottom+i.footerContainer.offsetHeight+i.headerContainer.offsetHeight),await r.onRowsCollected(D,e),R}async buildPage(e){const r=this,{exportMeta:t}=r,{client:i,headerTpl:n,footerTpl:s,enableDirectRendering:a}=e,{totalWidth:o,totalPages:l,currentPage:c,subGrids:d}=t;Object.values(d).forEach(m=>m.rows=[]),e.rowsRange===Et.all&&(t.totalHeight=i.height-i.bodyHeight+i.scrollable.scrollHeight-r.getVirtualScrollerHeight(i));let u,h;n&&(u=r.prepareHTML(n({totalWidth:o,totalPages:l,currentPage:c}))),s&&(h=r.prepareHTML(s({totalWidth:o,totalPages:l,currentPage:c})));let g;return a?g=await r.renderRows(e):g=await r.collectRows(e),{html:r.buildPageHtml(e),header:u,footer:h,offset:g}}async onRowsCollected(){}buildPageHtml(){const e=this,{subGrids:r}=e.exportMeta;let t=e.prepareExportElement();return Object.values(r).forEach(({placeHolder:i,rows:n,mergedCellsHtml:s})=>{const a=i.outerHTML;let o=n.reduce((l,c)=>(l+=c[0],l),"");s!=null&&s.length&&(o+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),t=t.replace(a,o)}),t}prepareExportElement(){const e=this,{element:r,exportMeta:t}=e;return t.scrollableTopMargin&&(r.querySelector(".b-grid-vertical-scroller").style.marginTop=`-${t.scrollableTopMargin}px`),super.prepareExportElement()}};Ia.prototype.pagesExtractor=async function*(r){const t=this,{exportMeta:i,stylesheets:n}=t,{totalWidth:s,totalPages:a,paperWidth:o,paperHeight:l,contentHeight:c}=i;let d;for(;(d=i.currentPage)<a;){t.trigger("exportStep",{text:t.L(Ia.exportingPageText,{currentPage:d,totalPages:a}),progress:Math.round((d+1)/a*90)});const{html:u,header:h,footer:g,offset:f}=await t.buildPage(r),m=[...n,`
                <style>
                    #${r.client.id} {
                        height: ${i.exactGridHeight}px !important;
                        width: ${s}px !important;
                    }
                    .b-export-body .b-export-viewport {
                        margin-inline-start : ${-o*i.horizontalPosition}in;
                        margin-top  : ${i.currentPageTopMargin}px;
                    }
                </style>
            `];i.currentPageTopMargin-=c+f,await t.stateNextPage(r),yield{html:t.pageTpl({html:u,header:h,footer:g,styles:m,paperWidth:o,paperHeight:l})}}},Ia._$name="MultiPageExporter";var Pa=class extends Ma{static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:r}=this,{totalRows:t,processedRows:i,totalPages:n}=r;++r.currentPage,++r.verticalPosition,r.currentPage===n&&i.size!==t&&(++r.totalPages,++r.verticalPages)}estimateTotalPages(e){const r=this,{exportMeta:t}=r,{client:i,headerTpl:n,footerTpl:s,alignRows:a,rowsRange:o,repeatHeader:l,enableDirectRendering:c}=e,{pageWidth:d,pageHeight:u,totalWidth:h}=t,g=r.getScaleValue(d,h);let f=0-r.getVirtualScrollerHeight(i)+i.height-i.bodyElement.offsetHeight+i.scrollable.scrollHeight,m=u/g,p=i.store.count,v=0,y=f,C;if(n&&(m-=r.measureElement(n({totalWidth:h,totalPages:-1,currentPage:-1}))),s&&(m-=r.measureElement(s({totalWidth:h,totalPages:-1,currentPage:-1}))),l&&(m-=i.headerHeight+i.footerHeight,f-=i.headerHeight+i.footerHeight),o===Et.visible){const D=i.rowManager,S=D.firstVisibleRow,x=D.lastVisibleRow;c||(v=S.top),p=r.getVisibleRowsCount(i),c?(f=i.headerHeight+i.footerHeight+x.bottom-S.top,y=x.bottom-S.top):y=f=f-i.scrollable.scrollHeight+x.bottom-S.top,t.lastRowIndex=S.dataIndex,t.finishRowIndex=x.dataIndex}else t.finishRowIndex=i.store.count-1;if(a&&!l&&o!==Et.visible){const D=i.rowManager.rowOffsetHeight,S=Math.floor((m-i.headerHeight)/D),x=Math.floor(m/D),R=p-S;C=1+Math.ceil(R/x)}else C=Math.ceil(y/m);Object.assign(t,{scale:g,contentHeight:m,totalRows:p,totalHeight:f,verticalPages:C,initialScroll:v,horizontalPages:1,totalPages:C})}async prepareComponent(e){await super.prepareComponent(e);const r=this,{exportMeta:t}=r,{client:i}=e,n=Kl[e.paperFormat],s=e.orientation===Ta.portrait,a=s?n.width:n.height,o=s?n.height:n.width,l=r.inchToPx(a),c=r.inchToPx(o);Object.assign(t,{paperWidth:a,paperHeight:o,pageWidth:l,pageHeight:c,horizontalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:0,processedRows:new Set}),r.estimateTotalPages(e),e.enableDirectRendering||r.adjustRowBuffer(i)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const r=this,{exportMeta:t}=r,{client:i,alignRows:n,repeatHeader:s}=e,{subGrids:a,currentPageTopMargin:o,verticalPosition:l,totalRows:c,contentHeight:d}=t,u=s?0:i.headerHeight,{rowManager:h}=i,{rows:g}=h,f=e.rowsRange===Et.visible,m=i.hasActiveFeature("mergeCells");let p=f?g.findIndex(R=>R.bottom>i.scrollable.y):g.findIndex(R=>R.bottom+o+u>0),v;const y=p,C=l===0?0:g[p].top+o+u;v=d-C,l===0&&(v-=u);let D,S=0;for(;v>0;){const R=g[p];n&&v<R.offsetHeight?(S=-v,v=0):(r.collectRow(R),v-=R.offsetHeight,v>0&&t.processedRows.add(R.dataIndex),D=R.dataIndex,(++p===g.length&&v>0||f&&p-y===c)&&(v=0))}if(m)for(const R in a){const I=a[R],M=i.subGrids[R].element.querySelectorAll(".b-grid-merged-cells");I.mergedCellsHtml=[];for(const P of M)I.mergedCellsHtml.push(P.outerHTML)}const x=g[p-1];if(x&&(t.exactGridHeight=x.bottom+i.footerContainer.offsetHeight+i.headerContainer.offsetHeight),await r.onRowsCollected(g.slice(y,p),e),f)t.scrollableTopMargin=i.scrollable.y;else{const R=h.ion({offsetRows:({offset:I})=>S+=I});await r.scrollRowIntoView(i,D+1),R()}return S}async renderRows(e){const r=this,{exportMeta:t}=r,{client:i,alignRows:n,repeatHeader:s}=e,{currentPageTopMargin:a,verticalPosition:o,totalRows:l,contentHeight:c,lastRowIndex:d,finishRowIndex:u,fakeRow:h}=t,g=s?0:i.headerHeight,{store:f}=i,m=i.hasActiveFeature("mergeCells"),p=e.rowsRange===Et.visible;let v=d,{lastTop:y}=t,C;const D=v,S=o===0?0:y+a+g,x=[];C=c-S,o===0&&(C-=g);let R,I,M=0;for(;C>0;)h.render(v,f.getAt(v),!0,!1,!0),n&&C<h.offsetHeight?(M=-C,C=0):(I=y,R=v,y=h.translate(y),C-=h.offsetHeight,r.collectRow(h),x.push({top:h.top,bottom:h.bottom,offsetHeight:h.offsetHeight,dataIndex:h.dataIndex}),C>0&&t.processedRows.add(v),(v===u||++v-D===l&&p)&&(C=0));return m&&r.renderMergedCells(e,D,v,x),t.lastRowIndex=R,t.lastTop=I,h&&(t.exactGridHeight=h.bottom+i.footerContainer.offsetHeight+i.headerContainer.offsetHeight),await r.onRowsCollected(x,e),M}async buildPage(e){const r=this,{exportMeta:t}=r,{client:i,headerTpl:n,footerTpl:s,enableDirectRendering:a}=e,{totalWidth:o,totalPages:l,currentPage:c,subGrids:d}=t;Object.values(d).forEach(m=>m.rows=[]),e.rowsRange===Et.all&&(t.totalHeight=i.headerHeight+i.footerHeight+i.scrollable.scrollHeight,a||(t.totalHeight-=r.getVirtualScrollerHeight(i)));let u,h,g;return n&&(u=r.prepareHTML(n({totalWidth:o,totalPages:l,currentPage:c}))),s&&(h=r.prepareHTML(s({totalWidth:o,totalPages:l,currentPage:c}))),a?g=await r.renderRows(e):g=await r.collectRows(e),{html:r.buildPageHtml(e),header:u,footer:h,offset:g}}async onRowsCollected(){}buildPageHtml(){const e=this,{subGrids:r}=e.exportMeta;let t=e.prepareExportElement();return Object.values(r).forEach(({placeHolder:i,rows:n,mergedCellsHtml:s})=>{const a=i.outerHTML;let o=n.reduce((l,c)=>(l+=c[0],l),"");s!=null&&s.length&&(o+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),t=t.replace(a,o)}),t}};Pa.prototype.pagesExtractor=async function*(r){const t=this,{exportMeta:i,stylesheets:n}=t,{totalWidth:s,paperWidth:a,paperHeight:o,contentHeight:l,scale:c,initialScroll:d}=i;let{totalPages:u}=i,h;for(;(h=i.currentPage)<u;){t.trigger("exportStep",{text:t.L(Pa.exportingPageText,{currentPage:h,totalPages:u}),progress:Math.round((h+1)/u*90)});const{html:g,header:f,footer:m,offset:p}=await t.buildPage(r),v=[...n,`
                <style>
                    #${r.client.id} {
                        width: ${s}px !important;
                    }
                    .b-export .b-export-content {
                        transform: scale(${c});
                        transform-origin: top left;
                        height: auto;
                    }
                </style>
            `];if(r.repeatHeader){const y=i.exactGridHeight?`${i.exactGridHeight+i.currentPageTopMargin}px`:"100%";v.push(`
                <style>
                    #${r.client.id} {
                        height: ${y} !important;
                    }
                    .b-export .b-export-content {
                        height: ${100/c}%;
                    }
                    .b-export-body {
                        height: 100%;
                        display: flex;
                    }
                    .b-export-viewport {
                        height: 100%;
                    }
                    .b-grid-vertical-scroller {
                        margin-top: ${i.currentPageTopMargin-d}px;
                    }
                </style>
                `)}else{const y=i.exactGridHeight||l-i.currentPageTopMargin;v.push(`
                <style>
                    #${r.client.id} {
                        height: ${y}px !important;
                    }
                    .b-export-body {
                        overflow: hidden;
                    }
                    .b-export .b-export-content {
                        height: ${100/c}%;
                    }
                    .b-export-body .b-export-viewport {
                        margin-top: ${i.currentPageTopMargin}px;
                    }
                    .b-grid-vertical-scroller {
                        margin-top: -${d}px;
                    }
                </style>
                `)}i.currentPageTopMargin-=l+p,await t.stateNextPage(r),{totalPages:u}=i,yield{html:t.pageTpl({html:g,header:f,footer:m,styles:v,paperWidth:a,paperHeight:o})}}},Pa._$name="MultiPageVerticalExporter";var Zl=class extends Ma{static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(e){await super.prepareComponent(e),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}positionRows(e,r){if(r.enableDirectRendering)return e.map(t=>t[0]);{let t=0;return e.map(([i,,n])=>{const s=i.replace(/translate\(\d+px, \d+px\)/,`translate(0px, ${t}px)`);return t+=n,s})}}async collectRows(e){const r=this,{client:t}=e,{rowManager:i,store:n}=t,s=t.hasActiveFeature("mergeCells"),{subGrids:a}=r.exportMeta,o=e.rowsRange===Et.visible&&n.count?r.getVisibleRowsCount(t):n.count;let{totalHeight:l}=r.exportMeta,c=0,d=-1;if(i.rows.length>0){if(e.rowsRange===Et.visible&&(d=i.firstVisibleRow.dataIndex-1),s)for(const u of Object.values(a))u.mergedCellsHtml=[];for(;c<o;){const u=i.rows,h=u[u.length-1],g=c;if(u.forEach(p=>{p.dataIndex>d&&c<o&&(++c,l+=p.offsetHeight,r.collectRow(p))}),s)for(const p in a){const v=a[p],y=t.subGrids[p].element.querySelectorAll(".b-grid-merged-cells");for(const C of y)v.mergedCellsHtml.push(C.outerHTML)}const f=u.findIndex(p=>p.dataIndex===d+1),m=f+(c-g);await r.onRowsCollected(u.slice(f,m),e),c<o&&(d=h.dataIndex,await r.scrollRowIntoView(t,d+1))}}return l}async renderRows(e){const r=this,{client:t,rowsRange:i}=e,{rowManager:n,store:s}=t,a=t.hasActiveFeature("mergeCells"),o=i===Et.visible;let{totalHeight:l}=r.exportMeta;if(s.count){const{fakeRow:c}=r.exportMeta,{firstVisibleRow:d}=n,u=o?d.dataIndex:0,h=o?n.lastVisibleRow.dataIndex:s.count-1,g=[];let f=0;if(c.cells.length){for(let m=u;m<=h;m++)c.render(m,s.getAt(m),!0,!1,!0),f=c.translate(f),r.collectRow(c),g.push({top:c.top,bottom:c.bottom,offsetHeight:c.offsetHeight,dataIndex:c.dataIndex});await r.onRowsCollected(g,e)}l+=f,a&&r.renderMergedCells(e,u,h,g)}return l}buildPageHtml(e){const r=this,{subGrids:t}=r.exportMeta;let i=r.prepareExportElement();return Object.values(t).forEach(({placeHolder:n,rows:s,mergedCellsHtml:a})=>{const o=n.outerHTML;let l=r.positionRows(s,e).join("");a!=null&&a.length&&(l+=`<div class="b-grid-merged-cells-container">${a.join("")}</div>`),i=i.replace(o,l)}),i}};Zl.prototype.pagesExtractor=async function*(r){const t=this,{client:i}=r,{totalWidth:n}=t.exportMeta,s=t.stylesheets,a=r.orientation===Ta.portrait,o=Kl[r.paperFormat],l=a?o.width:o.height,c=a?o.height:o.width;let d,u,h;r.enableDirectRendering?(d=await t.renderRows(r),d+=i.headerHeight+i.footerHeight):(d=await t.collectRows(r),d+=i.height-i.bodyHeight);const g=t.buildPageHtml(r),f=d;if(r.headerTpl){u=t.prepareHTML(r.headerTpl({totalWidth:n}));const y=t.measureElement(u);d+=y}if(r.footerTpl){h=t.prepareHTML(r.footerTpl({totalWidth:n}));const y=t.measureElement(h);d+=y}const m=Math.min(1,t.getScaleValue(t.inchToPx(l),n)),p=Math.min(1,t.getScaleValue(t.inchToPx(c),d)),v=Math.min(m,p);s.push(`<style>
                #${i.id} {
                    height: ${f}px !important;
                    width: ${n}px !important;
                }
                .b-export-content {
                    ${t.centerContentHorizontally?"left: 50%;":""}
                    transform: scale(${v}) ${t.centerContentHorizontally?"translateX(-50%)":""};
                    transform-origin: top left;
                    height: ${v===1?"inherit":"auto !important"};
                }
            </style>`),q.isIE11&&s.push(`<style>
                .b-export-body {
                   min-height: ${f}px !important;
                }
         </style>`),yield{html:t.pageTpl({html:g,header:u,footer:h,styles:s,paperWidth:l,paperHeight:c})}},Zl._$name="SinglePageExporter";var xu=class extends Q{static get $name(){return"PdfExport"}static get configurable(){return{dialogClass:Xl,exportServer:void 0,exportDialog:{value:!0,$config:["lazy"]},fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[Zl,Ia,Pa],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,sendAsBinary:!1,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",showErrorToast:!0,localizableProperties:["exportMask","exportProgressMask"],filterStyles:e=>e,enableDirectRendering:!0}}updateEnableDirectRendering(e){e||ne.deprecate("Grid","6.0.0","Indirect rendering is deprecated")}doDestroy(){var e;(e=this.exportDialog)==null||e.destroy(),this.exportersMap.forEach(r=>r.destroy()),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(e){this._currentExportPromise=e}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(e={}){const r=this,{exportersMap:t}=r,{type:i}=e;let n;if(t.has(i))n=t.get(i),Object.assign(n,e);else{const s=this.exporters.find(a=>a.type===i);if(!s)throw new Error(`Exporter type ${i} is not found. Make sure you've configured it`);e=T.clone(e),delete e.type,n=new s(e),n.relayAll(r),t.set(i,n)}return n}buildExportConfig(e={}){const r=this,{client:t,exportServer:i,clientURL:n,fileFormat:s,fileName:a,paperFormat:o,rowsRange:l,alignRows:c,repeatHeader:d,keepRegionSizes:u,orientation:h,translateURLsToAbsolute:g,keepPathName:f,sendAsBinary:m,headerTpl:p,footerTpl:v,filterStyles:y,enableDirectRendering:C}=r;e.columns||(e.columns=t.columns.visibleColumns.filter(S=>S.exportable).map(S=>S.id));const D=T.assign({client:t,exportServer:i,clientURL:n,fileFormat:s,paperFormat:o,rowsRange:l,alignRows:c,repeatHeader:d,keepRegionSizes:u,orientation:h,translateURLsToAbsolute:g,keepPathName:f,sendAsBinary:m,headerTpl:p,footerTpl:v,enableDirectRendering:C,exporterType:r.exporterType,fileName:a||t.$$name},e);return D.columns=e.columns.slice(),D.exporterType!=="multipagevertical"&&(D.repeatHeader=!1),!("alignRows"in e)&&e.repeatHeader&&(D.alignRows=!0),D.exporterConfig=T.assign({type:D.exporterType,translateURLsToAbsolute:D.translateURLsToAbsolute,keepPathName:D.keepPathName,filterStyles:y},D.exporterConfig||{}),delete D.exporterType,delete D.translateURLsToAbsolute,delete D.keepPathName,D}async export(e={}){var r,t;const i=this,{client:n,pagesPerRequest:s}=i;e=i.buildExportConfig(e);let a;if(n.trigger("beforePdfExport",{config:e})!==!1){n.isExporting=!0,n.mask(i.exportMask);try{const o=i.getExporter(e.exporterConfig);if(s===0){const l=await o.export(e);if(i.isDestroying)return;(r=i.exportDialog)==null||r.close(),n.unmask(),i.trigger("exportStep",{progress:90,text:i.exportProgressMask,contentGenerated:!0});const c=i.receiveExportContent(l,e);i.toast=i.showLoadingToast(c);const d=await c;a={response:d},await i.processExportContent(d,e)}}catch(o){throw o instanceof Response?a={response:o}:a={error:o},o}finally{i.toast&&!i.toast.isDestroying&&i.toast.hide(),i.isDestroying||((t=i.exportDialog)==null||t.close(),n.unmask(),i.showErrorToast&&(a.error?a.error.name!=="AbortError"&&It.show({html:i.L("L{Export failed}"),rootElement:i.rootElement}):a.response.ok||It.show({html:i.L("L{Server error}"),rootElement:i.rootElement})),n.trigger("pdfExport",a),n.isExporting=!1)}}return a}receiveExportContent(e,r){return _r.fetch(r.exportServer,Object.assign({method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e,orientation:r.orientation,format:r.paperFormat,fileFormat:r.fileFormat,fileName:r.fileName,clientURL:r.clientURL,sendAsBinary:r.sendAsBinary})},this.fetchOptions))}async processExportContent(e,r){const t=this;if(e.ok&&t.openAfterExport){e=e.clone();const i=e.headers.get("content-type");if(i.match(/application\/octet-stream/)){const n=Fk[r.fileFormat],s=await t.responseBlobToObjectURL(e,n);t.getDownloadLink(r.fileName,s).click()}else if(i.match(/application\/json/)){const n=await e.json();n.success?t.getDownloadLink(r.fileName,n.url).click():It.show({html:n.msg,rootElement:this.rootElement})}}}async responseBlobToObjectURL(e,r){const t=await e.blob();return URL.createObjectURL(t.slice(0,t.size,r))}getDownloadLink(e,r){const t=document.createElement("a");return t.download=e,t.href=r,this.openInNewTab&&(t.target="_blank"),t}get defaultExportDialogConfig(){return T.copyProperties({},this,["client","exporters","exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader"])}changeExportDialog(e,r){const t=this;if(r==null||r.destroy(),e){const i=t.dialogClass.mergeConfigs({rootElement:t.rootElement,client:t.client,items:{rowsRangeField:{value:t.rowsRange},exporterTypeField:{value:t.exporterType},orientationField:{value:t.orientation},paperFormatField:{value:t.paperFormat},repeatHeaderField:{value:t.repeatHeader},fileFormatField:{value:t.fileFormat},alignRowsField:{checked:t.alignRows}}},t.defaultExportDialogConfig,e);e=t.dialogClass.new(i),e.ion({export:t.onExportButtonClick,thisObj:t})}return e}async showExportDialog(){return this.exportDialog.show()}onExportButtonClick({values:e}){const r=this,t=r.exportDialog.mask({progress:0,maxProgress:100,text:r.exportMask}),i=r.ion({exportstep({progress:n,text:s,contentGenerated:a}){a?(r.exportDialog.unmask(),i()):(t.progress=n,s!=null&&(t.text=s))}});r.currentExportPromise=r.export(e),r.currentExportPromise.catch(()=>{}).finally(()=>{var n;i(),(n=r.exportDialog)==null||n.unmask(),r.currentExportPromise=null})}showLoadingToast(e){const r=It.show({timeout:0,showProgress:!1,rootElement:this.rootElement,html:`
    <span class="b-mask-icon b-icon b-icon-spinner"></span>
    <span>${this.exportProgressMask}</span>
    <button class="b-button">${this.L("L{Click to abort}")}</button>`});return B.on({element:r.element,click(){var t;(t=e.abort)==null||t.call(e)}}),r}};xu._$name="PdfExport",j.registerFeature(xu,!1,"Grid");var Ru=class extends F{static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"\xA0\xA0\xA0\xA0"}}export(e={}){const r=this;return e=T.assign({},r.config,e),r.normalizeColumns(e),r.generateExportData(e)}generateExportData(e){const r=this,t=r.generateColumns(e);return{rows:r.generateRows(e),columns:t}}normalizeColumns(e){const r=e.columns||this.target.columns.visibleColumns.filter(t=>t.exportable!==!1);e.columns=r.map(t=>typeof t=="string"?this.target.columns.find(i=>i.field===t)||{field:t}:t)}generateColumns(e){return e.columns.map(r=>this.processColumn(r,e))}generateRows(e){const{columns:r,rows:t}=e;if(r.length===0||(t==null?void 0:t.length)===0)return[];const i=this,{target:n}=i;return(t||n.store).map(s=>i.processRecord(s,r,e)).filter(s=>s==null?void 0:s.length)}getColumnType(e,r=this.target.store){let t=e.exportedType||"object";if(e.exportedType===void 0&&e.field){const i=r.modelClass.getFieldDefinition(e.field);i&&i.type!=="auto"&&(t=i.type)}return t}processColumn(e,r){const t=this,{target:i}=t,{defaultColumnWidth:n}=r;let{field:s,text:a,width:o,minWidth:l}=e;if(s in i.store.modelClass.fieldMap||(s=""),!a||!o){const c=i.columns.find(d=>d.field===s);a||(a=c&&c.text||s),o==null&&(o=c&&c.width||n)}return o=Math.max(o||n,l||n),{field:s,value:a,width:o,type:t.getColumnType(e)}}processRecord(e,r,t){const{target:i}=this,{showGroupHeader:n,indent:s,indentationSymbol:a}=t;let o;return e?e.isSpecialRow?n&&e.meta.groupRowFor&&(o=r.map(l=>i.features.group.buildGroupHeader({cellElement:w.createElement(),grid:i,record:e,column:l}))):o=r.map(l=>{let c=e.getValue(l.field);const d=l.renderer||l.defaultRenderer;return d&&!(c&&l.isDateColumn&&t.exportDateAsInstance)&&(c=d.call(l,{value:c,record:e,column:l,grid:i,isExport:!0})),s&&l.tree&&(c=`${a.repeat(e.childLevel)}${c}`),c}):o=r.map(()=>""),o}};Ru._$name="TableExporter";var UE=class{constructor(e){this._value=e}get value(){return this._value}toString(){return this.value?"\u2713":""}};UE._$name="BooleanUnicodeSymbol";var Tu=class extends Q{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{filename:null,dateFormat:"YYYY-MM-DD",exporterClass:Ru,exporterConfig:null,zipcelx:null,convertEmptyValueToEmptyString:!0}}processValue(e){return e==null||Number.isNaN(e)||typeof e=="function"||typeof e=="object"&&String(e)==="[object Object]"?"":e}generateExportData(e){const r=this,{rows:t,columns:i}=r.exporter.export(e.exporterConfig);return{rows:t.map(n=>n.map((s,a)=>{var o;s instanceof Date?s=b.format(s,e.dateFormat):typeof s=="boolean"&&(s=new UE(s)),r.convertEmptyValueToEmptyString&&(s=r.processValue(s));const l=((o=i[a])==null?void 0:o.type)==="number"?"number":"string";return{value:s,type:l}})),columns:i.map(n=>{let{field:s,value:a,width:o,type:l}=n;return l="string",{field:s,value:a,width:o,type:l}})}}export(e={}){const r=this,t=r.zipcelx||globalThis.zipcelx;if(!t)throw new Error('ExcelExporter: "zipcelx" library is required');if(r.disabled)return;e=T.assign({},r.config,e),e.filename||(e.filename=r.client.$$name);const{filename:i}=e,{rows:n,columns:s}=r.generateExportData(e);return t({filename:i,sheet:{data:[s].concat(n),cols:s}})}construct(e,r){super.construct(e,r),this.zipcelx||typeof zipcelx!="undefined"&&(this.zipcelx=globalThis.zipcelx)}get exporter(){const e=this;return e._exporter||(e._exporter=e.exporterClass.new({target:e.client},e.exporterConfig))}};Tu._$name="ExcelExporter",j.registerFeature(Tu,!1,"Grid");var Mu=class extends Q{construct(e,r){const t=this;super.construct(e,r),B.on({element:e.element,thisObj:t,drop:t.onFileDrop,dragover:t.onFileDragOver,dragenter:t.onFileDragEnter,dragleave:t.onFileDragLeave})}onFileLoad(e){this.client.trigger("fileDrop",{file:this.file,domEvent:e})}onFileDragEnter(){this.client.element.classList.add("b-dragging-file")}onFileDragOver(e){e.preventDefault()}onFileDragLeave(e){const{element:r}=this.client;e.relatedTarget&&!r.contains(e.relatedTarget)&&this.client.element.classList.remove("b-dragging-file")}onFileDrop(e){e.preventDefault();const r=e.dataTransfer.items[0].getAsFile();this.client.trigger("fileDrop",{file:r,domEvent:e}),this.onFileDragLeave(e)}};E(Mu,"$name","FileDrop"),Mu._$name="FileDrop",j.registerFeature(Mu,!1,"Grid");var vp=document.createRange(),Jl=class extends F{static get configurable(){return{cls:{$config:{equal:(e,r)=>(e==null?void 0:e.isDomClassList)&&(r==null?void 0:r.isDomClassList)&&e.isEqual(r)}}}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new oe({grid:e.grid,id:null,columnIndex:0})}),super.construct(e),this.grid.positionMode==="position"&&(this.translateElements=this.positionElements)}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){this._dataIndex!==e&&(this._dataIndex=e,this.eachElement(r=>{r.dataset.index=e,r.ariaRowIndex=this.grid.hideHeaders?e+1:e+2}))}get id(){return this._id}set id(e){const r=this,t={id:e},i=r.rowManager.idMap;(r._id!==e||i[e]!==r)&&(i[r._id]===r&&delete i[r._id],i[e]=r,r._id=e,r.eachElement(n=>{Ge.assign(n,t),n.dataset.id=e}),r.eachCell(n=>Ge.assign(n,t)))}addElement(e,r){const t=this;let i=r.firstElementChild;for(t._elements[e]=r,t._elementsArray.push(r),t._regions.push(e),Ge.assign(r,{index:t.index}),t._cells[e]=[];i;)t._cells[e].push(i),t._allCells.push(i),Ge.set(i,{column:i.dataset.column,columnId:i.dataset.columnId,rowElement:i.parentNode,row:t}),i=i.nextElementSibling;r.dataset.index=t.index,r.ariaRowIndex=t.grid.hideHeaders?t.index+1:t.index+2}getElement(e){return this._elements[e]}getRectangle(e){return k.from(this.getElement(e))}eachElement(e){this._elementsArray.forEach(e)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get element(){const e=Object.keys(this._elements)[0];return this._elements[e]}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e,r=!1){return this._allCells.find(t=>{const i=Ge.get(t);return i.columnId==e||!r&&i.column==e})}removeElements(e=!1){const r=this;r.rowManager.trigger("removeRow",{row:r}),e||r.eachElement(t=>t.remove()),r._elements={},r._cells={},r._elementsArray.length=r._regions.length=r._allCells.length=r.lastHeight=r.height=0,r.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(e){const r=this;e||r.rowManager.storeKnownHeight(r.id,r.height),r.lastHeight!==r.height&&(this.eachElement(t=>t.style.height=`${r.offsetHeight}px`),r.lastHeight=r.height)}addCls(e){this.updateCls(this.cls.add(e))}removeCls(e){this.updateCls(this.cls.remove(e))}toggleCls(e,r){this.updateCls(this.cls[r?"add":"remove"](e))}assignCls(e){this.updateCls(this.cls.assign(e))}changeCls(e){return e!=null&&e.isDomClassList?e:new J(e)}updateCls(e){this.eachElement(r=>w.syncClassList(r,e))}setAttribute(e,r){this.eachElement(t=>t.setAttribute(e,r))}removeAttribute(e){this.eachElement(r=>r.removeAttribute(e))}get isFirst(){return this.dataIndex===0}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e,r){this._top!==e&&(this._top=e,this.translateElements(r))}setBottom(e,r){this.setTop(e-this.offsetHeight,r)}translate(e,r=!1){return this.setTop(e,r),e+this.offsetHeight}translateElements(e){const r=this,{top:t,_elementsArray:i}=r;if(r.lastTop!==t){for(let n=0,{length:s}=i;n<s;n++)i[n].style.transform=`translate(0,${t}px)`;!e&&r.rowManager.trigger("translateRow",{row:r}),r.lastTop=t}}positionElements(e){const r=this,{top:t,_elementsArray:i}=r;if(r.lastTop!==t){for(let n=0,{length:s}=i;n<s;n++)i[n].style.top=`${t}px`;!e&&r.rowManager.trigger("translateRow",{row:r}),r.lastTop=t}}offset(e){let r=this._top+e;return r<0&&(e-=r,r=0),this.setTop(r),e}render(e,r,t=!0,i=!1,n=!1){var s,a,o;const l=this,{cellContext:c,cls:d,elements:u,grid:h,rowManager:g,height:f,_id:m}=l,p=Ge.get(l._elementsArray[0]),v=g._rowHeight,{store:y}=h,{isTree:C}=y;let D=0,S;if(!r&&r!==!1&&(r=h.store.getById(p.id),e=h.store.indexOf(r)),!r)return;const x=r==null?void 0:r.cls,R=x?x.isDomClassList?x:new J(x):null;d.assign({"b-grid-row-updating":t&&h.transitionDuration&&!n,"b-selected":h.isSelected(r==null?void 0:r.id),"b-readonly":r.readOnly,"b-linked":r.isLinked,"b-original":r.hasLinks}),l.lastRecordCls&&d.remove(l.lastRecordCls),R?(d.add(R),l.lastRecordCls=Object.assign({},R)):l.lastRecordCls=null,g.trigger("beforeRenderRow",{row:l,record:r,recordIndex:e,oldId:m}),h.beforeRenderRow({row:l,record:r,recordIndex:e,oldId:m}),l.updateCls(d),t&&h.transitionDuration&&!n&&h.setTimeout(()=>{l.isDestroyed||(d.remove("b-grid-row-updating"),l.updateCls(d))},h.transitionDuration),l.id=r.id,l.dataIndex=e;const I=!h.fixedRowHeight&&h.getRowHeight(r)||v;let M=l.maxRequestedHeight=null;if(C)for(const _ in u){const A=u[_];A.id=`${h.id}-${_}-${l.id}`,w.setAttributes(A,{"aria-level":r.childLevel+1,"aria-setsize":r.parent.children.length,"aria-posinset":r.parentIndex+1}),r.isExpanded(y)?w.setAttributes(A,{"aria-expanded":!0,"aria-owns":(s=r.children)!=null&&s.length?(a=r.children)==null?void 0:a.map(z=>`${h.id}-${_}-${z.id}`).join(" "):null}):(r.isLeaf?A.removeAttribute("aria-expanded"):A.setAttribute("aria-expanded",!1),A.removeAttribute("aria-owns"))}for(c._record=r,c._id=r.id,c._rowIndex=e,D=0;D<h.columns.visibleColumns.length;D++){const _=h.columns.visibleColumns[D];c._columnId=_.id,c._column=_,c._columnIndex=D,c._cell=l.getCell(_.id,!0),c.height=I,c.maxRequestedHeight=M,c.updatingSingleRow=t,S=l.renderCell(c),g.fixedRowHeight||S.height!=null&&(M=Math.max(M,S.height),S.transient||(l.maxRequestedHeight=M))}const P=M!=null?M:I;l.height=(o=h.processRowHeight(r,P))!=null?o:P,l.updateElementsHeight(n),t&&!n&&(f!==l.height&&g.translateFromRow(l,i),g.trigger("updateRow",{row:l,record:r,recordIndex:e,oldId:m}),g.trigger("renderDone")),h.afterRenderRow({row:l,record:r,recordIndex:e,oldId:m,oldHeight:f,isExport:n}),g.trigger("renderRow",{row:l,record:r,recordIndex:e,oldId:m,isExport:n}),f&&l.height!==f&&g.trigger("rowRowHeight",{row:l,record:r,height:l.height,oldHeight:f}),l.forceInnerHTML=!1}renderCell(e){var r,t,i,n;e.isLocation||(e=new oe(e));let{cell:s,record:a}=e;const o=this,{grid:l,column:c,height:d,maxRequestedHeight:u,updatingSingleRow:h=!0,isMeasuring:g=!1}=e,f=(r=l.features)==null?void 0:r.cellEdit,m=Ge.get(s),p=m.rowElement,v=Ge.get(p);if(!a&&(a=e._record=l.store.getById(v.id),!a))return;let y=c.getRawValue(a);const C=a.fieldMap[c.field],D={configuredHeight:d,height:null,maxRequestedHeight:u},S=c.getCellClass(e),x={cellElement:s,dataField:C,rowElement:p,value:y,record:a,column:c,size:D,grid:l,row:m.row,updatingSingleRow:h,isMeasuring:g},R=c.renderer||c.defaultRenderer;l.beforeRenderCell(x),x.cellElement!==s&&(s=x.cellElement),w.syncClassList(s,S);let I=!0;R?(y=c.callback(R,c,[x]),y===void 0&&c.alwaysClearCell===!1&&(I=!1)):C&&(y=C.print(y));const M=(t=l.hasFrameworkRenderer)==null?void 0:t.call(l,{cellContent:y,column:c});M&&a.isSpecialRow&&(y="");const P=M&&!c.data.tree&&!a.isSpecialRow;if(I&&!P){let _=s;(i=f==null?void 0:f.editorContext)!=null&&i.equals(e)&&!f.editor.isFinishing&&(_=o.moveContentFromCell(s,f.editor.element));const A=y!=null&&typeof y=="object",z=typeof y=="string",Y=A||y==null?"":String(y);if(o.forceInnerHTML&&(_.innerHTML="",delete _._content,s.lastDomConfig=null),!A&&c.htmlEncode&&!c.disableHtmlEncode?s._hasHtml?(_.innerText=Y,s._hasHtml=!1):w.setInnerText(_,Y):c.autoSyncHtml&&(!z||w.getChildElementCount(_))?z?w.sync(Y,_.firstElementChild):A&&X.sync({domConfig:y,targetElement:_}):A?X.sync({targetElement:_,domConfig:{onlyChildren:!0,children:H.asArray(y)}}):_._content!==Y&&(_.innerHTML=_._content=Y),_!==s){const{firstChild:V}=s;for(const U of _.childNodes)s.insertBefore(U,V)}}return a.isSpecialRow||(n=l.processCellContent)==null||n.call(l,{cellElementData:m,rendererData:x,rendererHtml:x.rendererHtml||y}),c.autoHeight&&D.height==null&&(s.classList.add("b-measuring-auto-height"),D.height=Math.max(s.offsetHeight,l.rowHeight),s.classList.remove("b-measuring-auto-height")),g||o.rowManager.trigger("renderCell",x),D}moveContentFromCell(e,r){vp.setStart(e,0),vp.setEndBefore(r);const t=document.createElement("div");return t.appendChild(vp.extractContents()),t}};E(Jl,"$name","Row"),Jl.initClass(),Jl._$name="Row";var Ql=class extends ${static get $name(){return"Bar"}static get type(){return"gridbar"}static get defaultConfig(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"}}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this,{hasFlex:r}=e.columns;let t;e.columns.traverse(i=>{const n=e.getBarCellElement(i.id),s=w.setLength(i.width),a=w.setLength(i.minWidth),o=w.setLength(i.maxWidth);if(n){if(t=s,n.style.maxWidth=o,i.isParent&&i.width==null&&i.flex==null){const l=i.children.reduce((c,d)=>c+=!d.hidden&&d.flex||0,0);n.style.flex=l>0?`${l} 0 auto`:"",n.style.minWidth=null,l>0&&i.traverse(c=>c.data.minWidth=null)}else if(parseInt(i.minWidth)>=0&&(n.style.minWidth=a),n.style.flex=n.style.flexBasis=n.style.width="",i.flex)!isNaN(parseInt(i.flex))&&i.children?n.style.flex=`${i.flex} 0 auto`:n.style.flex=i.flex;else if(parseInt(i.width)>=0){const l=i.parent;e.isHeader&&!l.isRoot&&!l.width?n.style.width=s:n.style.flexBasis=t}i.height>=0&&(n.style.height=w.setLength(i.height))}}),e.scrollable.element.classList.toggle("b-has-flex",r)}getLrPadding(e){if(!this.cellLrPadding){const r=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(r.getPropertyValue("padding-left"))+parseInt(r.getPropertyValue("padding-right"))+parseInt(r.getPropertyValue("border-left-width"))+parseInt(r.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}};Ql.initClass(),Ql._$name="Bar";var Iu=class extends Ql{static get $name(){return"Footer"}static get type(){return"gridfooter"}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return tr.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}" role="presentation">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}" role="presentation"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map(r=>tr.tpl`
                <div
                    class="b-grid-footer ${r.align?`b-grid-footer-align-${r.align}`:""} ${r.cls||""}"
                    data-column="${r.field||""}" data-column-id="${r.id}" data-all-index="${r.allIndex}"
                    role="presentation">
                    ${r.footerText||""}
                </div>`).join("")}fixFooterWidths(){this.fixCellWidths()}};Iu.initClass(),Iu._$name="Footer";var Pu=class extends Q{static get pluginConfig(){return{chain:["destroy"],assign:["topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}static get defaultConfig(){return{rowClass:Jl,prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this._rows.forEach(e=>e.destroy()),super.doDestroy()}initWithHeight(e,r=!1){const t=this;return t.autoHeight&&(e=t.store.allCount*t.preciseRowOffsetHeight),t.viewHeight=e,t.calculateRowCount(r),e}reinitialize(e=!1){const r=this;r.calculateRowCount(!1,!0,!0),r.topIndex+r.rowCount-1>r.store.count&&(e=!0);const t=r.topRow&&!e?r.topRow.top:0;r.scrollTargetRecordId=null,e&&(r.topIndex=r.lastScrollTop=0);const{topRow:i}=r;i&&(i.dataIndex=r.topIndex,i.setTop(t,!0)),r.estimateTotalHeight(),r.renderFromRow(i)}matchRowCount(e=!1){var r,t;const i=this,{rows:n,grid:s,rowClass:a}=i,o=n.length,l=o-i.rowCount;if(l)if(l<0){const c=[];for(let d=o,u=o?n[o-1].dataIndex+1:0;d<i.rowCount;d++,u++)c.push(a.new({cls:s.rowCls,rowManager:i,grid:s,index:d,dataIndex:u}));n.push.apply(n,c),i.trigger("addRows",{rows:c}),e||i.renderFromRow(n[Math.max(0,o-1)])}else{const{focusedCell:c}=s,d=(c==null?void 0:c.id)!=null&&((r=c==null?void 0:c.cell)==null?void 0:r.contains(w.getActiveElement(s))),u=n.splice(o-l,l);d&&(l===o?s.onFocusedRowDerender():((t=i.getRowFor(c._record))==null?void 0:t.index)>=n.length&&n[n.length-1].cells[c.columnIndex].focus()),i.trigger("removeRows",{rows:u}),u.forEach(h=>h.destroy())}}calculateRowCount(e=!1,r=!0,t=!1){var i,n;const s=this,{store:a}=s,o=Math.ceil(s.viewHeight/s.minRowOffsetHeight),l=o+s.prependRowBuffer+s.appendRowBuffer;if(!((i=s.grid.columns)!=null&&i.count)||isNaN(o))return s.rowCount=0,0;if(l<s.rowCount&&!r)return s.rowCount;if(s.visibleRowCount=o,s.rowCount=Math.min(a.count,l),!e){if(s.rows&&s.rowCount!==s.rows.length){if(s.matchRowCount(t),((n=s.bottomRow)==null?void 0:n.dataIndex)>=a.count&&s.topRow.dataIndex!==0){const c=s.bottomRow.dataIndex-a.count+1;for(const d of s.rows)d.dataIndex-=c;s.topIndex-=c}}else s.rowCount||s.trigger("changeTotalHeight",{totalHeight:s.totalHeight});s.grid.toggleEmptyText()}return s.rowCount}removeAllRows(){const e=this,{topRow:r}=e,t=r?e.refreshDetails={topRowIndex:r.dataIndex,topRowTop:r.top}:e.refreshDetails,i=e.rows.slice();return e.trigger("removeRows",{rows:i}),e.rows.forEach(n=>n.destroy()),e.rows.length=0,e.idMap={},t}setPosition(e){const{topRow:r}=this,{topRowIndex:t,topRowTop:i}=e;r&&(r.setTop(i),r.dataIndex=t)}get store(){return this.client.store}get rows(){return this._rows}getRow(e){if(this.rowCount)return this.rows[e-this.topIndex]}getRowById(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return e=e.closest(".b-grid-row"),e&&this.getRow(e.dataset.index)}getRowAt(e,r=!1){return r||(e-=k.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=w.roundPx(e),this.rows.find(t=>e>=t.top&&e<t.bottom)}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const r=typeof e=="number"?e:e.index;return this.getRow((r+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}get firstVisibleRow(){return this.rows.find(e=>e.bottom>Math.ceil(this.grid.scrollable.y))}get firstFullyVisibleRow(){return this.rows.find(e=>e.top>=Math.ceil(this.grid.scrollable.y))}get lastVisibleRow(){const{grid:e}=this;return H.findLast(this.rows,r=>r.top<e.scrollable.y+e.bodyHeight)}get lastFullyVisibleRow(){const{grid:e}=this;return H.findLast(this.rows,r=>r.bottom<e.scrollable.y+e.bodyHeight)}offsetRows(e){if(e!==0){const{rows:r}=this,{length:t}=r;for(let i=0;i<t;i++)r[i].offset(e)}this.trigger("offsetRows",{offset:e})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(e){const r=this,{grid:t,fixedRowHeight:i}=r,n=r.rowHeight;if(n!==e){if(T.assertNumber(e,"rowHeight"),e<10&&(e=10),r.trigger("beforeRowHeight",{height:e}),r.minRowHeight=r._rowHeight=e,i&&(r.averageRowHeight=e),r.rows.length){const s=t.scrollable.y,a=r.getRowAt(s,!0),o=a?a.top-s:0;let l,c;i?(l=e,c=n):(c=l=r.averageRowHeight,r.clearKnownHeights(),l*=e/n),r.calculateRowCount(!1,!0,!0),r.topRow.setTop(r.topRow.dataIndex*(l+t._rowBorderHeight),!0),r.refresh(),s*(l/c)!==s&&t.scrollRowIntoView(a.id,{block:"start",edgeOffset:o})}r.trigger("rowHeight",{height:e,oldHeight:n})}}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(e,r){const t=this,{heightMap:i}=t;t.fixedRowHeight||(i.has(e)&&(t.totalKnownHeight-=i.get(e)),i.set(e,r),t.totalKnownHeight+=r,r<t.minRowHeight&&(t.minRowHeight=r),t.averageRowHeight=t.totalKnownHeight/i.size)}getOffsetHeight(e){const r=this;return(e&&r.heightMap.get(e.id)||e&&r.grid.getRowHeight(e)||r.averageRowHeight||r.rowHeight)+r.grid._rowBorderHeight}invalidateKnownHeight(e){const r=this;if(!r.fixedRowHeight){const{heightMap:t}=r;e=H.asArray(e),e.forEach(i=>{i&&t.has(i.id)&&(r.totalKnownHeight-=t.get(i.id),t.delete(i.id))}),r.averageRowHeight=r.totalKnownHeight/t.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{store:r}=this;let t=0;for(let i=0;i<e;i++){const n=r.getAt(i);t+=this.getOffsetHeight(n)}return Math.floor(t)}getRecordCoords(e,r=!1,t=!1){const i=this,n=i.getRowById(e);let s=i.client._bodyRectangle;return r||(s=i.client.refreshBodyRectangle()),n?new k(s.x,Math.round(r?n.top:n.top+s.y-i.client.scrollable.y),s.width,n.offsetHeight):i.getRecordCoordsByIndex(i.store.indexOf(e),r,t)}getRecordCoordsByIndex(e,r=!1,t=!1){const i=this,{topRow:n,bottomRow:s}=i,a=i.client._bodyRectangle,{id:o}=i.store.getAt(e),l=i.preciseRowOffsetHeight,c=n.dataIndex,d=s.dataIndex,u=e>d?{index:e-d-1,y:s.bottom,from:"bottomRow"}:e>c/2?{index:e-c,y:n.top,from:"topRow"}:{index:e,y:0,from:"top"},h=i.allHeightsKnown&&!t?i.calculateTop(e):Math.floor(u.y+u.index*l),g=new k(a.x,r?h:h+a.y-i.client.scrollable.y,a.width,Math.floor(i.heightMap.get(o)||l));return g.virtual=!0,g.block=g.bottom<a.y?"start":g.y>a.bottom?"end":"nearest",g}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(e,r){const t=new oe({grid:this.grid,record:e,columnId:r});return!!(t.cell&&t.row.renderCell(t))}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const r=this.getRowById(e.id);r&&this.renderFromRow(r)}renderFromRow(e=null){const r=this,{rows:t,store:i}=r,n=i.count;if(r.calculateRowCount(!1,n<t.length,!0)===0){r.estimateTotalHeight(!0);return}const s=e?t.indexOf(e):0;let a=e?e.dataIndex:t[0].dataIndex;const o=n-a-1,l=Math.min(t.length-1,s+o);let c=t.length-l-1,d=s>0?t[s-1].bottom:t[s].top,u;for(let h=s;h<=l;h++)u=t[h],u.dataIndex=a,u.setTop(d,!0),u.render(a,i.getAt(a++),!1),d+=u.offsetHeight;for(;c-- >0;)r.displayRecordAtTop();r.bottomRow.bottom<r.viewHeight&&r.calculateRowCount(),r.estimateTotalHeight(!0),r.trigger("renderDone")}renderRows(e){let r,t=!1;e=Array.from(e),e.sort((i,n)=>i.dataIndex-n.dataIndex);for(const i of e)r=i.height,i.render(null,null,!1),t|=i.height!==r;t&&this.translateFromRow(e[0]),this.trigger("renderDone")}translateFromRow(e,r=!1){const t=this;let i=e.bottom,n,s;for(s=e.dataIndex+1,n=t.getRow(s);n;n=t.getRow(++s))i=n.translate(i);r||t.estimateTotalHeight(!0)}refresh(){const e=this,{topRow:r}=e;!r||e.grid.refreshSuspended||(e.idMap={},e.renderFromRow(r),e.trigger("refresh"))}jumpToPosition(e,r){const t=this,{store:i,heightMap:n}=t,s=i.count;if(t.allHeightsKnown&&!t.fixedRowHeight){const a=e-t.prependBufferHeight,o=t.grid._rowBorderHeight;let l=0,c=0;for(;l<a;){const u=i.getAt(c);l+=n.get(u.id)+o,c++}const d=Math.max(Math.min(c,s-t.rowCount),0);t.lastScrollTop=e,t.topRow.dataIndex=t.topIndex=d,t.topRow.setTop(t.calculateTop(d),!1),t.refresh()}else{const a=t.preciseRowOffsetHeight,o=r==null?Math.floor(e/a)-t.prependRowBuffer:r-Math.floor(t.rowCount/2),l=Math.max(Math.min(o,s-t.rowCount),0),c=t.client.scrollable.y,d=Math.min(t.client._bodyRectangle.height+c+t.appendBufferHeight,t.totalHeight);if(t.lastScrollTop=e,t.topRow.dataIndex=t.topIndex=l,t.topRow.setTop(Math.floor(l*a),!1),t.refresh(),t.bottomRow.bottom<d)for(t.calculateRowCount(!1,!1,!1);t.bottomRow.bottom<d&&t._rows[t.prependRowBuffer].top<c&&t.bottomRow.dataIndex<s-1;)t.displayRecordAtBottom();t.estimateTotalHeight()}if(r!=null){const{scrollable:a}=t.grid,o=t.getRow(r),l=o&&k.from(o._elementsArray[0]).center.y,c=a.viewport.center.y;o&&(a.y=e=Math.floor(a.y+(l-c)))}return e}warpIfNeeded(e){const r=this,t={newScrollTop:e,deltaTop:e-r.lastScrollTop};if(Math.abs(t.deltaTop)>r.rowCount*r.rowOffsetHeight*3){let i;r.scrollTargetRecordId&&(i=r.store.indexOf(r.scrollTargetRecordId)),r.grid.onFocusedRowDerender(),t.newScrollTop=r.jumpToPosition(e,i),t.deltaTop=0}return t}updateRenderedRows(e,r,t=!1){const i=this,n=i.client._bodyRectangle;if(i.rowCount===0)return 0;let s=i.totalHeight;if(r||Math.abs(e-i.lastScrollTop)>=i.rowOffsetHeight||i.topRow.top>e||i.bottomRow.bottom<e+n.height){const a=i.warpIfNeeded(e);i.scrollTargetRecordId=null,i.lastScrollTop=a.newScrollTop,a.deltaTop>0?i.fillBelow(a.newScrollTop):a.deltaTop<0&&i.fillAbove(a.newScrollTop),!i.fixedRowHeight&&!t&&i.correctError(a,n,e),s=i.estimateTotalHeight()}return s}correctError(e,r,t){const i=this;let n=0;(i.allHeightsKnown||e.deltaTop<0&&t<r.height*2||e.deltaTop>0&&t>i.totalHeight-r.height*2-3)&&(n=i.topRow.top-i.calculateTop(i.topRow.dataIndex)),n&&(i.offsetRows(-n),i.grid.scrollable.y=i.lastScrollTop=i.grid.scrollable.y-n)}fillAbove(e){const r=this,t=e-r.topRow.top-r.prependBufferHeight;let i=0;for(;i>t&&r.topIndex>0;)i-=r.displayRecordAtTop();r.trigger("renderDone")}fillBelow(e){const r=this,t=e-r.topRow.top-r.prependBufferHeight,i=r.store.count,n=r.rowCount;let s=0;for(;s<t&&r.topIndex+n<i&&r.topRow.top+r.topRow.offsetHeight<e;)s+=r.displayRecordAtBottom();r.trigger("renderDone")}estimateTotalHeight(e=!1){const r=this;if(r.grid.renderingRows)return;const t=r.store.count,i=t-r.heightMap.size,{bottomRow:n}=r;let s;if(r.fixedRowHeight)s=t*r.rowOffsetHeight;else{if(s=r.totalKnownHeight+r.heightMap.size*r.grid._rowBorderHeight+i*r.preciseRowOffsetHeight,n&&i){const a=n.bottom;(a>s||r.topIndex+r.rowCount>=t&&s>a&&a>0)&&(s=a,n.dataIndex<t-1&&(s+=(t-1-n.dataIndex)*r.preciseRowOffsetHeight))}s=Math.floor(s)}return s!==r.totalHeight&&r.trigger("changeTotalHeight",{totalHeight:s,immediate:e})!==!1&&(r._totalHeight=s),s}displayRecordAtTop(){var e;const r=this,{grid:t}=r,i=r.topIndex-1,n=r.store.getAt(i),s=r.bottomRow,a=s.top;return r.trigger("beforeTranslateRow",{row:s,newRecord:n}),s.dataIndex===((e=t.focusedCell)==null?void 0:e.rowIndex)&&t.onFocusedRowDerender(),s._top=r.topRow.top-r.getOffsetHeight(n),s.estimatedTop=!r.fixedRowHeight,s.render(i,n,!1),s._top=a,s.setBottom(r.topRow.top),s.estimatedTop=!1,r.topIndex--,r._rows.unshift(r._rows.pop()),s.offsetHeight}displayRecordAtBottom(){var e;const r=this,{grid:t}=r,i=r.topIndex+r.rowCount,n=r.store.getAt(i),s=r.topRow;return r.trigger("beforeTranslateRow",{row:s,newRecord:n}),s.dataIndex===((e=t.focusedCell)==null?void 0:e.rowIndex)&&t.onFocusedRowDerender(),s.dataIndex=i,s.setTop(r.bottomRow.bottom),s.render(i,n,!1),r.topIndex++,r._rows.push(r._rows.shift()),s.offsetHeight}};Pu.featureClass="",Pu._$name="RowManager";var Ok={x:1},YE=e=>e.isSubGrid,qE=class extends xr{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,r=Ok){if(typeof r=="string"&&(r={[r]:1}),r.x){e.owner.initScroll();const t=this.widget.items.filter(YE),i=e.widget.items.filter(YE);for(let n=0,{length:s}=t;n<s;n++)t[n].scrollable.addPartner(i[n].scrollable,"x")}r.y&&super.addPartner(e,"y")}removePartner(e){this.xScrollers.forEach((r,t)=>{r.isDestroyed||r.removePartner(e.xScrollers[t])}),super.removePartner(e)}updateOverflowX(e){var r;const t=e===!1;(r=this.xScrollers)==null||r.forEach(i=>i.overflowX=t?"hidden":"hidden-scroll"),this.widget.virtualScrollers.classList.toggle("b-hide-display",t)}scrollIntoView(e,r){if(e.nodeType===Element.ELEMENT_NODE&&this.element.contains(e)){for(const t of this.xScrollers)if(t.element.contains(e))return t.scrollIntoView(e,r)}else return super.scrollIntoView(e,r)}hasOverflow(e="y"){return e==="y"?this.scrollHeight>this.clientHeight:!1}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}};qE._$name="GridScroller";var es=class extends Ql{get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}get region(){var e;return(e=this.subGrid)==null?void 0:e.region}changeElement(e,r){const{region:t}=this;return this.getConfig("columns"),super.changeElement({className:{"b-grid-header-scroller":1,[`b-grid-header-scroller-${t}`]:t},children:[{reference:"headersElement",className:{"b-grid-headers":1,[`b-grid-headers-${t}`]:t},dataset:{region:t,reference:"headersElement",maxDepth:this.maxDepth}}]},r)}get overflowElement(){return this.headersElement}getColumnConfig(e){const{id:r,align:t,resizable:i,isLeaf:n,isParent:s,isLastInSubGrid:a,cls:o,childLevel:l,field:c,tooltip:d,children:u,isFocusable:h,grid:g}=e,f=g==null?void 0:g.focusedCell,m=(f==null?void 0:f.rowIndex)===-1&&(f==null?void 0:f.column)===e;if(e.isVisible)return{className:{"b-grid-header":1,"b-grid-header-parent":s,[`b-level-${l}`]:1,[`b-depth-${e.meta.depth}`]:1,[`b-grid-header-align-${t}`]:t,"b-grid-header-resizable":i&&n,[o]:o,"b-collapsible":e.collapsible,"b-last-parent":s&&a,"b-last-leaf":n&&a},role:h?"columnheader":"presentation","aria-sort":"none","aria-label":e.ariaLabel,[h?"tabIndex":""]:m?0:-1,dataset:{...ve.encodeConfig(d),columnId:r,[c?"column":""]:c},children:[{className:"b-grid-header-text",children:[{[g&&h?"id":""]:`${g==null?void 0:g.id}-column-${e.id}`,className:"b-grid-header-text-content"}]},u?{className:"b-grid-header-children",children:u.map(p=>this.getColumnConfig(p)),syncOptions:{syncIdField:"columnId"}}:null,{className:"b-grid-header-resize-handle"}]}}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach(r=>{e+=r.calculateMinWidth()}),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse(r=>{const t=e.getBarCellElement(r.id);if(t){let i=r.headerText;r.headerRenderer&&(i=r.headerRenderer.call(r.thisObj||e,{column:r,headerElement:t})),r.headerWidgetMap&&Object.values(r.headerWidgetMap).forEach(s=>{s.render(r.textWrapper)}),r.icon&&(i=`<i class="${O.encodeHtml(r.icon)}"></i>`+(i||""));const n=t.querySelector(".b-grid-header-text-content");n&&(n.innerHTML=i||"")}}),e.fixHeaderWidths()}get columns(){const e=this,r=super.columns;return e.columnsDetacher||(e.columnsDetacher=r.ion({change(){e.initDepths()},thisObj:e}),e.initDepths()),r}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,r=null){const t=this;let i=0;r!=null&&r.meta&&r.meta.depth++;for(const n of e){const{meta:s}=n;s.depth=0,n.children&&(t.initDepths(n.children.filter(t.columns.chainedFilterFn),n),s.depth&&r&&(r.meta.depth+=s.depth)),s.depth>i&&(i=s.depth)}return r||(t.maxDepth=i),i}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;X.sync({domConfig:{children:e.columns.topColumns.map(r=>e.getColumnConfig(r)),onlyChildren:!0},targetElement:e.contentElement,strict:!0,syncIdField:"columnId",releaseThreshold:0}),e.refreshHeaders()}onPaint({firstPaint:e}){e&&this.refreshContent()}};E(es,"$name","Header"),E(es,"type","gridheader"),es.initClass(),es._$name="Header";var yp={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",pointerover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"},KE=["pageX","pageY","clientX","clientY","screenX","screenY"];function ec(e,r=!0){e==null||e.classList.toggle("b-hover",r)}function Au(e,r,t=!0){r&&e&&ec(r.getCell(e),t)}var XE=e=>class extends(e||F){static get $name(){return"GridElementEvents"}static get configurable(){return{hoveredCell:null,longPressTime:400,enableUndoRedoKeys:!0,keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}initInternalEvents(){const t=Object.keys(yp),i=t.length,n={element:this.bodyElement,thisObj:this};for(let s=0;s<i;s++){const a=t[s];n[a]={handler:"handleEvent"},a.startsWith("touch")&&(n[a].passive=!1)}B.on(n),B.on({focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}getCellDataFromEvent(t,i=!1){var n;const s=this,{columns:a}=s,{target:o}=t;let l=o.closest(".b-grid-cell");if(!l&&i&&!o.classList.contains("b-grid-row")&&!o.classList.contains("b-grid-subgrid")){const{top:c,left:d,right:u,bottom:h}=s.bodyContainer.getBoundingClientRect();let g,{x:f,y:m}=t;f>=d&&f<=u?m=g=Math.ceil(s[`${m<c?"first":"last"}FullyVisibleRow`].element.getBoundingClientRect().y):m>=c&&m<=h&&(f=g=Math.ceil(a.visibleColumns[f<d?0:a.visibleColumns.length-1].element.getBoundingClientRect().x)),g!==void 0&&(l=(n=w.childFromPoint(t.target,t.offsetX,t.offsetY))==null?void 0:n.closest(".b-grid-cell"))}if(l){const c=Ge.get(l),{id:d,columnId:u}=c,h=s.store.getById(d),g=a.getById(u);return h?{cellElement:l,cellData:c,columnId:u,id:d,record:h,column:g,cellSelector:{id:d,columnId:u}}:null}}getHeaderDataFromEvent(t){const i=t.target.closest(".b-grid-header");if(i){const n=T.assign({},i.dataset),{columnId:s}=n,a=this.columns.getById(s);return a?{headerElement:i,headerData:n,columnId:s,column:a}:null}}handleEvent(t){!this.disabled&&yp[t.type]&&this[yp[t.type]](t)}onElementTouchStart(t){const i=this,n=i.getCellDataFromEvent(t);w.isTouchEvent=!0,t.touches.length===1&&(i.longPressTimeout=i.setTimeout(()=>{i.onElementLongPress(t),t.preventDefault(),i.longPressPerformed=!0},i.longPressTime)),n&&!t.defaultPrevented&&i.onFocusGesture(t)}onElementTouchMove(t){const i=this,{lastTouchTarget:n}=i,s=t.changedTouches[0],{pageX:a,pageY:o}=s,l=document.elementFromPoint(a,o);if(i.longPressTimeout&&(i.clearTimeout(i.longPressTimeout),i.longPressTimeout=null),l!==n){if(n){const c=new MouseEvent("mouseout",T.copyProperties({relatedTarget:l,pointerType:"touch",bubbles:!0},s,KE));c.preventDefault=()=>t.preventDefault(),n==null||n.dispatchEvent(c)}if(l){const c=new MouseEvent("mouseover",T.copyProperties({relatedTarget:n,pointerType:"touch",bubbles:!0},s,KE));c.preventDefault=()=>t.preventDefault(),l==null||l.dispatchEvent(c)}}i.lastTouchTarget=l}onElementTouchEnd(t){const i=this;i.longPressPerformed&&(t.cancelable&&t.preventDefault(),i.longPressPerformed=!1),i.longPressTimeout&&(i.clearTimeout(i.longPressTimeout),i.longPressTimeout=null)}onElementLongPress(t){}triggerCellMouseEvent(t,i,n=this.getCellDataFromEvent(i)){var s;const a=this;if(n){const o=a.columns.getById(n.columnId),l={grid:a,record:n.record,column:o,cellSelector:n.cellSelector,cellElement:n.cellElement,target:i.target,event:i};a.trigger("cell"+O.capitalize(t),l),t==="click"&&((s=o.onCellClick)==null||s.call(o,l))}}onElementMouseDown(t){const i=this,n=i.getCellDataFromEvent(t);i.skipFocusSelection=!0,i.isScrollbarOrRowBorderOrSplitterClick(t)?t.preventDefault():(i.triggerCellMouseEvent("mousedown",t,n),n&&!t.defaultPrevented&&i.onFocusGesture(t))}isScrollbarOrRowBorderOrSplitterClick({target:t,x:i,y:n}){if(t.closest(".b-grid-splitter")||t.matches(".b-grid-row, .b-virtual-width"))return!0;if(t.matches(".b-vertical-overflow")){const s=t.getBoundingClientRect();return i>s.right-w.scrollBarWidth}else if(t.matches(".b-horizontal-overflow")){const s=t.getBoundingClientRect();return n>s.bottom-w.scrollBarWidth-1}}onElementMouseMove(t){this.mouseMoveEvent=t}onElementMouseUp(t){}onElementPointerDown(t){}onElementPointerUp(t){}onHandleElementClick(t){this.trigger("beforeElementClick",{event:t})!==!1&&this.onElementClick(t)}onElementClick(t){const i=this,n=i.getCellDataFromEvent(t);n&&i.triggerCellMouseEvent("click",t,n)}onFocusGesture(t){var i;const n=this,{navigationEvent:s}=n,{target:a}=t,o=t.button===2,l=!o&&a.matches(".b-icon-tree-expand, .b-icon-tree-collapse"),c=!document.hasFocus()&&q.isMac&&o;if(l||c)t.preventDefault();else{n.navigationEvent=t;const d=new oe(a);if(o||(i=n.focusedCell)!=null&&i.equals(d)){let u;globalThis.TouchEvent&&t instanceof MouseEvent&&s instanceof TouchEvent&&a===s.target&&(u={doSelect:!1}),n.focusCell(d,u)}}}onElementDblClick(t){const{target:i}=t;if(this.triggerCellMouseEvent("dblClick",t),i.classList.contains("b-grid-header-resize-handle")){const n=i.closest(".b-grid-header");this.columns.getById(n.dataset.columnId).resizeToFitContent()}}onElementMouseOver(t){var i;if(!this.scrolling){const n=this,{hoveredCell:s}=n,a=(typeof t.buttons!="number"||t.buttons===0)&&t.pointerType!=="touch";let o=t.target.closest(".b-grid-cell");!o&&t.target.classList.contains("b-grid-row")&&(o=(i=w.childFromPoint(t.target,t.offsetX,t.offsetY-2))==null?void 0:i.closest(".b-grid-cell")),o&&(a&&(n.hoveredCell=o),!s&&n.hoveredCell&&n.triggerCellMouseEvent("mouseOver",t)),n.trigger("mouseOver",{event:t})}}onElementMouseOut(t){var i;const n=this,{hoveredCell:s}=n,{target:a,relatedTarget:o}=t;o!=null&&o.closest(".b-grid-cell")&&a.matches(".b-grid-row")||(o&&a.matches(".b-grid-cell")&&!a.contains(o)?o!=null&&o.matches(".b-grid-row")||(n.hoveredCell=o.closest(".b-grid-cell")):!(o!=null&&o.matches(".b-grid-row,.b-grid-cell"))&&!((i=n.hoveredCell)!=null&&i.contains(o))&&(n.hoveredCell=null)),n.scrolling||(s&&!n.hoveredCell&&n.triggerCellMouseEvent("mouseOut",t),n.trigger("mouseOut",{event:t}))}updateHoveredCell(t,i){var n,s,a,o;const l=this,{selectionMode:c}=l,d=c.rowNumber&&((n=l.columns.find(h=>h.type=="rownumber"))==null?void 0:n.id),u=c.checkbox&&((s=l.checkboxSelectionColumn)==null?void 0:s.id);if(i){ec(i,!1);const h=Ge.get(i),{row:g}=h;g&&!g.isDestroyed&&(Au(d,g,!1),Au(u,g,!1)),h!=null&&h.columnId&&ec((a=l.columns.getById(h.columnId))==null?void 0:a.element,!1)}if(l._hoveredRow&&!l._hoveredRow.isDestroyed&&l._hoveredRow.removeCls("b-hover"),l._hoveredRow=null,t&&!l.scrolling){const h=Ge.get(t),{row:g}=h;g?c.cell&&h.columnId!==d&&h.columnId!==u?(ec(t),Au(u,g),Au(d,g),ec((o=l.columns.getById(h.columnId))==null?void 0:o.element)):(l._hoveredRow=g,g.addCls("b-hover")):l.hoveredCell=null}}keyMapOnKeyDown(t){this.element.contains(t.target)&&(this.onElementKeyDown(t),super.keyMapOnKeyDown(t))}onElementKeyDown(t){var i,n;if(t.handled||!this.element.contains(t.target))return;const s=this,a=s.focusedCell;if(a!=null&&a.isCell&&!a.isActionable){const o=a.cell;(n=(i=s.columns.getById(o.dataset.columnId)).onCellKeyDown)==null||n.call(i,{event:t,cellElement:o})}}undoRedoKeyPress(t){var i;const{stm:n}=this.store;return n&&this.enableUndoRedoKeys&&!((i=this.features.cellEdit)!=null&&i.isEditing)?(n.onUndoKeyPress(t),!0):!1}clickCellByKey(t){const i=this,n=i.focusedCell,s=n==null?void 0:n.cell,a=i.columns.getById(s.dataset.columnId);return n!=null&&n.isCell&&!n.isActionable&&a.onCellClick?(a.onCellClick({grid:i,column:a,record:i.store.getById(n.id),cellElement:s,target:t.target,event:t}),!0):!1}onElementKeyPress(t){}onElementKeyUp(t){}onElementContextMenu(t){const i=this,n=i.getCellDataFromEvent(t);n&&(i.triggerCellMouseEvent("contextMenu",t,n),w.isTouchEvent&&i.onFocusGesture(t))}onInternalResize(t,i,n,s,a){const o=this;o._devicePixelRatio&&o._devicePixelRatio!==globalThis.devicePixelRatio&&w.resetScrollBarWidth(),o._devicePixelRatio=globalThis.devicePixelRatio,o._bodyRectangle=k.client(o.bodyContainer),super.onInternalResize(...arguments),n!==a&&(o._bodyHeight=o.bodyContainer.offsetHeight,o.isPainted&&o.rowManager.initWithHeight(o._bodyHeight)),o.refreshVirtualScrollbars(),i!==s&&o.setTimeout(()=>{o.isDestroyed||o.updateResponsive(i,s)},0)}get widgetClass(){}},Lk={string:1,object:1,function:1},ZE=e=>class extends(e||F){static get $name(){return"GridFeatures"}set features(t){const i=this,n=j.getInstanceDefaultFeatures(this);t=i._features=T.assign({},t),n&&Object.keys(n).forEach(a=>{a in t||(t[a]=!0)});const s=j.getInstanceFeatures(this);for(const a of Object.keys(t)){const o=t[a];if(o){const l=!globalThis.__bryntum_code_editor_changed;if(O.uncapitalize(a)!==a){const d=`Invalid feature name '${a}', must start with a lowercase letter`;if(l)throw new Error(d);console.error(d),i._errorDuringConfiguration=d}const c=s[a];if(!c){const d=`Feature '${a}' not available, make sure you have imported it`;if(l)throw new Error(d);console.error(d),i._errorDuringConfiguration=d;return}Reflect.defineProperty(t,a,i.createFeatureInitializer(t,a,c,o))}}}get features(){return this._features}createFeatureInitializer(t,i,n,s){const a=[this],o=n.prototype.construct;return s===!0&&(s={}),Lk[typeof s]&&(a[1]=s),{configurable:!0,get(){return delete t[i],n.prototype.construct=function(...l){t[i]=this,o.apply(this,l),n.prototype.construct=o},new n(...a)}}}hasFeature(t){const{features:i}=this;if(i){const n=Object.getOwnPropertyDescriptor(this.features,t);if(n)return!!(n.value||n.get)}return!1}hasActiveFeature(t){var i,n;return!!((i=this.features)!=null&&i[t]&&!((n=this.features)!=null&&n[t].disabled))}getConfigValue(t,i){var n,s;if(t==="features"){const a={};for(const o in this.features){const l=(s=(n=this.features[o])==null?void 0:n.getCurrentConfig)==null?void 0:s.call(n,i);l?T.isEmpty(l)?j.isDefaultFeatureForInstance(this.features[o].constructor,this)||(a[o]=!0):a[o]=l:a[o]=!1}return a}return super.getConfigValue(t,i)}get widgetClass(){}},$k=Object.freeze({}),jk=Object.freeze({x:!1,y:!1}),Bk=function(e){return this.focusableFinderCell.contains(e)?w.isFocusable(e)&&!e.disabled?w.NodeFilter.FILTER_ACCEPT:w.NodeFilter.FILTER_SKIP:w.NodeFilter.FILTER_REJECT},Hk=e=>{var r;return r=class extends(e||F){static get $name(){return"GridNavigation"}onStoreRecordIdChange(t){var i;(i=super.onStoreRecordIdChange)==null||i.call(this,t);const{focusedCell:n}=this,{oldValue:s,value:a}=t;n&&n.id===s&&(n._id=a)}onFocusedRowDerender(){const t=this,{focusedCell:i}=t;if((i==null?void 0:i.id)!=null&&i.cell){const n=i.cell.contains(w.getActiveElement(t));if(t.hideHeaders)n&&t.revertFocus();else{const s=t.normalizeCellContext({rowIndex:-1,columnIndex:n?i.columnIndex:0});n?t.focusCell(s):s.cell.tabIndex=0}i.cell.tabIndex=-1}}navigateFirstCell(){this.focusCell(oe.FIRST_CELL)}navigateFirstColumn(){this.focusCell(oe.FIRST_COLUMN)}navigateLastCell(){this.focusCell(oe.LAST_CELL)}navigateLastColumn(){this.focusCell(oe.LAST_COLUMN)}navigatePrevPage(){this.focusCell(oe.PREV_PAGE)}navigateNextPage(){this.focusCell(oe.NEXT_PAGE)}activateHeader(t){var i;if(t.target.classList.contains("b-grid-header")&&this.focusedCell.isColumnHeader){const{column:n}=this.focusedCell;(i=n.onKeyDown)==null||i.call(n,t),this.getHeaderElement(n.id).click()}return!1}onEscape(t){var i,n;const s=this,{focusedCell:a}=s;!t.target.closest(".b-dragging")&&(a!=null&&a.isActionable)?(t.stopImmediatePropagation(),s._focusedCell=null,s.focusCell({rowIndex:a.rowIndex,column:a.column},{disableActionable:!0})):s.isNested&&s.owner&&!((n=(i=s.owner).catchFocus)!=null&&n.call(i,{source:s}))&&s.revertFocus(!0)}onTab(t){const{target:i}=t,{focusedCell:n,bodyElement:s}=this,{isActionable:a,actionTargets:o}=n;if(a&&w.isEditable(i)&&!i.readOnly&&i===o[o.length-1])t.preventDefault(),this.navigateRight(t);else if(!a||i===o[o.length-1])return s.style.display="none",this.requestAnimationFrame(()=>s.style.display=""),!1}onShiftTab(t){const i=this,{target:n}=t,{focusedCell:s,bodyElement:a}=i,{cell:o,isActionable:l,actionTargets:c}=s,d=l&&w.isEditable(n)&&!n.readOnly,u=s.columnIndex===0&&s.rowIndex===(i.hideHeaders?0:-1);if(!u&&d&&n===c[0])t.preventDefault(),i.navigateLeft(t);else if(!l||n===c[0]){const h=!u&&!i.hideHeaders&&i.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return h?(h.cell.tabIndex=-1,o.tabIndex=0,i._focusedCell=s):(a.style.display="none",i.requestAnimationFrame(()=>a.style.display="")),!1}}onSpace(t){return this.focusedCell.isActionable||t.preventDefault(),!1}get focusedCell(){return this._focusedCell}get isActionableLocation(){var t;return(t=this._focusedCell)==null?void 0:t.isActionable}set focusedCell(t){this.focusCell(t)}get focusedRecord(){var t;return(t=this._focusedCell)==null?void 0:t.record}get cellCSSSelector(){const t=this._focusedCell;return t?`[data-index=${t.rowIndex}] [data-column-id=${t.columnId}]`:""}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=null}isFocused(t){var i;return!!((i=this._focusedCell)!=null&&i.equals(this.normalizeCellContext(t)))}get focusElement(){var t;if(!this.isDestroying){let i;this.store.count&&this._focusedCell?i=this._focusedCell.target:i=this.normalizeCellContext({rowIndex:-1,columnIndex:((t=this._focusedCell)==null?void 0:t.columnIndex)||0}).target;const n=super.focusElement;return n&&(!i||i.compareDocumentPosition(n)===Node.DOCUMENT_POSITION_PRECEDING)?n:i}}onPaint({firstPaint:t}){var i;const n=this;(i=super.onPaint)==null||i.call(this,...arguments);const s=this.normalizeCellContext({rowIndex:n.hideHeaders?0:-1,column:n.hideHeaders?0:n.columns.find(a=>!a.hidden&&a.isFocusable)});if(s.cell){s._isDefaultFocus=!0,n._focusedCell=s;const{target:a}=s;a===s.cell&&(s.cell.tabIndex=0)}}onGridBodyFocusIn(t){var i,n,s;const a=this,{bodyElement:o}=a,l=a.focusedCell,c=(l==null?void 0:l.initialTarget)||(l==null?void 0:l.target),{target:d,relatedTarget:u}=t,h=d.closest(a.focusableSelector);if(h&&(!be.currentMouseDown||be.isMouseDown(0)||be.isMouseDown(2))){const g=new oe(d),{cell:f}=g,m=l==null?void 0:l.cell,p=g.actionTargets=a.findFocusables(h),v=(!a._fromFocusCell||a.selectOnFocus)&&(d===f||a._selectActionCell)&&!(d!=null&&d._isRevertingFocus);if(!a.store.getById(h.parentNode.dataset.id)&&f!==h){f.focus({preventScroll:!0});return}if(d.matches(a.focusableSelector)){if(a.disableActionable)g._target=f;else if(p.length){a._selectActionCell=((i=be.currentMouseDown)==null?void 0:i.target)===d,p[0].focus(),delete a._selectActionCell;return}}else{if(l!=null&&l.target&&u&&(!be.isMouseDown()||!o.contains((n=be.currentMouseDown)==null?void 0:n.target))&&!o.contains(u)&&!g.equals(l)){c.focus();return}g._target=d}if(m&&(m.classList.remove("b-focused"),m.tabIndex=-1),f&&(f.classList.add("b-focused"),g.column.onCellFocus(g),f===d&&(f.tabIndex=0),f.contains(t.relatedTarget)&&c===d))return;a._focusedCell=g,(s=a.onCellNavigate)==null||s.call(a,a,l,g,v),a.trigger("navigate",{lastFocusedCell:l,focusedCell:g,event:t})}else d.closest(".b-rowexpander-body")||c==null||c.focus()}findFocusables(t){const{focusableFinder:i}=this,n=[];i.currentNode=this.focusableFinderCell=t;for(let s=i.nextNode();s;s=i.nextNode())n.push(s);return n}get focusableFinder(){const t=this;return t._focusableFinder||(t._focusableFinder=t.setupTreeWalker(t.bodyElement,w.NodeFilter.SHOW_ELEMENT,{acceptNode:Bk.bind(t)})),t._focusableFinder}restoreActiveItem(t=this._focusedCell){if(this.rowManager.count)return isNaN(t)?t.isModel||(t=this.store.getById(t)):t=this.store.getAt(t),this.focusCell(t)}focusCell(t,i=$k){var n,s,a,o;const l=this,{_focusedCell:c}=l,{scroll:d,disableActionable:u}=i,h=t===oe.DOWN,g=t===oe.UP;if((t==null?void 0:t.rowIndex)===-1&&l.hideHeaders){l.revertFocus();return}t=typeof t=="number"&&(c!=null&&c.isLocation)?c.move(t):l.normalizeCellContext(t);const f="doSelect"in i?i.doSelect:!t.isActionable||t.initialTarget===t.cell;if(t.equals(c))return l.isNested&&(h||g)?(s=(n=l.owner)==null?void 0:n.catchFocus)!=null&&s.call(n,{source:l,navigationDirection:h?"down":"up"})||l.revertFocus(!0):(a=l.onCellNavigate)==null||a.call(l,l,c,t,f),c;const m=l.getSubGridFromColumn(t.columnId),{cell:p}=t,v=p||l.getCell({rowIndex:l.rowManager.topIndex,columnId:t.columnId}),y=k.from(m.element),C=k.from(l.bodyElement),D=k.from(v).moveTo(null,y.y);return d===!1||t.rowIndex===-1?i=Object.assign({},i,jk):(i=Object.assign({},i,d),D.width>y.width||D.height>C.height?i.x=i.y=!1:i.column=t.columnId,l.scrollRowIntoView(t.id,i)),(l._hoveredRow||l.hoveredCell)&&(l.hoveredCell=null),l.disableActionable=u,l.selectOnFocus=f,l._fromFocusCell=!0,(o=t[u?"cell":"target"])==null||o.focus({preventScroll:!0}),l.disableActionable=l.selectOnFocus=!1,delete l._fromFocusCell,t}blurCell(t){const i=this,n=i.getCell(t);n&&n.classList.remove("b-focused")}clearFocus(t){const i=this;i._focusedCell&&(i.lastFocusedCell=t?null:i._focusedCell,i.blurCell(i._focusedCell),i._focusedCell=null)}catchFocus(){}internalNextPrevCell(t=!0){const i=this,n=i._focusedCell;return n?i.focusCell({id:n.id,columnId:i.columns.getAdjacentVisibleLeafColumn(n.column,t,!0).id}):null}navigateRight(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(this.rtl?oe.PREV_CELL:oe.NEXT_CELL):(arguments[0]&&ne.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!this.rtl))}navigateLeft(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(this.rtl?oe.NEXT_CELL:oe.PREV_CELL):(arguments[0]&&ne.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!!this.rtl))}internalNextPrevRow(t,i=!0,n=!0){const s=this,a=s._focusedCell;if(!a)return!1;const o=s.store[`get${t?"Next":"Prev"}`](a.id,!1,i);return o?s.focusCell({id:o.id,columnId:a.columnId,scroll:{x:!1}}):(!t&&n&&!a.isColumnHeader&&(this.clearFocus(),this.getHeaderElement(a.columnId).focus()),!1)}navigateDown(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(oe.DOWN):(arguments[0]&&ne.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!0,!1))}navigateUp(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(oe.UP):(arguments[0]&&ne.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!1,!1))}get widgetClass(){}},E(r,"configurable",{focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0",isNested:!1,keyMap:{ArrowUp:{handler:"navigateUp",weight:10},ArrowRight:{handler:"navigateRight",weight:10},ArrowDown:{handler:"navigateDown",weight:10},ArrowLeft:{handler:"navigateLeft",weight:10},"Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateHeader",Escape:{handler:"onEscape",weight:10},"Shift+Tab":{handler:"onShiftTab",preventDefault:!1,weight:200},Tab:{handler:"onTab",preventDefault:!1,weight:200}," ":{handler:"onSpace",preventDefault:!1}}}),r},JE=e=>class extends(e||F){static get $name(){return"GridResponsive"}static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(t){const i=this,n=Object.keys(T.assign({},i.responsiveLevels));let s=null,a=99995,o=null;return n.forEach(l=>{let c=i.responsiveLevels[l];if(["number","string"].includes(typeof c)||(c=c.levelWidth),c==="*")o=l;else if(t<c){const d=c-t;d<a&&(a=d,s=l)}}),s||o}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(t,i){const n=this,s=n.getClosestBiggerLevel(i),a=n.getClosestBiggerLevel(t);if(i===0||s!==a){const o=n.responsiveLevels[a];["number","string"].includes(typeof o)||n.applyState(o),n.columns.forEach(l=>{const c=l.responsiveLevels;c&&(c[a]?l.applyState(c[a]):c["*"]&&l.applyState(c["*"]))}),n.element.classList.remove("b-responsive-"+s),n.element.classList.add("b-responsive-"+a),n.trigger("responsive",{level:a,width:t,oldLevel:s,oldWidth:i})}}get widgetClass(){}},Vk={string:1,number:1},Nk={dataset:1,batch:1},QE=e=>{var r;return r=class extends(e||F){static get $name(){return"GridSelection"}construct(t){this._selectedCells=[],this._selectedRows=[],super.construct(t),t!=null&&t.selectedRecords&&(this.selectedRecords=t.selectedRecords)}getDefaultGridSelection(t){if(t.$name==="GridSelection")return t.configurable.selectionMode;if(t.superclass)return this.getDefaultGridSelection(t.superclass)}changeSelectionMode(t){const i=this;return i.selectionMode?(T.assign(i.selectionMode,t),i.selectionMode):(i.$defaultGridSelection=i.getDefaultGridSelection(i.constructor),new Proxy(t,{set(n,s,a){const o=T.assign({},n);return n[s]=a,i.updateSelectionMode(n,o),!0}}))}updateSelectionMode(t,i=this.$defaultGridSelection){var n,s;const a=this,{columns:o,checkboxSelectionColumn:l}=a,c={},{rowReorder:d}=a.features;for(const u in t)t[u]!=i[u]&&(c[u]=t[u]);t.rowCheckboxSelection&&!t.checkboxOnly&&(t.checkboxOnly=!0,delete t.rowCheckboxSelection),c.column&&(t.cell=!0,t.multiSelect=!0),c.cell&&(t.checkboxOnly=!1),c.cell===!1&&(t.column=!1),c.checkboxOnly&&(t.checkbox||(t.checkbox=!0),t.cell=!1),c.checkbox===!1&&(c.checkboxOnly=!1,c.showCheckAll=!1),c.showCheckAll&&(t.checkbox=t.checkbox||!0,t.multiSelect=!0),(c.includeChildren||c.includeParents)&&(t.multiSelect=!0),c.multiSelect===!1&&(t.column=t.showCheckAll=t.dragSelect=t.includeChildren=t.includeParents=!1),c.dragSelect&&(d!=null&&d.enabled&&d.gripOnly!==!0&&(d.showGrip=d.gripOnly=!0),t.multiSelect=!0,a._selectionListenersDetachers={}),c.dragSelect===!1&&a._selectionListenersDetachers&&((s=(n=a._selectionListenersDetachers).selectiondrag)==null||s.call(n),delete a._selectionListenersDetachers.selectiondrag),i&&(c.cell!==void 0||c.deselectFilteredOutRecords!==void 0||c.multiSelect!==void 0)&&a.deselectAll(),c.rowNumber?o.findRecord("type","rownumber")||(o.insert(0,{...typeof t.rowNumber=="object"?t.rowNumber:{},type:"rownumber"}),a._selectionAddedRowNumberColumn=!0):c.rowNumber===!1&&a._selectionAddedRowNumberColumn&&(o.remove(o.findRecord("type","rownumber")),delete a._selectionAddedRowNumberColumn),(t.checkbox!==(i==null?void 0:i.checkbox)||t.checkbox&&t.showCheckAll!==(i==null?void 0:i.showCheckAll))&&(a.isConfiguring?a.shouldInitCheckboxSelection=!0:(i&&a.deselectAll(),a.initCheckboxSelection())),i&&t.checkbox&&i.checkbox&&t.checkboxIndex!==i.checkboxIndex&&l&&l.parent.insertChild(l,o.getAt(a.checkboxSelectionColumnInsertIndex)),a.trigger("selectionModeChange",T.clone(t)),a.afterSelectionModeChange(t)}afterConfigure(){this.shouldInitCheckboxSelection&&(this.shouldInitCheckboxSelection=!1,this.initCheckboxSelection()),super.afterConfigure()}initCheckboxSelection(){var t,i;const n=this,{selectionMode:s,columns:a,checkboxSelectionColumn:o}=n,{checkbox:l}=s;if(o&&(n.checkboxSelectionColumn=null,a.remove(o)),l){const c=Z.getColumnClass("check"),d=l===!0?null:l;if(!c)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const u=n.checkboxSelectionColumn=new c(T.assign({id:`${n.id}-selection-column`,width:"4em",minWidth:"4em",field:null,sortable:!1,filterable:!1,hideable:!1,cellCls:"b-checkbox-selection",region:(i=(t=n.items)==null?void 0:t[0])==null?void 0:i.region,showCheckAll:s.showCheckAll,draggable:!1,resizable:!1,widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},d),a,{isSelectionColumn:!0});u.meta.depth=0,u._grid=n;const h=u.renderer;u.renderer=g=>{g.value=n.isSelected(g.record),h.call(u,g)},u.ion({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:n}),a.insert(n.checkboxSelectionColumnInsertIndex,u)}}get checkboxSelectionColumnInsertIndex(){const{columns:t}=this;let{checkboxIndex:i}=this.selectionMode;return i?typeof i=="string"&&(i=t.indexOf(t.getById(i))):i=t.indexOf(t.findRecord("type","rownumber"))+1,i}afterSelectionChange(){}afterSelectionModeChange(){}changeSelectedRecordCollection(t){return t!=null&&t.isCollection?(t.owner||(t.owner=this),t):$t.new(t,{owner:this})}updateSelectedRecordCollection(t){t.ion({change:"onSelectedRecordCollectionChange",thisObj:this})}onSelectedRecordCollectionChange({added:t=[],removed:i}){this.selectedRecordCollection._fromSelection!==this&&(t=t.filter(n=>this.isSelectable(n)),this.performSelection({selectedCells:[],deselectedCells:[],selectedRecords:t,deselectedRecords:i}))}changeSelectedRecordCollectionSilent(t){this.selectedRecordCollection._fromSelection=this;const i=t(this.selectedRecordCollection);return delete this.selectedRecordCollection._fromSelection,i}bindStore(t){var i;this.detachListeners("selectionStoreFilter"),t.ion({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),(i=super.bindStore)==null||i.call(this,t)}unbindStore(t){this.detachListeners("selectionStoreFilter"),super.unbindStore(t)}onStoreFilter({source:t}){const i=this,n=[];for(const a of i.selectedRows)t.includes(a)||n.push(a);const s=i.prepareSelection(i.selectionMode.deselectFilteredOutRecords?n:[]);if(i.isCellSelectionMode){const{deselectedCells:a}=i.prepareSelection(i.getSelectedCellsForRecords(n));a!=null&&a.length&&(s.deselectedCells=(s.deselectedCells||[]).concat(a))}(s.deselectedCells.length||s.deselectedRecords.length)&&(i.performSelection(s,!1),i.updateCheckboxHeader())}onStoreRecordIdChange({record:t,oldValue:i}){var n;(n=super.onStoreRecordIdChange)==null||n.call(this,...arguments),this.selectedRecordCollection.get(i)===t&&this.selectedRecordCollection.rebuildIndices()}onStoreRemove(t){var i;if((i=super.onStoreRemove)==null||i.call(this,t),!t.isCollapse){const n=this,s=t.records.filter(a=>this.isSelected(a));if(s.length){const a=n.prepareSelection(s);if(n.isCellSelectionMode){const{deselectedCells:o}=n.prepareSelection(n.getSelectedCellsForRecords(s));o!=null&&o.length&&(a.deselectedCells=(a.deselectedCells||[]).concat(o))}n.performSelection(a)}}}onStoreDataChange({action:t,source:i}){var n;const s=this,{selectionMode:a}=s;let o;if((n=super.onStoreDataChange)==null||n.call(this,...arguments),t==="pageLoad")a.preserveSelectionOnPageChange||(o=s.prepareSelection(null,null,!0)),s.updateCheckboxHeader();else if(Nk[t]){const l=[];if(a.preserveSelectionOnDatasetChange===!1)o=s.prepareSelection(null,null,!0);else{l.push(...s.changeSelectedRecordCollectionSilent(c=>c.match(i.storage)));for(const c of s._selectedCells)i.getById(c.id)||l.push(c);o=s.prepareSelection(l)}}o&&(o.deselectAll||o.deselectedCells.length||o.deselectedRecords.length||o.selectedCells.length||o.selectedRecords.length)&&(s.performSelection(o,!1),s.updateCheckboxHeader())}onStoreRemoveAll(){var t;(t=super.onStoreRemoveAll)==null||t.call(this),this.performSelection(this.prepareSelection(null,null,!0),!1)}onCheckChange({checked:t,record:i}){const n=this,s=!n.selectionMode.multiSelect&&t,a=!s&&!t?[i]:null,o=t?[i]:null;t&&!be.shiftKeyDown&&(n._lastSelectionChecked=i),t&&n._lastSelectionChecked&&be.shiftKeyDown?n.performSelection(n.internalSelectRange(n._lastSelectionChecked,i,!0)):n.performSelection(n.prepareSelection(a,o,s,!0))}updateCheckboxHeader(){const{selectionMode:t,checkboxSelectionColumn:i,store:n}=this;if(t.checkbox&&t.showCheckAll&&(i!=null&&i.headerCheckbox)){const s=n.count&&!n.some(a=>this.isSelectable(a)&&!this.isSelected(a));i.headerCheckbox.checked!==s&&(i.suspendEvents(),i.headerCheckbox.checked=s,i.resumeEvents())}}onCheckAllChange({checked:t}){this[t?"selectAll":"deselectAll"](this.store.isPaged&&this.selectionMode.preserveSelectionOnPageChange)}get selectionDragMouseEventListenerElement(){return globalThis}onSelectionDrag(t){var i;const n=this,{_selectionStartCell:s}=n;if(be.isMouseDown()||n.onSelectionEnd(),!s)return;const{items:a,_lastSelectionDragRegion:o}=n,l=n.getCellDataFromEvent(t,!0),c=l==null?void 0:l.column.region,d=(l==null?void 0:l.cellSelector)&&n.normalizeCellContext(l.cellSelector);if(d&&!d.equals(n._lastSelectionDragCell,!0)){if(n._isSelectionDragging||n.enableScrollingCloseToEdges(a),n._clearSelectionOnSelectionDrag&&!s.equals(d,!0)&&(n.deselectAll(),delete n._clearSelectionOnSelectionDrag),o&&c!==o){const h=n.subGrids[o],g=n.subGrids[c],f=h.scrollable,m=g.scrollable,p=a.indexOf(h)-a.indexOf(g)<0;if(m.x=p?0:m.maxX,p?f.x<f.maxX-1:f.x>1)return;const v=(i=n.scrollManager._activeScroll)==null?void 0:i.horizontal;v&&v.element!==m.element&&v.stopScroll(!0)}n._lastSelectionDragRegion=c,n._lastSelectionDragCell=d,n._isSelectionDragging=!0;const u=n._lastSelectionDragChange=n.internalSelectRange(s,d,n.isRowNumberSelecting(d)||n.isRowNumberSelecting(s));u.deselectedCells=u.deselectedCells.filter(h=>!n.isCellSelected(h)),u.deselectedRecords=u.deselectedRecords.filter(h=>!n.isSelected(h)),n.refreshGridSelectionUI(u),n.trigger("dragSelecting",u)}}onSelectionEnd(){var t,i;const n=this,s=n._lastSelectionDragChange;n._isSelectionDragging&&!n._selectionStartCell.equals(n._lastSelectionDragCell,!0)&&s&&n.performSelection(s,!1),n.disableScrollingCloseToEdges(n.items),n._isSelectionDragging=!1,n._lastSelectionDragChange=n._lastSelectionDragCell=n._lastSelectionDragRegion=null,(i=(t=n._selectionListenersDetachers).selectiondrag)==null||i.call(t),delete n._selectionListenersDetachers.selectiondrag}onHandleElementClick(t){const i=this;i.selectionMode.rowNumber&&t.target.closest(".b-rownumber-header")?(t.handled=!0,i.store.count&&i.store.some(n=>!i.isSelected(n))?i.selectAll():i.deselectAll()):i.selectionMode.column&&t.target.closest(".b-grid-header")&&(t.handled=!0,i.selectColumn(t,t.ctrlKey)),super.onHandleElementClick(t)}selectColumn(t,i=!1){const n=this,{store:s}=n,{columnId:a}=n.getHeaderDataFromEvent(t);n._shiftSelectRange=null,t.shiftKey||(n._shiftSelectColumn=a);const o=t.shiftKey&&n._shiftSelectColumn||a,l=n.internalSelectRange(n.normalizeCellContext({id:s.first.id,columnId:o}),n.normalizeCellContext({id:s.last.id,columnId:a}));i&&!l.selectedCells.some(c=>!n.isCellSelected(c))&&(l.deselectedCells=l.selectedCells,l.selectedCells=[]),i||(l.deselectedCells=n._selectedCells),n.cleanSelectionChange(l),n.performSelection(l)}isSelected(t){return t!=null&&t.id&&(t=t.id),Vk[typeof t]?this.selectedRows.some(i=>i.id===t):!1}isCellSelected(t,i){return t=this.normalizeCellContext(t),this.isCellSelectionMode&&this._selectedCells.some(n=>t.equals(n,!0))||i&&this.isSelected(t)}isSelectable(t){return this.normalizeCellContext({id:t.id||t}).isSelectable}get selectedRecord(){return this.selectedRecords[this.selectedRecords.length-1]||null}set selectedRecord(t){this.selectRow({record:t})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(t){this.selectRows(t)}get selectedRows(){return[...this._selectedRows]}set selectedRows(t){this.selectRows(t)}spliceSelectedRecords(t,i,n){const s=this;if(typeof i=="number"){const a=[...s.selectedRecords];a.splice(t,i,...H.asArray(n)),s.performSelection(s.prepareSelection(null,a,!0,!0))}else s.performSelection(s.prepareSelection(i,n,!1,!0))}selectRow(t){(typeof t=="number"||t.isModel||!("record"in t))&&(t={records:[t]}),T.assignIf(t,{scrollIntoView:!0}),this.selectRows(t)}selectRows(t){(!t||Array.isArray(t)||t.isModel||typeof t=="number"||!("records"in t)&&!("record"in t))&&(t={records:H.asArray(t)||[]});const i=this,{store:n}=i,s=[],{records:a=t.record?[t.record]:[],column:o=i.columns.visibleColumns[0],scrollIntoView:l,addToSelection:c=arguments[1]}=t;for(let d of a)d=n.getById(d),d&&s.push(d);c||(i._shiftSelectRange=null),i.performSelection(i.prepareSelection(null,s,!c,!0)),s.length&&l&&i.scrollRowIntoView(s[0].id,{column:o})}selectAll(t=!1){const{store:i}=this,n=(i.isGrouped?i.allRecords:i.records).filter(s=>!s.isSpecialRow);this.performSelection(this.prepareSelection(null,n,!1,!0),!0,t)}deselectAll(t=!1,i=!1){const{store:n}=this,s=t?(n.isGrouped?n.allRecords:n.records).filter(a=>!a.isSpecialRow):null;this.performSelection(this.prepareSelection(s,null,!t),!0,i)}deselectRow(t){this.deselectRows(t)}deselectRows(t){const{store:i}=this,n=H.asArray(t).map(s=>i.getById(s)).filter(s=>s);this.performSelection(this.prepareSelection(n))}selectRange(t,i,n=!1){const s=this,{store:a}=s,o=s.internalSelectRange(a.getById(t),a.getById(i),!0);s._shiftSelectRange=null,s.performSelection(o)}get selectedCell(){return this._selectedCells[this._selectedCells.length-1]}set selectedCell(t){this.selectCells([t])}get selectedCells(){return[...this._selectedCells]}set selectedCells(t){this.selectCells(t)}get selectedCellCSSSelector(){const t=this.selectedCell,i=t&&this.getRowById(t.id);return!t||!i?"":`[data-index=${i.dataIndex}] [data-column-id=${t.columnId}]`}selectCell(t){var i;return"id"in t&&(t={cell:t},t=Object.assign({scrollIntoView:arguments[1],addToSelection:arguments[2],silent:arguments[3]},t)),(i=this.selectCells(t))==null?void 0:i[0]}selectCells(t){Array.isArray(t)&&(t={cells:t});const i=this,{cells:n=t.cell?[t.cell]:[],scrollIntoView:s=!0,addToSelection:a=!1,silent:o=!1}=t,l=i.prepareSelection(null,n,!a);return a||(i._shiftSelectRange=null),i.performSelection(l,!0,o),s&&i.scrollRowIntoView(n[0].id,{column:n[0].columnId}),i.isCellSelectionMode?l.selectedCells:l.selectedRecords}deselectCell(t){var i;return(i=this.deselectCells([t]))==null?void 0:i[0]}deselectCells(t){const i=this.prepareSelection(t);return this.performSelection(i),this.isCellSelectionMode?i.deselectedCells:i.deselectedRecords}toggleSelection(t){const i=this,{_focusedCell:n,selectionMode:s}=i,a=i.isRowNumberSelecting(n),o=i.isCellSelected(n,!0);if(s.selectOnKeyboardNavigation===!0||n.isActionable)return!1;i.performSelection(i.prepareSelection(o?n:null,o?null:n,!s.multiSelect,a)),t.preventDefault()}selectCellRange(t,i){this.performSelection(this.internalSelectRange(t,i))}getSelection(){return this.isRowSelectionMode?this.selectedRecords:this.selectedCells}cleanSelectionChange(t){const{deselectedRecords:i,selectedRecords:n,deselectedCells:s,selectedCells:a,deselectedCellRecords:o,selectedCellRecords:l}=t;return i!=null&&i.length&&(n!=null&&n.length)&&(t.deselectedRecords=i.filter(c=>!n.some(d=>c===d))),s!=null&&s.length&&(a!=null&&a.length)&&(t.deselectedCells=s.filter(c=>!a.some(d=>c.equals(d,!0)))),o.length&&(l!=null&&l.length||n!=null&&n.length)&&(t.deselectedCellRecords=o.filter(c=>!l.some(d=>c.id===d.id)&&!n.some(d=>c.id===d.id))),t}getSelectedCellsForRecords(t){return this._selectedCells.filter(i=>i.id&&t.some(n=>n.id===i.id))}delayUntilMouseUp(t){const i=B.on({element:globalThis,blur:n=>t(n,i),mouseup:n=>t(n,i),thisObj:this,once:!0})}get isRowSelectionMode(){return!this.isCellSelectionMode}get isCellSelectionMode(){return this.selectionMode.cell===!0}isRowNumberSelecting(...t){return this.selectionMode.rowNumber&&!t.some(i=>i.column.type!=="rownumber")}extendSelectionLeft(){this.extendSelection("Left")}extendSelectionRight(){this.extendSelection("Right")}extendSelectionUp(){this.extendSelection("Up")}extendSelectionDown(){this.extendSelection("Down")}extendSelection(t){this._isKeyboardRangeSelecting=!0,this["navigate"+t](),this._isKeyboardRangeSelecting=!1}onCellNavigate(t,i,n,s){var a,o;const{selectionMode:l,_selectionListenersDetachers:c}=t,{multiSelect:d,deselectOnClick:u,dragSelect:h}=l,{ctrlKeyDown:g,shiftKeyDown:f}=be,m=be.isMouseDown(),p=be.isMouseDown(2),v=be.currentMouseDown||be.currentKeyDown;if(n=t.normalizeCellContext(n),!s||n.rowIndex===-1||(a=n.record)!=null&&a.isGroupHeader||v!=null&&v.fromKeyMap&&!l.selectOnKeyboardNavigation||t.columns.getById(n.columnId)===t.checkboxSelectionColumn||l.checkboxOnly||(v==null?void 0:v.handled)===!0)return;f||(t._isAddingToSelection=g&&d,t._selectionStartCell=n),d&&h&&m&&!c.selectiondrag&&!t.preventDragSelect&&(c.selectiondrag=B.on({name:"selectiondrag",element:t.selectionDragMouseEventListenerElement,blur:"onSelectionEnd",mouseup:{handler:"onSelectionEnd",element:globalThis},mousemove:"onSelectionDrag",thisObj:t})),t.preventDragSelect=!1;const y=t._selectionStartCell,C=t._isAddingToSelection;if((f&&m||t._isKeyboardRangeSelecting)&&y&&d)t.performSelection(t.internalSelectRange(y,n,t.isRowNumberSelecting(y,n)));else{let D=!1,S=!0,x;if(t.isCellSelected(n,!0)){if(p)return;if(C||u)x=u?null:[n],S=!1;else if(t.selectedRecords.length+(t.isCellSelectionMode?t._selectedCells.length:0)<=1)return;D=u||d}!x&&!C&&(x=null,h&&D&&c.selectiondrag&&(t._clearSelectionOnSelectionDrag=!0));const R=(I,M)=>{var P;if(M==null||M(),((P=I==null?void 0:I.target)==null?void 0:P.nodeType)===Node.ELEMENT_NODE){const _=new oe(I.target);if(_!=null&&_.grid&&!_.equals(n,!0))return}f||(t._shiftSelectRange=null),t.performSelection(t.prepareSelection(x,S&&[n],x===null,S&&t.isRowNumberSelecting(n)))};if((o=t.features.rowReorder)!=null&&o.isDragging)return;D?t.delayUntilMouseUp(R):R()}}prepareSelection(t,i,n=!1,s=!1){var a,o;const l=this,c=l._isSelectionDragging,{includeParents:d,selectRecordOnCell:u}=l.selectionMode,h=[],g=[];let f=[],m=[],p=[],v=[];if(n)f=l._selectedCells,m=l._selectedRows,v=l.selectedRecords.filter(y=>!m.some(C=>C.id===y.id));else if(t)for(const y of H.asArray(t)){const C=l.normalizeCellContext(y),D=(C==null?void 0:C.record)||(y.isModel?y:l.store.getById(C.id));if(!C.isSpecialRow&&(f.push(C),D&&!m.some(S=>S.id===D.id)&&(c||l.isSelected(D)?m.push(D):u&&l.selectedRecordCollection.get(D.id)&&!v.some(S=>S.id===D.id)&&v.push(D),l.selectionMode.includeChildren&&l.selectionMode.multiSelect&&!D.isLeaf&&((a=D.allChildren)!=null&&a.length))))for(const S of D.allChildren)!m.some(x=>x.id===S.id)&&(c||l.isSelected(S))&&m.push(S)}if(i){for(const y of H.asArray(i)){const C=l.normalizeCellContext(y),D=(C==null?void 0:C.record)||(y.isModel?y:l.store.getById(C.id));if(!(!D||C.isSpecialRow)&&(l.isCellSelectionMode&&!s&&g.push(C),(l.isRowSelectionMode||s)&&!h.some(S=>S.id===D.id)&&(h.push(D),l.selectionMode.includeChildren&&l.selectionMode.multiSelect&&!D.isLeaf&&((o=D.allChildren)!=null&&o.length))))for(const S of D.allChildren)h.some(x=>x.id===S.id)||h.push(S)}u&&g.length&&(p=H.unique(g.map(y=>y.record)).filter(y=>!h.some(C=>C.id===y.id)))}if(d&&(m.length||h.length)){const y=[...m,...h];H.unique(y.filter(D=>D.parent&&!D.allChildren.some(S=>y.includes(S))).map(D=>D.parent)).forEach(D=>l.toggleParentSelection(D,h,m))}return l.cleanSelectionChange({selectedCells:g,selectedRecords:h,deselectedCells:f,deselectedRecords:m,deselectAll:n,action:h!=null&&h.length||g!=null&&g.length?"select":"deselect",selectedCellRecords:p,deselectedCellRecords:v})}toggleParentSelection(t,i,n){if(!t||t.isRoot)return;const s=this.isSelected(t),a=i.includes(t),o=n.includes(t),l=c=>this.isSelected(c)&&!n.includes(c)||i.includes(c);this.selectionMode.includeParents==="some"?t.allChildren.some(l)?(!s||o)&&!a&&i.push(t):s&&!o&&n.push(t):s?!o&&!a&&t.allChildren.some(c=>n.includes(c))&&n.push(t):a||t.allChildren.every(l)&&i.push(t),t.parent&&this.toggleParentSelection(t.parent,i,n)}internalSelectRange(t,i,n=!1){const s=this,a=s.isRowSelectionMode||n,o=s.prepareSelection(s._shiftSelectRange,s.getRange(t,i,a),!1,n);return s._shiftSelectRange=o[`selected${a?"Records":"Cells"}`],o}getRange(t,i,n=!1){const s=this,{store:a}=s,o=s.normalizeCellContext(t),l=s.normalizeCellContext(i),c=Math.min(o.rowIndex,l.rowIndex),d=Math.max(o.rowIndex,l.rowIndex),u=[],h=Math.min(o.columnIndex,l.columnIndex),g=Math.max(o.columnIndex,l.columnIndex);if(c===-1||d===-1)throw new Error("Record not found in selectRange");if(n){const f=a.getRange(c,d+1,!1);l.rowIndex<o.rowIndex&&f.reverse(),u.push(...f)}else for(let f=c;f<=d;f++)for(let m=h;m<=g;m++)u.push({rowIndex:f,columnIndex:m});return u.map(f=>s.normalizeCellContext(f))}performSelection(t,i=!0,n=!1){const s=this,{selectedRecords:a=[],selectedCells:o=[],selectedCellRecords:l=[],deselectedRecords:c=[],deselectedCells:d=[],deselectedCellRecords:u=[],action:h}=t,g=[...a,...l],f=[...c,...u],m=s.isRowSelectionMode;if(s.trigger("beforeSelectionChange",{mode:m?"row":"cell",action:h,selected:g,deselected:f,selection:s.selectedRecords,selectedCells:o,deselectedCells:d,cellSelection:s.selectedCells})!==!1){if(s._selectedCells===d)s._selectedCells=[];else{const p=[];for(const v of s._selectedCells)d.some(y=>v.equals(y,!0))||p.push(v);s._selectedCells=p}if(t.deselectedRecords=[...t.deselectedRecords],c===s._selectedRows)s.changeSelectedRecordCollectionSilent(p=>p.clear()),s._selectedRows.length=0;else{const p=[],v=[];for(const y of s.selectedRecords)f.some(C=>y.id===C.id)||(s.isSelected(y)?p.push(y):v.push(y));s.changeSelectedRecordCollectionSilent(y=>y.values=[...p,...v]),s._selectedRows=p}if(o.length)for(const p of o)s._selectedCells.some(v=>v.equals(p,!0))||s._selectedCells.push(p);a.length&&(s.changeSelectedRecordCollectionSilent(p=>p.add(...a)),s._selectedRows.push(...a.filter(p=>!s._selectedRows.some(v=>v.id===p.id)))),l.length&&s.changeSelectedRecordCollectionSilent(p=>p.add(...l)),i&&s.refreshGridSelectionUI(t),s.afterSelectionChange(t),n||s.triggerSelectionChangeEvent(t)}}refreshGridSelectionUI({selectedRecords:t,selectedCells:i,deselectedRecords:n,deselectedCells:s}){const a=this,{checkboxSelectionColumn:o}=a;o==null||o.suspendEvents(),a.updateGridSelectionRecords(t,!0),a.updateGridSelectionRecords(n,!1),a.updateCheckboxHeader(),o==null||o.resumeEvents(),a.isCellSelectionMode&&(a.updateGridSelectionCells(i,!0),a.selectionMode.column&&a.updateGridSelectionColumns(i)),a.updateGridSelectionCells(s,!1)}updateGridSelectionRecords(t,i){const{checkboxSelectionColumn:n}=this;if(t!=null&&t.length)for(let s=0;s<t.length;s++){const a=this.getRowFor(t[s]);a&&(a.toggleCls("b-selected",i),a.setAttribute("aria-selected",i),n&&!n.hidden&&!t[s].isSpecialRow&&(a.getCell(n.id).widget.checked=i))}}updateGridSelectionCells(t,i){if(t!=null&&t.length)for(let n=0;n<t.length;n++){const s=this.getCell(t[n]);s&&(s.setAttribute("aria-selected",i),s.classList.toggle("b-selected",i))}}updateGridSelectionColumns(t){var i;const{count:n}=this.store;for(const s of this.columns.visibleColumns)(i=s.element)==null||i.classList.toggle("b-selected",(t==null?void 0:t.filter(a=>a.columnId===s.id).length)===n)}triggerSelectionChangeEvent(t){const{selectedRecords:i=[],selectedCells:n=[],selectedCellRecords:s=[],deselectedRecords:a=[],deselectedCells:o=[],deselectedCellRecords:l=[]}=t,c=[...i,...s],d=[...a,...l],u=this.isRowSelectionMode;this.trigger("selectionChange",{mode:u?"row":"cell",action:t.action,selected:c,deselected:d,selection:this.selectedRecords,selectedCells:n,deselectedCells:o,cellSelection:this.selectedCells})}doDestroy(){var t;((t=this.selectedRecordCollection)==null?void 0:t.owner)===this&&this.selectedRecordCollection.destroy(),this._selectedCells.length=0,this._selectedRows.length=0;for(const i in this._selectionListenersDetachers)this._selectionListenersDetachers[i]();super.doDestroy()}get widgetClass(){}},E(r,"configurable",{selectionMode:{cell:!1,multiSelect:!0,checkboxOnly:!1,checkbox:!1,checkboxPosition:null,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,includeParents:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1,dragSelect:!1,selectOnKeyboardNavigation:!0,column:!1,rowNumber:!1,selectRecordOnCell:!0},keyMap:{"Shift+ArrowUp":"extendSelectionUp","Shift+ArrowDown":"extendSelectionDown","Shift+ArrowLeft":"extendSelectionLeft","Shift+ArrowRight":"extendSelectionRight"," ":{handler:"toggleSelection",weight:10}},selectedRecordCollection:{}}),r},zk=e=>e.columns.suspendEvents(),Wk=e=>e.columns.resumeEvents(),Gk=e=>{e.columns.clearCaches(),e.columns.fillFromMaster()},bp=(e,r)=>e.stateSortIndex-r.stateSortIndex,ex=e=>class extends(e||F){static get $name(){return"GridState"}static get configurable(){return{statefulEvents:["subGridCollapse","subGridExpand","horizontalScrollEnd","stateChange"]}}updateStore(t,i){var n;(n=super.updateStore)==null||n.call(this,t,i),this.detachListeners("stateStoreListeners"),t==null||t.ion({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateColumns(t,i){var n;(n=super.updateColumns)==null||n.call(this,t,i),this.detachListeners("stateColumnListeners"),t.ion({name:"stateColumnListeners",change:"triggerUpdate",thisObj:this})}updateRowManager(t,i){var n;(n=super.updateRowManager)==null||n.call(this,t,i),this.detachListeners("stateRowManagerListeners"),t.ion({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}triggerUpdate(){this.trigger("stateChange")}finalizeInit(){super.finalizeInit(),this.ion({selectionChange:"triggerUpdate",thisObj:this})}getState(){const t=this,i=t.element.style.cssText,n={rowHeight:t.rowHeight};if(i&&(n.style=i),t.selectedCell){const{id:s,columnId:a}=t.selectedCell;n.selectedCell={id:s,columnId:a}}return n.selectedRecords=t.selectedRecords.map(s=>s.id),n.columns=t.columns.allRecords.map(s=>s.getState()),n.store=t.store.state,n.scroll=t.storeScroll(),n.subGrids={},t.eachSubGrid(s=>{var a;const o=n.subGrids[s.region]=n.subGrids[s.region]||{};s.isPainted?s.flex==null&&(o.width=s.width):s.config.width!=null?o.width=s.config.width:o.flex=s.config.flex,o.collapsed=(a=s.collapsed)!=null?a:!1,o.collapsed&&(o._beforeCollapseState=s._beforeCollapseState)}),n}applyState(t){const i=this;if(i.suspendRefresh(),"columns"in t){let n=!1,s=!1;i.columns.suspendEvents(),i.eachSubGrid(zk),t.columns.forEach((a,o)=>{const l=i.columns.getById(a.id);if(l){const c=l.generation;"region"in a&&!(a.region in i.subGrids)&&(delete a.region,delete a.locked),l.applyState(a),n=n||l.generation!==c,l.stateSortIndex=o,l.allIndex!==o&&(s=n=!0)}}),n&&i.eachSubGrid(Gk),s&&(i.eachSubGrid(a=>{a.columns.records.sort(bp),a.columns.allRecords.sort(bp)}),i.columns.sort({fn:bp,ascending:!0})),i.isPainted&&n&&i.renderContents(),i.columns.resumeEvents(),i.eachSubGrid(Wk)}"subGrids"in t&&i.eachSubGrid(n=>{if(n.region in t.subGrids){const s=t.subGrids[n.region];"width"in s?n.width=s.width:"flex"in s&&(n.flex=s.flex),"collapsed"in s&&(n.collapsed=s.collapsed,n._beforeCollapseState=s._beforeCollapseState)}n.clearWidthCache()}),"rowHeight"in t&&(i.rowHeight=t.rowHeight),"style"in t&&(i.style=t.style),"selectedCell"in t&&(i.selectedCell=t.selectedCell),"store"in t&&(i.store.state=t.store),"selectedRecords"in t&&(i.selectedRecords=t.selectedRecords),i.resumeRefresh(!0),i.whenVisible(()=>i.applyScrollState(t))}applyScrollState(t){const i=this;i.eachSubGrid(n=>n.refreshFakeScroll()),"scroll"in t&&(i.restoreScroll(t.scroll),t.scroll.scrollTop&&i.element.querySelectorAll(".b-resize-monitored").forEach(n=>{const s=la.fromElement(n);s&&s.onElementResize(n)}))}get widgetClass(){}},Cp=Promise.resolve(),Uk={block:"nearest"},Sp=class extends xr{updateYScroller(e){e==null||e.addScroller(this)}scrollIntoView(e,r=Uk){const t=this,{xDelta:i,yDelta:n}=t.getDeltaTo(e,r),s=i||n?t.scrollBy(i,n,r):Cp;return(r.highlight||r.focus)&&s.then(()=>{r.highlight&&(e instanceof k?e.translate(-i,-n).highlight():w.highlight(e)),r.focus&&e.focus&&e.focus()}),s}scrollBy(e,r,t){const i=r&&this.yScroller.scrollBy(0,r,t),n=e&&super.scrollBy(e,0,t);if(n!=null&&n.cancel&&(i!=null&&i.cancel)){const s=n.cancel,a=i.cancel;n.cancel=i.cancel=()=>{s(),a(),o.cancelled=!0};const o=Promise.all([n,i]);return o}return n||i||Cp}scrollTo(e,r,t){const i=r!=null&&this.yScroller.scrollTo(null,r,t),n=e!=null&&super.scrollTo(e,null,t);if(t&&t.animate||this.syncPartners(),n&&n.cancel&&i&&i.cancel){const s=n.cancel,a=i.cancel;return n.cancel=i.cancel=()=>{s(),a()},Promise.all([n,i])}return n||i||Cp}get viewport(){const e=k.from(this.element);return e.intersect(k.from(this.yScroller.element))||new k(e.x,e.y,e.width,0)}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}};E(Sp,"configurable",{propagate:!1,overflowX:"hidden-scroll",yScroller:null}),Sp._$name="SubGridScroller";var Yk=(e,r)=>e+r.getBoundingClientRect().width,ts=class extends ${static get $name(){return"SubGrid"}static get type(){return"subgrid"}static get defaultConfig(){return{insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,collapsed:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:Sp,hasCalculatedWidth:null,sealedColumns:null}}static get configurable(){return{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,resizable:null,role:"presentation"}}construct(e){const r=this;if(super.construct(e),this.rowManager.ion({addRows:"onAddRow",thisObj:this}),q.isFirefox){const{element:t}=r,i=r.grid.scrollable;let n=0;t.addEventListener("wheel",({ctrlKey:s,deltaY:a,deltaX:o})=>{const l=Math.abs(a)>Math.abs(o);!s&&l&&!r.scrollEndDetacher&&i.y!==n&&(t.style.pointerEvents="none",n=i.y,r.scrollEndDetacher=i.ion({scrollEnd:async()=>{n=i.y,t.style.pointerEvents="",r.scrollEndDetacher=null},once:!0}))})}ne.isTestEnv&&(r.hideOverlayScroller.delay=50)}doDestroy(){var e;const r=this;r.header.destroy(),r.footer.destroy(),(e=r.fakeScroller)==null||e.destroy(),r.virtualScrollerElement.remove(),r.splitterElements.forEach(t=>t.remove()),super.doDestroy()}get barConfig(){const e=this,{width:r,flex:t}=e.element.style,i={subGrid:e,parent:e,maxWidth:e.maxWidth||void 0,minWidth:e.minWidth||void 0};return t?i.flex=t:r&&(i.width=r),i}changeHeader(e){return new this.headerClass(T.assign({id:this.id+"-header"},this.barConfig,e))}changeFooter(e){return new this.footerClass(T.assign({id:this.id+"-footer"},this.barConfig,e))}get splitterElements(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}toggleSplitterCls(e,r=!0){this.splitterElements.forEach(t=>t==null?void 0:t.classList[r?"add":"remove"](e))}hideSplitter(){this.splitterElements.forEach(e=>e.classList.add("b-hide-display")),this.$showingSplitter=!1}showSplitter(){this.splitterElements.forEach(e=>e.classList.remove("b-hide-display")),this.$showingSplitter=!0}changeElement(e,r){const{region:t}=this;return super.changeElement({"aria-label":t,className:{"b-grid-subgrid":1,[`b-grid-subgrid-${t}`]:t,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:t}},r)}get rowElementConfig(){const{grid:e}=this;return{role:"row",className:e.rowCls,children:this.columns.visibleColumns.map((r,t)=>({role:"gridcell","aria-colindex":t+1,tabIndex:e.cellTabIndex,className:"b-grid-cell",dataset:{column:r.field||"",columnId:r.id}}))}}changeVirtualScrollerElement(){const e=w.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}changeSplitterElement(){const e=w.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[q.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[q.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[q.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[q.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return w.createElement(this.splitterConfig)}changeScrollerSplitter(){return w.createElement(this.splitterConfig)}changeFooterSplitter(){return w.createElement(this.splitterConfig)}render(...e){const r=this;super.render(...e),r.grid&&(r.updateHasFlex(),r.element.parentNode.insertBefore(r.splitterElement,r.element.nextElementSibling),r.splitterElements.forEach(t=>B.on({element:t,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:r})),r._collapsed&&r.collapse())}toggleHeaders(e){const r=this;if(e)r.headerSplitter.remove(),r.header.element.remove(),r.scrollable.removePartner(r.header.scrollable,"x");else{const{grid:t}=r;if(!r.isConfiguring){const i=t.items.indexOf(r)*2;w.insertAt(t.headerContainer,r.headerSplitter,i),w.insertAt(t.headerContainer,r.header.element,i),r.refreshHeader()}r.scrollable.addPartner(r.header.scrollable,"x")}}refreshHeader(){this.header.refreshContent()}refreshFooter(){var e;(e=this.footer)==null||e.refreshContent()}eachWidget(e,r=!0){const t=this,i=[t.header,t.footer];for(let n=0;n<i.length;n++){const s=i[n];if(e(s)===!1)return;r&&s.eachWidget&&s.eachWidget(e,r)}}fixCellWidths(e){const{visibleColumns:r}=this.columns;let t=e.firstElementChild,i=0;for(;t;){const n=r[i],{element:s}=n;n.minWidth&&(t.style.minWidth=w.setLength(n.minWidth)),n.maxWidth&&(t.style.maxWidth=w.setLength(n.maxWidth)),n.flex?n.childLevel&&s?(t.style.flex=`0 0 ${s.getBoundingClientRect().width}px`,t.style.width=""):(t.style.flex=n.flex,t.style.width=""):n.width?t.style.width=w.setLength(n.width):t.style.flex=t.style.width=t.style.minWidth="",t=t.nextElementSibling,i++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:r,header:t,footer:i}=e;if(!e.collapsed){if(e.flex)t.flex=e.flex,i&&(i.flex=e.flex),r.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some(s=>!s.hidden&&s.flex)&&e.totalFixedWidth!==e.width){e.width=e.totalFixedWidth,e.hasCalculatedWidth=!0;return}let n=e.width;if(!n&&e.hasCalculatedWidth){n=0;for(const s of e.columns)!s.flex&&!s.hidden&&(n+=s.width)}r.style.width=`${n}px`,t.width=n,i&&(i.width=n)}e.handleHorizontalScroll(!1)}}fixRowWidthsInSafariEdge(){if(q.isSafari){const e=this,{region:r,header:t}=e,i=t.calculateMinWidthForSafari();e.rowManager.forEach(n=>{const s=n.getElement(r);s&&(s.style.width=`${i}px`)}),t.headersElement.style.width=`${i}px`}}set width(e){var r,t;const i=this;i.hasCalculatedWidth=!1,super.width=e,i.header.width=e,i.footer.width=e,i.isPainted&&i.onElementResize(),!i.isExpanding&&!i.isCollapsing&&!i.isConfiguring&&((t=(r=i.grid).syncSplits)==null||t.call(r,n=>n.subGrids[i.region]&&(n.subGrids[i.region].width=e)))}get width(){return super.width}set flex(e){var r,t;const i=this;i.hasCalculatedWidth=!1,i.header.flex=e,i.footer.flex=e,super.flex=e,i.isPainted&&i.onElementResize(),!i.isExpanding&&!i.isCollapsing&&!i.isConfiguring&&((t=(r=i.grid).syncSplits)==null||t.call(r,n=>n.subGrids[i.region]&&(n.subGrids[i.region].flex=e)))}get flex(){return super.flex}onInternalResize(e,r,t,i,n){const s=this,{grid:a}=s;super.onInternalResize(...arguments),a!=null&&a.isPainted&&(s.syncSplitterButtonPosition(),r!==i&&(s.trigger("beforeInternalResize",s),a.trigger("horizontalScroll",{grid:a,subGrid:s,scrollLeft:s.scrollable.scrollLeft,scrollX:s.scrollable.x}),a.trigger("horizontalScrollEnd",{subGrid:s}),s.fakeScroller&&s.refreshFakeScroll(),a.syncFlexedSubCols(),s.fixRowWidthsInSafariEdge()),t!==n&&a.onHeightChange(),s.trigger("afterInternalResize",s))}syncParallelSplitters(e){const r=this,{grid:t}=r;if(r.splitterElement&&r.$showingSplitter)r.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const i=t.getSubGrid(t.getPreviousRegion(r.region));i&&i.splitterElement&&i.syncParallelSplitters(e)}}onSplitterMouseEnter(){const e=this,{nextSibling:r}=e;!e.collapsed&&(!r||!r.collapsed)&&e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseLeave(){const e=this,{nextSibling:r}=e;e.toggleSplitterCls("b-hover",!1),!e.collapsed&&(!r||!r.collapsed)&&e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.ion({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const{grid:e}=this;this.splitterButtons.style.top=`${e.scrollable.y+(e.bodyHeight-(this.headerSplitter?e.headerHeight:0))/2}px`}get viewRectangle(){const{scrollable:e}=this;return new k(e.x,e.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}updateResizable(e){this.splitterElements.forEach(r=>w.toggleClasses(r,["b-disabled"],!e))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach(e=>{e.resizeToFitContent(null,null,!0)}),this.grid.endGridMeasuring()}get overflowingHorizontally(){return!this.collapsed&&this.scrollable.hasOverflow("x")}get overflowingVertically(){return!1}refreshFakeScroll(){const e=this,{element:r,virtualScrollerElement:t,virtualScrollerWidth:i,header:n,footer:s,scrollable:a}=e,o=[...n.contentElement.children].reduce(Yk,0);a.scrollWidth=o,t.style.width=r.style.width,t.style.flex=r.style.flex,t.style.minWidth=r.style.minWidth,t.style.maxWidth=r.style.maxWidth,n.scrollable.syncOverflowState(),s.scrollable.syncOverflowState(),e.collapsed||(e.overflowingHorizontally?(i.style.width=`${a.scrollWidth||0}px`,e.grid.virtualScrollers.classList.remove("b-hide-display")):i.style.width=0)}initScroll(){const e=this,{scrollable:r,virtualScrollerElement:t,grid:i}=e;q.isFirefox&&r.element.addEventListener("wheel",n=>{n.deltaX&&(r.x+=n.deltaX,n.preventDefault())}),e.fakeScroller=new xr({element:t,overflowX:!0,widget:e}),r.ion({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),i.hideHorizontalScrollbar||(r.addPartner(e.fakeScroller,"x"),e.refreshFakeScroll()),i.hideHeaders||r.addPartner(e.header.scrollable,"x"),i.hideFooters||r.addPartner(e.footer.scrollable,"x")}onSubGridScrollEnd(){const e=this,{grid:r}=e;e.scrolling=!1,e.handleHorizontalScroll(!1),w.scrollBarWidth||(r.virtualScrollers.classList.remove("b-scrolling"),e.hideOverlayScroller()),r.trigger("horizontalScrollEnd",{subGrid:e})}onSubGridScroll(){this.handleHorizontalScroll()}showOverlayScroller(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}hideOverlayScroller(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}handleHorizontalScroll(e=!0){const r=this,{grid:t}=r;!r.scrolling&&e&&(r.scrolling=!0,w.scrollBarWidth||(t.virtualScrollers.classList.add("b-scrolling"),r.showOverlayScroller())),t.trigger("horizontalScroll",{subGrid:r,grid:t,scrollLeft:r.scrollable.scrollLeft,scrollX:r.scrollable.x})}scrollColumnIntoView(e,r){const{columns:t,header:i}=this,n=i.scrollable;if(e=e instanceof ye?e:t.get(e)||t.getById(e)||t.getAt(e),e){const s=i.getHeader(e.id);if(s)return n.scrollIntoView(k.from(s,null,!0),r)}}onAddRow({rows:e,isExport:r}){const t=this,i=t.rowElementConfig,n=document.createDocumentFragment();e.forEach(s=>{const a=w.createElement(i);n.appendChild(a),s.addElement(t.region,a),t.fixCellWidths(a)}),r||(t.fixRowWidthsInSafariEdge(),t.element.insertBefore(n,t.insertRowsBefore))}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),r=document.createRange();e.length&&(r.setStartBefore(e[0]),r.setEndAfter(e[e.length-1]),r.deleteContents())}addNewRowElement(){const e=w.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}get store(){return this.grid.store}get rowManager(){var e;return(e=this.grid)==null?void 0:e.rowManager}toggleTransitionClasses(e=!1){const r=this,t=r.grid,i=t.getSubGrid(t.getNextRegion(r.region)),n=t.resolveSplitter(i);i.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),i.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),n.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){var e;const r=this,{grid:t,element:i}=r,n=t.getSubGrid(t.getNextRegion(r.region)),s=r.splitterElement?r:r.previousSibling;let{_beforeCollapseState:a}=r,o=0;if(!(t.rendered&&r._collapsed===!0)){if(r.isCollapsing=!0,t.eachSubGrid(l=>{l!==r&&!l._collapsed&&++o}),(e=t.syncSplits)==null||e.call(t,l=>{var c;return(c=l.subGrids[r.region])==null?void 0:c.collapse()}),o===0){if(!n)return;await n.expand()}return new Promise(l=>{if(a)l();else{a=r._beforeCollapseState={};let c=!1;r.width&&(c=!0,r.ion({afterinternalresize:()=>{l(r)},thisObj:r,once:!0})),a.width=r.width,a.elementWidth=i.style.width,n.element.style.flex===""&&(a.nextRegionWidth=n.width,n.width="",n.flex="1"),i.style.flex!==""&&(a.flex=i.style.flex,r.header.element.style.flex=i.style.flex=""),i.classList.add("b-grid-subgrid-collapsed"),r.virtualScrollerElement.classList.add("b-collapsed"),r.header.element.classList.add("b-collapsed"),r.footer.element.classList.add("b-collapsed"),r._collapsed=!0,r.width="",c||(r.syncParallelSplitters(!0),l(!1))}t.trigger("subGridCollapse",{subGrid:r}),t.afterToggleSubGrid({subGrid:r,collapsed:!0}),r.isCollapsing=!1}).then(l=>{var c;r.isDestroyed||l!==!1&&(t.refreshVirtualScrollbars(),r.syncParallelSplitters(!0),(c=s.startSplitterButtonSyncing)==null||c.call(s))})}}async expand(){var e;const r=this,{grid:t,_beforeCollapseState:i}=r,n=t.getSubGrid(t.getNextRegion(r.region)),s=r.splitterElement?r:r.previousSibling;if(!(t.rendered&&r._collapsed!==!0))return r.isExpanding=!0,(e=t.syncSplits)==null||e.call(t,a=>{var o;return(o=a.subGrids[r.region])==null?void 0:o.expand()}),new Promise(a=>{if(i!=null){let o=!1;r.width!==i.elementWidth&&(o=!0,r.ion({afterinternalresize(){r.setTimeout(()=>a(r),10)},thisObj:r,once:!0})),i.nextRegionWidth&&(n.width=i.nextRegionWidth,n.flex=null),r.element.classList.remove("b-grid-subgrid-collapsed"),r._collapsed=!1,r.virtualScrollerElement.classList.remove("b-collapsed"),r.header.element.classList.remove("b-collapsed"),r.footer.element.classList.remove("b-collapsed"),i.flex?(r.width=i.width,r.header.flex=r.flex=i.flex,r.footer.flex=i.flex,r._width=null):r.width=i.elementWidth,r.element.classList.remove("b-grid-subgrid-collapsed"),r._collapsed=!1,o?(s.stopSplitterButtonSyncing(),r.syncParallelSplitters(!1)):a(!1),delete r._beforeCollapseState}else a();t.trigger("subGridExpand",{subGrid:r}),t.afterToggleSubGrid({subGrid:r,collapsed:!1}),r.isExpanding=!1})}hide(){var e,r;return(e=this.header)==null||e.hide(),(r=this.footer)==null||r.hide(),this.hideSplitter(),super.hide()}show(){var e,r;const t=this;return(e=t.header)==null||e.show(),(r=t.footer)==null||r.show(),t.region!==t.grid.regions[t.grid.regions.length-1]&&t.showSplitter(),super.show()}};E(ts,"delayable",{hideOverlayScroller:1e3}),ts.initClass(),ts._$name="SubGrid";var tx=e=>class extends(e||F){static get $name(){return"GridSubGrids"}static get properties(){return{subGrids:{}}}changeSubGridConfigs(t){const i=this,n=new Set;for(const s of i.columns){const{region:a}=s;a&&(t[a]||(t[a]={}),n.add(a))}t.normal&&T.isEmpty(t.normal)&&(t.normal=Aa.defaultConfig.subGridConfigs.normal);for(const s of n)i.createSubGrid(s,t[s]);return i.items=i.subGrids,t}createSubGrid(t,i=null){const n=this,s=n.columns.makeChained(c=>c.region===t,["region"]),a=T.assign({type:"subgrid",id:`${n.id}-${t}Subgrid`,parent:n,grid:n,region:t,headerClass:n.headerClass,footerClass:n.footerClass,columns:s,weight:t,scrollable:{yScroller:n.scrollable}},i||n.subGridConfigs[t]);let o=!1;!a.flex&&!a.width&&(a.width=s.totalFixedWidth,o=!0);const l=n.subGrids[t]=ts.create(a);return l.hasCalculatedWidth=o,t===n.regions[0]&&(l.isFirstRegion=!0),l}onChildAdd(t){if(t.isSubGrid){const i=this,{items:n,headerContainer:s,virtualScrollers:a,footerContainer:o}=i,l=n.indexOf(t)*2;i.hideHeaders||(w.insertAt(s,t.headerSplitter,l),w.insertAt(s,t.header.element,l)),w.insertAt(a,t.scrollerSplitter,l),w.insertAt(a,t.virtualScrollerElement,l),w.insertAt(o,t.footerSplitter,l),w.insertAt(o,t.footer.element,l),n.forEach((c,d)=>{d<n.length-1&&c.showSplitter()}),l===0&&i.emptyTextEl&&t.element.appendChild(i.emptyTextEl)}return super.onChildAdd(t)}onChildRemove(t){if(super.onChildRemove(t),t.isSubGrid){const{items:i}=this;delete this.subGrids[t.region],H.remove(this.regions,t.region),t.destroy(),i.length&&i[i.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid(t=>t.destroy()),super.doDestroy()}eachSubGrid(t,i=null){this.items.forEach((n,s)=>{n.isSubGrid&&t.call(i||n,n,s++)})}callEachSubGrid(t,...i){let n=null;return this.items.forEach((s,a)=>{if(s.isSubGrid&&s[t]){const o=s[t](...i);a===0&&(n=o)}}),n}get regions(){return this.items.map(t=>t.region)}getLastRegions(){const t=this.regions.slice(-2);return t.length===2?t:[t[0],t[0]]}getNextRegion(t){const i=this.regions;return i[i.indexOf(t)+1]||i[i.length-2]}getPreviousRegion(t){return this.regions[this.regions.indexOf(t)-1]}getSubGrid(t){return this.subGrids[t]}getSubGridFromColumn(t){return t=t instanceof ye?t:this.columns.getById(t)||this.columns.get(t),this.getSubGrid(t.region)}resolveSplitter(t){const i=this.getLastRegions();let n=t instanceof ts?t.region:t;return i[1]===n&&(n=i[0]),this.subGrids[n].splitterElement}get widgetClass(){}},qk=new String,Kk={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter",disableFilter:"Disable filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},HeaderMenu:{moveBefore:e=>`Move before "${e}"`,moveAfter:e=>`Move after "${e}"`,collapseColumn:"Collapse column",expandColumn:"Expand column"},ColumnRename:{rename:"Rename"},MergeCells:{mergeCells:"Merge cells",menuTooltip:"Merge cells with same value when sorted by this column"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Split:{split:"Split",unsplit:"Unsplit",horizontally:"Horizontally",vertically:"Vertically",both:"Both"},Column:{columnLabel:e=>`${e.text?`${e.text} column. `:""}SPACE for context menu${e.sortable?", ENTER to sort":""}`,cellLabel:qk},Checkbox:{toggleRowSelect:"Toggle row selection",toggleSelection:"Toggle selection of entire dataset"},RatingColumn:{cellLabel:e=>{var r;return`${e.text?e.text:""} ${(r=e.location)!=null&&r.record?`rating : ${e.location.record.get(e.field)||0}`:""}`}},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",serverResponse:"Server response:",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",moveColumnTo:e=>`Move column to ${e}`},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste",rows:"rows",row:"row"},CellCopyPaste:{copy:"Copy",cut:"Cut",paste:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Cancel"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:e,totalPages:r})=>`Exporting page ${e}/${r}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:e,totalPages:r})=>`Exporting page ${e}/${r}`},RowExpander:{loading:"Loading",expand:"Expand",collapse:"Collapse"},TreeGroup:{group:"Group by",stopGrouping:"Stop grouping",stopGroupingThisColumn:"Ungroup column"}},o1=yt.publishLocale(Kk),rx=new Promise(e=>e()),Dp="GridBase:store",Xk={block:"nearest",inline:"nearest"},Zk={dataset:1,pageLoad:1,filter:1},Aa=class extends Vt.mixin(Uf,Ld,XE,ZE,Hk,JE,QE,ex,tx,Am){static get $name(){return"GridBase"}static get type(){return"gridbase"}static get delayable(){return{onGridVerticalScroll:{type:"raf"},bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideHeaders:null,hideFooters:!0,hideHorizontalScrollbar:null,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}",sortFeatureStore:"store",rowHeight:null}}static get defaultConfig(){return{fixedRowHeight:null,defaultRowHeight:45,fullRowRefresh:!0,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},columnLines:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!0,disableGridRowModelWarning:null,headerClass:es,footerClass:Iu,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:qE,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",fixElementHeightsBuffer:350,testConfig:{transitionDuration:50,fixElementHeightsBuffer:50}}}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}finishConfigure(e){const r=this,{initScroll:t}=r;r.initScroll=()=>!r.scrollInitialized&&t.call(r),ne.isTestEnv&&(r.bufferedAfterColumnsResized.delay=50,r.bufferedElementResize.delay=50),super.finishConfigure(e),ze.ion({locale:"onBeforeLocaleChange",prio:1,thisObj:r}),ze.ion({locale:"onLocaleChange",prio:-1,thisObj:r}),be.ion({theme:"onThemeChange",thisObj:r}),r.ion({subGridExpand:"onSubGridExpand",prio:-1,thisObj:r}),r.bufferedFixElementHeights=r.buffer("fixElementHeights",r.fixElementHeightsBuffer,r),r.setGridClassList(r.element.classList),r.verticalScroller.classList.remove("b-content-element","b-auto-container"),r.bodyWrapElement.classList.remove("b-auto-container-panel")}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(e,r){return r==null||r.destroy(),e?cu.new({element:this.element,owner:this},e):null}doDestroy(){var e,r;const t=this;t.detachListeners(Dp),(e=t.scrollManager)==null||e.destroy();for(const i of Object.values(t.features))(r=i.destroy)==null||r.call(i);t._focusedCell=null,t.columns.destroy(),super.doDestroy()}setGridClassList(e){Object.values(this.features).forEach(t=>{if(t.disabled||t===!1)return;let i;Object.prototype.hasOwnProperty.call(t.constructor,"featureClass")?i=t.constructor.featureClass:i=`b-${t instanceof F?t.$$name:t.constructor.name}`,i&&e.add(i.toLowerCase())})}compose(){const{autoHeight:e,enableSticky:r,enableTextSelection:t,fillLastColumn:i,positionMode:n,showDirty:s}=this;return{class:{[`b-grid-${n}`]:1,"b-enable-sticky":r,"b-grid-notextselection":!t,"b-autoheight":e,"b-fill-last-column":i,"b-show-dirty":s}}}get cellCls(){const{_cellCls:e}=this;return e.value||e}get bodyConfig(){const{autoHeight:e,hideFooters:r,hideHeaders:t}=this;return{reference:"bodyElement",className:{"b-autoheight":e,"b-grid-panel-body":1},[this.hasHeader?"ariaLabelledBy":""]:`${this.id}-panel-title`,children:{headerContainer:{tag:"header",role:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":t}},bodyContainer:{className:"b-grid-body-container",tabIndex:-1,role:"presentation",children:{verticalScroller:{className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",style:q.isFirefox&&w.scrollBarWidth?{height:`${w.scrollBarWidth}px`}:void 0},footerContainer:{tag:"footer",className:{"b-grid-footer-container":1,"b-hidden":r}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}updateHideHeaders(e){var r;e=!!e,(r=this.headerContainer)==null||r.classList.toggle("b-hidden",e),this.eachSubGrid(t=>t.toggleHeaders(e))}updateHideFooters(e){var r;e=!!e,(r=this.footerContainer)==null||r.classList.toggle("b-hidden",e),this.eachSubGrid(t=>{t.scrollable[e?"removePartner":"addPartner"](t.footer.scrollable,"x")})}updateHideHorizontalScrollbar(e){e=!!e,this.eachSubGrid(r=>{r.virtualScrollerElement.classList.toggle("b-hide-display",e),r.scrollable[e?"removePartner":"addPartner"](r.fakeScroller,"x"),e||r.refreshFakeScroll()})}changeColumns(e,r){const t=this;if(!e&&r)return t.isDestroying?r.owner===t&&r.destroy():r.removeAll(),r;if(e.isStore)return(r==null?void 0:r.owner)===t&&r.destroy(),e.grid=t,e;if(Array.isArray(e)){if(r){const i=r.allRecords.slice();r.data=e;for(const n of i)r.includes(n)||n.destroy();return r}e={data:e}}if(r)throw new Error("Replacing ColumnStore is not supported");return Z.new({grid:t,owner:t},e)}updateColumns(e,r){var t,i;const n=this;(t=super.updateColumns)==null||t.call(this,e,r),e.ion({refresh:n.onColumnsChanged,sort:n.onColumnsChanged,change:n.onColumnsChanged,move:n.onColumnsChanged,thisObj:n}),e.ion(Tk(n.onColumnsResized,n)),q.isTouchDevice&&(n.touch=!0,e.forEach(s=>{const{touchConfig:a}=s;a&&s.applyState(a)})),(i=n.bodyElement)==null||i.setAttribute("aria-colcount",e.visibleColumns.length)}onColumnsChanged({type:e,action:r,changes:t,record:i,records:n,isMove:s}){var a;const o=this,{columns:l,checkboxSelectionColumn:c}=o,d=t&&Object.keys(t).length===1;if(s=s===!0?!0:s&&Object.values(s).some(h=>h),s||e==="refresh"&&r!=="batch"&&r!=="sort"||r==="update"&&d&&"parentIndex"in t||r==="sort"&&l.isSyncingDataOnLoad)return;const u=r==="add"&&n.some(h=>h.region&&!o.subGrids[h.region]);if(!(o.isConfiguring||!u&&(!o.isPainted||s&&r==="remove"))){if(r==="add")for(const h of n){const{region:g}=h;o.subGrids[g]||o.add(o.createSubGrid(g,(a=o.subGridConfigs)==null?void 0:a[g]))}if(r==="update"){if(("width"in t||"minWidth"in t||"maxWidth"in t||"flex"in t)&&!("region"in t)){const{region:h}=i;l.visibleColumns.forEach(g=>{g.region===h&&g.repaintOnResize&&o.refreshColumn(g)}),o.afterColumnsChange({action:r,changes:t,column:i});return}if("text"in t&&d){i.subGrid.refreshHeader();return}if("hidden"in t){const h=o.getSubGridFromColumn(i.id);h.header.fixHeaderWidths(),h.footer.fixFooterWidths(),h.updateHasFlex()}}if(r==="dataset"||r==="batch"||r==="update"&&"region"in t){const h=l.getDistinctValues("region",!0),{toRemove:g,toAdd:f}=H.delta(h,o.regions,!0);o.remove(g.map(m=>o.getSubGrid(m))),o.add(f.map(m=>o.createSubGrid(m,o.subGridConfigs[m])))}if(c&&!l.includes(c)){const h=l.indexOf(l.findRecord("type","rownumber"))+1;l.insert(h,c,!0)}o._suspendRenderContentsOnColumnsChanged||o.renderContents(),o.syncFlexedSubCols(),o.bodyElement.setAttribute("aria-colcount",l.visibleColumns.length),o.afterColumnsChange({action:r,changes:t,column:i,columns:n})}}onColumnsResized({changes:e,record:r}){var t;const i=this;if(i.isConfiguring)return;const n=w.setLength(r.width),s=w.setLength(r.minWidth),a=w.setLength(r.maxWidth),o=i.getSubGridFromColumn(r.id);if(o.header.fixHeaderWidths(),o.footer.fixFooterWidths(),o.updateHasFlex(),!(r.flex&&r.childLevel)){(!i.cellEls||r!==i.lastColumnResized)&&(i.cellEls=w.children(i.element,`.b-grid-cell[data-column-id="${r.id}"]`),i.lastColumnResized=r);for(const l of i.cellEls)"width"in e&&(l.style.width=n),"minWidth"in e&&(l.style.minWidth=s),"maxWidth"in e&&(l.style.maxWidth=a),"flex"in e&&(l.style.flex=(t=r.flex)!=null?t:null)}i.resizingColumns||i.afterColumnsResized(r),i.syncFlexedSubCols()}afterColumnsResized(e){const r=this;r.eachSubGrid(t=>{!t.collapsed&&(!e||e.region===t.region)&&(t.fixWidths(),t.fixRowWidthsInSafariEdge())}),r.lastColumnResized=r.cellEls=null,r.bufferedAfterColumnsResized(e),r.onHeightChange()}syncFlexedSubCols(){const e=this.columns.query(r=>r.flex&&r.childLevel&&r.element);if(e)for(const r of e){const t=r.element.getBoundingClientRect().width,i=w.children(this.element,`.b-grid-cell[data-column-id="${r.id}"]`);for(const n of i)n.style.flex=`0 0 ${t}px`}}bufferedAfterColumnsResized(e){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid(r=>{!r.collapsed&&(!e||e.region===r.region)&&r.refreshFakeScroll()})}bufferedElementResize(){this.refreshRows()}onInternalResize(e,r,t,i,n){w.scrollBarWidth&&r<i&&this.eachSubGrid(s=>{s.flex&&s.onElementResize(s.element)}),super.onInternalResize(...arguments),this.isPainted&&r!==i&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}changeRowManager(e,r){const t=this;if(t._isRowMeasured||t.measureRowHeight(),r==null||r.destroy(),e){const i=Pu.new({grid:t,rowHeight:t.rowHeight,rowScrollMode:t.rowScrollMode||"move",autoHeight:t.autoHeight,fixedRowHeight:t.fixedRowHeight,internalListeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:t}},e);return t.relayEvents(i,["beforeRenderRow","renderRow"]),t._rowManager=null,i}}updateRowHeight(e){!this.isConfiguring&&this.rowManager&&(this.rowManager.rowHeight=e)}get rowHeight(){var e,r;return(r=(e=this._rowManager)==null?void 0:e.rowHeight)!=null?r:this._rowHeight}getRowHeight(e){return e.rowHeight}processRowHeight(e,r){}getAsyncEventSuffixForStore(e){return this.asyncEventSuffix}bindStore(e){const r=this.getAsyncEventSuffixForStore(e);e.ion({name:Dp,[`refresh${r}`]:"onStoreDataChange",[`add${r}`]:"onStoreAdd",[`remove${r}`]:"onStoreRemove",[`replace${r}`]:"onStoreReplace",[`removeAll${r}`]:"onStoreRemoveAll",[`move${r}`]:e.tree?null:"onFlatStoreMove",change:"relayStoreDataChange",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",exception:"onStoreException",commit:"onStoreCommit",loadSync:"onStoreLoadSync",thisObj:this}),super.bindStore(e)}unbindStore(e){this.detachListeners(Dp),this.destroyStore&&e.destroy()}changeStore(e){var r;return e==null?null:(typeof e=="string"&&(e=re.getStore(e)),e.isStore||(e=T.assign({data:this.data,tree:!!((r=this.initialConfig.features)!=null&&r.tree)},e),e.data||delete e.data,e.modelClass||(e.modelClass=zi),e=new(e.readUrl?bt:re)(e)),e)}updateStore(e,r){var t,i;const n=this;(t=super.updateStore)==null||t.call(this,e,r),r&&n.unbindStore(r),e&&(r&&n.deselectAll(),n.bindStore(e)),n.trigger("bindStore",{store:e,oldStore:r}),!n.isDestroying&&n.isPainted&&!n.refreshSuspended&&((i=n._rowManager)==null||i.reinitialize())}onStoreLoadSync(){this.rowManager.renderFromRow(this.topRow)}onStoreUpdateRecord({source:e,record:r,changes:t}){const i=this;if(!(i.refreshSuspended||e.isSyncingDataOnLoad))if(i.forceFullRefresh)i.rowManager.refresh(),i.forceFullRefresh=!1;else{let n;if(r.isFieldModified("id")&&(n=i.getRowFor(r.meta.modified.id)),n=n||i.getRowFor(r),!n)return;if(i.fullRowRefresh||r.isSpecialRow){const s=e.indexOf(r);s!==-1&&n.render(s,r)}else i.columns.visibleColumns.forEach(s=>{const a=s.field;if(!(s.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(s.data,"renderer"))||t[a]){const l=n.getCell(a);l&&n.renderCell(l)}})}}refreshFromRowOnStoreAdd(e,r){const t=this,{rowManager:i}=t;i.renderFromRow(e),i.trigger("changeTotalHeight",{totalHeight:i.totalHeight}),t.store.count===1&&t.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(e){super.onMaskAutoClose(e),this.toggleEmptyText()}onStoreAdd({source:e,records:r,index:t,oldIndex:i,isChild:n,oldParent:s,parent:a,isMove:o,isExpandAll:l}){var c;const d=this,{rowManager:u}=d;if(!d.isPainted||l||d.refreshSuspended||e.isSyncingDataOnLoad||(c=e.project)!=null&&c.applyingChangeset)return;const h=o&&r.some(D=>{if(o[D.id]){const S=e.getById(D.meta.modified.parentId);return(S==null?void 0:S.isExpanded(e))&&(S==null?void 0:S.ancestorsExpanded(e))}});if(n&&!r[0].ancestorsExpanded(e)&&!h){if(!a.isLeaf){const D=u.getRowById(a);D&&u.renderRows([D])}return}u.calculateRowCount(!1,!0,!0),e.isFiltered&&(t=e.indexOf(r[0]));const{topIndex:g,rows:f,rowCount:m}=u,p=u.topIndex+u.rowCount-1,v=t,y=t+r.length-1,C=p>=e.count-r.length-1;s||i>-1||n&&o&&Object.values(o).some(D=>D)?u.refresh():v>=g&&v<g+m?d.refreshFromRowOnStoreAdd(f[v-g],...arguments):y>=g&&y<g+m?u.refresh():(C&&t>p&&u.fillBelow(d._scrollTop||0),u.estimateTotalHeight(!0))}onStoreException({action:e,type:r,response:t,exceptionType:i,error:n}){var s;const a=this;let o;switch(r){case"server":o=t.message||a.L("L{unspecifiedFailure}");break;case"exception":o=i==="network"?a.L("L{networkFailure}"):(n==null?void 0:n.message)||((s=t==null?void 0:t.parsedJson)==null?void 0:s.message)||a.L("L{parseFailure}");break}a.applyMaskError(`<div class="b-grid-load-failure">
                <div class="b-grid-load-fail">${a.L(e==="read"?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>
                ${t!=null&&t.url?`<div class="b-grid-load-fail">${t.url}</div>`:""}
                <div class="b-grid-load-fail">${a.L("L{serverResponse}")}</div>
                <div class="b-grid-load-fail">${o}</div>
            </div>`)}onStoreDataChange({action:e,changes:r,source:t,syncInfo:i}){var n;(n=super.onStoreDataChange)==null||n.call(this,...arguments);const s=this;if(s.refreshSuspended||!s.rowManager||t.isSyncingDataOnLoad||e==="dataset"&&(s.rowManager.clearKnownHeights(),t.isTree&&t.isFiltered))return;const a=t.isGrouped&&r&&t.groupers.some(o=>o.field in r);s.isPainted&&!a&&s.renderRows(!!(!(e in Zk)||s.preserveScrollOnDatasetChange)),s.toggleEmptyText()}onStoreRecordIdChange(){var e;(e=super.onStoreRecordIdChange)==null||e.call(this,...arguments)}onStoreBeforeRequest(){this.applyLoadMask()}onStoreAfterRequest(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove({isCollapse:e}){const r=this._features;return(r==null?void 0:r.group)&&!r.group.disabled||(r==null?void 0:r.groupSummary)&&!r.groupSummary.disabled||this.store.tree&&!e&&this.store.modelClass.convertEmptyParentToLeaf}onStoreRemove({source:e,records:r,isCollapse:t,isChild:i,isMove:n,isCollapseAll:s}){var a;if(!this.isPainted||n||s)return;(a=super.onStoreRemove)==null||a.call(this,...arguments);const o=this,{rowManager:l}=o;if(l.invalidateKnownHeight(r),!e.isSyncingDataOnLoad){if(o.animateRemovingRows&&!t&&!i){const c=r.reduce((d,u)=>{const h=l.getRowById(u.id);return h&&d.push(h),d},[]);if(c.length){const d=c[0];o.isAnimating=!0,B.onTransitionEnd({element:d._elementsArray[0],property:"left",duration:o.transitionDuration,thisObj:o,handler:()=>{o.isAnimating=!1,c.forEach(u=>!u.isDestroyed&&u.removeCls("b-removing")),l.refresh(),o.trigger("rowRemove"),o.afterRemove(arguments[0])}}),c.forEach(u=>u.addCls("b-removing"));return}}if(o.needsFullRefreshOnStoreRemove(...arguments))l.refresh(),o.afterRemove(arguments[0]);else{const c=l.topIndex;if(l.calculateRowCount(!1,!0,!0),l.topIndex!==c)l.renderFromRow(l.topRow);else{const{rows:d}=l,u=r.reduce((h,g)=>{const f=l.getRowById(g.id);return f&&(h=Math.min(h,d.indexOf(f))),h},d.length);d[u]?!o.refreshSuspended&&l.renderFromRow(d[u]):l.trigger("changeTotalHeight",{totalHeight:l.totalHeight})}o.trigger("rowRemove",{isCollapse:t}),o.afterRemove(arguments[0])}}}onFlatStoreMove({from:e,to:r}){const{rowManager:t,store:i}=this,{topIndex:n,rowCount:s}=t,[a,o]=[e,r].sort((d,u)=>d-u),l=i.indexOf(i.getAt(a,!0)),c=i.indexOf(i.getAt(o,!0));l>=n&&l<n+s?t.renderFromRow(t.rows[l-n]):c>=n&&c<n+s&&t.refresh()}onStoreReplace({records:e,all:r}){const{rowManager:t}=this;if(r)t.clearKnownHeights(),t.refresh();else{const i=e.reduce((n,[,s])=>{const a=this.getRowFor(s);return a&&n.push(a),n},[]);t.invalidateKnownHeight(e),t.renderRows(i)}}relayStoreDataChange(e){var r;if((r=this.ariaElement)==null||r.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",{...e,store:e.source,source:this})}onStoreRemoveAll(){var e;(e=super.onStoreRemoveAll)==null||e.call(this,...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const r=[];e.modified.forEach(t=>{const i=this.rowManager.getRowFor(t);i&&r.push(i)}),this.rowManager.renderRows(r)}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}populateHeaderMenu({column:e,items:r}){const t=this,{subGrids:i,regions:n}=t,{parent:s}=e;let a=!0;Object.entries(i).forEach(([o,l])=>{if(!l.sealedColumns&&e.draggable&&o!==e.region&&(!s&&i[e.region].columns.count>1||s&&s.children.length>1)){const c=l.element.compareDocumentPosition(i[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,d=t.rtl?!c:c,u=n.length>2?t.L("L{moveColumnTo}",t.optionalL(o)):t.L(d?"L{moveColumnRight}":"L{moveColumnLeft}");r[`${o}Region`]={targetSubGrid:o,text:u,icon:"b-fw-icon b-icon-column-move-"+(d?"right":"left"),separator:a,disabled:!e.allowDrag,onItem:({item:h})=>{e.traverse(g=>g.region=o),t.columns.insert(t.columns.indexOf(i[h.targetSubGrid].columns.last)+1,e),t.scrollColumnIntoView(e)}},a=!1}})}populateCellMenu({record:e,items:r}){}getColumnDragToolbarItems(e,r){return r}normalizeCellContext(e){const r=this,{columns:t}=r;return e.isLocation?e:e.isModel?new oe({grid:r,id:e.id,columnId:t.visibleColumns[0].id}):new oe(T.assign({grid:r},e))}getCell(e){const{store:r,columns:t}=this,{visibleColumns:i}=this.columns,n=isNaN(e.row)?isNaN(e.rowIndex)?r.indexOf(e.record||e.id):e.rowIndex:e.row,s=isNaN(e.column)?isNaN(e.columnIndex)?i.indexOf(e.column||t.getById(e.columnId)||t.get(e.field)||i[0]):e.columnIndex:e.column;return n>-1&&n<r.count&&s>-1&&s<i.length&&this.normalizeCellContext(e).cell||null}getHeaderElement(e){return e.isModel&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const r=this.columns.get(e);return r?this.getHeaderElement(r):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}get footerHeight(){const e=this;return e.isPainted&&!e._footerHeight&&(e._footerHeight=e.footerContainer.offsetHeight),e._footerHeight}get isTreeGrouped(){var e;return!!((e=this.features.treeGroup)!=null&&e.isGrouped)}getRecordFromElement(e){const r=e.closest(".b-grid-row");return r?this.store.getAt(r.dataset.index):null}getColumnFromElement(e){const r=e.closest(".b-grid-cell, .b-grid-header");if(!r)return null;if(r.matches(".b-grid-header"))return this.columns.getById(r.dataset.columnId);const t=Ge.get(r);return this.columns.getById(t.columnId)}updateAutoHeight(e){T.assertBoolean(e,"autoHeight")}get columnLines(){return this._columnLines}set columnLines(e){T.assertBoolean(e,"columnLines"),w.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}get keyMapElement(){return this.bodyElement}fixSizes(){this.callEachSubGrid("fixWidths");const e=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0");for(let r=0,{length:t}=e;r<t;r++)e[r].setAttribute("aria-colindex",r+1)}onRowManagerChangeTotalHeight({totalHeight:e,immediate:r}){return this.refreshTotalHeight(e,r)}refreshTotalHeight(e=this.rowManager.totalHeight,r=!1){const t=this;if(t.renderingRows||!t.isVisible)return!1;const i=t.scrollable,n=Math.abs(t.virtualScrollHeight-e),s=t._bodyRectangle.height,a=e-s;if(n){const o=a-t._scrollTop<s*2||t._verticalScrollHeight&&t._verticalScrollHeight-s<t._scrollTop;i.scrollHeight=t.virtualScrollHeight=e,t.isPainted&&(t.scrolling&&!o||n<100)&&!r?t.bufferedFixElementHeights():(t.virtualScrollHeightDirty&&t.virtualScrollHeightDirty(),t.bufferedFixElementHeights.cancel(),t.fixElementHeights())}}fixElementHeights(){const e=this,r=e.virtualScrollHeight,t=`${r}px`;e._verticalScrollHeight=r,e.verticalScroller.style.height=t,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=t,e._bodyHeight=r,e.refreshBodyRectangle()),e.refreshVirtualScrollbars()}refreshBodyRectangle(){return this._bodyRectangle=k.client(this.bodyContainer)}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){this.scrollManager.startMonitoring({scrollables:[{element:this.scrollable.element,direction:"vertical"},...H.asArray(e||[]).map(r=>({element:(typeof r=="string"?this.subGrids[r]:r).scrollable.element}))],direction:"horizontal"})}disableScrollingCloseToEdges(e){this.scrollManager.stopMonitoring([this.scrollable.element,...H.asArray(e||[]).map(r=>(typeof r=="string"?this.subGrids[r]:r).element)])}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this,{scrollable:r}=e;e.scrollInitialized||(e.scrollInitialized=!0,r.contentElement=e.contentElement,r.ion({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:e}),e.callEachSubGrid("initScroll"),q.isMobileSafari&&(r.element.style.transform="translate3d(0, 0, 0)"))}onGridVerticalScroll({source:e}){const r=this,{y:t}=e;t!==r._scrollTop&&(r._scrollTop=t,r.scrolling||(r.scrolling=!0,r.eachSubGrid(i=>i.suspendResizeMonitor=!0)),r.rowManager.updateRenderedRows(t),r.afterScroll({scrollTop:t}),r.trigger("scroll",{scrollTop:t}))}onGridVerticalScrollEnd(){this.scrolling=!1,this.eachSubGrid(e=>e.suspendResizeMonitor=!1)}async scrollRowIntoView(e,r=Xk){var t;const i=this,n=r.block||"nearest",{rowManager:s}=i,a=i.store.getById(e);if(a){let o;if(i.store.indexOf(a)===-1)return rx;let l=i.scrollable,c=i.getRecordCoords(a);const d=k.from(l.element);if(c.virtual){const u=c.block,h=n!=="nearest"?r:{block:u};if(o=l.scrollIntoView(c,{block:"center"}),s.scrollTargetRecordId=a,s.updateRenderedRows(l.y,!0),c=i.getRecordCoords(a),s.lastScrollTop=l.y,c.virtual)return rx;r.animate?(l.suspendEvents(),n==="end"||n==="nearest"&&u==="end"?l.y-=d.bottom-c.bottom:(n==="start"||n==="nearest"&&u==="start")&&(l.y+=c.y-d.y),s.updateRenderedRows(l.y,!1,!0),u==="end"?l.y-=s.appendRowBuffer*s.rowHeight-1:l.y+=s.prependRowBuffer*s.rowHeight-1,await l.scrollIntoView(i.getRecordCoords(a),Object.assign({},r,h)),l.resumeEvents()):(r.recursive||await o,await((t=i.scrollRowIntoView)==null?void 0:t.call(i,a,Object.assign({recursive:!0},r,h))))}else{let{column:u}=r;if(u){if(u.isModel||(u=i.columns.getById(u)||i.columns.get(u)),u){l=i.getSubGridFromColumn(u).scrollable;const h=k.from(s.getRowFor(a).getCell(u.id));c.x=h.x,c.width=h.width}}else r=T.assign({},r,{x:!1});await l.scrollIntoView(c,r)}}}scrollColumnIntoView(e,r){return e=e instanceof ye?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,r)}scrollCellIntoView(e,r){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},typeof r=="boolean"?{animate:r}:r))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this,r=e.storedScrollState={scrollTop:e.scrollable.y,scrollLeft:{}};return e.eachSubGrid(t=>{r.scrollLeft[t.region]=t.scrollable.x}),r}restoreScroll(e=this.storedScrollState){const r=this;r.eachSubGrid(t=>{var i;const n=e.scrollLeft[t.region];n!=null&&(t.scrollable.updateX(n),t.header.scrollable.updateX(n),t.footer.scrollable.updateX(n),(i=t.fakeScroller)==null||i.updateX(n))}),r.scrollable.updateY(e.scrollTop)}beginGridMeasuring(){const e=this;if(e.$measureCellElements||(e.$measureCellElements=w.createElement({className:"b-grid-subgrid "+(!e._isRowMeasured&&e.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:q.isFirefox?"layout paint":"layout style paint"}}]}]})),e.getConfig("element"),e.verticalScroller.appendChild(e.$measureCellElements.subGridElement),!e.rendered){const r=e.appendTo||e.insertBefore||document.body,t=w.getRootElement(typeof r=="string"?document.getElementById(r):r)||document.body;(!e.adopt||!t.contains(e.element))&&(t.appendChild(e.element),e.$removeAfterMeasuring=!0)}return e.$measureCellElements}endGridMeasuring(){this.$removeAfterMeasuring&&(this.element.remove(),this.$removeAfterMeasuring=!1),this.$measureCellElements.subGridElement.remove()}measureRowHeight(){const e=this,{rowElement:r}=e.beginGridMeasuring(),t=w.getStyleValue(r,["height","border-top-width","border-bottom-width"]),i=parseInt(t.height),n=q.isFirefox?globalThis.devicePixelRatio/Math.max(Math.trunc(globalThis.devicePixelRatio),1):1,s=t["border-top-width"]?Math.round(n*parseFloat(t["border-top-width"])):0,a=t["border-bottom-width"]?Math.round(n*parseFloat(t["border-bottom-width"])):0;(e.rowHeight==null||e.rowHeight===e._rowHeightFromStyle)&&(e.rowHeight=!isNaN(i)&&i?i:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=s+a,e._isRowMeasured=!0,e.endGridMeasuring()}onThemeChange({theme:e}){this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:e})}refreshRows(e=!1){const{element:r,rowManager:t}=this;r.classList.add("b-notransition"),e?t.returnToTop():t.refresh(),r.classList.remove("b-notransition")}refreshColumn(e){e.isVisible&&(e.isLeaf?this.rowManager.forEach(r=>r.renderCell(r.getCell(e.id))):e.children.forEach(r=>this.refreshColumn(r)))}refreshVirtualScrollbars(){const e=this,{headerContainer:r,footerContainer:t,virtualScrollers:i,scrollable:n,hasVerticalOverflow:s}=e,{classList:a}=i,o=!a.contains("b-hide-display"),l=Object.values(e.subGrids).some(d=>d.overflowingHorizontally),c=l!==o;if(c&&i.classList.toggle("b-hide-display",!l),w.scrollBarWidth){const d=s||n.overflowY==="scroll";r.classList.toggle("b-show-yscroll-padding",d),t.classList.toggle("b-show-yscroll-padding",d),i.classList.toggle("b-show-yscroll-padding",d),c&&(l&&e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange())}}get hasVerticalOverflow(){return this.scrollable.hasOverflow("y")}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}onContentChange(){const e=this,r=e.rowManager;e.isVisible?(r.estimateTotalHeight(),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.ion({paint:"onContentChange",once:!0,thisObj:e}))}triggerPaint(){this.isPainted||this.refreshBodyRectangle(),super.triggerPaint()}onHeightChange(){const e=this;e.refreshBodyRectangle(),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:e}))}renderRows(e=!0){const r=this,t=e&&r.storeScroll();r.refreshSuspended||(r.trigger("beforeRenderRows"),r.renderingRows=!0,r.element.classList.add("b-grid-refreshing"),e||(r.scrollable.y=r._scrollTop=0),r.rowManager.reinitialize(!e),r.trigger("renderRows"),r.renderingRows=!1,r.onContentChange(),e&&r.restoreScroll(t),r.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:r,headerContainer:t,footerContainer:i,rowManager:n}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader",t),e.callEachSubGrid("refreshFooter",i),e.renderHeader(t,r),e.renderFooter(i,r),e.fixSizes();const s=n.removeAllRows();n.calculateRowCount(!1,!0,!0),n.rowCount&&(n.setPosition(s),e.renderRows())}}onPaintOverride(){}onPaint({firstPaint:e}){var r;const t=this;if(t.ariaElement.setAttribute("aria-rowcount",t.store.count+1),(r=super.onPaint)==null||r.call(this,...arguments),t.onPaintOverride()||!e)return;const{rowManager:i,store:n,element:s,headerContainer:a,bodyContainer:o,footerContainer:l}=t,c=w.scrollBarPadElement;let d,u=0;t.role=n!=null&&n.isTree?"treegrid":"grid",t.columns.ion({change:()=>d=!0,once:!0}),t.updateResponsive(t.width,0),d&&(t.callEachSubGrid("refreshHeader",a),t.callEachSubGrid("refreshFooter",l)),t.renderHeader(a,s),t.renderFooter(l,s),w.append(a,c),w.append(l,c),w.append(t.virtualScrollers,c),t.refreshBodyRectangle();const h=t.bodyContainer.offsetHeight;if(t.autoHeight?(t._bodyHeight=i.initWithHeight(s.offsetHeight-a.offsetHeight-l.offsetHeight,!0),o.style.height=t.bodyHeight+"px"):(t._bodyHeight=h,i.initWithHeight(t._bodyHeight,!0)),t.eachSubGrid(g=>{g.header.maxDepth>u&&(u=g.header.maxDepth)}),a.dataset.maxDepth=u,t.fixSizes(),(n.count||!n.isLoading)&&t.renderRows(),t.columns.usesAutoHeight){const{fonts:g}=document;(g==null?void 0:g.status)!=="loaded"&&g.ready.then(()=>!t.isDestroyed&&t.refreshRows())}t.initScroll(),t.initInternalEvents()}render(){var e;const r=this;r.requireSize=!!r.owner,super.render(...arguments),r.setupFocusListeners(),r.autoHeight||(r.headerContainer.offsetHeight&&!r.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),!r.splitFrom&&!((e=r.features.split)!=null&&e.owner)&&!("minHeight"in r.initialConfig)&&!("height"in r.initialConfig)&&parseInt(globalThis.getComputedStyle(r.element).minHeight)===r.height&&console.warn(`The ${r.$$name} is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.`))}renderHeader(e,r){}renderFooter(e,r){}beforeRenderCell(){}beforeRenderRow(){}afterRenderRow(){}afterScroll(){}processCellEditor(e){}afterColumnsChange(){}afterRemove(e){}afterToggleGroup(){}afterToggleSubGrid(){}onConfigChange(e){super.onConfigChange(e),this.isConfiguring||this.afterConfigChange(e)}afterConfigChange(e){}afterAddListener(e,r){}afterRemoveListener(e,r){}syncMaskCover(e=this.masked){if(e){const r=e.cover==="body"&&this.rectangleOf("bodyContainer"),t=r&&this.rectangleOf("virtualScrollers"),{style:i}=e.element;i.marginTop=r?`${r.y}px`:"",i.height=r?`${r.height+((t==null?void 0:t.height)||0)}px`:""}}maskBody(e){let r;return this.bodyContainer&&(this.masked=Bt.mergeConfigs(this.loadMaskDefaults,e),r=this.masked),r}unmaskBody(){this.masked=null}updateEmptyText(e){var r,t;(r=this.emptyTextEl)==null||r.remove(),this.emptyTextEl=w.createElement({parent:(t=this.firstItem)==null?void 0:t.element,className:"b-empty-text",[e!=null&&e.includes("<")?"html":"text"]:e})}toggleEmptyText(){const{bodyContainer:e,store:r}=this;e==null||e.classList.toggle("b-grid-empty",!(r.count>0||r.isLoading||r.isCommitting))}updateReadOnly(e,r){var t;if(super.updateReadOnly(e,r),!this.isConfiguring)for(const i of this.columns.bottomColumns)(t=i.updateReadOnly)==null||t.call(i,e)}getCurrentConfig(e){const r=super.getCurrentConfig(e),{store:t}=this,i=t.getInlineData(e),n=t.getCurrentConfig(e)||r.store;return i.length&&(r.data=i),n&&t.originalModelClass===zi&&delete n.modelClass,T.isEmpty(n)||(r.store=n),r.store&&delete r.store.data,r}};Aa.initClass(),ne.setVersion("grid","5.5.0"),Aa._$name="GridBase";var tc=class extends Aa{static get $name(){return"Grid"}static get type(){return"grid"}};tc.initClass(),tc._$name="Grid";var _u=class extends tc{static get $name(){return"TreeGrid"}static get type(){return"treegrid"}static get configurable(){return{store:{tree:!0}}}updateStore(e,r){if(e&&!e.tree)throw new Error("TreeGrid requires a Store configured with tree : true");super.updateStore(e,r)}};_u.initClass(),_u._$name="TreeGrid";var _a=class extends Bn{construct(){super.construct(...arguments);const e=this.treeGrid=this.up("gridbase",!0);if(!e)throw new Error("GroupBar must be used inside a Grid component");e.ion({paint:this.onTreePaint,once:!0,thisObj:this})}onTreePaint(){const e=this,{treeGrid:r}=e,{treeGroup:t,columnReorder:i}=r.features;if(!t)throw new Error("GroupBar widget requires the TreeGroup feature to be present");i.usingGroupBarWidget=!0,e.store=new re({fields:["cls","ascending"],internalListeners:{add:e.onStoreChanged,remove:e.onStoreChanged,thisObj:e}}),r.ion({treeGroupChange:e.onTreeGroupChanged,beforeColumnDropFinalize:e.onBeforeColumnDropFinalize,columnDrag:e.onColumnDrag,columnDragStart:e.onColumnDragStart,columnDrop:e.onColumnDrop,thisObj:e}),e.onTreeGroupChanged({levels:t.levels})}onStoreChanged({records:e}){var r;const t=this,{treeGrid:i}=t;!t.treeGrid.isConstructing&&((r=e==null?void 0:e[0])==null?void 0:r.cls)!=="b-drop-target"&&(t.ignoreGroupChange=!0,i.features.treeGroup.levels=t.store.map(({field:n})=>n),t.ignoreGroupChange=!1)}onTreeGroupChanged({levels:e}){if(!this.ignoreGroupChange){if(e.some(r=>r instanceof Function&&!r.fieldName))throw new Error("GroupBar only supports column grouping");this.store.data=(e||[]).map(r=>(r=r.fieldName||r,this.treeGrid.columns.get(r)))}}onColumnDragStart(){this.store.add({id:"placeholder",cls:"b-drop-target"})}onColumnDrag({context:e,column:r,event:t}){t.target.closest(".b-groupbar")&&(e.valid=!0)}onBeforeColumnDropFinalize({column:e,event:r}){r.target.closest(".b-groupbar")&&(e.isTreeColumn||(this.store.getById("placeholder").remove(),this.store.add(e)))}onColumnDrop(){var e;(e=this.store.getById("placeholder"))==null||e.remove()}};E(_a,"type","groupbar"),E(_a,"$name","GroupBar"),E(_a,"configurable",{selectedCls:"not-used",itemTpl(e){return O.encodeHtml(O.capitalize(e.getValue(this.displayField)))}}),_a.initClass(),_a._$name="GroupBar";var ka=class extends Fe{changePicker(e,r){return e=super.changePicker(e,r),e==null||e.ion({selectionChange:"onPickerSelectionChange",thisObj:this}),e}updateMultiSelect(e){super.updateMultiSelect(...arguments),this.picker.selectionMode.multiSelect=e}updateReadOnly(e){super.updateReadOnly(...arguments),this.picker.readOnly=e}get value(){return super.value}set value(e){var r;this._settingValue=!0,super.value=e,this.picker.selectedRecords=((r=e.map)==null?void 0:r.call(e,t=>this.store.getById(t)))||[],this._settingValue=!1}onPickerSelectionChange({selection:e}){this._settingValue||(this.value=e)}};E(ka,"$name","TreeCombo"),E(ka,"type","treecombo"),E(ka,"configurable",{multiSelect:!0,picker:{type:"treegrid",minWidth:"35em",disableGridRowModelWarning:!0,selectionMode:{row:!0,rowCheckboxSelection:!0}},chipView:{itemTpl(e){return O.xss`${e.name}`},scrollable:{overflowX:"hidden-scroll"}}}),ka.initClass(),ka._$name="TreeCombo";var ix=(e,r)=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()+r,e.getMilliseconds()),wp=function(){"use strict";var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(r){"use strict";if(this==null)throw new TypeError;var t=Object(this),i=t.length>>>0;if(i===0)return-1;var n=0;if(arguments.length>1&&(n=Number(arguments[1]),n!=n?n=0:n!=0&&n!=1/0&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var s=n>=0?n:Math.max(i-Math.abs(n),0);s<i;s++)if(s in t&&t[s]===r)return s;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(r,t){r.sort(function(i,n){return+i-+n}),t&&r[0]===0&&r.push(r.shift())},e.array.next=function(r,t,i){for(var n,s=i[0]!==0,a=0,o=t.length-1;o>-1;--o){if(n=t[o],n===r)return n;if(n>r||n===0&&s&&i[1]>r){a=o;continue}break}return t[a]},e.array.nextInvalid=function(r,t,i){for(var n=i[0],s=i[1],a=t.length,o=t[a-1]===0&&n!==0?s:0,l=r,c=t.indexOf(r),d=l;l===(t[c]||o);)if(l++,l>s&&(l=n),c++,c===a&&(c=0),l===d)return;return l},e.array.prev=function(r,t,i){for(var n,s=t.length,a=i[0]!==0,o=s-1,l=0;l<s;l++){if(n=t[l],n===r)return n;if(n<r||n===0&&a&&i[1]<r){o=l;continue}break}return t[o]},e.array.prevInvalid=function(r,t,i){for(var n=i[0],s=i[1],a=t.length,o=t[a-1]===0&&n!==0?s:0,l=r,c=t.indexOf(r),d=l;l===(t[c]||o);)if(l--,l<n&&(l=s),c--,c===-1&&(c=a-1),l===d)return;return l},e.day=e.D={name:"day",range:86400,val:function(r){return r.D||(r.D=e.date.getDate.call(r))},isValid:function(r,t){return e.D.val(r)===(t||e.D.extent(r)[1])},extent:function(r){if(r.DExtent)return r.DExtent;var t=e.M.val(r),i=e.DAYS_IN_MONTH[t-1];return t===2&&e.dy.extent(r)[1]===366&&(i=i+1),r.DExtent=[1,i]},start:function(r){return r.DStart||(r.DStart=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)))},end:function(r){return r.DEnd||(r.DEnd=e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r)))},next:function(r,t){t=t>e.D.extent(r)[1]?1:t;var i=e.date.nextRollover(r,t,e.D,e.M),n=e.D.extent(i)[1];return t=t>n?1:t||n,e.date.next(e.Y.val(i),e.M.val(i),t)},prev:function(r,t){var i=e.date.prevRollover(r,t,e.D,e.M),n=e.D.extent(i)[1];return e.date.prev(e.Y.val(i),e.M.val(i),t>n?n:t||n)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(r){return r.dc||(r.dc=Math.floor((e.D.val(r)-1)/7)+1)},isValid:function(r,t){return e.dc.val(r)===t||t===0&&e.D.val(r)>e.D.extent(r)[1]-7},extent:function(r){return r.dcExtent||(r.dcExtent=[1,Math.ceil(e.D.extent(r)[1]/7)])},start:function(r){return r.dcStart||(r.dcStart=e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,(e.dc.val(r)-1)*7+1||1)))},end:function(r){return r.dcEnd||(r.dcEnd=e.date.prev(e.Y.val(r),e.M.val(r),Math.min(e.dc.val(r)*7,e.D.extent(r)[1])))},next:function(r,t){t=t>e.dc.extent(r)[1]?1:t;var i=e.date.nextRollover(r,t,e.dc,e.M),n=e.dc.extent(i)[1];t=t>n?1:t;var s=e.date.next(e.Y.val(i),e.M.val(i),t===0?e.D.extent(i)[1]-6:1+7*(t-1));return s.getTime()<=r.getTime()?(i=e.M.next(r,e.M.val(r)+1),e.date.next(e.Y.val(i),e.M.val(i),t===0?e.D.extent(i)[1]-6:1+7*(t-1))):s},prev:function(r,t){var i=e.date.prevRollover(r,t,e.dc,e.M),n=e.dc.extent(i)[1];return t=t>n?n:t||n,e.dc.end(e.date.prev(e.Y.val(i),e.M.val(i),1+7*(t-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(r){return r.dw||(r.dw=e.date.getDay.call(r)+1)},isValid:function(r,t){return e.dw.val(r)===(t||7)},extent:function(){return[1,7]},start:function(r){return e.D.start(r)},end:function(r){return e.D.end(r)},next:function(r,t){return t=t>7?1:t||7,e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)+(t-e.dw.val(r))+(t<=e.dw.val(r)?7:0))},prev:function(r,t){return t=t>7?7:t||7,e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r)+(t-e.dw.val(r))+(t>=e.dw.val(r)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(r){return r.dy||(r.dy=Math.ceil(1+(e.D.start(r).getTime()-e.Y.start(r).getTime())/e.DAY))},isValid:function(r,t){return e.dy.val(r)===(t||e.dy.extent(r)[1])},extent:function(r){var t=e.Y.val(r);return r.dyExtent||(r.dyExtent=[1,t%4?365:366])},start:function(r){return e.D.start(r)},end:function(r){return e.D.end(r)},next:function(r,t){t=t>e.dy.extent(r)[1]?1:t;var i=e.date.nextRollover(r,t,e.dy,e.Y),n=e.dy.extent(i)[1];return t=t>n?1:t||n,e.date.next(e.Y.val(i),e.M.val(i),t)},prev:function(r,t){var i=e.date.prevRollover(r,t,e.dy,e.Y),n=e.dy.extent(i)[1];return t=t>n?n:t||n,e.date.prev(e.Y.val(i),e.M.val(i),t)}},e.hour=e.h={name:"hour",range:3600,val:function(r){return r.h||(r.h=e.date.getHour.call(r))},isValid:function(r,t){return e.h.val(r)===t},extent:function(){return[0,23]},start:function(r){return r.hStart||(r.hStart=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r)))},end:function(r){return r.hEnd||(r.hEnd=e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r)))},next:function(r,t){t=t>23?0:t;var i=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)+(t<=e.h.val(r)?1:0),t);return!e.date.isUTC&&i.getTime()<=r.getTime()&&(i=e.date.next(e.Y.val(i),e.M.val(i),e.D.val(i),t+1)),i},prev:function(r,t){return t=t>23?23:t,e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r)+(t>=e.h.val(r)?-1:0),t)}},e.minute=e.m={name:"minute",range:60,val:function(r){return r.m||(r.m=e.date.getMin.call(r))},isValid:function(r,t){return e.m.val(r)===t},extent:function(r){return[0,59]},start:function(r){return r.mStart||(r.mStart=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r)))},end:function(r){return r.mEnd||(r.mEnd=e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r)))},next:function(r,t){var i=e.m.val(r),n=e.s.val(r),s=t>59?60-i:t<=i?60-i+t:t-i,a=new Date(r.getTime()+s*e.MIN-n*e.SEC);return!e.date.isUTC&&a.getTime()<=r.getTime()&&(a=new Date(r.getTime()+(s+120)*e.MIN-n*e.SEC)),a},prev:function(r,t){return t=t>59?59:t,e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r)+(t>=e.m.val(r)?-1:0),t)}},e.month=e.M={name:"month",range:2629740,val:function(r){return r.M||(r.M=e.date.getMonth.call(r)+1)},isValid:function(r,t){return e.M.val(r)===(t||12)},extent:function(){return[1,12]},start:function(r){return r.MStart||(r.MStart=e.date.next(e.Y.val(r),e.M.val(r)))},end:function(r){return r.MEnd||(r.MEnd=e.date.prev(e.Y.val(r),e.M.val(r)))},next:function(r,t){return t=t>12?1:t||12,e.date.next(e.Y.val(r)+(t>e.M.val(r)?0:1),t)},prev:function(r,t){return t=t>12?12:t||12,e.date.prev(e.Y.val(r)-(t>=e.M.val(r)?1:0),t)}},e.second=e.s={name:"second",range:1,val:function(r){return r.s||(r.s=e.date.getSec.call(r))},isValid:function(r,t){return e.s.val(r)===t},extent:function(){return[0,59]},start:function(r){return r},end:function(r){return r},next:function(r,t){var i=e.s.val(r),n=t>59?60-i:t<=i?60-i+t:t-i,s=new Date(r.getTime()+n*e.SEC);return!e.date.isUTC&&s.getTime()<=r.getTime()&&(s=new Date(r.getTime()+(n+7200)*e.SEC)),s},prev:function(r,t,i){return t=t>59?59:t,e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r)+(t>=e.s.val(r)?-1:0),t)}},e.time=e.t={name:"time",range:1,val:function(r){return r.t||(r.t=e.h.val(r)*3600+e.m.val(r)*60+e.s.val(r))},isValid:function(r,t){return e.t.val(r)===t},extent:function(){return[0,86399]},start:function(r){return r},end:function(r){return r},next:function(r,t){t=t>86399?0:t;var i=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)+(t<=e.t.val(r)?1:0),0,0,t);return!e.date.isUTC&&i.getTime()<r.getTime()&&(i=e.date.next(e.Y.val(i),e.M.val(i),e.D.val(i),e.h.val(i),e.m.val(i),t+7200)),i},prev:function(r,t){return t=t>86399?86399:t,e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)+(t>=e.t.val(r)?-1:0),0,0,t)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(r){return r.wm||(r.wm=(e.D.val(r)+(e.dw.val(e.M.start(r))-1)+(7-e.dw.val(r)))/7)},isValid:function(r,t){return e.wm.val(r)===(t||e.wm.extent(r)[1])},extent:function(r){return r.wmExtent||(r.wmExtent=[1,(e.D.extent(r)[1]+(e.dw.val(e.M.start(r))-1)+(7-e.dw.val(e.M.end(r))))/7])},start:function(r){return r.wmStart||(r.wmStart=e.date.next(e.Y.val(r),e.M.val(r),Math.max(e.D.val(r)-e.dw.val(r)+1,1)))},end:function(r){return r.wmEnd||(r.wmEnd=e.date.prev(e.Y.val(r),e.M.val(r),Math.min(e.D.val(r)+(7-e.dw.val(r)),e.D.extent(r)[1])))},next:function(r,t){t=t>e.wm.extent(r)[1]?1:t;var i=e.date.nextRollover(r,t,e.wm,e.M),n=e.wm.extent(i)[1];return t=t>n?1:t||n,e.date.next(e.Y.val(i),e.M.val(i),Math.max(1,(t-1)*7-(e.dw.val(i)-2)))},prev:function(r,t){var i=e.date.prevRollover(r,t,e.wm,e.M),n=e.wm.extent(i)[1];return t=t>n?n:t||n,e.wm.end(e.date.next(e.Y.val(i),e.M.val(i),Math.max(1,(t-1)*7-(e.dw.val(i)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(r){if(r.wy)return r.wy;var t=e.dw.next(e.wy.start(r),5),i=e.dw.next(e.Y.prev(t,e.Y.val(t)-1),5);return r.wy=1+Math.ceil((t.getTime()-i.getTime())/e.WEEK)},isValid:function(r,t){return e.wy.val(r)===(t||e.wy.extent(r)[1])},extent:function(r){if(r.wyExtent)return r.wyExtent;var t=e.dw.next(e.wy.start(r),5),i=e.dw.val(e.Y.start(t)),n=e.dw.val(e.Y.end(t));return r.wyExtent=[1,i===5||n===5?53:52]},start:function(r){return r.wyStart||(r.wyStart=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)-(e.dw.val(r)>1?e.dw.val(r)-2:6)))},end:function(r){return r.wyEnd||(r.wyEnd=e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r)+(e.dw.val(r)>1?8-e.dw.val(r):0)))},next:function(r,t){t=t>e.wy.extent(r)[1]?1:t;var i=e.dw.next(e.wy.start(r),5),n=e.date.nextRollover(i,t,e.wy,e.Y);e.wy.val(n)!==1&&(n=e.dw.next(n,2));var s=e.wy.extent(n)[1],a=e.wy.start(n);return t=t>s?1:t||s,e.date.next(e.Y.val(a),e.M.val(a),e.D.val(a)+7*(t-1))},prev:function(r,t){var i=e.dw.next(e.wy.start(r),5),n=e.date.prevRollover(i,t,e.wy,e.Y);e.wy.val(n)!==1&&(n=e.dw.next(n,2));var s=e.wy.extent(n)[1],a=e.wy.end(n);return t=t>s?s:t||s,e.wy.end(e.date.next(e.Y.val(a),e.M.val(a),e.D.val(a)+7*(t-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(r){return r.Y||(r.Y=e.date.getYear.call(r))},isValid:function(r,t){return e.Y.val(r)===t},extent:function(){return[1970,2099]},start:function(r){return r.YStart||(r.YStart=e.date.next(e.Y.val(r)))},end:function(r){return r.YEnd||(r.YEnd=e.date.prev(e.Y.val(r)))},next:function(r,t){return t>e.Y.val(r)&&t<=e.Y.extent()[1]?e.date.next(t):e.NEVER},prev:function(r,t){return t<e.Y.val(r)&&t>=e.Y.extent()[0]?e.date.prev(t):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(r){return r.fd||(r.fd=r.getTime())},isValid:function(r,t){return e.fd.val(r)===t},extent:function(){return[0,3250368e7]},start:function(r){return r},end:function(r){return r},next:function(r,t){return e.fd.val(r)<t?new Date(t):e.NEVER},prev:function(r,t){return e.fd.val(r)>t?new Date(t):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(r,t){var i=t[0];return{name:"after "+r.name,range:(r.extent(new Date)[1]-i)*r.range,val:r.val,isValid:function(n,s){return this.val(n)>=i},extent:r.extent,start:r.start,end:r.end,next:function(n,s){return s!=i&&(s=r.extent(n)[0]),r.next(n,s)},prev:function(n,s){return s=s===i?r.extent(n)[1]:i-1,r.prev(n,s)}}},e.modifier.before=e.modifier.b=function(r,t){var i=t[t.length-1];return{name:"before "+r.name,range:r.range*(i-1),val:r.val,isValid:function(n,s){return this.val(n)<i},extent:r.extent,start:r.start,end:r.end,next:function(n,s){return s=s===i?r.extent(n)[0]:i,r.next(n,s)},prev:function(n,s){return s=s===i?i-1:r.extent(n)[1],r.prev(n,s)}}},e.compile=function(r){var t=[],i=0,n;for(var s in r){var a=s.split("_"),o=a[0],l=a[1],c=r[s],d=l?e.modifier[l](e[o],c):e[o];t.push({constraint:d,vals:c}),i++}t.sort(function(h,g){var f=h.constraint.range,m=g.constraint.range;return m<f?-1:m>f?1:0}),n=t[i-1].constraint;function u(h){return h==="next"?function(g,f){return g.getTime()>f.getTime()}:function(g,f){return f.getTime()>g.getTime()}}return{start:function(h,g){for(var f=g,m=e.array[h],p=1e3,v;p--&&!v&&f;){v=!0;for(var y=0;y<i;y++){var C=t[y].constraint,D=C.val(f),S=C.extent(f),x=m(D,t[y].vals,S);if(!C.isValid(f,x)){f=C[h](f,x),v=!1;break}}}return f!==e.NEVER&&(f=h==="next"?n.start(f):n.end(f)),f},end:function(h,g){for(var f,m=e.array[h+"Invalid"],p=u(h),v=i-1;v>=0;v--){var y=t[v].constraint,C=y.val(g),D=y.extent(g),S=m(C,t[v].vals,D),x;S!==void 0&&(x=y[h](g,S),x&&(!f||p(f,x))&&(f=x))}return f},tick:function(h,g){return new Date(h==="next"?n.end(g).getTime()+e.SEC:n.start(g).getTime()-e.SEC)},tickSafe:function(h,g){return h==="next"?ix(n.end(g),1):ix(n.start(g),-1)},tickStart:function(h){return n.start(h)}}},e.schedule=function(r){if(!r)throw new Error("Missing schedule definition.");if(!r.schedules)throw new Error("Definition must include at least one schedule.");for(var t=[],i=r.schedules.length,n=[],s=r.exceptions?r.exceptions.length:0,a=0;a<i;a++)t.push(e.compile(r.schedules[a]));for(var o=0;o<s;o++)n.push(e.compile(r.exceptions[o]));function l(S,x,R,I,M){var P=C(S),_=x,A=1e6,z=[],Y=[],V,U,K=[],le=S==="next",Ce,Me=le?0:1,te=le?1:0;if(R=R?new Date(R):new Date,!R||!R.getTime())throw new Error("Invalid start date.");for(d(S,t,z,R),h(S,n,Y,R);A--&&_&&(V=D(z,P))&&!(I&&P(V,I));){if(s&&(g(S,n,Y,V),U=p(S,Y,V))){u(S,t,z,U);continue}if(M){var Ie=v(Y,P);U=y(S,t,z,V,Ie);var se=le?[new Date(Math.max(R,V)),U?new Date(I?Math.min(U,I):U):void 0]:[U?new Date(I?Math.max(I,U.getTime()+e.SEC):U.getTime()+e.SEC):void 0,new Date(Math.min(R,V.getTime()+e.SEC))];if(Ce&&se[Me].getTime()===Ce[te].getTime()?(Ce[te]=se[te],_++):(Ce=se,K.push(Ce)),!U)break;u(S,t,z,U)}else K.push(le?new Date(Math.max(R,V)):m(t,z,V,I)),f(S,t,z,V);_--}for(var he=0,Pr=K.length;he<Pr;he++){var Rt=K[he];K[he]=Object.prototype.toString.call(Rt)==="[object Array]"?[c(Rt[0]),c(Rt[1])]:c(Rt)}return K.length===0?e.NEVER:x===1?K[0]:K}function c(S){if(S instanceof Date&&!isNaN(S.valueOf()))return new Date(S)}function d(S,x,R,I){for(var M=0,P=x.length;M<P;M++)R[M]=x[M].start(S,I)}function u(S,x,R,I){for(var M=C(S),P=0,_=x.length;P<_;P++)R[P]&&!M(R[P],I)&&(R[P]=x[P].start(S,I))}function h(S,x,R,I){for(var M=C(S),P=0,_=x.length;P<_;P++){var A=x[P].start(S,I);A?R[P]=[A,x[P].end(S,A)]:R[P]=e.NEVER}}function g(S,x,R,I){for(var M=C(S),P=0,_=x.length;P<_;P++)if(R[P]&&!M(R[P][0],I)){var A=x[P].start(S,I);A?R[P]=[A,x[P].end(S,A)]:R[P]=e.NEVER}}function f(S,x,R,I){for(var M=0,P=x.length;M<P;M++)if(R[M]&&R[M].getTime()===I.getTime()){const _=x[M].start(S,x[M].tick(S,I));_!==e.NEVER&&_.getTime()===R[M].getTime()?R[M]=x[M].start(S,x[M].tickSafe(S,I)):R[M]=_}}function m(S,x,R,I){for(var M,P=0,_=x.length;P<_;P++)if(x[P]&&x[P].getTime()===R.getTime()){var A=S[P].tickStart(R);if(I&&A<I)return I;(!M||A>M)&&(M=A)}return M}function p(S,x,R){for(var I=C(S),M,P=0,_=x.length;P<_;P++){var A=x[P];A&&!I(A[0],R)&&(!A[1]||I(A[1],R))&&(!M||I(A[1],M))&&(M=A[1])}return M}function v(S,x){for(var R,I=0,M=S.length;I<M;I++)S[I]&&(!R||x(R,S[I][0]))&&(R=S[I][0]);return R}function y(S,x,R,I,M){for(var P=C(S),_,A=0,z=x.length;A<z;A++){var Y=R[A];if(Y&&Y.getTime()===I.getTime()){var V=x[A].end(S,Y);if(M&&(!V||P(V,M)))return M;(!_||P(V,_))&&(_=V)}}return _}function C(S){return S==="next"?function(x,R){return!R||x.getTime()>R.getTime()}:function(x,R){return!x||R.getTime()>x.getTime()}}function D(S,x){for(var R=S[0],I=1,M=S.length;I<M;I++)S[I]&&x(R,S[I])&&(R=S[I]);return R}return{isValid:function(S){return l("next",1,S,S)!==e.NEVER},next:function(S,x,R){return l("next",S||1,x,R)},prev:function(S,x,R){return l("prev",S||1,x,R)},nextRange:function(S,x,R){return l("next",S||1,x,R,!0)},prevRange:function(S,x,R){return l("prev",S||1,x,R,!0)}}},e.setTimeout=function(r,t){var i=e.schedule(t),n;r&&s();function s(){var a=Date.now(),o=i.next(2,a);if(!o[0]){n=void 0;return}var l=o[0].getTime()-a;l<1e3&&(l=o[1]?o[1].getTime()-a:1e3),l<2147483647?n=setTimeout(r,l):n=setTimeout(s,2147483647)}return{isDone:function(){return!n},clear:function(){clearTimeout(n)}}},e.setInterval=function(r,t){if(!r)return;var i=e.setTimeout(s,t),n=i.isDone();function s(){n||(r(),i=e.setTimeout(s,t))}return{isDone:function(){return i.isDone()},clear:function(){n=!0,i.clear()}}},e.date={},e.date.timezone=function(r){e.date.build=r?function(n,s,a,o,l,c){return new Date(n,s,a,o,l,c)}:function(n,s,a,o,l,c){return new Date(Date.UTC(n,s,a,o,l,c))};var t=r?"get":"getUTC",i=Date.prototype;e.date.getYear=i[t+"FullYear"],e.date.getMonth=i[t+"Month"],e.date.getDate=i[t+"Date"],e.date.getDay=i[t+"Day"],e.date.getHour=i[t+"Hours"],e.date.getMin=i[t+"Minutes"],e.date.getSec=i[t+"Seconds"],e.date.isUTC=!r},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=e.SEC*60,e.HOUR=e.MIN*60,e.DAY=e.HOUR*24,e.WEEK=e.DAY*7,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(r,t,i,n,s,a){return e.date.build(r,t!==void 0?t-1:0,i!==void 0?i:1,n||0,s||0,a||0)},e.date.nextRollover=function(r,t,i,n){var s=i.val(r),a=i.extent(r)[1];return(t||a)<=s||t>a?new Date(n.end(r).getTime()+e.SEC):n.start(r)},e.date.prev=function(r,t,i,n,s,a){var o=arguments.length;return t=o<2?11:t-1,i=o<3?e.D.extent(e.date.next(r,t+1))[1]:i,n=o<4?23:n,s=o<5?59:s,a=o<6?59:a,e.date.build(r,t,i,n,s,a)},e.date.prevRollover=function(r,t,i,n){var s=i.val(r);return t>=s||!t?n.start(n.prev(r,n.val(r)-1)):n.start(r)},e.parse={},e.parse.cron=function(r,t){var i={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},n={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},s={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function a(y,C,D){return isNaN(y)?i[y]||null:Math.min(+y+(C||0),D||9999)}function o(y){var C={},D;for(D in y)D!=="dc"&&D!=="d"&&(C[D]=y[D].slice(0));return C}function l(y,C,D,S,x){var R=D;for(y[C]||(y[C]=[]);R<=S;)y[C].indexOf(R)<0&&y[C].push(R),R+=x||1;y[C].sort(function(I,M){return I-M})}function c(y,C,D,S){(C.d&&!C.dc||C.dc&&C.dc.indexOf(S)<0)&&(y.push(o(C)),C=y[y.length-1]),l(C,"d",D,D),l(C,"dc",S,S)}function d(y,C,D){var S={},x={};D===1?(l(C,"D",1,3),l(C,"d",i.MON,i.FRI),l(S,"D",2,2),l(S,"d",i.TUE,i.FRI),l(x,"D",3,3),l(x,"d",i.TUE,i.FRI)):(l(C,"D",D-1,D+1),l(C,"d",i.MON,i.FRI),l(S,"D",D-1,D-1),l(S,"d",i.MON,i.THU),l(x,"D",D+1,D+1),l(x,"d",i.TUE,i.FRI)),y.exceptions.push(S),y.exceptions.push(x)}function u(y,C,D,S,x,R){var I=y.split("/"),M=+I[1],P=I[0];if(P!=="*"&&P!=="0"){var _=P.split("-");S=a(_[0],R,x),x=a(_[1],R,x)||x}l(C,D,S,x,M)}function h(y,C,D,S,x,R){var I,M,P=C.schedules,_=P[P.length-1];y==="L"&&(y=S-1),(I=a(y,R,x))!==null?l(_,D,I,I):(I=a(y.replace("W",""),R,x))!==null?d(C,_,I):(I=a(y.replace("L",""),R,x))!==null?c(P,_,I,S-1):(M=y.split("#")).length===2?(I=a(M[0],R,x),c(P,_,I,a(M[1]))):u(y,_,D,S,x,R)}function g(y){return y.indexOf("#")>-1||y.indexOf("L")>0}function f(y,C){return g(y)&&!g(C)?1:y-C}function m(y){var C={schedules:[{}],exceptions:[]},D=y.replace(/(\s)+/g," ").split(" "),S,x,R,I;for(S in s)if(x=s[S],R=D[x[0]],R&&R!=="*"&&R!=="?"){I=R.split(",").sort(f);var M,P=I.length;for(M=0;M<P;M++)h(I[M],C,S,x[1],x[2],x[3])}return C}function p(y){var C=y.toUpperCase();return n[C]||C}var v=p(r);return m(t?v:"0 "+v)},e.parse.recur=function(){var r=[],t=[],i,n=r,s,a,o,l,c,d,u,h;function g(f,m,p){if(f=l?f+"_"+l:f,i||(n.push({}),i=n[0]),i[f]||(i[f]=[]),s=i[f],o){for(a=[],u=m;u<=p;u+=o)a.push(u);h={n:f,x:o,c:s.length,m:p}}a=c?[m]:d?[p]:a;var v=a.length;for(u=0;u<v;u+=1){var y=a[u];s.indexOf(y)<0&&s.push(y)}a=o=l=c=d=0}return{schedules:r,exceptions:t,on:function(){return a=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(f){return o=f||1,this},after:function(f){return l="a",a=[f],this},before:function(f){return l="b",a=[f],this},first:function(){return c=1,this},last:function(){return d=1,this},time:function(){for(var f=0,m=a.length;f<m;f++){var p=a[f].split(":");p.length<3&&p.push(0),a[f]=+p[0]*3600+ +p[1]*60+ +p[2]}return g("t"),this},second:function(){return g("s",0,59),this},minute:function(){return g("m",0,59),this},hour:function(){return g("h",0,23),this},dayOfMonth:function(){return g("D",1,d?0:31),this},dayOfWeek:function(){return g("d",1,7),this},onWeekend:function(){return a=[1,7],this.dayOfWeek()},onWeekday:function(){return a=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return g("dc",1,d?0:5),this},dayOfYear:function(){return g("dy",1,d?0:366),this},weekOfMonth:function(){return g("wm",1,d?0:5),this},weekOfYear:function(){return g("wy",1,d?0:53),this},month:function(){return g("M",1,12),this},year:function(){return g("Y",1970,2450),this},fullDate:function(){for(var f=0,m=a.length;f<m;f++)a[f]=a[f].getTime();return g("fd"),this},customModifier:function(f,m){var p=e.modifier[f];if(!p)throw new Error("Custom modifier "+f+" not recognized!");return l=f,a=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(f){var m=e[f];if(!m)throw new Error("Custom time period "+f+" not recognized!");return g(f,m.extent(new Date)[0],m.extent(new Date)[1]),this},startingOn:function(f){return this.between(f,h.m)},between:function(f,m){return i[h.n]=i[h.n].splice(0,h.c),o=h.x,g(h.n,f,m),this},and:function(){return i=n[n.push({})-1],this},except:function(){return n=t,i=null,this}}},e.parse.text=function(r){var t=e.parse.recur,i=0,n="",s,a={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},o={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(S,x,R,I){return{startPos:S,endPos:x,text:R,type:I}}function c(S){var x=S instanceof Array?S:[S],R=/\s+/,I,M,P,_,A,z;for(x.push(R),A=i;!I||I.type===R;){z=-1,M=n.substring(A),I=l(A,A,n.split(R)[0]);var Y,V=x.length;for(Y=0;Y<V;Y++)_=x[Y],P=_.exec(M),P&&P.index===0&&P[0].length>z&&(z=P[0].length,I=l(A,A+z,M.substring(0,z),_));I.type===R&&(A=I.endPos)}return I}function d(S){var x=c(S);return i=x.endPos,x}function u(S){for(var x=+C(S),R=v(a.through)?+C(S):x,I=[],M=x;M<=R;M++)I.push(M);return I}function h(S){for(var x=u(S);v(a.and);)x=x.concat(u(S));return x}function g(S){var x,R,I,M;v(a.weekend)?S.on(o.sun,o.sat).dayOfWeek():v(a.weekday)?S.on(o.mon,o.tue,o.wed,o.thu,o.fri).dayOfWeek():(x=C(a.rank),S.every(x),R=p(S),v(a.start)?(x=C(a.rank),S.startingOn(x),y(R.type)):v(a.between)&&(I=C(a.rank),v(a.and)&&(M=C(a.rank),S.between(I,M))))}function f(S){v(a.first)?S.first():v(a.last)?S.last():S.on(h(a.rank)),p(S)}function m(S){i=0,n=S,s=-1;for(var x=t();i<n.length&&s<0;){var R=y([a.every,a.after,a.before,a.onthe,a.on,a.of,a.in,a.at,a.and,a.except,a.also]);switch(R.type){case a.every:g(x);break;case a.after:c(a.time).type!==void 0?(x.after(C(a.time)),x.time()):c(a.fullDate).type!==void 0?(x.after(C(a.fullDate)),x.fullDate()):(x.after(C(a.rank)),p(x));break;case a.before:c(a.time).type!==void 0?(x.before(C(a.time)),x.time()):c(a.fullDate).type!==void 0?(x.before(C(a.fullDate)),x.fullDate()):(x.before(C(a.rank)),p(x));break;case a.onthe:f(x);break;case a.on:x.on(h(a.dayName)).dayOfWeek();break;case a.of:x.on(h(a.monthName)).month();break;case a.in:x.on(h(a.yearIndex)).year();break;case a.at:for(x.on(C(a.time)).time();v(a.and);)x.on(C(a.time)).time();break;case a.and:break;case a.also:x.and();break;case a.except:x.except();break;default:s=i}}return{schedules:x.schedules,exceptions:x.exceptions,error:s}}function p(S){var x=y([a.second,a.minute,a.hour,a.dayOfYear,a.dayOfWeek,a.dayInstance,a.day,a.month,a.year,a.weekOfMonth,a.weekOfYear]);switch(x.type){case a.second:S.second();break;case a.minute:S.minute();break;case a.hour:S.hour();break;case a.dayOfYear:S.dayOfYear();break;case a.dayOfWeek:S.dayOfWeek();break;case a.dayInstance:S.dayOfWeekCount();break;case a.day:S.dayOfMonth();break;case a.weekOfMonth:S.weekOfMonth();break;case a.weekOfYear:S.weekOfYear();break;case a.month:S.month();break;case a.year:S.year();break;default:s=i}return x}function v(S){var x=c(S).type===S;return x&&d(S),x}function y(S){var x=d(S);return x.type?x.text=D(x.text,S):s=i,x}function C(S){return y(S).text}function D(S,x){var R=S;switch(x){case a.time:var I=S.split(/(:|am|pm)/),M=I[3]==="pm"&&I[0]<12?parseInt(I[0],10)+12:I[0],P=I[2].trim();R=(M.length===1?"0":"")+M+":"+P;break;case a.rank:R=parseInt(/^\d+/.exec(S)[0],10);break;case a.monthName:case a.dayName:R=o[S.substring(0,3)];break;case a.fullDate:R=new Date(S.toUpperCase());break}return R}return m(r.toLowerCase())},e}();wp.date.localTime();var zt=wp;function nx(e){const r=[],t=[];let i;const n=function*(){for(i||(i=e[Symbol.iterator]());r.length&&(yield*r,r.length=0),!!i;){const{value:a,done:o}=i.next();if(o){i=null,e=null;break}t.push(a),yield a}},s=function*(){for(i||(i=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),!!i;){const{value:a,done:o}=i.next();if(o){i=null,e=null;break}r.push(a),yield a}};return[n(),s()]}function*Jk(e,r){if(r<0)throw new Error("Batch size needs to a natural number");r=r|0;const t=[];for(const i of e)t.length===r&&(yield t,t.length=0),t.push(i);t.length>0&&(yield t)}function*Qk(e,r){let t=0;for(const i of e)r(i,t++)&&(yield i)}function*eF(e,r){let t=0;for(const i of e)++t>r&&(yield i)}function tF(e,r){let t=0;for(const i of e)if(!r(i,t++))return!1;return!0}function rF(e,r){let t=0;for(const i of e)if(r(i,t++))return!0;return!1}function*ku(e,r){let t=0;for(const i of e)yield r(i,t++)}function iF(e,r,t){let i=0,n=t;for(const s of e)n=r(n,s,i++);return n}function*sx(e){const r=new Set;for(const t of e)r.has(t)||(r.add(t),yield t)}function*nF(e,r){const t=new Set;for(const i of e){const n=r(i);t.has(n)||(t.add(n),yield i)}}function*sF(e,r){let t=0;for(const i of e)if(r(i,t++))yield i;else return}function*ax(...e){for(let r=0;r<e.length;r++)yield*e[r]}function*ox(e){for(const r of e)yield*r}var Fa=class{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new Fa(e)}copy(){const[e,r]=nx(this.iterable);return this.iterable=r,new Fa(e)}split(){const[e,r]=nx(this.iterable);return[new Fa(e),this.derive(r)]}inBatchesBySize(e){return this.derive(Jk(this.iterable,e))}filter(e){return this.derive(Qk(this.iterable,e))}drop(e){return this.derive(eF(this.iterable,e))}map(e){return this.derive(ku(this.iterable,e))}reduce(e,r){return iF(this,e,r)}concat(){return this.derive(ox(this.iterable))}uniqueOnly(){return this.derive(sx(this.iterable))}uniqueOnlyBy(e){return this.derive(nF(this.iterable,e))}every(e){return tF(this,e)}some(e){return rF(this,e)}takeWhile(e){return this.derive(sF(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new lx(this)}},aF=e=>new Fa(e),Ct=aF,lx=class extends Fa{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new Fa(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let r=this.$iterator,t=e.length;for(t>0&&(yield*e);;){if(e.length>t){for(let s=t;s<e.length;s++)yield e[s];t=e.length}if(!r)break;const{value:i,done:n}=r.next();n?(r=this.$iterator=null,this.$iterable=null):(e.push(i),t++,yield i)}}else yield*e}},oF=e=>new lx(e),cx=oF,Fu=Symbol("MixinIdentity"),rc=Symbol("MixinStateProperty"),lF=class{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=cx(this.linearizedByTopoLevels())}static new(e){const r=new this;return e&&Object.assign(r,e),r}get topoLevels(){return this.$topoLevels!==void 0?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort((e,r)=>e-r)}get elementsByTopoLevel(){return this.$elementsByTopoLevel!==void 0?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,r){let t=e.get(r);return t||(t=[],e.set(r,t)),t}buildElementsByTopoLevel(){let e=0;const r=this.baseEl?Ct(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,t=Ct(this.sourceEl.requirements).map(i=>i.walkDepthState.elementsByTopoLevel).concat().reduce((i,[n,s])=>(n>e&&(e=n),this.getOrCreateLevel(i,n).push(s),i),new Map);return this.getOrCreateLevel(t,e+1).push([this.sourceEl]),Ct(t).map(([i,n])=>[i,Ct(n).concat().uniqueOnly().filter(s=>!r.has(s)).sort((s,a)=>s.id-a.id)]).toMap()}*linearizedByTopoLevels(){yield*Ct(this.topoLevels).map(e=>this.elementsByTopoLevel.get(e)).concat()}},dx=1,cF=e=>class extends e{},Ou=class{},Ep=class{constructor(){this.id=dx++,this.requirements=[],this.baseClass=Ou,this.identitySymbol=void 0,this.mixinLambda=cF,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(e){const r=new this;e&&Object.assign(r,e),r.walkDepthState=lF.new({sourceEl:r,baseEl:uF(r.baseClass)});const t=r.mixinLambda,i=r.identitySymbol=Symbol(t.name),n=Object.assign(function(s){const a=t(s);return a.prototype[i]=!0,a},{[Fu]:i,[rc]:r});return Object.defineProperty(n,Symbol.hasInstance,{value:hx}),r.mixinLambda=n,r}get minimalClass(){return this.$minimalClass!==void 0?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const r=this.constructor,t=r.baseClassesIds.get(e);if(t!==void 0)return t;const i=dx++;return r.baseClassesIds.set(e,i),i}buildMinimalClass(){const e=this.constructor;let r=this.baseClass;const t=this.walkDepthState.linearizedByTopoLevelsSource.reduce((n,s)=>{const{cls:a,hash:o}=n,l=o+String.fromCharCode(s.id);let c=e.minimalClassesByLinearHash.get(l);return c||(c=s.mixinLambda(a),s.name=c.name,e.minimalClassesByLinearHash.set(l,c)),n.cls=c,n.hash=l,n},{cls:r,hash:String.fromCharCode(this.getBaseClassMixinId(r))}).cls,i=Object.assign(t,{[Fu]:this.identitySymbol,[rc]:this,mix:this.mixinLambda,derive:n=>G([i,n],s=>class extends s{}),$:this,toString:this.toString.bind(this)});return Object.defineProperty(i,Symbol.hasInstance,{value:hx}),i}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce((e,r)=>`${r.name}(${e})`,this.baseClass.name)}};Ep.minimalClassesByLinearHash=new Map,Ep.baseClassesIds=new Map;var dF=e=>Object.getPrototypeOf(e.prototype).constructor.hasOwnProperty(rc),uF=e=>Object.getPrototypeOf(e.prototype).constructor[rc],ux=(e,r)=>{let t;if(e.length>0){const s=e[e.length-1];!dF(s)&&s!==Ou&&(t=s)}const i=[];return e.forEach((s,a)=>{const o=s[rc];if(o!==void 0){const l=o.baseClass;if(l!==Ou)if(t){if(t!==l){const c=l.prototype.isPrototypeOf(t.prototype),d=t.prototype.isPrototypeOf(l.prototype);if(!c&&!d)throw new Error("Base class mismatch");t=d?l:t}}else t=l;i.push(o)}else if(a!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}),Ep.new({requirements:i,mixinLambda:r,baseClass:t||Ou}).minimalClass},hx=function(e){return!!(e&&e[this[Fu]])},Wt=(e,r)=>!!(e&&e[r[Fu]]),G=ux,xp=ux,Ke=class{initialize(e){e&&Object.assign(this,e)}static new(e){const r=new this;return r.initialize(e),r}},ee;(function(e){e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"})(ee||(ee={}));var ue;(function(e){e.MustStartOn="muststarton",e.MustFinishOn="mustfinishon",e.StartNoEarlierThan="startnoearlierthan",e.StartNoLaterThan="startnolaterthan",e.FinishNoEarlierThan="finishnoearlierthan",e.FinishNoLaterThan="finishnolaterthan",e.AsSoonAsPossible="assoonaspossible",e.AsLateAsPossible="aslateaspossible"})(ue||(ue={}));var Oe;(function(e){e.Normal="Normal",e.FixedDuration="FixedDuration",e.FixedEffort="FixedEffort",e.FixedUnits="FixedUnits"})(Oe||(Oe={}));var ci;(function(e){e[e.NoError=0]="NoError",e[e.CyclicDependency=1]="CyclicDependency",e[e.DuplicatingDependency=2]="DuplicatingDependency"})(ci||(ci={}));var ft;(function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToStart=2]="EndToStart",e[e.EndToEnd=3]="EndToEnd"})(ft||(ft={}));var rs;(function(e){e.Project="Project",e.FromEvent="FromEvent",e.ToEvent="ToEvent"})(rs||(rs={}));var di;(function(e){e[e.SchedulerBasic=1]="SchedulerBasic",e[e.SchedulerPro=2]="SchedulerPro",e[e.Gantt=3]="Gantt"})(di||(di={}));var ae;(function(e){e.Forward="Forward",e.Backward="Backward",e.None="None"})(ae||(ae={}));var ic=(e,r)=>e&&!r||!e&&r?!1:!e&&!r?!0:e.direction===r.direction&&(e.kind==="own"&&r.kind==="own"||e.kind==="enforced"&&r.kind==="enforced"&&e.enforcedBy===r.enforcedBy||e.kind==="inherited"&&r.kind==="inherited"&&e.inheritedFrom===r.inheritedFrom),Ye;(function(e){e.Start="Start",e.End="End"})(Ye||(Ye={}));var Xe=new Date(-864e13),He=new Date(864e13),ui=e=>{if(!e)return!1;const r=e.getTime();return r!==Xe.getTime()&&r!==He.getTime()},Br;(function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"})(Br||(Br={}));var _t;(function(e){e[e.FullRangeIterated=0]="FullRangeIterated",e[e.StoppedByIterator=1]="StoppedByIterator",e[e.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",e[e.MaxRangeReached=3]="MaxRangeReached"})(_t||(_t={}));var Rp=class{constructor(e){this.cacheFilledStartDate=He,this.cacheFilledEndDate=Xe,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=ee.Day,this.maxCacheExtendCycles=1e3,this.maxRange=5*365*24*60*60*1e3,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,r,t){e.ensureCacheFilledForInterval(r,t),this.intervalCache.includeWrappingRange(e.intervalCache,r,t)}ensureCacheFilledForInterval(e,r){const t=this.cacheFilledStartDate.getTime(),i=this.cacheFilledEndDate.getTime();if(t!==He.getTime()){const n=e.getTime(),s=r.getTime();if(t<=n&&s<=i)return;if(s<=t)r=new Date(t-1);else if(n>=i)e=new Date(i);else if(t<=n&&n<=i)e=new Date(i+1);else if(t<=s&&s<=i)r=new Date(t-1);else{this.ensureCacheFilledForInterval(e,new Date(t-1)),this.ensureCacheFilledForInterval(new Date(i+1),r);return}}(t===He.getTime()||e.getTime()<i)&&(this.cacheFilledStartDate=e),(i===Xe.getTime()||i<r.getTime())&&(this.cacheFilledEndDate=r),this.fillCache(e,r)}fillCache(e,r){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=He,this.cacheFilledEndDate=Xe,this.intervalCache.clear()}forEachAvailabilityInterval(e,r,t){var i;t=t||this;const n=e.startDate,s=e.endDate,a=n&&n.getTime(),o=s&&s.getTime(),l=(i=e.maxRange)!=null?i:this.maxRange,c=e.isForward!==!1;if(c?!n:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const d=this.intervalCache;let u=c?n:s,h=c?n:s;const g=h.getTime();for(let f=1;f<this.maxCacheExtendCycles;f++){c?this.ensureCacheFilledForInterval(u,s||b.add(u,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(n||b.add(u,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),u);let m=d.getIntervalOf(h,c?Br.Left:Br.Right);for(;m;){const p=m.startDate,v=m.endDate;if(c&&o&&p.getTime()>=o||!c&&a&&v.getTime()<=a)return _t.FullRangeIterated;if(c&&p.getTime()-g>=l||!c&&g-v.getTime()>=l)return _t.MaxRangeReached;if(c&&p.getTime()>=this.cacheFilledEndDate.getTime()||!c&&v.getTime()<=this.cacheFilledStartDate.getTime())break;h=c?v:p;const y=a&&p.getTime()<a?n:p,C=o&&v.getTime()>o?s:v;if(r.call(t,y,C,m.cacheInterval)===!1)return _t.StoppedByIterator;m=c?d.getNextInterval(m):d.getPrevInterval(m)}if(c&&h.getTime()===He.getTime()||!c&&h.getTime()===Xe.getTime())return _t.FullRangeIterated;u=c?this.cacheFilledEndDate:this.cacheFilledStartDate}return _t.MaxCacheExtendCyclesReached}},Oa=e=>Array.from(new Set(e)),Lu=class{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(this.intervals.indexOf(e)==-1){const r=this.intervals.slice();return r.push(e),new Lu({intervals:r,calendar:this.calendar})}else return this}combineWith(e){return new Lu({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(this.isWorking!=null)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const r=Oa(e);return r.sort((t,i)=>i.getPriorityField()-t.getPriorityField()),r}},Tp=class{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const r=this.intervalGroups.slice();return r.push([e.calendar,e]),new Tp({intervalGroups:r})}getIsWorkingForEvery(){if(this.isWorkingForEvery!=null)return this.isWorkingForEvery;for(let[e,r]of this.getGroups())if(!r[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(this.isWorkingForSome!=null)return this.isWorkingForSome;for(let[e,r]of this.getGroups())if(r[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[r,t]of this.getGroups())e.set(r,t[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[r,t]of this.getGroups())t[0].isWorking&&e.push(r);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[r,t]of this.getGroups())t[0].isWorking||e.push(r);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const e=this.calendars=[],r=new Map;return this.intervalGroups.forEach(([t,i])=>{let n=r.get(t);n||(e.push(t),n=[],r.set(t,n)),n.push.apply(n,i.intervals)}),r.forEach((t,i)=>{const n=Oa(t);n.sort((s,a)=>a.getPriorityField()-s.getPriorityField()),r.set(i,n)}),this.intervalsByCalendar=r}},nc=(e,r,t=(i,n)=>i-n)=>{let i=0,n=r.length;for(;i<n;){const s=(i+n)/2|0,a=t(e,r[s]);if(a===0)return{found:!0,index:s};a<0?n=s:i=s+1}return{found:!1,index:n}},is;(function(e){e[e.Exact=0]="Exact",e[e.Next=1]="Next"})(is||(is={}));var gx=class{constructor(e){this.keys=[],this.values=[],this.comparator=e||((r,t)=>r-t)}set(e,r){const t=nc(e,this.keys,this.comparator);return t.found?this.values[t.index]=r:(this.keys.splice(t.index,0,e),this.values.splice(t.index,0,r)),t.index}insertAt(e,r,t){this.keys.splice(e,0,r),this.values.splice(e,0,t)}setValueAt(e,r){this.values[e]=r}get(e){const r=nc(e,this.keys,this.comparator);return r.found?this.values[r.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const r=nc(e,this.keys,this.comparator);r.found&&this.deleteAt(r.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const r=nc(e,this.keys,this.comparator);return{found:r.found?is.Exact:is.Next,index:r.index}}map(e){const r=this.keys,t=this.values,i=[];for(let n=0;n<r.length;n++)i.push(e(t[n],r[n],n));return i}getAllEntries(){return this.map((e,r)=>({value:e,key:r}))}clear(){this.keys.length=0,this.values.length=0}},Mp=class{constructor(e){if(this.points=new gx((r,t)=>r.getTime()-t.getTime()),this.leftInfinityKey=Xe,this.rightInfinityKey=He,Object.assign(this,e),this.emptyInterval===void 0||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,r=Br.Left){let{found:t,index:i}=this.indexOf(e),n;return r===Br.Left?n=t===is.Exact?i:i-1:n=i-1,this.getIntervalWithStartDateIndex(n)}getPrevInterval(e){return e.startDateIndex===0?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,r,t){const i=this.points,{found:n,index:s}=i.indexOfKey(e);let a,o;if(n==is.Exact){const l=t(o=i.getValueAt(s));i.setValueAt(s,l),a=s+1}else{const l=t(o=i.getValueAt(s-1));i.insertAt(s,e,l),a=s+1}for(;a<i.size()&&!(i.getKeyAt(a).getTime()>=r.getTime());){const c=t(o=i.getValueAt(a));i.setValueAt(a,c),a++}a===i.size()?i.insertAt(i.size(),r,this.emptyInterval):i.getKeyAt(a).getTime()===r.getTime()||i.insertAt(a,r,o)}includeWrappingRange(e,r,t){let i=e.getIntervalOf(r);for(;i&&(this.addInterval(i.startDate,i.endDate,n=>this.combineIntervalsFn(n,i.cacheInterval)),!(i.endDate.getTime()>t.getTime()));)i=e.getNextInterval(i)}getSummary(){return this.points.map((e,r)=>({label:e,date:r}))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}},Ip=class extends Rp{constructor(e){super(e),this.calendarCaches=Oa(this.calendarCaches),this.intervalCache=new Mp({emptyInterval:new Tp,combineIntervalsFn:(r,t)=>r.combineWith(t)})}fillCache(e,r){this.calendarCaches.forEach(t=>{t.fillCache(e,r),this.includeWrappingRangeFrom(t,e,r)})}},hF=new Map,gF=e=>{const r=Oa(e);if(r.length===0)throw new Error("No calendars to combine");r.sort((a,o)=>a.internalId<o.internalId?-1:1);const t=r.map(a=>a.internalId+"/").join(""),i=r.map(a=>a.version+"/").join("");let n=hF.get(t),s;return n&&n.versionsHash===i?s=n.cache:s=new Ip({calendarCaches:r.map(a=>a.calendarCache)}),s},fx=class extends Rp{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new Mp({emptyInterval:new Lu({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(r,t)=>r.combineWith(t)})}fillCache(e,r){var t;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,r);const i=e.getTime(),n=r.getTime(),s=this.calendar.ignoreTimeZone?null:(t=this.calendar.project)==null?void 0:t.timeZone;if(i>n)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval(a=>{const o=a.getStartDateSchedule(),l=a.getEndDateSchedule();let c=o.prev(1,e),d;if(l==="EOD"){const g=o.next(1,r);g!==zt.NEVER?d=b.getStartOfNextDay(g,!0):d=zt.NEVER}else d=l.next(1,r);if(c!==zt.NEVER&&c.getTime()===i){const g=o.prev(2,e);g!==zt.NEVER&&g.length===2&&(c=g[1])}if(d!==zt.NEVER&&d.getTime()===n){const g=l.next(2,r);g!==zt.NEVER&&g.length===2&&(d=g[1])}const u=o.next(1/0,c!==zt.NEVER?c:e,d!==zt.NEVER?new Date(d.getTime()-1):r);if(u===zt.NEVER)return;const h=l==="EOD"?u.map(g=>b.getStartOfNextDay(g,!0)):l.next(1/0,new Date(u[0].getTime()+1),d!==zt.NEVER?d:r);h!==zt.NEVER&&(h.length>u.length?h.length=u.length:h.length<u.length&&(u.length=h.length),u.forEach((g,f)=>{let m=g,p=h[f];s!=null&&(m=Mt.toTimeZone(m,s),p=Mt.toTimeZone(p,s)),this.intervalCache.addInterval(m,p,v=>v.includeInterval(a))}))})}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval(e=>{var r;const t=(r=this.calendar.project)==null?void 0:r.timeZone;let{startDate:i,endDate:n}=e;t!=null&&(i=Mt.toTimeZone(i,t),n=Mt.toTimeZone(n,t)),this.intervalCache.addInterval(i,n,s=>s.includeInterval(e))})}forEachStaticInterval(e){this.intervalStore.forEach(r=>{r.isStatic()&&e(r)})}forEachRecurrentInterval(e){this.intervalStore.forEach(r=>{r.isRecurrent()&&e(r)})}},sc=class extends G([],e=>{const r=e.prototype;class t extends e{async commitAsync(){return this.project.commitAsync()}set project(n){this.$project=n}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(n){return this.project=n}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const n=this.getProject();return n==null?void 0:n.assignmentStore}getDependencyStore(){const n=this.getProject();return n==null?void 0:n.dependencyStore}getEventStore(){const n=this.getProject();return n==null?void 0:n.eventStore}getResourceStore(){const n=this.getProject();return n==null?void 0:n.resourceStore}getCalendarManagerStore(){const n=this.getProject();return n==null?void 0:n.calendarManagerStore}}return t}){},ir=class extends G([sc,re],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}static get $name(){return"AbstractPartOfProjectStoreMixin"}construct(n={}){return n.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},r.construct.call(this,n)}trigger(n,s){const a=this,{asyncEvents:o,project:l}=a,c=o==null?void 0:o[n];return c&&(c===!0||c[s.action])?(r.trigger.call(a,`${n}PreCommit`,{...s}),!l||l.isEngineReady()&&!l.isWritingData?r.trigger.call(a,n,s):!a.eventsSuspended&&l&&(l.dataReadyDetacher||(l.queuedDataReadyEvents=[],l.dataReadyDetacher=l.ion({dataReady(){this.queuedDataReadyEvents.forEach(([u,h,g,f])=>{u.trigger.call(h,g,f)}),l.queuedDataReadyEvents=null,l.dataReadyDetacher(),l.dataReadyDetacher=null},once:!0})),l.queuedDataReadyEvents.push([r,a,n,s])),!0):r.trigger.call(a,n,s)}calculateProject(){return this.project}setStoreData(n){var s;this.project&&!(this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag)&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,r.setStoreData.call(this,n),this.isLoadingData=!1,(s=this.project)==null||s.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),r.doAutoCommit.call(this)}async addAsync(n,s){const a=this.add(n,s);return await this.project.commitAsync(),a}async insertAsync(n,s,a){const o=this.insert(n,s,a);return await this.project.commitAsync(),o}async loadDataAsync(n){this.data=n,await this.project.commitAsync()}performFilter(){var n;return this.project&&(this.isLoadingData||(n=this.rootNode)!=null&&n.isLoading)&&this.project.commitAsync().then(()=>this.filter()),super.performFilter(...arguments)}}return t}){},La=class extends G([sc,ce],e=>{const r=e.prototype;class t extends e{joinStore(n){let s=null;if(Wt(n,ir)){const a=n.getProject();a&&!this.getProject()&&(this.setProject(a),s=a)}r.joinStore.call(this,n),s&&!s.isRepopulatingStores&&this.joinProject()}unjoinStore(n,s=!1){r.unjoinStore.call(this,n,s);const{project:a}=this,o=Wt(n,ir)&&!n.isFillingFromMaster&&a===(n.isChained&&n.project?n.masterStore.project:n.project);a&&!a.isDestroying&&!a.isRepopulatingStores&&o&&(this.leaveProject(s),this.setProject(null)),o&&(this.graph=null)}joinProject(){}leaveProject(n=!1){}calculateProject(){const n=this.stores.find(s=>Wt(s,ir)&&!!s.getProject());return n==null?void 0:n.getProject()}async setAsync(n,s,a){var o;const l=this.set(n,s,a);return await((o=this.project)==null?void 0:o.commitAsync()),l}async getAsync(n){var s;return await((s=this.project)==null?void 0:s.commitAsync()),this.get(n)}get isStmRestoring(){const n=this.getProject();return(n==null?void 0:n.isRestoringData)||(n==null?void 0:n.stm.isRestoring)||!1}}return t}){},ac=class extends G([La],e=>{const r=e.prototype;class t extends e{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(this.priorityField!=null)return this.priorityField;let n=1e4+this.getCalendar().getDepth()*100,s=this.priority;return s==null&&(s=this.isRecurrent()?20:30),this.priorityField=n+s}isRecurrent(){return!!(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return!!(this.startDate&&this.endDate)}parseDateSchedule(n){let s=n;if(n&&n!==Object(n)&&(s=zt.parse.text(n),s!==Object(s)||s.error>=0))try{s=JSON.parse(n)}catch(a){return null}return s}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const n=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=zt.schedule(n)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if(this.recurrentEndDate==="EOD")return"EOD";const n=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=zt.schedule(n)}}return t}){},Pp=class extends G([ir],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:ac}}}return t}){},mx=class extends G([ac],e=>{const r=e.prototype;class t extends e{getCalendar(){return this.calendar}getPriorityField(){return this.priorityField!=null?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}return t}){},$u=class extends G([sc],e=>{const r=e.prototype;class t extends e{get eventStore(){var n;return(n=this.project)==null?void 0:n.eventStore}get resourceStore(){var n;return(n=this.project)==null?void 0:n.resourceStore}get assignmentStore(){var n;return(n=this.project)==null?void 0:n.assignmentStore}get dependencyStore(){var n;return(n=this.project)==null?void 0:n.dependencyStore}get calendarManagerStore(){var n;return(n=this.project)==null?void 0:n.calendarManagerStore}getEventById(n){var s;return(s=this.eventStore)==null?void 0:s.getById(n)}getDependencyById(n){var s;return(s=this.dependencyStore)==null?void 0:s.getById(n)}getResourceById(n){var s;return(s=this.resourceStore)==null?void 0:s.getById(n)}getAssignmentById(n){var s;return(s=this.assignmentStore)==null?void 0:s.getById(n)}getCalendarById(n){var s;return(s=this.calendarManagerStore)==null?void 0:s.getById(n)}}return t}){},Ap=class extends G([La],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls"]}get intervalStoreClass(){return Pp}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(n){n.storeClass=this.intervalStoreClass,n.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,n.calendar=this}processIntervalsStoreData(n){this.bumpVersion()}isDefault(){const n=this.getProject();return n?this===n.defaultCalendar:!1}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(n,s,a){var o;const l=(o=this.getProject())==null?void 0:o.maxCalendarRange;return l&&(n=Object.assign({maxRange:l},n)),this.calendarCache.forEachAvailabilityInterval(n,s,a)}accumulateWorkingTime(n,s,a){var o,l;if(s===0)return{finalDate:new Date(n),remainingDurationInMs:0};if(isNaN(s))throw new Error("Invalid duration");let c=n;const d=(l=(o=this.getProject())==null?void 0:o.adjustDurationToDST)!=null?l:!1;return this.forEachAvailabilityInterval(a?{startDate:n,isForward:!0}:{endDate:n,isForward:!1},(u,h,g)=>{let f=!0;if(g.getIsWorking()){let m=h.getTime()-u.getTime();if(s<=m){if(d){const p=a?u.getTimezoneOffset()-new Date(u.getTime()+s).getTimezoneOffset():new Date(h.getTime()-s).getTimezoneOffset()-h.getTimezoneOffset();s-=p*60*1e3}c=a?new Date(u.getTime()+s):new Date(h.getTime()-s),s=0,f=!1}else{if(d){const p=u.getTimezoneOffset()-h.getTimezoneOffset();m+=p*60*1e3}c=a?h:u,s-=m}}return f}),{finalDate:new Date(c),remainingDurationInMs:s}}calculateDurationMs(n,s,a=!1){let o=0;const l=n.getTime()<=s.getTime()||!a?1:-1;l<0&&([n,s]=[s,n]);const c=this.getProject().adjustDurationToDST;return this.forEachAvailabilityInterval({startDate:n,endDate:s},(d,u,h)=>{if(h.getIsWorking()&&(o+=u.getTime()-d.getTime(),c)){const g=d.getTimezoneOffset()-u.getTimezoneOffset();o+=g*60*1e3}}),o*l}calculateEndDate(n,s){const a=s>=0,o=this.accumulateWorkingTime(n,Math.abs(s),a);return o.remainingDurationInMs===0?o.finalDate:null}calculateStartDate(n,s){const a=s<=0,o=this.accumulateWorkingTime(n,Math.abs(s),a);return o.remainingDurationInMs===0?o.finalDate:null}skipNonWorkingTime(n,s=!0){let a;const o=this.forEachAvailabilityInterval(s?{startDate:n,isForward:!0}:{endDate:n,isForward:!1},(l,c,d)=>{if(d.getIsWorking())return a=s?l:c,!1});return o===_t.MaxRangeReached||o===_t.FullRangeIterated?"empty_calendar":a?new Date(a):new Date(n)}addInterval(n){return this.addIntervals([n])}addIntervals(n){return this.bumpVersion(),this.intervalStore.add(n)}removeInterval(n){return this.removeIntervals([n])}removeIntervals(n){return this.bumpVersion(),this.intervalStore.remove(n)}clearIntervals(n){return n||this.bumpVersion(),this.intervalStore.removeAll(n)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(this.$calendarCache!==void 0)return this.$calendarCache;const n=new mx({isWorking:this.unspecifiedTimeIsWorking});return n.calendar=this,this.$calendarCache=new fx({calendar:this,unspecifiedTimeInterval:n,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse(n=>{n.intervalStore.forEach(s=>s.resetPriority())})}insertChild(n,s,a){let o=r.insertChild.call(this,...arguments);return Array.isArray(o)||(o=[o]),o.forEach(l=>{l.bumpVersion(),l.resetPriorityOfAllIntervals()}),o}joinProject(){r.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){r.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(n){const s=b.clearTime(n),a=b.getNext(n,ee.Day);let o=!1;return this.forEachAvailabilityInterval({startDate:s,endDate:a,isForward:!0},(l,c,d)=>(o=d.getIsWorking(),!o)),!o}getDailyHolidaysRanges(n,s){const a=[];for(n=b.clearTime(n);n<s;)this.isDayHoliday(n)&&a.push({startDate:n,endDate:b.getStartOfNextDay(n,!0,!0)}),n=b.getNext(n,ee.Day);return a}getWorkingTimeRanges(n,s){const a=[];return this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0},(o,l,c)=>{if(c.getIsWorking()){const d=c.intervals[0];a.push({name:d.name,startDate:o,endDate:l})}}),a}getNonWorkingTimeRanges(n,s){const a=[];return this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0},(o,l,c)=>{if(!c.getIsWorking()){const d=c.intervals[0];a.push({name:d.name,iconCls:d.iconCls,cls:d.cls,startDate:o,endDate:l})}}),a}isWorkingTime(n,s,a){if(a){let o;const l=this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0},(c,d,u)=>{if(u.getIsWorking()&&c<=n&&d>=s)return o=!0,!1});return l===_t.MaxRangeReached||l===_t.FullRangeIterated?!1:o}else{const o=this.skipNonWorkingTime(n);return o&&o!=="empty_calendar"?s?o<s:o.getTime()===n.getTime():!1}}}return t}){},_p=class extends G([La],e=>{const r=e.prototype;class t extends e{getAssignmentFor(n){var s;for(const a of(s=this.assigned)!=null?s:[])if(a.resource===n)return a;return null}isAssignedTo(n){return!!this.getAssignmentFor(n)}async assign(n){const s=this.project.assignmentStore.modelClass;return this.addAssignment(new s({event:this,resource:n})),this.commitAsync()}async unassign(n){const s=this.getAssignmentFor(n);return this.removeAssignment(s),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const n=this.getEventStore();this.assigned.forEach(s=>n.assignmentsForRemoval.add(s))}r.leaveProject.call(this,...arguments)}remove(){if(this.parent){const n=this.getEventStore();r.remove.call(this),n&&n.afterEventRemoval()}else return r.remove.call(this)}addAssignment(n){return this.getProject().assignmentStore.add(n),n}removeAssignment(n){return this.getProject().assignmentStore.remove(n),n}}return t}){},$a=class extends G([La,$u,ce],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(n=!1){var s;r.leaveProject.call(this,n),(s=this.project)==null||s.bufferedCommitAsync()}invalidate(){var n;(n=this.project)==null||n.invalidate(this)}getCurrentOrProposed(n){var s;return n in this.$changed&&this.$changed[n]!==!0?this.$changed[n]:(s=this.get(n))!=null?s:null}hasCurrentOrProposed(n){return n in this.$changed&&this.$changed[n]!=!0||this.get(n)!=null}propose(n){var s;if(this.project||(s=this.recurringTimeSpan)!=null&&s.project){const a=Object.keys(n);for(let o=0;o<a.length;o++){const l=a[o];this.$changed[l]=n[l]}this.invalidate()}else this.set(n)}setChanged(n,s,a=!0,o=!1){const l=this;l.$changed[n]=s,o&&(n in l.$beforeChange||(l.$beforeChange[n]=l.get(n)),l.setData(n,s)),a&&l.invalidate()}calculateInvalidated(){}finalizeInvalidated(n=!1){const s=this;s.$isCalculating=!0,n?s.setData(s.$changed):(s.setData(s.$beforeChange),s.set(s.$changed)),s.$changed={},s.$beforeChange={},s.$isCalculating=!1}}return t}){},px=e=>Number(e)!==e,kp=e=>e instanceof Set||e instanceof Array?Ct(e):Ct([e]),vx=e=>new Promise(r=>setTimeout(r,e)),mr=(e,...r)=>e.replace(/{(\d+)}/g,(t,i)=>typeof r[i]!="undefined"?r[i]:t),Fp=class extends G([ir],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(n,s){this.assignmentsForRemoval=kp(n).toSet();const a=r.remove.call(this,n,s);return this.assignmentsForRemoval.clear(),a}removeAll(n){this.allAssignmentsForRemoval=!0;const s=r.removeAll.call(this,n);return this.allAssignmentsForRemoval=!1,s}}return t}){},Op=class extends G([ir],e=>{const r=e.prototype;class t extends e{doDestroy(){var n;const s=[];(n=this.rootNode)!=null&&n.isDestroyed||this.traverse(a=>s.push(a)),super.doDestroy(),s.forEach(a=>a.destroy())}}return t}){},Lp=class extends G([ir],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(n,s){this.dependenciesForRemoval=kp(n).toSet();const a=r.remove.call(this,n,s);return this.dependenciesForRemoval.clear(),a}removeAll(n){this.allDependenciesForRemoval=!0;const s=r.removeAll.call(this,n);return this.allDependenciesForRemoval=!1,s}}return t}){},fF={splice:1,clear:1},$p=class extends G([ir],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(n){var s;const a=fF[n.action];super.onDataChange(n),a&&((s=n.removed)!=null&&s.length)&&this.afterEventRemoval()}remove(n,s){const a=r.remove.call(this,n,s);return this.afterEventRemoval(),a}removeAll(n){const s=r.removeAll.call(this,n);return this.afterEventRemoval(),s}onNodeRemoveChild(n,s,a,o){const l=r.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),l}afterEventRemoval(){const{assignmentsForRemoval:n,dependenciesForRemoval:s}=this;if(!n)return;const a=this.getAssignmentStore();if(a&&!a.allAssignmentsForRemoval&&n.size){const l=[...n].filter(c=>!a.assignmentsForRemoval.has(c));l.length>0&&a.remove(l)}n.clear();const o=this.getDependencyStore();if(o&&!o.allDependenciesForRemoval&&s.size){const l=[...s].filter(c=>!o.dependenciesForRemoval.has(c));l.length>0&&o.remove(l)}s.clear()}processRecord(n,s=!1){var a;if(!((a=this.project)!=null&&a.isRepopulatingStores)){const o=this.getById(n.id);if(o&&o!==n&&o.assigned)for(const c of o.assigned)c.event=n}return n}}return t}){},mF={splice:1,clear:1},jp=class extends G([ir],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(n){var s;const a=mF[n.action];super.onDataChange(n),a&&((s=n.removed)!=null&&s.length)&&this.afterResourceRemoval()}remove(n,s){const a=r.remove.call(this,n,s);return this.afterResourceRemoval(),a}removeAll(n){const s=r.removeAll.call(this,n);return this.afterResourceRemoval(),s}afterResourceRemoval(){const n=this.getAssignmentStore();if(n&&!n.allAssignmentsForRemoval){const s=[...this.assignmentsForRemoval].filter(a=>!n.assignmentsForRemoval.has(a));s.length>0&&n.remove(s)}this.assignmentsForRemoval.clear()}processRecord(n,s=!1){const a=this.getById(n.id);if(a&&a!==n)for(const l of a.assigned||[])l.resource=n;return n}}return t}){},hi=class extends G([$a],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var n,s;return(s=(n=this._startDate)!=null?n:this.get("startDate"))!=null?s:null}get endDate(){var n,s;return(s=(n=this._endDate)!=null?n:this.get("endDate"))!=null?s:null}get duration(){var n,s;return(s=(n=this._duration)!=null?n:this.get("duration"))!=null?s:null}set startDate(n){this.proposeStartDate(n)}set endDate(n){this.proposeEndDate(n)}set duration(n){this.proposeDuration(n)}inSet(n,s,a,o,l){const c=this;return c.project&&!c.project.isWritingData&&typeof n!="string"&&!l&&("startDate"in n&&!("startDate"in c.$changed)&&(c.$changed.startDate=!0,c.invalidate()),"endDate"in n&&!("endDate"in c.$changed)&&(c.$changed.endDate=!0,c.invalidate())),r.inSet.call(c,n,s,a,o,l)}getStartDate(){return this.startDate}proposeStartDate(n,s=!("endDate"in this.$changed)){var a;(this.inSetting||(n==null?void 0:n.getTime())!==((a=this.startDate)==null?void 0:a.getTime()))&&(this._startDate=n,this.propose({startDate:n,keepDuration:s}))}async setStartDate(n,s=!0){var a;return this.proposeStartDate(n,s),(a=this.project)==null?void 0:a.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(n,s=!1){var a;(this.inSetting||(n==null?void 0:n.getTime())!==((a=this.endDate)==null?void 0:a.getTime()))&&(this._endDate=n,this.propose({endDate:n,keepDuration:s}))}async setEndDate(n,s=!1){var a;return this.proposeEndDate(n,s),(a=this.project)==null?void 0:a.commitAsync()}getDuration(){return this.duration}proposeDuration(n,s,a=!0){this._duration=n,this.propose({duration:n,keepStart:a}),s&&this.propose({durationUnit:s})}async setDuration(n,s,a=!0){var o;return this.proposeDuration(n,s,a),(o=this.project)==null?void 0:o.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){var n,s;const a=this,o=a.$changed,l=a.getCurrentOrProposed("startDate"),c=a.getCurrentOrProposed("endDate"),d=a.getCurrentOrProposed("duration");if(l!=null&&(o.startDate=a._startDate=l),c!=null&&(o.endDate=a._endDate=c),d!=null&&(o.duration=a._duration=d),a.eventStore&&!a.eventStore.isLoadingData){const u=(n=a.assignmentStore)==null?void 0:n.storage.findItem("event",null);if(u){const h=(s=a.assignmentStore)==null?void 0:s.storage.findItem("eventId",a.id);if(h)for(const g of h)g.setChanged("event",a);else for(const g of u)g.getCurrentOrProposed("event")===a.id&&g.setChanged("event",a)}}r.joinProject.call(a)}applyValue(n,s,a,o,l){var c;if((this.project||(c=this.recurringTimeSpan)!=null&&c.project)&&l){const{name:d}=l;(d==="startDate"||d=="duration"||d==="endDate")&&(n=!0,this["_"+d]=a),o&&(n=!1)}r.applyValue.call(this,n,s,a,o,l)}afterChange(n,s,a,o,l){!this.$isCalculating&&!l&&this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),r.afterChange.call(this,n,s,a,o,l)}calculateInvalidated(){const n=this,s=n.$changed,a="startDate"in s,o="endDate"in s,l="duration"in s,{startDate:c,endDate:d,duration:u,keepDuration:h,keepStart:g}=s;let f=null;a&&!o&&!l?c===null?s.endDate=null:n.hasCurrentOrProposed("endDate")&&c>n.getCurrentOrProposed("endDate")&&!h?(s.endDate=c,s.duration=0):n.hasCurrentOrProposed("duration")&&(h||!n.hasCurrentOrProposed("endDate"))?f="endDate":n.hasCurrentOrProposed("endDate")&&(f="duration"):!a&&o&&!l?d===null?s.startDate=null:n.hasCurrentOrProposed("startDate")&&!h&&d!==!0&&d<n.getCurrentOrProposed("startDate")?(s.startDate=d,s.duration=0):n.hasCurrentOrProposed("duration")&&(h||!n.hasCurrentOrProposed("startDate"))?f="startDate":n.hasCurrentOrProposed("startDate")&&(f="duration"):!a&&!o&&l?u===null?s.endDate=null:n.hasCurrentOrProposed("startDate")&&(g||!n.hasCurrentOrProposed("endDate"))?(g&&s.duration<0&&(s.duration=0),f="endDate"):n.hasCurrentOrProposed("endDate")&&(f="startDate"):a&&o&&!l?c===null&&d===null?s.duration=null:f="duration":a&&!o&&l?f="endDate":!a&&o&&l?f="startDate":a&&o&&l&&(u==null?f="duration":c==null?f="startDate":f="endDate");const m=n.getCurrentOrProposed("startDate"),p=n.getCurrentOrProposed("endDate"),v=n.getCurrentOrProposed("duration"),y=n.getCurrentOrProposed("durationUnit");let C,D;switch(f){case"startDate":s.startDate=b.add(p,-v,y);break;case"endDate":C=b.as("hour",v,y),D=b.as(y,C,"h"),s.endDate=b.add(m,D,y);break;case"duration":C=b.diff(m,p,"h"),s.duration=b.as(y,C,"h");break}"startDate"in s&&s.startDate!==!0&&(this._startDate=s.startDate),"endDate"in s&&s.endDate!==!0&&(this._endDate=s.endDate),"duration"in s&&s.duration!==!0&&(this._duration=s.duration),s.startDate===!0&&delete s.startDate,s.endDate===!0&&delete s.endDate,delete s.keepDuration,delete s.keepStart}}return t}){},ja=class extends G([$a],e=>{const r=e.prototype;class t extends e{get assigned(){var n;return(n=this.project)==null?void 0:n.assignmentStore.getResourcesAssignments(this)}joinProject(){var n;this.resourceStore&&!this.resourceStore.isLoadingData&&((n=this.assignmentStore)==null||n.query(s=>s.get("resource")===this.id).forEach(s=>s.setChanged("resource",this))),r.joinProject.call(this)}leaveProject(n=!1){var s;if(this.assigned&&!n&&!((s=this.resourceStore)!=null&&s.isLoadingData)){const a=this.resourceStore;this.assigned.forEach(o=>a.assignmentsForRemoval.add(o))}r.leaveProject.call(this)}applyValue(n,s,a,o,l){(l==null?void 0:l.name)==="id"&&this.assigned.forEach(c=>{c.set("resourceId",a)}),r.applyValue.call(this,n,s,a,o,l)}}return t}){};function ju(e){return e!=null&&e.isModel?e.id:e}var Bu=class extends G([$a],e=>{const r=e.prototype;class t extends e{static get fields(){return[{name:"resource",isEqual:(n,s)=>n===s,persist:!1},{name:"event",isEqual:(n,s)=>n===s,persist:!1}]}setChanged(n,s,a){const{assignmentStore:o,eventStore:l,resourceStore:c,project:d}=this;let u=!1;if(n==="event"){const h=Wt(s,hi)?s:l==null?void 0:l.$master.getById(s);h&&(u=!0),s=h||s}if(n==="resource"){const h=Wt(s,ja)?s:c==null?void 0:c.$master.getById(s);h&&(u=!0),s=h||s}r.setChanged.call(this,n,s,a,!0),o&&u&&!d.isPerformingCommit&&!o.isLoadingData&&!(c!=null&&c.isLoadingData)&&!o.skipInvalidateIndices&&o.invalidateIndices()}joinProject(){r.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){var n,s;let{event:a=this.event,resource:o=this.resource}=this.$changed;if(a!==null&&!Wt(a,hi)){const l=(n=this.eventStore)==null?void 0:n.getById(a);l&&this.setChanged("event",l,!1)}if(o!==null&&!Wt(o,ja)){const l=(s=this.resourceStore)==null?void 0:s.getById(o);l&&this.setChanged("resource",l,!1)}}finalizeInvalidated(n){const s=this.$changed;"resource"in s&&(s.resourceId=ju(s.resource)),"event"in s&&(s.eventId=ju(s.event)),r.finalizeInvalidated.call(this,n)}set event(n){this.setChanged("event",n),this.setChanged("eventId",ju(n))}get event(){const n=this.get("event");return(n==null?void 0:n.id)!=null?n:null}set resource(n){this.setChanged("resource",n),this.setChanged("resourceId",ju(n))}get resource(){const n=this.get("resource");return(n==null?void 0:n.id)!=null?n:null}}return t}){},Ba=class extends G([ir,$u,re],e=>{const r=e.prototype;class t extends e{setProject(n){const s=r.setProject.call(this,n);return n&&this.joinProject(n),s}joinProject(n){}onCommitAsync(){}}return t}){},yx=new Set,Bp=class extends G([Fp,Ba],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:Bu,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(n){this.allAssignmentsForRemoval=!0,super.data=n,this.allAssignmentsForRemoval=!1}getEventsAssignments(n){return this.storage.findItem("event",n,!0)||yx}getResourcesAssignments(n){return this.storage.findItem("resource",n.$original,!0)||yx}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(n,s){n=n.masterStore||n;const a=this.count&&this.storage.findItem(s,null,!0);if(a){for(const o of a){const l=n.getById(o.getCurrentOrProposed(s));l&&o.setChanged(s,l)}this.invalidateIndices()}}unlinkAssignments(n){this.forEach(s=>{var a,o,l;return s.setChanged(n,(l=(o=(a=s[n])==null?void 0:a.id)!=null?o:s==null?void 0:s.getData(n))!=null?l:s[n+"Id"])}),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},Hp=class extends G([Ap,$a],e=>{const r=e.prototype;class t extends e{}return t}){},bx=class extends G([Op,Ba],e=>{const r=e.prototype;class t extends e{static get defaultConfig(){return{tree:!0,modelClass:Hp}}}return t}){},Hu=class extends G([$a],e=>{const r=e.prototype;class t extends e{static get fields(){return[{name:"fromEvent",isEqual:(n,s)=>n===s,persist:!1},{name:"toEvent",isEqual:(n,s)=>n===s,persist:!1}]}setChanged(n,s,a){var o,l,c;let d=!1;if(n==="fromEvent"||n==="toEvent"){const u=Wt(s,hi)?s:(o=this.eventStore)==null?void 0:o.getById(s);u&&(d=!0),s=u||s}r.setChanged.call(this,n,s,a,!0),d&&!this.project.isPerformingCommit&&!((l=this.dependencyStore)!=null&&l.isLoadingData)&&((c=this.dependencyStore)==null||c.invalidateIndices())}joinProject(){r.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){var n,s;let{fromEvent:a,toEvent:o}=this.$changed;if(a!==null&&!Wt(a,hi)){const l=(n=this.eventStore)==null?void 0:n.getById(a);l&&(this.$changed.fromEvent=l)}if(o!==null&&!Wt(o,hi)){const l=(s=this.eventStore)==null?void 0:s.getById(o);l&&(this.$changed.toEvent=l)}}set fromEvent(n){this.setChanged("fromEvent",n)}get fromEvent(){const n=this.get("fromEvent");return(n==null?void 0:n.id)!=null?n:null}set toEvent(n){this.setChanged("toEvent",n)}get toEvent(){const n=this.get("toEvent");return(n==null?void 0:n.id)!=null?n:null}}return t}){},Cx=new Set,Vp=class extends G([Lp,Ba],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:Hu,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(n){return this.storage.findItem("toEvent",n)||Cx}getOutgoingDepsForEvent(n){return this.storage.findItem("fromEvent",n)||Cx}set data(n){this.allDependenciesForRemoval=!0,super.data=n,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},Sx=class extends G([hi,_p],e=>{const r=e.prototype;class t extends e{get assigned(){var n,s;return(s=(n=this.project)==null?void 0:n.assignmentStore.getEventsAssignments(this))!=null?s:this.$cachedAssignments}leaveProject(n=!1){this.$cachedAssignments=this.assigned,super.leaveProject(n)}applyValue(n,s,a,o,l){var c;s==="id"&&((c=this.assigned)==null||c.forEach(d=>d.set("eventId",a))),r.applyValue.call(this,n,s,a,o,l)}copy(n=null,s=null){const a=r.copy.call(this,n,s);return(T.isObject(s)&&!s.skipFieldIdentifiers||!T.isObject(s))&&(a.$cachedAssignments=this.assigned),a}}return t}){},Dx=class extends G([hi],e=>{const r=e.prototype;class t extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const n=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach(s=>n.dependenciesForRemoval.add(s)),this.incomingDeps&&this.incomingDeps.forEach(s=>n.dependenciesForRemoval.add(s)),r.leaveProject.call(this)}}return t}){},Vu=class extends G([hi,Sx,Dx],e=>{const r=e.prototype;class t extends e{}return t}){},Np=class extends G([$p,Ba],e=>{const r=e.prototype;class t extends e{static get defaultConfig(){return{modelClass:Vu}}joinProject(){var n;(n=this.assignmentStore)==null||n.linkAssignments(this,"event")}afterLoadData(){var n;this.afterEventRemoval(),(n=this.assignmentStore)==null||n.linkAssignments(this,"event")}}return t}){},zp=class extends G([jp,Ba],e=>{const r=e.prototype;class t extends e{static get defaultConfig(){return{modelClass:ja}}joinProject(){var n;(n=this.assignmentStore)==null||n.linkAssignments(this,"resource")}afterLoadData(){var n;(n=this.assignmentStore)==null||n.linkAssignments(this,"resource")}clear(n){var s;r.clear.call(this,n),(s=this.assignmentStore)==null||s.unlinkAssignments("resource")}}return t}){},pF=class extends G([],Le){},vF=class extends G([],fe){},wx=class extends G([pF,vF,ce],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(n={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const s="silenceInitialCommit"in n?n.silenceInitialCommit:!0,a="adjustDurationToDST"in n?n.adjustDurationToDST:!1;this.maxCalendarRange="maxCalendarRange"in n?n.maxCalendarRange:15768e7,delete n.maxCalendarRange,delete n.silenceInitialCommit,delete n.adjustDurationToDST,r.construct.call(this,n),this.silenceInitialCommit=s,this.adjustDurationToDST=a}repopulateStore(n){}repopulateReplica(){}deferUntilRepopulationIfNeeded(n,s,a){s(...a)}attachStore(n){}detachStore(n){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}return t}){},Ex=class extends G([],fe){},xx=class extends G([wx,$u,Ex,ce],e=>{const r=e.prototype;class t extends e{static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:Vu,assignmentModelClass:Bu,resourceModelClass:ja,dependencyModelClass:Hu,calendarModelClass:Hp,eventStoreClass:Np,assignmentStoreClass:Bp,resourceStoreClass:zp,dependencyStoreClass:Vp,calendarManagerStoreClass:bx,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(n={}){var s;const a=this;if(a.$invalidated=new Set,a.isPerformingCommit=!1,a.silenceInitialCommit=!0,a.ongoing=Promise.resolve(),n.eventStore&&!n.assignmentStore){const g=n.eventStore.masterStore||n.eventStore,f=g.assignmentStore||((s=g.crudManager)==null?void 0:s.assignmentStore);f!=null&&f.isAssignmentStore&&(n.assignmentStore=f,a.isSharingAssignmentStore=!0)}r.construct.call(a,n),a.defaultCalendar=new a.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:a.unspecifiedTimeIsWorking}),a.defaultCalendar.project=a;const{calendarsData:o,eventsData:l,dependenciesData:c,resourcesData:d,assignmentsData:u}=a;!!(o||l||c||d||u)?(a.loadInlineData({calendarsData:o,eventsData:l,dependenciesData:c,resourcesData:d,assignmentsData:u}),delete a.calendarsData,delete a.eventsData,delete a.dependenciesData,delete a.resourcesData,delete a.assignmentsData):a.bufferedCommitAsync()}doDestroy(){var n,s,a,o,l,c;const d=this;(n=d.eventStore)==null||n.destroy(),(s=d.dependencyStore)==null||s.destroy(),(a=d.assignmentStore)==null||a.destroy(),(o=d.resourceStore)==null||o.destroy(),(l=d.calendarManagerStore)==null||l.destroy(),d.defaultCalendar.destroy(),(c=d.stm)==null||c.destroy(),r.doDestroy.call(this)}async loadInlineData(n){const s=this;s.isLoadingInlineData=!0,n.calendarsData&&(s.calendarManagerStore.data=n.calendarsData),n.resourcesData&&(s.resourceStore.data=n.resourcesData),n.assignmentsData&&(s.assignmentStore.data=n.assignmentsData),n.eventsData&&(s.eventStore.data=n.eventsData),n.tasksData&&(s.eventStore.data=n.tasksData),n.dependenciesData&&(s.dependencyStore.data=n.dependenciesData),await s.commitLoad(),s.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(n){const s=a=>{a.setProject(this),a.joinProject()};n.rootNode?n.rootNode.traverse(s):n.forEach(s)}unJoinStoreRecords(n){const s=a=>{a.leaveProject(),a.setProject(this)};n.rootNode?n.rootNode.traverse(a=>{a!==n.rootNode&&s(a)}):n.forEach(s)}resolveStoreAndModelClass(n,s){const a=(s==null?void 0:s.storeClass)||this[`${n}StoreClass`];let o=s==null?void 0:s.modelClass;return o||(this.getDefaultConfiguration()[`${n}ModelClass`]!==a.getDefaultConfiguration().modelClass?o=a.getDefaultConfiguration().modelClass:o=this[`${n}ModelClass`]),{storeClass:a,modelClass:o}}setEventStore(n){this.eventStore=n}changeEventStore(n,s){const a=this,{stm:o}=a;if(a.detachStore(s),n instanceof re)n.project=a,o.addStore(n),a.joinStoreRecords(n);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("event",n);n=new l(T.assign({modelClass:c,project:a,stm:o},n))}if(s&&o.hasStore(s)){o.removeStore(s),a.unJoinStoreRecords(s);const{assignmentsForRemoval:l}=s;l.forEach(c=>{const d=c.event;if(d){const u=n.getById(d.id);u&&(c.event=u,l.delete(c))}}),s.afterEventRemoval()}return n.setProject(a),n}updateEventStore(n,s){this.attachStore(n),this.trigger("eventStoreChange",{store:n})}setAssignmentStore(n){this.assignmentStore=n}changeAssignmentStore(n,s){const a=this,{stm:o}=a;if(a.detachStore(s),s&&o.hasStore(s)&&(o.removeStore(s),a.unJoinStoreRecords(s)),n instanceof re)n.project=a,o.addStore(n),a.joinStoreRecords(n);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("assignment",n);n=new l(T.assign({modelClass:c,project:a,stm:o},n))}return n.setProject(a),n}updateAssignmentStore(n,s){this.attachStore(n),this.trigger("assignmentStoreChange",{store:n})}setResourceStore(n){this.resourceStore=n}changeResourceStore(n,s){const a=this,{stm:o}=a;if(a.detachStore(s),n instanceof re)n.project=a,o.addStore(n),a.joinStoreRecords(n);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("resource",n);n=new l(T.assign({modelClass:c,project:a,stm:o},n))}if(s&&o.hasStore(s)){o.removeStore(s),a.unJoinStoreRecords(s);const{assignmentsForRemoval:l}=s;l.forEach(c=>{const d=c.resource;if(d){const u=n.getById(d.id);u&&(c.resource=u,l.delete(c))}}),s.afterResourceRemoval()}return n.setProject(a),n}updateResourceStore(n,s){this.attachStore(n),this.trigger("resourceStoreChange",{store:n})}setDependencyStore(n){this.dependencyStore=n}changeDependencyStore(n,s){const a=this;if(a.detachStore(s),n instanceof re)n.project=a,a.stm.addStore(n),a.joinStoreRecords(n);else{const{storeClass:o,modelClass:l}=a.resolveStoreAndModelClass("dependency",n);n=new o(T.assign({modelClass:l,project:a,stm:a.stm},n))}return n}updateDependencyStore(n,s){this.attachStore(n),this.trigger("dependencyStoreChange",{store:n})}setCalendarManagerStore(n){this.calendarManagerStore=n}changeCalendarManagerStore(n,s){const a=this;if(a.detachStore(s),n instanceof re)a.stm.addStore(n);else{const o=(n==null?void 0:n.storeClass)||a.calendarManagerStoreClass,l=(n==null?void 0:n.modelClass)||o.getDefaultConfiguration().modelClass||a.calendarModelClass;n=new o(T.assign({modelClass:l,project:a,stm:a.stm},n))}return n.setProject(a),n}updateCalendarManagerStore(n,s){this.attachStore(n),this.trigger("calendarManagerStoreChange",{store:n})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(n){this.$calendar=n}get effectiveCalendar(){return this.calendar}async addEvent(n){return this.eventStore.add(n),this.commitAsync()}async addAssignment(n){return this.assignmentStore.add(n),this.commitAsync()}async addResource(n){return this.resourceStore.add(n),this.commitAsync()}async addDependency(n){return this.dependencyStore.add(n),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const n=this;if(n.isPerformingCommit=!0,n.unScheduleAutoCommit(),await vx(0),!n.isDestroyed){for(const c of n.$invalidated)c.calculateInvalidated();const{isInitialCommit:s,silenceInitialCommit:a}=n,o=s&&a;n.assignmentStore.onCommitAsync(),n.dependencyStore.onCommitAsync(),n.isInitialCommitPerformed=!0,n.hasLoadedDataToCommit=!1,n.isPerformingCommit=!1;const l=[n.assignmentStore,n.dependencyStore,n.eventStore,n.resourceStore,n.calendarManagerStore];if(l.forEach(c=>{var d;return(d=c.suspendAutoCommit)==null?void 0:d.call(c)}),n.isWritingData=!0,n.trigger("refresh",{isInitialCommit:s,isCalculated:!0}),o)for(const c of n.$invalidated)c.finalizeInvalidated(!0);else{for(const c of n.$invalidated)c.beginBatch(!0),c.finalizeInvalidated();for(const c of n.$invalidated)c.endBatch(!1,!0)}return n.isWritingData=!1,n.$invalidated.clear(),n.trigger("dataReady"),l.forEach(c=>{var d;return(d=c.resumeAutoCommit)==null?void 0:d.call(c)}),n.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(n){this.$invalidated.add(n),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(n){n=this.$stm=new ia(T.assign({disabled:!0},n)),n.ion({restoringStop:async()=>{n.disable(),await this.commitAsync(),this.isDestroyed||(n.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return t.applyConfigs=!0,t}){},Hr=class extends rr{constructor(){super(...arguments),E(this,"compositeField",!0)}static get $name(){return"DurationColumn"}static get type(){return"duration"}static get isGanttColumn(){return!0}static get fields(){return[{name:"decimalPrecision",defaultValue:1}]}static get defaults(){return{min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",instantUpdate:!0,filterType:"duration",sortable(e,r){const t=e.getValue(this.field),i=r.getValue(this.field);return t-i}}}construct(){super.construct(...arguments);const e=this.sortable;this.sortable=(...r)=>e.call(this,...r)}get defaultEditor(){const{max:e,min:r,step:t,largeStep:i}=this;return T.cleanupProperties({type:"duration",name:this.field,max:e,min:r,step:t,largeStep:i})}get durationUnitField(){return`${this.field}Unit`}roundValue(e){const r=typeof this.grid.durationDisplayPrecision=="number"?this.grid.durationDisplayPrecision:this.decimalPrecision,t=Math.pow(10,r);return Math.round(e*t)/t}formatValue(e,r){return e instanceof _e&&(r=e.unit,e=e.magnitude),e=this.roundValue(e),e+" "+b.getLocalizedNameOfUnit(r,e!==1)}defaultRenderer({value:e,record:r,isExport:t}){const i=typeof e,n=i==="number"?e:e==null?void 0:e.magnitude,s=i==="number"?r.getValue(this.durationUnitField):e==null?void 0:e.unit;return typeof n!="number"?t?"":null:this.formatValue(n,s)}toClipboardString({record:e}){return e.getValue(this.field).toString()}fromClipboardString({string:e,record:r}){const t=b.parseDuration(e,!0,this.durationUnit);return t&&"magnitude"in t?t:r.fullDuration}calculateFillValue({value:e,record:r}){return this.fromClipboardString({string:e,record:r})}};Z.registerColumnType(Hr),Hr._$name="DurationColumn";var Wp={startDate:1,endDate:1,constraintDate:1,deadlineDate:1},Rx=e=>{var r;return r=class extends(e||St){get timeZone(){return this.getData("timeZone")}set timeZone(t){this.setData("timeZone",t)}setLocalDate(t,i){this.set(t,this.timeZone!=null?Mt.toTimeZone(i,this.timeZone):i,!0),this.data[t]=this[t]}getLocalDate(t){return this.timeZone!=null&&this[t]?Mt.fromTimeZone(this[t],this.timeZone):this[t]}applyChangeset(t){if(this.timeZone!=null)for(const i in Wp)t[i]&&(this.setLocalDate(i,new Date(t[i])),delete t[i]);return super.applyChangeset(...arguments)}getFieldPersistentValue(t){var i,n;if(this.timeZone!=null){const s=(n=(i=t==null?void 0:t.field)!=null?i:t==null?void 0:t.name)!=null?n:t;if(Wp[s])return this.getLocalDate(s)}return super.getFieldPersistentValue(t)}convertToTimeZone(t){const i=this,n={...i.meta.modified},s={...Wp};i.isTask&&!i.manuallyScheduled&&(delete s.startDate,delete s.endDate);for(const a in s)i[a]!=null?(s[a]=i[a],i.timeZone!=null&&(s[a]=i.getLocalDate(a),n[a]&&(n[a]=Mt.fromTimeZone(n[a],i.timeZone)))):delete s[a];i.timeZone=t;for(const a in s)i.setLocalDate(a,s[a],!1),s[a]=1,i.timeZone!=null&&n[a]&&(n[a]=Mt.toTimeZone(n[a],i.timeZone));i.clearChanges(!0,!0,s),T.isEmpty(n)||(i.meta.modified=n,i.stores.forEach(a=>a.modified.add(i)))}},E(r,"$name","TimeZonedDatesMixin"),E(r,"fields",[{name:"timeZone",persist:!1}]),r},St=class extends ce.mixin(Rx){static get $name(){return"TimeSpan"}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"},useProp:!0},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]}construct(e,...r){if(e!=null&&e.fullDuration){const{magnitude:t,unit:i}=e.fullDuration;e.duration=t,e.unit=i,delete e.fullDuration}super.construct(e,...r),this.normalize()}get eventStore(){var e;const r=this;return r.isOccurrence?r.recurringTimeSpan.eventStore:(r._eventStore||(r._eventStore=(e=r.stores)==null?void 0:e.find(t=>t.isEventStore)),r._eventStore)}normalize(){const e=this,{startDate:r,endDate:t,duration:i,durationUnit:n}=e,s=i!=null;r&&t&&!s?e.setData("duration",b.diff(r,t,n,!0)):r&&!t&&s?e.setData("endDate",b.add(r,i,n)):!r&&t&&s&&e.setData("startDate",b.add(t,-i,n))}updateInternalCls(e){this._cls?this._cls.value=e:this._cls=new J(e)}set internalCls(e){this.updateInternalCls(e),this.set("cls",this._cls.value)}get internalCls(){const{cls:e}=this;return e!=null&&e.isDomClassList?e:(this.internalCls=e,this._cls)}get cls(){return this._cls||(this._cls=new J(super.get("cls"))),this._cls}set cls(e){this.internalCls=e}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get endingDate(){const e=this,{endDate:r,startDate:t}=e;return r||b.add(t,e.duration,e.durationUnit)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,r=this.durationUnit){e=parseFloat(e),this.set({duration:e,durationUnit:r,...this.updateDatesFromDuration(e,r)})}updateDatesFromDuration(e,r,t=this.startDate,i=this.endDate){const n={};return t?n.endDate=b.add(t,e,r):i&&(n.startDate=b.add(i,-e,r)),n}getDurationInUnit(e,r){const t=this;return t.startDate&&t.endDate?b.getDurationInUnit(t.startDate,t.endDate,e,r):b.as(e,t.duration,t.durationUnit)}get fullDuration(){return new _e({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){typeof e=="string"&&(e=b.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,r=!0){const t=this,i={startDate:e};if(e){let n;if(r)n=t.duration!=null;else if(t.endDate){if(i.duration=b.diff(e,t.endDate,t.durationUnit,!0),i.duration<0)throw new Error("Negative duration")}else n=this.duration!=null;n&&(i.endDate=b.add(e,t.getDurationInUnit("h"),"h"))}else i.duration=null;t.set(i)}setEndDate(e,r=!1){const t=this,i={endDate:e};if(e){let n;if(r===!0)n=t.duration!=null;else if(t.startDate){if(i.duration=b.diff(t.startDate,e,t.durationUnit,!0),i.duration<0)throw new Error("Negative duration")}else n=this.duration!=null;n&&(i.startDate=b.add(e,-t.duration,t.durationUnit))}t.set(i)}setStartEndDate(e,r,t){this.set({startDate:e,endDate:r},null,t)}get dates(){const e=[],r=b.startOf(this.startDate,"day"),t=this.endDate;for(let i=r;i<t;i=b.add(i,1,"day"))e.push(i);return e}get startDateMS(){var e;return(e=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)==null?void 0:e.getTime()}get endDateMS(){var e;return(e=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)==null?void 0:e.getTime()}get durationMS(){const{endDateMS:e,startDateMS:r}=this;return e&&r?e-r:b.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return this.duration===0}inSetNormalize(e){if(typeof e!="string"){let{startDate:r,endDate:t,duration:i,durationUnit:n=this.durationUnit}=e;typeof r=="string"&&(r=this.getFieldDefinition("startDate").convert(r)),typeof t=="string"&&(t=this.getFieldDefinition("endDate").convert(t)),"duration"in e?(r&&!t&&(t=b.add(r,i,n,!0,!0)),!r&&t&&(r=b.add(t,-i,n,!0,!0))):r&&t&&(i=b.as(n,b.diff(r,t,"h",!0),"h"));const s=Object.isFrozen(e)?T.clone(e):e;return r&&(s.startDate=r),t&&(s.endDate=t),i!=null&&(s.duration=i),s}}fieldToKeys(e,r){var t,i;const n=super.fieldToKeys(e,r);if(n.fullDuration){const{magnitude:s,unit:a}=n.fullDuration;n.duration=s,n.durationUnit=a}return!this.isEventModel&&!this.isTaskModel&&("duration"in n||n.durationUnit)&&!(n.startDate&&n.endDate)&&Object.assign(n,this.updateDatesFromDuration((t=n.duration)!=null?t:this.duration,(i=n.durationUnit)!=null?i:this.durationUnit,n.startDate,n.endDate)),n}inSet(e,r,t,i,n,s){return n||(e=this.inSetNormalize(e)||e),super.inSet(e,r,t,i,n,s)}applyValue(e,r,t,i,n){r==="cls"&&this.updateInternalCls(t),super.applyValue(e,r,t,i,n)}forEachDate(e,r){return this.dates.forEach(e.bind(r))}get isScheduled(){const{startDateMS:e,endDateMS:r}=this;return r-e>=0}get isValid(){const{startDate:e,endDate:r}=this;return!e||!r||r-e>=0}shift(e,r=this.durationUnit){if(typeof e=="string"){const t=e;e=r,r=t}return this.setStartDate(b.add(this.startDate,e,r,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,r){const t=this.startDate,i=this.endDate;return t&&i&&b.intersectSpans(t,i,e,r)}split(e=.5){const r=this,t=r.copy(),{fullDuration:i,eventStore:n,assignmentStore:s}=r,a=new _e(i),o=new _e(i);let l,c;return typeof e=="string"?(l=new _e(e),l.unit===a.unit?o.magnitude-=l.magnitude:(o.magnitude=b.as(l.unit,a)-l.magnitude,o.unit=l.unit,c=!0)):(l=new _e(e>1?e:r.duration*e,r.durationUnit),o.magnitude-=l.magnitude),t.startDate=b.add(r.startDate,l.magnitude,l.unit),c?(t.fullDuration=o,r.fullDuration=l):(t.duration=o.magnitude,r.duration=l.magnitude),n&&(n.add(t),s&&!n.usesSingleAssignment&&s.add(r.assignments.map(d=>{const u=Object.assign({},d.data,{eventId:t.id,event:null,resource:null});return delete u.id,u}))),t}toICSString(e={}){if(!this.isScheduled)return"";const{startDate:r,endDate:t}=this,i=e.DTSTAMP||b.format(new Date,"uu");delete e.DTSTAMP;let n={};this.allDay?n={"DTSTART;VALUE=DATE":b.format(r,"u"),"DTEND;VALUE=DATE":b.format(t,"u")}:n={DTSTART:b.format(r,"uu"),DTEND:b.format(t,"uu")};const s=ne.scheduler&&ne.getVersion("scheduler")||ne.calendar&&ne.getVersion("calendar")||"",a={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${s} //EN`,END:"VCALENDAR"},o={BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:i,...n,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...e,END:"VEVENT"},l=Object.keys(a).map(d=>`${d}:${a[d]}`),c=Object.keys(o).map(d=>`${d}:${o[d]}`);return l.splice(l.length-1,0,...c),l.join(`
`)}exportToICS(e){if(this.isScheduled){const r=new Blob([this.toICSString(e)],{type:"text/calendar"});q.downloadBlob(r,(this.name||"Event")+".ics")}}isEditable(e){return this.getFieldDefinition(e)?!0:void 0}isFieldModified(e){return e==="fullDuration"?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(e)}};St._$name="TimeSpan";var qi=class extends ce{static get fields(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(){super.construct(...arguments),this.normalizeUnits()}generateId(e){const r=this,{headers:t}=r,i=[];let n=Object.getPrototypeOf(r.data).id;if(!n){for(let{length:s}=t,a=s-1;a>=0;a--){const{unit:o,increment:l}=t[a],c=l>1;i.push(`${c?l:""}${a?o:O.capitalize(o)}${c?"s":""}`)}n=i.join("And")}return e.count&&e.includes(n)&&(n+=`-${r.tickWidth}by${r.tickHeight||r.tickWidth}`,e.includes(n)&&(n+=`-${r.bottomHeader.increment}`,e.includes(n)&&(n=ti.generateId(`${n}-`)))),n}normalizeUnits(){const e=this,{timeResolution:r,headers:t,shiftUnit:i}=e;if(t)for(let n=0,{length:s}=t;n<s;n++){const a=t[n];a.unit=b.normalizeUnit(a.unit),a.splitUnit&&(a.splitUnit=b.normalizeUnit(a.splitUnit)),"increment"in a||(t[n]=Object.assign({increment:1},a))}r&&(r.unit=b.normalizeUnit(r.unit)),i&&(e.shiftUnit=b.normalizeUnit(i))}static normalizeHeaderConfig(e){const{headerConfig:r,columnLinesFor:t,mainHeaderLevel:i}=e,n=e.headers=[];if(r.top&&(t==="top"&&(e.columnLinesFor=0),i==="top"&&(e.mainHeaderLevel=0),n[0]=r.top),r.middle)t==="middle"&&(e.columnLinesFor=n.length),i==="middle"&&(e.mainHeaderLevel=n.length),n.push(r.middle);else throw new Error("ViewPreset.headerConfig must be configured with a middle");r.bottom&&(e.mainHeaderLevel=n.length-1,t==null?e.columnLinesFor=n.length-1:t==="bottom"&&(e.columnLinesFor=n.length),i==null&&(e.mainHeaderLevel=n.length-1),i==="bottom"&&(e.mainHeaderLevel=n.length),n.push(r.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const e={},{headers:r}=this,{length:t}=r;switch(t){case 1:e.middle=r[0];break;case 2:this.mainHeaderLevel===0?(e.middle=r[0],e.bottom=r[1]):(e.top=r[0],e.middle=r[1]);break;case 3:e.top=r[0],e.middle=r[1],e.bottom=r[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}set mainHeaderLevel(e){this.data.mainHeaderLevel=e}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:this.data.headers.length===3?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get topHeader(){return this.headers[0]}get topUnit(){return this.topHeader.unit}get topIncrement(){return this.topHeader.increment}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:e}=this;return Math.round(b.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}get isValid(){const e=this;let r=!0;for(const t of e.headers)r=r&&!!b.normalizeUnit(t.unit);return e.timeResolution&&(r=r&&b.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(r=r&&b.normalizeUnit(e.shiftUnit)),r}};E(qi,"$name","ViewPreset"),qi._$name="ViewPreset";var yF={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{newEvent:"New event"},ResourceInfoColumn:{eventCountText:e=>e+" event"+(e!==1?"s":"")},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-Finish",EndToStart:"Finish-to-Start",EndToEnd:"Finish-to-Finish",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit event",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event",color:"Color"},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventCopyPaste:{copyEvent:"Copy event",cutEvent:"Cut event",pasteEvent:"Paste event"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS",name:"Seconds"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST",name:"Day"},day:{name:"Day/hours"},week:{name:"Week/hours"},dayAndWeek:{displayDateFormat:"ll LST",name:"Week/days"},dayAndMonth:{name:"Month"},weekAndDay:{displayDateFormat:"ll LST",name:"Week"},weekAndMonth:{name:"Weeks"},weekAndDayLetter:{name:"Weeks/weekdays"},weekDateAndMonth:{name:"Months/weeks"},monthAndYear:{name:"Months"},year:{name:"Years"},manyYears:{name:"Multiple years"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:e})=>`Weekly on ${e}`,"Monthly on {1}":({days:e})=>`Monthly on ${e}`,"Yearly on {1} of {2}":({days:e,months:r})=>`Yearly on ${e} of ${r}`,"Every {0} days":({interval:e})=>`Every ${e} days`,"Every {0} weeks on {1}":({interval:e,days:r})=>`Every ${e} weeks on ${r}`,"Every {0} months on {1}":({interval:e,days:r})=>`Every ${e} months on ${r}`,"Every {0} years on {1} of {2}":({interval:e,days:r,months:t})=>`Every ${e} years on ${r} of ${t}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:e,days:r})=>`${e} ${r}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each","On the":"On the","End repeat":"End repeat","time(s)":"time(s)"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{None:"No repeat",Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":e=>`Summary for ${e}`},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"},DurationColumn:{Duration:"Duration"}},l1=yt.publishLocale(yF),Nu=class extends We(re){static get $name(){return"PresetStore"}static get defaultConfig(){return{useRawData:!0,modelClass:qi,zoomOrder:1}}set storage(e){super.storage=e,this.storage.addSorter((r,t)=>{const i=r.bottomHeader,n=t.bottomHeader;return(t.msPerPixel-r.msPerPixel||dr[i.unit]-dr[n.unit]||i.increment-n.increment)*this.zoomOrder})}get storage(){return super.storage}getById(e){return super.getById(e)||!this.isPresetManager&&Ha.getById(e)}createRecord(e,...r){let t;if(e.isViewPreset)return e;if(typeof e=="string")t=this.getById(e);else if(typeof e=="number")t=this.getAt(e);else return e.base&&(e=this.copyBaseValues(e)),super.createRecord(e,...r);if(!t)throw new Error(`ViewPreset ${e} does not exist`);return t}updateLocalization(){super.updateLocalization();const e=this;let r=e.allRecords;e.isPresetManager&&(r=new Set(r.concat(Object.values(e.basePresets)))),r.forEach(t=>{let i=e.optionalL(`L{PresetManager.${t.id}}`,null,!0);typeof i=="string"&&t.baseId&&(i=e.optionalL(`L{PresetManager.${t.baseId}}`,null,!0)),i&&typeof i=="object"&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),t.mainHeaderLevel===0&&i.topDateFormat&&(i.middleDateFormat=i.middleDateFormat||i.topDateFormat),t.setData("displayDateFormat",i.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach(n=>{const s=t.headerConfig[n],a=i[n+"DateFormat"];s&&(s.originalDateFormat||(s.originalDateFormat=s.dateFormat),a&&s.renderer&&(s.renderer=null),s.dateFormat=a||s.originalDateFormat)}),i.name?(t.unlocalizedName||(t.unlocalizedName=t.name),t.setData("name",i.name)):t.unlocalizedName&&t.unlocalizedName!==t.name&&(t.name=t.unlocalizedName,t.unlocalizedName=null))})}getCurrentConfig(e){return super.getCurrentConfig(e).data}copyBaseValues(e){let r=this.getById(e.base);if(!r)throw new Error(`ViewPreset base '${e.base}' does not exist.`);return r=T.clone(r.data),delete r.id,e.name&&delete r.name,T.merge(r,e)}add(e){return e=Array.isArray(e)?e:[e],e.forEach(r=>{r.isViewPreset&&r.base&&(r.data=this.copyBaseValues(r.originalData))}),super.add(...arguments)}};Nu._$name="PresetStore";var bF=class extends Nu{static get $name(){return"PresetManager"}static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"lll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:15},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer(e){return`
                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${b.format(e,"HH")}</span>
                                    <span class="b-sch-calendarcolumn-minutes">${b.format(e,"mm")}</span></div>
                                `}}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer(e){return`
                                    <div class="sch-calendarcolumn-ct">
                                    <span class="sch-calendarcolumn-hours">${b.format(e,"HH")}</span>
                                    <span class="sch-calendarcolumn-minutes">${b.format(e,"mm")}</span>
                                    </div>
                                `}}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer(e){return b.getShortNameOfUnit("week")+"."+b.format(e,"WW MMM YYYY")}},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer(e,r,t){return b.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(e,r)=>e.getFullYear()+" - "+r.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:60,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}set basePresets(e){const r=this._basePresets={};for(const t in e)e[t].id=t,r[t]=this.createRecord(e[t])}get basePresets(){return this._basePresets}set defaultPresets(e){for(let r=0,{length:t}=e;r<t;r++){const i=e[r],n=typeof i=="string",s=n?i:i.base;let a;if(n)a=this.basePresets[s];else{const o=Object.setPrototypeOf(T.clone(this.basePresets[s].data),{id:s}),{timeResolution:l}=o,c=o.headers[o.headers.length-1];o.id=void 0,"width"in i&&(o.tickWidth=i.width),"height"in i&&(o.tickHeight=i.height),"increment"in i&&(c.increment=i.increment),"resolution"in i&&(l.increment=i.resolution),"resolutionUnit"in i&&(l.unit=b.getUnitByName(i.resolutionUnit)),a=this.createRecord(o),a.baseId=s}this.add(a)}}getById(e){return super.getById(e)||this.basePresets[e]}registerPreset(e,r){const t=this.createRecord(Object.assign({id:e},r)),i=this.find(n=>n.equals(t));if(i)return i;if(t.isValid)this.add(t);else throw new Error("Invalid preset, please check your configuration");return t}getPreset(e){return typeof e=="number"&&(e=this.getAt(e)),typeof e=="string"?e=this.getById(e):e instanceof qi||(e=this.createRecord(e)),e}normalizePreset(e){const r=this;if(!(e instanceof qi)){if(typeof e=="string"){if(e=r.getPreset(e),!e)throw new Error("You must define a valid view preset. See PresetManager for reference")}else if(typeof e=="object"){if(e.base){const t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=T.merge(T.clone(t.data),e)}e.id?e=r.createRecord(e):(e=r.createRecord(T.assign({},e)),e.id=e.generateId(e))}}return e}deletePreset(e){typeof e=="string"?e=this.getById(e):typeof e=="number"&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}},Ha=new bF,CF=class extends St{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}},Gp=class extends re{static get defaultConfig(){return{modelClass:CF,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,maxTraverseTries:100,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0}}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(e){const r=this;if(super.construct(e),r.originalContinuous=r.continuous,r.ion({change:({action:t})=>{t!=="filter"&&r.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>r.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:t=>r.trigger("reconfigure",t)}),r.startDate)r.internalOnReconfigure(),r.trigger("reconfigure");else if(r.viewPreset){const t=r.getAdjustedDates(new Date);r.startDate=t.startDate,r.endDate=t.endDate}}get isTimeAxis(){return!0}reconfigure(e,r=!1,t=!1){const i=this,n=i.getAdjustedDates(e.startDate,e.endDate),s={};if(i.trigger("beforeReconfigure",{startDate:n.startDate,endDate:n.endDate,config:e})!==!1){i.trigger("beginReconfigure"),i._configuredStartDate=e.startDate,i._configuredEndDate=e.endDate;for(const o in e)s[o]=i[o];const a=e.viewPreset&&e.viewPreset!==i.viewPreset;if(a&&(t=i.isFiltered,i.filters.forEach(o=>o.disabled=!1)),Object.assign(i,e),i.internalOnReconfigure(t,a)===!1)return!1;i.trigger("endReconfigure",{suppressRefresh:r,config:e,oldConfig:s})}}internalOnReconfigure(e=!1,r){const t=this;t.isConfigured=!0;const i=t.getAdjustedDates(t.startDate,t.endDate,!0),n=t.getAdjustedDates(t.startDate,t.endDate),s=n.startDate,a=n.endDate;if(s>=a)throw new Error(`Invalid start/end dates. Start date must be less than end date. Start date: ${s}. End date: ${a}.`);const{unit:o,increment:l=1}=t,c=t.generateTicks(s,a,o,l);t.suspendEvents(),t.maintainFilter=e,t.data=c,t.maintainFilter=!1;const{count:d}=t;if(d===0){if(e)return r&&t.disableFilters(),t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.endDate=t.last.endDate,t.resumeEvents(),t.isContinuous?(t.adjustedStart=i.startDate,t.adjustedEnd=b.getNext(d>1?c[d-1].startDate:i.startDate,o,l,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=t.endDate),t.updateVisibleTickBoundaries(),t.updateTickCache(!0)}updateVisibleTickBoundaries(){const e=this,{count:r,unit:t,startDate:i,endDate:n,weekStartDay:s,increment:a=1}=e,o=b.getNormalizedUnitDuration(i,t)*a,l=b.getNormalizedUnitDuration(n,t)*a;do e.visibleTickStart=(i-e.adjustedStart)/o,e.autoAdjust&&(e.visibleTickStart=Math.floor(e.visibleTickStart)),e.visibleTickStart>=1&&(e.adjustedStart=b.getNext(e.adjustedStart,t,a,s));while(e.visibleTickStart>=1);do e.visibleTickEnd=r-(e.adjustedEnd-n)/l,r-e.visibleTickEnd>=1&&(e.adjustedEnd=b.getNext(e.adjustedEnd,t,-1,s));while(r-e.visibleTickEnd>=1);e.fullTicks=!e.visibleTickStart&&e.visibleTickEnd===r}get viewPreset(){return this._viewPreset}set viewPreset(e){const r=this;if(e=Ha.getPreset(e),!(e instanceof qi))throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");r._viewPreset=e,Object.assign(r,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit||e.mainHeader.unit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}get weekStartDay(){var e;return(e=this._weekStartDay)!=null?e:b.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(e,r,t=!1){r&&e-r===0&&(r=null);const i=this,{startDate:n,endDate:s}=i.getAdjustedDates(e,r);if(i.startDate-n!==0||i.endDate-s!==0)return i.reconfigure({startDate:n,endDate:s},!1,t)}shift(e,r=this.shiftUnit){const t=this;let{startDate:i,endDate:n}=t;t.isFiltered&&(i=t.allRecords[0].startDate,n=t.allRecords[t.allCount-1].endDate);let s=0;do i=b.add(i,e,r),n=b.add(n,e,r);while(s++<t.maxTraverseTries&&t.setTimeSpan(i,n,{preventThrow:!0})===!1)}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,r=this){this.filters.clear(),super.filterBy((i,n)=>e.call(r,i.data,n))}filter(){const e=this,r=super.filter(...arguments);return!e.maintainFilter&&e.count===0&&(e.resumeEvents(),e.trigger("invalidFilter"),e.disableFilters()),r}disableFilters(){this.filters.forEach(e=>e.disabled=!0),this.filter()}triggerFilterEvent(e){const r=this;e.filters.count?r.continuous=!1:r.continuous=r.originalContinuous,r.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return this.continuous!==!1&&!this.isFiltered}getAdjustedDates(e,r,t=!1){const i=this;return r&&e-r===0&&(r=null),e=e||i.startDate,r=r||b.add(e,i.defaultSpan,i.mainUnit),i.autoAdjust||t?{startDate:i.floorDate(e,!1,i.autoAdjust?i.mainUnit:i.unit,1),endDate:i.ceilDate(r,!1,i.autoAdjust?i.mainUnit:i.unit,1)}:{startDate:e,endDate:r}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=b.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=b.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,r,t,i){r=r!==!1;const n=this,s=r?b.clone(n.startDate):null,a=i||n.resolutionIncrement,o=t||(r?n.resolutionUnit:n.mainUnit),l=(d,u)=>Math.floor(d/u)*u;if(r){const d=l(b.diff(s,e,o),a);return b.add(s,d,o,!1)}const c=b.clone(e);if(o==="week"){const d=c.getDay()||7,u=n.weekStartDay||7;b.add(b.startOf(c,"day",!1),d>=u?u-d:-(7-u+d),"day",!1),c.getDay()!==u&&c.getHours()===23&&b.add(c,1,"hour",!1)}else{b.startOf(c,o,!1);const d=["day","year"].includes(o)?1:0,u=o==="day"?"date":o,h=l(b.get(c,u)-d,a)+d;b.set(c,u,h)}return c}roundDate(e,r,t=this.resolutionUnit,i=this.resolutionIncrement||1){const n=this,s=b.clone(e);switch(r=b.clone(r||n.startDate),t){case"week":{b.startOf(s,"day",!1);let a=s.getDay()-n.weekStartDay,o;return a<0&&(a=7+a),Math.round(a/7)===1?o=7-a:o=-a,b.add(s,o,"day",!1)}case"month":{const a=b.diff(r,s,"month")+b.as("month",s.getDay()/b.daysInMonth(s)),o=Math.round(a/i)*i;return b.add(r,o,"month",!1)}case"quarter":return b.startOf(s,"month",!1),b.add(s,3-s.getMonth()%3,"month",!1);default:{const a=b.as(t,b.diff(r,s)),o=b.as(t,r.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),l=Math.round((a+o)/i)*i;return b.add(r,l-o,t,!1)}}}ceilDate(e,r,t,i){const n=this;r=r!==!1,i=i||(r?n.resolutionIncrement:1);const s=t||(r?n.resolutionUnit:n.mainUnit),a=b.clone(e);let o=!1;switch(s){case"minute":o=!b.isStartOf(a,"minute");break;case"hour":o=!b.isStartOf(a,"hour");break;case"day":case"date":o=!b.isStartOf(a,"day");break;case"week":b.startOf(a,"day",!1),o=a.getDay()!==n.weekStartDay||!b.isEqual(a,e);break;case"month":b.startOf(a,"day",!1),o=a.getDate()!==1||!b.isEqual(a,e);break;case"quarter":b.startOf(a,"day",!1),o=a.getMonth()%3!==0||a.getDate()!==1||!b.isEqual(a,e);break;case"year":b.startOf(a,"day",!1),o=a.getMonth()!==0||a.getDate()!==1||!b.isEqual(a,e);break}return o?b.getNext(a,s,i,n.weekStartDay):a}get include(){return this._include}set include(e){const r=this;r._include=e,r.continuous=!e,r.isConfiguring||(r.startDate=r._configuredStartDate,r.endDate=r._configuredEndDate,r.internalOnReconfigure(),r.trigger("includeChange"))}processExclusion(e,r,t){const{include:i}=this;return i?Object.entries(i).some(([n,s])=>{if(!s)return!1;const{from:a,to:o}=s;if(b.compareUnits("day",t)>=0&&b.getLargerUnit(n)===t&&(a&&b.set(e,n,a),o)){let l=t;t==="day"&&(l="date"),b.set(r,{[l]:b.get(r,l)-1,[n]:o})}if(b.compareUnits(n,t)>=0){const l=n==="day"?e.getDay():b.get(e,n);if(a&&l<a||o&&l>=o)return!0}}):!1}initExclusion(){Object.entries(this.include).forEach(([e,r])=>{if(r){const{from:t,to:i}=r;r.lengthFactor=b.getUnitToBaseUnitRatio(e,b.getLargerUnit(e))/(i-t),r.lengthFactorExcl=b.getUnitToBaseUnitRatio(e,b.getLargerUnit(e))/(i-t-1),r.center=t+t/(r.lengthFactor-1)}})}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(e,r,t=this.unit,i=this.increment){const n=this,s=[],a=!!n.include;let o,l,c,d=0,{startDate:u,endDate:h}=n.getAdjustedDates(e,r);for(n.tickCache={},a&&n.initExclusion();u<h;){if(o=b.getNext(u,t,i,n.weekStartDay),!n.autoAdjust&&o>h&&(o=h),t==="hour"&&i>1&&s.length>0&&d===0){const g=s[s.length-1];d=(g.startDate.getHours()+i)%24-g.endDate.getHours(),d!==0&&(o=b.add(o,d,"hour"))}c=!1,a?(l=new Date(o.getTime()),c=n.processExclusion(u,o,t)):l=o,c||(s.push({id:s.length+1,startDate:u,endDate:o}),n.tickCache[u.getTime()]=s.length-1),u=l}return s}get visibleTickTimeSpan(){const e=this;return e.isContinuous?e.visibleTickEnd-e.visibleTickStart:e.count}getTickFromDate(e){var r,t;const i=this,n=i.records,s=(t=(r=e.getTime)==null?void 0:r.call(e))!=null?t:e;let a=0,o=n.length-1,l,c,d,u;if(!n.length||s<n[0].startDateMS||s>n[o].endDateMS)return-1;if(i.isContinuous){for(;a<o;)l=a+o+1>>1,s>n[l].endDateMS?a=l+1:s<n[l].startDateMS?o=l-1:a=l;return c=n[a],d=c.startDateMS,s>d&&(u=c.endDateMS,a+=(s-d)/(u-d)),Math.min(Math.max(a,i.visibleTickStart),i.visibleTickEnd)}else for(let h=0;h<=o;h++)if(u=n[h].endDateMS,s<=u)return d=n[h].startDateMS,c=h+(s>d?(s-d)/(u-d):0),c}getSnappedTickFromDate(e){const r=Math.floor(this.getTickFromDate(e));return this.getAt(r)}getDateFromTick(e,r){const t=this;if(e===t.visibleTickEnd)return t.endDate;const i=Math.floor(e),n=e-i,s=t.getAt(i);if(!s)return null;const a=i===0&&t.isContinuous?t.adjustedStart:s.startDate,o=i===t.count-1&&t.isContinuous?t.adjustedEnd:s.endDate;let l=b.add(a,n*(o-a),"millisecond");return r&&(l=t[r+"Date"](l)),l}get ticks(){return this.records}updateTickCache(e=!1){const r=this;r.count?(r._start=r.first.startDate,r._end=r.last.endDate,r._startMS=r.startDate.getTime(),r._endMS=r.endDate.getTime()):r._start=r._end=r._startMs=r._endMS=null,e||(r.tickCache={},r.forEach((t,i)=>r.tickCache[t.startDate.getTime()]=i))}dateInAxis(e,r=!1){const t=this,i=t.startDate,n=t.endDate;if(t.isContinuous)return r?b.betweenLesserEqual(e,i,n):b.betweenLesser(e,i,n);{const s=t.getCount();let a,o,l;for(let c=0;c<s;c++)if(l=t.getAt(c),a=l.startDate,o=l.endDate,r&&e<=o||!r&&e<o)return e>=a}return!1}timeSpanInAxis(e,r){const t=this;return!r||r.getTime()===e.getTime()?this.dateInAxis(e,!0):t.isContinuous?b.intersectSpans(e,r,t.startDate,t.endDate):e<t.startDate&&r>t.endDate||t.getTickFromDate(e)!==t.getTickFromDate(r)}isTimeSpanInAxis(e){var r;const t=this,{startMS:i,endMS:n}=t,{startDateMS:s}=e,a=(r=e.endDateMS)!=null?r:e.meta.endDateCached;if(!s||!a)return!1;if(a===s)return t.dateInAxis(e.startDate,!0);if(t.isContinuous)return a>i&&s<n;const o=t.getTickFromDate(e.startDate),l=t.getTickFromDate(e.endDate);return o===t.count&&b.isEqual(e.startDate,t.last.endDate)||l===0&&b.isEqual(e.endDate,t.first.startDate)?!1:s<i&&a>n||o!==l}forEachAuxInterval(e,r=1,t,i=this){const n=this.endDate;let s=this.startDate,a=0,o;if(s>n)throw new Error("Invalid time axis configuration");for(;s<n;)o=b.min(b.getNext(s,e,r,this.weekStartDay),n),t.call(i,s,o,a,o>=n),s=o,a++}};Gp._$name="TimeAxis";var Up=class extends Le(){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(e){const r=this;r.unitToPixelsCache={},super.construct(e);const t=r.timeAxis.viewPreset||r.viewPreset;if(t)if(t instanceof qi)r.consumeViewPreset(t);else{const i=Ha.getPreset(t);i&&r.consumeViewPreset(i)}r.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:r}),r.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}calculateInfiniteScrollingDateRange(e,r,t=this.viewPreset){const{timeAxis:i,availableSpace:n}=this,{bufferCoef:s}=this.owner,{leafUnit:a,leafIncrement:o,topUnit:l,topIncrement:c,tickSize:d}=t,u=a===l&&Math.round(c)===c&&Math.round(o)===o,h=u?c:o,g=u?l:a;if(r){const f=Math.ceil((n*s+n/2)/d);return{startDate:i.floorDate(b.add(e,-f*o,a),!1,g,h),endDate:i.ceilDate(b.add(e,f*o,a),!1,g,h)}}else{const f=Math.ceil(n*s/d);return{startDate:i.floorDate(b.add(e,-f*o,a),!1,g,h),endDate:i.ceilDate(b.add(e,Math.ceil((n/d+f)*o),a),!1,g,h)}}}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get headers(){return this._headers}set headers(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}get isTimeAxisViewModel(){return!0}get isHorizontal(){return this.mode!=="vertical"}get isVertical(){return this.mode==="vertical"}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this.headers=null,this.setConfig(e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:r}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),!r&&e.count>0&&this.update()}update(e,r=!1,t=!1){const i=this,{timeAxis:n,headers:s}=i,a=e!==0;if(i.isConfiguring||a&&i._availableSpace===e){t&&i.trigger("update");return}if(i._availableSpace=Math.max(e||i.availableSpace||0,0),typeof i.availableSpace!="number")throw new Error("Invalid available space provided to TimeAxisModel");i.columnConfig=[];const o=i._tickSize=i.calculateTickSize(i.originalTickSize);if(typeof o!="number"||o<=0)throw new Error("Invalid timeAxis tick size");i.unitToPixelsCache={},i._totalSize=null;for(let l=0,{length:c}=s;l<c;l++){const d=s[l];if(d.cellGenerator){const u=d.cellGenerator.call(i,n.startDate,n.endDate);i.columnConfig[l]=i.createHeaderRow(l,d,u)}else i.columnConfig[l]=i.createHeaderRow(l,d)}r||i.trigger("update")}getDistanceBetweenDates(e,r){return this.getPositionFromDate(r)-this.getPositionFromDate(e)}getDistanceForDuration(e){return this.getSingleUnitInPixels("millisecond")*e}getPositionFromDate(e,r={}){const t=this.getScaledTick(e,r);return t===-1?-1:this.tickSize*(t-this.timeAxis.visibleTickStart)}getScaledTick(e,{respectExclusion:r,snapToNextIncluded:t,isEnd:i,min:n,max:s}){const{timeAxis:a}=this,{include:o,unit:l}=a;let c=a.getTickFromDate(e);if(c!==-1&&r&&o){let d=!1;if(o.hour&&b.compareUnits(l,"hour")>0&&l!=="day"){const{from:u,to:h,lengthFactor:g,center:f}=o.hour,m=e.getHours(),p=Math.min(Math.max(m,u),h);if(!t&&p!==m)return-1;const v=p+e.getMinutes()/60,y=f-v,C=f-y*g;e=b.add(e,C-m,"h"),d=!0}if(o.day&&b.compareUnits(l,"day")>0){const{from:u,to:h,lengthFactor:g,center:f}=o.day;let m=e.getDay();i&&e.getHours()===0&&e.getMinutes()===0&&e.getSeconds()===0&&e.getMilliseconds()===0&&--m<0&&(m=6);let p=0;if(m<u||m>=h)if(t){if(i?p=(h-m-8)%7:p=(u-m+7)%7,e=b.add(e,p,"d"),e=b.startOf(e,"d",!1),s&&e.getTime()>=s||n&&e.getTime()<=n)return-1}else return-1;const{weekStartDay:v}=a,y=e.getDay()===0?0:f,C=e.getDay()+e.getHours()/24,D=y-C,S=y-D*g;e=b.add(e,S-C+v,"d"),d=!0}d&&(e=b.constrain(e,a.startDate,a.endDate),c=a.getTickFromDate(e))}return c}getDateFromPosition(e,r,t=!1){const i=this,{timeAxis:n}=i,s=i.getScaledPosition(e)/i.tickSize+n.visibleTickStart;if(s<0||s>n.count){if(t){let a;return s<0?a=b.add(n.startDate,s,n.unit):a=b.add(n.endDate,s-n.count,n.unit),r&&(a=n[r+"Date"](a)),a}return null}return n.getDateFromTick(s,r)}getScaledPosition(e){const{include:r,unit:t,weekStartDay:i}=this.timeAxis;if(r){const n=this.getSingleUnitInPixels("day");if(r.day&&b.compareUnits(t,"day")>0){const{from:s,lengthFactor:a}=r.day,o=e%(n*7),l=e-o;e=o/a+(s-i)*n+l}if(r.hour&&b.compareUnits(t,"hour")>0&&t!=="day"){const{from:s,lengthFactorExcl:a}=r.hour,o=this.getSingleUnitInPixels("hour"),l=e%n,c=e-l;e=l/a+s*o+c}}return e}getSingleUnitInPixels(e){const r=this;return r.unitToPixelsCache[e]||(r.unitToPixelsCache[e]=b.getUnitToBaseUnitRatio(r.timeAxis.unit,e,!0)*r.tickSize/r.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,r){this._tickSize=this.originalTickSize=e,this.update(void 0,r)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const r=this,{forceFit:t,timeAxis:i,suppressFit:n}=r,s=i.unit;let a=0,o=1;if(r.snap){const l=i.resolution;o=b.getUnitToBaseUnitRatio(s,l.unit)*l.increment}if(n)a=e;else{const l=r.availableSpace/i.visibleTickTimeSpan;a=t||e<l?l:e,o>0&&(!t||o<1)&&(a=Math.max(1,o*a)/o)}return a}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const r=this;if(r._availableSpace=Math.max(0,e),r._availableSpace>0){const t=r.calculateTickSize(r.originalTickSize);t>0&&t!==r.tickSize&&r.update()}}getDates(e=this.columnLinesFor,r=!1,t=!1){const i=this,n=[],s=r?i.lowestHeader:e,a=i.majorHeaderLevel,o=i.headers&&i.headers[e].unit,l=a!=null&&i.headers&&i.headers[a].unit,c=a!=null&&b.doesUnitsAlign(l,o);if(!!(i.headers&&i.headers[s].cellGenerator)){const u=i.columnConfig[s];for(let h=1,g=u.length;h<g;h++)n.push({date:u[h].startDate})}else i.forEachInterval(s,(u,h)=>{n.push({date:t?h:u,isMajor:a!==e&&c&&i.isMajorTick(t?h:u)})});return n}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const r=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(r,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,r,t){const i=this,n=[],{align:s,headerCellCls:a=""}=r,o=b.clearTime(new Date),{timeAxis:l}=i,c=i.headers.length-1,d=(h,g,f,m,p)=>{let v=b.format(h,r.dateFormat);const y=f>0&&!m,C={align:s,start:h,end:g,value:p?p.header:v,headerCellCls:a,width:c===e&&i.owner&&(l.fullTicks||y)?i.owner.tickSize:i.getDistanceBetweenDates(h,g),index:f};C.width!==0&&(C.coord=u-1,u+=C.width,i.headersDatesCache[e][h.getTime()]=1,r.renderer&&(v=r.renderer.call(r.thisObj||i,h,g,C,f),C.value=v==null?"":v),r.unit==="day"&&(!r.increment||r.increment===1)&&(C.headerCellCls+=" b-sch-dayheadercell-"+h.getDay(),b.clearTime(h,!0)-o===0&&(C.headerCellCls+=" b-sch-dayheadercell-today")),n.push(C))};let u=0;return i.headersDatesCache[e]={},t?t.forEach((h,g)=>d(h.start,h.end,g,g===t.length-1,h)):i.forEachInterval(e,d),n}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:e}=this;return e?Math.max(e.length-2,0):null}isMajorTick(e){const r=this.majorHeaderLevel;return r!=null&&this.headersDatesCache[r]&&this.headersDatesCache[r][e.getTime()]||!1}forEachInterval(e,r,t=this){const{headers:i,timeAxis:n}=this;if(i)if(e===i.length-1)n.forEach((s,a)=>r.call(t,s.startDate,s.endDate,a,a===n.count-1));else{const s=i[e];n.forEachAuxInterval(s.unit,s.increment,r,t)}}forEachMainInterval(e,r){this.forEachInterval(this.mainHeaderLevel,e,r)}consumeViewPreset(e){const r=this;r.headers=null,r.getConfig("tickSize"),r.viewPreset=e,Object.assign(r,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:r.isHorizontal?e.tickWidth:e.tickHeight}),r.originalTickSize=r.tickSize}};Up._$name="TimeAxisViewModel";var Tx=new Date,Mx=e=>{var r;return r=class extends(e||F){getRtlX(t){return this.rtl&&this.isHorizontal&&(t=this.timeAxisViewModel.totalSize-t),t}getDateFromCoordinate(t,i,n=!0,s=!1,a=!1){return n||(t=this.currentOrientation.translateToScheduleCoordinate(t)),a||(t=this.getRtlX(t)),this.timeAxisViewModel.getDateFromPosition(t,i,s)}getDateFromCoord(t){return this.getDateFromCoordinate(t.coord,t.roundingMethod,t.local,t.allowOutOfRange,t.ignoreRTL)}getDateFromXY(t,i,n=!0,s=!1){return this.currentOrientation.getDateFromXY(t,i,n,s)}getDateFromDomEvent(t,i,n=!1){return this.getDateFromXY([t.pageX,t.pageY],i,!1,n)}getStartEndDatesFromRectangle(t,i,n,s=!1){const a=this,{isHorizontal:o}=a,l=o?t.x:t.top,c=o?t.right:t.bottom;let d,u;return l>=0&&c<a.timeAxisViewModel.totalSize?(d=a.getDateFromCoordinate(l,i,!0),u=a.getDateFromCoordinate(c,i,!0)):l<0?(u=a.getDateFromCoordinate(c,i,!0,s),d=u&&b.add(u,-n,"ms")):(d=a.getDateFromCoordinate(l,i,!0,s),u=d&&b.add(d,n,"ms")),{start:d,end:u}}getDisplayEndDate(t,i){return t.getHours()===0&&t.getMinutes()===0&&(!i||!(t.getYear()===i.getYear()&&t.getMonth()===i.getMonth()&&t.getDate()===i.getDate()))&&!b.formatContainsHourInfo(this.displayDateFormat)&&(t=b.add(t,-1,"day")),t}getFormattedEndDate(t,i){return this.getFormattedDate(this.getDisplayEndDate(t,i))}getCoordinateFromDate(t,i=!0){const n=this,{timeAxisViewModel:s}=n,{isContinuous:a,startMS:o,endMS:l,startDate:c,endDate:d,unit:u}=n.timeAxis,h=t.valueOf();i===!0?i={local:!0}:i?"local"in i||(i.local=!0):i={local:!1};let g;if(t instanceof Date||(Tx.setTime(t),t=Tx),a&&t.getTimezoneOffset()===c.getTimezoneOffset()&&c.getTimezoneOffset()===d.getTimezoneOffset()&&b.getUnitToBaseUnitRatio(u,"day")!==-1){if(h<o||h>l)return-1;g=(h-o)/(l-o)*s.totalSize}else g=s.getPositionFromDate(t,i);return n.rtl&&n.isHorizontal&&!(i!=null&&i.ignoreRTL)&&(g=s.totalSize-g),i.local||(g=n.currentOrientation.translateToPageCoordinate(g)),g}getTimeSpanDistance(t,i){return this.timeAxisViewModel.getDistanceBetweenDates(t,i)}get viewportCenterDate(){const{timeAxis:t,timelineScroller:i}=this;if(t.isContinuous){const n=(i.position+i.clientSize/2)/i.scrollSize;return new Date(t.startMS+(t.endMS-t.startMS)*n)}return this.getDateFromCoordinate(i.position+i.clientSize/2)}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(t){this.timeAxis.resolution=typeof t=="number"?{increment:t,unit:this.timeAxis.resolution.unit}:t}get snap(){var t,i;return(i=(t=this._timeAxisViewModel)==null?void 0:t.snap)!=null?i:this._snap}updateSnap(t){this.isConfiguring||(this.timeAxisViewModel.snap=t,this.timeAxis.forceFullTicks=t&&this.fillTicks)}onSchedulerHorizontalScroll({subGrid:t,scrollLeft:i,scrollX:n}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}},E(r,"$name","TimelineDateMapper"),E(r,"configurable",{snap:!1}),r},{eventNameMap:SF}=B,Ix=e=>{var r;return r=class extends(e||F){constructor(){super(...arguments),E(this,"hoveredEvents",new Set)}initDomEvents(){const t=this,{schedulerEvents:i}=t;i.element=t.timeAxisSubGridElement,i.thisObj=t,B.on(i),B.on({element:t.timeAxisSubGridElement,mouseleave:"handleScheduleLeaveEvent",capture:!0,thisObj:t}),t.updateTimelineContextOnScroll&&q.supportsPointerEventConstructor&&B.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:t})}getTimeSpanMouseEventParams(t,i){throw new Error("Implement in subclass")}getScheduleMouseEventParams(t,i){throw new Error("Implement in subclass")}handleScheduleEvent(t){const i=this;if(i.ignoreDomEventsWhileScrolling&&(i.scrolling||i.timeAxisSubGrid.scrolling))return;const n=i.getTimelineEventContext(t);i.lastPointerEvent=t,n&&i.trigger(`${n.eventElement?i.scheduledEventName:"schedule"}${SF[t.type]||O.capitalize(t.type)}`,n),i.timelineContext=n}handleScheduleLeaveEvent(t){t.target===this.timeAxisSubGridElement&&this.handleScheduleEvent(t)}onScheduleScroll({target:t}){var i,n,s,a,o;const l=this;if(t&&l.updateTimelineContextOnScroll&&!((i=l.features.pan)!=null&&i.isActive)&&!l.partners.some(c=>{var d;return(d=c.features.pan)==null?void 0:d.isActive})&&(t.contains(l.element)||l.bodyElement.contains(t))){const{timelineContext:c,lastPointerEvent:d}=l;if(c){const u=w.elementFromPoint(c.domEvent.clientX,c.domEvent.clientY),h=new q.PointerEventConstructor("pointermove",d),g=new MouseEvent("mousemove",d);Object.defineProperty(h,"pointerId",{value:(o=(a=(n=be.currentPointerDown)==null?void 0:n.pointerId)!=null?a:(s=be.currentTouch)==null?void 0:s.identifier)!=null?o:1}),h.scrollInitiated=g.scrollInitiated=!0,u==null||u.dispatchEvent(h),u==null||u.dispatchEvent(g)}}}updateTimelineContext(t,i){this.trigger("timelineContextChange",{oldContext:i,context:t}),t&&!i?this.trigger("scheduleMouseEnter",t):t||this.trigger("scheduleMouseLeave",{event:i.event})}getTimelineEventContext(t){const i=this,n=t.target.closest(i.eventInnerSelector),s=i.getCellElementFromDomEvent(t);if(s){const a=i.getDateFromDomEvent(t,"floor");if(!a)return;const o=Ge.get(s),l=n?i.getTimeSpanMouseEventParams(n,t):i.getScheduleMouseEventParams(o,t);if(!l)return;const c=i.isVertical?i.resourceStore.indexOf(l.resourceRecord):o.row.dataIndex,d=i.timeAxis.getTickFromDate(a),u=i.timeAxis.getAt(Math.floor(d));if(u)return{isTimelineContext:!0,domEvent:t,eventElement:n,cellElement:s,index:c,tick:u,tickIndex:d,date:a,tickStartDate:u.startDate,tickEndDate:u.endDate,tickParentIndex:u.parentIndex,row:o.row,event:t,...l}}}getCellElementFromDomEvent({target:t,clientY:i,type:n}){var s;const a=this,{isVertical:o,foregroundCanvas:l}=a,c=t.closest(a.eventSelector);if(c)return a.getCell({[o?"row":"record"]:o?0:a.resolveRowRecord(c),column:a.timeAxisColumn});if(l.contains(t)){if(t===l||n==="mousemove")return(s=a.rowManager.getRowAt(i,!1))==null?void 0:s.getCell(a.timeAxisColumn.id)}else return t.matches(".b-grid-row")?t.firstElementChild:t.closest(a.timeCellSelector)}matchScheduleCell(t){return t.closest(this.timeCellSelector)}onElementMouseButtonEvent(t){const i=t.target.closest(".b-sch-header-timeaxis-cell");if(i){const n=this,s=i.parentElement.dataset.headerPosition,a=n.timeAxisViewModel.columnConfig[s],o=n.timeAxis.isFiltered?a.findIndex(d=>d.index==i.dataset.tickIndex):i.dataset.tickIndex,l=a[o],c=n.features.contextMenu;(!c||t.type!==c.triggerEvent)&&this.trigger(`timeAxisHeader${O.capitalize(t.type)}`,{startDate:l.start,endDate:l.end,event:t})}}onElementMouseDown(t){this.onElementMouseButtonEvent(t),super.onElementMouseDown(t)}onElementClick(t){this.onElementMouseButtonEvent(t),super.onElementClick(t)}onElementDblClick(t){this.onElementMouseButtonEvent(t),super.onElementDblClick(t)}onElementContextMenu(t){this.onElementMouseButtonEvent(t),super.onElementContextMenu(t)}onElementMouseOver(t){var i;const n=this;if(n.ignoreDomEventsWhileScrolling&&(n.scrolling||n.timeAxisSubGrid.scrolling))return;super.onElementMouseOver(t);const{target:s}=t,{hoveredEvents:a}=n;if(s.closest(n.eventInnerSelector)&&!((i=n.features.eventDrag)!=null&&i.isDragging)){const o=s.closest(n.eventSelector);if(!a.has(o)&&!n.preventOverCls){a.add(o),o.classList.add(n.overScheduledEventClass);const l=n.getTimeSpanMouseEventParams(o,t);l&&n.trigger(`${n.scheduledEventName}MouseEnter`,l)}}else a.size&&n.unhoverAll(t)}onElementMouseOut(t){var i;super.onElementMouseOut(t);const n=this,{target:s,relatedTarget:a}=t,o=s.closest(n.eventInnerSelector),l=s.closest(n.eventSelector),c=n.resolveTimeSpanRecord(s);if(o&&c&&n.hoveredEvents.has(l)&&!((i=n.features.eventDrag)!=null&&i.isDragging)){if(a&&w.isDescendant(o,a))return;n.unhover(l,t)}}unhover(t,i){const n=this;t.classList.remove(n.overScheduledEventClass),n.trigger(`${n.scheduledEventName}MouseLeave`,n.getTimeSpanMouseEventParams(t,i)),n.hoveredEvents.delete(t)}unhoverAll(t){for(const i of this.hoveredEvents)!i.isReleased&&!i.classList.contains("b-released")&&this.unhover(i,t);this.hoveredEvents.clear()}get widgetClass(){}},E(r,"$name","TimelineDomEvents"),E(r,"configurable",{timelineContext:{$config:{equal(t,i){return(t==null?void 0:t.index)===(i==null?void 0:i.index)&&(t==null?void 0:t.tickParentIndex)===(i==null?void 0:i.tickParentIndex)&&!(((t==null?void 0:t.tickStartDate)||0)-((i==null?void 0:i.tickStartDate)||0))}}},updateTimelineContextOnScroll:!0,ignoreDomEventsWhileScrolling:null}),E(r,"properties",{schedulerEvents:{pointermove:"handleScheduleEvent",mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"}}),E(r,"delayable",{onScheduleScroll:"raf"}),r},oc=(e=0,r=0)=>r-e,Px=e=>class extends(e||F){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(t){const i={owner:this};let n=[];if(t===!0)n=Ha.allRecords;else if(Array.isArray(t))for(const a of t)if(typeof a=="string"){const o=Ha.getById(a);o&&n.push(o)}else n.push(a);else T.assign(i,t);const s=new Nu(i);return s.add(n),s}changeViewPreset(t,i){const n=this,{presets:s}=n;t?(t=s.createRecord(t),s.includes(t)||s.add(t)):t=s.first;const a=n.lastViewPresetOptions||{},o=t.options||(t.options={}),l=o.event={startDate:o.startDate,endDate:o.endDate,from:i,to:t,preset:t},c=!n._viewPreset||!n._viewPreset.equals(t),d=oc(o.startDate,a.startDate)||oc(o.endDate,a.endDate)||oc(o.centerDate,a.centerDate)||o.startDate&&oc(o.startDate,n.startDate)||o.endDate&&oc(o.endDate,n.endDate);if((c||d)&&(c||(n._viewPreset=null),n.isConfiguring||n.trigger("beforePresetChange",l)!==!1))return t}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateDisplayDateFormat(t){this.trigger("displayDateFormatChange",{format:t})}getFormattedDate(t){return b.format(t,this.displayDateFormat)}updateViewPreset(t){var i;const n=this,{options:s}=t,{event:a,startDate:o,endDate:l}=s,{isHorizontal:c,_timeAxis:d,_timeAxisViewModel:u}=n,h=c&&n.rtl;let{centerDate:g,zoomDate:f,zoomPosition:m}=s,p=!1;if((i=n.syncSplits)==null||i.call(n,v=>v.viewPreset=t),delete t.options,n._viewPresetChanging=!0,d&&!n.isConfiguring){const{timelineScroller:v}=n;if(n.lastViewPresetOptions=s,d.isConfigured){n.suspendRefresh();const y=T.copyProperties({},n,["weekStartDay","startTime","endTime"]);n.infiniteScroll?Object.assign(y,u.calculateInfiniteScrollingDateRange(g||new Date((o.getTime()+l.getTime())/2),!0,t)):o?(y.startDate=o,y.endDate=l,!g&&l&&(g=new Date((o.getTime()+l.getTime())/2))):(y.startDate=d.startDate,y.endDate=l||d.endDate,g||(g=n.viewportCenterDate)),d.isConfigured=!1,y.viewPreset=t,d.reconfigure(y,!0),u.reconfigure({viewPreset:t,headers:t.headers,columnLinesFor:t.columnLinesFor!=null?t.columnLinesFor:t.headers.length-1,tickSize:c?t.tickWidth:t.tickHeight||t.tickWidth||60}),n.resumeRefresh(!1)}if(n.refresh(),!s.notScroll&&n.isPainted)if(s.visibleDate)n.visibleDate=s.visibleDate;else if(f&&m){const y=dr[d.resolutionUnit],C=y>3?"hour":"minute",D=b.asMilliseconds(C==="minute"?15:1,C),S=new Date(Math.round(f/D)*D);a.zoomDate=f,a.zoomPosition=m,a.zoomLevel=s.zoomLevel,h?v.position=v.scrollWidth-(n.getCoordinateFromDate(S)+m):v.position=n.getCoordinateFromDate(S)-m}else if(g){n.cachedCenterDate=g,a.centerDate=g;const y=n.timelineScroller.clientSize,C=h?n.timeAxisViewModel.totalSize-n.getCoordinateFromDate(g,!0):n.getCoordinateFromDate(g,!0),D=Math.max(C-y/2,0);n.scrollingToCenter=!0,D===(n.isHorizontal?n.scrollLeft:n.scrollTop)?p=!0:n.isHorizontal?n.scrollHorizontallyTo(D,!1):n.scrollVerticallyTo(D,!1),n.setTimeout(()=>{n.scrollingToCenter=!1},100)}else(n.isHorizontal?n.scrollLeft:n.scrollTop)===0?p=!0:n.timelineScroller.scrollTo(0)}n.dataset.presetId=t.id,n.trigger("presetChange",a),n._viewPresetChanging=!1,p&&(n.isHorizontal?n.currentOrientation.updateFromHorizontalScroll(n.scrollLeft,!0):n.currentOrientation.updateFromVerticalScroll(n.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(t){const i=super.getCurrentConfig(t);return i.viewPreset&&i.viewPreset.name&&!i.viewPreset.base&&delete i.viewPreset.name,i}get widgetClass(){}},Ax=e=>{var r;return r=class extends(e||F){constructor(){super(...arguments),E(this,"lastWheelTime",-1),E(this,"lastZoomPosition",-1)}construct(t){const i=this;super.construct(t),i.zoomOnMouseWheel&&B.on({element:i.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:n=>n.ctrlKey&&n.preventDefault()},thisObj:i,capture:!0,passive:!1}),i.zoomOnTimeAxisDoubleClick&&i.ion({timeaxisheaderdblclick:({startDate:n,endDate:s})=>{i.forceFit||i.zoomToSpan({startDate:n,endDate:s})}})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(t){if(typeof t!="number"&&(t=this.presets.count-1),t<0||t>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=t}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(t){if(typeof t!="number"&&(t=0),t<0||t>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=t}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(t){this.zoomToLevel(t)}getMilliSecondsPerPixelForZoomLevel(t,i){const{bottomHeader:n}=t,s=this.isHorizontal?t.tickWidth:t.tickHeight;return Math.round((b.add(new Date(1,0,1),n.increment||1,n.unit)-new Date(1,0,1))/(i?s:t.actualWidth||s))}zoomTo(t){const i=this;typeof t=="object"?t.preset?i.zoomToLevel(t.preset,t):t.level!=null?i.zoomToLevel(t.level,t):i.zoomToSpan(t):i.zoomToLevel(t)}zoomToLevel(t,i={}){if(this.forceFit){console.warn("Warning: The forceFit setting and zooming cannot be combined");return}typeof t=="number"&&(t=Math.min(Math.max(t,this.minZoomLevel),this.maxZoomLevel));const n=this,{presets:s}=n,a=n.isVertical?"tickHeight":"tickWidth",o=s.createRecord(t),l=o[a],c=i.startDate?new Date(i.startDate):null,d=i.endDate?new Date(i.endDate):null;s.add(o);let u=c&&d?{startDate:c,endDate:d}:null;const h=i.centerDate?new Date(i.centerDate):u?new Date((c.getTime()+d.getTime())/2):n.viewportCenterDateCached;let g=n.isVertical?n.scrollable.clientHeight:n.timeAxisSubGrid.width;if(g===0){const{_beforeCollapseState:f}=n.timeAxisSubGrid;if(n.isHorizontal&&n.timeAxisSubGrid.collapsed&&(f!=null&&f.width))g=f.width;else return null}return u||(u=n.calculateOptimalDateRange(h,g,o)),"width"in i&&o.setData(a,i.width),n.isZooming=!0,o.options={...i,startDate:u.startDate||n.startDate,endDate:u.endDate||n.endDate,centerDate:h},n.viewPreset=o,o.actualWidth=n.timeAxisViewModel.tickSize,n.isZooming=!1,o.setData(a,l),n.zoomLevel}zoomToFit(t){const i=this.eventStore,n=i.getTotalTimeSpan();t={leftMargin:0,rightMargin:0,...t,...n},t.startDate&&t.endDate&&(t.endDate>t.startDate?this.zoomToSpan(t):this.scrollToDate(t.startDate))}zoomToSpan(t={}){if((t.leftMargin||t.rightMargin)&&(t.adjustStart=0,t.adjustEnd=0),t.leftMargin||(t.leftMargin=0),t.rightMargin||(t.rightMargin=0),!t.startDate||!t.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const i=this,{timeAxis:n}=i,s=t.adjustStart>=0||t.adjustEnd>=0;let{startDate:a,endDate:o}=t;if(s&&(a=b.add(a,-t.adjustStart,n.mainUnit),o=b.add(o,t.adjustEnd,n.mainUnit)),a<=o){const{availableSpace:l}=i.timeAxisViewModel,c=i.presets.allRecords,d=o-a||1;let u=i.zoomLevel,h,g;u===-1&&(u=0);let f=i.getMilliSecondsPerPixelForZoomLevel(c[u],!0),m=u+(h=d/f+t.leftMargin+t.rightMargin>l?-1:1),p,v=null;for(;m>=0&&m<=c.length-1;){p=c[m],f=i.getMilliSecondsPerPixelForZoomLevel(p,!0);const R=d/f+t.leftMargin+t.rightMargin;if(h===-1){if(R<=l){v=m;break}}else if(R<=l)u!==m-h&&(v=m);else break;m+=h}v=v!=null?v:m-h,p=c[v];const y=p.bottomHeader.unit;f=i.getMilliSecondsPerPixelForZoomLevel(p,!0),(t.leftMargin||t.rightMargin)&&(a=new Date(a.getTime()-f*t.leftMargin),o=new Date(o.getTime()+f*t.rightMargin));const C=b.getDurationInUnit(a,o,y,!0)/p.bottomHeader.increment;if(C===0)return null;const D=Math.floor(l/C),S=t.centerDate||new Date((a.getTime()+o.getTime())/2);s?g={startDate:a,endDate:o}:g=i.calculateOptimalDateRange(S,l,p);let x=i.zoomLevel;return i.zoomLevel===v?n.reconfigure(g):x=i.zoomToLevel(v,Object.assign(g,{width:D,centerDate:S})),i.infiniteScroll&&i.scrollToDate(a,{block:"start"}),x}return null}zoomIn(t=1,i){typeof t=="object"&&(i=t,t=1);const n=this.zoomLevel;return n>=this.maxZoomLevel?null:this.zoomToLevel(n+t,i)}zoomOut(t=1,i){typeof t=="object"&&(i=t,t=1);const n=this.zoomLevel;return n<=this.minZoomLevel?null:this.zoomToLevel(n-t,i)}zoomInFull(t){return this.zoomToLevel(this.maxZoomLevel,t)}zoomOutFull(t){return this.zoomToLevel(this.minZoomLevel,t)}calculateOptimalDateRange(t,i,n,s){if(s)return s;const a=this,{timeAxis:o}=a,{bottomHeader:l}=n,c=a.isHorizontal?n.tickWidth:n.tickHeight;if(a.zoomKeepsOriginalTimespan)return{startDate:o.startDate,endDate:o.endDate};const d=l.unit,u=Math.ceil(i/c*l.increment*a.visibleZoomFactor/2),h=b.add(t,-u,d),g=b.add(t,u,d);return a.infiniteScroll?a.timeAxisViewModel.calculateInfiniteScrollingDateRange(t,!0):{startDate:o.floorDate(h,!1,d,l.increment),endDate:o.ceilDate(g,!1,d,l.increment)}}onElementMouseMove(t){const{isHorizontal:i,zoomContext:n}=this;super.onElementMouseMove(t),t.isTrusted&&n&&Math.abs(t[`client${i?"X":"Y"}`]-n.coordinate)>10&&(this.zoomContext=null)}async onWheel(t){if(t.ctrlKey&&!this.forceFit){t.preventDefault();const i=this,{zoomContext:n,isHorizontal:s,timelineScroller:a,zoomLevel:o}=i,l=performance.now(),c=t[`client${s?"X":"Y"}`];let d=c-a.viewport[`${s?"x":"y"}`];s&&i.rtl&&(d=a.viewport.width+a.viewport.x-c),l-i.lastWheelTime>200||!n||Math.abs(c-i.zoomContext.coordinate)>20?i.zoomContext={zoomLevel:o,coordinate:c,zoomPosition:d,zoomDate:i.getDateFromDomEvent(t)}:(o>n.zoomLevel&&(n.zoomDate=i.getDateFromDomEvent(t),n.zoomLevel=o),n.zoomPosition=d),i.lastWheelTime=l,i[`zoom${t.deltaY>0?"Out":"In"}`](void 0,i.zoomContext)}}setTimeSpan(t,i){this.timeAxis.setTimeSpan(t,i)}shift(t,i){this.timeAxis.shift(t,i)}shiftNext(t){this.timeAxis.shiftNext(t)}shiftPrevious(t){this.timeAxis.shiftPrevious(t)}get widgetClass(){}},E(r,"$name","TimelineZoomable"),E(r,"defaultConfig",{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}),r},Yp=class extends ht{static get $name(){return"RecurrenceConfirmationPopup"}static get type(){return"recurrenceconfirmation"}static get defaultConfig(){return{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:this},items:{changeSingleButton:{weight:100,cls:"b-raised",color:"b-blue",text:"L{update-only-this-btn-text}",onClick:"up.onChangeSingleButtonClick"},changeMultipleButton:{weight:200,color:"b-green",text:"L{Object.Yes}",onClick:"up.onChangeMultipleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}onRecurrenceClose(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}confirm(e={}){const r=this;return["actionType","eventRecord","title","html","changerFn","cancelFn","finalizerFn","thisObj"].forEach(t=>{t in e&&(r[t]=e[t])}),r.updatePopupContent(),super.show(e)}updatePopupContent(){const e=this,{changeMultipleButton:r,changeSingleButton:t,cancelButton:i}=e.widgetMap,{eventRecord:n,actionType:s="update"}=e;(n==null?void 0:n.isRecurring)?(r.text=e.L("L{Object.Yes}"),e.html=e.L(`${s}-all-message`)):(r.text=e.L(`${s}-further-btn-text`),e.html=e.L(`${s}-further-message`)),t.text=e.L(`${s}-only-this-btn-text`),i.text=e.L("L{Object.Cancel}"),e.width=e.L("L{width}"),e.title=e.L(`${s}-title`)}processMultipleRecords(){const{eventRecord:e,changerFn:r,thisObj:t,finalizerFn:i}=this;e.beginBatch(),r&&this.callback(r,t,[e]),e.endBatch(),i&&this.callback(i,t,[e])}processSingleRecord(){const{eventRecord:e,changerFn:r,thisObj:t,finalizerFn:i}=this;e.beginBatch();let n;e!=null&&e.isRecurring&&e.recurrence.forEachOccurrence(e.startDate,null,(s,a,o)=>{if(o>1)return n=s,!1}),n==null||n.convertToRealEvent(),e.recurrence=null,r&&this.callback(r,t,[e]),e.recurrenceRule=null,e.endBatch(),i&&this.callback(i,t,[e])}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}};Yp.initClass(),Yp._$name="RecurrenceConfirmationPopup";var _x=e=>{var r;return r=class extends(e||F){construct(t){super.construct(t),this.ion({beforeEventDropFinalize:"onRecurrableBeforeEventDropFinalize",beforeEventResizeFinalize:"onRecurrableBeforeEventResizeFinalize",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete"})}changeRecurrenceConfirmationPopup(t,i){const n=this.constructor.reconfigure(i,t,"recurrenceconfirmation");return n.owner=this,n}findRecurringEventToConfirmDelete(t){return t.find(i=>i.supportsRecurring&&(i.isRecurring||i.isOccurrence))}onRecurrableAssignmentBeforeDelete({assignmentRecords:t,context:i}){const n=t.map(a=>a.event),s=this.findRecurringEventToConfirmDelete(n);if(this.enableRecurringEvents&&s)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:s,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}}),!1}onRecurrableBeforeEventDropFinalize({context:t}){if(this.enableRecurringEvents){const{eventRecords:i}=t,n=i.filter(s=>s.supportsRecurring&&(s.isRecurring||s.isOccurrence));n.length&&(t.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:n[0],changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}))}}onRecurrableBeforeEventResizeFinalize({context:t}){if(this.enableRecurringEvents){const{eventRecord:i}=t;i.supportsRecurring&&(i.isRecurring||i.isOccurrence)&&(t.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:i,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}))}}onAssignmentChange({action:t,records:i}){var n;if(t!=="dataset"&&Array.isArray(i))for(const s of i)(n=s.event)!=null&&n.isRecurring&&!s.event.isBatchUpdating&&s.event.removeOccurrences()}getOccurrencesFor(t){return this.eventStore.getOccurrencesForTimeSpan(t,this.timeAxis.startDate,this.timeAxis.endDate)}async removeEvents(t,i=null,n=this){const s=this;if(!s.readOnly&&t.length){const a={finalize(l=!0){i&&i(l),l!==!1&&(t.some(c=>{var d;return c.isOccurrence||((d=c.event)==null?void 0:d.isOccurrence)})?t.forEach(c=>c.isOccurrenceAssignment?c.event.remove():c.remove()):(t[0].isAssignment?s.assignmentStore:s.eventStore).remove(t))}};let o;if(t[0].isAssignment?o=s.trigger("beforeAssignmentDelete",{assignmentRecords:t,context:a}):o=await s.trigger("beforeEventDelete",{eventRecords:t,context:a}),o!==!1){const l=t.find(c=>c.isRecurring||c.isOccurrence);return l?(s.recurrenceConfirmationPopup.owner=n,s.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:l,changerFn(){a.finalize(!0)},cancelFn(){a.finalize(!1)}})):a.finalize(!0),!0}}return!1}get widgetClass(){}},E(r,"$name","RecurringEvents"),E(r,"configurable",{enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}}),r},kx=e=>{var r;return r=class extends(e||F){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed"}}updateFillTicks(t){this.isConfiguring||(this.timeAxis.forceFullTicks=t&&this.snap,this.refreshWithTransition(),this.trigger("stateChange"))}changeBarMargin(t){return T.assertNumber(t,"barMargin"),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),t):t}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return this._resourceMargin==null?this.barMargin:this._resourceMargin}changeResourceMargin(t){return T.assertNumber(t,"resourceMargin"),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),t):t}updateResourceMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition())}changeTickSize(t){return T.assertNumber(t,"tickSize"),t}updateTickSize(t){this.timeAxisViewModel.tickSize=t}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","magenta","violet","indigo","blue","cyan","teal","green","gantt-green","lime","yellow","orange","deep-orange","gray","light-gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}updateEventStyle(t){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}updateEventColor(t){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}get widgetClass(){}},E(r,"configurable",{barMargin:10,fillTicks:!1,resourceMargin:null,eventColor:"green",eventStyle:"plain",tickSize:null}),r},DF={maintainVisibleStart:!0},wF={block:"nearest"},Fx=e=>class extends(e||F){static get $name(){return"TimelineScroll"}static get configurable(){return{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}}initScroll(){const t=this,{isHorizontal:i,visibleDate:n}=t;super.initScroll();const{scrollable:s}=i?t.timeAxisSubGrid:t;if(s.ion({scroll:"onTimelineScroll",thisObj:t}),t.infiniteScroll){const a=n?{...n,visibleDate:n.date}:{visibleDate:t.viewportCenterDate,block:"center"},{startDate:o,endDate:l}=t.timeAxisViewModel.calculateInfiniteScrollingDateRange(a.visibleDate,a.block==="center");t.setTimeSpan(o,l,a)}}get timelineScroller(){const t=this;return t.scrollInitialized||t.initScroll(),t._timelineScroller||(t._timelineScroller=new EF({widget:t,scrollable:t.isHorizontal?t.timeAxisSubGrid.scrollable:t.scrollable,isHorizontal:t.isHorizontal}))}doDestroy(){var t;(t=this._timelineScroller)==null||t.destroy(),super.doDestroy()}onTimelineScroll({source:t}){this.infiniteScroll&&this.checkTimeAxisScroll(t[this.isHorizontal?"x":"y"])}checkTimeAxisScroll(t){const i=this,n=i.timelineScroller,{clientSize:s}=n,a=s*i.bufferCoef,o=a*i.bufferThreshold,l=n.maxPosition,{style:c}=i.timeAxisSubGrid.virtualScrollerElement;(l-t<o||t<o)&&(c.overflow="hidden",c.pointerEvents="none",c.paddingBottom=`${w.scrollBarWidth}px`,i.setTimeout(()=>{c.overflow="",c.paddingBottom="",c.pointerEvents=""},100),i.shiftToDate(i.getDateFromCoordinate(t,null,!0,!1,!0)))}shiftToDate(t,i){const n=this.timeAxisViewModel.calculateInfiniteScrollingDateRange(t,i);this.setTimeSpan(n.startDate,n.endDate,DF)}updateInfiniteScroll(t){!this.isConfiguring&&t&&this.checkTimeAxisScroll(this.timelineScroller.position)}async scrollToDate(t,i={}){const n=this,{timeAxis:s,visibleDateRange:a,infiniteScroll:o}=n,{unit:l,increment:c}=s,d=i.edgeOffset||0,u=b.ceil(a.endDate,c+" "+l)-b.floor(a.startDate,c+" "+l),h=t>n.viewportCenterDate?1:-1,g=(o?u*n.bufferCoef*n.bufferThreshold:i.block==="center"?u/2:d?n.getMilliSecondsPerPixelForZoomLevel(n.viewPreset)*d:0)*h,f=new Date(t.getTime()+g);(f>s.endDate?1:f<s.startDate?-1:0)&&n.infiniteScroll&&(n.shiftToDate(new Date(t-g),null,!0),await n.nextAnimationFrame());const p=n.timelineScroller.viewport,v=n.getCoordinateFromDate(t,!0),y=Math.min(n.timeAxisViewModel.tickSize,n.timeAxisViewModel.availableSpace),C=n.isHorizontal?new k(n.getCoordinateFromDate(t,!1)-(n.rtl?y:0),p.y,y,p.height):new k(p.x,n.getCoordinateFromDate(t,!1),p.width,n.timeAxisViewModel.tickSize);await n.scrollToCoordinate(v,C,t,i)}scrollToNow(t={}){return this.scrollToDate(new Date,t)}async scrollToCoordinate(t,i,n,s={}){const a=this;if(t<0){const o=a.endDate-a.startDate,{unit:l,increment:c}=a.timeAxis,d=b.floor(new Date(n.getTime()-o/2),c+" "+l),u=b.add(d,o);return d-a.startDate!==0&&u-a.endDate!==0?(a.setTimeSpan(d,u),a.scrollToDate(n,s)):void 0}return await a.timelineScroller.scrollIntoView(i,s),!a.isDestroyed&&a.nextAnimationFrame()}set scrollLeft(t){this.timeAxisSubGrid.scrollable.element.scrollLeft=t}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(t){this.timeAxisSubGrid.scrollable.x=t}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(t){this.scrollable.y=t}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(t,i=!0){return this.timeAxisSubGrid.scrollable.scrollTo(t,null,i)}scrollVerticallyTo(t,i=!0){return this.scrollable.scrollTo(null,t,i)}scrollTo(t,i=!0){return this.timeAxisSubGrid.scrollable.scrollTo(t,null,i)}get widgetClass(){}},EF=class extends xr{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(e){super.onScroll(e),this._position=null}syncPartners(e){this.scrollable.syncPartners(e)}updatePosition(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable[`client${this.isHorizontal?"Width":"Height"}`]}get scrollSize(){return this.scrollable[`scroll${this.isHorizontal?"Width":"Height"}`]}get maxPosition(){return this.scrollable[`max${this.isHorizontal?"X":"Y"}`]}scrollTo(e,r){return this.isHorizontal?this.scrollable.scrollTo(e,null,r):this.scrollable.scrollTo(null,e,r)}scrollBy(e=0,r=0,t=wF){return this.isHorizontal?this.scrollable.scrollBy(e||r,0,t):this.scrollable.scrollBy(0,r||e,t)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(e){this.position=e}changeY(e){this.position=e}get x(){return this.position}set x(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get y(){return this.position}set y(e){this.scroller[this.isHorizontal?"x":"y"]=e}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}},Ox=["barMargin"],Lx=e=>class extends(e||F){static get $name(){return"TimelineState"}getState(){const t=this,i=T.copyProperties(super.getState(),t,Ox);return i.zoomLevel=t.zoomLevel,i.zoomLevelOptions={startDate:t.startDate,endDate:t.endDate,centerDate:!t.infiniteScroll||t.timeAxisViewModel.availableSpace?t.viewportCenterDate:void 0,width:t.tickSize},i}applyState(t){var i;const n=this;n.suspendRefresh(),T.copyProperties(n,t,Ox),super.applyState(t),t.zoomLevel!=null&&(n.infiniteScroll&&(i=t==null?void 0:t.scroll)!=null&&i.scrollLeft&&(t.scroll.scrollLeft={}),n.isPainted?n.zoomToLevel(t.zoomLevel,t.zoomLevelOptions):n._zoomAfterPaint={zoomLevel:t.zoomLevel,zoomLevelOptions:t.zoomLevelOptions}),n.resumeRefresh(!0)}onPaint(...t){if(super.onPaint(...t),this._zoomAfterPaint){const{zoomLevel:i,zoomLevelOptions:n}=this._zoomAfterPaint;this.zoomToLevel(i,n),delete this._zoomAfterPaint}}get widgetClass(){}},$x=class extends es{static get $name(){return"SchedulerHeader"}refreshContent(){var e;(e=this.headersElement)!=null&&e.querySelector(".b-sch-timeaxiscolumn")||super.refreshContent()}};$x._$name="Header";var qp=class extends ts{static get $name(){return"TimeAxisSubGrid"}static get type(){return"timeaxissubgrid"}static get configurable(){return{sealedColumns:!0,headerClass:$x}}startConfigure(e){const{grid:r}=e;r.timeAxisSubGrid=this,super.startConfigure(e),r.isHorizontal&&(e.header={cls:{"b-sticky-headers":r.stickyHeaders}},delete e.headerClass),"flex"in e||"width"in e||(e.flex=1)}changeScrollable(){const e=this,r=super.changeScrollable(...arguments);return r&&Object.defineProperty(r,"scrollWidth",{get(){var t,i;return(i=(t=this.element)==null?void 0:t.scrollWidth)!=null?i:0},set(){e.grid.updateCanvasSize()}}),r}handleHorizontalScroll(e=!0){this.grid._viewPresetChanging||super.handleHorizontalScroll(e)}onInternalResize(e,r,t,i,n){const s=this;if(s.isPainted&&r!==i){const a=s.grid,o=a._bodyRectangle.height;w.scrollBarWidth&&r<i&&(s.monitorResize=!1),a.onSchedulerViewportResize(r,o,i,o),s.monitorResize||s.requestAnimationFrame(()=>s.monitorResize=!0)}super.onInternalResize(...arguments)}clearWidthCache(){super.clearWidthCache(),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}async expand(){const{owner:e}=this;await super.expand(),e.isPainted&&e.timeAxisViewModel.update(this.width,!1,!0)}};qp.initClass(),qp._$name="TimeAxisSubGrid";var jx={fn:"exitTransition",delay:0,cancelOutstanding:!0},Bx=(e,r,t)=>r==null?t==null||e<t:t==null?e>=r:r<t?r<=e&&e<t:e<t||r<=e,xF=(e,r)=>Bx(e.getDay(),r.fromDay,r.toDay)&&Bx(e.getHours(),r.fromHour,r.toHour),Kp={},ns=class extends Aa.mixin(Mx,Ix,kx,Fx,Lx,Px,Ax,_x){constructor(){super(...arguments),E(this,"timeCellSelector",null)}static get $name(){return"TimelineBase"}static get type(){return"timelinebase"}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,useBackgroundCanvas:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit"}}updateTimeZone(e){this.project&&(this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=e)}get timeZone(){var e;return(e=this.project)==null?void 0:e.timeZone}populateEventMenu(){}populateScheduleMenu(){}onVisibleDateRangeChange(e){if(!this.handlingVisibleDateRangeChange){const r=this,{_visibleDateRange:t}=r;(!t||t.startDate-e.startDate||t.endDate-e.endDate)&&(r.timeView.range=e,r.handlingVisibleDateRangeChange=!0,r.trigger("visibleDateRangeChange",{old:t,new:e}),r.handlingVisibleDateRangeChange=!1,r._visibleDateRange=e)}}onVisibleResourceRangeChange(){}construct(e={}){const r=this;super.construct(e),r.$firstVerticalOverflow=!0,r.initDomEvents(),r.currentOrientation.init(),r.rowManager.ion({refresh:()=>{r.forceLayout=!1}})}createSubGrid(e,r={}){const t=this,{stickyHeaders:i}=t;return e===(t.schedulerRegion||"normal")?r.type="timeaxissubgrid":e==="locked"&&i&&t.isVertical&&(r.scrollable={overflowX:"visible",overflowY:"visible"},t.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(e,r)}doDestroy(){const e=this,{partneredWith:r,currentOrientation:t}=e;t==null||t.destroy(),r?(r.forEach(i=>{e.removePartner(i)}),r.destroy()):(e.timeAxisViewModel.destroy(),e.timeAxis.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),st.addResizeListener(this.bodyContainer,this.onBodyResize.bind(this)),this.getConfig("partner")}changeStartDate(e){return typeof e=="string"&&(e=b.parse(e)),e}onPaint({firstPaint:e}){var r,t;if(e){const i=this,n=i.isHorizontal?i.timeAxisSubGrid.scrollable:i.scrollable,s=n.element.getBoundingClientRect()[i.isHorizontal?"width":"height"];i.timeAxisViewModel.update(s,i.infiniteScroll,!0),i.infiniteScroll&&((t=(r=i.currentOrientation).doUpdateTimeView)==null||t.call(r))}super.onPaint(...arguments)}onSchedulerHorizontalScroll(e,r,t){this.currentOrientation.updateFromHorizontalScroll(t),super.onSchedulerHorizontalScroll(e,r,t)}initScroll(){const e=this;let r=0;super.initScroll(),e.ion({horizontalScroll:({subGrid:t,scrollLeft:i,scrollX:n})=>{e.isPainted&&t===e.timeAxisSubGrid&&!e.isDestroying&&!e.refreshSuspended&&e.onSchedulerHorizontalScroll(t,i,n),r++}}),e.testPerformance==="horizontal"&&e.setTimeout(()=>{const t=performance.now();let i=5,n=1;const s=e.setInterval(()=>{if(i=i+5,e.scrollX+=(10+Math.floor(i))*n,n===1&&e.scrollX>5500&&(n=-1,i=5),n===-1&&e.scrollX<=0){const l=(performance.now()-t)/r,c=Math.round(1e3/l*10)/10;clearInterval(s),console.log(e.eventPositionMode,e.eventScrollMode,c+"fps")}},0)},500)}preserveViewCenter(e,r=this,...t){const i=this,n=i.viewportCenterDate,s=e.apply(r,t),a=i.timelineScroller,{clientSize:o}=a,l=Math.max(Math.floor(i.getCoordinateFromDate(n,!0)-o/2),0);return i.scrollingToCenter=!0,a.scrollTo(l,!1).then(()=>i.scrollingToCenter=!1),s}setTimeSpan(e,r,t=Kp){const i=this,{timeAxis:n}=i,{preventThrow:s=!1,maintainVisibleStart:a=!1,visibleDate:o}=t,{startDate:l,endDate:c}=n.getAdjustedDates(e,r),d=n.startDate-l!==0,u=n.endDate-c!==0;if(d||u){if(a){const{timeAxisViewModel:g}=i,{totalSize:f}=g,m=g.tickSize,p=i.timelineScroller,v=p.position,y=g.getDateFromPosition(v);y>=l&&y<c&&g.ion({update(){const C=g.tickSize!==m;i.updateCanvasSize(),d&&!u&&!C?p.position+=g.totalSize-f:!d&&!C?p.position=v:p.position=g.getPositionFromDate(y),p.syncPartners(!0)},prio:1e4,once:!0})}const h=n.reconfigure({startDate:l,endDate:c},!1,s);return o?i.scrollToDate(o,t).then(()=>h):h}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some(e=>this.timeAxis.isTimeSpanInAxis(e))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=O.capitalize(this.scheduledEventName)),this._capitalizedEventName}set partner(e){this._partner=e,this.addPartner(e)}addPartner(e){const r=this;if(!r.isPartneredWith(e)){(r.partneredWith||(r.partneredWith=new $t)).add(e),(e.partneredWith||(e.partneredWith=new $t)).add(r),r.getConfig("viewPreset"),e.ion({presetchange:"onPartnerPresetChange",thisObj:r}),e.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:r});const i=r.partnerSharedConfigs.reduce((n,s)=>(n[s]=e[s],n),{});r.setConfig(i),r.ion({presetchange:"onPartnerPresetChange",thisObj:e}),r.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:e}),r.isPainted?(r.scrollable.addPartner(e.scrollable,r.isHorizontal?"x":"y"),e.syncPartnerSubGrids()):r.initScroll=Te.createSequence(r.initScroll,()=>{r.scrollable.addPartner(e.scrollable,r.isHorizontal?"x":"y"),e.syncPartnerSubGrids()},r)}}removePartner(e){const r=this,{partneredWith:t}=r;r.isPartneredWith(e)&&(t.remove(e),r.scrollable.removePartner(e.scrollable),r.un({presetchange:"onPartnerPresetChange",thisObj:e}),r.scrollable.un({overflowChange:"onPartnerOverflowChange",thisObj:e}),e.removePartner(r))}isPartneredWith(e){var r;return!!((r=this.partneredWith)!=null&&r.includes(e))}onPartnerOverflowChange({source:e,y:r}){const{scrollable:t}=this,i=t.hasOverflow("y");i!==r?i?e.overflowY="scroll":(e.overflowY=!0,t.overflowY="scroll",this.refreshVirtualScrollbars()):t.overflowY=!0}onPartnerPresetChange({preset:e,startDate:r,endDate:t,centerDate:i,zoomDate:n,zoomPosition:s,zoomLevel:a}){!this._viewPresetChanging&&this.viewPreset!==e&&(e.options={startDate:r,endDate:t,centerDate:i,zoomDate:n,zoomPosition:s,zoomLevel:a},this.viewPreset=e)}get partner(){return this._partner}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.allValues),e}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}changeColumns(e,r){const t=this;let i,n;if(e){const s=Array.isArray(e);let a=e;s||(a=e.data),i=a&&a.length,a.some((o,l)=>o.type==="timeAxis"?(i=l,n=T.assign(o,t.timeAxisColumn),!0):!1),t.isVertical?(a=[T.assign({type:"verticalTimeAxis"},t.verticalTimeAxisColumn),a[i]],i=1):a=a.slice(),a[i]=this._timeAxisColumn||{type:"timeAxis",cellCls:t.timeCellCls,mode:t.mode,...n},s||e.isStore&&e.owner!==this?e=a:e.data=a}return super.changeColumns(e,r)}updateColumns(e,r){if(super.updateColumns(e,r),e){const t=this,i=t._timeAxisColumn=t.columns.find(n=>n.isTimeAxisColumn);t.isVertical&&(t.verticalTimeAxisColumn=t.columns.find(n=>n.isVerticalTimeAxisColumn),t.verticalTimeAxisColumn.relayAll(t)),i.relayAll(t)}}onColumnsChanged({action:e,changes:r,record:t,records:i}){var n;const{timeAxisColumn:s,columns:a}=this;(e==="dataset"||e==="batch")&&!a.includes(s)?a.add(s,!0):t===s&&"width"in r&&this.updateCanvasSize(),t&&((n=this.partneredWith)==null||n.forEach(o=>{const l=o.columns.getAt(t.allIndex);if(l!=null&&l.shouldSync(t)){const c={};for(const d in r)c[d]=r[d].value;l.set(c)}})),super.onColumnsChanged(...arguments)}get timeView(){var e,r;const t=this;return t.columns&&t.isVertical?(e=t.verticalTimeAxisColumn)==null?void 0:e.view:(r=t.timeAxisColumn)==null?void 0:r.timeAxisView}updateEventCls(e){const r=this;r.eventSelector||(r.unreleasedEventSelector=r.eventSelector=`.${e}-wrap`),r.eventInnerSelector||(r.eventInnerSelector=`.${e}`)}set timeAxisViewModel(e){const r=this,t=r._timeAxisViewModel,i={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:r};r.partner&&!e||t&&t===e||((t==null?void 0:t.owner)===r&&t.destroy(),r.detachListeners("timeAxisViewModel"),e!=null&&e.isTimeAxisViewModel?e.ion(i):e=Up.new({mode:r._mode,snap:r.snap,forceFit:r.forceFit,timeAxis:r.timeAxis,suppressFit:r.suppressFit,internalListeners:i,owner:r},e),r.isConfiguring||(r.isHorizontal?r.timeAxisColumn.timeAxisViewModel=e:r.verticalTimeAxisColumn.view.model=e),r._timeAxisViewModel=e,r.relayEvents(e,["update"],"timeAxisViewModel"),t&&e&&r.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var e,r;return(r=(e=this._timeAxisViewModel)==null?void 0:e.suppressFit)!=null?r:this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){const r=this,t=r._timeAxis,i={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:r};r.partner&&!e||t&&t===e||(t&&t.owner===r&&t.destroy(),r.detachListeners("timeAxis"),e!=null&&e.isTimeAxis||(e=T.assign({owner:r,viewPreset:r.viewPreset,autoAdjust:r.autoAdjustTimeAxis,weekStartDay:r.weekStartDay,forceFullTicks:r.fillTicks&&r.snap},e),r.startDate&&(e.startDate=r.startDate),r.endDate&&(e.endDate=r.endDate),r.workingTime&&r.applyWorkingTime(e),e=new Gp(e)),e.ion(i),r._timeAxis=e)}onTimeAxisReconfigure({config:e,oldConfig:r}){e&&(!r||r.startDate-e.startDate||r.endDate-e.endDate)&&this.trigger("dateRangeChange",{old:{startDate:r.startDate,endDate:r.endDate},new:{startDate:e.startDate,endDate:e.endDate}}),this.trigger("timeAxisChange",{config:e})}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(e){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=e)}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){var r;const t=this,i=t._workingTime;if(i){let n=null;i.fromHour>=0&&i.fromHour<24&&i.toHour>i.fromHour&&i.toHour<=24&&i.toHour-i.fromHour<24&&(n={from:i.fromHour,to:i.toHour});let s=null;i.fromDay>=0&&i.fromDay<7&&i.toDay>i.fromDay&&i.toDay<=7&&i.toDay-i.fromDay<7&&(s={from:i.fromDay,to:i.toDay}),n||s?e.include={hour:n,day:s}:e.include=null}else e.include=null;t.isPainted&&(t.timeAxisColumn.refreshHeader(),(r=t.features.columnLines)==null||r.refresh(),t.refreshWithTransition())}updateStartDate(e){this.setStartDate(e)}setStartDate(e,r=!0){const t=this,i=t._timeAxis,{startDate:n,endDate:s,mainUnit:a}=i||Kp;if(typeof e=="string"&&(e=b.parse(e)),i&&s){if(e){let o=s;if(r&&n){const l=b.diff(n,s,a,!0);o=b.add(e,l,a)}t.setTimeSpan(e,o)}}else t._tempStartDate=e}get startDate(){var e;let r=((e=this._timeAxis)==null?void 0:e.startDate)||this._tempStartDate;if(!r){r=new Date;const{workingTime:t}=this;if(t)for(;!xF(r,t);)r.setHours(r.getHours()+1);this._tempStartDate=r}return r}changeEndDate(e){typeof e=="string"&&(e=b.parse(e)),this.setEndDate(e)}setEndDate(e,r=!1){const t=this,i=t._timeAxis,{startDate:n,endDate:s,mainUnit:a}=i||Kp;if(typeof e=="string"&&(e=b.parse(e)),i&&n){if(e){let o=n;if(r&&s){const l=b.diff(n,s,a,!0);o=b.add(e,-l,a)}t.setTimeSpan(o,e)}}else t._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||b.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}changeVisibleDate(e){if(e instanceof Date)return{date:e,block:"nearest"};if(e instanceof Object)return{date:e.date,...e}}updateVisibleDate(e){const r=this;r.infiniteScroll&&r.isConfiguring||(r.isPainted?r.scrollToDate(e.date,e):r.ion({paint:()=>r.scrollToDate(e.date,e),once:!0}))}get features(){return super.features}set features(e){e=e===!0?{}:e,"regionResize"in e||(e.regionResize=!0),super.features=e}onLocaleChange(){super.onLocaleChange();const e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}onBodyResize(e,r,{width:t,height:i}){this.isVertical&&r&&t!==r.width&&delete this.timeAxisSubGrid._width;const n=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&r&&i!==r.height&&this.onSchedulerViewportResize(n,i,n,r.height)}onSchedulerViewportResize(e,r,t,i){if(this.isPainted){const n=this,{isHorizontal:s,partneredWith:a}=n;n.currentOrientation.onViewportResize(e,r,t,i),n.updateViewModelAvailableSpace(s?e:Math.floor(r)),a&&!n.isSyncingFromPartner&&n.syncPartnerSubGrids(),n.trigger("timelineViewportResize",{width:e,height:r,oldWidth:t,oldHeight:i})}}updateViewModelAvailableSpace(e){this.timeAxisViewModel.availableSpace=e}onTimeAxisViewModelUpdate(){!this._viewPresetChanging&&!this.timeAxisSubGrid.collapsed&&(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach(e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,this.eachSubGrid(r=>{const t=e.subGrids[r.region];t.width!==r.width&&(r.collapsed?t.collapse():(t.collapsed&&t.expand(),r.flex?r.flex!==t.flex&&(t.flex=r.flex):t.width=r.width))}),e.isSyncingFromPartner=!1)})}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const r=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("id",ti.generateId("svg")),r.retainElement=!0,e.foregroundCanvas.appendChild(r),e.trigger("svgCanvasCreated",{svg:r})}return e._svgCanvas}get timeAxisSubGridElement(){var e;return this._timeAxisSubGridElement||(this.getConfig("regions"),this._timeAxisSubGridElement=(e=this.timeAxisColumn)==null?void 0:e.subGridElement),this._timeAxisSubGridElement}updateCanvasSize(){const e=this,{totalSize:r}=e.timeAxisViewModel,t=e.isHorizontal?r:e.timeAxisColumn.width;let i=!1;return e.isVertical&&(e.isPainted&&e.refreshTotalHeight(r+e._rowBorderHeight,!0),e.suppressFit&&w.setLength(e.foregroundCanvas,"height",r),i=!0),t!==e.$canvasWidth&&e.foregroundCanvas&&(e.backgroundCanvas&&w.setLength(e.backgroundCanvas,"width",t),w.setLength(e.foregroundCanvas,"width",t),e.$canvasWidth=t,i=!0),i}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}async onStoreDataChange({action:e}){var r;const t=this;t.isVisible?(e==="dataset"&&((r=t.project)!=null&&r.isRepopulatingStores)&&await t.project.await("refresh",!1),super.onStoreDataChange(...arguments)):t.whenVisible("refresh",t,[!0])}refresh(e=!0){const r=this;r.isPainted&&!r.refreshSuspended&&(r.isVertical||r.hasVisibleEvents||r.timeAxisSubGridElement.querySelector(r.eventSelector)?!r.project||r.isEngineReady?r.refreshRows(!1,e):(r.refreshAfterProjectRefresh=!0,r.currentOrientation.refreshAllWhenReady=!0):r.rowManager.trigger("refresh"))}render(){const e=this,r=e.timeAxisSubGridElement;e.useBackgroundCanvas&&(e._backgroundCanvas=w.createElement({className:"b-sch-background-canvas",parent:r,nextSibling:r.firstElementChild}));const t=e._foregroundCanvas=w.createElement({className:"b-sch-foreground-canvas",style:`font-size:${e.rowHeight-e.resourceMargin*2}px`,parent:r});e.timeAxisSubGrid.insertRowsBefore=t,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments)}refreshRows(e=!1,r=!0){const t=this;t.isConfiguring||(t.currentOrientation.refreshRows(r),super.refreshRows(e))}updateHideHeaders(e){const r=this,t=r.isPainted?r.scrollLeft:0;super.updateHideHeaders(e),r.isPainted&&(e||r.timeAxisColumn.refreshHeader(null,!0),r.nextAnimationFrame().then(()=>r.scrollLeft=t))}getCellDataFromEvent(e,r){return r&&(r=!e.target.closest(".b-sch-foreground-canvas")),super.getCellDataFromEvent(e,r)}onCellNavigate(e,r,t){var i,n;(i=t.cell)!=null&&i.classList.contains("b-timeaxis-cell")&&!((n=be.currentMouseDown)!=null&&n.target.classList.contains("b-grid-cell"))&&(this.preventDragSelect=!0),super.onCellNavigate(...arguments)}runWithTransition(e,r){const t=this;t.isVisible&&((r==null||r===!0)&&(r=t.transitionDuration),r&&t.enableEventAnimations&&(t.hasTimeout("exitTransition")||(t.isAnimating=!0),jx.delay=r,t.setTimeout(jx))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForAnimations(){!this.isEngineReady&&this.project&&await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(e,r){const t=this;!t.refreshSuspended&&t.isPainted&&(t.rowManager.topRow?t.runWithTransition(()=>t.refresh(e),r):t.rowManager.reinitialize())}get visibleDateRange(){return this.currentOrientation.visibleDateRange}isRowNumberSelecting(...e){return super.isRowNumberSelecting(...e)||e.some(r=>{var t;return r.column?r.column.isTimeAxisColumn:(t=r.cell)==null?void 0:t.closest(".b-timeaxis-cell")})}formatDuration(e,r=this.durationDisplayPrecision){const t=Math.pow(10,r);return Math.round(e*t)/t}beginListeningForBatchedUpdates(){var e;this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1,(e=this.syncSplits)==null||e.call(this,r=>r.beginListeningForBatchedUpdates())}endListeningForBatchedUpdates(){var e;this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1),(e=this.syncSplits)==null||e.call(this,r=>r.endListeningForBatchedUpdates())}onConnectedCallback(e,r){e&&!r&&(this.timeAxisSubGrid.scrollable.x+=.5)}updateRtl(e){const r=this,{isConfiguring:t}=r;let i;t||(i=r.visibleDateRange),super.updateRtl(e),t||(r.currentOrientation.clearAll(),r.infiniteScroll?(r.shiftToDate(i.startDate),r.scrollToDate(i.startDate,{block:"start"})):r.timelineScroller.position+=.5)}applyStartEndParameters(e){const r=this,t=r.eventStore.modelClass.fieldMap.startDate;r.passStartEndParameters&&(e[r.startParamName]=t.print(r.startDate),e[r.endParamName]=t.print(r.endDate))}};E(ns,"configurable",{partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null}),ns.initClass(),ne.setVersion("scheduler","5.5.0"),ns._$name="TimelineBase";var Xp=e=>class extends(e||F){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(t){if(super.construct(t),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const t=super.removeAll(...arguments);return t&&this.assignmentStore.removeAll(),t}onRecordIdChange({record:t,oldValue:i,value:n}){super.onRecordIdChange({record:t,oldValue:i,value:n}),t.isFieldModified("id")&&(this.isChangingId=!0,t.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:t,endDate:i}){return this.query(n=>this.eventStore.isDateRangeAvailable(t,i,null,n))}},gi=e=>class extends(e||F){static get $name(){return"PartOfProject"}},Zp=e=>class extends e{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image",{name:"resourceMargin",type:"number"},{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach(t=>{t.resourceId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce((t,i)=>(i.event&&t.push(i.event),t),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(t){t.forEach(i=>{i.resource=this})}getEvents(){return ne.deprecate("scheduler","6.0.0","getEvents() is deprecated, use the events property instead"),this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:t=""}=this;if(!t)return"";const i=t.split(" "),n=i[0][0],s=i.length>1?i[i.length-1][0]:"";return n+s}isWorkingTime(t){var i,n;const s=this.effectiveCalendar||((i=this.project)==null?void 0:i.calendar);return!s||((n=s.isWorkingTime)==null?void 0:n.call(s,t))}},RF=ja,Va=class extends Zp(gi(RF.derive(zi))){};E(Va,"$name","ResourceModel"),Va.exposeProperties(),Va._$name="ResourceModel";var TF=e=>class extends e{static get $name(){return"PartOfBaseProject"}get assignmentStore(){return this.project.assignmentStore}get calendarManagerStore(){return this.project.calendarManagerStore}get dependencyStore(){return this.project.dependencyStore}get eventStore(){return this.project.eventStore}get resourceStore(){return this.project.resourceStore}},MF=gi(zp.derive(bt)),zu=class extends Xp(MF){static get defaultConfig(){return{modelClass:Va}}};zu._$name="ResourceStore";var Jp=e=>{var r;return r=class extends(e||F){static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(t){if(super.construct(t),this.autoTree=!0,this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}set filtersFunction(t){super.filtersFunction=t}get filtersFunction(){const t=super.filtersFunction;return t&&t!==Te.returnTrue?i=>i.isCreating||t(i):t}getEventCounts(t){const i=this,{filtersFunction:n,added:s}=i,a=i.getEvents({...t,storeFilterFn:i.isFiltered?i.reapplyFilterOnAdd?n:o=>s.includes(o)?i.indexOf(o)>-1:n(o):null,dateMap:t.dateMap||!0});return a.forEach((o,l)=>a.set(l,o.length)),a}forEachScheduledEvent(t,i=this){this.forEach(n=>{const{startDate:s,endDate:a}=n;if(s&&a)return t.call(i,n,s,a)})}getTotalTimeSpan(){let t=new Date(9999,0,1),i=new Date(0);return this.forEach(n=>{n.startDate&&(t=b.min(n.startDate,t)),n.endDate&&(i=b.max(n.endDate,i))}),t=t<new Date(9999,0,1)?t:null,i=i>new Date(0)?i:null,this.lastTotalTimeSpan={startDate:t||null,endDate:i||t||null}}isEventPersistable(t){return t.isPersistable}isDateRangeAvailable(t,i,n,s){if(s.data.generatedParent)return!1;const a=new Set(this.getEventsForResource(s));if(n!=null&&n.isAssignment&&n.event.resources.forEach(c=>{c.id!==n.resourceId&&this.getEventsForResource(c).forEach(d=>a.add(d))}),n){const o=n.isAssignment?n.event:n;a.delete(o)}return!Array.from(a).some(o=>o.isScheduled&&b.intersectSpans(t,i,o.startDate,o.endDate))}filterEventsForResource(t,i,n=this){return t.getEvents(this).filter(i.bind(n))}getResourcesForEvent(t){return t.isOccurrence&&(t=t.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(t)}getEventsForResource(t){return this.assignmentStore.getEventsForResource(t)}getAssignmentsForEvent(t){return this.assignmentStore.getAssignmentsForEvent(t)||[]}getAssignmentsForResource(t){return this.assignmentStore.getAssignmentsForResource(t)||[]}assignEventToResource(t,i,n=!1){return this.assignmentStore.assignEventToResource(t,i,void 0,n)}unassignEventFromResource(t,i){this.assignmentStore.unassignEventFromResource(t,i)}reassignEventFromResourceToResource(t,i,n){const s=this,a=ce.asId(n),o=s.assignmentStore.getAssignmentForEventAndResource(t,i);o?o.resourceId=a:s.assignmentStore.assignEventToResource(t,n)}isEventAssignedToResource(t,i){return this.assignmentStore.isEventAssignedToResource(t,i)}removeAssignmentsForEvent(t){this.assignmentStore.removeAssignmentsForEvent(t)}removeAssignmentsForResource(t){this.assignmentStore.removeAssignmentsForResource(t)}append(t){return this.add(t)}get project(){return super.project}set project(t){var i;super.project=t,this.detachListeners("project"),t&&((i=t.assignmentStore)!=null&&i.isAssignmentStore&&this.attachToAssignmentStore(t.assignmentStore),t.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(t){this._usesSingleAssignment=t;const{assignmentStore:i}=this;i!=null&&i.isStore&&!i.hasGenerateIdOverride&&(i.modelClass.generateId=function(){return this.singleAssignmentIdCounter==null&&(this.singleAssignmentIdCounter=0),`a-${++this.singleAssignmentIdCounter}`},i.hasGenerateIdOverride=!0)}processRecords(t){var i;const{assignmentStore:n}=this,s=[];return n&&(n.skipInvalidateIndices=!0),t=super.processRecords(t,n&&!((i=this.stm)!=null&&i.isRestoring)&&(a=>{const o=a.get("resourceId");!a.reassignedFromReplace&&o!=null&&(n.includesAssignment(a.id,o)||s.push({id:n.modelClass.generateId(""),resourceId:o,eventId:a.id})),a.reassignedFromReplace=!1})||void 0),n&&(n.storage.invalidateIndices(),n.skipInvalidateIndices=!1,n.add(s)),t}joinRecordsToStore(t){const{assignmentStore:i}=this;i?(i.skipInvalidateIndices=!0,super.joinRecordsToStore(t),i.storage.invalidateIndices(),i.skipInvalidateIndices=!1):super.joinRecordsToStore(t)}processRecord(t,i=!1){var n,s,a;t=super.processRecord(t,i);const o=this,l=(s=o.assignmentStore)!=null?s:(n=o.crudManager)==null?void 0:n.assignmentStore,c=t.get("resourceId"),{resourceIds:d}=t;if(d!=null&&d.length&&t.meta.skipEnforcingSingleAssignment!==!1&&((a=o.modelClass.fieldMap)!=null&&a.resourceIds.persist))l?l.add(d.filter(u=>!l.some(h=>h.eventId===t.id&&h.resourceId===u)).map(u=>({resource:u,event:t}))):o.$processResourceIds=!0;else if(c!=null&&!t.meta.skipEnforcingSingleAssignment){const u=o.getById(t.id);if(u&&u!==t&&!i){const g=l.storage.findItem("eventId",t.id);if(g!=null&&g.size){const f=g.values().next().value;f.resource=c,t.reassignedFromReplace=!0}}else o.$processResourceIds=!0;o.usesSingleAssignment=!0}return t}processResourceIds(){var t,i,n;const s=this,a=(i=s.assignmentStore)!=null?i:(t=s.crudManager)==null?void 0:t.assignmentStore;if(s.$processResourceIds&&(a!=null&&a.isAssignmentStore)&&!((n=s.project)!=null&&n.isSharingAssignmentStore&&s.isChained)){const o=[];s.forEach(l=>{const{resourceId:c,resourceIds:d,id:u}=l;c!=null?o.push({id:a.modelClass.generateId(""),resourceId:c,eventId:u}):d!=null&&d.length&&d.forEach(h=>{o.push({id:a.modelClass.generateId(""),resourceId:h,eventId:u})})}),a.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},a.usesSingleAssignment=!1,a.verifyNoGeneratedIds=!1,a.data=o,a.usesSingleAssignment=!0,s.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:t}){var i;const n=this;if(n.removeUnassignedEvent&&!n.isRemoving&&!n.isSettingData&&!((i=n.stm)!=null&&i.isRestoring)&&!n.usesSingleAssignment&&!n.assignmentStore.isSyncingDataOnLoad&&!n.resourceStore.isSyncingDataOnLoad){const s=new Set;t.forEach(a=>{const{event:o}=a;o&&!o.isRemoved&&o.assignments.every(l=>t.includes(l))&&s.add(o)}),s.size&&n.remove([...s])}}onProjectAssignmentStoreChange({store:t}){this.attachToAssignmentStore(t)}attachToAssignmentStore(t){const i=this;i.detachListeners("assignmentStore"),t&&(i.processResourceIds(),t.ion({name:"assignmentStore",addPreCommit({records:n}){var s;!i.isSettingData&&!i.isAssigning&&(i.usesSingleAssignment?n.forEach(a=>{const{event:o}=a;o!=null&&o.isEvent&&o.resourceId!==a.resourceId&&(o.meta.isAssigning=!0,o.set("resourceId",a.resourceId),o.meta.isAssigning=!1)}):(s=i.modelClass.fieldMap)!=null&&s.resourceIds.persist&&n.forEach(a=>{var o;const{event:l}=a;if(l!=null&&l.isEvent){l.meta.isAssigning=!0;const c=(o=l.resourceIds)!=null?o:[];c.includes(a.resourceId)||(l.resourceIds=[...c,a.resourceId]),l.meta.isAssigning=!1}}))},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:n}){var s;!i.isSettingData&&!i.isAssigning&&(i.usesSingleAssignment?n.forEach(a=>{var o;(o=i.getById(a.eventId))==null||o.set("resourceId",null)}):(s=i.modelClass.fieldMap)!=null&&s.resourceIds.persist&&n.forEach(({event:a,resourceId:o})=>{const l=a.resourceIds.slice(),c=l==null?void 0:l.indexOf(o);c>=0&&(l.splice(c,1),a.resourceIds=l)}))},removeAllPreCommit(){var n;!i.isSettingData&&!i.isAssigning&&(i.usesSingleAssignment?i.allRecords.forEach(s=>s.set("resourceId",null)):(n=i.modelClass.fieldMap)!=null&&n.resourceIds.persist&&i.allRecords.forEach(s=>{s.resourceIds=[]}))},update({record:n,changes:s}){var a;if("resourceId"in s){const{event:o}=n;if(i.usesSingleAssignment)o.meta.isAssigning=!0,o.set("resourceId",s.resourceId.value),o.meta.isAssigning=!1;else if((a=i.modelClass.fieldMap)!=null&&a.resourceIds.persist){o.meta.isAssigning=!0;const l=o.resourceIds.slice(),c=l==null?void 0:l.indexOf(s.resourceId.oldValue);c>=0&&l.splice(c,1),l!=null&&l.includes(s.resourceId.value)||(l.push(s.resourceId.value),o.resourceIds=l),o.meta.isAssigning=!1}}},change({action:n,records:s}){var a;n==="dataset"&&((a=i.modelClass.fieldMap)!=null&&a.resourceIds.persist)&&s.forEach(({event:o,resourceId:l})=>{var c;const d=(c=o.resourceIds)!=null?c:[];d.includes(l)||(d.push(l),o.meta.isAssigning=!0,o.setData("resourceIds",d),o.meta.isAssigning=!1)})},thisObj:i}))}set data(t){this.isSettingData=!0,this.usesSingleAssignment&&!this.syncDataOnLoad&&!this.isChained&&this.assignmentStore.removeAll(!0),super.data=t,this.isSettingData=!1}trigger(t,i){var n;const{changes:s}=i||{};return s&&"resourceId"in s&&Object.keys(s).length===1&&!((n=this.stm)!=null&&n.isRestoring)&&(i.isAssign=!0),super.trigger(...arguments)}remove(t,...i){var n,s;const a=super.remove(t,...i);if(a.length&&this.usesSingleAssignment)for(const o of a)o.isOccurrence||(s=this.assignmentStore||((n=this.crudManager)==null?void 0:n.assignmentStore))==null||s.remove(o.assignments,!0);return a}},E(r,"$name","EventStoreMixin"),r},IF=()=>!0,PF=e=>!e.isRecurring,Wu=e=>{var r;return r=class extends e{getEvents({filter:t,date:i,startDate:n,endDate:s,startOnly:a,includeOccurrences:o,allowPartial:l,onlyAssigned:c=!1,dateMap:d=!1,dayTime:u=null,getDateIndex:h}){const g=this,f=arguments[0],{lastDateRange:m,added:p,filtersFunction:v}=g,y=t;if(c&&(f.filter=y?D=>y(D)&&D.resources.length:D=>D.resources.length),"startDate"in f||(n=f.startDate=i),"includeOccurrences"in f||(o=f.includeOccurrences=!0),"allowPartial"in f||(l=f.allowPartial=!a),f.storeFilterFn=g.isFiltered&&!f.ignoreFilters?g.reapplyFilterOnAdd?v:D=>p.includes(D)?g.indexOf(D)>-1:v(D):null,!s)if(n)s=f.endDate=b.clearTime(n),s.setDate(s.getDate()+1);else{if(o)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");f.dateFilter=IF}f.dateFilter||(a?f.dateFilter=D=>{const S=D.hasBatchedChange("startDate")?D.get("startDate"):D.startDate;return S&&!(b.clearTime(S)-n)}:l?f.dateFilter=D=>{const S=D.hasBatchedChange("startDate")?D.get("startDate"):D.startDate,x=D.hasBatchedChange("endDate")?D.get("endDate"):D.endDate||S,R=!(S-x);return S&&(R?b.betweenLesserEqual(S,n,s):b.intersectSpans(S,x,n,s))}:f.dateFilter=D=>{const S=D.hasBatchedChange("startDate")?D.get("startDate"):D.startDate,x=D.hasBatchedChange("endDate")?D.get("endDate"):D.endDate||S;return S&&S>=n&&x<=s});const C={startDate:n,endDate:s};return g.processConfiguredListeners(),g.trigger("loadDateRange",{old:m||{},new:N.clone(C),changed:!!(!m||m.startDate-C.startDate||m.endDate-C.endDate)}),g.lastDateRange=N.clone(C),d?g.getEventsAsMap(f):g.getEventsAsArray(f)}getEventsAsArray({filter:t,date:i,resourceRecord:n,startDate:s=i,endDate:a,startOnly:o,includeOccurrences:l=!0,dayTime:c=null,dateFilter:d,storeFilterFn:u,getDateIndex:h}){const g=this,f=[];if(u?g.count:g.allCount){let p=n?g.getEventsForResource(n):null;if(!n){const v=g.useDayIndex(c),y=new Set,C=o?"startDate":"date";g.recurringEvents.forEach(D=>{v.dayTime.startOfDay(D.startDate)<=s&&y.add(D)});for(const D=new Date(s);D<a;D.setDate(D.getDate()+1)){const S=v.get(h?h(D):C,D);S==null||S.forEach(x=>y.add(x))}p=[...y]}u&&(p=p.filter(u));for(let v=0,{length:y}=p;v<y;v++){const C=p[v];l&&C.isRecurring?f.push.apply(f,C.getOccurrencesForDateRange(s,a).filter(d)):d(C)&&f.push(C)}}return t?f.filter(t):f}getEventsAsMap({filter:t,date:i,resourceRecord:n,startDate:s=i,endDate:a,startOnly:o,includeOccurrences:l=!0,dateMap:c,dayTime:d=null,storeFilterFn:u,getDateIndex:h}){var g;const f=this;if(c!=null&&c.clear?c.clear():c=new Map,f.count){const m=f.useDayIndex(d),p=o?"startDate":"date",v=[],y=D=>(!t||t(D))&&(!u||u(D)),C=D=>PF(D)&&y(D);if(d=m.dayTime,n)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");(g=f.recurringEvents)==null||g.forEach(D=>{d.startOfDay(D.startDate)<a&&v.push(D)});for(const D=new Date(s);D<a;D.setDate(D.getDate()+1)){let[S,x]=m.get(h?h(D):p,D,!0);S!=null&&S.size&&(S=[...S].filter(C),S.length&&(c.get(x)||c.set(x,[]).get(x)).push(...S))}for(let D=0,{length:S}=v;D<S;D++){const x=v[D],R=(l?x.getOccurrencesForDateRange(s,a):[x]).filter(y),I=b.add(a,1,"day");for(let M,P=0,{length:_}=R;P<_;P++){const A=R[P],z=d.startOfDay(A.startDate),Y=h?h(z):o?"startDate":"date",V=Y==="startDate"||!A.durationMS?b.add(z,1,"day"):b.min(A.endDate||b.add(A.startDate,A.duration,A.durationUnit),I);for(;z<V;z.setDate(z.getDate()+1)){const U=d.dateKey(z);(M=c.get(U))||c.set(U,M=[]),M.push(A)}}}}return c}},E(r,"$name","GetEventsMixin"),r},Gu={date:"_dateIndex",startDate:"_startDateIndex"},Qp=Object.values(Gu),Hx=Object.freeze([]),{MILLIS_PER_DAY:Vx}=gt,Uu=class{constructor(e,r){this.dayTime=r||gt.MIDNIGHT,this.store=e,this.users=[this.dayTime]}add(e,r,t){const i=this[Gu[e]],n=this.dayTime.dateKey(r);(i[n]||(i[n]=new Set)).add(t)}addEvent(e){var r,t,i;let n=(r=this.dayTime.startOfDay(e.startDate))==null?void 0:r.getTime(),s;if(n){s=(i=(t=e.endDate)==null?void 0:t.getTime())!=null?i:n,this.add("startDate",n,e);do this.add("date",n,e),n+=Vx;while(n<s)}}clear(){Qp.forEach(e=>this[e]=Object.create(null))}get(e,r,t){!this.initialized&&this.initialize();let i=this[Gu[e]],n;return r&&(n=this.dayTime.dateKey(r),i=t?[i[n],n]:i[n]),i}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,Qp.forEach(e=>this[e]=null)}matches(e){return this.dayTime.startShift===e.startShift}remove(e,r,t){const i=this[Gu[e]],n=this.dayTime.dateKey(r),s=i[n];s&&s.delete(t)}removeEvent(e,r,t){var i,n;let s=(i=this.dayTime.startOfDay(r))==null?void 0:i.getTime(),a;if(s){a=(n=t==null?void 0:t.getTime())!=null?n:s,this.remove("startDate",s,e);do this.remove("date",s,e),s+=Vx;while(s<a)}}sync(e,r,t,i,n){var s,a;r=r||Hx,t=t||Hx;const o=this,l=r.length,c=t.length,d=i==null?void 0:i.length;let u,h,g;if(o.initialized)switch(e){case"clear":o.clear();break;case"splice":if(d)for(r=r.slice(),t=t.slice(),u=0;u<d;u++)t.push(i[u][0]),r.push(i[u][1]);if(c)for(u=0;u<c;u++)g=t[u],o.removeEvent(g,g.startDate,g.endDate);if(l)for(u=0;u<l;u++)h=r[u],h.isScheduled&&!h.isParent&&o.addEvent(h);break;case"reschedule":g=r[0],o.removeEvent(g,((s=n.startDate)==null?void 0:s.oldValue)||g.startDate,((a=n.endDate)==null?void 0:a.oldValue)||g.endDate),o.sync("splice",r);break}}register(e){this.users.push(e)}unregister(e){const{users:r}=this,t=r.indexOf(e);return t>-1&&r.splice(t,1),!r.length}},Nx=Uu.prototype;Qp.forEach(e=>Nx[e]=null),Nx.initialized=!1,Uu._$name="EventDayIndex";var{MIDNIGHT:zx}=gt,ev=e=>{var r;return r=class extends e{construct(t){super.construct(t),this.dayIndices=null}afterLoadData(){var t;this.syncIndices("splice",this.storage.allValues),(t=super.afterLoadData)==null||t.call(this)}onDataChange({action:t,added:i,removed:n,replaced:s}){this.syncIndices(t,i,n,s),super.onDataChange(...arguments)}onDataReplaced(t,i){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(t,i)}onModelChange(t,i,n,s,a){("startDate"in n||"endDate"in n)&&this.syncIndices("reschedule",[t],null,null,n),super.onModelChange(...arguments)}invalidateDayIndices(){var t;(t=this.dayIndices)==null||t.forEach(i=>i.invalidate())}registerDayIndex(t){const i=this,n=i.dayIndices||(i.dayIndices=[]);let s,a;for(a=0;!s&&a<n.length;++a)n[a].matches(t)&&(s=n[a]).register(t);return!s&&n.push(s=new Uu(i,t)),s}syncIndices(...t){var i;(i=this.dayIndices)==null||i.forEach(n=>n.sync(...t))}unregisterDayIndex(t){const i=this,{dayIndices:n}=i;for(let s=n==null?void 0:n.length;s-- >0;)if(n[s].matches(t)){n[s].unregister(t)&&n.splice(s,1);break}}useDayIndex(t){const i=this,{dayIndices:n}=i;t=t||zx;for(let s=0;n&&s<n.length;++s)if(n[s].matches(t))return n[s];if(t.startShift)throw new Error(`No day index registered for ${t} on ${i.id}`);return i.registerDayIndex(zx)}},E(r,"$name","DayIndexMixin"),r},Wx=Object.freeze([]),tv=e=>class extends(e||F){static get $name(){return"RecurringTimeSpansMixin"}construct(...t){const i=this;i.globalOccurrences=new Map,i.recurringEvents=new Set,super.construct(...t)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:t,added:i,removed:n,replaced:s}){this.refreshRecurringEventsCache(t,i,n,s),super.onDataChange(...arguments)}refreshRecurringEventsCache(t,i=Wx,n=Wx,s){const a=this,{recurringEvents:o}=a,l=s==null?void 0:s.length;switch(t){case"clear":o.clear();break;case"splice":{if(l){i=i.slice(),n=n.slice();for(let u=0;u<l;u++)n.push(s[u][0]),i.push(s[u][1])}const c=i.length,d=n.length;if(d&&o.size)for(let u=0;u<d;u++)o.delete(n[u]);if(c)for(let u=0;u<c;u++){const h=i[u];h.isRecurring&&o.add(h)}break}}}getById(t){let i=super.getById(t);return i||(i=this.globalOccurrences.get(this.modelClass.asId(t))),i}onModelChange(t,i,n,s,a){const o=!s&&this.isRecurrenceRelatedFieldChange(t,n);if(o&&t.removeOccurrences(),super.onModelChange(...arguments),o){const l={action:"batch",records:this.storage.values};this.trigger("refresh",l),this.trigger("change",l)}}isRecurrenceRelatedFieldChange(t,i){return t.isRecurring||"recurrenceRule"in i}getOccurrencesForTimeSpan(t,i,n){const s=[];return t.isRecurring&&t.recurrence.forEachOccurrence(i,n,a=>s.push(a)),s}set data(t){this.globalOccurrences.clear(),super.data=t}getRecurringTimeSpans(){return[...this.recurringEvents]}},rv=e=>class extends tv(e||F){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(t){return super.isEventPersistable(t)&&(!t.supportsRecurring||!t.isOccurrence)}},AF=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,Gx=["SU","MO","TU","WE","TH","FR","SA"],Gt=class extends F{static decodeDay(e){let r,t;return(r=AF.exec(e))&&(t=[Gx.indexOf(r[2])],r[1]&&(r[1]=parseInt(r[1],10),t.push(r[1]))),t}static encodeDay(e){let r;return Array.isArray(e)&&([e,r]=e),(r?r.toString():"")+Gx[e]}static decode(e){const r=[];let t;if(e)for(let i=0;i<e.length;i++)(t=this.decodeDay(e[i]))&&r.push(t);return r}static encode(e){const r=[];let t;if(e)for(let i=0;i<e.length;i++)(t=this.encodeDay(e[i]))&&r.push(t);return r}};Gt._$name="RecurrenceDayRuleEncoder";var _F=/ly$/i,iv=e=>{const r=e.replace(_F,"");return r==="DAI"?"DAY":r},kF=(e,r,t,i)=>i.buildOccurrence(e,t),FF=e=>nv=e,nv,fi=class extends F{static processIterationConfig(e){const{recurrence:r}=e,{frequency:t,interval:i,timeSpan:n,endDate:s,count:a}=r;if(!e.syncingStartDate&&!n.meta.isSyncedWithRule){const u=b.add(n.startDate,i,iv(t)),h=b.min(u,e.endDate||u);this.forEachDate({syncingStartDate:!0,startDate:n.startDate,endDate:h,recurrence:r,fn:kF})}const o=n.startDate;let{startDate:l=o,endDate:c=s}=e;l<o&&(l=o),s?(!c||c>s)&&(c=s):a&&l>o&&(this.forEachDate({recurrence:r,fn:FF}),(!c||c>nv)&&(c=new Date(nv.getTime()+1)));const d=l;return e.startOnly||(l=new Date(b.max(b.add(l,-i,iv(t)),o))),Object.assign({extraArgs:[],startOnly:!n.durationMS},e,{startDate:l,endDate:c,timeSpan:n,timeSpanStart:o,earliestVisibleDate:d,endDateMS:c==null?void 0:c.getTime(),timeSpanStartMS:o.getTime(),earliestVisibleDateMS:d.getTime(),durationMS:n.durationMS,spansStart:l<=o&&c>o})}static getOccurrenceIndex(e){if(e.isOccurrence)return b.diff(e.recurringTimeSpan.startDate,e.startDate,iv(e.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(e,r,t,i){let n,s,a;if(i){i>0?(s=1,a=e):(s=-1,a=r);const o=t-a.getDay();s*o<0&&(i+=s),n=new Date(a),n.setDate(a.getDate()+(i-s)*7+o),(n<e||n>r)&&(n=null)}return n}static buildDate(e,r,t){const i=new Date(e,r,t);if(i.getFullYear()===e&&i.getMonth()===r&&i.getDate()===t)return i}static isValidPosition(e){return!!e}static forEachDateAtPositions(e,r,t,i){const n=e.length,s={};for(let a=0;a<r.length;a++){const o=r[a];if(this.isValidPosition(o)){const l=o>0?e[o-1]:e[n+o];if(l&&!s[l.getTime()]&&(s[l.getTime()]=!0,t.call(i,l)===!1))return!1}}}static isInView(e,r,t,i,n){return(e?r>=t:r.valueOf()+i>t)&&!n.hasException(r)}static isInViewMS(e,r,t,i,n,s){return(e?t>=i:t+n>i)&&!s.hasException(r)}};E(fi,"frequency","NONE"),E(fi,"MAX_OCCURRENCES_COUNT",1e6),fi._$name="AbstractRecurrenceIterator";var Yu=class extends fi{static forEachDate(e){const{startOnly:r,startDate:t,endDate:i,endDateMS:n,timeSpan:s,timeSpanStart:a,earliestVisibleDateMS:o,durationMS:l,spansStart:c,recurrence:d,fn:u,extraArgs:h,scope:g=this}=this.processIterationConfig(e),{interval:f}=d,m=t-a,p=f*864e5,v=Math.floor(m/p);let{count:y}=d,C=0,D=b.add(a,v*f,"day"),S=D.getTime();for(!i&&!y&&(y=this.MAX_OCCURRENCES_COUNT);!n||S<n;){const x=this.isInViewMS(r,D,S,o,l,s);if(C++,x&&(n&&S>n||u.apply(g,[D,C,C===1&&c,s,...h])===!1||y&&C>=y))break;D=b.add(D,f,"day"),S=D.getTime()}}};E(Yu,"frequency","DAILY"),Yu._$name="DailyRecurrenceIterator";var qu=class extends fi{static forEachDate(e){const{startOnly:r,startDate:t,endDateMS:i,timeSpan:n,timeSpanStart:s,timeSpanStartMS:a,earliestVisibleDateMS:o,durationMS:l,spansStart:c,recurrence:d,fn:u,extraArgs:h,scope:g=this}=this.processIterationConfig(e),{interval:f,days:m}=d,{weekStartDay:p}=b,v=s.getHours(),y=s.getMinutes(),C=s.getSeconds(),D=s.getMilliseconds();let S=0,{count:x}=d,R=Gt.decode(m),I,M;if(R!=null&&R.length||(R=[[s.getDay()]]),p>0)for(let P=0;P<R.length;P++)p>R[P][0]?R[P][0]=7-p-R[P][0]:R[P][0]-=p;for(R.sort((P,_)=>P[0]-_[0]),I=b.getNext(x||f>1?s:t,"week",0),!i&&!x&&(x=this.MAX_OCCURRENCES_COUNT);!i||I.getTime()<i;){for(let P=0;P<R.length;P++){M=new Date(I.getFullYear(),I.getMonth(),I.getDate()+R[P][0],v,y,C,D);const _=M.getTime();if(_>=a){const A=this.isInViewMS(r,M,_,o,l,n);if(S++,A&&(i&&_>=i||u.apply(g,[M,S,S===1&&c,n,...h])===!1||x&&S>=x))return}}I=b.getNext(I,"week",f)}}};E(qu,"frequency","WEEKLY"),qu._$name="WeeklyRecurrenceIterator";var Ku=class extends fi{static getNthDayOfMonth(e,r){const t=b.daysInMonth(e);let i=null;return r&&Math.abs(r)<=t&&(i=new Date(e.getFullYear(),e.getMonth(),r<0?t+r+1:r)),i}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const{startOnly:r,startDate:t,endDate:i,timeSpan:n,timeSpanStart:s,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:f,count:m,positions:p}=c,v=Gt.decode(f),y=p&&p.length,C={};let{monthDays:D}=c,S=0,x,R,I,M,P,_;for(R=b.startOf(m||g>1?s:t,"month"),I=new Date(b.getNext(R,"month",1)-1),!(D&&D.length)&&!(v&&v.length)&&(D=[s.getDate()]),v&&v.length&&v.forEach(A=>{A[1]&&(x=x||{},x[A[0]]=A[1])});(!i||i>R)&&(!m||S<m);){if(M=[],v&&v.length){if(v.forEach(A=>{const z=A[0];let Y=1,V=53;for(A[1]&&(Y=V=A[1]),_=Y;_<=V;_++)(P=this.getNthDayInPeriod(R,I,z,_))&&(P=b.copyTimeValues(P,s),C[P.getTime()]||(C[P.getTime()]=!0,M.push(P)))}),M.sort((A,z)=>A-z),!y){for(_=0;_<M.length;_++)if(P=M[_],P>=s){const A=this.isInView(r,P,a,o,n);if(S++,A&&(i&&P>=i||d.apply(h,[P,S,S===1&&l,n,...u])===!1||m&&S>=m))return!1}}}else{const A=[];for(_=0;_<D.length;_++)(P=this.getNthDayOfMonth(R,D[_]))&&!C[P.getTime()]&&(C[P.getTime()]=!0,A.push(P));for(A.sort((z,Y)=>z-Y),_=0;_<A.length;_++)if(P=b.copyTimeValues(A[_],s),y)M.push(P);else if(P>=s){const z=this.isInView(r,P,a,o,n);if(S++,z&&(i&&P>i||d.apply(h,[P,S,S===1&&l,n,...u])===!1||m&&S>=m))return}}y&&M.length&&this.forEachDateAtPositions(M,p,A=>{if(A>=s){const z=r?A>=a:A.valueOf()+o>a&&!n.hasException(A);if(S++,z&&(!i||A<=i)&&(d.apply(h,[A,S,S===1&&l,n,...u])===!1||m&&S>=m))return!1}}),R=b.getNext(R,"month",g),I=new Date(b.getNext(R,"month",1)-1)}}};E(Ku,"frequency","MONTHLY"),Ku._$name="MonthlyRecurrenceIterator";var Xu=class extends fi{static forEachDate(e){const{startOnly:r,startDate:t,endDate:i,timeSpan:n,timeSpanStart:s,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:f,count:m,positions:p}=c,v=Gt.decode(f),y=p&&p.length,C={};let{months:D}=c,S=0,x,R,I,M,P,_;for(M=b.startOf(m||g>1?s:t,"year"),P=new Date(b.getNext(M,"year",1)-1),D&&D.sort((A,z)=>A-z),!(D&&D.length)&&!(v&&v.length)&&(D=[s.getMonth()+1]),v&&v.length&&v.forEach(A=>{A[1]&&(_=_||{},_[A[0]]=A[1])});(!i||i>M)&&(!m||S<m);){if(I=[],v&&v.length){if(v.forEach(A=>{const z=A[0];let Y=1,V=53;for(A[1]&&(Y=V=A[1]),x=Y;x<=V;x++)(R=this.getNthDayInPeriod(M,P,z,x))&&(R=b.copyTimeValues(R,s),C[R.getTime()]||(C[R.getTime()]=!0,I.push(R)))}),I.sort((A,z)=>A-z),!y){for(x=0;x<I.length;x++)if(R=I[x],R>=s){const A=this.isInView(r,R,a,o,n);if(S++,A&&(i&&R>=i||d.apply(h,[R,S,S===1&&l,n,...u])===!1||m&&S>=m))return}}}else for(x=0;x<D.length;x++)if((R=this.buildDate(M.getFullYear(),D[x]-1,s.getDate()))&&(R=b.copyTimeValues(R,s),!C[R.getTime()])){if(C[R.getTime()]=!0,y)I.push(R);else if(R>=s){const A=r?R>=a:R.valueOf()+o>a&&!n.hasException(R);if(S++,A&&(i&&R>=i||d.apply(h,[R,S,S===1&&l,n,...u])===!1||m&&S>=m))return}}y&&I.length&&this.forEachDateAtPositions(I,p,A=>{if(A>=s){const z=r?A>=a:A.valueOf()+o>a&&!n.hasException(A);if(S++,z&&(!i||A<i)&&(d.apply(h,[A,S,S===1&&l,n,...u])===!1||m&&S>=m))return!1}}),M=b.getNext(M,"year",g),P=new Date(b.getNext(M,"year",1)-1)}}};E(Xu,"frequency","YEARLY"),Xu._$name="YearlyRecurrenceIterator";var Ux={};[Yu,qu,Ku,Xu].forEach(e=>{Ux[e.frequency]=e});function sv(e){return e?typeof e=="string"&&(e=e.split(",").map(r=>parseInt(r,10))):e=null,e}function OF(e){return e?typeof e=="string"&&(e=e.split(",")):e=null,e}function Zu(e,r){return String(e)===String(r)}function Yx(e){return this.defaultValue&&e===void 0?this.defaultValue:this.allowNull&&e==null?null:(e=parseInt(e),isNaN(e)?void 0:e)}var av=class extends ce{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:Yx},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:Yx},{name:"days",convert:OF,isEqual:Zu},{name:"monthDays",convert:sv,isEqual:Zu},{name:"months",convert:sv,isEqual:Zu},{name:"positions",convert:sv,isEqual:Zu}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return Ux[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const e=this,r=[];return e.frequency&&(r.push(`FREQ=${e.frequency}`),e.interval>1&&r.push(`INTERVAL=${e.interval}`),e.days&&e.days.length&&r.push("BYDAY="+e.days.join(",")),e.monthDays&&e.monthDays.length&&r.push("BYMONTHDAY="+e.monthDays.join(",")),e.months&&e.months.length&&r.push("BYMONTH="+e.months.join(",")),e.count&&r.push(`COUNT=${e.count}`),e.endDate&&r.push("UNTIL="+b.format(e.endDate,e.dateFormat)),e.positions&&e.positions.length&&r.push("BYSETPOS="+e.positions.join(","))),r.join(";")}set rule(e){const r=this,t={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(r.beginBatch(),e){const i=e.split(";");for(let n=0,s=i.length;n<s;n++){const a=i[n].split("="),o=a[1];switch(a[0]){case"FREQ":t.frequency=o;break;case"INTERVAL":t.interval=o;break;case"COUNT":t.count=o,t.until=null;break;case"UNTIL":o?t.endDate=b.parse(o,r.dateFormat):t.endDate=null,t.count=null;break;case"BYDAY":t.days=o;break;case"BYMONTHDAY":t.monthDays=o;break;case"BYMONTH":t.months=o;break;case"BYSETPOS":t.positions=o;break}}}r.set(t),e&&r.sanitize(),r.endBatch()}construct(e={}){const r=this,{rule:t,timeSpan:i}=e;r._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),t&&(r.suspendTimeSpanNotifying(),r.rule=t,r.resumeTimeSpanNotifying()),r.timeSpan=i}forEachOccurrence(e,r,t){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:r,fn(i,n,s,a){return t(a.buildOccurrence(i,s),s,n,i)}})}sanitize(){var e,r;const t=this,i=(e=t.timeSpan)==null?void 0:e.startDate,n={};switch(t.isSanitizing=!0,t.frequency){case"DAILY":n.positions=null,n.days=null,n.monthDays=null,n.months=null;break;case"WEEKLY":{n.positions=null,n.monthDays=null,n.months=null;const{days:s}=t;i&&(s==null?void 0:s.length)===1&&s[0]===Gt.encodeDay(i.getDay())&&(n.days=null);break}case"MONTHLY":{(r=t.monthDays)!=null&&r.length&&(n.positions=null,n.days=null),n.months=null;const{monthDays:s}=t;i&&(s==null?void 0:s.length)===1&&s[0]===i.getDate()&&(n.monthDays=null);break}case"YEARLY":{n.monthDays=null;const{months:s}=t;i&&(s==null?void 0:s.length)===1&&s[0]===i.getMonth()+1&&(n.months=null);break}}t.set(n),t.isSanitizing=!1}copy(...e){const r=super.copy(...e);return r.dateFormat=this.dateFormat,r.timeSpan=this.timeSpan,r}afterChange(e,r,t){const i=super.afterChange(e,r,t),{timeSpan:n}=this;return this.isSanitizing||this.sanitize(),n&&(n.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||n.onRecurrenceChanged()),i}set(e,r,...t){const i=typeof e=="object"?e:{[e]:r};i.count?i.endDate=null:i.endDate&&(i.count=null),super.set(i,void 0,...t)}get isTimeSpanNotifyingSuspended(){return!!this._suspendedTimeSpanNotifying}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}};av._$name="RecurrenceModel";function LF(e){const r={},{dateFormat:t}=this;return e&&(e=typeof e=="string"?e.split(","):H.asArray(e),e.forEach(i=>{typeof i=="string"&&(i=b.parse(i,t)),isNaN(i)||(r[b.makeKey(i)]=1)})),r}function $F(e){const r=[],{dateFormat:t}=this;for(const i in e)e[i]&&r.push(b.format(b.parseKey(i),t));return r}var jF=[],Ju=e=>class extends(e||St){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:LF,serialize:$F,internal:!0}]}remove(){if(this.isOccurrence){const t=this,{recurringTimeSpan:i}=t;t.cancelBatch(),i.beginBatch(),t.detachFromRecurringEvent(),i.endBatch()}else return super.remove(...arguments)}get eventStore(){var t;let i=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!i&&((t=this.firstStore)!=null&&t.isRecurringTimeSpansMixin)&&(i=this.firstStore),i}get recurrenceModel(){return this._recurrenceModel||av}set recurrenceModel(t){this._recurrenceModel=t}setRecurrence(t,i,n){const s=this;let a;t&&(t.isRecurrenceModel||(typeof t=="string"&&(t={frequency:t},i&&(t.interval=i),n&&(n instanceof Date?t.endDate=n:t.count=n)),t=new s.recurrenceModel(t)),t.timeSpan=s,a=t.rule),s.recurrence=t,s.recurrenceRule=a}get recurrence(){const t=this,i=t.recurrenceRule;return!t._recurrence&&i&&(t._recurrence=new t.recurrenceModel({rule:i,timeSpan:t,id:`${t.id}-recurrence`})),t._recurrence}set recurrence(t){const i=this;i._recurrence=t,t?(t.timeSpan=i,i.recurrenceRule=t.rule):i.isOccurrence?i.setData("recurrenceRule",null):i.recurrenceRule=null}get isRecurring(){return!!(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return!!this.recurringTimeSpan}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(t){this._recurringTimeSpan=t}getOccurrencesForDateRange(t,i=t){return this.eventStore.getOccurrencesForTimeSpan(this,t,i)}get occurrences(){if(this.isRecurring){const t=[];return this.occurrenceMap.forEach(i=>{i!==this&&t.push(i)}),t}return jF}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(t){var i;const n=t.isTimeSpan?t.occurrenceDate:t;(i=this.eventStore)==null||i.globalOccurrences.delete(this.createRecurrenceKey(n)),this.occurrenceMap.delete(b.makeKey(n))}removeOccurrencesFrom(t){this.occurrenceMap.forEach((i,n)=>{b.parseKey(n)>=t&&this.removeOccurrence(i)})}removeOccurrences(){[this,...this.occurrences].forEach(t=>this.removeOccurrence(t))}onRecurrenceChanged(){var t;this.recurrenceRule=((t=this.recurrence)==null?void 0:t.rule)||null}sanitizeRecurrenceData(t=this.recurrence){if(t.endDate){const i=b.clearTime(t.endDate),{exceptionDates:n}=this;if(this.removeOccurrencesFrom(i),n)for(const s in n)b.parseKey(s)>=i&&delete n[s]}}get occurrenceDate(){var t;return((t=this.meta.modified)==null?void 0:t.startDate)||this.startDate}get occurrenceIndex(){return fi.getOccurrenceIndex(this)}buildOccurrence(t,i){var n;const s=this,{occurrenceMap:a,recurrence:o,meta:l}=s,c=(n=s.eventStore)==null?void 0:n.globalOccurrences,d=b.makeKey(t),u=s.createRecurrenceKey(t,d),h=!(t-s.startDate),{fieldMap:g}=s.constructor;let f=c==null?void 0:c.get(u),{duration:m}=s;s.endDate&&(s.allDay||!m)&&(m=b.as(s.durationUnit,s.endDate.getTime()-s.startDate.getTime()));const p=m!==void 0?b.add(t,m,s.durationUnit):void 0;return f||(i||h?(f=s,h||(s.setStartEndDate(t,p,!0),o.suspendTimeSpanNotifying(),o.sanitize(),o.resumeTimeSpanNotifying()),l.isSyncedWithRule=!0):(f=s.copy({[g.id.dataSource]:u,[g.startDate.dataSource]:t,[g.endDate.dataSource]:p,[g.duration.dataSource]:m,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),f.recurringTimeSpan=s),c==null||c.set(u,f),a.set(d,f)),f}createRecurrenceKey(t=this.startDate,i=null){return`_generated:${this.id}:${i||b.makeKey(t)}`}convertToRealEvent(t,i){var n;if(!this.isOccurrence)return;const s=this,{recurringTimeSpan:a,resource:o,occurrenceIndex:l,recurrence:c}=s,d=c&&a.recurrence.count,u=((n=t==null?void 0:t.resourceRecords)==null?void 0:n.value)||s.data.newResource;a.beginBatch(),s.detachFromRecurringEvent(),s.clearChanges(),s.setData("id",s.generateId(a.eventStore)),u&&delete s.data.resourceId,a.eventStore.add(s,i),d&&(s.recurrence.count=d-l),(u||o)&&s.assign(u||o),u&&delete s.data.resourceRecords,t&&delete t.resourceRecords,a.endBatch()}afterChange(t,i,n,...s){const a=this,{eventStore:o}=a;return"recurrenceRule"in i&&(a._recurrence=null,o==null||o.recurringEvents[i.recurrenceRule.value?"add":"delete"](a)),a.isOccurrence?a.convertToRealEvent(i,n):"newExceptionDate"in i&&(a.meta.modified.exceptionDates=!0,delete a.meta.modified.newExceptionDate,a.removeOccurrence(i.newExceptionDate.value)),super.afterChange(t,i,n,...s)}detachFromRecurringEvent(){const t=this,{recurringTimeSpan:i,occurrenceDate:n,startDate:s}=t;t.recurringTimeSpan=null,i.addExceptionDate(n),t.recurrenceRule&&(i.recurrence.endDate=b.add(s,-1,"minute"))}set newExceptionDate(t){if(t){const i=this.exceptionDates||(this.exceptionDates={});i[b.makeKey(t)]=1}}addExceptionDate(t){return this.set({newExceptionDate:t})}hasException(t){var i;return(i=this.exceptionDates)==null?void 0:i[b.makeKey(t)]}},BF=1e3*60*60*24,Qu=e=>class extends e{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resourceIds",type:"array",persist:!1,internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0,useProp:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach(t=>{t.eventId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentEventIds()}get resources(){return this.assignments.reduce((t,{resource:i})=>(i&&t.push(i.$original),t),[])}set resources(t){var i;t=H.asArray(t);const n=this,s=t.map(n.constructor.asId);if(n.usesSingleAssignment)n.set("resourceId",s[0]);else if((i=n.fieldMap)!=null&&i.resourceIds.persist)n.resourceIds=s;else{const a=n.assignments.map(c=>c.resource.id),{onlyInA:o,onlyInB:l}=H.delta(s,a);n.assignmentStore.add(o.map(c=>({resource:c,event:n}))),n.assignmentStore.remove(l.map(c=>n.assignments.find(d=>d.resource.id===c)))}}forEachResource(t,i=this){for(const n of this.resources)if(t.call(i,n)===!1)return}getResource(t){return t==null?this.resource:this.resourceStore?this.resourceStore.getById(t):null}get startDate(){var t;let i;return this.isOccurrence?i=this.get("startDate"):i=(t=this._startDate)!=null?t:super.startDate,this.allDay&&(i=this.constructor.getAllDayStartDate(i)),i}set startDate(t){this.batching?(this._startDate=t,this.set({startDate:t})):super.startDate=t}get endDate(){var t;let i;return this.isOccurrence?i=this.get("endDate"):i=(t=this._endDate)!=null?t:super.endDate,this.allDay&&(i=this.constructor.getAllDayEndDate(i)),i}set endDate(t){this.batching?(this._endDate=t,this.set({endDate:t})):super.endDate=t}get wrapStartDate(){return this.startDate}set wrapStartDate(t){}get wrapEndDate(){return this.endDate}set wrapEndDate(t){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(){const t=this,{isPersistable:i,meta:{batchChanges:n}}=t;if(n&&("endDate"in n&&(delete t._endDate,t.postamble&&(t.wrapEndDate=null)),"startDate"in n&&(delete t._startDate,t.preamble&&(t.wrapStartDate=null))),super.endBatch(...arguments),t.isPersistable&&!i&&!t.ignoreBag&&t.assigned)for(const s of t.assigned)s.stores.forEach(a=>a.updateModifiedBagForRecord(s))}get isCreating(){return super.isCreating}set isCreating(t){var i,n;super.isCreating=t,(i=this.assignmentStore)==null||i.suspendAutoCommit(),this.assignments.forEach(s=>s.isCreating=t),(n=this.assignmentStore)==null||n.resumeAutoCommit()}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...t){const i=super.copy(...t);return this.usesSingleAssignment||(i.resourceId=null),i}get persistableData(){const t=super.persistableData;return this.usesSingleAssignment||delete t.resourceId,t}get resource(){const{resources:t}=this;return t.length?t[0]:null}set resource(t){this.resourceId=this.constructor.asId(t)}get resourceId(){var t;return this.usesSingleAssignment?this.get("resourceId"):(t=this.resource)==null?void 0:t.id}set resourceId(t){this.applyResourceId(t)}get resourceIds(){var t,i,n;return(t=this.fieldMap)!=null&&t.resourceIds.persist?this.get("resourceIds"):(n=(i=this.resources)==null?void 0:i.map(s=>s.id))!=null?n:[]}set resourceIds(t){this.set("resourceIds",t)}get $linkedResources(){var t,i;return(i=(t=this.resources)==null?void 0:t.flatMap(n=>[n,...n.$links]))!=null?i:[]}applyResourceId(t,i=!1){var n,s;const a=this,{eventStore:o,assignments:l}=a;if(o){const c=o.assignmentStore||((n=o.crudManager)==null?void 0:n.assignmentStore);if(t!=null)if(a.meta.skipEnforcingSingleAssignment||(o.usesSingleAssignment=!0),l!=null&&l.length&&t!==l[0].resourceId){const d=!!o.eventsSuspended;d&&c.suspendEvents(),l[0].resource=t,d&&c.resumeEvents()}else c.assignEventToResource(a,t);else(a.usesSingleAssignment||(s=a.resourceIds)!=null&&s.length)&&c.remove(l)}else i||a.set({resourceId:t})}applyResourceIds(t,i=!1){var n;const s=this,{eventStore:a,assignments:o}=s;if(s.fieldMap.resourceIds.persist===!1)return!1;if(t=[...new Set(t)],a){const l=a.assignmentStore||((n=a.crudManager)==null?void 0:n.assignmentStore);if(t!=null&&t.length)if(o!=null&&o.length){const c=!!a.eventsSuspended;c&&l.suspendEvents(),o.forEach(h=>{const g=t.find(f=>!o.some(m=>m.resourceId===f));g&&(h.resource=g)});const{onlyInA:d,onlyInB:u}=H.delta(t,o.map(h=>h.resourceId));l.add(d.map(h=>({resource:h,event:s}))),l.remove(u.map(h=>o.find(g=>g.resource.id===h))),c&&l.resumeEvents()}else l.add(t.map(c=>({resource:c,event:s})));else l.remove(o)}else i||s.set({resourceIds:t})}applyValue(t,i,n,s,a){if(a&&!this.meta.isAssigning){const{eventStore:o}=this;switch(a.name){case"resourceId":o&&(o.isAssigning=!0),this.applyResourceId(n,!0);break;case"resourceIds":o&&(o.isAssigning=!0),this.applyResourceIds(n,!0);break}o&&(o.isAssigning=!1)}super.applyValue(t,i,n,s,a)}get assignments(){return[...this.assigned||[]]}assign(t,i=!1){const{eventStore:n}=this;n&&!n.usesSingleAssignment?n.assignEventToResource(this,t,i):(this.resourceId=this.constructor.asId(t),n||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(t,i=!1){var n;const s=this;t=s.constructor.asId(t),s.meta.removingResource=i,(n=s.eventStore)==null||n.unassignEventFromResource(s,t),s.meta.removingResource=null}reassign(t,i){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,t,i)}isAssignedTo(t){const i=this.constructor.asId(t);return this.assignments.some(n=>n.resourceId===i)}get predecessors(){var t;return[...(t=this.incomingDeps)!=null?t:[]]}get successors(){var t;return[...(t=this.outgoingDeps)!=null?t:[]]}get dependencies(){var t,i;return[...(t=this.incomingDeps)!=null?t:[],...(i=this.outgoingDeps)!=null?i:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:t}=this;if(t>=BF||!t&&this.allDay)return!0;const{endDate:i,startDate:n}=this,s=b.clearTime(n);if(n&&i)return s.setDate(s.getDate()+1),(i||b.add(n,t))>s}static getAllDayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),t&&(t=b.clearTime(t,!0)),t}static getAllDayEndDate(t){return t&&t.isEvent&&(t=t.get("endDate")),t&&(t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0||t.getMilliseconds()>0)&&(t=b.getNext(t,"d",1)),t}static getAllDayDisplayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),b.clearTime(t,!0)}static getAllDayDisplayEndDate(t,i){return t&&t.isEvent&&(i=t.get("endDate"),t=t.get("startDate")),i&&(t=this.constructor.getAllDayDisplayStartDate(t),b.clearTime(i,!0).valueOf()===i.valueOf()?i=b.add(i,b.DAY,-1):t.valueOf()!==i.valueOf()&&(i=b.clearTime(i,!0))),i}isEditable(t){switch(t){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(t)}},HF=Vu,lc=class extends HF.derive(St).mixin(Ju,gi,Qu){static get $name(){return"EventModel"}};lc.exposeProperties(),lc._$name="EventModel";var VF=gi(Np.derive(bt)),cc=class extends VF.mixin(rv,Jp,ev,Wu){static get defaultConfig(){return{modelClass:lc}}};E(cc,"$name","EventStore"),cc._$name="EventStore";var ov=e=>class extends e{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(t,...i){t=t||{};const{fieldMap:n}=this,s=n.eventId.dataSource,a=n.resourceId.dataSource,o=n.event.dataSource,l=n.resource.dataSource,c=t[s],d=t[a],u=t[o],h=t[l];c!=null?t[o]=c:u!=null&&(t[s]=u.isModel?u.id:u),d!=null?t[l]=d:h!=null&&(t[a]=h.isModel?h.id:h),super.construct(t,...i)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(t,i){let n,s;return t?n=t.isModel?t.id:t:n=this.internalId,i?s=i.isModel?i.id:i:s=this.internalId,`${n}-${s}`}buildIndexKey({event:t,resource:i}){return this.buildEventResourceKey(t,i)}set(t,i,...n){var s,a;const o=this.fieldToKeys(t,i);return"resource"in o?((s=o.resource)==null?void 0:s.id)!==void 0&&(o.resourceId=o.resource.id):"resourceId"in o&&this.constructor.isProAssignmentModel&&(o.resource=o.resourceId),"event"in o?((a=o.event)==null?void 0:a.id)!==void 0&&(o.eventId=o.event.id):"eventId"in o&&this.constructor.isProAssignmentModel&&(o.event=o.eventId),super.set(o,null,...n)}afterChange(t,i,n,s,a){var o,l;const c=this;return!c.constructor.isProAssignmentModel&&(i!=null&&i.resourceId)&&((o=c.resource)==null?void 0:o.id)!==i.resourceId.value?c.resource=i.resourceId.value:c.constructor.isProAssignmentModel&&((l=c.project)!=null&&l.propagatingSyncChanges)&&(i!=null&&i.eventId)&&!(i!=null&&i.event)&&(t.event.value===i.eventId.value||t.event.value.id===i.eventId.value)&&(delete i.eventId,delete c.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(t){const{resource:i}=this;i!=null&&i.isModel&&i.id===t?this.set("resourceId",t):this.resource=t}get resourceId(){var t,i;return(i=(t=this.resource)==null?void 0:t.id)!=null?i:this.get("resourceId")}set eventId(t){const{event:i}=this;i!=null&&i.isModel&&i.id===t?this.set("eventId",t):this.event=t}get eventId(){var t,i;return(i=(t=this.event)==null?void 0:t.id)!=null?i:this.get("eventId")}get eventName(){var t;return(t=this.event)==null?void 0:t.name}get resourceName(){var t;return(t=this.resource)==null?void 0:t.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var t;const{event:i,resource:n,unjoinedStores:s,assignmentStore:a}=this,o=a==null?void 0:a.crudManager;let l;return a?l=this.isValid&&i.isPersistable&&(o||!i.hasGeneratedId&&!n.hasGeneratedId):l=!this.isPhantom&&!!s[0],l&&super.isPersistable&&!((t=this.event)!=null&&t.isCreating)}get isValid(){return this.resource!=null&&this.event!=null}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(t,i,n){var s,a;if(!super.shouldRecordFieldChange(t,i,n))return!1;if(t==="event"||t==="eventId"){const o=(s=this.project)==null?void 0:s.eventStore;if(o&&o.oldIdMap[i]===o.getById(n))return!1}if(t==="resource"||t==="resourceId"){const o=(a=this.project)==null?void 0:a.resourceStore;if(o&&o.oldIdMap[i]===o.getById(n))return!1}return!0}},NF=Bu,dc=class extends ov(gi(NF.derive(ce))){static get $name(){return"AssignmentModel"}};dc.exposeProperties(),dc._$name="AssignmentModel";var lv=e=>class extends e{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(t,...i){var n;t=H.asArray(t);for(let s=0;s<t.length;s++){let a=t[s];if(a instanceof ce||(t[s]=a=this.createRecord(a)),!this.isSyncingDataOnLoad&&this.storage.findIndex("eventResourceKey",a.eventResourceKey,!0)!==-1)throw new Error(`Duplicate assignment Event: ${a.eventId} to resource: ${a.resourceId}`);(n=a.event)!=null&&n.isCreating&&(a.isCreating=!0)}return super.add(t,...i)}includesAssignment(t,i){return this.storage.findIndex("eventResourceKey",`${t}-${i}`,!0)!==-1}setStoreData(t){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined EventStore data containing resourceId (single-assignment mode)");super.setStoreData(t)}set storage(t){super.storage=t,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(t,i){if(!t||!(i!=null&&i.isOccurrence))return t;const n=this;return{id:`${i.id}:a${t.id}`,event:i,resource:t.resource,eventId:i.id,resourceId:t.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(s){return n.occurrenceInstanceMeta(this,s)}}}occurrenceInstanceMeta(t,i){const n=this,s=i.id||i,{id:a}=t;let{occurrenceMeta:o}=n;return o||(o=n.occurrenceMeta={}),o[a]||(o[a]={}),o[a][s]||(o[a][s]={})}mapAssignmentsForEvent(t,i,n){t=this.eventStore.getById(t);const s=!!i,a=!!n;return s||a?t.assignments.reduce((o,l)=>{const c=s?i(l):l;return(!a||n(c))&&o.push(c),o},[]):t.assignments}mapAssignmentsForResource(t,i,n){t=this.resourceStore.getById(t);const s=!!i,a=!!n;return s||a?t.assignments.reduce((o,l)=>{const c=s?i(l):l;return(!a||n(c))&&o.push(c),o},[]):t.assignments}getAssignmentsForEvent(t){return t.assignments}removeAssignmentsForEvent(t){return this.remove(t.assignments)}getAssignmentsForResource(t){return t=this.resourceStore.getById(t),t.assignments}removeAssignmentsForResource(t){this.remove(this.getAssignmentsForResource(t))}getResourcesForEvent(t){return t.resources}getEventsForResource(t){return t=this.resourceStore.getById(t),t==null?void 0:t.events}assignEventToResource(t,i,n=null,s=!1){var a,o;const l=this,c=s?new Set(t.assignments):null;if(i=H.asArray(i).map(u=>{var h;return(h=u.$original)!=null?h:u}),(a=l.eventStore)!=null&&a.usesSingleAssignment){if((o=t.assignments)!=null&&o.length)return l.isEventAssignedToResource(t,i[0])||(t.resource=i[0]),[];t.resourceId=i[0].id}let d=[];return l.suspendAutoCommit(),i.forEach(u=>{var h;const g=l.getAssignmentForEventAndResource(t,u);if(g)s&&c.delete(g);else{const f={event:t,resource:u};d.push((h=n==null?void 0:n(f))!=null?h:f)}}),d=l.add(d),s&&l.remove(Array.from(c)),l.resumeAutoCommit(),d}unassignEventFromResource(t,i){const n=this,s=[];if(!i)return n.removeAssignmentsForEvent(t);i=H.asArray(i);for(let a=0;a<i.length;a++)n.isEventAssignedToResource(t,i[a])&&s.push(n.getAssignmentForEventAndResource(t,i[a]));return n.remove(s)}isEventAssignedToResource(t,i){return!!this.getAssignmentForEventAndResource(t,i)}getAssignmentForEventAndResource(t,i){let n;return!(t=this.eventStore.getById(t))||!(n=t.assignments)||!(i=this.resourceStore.$master.getById(i))?null:this.getOccurrence(n.find(s=>{var a;return((a=s.resource)==null?void 0:a.$original)===i.$original}),t)}},zF=gi(Bp.derive(bt)),uc=class extends lv(zF){static get defaultConfig(){return{modelClass:dc}}};E(uc,"$name","AssignmentStore"),uc._$name="AssignmentStore";var WF=["SS","SF","FS","FF"],mt=class extends ce{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(e){const r=e[this.fieldMap.from.dataSource],t=e[this.fieldMap.to.dataSource];r!=null&&(e.fromEvent=r),t!=null&&(e.toEvent=t),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||((e=this.unjoinedStores[0])==null?void 0:e.eventStore)}set from(e){const{fromEvent:r}=this;r!=null&&r.isModel&&r.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:r}=this;r!=null&&r.isModel&&r.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let r;return e!==this.hardType&&(r=this.set({type:e,fromSide:null,toSide:null})),r}get lag(){return this.get("lag")}set lag(e){this.setLag(e)}setLag(e,r=this.lagUnit){if(arguments.length===1){typeof e=="number"?this.lag=e:(e=b.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}));return}e=parseFloat(e),this.set({lag:e,lagUnit:r})}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${b.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new _e({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){typeof e=="string"?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:r,unjoinedStores:t}=e,i=r[0];let n;if(i){const{fromEvent:s,toEvent:a}=e,o=i.crudManager;n=s&&(o||!s.hasGeneratedId)&&a&&(o||!a.hasGeneratedId)}else n=!!t[0];return n&&super.isPersistable}getDateRange(){const{fromEvent:e,toEvent:r}=this;if(e!=null&&e.isScheduled&&(r!=null&&r.isScheduled)){const t=mt.Type;let i,n;switch(this.type){case t.StartToStart:i=e.startDateMS,n=r.startDateMS;break;case t.StartToEnd:i=e.startDateMS,n=r.endDateMS;break;case t.EndToEnd:i=e.endDateMS,n=r.endDateMS;break;case t.EndToStart:i=e.endDateMS,n=r.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(i,n),end:Math.max(i,n)}}return null}highlight(e){var r,t;const i=(t=(r=this.highlighted)==null?void 0:r.split(" "))!=null?t:[];i.includes(e)||(this.highlighted=i.concat(e).join(" "))}unhighlight(e){const{highlighted:r}=this;if(r){const t=r.split(" "),i=t.indexOf(e);i>=0&&(t.splice(i,1),this.highlighted=t.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const r=WF[this.type];return e?r:this.type===mt.Type.EndToStart?"":r}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:e,toEvent:r,type:t}=this;return typeof t=="number"&&e&&r&&e!==r}get fromEventName(){var e;return((e=this.fromEvent)==null?void 0:e.name)||""}get toEventName(){var e;return((e=this.toEvent)==null?void 0:e.name)||""}shouldRecordFieldChange(e,r,t){var i;if(!super.shouldRecordFieldChange(e,r,t))return!1;if(e==="from"||e==="to"||e==="fromEvent"||e==="toEvent"){const n=(i=this.project)==null?void 0:i.eventStore;if(n&&n.oldIdMap[r]===n.getById(t))return!1}return!0}};mt.exposeProperties(),mt._$name="DependencyBaseModel";var GF=Hu,kt=class extends gi(GF.derive(mt)){static get $name(){return"DependencyModel"}getTypeFromSides(e,r,t){const i=mt.Type,n=t?"right":"left",s=t?"left":"right";return e===n?r===n?i.StartToStart:i.StartToEnd:r===s?i.EndToEnd:i.EndToStart}};kt.exposeProperties(),kt._$name="DependencyModel";var cv=e=>class extends e{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(t,i,n,s=!0,a){return a=a||(o=>this.getEventDependencies(o)),t=H.asArray(t),t.reduce((o,l)=>{l.children&&!s?l.traverse(c=>{o=a(c).reduce(i,o)}):o=a(l).reduce(i,o)},n),n}mapEventDependencies(t,i,n,s,a){return this.reduceEventDependencies(t,(o,l)=>(n(l)&&o.push(l),o),[],s,a)}mapEventPredecessors(t,i,n,s){return this.reduceEventPredecessors(t,(a,o)=>(n(o)&&a.push(o),a),[],s)}mapEventSuccessors(t,i,n,s){return this.reduceEventSuccessors(t,(a,o)=>(n(o)&&a.push(o),a),[],s)}getEventDependencies(t){return[].concat(t.predecessors||[],t.successors||[])}removeEventDependencies(t){this.remove(this.getEventDependencies(t))}removeEventPredecessors(t){this.remove(t.predecessors)}removeEventSuccessors(t,i){this.remove(t.successors)}getBySourceTargetId(t){return this.records.find(i=>t==this.constructor.makeDependencySourceTargetCompositeKey(i.from,i.to))}getDependencyForSourceAndTargetEvents(t,i){return t=ce.asId(t),i=ce.asId(i),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(t,i))}getEventsLinkingDependency(t,i){return this.getDependencyForSourceAndTargetEvents(t,i)||this.getDependencyForSourceAndTargetEvents(i,t)}async isValidDependency(t,i,n){let s=t,a=i;return t==null?!1:(t.isDependencyModel&&({fromEvent:s,toEvent:a}=t),s=this.eventStore.getById(s),a=this.eventStore.getById(a),s&&a?!s.project||!a.project?!1:this.project.isValidDependency(s,a,n):t!==i)}isValidDependencyToCreate(t,i,n){return this.isValidDependency(t,i,n)}getHighlightedDependencies(t){return this.records.reduce((i,n)=>(n.isHighlightedWith(t)&&i.push(n),i),[])}static makeDependencySourceTargetCompositeKey(t,i){return`source(${t})-target(${i})`}getTimeSpanDependencies(t){return this.getEventDependencies(t)}},UF=gi(Vp.derive(bt)),eh=class extends cv(UF.derive(bt)){static get defaultConfig(){return{modelClass:kt}}};eh._$name="DependencyStore";var qx=e=>class extends e{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(t,i,n){const s=[],{storeId:a}=t,o=this.crudLoadValidationMandatoryStores,l={[a]:{}};return i?i.rows||(s.push(`- "${a}" store section should have a "rows" property with an array of the store records.`),l[a].rows=["..."]):o!=null&&o.includes(a)&&(s.push(`- No "${a}" store section found. It should contain the store data.`),l[a].rows=["..."]),s.length&&Object.assign(n,l),s}getLoadResponseWarnings(t){const i=[],n={};return this.skipSuccessProperty||(n.success=!0),this.forEachCrudStore((s,a,o)=>{i.push(...this.getStoreLoadResponseWarnings(o,t==null?void 0:t[a],n))}),i.length&&(i.push(`Please adjust your response to look like this:
`+JSON.stringify(n,null,4).replace(/"\.\.\."/g,"...")),i.push(this.disableValidationNote)),i}validateLoadResponse(t){const i=this.getLoadResponseWarnings(t);i.length&&console.warn(this.crudLoadValidationWarningPrefix+`
`+i.join(`
`))}getStoreSyncResponseWarnings(t,i,n,s){const a=[],o=[],l=[],{storeId:c}=t,d={[c]:{}},u=t.phantomIdField||this.phantomIdField,{modelClass:h}=t.store,{idField:g}=h,f=(n==null?void 0:n.rows)||[],m=(n==null?void 0:n.removed)||[];let p=!1;if(i!=null&&i.added&&(o.push(...i.added.filter(v=>!f.find(y=>y[u]==v[u])&&!m.find(y=>y[u]==v[u]||y[g]==v[u])).map(v=>({[u]:v[u],[g]:"..."}))),o.length)){const v=o.map(y=>"#"+y[u]).join(", ");a.push(`- "${c}" store "rows" section should mention added record(s) ${v} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!o.length&&n&&((typeof n!="object"||Array.isArray(n))&&(a.push(`- "${c}" store section should be an Object.`),d[c]["..."]="..."),n.rows&&!Array.isArray(n.rows)&&(a.push(`- "${c}" store "rows" section should be an array`),o.push("...")),n.removed&&!Array.isArray(n.removed)&&(a.push(`- "${c}" store "removed" section should be an array:`),l.push("...")));else{if(i!=null&&i.updated){const v=i.updated.filter(y=>!f.find(C=>C[g]==y[g])).map(y=>({[g]:y[g]}));if(o.push(...v),v.length){const y=v.map(C=>"#"+C[g]).join(", ");a.push(`- "${c}" store "rows" section should mention updated record(s) ${y} sent in the request. It should contain the updated record identifiers.`),p=!0}}if(o.length&&o.push("..."),i!=null&&i.removed&&(l.push(...i.removed.filter(v=>!f.find(y=>y[g]==v[g])).map(v=>({[g]:v[g]}))),l.length)){const v=l.map(y=>"#"+y[g]).join(", ");a.push(`- "${c}" store "removed" section should mention removed record(s) ${v} sent in the request. It should contain the removed record identifiers.`),d[c].removed=l,l.push("..."),p=!0}}return o.length&&(d[c].rows=o),a.length||delete d[c],Object.assign(s,d),{messages:a,showSupportShortSyncResponseNote:p}}getSyncResponseWarnings(t,i){const n=[],s={},a=i.pack;this.skipSuccessProperty||(s.success=!0);let o=!1;return this.forEachCrudStore((l,c,d)=>{const u=this.getStoreSyncResponseWarnings(d,a==null?void 0:a[c],t[c],s);o=o||u.showSupportShortSyncResponseNote,n.push(...u.messages)}),n.length&&(n.push(`Please adjust your response to look like this:
`+JSON.stringify(s,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),o&&n.push(this.supportShortSyncResponseNote),n.push(this.disableValidationNote)),n}validateSyncResponse(t,i){const n=this.getSyncResponseWarnings(t,i);n.length&&console.warn(this.crudSyncValidationWarningPrefix+`
`+n.join(`
`))}},YF=class extends Error{},Kx=class extends YF{constructor(e={}){var r,t;super(e.message||e.request&&O.capitalize((r=e.request)==null?void 0:r.type)+" failed"||"Crud Manager request failed"),Object.assign(this,e),this.action=(t=this.request)==null?void 0:t.type}},Xx=function(e,r,t){return e.store&&(e=e.store),r.store&&(r=r.store),e=e[t]||0,r=r[t]||0,e<r?-1:e>r?1:0},qF=function(e,r){return Xx(e,r,"loadPriority")},KF=function(e,r){return Xx(e,r,"syncPriority")},dv=e=>{var r;e.$$meta=e.$meta;const t=[];return e.isEvents||t.push(Le),e.isDelayable||t.push(fe),t.push(qx),r=class extends(e||F).mixin(...t){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(i={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(i)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var i,n;return(n=(i=this.transport)==null?void 0:i.load)==null?void 0:n.url}updateLoadUrl(i){T.setPath(this,"transport.load.url",i)}get syncUrl(){var i,n;return(n=(i=this.transport)==null?void 0:i.sync)==null?void 0:n.url}updateSyncUrl(i){T.setPath(this,"transport.sync.url",i)}getStoreDescriptor(i){return i?i instanceof re?this.crudStores.find(n=>n.store===i):typeof i=="object"?this.crudStoresIndex[i.storeId]:this.crudStoresIndex[i]||this.getStoreDescriptor(re.getStore(i)):null}fillStoreDescriptor(i){const{store:n}=i,{storeIdProperty:s=this.storeIdProperty,modelClass:a}=n;return i.storeId||(i.storeId=n[s]||n.id),i.idField||(i.idField=a.idField),i.phantomIdField||(i.phantomIdField=a.phantomIdField),i.phantomParentIdField||(i.phantomParentIdField=a.phantomParentIdField),"writeAllFields"in i||(i.writeAllFields=n.writeAllFields),i}updateCrudStoreIndex(){const i=this.crudStoresIndex={};this.crudStores.forEach(n=>n.storeId&&(i[n.storeId]=n))}getCrudStore(i){const n=this.getStoreDescriptor(i);return n==null?void 0:n.store}forEachCrudStore(i,n=this){if(!i)throw new Error("Iterator function must be provided");this.crudStores.every(s=>i.call(n,s.store,s.storeId,s)!==!1)}set crudStores(i){this._crudStores=[],this.addCrudStore(i);for(const n of this._crudStores)n.loadPriority=n.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(i){return this._orderedCrudStores=i}set syncApplySequence(i){this._syncApplySequence=[],this.addStoreToApplySequence(i)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(i){const n=this;let s;return i instanceof re?s={store:i}:typeof i=="object"?(i.store||(i={storeId:i.id,store:new re(i)}),s=i):s={store:re.getStore(i)},n.fillStoreDescriptor(s),i=s.store,i.setCrudManager?i.setCrudManager(n):i.crudManager=n,i.pageSize=null,(n.loadUrl||n.syncUrl)&&(i.autoCommit=!1,i.autoLoad=!1,(i.createUrl||i.updateUrl||i.deleteUrl||i.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),n.bindCrudStoreListeners(i),s}addCrudStore(i,n,s){if(i=H.asArray(i),!(i!=null&&i.length))return;const a=this,o=i.map(a.internalAddCrudStore,a);typeof n=="undefined"?a.crudStores.push(...o):(s&&((s instanceof re||typeof s!="object")&&(s=a.getStoreDescriptor(s)),n+=a.crudStores.indexOf(s)),a.crudStores.splice(n,0,...o)),a.orderedCrudStores.push(...o),a.updateCrudStoreIndex()}addPrioritizedStore(i){const n=this;n.hasCrudStore(i)||n.addCrudStore(i,H.findInsertionIndex(i,n.crudStores,qF)),n.hasApplySequenceStore(i)||n.addStoreToApplySequence(i,H.findInsertionIndex(i,n.syncApplySequence,KF))}hasCrudStore(i){var n;return(n=this.crudStores)==null?void 0:n.some(s=>s===i||s.store===i||s.storeId===i)}removeCrudStore(i){const n=this,s=n.crudStores,a=s.find(o=>o===i||o.store===i||o.storeId===i);if(a)n.unbindCrudStoreListeners(a.store),delete n.crudStoresIndex[a.storeId],H.remove(s,a),n.syncApplySequence&&n.removeStoreFromApplySequence(i);else throw new Error("Store not found in stores collection")}bindCrudStoreListeners(i){i.ion({name:i.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(i){this.detachListeners(i.id)}addStoreToApplySequence(i,n,s){if(!i)return;i=H.asArray(i);const a=this,o=i.reduce((c,d)=>{const u=a.getStoreDescriptor(d);return u&&c.push(u),c},[]);if(typeof n=="undefined")a.syncApplySequence.push(...o);else{let c=n;s&&((s instanceof re||typeof s!="object")&&(s=a.getStoreDescriptor(s)),c+=a.syncApplySequence.indexOf(s)),a.syncApplySequence.splice(c,0,...o)}const l=a.syncApplySequence.map(({storeId:c})=>c);a.orderedCrudStores=[...a.syncApplySequence],a.crudStores.forEach(c=>{l.includes(c.storeId)||a.orderedCrudStores.push(c)})}removeStoreFromApplySequence(i){const n=this.syncApplySequence.findIndex(s=>s===i||s.store===i||s.storeId===i);n>-1&&(this.syncApplySequence.splice(n,1),this.orderedCrudStores.splice(n,1))}hasApplySequenceStore(i){return this.syncApplySequence.some(n=>n===i||n.store===i||n.storeId===i)}onCrudStoreDestroy({source:i}){this.removeCrudStore(i)}onCrudStoreChange(i){const n=this;n.crudIgnoreUpdates||(n.crudStoreHasChanges(i==null?void 0:i.source)?(n.trigger("hasChanges"),n.autoSync&&n.scheduleAutoSync()):n.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(i=!0){const n=this;n.autoSyncSuspendCounter--,n.autoSyncSuspendCounter<=0&&(n.autoSyncSuspendCounter=0,i&&n.autoSync&&n.crudStoreHasChanges()&&n.scheduleAutoSync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const i=this;!i.hasTimeout("autoSync")&&!i.isAutoSyncSuspended&&i.setTimeout({name:"autoSync",fn:()=>{i.sync().catch(n=>{})},delay:i.autoSyncTimeout})}async triggerFailedRequestEvents(i,n,s,a){const{options:o,type:l}=i;this.trigger("requestFail",{requestType:l,response:n,responseText:s,responseOptions:a}),this.trigger(l+"Fail",{response:n,responseOptions:a,responseText:s,options:o})}async internalOnResponse(i,n,s){const a=this,o=n?a.decode(n):null,{options:l,type:c}=i;if(n&&!o&&console.error("Failed to parse response: "+n),!o||(a.skipSuccessProperty?o.success===!1:!o.success))a.triggerFailedRequestEvents(i,o,n,s);else if(a.trigger("beforeResponseApply",{requestType:c,response:o})!==!1&&a.trigger(`before${O.capitalize(c)}Apply`,{response:o,options:l})!==!1){if(a.crudRevision=o.revision,await a.applyResponse(i,o,l),a.isDestroyed)return;a.trigger("requestDone",{requestType:c,response:o,responseOptions:s}),a.trigger(c,{response:o,responseOptions:s,options:l}),(c==="load"||!a.crudStoreHasChanges())&&(a.trigger("noChanges"),c==="load"&&a.emitCrudStoreEvents(i.pack.stores,"afterRequest"))}return o}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(i){this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&!i&&this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(i){return i?this.isCrudStoreDirty(this.getCrudStore(i)):this.crudStores.some(n=>this.isCrudStoreDirty(n.store))}isCrudStoreDirty(i){return!!i.changes}doAutoLoad(){return this.load().catch(i=>{})}emitCrudStoreEvents(i,n,s){const a={action:"read"+n,...s};for(const o of this.crudStores)i.includes(o.storeId)&&o.store.trigger(n,a)}getLoadPackage(i){const n={type:"load",requestId:this.requestId},s=this.crudStores,a=Object.assign({},i);return delete a.request,n.stores=s.map(o=>{var l;const c=a==null?void 0:a[o.storeId],d=o.pageSize||((l=o.store)==null?void 0:l.pageSize);if(c||d){const u=Object.assign({storeId:o.storeId,page:1},c);return d&&(u.pageSize=d),o.currentPage=u.page,c&&delete a[o.storeId],u}return o.storeId}),Object.assign(n,a),n}loadCrudStore(i,n,s){const a=n==null?void 0:n.rows;s!=null&&s.append||n!=null&&n.append?i.add(a):i.data=a,i.trigger("load",{data:a})}loadDataToCrudStore(i,n,s){const a=i.store,o=n==null?void 0:n.rows;a.__loading=!0,o&&this.loadCrudStore(a,n,s,i),a.__loading=!1}loadCrudManagerData(i,n={}){this.suspendChangesTracking(),this.crudStores.forEach(s=>{const a=s.storeId,o=i[a];o&&this.loadDataToCrudStore(s,o,n[a])}),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return!!(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return!!(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return!!(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(i){typeof i=="string"&&(i={request:{url:i}});const n=this,s=n.getLoadPackage(i);return n._autoLoadPromise=null,new Promise((a,o)=>{if(n.trigger("beforeLoad",{pack:s})!==!1){const{load:l}=n.activeRequests;l&&(n.cancelRequest(l.desc,l.reject),n.trigger("loadCanceled",{pack:s}));const c=N.assign({id:s.requestId,data:n.encode(s),type:"load",success:n.onCrudRequestSuccess,failure:n.onCrudRequestFailure,thisObj:n},i==null?void 0:i.request);n.activeRequests.load={type:"load",options:i,pack:s,resolve:a,reject(...d){c.success=c.failure=null,o(...d)},id:s.requestId,desc:n.sendRequest(c)},n.emitCrudStoreEvents(s.stores,"loadStart"),n.trigger("loadStart",{pack:s})}else n.trigger("loadCanceled",{pack:s}),o({cancelled:!0})})}getActiveCrudManagerRequest(i){let n=this.activeRequests[i];return!n&&this.trackResponseType&&(n=Object.values(this.activeRequests)[0]),n}prepareAddedRecordData(i,n){const s=this,{store:a}=n,{isTree:o}=a,l=n.phantomIdField||s.phantomIdField,c=n.phantomParentIdField||s.phantomParentIdField,d=a.modelClass.allFields.filter(g=>g.subStore),u=i.constructor,h=Object.assign(i.persistableData,{[l]:i.id});if(o){const{parent:g}=i;g&&!g.isRoot&&g.isPhantom&&(h[c]=g.id)}return s.resetIdsBeforeSync&&T.deletePath(h,u.idField),d.forEach(g=>{const f=i.get(g.name);f.allCount&&(h[g.dataSource]={added:f.getRange().map(m=>s.prepareAddedRecordData(m,{store:f}))})}),h}prepareAdded(i,n){return i.filter(s=>s.isValid).map(s=>this.prepareAddedRecordData(s,n))}prepareUpdated(i,n){const{store:s}=n,{isTree:a}=s,o=n.writeAllFields||n.writeAllFields!==!1&&this.writeAllFields,l=n.phantomParentIdField||this.phantomParentIdField,c=s.modelClass.allFields.filter(d=>d.subStore);if(n.store.tree){const d=n.store.rootNode;i=i.filter(u=>u!==d)}return i.filter(d=>d.isValid).reduce((d,u)=>{let h;if(o?h=u.persistableData:h=u.modificationDataToWrite,a){const{parent:g}=u;g&&!g.isRoot&&g.isPhantom&&(h[l]=g.id)}return c.forEach(g=>{const f=u.get(g.name);h[g.dataSource]=this.getCrudStoreChanges({store:f})}),T.isEmpty(h)||d.push(h),d},[])}prepareRemoved(i){return i.map(n=>{const s=n.constructor;return T.setPath({},s.idField,n.id)})}getCrudStoreChanges(i){const{store:n}=i;let{added:s=[],modified:a=[],removed:o=[]}=n.changes||{},l;return s.length&&(s=this.prepareAdded(s,i)),a.length&&(a=this.prepareUpdated(a,i)),o.length&&(o=this.prepareRemoved(o)),(s.length||a.length||o.length)&&(l={},s.length&&(l.added=s),a.length&&(l.updated=a),o.length&&(l.removed=o)),l}getChangesetPackage(){const{changes:i}=this;return i||this.forceSync?{type:"sync",requestId:this.requestId,revision:this.crudRevision,...i}:null}get changes(){const i={};return this.crudStores.forEach(n=>{const s=this.getCrudStoreChanges(n);s&&(i[n.storeId]=s)}),Object.keys(i).length>0?i:null}getRowsToApplyChangesTo({store:i,storeId:n},s,a){var o,l;const c=this,{modelClass:d}=i,u=d.idField,{updated:h,removed:g}=a||{};let f,m,p;if(s){p=!0;const v={};f=((o=s.rows)==null?void 0:o.slice())||[],m=((l=s.removed)==null?void 0:l.slice())||[],[...f,...m].forEach(y=>{const C=T.getPath(y,u);v[C]=!0}),c.supportShortSyncResponse&&(h==null||h.forEach(y=>{const C=T.getPath(y,u);v[C]||f.push({[u]:C})}),g==null||g.forEach(y=>{const C=T.getPath(y,u);v[C]||m.push({[u]:C})}))}else(h||g)&&(p=!1,f=h,m=g);return f=f!=null&&f.length?f:null,m=m!=null&&m.length?m:null,{rows:f,removed:m,remote:p}}applyChangesToStore(i,n,s){var a;const o=this,l=i.phantomIdField||o.phantomIdField,{store:c}=i,d=c.modelClass.getFieldDataSource("id"),u=c.modelClass.allFields.filter(C=>C.subStore),{rows:h,removed:g,remote:f}=o.getRowsToApplyChangesTo(i,n,s),m=[],p=[];if(h)for(const C of h)c.getById((a=C[l])!=null?a:C[d])?p.push(C):m.push(C);const v=[];p.length&&u.length&&p.forEach(C=>{var D,S,x;const R=c.getById((D=C[l])!=null?D:C[d]),I=((S=s.added)==null?void 0:S.find(P=>P[l]==C[l]))||((x=s.updated)==null?void 0:x.find(P=>P[d]==C[d])),M={};u.forEach(P=>{const _=R.get(P.name);o.applyChangesToStore({store:_},C[P.dataSource],I==null?void 0:I[P.dataSource]),M[P.dataSource]="foo",delete C[P.dataSource]}),v.push([R,M])});const y=c.applyChangeset({removed:g,added:m,updated:p},null,l,f,!0);return v.forEach(([C,D])=>Object.assign(y.get(C.id),D)),y}applySyncResponse(i,n){var s;const a=this,o=a.orderedCrudStores;a.applyingChangeset=a.applyingSyncResponse=!0,a.suspendChangesTracking();for(const l of o)a.applyChangesToStore(l,i[l.storeId],(s=n==null?void 0:n.pack)==null?void 0:s[l.storeId]);a.resumeChangesTracking(!0),a.applyingChangeset=a.applyingSyncResponse=!1}applyLoadResponse(i,n){this.applyingLoadResponse=!0,this.loadCrudManagerData(i,n),this.applyingLoadResponse=!1}async applyResponse(i,n,s){const a=this;switch(a.trackResponseType&&n.type||i.type){case"load":a.validateResponse&&a.validateLoadResponse(n),a.applyLoadResponse(n,s);break;case"sync":a.validateResponse&&a.validateSyncResponse(n,i),a.applySyncResponse(n,i);break}}applyChangeset(i,n=null,s,a=!1){const o=this,l=a?new Map:void 0;o.suspendAutoSync(),o.suspendChangesTracking();for(const{store:c,phantomIdField:d}of o.orderedCrudStores)if(i[c.id]){const u=c.applyChangeset(i[c.id],n,d||o.phantomIdField,!0,a);u&&l.set(c.id,u)}return o.resumeChangesTracking(!0),o.resumeAutoSync(!1),l}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const i=this;return i.clearTimeout("autoSync"),i.activeRequests.sync?(i.trigger("syncDelayed"),i.activeSyncPromise=i.activeSyncPromise.finally(()=>i.sync())):i.activeSyncPromise=new Promise((n,s)=>{const a=i.getChangesetPackage();if(!a){n(null);return}i.trigger("beforeSync",{pack:a})!==!1?(i.trigger("syncStart",{pack:a}),i.activeRequests.sync={type:"sync",pack:a,resolve:n,reject:s,id:a.requestId,desc:i.sendRequest({id:a.requestId,data:i.encode(a),type:"sync",success:i.onCrudRequestSuccess,failure:i.onCrudRequestFailure,thisObj:i})}):(i.trigger("syncCanceled",{pack:a}),s({cancelled:!0}))}).catch(n=>{if(n&&!n.cancelled)throw n;return n})}async onCrudRequestSuccess(i,n,s){const a=this,{type:o,id:l}=s;if(a.isDestroyed)return;let c="";s=a.activeRequests[o];try{c=await i.text()}catch(u){}if(a.isDestroyed)return;if((s==null?void 0:s.id)!==l)throw new Error(`Interleaved ${o} operation detected`);a.activeRequests[o]=null;const d=await a.internalOnResponse(s,c,n);if(!a.isDestroyed){if(!d||(a.skipSuccessProperty?(d==null?void 0:d.success)===!1:!(d!=null&&d.success))){const u={rawResponse:i,response:d,request:s};d!=null&&d.message&&(u.message=d.message),s.reject(new Kx(u))}a["crud"+O.capitalize(s.type)+"ed"]=!0,s.resolve({response:d,rawResponse:i,responseText:c,request:s})}}async onCrudRequestFailure(i,n,s){var a;const o=this;if(o.isDestroyed)return;s=o.activeRequests[s.type];const l=(a=n==null?void 0:n.abortController)==null?void 0:a.signal;if(!!!(l!=null&&l.aborted)){let d,u="";try{u=await i.text(),d=o.decode(u)}catch(h){}if(o.isDestroyed||(o.triggerFailedRequestEvents(s,d,u,n),o.isDestroyed))return;s.reject(new Kx({rawResponse:i,request:s}))}o.activeRequests[s.type]=null}acceptChanges(){this.crudStores.forEach(i=>i.store.acceptChanges())}revertChanges(){this.revertCrudStoreChanges()}revertCrudStoreChanges(){const{usesSingleAssignment:i}=this.eventStore;this.orderedCrudStores.forEach(({store:n})=>(!n.isAssignmentStore||!i)&&n.revertChanges())}doDestroy(){const i=this,{load:n,sync:s}=i.activeRequests;for(n&&i.cancelRequest(n.desc,n.reject),s&&i.cancelRequest(s.desc,s.reject);i.crudStores.length>0;)i.removeCrudStore(i.crudStores[0]);super.doDestroy&&super.doDestroy()}},E(r,"configurable",{loadUrl:null,syncUrl:null,forceSync:null}),E(r,"delayable",{doAutoLoad:"raf"}),r},uv=e=>class vM extends(e||F){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(t,i){var n;(n=t.abort)==null||n.call(t),this.isDestroying||i({cancelled:!0})}shouldUseBodyForRequestData(t,i,n){return!(i==="HEAD"||i==="GET")&&!n}sendRequest(t){const i=this,{data:n}=t,s=i.transport[t.type]||{},a=N.assign({},s,s.requestConfig);t.url&&(a.url=t.url),a.method=a.method||vM.defaultMethod[t.type],a.params=N.assign(a.params||{},t.params);let{paramName:o}=a;if(i.shouldUseBodyForRequestData(s,a.method,o)?(a.body=n,a.headers=a.headers||{},a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"):(o=o||"data",a.params[o]=n),!a.url)throw new Error("Trying to request without URL specified");delete a.requestConfig,delete a.paramName;let l,c;function d(){a.queryParams=a.params,delete a.params;let h=!1;const g=N.assign({},a,a.fetchOptions);return l=_r.fetch(a.url,g),l.catch(f=>{var m,p;l.done=!0,(m=i.trigger)==null||m.call(i,"responseReceived",{success:!1});const v=(p=g.abortController)==null?void 0:p.signal;return v&&(h=v.aborted,h||console.warn(f)),{error:f,cancelled:h}}).then(f=>{var m;l.done=!0,(m=i.trigger)==null||m.call(i,"responseReceived",{success:!!(f!=null&&f.ok)});const p=f!=null&&f.ok?t.success:t.failure;return p==null?void 0:p.call(t.thisObj||i,f,g,t)})}const u=i.trigger("beforeSend",{params:a.params,requestType:t.type,requestConfig:a,config:t});return N.isPromise(u)?c=u.then(d):c=d(),c.abort=()=>{var h;l.done||(h=l.abort)==null||h.call(l)},c}},hv=e=>class extends(e||F){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(t){var i;return t=Object.assign({},(i=this.encoder)==null?void 0:i.requestData,t),O.safeJsonStringify(t)}decode(t){return O.safeJsonParse(t)}},gv=e=>class extends(e||F).mixin(dv,uv,hv){static get defaultConfig(){return{project:null}}startConfigure(t){this.getConfig("project"),super.startConfigure(t),this._changesToClear=new Map}async doAutoLoad(){const{project:t}=this;return t&&await t.commitAsync(),super.doAutoLoad()}applyProjectResponse(t){const i=this,{project:n}=i;i.applyingProjectResponse=!0;const s=n.fieldMap.startDate,a=n.fieldMap.endDate,o=T.getPath(t,s.dataSource),l=T.getPath(t,a.dataSource);typeof o=="string"&&T.setPath(t,s.dataSource,s.convert(o)),typeof l=="string"&&T.setPath(t,a.dataSource,a.convert(l)),Object.assign(n,t),i._changesToClear.set(i,t),i.applyingProjectResponse=!1}loadCrudManagerData(t,i={}){const n=this,{project:s}=n;n.suspendChangesTracking(),super.loadCrudManagerData(...arguments),t!=null&&t.project&&(s.delayEnteringReplica?s.ion({recordsUnlinked:()=>{n.suspendChangesTracking(),n.applyProjectResponse(t.project),n.resumeChangesTracking()},once:!0}):n.applyProjectResponse(t.project)),n.resumeChangesTracking()}async sync(){const{project:t}=this;if(this.suspendAutoSync(),t&&await t.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(t,i,n){var s,a,o,l,c,d;const u=this;if(!(u.isDestroyed||(s=u.project)!=null&&s.isDestroyed)){if(u.trigger("beforeApplyResponse"),await super.applyResponse(t,i,n),(i!=null&&i.project||u.supportShortSyncResponse&&((a=t==null?void 0:t.pack)!=null&&a.project))&&u.applyProjectResponse(i.project||((o=t==null?void 0:t.pack)==null?void 0:o.project)),u.project){let h=t.type;u.trackResponseType&&(h=i.type||h);const g=`propagating${O.capitalize(h)}Changes`;u.suspendAutoSync(),u[g]=!0;const f=u.project.isInitialCommit&&!u.project.silenceInitialCommit;await u.project.commitAsync(),u[g]=!1,(l=u.resumeAutoSync)==null||l.call(u,f),(c=u.commitRespondedChanges)==null||c.call(u)}(d=u.trigger)==null||d.call(u,"applyResponse")}}applySyncResponse(...t){var i;const n=this,s=(i=n.project)==null?void 0:i.stm.disabled;s===!1&&n.ignoreRemoteChangesInSTM&&n.project.stm.disable(),super.applySyncResponse(...t),s===!1&&n.project.stm.enable()}shouldClearRecordFieldChange(t,i,n){const s=t.getValue(i);return i=t.getFieldDefinition(i),i!=null&&i.isEqual?i.isEqual(s,n):T.isEqual(s,n)}commitRespondedChanges(){this._changesToClear.forEach((t,i)=>{Object.entries(t).forEach(([n,s])=>{this.shouldClearRecordFieldChange(i,n,s)&&delete i.meta.modified[n]})}),this._changesToClear.clear()}applyChangesToStore(t,i,n,...s){const a=super.applyChangesToStore(t,i,n,...s);if(a.size&&this.project)for(const[o,l]of a){const c=t.store.getById(o);c&&this._changesToClear.set(c,l)}return a}},fv=class extends F.mixin(dv){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}get json(){return O.safeJsonStringify(this)}set json(e){typeof e=="string"&&(e=O.safeJsonParse(e)),this.forEachCrudStore(r=>{const t=`${r.storeId}Data`;e[t]&&(r.data=e[t])})}static get defaultConfig(){return{stores:null}}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}toJSON(){const e={};return this.forEachCrudStore((r,t)=>e[`${t}Data`]=r.toJSON()),e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}};fv._$name="AbstractCrudManager";var mv=e=>{var r;return r=class extends(e||ce){static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null}}get assignments(){return this.assignmentStore.allRecords}updateAssignments(t){this.assignmentStore.data=t}get dependencies(){return this.dependencyStore.allRecords}updateDependencies(t){this.dependencyStore.data=t}get resources(){return this.resourceStore.allRecords}updateResources(t){this.resourceStore.data=t}get timeRanges(){return this.timeRangeStore.allRecords}getTimeRanges(t,i){const n=this.timeRangeStore,s=[];for(const a of n)a.isRecurring?s.push(...a.getOccurrencesForDateRange(t,i)):a.startDate<i&&t<a.endDate&&s.push(a);return s}updateTimeRanges(t){this.timeRangeStore.data=t}getResourceTimeRanges(t,i){const n=this.resourceTimeRangeStore,s=[];for(const a of n)a.isRecurring?s.push(...a.getOccurrencesForDateRange(t,i)):a.startDate<i&&t<a.endDate&&s.push(a);return s}},E(r,"$name","ProjectModelCommon"),r},Vr=class extends St.mixin(Ju){get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}};E(Vr,"$name","ResourceTimeRangeModel"),E(Vr,"fields",["resourceId","timeRangeColor"]),E(Vr,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}}),E(Vr,"domIdPrefix","resourcetimerange"),Vr._$name="ResourceTimeRangeModel";var hc=class extends bt.mixin(tv){static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:Vr,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}getRanges({resourceRecord:e,startDate:r,endDate:t}){return e.timeRanges.flatMap(n=>n.supportsRecurring?n.getOccurrencesForDateRange(r,t):n.intersectsRange(r,t)?n:[]).sort((n,s)=>n.startDate-s.startDate)}};E(hc,"$name","ResourceTimeRangeStore"),hc._$name="ResourceTimeRangeStore";var pv=e=>{var r;return r=class extends(e||ce){get _storesWithDates(){return[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore].filter(t=>t)}overrideStoreProcessRecord(t){this._storesWithDates.includes(t)&&!t.$originalProcessRecord&&(t.$originalProcessRecord=Te.before(t,"processRecord",(i,n)=>{(n||t.isLoadingData)&&this.convertRecordToTimeZone(i)}))}attachStore(t){super.attachStore(t),t&&this.timeZone!=null&&this._storesWithDates.includes(t)&&(this.convertStoresToTimeZone([t]),this.overrideStoreProcessRecord())}detachStore(t){if(super.detachStore(t),t&&!t.isDestroyed){const{$originalProcessRecord:i}=t;i&&(i(),t.$originalProcessRecord=null,this.convertStoresToTimeZone([t],null))}}relayStoreChange({source:t,action:i,records:n,replaced:s}){const a=this;a.timeZone!=null&&a._storesWithDates.includes(t)&&["add","replace"].includes(i)&&(!(n!=null&&n.length)&&(s!=null&&s.length)&&(n=s),n.length&&n.forEach(o=>o.timeZone=a.timeZone))}convertStoresToTimeZone(t,i=this.timeZone){var n;const s=this,a=(n=s.stm)==null?void 0:n.autoRecord;a&&(s.stm.autoRecord=!1);for(const o of t)o==null||o.forEach(l=>s.convertRecordToTimeZone(l,i));a&&(s.stmAutoRecord=a)}convertRecordToTimeZone(t,i=this.timeZone){var n;if(t.timeZone!==i){if(t.$ignoreChange=!0,(n=t.baselines)!=null&&n.count)for(const s of t.baselines)t.timeZone!==s.timeZone&&(s.timeZone=t.timeZone),s.convertToTimeZone(i);t.convertToTimeZone(i),t.$ignoreChange=!1}}updateTimeZone(t,i){const n=this,s=n._isConfiguringTimeZone||n.isConfiguring;if(n.trigger("beforeTimeZoneChange",{timeZone:t,oldTimeZone:i,isConfiguring:s}),n.calendarManagerStore.forEach(a=>a.bumpVersion()),n.convertStoresToTimeZone(n._storesWithDates),n._storesWithDates.forEach(a=>n.overrideStoreProcessRecord(a)),n.startDate){const a=i!=null?Mt.fromTimeZone(n.startDate,i):n.startDate;n.startDate=t!=null?Mt.toTimeZone(a,t):a}n.ignoreRecordChanges=!0,n.commitAsync().then(()=>{n.isDestroyed||n.trigger("timeZoneChange",{timeZone:t,oldTimeZone:i,isConfiguring:s}),delete n._isConfiguringTimeZone})}},E(r,"$name","ProjectModelTimeZoneMixin"),E(r,"configurable",{timeZone:{$config:"lazy",value:null}}),r},vv=e=>{var r;return r=class extends(e||ce).mixin(mv,pv){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:St,resourceTimeRangeModelClass:Vr,timeRangeStoreClass:re,resourceTimeRangeStoreClass:hc,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null}}get inlineData(){return O.safeJsonParse(super.json)}set inlineData(t){this.json=t}construct(t={}){super.construct(...arguments),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const t=this;!t.timeRangeStore.stm&&t.stm.addStore(t.timeRangeStore),!t.resourceTimeRangeStore.stm&&t.stm.addStore(t.resourceTimeRangeStore)}attachStore(t){t&&t.ion({name:t.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(t)}detachStore(t){t&&(this.detachListeners(t.$$name),super.detachStore(t))}relayStoreChange(t){return super.relayStoreChange(t),this.trigger("change",{store:t.source,...t,source:this})}updateTimeRangeStore(t,i){this.detachStore(i),this.attachStore(t)}setTimeRangeStore(t){this.timeRangeStore=t}changeTimeRangeStore(t){return t&&!t.isStore&&(t=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},t)),t}updateResourceTimeRangeStore(t,i){this.detachStore(i),this.attachStore(t)}changeResourceTimeRangeStore(t){return t&&!t.isStore&&(t=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},t)),t}setResourceTimeRangeStore(t){this.resourceTimeRangeStore=t}get events(){return this.eventStore.allRecords}updateEvents(t){this.eventStore.data=t}get resourceTimeRanges(){return this.resourceTimeRangeStore.allRecords}updateResourceTimeRanges(t){this.resourceTimeRangeStore.data=t}async loadInlineData(t){return this.isLoadingInlineData=!0,t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),super.loadInlineData(t)}toJSON(){const t=this,i={eventsData:t.eventStore.toJSON(),resourcesData:t.resourceStore.toJSON(),dependenciesData:t.dependencyStore.toJSON(),timeRangesData:t.timeRangeStore.toJSON(),resourceTimeRangesData:t.resourceTimeRangeStore.toJSON()};return t.eventStore.usesSingleAssignment||(i.assignmentsData=t.assignmentStore.toJSON()),i}get json(){return super.json}changeJson(t){return typeof t=="string"&&(t=O.safeJsonParse(t)),t}updateJson(t){t&&this.loadInlineData(t)}afterChange(t,i){super.afterChange(...arguments),i.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},E(r,"configurable",{json:null,timeRangeStore:{value:{id:"timeRanges",modelClass:St},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),r},Zx=e=>class extends e{getCurrentConfig(t){const i=this,n=super.getCurrentConfig(t);if(n){for(const s of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const a=i[s];if(a){a.count&&(n[a.id+"Data"]=a.getInlineData(t));const o=a.getCurrentConfig(t);o&&Object.keys(o).length>0?n[s]=Object.assign(n[s]||{},o):n[s]&&Object.keys(n[s]).length===0&&delete n[s]}}return n.timeRangeStore&&((i.timeRangeStore.originalModelClass===i.timeRangeModelClass||i.timeRangeStore.originalModelClass.$name==="TimeSpan")&&delete n.timeRangeStore.modelClass,n.timeRangeStore.storeId==="timeRanges"&&delete n.timeRangeStore.storeId,Object.keys(n.timeRangeStore).length===1&&delete n.timeRangeStore),i.taskStore.isTaskStore&&(delete n.eventModelClass,delete n.eventStoreClass,delete n.children),n}}},Jx=class extends F{set eventStore(e){const r=this;r.eventStoreDetacher&&r.eventStoreDetacher(),r._eventStore=e,e&&e.autoCommit&&(r.eventStoreDetacher=e.ion({beforecommit:r.onEventStoreBeforeSync,thisObj:r,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const r=this;r.resourceStoreDetacher&&r.resourceStoreDetacher(),r._resourceStore=e,e&&e.autoCommit&&(r.resourceStoreDetacher=e.ion({beforecommit:r.onResourceStoreBeforeSync,thisObj:r,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const r=this;r.assignmentStoreDetacher&&r.assignmentStoreDetacher(),r._assignmentStore=e,e&&e.autoSync&&(r.assignmentStoreDetacher=e.ion({beforecommit:r.onAssignmentStoreBeforeSync,thisObj:r,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const r=this;r.dependencyStoreDetacher&&r.dependencyStoreDetacher(),r._dependencyStore=e,e&&e.autoSync&&(r.dependencyStoreDetacher=e.ion({beforecommit:r.onDependencyStoreBeforeSync,thisObj:r,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){const r=this;return r.removeNonPersistableRecordsToCreate(e),r.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){const r=this;return r.removeNonPersistableRecordsToCreate(e),r.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){const r=this;return r.removeNonPersistableRecordsToCreate(e),r.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){const r=this;return r.removeNonPersistableRecordsToCreate(e),r.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){const r=e.added||[];let t,i;for(i=r.length-1;i>=0;--i)t=r[i],t.isPersistable||r.splice(r.indexOf(t),1);r.length===0&&(e.added.length=0)}shallContinueSync(e){return!!(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}};Jx._$name="ModelPersistencyManager";var XF=xx,Na=class extends Zx(vv(XF)){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:lc,dependencyModelClass:kt,resourceModelClass:Va,assignmentModelClass:dc,eventStoreClass:cc,dependencyStoreClass:eh,resourceStoreClass:zu,assignmentStoreClass:uc}}construct(...e){super.construct(...e),ne.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new Jx({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}};Na.applyConfigs=!0,Na.initClass(),Na._$name="ProjectModel";var th=class extends fv.mixin(gv,uv,hv){static get defaultConfig(){return{projectClass:Na,resourceStoreClass:zu,eventStoreClass:cc,assignmentStoreClass:uc,dependencyStoreClass:eh,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null}}buildProject(){return new this.projectClass(this.buildProjectConfig())}buildProjectConfig(){return T.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}set project(e){const r=this;e!==r._project&&(r.detachListeners("beforeDataReady"),r.detachListeners("afterDataReady"),r._project=e,e&&(r.eventStore=e.eventStore,r.resourceStore=e.resourceStore,r.assignmentStore=e.assignmentStore,r.dependencyStore=e.dependencyStore,r.timeRangeStore=e.timeRangeStore,r.resourceTimeRangeStore=e.resourceTimeRangeStore,e.ion({name:"beforeDataReady",dataReady:()=>r.suspendChangesTracking(),prio:100,thisObj:r}),e.ion({name:"afterDataReady",dataReady:()=>r.resumeChangesTracking(),prio:-100,thisObj:r})),r.eventStore||(r.eventStore={}),r.resourceStore||(r.resourceStore={}),r.assignmentStore||(r.assignmentStore={}),r.dependencyStore||(r.dependencyStore={}))}get project(){return this._project}get timeRangeStore(){var e;return(e=this._timeRangeStore)==null?void 0:e.store}set timeRangeStore(e){var r;this.setFeaturedStore("_timeRangeStore",e,(r=this.project)==null?void 0:r.timeRangeStoreClass)}get resourceTimeRangeStore(){var e;return(e=this._resourceTimeRangeStore)==null?void 0:e.store}set resourceTimeRangeStore(e){var r;this.setFeaturedStore("_resourceTimeRangeStore",e,(r=this.project)==null?void 0:r.resourceTimeRangeStoreClass)}get resourceStore(){var e;return(e=this._resourceStore)==null?void 0:e.store}set resourceStore(e){const r=this;r.setFeaturedStore("_resourceStore",e,r.resourceStoreClass)}get eventStore(){var e;return(e=this._eventStore)==null?void 0:e.store}set eventStore(e){const r=this;r.setFeaturedStore("_eventStore",e,r.eventStoreClass)}get assignmentStore(){var e;return(e=this._assignmentStore)==null?void 0:e.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){var e;return(e=this._dependencyStore)==null?void 0:e.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}setFeaturedStore(e,r,t){var i;const n=this,s=(i=n[e])==null?void 0:i.store;return s!==r&&(r=re.getStore(r,(r==null?void 0:r.storeClass)||t),s&&n.removeStore(s),n[e]=r&&{store:r}||null,n.addPrioritizedStore(n[e])),n[e]}getChangesetPackage(){var e,r;const t=super.getChangesetPackage();return t&&(this.eventStore.usesSingleAssignment||(r=(e=this.eventStore.modelClass.fieldMap)==null?void 0:e.resourceIds)!=null&&r.persist)&&(delete t[this.assignmentStore.storeId],!this.crudStores.some(i=>t[i.storeId]))?null:t}get crudLoadValidationMandatoryStores(){return[this._eventStore.storeId,this._resourceStore.storeId]}};E(th,"$name","CrudManager"),th._$name="CrudManager";var ZF=["eventStore","taskStore","assignmentStore","resourceStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"],JF=["events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges"],Qx=e=>class extends e{static get $name(){return"CurrentConfig"}preProcessCurrentConfigs(t){for(const i of JF)delete t[i];super.preProcessCurrentConfigs(t)}getCurrentConfig(t){const i=this.project.getCurrentConfig(t),n=super.getCurrentConfig(t);if(i){n.project=i;const{crudManager:s}=n;if(s)for(const a of ZF)s[a]&&(i[a]=s[a]);Object.keys(i).length===0&&delete n.project}return delete n.data,delete n.crudManager,n}get widgetClass(){}},e0=e=>!e||Array.isArray(e)?e:[e],t0=(e,r,t)=>e&&e[r]!==!0?e[r]:t,r0=e=>{var r;return r=class extends(e||F){get dateBounds(){return[this.date]}get description(){const t=this,{descriptionRenderer:i}=t;return i?t.callback(i,t,[t]):t.formattedDescription}get formattedDescription(){var t;const i=this,{dateBounds:n,dateFormat:s}=i,a=(t=i.descriptionFormat)!=null?t:e0(i.defaultDescriptionFormat),o=t0(a,0,s),l=n.length>1&&(a==null?void 0:a.length)>1&&b.format(n[0],o)!==b.format(n[1],o);let c=b.format(n[0],o);return l&&(c=b.formatRange(n,t0(a,1,`S${s}${i.dateSeparator}E${s}`))),c}changeDescriptionFormat(t){return e0(t)}get widgetClass(){}},E(r,"$name","Describable"),E(r,"configurable",{dateFormat:"MMMM d, YYYY",dateSeparator:" - ",descriptionFormat:null,descriptionRenderer:null}),r},i0=e=>class extends(e||F){static get $name(){return"SchedulerDom"}getElementFromAssignmentRecord(t,i=!1){var n,s,a;if(this.isPainted&&t){let o=(n=this.foregroundCanvas.syncIdMap)==null?void 0:n[t.id];if(!o&&t.resource.hasLinks){for(const l of t.resource.$links)if(o=(s=this.foregroundCanvas.syncIdMap)==null?void 0:s[`${t.id}_${l.id}`],o)break}return i?o:(a=o==null?void 0:o.syncIdMap)==null?void 0:a.event}return null}getElementFromEventRecord(t,i=(s=>(s=t.resources)==null?void 0:s[0])(),n=!1){var s;if(t.isResourceTimeRange){const o=(s=this.foregroundCanvas.syncIdMap)==null?void 0:s[t.domId];return n?o:o==null?void 0:o.syncIdMap.event}const a=this.assignmentStore.getAssignmentForEventAndResource(t,i);return this.getElementFromAssignmentRecord(a,n)}getElementsFromEventRecord(t,i,n=!1){return i?[this.getElementFromEventRecord(t,i,n)]:t.resources.reduce((s,a)=>{const o=this.getElementFromEventRecord(t,a,n);return o&&s.push(o),s},[])}resolveResourceRecord(t,i){return this.currentOrientation.resolveRowRecord(t,i)}resolveRowRecord(t){return this.resolveResourceRecord(t)}resolveEventRecord(t){t instanceof Event&&(t=t.target);const i=t==null?void 0:t.closest(this.eventSelector);if(i){if(i.dataset.eventId)return this.eventStore.getById(i.dataset.eventId);if(i.dataset.assignmentId)return this.assignmentStore.getById(i.dataset.assignmentId).event}return null}resolveTimeSpanRecord(t){return this.resolveEventRecord(t)}resolveAssignmentRecord(t){const i=t.closest(this.eventSelector),n=i&&this.assignmentStore.getById(i.dataset.assignmentId),s=i&&this.eventStore.getById(i.dataset.eventId);return this.assignmentStore.getOccurrence(n,s)}isRowVisible(t){return this.store.indexOf(t)>=0}get widgetClass(){}},n0=e=>class extends(e||F){static get $name(){return"SchedulerDomEvents"}getTimeSpanMouseEventParams(t,i){const n=this.resolveEventRecord(t);return n&&{eventRecord:n,resourceRecord:this.resolveResourceRecord(t),assignmentRecord:this.resolveAssignmentRecord(t),eventElement:t,event:i}}getScheduleMouseEventParams(t,i){return{resourceRecord:this.isVertical?this.resolveResourceRecord(i):this.store.getById(t.id)}}onElementKeyDown(t){const i=super.onElementKeyDown(t),n=this;return n.selectedEvents.length&&n.trigger(n.scheduledEventName+"KeyDown",{eventRecords:n.selectedEvents,assignmentRecords:n.selectedAssignments,event:t,eventRecord:n.selectedEvents,assignmentRecord:n.selectedAssignments}),i}onElementKeyUp(t){super.onElementKeyUp(t);const i=this;i.selectedEvents.length&&i.trigger(i.scheduledEventName+"KeyUp",{eventRecords:i.selectedEvents,assignmentRecords:i.selectedAssignments,event:t,eventRecord:i.selectedEvents,assignmentRecord:i.selectedAssignments})}get widgetClass(){}},yv=class extends F{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}applyLayout(e,r){return this.nbrOfBandsByResource[r.id]=this.layoutEventsInBands(e,r)}layoutEventsInBands(e,r){throw new Error("Implement in subclass")}};yv._$name="HorizontalLayout";var rh=class extends yv{static get $name(){return"HorizontalLayoutStack"}static get configurable(){return{type:"stack"}}layoutEventsInBands(e,r,t=!1){let i=0;do{let n=0,s=e[0];for(;s;)t||(s.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,i,s.eventRecord,s.resourceRecord)),e.splice(n,1),n=this.findClosestSuccessor(s,e),s=e[n];i++}while(e.length>0);return i}findClosestSuccessor(e,r){const{endMS:t,group:i}=e,n=e.eventRecord&&e.eventRecord.duration===0;let s=1/0,a,o,l;for(let c=0,d=r.length;c<d;c++)if(l=r[c],o=l.startMS-t,o>=0&&o<s&&(o>0||l.endMS-l.startMS>0||!n)){if(this.grouped&&i!==l.group)break;a=c,s=o}return a}};rh._$name="HorizontalLayoutStack";var bv=e=>class extends(e||F){static get $name(){return"PackMixin"}static get defaultConfig(){return{coordProp:"top",sizeProp:"height",inBandCoordProp:"inBandTop",inBandSizeProp:"inBandHeight"}}isSameGroup(t,i){return this.grouped?t.group===i.group:!0}packEventsInBands(t,i){const n=this,{coordProp:s,sizeProp:a}=n;let o,l,c,d;for(let u=0,h=t.length;u<h;u++){if(l=t[u],o=n.findStartSlot(t,l),c=n.getCluster(t,u),c.length>1){for(l[s]=o.start,l[a]=o.end-o.start,d=1;d<c.length-1&&c[d+1].start-l.start===0;)d++;const m=n.findStartSlot(t,c[d]);m&&m.start<.8&&(c.length=d)}const g=c.length,f=(o.end-o.start)/g;for(d=0;d<g;d++)i(c[d],d,o,f);u+=g-1}return 1}findStartSlot(t,i){const{inBandSizeProp:n,inBandCoordProp:s,coordProp:a,sizeProp:o}=this,l=this.getPriorOverlappingEvents(t,i);let c;if(l.length===0)return{start:0,end:1};for(c=0;c<l.length;c++){const d=l[c],u=s in d?s:a,h=n in d?n:o;if(c===0&&d[u]>0)return{start:0,end:d[u]};if(d[u]+d[h]<(c<l.length-1?l[c+1][u]:1))return{start:d[u]+d[h],end:c<l.length-1?l[c+1][u]:1}}return!1}getPriorOverlappingEvents(t,i){const n=i.start,s=i.end,a=[];for(let o=0,l=t.indexOf(i);o<l;o++){const c=t[o];this.isSameGroup(c,i)&&b.intersectSpans(n,s,c.start,c.end)&&a.push(c)}return a.sort(this.sortOverlappers.bind(this)),a}sortOverlappers(t,i){const{coordProp:n}=this;return t[n]-i[n]}getCluster(t,i){const n=t[i],s=[n];if(i>=t.length-1)return s;let{start:a,end:o}=n;for(let l=i+1,c=t.length;l<c;l++){const d=t[l];if(!this.isSameGroup(d,n)||!b.intersectSpans(a,o,d.start,d.end))break;s.push(d),a=b.max(a,d.start),o=b.min(d.end,o)}return s}},ih=class extends yv.mixin(bv){static get $name(){return"HorizontalLayoutPack"}static get configurable(){return{type:"pack"}}layoutEventsInBands(e){const r=this.packEventsInBands(e,(t,i,n,s)=>{t.height=s,t.top=n.start+i*s});return e.forEach(t=>{Object.assign(t,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,t.top,t.height,t.eventRecord,t.resourceRecord))}),r}};ih._$name="HorizontalLayoutPack";var Cv=e=>{var r;return r=class extends(e||F){get resourceColumns(){var t;return((t=this.timeAxisColumn)==null?void 0:t.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){var t;return((t=this.resourceColumns)==null?void 0:t.columnWidth)||null}getResourceMargin(t){var i;return(i=t==null?void 0:t.resourceMargin)!=null?i:this.resourceMargin}getBarMargin(t){var i;return(i=t==null?void 0:t.barMargin)!=null?i:this.barMargin}getResourceHeight(t){var i;return(i=t.rowHeight)!=null?i:this.isHorizontal?this.rowHeight:this.getResourceWidth(t)}getResourceWidth(t){var i;return(i=t.columnWidth)!=null?i:this.resourceColumnWidth}getAppliedResourceHeight(t){var i;const n=this.getRowById(t);return(i=n==null?void 0:n.maxRequestedHeight)!=null?i:this.getResourceHeight(t)}getResourceLayoutSettings(t,i=null){const n=this.getResourceMargin(t,i),s=this.getAppliedResourceHeight(t,i);return{barMargin:this.getBarMargin(t,i),contentHeight:Math.max(s-n*2,1),rowHeight:s,resourceMargin:n}}get widgetClass(){}},E(r,"$name","SchedulerResourceRendering"),E(r,"configurable",{resourceMargin:null,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg"}),r},s0=e=>class extends Cv(e||F){static get $name(){return"SchedulerEventRendering"}static get configurable(){return{milestoneTextPosition:"outside",milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",eventLayout:"stack",overlappingEventSorter:null,horizontalEventSorterFn:null,resourceMargin:null,useInitialAnimation:!0,eventRenderer:null,eventRendererThisObj:null,eventBarTextField:"name",eventBodyTemplate:null,horizontalLayoutPackClass:ih,horizontalLayoutStackClass:rh,isFirstRender:!0,initialAnimationDuration:2e3,narrowEventWidth:10,internalEventLayout:null,eventPositionMode:"translate",eventScrollMode:"move"}}changeEventLayout(t){return this.internalEventLayout=t,this.internalEventLayout.type}changeInternalEventLayout(t){return this.getEventLayout(t)}updateInternalEventLayout(t,i){const n=this;i&&n.element.classList.remove(`b-eventlayout-${i.type}`),n.element.classList.add(`b-eventlayout-${t.type}`),n.isConfiguring||(n.refreshWithTransition(),n.trigger("stateChange"))}changeHorizontalEventSorterFn(t){ne.deprecate("Scheduler","6.0.0","Replaced by overlappingEventSorter()"),this.overlappingEventSorter=t}updateOverlappingEventSorter(t){this.isConfiguring||this.refreshWithTransition()}getEventLayout(t){return t!=null&&t.isModel&&(t=t.eventLayout||this.internalEventLayout),typeof t=="string"&&(t={type:t}),t}getEventLayoutHandler(t){const i=this;if(!i.isHorizontal)return null;const{timeAxisViewModel:n,horizontal:s}=i,{type:a}=t;switch(i.layouts||(i.layouts={}),a){case"stack":return i.layouts.horizontalStack||(i.layouts.horizontalStack=new i.horizontalLayoutStackClass(T.assign({scheduler:i,timeAxisViewModel:n,bandIndexToPxConvertFn:s.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:s},t))),i.layouts.horizontalStack;case"pack":return i.layouts.horizontalPack||(i.layouts.horizontalPack=new i.horizontalLayoutPackClass(T.assign({scheduler:i,timeAxisViewModel:n,bandIndexToPxConvertFn:s.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:s},t))),i.layouts.horizontalPack;default:return null}}getEventsToRender(t,i){return i}repaintEventsForResource(t){this.currentOrientation.repaintEventsForResource(t)}repaintEvent(t){this.eventStore.getResourcesForEvent(t).forEach(n=>this.repaintEventsForResource(n))}getEventStyle(t,i){return t.eventStyle||i.eventStyle||this.eventStyle}getEventColor(t,i){var n,s;return t.eventColor||((n=t.event)==null?void 0:n.eventColor)||((s=t.parent)==null?void 0:s.eventColor)||i.eventColor||this.eventColor}generateRenderData(t,i,n={viewport:!0}){var s,a;const o=this,l=o.currentOrientation.getTimeSpanRenderData(t,i,n),{isEvent:c}=t,{eventResize:d}=o.features,u=!t.meta.isDragCreating&&t.isMilestone,h=c&&t.assignments.find(f=>f.resourceId===i.$originalId),g={className:"b-sch-event-content",role:"presentation",dataset:{taskBarFeature:"content"}};if(l){l.tabIndex="0";let f=t.isResizable;d&&f&&(l.startsOutsideView&&(f===!0?f="end":f==="start"&&(f=!1)),l.endsOutsideView&&(f===!0?f="start":f==="end"&&(f=!1)),f&&(o.isHorizontal?!o.rtl&&!d.leftHandle||o.rtl&&!d.rightHandle?f=f==="start"?!1:"end":(!o.rtl&&!d.rightHandle||o.rtl&&!d.leftHandle)&&(f=f==="end"?!1:"start"):d.topHandle?d.bottomHandle||(f=f==="end"?!1:"start"):f=f==="start"?!1:"end"));const m=!!(t.hasPersistableChanges||h!=null&&h.hasPersistableChanges),p={[i.cls]:i.cls,[o.generatedIdCls]:!t.isOccurrence&&t.hasGeneratedId,[o.dirtyCls]:m,[o.committingCls]:t.isCommitting,[o.endsOutsideViewCls]:l.endsOutsideView,[o.startsOutsideViewCls]:l.startsOutsideView,"b-clipped-start":l.clippedStart,"b-clipped-end":l.clippedEnd,"b-iscreating":t.isCreating,"b-rtl":o.rtl},v={[`${o.eventCls}-parent`]:i.isParent,"b-readonly":t.readOnly||(h==null?void 0:h.readOnly),"b-linked-resource":i.isLinked,"b-original-resource":i.hasLinks},y=t.isResourceTimeRange?new J:t.internalCls.clone(),C=t.isResourceTimeRange?t.internalCls.clone():new J;if(l.wrapperStyle="",l.isWrap=!0,c){const R=h&&o.isAssignmentSelected(h);T.assign(p,{[o.eventCls]:1,"b-milestone":u,"b-sch-event-narrow":!u&&l.width<o.narrowEventWidth,[o.fixedEventCls]:t.isDraggable===!1,[`b-sch-event-resizable-${f}`]:!!(d&&!t.readOnly),[o.eventSelectedCls]:R,[o.eventAssignHighlightCls]:o.eventAssignHighlightCls&&!R&&o.isEventSelected(t),"b-recurring":t.isRecurring,"b-occurrence":t.isOccurrence,"b-inactive":t.inactive}),l.eventId=t.id;const I=o.getEventStyle(t,i),M=o.getEventColor(t,i),P=o.isFirstRender&&o.useInitialAnimation&&globalThis.bryntum.noAnimations!==!0;if(T.assign(v,{[`${o.eventCls}-wrap`]:1,"b-milestone-wrap":u}),P){const _=l.row?l.row.index:(l.top-o.scrollTop)/o.tickSize,A=_/20*1e3;l.wrapperStyle=`animation-delay: ${A}ms;`,o.maxDelay=Math.max(o.maxDelay||0,A),o.initialAnimationDetacher||(o.initialAnimationDetacher=B.on({element:o.foregroundCanvas,delegate:o.eventSelector,once:!0,animationend:()=>o.setTimeout({fn:"stopInitialAnimation",delay:o.maxDelay,cancelOutstanding:!0}),expires:{alt:"stopInitialAnimation",delay:o.initialAnimationDuration+o.maxDelay},thisObj:o}))}l.eventColor=M,l.eventStyle=I,l.assignmentRecord=l.assignment=h}if(l.wrapperCls=T.assign(C,v),l.cls=T.assign(y,p),l.iconCls=new J(t.getValue(o.eventBarIconClsField)||t.iconCls),t.isResourceTimeRange?(l.style="",l.wrapperStyle+=t.style||""):l.style=t.style||"",l.resource=l.resourceRecord=i,l.resourceId=l.rowId,c){let R=null,I=null,M;if(o.eventRenderer){const P=o.eventRenderer.call(o.eventRendererThisObj||o,{eventRecord:t,resourceRecord:i,assignmentRecord:l.assignmentRecord,renderData:l});typeof l.cls=="string"&&(l.cls=new J(l.cls)),typeof l.wrapperCls=="string"&&(l.wrapperCls=new J(l.wrapperCls)),typeof l.iconCls=="string"&&(l.iconCls=new J(l.iconCls)),o.eventBodyTemplate?M=o.eventBodyTemplate(P):M=P}else o.eventBodyTemplate?M=o.eventBodyTemplate(t):o.eventBarTextField&&(M=O.encodeHtml(t.getValue(o.eventBarTextField)||""));!o.eventBodyTemplate||Array.isArray(M)?(g.children=[],u&&(o.milestoneLayoutMode==="default"||o.milestoneTextPosition==="always-outside")&&M!=null&&M!==""&&g.children.unshift(I={tag:"label",children:[]}),(s=l.iconCls)!=null&&s.length&&g.children.unshift({tag:"i",className:l.iconCls}),Array.isArray(M)?(I||g).children.push(...M):O.isHtml(M)?g.children.length?R={tag:"span",class:"b-event-text-wrap",html:M}:(g.children=null,g.html=M):typeof M=="string"||typeof M=="object"?R=M:M!=null&&(R=String(M)),R!=null&&((I||g).children.push(R),l.cls.add("b-has-content")),(g.html!=null||g.children.length)&&l.children.push(g)):(g.html=M,l.children.push(g))}const{eventStyle:D,eventColor:S,wrapperCls:x}=l;if(x[`b-sch-style-${D||"none"}`]=1,w.isNamedColor(S))x[`b-sch-color-${S}`]=S;else if(S){const R=D?"color":"background-color",I=`${R}:${S};`;l.style=I+l.style,x["b-sch-custom-color"]=1,l._customColorStyle=I}else x["b-sch-color-none"]=1;l.style&&u&&g&&(g.style=l.style,delete l.style),l.cls["b-sch-event-withicon"]=(a=l.iconCls)==null?void 0:a.length,l.eventContent=g,l.wrapperChildren=[],o.onEventDataGenerated(l)}return l}onEventDataGenerated(t){}changeUseInitialAnimation(t){return t===!0?"fade-in":t}updateUseInitialAnimation(t,i){const{classList:n}=this.element;i&&n.remove(`b-initial-${i}`),t&&(n.add(`b-initial-${t}`),q.isFirefox&&n.add("b-prevent-event-transitions"))}restartInitialAnimation(t){var i;const n=this;(i=n.initialAnimationDetacher)==null||i.call(n),n.initialAnimationDetacher=null,n.useInitialAnimation=t,n.isFirstRender=!0,n.refresh()}stopInitialAnimation(){const t=this;t.initialAnimationDetacher(),t.isFirstRender=!1,t.useInitialAnimation=!1,q.isFirefox&&t.setTimeout(()=>t.element.classList.remove("b-prevent-event-transitions"),100)}getMilestoneLabelWidth(t,i){const n=this,s=n.milestoneLayoutMode,a=n.getResourceLayoutSettings(i).contentHeight;if(s==="measure"){const o=O.encodeHtml(t.name),l=n.getEventColor(t,i),c=n.getEventStyle(t,i),d=n.milestoneMeasureElement||(n.milestoneMeasureElement=w.createElement({className:{"b-sch-event-wrap":1,"b-milestone-wrap":1,"b-measure":1,[`b-sch-color-${l}`]:l,[`b-sch-style-${c}`]:c},children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content",children:[{tag:"label"}]}]}],parent:n.foregroundCanvas}));if(d.retainElement=!0,d.style.fontSize=`${a}px`,n.milestoneTextPosition==="always-outside"){const u=d.firstElementChild.firstElementChild.firstElementChild;u.innerHTML=o;const h=k.from(u,u.parentElement);return h.left+h.width+2}else return d.firstElementChild.firstElementChild.innerHTML=`<label></label>${o}`,d.firstElementChild.offsetWidth}return s==="estimate"?t.name.length*n.milestoneCharWidth+(n.milestoneTextPosition==="always-outside"?a:0):s==="data"?t.milestoneWidth:0}updateMilestoneLayoutMode(t){const i=this,n=i.milestoneTextPosition==="always-outside";i.element.classList.toggle("b-sch-layout-milestones",t!=="default"&&!n),i.element.classList.toggle("b-sch-layout-milestone-labels",t!=="default"&&n),i.isConfiguring||i.refreshWithTransition()}updateMilestoneTextPosition(t){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside",t==="inside"),this.updateMilestoneLayoutMode(this.milestoneLayoutMode)}updateMilestoneAlign(){this.isConfiguring||this.refreshWithTransition()}updateMilestoneCharWidth(){this.isConfiguring||this.refreshWithTransition()}get widgetClass(){}},a0=["assignmentStore","dependencyStore","eventStore","resourceStore"],Sv=e=>{var r,t;return t=class extends(e||F){constructor(){super(...arguments),NC(this,r,void 0)}static get $name(){return"ProjectConsumer"}static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:Na,project:{},destroyStores:null,projectSubscribers:[]}}startConfigure(i){this.getConfig("project"),super.startConfigure(i)}changeProject(i,n){const s=this,{projectStoreNames:a,projectDataNames:o}=s.constructor;if(s.projectCallbacks=new Set,i){if(s.buildingProjectConfig=!0,!i.isModel){if(s.isConfiguring){s._project=i;const{crudManager:d}=s;if(d){const{isCrudManager:u}=d;for(const h of a)d[h]&&(s[h]=d[h],u||delete d[h])}s.getConfig("projectStores");for(const u of o)s.getConfig(u)}const{eventStore:l}=i;let{_sharedProject:c}=s;if(l&&!l.isEventStoreMixin&&l.autoLoad&&!l.count&&(l.autoLoad=!1,s.delayAutoLoad=!0),c&&a0.some(d=>i[d]&&i[d]!==c[d])){for(const d of a0)i[d]&&i[d]===c[d]&&(i[d]=i[d].chain());c=null}i=c||new s.projectModelClass(i),delete s._project}s.buildingProjectConfig=!1}return i}updateProject(i,n){var s;const a=this,{projectListeners:o,crudManager:l}=a;if(a.detachListeners("projectConsumer"),delete a._crudManager,i){o.thisObj=a,i.ion(o),i.isCrudManager?a.crudManager=i:l&&(l.project=i,a.crudManager=l),a.projectSubscribers.forEach(c=>{c.detachFromProject(n),c.attachToProject(i)});for(const c of a.constructor.projectStoreNames)a[c]=i[c];a.delayAutoLoad&&(i.eventStore.autoLoad=!0,i.eventStore.load()),(s=i.stm)==null||s.ion({name:"projectConsumer",restoringStart:"onProjectRestoringStart",restoringStop:"onProjectRestoringStop",thisObj:a})}a.trigger("projectChange",{project:i})}changeCrudManager(i){if(this.buildingProjectConfig)this._crudManager=i.isCrudManager?i:Object.assign({},i);else return super.changeCrudManager(i)}onProjectDataReady(){const i=this;i.whenVisible(()=>{i.projectCallbacks.size&&(i.projectCallbacks.forEach(n=>n()),i.projectCallbacks.clear())},null,null,"onProjectDataReady")}onProjectRestoringStart({stm:i}){const{rawQueue:n}=i;n.length&&n[n.length-1].length>1&&(Ks(this,r,!0),this.suspendRefresh())}onProjectRestoringStop(){VC(this,r)&&(Ks(this,r,!1),this.resumeRefresh(!0))}onBeforeTimeZoneChange(){}onTimeZoneChange({timeZone:i,oldTimeZone:n}){const s=this;if(s.startDate&&s.timeAxis.timeZone!==i){const a=n!=null?Mt.fromTimeZone(s.startDate,n):s.startDate;s.startDate=i!=null?Mt.toTimeZone(a,i):a,s.timeAxis.timeZone=i}}onStartApplyChangeset(){this.suspendRefresh()}onEndApplyChangeset(){this.resumeRefresh(!0)}whenProjectReady(i){this.isEngineReady?i():this.projectCallbacks.add(i)}get isEngineReady(){var i,n;return!!((n=(i=this.project).isEngineReady)!=null&&n.call(i))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:i}=this.constructor;return i.map(n=>this[n])}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce((i,n)=>{const{dataName:s}=this.projectStores[n];return s&&i.push(s),i},[])}static setupProjectStores(i,n){const{projectStores:s}=i;if(s){const a={name:"projectConsumer",dataReady:"onProjectDataReady",change:"relayProjectDataChange",beforeTimeZoneChange:"onBeforeTimeZoneChange",timeZoneChange:"onTimeZoneChange",startApplyChangeset:"onStartApplyChangeset",endApplyChangeset:"onEndApplyChangeset"},o={projectListeners:a};let l;for(const c in s){const{dataName:d}=s[c];o[c]=o[d]=null,d&&(Object.defineProperty(n.class.prototype,d,{configurable:!0,get(){var u;return(u=this.project[c])==null?void 0:u.records}}),this.createDataUpdater(c,d,l,n)),this.createStoreDescriptor(n,c,s[c],a),l=d}this.setupConfigs(n,o)}}static createDataUpdater(i,n,s,a){a.class.prototype[`update${O.capitalize(n)}`]=function(o){const{project:l}=this;s&&this.getConfig(s),this.buildingProjectConfig?l[`${n}Data`]=o:l[i].data=o}}static createStoreDescriptor(i,n,{listeners:s},a){const{prototype:o}=i.class,l=O.capitalize(n);a[`${n}Change`]=function({store:c}){this[n]=c},o[`change${l}`]=function(c,d){const u=this,{project:h}=u,g=c==null?void 0:c.project;if(u.buildingProjectConfig){g!=null&&g.isProjectModel&&(u._sharedProject=g),h[n]=c;return}return u.initializingProject||h[n]!==c&&(h[`set${l}`](c),c=h[n]),c!==d&&(s&&(s.thisObj=u,s.name=`${n}Listeners`,u.detachListeners(s.name),c.ion(s)),u[`_${n}`]=c,u.projectSubscribers.forEach(f=>{var m;(m=f[`attachTo${l}`])==null||m.call(f,c)}),u[`_${n}`]=null),c}}relayProjectDataChange(i){if(!((i.isExpand||i.isCollapse)&&!i.records[0].fieldMap.expanded.persist))return this.trigger("dataChange",{project:i.source,...i,source:this})}get widgetClass(){}},r=new WeakMap,t},Dv=e=>class extends Sv(e||F){static get $name(){return"SchedulerStores"}static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"onBeforeLoad"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}static get configurable(){return{store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:ne.checkVersion("core","6.0",">="),crudManagerClass:null,crudManager:null}}updateProject(t,i){super.updateProject(t,i),this.detachListeners("schedulerStores"),t.ion({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({isInitialCommit:t}){const i=this;i.isVisible?(t&&i.isVertical&&(i.refreshAfterProjectRefresh=!1,i.refreshWithTransition()),i.navigateToAfterRefresh&&(i.navigateTo(i.navigateToAfterRefresh),i.navigateToAfterRefresh=null),i.refreshAfterProjectRefresh&&(i.refreshWithTransition(!1,!t),i.refreshAfterProjectRefresh=!1)):i.whenVisible("refresh",i,[!0])}changeCrudManager(t){const i=this;t&&!t.isCrudManager&&(t=i.crudManagerClass.new({scheduler:i},t)),i._crudManager=t,i.bindCrudManager(t)}get store(){return!this._store&&this.isVertical&&(this._store=new re({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}]})),super.store}set store(t){super.store=t}refreshFromRowOnStoreAdd(t,{isExpand:i,records:n}){const s=arguments;this.runWithTransition(()=>{this.currentOrientation.suspended=!i&&!n.some(a=>a.isLinked),super.refreshFromRowOnStoreAdd(t,...s),this.currentOrientation.suspended=!1},!i)}onStoreAdd(t){super.onStoreAdd(t),this.isPainted&&this.calculateRowHeights(t.records)}onStoreUpdateRecord({source:t,record:i,changes:n}){let s=0;"assigned"in n&&s++,"calendar"in n&&s++,s!==Object.keys(n).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(t){t&&this.isHorizontal&&(t.metaMapId=this.id,this.store=t)}get usesDisplayStore(){return this.store!==this.resourceStore}onEventIdChange(t){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(t)}onEventStoreBatchedUpdate(t){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(t)}onInternalEventStoreChange(t){!this.isPainted||!this._mode||t.isAssign||this.assignmentStore.isRemovingAssignment||(this.isVisible?this.currentOrientation.onEventStoreChange(t):this.whenVisible(this.onInternalEventStoreChange,this,[t]))}onEventCommit({changes:t}){let i=[...t.added,...t.modified].map(n=>this.eventStore.getResourcesForEvent(n));i=Array.prototype.concat.apply([],i),new Set(i).forEach(n=>this.repaintEventsForResource(n))}onEventCommitStart({changes:t}){const{currentOrientation:i,committingCls:n}=this;[...t.added,...t.modified].forEach(s=>s.assignments.forEach(a=>i.toggleCls(a,n,!0)))}onEventException({action:t}){if(t==="commit"){const{changes:i}=this.eventStore;[...i.added,...i.modified,...i.removed].forEach(n=>this.repaintEvent(n))}}onAssignmentCommit({changes:t}){this.repaintEventsForAssignmentChanges(t)}onAssignmentCommitStart({changes:t}){const{currentOrientation:i,committingCls:n}=this;[...t.added,...t.modified].forEach(s=>{i.toggleCls(s,n,!0)})}onAssignmentException({action:t}){t==="commit"&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}repaintEventsForAssignmentChanges(t){const i=[...t.added,...t.modified,...t.removed].map(n=>n.getResource());new Set(i).forEach(n=>this.repaintEventsForResource(n))}onAssignmentBeforeRemove({records:t,removingAll:i}){if(i)return;const n=this;let s;if(!n.isConfiguring&&(n.navigateToAfterRefresh||n.activeAssignment&&t.includes(n.activeAssignment))){if(t.includes(n.navigateToAfterRefresh)&&(n.navigateToAfterRefresh=null),be.lastInteractionType==="key")for(let a=0,o=t.length;a<o&&!s;a++){const l=t[a];if(l.resource&&l.resource.isModel){let c=n.getNext(l);(!c||t.includes(c))&&(c=n.getPrevious(l)),c&&!t.includes(c)&&(s=c)}}s?(n.navigateTo(s),n.navigateToAfterRefresh=s):w.focusWithoutScrolling(n.focusElement)}}set timeRanges(t){this.project.timeRanges=t}get timeRanges(){return this.project.timeRanges}set resourceTimeRanges(t){this.project.resourceTimeRanges=t}get resourceTimeRanges(){return this.project.resourceTimeRanges}onBeforeLoad({params:t}){this.applyStartEndParameters(t)}getResourcesEventsPerTick(t,i){const{timeAxis:n,resourceStore:s}=this,a=[];return t=t||s.records,t.forEach(o=>{o.events.forEach(l=>{if(!n.isTimeSpanInAxis(l)||i&&!i.call(this,{resource:o,event:l}))return;let c=Math.floor(n.getTickFromDate(l.startDate)),d=Math.ceil(n.getTickFromDate(l.endDate));c==-1&&(c=0),d===-1&&(d=n.ticks.length);do a[c]?a[c].push(l):a[c]=[l];while(++c<d)})}),a}get widgetClass(){}},nh={block:"nearest",edgeOffset:20},QF={highlight:!1,focus:!1},o0=e=>class extends(e||F){static get $name(){return"SchedulerScroll"}async scrollEventIntoView(t,i=nh){const n=this,s=t.resources||[t];if(s.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");s.length||console.warn("You have asked to scroll to an event which is not assigned to a resource"),await n.scrollResourceEventIntoView(s[0],t,i)}scrollAssignmentIntoView(t,...i){return this.scrollResourceEventIntoView(t.resource,t.event,...i)}async scrollResourceEventIntoView(t,i,n=nh){var s;const a=this,o=i.startDate,l=i.endDate,c=i.isScheduled&&o<a.timeAxis.startDate|(l>a.timeAxis.endDate)<<1;arguments.length>3&&(n=arguments[3]);let d;if(n.edgeOffset==null&&(n.edgeOffset=20),c&&n.extendTimeAxis!==!1){const u=a.timeAxis.endDate-a.timeAxis.startDate;if(c===3)await a.setTimeSpan(new Date(o.valueOf()-u/2),new Date(l.valueOf()+u/2));else if(a.infiniteScroll){const{visibleDateRange:h}=a,g=h.endMS-h.startMS,f=c&1?1:-1;await a.setTimeSpan(new Date(o.valueOf()-u/2),new Date(o.valueOf()+u/2),{visibleDate:new Date(l.valueOf()+f*g)})}else c&1?await a.setTimeSpan(new Date(o),new Date(o.valueOf()+u)):await a.setTimeSpan(new Date(l.valueOf()-u),new Date(l))}a.store.tree&&await((s=a.expandTo)==null?void 0:s.call(a,t)),i.parent&&!i.parent.isRoot&&await this.scrollEventIntoView(i.parent),d=a.getElementFromEventRecord(i,t),d?(w.isFocusable(d)||(d=d.parentNode),await a.timeAxisSubGrid.scrollable.scrollIntoView(d,n)):c===3&&n.extendTimeAxis===!1?console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"):!i.isOccurrence&&!a.eventStore.isAvailable(i)?console.warn("You have asked to scroll to an event which is not available"):i.isScheduled?await a.scrollUnrenderedEventIntoView(t,i,n):await a.scrollResourceIntoView(t,n)}scrollUnrenderedEventIntoView(t,i,n=nh){return new Promise(s=>{const a=this,o=Object.assign({edgeOffset:20},n,QF),l=a.timeAxisSubGrid.scrollable,c=a.getResourceEventBox(i,t),d=l.viewport;if(!d||!c){s();return}c.x=Math.ceil(c.x),c.y=Math.ceil(c.y),a.rtl&&c.translate(-a.timeAxisViewModel.totalSize+d.width,0),c.translate(d.x-l.scrollLeft,d.y-l.y);const u=async({eventRecord:f,element:m,targetElement:p})=>{if(f===i){const v=m||p;h(),await g,n.highlight&&w.highlight(v),n.focus&&v.focus(),s()}},h=a.ion({renderEvent:u}),g=l.scrollIntoView(c,o);g.then(()=>{g.cancelled&&s()})})}scrollResourceIntoView(t,i=nh){return this.isVertical?this.currentOrientation.scrollResourceIntoView(t,i):this.scrollRowIntoView(t,i)}get widgetClass(){}},l0=e=>class extends(e||F){static get $name(){return"SchedulerRegions"}getScheduleRegion(t,i,n=!0,s){return this.currentOrientation.getScheduleRegion(...arguments)}getResourceRegion(t,i,n){return this.currentOrientation.getRowRegion(...arguments)}getAssignmentEventBox(t,i){return this.getResourceEventBox(t.event,t.resource,i)}getResourceEventBox(t,i,n=!1,s=!1){return this.currentOrientation.getResourceEventBox(...arguments)}getItemBox(t,i=!1){return t.resources.map(n=>this.getResourceEventBox(t,n,i))}get widgetClass(){}},c0=["eventLayout","mode","eventColor","eventStyle","tickSize","fillTicks"],d0=e=>class extends(e||F){static get $name(){return"SchedulerState"}getState(){return T.copyProperties(super.getState(),this,c0)}applyState(t){var i;this.suspendRefresh();let n=c0.slice();(t==null?void 0:t.eventLayout)==="layoutFn"&&(delete t.eventLayout,n.splice(n.indexOf("eventLayout"),1)),(i=t==null?void 0:t.zoomLevelOptions)!=null&&i.width&&(n=n.filter(s=>s!=="tickSize")),T.copyProperties(this,t,n),super.applyState(t),this.resumeRefresh(!0)}get widgetClass(){}},u0=e=>class extends(e||F){static get $name(){return"EventSelection"}static get configurable(){return{highlightPredecessors:!1,highlightSuccessors:!1,deselectOnClick:!1,deselectAllOnScheduleClick:!0,selectedCollection:{}}}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected"}}afterConstruct(){var t;super.afterConstruct(),(t=this.navigator)==null||t.ion({navigate:"onEventNavigate",thisObj:this})}changeSelectedCollection(t){return t.isCollection||(t=new $t(t)),t}updateSelectedCollection(t){const i=this;t.owner||(t.owner=i),t.ion({change:(...n)=>i.project.deferUntilRepopulationIfNeeded("onSelectedCollectionChange",(...s)=>!i.isDestroying&&i.onSelectedCollectionChange(...s),n),beforeSplice:"onBeforeSelectedCollectionSplice",thisObj:i})}get selectedCollection(){return this._selectedCollection}getActionType(t,i,n){return t.length>0?i.length>0&&n.length>0?"update":i.length>0?"select":"deselect":"clear"}getEventsFromAssignments(t){return H.unique(t.map(i=>i.event))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(t){const i=[];t=H.asArray(t),t==null||t.forEach(n=>{this.isEventSelectable(n)!==!1&&(n.isOccurrence?n.assignments.forEach(s=>{i.push(this.assignmentStore.getOccurrence(s,n))}):i.push(...n.assignments))}),this.selectedCollection.splice(0,this.selectedCollection.count,i)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(t){this.selectedCollection.splice(0,this.selectedCollection.count,t||[])}isEventSelected(t){const{selectedCollection:i}=this;return!!(i.count&&i.includes(t.assignments))}isEventSelectable(t){}isAssignmentSelected(t){return this.selectedCollection.includes(t)}select(t,i=!1){t.isAssignment?this.selectAssignment(t,i):this.selectEvent(t,i)}selectEvent(t,i=!1){this.isEventSelected(t)||this.selectEvents([t],i)}selectAssignment(t,i=!1,n){this.isAssignmentSelected(t)||(i?this.selectedCollection.add(t):this.selectedAssignments=t)}deselect(t){t.isAssignment?this.deselectAssignment(t):this.deselectEvent(t)}deselectEvent(t){this.isEventSelected(t)&&this.selectedCollection.remove(...t.assignments)}deselectAssignment(t){this.isAssignmentSelected(t)&&this.selectedCollection.remove(t)}selectEvents(t,i=!1){if(i){const n=t.reduce((s,a)=>(this.isEventSelectable(a)!==!1&&s.push(...a.assignments),s),[]);this.selectedCollection.add(n)}else this.selectedEvents=t}deselectEvents(t){this.selectedCollection.remove(t.reduce((i,n)=>(i.push(...n.assignments),i),[]))}selectAssignments(t){this.selectedCollection.add(t)}deselectAssignments(t){this.selectedCollection.remove(t)}clearEventSelection(){this.selectedAssignments=[]}onBeforeSelectedCollectionSplice({toAdd:t,toRemove:i,index:n}){const s=this,a=s._selectedCollection.values,o=t,l=i>0?o.slice(n,i+n):[],c=s.getActionType(a,o,l);if(s.trigger("beforeEventSelectionChange",{action:c,selection:s.getEventsFromAssignments(a)||[],selected:s.getEventsFromAssignments(o)||[],deselected:s.getEventsFromAssignments(l)||[]})===!1||s.trigger("beforeAssignmentSelectionChange",{action:c,selection:a,selected:o,deselected:l})===!1)return!1}onSelectedCollectionChange({added:t,removed:i}){const n=this,s=n.selectedAssignments,a=t||[],o=i||[];function l(c,d){const u=c.event;if(u){const{eventAssignHighlightCls:h}=n,g=n.getElementFromAssignmentRecord(c);n.currentOrientation.toggleCls(c,n.eventSelectedCls,d),h&&n.getElementsFromEventRecord(u).forEach(f=>{if(f!==g){const m=n.resolveAssignmentRecord(f);n.currentOrientation.toggleCls(m,h,d),d&&(f.style.animation="none",f.offsetHeight,f.style.animation=""),f.classList.toggle(h,d)}})}}if(o.forEach(c=>l(c,!1)),a.forEach(c=>l(c,!0)),(n.highlightSuccessors||n.highlightPredecessors)&&n.highlightLinkedEvents(n.selectedEvents),n.$selectedAssignments=s.map(c=>({eventId:c.eventId,resourceId:c.resourceId})),!n.silent){const c=this.getActionType(s,a,o);n.trigger("assignmentSelectionChange",{action:c,selection:s,selected:a,deselected:o}),n.trigger("eventSelectionChange",{action:c,selection:n.selectedEvents,selected:n.getEventsFromAssignments(a),deselected:n.getEventsFromAssignments(o)})}}onAssignmentChange(t){super.onAssignmentChange(t);const i=this,{action:n,records:s}=t;if(i.silent=!i.triggerSelectionChangeOnRemove,n==="remove")i.deselectAssignments(s);else if(n==="removeall"&&!i.eventStore.isSettingData)i.clearEventSelection();else if(n==="dataset"&&i.$selectedAssignments)if(!i.maintainSelectionOnDatasetChange)i.clearEventSelection();else{const a=i.$selectedAssignments.map(o=>s.find(l=>l.eventId===o.eventId&&l.resourceId===o.resourceId));i.selectedAssignments=H.clean(a)}i.silent=!1}onInternalEventStoreChange({source:t,action:i,records:n}){!t.isResourceTimeRangeStore&&i==="dataset"&&!n.length&&this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(t,i){const n=this;n.isAssignmentSelected(i)?(n.deselectOnClick||t.ctrlKey)&&n.deselectAssignment(i,n.multiEventSelect,t):this.isEventSelectable(i.event)!==!1&&n.selectAssignment(i,t.ctrlKey&&n.multiEventSelect,t)}onEventNavigate({event:t,item:i}){if(!this.eventSelectionDisabled){const n=i&&(i.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(i):i);n?this.onAssignmentSelectionClick(t,n):this.deselectAllOnScheduleClick&&this.clearEventSelection()}}changeHighlightSuccessors(t){return this.changeLinkedEvents(t)}changeHighlightPredecessors(t){return this.changeLinkedEvents(t)}changeLinkedEvents(t){const i=this;return t?(i.highlighted=i.highlighted||new Set,i.highlightLinkedEvents(i.selectedEvents)):i.highlighted&&i.highlightLinkedEvents(),t}highlightLinkedEvents(t=[]){const i=this,{highlighted:n,eventStore:s}=i,a=i.features.dependencies;n.forEach(o=>{t.includes(o)||(o.meta.highlight=!1,n.delete(o),s.includes(o)&&o.dependencies.forEach(l=>a.unhighlight(l,"b-highlight")))}),t.forEach(o=>{const l=[o];for(;l.length;){const c=l.pop();n.add(c),i.highlightSuccessors&&c.outgoingDeps.forEach(d=>{a.highlight(d,"b-highlight"),!n.has(d.toEvent)&&l.push(d.toEvent)}),i.highlightPredecessors&&c.incomingDeps.forEach(d=>{a.highlight(d,"b-highlight"),!n.has(d.fromEvent)&&l.push(d.fromEvent)})}n.forEach(c=>c.meta.highlight=!0)}),i.element.classList.toggle("b-highlighting",t.length>0),i.refreshWithTransition()}onEventDataGenerated(t){(this.highlightSuccessors||this.highlightPredecessors)&&(t.cls["b-highlight"]=t.eventRecord.meta.highlight),super.onEventDataGenerated(t)}updateProject(t,i){this.clearEventSelection(),super.updateProject(t,i)}doDestroy(){var t;((t=this._selectedCollection)==null?void 0:t.owner)===this&&this._selectedCollection.destroy(),super.doDestroy()}get widgetClass(){}},h0=e=>e.preventDefault(),eO={ArrowRight:1,ArrowLeft:1,ArrowUp:1,ArrowDown:1},tO={animate:100},rO=Object.freeze({}),wv=e=>class extends fe(e||F){static get $name(){return"EventNavigation"}static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey",ArrowUp:"onArrowUpKey",ArrowDown:"onArrowDownKey",Escape:"onEscapeKey",Tab:"onTab","SHIFT+Tab":"onShiftTab"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:1,ArrowRight:1}}}static get defaultConfig(){return{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}}construct(t){const i=this;i.isInTimeAxis=i.isInTimeAxis.bind(i),i.onDeleteKey=i.throttle(i.onDeleteKey,i.onDeleteKeyBuffer,i),super.construct(t)}changeNavigator(t){const i=this;return i.getConfig("subGridConfigs"),new Ln(i.constructor.mergeConfigs({ownerCmp:i,target:i.timeAxisSubGridElement,processEvent:i.processEvent,itemSelector:`.${i.eventCls}-wrap`,focusCls:i.focusCls,navigatePrevious:i.throttle(i.navigatePrevious,{delay:i.navigatePreviousBuffer,throttled:h0}),navigateNext:i.throttle(i.navigateNext,{delay:i.navigateNextBuffer,throttled:h0})},t))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(t){return!t.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(t)}onElementKeyDown(t){var i,n,s;const a=this,{navigator:o}=a;if(((i=a.focusedCell)==null?void 0:i.rowIndex)!==-1&&((n=a.focusedCell)==null?void 0:n.column)===a.timeAxisColumn&&!t.target.closest(o.itemSelector)&&t.key==="Enter"){const l=a.getFirstVisibleAssignment();if(l)return a.navigateTo(l,{uiEvent:t}),!1}else(s=super.onElementKeyDown)==null||s.call(this,t)}getFirstVisibleAssignment(t=this.focusedCell){var i,n,s;const a=this,{currentOrientation:o,rowManager:l,eventStore:c}=a;if(a.isHorizontal){let d=o.rowMap.get(l.getRow(t.rowIndex));if(d!=null&&d.length)return(i=d[0])==null?void 0:i.elementData.assignmentRecord;if(d=(n=o.resourceMap.get(t.id))==null?void 0:n.eventsData,d!=null&&d.length)return(s=d.filter(u=>c.isAvailable(u.eventRecord))[0])==null?void 0:s.assignmentRecord}else{const d=[...o.resourceMap.values()][0],u=d&&Object.values(d);if(u!=null&&u.length)return u.filter(h=>c.isAvailable(h.renderData.eventRecord))[0].renderData.assignmentRecord}}onGridBodyFocusIn(t){var i;const n=t.target.closest(this.focusableSelector);if(this.timeAxisSubGridElement.contains(t.target)){const s=this,{navigationEvent:a}=s,{target:o}=t,l=o.closest(s.navigator.itemSelector),c=l?s.normalizeCellContext({rowIndex:s.isVertical?0:s.resourceStore.indexOf(s.resolveResourceRecord(o)),column:s.timeAxisColumn,target:o}):new oe(o);if(l){const{_focusedCell:d}=s;s._focusedCell=c,(i=s.onCellNavigate)==null||i.call(s,s,d,c,a,!0);return}if(n&&(!a||eO[a.key])){const d=s.getFirstVisibleAssignment(c);if(d){s.navigateTo(d,{scrollIntoView:!!(a&&a.type!=="mousedown"),uiEvent:a||t});return}}}n&&super.onGridBodyFocusIn(t)}accessibleFocusCell(t,i){const n=this;if(t=n.normalizeCellContext(t),t.columnId!==n.timeAxisColumn.id)return super.focusCell(t,i)}normalizeTarget(t){return t.assignmentRecord}getPrevious(t,i){const n=this,{resourceStore:s}=n,{eventSorter:a}=n.currentOrientation,{startDate:o,endDate:l}=n.timeAxis,c=t.event,d=n.eventStore.getEvents({resourceRecord:t.resource,startDate:o,endDate:l}).filter(this.isInTimeAxis).sort(a);let u=t.resource,h=d[d.indexOf(c)-1];if(!h)for(let g=s.indexOf(u)-1;(!h||i&&h===c)&&g>=0;g--){u=s.getAt(g);const f=n.eventStore.getEvents({resourceRecord:u,startDate:o,endDate:l}).filter(n.isInTimeAxis).sort(a);h=f.length&&f[f.length-1]}return n.assignmentStore.getAssignmentForEventAndResource(h,u)}navigatePrevious(t){const i=this,n=i.getPrevious(i.normalizeTarget(t));return t.preventDefault(),n?(t.ctrlKey||i.clearEventSelection(),i.navigateTo(n,{uiEvent:t})):i.doGridNavigation(t)}getNext(t,i){const n=this,{resourceStore:s}=n,{eventSorter:a}=n.currentOrientation,{startDate:o,endDate:l}=n.timeAxis,c=t.event,d=n.eventStore.getEvents({resourceRecord:t.resource,startDate:o,endDate:l}).filter(this.isInTimeAxis).sort(a);let u=t.resource,h=d[d.indexOf(c)+1];if(!h)for(let g=s.indexOf(u)+1;(!h||i&&h===c)&&g<s.count;g++)u=s.getAt(g),h=n.eventStore.getEvents({resourceRecord:u,startDate:o,endDate:l}).filter(n.isInTimeAxis).sort(a)[0];return n.assignmentStore.getAssignmentForEventAndResource(h,u)}navigateNext(t){const i=this,n=i.getNext(i.normalizeTarget(t));return t.preventDefault(),n?(t.ctrlKey||i.clearEventSelection(),i.navigateTo(n,{uiEvent:t})):i.doGridNavigation(t)}doGridNavigation(t){!t.handled&&t.key.indexOf("Arrow")===0&&this[`navigate${t.key.substring(5)}ByKey`](t)}async navigateTo(t,{scrollIntoView:i=!0,uiEvent:n={}}=rO){const s=this,{navigator:a}=s,{skipScrollIntoView:o}=a;t&&(i?(a.disabled=!0,await s.scrollAssignmentIntoView(t,tO),a.disabled=!1):a.skipScrollIntoView=!0,!s.isDestroyed&&this.getElementFromAssignmentRecord(t)&&(s.activeAssignment=t,a.skipScrollIntoView=o,a.trigger("navigate",{event:n,item:s.getElementFromAssignmentRecord(t).closest(a.itemSelector)})))}set activeAssignment(t){const i=this.getElementFromAssignmentRecord(t,!0);i&&(this.navigator.activeItem=i)}get activeAssignment(){const{activeItem:t}=this.navigator;if(t)return this.resolveAssignmentRecord(t)}get previousActiveEvent(){const{previousActiveItem:t}=this.navigator;if(t)return this.resolveEventRecord(t)}processEvent(t){const i=this,n=t.target.closest(i.eventSelector);return!i.navigator.disabled&&n&&(t.assignmentRecord=i.resolveAssignmentRecord(n),t.eventRecord=i.resolveEventRecord(n),t.resourceRecord=i.resolveResourceRecord(n)),t}onDeleteKey(t){const i=this;if(!i.readOnly&&i.enableDeleteKey){const n=i.eventStore.usesSingleAssignment?i.selectedEvents:i.selectedAssignments;i.removeEvents(n.filter(s=>!s.readOnly))}}onArrowUpKey(t){this.focusCell({rowIndex:this.focusedCell.rowIndex-1,column:this.timeAxisColumn}),t.handled=!0}onArrowDownKey(t){this.focusedCell.rowIndex<this.resourceStore.count-1&&(this.focusCell({rowIndex:this.focusedCell.rowIndex+1,column:this.timeAxisColumn}),t.handled=!0)}onEscapeKey(t){t.target.closest(".b-dragging")||(this.focusCell({rowIndex:this.focusedCell.rowIndex,column:this.timeAxisColumn}),t.handled=!0)}onEventSpaceKey(t){}onEventEnterKey(t){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}},Ev=e=>{var r;return r=class extends e{static get $name(){return"TransactionalFeatureMixin"}get widgetClass(){}get transactionalFeaturesEnabled(){var t;return this.enableTransactionalFeatures&&((t=this.project)==null?void 0:t.queue)}},E(r,"configurable",{enableTransactionalFeatures:!1,testConfig:{enableTransactionalFeatures:!1}}),r},sh=e=>{var r;return r=class extends e.mixin(Am){static get $name(){return"CrudManagerView"}afterConstruct(){super.afterConstruct();const{crudManager:t,project:i}=this;this.loadMask&&(t||i).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:t}=this;t&&(this.masked=Bt.mergeConfigs(this.loadMaskDefaults,t))}bindCrudManager(t){this.detachListeners("crudManager"),t==null||t.ion({name:"crudManager",loadStart:"onCrudManagerLoadStart",beforeSend:"onCrudManagerBeforeSend",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",beforeApplyResponse:"onCrudManagerBeforeApplyResponse",applyResponse:"onCrudManagerApplyResponse",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",responseReceived:"onAjaxTransportResponseReceived",thisObj:this})}onCrudManagerBeforeSend({params:t}){var i;(i=this.applyStartEndParameters)==null||i.call(this,t)}onCrudManagerLoadStart(){var t;this.applyLoadMask(),(t=this.toggleEmptyText)==null||t.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerBeforeApplyResponse(){var t;(t=this.suspendRefresh)==null||t.call(this)}onCrudManagerApplyResponse(){var t;(t=this.resumeRefresh)==null||t.call(this,!0)}onCrudManagerRequestFinalize(t=!0,i,n){var s;const a=this;t?(s=a.toggleEmptyText)==null||s.call(a):(a.masked||a.applyLoadMask(),a.applyMaskError(`<div class="b-grid-load-failure">
                    <div class="b-grid-load-fail">${a.L(`L{GridBase.${i}FailedMessage}`)}</div>
                    ${n&&n.message?`<div class="b-grid-load-fail">${a.L("L{CrudManagerView.serverResponseLabel}")} ${n.message}</div>`:""}
                </div>`))}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerRequestFail({requestType:t,response:i}){this.onCrudManagerRequestFinalize(!1,t,i)}onAjaxTransportResponseReceived(){const t=this;t.clearMaskDelay!=null?t.setTimeout(()=>t.masked=null,t.clearMaskDelay):t.masked=null}get widgetClass(){}},E(r,"config",{clearMaskDelay:null,testConfig:{clearMaskDelay:0}}),r},xt=e=>class extends e{static get $name(){return"AttachToProjectMixin"}async afterConstruct(){var t;super.afterConstruct();const i=this,n=i.client||i.grid,{project:s}=n;(t=n.projectSubscribers)==null||t.push(i),s&&(i.attachToProject(s),i.attachToResourceStore(s.resourceStore),i.attachToEventStore(s.eventStore),i.attachToAssignmentStore(s.assignmentStore),i.attachToDependencyStore(s.dependencyStore),i.attachToCalendarManagerStore(s.calendarManagerStore))}attachToProject(t){var i;this.detachListeners("project"),this._project=t,(i=super.attachToProject)==null||i.call(this,t)}detachFromProject(t){var i;(i=super.detachFromProject)==null||i.call(this,t)}attachToEventStore(t){var i;this.detachListeners("eventStore"),(i=super.attachToEventStore)==null||i.call(this,t)}attachToResourceStore(t){var i;this.detachListeners("resourceStore"),(i=super.attachToResourceStore)==null||i.call(this,t)}attachToAssignmentStore(t){var i;this.detachListeners("assignmentStore"),(i=super.attachToAssignmentStore)==null||i.call(this,t)}attachToDependencyStore(t){var i;this.detachListeners("dependencyStore"),(i=super.attachToDependencyStore)==null||i.call(this,t)}attachToCalendarManagerStore(t){var i;this.detachListeners("calendarManagerStore"),(i=super.attachToCalendarManagerStore)==null||i.call(this,t)}get project(){return this._project}get calendarManagerStore(){return this.project.calendarManagerStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}get eventStore(){return this.project.eventStore}get dependencyStore(){return this.project.dependencyStore}},iO={releaseElement:1,reuseElement:1},nO={newElement:1,reuseOwnElement:1,reuseElement:1},xv=9999999,sO=({startDateMS:e},{startDateMS:r})=>e-r,aO={startDate:1,endDate:1,duration:1};function g0(e,r,t,i,n){var s,a;const{timeAxis:o}=e,l=r.isBatchUpdating&&!n?r.get(i):r[i],c=(s=r.hasBatchedChange)==null?void 0:s.call(r,i);if(e.fillTicks&&(!((a=r.meta)!=null&&a.isResizing)||!c)){let u=o.getTickFromDate(l);if(u>=0){t&&u===Math.round(u)&&u>0&&u--;const h=Math.floor(u);return o.getAt(h)[i].getTime()}}return l==null?void 0:l.getTime()}var gc=class extends F.mixin(xt){static get configurable(){return{bufferSize:150,verticalBufferSize:150}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],isFirstRefresh:!0,toDrawOnProjectRefresh:new Set,toDrawOnDataReady:new Set}}construct(e){const r=this;r.client=r.scheduler=e,r.eventSorter=r.eventSorter.bind(e),r.scrollBuffer=e.scrollBuffer,e.scrollable.ion({scroll:"onEarlyScroll",prio:1,thisObj:r}),e.rowManager.ion({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",offsetRows:"onOffsetRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:r}),super.construct({})}init(){}updateVerticalBufferSize(){const{rowManager:e}=this.scheduler;this.scheduler.isPainted&&e.renderRows(e.rows)}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(e,r,t,i=!1){const{scheduler:n}=this;let s=e[0];return t||(s=this.translateToScheduleCoordinate(s)),s=n.getRtlX(s),n.timeAxisViewModel.getDateFromPosition(s,r,i)}translateToScheduleCoordinate(e){const{scheduler:r}=this,{scrollable:t}=r.timeAxisSubGrid;let i=e-r.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return r.rtl?i+=t.maxX-Math.abs(r.scrollLeft):i+=r.scrollLeft,i}translateToPageCoordinate(e){const{scheduler:r}=this,{scrollable:t}=r.timeAxisSubGrid;let i=e+r.timeAxisSubGridElement.getBoundingClientRect().left;return r.rtl?i-=t.maxX-Math.abs(r.scrollLeft):i-=r.scrollLeft,i}getScheduleRegion(e,r,t=!0,i,n=!1){var s;const a=this,{scheduler:o}=a,{timeAxisSubGridElement:l,timeAxis:c}=o,d=(!n||e)&&o.getResourceMargin(e)||0;let u;if(e){const p=r&&o.getElementsFromEventRecord(r,e)[0];if(u=k.from(o.getRowById(e.id).getElement("normal"),l),p){const v=k.from(p,l);u.y=v.y,u.bottom=v.bottom}else u.y=u.y+d,u.bottom=u.bottom-d}else u=k.from(l).moveTo(null,0),u.width=l.scrollWidth,u.y=u.y+d,u.bottom=u.bottom-d;const h=c.startDate,g=c.endDate;i=(i==null?void 0:i.start)&&i||((s=o.getDateConstraints)==null?void 0:s.call(o,e,r))||{start:h,end:g};let f=o.getCoordinateFromDate(i.start?b.max(h,i.start):h),m=o.getCoordinateFromDate(i.end?b.min(g,i.end):g);return t||(f=a.translateToPageCoordinate(f),m=a.translateToPageCoordinate(m)),u.left=Math.min(f,m),u.right=Math.max(f,m),u}getRowRegion(e,r,t){const{scheduler:i}=this,{timeAxis:n}=i,s=i.getRowById(e.id);if(!s)return null;const a=n.startDate,o=n.endDate,l=r?b.max(a,r):a,c=t?b.min(o,t):o,d=i.getCoordinateFromDate(l),u=i.getCoordinateFromDate(c,!0,!0),h=s.top,g=Math.min(d,u),f=h+s.offsetHeight;return new k(g,h,Math.max(d,u)-g,f-h)}getResourceEventBox(e,r,t,i=!1){const n=this.resourceMap.get(r.id);let s=null,a=!1;if(n&&(s=n.eventsData.find(o=>o.eventRecord===e)),s||(s=this.getTimeSpanRenderData(e,r,{viewport:!0,timeAxis:t}),a=!0),s){const o=this.scheduler.rowManager.getRecordCoords(r,!0,i),l=s.top+o.top,c=new k(s.left,l,s.width,s.height);return c.layout=!a,c.rowTop=o.top,c.rowBottom=o.bottom,c.resourceId=r.id,c}return null}resolveRowRecord(e){const r=this,{scheduler:t}=r,i=e.nodeType?e:e.target,n=i.nodeType===Element.TEXT_NODE?i.parentElement:i,s=n.closest(t.eventSelector);return s?r.resourceStore.getById(s.dataset.resourceId):!n.closest(".b-grid-row")&&n.dataset.resourceId?r.resourceStore.getById(n.dataset.resourceId):t.getRecordFromElement(n)}attachToProject(e){super.attachToProject(e),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),e==null||e.ion({name:"project",refresh:"onProjectRefresh",commitFinalized:"onProjectCommitFinalized",thisObj:this})}onProjectCommitFinalized(){const{scheduler:e,toDrawOnDataReady:r,project:t}=this;e.isVisible?e.isPainted&&!e.refreshSuspended&&(!r.size&&t.timeZone!=null&&t.ignoreRecordChanges&&t.resourceStore.forEach(i=>r.add(i.id)),r.size&&(this.clearResources(r),this.refreshResources(r)),r.clear()):e.whenVisible("refreshRows")}onProjectRefresh({isCalculated:e,isInitialCommit:r}){const t=this,{scheduler:i,toDrawOnProjectRefresh:n}=t;if(i.isVisible){if(i.isPainted&&!i.isConfiguring&&!i.refreshSuspended){if(t.refreshAllWhenReady||r&&e){i.calculateAllRowHeights(!0);const{rowManager:s}=i;s.topRow?(t.clearAll(),i.refreshAfterProjectRefresh||(s.topRow.dataIndex>=i.store.count?i.renderRows(!1):i.refreshWithTransition(!1,!t.isFirstRefresh&&e&&!r)),t.isFirstRefresh=!1):s.reinitialize(),t.refreshAllWhenReady=!1}else n.size&&t.refreshResources(n);n.clear()}}else i.whenVisible("refresh",i,[!0])}attachToAssignmentStore(e){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(e),e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({source:e,action:r,records:t=[],replaced:i,changes:n}){const s=this,{scheduler:a}=s,o=new Set(t.flatMap(l=>{var c,d,u;return[l.resourceId,...(u=(d=(c=l.resource)==null?void 0:c.$links)==null?void 0:d.map(h=>h.id))!=null?u:[]]}));if(!(s.resourceStore.isRemoving||s.resourceStore.isChangingId))switch(r){case"dataset":{s.eventStore.usesSingleAssignment||(o.size?s.refreshResourcesWhenReady(o):(s.clearAll(),a.refreshWithTransition()));return}case"add":case"remove":case"updateMultiple":s.refreshResourcesWhenReady(o);return;case"removeall":s.refreshAllWhenReady=!0;return;case"replace":i.forEach(([l,c])=>{o.add(l.resourceId),o.add(c.resourceId)}),s.refreshResourcesWhenReady(o);return;case"filter":s.clearAll(),a.calculateAllRowHeights(!0),a.refreshWithTransition();return;case"update":{("eventId"in n||"resourceId"in n||"id"in n)&&("resourceId"in n&&o.add(n.resourceId.oldValue),e===a.project.assignmentStore?s.refreshResourcesOnDataReady(o):s.refreshResources(o));break}case"clearchanges":{const{added:l,modified:c,removed:d}=n;c.length?a.refreshWithTransition():(l.forEach(u=>o.add(u.resourceId)),d.forEach(u=>o.add(u.resourceId)),s.refreshResourcesOnDataReady(o))}}}onAssignmentStoreRefresh({action:e,records:r}){e==="batch"&&(this.clearAll(),this.scheduler.refreshWithTransition())}attachToEventStore(e){this.refreshAllWhenReady=!0,super.attachToEventStore(e),e&&e.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:e}){for(const r of this.client.getElementsFromEventRecord(e))r.classList.remove("b-iscreating")}onEventStoreRefresh({action:e}){if(e==="batch"){const{scheduler:r}=this;r.isEngineReady&&r.isPainted&&(this.clearAll(),r.refreshWithTransition())}}onEventStoreChange({action:e,records:r=[],record:t,replaced:i,changes:n,source:s}){var a,o;const l=this,{scheduler:c}=l,d=s.isResourceTimeRangeStore,u=new Set;if(c.isPainted)if(r.forEach(h=>{var g;const f=(g=h.$linkedResources)==null?void 0:g.filter(m=>l.resourceStore.includes(m));f==null||f.forEach(m=>u.add(m.id))}),d){switch(e){case"removeall":case"dataset":l.clearAll(),c.refreshWithTransition();return}l.refreshResources(u)}else{switch(e){case"batch":case"sort":case"group":case"move":return;case"remove":return;case"clearchanges":l.clearAll(),c.refreshWithTransition();return;case"dataset":{l.clearAll(),c.isEngineReady?c.refreshWithTransition():l.refreshAllWhenReady=!0;return}case"add":case"updateMultiple":break;case"replace":i.forEach(([,h])=>{h.resources.map(g=>u.add(g.id))});break;case"removeall":case"filter":if(!c.isEngineReady){l.refreshAllWhenReady=!0;return}l.clearAll(),c.calculateAllRowHeights(!0),c.refreshWithTransition();return;case"update":{const h=t.$entity?!Object.keys(n).some(f=>!t.$entity.getField(f)):!Object.keys(n).some(f=>!aO[f]);let g=0;"startDate"in n&&g++,"endDate"in n&&g++,"duration"in n&&g++,"resourceId"in n&&u.add(n.resourceId.oldValue),u.size&&(!h||g&&!("duration"in n&&g===1)||"percentDone"in n||"inactive"in n||"constraintDate"in n||"constraintType"in n||"segments"in n)&&((a=l.project)!=null&&a.propagatingLoadChanges||(o=l.project)!=null&&o.isWritingData?l.refreshResourcesOnDataReady(u):l.refreshResources(u));return}}l.refreshResourcesWhenReady(u)}}attachToResourceStore(e){this.refreshAllWhenReady=!0,super.attachToResourceStore(e),e&&(this.clearAll({clearLayoutCache:!0}),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}get resourceStore(){return this.client.store}onResourceStoreChange({action:e,isExpand:r,records:t,changes:i}){const n=this,s=t==null?void 0:t.flatMap(a=>a.isLinked?[a.id,a.$originalId]:[a.id]);if(n.scheduler.isPainted){switch(e){case"add":r||(t.every(a=>a.isLinked)?n.refreshResources(s):n.refreshResourcesWhenReady(s));return;case"update":{!n.project.isBatchingChanges&&!i.isLeaf&&n.refreshResources(s);return}case"filter":return;case"removeall":n.clearAll({clearLayoutCache:!0});return;case"dataset":return}s&&n.clearResources(s)}}onTranslateRow({row:e}){e.id!=null&&this.refreshEventsForResource(e,!1)}onOffsetRows(){this.clearAll(),this.doUpdateTimeView()}calculateRowHeight(e){var r;const{scheduler:t}=this,i=t.getResourceHeight(e),n=t.getEventLayout(e);if(n.type==="stack"&&t.isEngineReady&&!e.isSpecialRow&&((r=e.assigned)==null?void 0:r.size)>1){const{assignmentStore:a,eventStore:o,timeAxis:l}=t,{barMargin:c,resourceMargin:d,contentHeight:u}=t.getResourceLayoutSettings(e),h=(o.isFiltered||a.isFiltered)&&(p=>p.assignments.some(v=>v.resource===e.$original&&a.includes(v))),g=o.getEvents({resourceRecord:e,includeOccurrences:t.enableRecurringEvents,startDate:l.startDate,endDate:l.endDate,filter:h}).sort(sO).map(p=>{const v=p.isBatchUpdating?p.get("startDate"):p.startDate,y=p.isBatchUpdating?p.get("endDate"):p.endDate||v;return{eventRecord:p,resourceRecord:e,startMS:v.getTime(),endMS:y.getTime()}}),f=t.getEventLayoutHandler(n),m=f.layoutEventsInBands(g,e,!0);return f.type==="layoutFn"?m:m*u+(m-1)*c+d*2}return i}doUpdateTimeView(){const{scrollable:e}=this.scheduler.timeAxisSubGrid;this.updateFromHorizontalScroll(e.x,!0)}onTimeAxisViewModelUpdate(){const e=this,{scheduler:r}=e;e.clearAll(),r.refreshSuspended&&(e.detachListeners("renderingSuspend"),r.ion({name:"renderingSuspend",resumeRefresh({trigger:t}){r.isEngineReady&&t&&e.doUpdateTimeView()},thisObj:e,once:!0})),e.doUpdateTimeView()}getConnectorStartSide(e){return"start"}getConnectorEndSide(e){return"end"}refreshRows(e){e&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(e,r,t,i){r>i&&this.onRenderDone()}onDragAbort({context:e,dragData:r}){this.resourceStore.indexOf(r.record.resource)<this.scheduler.topRow.dataIndex&&e.element.remove()}toggleCls(e,r,t=!0,i=!1){const n=this.client.getElementFromAssignmentRecord(e,i),s=this.resourceMap.get(e.isModel?e.get("resourceId"):e.resourceId),a=s==null?void 0:s.eventsData.find(o=>o.eventId===e.eventId);a&&(a[i?"wrapperCls":"cls"][r]=t),n&&(n.classList[t?"add":"remove"](r),n.lastDomConfig.className[r]=t)}onRemoveRows({rows:e}){e.forEach(r=>this.rowMap.delete(r)),this.onRenderDone()}onEarlyScroll(){this.rendererCalled=!1}updateFromVerticalScroll(){this.fromScroll=!0,this.rendererCalled||this.onRenderDone()}updateFromHorizontalScroll(e,r){var t,i;const n=this,{scheduler:s,scrollBuffer:a}=n,o=a===-1,{timeAxisSubGrid:l,timeAxis:c,rtl:d}=s,{width:u}=l,{totalSize:h}=s.timeAxisViewModel,g=e,f=l.scrollable.maxX!==0&&Math.abs(l.scrollable.maxX)<=Math.round(g)+5,m=o?c.startDate:s.getDateFromCoord({coord:Math.max(0,g-a),ignoreRTL:!0}),p=f||o?c.endDate:s.getDateFromCoord({coord:g+u+a,ignoreRTL:!0})||c.endDate;if(m&&!s._viewPresetChanging&&(!o||r||m-(((t=n._visibleDateRange)==null?void 0:t.startDate)||0)||p-(((i=n._visibleDateRange)==null?void 0:i.endDate)||0))){n._visibleDateRange={startDate:m,endDate:p,startMS:m.getTime(),endMS:p.getTime()},n.viewportCoords=o?{left:0,right:h}:d?{left:h-e-u+a,right:h-e-a}:{left:e-a,right:e+u+a};const v=s.timeView.range={startDate:m,endDate:p};if(s.onVisibleDateRangeChange(v),!s.refreshSuspended&&s.rowManager.rows.length){if(s.rowManager.rows[0].id===null)return;n.fromScroll=!0,s.rowManager.rows.forEach(y=>n.refreshEventsForResource(y,!1,!1)),n.onRenderDone()}}}repaintEventsForResource(e){this.refreshResources([e.id])}onBeforeRowHeightChange(){this.clearAll()}refreshResourcesOnDataReady(e){e.forEach(r=>this.toDrawOnDataReady.add(r))}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach(r=>this.toDrawOnProjectRefresh.add(r))}refreshResources(e,r=!0){const t=this,{scheduler:i}=t,n=[],s=[];t.clearResources(e),i.refreshSuspended||(e.forEach(a=>{const o=i.getRowById(a);o?n.push(o):s.push(o)}),i.runWithTransition(()=>{i.calculateRowHeights(s.map(a=>this.resourceStore.getById(a)),!0),i.rowManager.renderRows(n)},r))}layoutEventVerticallyStack(e,r,t){const{barMargin:i,resourceMargin:n,contentHeight:s}=this.scheduler.getResourceLayoutSettings(t,r.parent);return e===0?n:n+e*s+e*i}layoutEventVerticallyPack(e,r,t,i){const{barMargin:n,resourceMargin:s,contentHeight:a}=this.scheduler.getResourceLayoutSettings(i,t.parent),o=1/r,l=e*o,c=(a-(o-1)*n)*r;return{top:s+l*c+l*n,height:c}}addTemporaryDragElement(e,r=e.resource){const{scheduler:t}=this,i=t.generateRenderData(e,r,{timeAxis:!0,viewport:!0});i.absoluteTop=i.row?i.top+i.row.top:t.getResourceEventBox(e,r,!0).top;const n=this.renderEvent(i),{dataset:s}=n;delete n.tabIndex,delete s.eventId,delete s.resourceId,delete s.assignmentId,delete s.syncId,s.transient=!0,n.parent=this.scheduler.foregroundCanvas,n.retainElement=!0;const a=w.createElement(n);return a.innerElement=a.firstChild,e.instanceMeta(t).hasTemporaryDragElement=!0,a}eventSorter(e,r){if(this.overlappingEventSorter)return this.overlappingEventSorter(e.eventRecord||e,r.eventRecord||r);const t=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,i=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,n=r.isModel?r.startDateMS:r.dataStartMS||r.startMS,s=r.isModel?r.endDateMS:r.dataEndMS||r.endMS,a=e.isModel?e.name:e.eventRecord.name,o=r.isModel?r.name:r.eventRecord.name;return t-n||s-i||(a<o?-1:a==o?0:1)}calculateMS(e,r,t,i,n){const s=this,{scheduler:a}=s,{timeAxisViewModel:o}=a;let l=g0(a,e,!1,r,i),c=g0(a,e,!0,t,i),d=c-l;if(a.milestoneLayoutMode!=="default"&&d===0){const u=o.getSingleUnitInPixels("minute");if(d=a.getMilestoneLabelWidth(e,n)*(1/u)*60*1e3,a.milestoneTextPosition==="always-outside"){const f=a.getResourceLayoutSettings(n,e.parent).contentHeight,m=f*(1/u)*60*1e3;l-=m/2,c=l+d}else switch(a.milestoneAlign){case"start":case"left":c=l+d;break;case"end":case"right":c=l,l=c-d;break;default:c=l+d/2,l=c-d;break}}return{startMS:l,endMS:c,durationMS:d}}setupRenderData(e,r){var t;const i=this,{scheduler:n}=i,{timeAxis:s,timeAxisViewModel:a}=n,{preamble:o,postamble:l}=e,c=i.isProHorizontalRendering&&((t=n.features.eventBuffer)==null?void 0:t.enabled)&&(o||l)&&!e.isMilestone,d=a.getSingleUnitInPixels("minute"),{isBatchUpdating:u}=e,h=c?"wrapStartDate":"startDate",g=c?"wrapEndDate":"endDate",f=u&&!c?e.get(h):e[h],m=u&&!c?e.get(g):e[g]||f,p=s.startMS,v=s.endMS,{startMS:y,endMS:C,durationMS:D}=i.calculateMS(e,h,g,c,r),S=y<p|(y>v)<<1,x=C>v|(C<=p)<<1,R=D/(1e3*60),I=x?d*R:null,M=n.getRowById(r);return{eventRecord:e,taskRecord:e,start:f,end:m,rowId:r.id,children:[],startMS:y,endMS:C,durationMS:D,startsOutsideView:S,endsOutsideView:x,width:I,row:M,useEventBuffer:c}}fillTimeSpanHorizontalPosition(e){const{startMS:r,endMS:t,durationMS:i}=e,n=r!=null&&t!=null&&this.calculateHorizontalPosition(e,r,t,i);return n?(Object.assign(e,n),!0):!1}calculateHorizontalPosition(e,r,t,i){const{scheduler:n}=this,{timeAxis:s,timeAxisViewModel:a}=n,{startsOutsideView:o,endsOutsideView:l,eventRecord:c}=e,d=s.startMS,u=a.getSingleUnitInPixels("minute"),h=i/(1e3*60),g=l?u*h:null;let f=n.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0}),m,p=!1,v=!1;return o?(m=(r-d)/(1e3*60)*u,n.rtl&&(m=n.timeAxisSubGrid.scrollable.scrollWidth-m)):(m=n.getCoordinateFromDate(r,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:f!==-1}),p=m===-1),l?q.isSafari&&n.features.stickyEvents&&s.endMS||f===-1&&!s.continuous?f=n.getCoordinateFromDate(s.endMS):f=m+g*(n.rtl?-1:1):v=f===-1,v&&!p&&(f=n.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),g>xv&&(o===1?l===1?(m=-100,f=n.timeAxisColumn.width+100):m=f-xv:l===1&&(f=m+xv)),p&&v&&(m=n.getCoordinateFromDate(r,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:t}),f=n.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:r}),m===f)?(c.instanceMeta(n).excluded=!0,null):{left:Math.min(m,f),width:Math.abs(f-m)||(c.isMilestone&&!c.meta.isDragCreating?0:6),clippedStart:p,clippedEnd:v}}fillTimeSpanVerticalPosition(e,r){const{scheduler:t}=this,{start:i,end:n}=e,{resourceMargin:s,contentHeight:a}=t.getResourceLayoutSettings(r);t.fillTicks&&(e.dataStartMS=i.getTime(),e.dataEndMS=n.getTime()),e.top=Math.max(0,s),t.managedEventSizing&&(e.height=a)}getTimeSpanRenderData(e,r,t=!1){const i=this,{scheduler:n}=i,{timeAxis:s}=n,a=t===!0||t.timeAxis,o=t===!0||t.viewport;if((a||s.isTimeSpanInAxis(e))&&(n.getRowById(r)||o)){const c=i.setupRenderData(e,r);return i.fillTimeSpanHorizontalPosition(c)?(i.fillTimeSpanVerticalPosition(c,r),c):null}}layoutEvents(e,r,t=!1,i,n){const s=this,{scheduler:a}=s,{timeAxis:o}=a,l=r.reduce((g,f)=>{if(t||o.isTimeSpanInAxis(f)){const m=a.generateRenderData(f,e,!1);m&&g.push(m)}return g},[]);l.sort(n!=null?n:s.eventSorter);let c=a.getAppliedResourceHeight(e,i);const d=l.filter(({eventRecord:g})=>g.isEvent&&!g.meta.excludeFromLayout),u=a.getEventLayout(e,i),h=a.getEventLayoutHandler(u);if(h){const{barMargin:g,resourceMargin:f,contentHeight:m}=a.getResourceLayoutSettings(e,i),p=h.applyLayout(d,e)||1;h.type==="layoutFn"?c=p:c=p*m+(p-1)*g+f*2}else if(d.length>0)for(let g=0;g<d.length;g++){const f=d[g];f.wrapperStyle+=`;z-index:${g+5}`}return{rowHeight:c,eventsData:l}}layoutResourceEvents(e,r=!1){const t=this,{scheduler:i}=t,{eventStore:n,assignmentStore:s,timeAxis:a}=i,o=n.getEvents({includeOccurrences:i.enableRecurringEvents,resourceRecord:e,startDate:a.startDate,endDate:a.endDate,filter:(s.isFiltered||n.isFiltered)&&(c=>c.assignments.some(d=>d.resource===e.$original&&s.includes(d)))}),l=i.getEventsToRender(e,o)||[];return t.layoutEvents(e,l,r)}renderEvent(e,r){const{scheduler:t}=this,{resourceRecord:i,assignmentRecord:n,eventRecord:s}=e,{milestoneLayoutMode:a,milestoneTextPosition:o}=t,l=n?this.assignmentStore.getOccurrence(n,s).id:e.eventId,c={className:e.cls,style:e.style||"",children:e.children,role:"presentation",dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},d={className:e.wrapperCls,tabIndex:"tabIndex"in e?e.tabIndex:-1,children:[c,...e.wrapperChildren],style:{top:e.absoluteTop,left:e.left,height:e.fillSize?r:e.height,width:s.isMilestone&&!s.meta.isDragCreating&&(a==="default"&&(o==="outside"||o==="inside"&&!e.width)||o==="always-outside")?e.height:e.width,style:e.wrapperStyle,fontSize:e.height+"px"},dataset:{resourceId:i.id,eventId:e.eventId,syncId:i.isLinked?`${l}_${i.id}`:l},elementData:e,retainElement:(n==null?void 0:n.instanceMeta(t).retainElement)||s.instanceMeta(t).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return e.fillSize&&(e.height=r),e.zIndex&&(d.zIndex=e.zIndex),n&&(d.dataset.assignmentId=n.id),e.elementConfig=d,t.afterRenderEvent({renderData:e,rowHeight:r,domConfig:d}),d}refreshEventsForResource(e,r=!0,t=!0){const i=this,n=i.scheduler.store.getById(e.isRow?e.id:e),s=i.scheduler.rowManager.getRowFor(n);r&&i.clearResources([n]),s&&n&&(i.renderer({row:s,record:n}),r&&t&&i.onRenderDone())}getResourceLayout(e){const r=this;let t=r.resourceMap.get(e.id);if(!t||t.invalid){if(r.suspended)return;t=r.layoutResourceEvents(e,!1),r.resourceMap.set(e.id,t)}return t}getEventDOMConfigForCurrentView(e,r,t,i){const n=this,{bufferSize:s,scheduler:a}=n,{labels:o,eventBuffer:l}=a.features,c=(l==null?void 0:l.enabled)||(o==null?void 0:o.enabled)&&(o.left||o.right||o.before||o.after),{eventsData:d}=e,u=n.fromScroll?n.rowMap.get(r):null,h=[];let g,f;for(let m=0;m<d.length;m++){const p=d[m];if(g=t,f=i,(c||p.width===0)&&(g-=s,f+=s),p.left+p.width>=g&&p.left<=f){p.absoluteTop=p.top+r.top;const v=u==null?void 0:u.find(y=>y.elementData.eventId===p.eventId&&y.elementData.resourceId===p.resourceId);h.push(v!=null?v:n.renderEvent(p,e.rowHeight))}}return h}renderer({row:e,record:r,size:t={}}){const i=this;if(r.isSpecialRow){i.rowMap.delete(e);return}const{left:n,right:s}=i.viewportCoords,a=i.getResourceLayout(r);if(!a)return;t.height=a.rowHeight,t.transient=!0;const o=i.getEventDOMConfigForCurrentView(a,e,n,s);i.rowMap.set(e,o),i.rendererCalled=!0}onRenderDone(){var e;const{scheduler:r,rowMap:t,verticalBufferSize:i}=this,n=[],s=(e=r._scrollTop)!=null?e:0,a=s-i,o=s+r._bodyRectangle.height+i,l=i<0,c=!r.managedEventSizing;t.forEach((d,u)=>{if(l||u.bottom>a&&u.top<o)for(let h=0;h<d.length;h++){const g=d[h],f=g.elementData,{absoluteTop:m,eventRecord:p}=f;(l||c||p.meta.isDragCreating||p.meta.isResizing||m+f.height>a&&m<o)&&n.push(g)}for(let h=0;h<d.length;h++)d[h]={...d[h]}}),this.fromScroll=!1,this.visibleEventDOMConfigs=n,X.sync({domConfig:{onlyChildren:!0,children:n},targetElement:r.foregroundCanvas,syncIdField:"syncId",callback({action:d,domConfig:u,lastDomConfig:h,targetElement:g,jsx:f}){var m,p,v;const{reactComponent:y}=r,C=iO[d],D=nO[d];if(!C&&((m=r.processEventContent)==null||m.call(r,{jsx:f,action:d,domConfig:u,targetElement:g,isRelease:C,reactComponent:y})),!(d==="none"||!((p=u==null?void 0:u.elementData)!=null&&p.isWrap))){if(C&&(h!=null&&h.elementData)){const{eventRecord:S,resourceRecord:x,assignmentRecord:R}=h.elementData,I={renderData:h.elementData,element:g,eventRecord:S,resourceRecord:x,assignmentRecord:R};(v=r.processEventContent)==null||v.call(r,{isRelease:C,targetElement:g,reactComponent:y,assignmentRecord:R}),g===w.getActiveElement(g)&&r.focusElement.focus(),r.trigger("releaseEvent",I)}if(D){const{eventRecord:S,resourceRecord:x,assignmentRecord:R}=u.elementData,I={renderData:u.elementData,element:g,isReusingElement:d==="reuseElement",isRepaint:d==="reuseOwnElement",eventRecord:S,resourceRecord:x,assignmentRecord:R};d==="reuseElement"&&r.isAnimating&&w.addTemporaryClass(g,"b-reusing-own",50,r),r.trigger("renderEvent",I)}}}})}clearResources(e){e=H.asArray(e),e.map(ce.asId).forEach(t=>{const i=this.resourceMap.get(t);i&&(i.invalid=!0);const n=this.scheduler.getRowById(t);n&&this.rowMap.delete(n)})}clearAll({clearDom:e=!1,clearLayoutCache:r=!1}={}){const t=this,{layouts:i,foregroundCanvas:n}=t.scheduler;if(r&&i)for(const s in i)i[s].clearCache();if(n&&e){n.syncIdMap=n.lastDomConfig=null;for(const s of n.children)s.lastDomConfig=s.elementData=null}t.resourceMap.clear(),t.rowMap.clear()}};E(gc,"$name","HorizontalRendering"),gc._$name="HorizontalRendering";var f0=class extends bv(){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(e,r,t,i,n,s){const a=this,o=s.type;return a.packEventsInBands(e,(l,c,d,u)=>{if(o==="none")l.width=r-t*2,l.left+=t;else{l.widthFactor=u;const h=l.leftFactor=d.start+c*u,g=Math.round(1/u),f=h/u,m=r-t*2-i*(g-1);o==="mixed"&&g===2?(l.left+=h*r/5+i,l.width=r-h*r/5-i*2,l.zIndex=5+f):(l.width=u*m,l.left+=h*m+t+i*f)}l.cls["b-sch-event-narrow"]=l.width<a.scheduler.narrowEventWidth})}};f0._$name="VerticalLayout";var oO={releaseElement:1,reuseElement:1},lO={newElement:1,reuseOwnElement:1,reuseElement:1},cO={startDate:1,endDate:1,duration:1},dO=Object.freeze({}),ah=class extends F.mixin(fe,xt){static get properties(){return{eventMap:new Map,resourceMap:new Map,releasedElements:{},toDrawOnProjectRefresh:new Set,resourceBufferSize:1}}construct(e){this.client=this.scheduler=e,this.verticalLayout=new f0({scheduler:e}),super.construct({})}init(){const e=this,{scheduler:r,resourceColumns:t}=e;t.resourceStore=e.resourceStore,t.ion({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:e}),e.initialized=!0,r.isPainted&&e.renderer(),t.availableWidth=r.timeAxisSubGridElement.offsetWidth}resolveRowRecord(e,r){const t=this,{scheduler:i}=t,n=e.nodeType?null:e,s=n?n.target:e,a=n?[n.borderOffsetX,n.borderOffsetY]:r,o=s.nodeType===Element.TEXT_NODE?s.parentElement:s,l=o.closest(i.eventSelector);if(l)return i.resourceStore.getById(l.dataset.resourceId);if(!s.closest(".b-sch-timeaxis-cell"))return null;if(!a)throw new Error(`Vertical mode needs coordinates to resolve this element. Can also be called with a browser
                event instead of element to extract element and coordinates from`);if(i.variableColumnWidths||i.resourceStore.isGrouped){let d=0;for(const u of t.resourceStore)if(u.isSpecialRow||(d+=u.columnWidth||t.resourceColumns.columnWidth),d>=a[0])return u;return null}const c=Math.floor(a[0]/t.resourceColumns.columnWidth);return t.allResourceRecords[c]}toggleCls(e,r,t=!0,i=!1){var n;const s=(n=this.eventMap.get(e.eventId))==null?void 0:n[e.resourceId];if(s){s.renderData[i?"wrapperCls":"cls"][r]=t;const a=this.client.getElementFromAssignmentRecord(e,i);a&&a.classList[t?"add":"remove"](r)}}getDateFromXY(e,r,t,i=!1){let n=e[1];return t||(n=this.translateToScheduleCoordinate(n)),this.scheduler.timeAxisViewModel.getDateFromPosition(n,r,i)}translateToScheduleCoordinate(e){return e-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top-globalThis.scrollY}translateToPageCoordinate(e){return e+this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top+globalThis.scrollY}getResourceEventBox(e,r){var t,i,n;const s=e.id,a=r.id;let{renderData:o}=((t=this.eventMap.get(s))==null?void 0:t[a])||dO;return o||(this.layoutResourceEvents(this.scheduler.resourceStore.getById(a)),o=(n=(i=this.eventMap.get(s))==null?void 0:i[a])==null?void 0:n.renderData),o?new k(o.left,o.top,o.width,o.bottom-o.top):null}getScheduleRegion(e,r,t){var i;const n=this,{scheduler:s}=n,a=k.from(s.timeAxisSubGridElement,s.timeAxisSubGridElement);e&&(a.left=n.allResourceRecords.indexOf(e)*s.resourceColumnWidth,a.right=a.left+s.resourceColumnWidth);const o=s.timeAxis.startDate,l=s.timeAxis.endDate,c=((i=s.getDateConstraints)==null?void 0:i.call(s,e,r))||{start:o,end:l},d=s.getCoordinateFromDate(b.max(o,c.start)),u=s.getCoordinateFromDate(b.min(l,c.end));return t?(a.top=d,a.bottom=u):(a.top=n.translateToPageCoordinate(d),a.bottom=n.translateToPageCoordinate(u)),a}getRowRegion(e,r,t){const i=this,{scheduler:n}=i,s=i.allResourceRecords.indexOf(e)*n.resourceColumnWidth,a=n.timeAxis.startDate,o=n.timeAxis.endDate,l=r?b.max(a,r):a,c=t?b.min(o,t):o,d=n.getCoordinateFromDate(l),u=n.getCoordinateFromDate(c,!0,!0),h=Math.min(d,u),g=Math.abs(d-u);return new k(s,h,n.resourceColumnWidth,g)}get visibleDateRange(){const e=this.scheduler,r=e.scrollable.y,t=e.scrollable.clientHeight,i=e.getDateFromCoordinate(r)||e.timeAxis.startDate,n=e.getDateFromCoordinate(r+t)||e.timeAxis.endDate;return{startDate:i,endDate:n,startMS:i.getTime(),endMS:n.getTime()}}onResourceColumnWidthChange({width:e,oldWidth:r}){const t=this,{scheduler:i}=t;t.resourceColumns.width=i.timeAxisColumn.width=t.allResourceRecords.length*e,t.clearAll(),t.refresh(Math.abs(e-r)>30)}attachToProject(e){super.attachToProject(e),e&&e.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const e=this,{scheduler:r,toDrawOnProjectRefresh:t}=e;r.isVisible?r.rendered&&!r.refreshSuspended&&(e.refreshAllWhenReady?(e.clearAll(),e.refresh(),e.refreshAllWhenReady=!1):t.size&&e.refresh(),t.clear()):r.whenVisible("refresh",r,[!0])}attachToEventStore(e){super.attachToEventStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:e}){for(const r of this.client.getElementsFromEventRecord(e))r.classList.remove("b-iscreating")}onEventStoreRefresh({action:e}){e==="batch"&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:e,records:r=[],record:t,replaced:i,changes:n,isAssign:s}){const a=this,o=new Set;switch(r.forEach(l=>{var c;const d=(c=l.$linkedResources)==null?void 0:c.filter(u=>a.resourceStore.includes(u));d==null||d.forEach(u=>o.add(u.id))}),e){case"sort":case"group":case"move":case"remove":return;case"dataset":a.refreshAllResourcesWhenReady();return;case"add":case"updateMultiple":break;case"replace":i.forEach(([,l])=>{l.resources.map(c=>o.add(c.id))}),a.clearResources(o);break;case"removeall":case"filter":a.clearAll(),a.refresh();return;case"update":{const l=t.$entity?!Object.keys(n).some(d=>!t.$entity.getField(d)):!Object.keys(n).some(d=>!cO[d]);let c=0;"startDate"in n&&c++,"endDate"in n&&c++,"duration"in n&&c++,(!l||c||"percentDone"in n||"inactive"in n||"segments"in n)&&(a.shouldWaitForInitializeAndEngineReady?a.refreshResourcesWhenReady(o):(a.clearResources(o),a.refresh()));return}}a.refreshResourcesWhenReady(o)}attachToResourceStore(e){const r=this;super.attachToResourceStore(e),r.refreshAllWhenReady=!0,r.resourceColumns&&(r.resourceColumns.resourceStore=e),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>r.scheduler.unmaskBody(),thisObj:r,prio:1}),r.initialized&&r.scheduler.isPainted&&(r.firstResource=r.lastResource=null,r.clearAll(),r.renderer())}onResourceStoreChange({source:e,action:r,records:t=[],record:i,replaced:n,changes:s}){const a=this,o=n?n.map(d=>d[1]):t,l=new Set(o.map(d=>d.id));a.firstResource=a.lastResource=null,e._allResourceRecords=null;const{allResourceRecords:c}=e;if(a.scheduler.isEngineReady){switch(r){case"update":s!=null&&s.id?a.clearResources([s.id.oldValue,s.id.value]):a.clearResources([i.id]);break;case"filter":a.clearAll();break}s&&"columnWidth"in s&&a.clearAll(),a.refresh(!0)}else{switch(r){case"dataset":case"remove":case"removeall":a.refreshAllResourcesWhenReady();return;case"replace":case"add":if(!e.isGrouped){const d=o.reduce((u,h)=>Math.min(u,c.indexOf(h)),c.length);for(let u=d;u<c.length;u++)l.add(c[u].id)}}a.refreshResourcesWhenReady(l)}}onResourceStoreRefresh({action:e}){const r=this;(e==="sort"||e==="group")&&(r.firstResource=r.lastResource=r.resourceStore._allResourceRecords=null,r.clearAll(),r.refresh())}attachToAssignmentStore(e){super.attachToAssignmentStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:r=[],replaced:t,changes:i}){const n=this,s=new Set(r.map(a=>a.resourceId));if(n.scheduler.isEngineReady){switch(e){case"remove":n.clearResources(s);break;case"filter":n.clearAll();break;case"update":{if("resourceId"in i&&s.add(i.resourceId.oldValue),!Object.keys(i).filter(a=>a!=="resource"&&a!=="event").length)return;n.clearResources(s)}}n.refresh(!0)}else{switch(i&&"resourceId"in i&&s.add(i.resourceId.oldValue),e){case"removeall":n.refreshAllResourcesWhenReady();return;case"replace":t.forEach(([a,o])=>{s.add(a.resourceId),s.add(o.resourceId)})}n.refreshResourcesWhenReady(s)}}onAssignmentStoreRefresh({action:e,records:r}){e==="batch"&&(this.clearAll(),this.refreshAllResourcesWhenReady())}refreshRows(e){e&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(e){this.renderResource(e)}updateFromHorizontalScroll(e){e!==this.prevScrollX&&(this.renderer(),this.prevScrollX=e)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(e,r){const{scheduler:t}=this,i=this.allResourceRecords.indexOf(e)*t.resourceColumnWidth;return t.scrollHorizontallyTo(i,r)}get allResourceRecords(){return this.scheduler.resourceStore.allResourceRecords}onViewportResize(e){this.resourceColumns.availableWidth=e,this.renderer()}get resourceColumns(){var e;return(e=this.scheduler.timeAxisColumn)==null?void 0:e.resourceColumns}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}getConnectorStartSide(e){return"top"}getConnectorEndSide(e){return"bottom"}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach(r=>this.toDrawOnProjectRefresh.add(r))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){return this.getResourceRange(!0)}get visibleResources(){const{first:e,last:r}=this.getResourceRange();return{first:this.allResourceRecords[e],last:this.allResourceRecords[r]}}getResourceRange(e){const{scheduler:r,resourceStore:t}=this,{resourceColumnWidth:i,scrollX:n}=r,{scrollWidth:s}=r.timeAxisSubGrid.scrollable,a=e?this.resourceBufferSize:0,o=n-a,l=n+s+a;if(!(t!=null&&t.count))return{first:-1,last:-1};if(r.variableColumnWidths){let c,d=0,u,h=0;return this.allResourceRecords.forEach((g,f)=>{if(g.instanceMeta(r).insetStart=u=h,h=u+g.columnWidth,u>l)return!1;h>o&&c==null?c=f:u<l&&(d=f)}),{first:c,last:d}}else return{first:Math.max(Math.floor(n/i)-a,0),last:Math.min(Math.floor((n+r.timeAxisSubGrid.width)/i)+a,this.allResourceRecords.length-1)}}get dateRange(){const{scheduler:e}=this;let r=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));r||(r=e.timeAxis.last.endDate);let t=e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0));return t||(t=e.timeAxis.first.startDate,r=e.getDateFromCoordinate(e.bodyHeight+e.tickSize-1)),{topDate:t,bottomDate:r}}getTimeSpanRenderData(e,r,t=!1){var i;const n=this,{scheduler:s}=n,{preamble:a,postamble:o}=e,{variableColumnWidths:l}=s,c=((i=s.features.eventBuffer)==null?void 0:i.enabled)&&n.isProVerticalRendering&&(a||o)&&!e.isMilestone,d=c?"wrapStartDate":"startDate",u=c?"wrapEndDate":"endDate",h=e.isBatchUpdating&&e.hasBatchedChange(d)&&!c?e.get(d):e[d],g=e.isBatchUpdating&&e.hasBatchedChange(u)&&!c?e.get(u):e[u],f=s.getResourceMargin(r),m=s.getCoordinateFromDate(h),p=r.instanceMeta(s),v=l?p.insetStart:n.allResourceRecords.indexOf(r)*s.resourceColumnWidth,y=s.getResourceWidth(r),C=y-f*2,D=h.getTime(),S=g.getTime();let x=s.getCoordinateFromDate(g),R=x-m;return x===-1&&(R=Math.round((S-D)*s.timeAxisViewModel.getSingleUnitInPixels("millisecond")),x=m+R),{eventRecord:e,resourceRecord:r,left:v,top:m,bottom:x,resourceWidth:y,width:C,height:R,startDate:h,endDate:g,startDateMS:D,endDateMS:S,useEventBuffer:c,children:[],start:h,end:g,startMS:D,endMS:S}}eventSorter(e,r){const t=e.dataStartMs||e.startDateMS,i=e.dataEndMs||e.endDateMS,n=r.dataStartMs||r.startDateMS,s=r.dataEndMs||r.endDateMS,a=e.isModel?e.name:e.eventRecord.name,o=r.isModel?r.name:r.eventRecord.name;return t-n||s-i||(a<o?-1:a==o?0:1)}layoutEvents(e,r,t=!1,i,n){const s=this,{scheduler:a}=s,{variableColumnWidths:o}=a,{id:l}=e,c=e.instanceMeta(a),d=i?`${l}-${i.id}`:l,u=s.resourceMap.set(d,{}).get(d),h=s.allResourceRecords.indexOf(e),{barMargin:g,resourceMargin:f}=a.getResourceLayoutSettings(e,i),m=r.reduce((p,v)=>{if(v.isScheduled){const y=a.generateRenderData(v,e,!1),C={renderData:y},D=T.getMapPath(s.eventMap,y.eventId,{});D[l]=C,u[y.eventId]=C,y.fillSize?(y.left=o?c.insetStart:h*a.resourceColumnWidth,y.width=a.getResourceWidth(e)):p.push(y)}return p},[]);return m.sort(n!=null?n:s.eventSorter),s.verticalLayout.applyLayout(m,a.getResourceWidth(e,i),f,g,h,a.getEventLayout(e,i)),u}layoutResourceEvents(e){const r=this,{scheduler:t}=r,{assignmentStore:i,eventStore:n,timeAxis:s}=t;let a=n.getEvents({includeOccurrences:t.enableRecurringEvents,resourceRecord:e,startDate:s.startDate,endDate:s.endDate,filter:(i.isFiltered||n.isFiltered)&&(o=>o.assignments.some(l=>l.resource===e&&i.includes(l)))});return a=t.getEventsToRender(e,a),r.layoutEvents(e,a)}addTemporaryDragElement(e){const{scheduler:r}=this,t=r.generateRenderData(e,e.resource,{timeAxis:!0,viewport:!0});t.top=t.row?t.top+t.row.top:r.getResourceEventBox(e,e.resource,!0).top;const i=this.renderEvent({renderData:t}),{dataset:n}=i;delete i.tabIndex,delete n.eventId,delete n.resourceId,delete n.assignmentId,delete n.syncId,n.transient=!0,i.parent=this.scheduler.foregroundCanvas,i.retainElement=!0;const s=w.createElement(i);return s.innerElement=s.firstChild,e.instanceMeta(r).hasTemporaryDragElement=!0,s}renderEvent(e){const{scheduler:r}=this,t=e.renderData,{resourceRecord:i,assignmentRecord:n,eventRecord:s}=t,a={className:t.wrapperCls,tabIndex:-1,children:[{role:"presentation",className:t.cls,style:(t.internalStyle||"")+(t.style||""),children:t.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...t.wrapperChildren],style:{top:t.top,[r.rtl?"right":"left"]:t.left,height:s.isMilestone?"1em":t.height,width:t.width,style:t.wrapperStyle||"",fontSize:s.isMilestone?Math.min(t.width,40):null},dataset:{resourceId:i.id,eventId:t.eventId,syncId:n?this.assignmentStore.getOccurrence(n,s).id:t.eventId},elementData:e,retainElement:(n||s).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return a.className["b-sch-vertical"]=1,t.zIndex&&(a.zIndex=t.zIndex),n&&(a.dataset.assignmentId=n.id),t.elementConfig=e.elementConfig=a,r.afterRenderEvent({renderData:t,domConfig:a}),a}renderResource(e){var r;const t=this,{topDateMS:i,bottomDateMS:n}=t,s=[];let a=t.resourceMap.get(e.id);a||(a=t.layoutResourceEvents(e));for(const o in a){const l=a[o],{endDateMS:c,startDateMS:d,eventRecord:u}=l.renderData;if(c>=i&&d<=n&&!u.instanceMeta(t.scheduler).hasTemporaryDragElement){const h=((r=l.elementConfig)==null?void 0:r.className)!=="b-released"&&l.elementConfig||t.renderEvent(l);s.push(h)}}return s}isEventElement(e){const r=e&&e.className;return r&&r[this.scheduler.eventCls+"-wrap"]}get shouldWaitForInitializeAndEngineReady(){return!this.initialized||!this.scheduler.isEngineReady&&!this.scheduler.isCreating}renderer(){const e=this,{scheduler:r}=e,{first:t,last:i}=e.resourceRange,{topDate:n,bottomDate:s}=e.dateRange,a=[],o=[];if(!e.shouldWaitForInitializeAndEngineReady){if(!b.isEqual(n,e.topDate)||!b.isEqual(s,e.bottomDate)){e.topDate=n,e.bottomDate=s,e.topDateMS=n.getTime(),e.bottomDateMS=s.getTime();const l=e.timeView.range={startDate:n,endDate:s};r.onVisibleDateRangeChange(l)}if(t!==-1&&i!==-1)for(let l=t;l<=i;l++)a.push.apply(a,e.renderResource(e.allResourceRecords[l]));if(r.getForegroundDomConfigs(o),a.push.apply(a,o),X.sync({domConfig:{onlyChildren:!0,children:a},targetElement:r.foregroundCanvas,syncIdField:"syncId",callback({action:l,domConfig:c,lastDomConfig:d,targetElement:u,jsx:h}){var g,f,m;const{reactComponent:p}=r;if(e.isEventElement(c)||h||(g=c==null?void 0:c.elementData)!=null&&g.jsx){const v=oO[l],y=lO[l];if((f=r.processEventContent)!=null&&f.call(r,{action:l,domConfig:c,isRelease:!1,targetElement:u,reactComponent:p,jsx:h}))return;if(v&&e.isEventElement(d)&&!d.isReleased){const C=d.elementData.renderData,D={renderData:C,assignmentRecord:C.assignmentRecord,eventRecord:C.eventRecord,resourceRecord:C.resourceRecord,element:u};(m=r.processEventContent)==null||m.call(r,{isRelease:v,targetElement:u,reactComponent:p,assignmentRecord:C.assignmentRecord}),u===w.getActiveElement(u)&&r.focusElement.focus(),r.trigger("releaseEvent",D)}if(y){const C=c.elementData.renderData,D={renderData:C,assignmentRecord:C.assignmentRecord,eventRecord:C.eventRecord,resourceRecord:C.resourceRecord,element:u,isReusingElement:l==="reuseElement",isRepaint:l==="reuseOwnElement"};D.reusingElement=l==="reuseElement",r.trigger("renderEvent",D)}}}}),e.firstResource!==t||e.lastResource!==i){const l=e.resourceColumns.visibleResources={firstResource:t,lastResource:i};e.firstResource=t,e.lastResource=i,r.onVisibleResourceRangeChange(l),r.trigger("resourceRangeChange",l)}}}refresh(e){this.scheduler.runWithTransition(()=>this.renderer(),e)}refreshResources(e){this.clearResources(e),this.refresh()}refreshEventsForResource(e,r=!0,t=!0){this.refreshResources([e.id])}onRenderDone(){}get timeView(){return this.scheduler.timeView}clearResources(e){const{resourceMap:r,eventMap:t}=this;e.forEach(i=>{r.has(i)&&(Object.values(r.get(i)).forEach(({renderData:{eventId:n}})=>{delete t.get(n)[i]}),r.delete(i))})}clearAll(){this.resourceMap.clear(),this.eventMap.clear()}};ah._$name="VerticalRendering";function uO(e,r){return e===r.length-1}function hO(e,r){return r===e.cells[e.cells.length-1]}var fc=class extends ${constructor(){super(...arguments),E(this,"startDate",null),E(this,"endDate",null),E(this,"levels",[]),E(this,"size",null)}set range({startDate:e,endDate:r}){var t;const i=this;if(i.startDate-e||i.endDate-r){const{client:n}=i;if(i.startDate=e,i.endDate=r,i.sizeProperty==="width"&&(n!=null&&n.hideHeaders)||i.sizeProperty==="height"&&((t=n==null?void 0:n.verticalTimeAxisColumn)!=null&&t.hidden))return;i.refresh()}}buildCells(e=this.startDate,r=this.endDate){var t;const i=this,{sizeProperty:n}=i,{stickyHeaders:s,isVertical:a}=i.client||{},o=[],{length:l}=i.levels,c=i.levels.map((d,u)=>{var h;const g=s&&(a||u<l-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${d.position}`]:1,"b-sch-header-row-main":u===i.model.viewPreset.mainHeaderLevel,"b-lowest":uO(u,i.levels),"b-sticky-header":g},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${u}`,headerPosition:d.position},children:(h=d.cells)==null?void 0:h.filter(f=>f.start<r&&f.end>e).map((f,m)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[f.headerCellCls]:f.headerCellCls,[`b-align-${f.align}`]:f.align,"b-last":hO(d,f)},dataset:{tickIndex:f.index,...globalThis.DEBUG&&{date:f.start.getTime()}},style:{[i.positionProperty]:f.coord,[n]:f.width,[`min-${n}`]:f.width},children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":g},html:f.value}]}))}});return(t=i.client)==null||t.getHeaderDomConfigs(o),c.push(...o),{className:i.widgetClassList,syncOptions:{releaseThreshold:0},children:c}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const r=this,{columnConfig:t}=r.model,{levels:i}=r,n=i.length;if(e){i.length=0,t.forEach((a,o)=>i[o]={position:o,cells:a}),r.size=i[0].cells.reduce((a,o)=>a+o.width,0);const{parentElement:s}=r.element;s&&(i.length!==n||e)&&(s.classList.remove(`b-sch-timeaxiscolumn-levels-${n}`),s.classList.add(`b-sch-timeaxiscolumn-levels-${i.length}`))}!r.startDate||!r.endDate||(X.sync({domConfig:r.buildCells(),targetElement:r.element,syncIdField:"headerFeature"}),r.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}};E(fc,"$name","TimeAxisBase"),E(fc,"configurable",{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}),fc._$name="TimeAxisBase";var za=class extends fc{get positionProperty(){var e;return(e=this.owner)!=null&&e.rtl?"right":"left"}get width(){return this.size}onModelUpdate(){var e;!((e=this.owner)!=null&&e.hideHeaders)&&this.model.availableSpace>0&&this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(e){this.detachListeners("tavm"),e==null||e.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}};E(za,"$name","HorizontalTimeAxis"),E(za,"type","horizontaltimeaxis"),E(za,"configurable",{model:null,sizeProperty:"width"}),za._$name="HorizontalTimeAxis";var Wa=class extends ${constructor(){super(...arguments),E(this,"firstResource",-1),E(this,"lastResource",-1)}construct(e){const r=this;e.scheduler._resourceColumns=r,super.construct(e),r.imagePath!=null&&r.element.classList.add("b-has-images"),B.on({element:r.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:r})}changeShowAvatars(e){var r;return(r=this.avatarRendering)==null||r.destroy(),e&&(this.avatarRendering=new qn({element:this.element})),e}updateShowAvatars(){this.isConfiguring||this.refresh()}updateResourceStore(e){const r=this;r.detachListeners("resourceStore"),e&&(e.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:r}),e.count&&r.onResourceStoreDataChange({}))}onResourceStoreDataChange({action:e}){const r=this;r.getConfig("fillWidth"),r.getConfig("fitWidth"),r.updateWidthCache();const{element:t}=r,i=r.totalWidth;r.scheduler.variableColumnWidths?r._fillWidth=r._fitWidth=!1:(r._fillWidth=r.configuredFillWidth,r._fitWidth=r.configuredFitWidth),i!==r.width&&(w.setLength(t,"width",i),r.column.set("width",i,r.column.grid.isConfiguring)),e==="removeall"&&(t.innerHTML=""),(e==="remove"||e==="add"||e==="filter"||r.fitWidth||r.fillWidth)&&r.refreshWidths(),r.column.grid.toggleEmptyText()}get totalWidth(){return this.updateWidthCache()}updateWidthCache(){let e=0;const{scheduler:r}=this;return r.variableColumnWidths=!1,r.resourceStore.forEach(t=>{t.instanceMeta(r).insetStart=e,t.instanceMeta(r).insetEnd=e+(t.columnWidth||r.resourceColumnWidth),t.columnWidth==null?e+=r.resourceColumnWidth:(e+=t.columnWidth,r.variableColumnWidths=!0)}),e}changeColumnWidth(e){return this.refreshingWidths||(this.configuredColumnWidth=e),e}updateColumnWidth(e,r){const t=this;t.refreshingWidths||t.refreshWidths(),t.isConfiguring||(t.resourceStore.isGrouped&&t.updateWidthCache(),t.refresh(),t.trigger("columnWidthChange",{width:e,oldWidth:r}))}changeFillWidth(e){return this.configuredFillWidth=e}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(e){return this.configuredFitWidth=e}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(e){return O.joinPaths([this.imagePath||"",e||""])}updateImagePath(){this.isConfiguring||this.refresh()}updateAvailableWidth(e){this.refreshWidths()}refreshWidths(){var e;const r=this,{availableWidth:t,configuredColumnWidth:i}=r,n=(e=r.resourceStore)==null?void 0:e.count;if(!t||!n||r.scheduler.variableColumnWidths)return;r.refreshingWidths=!0;const s=r.fitWidth||r.fillWidth&&i*n<t,a=s?Math.floor(t/n):i,o=r.column.grid.enableEventAnimations&&Math.abs(r._columnWidth-a)>30;w.addTemporaryClass(r.element,"b-animating",o?300:0,r),r.columnWidth=a,r.refreshingWidths=!1}set visibleResources({firstResource:e,lastResource:r}){this.firstResource=e,this.lastResource=r,this.updateWidthCache(),this.refresh()}refresh(){var e;const r=this,{firstResource:t,scheduler:i,resourceStore:n,lastResource:s}=r,{variableColumnWidths:a}=i,o=n.isGrouped&&n.groupers[0].field,l=[];if(r.element.classList.toggle("b-grouped",!!o),!r.column.grid.isConfiguring&&t>-1&&s>-1&&s<n.count){let c;for(let d=t;d<=s;d++){const u=n.allResourceRecords[d],h=u.instanceMeta(n).groupParent,g=h==null?void 0:h.groupChildren;if(o&&h.id!==(c==null?void 0:c.dataset.resourceId)){const y=g[0].instanceMeta(i).insetStart,C=g[g.length-1].instanceMeta(i).insetEnd-y;c={className:"b-resourceheader-group-cell",dataset:{resourceId:h.id},style:{left:y,width:C},children:[{tag:"span",html:O.encodeHtml(g[0][o])},{className:"b-resourceheader-group-children",children:[]}]},l.push(c)}const f=u.instanceMeta(i),m=u.columnWidth||r.columnWidth,p=o?f.insetStart-c.style.left:a?f.insetStart:d*r.columnWidth,v={className:new J({"b-resourceheader-cell":1}),dataset:{resourceId:u.id},style:{[i.rtl?"right":"left"]:p,width:m},children:[]};if(r.headerRenderer){const y=r.headerRenderer({elementConfig:v,resourceRecord:u});y!=null&&(v.html=y)}else{let y;if(u.imageUrl)y=u.imageUrl;else if(r.imagePath!=null&&u.image!==!1){const C=u.image||((e=u.name)==null?void 0:e.toLowerCase())+r.imageExtension;y=r.getImageURL(C)}v.children.push(r.showAvatars&&r.avatarRendering.getResourceAvatar({resourceRecord:u,initials:u.initials,color:u.eventColor,iconCls:u.iconCls,defaultImageUrl:r.defaultImageName&&r.getImageURL(r.defaultImageName),imageUrl:y}),{tag:"span",className:"b-resource-name",html:O.encodeHtml(u.name)})}o?c.children[1].children.push(v):l.push(v)}}X.sync({domConfig:{onlyChildren:!0,children:l},targetElement:r.element,syncIdField:"resourceId"})}onResourceMouseEvent(e){const r=e.target.closest(".b-resourceheader-cell"),t=this.resourceStore.getById(r.dataset.resourceId);this.trigger("resourceHeader"+O.capitalize(e.type),{resourceRecord:t,event:e})}getCurrentConfig(e){const r=super.getCurrentConfig(e);return delete r.resourceStore,delete r.column,delete r.type,r}};E(Wa,"$name","ResourceHeader"),E(Wa,"type","resourceheader"),E(Wa,"configurable",{resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null}),Wa._$name="ResourceHeader";var mc=class extends Le(oi){static get fields(){return[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1,htmlEncode:!1}}static get type(){return"timeAxis"}construct(e){const r=this;super.construct(...arguments),r.thisObj=r,r.timeAxisViewModel=r.grid.timeAxisViewModel,r.mode=r.mode,r.grid.ion({paint:"onTimelinePaint",thisObj:r,once:!0})}static get autoExposeFields(){return!0}doDestroy(){var e,r;(e=this.resourceColumns)==null||e.destroy(),(r=this.timeAxisView)==null||r.destroy(),super.doDestroy()}set mode(e){const r=this,{grid:t}=r;r.set("mode",e),e==="horizontal"?r.timeAxisView=new za({model:r.timeAxisViewModel,compactCellWidthThreshold:r.compactCellWidthThreshold,owner:t,client:t}):e==="vertical"&&(r.resourceColumns=Wa.new({column:r,scheduler:t,resourceStore:t.resourceStore,imagePath:t.resourceImagePath,imageExtension:t.resourceImageExtension,defaultImageName:t.defaultResourceImageName},t.resourceColumns||{}),r.relayEvents(r.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:e}){const r=this;r.grid.timeAxisSubGrid.collapsed||(r.mode==="horizontal"?(r.refreshHeader(!0),r.width=e.totalSize,r.grid.refresh(),r.subGrid.refreshFakeScroll()):r.mode==="vertical"&&r.grid.refreshRows())}onTimelinePaint({firstPaint:e}){var r;const t=this;t.subGrid.insertRowsBefore&&e&&(t.subGridElement.classList.add("b-timeline-subgrid"),t.mode==="vertical"&&(t.refreshHeader(),(r=t.grid)==null||r.onHeightChange()))}refreshHeader(e){const r=this,{element:t}=r;t&&(r.mode==="horizontal"?(!e&&r.timeAxisViewModel.update(void 0,void 0,!0),r.timeAxisView.rendered?r.timeAxisView.refresh(!0):(t.innerHTML="",r.timeAxisView.render(t))):r.mode==="vertical"&&(r.resourceColumns.currentElement?r.resourceColumns.refresh():(t.innerHTML="",r.resourceColumns.render(t))))}internalRenderer(e){const{grid:r}=this;return r.project.isInitialCommitPerformed||r.project.isDelayingCalculation?(r.currentOrientation.renderer(e),super.internalRenderer(e)):""}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(e){const r=this;r.detachListeners("tavm"),e==null||e.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:r}),r._timeAxisViewModel=e,r.timeAxisView&&(r.timeAxisView.model=e)}getState(){const e=super.getState();return delete e.width,delete e.flex,e}};E(mc,"$name","TimeAxisColumn"),Z.registerColumnType(mc),mc._$name="TimeAxisColumn";var m0=class extends fc{static get $name(){return"VerticalTimeAxis"}static get configurable(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}buildHorizontalCells(){const e=this,{client:r}=e,t=r==null?void 0:r.stickyHeaders,i=[],n=e.levels.reduce((s,a,o)=>{var l;return a.cells&&s.push(...(l=a.cells)==null?void 0:l.filter(c=>c.start<e.endDate&&c.end>e.startDate).map((c,d,u)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[c.headerCellCls]:c.headerCellCls,[`b-align-${c.align}`]:c.align,"b-last":d===u.length-1,"b-lowest":o===e.levels.length-1},dataset:{tickIndex:c.index,cellId:`${o}-${c.index}`,headerPosition:o,...globalThis.DEBUG&&{date:c.start.getTime()}},style:{top:c.coord,height:c.width,minHeight:c.width},children:[{role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":t},html:c.value}]}))),s},[]);return r==null||r.getHeaderDomConfigs(i),n.push(...i),{className:e.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:n}}get height(){return this.size}};m0._$name="VerticalTimeAxis";var oh=class extends ye{static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,minWidth:0,resizable:!1,cellCls:"b-verticaltimeaxiscolumn",locked:!0,flex:1,alwaysClearCell:!1}}get isFocusable(){return!1}construct(e){super.construct(...arguments),this.view=new m0({model:this.grid.timeAxisViewModel,client:this.grid})}renderer({cellElement:e,size:r}){this.view.render(e),r.height=this.view.height}getCurrentConfig(e){const r=super.getCurrentConfig(e);return delete r.id,delete r.region,delete r.type,delete r.field,delete r.ariaLabel,delete r.cellAriaLabel,r}};E(oh,"$name","VerticalTimeAxisColumn"),Z.registerColumnType(oh),oh._$name="VerticalTimeAxisColumn";var gO={month:"MMMM, YYYY",week:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"],day:"MMMM D, YYYY"},pr=class extends ns.mixin(sh,r0,i0,n0,Dv,o0,d0,s0,l0,u0,wv,Qx,Ev){constructor(){super(...arguments),E(this,"timeCellSelector",".b-sch-timeaxis-cell"),E(this,"resourceTimeRangeSelector",".b-sch-resourcetimerange")}static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:th,testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}afterConstruct(){const e=this;super.afterConstruct(),e.ion({scroll:"onVerticalScroll",thisObj:e}),e.createEventOnDblClick&&e.ion({scheduledblclick:e.onTimeAxisCellDblClick})}onPaintOverride(){}get store(){return super.store}set store(e){super.store=e}get visibleResources(){var e,r;const t=this;return t.isVertical?t.currentOrientation.visibleResources:{first:t.store.getById((e=t.firstVisibleRow)==null?void 0:e.id),last:t.store.getById((r=t.lastVisibleRow)==null?void 0:r.id)}}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onTimeAxisCellDblClick({date:e,resourceRecord:r,row:t}){this.createEvent(e,r,t)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}onEventCreated(e){}get isHorizontal(){return this.mode==="horizontal"}get isVertical(){return this.mode==="vertical"}get mode(){return this._mode}set mode(e){const r=this;r._mode=e,r[e]||(r.element.classList.add(`b-sch-${e}`),e==="horizontal"?(r.horizontal=new gc(r),r.isPainted&&r.horizontal.init()):e==="vertical"&&(r.vertical=new ah(r),r.rendered&&r.vertical.init()))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){return super.onElementKeyDown(e)}onElementKeyUp(e){return super.onElementKeyUp(e)}onElementMouseOver(e){return super.onElementMouseOver(e)}onElementMouseOut(e){return super.onElementMouseOut(e)}processEventDrop(){}processCrossSchedulerEventDrop(){}beforeEventDragStart(){}afterEventDragStart(){}afterEventDragAbortFinalized(){}checkEventDragValidity(){}afterEventResizeStart(){}afterRenderEvent(){}get hasEventEditor(){return!!this.eventEditingFeature}get eventEditingFeature(){const{eventEdit:e,taskEdit:r,simpleEventEdit:t}=this.features;return e!=null&&e.enabled?e:r!=null&&r.enabled?r:t!=null&&t.enabled?t:null}editEvent(e,r,t){const i=this,{eventStore:n,assignmentStore:s}=i;if(!i.hasEventEditor)return!1;if(e.eventStore!==n){const{enableEventAnimations:a}=i,o=[];e.isCreating=!0;let l=[];if(r&&(o.push(r),l=s.assignEventToResource(e,r)),i.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:o,assignmentRecords:l})===!1)return s==null||s.remove(l),!1;i.enableEventAnimations=!1,n.add(e),i.project.commitAsync().then(()=>i.enableEventAnimations=a),i.refreshRows()}}async createEvent(e,r){var t,i;const n=this,{enableEventAnimations:s,eventStore:a,assignmentStore:o,hasEventEditor:l}=n,c=[r],d=n.createEventOnDblClick.useEventModelDefaults,u=d?a.modelClass.defaultValues.duration:1,h=d?a.modelClass.defaultValues.durationUnit:n.timeAxis.unit,g=a.createRecord({startDate:e,endDate:b.add(e,u,h),duration:u,durationUnit:h,name:n.L("L{Object.newEvent}")});if(n.readOnly||r.isSpecialRow||r.readOnly||!n.allowOverlap&&!n.isDateRangeAvailable(g.startDate,g.endDate,null,r))return;(t=n.eventEditingFeature)==null||t.captureStm(!0),g.isCreating=l,n.onEventCreated(g);const f=o==null?void 0:o.assignEventToResource(g,r);if(n.trigger("beforeEventAdd",{eventRecord:g,resourceRecords:c,assignmentRecords:f})===!1){o==null||o.remove(f),(i=n.eventEditingFeature)==null||i.freeStm(!1);return}n.enableEventAnimations=!1,a.add(g),n.project.commitAsync().then(()=>n.enableEventAnimations=s),n.isCreating=!0,n.refreshRows(),n.isCreating=!1,await n.scrollEventIntoView(g),n.trigger("eventAutoCreated",{eventRecord:g,resourceRecord:r}),l&&n.editEvent(g,r,n.getEventElement(g))}isDateRangeAvailable(e,r,t,i){return this.eventStore.isDateRangeAvailable(e,r,t,i)}async resumeRefresh(e){super.resumeRefresh(!1);const r=this;if(!r.refreshSuspended&&e){if(!r.isEngineReady)return r.currentOrientation.refreshAllWhenReady=!0,r.project.commitAsync();r.isDestroyed||r.refreshWithTransition()}}toggleEmptyText(){var e;const r=this;r.bodyContainer&&w.toggleClasses(r.bodyContainer,"b-grid-empty",!(r.resourceStore.count>0||(e=r.crudManager)!=null&&e.isLoading))}getRowHeight(e){if(this.isHorizontal){const r=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,r),r}}calculateRowHeights(e,r=!1){e.forEach(t=>t&&this.getRowHeight(t)),r||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:r,rowManager:t}=this,i=Math.min(r.count,this.preCalculateHeightLimit);if(i){t.clearKnownHeights();for(let n=0;n<i;n++)this.getRowHeight(r.getAt(n));e||t.estimateTotalHeight(!0)}}get dateBounds(){const e=this,r=[e.startDate];return e.range==="week"&&r.push(e.lastDate),r}get defaultDescriptionFormat(){return gO[this.range]}get lastDate(){const e=this.endDate;return e&&b.add(e,-1,"day")}getEventRecord(e){return e=w.getEventElement(e),this.resolveEventRecord(e)}getEventElement(e){return this.getElementFromEventRecord(e)}changeRange(e){return b.normalizeUnit(e)}updateRange(e){if(!this.isConfiguring){const r=this.date,t=this.date=b.startOf(r,e);r.getTime()===t.getTime()&&this.updateDate(t)}}changeStepUnit(e){return b.normalizeUnit(e)}updateDate(e){const r=this,t=b.startOf(e,r.range);r.setTimeSpan(t,b.add(t,1,r.range)),r.visibleDate={date:b.max(e,r.timeAxis.startDate),block:"start",animate:!0},r.trigger("descriptionChange")}updateScrollBuffer(e){this.isConfiguring||(this.currentOrientation.scrollBuffer=e)}previous(){this.date=b.add(this.date,-1,this.stepUnit)}next(){this.date=b.add(this.date,1,this.stepUnit)}async scheduleEvent({startDate:e,eventRecord:r,resourceRecord:t,element:i}){const n=this;if(n.eventStore.includes(r)||([r]=n.eventStore.add(r)),r.startDate=e,r.assign(t),i){const s=k.from(i,n.foregroundCanvas);w.setTranslateXY(i,0,0),w.setTopLeft(i,s.y,s.x),X.addChild(n.foregroundCanvas,i,r.assignments[0].id)}await n.project.commitAsync()}};E(pr,"$name","SchedulerBase"),E(pr,"type","schedulerbase"),E(pr,"configurable",{date:{value:null,$config:{equal:"date"}},stepUnit:"week",range:"week",getDateConstraints:null,verticalTimeAxisColumn:{},createEventOnDblClick:!0,scrollBuffer:0,schedulableAreaSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",sortFeatureStore:"resourceStore",showEventColorPickers:null}),pr.initClass(),pr._$name="SchedulerBase";var Ga=class extends Vn{colorSelected({color:e}){this.record&&(this.record.eventColor=e)}};E(Ga,"$name","EventColorPicker"),E(Ga,"type","eventcolorpicker"),E(Ga,"configurable",{colorClasses:pr.eventColors,colorClassPrefix:"b-sch-",colors:null,record:null}),Ga.initClass(),Ga._$name="EventColorPicker";var Ua=class extends Vi{};E(Ua,"$name","EventColorColumn"),E(Ua,"type","eventcolor"),E(Ua,"defaults",{colorEditorType:"eventcolorpicker",field:"eventColor"}),Z.registerColumnType(Ua),Ua._$name="EventColorColumn";var Rv=class extends ye{static get $name(){return"ResourceCollapseColumn"}static get type(){return"resourceCollapse"}static get defaults(){return{width:"3em",align:"center",sortable:!1,groupable:!1,editor:!1,minWidth:0,cellCls:"b-resourcecollapse-cell",renderer:({record:e})=>({tag:"i",class:{"b-icon":1,"b-icon-expand-resource":1,"b-flip":e.eventLayout!=="none"}})}}onCellClick({record:e,event:r}){r.preventDefault(),e.eventLayout=e.eventLayout!=="none"?"none":"stack"}};Z.registerColumnType(Rv),Rv._$name="ResourceCollapseColumn";var lh=class extends ye{static get $name(){return"ResourceInfoColumn"}static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showMeta","showImage","validNames","autoScaleThreshold","useNameAsImageName"]}static get defaults(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,validNames:null,autoScaleThreshold:40,useNameAsImageName:!0,field:"name",htmlEncode:!1,width:140,cellCls:"b-resourceinfo-cell",editor:ne.isTestEnv?!1:"text"}}construct(...e){super.construct(...e),this.avatarRendering=new qn({element:this.grid.element})}doDestroy(){super.doDestroy(),this.avatarRendering.destroy()}getImageURL(e){const r=this.grid.resourceImagePath||"",t=r.split("//"),i=t.length>1?t[1]:r,n=O.joinPaths([i||"",e||""]);return t.length>1?t[0]+"//"+n:n}template(e,r){const t=this,{showImage:i,showRole:n,showMeta:s,showEventCount:a,grid:o}=t,{timeAxis:l,resourceImageExtension:c="",defaultResourceImageName:d}=o,u=typeof n=="string"?n:"role",h=a&&e.eventStore.getEvents({includeOccurrences:o.enableRecurringEvents,resourceRecord:e,startDate:l.startDate,endDate:l.endDate}).length;let g;if(i&&e.image!==!1)if(e.imageUrl)g=e.imageUrl;else{const f=typeof i=="string"?i:e.image||r&&t.useNameAsImageName&&r.toLowerCase()+c||d||"";g=f&&t.getImageURL(f),g&&!f.includes(".")&&(!t.validNames||t.validNames.includes(f))&&(g+=c)}return{class:"b-resource-info",children:[i&&t.avatarRendering.getResourceAvatar({resourceRecord:e,initials:e.initials,color:e.eventColor,iconCls:e.iconCls,imageUrl:g,defaultImageUrl:d&&this.getImageURL(d)}),n||a||s?{tag:"dl",children:[{tag:"dt",text:r},n?{tag:"dd",class:"b-resource-role",text:e.getValue(u)}:null,a?{tag:"dd",class:"b-resource-events",html:t.L("L{eventCountText}",h)}:null,s?{tag:"dd",class:"b-resource-meta",html:t.showMeta(e)}:null]}:r]}}defaultRenderer({grid:e,record:r,cellElement:t,value:i,isExport:n}){let s;return r.isSpecialRow?s="":n?s=i:(this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?t.style.fontSize=e.rowHeight/40+"em":t.style.fontSize="",s=this.template(r,i)),s}};Z.registerColumnType(lh),lh._$name="ResourceInfoColumn";var Ya=class extends ye{static get fields(){return["scalePoints"]}static get defaults(){return{text:"\xA0",width:40,minWidth:40,field:"scalePoints",cellCls:"b-scale-cell",editor:!1,sortable:!1,groupable:!1,filterable:!1,alwaysClearCell:!1,scalePoints:null}}onDestroy(){this.scaleWidget.destroy()}set width(e){super.width=e,this.scaleWidget.width=e}get width(){return super.width}applyValue(e,r,t){return r==="scalePoints"&&(this.scaleWidget[r]=t),super.applyValue(...arguments)}buildScaleWidget(){const e=this,r=new vu({owner:e.grid,appendTo:e.grid.floatRoot,cls:"b-hide-offscreen",align:"right",scalePoints:e.scalePoints,monitorResize:!1});return Object.defineProperties(r,{width:{get(){return e.width},set(t){this.element.style.width=`${t}px`,this._width=e.width}},height:{get(){return this._height},set(t){this.element.style.height=`${t}px`,this._height=t}}}),r.width=e.width,r}get scaleWidget(){const e=this;return e._scaleWidget||(e._scaleWidget=e.buildScaleWidget()),e._scaleWidget}renderer({cellElement:e,value:r,scaleWidgetConfig:t,scaleWidget:i=this.scaleWidget}){T.assign(i,{scalePoints:r||this.scalePoints,height:this.grid.rowHeight},t),i.refresh();const n=i.element.cloneNode(!0);n.removeAttribute("id"),n.classList.remove("b-hide-offscreen"),e.innerHTML="",e.appendChild(n)}};E(Ya,"$name","ScaleColumn"),E(Ya,"type","scale"),E(Ya,"isScaleColumn",!0),Z.registerColumnType(Ya),Ya._$name="ScaleColumn";var Tv=class extends We(){static get $name(){return"RecurrenceLegend"}static get allDaysValueAsArray(){return["SU","MO","TU","WE","TH","FR","SA"]}static get allDaysValue(){return this.allDaysValueAsArray.join(",")}static get workingDaysValue(){return this.allDaysValueAsArray.filter((e,r)=>!b.nonWorkingDays[r]).join(",")}static get nonWorkingDaysValue(){return this.allDaysValueAsArray.filter((e,r)=>b.nonWorkingDays[r]).join(",")}static getLegend(e,r){const t=this,{timeSpan:i,interval:n,days:s,monthDays:a,months:o,positions:l}=e,c=r||i.startDate,d={interval:n};let u;switch(e.frequency){case"DAILY":return n===1?t.L("L{Daily}"):t.L("L{Every {0} days}",d);case"WEEKLY":return s&&s.length?d.days=t.getDaysLegend(s):c&&(d.days=b.getDayName(c.getDay())),t.L(n===1?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",d);case"MONTHLY":return s&&s.length&&l&&l.length?d.days=t.getDaysLegend(s,l):a&&a.length?(a.sort((h,g)=>h-g),d.days=t.arrayToText(a)):c&&(d.days=c.getDate()),t.L(n===1?"L{Monthly on {1}}":"L{Every {0} months on {1}}",d);case"YEARLY":return s&&s.length&&l&&l.length?d.days=t.getDaysLegend(s,l):d.days=c.getDate(),o&&o.length?(o.sort((h,g)=>h-g),o.length>2?u=h=>b.getMonthShortName(h-1):u=h=>b.getMonthName(h-1),d.months=t.arrayToText(o,u)):d.months=b.getMonthName(c.getMonth()),t.L(n===1?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",d)}}static getDaysLegend(e,r){const t=this,i={position:""};let n;if(r&&r.length&&(i.position=t.arrayToText(r,s=>t.L(`L{position${s}}`))),e.length)switch(e.sort((s,a)=>Gt.decodeDay(s)[0]-Gt.decodeDay(a)[0]),e.join(",")){case t.allDaysValue:i.days=t.L("L{day}");break;case t.workingDaysValue:i.days=t.L("L{weekday}");break;case t.nonWorkingDaysValue:i.days=t.L("L{weekend day}");break;default:e.length>2?n=s=>b.getDayShortName(Gt.decodeDay(s)[0]):n=s=>b.getDayName(Gt.decodeDay(s)[0]),i.days=t.arrayToText(e,n)}return t.L("L{daysFormat}",i)}static arrayToText(e,r){return r&&(e=e.map(r)),e.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}};Tv._$name="RecurrenceLegend";var ss=class extends F{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(e){return`<div class="b-sch-clockwrap b-sch-clock-${e.mode||this.mode} ${e.cls||""}">
                    <div class="b-sch-clock">
                        <div class="b-sch-hour-indicator">${b.format(e.date,"MMM")}</div>
                        <div class="b-sch-minute-indicator">${b.format(e.date,"D")}</div>
                        <div class="b-sch-clock-dot"></div>
                    </div>
                    <span class="b-sch-clock-text">${O.encodeHtml(e.text)}</span>
                </div>`}}}generateContent(e){return this.div.innerHTML=this.template(e)}updateDateIndicator(e,r){const t=e==null?void 0:e.querySelector(".b-sch-hour-indicator"),i=e==null?void 0:e.querySelector(".b-sch-minute-indicator");r&&t&&i&&q.isBrowserEnv&&(this.mode==="hour"?(t.style.transform=`rotate(${r.getHours()%12*30}deg)`,i.style.transform=`rotate(${r.getMinutes()*6}deg)`):(t.style.transform="none",i.style.transform="none"))}set mode(e){this._mode=e}get mode(){if(this._mode)return this._mode;const e=b.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,r=b.formatContainsHourInfo(this.scheduler.displayDateFormat);return e&&r?"hour":"day"}set template(e){this._template=e}get template(){return this._template}};ss._$name="ClockTemplate";var ch=class extends Q{static get defaultConfig(){return{tooltipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    ${e.startClockHtml}
                    ${e.endClockHtml}
                    <div class="b-sch-tip-message">${e.message}</div>
                </div>
            `,showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip"}}static get configurable(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,constrainDragToTimeSlot:!1,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0}}static get pluginConfig(){return{chain:["onPaint"]}}internalSnapToPosition(e){var r;const{dragData:t}=this;(r=this.snapToPosition)==null||r.call(this,{assignmentRecord:t.assignmentRecord,eventRecord:t.eventRecord,resourceRecord:t.newResource||t.resourceRecord,startDate:t.startDate,endDate:t.endDate,snapTo:e})}buildDragHelperConfig(){const e=this,{client:r,constrainDragToTimeline:t,constrainDragToResource:i,constrainDragToTimeSlot:n,dragHelperConfig:s={}}=e,{timeAxisViewModel:a,isHorizontal:o}=r,l=o?i:n,c=o?n:i;return e.externalDropTargetSelector&&(s.dropTargetSelector=`.b-timeaxissubgrid,${e.externalDropTargetSelector}`),N.merge({name:e.constructor.name,positioning:"absolute",lockX:c,lockY:l,minX:!0,maxX:!0,constrain:!1,cloneTarget:!t,removeProxyAfterDrop:!1,dragWithin:t?null:document.body,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",dropTargetCls:e.externalDropTargetSelector?"b-drop-target":"",outerElement:r.timeAxisSubGridElement,targetSelector:r.eventSelector,scrollManager:t?r.scrollManager:null,createProxy:d=>e.createProxy(d),snapCoordinates:({element:d,newX:u,newY:h})=>{const{dragData:g}=e;if(e.constrainDragToTimeline&&!e.constrainDragToTimeSlot&&(e.showExactDropPosition||a.snap)){const m=g.draggedEntities[0],p=e.getCoordinate(m,d,[u,h]),v=a.getDateFromPosition(p,"round"),{calendar:y}=m;if(!y||v&&y.isWorkingTime(v,b.add(v,m.fullDuration))){const C=v&&a.getPositionFromDate(v);v&&v>=r.startDate&&C!=null&&(o?u=C:h=C)}}const f={x:u,y:h};return e.internalSnapToPosition(f),f},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",afterdragstart:"onAfterDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:e}},s,{isElementDraggable:(d,u)=>(!s||!s.isElementDraggable||s.isElementDraggable(d,u))&&e.isElementDraggable(d,u)})}onPaint({firstPaint:e}){var r;const t=this,{client:i}=t;(r=t.drag)==null||r.destroy(),t.drag=ki.new(t.buildDragHelperConfig()),e&&i.rowManager.ion({changeTotalHeight:()=>{var n;return t.updateYConstraint((n=t.dragData)==null?void 0:n[`${i.scheduledEventName}Record`])},thisObj:t}),t.showTooltip&&(t.clockTemplate=new ss({scheduler:i}))}doDestroy(){var e,r,t;(e=this.drag)==null||e.destroy(),(r=this.clockTemplate)==null||r.destroy(),(t=this.tip)==null||t.destroy(),super.doDestroy()}get tipId(){return`${this.client.id}-event-drag-tip`}changeTip(e,r){const t=this;if(e){const i=ve.reconfigure(r,ve.mergeConfigs({forElement:t.element,id:t.tipId,getHtml:t.getTipHtml.bind(t),cls:t.tooltipCls,owner:t.client},e),{owner:t.client,defaults:{type:"tooltip"}});return i.ion({innerHtmlUpdate:"updateDateIndicator",thisObj:t}),i}else r==null||r.destroy()}createProxy(e){const r=e.cloneNode(!0);return delete r.id,r.classList.add(`b-sch-${this.client.mode}`),r}onBeforeDragStart({context:e,event:r}){var t;const i=this,{client:n}=i,s=i.getMinimalDragData(e,r),a=s==null?void 0:s[`${n.scheduledEventName}Record`],o=s.resourceRecord;if(n.readOnly||i.disabled||!a||a.isDraggable===!1||a.readOnly||o!=null&&o.readOnly)return!1;e.pointerStartDate=n.getDateFromXY([e.startClientX,e.startPageY],null,!1);const l=i.triggerBeforeEventDrag(`before${n.capitalizedEventName}Drag`,{...s,event:r,context:{...e,...s}})!==!1;return l&&(i.updateYConstraint(a,o),(t=n[`before${n.capitalizedEventName}DragStart`])==null||t.call(n,e,s)),l}onAfterDragStart({context:e,event:r}){}get isDragging(){var e;return(e=this.drag)==null?void 0:e.isDragging}get isActivelyDragging(){return this.isDragging&&!this.finalizing}onDragStart({context:e,event:r}){var t,i,n;const s=this,a=(t=s.findClientFromTarget(r,e))!=null?t:s.client;s.currentOverClient=a,s.drag.unifiedProxy=s.unifiedDrag,s.onMouseOverNewTimeline(a,!0);const o=s.dragData=s.getDragData(e);if(s.suspendElementRedrawing(e.element),s.showTooltip&&s.tip){const u=o.context.dragProxy?o.context.dragProxy.firstChild:e.element;s.tip.showBy(u)}s.triggerDragStart(o),(i=a[`after${a.capitalizedEventName}DragStart`])==null||i.call(a,e,o);const{eventMenu:l,taskMenu:c}=a.features,d=l||c;(n=d==null?void 0:d.hideContextMenu)==null||n.call(d,!1)}updateDateIndicator(){const{startDate:e,endDate:r}=this.dragData,{tip:t,clockTemplate:i}=this,n=t.element.querySelector(".b-sch-tooltip-enddate");i.updateDateIndicator(t.element,e),n&&i.updateDateIndicator(n,r)}findClientFromTarget(e,r){let{target:t}=e;if(/^touch/.test(e.type)){const n=k.from(r.element,null,!0).center;t=w.elementFromPoint(n.x,n.y)}const i=$.fromElement(t,"timelinebase");return i!=null&&i.isResourceHistogram?null:i}onDrag({context:e,event:r}){const t=this,i=t.dragData,n=i.startDate;let s;if(t.constrainDragToTimeline?s=t.client:s=t.findClientFromTarget(r,i.context),t.updateDragContext(e,r),!!s){if(s!==t.currentOverClient&&t.onMouseOverNewTimeline(s),i.dirty||!t.throttleDragEvent){const a=i.valid;t.triggerEventDrag(i,n),a!==i.valid&&(i.context.valid=i.externalDragValidity=i.valid)}t.showTooltip&&t.tip&&(t.tip.lastAlignSpec.allowTargetOut=!i.valid,t.tip.realign())}}onMouseOverNewTimeline(e,r){const t=this,{drag:{lockX:i,lockY:n}}=t,s=[];t.currentOverClient.element.classList.remove("b-dragging-"+t.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),r||t.currentOverClient.scrollManager.stopMonitoring(),i||s.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n||s.push({element:e.scrollable.element,direction:"vertical"}),e.scrollManager.startMonitoring({scrollables:s,callback:t.drag.onScrollManagerScrollCallback}),t.currentOverClient=e}triggerBeforeEventDropFinalize(e,r,t){t.trigger(e,r)}onDrop({context:e,event:r}){var t;const i=this,{currentOverClient:n,dragData:s}=i;let a=!1;if(n==null||n.scrollManager.stopMonitoring(),(t=i.tip)==null||t.hide(),e.valid=e.valid&&i.isValidDrop(s),i.drag.removeProxyAfterDrop=!!s.externalDropTarget,e.valid&&s.startDate&&s.endDate){let o=!1;s.finalize=async l=>{o||s.async?await i.finalize(l):e.valid=e.valid&&l},i.triggerBeforeEventDropFinalize(`before${n.capitalizedEventName}DropFinalize`,{context:s,domEvent:r},n),o=!0,e.async=s.async,!e.async&&!s.externalDropTarget&&(a=s.startDate-s.origStart!==0||s.newResource!==s.resourceRecord)}e.async||i.finalize(s.valid&&e.valid&&a)}onDragAbort({context:e}){var r,t;const i=this;(r=i.currentOverClient)==null||r.scrollManager.stopMonitoring(),i.client.currentOrientation.onDragAbort({context:e,dragData:i.dragData}),i.resetDraggedElements(),(t=i.tip)==null||t.hide(),i.triggerDragAbort(i.dragData)}onDragAbortFinalized({context:e}){var r,t;const i=this;i.triggerDragAbortFinalized(i.dragData),(t=(r=i.client)[`after${i.client.capitalizedEventName}DragAbortFinalized`])==null||t.call(r,e,i.dragData)}onDragReset({source:e}){var r;const t=this,i=t.currentOverClient;(r=e.context)!=null&&r.started&&(t.resetDraggedElements(),i.trigger(`${i.scheduledEventName}DragReset`)),i==null||i.element.classList.remove(`b-dragging-${i.scheduledEventName}`),t.dragData=null}resetDraggedElements(){const{dragData:e}=this,{eventBarEls:r,draggedEntities:t}=e;this.resumeRecordElementRedrawing(e.record),t.forEach((i,n)=>{this.resumeRecordElementRedrawing(i),r[n].classList.remove(this.drag.draggingCls),r[n].retainElement=!1}),e.context.element.retainElement=!1}onInternalInvalidDrop(e){var r;const t=this,{context:i}=t.drag;(r=t.tip)==null||r.hide(),t.triggerAfterDrop(t.dragData,!1),i.valid=!1,e&&t.drag.abort()}async finalize(e){const r=this,{dragData:t,currentOverClient:i}=r,n=i.features.taskTooltip||i.features.eventTooltip;if(!t||r.finalizing)return;const{context:s,draggedEntities:a,externalDropTarget:o}=t;let l;return r.finalizing=!0,a.forEach((c,d)=>{r.resumeRecordElementRedrawing(c),t.eventBarEls[d].classList.remove(r.drag.draggingCls),t.eventBarEls[d].retainElement=!1}),s.element.retainElement=!1,o&&t.valid||e?(l=r.updateRecords(t),!o&&N.isPromise(l)&&(s.async=!0,await l),t.valid?(s.async&&s.finalize(),o&&r.client.refreshRows(!1),r.triggerAfterDrop(t,!0)):r.onInternalInvalidDrop(!0)):r.onInternalInvalidDrop(s.async||t.async),r.finalizing=!1,n!=null&&n.enabled&&(n.disabled=!0,i.setTimeout(()=>{n.disabled=!1},200)),l}updateDragContext(e,r){var t,i,n;const s=this,{drag:a}=s,o=s.dragData,l=s.currentOverClient,{isHorizontal:c}=l,[d]=o.draggedEntities,u=d.isAssignment?d.event:d,h=o.startDate,g=s.constrainDragToTimeSlot||(c?a.lockX:a.lockY);if(o.browserEvent=r,Object.assign(o,s.getProductDragContext(o)),g)o.timeDiff=0;else{let m;if(l.timeAxis.isContinuous){const p=l.isHorizontal?(t=e.pageX)!=null?t:e.startPageX:(i=e.pageY)!=null?i:e.startPageY,v=l.getDateFromCoordinate(p,null,!1,!0);m=o.timeDiff=v-e.pointerStartDate}else{const p=s.resolveStartEndDates(e.element);o.valid=!!(p.startDate&&p.endDate),o.valid&&(m=p.startDate-o.origStart)}m!==null&&(o.startDate=s.adjustStartDate(o.origStart,m),o.endDate=b.add(o.startDate,u.fullDuration),o.valid&&(o.timeDiff=o.startDate-o.origStart))}const f=o.dirty=o.dirty||h-o.startDate!==0;if(o.valid)if(s.constrainDragToTimeline&&(o.endDate<=l.timeAxis.startDate||o.startDate>=l.timeAxis.endDate))o.valid=!1,o.context.message=s.L("L{EventDrag.noDropOutsideTimeline}");else if(f||o.externalDropTarget){const m=o.externalDragValidity=!r||e.pageX&&s.checkDragValidity(o,r);!m||typeof m=="boolean"?(o.valid=m!==!1,o.context.message=""):(o.valid=m.valid!==!1,o.context.message=m.message)}else o.valid=o.externalDragValidity!==!1&&((n=o.externalDragValidity)==null?void 0:n.valid)!==!1;else o.valid=!1;o.context.valid=o.valid}suspendRecordElementRedrawing(e,r=!0){this.suspendElementRedrawing(this.getRecordElement(e),r),e.instanceMeta(this.client).retainElement=r}resumeRecordElementRedrawing(e){this.suspendRecordElementRedrawing(e,!1)}suspendElementRedrawing(e,r=!0){e&&(e.retainElement=r)}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e){const r=this,{client:t,drag:i}=r,n=r.setupProductDragData(e),{record:s,eventBarEls:a,draggedEntities:o}=n,{startEvent:l}=i,c=s.isAssignment?s.event:s,d=c.startDate,u=c.endDate,h=t.timeAxis,g=d<h.startDate,f=u>h.endDate,m=t.isSchedulerBase?t.multiEventSelect:t.selectionMode.multiSelect,p=r.getCoordinate(c,e.element,[e.elementStartX,e.elementStartY]),v=r.getCoordinate(c,e.element,[e.startClientX,e.startClientY]);r.suspendRecordElementRedrawing(s),o.forEach(C=>r.suspendRecordElementRedrawing(C)),s.isAssignment?t.selectAssignment(s,l.ctrlKey&&m):t.selectEvent(s,l.ctrlKey&&m);const y={context:e,...n,sourceDate:g?d:t.getDateFromCoordinate(p),screenSourceDate:t.getDateFromCoordinate(v,null,!1),startDate:d,endDate:u,timeDiff:0,origStart:d,origEnd:u,startsOutsideView:g,endsOutsideView:f,duration:u-d,browserEvent:l};return a.forEach(C=>C.classList.remove("b-sch-event-hover","b-active")),a.length>1&&(e.relatedElements=a.slice(1)),y}setupConstraints(e,r,t,i){const n=this,s=!n.showExactDropPosition&&t>1?t:0,a=0;i?n.setXConstraint(e.left,e.right-r.width,s):n.setXConstraint(!0,!0,s),n.setYConstraint(e.top,e.bottom-r.height,a)}updateYConstraint(e,r){const t=this,{client:i}=t,{context:n}=t.drag,s=i.timeAxisViewModel.snapPixelAmount;if(n&&!t.drag.lockY){let a;if(t.constrainDragToTimeline)a=i.getScheduleRegion(r,e);else{t.setYConstraint(null,null,s);return}t.setYConstraint(a.top,a.bottom-n.element.offsetHeight,s)}else t.setYConstraint(null,null,s)}setXConstraint(e,r,t){const{drag:i}=this;i.minX=e,i.maxX=r}setYConstraint(e,r,t){const{drag:i}=this;i.minY=e,i.maxY=r}adjustStartDate(e,r){const t=this.client.timeAxis.roundDate(new Date(e-0+r),this.client.snapRelativeToEventStartDate?e:!1);return this.constrainStartDate(t)}resolveStartEndDates(e){const r=this.currentOverClient,{timeAxis:t}=r,i=k.from(e.querySelector(r.eventInnerSelector),r.timeAxisSubGridElement),n=this.dragData,[s]=n.draggedEntities,a=s.isAssignment?s.event:s,{fullDuration:o}=a,l=r.fillTicks&&r.snapRelativeToEventStartDate;let{start:c,end:d}=r.getStartEndDatesFromRectangle(i,l?null:"round",o,!0);if(c&&d){if(l){const u=a.startDate-b.startOf(a.startDate,t.unit),h=d-c,g=u/h*i.width;i.deflate(g,0,0,g);const f=i.getStart(r.rtl,!r.isVertical);c=r.getDateFromCoordinate(f,null,!0),c=t.roundDate(c,a.startDate)}if(c=this.adjustStartDate(c,0),n.startsOutsideView)n.endsOutsideView||(c=d&&b.add(d,-o));else{if(!t.dateInAxis(c,!1)){const u=t.getTickFromDate(c);u>=0&&(c=t.getDateFromTick(u))}d=c&&b.add(c,o)}}return{startDate:c,endDate:d}}getTipHtml(){const e=this,{dragData:r,client:t,tooltipTemplate:i}=e,{startDate:n,endDate:s,draggedEntities:a}=r,o=t.getFormattedDate(n),l=t.getFormattedEndDate(s,n),{valid:c,message:d,element:u,dragProxy:h}=r.context,g=h?h.firstChild:u,f=a[0],m=f.isTask?f:f.event;return e.tip.lastAlignSpec.target=g,i({valid:c,startDate:n,endDate:s,startText:o,endText:l,dragData:r,message:d||"",[t.scheduledEventName+"Record"]:m,startClockHtml:e.clockTemplate.template({date:n,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:m.isMilestone?"":e.clockTemplate.template({date:s,text:l,cls:"b-sch-tooltip-enddate"})})}updateConstrainDragToTimeSlot(e){const r=this.client.isHorizontal?"lockX":"lockY";this.drag&&(this.drag[r]=e)}updateConstrainDragToResource(e){const r=this;if(r.drag){const{constrainDragToTimeSlot:t}=r,{isHorizontal:i}=r.client;e&&(r.constrainDragToTimeline=!0),r.drag.lockY=i?e:t,r.drag.lockX=i?t:e}}updateConstrainDragToTimeline(e){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!e,dragWithin:e?null:document.body,scrollManager:e?this.client.scrollManager:null})}constrainStartDate(e){const{dragData:r}=this,{dateConstraints:t}=r,i=r.eventRecord||r.taskRecord||r.draggedEntities[0];return t!=null&&t.start&&(e=b.max(t.start,e)),t!=null&&t.end&&(e=b.min(new Date(t.end-i.durationMS),e)),e}getElementFromContext(e){return e.grabbed||e.dragProxy||e.element}getRelatedRecords(e){return[]}getMinimalDragData(e,r){return{}}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,r){throw new Error("Implement in subclass")}getCoordinate(e,r,t){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}getRecordElement(e){throw new Error("Implement in subclass")}};ch._$name="DragBase";var p0={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"},qa=class extends Q.mixin(nu,fE){static get $name(){return"EventResize"}static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSize:null,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:5,touchHandleSize:null,dragThreshold:0,dragTouchStartDelay:0,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    ${e.startClockHtml}
                    ${e.endClockHtml}
                    <div class="b-sch-tip-message">${e.message}</div>
                </div>
            `,ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event"}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}doDestroy(){var e;super.doDestroy(),(e=this.dragging)==null||e.destroy()}render(){const e=this,{client:r}=e;e.dragSelector=e.dragItemSelector=r.eventSelector,e.dragRootElement=e.dropRootElement=r.timeAxisSubGridElement,e.dragLock=r.isVertical?"y":"x"}isEventElementDraggable(e,r,t,i){const n=this,s=r==null?void 0:r.resizable;return n.disabled||!s||r.isMilestone?!0:(s!==!0&&s!=="start"||!n.isOverStartHandle(i,e))&&(s!==!0&&s!=="end"||!n.isOverEndHandle(i,e))}onEventDataGenerated({eventRecord:e,wrapperCls:r,cls:t}){var i,n;e===((n=(i=this.dragging)==null?void 0:i.context)==null?void 0:n.eventRecord)&&(r["b-active"]=r[this.draggingItemCls]=r["b-over-resize-handle"]=t["b-resize-handle"]=t[this.resizingItemInnerCls]=1)}onDragPointerMove(e){var r;const{client:t,dragging:i}=this,{visibleDateRange:n,isHorizontal:s}=t,a=s&&t.rtl,o=s?"X":"Y",l=globalThis[`page${o}Offset`],c=e[`page${o}`]+(((r=i.context)==null?void 0:r.offset)||0),d=k.from(t.timeAxisSubGridElement,null,!0),u=d.getStart(a,s),h=d.getEnd(a,s);let g=t.getDateFromCoord({coord:c,local:!1});a?c-l>u?g=n.startDate:c<h&&(g=n.endDate):c-l<u?g=n.startDate:c-l>h&&(g=n.endDate),i.clientStartCoord=u,i.clientEndCoord=h,i.date=g,super.onDragPointerMove(e)}get isResizing(){return!!this.dragging}beforeDrag(e){const{client:r}=this,t=r.resolveTimeSpanRecord(e.itemElement),i=!r.isGanttBase&&r.resolveResourceRecord(r.isVertical?e.startEvent:e.itemElement);return this.disabled||r.readOnly||i!=null&&i.readOnly||t&&(t.readOnly||!(t.project||t.isOccurrence))||super.beforeDrag(e)===!1?!1:(e.mousedownDate=e.date=r.getDateFromCoordinate(e.event[`page${r.isHorizontal?"X":"Y"}`],null,!1),this.triggerBeforeResize(e))}dragStart(e){var r,t;const i=this,{client:n,tip:s}=i,{startEvent:a,itemElement:o}=e,l=n.scheduledEventName,c=n.resolveEventRecord(o),{isBatchUpdating:d,wrapStartDate:u,wrapEndDate:h}=c,g=(r=n.features.eventBuffer)==null?void 0:r.enabled,f=d?c.get("startDate"):c.startDate,m=d?c.get("endDate"):c.endDate,p=i.dragLock==="x",v=p&&n.rtl,y=i.isOverEndHandle(a,o),C=y?"endDate":"startDate",D=g?y?"wrapEndDate":"wrapStartDate":null,S=y?"startDate":"endDate",x=y?"setEndDate":"setStartDate",R=y?"setStartDate":"setEndDate",I=k.from(o),M=p?a.clientX:a.clientY,P=y?I.getEnd(v,p):I.getStart(v,p),_=e.context={eventRecord:c,element:o,timespanRecord:c,taskRecord:c,owner:i,valid:!0,oldValue:y?m:f,startDate:f,endDate:m,offset:g?0:P-M,edge:p?y?"right":"left":y?"bottom":"top",finalize:i.finalize,event:e.event,originalStartDate:f,originalEndDate:m,wrapStartDate:u,wrapEndDate:h,draggingEnd:y,toSet:C,wrapToSet:D,otherEnd:S,setMethod:x,setOtherMethod:R};c.meta.isResizing=!0,n.element.classList.add(...i.dragActiveCls.split(" ")),n.listenToBatchedUpdates||n.beginListeningForBatchedUpdates(),d||i.beginEventRecordBatch(c),i.setupProductResizeContext(_,a),i.triggerEventResizeStart(`${l}ResizeStart`,{[`${l}Record`]:c,event:a,...i.getResizeStartParams(_)},_),_.resizedRecord=((t=n.resolveAssignmentRecord)==null?void 0:t.call(n,_.element))||c,s&&(s.show(),s.align=p0[_.edge],s.showBy(i.getTooltipTarget(e)))}triggerBeforeResize(e){const{client:r}=this,t=r.resolveTimeSpanRecord(e.itemElement);return r.trigger(`before${r.capitalizedEventName}Resize`,{[`${r.scheduledEventName}Record`]:t,event:e.event,...this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})})}triggerEventResizeStart(e,r,t){var i,n;this.client.trigger(e,r),(n=(i=this.client)[`after${O.capitalize(e)}`])==null||n.call(i,t,r)}triggerEventResizeEnd(e,r){this.client.trigger(e,r)}triggerEventPartialResize(e,r){this.client.trigger(e,r)}triggerBeforeEventResizeFinalize(e,r){this.client.trigger(e,r)}dragEnter(e){var r;return((r=e.context)==null?void 0:r.owner)===this}resizeEventPartiallyInternal(e,r){var t;const{client:i}=this,{toSet:n}=r;if((t=i.features.eventBuffer)!=null&&t.enabled){if(n==="startDate"){const s=r.startDate.getTime()-r.originalStartDate.getTime();e.wrapStartDate=new Date(r.wrapStartDate.getTime()+s)}else if(n==="endDate"){const s=r.endDate.getTime()-r.originalEndDate.getTime();e.wrapEndDate=new Date(r.wrapEndDate.getTime()+s)}}e.set(n,r[n])}applyDateConstraints(e,r,t){var i,n;const s=(i=t.dateConstraints)==null?void 0:i.start,a=(n=t.dateConstraints)==null?void 0:n.end;return(s||a)&&(e=b.constrain(e,s,a),t.snappedDate=b.constrain(t.snappedDate,s,a)),e}moveDrag(e){const r=this,{client:t,tip:i}=r,n=r.dragLock==="x",s=n?"X":"Y",a=t.scheduledEventName,{visibleDateRange:o,enableEventAnimations:l,timeAxis:c,weekStartDay:d}=t,u=n&&t.rtl,{resolutionUnit:h,resolutionIncrement:g}=c,{event:f,context:m}=e,{eventRecord:p}=m,v=m.offset*(u?-1:1),{isOccurrence:y}=p,C=p.get("startDate"),D=p.get("endDate"),S=f[`client${s}`]+v,x=k.from(t.timeAxisSubGridElement,null,!0),R=x.getStart(u,n),I=x.getEnd(u,n);m.event=f,f.isScroll&&(e.date=t.getDateFromCoordinate(f[`page${s}`]+v,null,!1));let M,P,{date:_}=e,{toSet:A,otherEnd:z,draggingEnd:Y}=m;u?S>R?_=e.date=o.startDate:S<I&&(_=e.date=o.endDate):S<R?_=e.date=o.startDate:S>I&&(_=e.date=o.endDate),A==="endDate"?_<C&&(M=-1):_>D&&(M=1),M&&r.onDragEndSwitch&&(r.onDragEndSwitch(m,_,M),z=m.otherEnd,A=m.toSet),t.snapRelativeToEventStartDate&&(_=c.roundDate(_,m.oldValue)),m.snappedDate=b.round(_,c.resolution,null,d);const V=b.diff(_,m[z],h)*(Y?-1:1);if(r.isEventDragCreate)m.tooNarrow=V<g/2;else if(V<g)if(r.allowResizeToZero)m.snappedDate=_=m[z];else{const U=z==="startDate"?1:-1;m.snappedDate=_=c.roundDate(b.add(p.get(z),g*U,h)),P=!0}if(_=r.applyDateConstraints(_,p,m),(!m.date||_-m.date||P)&&(m.date=_,m[A]=r.showExactResizePosition||t.timeAxisViewModel.snap?m.snappedDate:_,m.valid=r.allowResizeToZero||m[A]-m[A==="startDate"?"endDate":"startDate"]!==0,p.get(A)-m[A])){if(m.valid=r.checkValidity(m,f),m.message="",m.valid&&typeof m.valid!="boolean"&&(m.message=m.valid.message,m.valid=m.valid.valid),m.valid=m.valid!==!1,m.valid){const U={[`${a}Record`]:p,startDate:C,endDate:D,element:e.itemElement,context:m};U[A]=m[A],r.triggerEventPartialResize(`${a}PartialResize`,U),y&&p.stores.push(t.eventStore),t.enableEventAnimations=!1,this.resizeEventPartiallyInternal(p,m),t.enableEventAnimations=l,y&&(p.stores.length=0)}m.tooNarrow&&(m.valid=!1)}i&&(i.align=p0[m.edge],i.alignTo(r.getTooltipTarget(e))),super.moveDrag(e)}dragEnd(e){const{context:r}=e;r&&(r.event=e.event),e.aborted?r==null||r.finalize(!1):!this.isEventDragCreate&&!e.started&&!B.getPagePoint(e.event).equals(B.getPagePoint(e.startEvent))&&(this.dragStart(e),this.cleanup(e.context,!1))}async dragDrop({context:e,event:r}){var t;e[e.toSet]=e.snappedDate;const{client:i}=this,{startDate:n,endDate:s}=e;let a;(t=this.tip)==null||t.hide(),e.valid=n&&s&&(this.allowResizeToZero||s-n>0)&&e[e.toSet]-e.oldValue&&e.valid!==!1,e.valid&&(this.triggerBeforeEventResizeFinalize(`before${i.capitalizedEventName}ResizeFinalize`,{context:e,event:r,[`${i.scheduledEventName}Record`]:e.eventRecord}),a=!0),e.async||await e.finalize(a)}async finalize(e){const r=this.owner,t=this,{eventRecord:i,oldValue:n,toSet:s}=t,{snapRelativeToEventStartDate:a,timeAxis:o}=r.client;let l=!1;e?(a&&(t[s]=t.snappedDate=o.roundDate(t.date,n)),l=await r.internalUpdateRecord(t,i)):(r.cancelEventRecordBatch(i),i.isOccurrence&&i.resources.forEach(c=>r.client.repaintEventsForResource(c))),r.isDestroyed||r.cleanup(t,l)}cleanup(e,r){var t;const i=this,{client:n}=i,{element:s,eventRecord:a}=e,o=n.scheduledEventName;a.meta.isResizing=!1,n.endListeningForBatchedUpdates(),(t=i.tip)==null||t.hide(),i.unHighlightHandle(s),n.element.classList.remove(...i.dragActiveCls.split(" ")),i.triggerEventResizeEnd(`${o}ResizeEnd`,{changed:r,[`${o}Record`]:a,...i.getResizeEndParams(e)})}async internalUpdateRecord(e,r){var t;const{client:i}=this,{generation:n}=r;if(r.isOccurrence)i.endListeningForBatchedUpdates(),r[r.batching>1?"endBatch":"cancelBatch"](),r.set(St.prototype.inSetNormalize.call(r,{startDate:e.startDate,endDate:e.endDate}));else{const s={[e.toSet]:e[e.toSet]};if(r.isEntity){const{startDate:a,endDate:o,draggingEnd:l}=e;e.duration=s.duration=r.run("calculateProjectedDuration",a,o),s[e.toSet]=r.run("calculateProjectedXDateWithDuration",l?a:o,l,e.duration);const c=!r[e.otherEnd];c&&(s[e.otherEnd]=e[e.otherEnd]),r.set(s),i.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(r),(t=i.features.eventBuffer)!=null&&t.enabled&&(r[e.wrapToSet]=null);const d=[];c&&d.push(r[e.setOtherMethod](s[e.otherEnd],!1)),d.push(r[e.setMethod](s[e.toSet],!1)),await Promise.all(d),r.endBatch()}else{const a=Object.assign({},r.meta.batchChanges);delete a[e.toSet],i.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(r),r.set(a),r[e.setMethod](s[e.toSet],!1)}}return await i.project.commitAsync(),r.generation!==n}onDragItemMouseMove(e){e.pointerType!=="touch"&&!this.handleSelector&&this.checkResizeHandles(e)}checkResizeHandles(e){const r=this,{overItem:t}=r;if(t&&!r.client.readOnly&&(!r.allowResize||r.allowResize(t,e))){const i=r.client.resolveTimeSpanRecord(t);if(i!=null&&i.readOnly)return;r.isOverAnyHandle(e,t)?r.highlightHandle():r.unHighlightHandle()}}onDragItemMouseLeave(e,r){this.unHighlightHandle(r)}highlightHandle(){var e,r;const{overItem:t,client:i}=this;((r=(e=t.syncIdMap)==null?void 0:e[i.scheduledEventName])!=null?r:t.querySelector(i.eventInnerSelector)).classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(e=this.overItem){var r,t;if(e){const i=this,n=(t=(r=e.syncIdMap)==null?void 0:r[i.client.scheduledEventName])!=null?t:e.querySelector(i.client.eventInnerSelector);n&&n.classList.remove("b-resize-handle",i.resizingItemInnerCls),e.classList.remove("b-over-resize-handle",i.draggingItemCls)}}isOverAnyHandle(e,r){return this.isOverStartHandle(e,r)||this.isOverEndHandle(e,r)}isOverStartHandle(e,r){var t;return(t=this.getHandleRect("start",e,r))==null?void 0:t.contains(B.getPagePoint(e))}isOverEndHandle(e,r){var t;return(t=this.getHandleRect("end",e,r))==null?void 0:t.contains(B.getPagePoint(e))}getHandleRect(e,r,t){if(this.overItem){if(t=r.target.closest(`.${this.client.eventCls}`)||t.querySelector(`.${this.client.eventCls}`),!t)return;const i=this,n=e==="start",{client:s}=i,a=!!s.rtl,o=i.dragLock,l=o==="x",c=l?"width":"height",d=`${l?n&&!a?"left":"right":n?"top":"bottom"}Handle`,{offsetWidth:u}=t,h=s.resolveTimeSpanRecord(t),g=h==null?void 0:h.isResizable,f=k.from(t),m=f.clone(),p=globalThis.getComputedStyle(t,":before"),v=!i.handleSelector&&!q.isHoverableDevice?i.touchHandleSize:void 0,y=v||i.handleSize||parseFloat(p[c]),C=i.handleVisibilityThreshold||2*i.handleSize,D=i.dynamicHandleSize?i.reservedSpace/2:0,S=[0,0,0,0];if(!i.disabled&&i[d]&&(u>=C||i.dynamicHandleSize)&&(g===!0||g===e)&&(!l&&!n||l&&a===n?(m[o]+=f[c]-y,S[l?3:0]=f[c]/2+D):S[l?1:2]=f[c]/2+D,f.deflate(...S),m[c]=y,m.constrainTo(f),m[c]))return m}}setupDragContext(e){const r=this;if(r.overItem&&r.isOverAnyHandle(e,r.overItem)&&r.isElementResizable(r.overItem,e)){const t=super.setupDragContext(e);return t.scrollManager=r.client.scrollManager,t}}changeHandleSize(){ne.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTouchHandleSize(){ne.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTip(e,r){var t;const i=this;return i.showTooltip?(e?(e.isTooltip?e.owner=i:e=ve.reconfigure(r,ve.mergeConfigs({id:i.tipId},e,{getHtml:i.getTipHtml.bind(i),owner:i.client},i.tip),{owner:i,defaults:{type:"tooltip"}}),e.ion({innerhtmlupdate:"updateDateIndicator",thisObj:i}),i.clockTemplate=new ss({scheduler:i.client})):r&&(r.destroy(),(t=i.clockTemplate)==null||t.destroy()),e):null}isElementResizable(e,r){var t;const i=this,{client:n}=i,s=n.resolveTimeSpanRecord(e);if(n.readOnly)return!1;let a=s==null?void 0:s.isResizable;const o=(t=e==null?void 0:e.syncIdMap[n.scheduledEventName])!=null?t:e,l=r.target.closest('[class$="-handle"]');if(!a||l&&l!==o||(e=r.target.closest(i.dragSelector),!e))return!1;const c=e.classList.contains("b-sch-event-startsoutside"),d=e.classList.contains("b-sch-event-endsoutside");if(a===!0){if(c&&d)return!1;if(c)a="end";else if(d)a="start";else return i.isOverStartHandle(r,e)||i.isOverEndHandle(r,e)}return c&&a==="start"||d&&a==="end"?!1:!!(i.isOverStartHandle(r,e)&&a==="start"||i.isOverEndHandle(r,e)&&a==="end")}updateDateIndicator(){const{clockTemplate:e}=this,{eventRecord:r,draggingEnd:t,snappedDate:i}=this.dragging.context,n=t?r.get("startDate"):i,s=t?i:r.get("endDate"),{element:a}=this.tip;e.updateDateIndicator(a.querySelector(".b-sch-tooltip-startdate"),n),e.updateDateIndicator(a.querySelector(".b-sch-tooltip-enddate"),s)}getTooltipTarget({itemElement:e,context:r}){const t=this,{rtl:i}=t.client,n=k.from(e,null,!0);return t.dragLock==="x"?(!i&&r.edge==="right"||i&&r.edge==="left"?n.x=n.right-1:n.x-=t.tip.anchorSize[0]/2,n.width=t.tip.anchorSize[0]/2):(r.edge==="bottom"&&(n.y=n.bottom-1),n.height=t.tip.anchorSize[1]/2),{target:n}}basicValidityCheck(e,r){return e.startDate&&(e.endDate>e.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,e,r)}getTipHtml({tip:e}){const r=this,{startDate:t,endDate:i,toSet:n,snappedDate:s,valid:a,message:o="",timespanRecord:l}=r.dragging.context;if(!t||!i)return e.html;const c={record:l,valid:a,message:o,startDate:t,endDate:i,[n]:s};return c.startText=r.client.getFormattedDate(c.startDate),c.endText=r.client.getFormattedDate(c.endDate),c.startClockHtml=r.clockTemplate.template({date:c.startDate,text:c.startText,cls:"b-sch-tooltip-startdate"}),c.endClockHtml=r.clockTemplate.template({date:c.endDate,text:c.endText,cls:"b-sch-tooltip-enddate"}),r.tooltipTemplate(c)}beginEventRecordBatch(e){e.beginBatch()}cancelEventRecordBatch(e){e.cancelBatch()}getBeforeResizeParams(e){const{client:r}=this;return{resourceRecord:r.resolveResourceRecord(r.isVertical?e.event:e.element)}}getResizeStartParams(e){return{resourceRecord:e.resourceRecord}}getResizeEndParams(e){return{resourceRecord:e.resourceRecord,event:e.event}}setupProductResizeContext(e,r){var t,i,n;const{client:s}=this,{element:a}=e,o=s.resolveEventRecord(a),l=(t=s.resolveResourceRecord)==null?void 0:t.call(s,a),c=(i=s.resolveAssignmentRecord)==null?void 0:i.call(s,a);Object.assign(e,{eventRecord:o,taskRecord:o,resourceRecord:l,assignmentRecord:c,dateConstraints:(n=s.getDateConstraints)==null?void 0:n.call(s,l,o)})}checkValidity({startDate:e,endDate:r,eventRecord:t,resourceRecord:i}){const{client:n}=this;return!n.allowOverlap&&t.resources.some(s=>!n.isDateRangeAvailable(e,r,t,s))?{valid:!1,message:this.L("L{EventDrag.eventOverlapsExisting}")}:this.basicValidityCheck(...arguments)}get tipId(){return`${this.client.id}-event-resize-tip`}};qa._$name="EventResize",j.registerFeature(qa,!0,"Scheduler"),j.registerFeature(qa,!1,"ResourceHistogram");var pc=e=>class extends(e||F){static get $name(){return"TaskEditStm"}getStmCapture(){return{stmInitiallyAutoRecord:this.stmInitiallyAutoRecord,stmInitiallyDisabled:this.stmInitiallyDisabled,transferred:!1}}applyStmCapture(t){this.stmInitiallyAutoRecord=t.stmInitiallyAutoRecord,this.stmInitiallyDisabled=t.stmInitiallyDisabled}captureStm(t=!1){const i=this,n=i.project,s=n.getStm();i.hasStmCapture||(i.hasStmCapture=!0,i.stmInitiallyDisabled=s.disabled,i.stmInitiallyAutoRecord=s.autoRecord,i.stmInitiallyDisabled?(s.enable(),s.autoRecord=!1):(i.stmInitiallyAutoRecord&&(s.autoRecord=!1),s.isRecording&&s.stopTransaction()),t&&this.startStmTransaction())}startStmTransaction(){this.project.getStm().startTransaction()}commitStmTransaction(){const t=this,i=t.project.getStm();if(!t.hasStmCapture)throw new Error("Does not have STM capture, no transaction to commit");i.enabled&&(i.stopTransaction(),t.stmInitiallyDisabled&&i.resetQueue())}async rejectStmTransaction(){var t;const i=this.project.getStm(),{client:n}=this;if(!this.hasStmCapture)throw new Error("Does not have STM capture, no transaction to reject");i.enabled&&((t=i.transaction)!=null&&t.length?(n.suspendRefresh(),i.rejectTransaction(),await n.resumeRefresh(!0)):i.stopTransaction())}enableStm(){this.project.getStm().enable()}disableStm(){this.project.getStm().disable()}async freeStm(t=null){const i=this,n=i.project.getStm(),{stmInitiallyDisabled:s,stmInitiallyAutoRecord:a}=i;if(!i.hasStmCapture)return;let o;i.rejectingStmTransaction=!0,t===!0?o=i.commitStmTransaction():t===!1&&(o=i.rejectStmTransaction()),await o,n.isDestroying||(n.disabled=s,n.autoRecord=a),i.isDestroying||(i.rejectingStmTransaction=!0,i.hasStmCapture=!1)}},Mv=e=>class extends(e||F){static get $name(){return"TaskEditTransactional"}captureStm(t){if(this.client.transactionalFeaturesEnabled)return super.captureStm(),this.startStmTransaction(t);super.captureStm(t)}freeStm(t){if(this.hasStmCapture||!this.client.transactionalFeaturesEnabled)return super.freeStm(t)}async startStmTransaction(t){this.client.transactionalFeaturesEnabled?await this.startFeatureTransaction(t):super.startStmTransaction()}commitStmTransaction(){if(this.client.transactionalFeaturesEnabled)return this.finishFeatureTransaction();super.commitStmTransaction()}async rejectStmTransaction(){this.client.transactionalFeaturesEnabled?this.rejectFeatureTransaction():await super.rejectStmTransaction()}},Tr=e=>{var r;return r=class extends xt(e||F){detachFromProject(t){this.rejectFeatureTransaction(),super.detachFromProject(t)}getStmCapture(){const t=super.getStmCapture();return t._editorPromiseResolve=this._editorPromiseResolve,t}applyStmCapture(t){super.applyStmCapture(t),this._editorPromiseResolve=t._editorPromiseResolve}async startFeatureTransaction(){if(!this.client.transactionalFeaturesEnabled)return;const t=this,{project:i}=t.client,{stm:n}=i;let s;t.hasStmCapture?n.startTransaction():s=i.queue(()=>i.commitAsync()),i.queue(()=>{var a;return t.hasStmCapture||(t._stmInitiallyDisabled=n.disabled,t._stmInitiallyAutoRecord=n.autoRecord,n.isRecording?n.stopTransaction():t._stmInitiallyDisabled&&n.enable(),n.autoRecord=!1),n.isRecording||n.startTransaction(),(a=t.trigger)==null||a.call(t,"featureTransactionStart"),new Promise(o=>t._editorPromiseResolve=o)}),await s}rejectFeatureTransaction(){var t;if(!this.client.transactionalFeaturesEnabled)return;const i=this,{stm:n}=i.client.project;(t=i._editorPromiseResolve)==null||t.call(i),i._editorPromiseResolve=null,n.isRecording&&n.rejectTransaction(),!i.hasStmCapture&&i._stmInitiallyDisabled!=null&&(n.disabled=i._stmInitiallyDisabled,n.autoRecord=i._stmInitiallyAutoRecord),i.trigger("featureTransactionReject")}async finishFeatureTransaction(t){var i;if(!this.client.transactionalFeaturesEnabled)return;const n=this,{project:s}=n.client,{stm:a}=s;s.isEngineReady()||await s.commitAsync();const o=a.stash(),{_stmInitiallyDisabled:l,_stmInitiallyAutoRecord:c}=n,d=ti.generateId("featureTransaction");return(i=n._editorPromiseResolve)==null||i.call(n),n._editorPromiseResolve=null,n.isDestroying||n.trigger("featureTransactionFinalizeStart",{id:d}),s.queue(async()=>{var u,h;a==null||a.applyStash(o),await(t==null?void 0:t()),await((u=s.commitAsync)==null?void 0:u.call(s)),a.isRecording&&a.stopTransaction(),!n.hasStmCapture&&a&&!a.isDestroying&&l!=null&&(a.disabled=l,a.autoRecord=c),(h=n.trigger)==null||h.call(n,"featureTransactionFinalized",{id:d})})}},E(r,"$name","TransactionalFeature"),r},fO=function(e){var r,t;return(t=(r=this.source)==null?void 0:r.client.features.taskEdit)!=null&&t._canceling?!1:B.getDistanceBetween(this.startEvent,e)},Ka=class extends qa.mixin(pc,Tr,Mv){construct(e,r){(r==null?void 0:r.showTooltip)===!1&&(r.tip=null),super.construct(...arguments)}changeValidatorFn(e){this.createValidatorFn=e}render(){const e=this,{client:r}=e;e.dragRootElement=e.dropRootElement=r.timeAxisSubGridElement,e.dragLock=r.isVertical?"y":"x"}onDragEndSwitch(e){const{client:r}=this,{enableEventAnimations:t}=r,{eventRecord:i,draggingEnd:n}=e,s=this.dragLock==="x",{initialDate:a}=this.dragging;r.enableEventAnimations=!1,i.set({startDate:a,endDate:a}),n?Object.assign(e,{endDate:a,toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:s?"left":"top"}):Object.assign(e,{startDate:a,toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:s?"right":"bottom"}),e.draggingEnd=this.draggingEnd=!n,r.enableEventAnimations=t}beforeDrag(e){const r=this,t=super.beforeDrag(e),{pan:i,eventDragSelect:n}=r.client.features;return t!==!1&&(r.preventMultiple&&!r.isRowEmpty(e.rowRecord)||r.disabled||i&&!i.disabled||n&&!n.disabled)?!1:(r.client.preventDragSelect=!0,t)}startDrag(e){const r=super.startDrag(e);if(r!==!1){const{context:t}=e;e.initialDate=t.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:e.element,eventElement:e.element,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord}),e.context.offset=0,e.context.oldValue=e.mousedownDate}return r}isOverEndHandle(){return this.draggingEnd}setupDragContext(e){var r;const{client:t}=this;if(t.matchScheduleCell(e.target)){const i=(r=t.resolveResourceRecord(e))==null?void 0:r.$original;if(i&&!i.isSpecialRow){const n=nu().prototype.setupDragContext.call(this,e),s=[];return t.isVertical?s.push({element:t.scrollable.element,direction:"vertical"}):s.push({element:t.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n.scrollManager=t.scrollManager,n.monitoringConfig={scrollables:s},n.resourceRecord=n.rowRecord=i,n.getDistance=fO,n}}}async dragDrop({context:e,event:r}){var t;e[e.toSet]=e.snappedDate;const{client:i}=this,{startDate:n,endDate:s,eventRecord:a}=e,{generation:o}=a;let l;(t=this.tip)==null||t.hide(),await i.project.commitAsync(),a.generation!==o&&(e.eventRecord[e.toSet]=e.oldValue,e.eventRecord[e.toSet]=e[e.toSet]),e.valid=n&&s&&s-n>0&&e[e.toSet]-e.oldValue&&e.valid!==!1,e.valid&&(i.trigger("beforeDragCreateFinalize",{context:e,event:r,proxyElement:e.element,eventElement:e.element,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),l=!0),e.async||await e.finalize(l)}updateDragTolerance(e){this.dragThreshold=e}changeTip(e,r){return super.changeTip(!e||e.isTooltip?e:T.assign({id:`${this.client.id}-drag-create-tip`},e),r)}async finalize(e){var r;if(this.finalized)return;this.finalized=!0;const t=this.owner,i=this,n=()=>{t.isDestroyed||(t.client.trigger("afterDragCreate",{proxyElement:i.element,eventElement:i.element,eventRecord:i.eventRecord,resourceRecord:i.resourceRecord}),t.cleanup(i))};e?(await t.finalizeDragCreate(i),n()):(await t.cancelDragCreate(i),(r=t.onAborted)==null||r.call(t,i),n())}async cancelDragCreate(e){}async finalizeDragCreate(e){var r,t;await this.internalUpdateRecord(e,e.eventRecord);const i=this.getStmCapture();return(r=this.client)==null||r.trigger("dragCreateEnd",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,event:e.event,eventElement:e.element,stmCapture:i}),(t=this.client)==null||t.trigger("eventAutoCreated",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),i.transferred}cleanup(e){var r;const{client:t}=this,{eventRecord:i}=e;i.meta.isResizing=!1,t.endListeningForBatchedUpdates(),(r=this.tip)==null||r.hide(),t.element.classList.remove(...this.dragActiveCls.split(" ")),e.element.parentElement.classList.remove("b-sch-dragcreating")}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(e,r,t,i=!1){return{...e,async:i,event:r,finalize:t}}onEventDataGenerated(e){var r,t;((t=(r=this.dragging)==null?void 0:r.context)==null?void 0:t.eventRecord)===e.eventRecord&&(e.wrapperCls["b-sch-dragcreating"]=!0,e.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(e,r){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,r){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}};E(Ka,"configurable",{showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,tipTemplate:e=>`
            <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                ${e.startClockHtml}
                ${e.endClockHtml}
                <div class="b-sch-tip-message">${e.message}</div>
            </div>
        `,dragActiveCls:"b-dragcreating"}),E(Ka,"pluginConfig",{chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]}),Ka._$name="DragCreateBase";var as=b,mO=["startDate","endDate","resource","recurrenceRule"],v0=e=>{if(e.length===1)return e[0].value;if(e.length===2){const[r,t]=e[0]instanceof ma?e:e.reverse(),i=as.parse(r.value);return i&&t.value&&i.setHours(t.value.getHours(),t.value.getMinutes(),t.value.getSeconds(),t.value.getMilliseconds()),i?b.clone(i):null}return null},pO=(e,r)=>{const t=new Date(e.getTime());return t.setHours(r.getHours(),r.getMinutes()),t},Iv=(e,r,t)=>{if(e&&r&&t.endDateField&&t.endTimeField){const i=as.add(pO(t.startDateField.value,t.startTimeField.value),t.eventRecord.durationMS,"milliseconds");t.endDateField.value=i,t.endTimeField.value=as.clone(i)}},Pv=class extends Q{static get configurable(){return{saveAndCloseOnEnter:!0,triggerEvent:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,items:null,weekStartDay:null}}construct(e,r){const t=this;e.eventEdit=t,super.construct(e,T.assign({weekStartDay:e.weekStartDay},r)),t.clientListenersDetacher=e.ion({[t.triggerEvent]:"onActivateEditor",dragCreateEnd:"onDragCreateEnd",eventAutoCreated:"onEventAutoCreated",thisObj:t})}doDestroy(){var e;this.clientListenersDetacher(),(e=this._editor)==null||e.destroy(),super.doDestroy()}onEventAutoCreated(){}changeEditorConfig(e){const{items:r}=this;return r&&(e=N.clone(e),e.items=Pe.merge(r,e.items)),e}changeItems(e){return this.cleanItemsConfig(e),e}cleanItemsConfig(e){for(const r in e){const t=e[r];t===!0?delete e[r]:t!=null&&t.items&&this.cleanItemsConfig(t.items)}}onDatesChange(e){var r,t,i,n;const s=this,a=e.source,o=e.value;switch(s.startDateField&&s.endDateField&&(s.endDateField.min=s.startDateField.value),s.endTimeField&&(as.isEqual(as.clearTime((r=s.startDateField)==null?void 0:r.value),as.clearTime((t=s.endDateField)==null?void 0:t.value))?s.endTimeField.min=s.startTimeField.value:s.endTimeField.min=null),a.ref){case"startDateField":(i=s.startTimeField)!=null&&i.value&&Iv(o,s.startTimeField.value,s);break;case"startTimeField":(n=s.startDateField)!=null&&n.value&&Iv(s.startDateField.value,o,s);break}}async save(){throw new Error("Implement in subclass")}get values(){const e=this,{editor:r}=e,t=[],i=[],{values:n}=r;return mO.forEach(s=>delete n[s]),r.eachWidget(s=>{var a;const{name:o}=s;if(!o||s.hidden||s.up(l=>l===e.recurrenceEditor)){delete n[o];return}switch(o){case"startDate":t.push(s);break;case"endDate":i.push(s);break;case"resource":n[o]=s.record;break;case"recurrenceRule":n[o]=((a=r.widgetMap.recurrenceCombo)==null?void 0:a.value)==="none"?"":s.value;break}},!0),n.allDay&&!e.eventRecord.allDay&&(t.push(e.startTimeField),i.push(e.endTimeField)),t.length&&(n.startDate=v0(t)),i.length&&(n.endDate=v0(i)),"startDate"in n&&"endDate"in n&&(n.duration=as.diff(n.startDate,n.endDate,e.editor.record.durationUnit,!0)),n}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:r}=this;return this.assignmentStore&&delete r.resource,e.set(r)}onBeforeEditorShow(){const{eventRecord:e,editor:r}=this.editingContext,{nameField:t}=r.widgetMap;t&&e.isCreating&&(r.assigningValues=!0,t.value="",r.assigningValues=!1,t._configuredPlaceholder=t.placeholder,t.placeholder=e.name)}resetEditingContext(){var e;const r=this;if(!r.editingContext)return;const{client:t}=r,{editor:i,eventRecord:n}=r.editingContext,{eventStore:s}=t,{nameField:a}=i.widgetMap;n.isCreating&&(t.isTimelineBase&&((e=r.editingContext.eventElement)==null||e.closest("[data-event-id]").classList.add("b-released")),s.remove(n),n.isCreating=!1),a&&(a.placeholder=a._configuredPlaceholder),t.element.classList.remove("b-eventeditor-editing"),r.targetEventElement=r.editingContext=i._record=null}onPopupKeyDown({event:e}){const r=this;!r.readOnly&&e.key==="Enter"&&r.saveAndCloseOnEnter&&e.target.tagName.toLowerCase()==="input"&&(e.preventDefault(),e.target.name==="startDate"&&r.startTimeField&&Iv(r.startDateField.value,r.startTimeField.value,r),r.onSaveClick())}async finalizeStmCapture(e){}async onSaveClick(){this.editor.focus(),this.isFinalizingEventSave=!0;const e=await this.save();return this.isFinalizingEventSave=!1,e&&(await this.finalizeStmCapture(!1),this.editor.close(),this.client.trigger("afterEventEdit")),e}async onDeleteClick(){this.isDeletingEvent=!0;const e=await this.deleteEvent();if(this.isDeletingEvent=!1,e){await this.finalizeStmCapture(!1);const{editor:r}=this;(!r.autoClose||r.containsFocus)&&r.close(),this.client.trigger("afterEventEdit")}}async onCancelClick(){this.isCancelingEdit=!0,this.editor.close(),this.isCancelingEdit=!1,this.hasStmCapture&&await this.finalizeStmCapture(!0),this.client.trigger("afterEventEdit")}};Pv._$name="EditBase";var os=class extends Q.mixin(xt){static get pluginConfig(){return{chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["matchScheduleCell","resolveResourceRecord"]}}noFeatureElementsInAxis(){const{timeAxis:e}=this.client;return!this.needsRefresh&&this.store&&!this.store.storage.values.some(r=>e.isTimeSpanInAxis(r))}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}updateTabIndex(){this.isConfiguring||this.client.refresh()}getEventsToRender(e,r){throw new Error("Implement in subclass")}onEventDataGenerated(e){const r=this,{eventRecord:t,iconCls:i}=e;r.shouldInclude(t)&&(r.client.isVertical?e.width=e.resourceRecord.columnWidth||r.client.resourceColumnWidth:e.top=0,e.fillSize=!0,e.wrapperCls["b-sch-resourcetimerange"]=1,r.rangeCls&&(e.wrapperCls[r.rangeCls]=1),e.wrapperCls[`b-sch-color-${t.timeRangeColor}`]=t.timeRangeColor,e.eventContent.text=t.name,e.children.push(e.eventContent),e.tabIndex=r.tabIndex!=null?String(r.tabIndex):null,(i==null?void 0:i.length)>0&&e.children.unshift({tag:"i",className:i.toString()}),e.eventId=r.generateElementId(t))}generateElementId(e){return e.domId}resolveResourceTimeRangeRecord(e){var r;return(r=e==null?void 0:e.closest(`.${this.rangeCls}`))==null?void 0:r.elementData.eventRecord}getElementFromResourceTimeRangeRecord(e){return this.client.foregroundCanvas.syncIdMap[e.domId]}resolveResourceRecord(e){var r;return this.overridden.resolveResourceRecord(...arguments)||((r=this.resolveResourceTimeRangeRecord(e.target||e))==null?void 0:r.resource)}shouldInclude(e){throw new Error("Implement in subclass")}onStoreChange(e){(e.action==="removeall"||e.action==="dataset")&&(this.needsRefresh=!0),this.client.onInternalEventStoreChange(e),this.needsRefresh=!1}matchScheduleCell(e){let r=this.overridden.matchScheduleCell(e);if(!r&&this.enableMouseEvents){const{client:t}=this,i=e.closest(`.${this.rangeCls}`);r=i&&t.getCell({record:t.isHorizontal?i.elementData.resource:t.store.first,column:t.timeAxisColumn})}return r}handleRangeMouseEvent(e){var r;const t=this,i=e.target.closest(`.${t.rangeCls}`);if(i){const n=(r=B.eventNameMap[e.type])!=null?r:O.capitalize(e.type),s=t.resolveResourceTimeRangeRecord(i);t.client.trigger(t.entityName+n,{feature:t,[`${t.entityName}Record`]:s,resourceRecord:t.client.resourceStore.getById(s.resourceId),domEvent:e})}}updateEnableMouseEvents(e){var r;const t=this,{client:i}=t;if((r=t.mouseEventsDetacher)==null||r.call(t),t.mouseEventsDetacher=null,e){let n=function(){t.mouseEventsDetacher=B.on({element:i.foregroundCanvas,delegate:`.${t.rangeCls}`,mousedown:"handleRangeMouseEvent",mouseup:"handleRangeMouseEvent",click:"handleRangeMouseEvent",dblclick:"handleRangeMouseEvent",contextmenu:"handleRangeMouseEvent",mouseover:"handleRangeMouseEvent",mouseout:"handleRangeMouseEvent",thisObj:t})};i.whenVisible(n)}i.element.classList.toggle("b-interactive-resourcetimeranges",!!e)}};E(os,"configurable",{tabIndex:null,entityName:"resourceTimeRange"}),os.featureClass="",os._$name="ResourceTimeRangesBase";var dh=class extends aa{};dh._$name="TimeSpanMenuBase";var ls=class extends Q{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onPaint"]}}construct(e,r){const t=this;r=t.processConfig(r),super.construct(e,r),t.forSelector||(t.forSelector=`${e.eventInnerSelector}:not(.b-dragproxy,.b-iscreating)`),t.clockTemplate=new ss({scheduler:e}),e.ion({[`before${e.scheduledEventName}drag`]:()=>{var i;(i=t.tooltip)==null||i.hide()}})}processConfig(e){return typeof e=="function"?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.destroyProperties("clockTemplate","tooltip"),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}onPaint({firstPaint:e}){var r;if(e){const t=this,{client:i}=t,n=`:not(${[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-task-percent-bar-resizing-task",".b-dragcreating",`.b-dragging-${i.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].join()})`;(r=t.tooltip)==null||r.destroy();const s=t.tooltip=new ve({axisLock:"flexible",id:t.tipId||`${t.client.id}-event-tip`,cls:t.tipCls,forSelector:`.b-timelinebase${n} .b-grid-body-container:not(.b-scrolling) ${t.forSelector}`,scrollAction:"realign",forElement:i.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:t.getTipHtml.bind(t),disabled:t.disabled,...t.config,internalListeners:t.configuredListeners});s.ion({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:t}),Object.keys(s.$meta.configs).forEach(a=>{Object.defineProperty(this,a,{set:o=>s[a]=o,get:()=>s[a]})})}}processConfiguredListeners(){}addListener(...e){var r;const t=super.addListener(...e),i=(r=this.tooltip)==null?void 0:r.addListener(...e);if(t||i)return()=>{t==null||t(),i==null||i()}}removeListener(...e){var r;super.removeListener(...e),(r=this.tooltip)==null||r.removeListener(...e)}updateDateIndicator(){const e=this,r=e.tooltip,t=r.element.querySelector(".b-sch-tooltip-enddate");e.record&&(e.clockTemplate.updateDateIndicator(r.element,e.record.startDate),t&&e.clockTemplate.updateDateIndicator(t,e.record.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,activeTarget:r}){const t=this,{client:i}=t,n=t.recordType||`${i.scheduledEventName}Record`,s=t.resolveTimeSpanRecord(r);if((s==null?void 0:s.startDate)instanceof Date){const{startDate:a,endDate:o}=s,l=i.getFormattedDate(a),c=i.getDisplayEndDate(o,a),d=i.getFormattedDate(c);return e.eventRecord=s,t.template({tip:e,[`${n}`]:s,startDate:a,endDate:o,startText:l,endText:d,startClockHtml:t.clockTemplate.template({date:a,text:l,cls:"b-sch-tooltip-startdate"}),endClockHtml:s.isMilestone?"":t.clockTemplate.template({date:c,text:d,cls:"b-sch-tooltip-enddate"})})}else return e.hide(),""}get record(){return this.tooltip.eventRecord}onTipShow(){const e=this;e.monitorRecordUpdate&&!e.updateListener&&(e.updateListener=e.client.eventStore.ion({change:e.onRecordUpdate,buffer:300,thisObj:e}))}onTipHide(){var e;this.tooltip.eventRecord=null,(e=this.updateListener)==null||e.call(this),this.updateListener=null}onOverNewTarget({newTarget:e}){const{tooltip:r}=this;r.isVisible&&(this.client.timeAxisSubGrid.scrolling||this.client.scrolling?r.hide(!1):r.eventRecord=this.resolveTimeSpanRecord(e))}onRecordUpdate({record:e}){const{tooltip:r}=this;r!=null&&r.isVisible&&e===this.record&&(r.updateContent(),r.lastAlignSpec.aligningToElement?r.realign():r.internalOnPointerOver(this.client.lastPointerEvent))}};ls._$name="TooltipBase";var Ki=class extends Q.mixin(fe){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,tooltipTemplate:null,dragTipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    <div class="b-sch-tip-name">${O.encodeHtml(e.name)||""}</div>
                    ${e.startClockHtml}
                    ${e.endClockHtml||""}
                </div>
            `,baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}construct(e,r){const t=this;super.construct(e,r),e.isVertical&&e.ion({renderRows:t.onUIReady,thisObj:t,once:!0}),t.cls=t.cls||`b-sch-${t.constructor.$$name.toLowerCase()}`,t.baseSelector=`.${t.baseCls}.${t.cls}`,t.enableResizing&&(t.showHeaderElements=!0)}doDestroy(){var e,r,t,i;const n=this;n.detachListeners("timeAxisViewModel"),n.detachListeners("timeAxis"),(e=n.clockTemplate)==null||e.destroy(),(r=n.tip)==null||r.destroy(),(t=n.drag)==null||t.destroy(),(i=n.resize)==null||i.destroy(),super.doDestroy()}doDisable(e){this.renderRanges(),super.doDisable(e)}setupTimeAxisViewModelListeners(){const e=this;e.detachListeners("timeAxisViewModel"),e.detachListeners("timeAxis"),e.client.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),e.client.timeAxis.ion({name:"timeAxis",includeChange:"renderRanges",thisObj:e}),e.updateLineBuffer()}onUIReady(){const e=this,{client:r}=e;r.ion({timeAxisViewModelChange:e.setupTimeAxisViewModelListeners,thisObj:e}),e.setupTimeAxisViewModelListeners(),r.hideHeaders||(e.headerContainerElement&&B.on({click:e.onTimeRangeClick,dblclick:e.onTimeRangeClick,contextmenu:e.onTimeRangeClick,delegate:e.baseSelector,element:e.headerContainerElement,thisObj:e}),e.enableResizing&&(e.drag=ki.new({name:"rangeDrag",lockX:r.isVertical,lockY:r.isHorizontal,constrain:!0,outerElement:e.headerContainerElement,targetSelector:`${e.baseSelector}`,isElementDraggable:(t,i)=>!r.readOnly&&e.isElementDraggable(t,i),rtlSource:r,internalListeners:{dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:e}},e.dragHelperConfig),e.resize=Sl.new({direction:r.mode,targetSelector:`${e.baseSelector}.b-sch-range`,outerElement:e.headerContainerElement,isElementResizable:(t,i)=>!t.matches(".b-dragging,.b-readonly")&&!i.target.matches(".b-fa"),internalListeners:{resizestart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:e}},e.resizeHelperConfig))),e.renderRanges(),e.tooltipTemplate&&(e.hoverTooltip=new ve({forElement:e.headerContainerElement,getHtml({activeTarget:t}){const i=e.resolveTimeRangeRecord(t);return e.tooltipTemplate({timeRange:i})},forSelector:"."+e.baseCls+(e.cls?"."+e.cls:"")}))}refresh(){this._timeRanges=null,this.renderRanges()}getDOMConfig(e,r){const t=this,i=[],n=[];if(!t.disabled){t._labelRotationMap={};for(const s of t.timeRanges){const a=t.renderRange(s,e,r);a&&(i.push(a.bodyConfig),n.push(a.headerConfig))}}return[i,n]}renderRanges(){const e=this,{client:r}=e,{foregroundCanvas:t}=r;if(t&&r.isPainted&&!r.timeAxisSubGrid.collapsed){const{headerContainerElement:i}=e,n=[],[s,a]=e.getDOMConfig();e.bodyCanvas||(e.bodyCanvas=w.createElement({className:`b-timeranges-canvas ${e.cls}-canvas`,parent:t,retainElement:!0})),X.sync({targetElement:e.bodyCanvas,childrenOnly:!0,domConfig:{children:s,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:e.showHeaderElements?null:({targetElement:o,action:l})=>{(l==="reuseElement"||l==="newElement"||l==="reuseOwnElement")&&n.push(o)}}),e.showHeaderElements&&!e.headerCanvas&&(e.headerCanvas=w.createElement({className:`${e.cls}-canvas`,parent:i,retainElement:!0})),e.headerCanvas&&X.sync({targetElement:e.headerCanvas,childrenOnly:!0,domConfig:{children:a,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(const o of n)e.cacheRotation(o.elementData.timeRange,o);for(const o of n)e.applyRotation(o.elementData.timeRange,o)}}get timeRanges(){return[]}shouldRenderRange(e,r=this.client.visibleDateRange.startDate,t=this.client.visibleDateRange.endDate){const{timeAxis:i}=this.client,{startDate:n,endDate:s,duration:a}=e;return!!(n&&(i.isContinuous||i.isTimeSpanInAxis(e))&&b.intersectSpans(r,t,n,a?s:b.add(n,this._lineBufferDurationMS)))}getRangeDomConfig(e,r,t,i=0){const n=this,{client:s}=n,{rtl:a}=s,o=s.getCoordinateFromDate(b.max(e.startDate,r),{respectExclusion:!0})-i,l=e.endDate?s.getCoordinateFromDate(b.min(e.endDate,t),{respectExclusion:!0,isEnd:!0})-i:o,c=Math.abs(l-o),d=c>0,u=a?`calc(${o}px - 100%)`:`${o}px`;return{className:{[n.baseCls]:1,[n.cls]:n.cls,[n.rangeCls]:d,[n.lineCls]:!d,[e.cls]:e.cls,"b-narrow-range":d&&c<n.narrowThreshold,"b-readonly":e.readOnly,"b-rtl":a},dataset:{id:e.id},elementData:{timeRange:e},style:s.isVertical?`transform: translateY(${u}); ${d?`height:${c}px`:""};`:`transform: translateX(${u}); ${d?`width:${c}px`:""};`}}renderRange(e,r,t){const i=this,{client:n}=i,{timeAxis:s}=n;if(i.shouldRenderRange(e,r,t)&&s.startDate){const a=i.getRangeDomConfig(e,s.startDate,s.endDate),o=e.iconCls&&O.xss`<i class="${e.iconCls}"></i>`,l=e.name&&O.encodeHtml(e.name),c=l||o?`<label>${o||""}${l||"&nbsp;"}</label>`:"",d={...a,style:a.style+(e.style||""),html:i.bodyRenderer?i.bodyRenderer({timeRange:e}):i.showHeaderElements&&!i.showLabelInBody?"":c};let u;return i.showHeaderElements&&(u={...a,html:i.headerRenderer?i.headerRenderer({timeRange:e}):i.showLabelInBody?"":c}),{bodyConfig:d,headerConfig:u}}}cacheRotation(e,r){if(!e.iconCls&&!e.name||!e.duration)return;const t=r.firstElementChild;t&&!e.recurringTimeSpan&&(this._labelRotationMap[e.id]=this.client.isVertical?t.offsetHeight<r.offsetHeight:t.offsetWidth>r.offsetWidth)}applyRotation(e,r){var t,i,n;const s=this._labelRotationMap[(i=(t=e.recurringTimeSpan)==null?void 0:t.id)!=null?i:e.id];(n=r.firstElementChild)==null||n.classList.toggle("b-vertical",!!s)}getBodyElementByRecord(e){const r=typeof e=="string"?e:e==null?void 0:e.id;return r!=null&&X.getChild(this.bodyCanvas,r)}resolveTimeRangeRecord(e){}get headerContainerElement(){const e=this,{isVertical:r,timeView:t,timeAxisColumn:i}=e.client;return e._headerContainerElement||(r&&t.element?e._headerContainerElement=t.element.parentElement:r||(e._headerContainerElement=i.element)),e._headerContainerElement}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}updateShowHeaderElements(e){const{client:r}=this;this.isConfiguring||(r.element.classList.toggle("b-sch-timeranges-with-headerelements",!!e),this.renderRanges())}populateTimeAxisHeaderMenu({column:e,items:r}){}onPaint({firstPaint:e}){e&&this.client.isHorizontal&&this.onUIReady()}onSchedulerHorizontalScroll(){this.client.isHorizontal&&this.renderRanges()}afterScroll(){this.client.isVertical&&this.renderRanges()}updateLineBuffer(){const{timeAxisViewModel:e}=this.client;this._lineBufferDurationMS=e.getDateFromPosition(300)-e.getDateFromPosition(0)}onInternalResize(e,r,t,i,n){this.client.isVertical&&n!==t&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.updateLineBuffer(),this.refresh()}onTimeRangeClick(e){const r=this.resolveTimeRangeRecord(e.target);this.client.trigger(`timeRangeHeader${O.capitalize(e.type)}`,{event:e,domEvent:e,timeRangeRecord:r})}showTip(e){const r=this;r.showTooltip&&(r.clockTemplate=new ss({scheduler:r.client}),r.tip=new ve(T.assign({id:`${r.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>r.getTipHtml(e.record,e.element)},r.showTooltip)))}destroyTip(){this.tip&&(this.tip.destroy(),this.tip=null)}isElementDraggable(e){return e=e.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"),e&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const{client:r,drag:t}=this;r.isVertical?(t.minY=0,t.maxY=r.timeAxisViewModel.totalSize-e.element.offsetHeight,t.minX=0,t.maxX=Number.MAX_SAFE_INTEGER):(t.minX=0,t.maxX=r.timeAxisViewModel.totalSize-e.element.offsetWidth,t.minY=0,t.maxY=Number.MAX_SAFE_INTEGER),r.element.classList.add("b-dragging-timerange")}onDrop({context:e}){this.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}updateDateIndicator({startDate:e,endDate:r}){const t=this,{tip:i}=t,n=i.element.querySelector(".b-sch-tooltip-enddate");t.clockTemplate.updateDateIndicator(i.element,e),n&&t.clockTemplate.updateDateIndicator(n,r)}onDrag({context:e}){const r=this,{client:t}=r,i=k.from(e.element),n=i.getStart(t.rtl,t.isHorizontal),s=i.getEnd(t.rtl,t.isHorizontal),a=t.getDateFromCoordinate(n,"round",!1),o=t.getDateFromCoordinate(s,"round",!1);r.updateDateIndicator({startDate:a,endDate:o})}onDragReset(){}onResizeStart(){}onResizeDrag(){}onResize(){}onInvalidResize(){}onResizeReset(){}getTipHtml(e,r){const t=this,{client:i}=t,n=k.from(r),s=n.getStart(i.rtl,i.isHorizontal),a=n.getEnd(i.rtl,i.isHorizontal),o=i.getDateFromCoordinate(s,"round",!1),l=e.endDate&&i.getDateFromCoordinate(a,"round",!1),c=i.getFormattedDate(o),d=l&&i.getFormattedEndDate(l,o);return t.dragTipTemplate({name:e.name||"",startDate:o,endDate:l,startText:c,endText:d,startClockHtml:t.clockTemplate.template({date:o,text:c,cls:"b-sch-tooltip-startdate"}),endClockHtml:d&&t.clockTemplate.template({date:l,text:d,cls:"b-sch-tooltip-enddate"})})}};E(Ki,"configurable",{showHeaderElements:!0}),E(Ki,"pluginConfig",{chain:["onPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]}),Ki._$name="AbstractTimeRanges";var vO=Object.freeze({}),Av=class extends Q.mixin(xt,fe){static get $name(){return"ColumnLines"}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static get pluginConfig(){return{after:["render","updateCanvasSize","onVisibleDateRangeChange","onVisibleResourceRangeChange"]}}construct(e,r){e.useBackgroundCanvas=!0,super.construct(e,r)}attachToResourceStore(e){const{client:r}=this;super.attachToResourceStore(e),r.isVertical&&r.resourceStore.ion({name:"resourceStore",group({groupers:t}){t.length===0&&this.refresh()},thisObj:this})}doDisable(e){super.doDisable(e),this.isConfiguring||this.refresh()}render(){this.refresh()}getColumnLinesDOMConfig(e,r){var t,i;const n=this,{client:s}=n,{rtl:a}=s,o=a?-1:1,{timeAxisViewModel:l,isHorizontal:c,resourceStore:d,variableColumnWidths:u}=s,{columnConfig:h}=l,g=l.columnLinesFor,f=Math.max(g-1,0),m=e.getTime(),p=r.getTime(),v=[],y=new Set,C=c?"X":"Y";if(!n.disabled){const D=(S,x)=>{const R=S.start.getTime();R>m&&R<p&&!y.has(R)&&(y.add(R),v.push({role:"presentation",className:x?"b-column-line-major":"b-column-line",style:{transform:`translate${C}(${S.coord*o}px)`},dataset:{line:x?`major-${S.index}`:`line-${S.index}`}}))};if(g!==f)for(let S=1;S<=h[f].length-1;S++)D(h[f][S],!0);for(let S=1;S<=h[g].length-1;S++)D(h[g][S],!1);if(!c&&s.columnLines){const{columnWidth:S}=s.resourceColumns;let{first:x,last:R}=s.currentOrientation.getResourceRange(!0),I=0;if(x>-1)for(let M=x;M<R+1;M++){const P=d.getAt(M);if(P.isGroupHeader){R++,I++;continue}const _=P.instanceMeta(d),A=u?_.insetStart+P.columnWidth-1:(M-I+1)*S-1;v.push({className:{"b-column-line":1,"b-resource-column-line":1,"b-resource-group-divider":d.isGrouped&&((i=_.groupParent)==null?void 0:i.groupChildren[((t=_.groupParent)==null?void 0:t.groupChildren.length)-1])===P},style:{transform:`translateX(${A*o}px)`},dataset:{line:`resource-${M}`}})}}}return v}refresh(){const e=this,{client:r}=e,{timeAxis:t}=r,{startDate:i,endDate:n}=r.visibleDateRange||vO;if(!t.startDate||!i||e.client.timeAxisSubGrid.collapsed)return;e.element||(e.element=w.createElement({parent:r.backgroundCanvas,className:"b-column-lines-canvas"}));const a=e.getColumnLinesDOMConfig(i,n);X.sync({targetElement:e.element,onlyChildren:!0,domConfig:{children:a,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}onVisibleDateRangeChange(){this.refresh()}onVisibleResourceRangeChange({firstResource:e,lastResource:r}){this.refresh()}updateCanvasSize(){this.refresh()}};Av._$name="ColumnLines",j.registerFeature(Av,!0,["Scheduler","Gantt","TimelineHistogram"]);var y0=e=>class extends(e||F){static get $name(){return"DependencyCreation"}static get defaultConfig(){return{allowDropOnEventBar:!0,showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}construct(t,i){super.construct(t,i);const n=this;n.view=t,n.eventName=t.scheduledEventName,t.ion({readOnly:()=>n.updateCreateListeners()}),n.updateCreateListeners(),n.chain(t,"onElementTouchMove","onElementTouchMove")}doDestroy(){var t,i;const n=this;n.detachListeners("view"),n.creationData=null,(t=n.pointerUpMoveDetacher)==null||t.call(n),(i=n.creationTooltip)==null||i.destroy(),super.doDestroy()}updateCreateListeners(){const t=this;t.view&&(t.detachListeners("view"),t.isCreateAllowed&&t.view.ion({name:"view",[`${t.eventName}mouseenter`]:"onTimeSpanMouseEnter",[`${t.eventName}mouseleave`]:"onTimeSpanMouseLeave",thisObj:t}))}set allowCreate(t){this._allowCreate=t,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.view.readOnly&&!this.disabled}onTimeSpanMouseEnter({event:t,source:i,[`${this.eventName}Record`]:n,[`${this.eventName}Element`]:s}){if(!n.isCreating&&!n.readOnly&&(!this.client.features.nestedEvents||n.parent.isRoot)){const a=this,{creationData:o}=a,l=w.down(s,i.eventInnerSelector);n!==(o==null?void 0:o.source)&&(a.showTerminals(n,l),o&&t.target.closest(a.client.eventSelector)&&(o.timeSpanElement=l,a.onOverTargetEventBar(t)))}}onTimeSpanMouseLeave(t){var i;const n=this,{creationData:s}=n,a=t[`${n.eventName}Element`],o=w.down(a,n.view.eventInnerSelector),l=(i=t.event)==null?void 0:i.relatedTarget,c=s==null?void 0:s.timeSpanElement;l&&((!s||!c||!l||!w.isDescendant(c,l))&&(t.event.isTrusted||o!==(s==null?void 0:s.sourceElement))&&n.hideTerminals(a),s&&!s.finalizing&&!l.closest(n.client.eventSelector)&&(s.timeSpanElement=null,n.onOverNewTargetWhileCreating(void 0,void 0,t)))}onTerminalMouseOver(t){this.creationData&&this.onOverTargetEventBar(t)}onTerminalMouseOut(t){const i=this,{creationData:n}=i,s=t.target.closest(i.view.eventSelector);s&&(!i.showingTerminalsFor||!w.isDescendant(s,i.showingTerminalsFor))&&(!n||s!==n.timeSpanElement)&&(i.hideTerminals(s),i.view.unhover(s,t)),n&&i.onOverNewTargetWhileCreating(t.relatedTarget,n.target,t)}onTerminalPointerDown(t){var i;const n=this;if(t.button===0&&!n.creationData){const s=n.view,a=s.timeAxisSubGridElement,o=t.target,l=o.closest(s.eventInnerSelector),c=k.from(s.element,document.body);t.stopPropagation(),n.creationData={sourceElement:l,source:s.resolveTimeSpanRecord(l).$original,fromSide:o.dataset.side,startPoint:k.from(o,a).center,startX:t.pageX-c.x+s.scrollLeft,startY:t.pageY-c.y+s.scrollTop,valid:!1,sourceResource:(i=s.resolveResourceRecord)==null?void 0:i.call(s,t),tooltip:n.creationTooltip},n.pointerUpMoveDetacher=B.on({pointerup:{element:s.element.getRootNode(),handler:"onMouseUp",passive:!1},pointermove:{element:a,handler:"onMouseMove",passive:!1},thisObj:n}),n.documentPointerUpDetacher=B.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:d})=>{d==="Escape"&&n.abort()}},thisObj:n})}}onElementTouchMove(t){var i;(i=super.onElementTouchMove)==null||i.call(this,t),this.connector&&t.preventDefault()}onMouseMove(t){const i=this,{view:n,creationData:s}=i,a=k.from(n.element,document.body),o=t.pageX-a.x+n.scrollLeft-s.startX,l=t.pageY-a.y+n.scrollTop-s.startY,c=Math.round(Math.sqrt(o*o+l*l))-3,d=Math.atan2(l,o);let{connector:u}=i;if(!u){if(i.onRequestDragCreate(t)===!1)return;u=i.connector}u.style.width=`${c}px`,u.style.transform=`rotate(${d}rad)`,i.lastMouseMoveEvent=t}onRequestDragCreate(t){const i=this,{view:n,creationData:s}=i;if(n.trigger("beforeDependencyCreateDrag",{data:s,source:s.source})===!1)return i.abort(),!1;if(n.element.classList.add("b-creating-dependency"),i.createConnector(s.startPoint.x,s.startPoint.y),n.trigger("dependencyCreateDragStart",{data:s,source:s.source}),i.showCreationTooltip){const a=i.creationTooltip||(i.creationTooltip=i.createDragTooltip());i.creationData.tooltip=a,a.disabled=!1,a.show(),a.onMouseMove(t)}n.scrollManager.startMonitoring({scrollables:[{element:n.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:n.scrollable.element,direction:"vertical"}],callback:()=>i.lastMouseMoveEvent&&i.onMouseMove(i.lastMouseMoveEvent)})}onOverTargetEventBar(t){const i=this,{view:n,creationData:s,allowDropOnEventBar:a}=i,{target:o}=t;let l=n.resolveTimeSpanRecord(o).$original;l!=null&&l.isEventSegment&&(l=l.event),!(N.isPromise(s.valid)||!a&&!o.classList.contains(i.terminalCls))&&l!==s.source&&i.onOverNewTargetWhileCreating(o,l,t)}async onOverNewTargetWhileCreating(t,i,n){var s,a;const o=this,{view:l,creationData:c,allowDropOnEventBar:d,connector:u}=o;if(!N.isPromise(c.valid)&&!c.finalizing&&u){if(u.classList.remove("b-valid","b-invalid"),c.timeSpanElement&&w.removeClsGlobally(c.timeSpanElement,"b-sch-terminal-active"),!i||i===c.source||!d&&!t.classList.contains(o.terminalCls))c.target=c.toSide=null,c.valid=!1,u.classList.add("b-invalid");else{const h=c.target=i,{source:g}=c;let f=t.dataset.side;d&&!t.classList.contains(o.terminalCls)&&(f=o.getTargetSideFromType(o.dependencyStore.modelClass.fieldMap.type.defaultValue||mt.Type.EndToStart)),l.resolveResourceRecord&&(c.targetResource=l.resolveResourceRecord(n));let m;c.toSide=f;const p=c.fromSide,v=D=>{o.isDestroyed||(c.valid=D,t.classList.add(D?"b-valid":"b-invalid"),u.classList.add(D?"b-valid":"b-invalid"),l.trigger("dependencyValidationComplete",{data:c,source:g,target:h,dependencyType:m}))};switch(!0){case(p==="start"&&f==="start"):m=mt.Type.StartToStart;break;case(p==="start"&&f==="end"):m=mt.Type.StartToEnd;break;case(p==="end"&&f==="start"):m=mt.Type.EndToStart;break;case(p==="end"&&f==="end"):m=mt.Type.EndToEnd;break}l.trigger("dependencyValidationStart",{data:c,source:g,target:h,dependencyType:m});let y=c.valid=o.dependencyStore.isValidDependency(g,h,m);N.isPromise(y)&&(y=await y),v(y);const C=y?"b-valid":"b-invalid";u.classList.add(C),(a=(s=c.timeSpanElement)==null?void 0:s.querySelector(`.b-sch-terminal[data-side=${f}]`))==null||a.classList.add("b-sch-terminal-active",C)}o.updateCreationTooltip()}}async onMouseUp(){var t;const i=this,n=i.creationData;if(n.finalizing=!0,(t=i.pointerUpMoveDetacher)==null||t.call(i),n.valid)if(await i.view.trigger("beforeDependencyCreateFinalize",n)===!1?n.valid=!1:N.isPromise(n.valid)&&(n.valid=await n.valid),n.valid){let a=i.createDependency(n);a!==null&&(N.isPromise(a)&&(a=await a),n.dependency=a,i.view.trigger("dependencyCreateDrop",{data:n,source:n.source,target:n.target,dependency:a}),i.doAfterDependencyDrop(n))}else i.doAfterDependencyDrop(n);else n.valid=!1,i.doAfterDependencyDrop(n);i.abort()}doAfterDependencyDrop(t){this.view.trigger("afterDependencyCreateDrop",{data:t,...t})}onDocumentMouseUp({target:t}){this.view.timeAxisSubGridElement.contains(t)||this.abort()}abort(){var t,i;const n=this,{view:s,creationData:a}=n;if(a){const{source:o,sourceResource:l,target:c,targetResource:d}=a;if(o){const u=s.getElementFromEventRecord(o,l);u&&n.hideTerminals(u)}if(c){const u=s.getElementFromEventRecord(c,d);u&&n.hideTerminals(u)}}n.creationTooltip&&(n.creationTooltip.disabled=!0),n.creationData=n.lastMouseMoveEvent=null,(t=n.pointerUpMoveDetacher)==null||t.call(n),(i=n.documentPointerUpDetacher)==null||i.call(n),n.removeConnector()}createConnector(t,i){const n=this,{view:s}=n;n.clearTimeout(n.removeConnectorTimeout),n.connector=w.createElement({parent:s.timeAxisSubGridElement,className:`${n.baseCls}-connector`,style:`left:${t}px;top:${i}px`}),s.element.classList.add("b-creating-dependency")}createDragTooltip(){const t=this,{view:i}=t;return t.creationTooltip=ve.new({id:`${i.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:i.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},internalListeners:{beforeShow:"updateCreationTooltip",thisObj:t}},t.creationTooltip)}removeConnector(){const t=this,{connector:i,view:n}=t;i&&(i.classList.add("b-removing"),i.style.width="0",t.removeConnectorTimeout=t.setTimeout(()=>{i.remove(),t.connector=null},200)),n.element.classList.remove("b-creating-dependency"),t.creationTooltip&&t.creationTooltip.hide(),n.scrollManager.stopMonitoring()}showTerminals(t,i){const n=this;if(!n.isCreateAllowed||!t.project)return;const s=n.terminalCls,a=`${s}s-visible`;if(i=w.down(i,n.view.eventInnerSelector),!i.classList.contains(a)&&!n.view.element.classList.contains("b-resizing-event")&&!n.view.readOnly){if(n.client.trigger("beforeShowTerminals",{source:t})===!1)return;n.terminalSides.forEach(o=>{o=n.fixSide(o);const l=w.createElement({parent:i,className:`${s} ${s}-${o}`,dataset:{side:o,feature:!0}});l.detacher=B.on({element:l,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:n})}),i.classList.add(a),t.internalCls.add(a),n.showingTerminalsFor=i}}fixSide(t){return t==="left"?"start":t==="right"?"end":t}hideTerminals(t){const i=this,n=i.client.getTimeSpanMouseEventParams(t),s=n==null?void 0:n[`${i.eventName}Record`],a=`${i.terminalCls}s-visible`;w.forEachSelector(t,`.${i.terminalCls}`,o=>{o.detacher&&o.detacher(),o.remove()}),w.down(t,i.view.eventInnerSelector).classList.remove(a),s.internalCls.remove(a),i.showingTerminalsFor=null}createDependency(t){const{source:i,target:n,fromSide:s,toSide:a}=t,o=(s==="start"?0:2)+(a==="end"?1:0),l=this.dependencyStore.add({from:i.id,to:n.id,type:o,fromSide:s,toSide:a});return l!==null?l[0]:null}getTargetSideFromType(t){return t===mt.Type.StartToStart||t===mt.Type.EndToStart?"start":"end"}updateCreationTooltip(){const t=this,i=t.creationData,{valid:n}=i,s=t.creationTooltip,{classList:a}=s.element;if(N.isPromise(n))return a.remove("b-invalid"),a.add("b-checking"),new Promise(o=>n.then(l=>{i.valid=l,s.isDestroyed||o(t.updateCreationTooltip())}));s.html=t.creationTooltipTemplate(i)}creationTooltipTemplate(t){var i,n;const s=this,{tooltip:a,valid:o}=t,{classList:l}=a.element;Object.assign(t,{fromText:O.encodeHtml(t.source.name),toText:O.encodeHtml((n=(i=t.target)==null?void 0:i.name)!=null?n:""),fromSide:t.fromSide,toSide:t.toSide||""});let c,d;return l.toggle("b-invalid",!o),l.remove("b-checking"),o===!0?(c="valid",d=s.L("L{Dependencies.valid}")):(c="invalid",d=s.L("L{Dependencies.invalid}")),a.title=`<i class="b-icon b-icon-${c}"></i>${d}`,{children:[{className:"b-sch-dependency-tooltip",children:[{dataset:{ref:"fromLabel"},tag:"label",text:s.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:t.fromText},{dataset:{ref:"fromBox"},className:`b-sch-box b-${t.fromSide}`},{dataset:{ref:"toLabel"},tag:"label",text:s.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:t.toText},{dataset:{ref:"toBox"},className:`b-sch-box b-${t.toSide}`}]}]}}doDisable(t){this.isConfiguring||this.updateCreateListeners(),super.doDisable(t)}},uh=25,yO=e=>{var r;return r=class extends e{constructor(){super(...arguments),E(this,"gridCache",null)}getDependenciesToConsider(t,i,n,s){const a=this,{gridCache:o}=a,{timeAxis:l}=a.client;if(o){const c=new Set,d=Math.floor((t-l.startMS)/a.MS_PER_CELL),u=Math.floor((i-l.startMS)/a.MS_PER_CELL),h=Math.floor(n/uh),g=Math.floor(s/uh);for(let f=d;f<=u;f++){const m=o[f];if(m)for(let p=h;p<=g;p++){const v=m[p];if(v)for(let y=0;y<v.length;y++)c.add(v[y])}}return c}}afterDrawDependency(t,i,n,s,a){var o,l;const c=this;if(c.constructGridCache){const{MS_PER_CELL:d}=c,{startMS:u,endMS:h}=c.client.timeAxis,g=Math.ceil((h-u)/d),f=Math.floor((s-u)/d),m=Math.floor((a-u)/d),p=Math.floor(i/uh),v=Math.floor(n/uh),y=Math.min(f,m),C=Math.max(f,m),D=Math.min(p,v),S=Math.max(p,v);if(y<0&&C<0||y>g&&C>g)return;const x=Math.max(y,0),R=Math.min(C,g);for(let I=x;I<=R;I++){const M=(o=c.gridCache[I])!=null?o:c.gridCache[I]={};for(let P=D;P<=S;P++)((l=M[P])!=null?l:M[P]=[]).push(t)}}}beforeDraw(){const t=this;if(!t.gridCache){const{visibleDateRange:i}=t.client;t.constructGridCache=!0,t.MS_PER_CELL=Math.max(i.endMS-i.startMS,1e3),t.gridCache={}}}afterDraw(){this.constructGridCache=!1}reset(){this.gridCache=null}},E(r,"$name","DependencyGridCache"),r},bO=Math.min(1/globalThis.devicePixelRatio,.75),CO=["start","end","top","bottom"],Xi=(e,r)=>Math.abs(e-r)<.1,SO={l:"left",r:"right",t:"top",b:"bottom"},Xa=class extends F{static get configurable(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}findPath(e,r){const t=this,i=e;let n,s,a,o,l,c,d,u,h,g,f,m,p,v,y,C,D,S,x,R,I,M,P,_,A,z,Y,V,U;for(r=H.asArray(r),U=0;e&&!V;)for(n=Object.assign(t.config,e),s=n.startBox,a=n.endBox,o=n.startShift,l=n.endShift,c=n.startSide,d=n.endSide,u=n.startArrowMargin,h=n.endArrowMargin,g=n.horizontalMargin,f=n.verticalMargin,m=n.hasOwnProperty("startHorizontalMargin")?n.startHorizontalMargin:g,p=n.hasOwnProperty("startVerticalMargin")?n.startVerticalMargin:f,v=n.hasOwnProperty("endHorizontalMargin")?n.endHorizontalMargin:g,y=n.hasOwnProperty("endVerticalMargin")?n.endVerticalMargin:f,C=n.hasOwnProperty("otherHorizontalMargin")?n.otherHorizontalMargin:g,D=n.hasOwnProperty("otherVerticalMargin")?n.otherVerticalMargin:f,S=n.otherBoxes,c=t.normalizeSide(c),d=t.normalizeSide(d),x=t.getConnectionCoordinatesFromBoxSideShift(s,c,o),R=t.getConnectionCoordinatesFromBoxSideShift(a,d,l),A=t.calcGridBaseBoxFromBoxAndDrawParams(s,c,u,m,p),z=t.calcGridBaseBoxFromBoxAndDrawParams(a,d,h,v,y),CO.forEach(K=>{Math.abs(A[K]-z[K])<=bO&&(z[K]=A[K])}),t.shouldLookForPath(s,a,A,z)&&(S=S==null?void 0:S.map(K=>t.calcGridBaseBoxFromBoxAndDrawParams(K,!1,0,C,D)),I=t.getConnectionCoordinatesFromBoxSideShift(A,c,o),M=t.getConnectionCoordinatesFromBoxSideShift(z,d,l),Y=t.buildPathGrid(A,z,I,M,c,d,S),P=t.convertDecartPointToGridPoint(Y,I),_=t.convertDecartPointToGridPoint(Y,M),V=t.findPathOnGrid(Y,P,_,c,d)),e=!1;!V&&!e&&r&&U<r.length;U++)e=r[U](n,i);return V&&(V=t.prependPathWithArrowStaffSegment(V,x,c),V=t.appendPathWithArrowStaffSegment(V,R,d),V=t.optimizePath(V)),V}static calculateRelativePosition(e,r,t=!1){const i=t?"top":"start",n=t?"bottom":"end";let s;return e[n]<r[i]?s=0:e[n]<=r[n]&&e[n]>=r[i]&&e[i]<r[i]?s=1:e[i]>=r[i]&&e[n]<=r[n]?s=2:e[i]<r[i]&&e[n]>r[n]?s=-2:e[i]<=r[n]&&e[n]>r[n]?s=3:s=4,s}static boxOverlapChanged(e,r,t,i,n=!1){const s=Xa.calculateRelativePosition,a=s(e,r,n),o=s(t,i,n);return a!==o}shouldLookForPath(e,r,t,i){let n=!0;return(e.end-e.start<=this.startArrowMargin||r.end-r.start<=this.endArrowMargin)&&Math.abs(Xa.calculateRelativePosition(e,r,!0))===2&&(n=!Xa.boxOverlapChanged(e,r,t,i)),n}getConnectionCoordinatesFromBoxSideShift(e,r,t){let i;switch(r){case"left":i={x:e.start,y:(e.top+e.bottom)/2+t};break;case"right":i={x:e.end,y:(e.top+e.bottom)/2+t};break;case"top":i={x:(e.start+e.end)/2+t,y:e.top};break;case"bottom":i={x:(e.start+e.end)/2+t,y:e.bottom};break}return i}calcGridBaseBoxFromBoxAndDrawParams(e,r,t,i,n){let s;switch(this.normalizeSide(r)){case"left":s={start:e.start-Math.max(t,i),end:e.end+i,top:e.top-n,bottom:e.bottom+n};break;case"right":s={start:e.start-i,end:e.end+Math.max(t,i),top:e.top-n,bottom:e.bottom+n};break;case"top":s={start:e.start-i,end:e.end+i,top:e.top-Math.max(t,n),bottom:e.bottom+n};break;case"bottom":s={start:e.start-i,end:e.end+i,top:e.top-n,bottom:e.bottom+Math.max(t,n)};break;default:s={start:e.start-i,end:e.end+i,top:e.top-n,bottom:e.bottom+n}}return s}normalizeSide(e){const{rtl:r}=this.client;return e==="start"?r?"right":"left":e==="end"?r?"left":"right":e}buildPathGrid(e,r,t,i,n,s,a){let o,l,c,d,u,h,g,f,m,p,v,y,C;const D={},S=[];for(o=[e.start,n==="left"||n==="right"?(e.start+e.end)/2:t.x,e.end,r.start,s==="left"||s==="right"?(r.start+r.end)/2:i.x,r.end],l=[e.top,n==="top"||n==="bottom"?(e.top+e.bottom)/2:t.y,e.bottom,r.top,s==="top"||s==="bottom"?(r.top+r.bottom)/2:i.y,r.bottom],a&&a.forEach(x=>{o.push(x.start,(x.start+x.end)/2,x.end),l.push(x.top,(x.top+x.bottom)/2,x.bottom)}),o=[...new Set(o.sort((x,R)=>x-R))],l=[...new Set(l.sort((x,R)=>x-R))],h=0,f=l.length;h<f;++h)for(D[h]=D[h]||{},c=l[h],u=0,g=o.length;u<g;++u){if(d=o[u],y=(d<=e.start||d>=e.end||c<=e.top||c>=e.bottom)&&(d<=r.start||d>=r.end||c<=r.top||c>=r.bottom),a)for(m=0,p=a.length;y&&m<p;++m)v=a[m],y=d<=v.start||d>=v.end||c<=v.top||c>=v.bottom||d===t.x&&c===t.y||d===i.x&&c===i.y;C={distance:Number.MAX_SAFE_INTEGER,permitted:y,x:d,y:c,ix:u,iy:h},D[h][u]=C,S.push(C)}return{width:o.length,height:l.length,xs:o,ys:l,points:D,linearPoints:S}}convertDecartPointToGridPoint(e,r){const t=e.xs.indexOf(r.x),i=e.ys.indexOf(r.y);return e.points[i][t]}findPathOnGrid(e,r,t,i,n){const s=this;let a=!1;return r.permitted&&t.permitted&&(e=s.waveForward(e,r,0),a=s.collectPath(e,t,n)),a}getGridPointNeighbors(e,r,t){const i=r.ix,n=r.iy,s=[];let a;return n<e.height-1&&(a=e.points[n+1][i],(!t||t(a))&&s.push(a)),n>0&&(a=e.points[n-1][i],(!t||t(a))&&s.push(a)),i<e.width-1&&(a=e.points[n][i+1],(!t||t(a))&&s.push(a)),i>0&&(a=e.points[n][i-1],(!t||t(a))&&s.push(a)),s}waveForward(e,r,t){const i=this;return Rn.preWalkUnordered([r,t],([n,s])=>i.getGridPointNeighbors(e,n,a=>a.permitted&&a.distance>s+1).map(a=>[a,s+1]),([n,s])=>n.distance=s),e}collectPath(e,r,t){const i=this,n=[];let s=!0,a,o,l,c;for(;s&&r.distance;)if(a=i.getGridPointNeighbors(e,r,d=>d.permitted&&d.distance===r.distance-1),s=a.length>0,s){switch(a=a.sort((d,u)=>{let h,g;h=d.ix-r.ix,g=d.iy-r.iy;const f=(t==="left"||t==="right")&&g===0||(t==="top"||t==="bottom")&&h===0?-1:1;h=u.ix-r.ix,g=u.iy-r.iy;const m=(t==="left"||t==="right")&&g===0||(t==="top"||t==="bottom")&&h===0?-1:1;if(f>m)return 1;if(f<m)return-1;if(f===m)return d.y>u.y?-1:1}),o=a[0],n.push({x1:o.x,y1:o.y,x2:r.x,y2:r.y}),l=o.ix-r.ix,c=o.iy-r.iy,!0){case(!c&&l>0):t="left";break;case(!c&&l<0):t="right";break;case(!l&&c>0):t="top";break;case(!l&&c<0):t="bottom";break}r=o}return s&&n.reverse()||!1}prependPathWithArrowStaffSegment(e,r,t){if(e.length>0){const i=e[0],n={x2:i.x1,y2:i.y1};switch(t){case"left":n.x1=r.x,n.y1=i.y1;break;case"right":n.x1=r.x,n.y1=i.y1;break;case"top":n.x1=i.x1,n.y1=r.y;break;case"bottom":n.x1=i.x1,n.y1=r.y;break}e.unshift(n)}return e}appendPathWithArrowStaffSegment(e,r,t){if(e.length>0){const i=e[e.length-1],n={x1:i.x2,y1:i.y2};switch(t){case"left":n.x2=r.x,n.y2=i.y2;break;case"right":n.x2=r.x,n.y2=i.y2;break;case"top":n.x2=i.x2,n.y2=r.y;break;case"bottom":n.x2=i.x2,n.y2=r.y;break}e.push(n)}return e}optimizePath(e){const r=[];let t,i;if(e.length>0)for(t=e.shift(),r.push(t);e.length>0;)i=e.shift(),Xi(t.x1,i.x1)&&Xi(t.y1,i.y1)&&Xi(t.x2,i.x2)&&Xi(t.y2,i.y2)?t=i:Xi(t.y1,t.y2)&&Xi(i.y1,i.y2)?t.x2=i.x2:Xi(t.x1,t.x2)&&Xi(i.x1,i.x2)?t.y2=i.y2:(r.push(i),t=i);return r}};Xa._$name="RectangularPathFinder";function b0(e){return e.x1===e.x2?e.y2>e.y1?"d":"u":e.x2>e.x1?"r":"l"}function _v(e){return e.x1===e.x2?e.y2-e.y1:e.x2-e.x1}function DO(e,r,t){const i=b0(e)+b0(r),n=t*(i.includes("l")?-1:1),s=t*(i.includes("u")?-1:1);return`a${n},${s} 0 0 ${i==="ur"||i==="lu"||i==="dl"||i==="rd"?1:0} ${n},${s}`}function wO(e,r,t,i,n){let s=e.x1===e.x2?"v":"h",a=i;if(i){const o=_v(e),l=r?Math.abs(_v(r)):Number.MAX_SAFE_INTEGER,c=Math.sign(o);n==null&&(n=i),(Math.abs(o)<i*2||l<i*2)&&(a=Math.min(Math.abs(o),l)/2);const d=t==="single"?0:t==="first"?a:t==="between"?n+a:n,u=o-d*c;s+=Math.sign(u)!==c?0:u,t!=="last"&&t!=="single"&&a>0&&(s+=` ${DO(e,r,a)}`)}else s+=_v(e);return{line:s,currentRadius:i!==a?a:null}}function EO(e,r){const{length:t}=r;if(!t)return"";let i=null;return`M${r[0].x1},${r[0].y1} ${r.map((n,s)=>{const a=t===1?"single":s===t-1?"last":s===0?"first":"between",o=wO(n,r[s+1],a,e,i);return{currentRadius:i}=o,o.line}).join(" ")}`}var xO=e=>{var r;return r=class extends e{constructor(){super(...arguments),E(this,"lineCache",{})}onSVGReady(){const t=this;t.pathFinder=new Xa({...t.pathFinderConfig,client:t.client}),t.lineDefAdjusters=t.createLineDefAdjusters(),t.createMarker()}changeRadius(t){return t!==null&&T.assertNumber(t,"radius"),t}updateRadius(){this.isConfiguring||this.reset()}updateRenderer(){this.isConfiguring||this.reset()}changeClickWidth(t){return t!==null&&T.assertNumber(t,"clickWidth"),t}updateClickWidth(){this.isConfiguring||this.reset()}createMarker(){var t,i;const n=this,{markerDef:s}=n,a=this.client.svgCanvas,o=s?`${n.client.id}-arrowEnd`:"arrowEnd";(t=n.marker)==null||t.remove(),a.style.setProperty("--scheduler-dependency-marker",`url(#${o})`),n.marker=w.createElement({parent:a,id:o,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8.5,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:(i=n.markerDef)!=null?i:"M3,0 L3,6 L9,3 z"}]})}updateMarkerDef(){this.isConfiguring||this.createMarker()}getAssignmentElement(t){var i,n;return((n=(i=this.client.features.eventDrag)==null?void 0:i.getProxyElement)==null?void 0:n.call(i,t))||this.client.getElementFromAssignmentRecord(t)}getDomConfigs(t,i,n,s){var a,o;const l=this,c=l.getDependencyKey(t,i,n),d=l.lineCache[c];if(l.constructLineCache||!d||s||l.drawingLive&&(l.getAssignmentElement(i)||l.getAssignmentElement(n))){const u=l.prepareLineDef(t,i,n,s),h=u&&l.pathFinder.findPath(u,l.lineDefAdjusters),{client:g,clickWidth:f}=l,{toEvent:m}=t;if(h){const p=l.highlighted.get(t),v={tag:"path",ns:"http://www.w3.org/2000/svg",d:EO((a=l.radius)!=null?a:0,h),role:"presentation",dataset:{syncId:c,depId:t.id,fromId:i.id,toId:n.id},elementData:{dependency:t,points:h},class:{[l.baseCls]:1,[t.cls]:t.cls,[t.highlighted]:t.highlighted,[p&&[...p].join(" ")]:p,[l.noMarkerCls]:u.hideMarker,"b-inactive":t.active===!1,"b-sch-bidirectional-line":t.bidirectional,"b-readonly":t.readOnly,"b-sch-dependency-ends-outside":!m.milestone&&(m.endDate<=g.startDate||g.endDate<=m.startDate)||m.milestone&&(m.endDate<g.startDate||g.endDate<m.startDate)}};(o=l.renderer)==null||o.call(l,{domConfig:v,points:h,dependencyRecord:t,fromAssignmentRecord:i,toAssignmentRecord:n,fromBox:u.startBox,toBox:u.endBox,fromSide:u.startSide,toSide:u.endSide});const y=[v];return f>1&&y.push({...v,class:{...v.class,"b-click-area":1},dataset:{...v.dataset,syncId:`${v.dataset.syncId}-click-area`},style:{strokeWidth:f}}),l.lineCache[c]=y}return l.lineCache[c]=null}return d}generateBoundaryBoxes(t,i){return i==="bottom"?[{start:t.left,end:t.left+t.width/2,top:t.rowTop,bottom:t.rowBottom},{start:t.left+t.width/2,end:t.right,top:t.rowTop,bottom:t.rowBottom}]:[{start:t.left-this.pathFinder.startArrowMargin,end:t.right+this.pathFinder.startArrowMargin,top:t.rowTop,bottom:t.rowBottom}]}getAssignmentBounds(t){const{client:i}=this,n=this.getAssignmentElement(t);if(n&&!i.isExporting){const s=k.from(n,this.relativeTo);if(i.isHorizontal){let a=i.getRowById(t.resource.id);if(s.y<a.top||s.bottom>a.bottom){const o=i.rowManager.getRowAt(s.center.y,!0);o&&(a=o)}s.rowTop=a.top,s.rowBottom=a.bottom}return s}return i.isEngineReady&&i.getAssignmentEventBox(t,!0)}getConnectorStartSide(t){return this.client.currentOrientation.getConnectorStartSide(t)}getConnectorEndSide(t){return this.client.currentOrientation.getConnectorEndSide(t)}getDependencyStartSide(t){const{fromEvent:i,type:n,fromSide:s}=t;if(s)return s;switch(!0){case n===kt.Type.StartToEnd:case n===kt.Type.StartToStart:return this.getConnectorStartSide(i);case n===kt.Type.EndToStart:case n===kt.Type.EndToEnd:return this.getConnectorEndSide(i);default:return this.getConnectorEndSide(i)}}getDependencyEndSide(t){const{toEvent:i,type:n,toSide:s}=t;if(s)return s;switch(!0){case n===kt.Type.EndToEnd:case n===kt.Type.StartToEnd:return this.getConnectorEndSide(i);case n===kt.Type.EndToStart:case n===kt.Type.StartToStart:return this.getConnectorStartSide(i);default:return this.getConnectorStartSide(i)}}createLineDefAdjusters(){const{client:t}=this;function i(a){const{barMargin:o}=t;let l=!1;return(a.startArrowMargin>o||a.endArrowMargin>o)&&(a.startArrowMargin=a.endArrowMargin=o,l=!0),l&&a}function n(a){let o=!1;return(a.startArrowMargin>0||a.endArrowMargin>0)&&(a.startArrowMargin=a.endArrowMargin=0,o=!0),o&&a}function s(a,o){let l=!1;return a.horizontalMargin>2&&(a.horizontalMargin=1,l=!0,o.hideMarker=!0),l&&a}return[i,n,s]}adjustLineDef(t,i){return i}prepareLineDef(t,i,n,s){var a,o;const l=this,c=l.getDependencyStartSide(t),d=l.getDependencyEndSide(t),u=(a=s==null?void 0:s.from)!=null?a:l.getAssignmentBounds(i),h=(o=s==null?void 0:s.to)!=null?o:l.getAssignmentBounds(n),g=[];if(!u||!h)return null;let{startArrowMargin:f,verticalMargin:m}=l.pathFinder;return l.client.isHorizontal&&(u.rowTop!=null&&u.rowTop!==h.rowTop&&g.push(...l.generateBoundaryBoxes(u,c)),t.bidirectional||(/(top|bottom)/.test(c)&&(f=l.client.barMargin/2),m=l.client.barMargin/2)),l.adjustLineDef(t,{startBox:u,endBox:h,otherBoxes:g,startArrowMargin:f,verticalMargin:m,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:c,endSide:d})}beforeDraw(){super.beforeDraw(),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}afterDraw(){super.afterDraw(),this.constructLineCache=!1}reset(){super.reset(),this.lineCache={}}},E(r,"$name","DependencyLineGenerator"),r},RO=["start","start","end","end"],TO=["start","end","start","end"],C0=e=>{var r;return r=class extends e{changeTooltip(t,i){const n=this;return i==null||i.destroy(),!n.showTooltip||!t?null:ve.new({align:"b-t",id:`${n.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing,.b-taskeditor-editing,.b-resizing-event,.b-dragcreating,.b-dragging-event,.b-creating-dependency) .${n.baseCls}`,forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:n.getHoverTipHtml.bind(n)},t)}getHoverTipHtml({activeTarget:t}){return this.tooltipTemplate(this.resolveDependencyRecord(t))}},E(r,"$name","DependencyTooltip"),E(r,"configurable",{showTooltip:!0,tooltipTemplate(t){return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:this.L("L{Dependencies.from}")},{text:t.fromEvent.name},{className:`b-sch-box b-${t.fromSide||RO[t.type]}`},{tag:"label",text:this.L("L{Dependencies.to}")},{text:t.toEvent.name},{className:`b-sch-box b-${t.toSide||TO[t.type]}`}]}]}},tooltip:{$config:"nullify",value:{}}}),r},MO={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},IO=Object.freeze({}),S0=e=>{var r;const t=[e];return(r=e.resource)!=null&&r.hasLinks&&t.push(...e.resource.$links.map(i=>({id:`${i.id}_${e.id}`,resource:i,event:e.event,drawDependencies:e.drawDependencies}))),t},Zi=class extends Q.mixin(xt,fe,y0,yO,xO,C0){constructor(){super(...arguments),E(this,"domConfigs",new Map),E(this,"drawingLive",!1),E(this,"lastScrollX",null),E(this,"highlighted",new Map),E(this,"visibleResources",null),E(this,"usingLinks",null),E(this,"visibleDateRange",null),E(this,"relativeTo",null)}static get pluginConfig(){return{chain:["render","onPaint","onElementClick","onElementDblClick","onElementContextMenu","onElementMouseOver","onElementMouseOut","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}construct(e,r){super.construct(e,r);const{scheduledEventName:t}=e;e.ion({svgCanvasCreated:"onSVGReady",animationStart:"refresh",[t+"DragStart"]:"refresh",[t+"DragAbort"]:"refresh",[t+"ResizeStart"]:"refresh",[t+"SegmentDragStart"]:"refresh",[t+"SegmentResizeStart"]:"refresh",timelineViewportResize:"reset",timeAxisViewModelUpdate:"reset",toggleNode:"reset",thisObj:this}),e.rowManager.ion({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(e.store)}doDisable(e){this.isConfiguring||(this._isDisabling=e,this.draw(),this._isDisabling=!1),super.doDisable(e)}get rowStore(){return this.client.isVertical?this.client.resourceStore:this.client.store}bindStore(e){const r=this;r.client.isVertical||(r.detachListeners("store"),r.client.usesDisplayStore&&(e==null||e.ion({name:"store",refresh:"onStoreRefresh",thisObj:r}),r.reset()))}onStoreRefresh(){this.reset()}attachToProject(e){super.attachToProject(e),e==null||e.ion({name:"project",commitFinalized:"reset",thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),e==null||e.ion({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}onResourceStoreChange(){this.usingLinks=null,this.reset()}attachToEventStore(e){super.attachToEventStore(e),e==null||e.ion({name:"eventStore",refresh:"reset",thisObj:this})}attachToAssignmentStore(e){super.attachToAssignmentStore(e),e==null||e.ion({name:"assignmentStore",refresh:"reset",thisObj:this})}attachToDependencyStore(e){super.attachToDependencyStore(e),e==null||e.ion({name:"dependencyStore",change:"reset",refresh:"reset",thisObj:this})}updateDrawOnScroll(e){const r=this;r.detachListeners("scroll"),e?r.client.ion({name:"scroll",scroll:"doRefresh",horizontalScroll:"onHorizontalScroll",prio:-100,thisObj:r}):(r.client.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:r}),r.client.timeAxisSubGrid.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:r}))}onHorizontalScroll({subGrid:e,scrollX:r}){r!==this.lastScrollX&&e===this.client.timeAxisSubGrid&&(this.lastScrollX=r,this.draw())}onPaint(){this.refresh()}static getLocalizedDependencyType(e){return e?this.L(`L{DependencyType.${e}}`):""}getElementForDependency(e,r,t){return this.getElementsForDependency(e,r,t)[0]}getElementsForDependency(e,r,t){let i=`[data-dep-id="${e.id}"]`;return r&&(i+=`[data-from-id="${r.id}"]`),t&&(i+=`[data-to-id="${t.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(i))}resolveDependencyRecord(e){var r;return(r=e.elementData)==null?void 0:r.dependency}isDependencyElement(e){return e.matches(`.${this.baseCls}`)}onElementClick(e){const r=this.resolveDependencyRecord(e.target);if(r){const t=MO[e.type];this.client.trigger(`dependency${t}`,{dependency:r,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementContextMenu(e){return this.onElementClick(e)}onElementMouseOver(e){const r=this,t=r.resolveDependencyRecord(e.target);t&&(r.client.trigger("dependencyMouseOver",{dependency:t,event:e}),r.overCls&&r.highlight(t))}onElementMouseOut(e){const r=this,t=r.resolveDependencyRecord(e.target);t&&(r.client.trigger("dependencyMouseOut",{dependency:t,event:e}),r.overCls&&r.unhighlight(t))}isDependencyVisible(e){const r=this,{rowStore:t}=r,{fromEvent:i,toEvent:n}=e;if(!i||!n)return!1;const s=i.resource,a=n.resource;return!t.isAvailable(s)||!t.isAvailable(a)?!1:i.isModel&&!s.instanceMeta(t).hidden&&!a.instanceMeta(t).hidden}updateHighlightDependenciesOnEventHover(e){const r=this;if(e){const{client:t}=r;t.ion({name:"highlightOnHover",[`${t.scheduledEventName}MouseEnter`]:i=>r.highlightEventDependencies(i.eventRecord||i.taskRecord),[`${t.scheduledEventName}MouseLeave`]:i=>r.unhighlightEventDependencies(i.eventRecord||i.taskRecord),thisObj:r})}else r.detachListeners("highlightOnHover")}highlight(e,r=this.overCls){let t=this.highlighted.get(e);t||this.highlighted.set(e,t=new Set),t.add(r);for(const i of this.getElementsForDependency(e))i.classList.add(r)}unhighlight(e,r=this.overCls){const t=this.highlighted.get(e);t&&(t.delete(r),t.size||this.highlighted.delete(e));for(const i of this.getElementsForDependency(e))i.classList.remove(r)}highlightEventDependencies(e,r){e.dependencies.forEach(t=>this.highlight(t,r))}unhighlightEventDependencies(e,r){e.dependencies.forEach(t=>this.unhighlight(t,r))}getDependenciesToConsider(e,r,t,i){var n,s;return(s=(n=super.getDependenciesToConsider)==null?void 0:n.call(this,e,r,t,i))!=null?s:this.project.dependencyStore.records.filter(a=>a.isValid)}getDependencyKey(e,r,t){return`dep:${e.id};from:${r.id};to:${t.id}`}drawDependency(e,r=!1,t=null){var i,n,s,a;const o=this,{domConfigs:l,client:c,rowStore:d,topIndex:u,bottomIndex:h}=o,{eventStore:g,useInitialAnimation:f}=c,{idMap:m}=d,{startMS:p,endMS:v}=o.visibleDateRange,{fromEvent:y,toEvent:C}=e;let D=y.assigned,S=C.assigned;if(y.isScheduled&&C.isScheduled&&g.includes(y)&&g.includes(C)&&(D!=null&&D.size)&&(S!=null&&S.size)){o.usingLinks&&(D=[...D].flatMap(S0),S=[...S].flatMap(S0));for(const x of D)for(const R of S){const I=(n=m[(i=x.resource)==null?void 0:i.id])==null?void 0:n.index,M=(a=m[(s=R.resource)==null?void 0:s.id])==null?void 0:a.index,P=Math.min(y.startDateMS,C.startDateMS),_=Math.max(y.endDateMS,C.endDateMS);if(c.isExporting||I!=null&&M!=null&&x.drawDependencies!==!1&&R.drawDependencies!==!1&&d.isAvailable(x.resource)&&d.isAvailable(R.resource)&&!(I<u&&M<u||I>h&&M>h||P<p&&_<p||P>v&&_>v)){const A=o.getDependencyKey(e,x,R),z=o.getDomConfigs(e,x,R,t);z?(f&&(z[0].style={animationDelay:`${Math.max(I,M)/20*1e3}ms`}),l.set(A,z)):l.delete(A)}o.afterDrawDependency(e,I,M,P,_)}}r||o.domSync()}afterDrawDependency(e,r,t,i,n){var s;(s=super.afterDrawDependency)==null||s.call(this,e,r,t,i,n)}beforeDraw(){var e;(e=super.beforeDraw)==null||e.call(this)}afterDraw(){var e;(e=super.afterDraw)==null||e.call(this)}domSync(e=this.client.svgCanvas){X.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values()).flat()},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback(){}})}fillDrawingCache(){const e=this,{client:r}=e;e.relativeTo=k.from(r.foregroundCanvas),e.visibleResources=r.visibleResources,e.visibleDateRange=r.visibleDateRange,e.topIndex=e.rowStore.indexOf(e.visibleResources.first),e.bottomIndex=e.rowStore.indexOf(e.visibleResources.last),e.usingLinks==null&&(e.usingLinks=r.resourceStore.some(t=>t.hasLinks))}draw(){const e=this,{client:r}=e,{visibleDateRange:t}=r;if(!(r.refreshSuspended||!r.foregroundCanvas||!t||!r.isEngineReady||e.disabled&&!e._isDisabling||r.isExporting)){if(e.fillDrawingCache(),e.domConfigs.clear(),r.firstVisibleRow&&r.lastVisibleRow&&r.timeAxis.count&&!e.disabled&&t.endMS-t.startMS>0){const{topIndex:i,bottomIndex:n}=e,s=e.getDependenciesToConsider(t.startMS,t.endMS,i,n);e.beforeDraw();for(const a of s)e.drawDependency(a,!0);e.afterDraw()}e.domSync(),r.trigger("dependenciesDrawn")}}doRefresh(){var e,r,t,i;const n=this,{client:s}=n,{scheduledEventName:a}=s;n.draw(),n.drawingLive=s.dependencyStore.count&&(s.isAnimating||s.useInitialAnimation&&s.eventStore.count||((e=s.features[`${a}Drag`])==null?void 0:e.isActivelyDragging)||((r=s.features[`${a}Resize`])==null?void 0:r.isResizing)||((t=s.features[`${a}SegmentDrag`])==null?void 0:t.isActivelyDragging)||((i=s.features[`${a}SegmentResize`])==null?void 0:i.isResizing)),n.drawingLive&&n.refresh(!1)}refresh(e=this.immediateRefresh){const{client:r}=this;!r.refreshSuspended&&!this.disabled&&r.isPainted&&!r.timeAxisSubGrid.collapsed&&(e===!0?this.doRefresh.now:this.doRefresh).call(this)}reset({source:e,type:r}=IO){var t;(t=super.reset)==null||t.call(this),this.refresh(e===this.client&&r==="timelineviewportresize")}drawForEvent(){ne.deprecate("Scheduler","6.0.0","Dependencies.drawForEvent() is no longer needed"),this.refresh()}render(){this.client.getConfig("svgCanvas")}};E(Zi,"$name","Dependencies"),E(Zi,"configurable",{overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,drawOnScroll:!0,clickWidth:null,immediateRefresh:null}),E(Zi,"delayable",{doRefresh:10}),Zi._$name="Dependencies",j.registerFeature(Zi,!1,["Scheduler","ResourceHistogram"]);var D0=class extends ht{static get $name(){return"DependencyEditor"}static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const{dependencyEditFeature:r}=this;return e.ref==="lagField"&&!r.showLagField||e.ref==="deleteButton"&&!r.showDeleteButton?!1:super.processWidgetConfig(e)}afterShow(...e){const{deleteButton:r}=this.widgetMap;r&&(r.hidden=!this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}};D0._$name="DependencyEditor";var hh=class extends Q{static get $name(){return"DependencyEdit"}static get configurable(){return{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,defaults:{localeClass:this},items:{fromNameField:{type:"display",weight:100,label:"L{From}"},toNameField:{type:"display",weight:200,label:"L{To}"},typeField:{type:"combo",weight:300,label:"L{Type}",name:"type",editable:!1,valueField:"id",displayField:"name",localizeDisplayFields:!0,buildItems:function(){const e=this.parent;return Object.keys(kt.Type).map(r=>({id:kt.Type[r],name:e.L(r),localeKey:r}))}},lagField:{type:"duration",weight:400,label:"L{Lag}",name:"lag",allowNegative:!0}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler"},saveButton:{color:"b-green",text:"L{Save}"},deleteButton:{color:"b-gray",text:"L{Delete}"},cancelButton:{color:"b-gray",text:"L{Object.Cancel}"}}}}}}construct(e,r){const t=this;if(e.dependencyEdit=t,super.construct(e,r),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit");t.clientListenersDetacher=e.ion({[t.triggerEvent]:t.onActivateEditor,thisObj:t})}doDestroy(){var e;this.clientListenersDetacher(),(e=this.editor)==null||e.destroy(),super.doDestroy()}changeEditorConfig(e){const r=this,{autoClose:t,cls:i,client:n}=r;return T.assign({owner:n,align:"b-t",id:`${n.id}-dependency-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[n.timeAxisSubGridElement,n.bodyContainer],constrainTo:globalThis,autoClose:t,cls:i},e)}get isValid(){return Object.values(this.editor.widgetMap).every(e=>!e.name||e.hidden?!0:e.isValid!==!1)}get values(){const e={};return this.editor.eachWidget(r=>{!r.name||r.hidden||(e[r.name]=r.value)},!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:r}=this;r.lag&&(r.lagUnit=r.lag.unit,r.lag=r.lag.magnitude),"type"in r&&(e.fromSide!=null&&(r.fromSide=null),e.toSide!=null&&(r.toSide=null)),T.cleanupProperties(r,!0),e.set(r)}onPopupKeyDown({event:e}){e.key==="Enter"&&this.saveAndCloseOnEnter&&e.target.tagName.toLowerCase()==="input"&&(e.preventDefault(),this.onSaveClick())}onSaveClick(){this.save()&&(this.afterSave(),this.editor.hide())}async onDeleteClick(){await this.deleteDependency()&&this.afterDelete(),this.editor.hide()}onCancelClick(){this.afterCancel(),this.editor.hide()}afterSave(){}afterDelete(){}afterCancel(){}internalShowEditor(e){const r=this,{client:t}=r,i=r.getEditor(e);r.loadRecord(e),t.trigger("beforeDependencyEditShow",{dependencyEdit:r,dependencyRecord:e,editor:i});let n=r.lastPointerDownCoordinate;if(!n){const s=k.from(t.element).center;n=[s.x-i.width/2,s.y-i.height/2]}return i.showBy(n)}async editDependency(e){const r=this,{client:t}=r;return t.readOnly||e.readOnly||await t.trigger("beforeDependencyEdit",{dependencyEdit:r,dependencyRecord:e})===!1?!1:(await this.internalShowEditor(e),!0)}getEditor(){var e,r,t;const i=this;let{editor:n}=i;return n||(n=i.editor=D0.new({dependencyEditFeature:i,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,autoClose:i.autoClose,cls:i.cls,rootElement:i.client.rootElement,internalListeners:{keydown:i.onPopupKeyDown,thisObj:i}},i.editorConfig),n.items.length===0&&console.warn("Editor configured without any `items`"),n.eachWidget(s=>{const a=s.ref||s.id;a&&!i[a]&&(i[a]=s)}),(e=i.saveButton)==null||e.ion({click:"onSaveClick",thisObj:i}),(r=i.deleteButton)==null||r.ion({click:"onDeleteClick",thisObj:i}),(t=i.cancelButton)==null||t.ion({click:"onCancelClick",thisObj:i}),i.editor)}loadRecord(e){const r=this;r.fromNameField.value=e.fromEvent.name,r.toNameField.value=e.toEvent.name,r.lagField&&(r.lagField.value=new _e(e.lag,e.lagUnit)),r.editor.record=r.dependencyRecord=e}async save(){var e;const r=this,{client:t,dependencyRecord:i}=r;if(!i||!r.isValid)return;const{dependencyStore:n,values:s}=r;if(t.trigger("beforeDependencySave",{dependencyRecord:i,values:s})!==!1){if(r.onBeforeSave(i),r.updateRecord(i),n&&!i.stores.length){if(t.trigger("beforeDependencyAdd",{dependencyRecord:i,dependencyEdit:r})===!1)return;n.add(i)}await((e=t.project)==null?void 0:e.commitAsync()),t.trigger("afterDependencySave",{dependencyRecord:i}),r.onAfterSave(i)}return i}async deleteDependency(){var e;const{client:r,editor:t,dependencyRecord:i}=this;return r.trigger("beforeDependencyDelete",{dependencyRecord:i})!==!1?(t.containsFocus&&t.revertFocus(),r.dependencyStore.remove(i),await((e=r.project)==null?void 0:e.commitAsync()),!0):!1}get dependencyStore(){return this.client.dependencyStore}onActivateEditor({dependency:e,event:r}){this.disabled||(this.lastPointerDownCoordinate=[r.clientX,r.clientY],this.editDependency(e))}};hh._$name="DependencyEdit",j.registerFeature(hh,!1);var Za=class extends Q.mixin(fe){static get $name(){return"ScheduleContext"}construct(e,r){super.construct(e,r);const{triggerEvent:t}=this,i={datachange:"syncContextElement",timeaxisviewmodelupdate:"onTimeAxisViewModelUpdate",presetchange:"clearContext",thisObj:this};t==="mouseover"?i.timelineContextChange="onTimelineContextChange":((t==="click"||t==="mousedown")&&(i.schedulecontextmenu="onScheduleContextGesture"),Object.assign(i,{[`schedule${t}`]:"onScheduleContextGesture",[`event${t}`]:"onScheduleContextGesture",...i})),e.useBackgroundCanvas=!0,e.ion(i),e.rowManager.ion({rowheight:"syncContextElement",thisObj:this})}changeTriggerEvent(e){return(e==="hover"||e==="mousemove")&&(e="mouseover"),e}get element(){return this._element||(this._element=w.createElement({parent:this.client.backgroundCanvas,className:"b-schedule-selected-tick"}))}onTimelineContextChange({context:e}){this.context=e}onScheduleContextGesture(e){this.context=e}onTimeAxisViewModelUpdate({source:e}){var r;e.timeAxis.includes((r=this.context)==null?void 0:r.tick)?this.syncContextElement():this.clearContext()}clearContext(){this.context=null}updateContext(e,r){this.syncContextElement()}syncContextElement(){if(this.context&&this.enabled){const e=this,{client:r,element:t,context:i,renderer:n}=e,{isVertical:s}=r,{style:a}=t,o=s?r.rowManager.rows[0]:r.getRowFor(i.resourceRecord);if(o){const{tickStartDate:l,tickEndDate:c,resourceRecord:d}=i,u=r.currentOrientation.getTimeSpanRenderData({startDate:l,endDate:c,startDateMS:l.getTime(),endDateMS:c.getTime()},d);let h,g,f;s?(h=u.top,g=u.resourceWidth,f=u.height):(h=o.top,g=u.width,f=o.height),a.display="",a.width=`${g}px`,a.height=`${f}px`,w.setTranslateXY(t,u.left,h),i.index=o.index,t.innerHTML="",n&&e.callback(n,e,[i,t])}else a.display="none"}else this.element.style.display="none"}};E(Za,"delayable",{syncContextElement:"raf"}),E(Za,"configurable",{triggerEvent:"click",renderer:null,context:{$config:{equal(e,r){return(e==null?void 0:e.index)===(r==null?void 0:r.index)&&(e==null?void 0:e.tickParentIndex)===(r==null?void 0:r.tickParentIndex)&&!(((e==null?void 0:e.tickStartDate)||0)-((r==null?void 0:r.tickStartDate)||0))}}}}),Za.featureClass="b-scheduler-context",Za._$name="ScheduleContext",j.registerFeature(Za,!1,["Scheduler"]);var cs=class extends ba.mixin(xt){constructor(){super(...arguments),E(this,"entityName","event")}construct(e,r){super.construct(e,r),e.ion({eventClick:"onEventClick",scheduleClick:"onScheduleClick",projectChange:()=>{this.clearClipboard(),this._cellClickedContext=null},thisObj:this})}get scheduler(){return this.client}attachToEventStore(e){super.attachToEventStore(e),delete this._eventClickedContext}onEventDataGenerated(e){const{assignmentRecord:r}=e;r&&(e.cls["b-cut-item"]=r.meta.isCut)}onEventClick(e){this._cellClickedContext=null,this._eventClickedContext=e}onScheduleClick(e){this._cellClickedContext=e,this._eventClickedContext=null}isActionAvailable({event:e}){var r,t;return!this.disabled&&globalThis.getSelection().toString().length===0&&!((r=this.client.features.cellEdit)!=null&&r.isEditing)&&!!e.target.closest(".b-timeaxissubgrid")&&!((t=this.client.focusedCell)!=null&&t.isSpecialRow)}async copy(){await this.copyEvents()}async cut(){await this.copyEvents(void 0,!0)}async paste(){await this.pasteEvents()}async copyEvents(e=this.scheduler.selectedAssignments,r=!1){const t=this,{scheduler:i}=t;if(i.splitFrom)return i.splitFrom.features.eventCopyPaste.copyEvents(e,r);if(!(e!=null&&e.length))return;let n=e.slice();e[0].isEventModel&&(n=e.map(a=>a.assignments).flat()),r&&(n=n.filter(a=>!a.event.readOnly));const s=n.map(a=>a.event);!n.length||i.readOnly||(await t.writeToClipboard({assignmentRecords:n,eventRecords:s},r),i.trigger("copy",{assignmentRecords:n,eventRecords:s,isCut:r,entityName:t.entityName}),i.refreshWithTransition(),t._focusedEventOnCopy=t._eventClickedContext)}async beforeCopy({data:{assignmentRecords:e,eventRecords:r},isCut:t}){return await this.scheduler.trigger("beforeCopy",{assignmentRecords:e,eventRecords:r,isCut:t,entityName:this.entityName})}handleCutData({source:e}){var r;const t=this;if(e!==t&&((r=t.cutData)!=null&&r.length)){const{assignmentRecords:i,eventRecords:n}=t.cutData[0];i!=null&&i.length&&t.scheduler.assignmentStore.remove(i),n!=null&&n.length&&t.scheduler.eventStore.remove(n)}}stringConverter({eventRecords:e}){const r=[];for(const t of e)r.push(this.eventToStringFields.map(i=>{const n=t[i];return n instanceof Date?b.format(n,this.dateFormat):n}).join("	"));return r.join(`
`)}setIsCut({assignmentRecords:e},r){e.forEach(t=>{t.meta.isCut=r}),this.scheduler.refreshWithTransition()}async pasteEvents(e,r){var t;const i=this,{scheduler:n}=i;if(n.splitFrom)return n.splitFrom.features.eventCopyPaste.pasteEvents(e,r);const{entityName:s,isCut:a,_cellClickedContext:o,_eventClickedContext:l}=i,{eventStore:c,assignmentStore:d}=n;arguments.length===0&&(o?(e=o.date,r=o.resourceRecord):i._focusedEventOnCopy!==l&&(e=l.eventRecord.startDate,r=l.resourceRecord)),r&&(r=r.$original);const u=await i.readFromClipboard({resourceRecord:r,date:e});if(!((t=u==null?void 0:u.assignmentRecords)!=null&&t.length))return;const{assignmentRecords:h,eventRecords:g}=u;let f=null;const m=new Set,p=[];for(const y of h){let{event:C}=y;const D=r||y.resource,S=e||y.event.startDate;if(m.has(C)){a&&y.remove();continue}if(m.add(C),a)y.meta.isCut=!1,y.resource=D,f=y;else if(c.usesSingleAssignment||i.copyPasteAction==="clone")C=C.copy(),C.name=i.generateNewName(C),c.add(C),C.assign(D),f=d.last;else if(!C.resources.includes(D)){const x=y.copy();x.resource=D,[f]=d.add(x)}C.startDate=S,C.constraintDate&&(C.constraintDate=null),p.push(C)}n.trigger("paste",{assignmentRecords:h,pastedEventRecords:p,eventRecords:g,resourceRecord:r,date:e,isCut:a,entityName:s});const v=n.ion({renderEvent({assignmentRecord:y}){y===f&&(n.navigateTo(y,{scrollIntoView:!1}),v())}});a&&await i.clearClipboard()}async beforePaste({data:{assignmentRecords:e,eventRecords:r},resourceRecord:t,isCut:i,date:n}){const{scheduler:s}=this,a={assignmentRecords:e,eventRecords:r,resourceRecord:t||e[0].resource,date:n,isCut:i,entityName:this.entityName};let o;return t!=null&&t.readOnly&&(o="resourceReadOnly"),s.allowOverlap||e.some(c=>!s.isDateRangeAvailable(c.event.startDate,c.event.endDate,i?c.event:null,c.resource))&&(o="overlappingEvents"),o?(s.trigger("pasteNotAllowed",{...a,reason:o}),!1):await this.scheduler.trigger("beforePaste",a)}stringParser(e){const{eventStore:r,assignmentStore:t}=this.scheduler,{modifiedRecords:i}=this.setFromStringData(e,!0,r,this.eventToStringFields),n=[];for(const s of i){const a=new t.modelClass({eventId:s.id});a.event=s,n.push(a)}return{eventRecords:i,assignmentRecords:n}}populateEventMenu({assignmentRecord:e,items:r}){const t=this,{scheduler:i}=t;i.readOnly||(r.copyEvent={text:"L{copyEvent}",localeClass:t,icon:"b-icon b-icon-copy",weight:110,onItem:()=>{const n=i.isAssignmentSelected(e)?i.selectedAssignments:[e];t.copyEvents(n)}},r.cutEvent={text:"L{cutEvent}",localeClass:t,icon:"b-icon b-icon-cut",weight:120,disabled:e.event.readOnly,onItem:()=>{const n=i.isAssignmentSelected(e)?i.selectedAssignments:[e];t.copyEvents(n,!0)}})}populateScheduleMenu({items:e,resourceRecord:r}){const t=this,{scheduler:i}=t;!i.readOnly&&t.hasClipboardData()!==!1&&(e.pasteEvent={text:"L{pasteEvent}",localeClass:t,icon:"b-icon b-icon-paste",disabled:i.resourceStore.count===0||r.readOnly,weight:110,onItem:({date:n,resourceRecord:s})=>t.pasteEvents(n,s,i.getRowFor(s))})}generateNewName(e){const r=e.getValue(this.nameField);let t=2;for(;this.client.eventStore.findRecord(this.nameField,`${r} - ${t}`);)t++;return`${r} - ${t}`}};E(cs,"$name","EventCopyPaste"),E(cs,"pluginConfig",{assign:["copyEvents","pasteEvents"],chain:["populateEventMenu","populateScheduleMenu","onEventDataGenerated"]}),E(cs,"configurable",{nameField:"name",copyPasteAction:"clone",eventToStringFields:["name","startDate","endDate","duration","durationUnit","allDay"]}),cs.featureClass="b-event-copypaste",cs._$name="EventCopyPaste",j.registerFeature(cs,!0,"Scheduler");var vc=class extends ch{static get $name(){return"EventDrag"}static get configurable(){return{constrainDragToResource:!1,constrainDragToTimeSlot:!1,externalDropTargetSelector:null,validatorFn:(e,r)=>{},validatorFnThisObj:null,unifiedDrag:null,snapToPosition:null,copyKey:"SHIFT",copyMode:"auto",mode:"move",capitalizedEventName:null}}afterConstruct(){this.capitalizedEventName=this.capitalizedEventName||this.client.capitalizedEventName,super.afterConstruct(...arguments)}changeMode(e){const{dragData:r,copyMode:t}=this;if((t==="event"||t==="auto"||t==="assignment"&&!this.scheduler.eventStore.usesSingleAssignment)&&(!r||r.eventRecords.every(i=>!i.isRecurring)))return e}updateMode(e){this.dragData&&(e==="copy"?this.setCopying():this.setMoving(),this.client.trigger("eventDragModeChange",{mode:e}))}setCopying(){const{dragData:e}=this;e&&(e.eventBarCopies.some(r=>r.isConnected)?e.eventBarCopies.forEach(r=>{r.classList.remove("b-hidden")}):e.eventBarCopies.forEach(r=>{r.classList.add("b-drag-proxy-copy"),r.classList.remove("b-hidden"),e.context.grabbedParent.appendChild(r),r.retainElement=!0}))}setMoving(){const{dragData:e}=this;e&&e.eventBarCopies.forEach(r=>{r.classList.add("b-hidden")})}get scheduler(){return this.client}onAfterDragStart(e){const r=this,{context:{element:t}}=e;super.onAfterDragStart(e),r.handleKeyDownOrMove(e.event),r.keyEventDetacher=B.on({element:w.getRootElement(t),keydown:r.handleKeyDownOrMove,keyup:r.handleKeyUp,thisObj:r})}onDragReset(e){var r;super.onDragReset(e),(r=this.keyEventDetacher)==null||r.call(this),this.mode="move"}onDrop(e){var r;return(r=this.dragData.eventBarCopies)==null||r.forEach(t=>t.remove()),super.onDrop(e)}getDraggableElement(e){return e==null?void 0:e.closest(this.drag.targetSelector)}resolveEventRecord(e,r=this.client){return r.resolveEventRecord(e)}isElementDraggable(e,r){var t;const i=this,{client:n}=i,s=i.getDraggableElement(e);if(!s||i.disabled||n.readOnly||e.matches('[class$="-handle"]'))return!1;const a=i.resolveEventRecord(s,n);return!a||!a.isDraggable||a.readOnly?!1:!(((t=n[`is${i.capitalizedEventName}ElementDraggable`])==null?void 0:t.call(n,s,a,e,r))===!1)}getTriggerParams(e){const{assignmentRecords:r,eventRecords:t,resourceRecord:i,browserEvent:n}=e;return{context:e,eventRecords:t,resourceRecord:i,assignmentRecords:r,event:n,domEvent:n}}triggerBeforeEventDrag(e,r){return this.client.trigger(e,r)}triggerEventDrag(e,r){this.client.trigger("eventDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate,newResource:e.newResource}))}triggerDragStart(e){this.client.navigator.skipNextClick=!0,this.client.trigger("eventDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.client.trigger("eventDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.client.trigger("eventDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,r){const t=this;if(t.currentOverClient.trigger("afterEventDrop",Object.assign(t.getTriggerParams(e),{valid:r})),!r){const{assignmentStore:i,eventStore:n}=t.client;t.dragData.initialAssignmentsState.find(({resource:a,assignment:o},l)=>{var c;return!i.includes(o)||!n.includes(o.event)||a.id!==((c=t.dragData.assignmentRecords[l])==null?void 0:c.resourceId)})&&t.client.refresh()}t.client.setTimeout(()=>t.client.navigator.skipNextClick=!1,10)}handleKeyDownOrMove(e){var r,t;this.mode!=="copy"&&(e.key&&B.specialKeyFromEventKey(e.key)===((r=this.copyKey)==null?void 0:r.toLowerCase())||e[`${(t=this.copyKey)==null?void 0:t.toLowerCase()}Key`])&&(this.mode="copy")}handleKeyUp(e){B.specialKeyFromEventKey(e.key)===this.copyKey.toLowerCase()&&(this.mode="move")}isValidDrop(e){const{newResource:r,resourceRecord:t,browserEvent:i}=e,n=e.draggedEntities[0],{target:s}=i;return r?r.isSpecialRow||r.readOnly?!1:t!==r?!n.event.resources.includes(r):!0:!this.constrainDragToTimeline&&this.externalDropTargetSelector?!!s.closest(this.externalDropTargetSelector):!1}checkDragValidity(e,r){var t,i,n;const s=this,a=s.currentOverClient;let o;return(t=e.newResource)!=null&&t.readOnly?!1:(!a.allowOverlap&&!a.isDateRangeAvailable(e.startDate,e.endDate,e.draggedEntities[0],e.newResource)?o={valid:!1,message:s.L("L{eventOverlapsExisting}")}:o=s.validatorFn.call(s.validatorFnThisObj||s,e,r),(!o||o.valid)&&(o=(n=(i=a.checkEventDragValidity)==null?void 0:i.call(a,e,r))!=null?n:o),o)}async updateRecords(e){const r=this,t=r.client,i=r.currentOverClient,n=r.mode==="copy",{draggedEntities:s,timeDiff:a,initialAssignmentsState:o}=e,l=o[0].startDate,c=r.adjustStartDate(l,a);let d;return e.externalDropTarget||(i.timeAxis.timeSpanInAxis(c,b.add(c,s[0].event.durationMS,"ms"))||(e.valid=!1),e.valid&&(t.eventStore.suspendAutoCommit(),i.eventStore.suspendAutoCommit(),d=await r.updateAssignments(t,i,e,n),t.eventStore.resumeAutoCommit(),i.eventStore.resumeAutoCommit())),e.valid&&i.trigger("eventDrop",Object.assign(r.getTriggerParams(e),{isCopy:n,copyMode:r.copyMode,domEvent:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),d}async updateAssignments(e,r,t,i){const n=this,{copyMode:s}=n,a=e!==r,{isVertical:o}=r,{assignmentStore:l,eventStore:c}=e,{assignmentStore:d,eventStore:u}=r,h=e.isVertical?e.resourceStore:e.store,g=o?r.resourceStore:r.store,{eventRecords:f,assignmentRecords:m,timeDiff:p,initialAssignmentsState:v,resourceRecord:y,newResource:C}=t,{unifiedDrag:D}=n,S=u.usesSingleAssignment||u.usesSingleAssignment!==!1&&c.usesSingleAssignment,x=s==="event"?"event":s==="assignment"?"assignment":S?"event":"assignment",R=n.adjustStartDate(m[0].event.startDate,p),I=[],M=[],P=[],_=[],A=[],z=new Set,Y=h.getAllDataRecords();e.suspendRefresh(),r.suspendRefresh();let V=!1,U=!1,K;a?K=g.indexOf(C)-h.indexOf(y):n.constainDragToResource?K=0:o&&g.isGrouped?K=Y.indexOf(y)-Y.indexOf(C):K=h.indexOf(y)-h.indexOf(C),o&&f.forEach((te,Ie)=>{const se=t.eventBarEls[Ie];delete te.instanceMeta(e).hasTemporaryDragElement,se.dataset.transient&&se.remove()});const le=t.eventBarEls.slice(),Ce=[],Me={};for(let te=0;te<m.length;te++){const Ie=m[te];let se=Ie.event,he;if(i?(he=Ie.copy(),Me[Ie.id]=he):he=Ie,!he.isOccurrenceAssignment&&(!l.includes(Ie)||!c.includes(se))){le[te].remove(),le.splice(te,1),m.splice(te,1),te--;continue}const Pr=v[te],Rt=se,Go=Pr.startDate,Kr=Pr.resource,$C=this.constrainDragToTimeSlot?Go:D?R:n.adjustStartDate(Go,p);if(l!==d){const Ot=Rt.assignments.length>1||i;let Dt;i?Dt=he:(Dt=he.copy(),Me[he.id]=Dt),Dt.event&&!S&&(Dt.event=Dt.event.id,Dt.resource=Dt.resource.id),i||_.push(he),Ot||M.push(Rt),(i&&(s==="event"||s==="auto"&&u.usesSingleAssignment)||!u.getById(Rt.id))&&(se=u.createRecord({...Rt.data,id:i&&(s==="event"||s==="auto")?void 0:Rt.id,calendar:null}),Dt.set({eventId:se.id,event:se}),I.push(se)),S||P.push(Dt),he=Dt}let qe=C,jC=null;if(!D)if(a){if(te>0){const Ot=h.indexOf(Kr);qe=g.getAt(Ot+K)||qe}}else if(K!==0){let Ot;o&&g.isGrouped?(Ot=Math.max(Math.min(Y.indexOf(Kr)-K,Y.length-1),0),qe=Y[Ot]):(Ot=Math.max(Math.min(h.indexOf(Kr)-K,h.count-1),0),qe=h.getAt(Ot),qe.isSpecialRow&&(qe=h.getNext(qe,!1,!0)||h.getPrevious(qe,!1,!0))),qe=qe==null?void 0:qe.$original}else qe=Kr;const BC=he.resourceId!==qe.id;if(BC){if(jC=h.getById(he.resourceId),i&&l===d){he.setData({resource:null,resourceId:null}),he.resource=qe,he.event=u.getById(he.eventId);const Ot=s==="event"||c.usesSingleAssignment&&s==="auto";Ot&&(se=se.copy(),se.meta.endDateCached=n.adjustStartDate(se.endDate,p),se.endDate=null,he.event=se,u.usesSingleAssignment&&(se.resource=qe,se.resourceId=qe.id)),!d.find(Dt=>Dt.eventId===he.eventId&&Dt.resourceId===he.resourceId)&&!P.find(Dt=>Dt.eventId===he.eventId&&Dt.resourceId===he.resourceId)&&(Ot&&I.push(se),P.push(he))}else he.resource=qe;se.isEvent&&z.add(se),V=!0,se.isOccurrence&&se.set("newResource",qe),a&&S&&(se.resourceId=qe.id)}else i&&(s==="event"||s==="auto"&&c.usesSingleAssignment)&&!I.includes(se)&&(se=se.copy(),se.meta.endDateCached=n.adjustStartDate(se.endDate,p),se.endDate=null,I.push(se),he.event=se,u.usesSingleAssignment&&se.set({resource:qe,resourceId:qe.id}),P.push(he));if(!A.find(Ot=>Ot.draggedEvent===se)&&!b.isEqual(se.startDate,$C)){for(;!se.isOccurrence&&se.isBatchUpdating;)se.endBatch(!0);i&&!a&&!S&&x==="assignment"&&BC||(se.startDate=$C,A.push({draggedEvent:se,originalStartDate:Go})),se.isEvent&&z.add(se),U=!0}r.processEventDrop({eventRecord:se,resourceRecord:qe,element:te===0?t.context.element:t.context.relatedElements[te-1],context:t,toScheduler:r,reassignedFrom:jC,eventsToAdd:I,addedEvents:Ce,draggedAssignment:he}),r.trigger("processEventDrop",{originalAssignment:Ie,draggedAssignment:he,context:t,copyMode:s,isCopy:i})}if(l.remove(_),c.remove(M),d.add(P),i&&l===d){const{syncIdMap:te}=e.foregroundCanvas;Object.entries(Me).forEach(([Ie,se])=>{const he=te[Ie];delete te[Ie],te[se.id]=he})}if(I.length&&Ce.push(...u.add(I)),!n.constrainDragToTimeline)for(let te=0;te<m.length;te++){const Ie=Me[m[te].id]||m[te],se=Ie.event,he=(Ce==null?void 0:Ce.find(Kr=>Kr.id===se.id))||se,Pr=t.eventBarEls[te],Rt=te===0?t.context.element:t.context.relatedElements[te-1],Go=r.isInTimeAxis(he);if(delete he.meta.endDateCached,i||X.removeChild(Pr.parentElement,Pr),he.resource&&(o||r.rowManager.getRowFor(he.resource))&&Go){if(!he.parent||he.parent.isRoot){const Kr=k.from(Rt,r.foregroundCanvas,!0);w.setTopLeft(Rt,Kr.y,Kr.x),X.addChild(r.foregroundCanvas,Rt,he.assignments[0].id),a&&r.processCrossSchedulerEventDrop({eventRecord:he,toScheduler:r})}Rt.classList.remove("b-sch-event-hover","b-active","b-drag-proxy","b-dragging"),Rt.retainElement=!1}}Ce==null||Ce.forEach(te=>z.add(te)),(_.length||M.length||P.length||I.length)&&(V=!0),(V||U)&&(S&&z.forEach(te=>te.beginBatch()),await Promise.all([r.project!==e.project?r.project.commitAsync():null,e.project.commitAsync()]),S&&z.forEach(te=>te.endBatch(!1,!0))),V||(V=A.some(({draggedEvent:te,originalStartDate:Ie})=>!b.isEqual(te.startDate,Ie))),r.resumeRefresh(),e.resumeRefresh(),m.length>0&&(V?(le.forEach(te=>delete te.lastDomConfig),r.refreshWithTransition(),a&&(e.refreshWithTransition(),r.selectedEvents=Ce)):t.valid=!1)}getProductDragContext(e){const r=this,{currentOverClient:t}=r,i=e.browserEvent.target,n=e.newResource||e.resourceRecord,s=e.targetEventRecord;let a=t?r.resolveEventRecord(i,t):null,o,l;e.eventRecords.includes(a)&&(a=null),r.constrainDragToResource?o=e.resourceRecord:r.constrainDragToTimeline?t&&(o=r.resolveResource()||e.newResource||e.resourceRecord):o=r.resolveResource();const{assignmentRecords:c,eventRecords:d}=e,u=n!==o;let h=!!(o&&!o.isSpecialRow);return!o&&r.externalDropTargetSelector&&(l=i.closest(r.externalDropTargetSelector),h=!!l),{valid:h,externalDropTarget:l,eventRecords:d,assignmentRecords:c,newResource:o,targetEventRecord:a,dirty:u||a!==s,proxyElements:[e.context.element,...e.context.relatedElements||[]]}}getMinimalDragData(e){const r=this,{scheduler:t}=r,i=r.getElementFromContext(e),n=r.resolveEventRecord(i,t),s=t.resolveResourceRecord(i),a=t.resolveAssignmentRecord(i),o=a?[a]:[];a&&(t.isAssignmentSelected(o[0])||r.drag.startEvent.ctrlKey&&t.multiEventSelect)&&o.push.apply(o,r.getRelatedRecords(a));const l=[...new Set(o.map(c=>c.event))];return{eventRecord:n,resourceRecord:s,assignmentRecord:a,eventRecords:l,assignmentRecords:o}}setupProductDragData(e){var r;const t=this,{scheduler:i}=t,n=t.getElementFromContext(e),{eventRecord:s,resourceRecord:a,assignmentRecord:o,assignmentRecords:l}=t.getMinimalDragData(e),c=[];if(t.constrainDragToResource&&!a)throw new Error("Resource could not be resolved for event: "+s.id);let d;if(t.constrainDragToTimeline){d=(r=t.getDateConstraints)==null?void 0:r.call(t,a,s);const u=t.constrainRectangle=t.getConstrainingRectangle(d,a,s),h=k.from(n,i.timeAxisSubGridElement);super.setupConstraints(u,h,i.timeAxisViewModel.snapPixelAmount,!!d.start)}return l.forEach(u=>{let h=i.getElementFromAssignmentRecord(u,!0);h||(h=i.currentOrientation.addTemporaryDragElement(u.event,u.resource)),c.push(h)}),{record:o,draggedEntities:l,dateConstraints:d!=null&&d.start?d:null,eventBarCopies:c.map(u=>t.createProxy(u)),eventBarEls:c}}getDateConstraints(e,r){var t;const{scheduler:i}=this,n=(t=i.getDateConstraints)==null?void 0:t.call(i,e,r);let s,a;return this.constrainDragToTimeSlot?(s=r.startDate,a=r.endDate):n&&(s=n.start,a=n.end),{start:s,end:a}}getConstrainingRectangle(e,r,t){return this.scheduler.getScheduleRegion(this.constrainDragToResource&&r,t,!0,e&&{start:e.start,end:e.end})}getDragData(e){const r=this.getMinimalDragData(e)||{};return{...super.getDragData(e),...r,initialAssignmentsState:r.assignmentRecords.map(t=>({startDate:t.event.startDate,resource:t.resource,assignment:t}))}}getRelatedRecords(e){return this.scheduler.selectedAssignments.filter(r=>r!==e&&!r.resource.readOnly&&r.event.isDraggable)}getCoordinate(e,r,t){const i=this.currentOverClient;if(i.isHorizontal){let n=t[0];if(i.milestoneLayoutMode!=="default"&&e.isMilestone)switch(i.milestoneAlign){case"center":n+=r.offsetWidth/2;break;case"end":n+=r.offsetWidth;break}return n}else{let n=t[1];if(i.milestoneLayoutMode!=="default"&&e.isMilestone)switch(i.milestoneAlign){case"center":n+=r.offsetHeight/2;break;case"end":n+=r.offsetHeight;break}return n}}resolveResource(){const e=this,r=e.currentOverClient,{isHorizontal:t}=r,{context:i,browserEvent:n,dragProxy:s}=e.dragData,a=s||i.element,o=k.from(a,null,!0),l=r.isVertical||e.unifiedDrag?i.clientY:o.center.y,c=k.from(a,r.timeAxisSubGridElement,!0),{x:d,y:u}=c.center,h=e.getMouseMoveEventTarget(n);let g=null;if(r.element.contains(h))if(t){const f=r.rowManager.getRowAt(l);g=f&&r.store.getAt(f.dataIndex)}else g=r.resolveResourceRecord(r.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[d,u]);return g}adjustStartDate(e,r){const t=this.currentOverClient;return e=t.timeAxis.roundDate(new Date(e-0+r),t.snapRelativeToEventStartDate?e:!1),this.constrainStartDate(e)}getRecordElement(e){return this.client.getElementFromAssignmentRecord(e,!0)}getProxyElement(e){if(this.isDragging){const r=this.dragData.assignmentRecords.indexOf(e);if(r>=0)return this.dragData.proxyElements[r]}return null}getMouseMoveEventTarget(e){return e.target}};vc._$name="EventDrag",j.registerFeature(vc,!0,"Scheduler"),j.registerFeature(vc,!1,"ResourceHistogram");var Ja=class extends Ka{get scheduler(){return this.client}get store(){return this.client.eventStore}get project(){return this.client.project}updateLockLayout(e){this.dragActiveCls=`b-dragcreating${e?" b-dragcreate-lock":""}`}handleBeforeDragCreate(e,r,t){var i;const{resourceRecord:n}=e;if(n.readOnly||!this.scheduler.resourceStore.isAvailable(n))return!1;const{scheduler:s}=this,a=!s.isSchedulerPro||r.ignoreResourceCalendar||n.isWorkingTime(e.mousedownDate),o=a&&s.trigger("beforeDragCreate",{resourceRecord:n,date:e.mousedownDate,event:t});return this.dateConstraints=(i=s.getDateConstraints)==null?void 0:i.call(s,n,r),o}dragStart(e){var r;const t=this,{client:i}=t,{eventStore:n,assignmentStore:s,enableEventAnimations:a,enableTransactionalFeatures:o}=i,{resourceRecord:l}=e,c=t.createEventRecord(e),d=[l];if(c.set("duration",b.diff(c.startDate,c.endDate,c.durationUnit,!0)),c.isCreating=!0,c.meta.isDragCreating=!0,i.features.taskEdit&&i.features.taskEdit.doCancel(),t.handleBeforeDragCreate(e,c,e.event)===!1)return!1;t.captureStm(!0);let u=[];return l&&(n.usesSingleAssignment||!o?u=s.assignEventToResource(c,l):u=[s.createRecord({event:c,resource:l})]),i.trigger("beforeEventAdd",{eventRecord:c,resourceRecords:d,assignmentRecords:u})===!1?((n.usesSingleAssignment||!o)&&s.remove(u),!1):(t.lockLayout&&(c.meta.excludeFromLayout=!0),(r=i.onEventCreated)==null||r.call(i,c),i.enableEventAnimations=!1,n.addAsync(c).then(()=>i.enableEventAnimations=a),!n.usesSingleAssignment&&o&&s.add(u[0]),i.isCreating=!0,i.refreshRows(),i.isCreating=!1,e.itemElement=e.element=i.getElementFromEventRecord(c),w.isInView(e.itemElement)||i.scrollable.scrollIntoView(e.itemElement,{animate:!0,edgeOffset:i.barMargin}),super.dragStart(e))}checkValidity(e,r){const t=this,{client:i}=t;return e.resourceRecord=t.dragging.resourceRecord,(i.allowOverlap||i.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&t.createValidatorFn.call(t.validatorFnThisObj||t,e,r)}isRowEmpty(e){const r=this.store.getEventsForResource(e);return!r||!r.length}triggerBeforeFinalize(e){this.client.trigger("beforeDragCreateFinalize",e)}createEventRecord(e){const r=this,{client:t}=r,i=t.isHorizontal?"X":"Y",{timeAxis:n,eventStore:s,weekStartDay:a}=t,{event:o,mousedownDate:l}=e,c=r.draggingEnd=o[`page${i}`]>e.startEvent[`page${i}`],d={name:s.modelClass.fieldMap.name.defaultValue||r.L("L{Object.newEvent}"),startDate:c?b.floor(l,n.resolution,null,a):l,endDate:c?l:b.ceil(l,n.resolution,null,a)};return t.project.isGanttProjectMixin&&T.assign(d,{constraintDate:d.startDate,constraintType:"startnoearlierthan"}),s.createRecord(d)}async internalUpdateRecord(e,r){await super.internalUpdateRecord(e,r),this.client.hasEventEditor||(e.eventRecord.isCreating=!1)}async finalizeDragCreate(e){const{meta:r}=e.eventRecord;r.excludeFromLayout=!1,r.isDragCreating=!1;const t=await super.finalizeDragCreate(e);return t?this.hasStmCapture=!1:await this.freeStm(!0),t}async cancelDragCreate(e){await super.cancelDragCreate(e),await this.freeStm(!1)}getTipHtml(...e){const r=super.getTipHtml(...e),{element:t}=this.tip;return t.classList.add("b-sch-dragcreate-tooltip"),t.classList.toggle("b-too-narrow",this.dragging.context.tooNarrow),r}onAborted(e){var r,t;const{eventRecord:i,resourceRecord:n}=e;(t=(r=this.store).unassignEventFromResource)==null||t.call(r,i,n),this.store.remove(i)}};E(Ja,"$name","EventDragCreate"),E(Ja,"configurable",{validatorFn:()=>!0,lockLayout:!1}),Ja._$name="EventDragCreate",j.registerFeature(Ja,!0,"Scheduler"),j.registerFeature(Ja,!1,"ResourceHistogram");var yc=class extends fe(Q){constructor(){super(...arguments),E(this,"targetSelector",".b-sch-timeaxis-cell, .b-timeaxissubgrid")}construct(e,r){e.multiEventSelect=!0,super.construct(e,r)}onElementMouseDown(e){const r=this,{client:t}=r,{foregroundCanvas:i}=t,{target:n,button:s,touches:a,clientX:o,clientY:l}=e,c=k.from(i,!0);a||s!==0||r.disabled||!n.matches(r.targetSelector)||t.trigger("beforeEventDragSelect",{event:e})===!1||(t.preventDragSelect=!0,r.startX=o-c.x,r.startY=l-c.y,r.element=w.createElement({tag:"div",className:"b-dragselect-rect",parent:t.foregroundCanvas,retainElement:!0,style:{transform:`translate(${r.startX}px, ${r.startY}px)`}}),t.element.classList.add("b-dragselecting"),!e.ctrlKey&&!e.metaKey&&t.clearEventSelection(),r.originalSelection=t.selectedAssignments.slice(),r.subGridElementRect=k.from(t.timeAxisSubGridElement,!0),t.navigator.disabled=!0,t.enableScrollingCloseToEdges(t.timeAxisSubGrid),r.mouseUpDetacher=B.on({element:document,mouseup:"onDocumentMouseUp",thisObj:r}))}get eventRectangles(){const{client:e}=this;return Array.from(e.foregroundCanvas.children).filter(t=>t.matches(`${e.eventSelector}, .b-nested-events-container`)).map(t=>{const i=e.resolveAssignmentRecord(t);return{rectangle:k.from(t,!0),record:i,selected:e.selectedAssignments.includes(i)}})}onElementMouseMove(e){const r=this;if(typeof r.startX=="number"){const t=r.rectangle=k.from(r.client.foregroundCanvas,!0),i=Math.min(Math.max(e.clientX-t.x,0),t.width+1),n=Math.min(Math.max(e.clientY-t.y,0),t.height+1),s=new k(r.startX,r.startY,i-r.startX,n-r.startY);w.setTranslateXY(r.element,s.x,s.y),r.element.style.width=`${s.width}px`,r.element.style.height=`${s.height}px`,r.updateSelection()}}onDocumentMouseUp(e){var r,t;const i=this,{client:n}=i,{selectedAssignments:s,navigator:a}=n;n.disableScrollingCloseToEdges(n.timeAxisSubGrid),(r=i.element)==null||r.remove(),n.element.classList.remove("b-dragselecting"),i.startX=i.startY=null,a.skipNextClick=n.timeAxisSubGridElement.contains(e.target),a.disabled=!1,s.length&&(a.skipScrollIntoView=!0,n.activeAssignment=s[s.length-1],(t=a.activeItem)==null||t.focus(),a.skipScrollIntoView=!1),i.mouseUpDetacher()}updateSelection(){const e=this,r=e.rectangle=k.from(e.element,!0),{eventRectangles:t,client:i}=e,n=i.selectedAssignments.reduce((s,a)=>(i.getElementFromAssignmentRecord(a)||s.push(a),s),[]);for(const s of t)r.intersect(s.rectangle,!0)&&(s.selected=!0,n.push(s.record));n.push(...e.originalSelection),i.selectedAssignments=n}};E(yc,"$name","EventDragSelect"),E(yc,"pluginConfig",{chain:["onElementMouseDown","onElementMouseMove"]}),yc._$name="EventDragSelect",j.registerFeature(yc,!1,"Scheduler");var kv=class extends ht{static get type(){return"eventeditor"}static get $name(){return"EventEditor"}static get configurable(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",scrollable:{overflowY:!0},readOnly:null,titleRenderer:null,maximizeOnMobile:!0}}updateLocalization(){super.updateLocalization(...arguments),this.initialTitle=this.title||""}chainResourceStore(){return this.eventEditFeature.resourceStore.chain(e=>!e.isSpecialRow,null,{storeClass:re,excludeCollapsedRecords:!1})}processWidgetConfig(e){var r;if((r=e.type)!=null&&r.includes("date")&&e.weekStartDay==null&&(e.weekStartDay=this.weekStartDay),e.type==="extraItems")return!1;const{eventEditFeature:t}=this,i={};if(e.ref==="resourceField"){const{store:n}=e;e.store=this.chainResourceStore(),n&&e.store.setConfig(n),"multiSelect"in e||(e.multiSelect=!t.eventStore.usesSingleAssignment)}return(e.name==="startDate"||e.name==="endDate")&&e.type==="date"&&(i.format=t.dateFormat),(e.name==="startDate"||e.name==="endDate")&&e.type==="time"&&(i.format=t.timeFormat),Object.assign(e,i),super.processWidgetConfig(e)}setupEditorButtons(){const{record:e}=this,{deleteButton:r}=this.widgetMap;r&&(r.hidden=this.readOnly||e.isCreating)}onBeforeShow(...e){var r;const t=this,{record:i,titleRenderer:n}=t;t.setupEditorButtons(),n?t.title=t.callback(n,t,[i]):t.title=t.initialTitle,(r=super.onBeforeShow)==null||r.call(this,...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}updateReadOnly(e){const{deleteButton:r,saveButton:t,cancelButton:i}=this.widgetMap;super.updateReadOnly(e),r&&(r.hidden=e),t&&(t.hidden=e),i&&(i.hidden=e)}};kv.initClass(),kv._$name="EventEditor";var ds=class extends Fe{buildItems(){return[...this.addNone?[{text:"L{None}",value:"NONE"}]:[],{value:"DAILY",text:"L{Daily}"},{value:"WEEKLY",text:"L{Weekly}"},{value:"MONTHLY",text:"L{Monthly}"},{value:"YEARLY",text:"L{Yearly}"}]}};E(ds,"$name","RecurrenceFrequencyCombo"),E(ds,"type","recurrencefrequencycombo"),E(ds,"configurable",{editable:!1,displayField:"text",valueField:"value",localizeDisplayFields:!0,addNone:!1}),ds.initClass(),ds._$name="RecurrenceFrequencyCombo";var Fv=class extends ds{static get $name(){return"RecurrenceCombo"}static get type(){return"recurrencecombo"}static get defaultConfig(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}buildItems(){const e=this;return[{value:"none",text:"L{None}"},...super.buildItems(),{value:e.customValue,text:"L{Custom}",cls:e.splitCls}]}set value(e){e=e||"none",super.value=e}get value(){return super.value}set recurrence(e){const r=this;e?r.value=r.isCustomRecurrence(e)?r.customValue:e.frequency:r.value=null}isCustomRecurrence(e){const{interval:r,days:t,monthDays:i,months:n}=e;return!!(r>1||t&&t.length||i&&i.length||n&&n.length)}};Fv.initClass(),Fv._$name="RecurrenceCombo";var Ov=class extends bl{static get $name(){return"RecurrenceLegendButton"}static get type(){return"recurrencelegendbutton"}static get defaultConfig(){return{localizableProperties:[],recurrence:null}}set recurrence(e){this._recurrence=e,this.updateLegend()}get recurrence(){return this._recurrence}set eventStartDate(e){this._eventStartDate=e,this.updateLegend()}get eventStartDate(){return this._eventStartDate}updateLegend(){const{recurrence:e}=this;this.text=e?Tv.getLegend(e,this.eventStartDate):""}onLocaleChange(){this.updateLegend()}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}};Ov.initClass(),Ov._$name="RecurrenceLegendButton";var Lv=class extends Fe{static get $name(){return"RecurrenceDaysCombo"}static get type(){return"recurrencedayscombo"}static get defaultConfig(){const e=["SU","MO","TU","WE","TH","FR","SA"],r=e.join(",");return{allDaysValue:r,editable:!1,defaultValue:r,workingDaysValue:e.filter((t,i)=>!b.nonWorkingDays[i]).join(","),nonWorkingDaysValue:e.filter((t,i)=>b.nonWorkingDays[i]).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildItems(){const e=this;return e._weekDays=null,e.weekDays.concat([{value:e.allDaysValue,text:e.L("L{day}"),cls:e.splitCls},{value:e.workingDaysValue,text:e.L("L{weekday}")},{value:e.nonWorkingDaysValue,text:e.L("L{weekend day}")}])}get weekDays(){const e=this;if(!e._weekDays){const r=b.weekStartDay,t=b.getDayNames().map((i,n)=>({text:i,value:Gt.encodeDay(n)}));e._weekDays=t.slice(r).concat(t.slice(0,r))}return e._weekDays}set value(e){const r=this;e&&Array.isArray(e)&&(e=e.join(",")),(!e||!r.store.findRecord("value",e))&&(e=r.defaultValue),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}};Lv.initClass(),Lv._$name="RecurrenceDaysCombo";var $v=class extends ai{static get $name(){return"RecurrenceDaysButtonGroup"}static get type(){return"recurrencedaysbuttongroup"}static get defaultConfig(){return{defaults:{cls:"b-raised",toggleable:!0}}}construct(e={}){const r=this;e.columns=7,e.items=r.buildItems(),super.construct(e)}updateItemText(e){const r=Gt.decodeDay(e.value)[0];e.text=b.getDayName(r).substring(0,3)}buildItems(){const e=this;if(!e.__items){const r=b.weekStartDay,t=b.getDayNames().map((i,n)=>({text:i.substring(0,3),value:Gt.encodeDay(n)}));e.__items=t.slice(r).concat(t.slice(0,r))}return e.__items}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}};$v.initClass(),$v._$name="RecurrenceDaysButtonGroup";var jv=class extends ai{static get $name(){return"RecurrenceMonthDaysButtonGroup"}static get type(){return"recurrencemonthdaysbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}get minValue(){return 1}get maxValue(){return 31}construct(e={}){const r=this;e.columns=7,e.items=r.buildItems(),super.construct(e)}buildItems(){const e=this,r=[];for(let t=e.minValue;t<=e.maxValue;t++)r.push({text:t+"",value:t});return r}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}};jv.initClass(),jv._$name="RecurrenceMonthDaysButtonGroup";var Bv=class extends ai{static get $name(){return"RecurrenceMonthsButtonGroup"}static get type(){return"recurrencemonthsbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}construct(e={}){const r=this;e.columns=4,e.items=r.buildItems(),super.construct(e)}buildItems(){return b.getMonthNames().map((e,r)=>({text:e.substring(0,3),value:r+1}))}updateItemText(e){e.text=b.getMonthName(e.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}};Bv.initClass(),Bv._$name="RecurrenceMonthsButtonGroup";var Hv=class extends Fe{static get $name(){return"RecurrenceStopConditionCombo"}static get type(){return"recurrencestopconditioncombo"}static get defaultConfig(){return{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}}buildItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(e){e=e||"never",super.value=e}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(e){let r=null;e.endDate?r="date":e.count&&(r="count"),this._recurrence=e,this.value=r}};Hv.initClass(),Hv._$name="RecurrenceStopConditionCombo";var Vv=class extends Fe{static get $name(){return"RecurrencePositionsCombo"}static get type(){return"recurrencepositionscombo"}static get defaultConfig(){return{editable:!1,splitCls:"b-sch-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildItems(){return this.buildDayNumbers().concat([{value:"-1",text:this.L("L{position-1}"),cls:this.splitCls}])}buildDayNumbers(){return H.populate(this.maxPosition,e=>({value:e+1,text:this.L(`position${e+1}`)}))}set value(e){const r=this;e&&Array.isArray(e)&&(e=e.join(",")),(!e||!r.store.findRecord("value",e))&&(e=r.defaultValue),super.value=e}get value(){const e=super.value;return e?`${e}`.split(",").map(r=>parseInt(r,10)):[]}};Vv.initClass(),Vv._$name="RecurrencePositionsCombo";var Qa=class extends Vt{setupWidgetConfig(e){return q.isMobile&&!("editable"in e)&&(e.editable=!1),super.setupWidgetConfig(...arguments)}updateRecord(e){super.updateRecord(e);const r=this,{frequencyField:t,daysButtonField:i,monthDaysButtonField:n,monthsButtonField:s,monthDaysRadioField:a,positionAndDayRadioField:o,stopRecurrenceField:l}=r.widgetMap;if(e){const c=e.timeSpan,d=c==null?void 0:c.startDate;d&&((!e.days||!e.days.length)&&(i.value=[Gt.encodeDay(d.getDay())]),(!e.monthDays||!e.monthDays.length)&&(n.value=d.getDate()),(!e.months||!e.months.length)&&(s.value=d.getMonth()+1)),e.days&&e.positions?(o.check(),r.isPainted||a.uncheck()):(a.check(),r.isPainted||o.uncheck()),l.recurrence=e}else t.value="NONE"}syncEventRecord(e){const r=this.getValues(t=>t.name in e&&!t.disabled);"endDate"in r||(r.endDate=null),"count"in r||(r.count=null),e.set(r)}toggleStopFields(){const e=this,{countField:r,endDateField:t}=e.widgetMap;switch(e.widgetMap.stopRecurrenceField.value){case"count":r.show(),r.enable(),t.hide(),t.disable();break;case"date":r.hide(),r.disable(),t.show(),t.enable();break;default:r.hide(),t.hide(),r.disable(),t.disable()}}onMonthDaysRadioFieldChange({checked:e}){const{monthDaysButtonField:r}=this.widgetMap;r.disabled=!e||!this.isWidgetAvailableForFrequency(r)}onPositionAndDayRadioFieldChange({checked:e}){const{daysCombo:r,positionsCombo:t}=this.widgetMap;r.disabled=t.disabled=!e||!this.isWidgetAvailableForFrequency(r)}onStopRecurrenceFieldChange(){this.toggleStopFields()}isWidgetAvailableForFrequency(e,r=this.widgetMap.frequencyField.value){return!e.forFrequency||e.forFrequency.includes(r)}onFrequencyFieldChange({value:e,oldValue:r,valid:t}){const i=this,n=i.queryAll(o=>"forFrequency"in o),{intervalField:s,stopRecurrenceField:a}=i.widgetMap;if(t&&e){for(let o=0;o<n.length;o++){const l=n[o];i.isWidgetAvailableForFrequency(l,e)?(l.show(),l.enable()):(l.hide(),l.disable())}s.hidden=a.hidden=e==="NONE",e!=="NONE"&&(s.hint=i.L(`L{RecurrenceEditor.${e}intervalUnit}`)),r==="NONE"&&s.value==null&&(s.value=1),i.toggleFieldsState()}}toggleFieldsState(){const e=this,{widgetMap:r}=e;e.onMonthDaysRadioFieldChange({checked:r.monthDaysRadioField.checked}),e.onPositionAndDayRadioFieldChange({checked:r.positionAndDayRadioField.checked}),e.onStopRecurrenceFieldChange()}updateLocalization(){const{countField:e,intervalField:r,frequencyField:t}=this.widgetMap;e.hint=this.L("L{RecurrenceEditor.time(s)}"),t.value&&t.value!=="NONE"&&(r.hint=this.L(`L{RecurrenceEditor.${t.value}intervalUnit}`)),super.updateLocalization()}};E(Qa,"$name","RecurrenceEditorPanel"),E(Qa,"type","recurrenceeditorpanel"),E(Qa,"configurable",{cls:"b-recurrenceeditor",record:!1,addNone:!1,items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{RecurrenceEditor.Frequency}",weight:10,onChange:"up.onFrequencyFieldChange",addNone:"up.addNone"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{RecurrenceEditor.Every}",min:1,required:!0},daysButtonField:{type:"recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY"},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",forFrequency:"MONTHLY",label:"L{RecurrenceEditor.Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:50,name:"months",forFrequency:"YEARLY"},positionAndDayRadioField:{type:"checkbox",weight:60,toggleGroup:"radio",forFrequency:"MONTHLY|YEARLY",label:"L{RecurrenceEditor.On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY"},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",flex:1},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{RecurrenceEditor.End repeat}",onChange:"up.onStopRecurrenceFieldChange"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" "},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0}}}),Qa.initClass(),Qa._$name="RecurrenceEditorPanel";var Nv=class extends ht{static get $name(){return"RecurrenceEditor"}static get type(){return"recurrenceeditor"}static get configurable(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:470,items:{recurrenceEditorPanel:{type:"recurrenceeditorpanel",title:null}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler",weight:100},saveButton:{color:"b-green",text:"L{Save}",onClick:"up.onSaveClick",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick",weight:300}}},scrollable:{overflowY:!0}}}updateReadOnly(e){super.updateReadOnly(e),this.bbar.hidden=e}get recurrenceEditorPanel(){return this.widgetMap.recurrenceEditorPanel}updateRecord(e){this.recurrenceEditorPanel.record=e}onSaveClick(){const e=this;e.saveHandler?e.saveHandler.call(e.thisObj||e,e,e.record):(e.recurrenceEditorPanel.syncEventRecord(),e.close())}onCancelClick(){const e=this;e.cancelHandler?e.cancelHandler.call(e.thisObj||e,e,e.record):e.close()}};Nv.initClass(),Nv._$name="RecurrenceEditor";var w0=e=>class extends(e||F){static get $name(){return"RecurringEventEdit"}static get configurable(){return{recurringEventsItems:{recurrenceCombo:{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo",weight:700},editRecurrenceButton:{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",color:"b-gray",menuIcon:null,flex:1,weight:800,ignoreParentReadOnly:!0}},showRecurringUI:null}}changeEditorConfig(t){return t.items={...t.items,...this.recurringEventsItems},t=super.changeEditorConfig(t),t}doDestroy(){var t,i;(t=this._recurrenceConfirmation)==null||t.destroy(),(i=this._recurrenceEditor)==null||i.destroy(),super.doDestroy()}onEditorConstructed(t){var i;const n=this;t.ion({hide:n.onRecurringEventEditorHide,thisObj:n}),n.editRecurrenceButton&&(n.editRecurrenceButton.menu=n.recurrenceEditor),(i=n.recurrenceCombo)==null||i.ion({change:n.onRecurrenceComboChange,thisObj:n})}updateReadOnly(t){this._recurrenceEditor&&(this._recurrenceEditor.readOnly=t)}internalShowEditor(){this.toggleRecurringFieldsVisibility(this.client.enableRecurringEvents&&this.showRecurringUI!==!1)}toggleRecurringFieldsVisibility(t=!0){var i,n,s,a;const o=t?"show":"hide";(n=(i=this.editRecurrenceButton)==null?void 0:i[o])==null||n.call(i),(a=(s=this.recurrenceCombo)==null?void 0:s[o])==null||a.call(s)}onRecurringEventEditorHide(){var t,i;(t=this.recurrenceEditor)!=null&&t.isVisible&&this.recurrenceEditor.hide(),(i=this.recurrenceConfirmation)!=null&&i.isVisible&&this.recurrenceConfirmation.hide()}makeRecurrence(t){const i=this.eventRecord,n=i.copy();let s=i.recurrence;return!t&&s?s=s.copy():s=new i.recurrenceModel(t?{rule:t}:{}),s.timeSpan=n,n.setStartDate(this.values.startDate),s.suspendTimeSpanNotifying(),s}onRecurrableEventBeforeSave({eventRecord:t,context:i}){const n=this;n.isEditing&&!t.isCreating&&t.supportsRecurring&&(t.isRecurring||t.isOccurrence)&&(n.recurrenceConfirmation.confirm({actionType:"update",eventRecord:t,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}}),i.async=!0)}set recurrenceConfirmation(t){this._recurrenceConfirmation=t}get recurrenceConfirmation(){const t=this;let i=t._recurrenceConfirmation;return(!i||!i.$$name)&&(i=$.create({type:"recurrenceconfirmation",owner:t.editor,...i}),t._recurrenceConfirmation=i),i}set recurrenceEditor(t){this._recurrenceEditor=t}get recurrenceEditor(){const t=this;let i=t._recurrenceEditor;return(!i||!i.$$name)&&(t._recurrenceEditor=i=$.create({type:"recurrenceeditor",autoShow:!1,centered:!0,modal:!0,minWidth:"auto",constrainTo:globalThis,anchor:!1,rootElement:t.rootElement,saveHandler:t.recurrenceEditorSaveHandler,onBeforeShow:t.onBeforeShowRecurrenceEditor.bind(t),thisObj:t,...i}),i.readOnly=t._readOnly),i}onBeforeShowRecurrenceEditor(){const t=this,{recurrenceEditor:i,eventRecord:n}=t;i&&(n!=null&&n.supportsRecurring)&&(t.recurrence||(t.recurrence=t.makeRecurrence()),t.recurrence.timeSpan.setStartDate(t.values.startDate),i.record=t.recurrence,i.centered=!0)}loadRecurrenceData(t){this.recurrence=t,this.updateRecurrenceFields(t)}updateRecurrenceFields(t){const i=this,{editRecurrenceButton:n}=i;i.recurrenceCombo&&(i.recurrenceCombo.recurrence=t),n&&(n.recurrence=t,n.value=t?t.rule:null,t&&i.client.enableRecurringEvents&&i.showRecurringUI!==!1?n.show():n.hide())}onRecurrenceComboChange({source:t,value:i,userAction:n}){if(n){const s=this,{recurrenceEditor:a}=s;i===t.customValue?(s.recurrenceCombo.recurrence=s.makeRecurrence(),a.centered?a.show():a.show((s.editRecurrenceButton||t).element)):s.loadRecurrenceData(i&&i!=="none"?s.makeRecurrence(`FREQ=${i}`):null)}}recurrenceEditorSaveHandler(t,i){t.recurrenceEditorPanel.syncEventRecord(i),this.updateRecurrenceFields(i),t.close()}onDatesChange(...t){if(super.onDatesChange(...t),!this.loadingRecord&&this.editRecurrenceButton){const{startDate:i}=this.values;i&&(this.editRecurrenceButton.eventStartDate=i)}}internalLoadRecord(t){t!=null&&t.supportsRecurring&&this.loadRecurrenceData(t.recurrence?this.makeRecurrence():null)}updateRecord(t){return t.recurrenceRule&&!this.recurrence&&(t.recurrenceRule=null),super.updateRecord(t)}},zv=class extends Fe{static get $name(){return"ResourceCombo"}static get type(){return"resourcecombo"}static get configurable(){return{showEventColor:!1,displayField:"name",valueField:"id",picker:{cls:"b-resourcecombo-picker",itemIconTpl(e){const{eventColor:r}=e,t=!w.isNamedColor(r),i=r?t?` style="color:${r}"`:"":' style="display:none"';return`<div class="b-icon b-icon-square${!r||t?"":` b-sch-foreground-${r}`}"${i}></div>`}}}}changeShowEventColor(e){return!!e}updateShowEventColor(e){const{_picker:r}=this,t=e?"add":"remove";this.element.classList[t]("b-show-event-color"),r==null||r.element.classList[t]("b-show-event-color")}changePicker(e,r){return e=super.changePicker(e,r),e==null||e.element.classList[this.showEventColor?"add":"remove"]("b-show-event-color"),e}get innerElements(){return[{class:"b-icon b-resource-icon b-icon-square b-hide-display",reference:"resourceIcon"},this.inputElement]}syncInputFieldValue(){var e,r;const t=this,{resourceIcon:i,lastResourceIconCls:n}=t,{classList:s}=i,a=(r=(e=t.selected)==null?void 0:e.eventColor)!=null?r:"";super.syncInputFieldValue(),i.style.color="",n&&s.remove(n),t.lastResourceIconCls=null,a?(w.isNamedColor(a)?(t.lastResourceIconCls=`b-sch-foreground-${a}`,s.add(t.lastResourceIconCls)):i.style.color=a,s.remove("b-hide-display")):s.add("b-hide-display")}};zv.initClass(),zv._$name="ResourceCombo";var eo=class extends Nn{};E(eo,"$name","EventColorField"),E(eo,"type","eventcolorfield"),E(eo,"configurable",{picker:{type:"eventcolorpicker"},name:"eventColor"}),eo.initClass(),eo._$name="EventColorField";var E0=/[^\w\d]/g,bc=class extends Pv.mixin(pc,w0,fe){static get $name(){return"EventEdit"}static get configurable(){return{triggerEvent:"eventdblclick",typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{type:"eventeditor",title:"L{EventEdit.Edit event}",closable:!0,localeClass:this,defaults:{localeClass:this},items:{nameField:{type:"text",label:"L{Name}",clearable:!0,name:"name",weight:100,required:!0},resourceField:{type:"resourcecombo",label:"L{Resource}",name:"resource",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,destroyStore:!0,weight:200},startDateField:{type:"date",clearable:!1,required:!0,label:"L{Start}",name:"startDate",validateDateOnly:!0,weight:300},startTimeField:{type:"time",clearable:!1,required:!0,name:"startDate",cls:"b-match-label",weight:400},endDateField:{type:"date",clearable:!1,required:!0,label:"L{End}",name:"endDate",validateDateOnly:!0,weight:500},endTimeField:{type:"time",clearable:!1,required:!0,name:"endDate",cls:"b-match-label",weight:600},colorField:{label:"L{SchedulerBase.color}",type:"eventColorField",name:"eventColor",weight:700}},bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{color:"b-blue",cls:"b-raised",text:"L{Save}",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}}},targetEventElement:null}}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey","editEvent"]}}construct(e,r){this.readOnly=e.readOnly,super.construct(e,r),e.ion({projectChange:"onChangeProject",readOnly:"onClientReadOnlyToggle",thisObj:this})}get scheduler(){return this.client}get project(){return this.client.project}get readOnly(){return this._editor?this.editor.readOnly:this._readOnly}updateReadOnly(e){super.updateReadOnly(e),this._editor&&(this.editor.readOnly=e)}onClientReadOnlyToggle({readOnly:e}){this.readOnly=e}get editor(){var e,r,t,i,n;const s=this,a={beforehide:"resetEditingContext",beforeshow:"onBeforeEditorShow",keydown:"onPopupKeyDown",thisObj:s};let{_editor:o}=s;if(o)return o;o=s._editor=$.create(s.getEditorConfig());const{startDateField:l,startTimeField:c,endDateField:d,endTimeField:u}=o.widgetMap;return!l&&c&&(c.keepDate=!0,c.label=s.L("Start"),c.flex="1 0 100%"),!d&&u&&(u.keepDate=!0,u.label=s.L("End"),u.flex="1 0 100%"),!o.floating&&!o.positioned&&(o.element.parentNode||s.client.add(o),delete a.beforehide,delete a.beforeshow,a.beforeToggleReveal="onBeforeEditorToggleReveal"),o.readOnly=s._readOnly,o.items.length===0&&console.warn("Event Editor configured without any `items`"),o.ion(a),s.scheduler.relayEvents(o,["beforeSetRecord"],"eventEdit"),Object.values(o.widgetMap).forEach(h=>{const g=h.ref||h.id;if(g&&!s[g])switch(s[g]=h,h.name){case"startDate":case"endDate":h.ion({change:"onDatesChange",thisObj:s});break}}),(e=s.onEditorConstructed)==null||e.call(s,o),(r=s.eventTypeField)==null||r.ion({change:"onEventTypeChange",thisObj:s}),(t=s.saveButton)==null||t.ion({click:"onSaveClick",thisObj:s}),(i=s.deleteButton)==null||i.ion({click:"onDeleteClick",thisObj:s}),(n=s.cancelButton)==null||n.ion({click:"onCancelClick",thisObj:s}),o}getEditorConfig(){const e=this,{cls:r,scheduler:t}=e,i=T.assign({owner:t,eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:`${t.id}-event-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,cls:r},e.editorConfig);return $.prototype.getRenderContext(i)[0]&&(i.floating=!1),i.floating===!1&&!i.positioned&&(i.collapsible={type:"overlay",direction:"right",autoClose:!1,tool:null,recollapseTool:null},i.collapsed=!0,i.hidden=i.anchor=!1,i.hide=function(){this.collapsible.toggleReveal(!1)}),!t.showEventColorPickers&&i.items.colorField&&(i.items.colorField.hidden=!0),i.onElementCreated=e.updateCSSVars.bind(this),i}updateCSSVars({element:e}){const r=new Date(2e3,12,31,23,55,55),t=b.format(r,this.dateFormat).replace(E0,"").length,i=b.format(r,this.timeFormat).replace(E0,"").length,n=t+i;e.style.setProperty("--date-time-length",`${n}em`),e.style.setProperty("--date-width-difference",`${(t-i)/2}em`)}async internalShowEditor(e,r,t=null){var i,n;const s=this,{scheduler:a}=s,o=((i=t==null?void 0:t.target)==null?void 0:i.nodeType)===Element.ELEMENT_NODE?t.target:a.getElementFromEventRecord(e,r),l=e.isPartOfStore(a.eventStore);if(t=t!=null?t:{target:o,anchor:!0},t.target||!l||e.resources.length===0||e.isCreating){a.element.classList.add("b-eventeditor-editing"),s.resourceRecord=r;const{editor:c}=s;s.editingContext={eventRecord:e,resourceRecord:r,eventElement:o,editor:c,isPartOfStore:l},(n=super.internalShowEditor)==null||n.call(this,e,r,t),s.typeField&&s.toggleEventType(e.getValue(s.typeField)),s.loadRecord(e,r),c.collapsed?(await bn.sleep(100),await c.collapsible.toggleReveal(!0),c.focus()):c.centered||!c.anchor||!c.floating?c.show():o?(s.targetEventElement=o,c.showBy(t)):(c.show(),c.updateCentered(!0));const d=a.timeAxisViewModel.timeResolution;if(d.unit==="hour"||d.unit==="minute"){const u=`${d.increment}${d.unit}`;s.startTimeField&&(s.startTimeField.step=u),s.endTimeField&&(s.endTimeField.step=u)}s.detachListeners("changesWhileEditing"),a.eventStore.ion({change:s.onChangeWhileEditing,refresh:s.onChangeWhileEditing,thisObj:s,name:"changesWhileEditing"})}}onChangeWhileEditing(){const e=this;!e.isFinalizingEventSave&&e.isEditing&&e.editingContext.isPartOfStore&&!e.eventRecord.isPartOfStore(e.scheduler.eventStore)&&e.onCancelClick()}onBeforeEditorShow(){super.onBeforeEditorShow(...arguments),this.scheduler.trigger("beforeEventEditShow",{eventEdit:this,...this.editingContext})}updateTargetEventElement(e,r){e==null||e.classList.add("b-editing"),r==null||r.classList.remove("b-editing")}editEvent(e,r,t=null,i=null){var n;const s=this,{client:a}=s,{simpleEventEdit:o}=a.features;if(s.isEditing&&s.resetEditingContext(),!(s.disabled||e.readOnly||e.isCreating&&(o!=null&&o.enabled)))return a.trigger("beforeEventEdit",{eventEdit:s,eventRecord:e,resourceRecord:r,eventElement:((n=a.getElementFromEventRecord)==null?void 0:n.call(a,e,r))||t})===!1?(a.element.classList.remove("b-eventeditor-editing"),!1):(i?(s.applyStmCapture(i),s.hasStmCapture=!0,i.transferred=!0):i!==!1&&!a.isCalendar&&!s.hasStmCapture&&s.captureStm(!0),s.doEditEvent(...arguments).then(l=>{if(!s.isDestroying&&!s.isEditing&&!a.isCalendar&&!s.rejectingStmTransaction)return l!==!1&&s.hasStmCapture?s.freeStm(!1):s.freeStm()}))}get isEditing(){const{_editor:e}=this;return!!(e!=null&&e.isVisible&&!(e.collapsed&&!e.revealed))}async doEditEvent(e,r,t=null){const i=this,{scheduler:n}=i,s=e.isCreating;return r||(r=e.resource||i.resourceStore.getById(e.resourceId)),s&&St.prototype.normalize.call(e),t||s||e.resources.length===0?i.internalShowEditor(e,r,t?{target:t}:null):n.scrollResourceEventIntoView(r,e,{animate:!0,edgeOffset:0,extendTimeAxis:!1}).then(()=>i.internalShowEditor(e,r),()=>n.element.classList.remove("b-eventeditor-editing"))}loadRecord(e,r){this.loadingRecord=!0,this.internalLoadRecord(e,r),this.loadingRecord=!1}get eventRecord(){var e;return(e=this._editor)==null?void 0:e.record}internalLoadRecord(e,r){var t;const i=this,{eventStore:n}=i.client,{editor:s,resourceField:a}=i;if(i.resourceRecord=r,a&&((t=a.store)==null?void 0:t.masterStore)!==i.resourceStore&&(a.store=s.chainResourceStore()),s.record=e,a){const o=n.assignmentStore.getResourcesForEvent(e);s.assigningValues=!0,!e.isOccurrence&&!n.storage.includes(e,!0)&&r?i.resourceField.value=r.getValue(i.resourceField.valueField):i.assignmentStore&&(i.resourceField.value=o.map(l=>l.getValue(i.resourceField.valueField))),s.assigningValues=!1}super.internalLoadRecord(e,r)}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget(r=>{var t;(t=r.dataset)!=null&&t.eventType&&(r.hidden=r.dataset.eventType!==e)})}async finalizeEventSave(e,r,t,i){const n=this,{scheduler:s,assignmentStore:a}=n,o=!1;a.suspendAutoCommit(),s.suspendRefresh(),n.onBeforeSave(e),e.beginBatch(),n.updateRecord(e),e.endBatch(),e.isOccurrence?r&&e.set("resourceRecords",r):n.resourceField&&a.assignEventToResource(e,r,null,!0),e.isCreating=!1,o||await s.project.commitAsync(),a.resumeAutoCommit(),s.resumeRefresh(!0),o||(s.trigger("afterEventSave",{eventRecord:e}),n.onAfterSave(e)),t(o?!1:e)}save(){return new Promise((e,r)=>{var t;const i=this,{scheduler:n,eventRecord:s}=i;if(!s||!i.editor.isValid){e(!1);return}const{eventStore:a,values:o}=i,l=((t=i.resourceField)==null?void 0:t.records)||(i.resourceRecord?[i.resourceRecord]:[]);if(!i.scheduler.allowOverlap&&a){let{startDate:h,endDate:g}=o;if(g||("duration"in o?g=b.add(h,o.duration,o.durationUnit||s.durationUnit):"fullDuration"in o?g=b.add(h,o.fullDuration):g=s.endDate),l.some(m=>!a.isDateRangeAvailable(h,g,s,m))){e(!1);return}}const c={finalize(h){try{h!==!1?i.finalizeEventSave(s,l,e,r):e(!1)}catch(g){r(g)}}},d=n.trigger("beforeEventSave",{eventRecord:s,resourceRecords:l,values:o,context:c});function u(h,g,f){h===!1?e(!1):(i.onRecurrableEventBeforeSave({eventRecord:g,context:f}),f.async||f.finalize())}T.isPromise(d)?d.then(h=>u(h,s,c)):u(d,s,c)})}deleteEvent(){return this.detachListeners("changesWhileEditing"),new Promise((e,r)=>{const t=this,{eventRecord:i,editor:n}=t;t.scheduler.removeEvents([i],s=>{s&&n.containsFocus&&n.revertFocus(),e(s)},n)})}onChangeProject(){this.resourceField&&(this.resourceField.store={})}get eventStore(){return this.scheduler.project.eventStore}get resourceStore(){return this.scheduler.project.resourceStore}get assignmentStore(){return this.scheduler.project.assignmentStore}onActivateEditor({eventRecord:e,resourceRecord:r,eventElement:t}){this.editEvent(e,r,t)}onDragCreateEnd({eventRecord:e,resourceRecord:r,proxyElement:t,stmCapture:i}){this.editEvent(e,r,t,i)}onEventEnterKey({assignmentRecord:e,eventRecord:r,target:t}){const{client:i}=this,n=t[t.matches(i.eventSelector)?"querySelector":"closest"](i.eventInnerSelector);e?this.editEvent(r,e.resource,n):r&&this.editEvent(r,r.resource,n)}onEventTypeChange({value:e}){this.toggleEventType(e)}populateEventMenu({eventRecord:e,resourceRecord:r,items:t}){!this.scheduler.readOnly&&!this.disabled&&(t.editEvent={text:"L{EventEdit.Edit event}",localeClass:this,icon:"b-icon b-icon-edit",weight:100,disabled:e.readOnly,onItem:()=>{this.editEvent(e,r)}})}onBeforeEditorToggleReveal({reveal:e}){e&&this.editor.setupEditorButtons(),this[e?"onBeforeEditorShow":"resetEditingContext"]()}async resetEditingContext(){const e=this;e.detachListeners("changesWhileEditing"),super.resetEditingContext(),e.hasStmCapture&&!e.isDeletingEvent&&!e.isCancelingEdit&&await e.freeStm(!1),e.resourceRecord=null}finalizeStmCapture(e){return this.freeStm(!e)}updateLocalization(){this._editor&&this.updateCSSVars({element:this._editor.element}),super.updateLocalization(...arguments)}};bc._$name="EventEdit",j.registerFeature(bc,!0,"Scheduler"),j.registerFeature(bc,!1,["SchedulerPro","ResourceHistogram"]),bc.initClass();var Cc=class extends Q{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["populateTimeAxisHeaderMenu"]}}populateTimeAxisHeaderMenu({items:e}){const r=this;e.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:r.disabled,localeClass:r,weight:100,menu:{type:"popup",localeClass:r,items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:r,width:200,internalListeners:{change:r.onEventFilterChange,thisObj:r}}},onBeforeShow({source:t}){const[i]=t.items,n=r.store.filters.getBy("property","name");i.value=(n==null?void 0:n.value)||""}}}}onEventFilterChange({value:e}){e!==""?this.store.filter("name",e):this.store.removeFilter("name")}get store(){const{client:e}=this;return e.isGanttBase?e.store:e.eventStore}};Cc.featureClass="b-event-filter",Cc._$name="EventFilter",j.registerFeature(Cc,!0,["Scheduler","Gantt"]),j.registerFeature(Cc,!1,"ResourceHistogram");var to=class extends dh{static get $name(){return"EventMenu"}static get configurable(){return{processItems:null,type:"event"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateEventMenu"),e}get resourceStore(){return this.client.isHorizontal?this.client.store:this.client.resourceStore}getDataFromEvent(e){var r;const t=super.getDataFromEvent(e),i=t.targetElement,{client:n}=this,s=n.resolveEventRecord(i),a=s&&((r=n.resolveResourceRecord(i)||this.resourceStore.last)==null?void 0:r.$original),o=s&&n.resolveAssignmentRecord(i);return Object.assign(t,{eventElement:i,eventRecord:s,resourceRecord:a,assignmentRecord:o})}getTargetElementFromEvent({target:e}){return e.closest(this.client.eventSelector)||e}shouldShowMenu(e){return e.eventRecord}showContextMenuFor(e,{targetElement:r,event:t}={}){this.disabled||!r&&(r=this.getElementFromRecord(e),!r)||w.triggerMouseEvent(r,this.tiggerEvent)}getElementFromRecord(e){return this.client.getElementsFromEventRecord(e)[0]}populateEventMenu({items:e,eventRecord:r,assignmentRecord:t}){const{client:i}=this;e.deleteEvent={disabled:r.readOnly||(t==null?void 0:t.readOnly),hidden:i.readOnly},e.unassignEvent={disabled:r.readOnly||(t==null?void 0:t.readOnly),hidden:i.readOnly||i.eventStore.usesSingleAssignment},i.showEventColorPickers||i.showTaskColorPickers?e.eventColor={disabled:r.readOnly,hidden:i.readOnly}:e.eventColor={hidden:!0}}populateItemsWithData({items:e,eventRecord:r}){var t;super.populateItemsWithData(...arguments);const{client:i}=this;(i.showEventColorPickers||i.isSchedulerPro&&i.showTaskColorPickers)&&((t=e.eventColor)!=null&&t.menu)&&N.merge(e.eventColor.menu.colorMenu,{value:r.eventColor,record:r})}changeItems(e){const{client:r}=this;return N.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",weight:200,onItem({menu:t,eventRecord:i}){var n;const s=(n=t.focusInEvent)==null?void 0:n.relatedTarget;s&&(s.focus(),r.navigator.activeItem=s),r.removeEvents(r.isEventSelected(i)?r.selectedEvents:[i])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,onItem({menu:t,eventRecord:i,resourceRecord:n}){var s;const a=(s=t.focusInEvent)==null?void 0:s.relatedTarget;a&&(a.focus(),r.navigator.activeItem=a),r.isEventSelected(i)?r.assignmentStore.remove(r.selectedAssignments):i.unassign(n)}},eventColor:{text:"L{SchedulerBase.color}",icon:"b-icon b-icon-palette",separator:!0,menu:{colorMenu:{type:"eventcolorpicker"}}}},e)}};to.featureClass="",to._$name="EventMenu",j.registerFeature(to,!0,"Scheduler"),j.registerFeature(to,!1,"ResourceHistogram");var Wv=e=>{var r;return r=class extends e{getNonWorkingTimeRanges(t,i,n){if(!t.getNonWorkingTimeRanges){const s=[];return t.forEachAvailabilityInterval({startDate:i,endDate:n,isForward:!0},(a,o,l)=>{for(const[c,d]of l.intervalGroups)d.getIsWorking()||s.push({name:c.name,iconCls:c.iconCls,cls:c.cls,startDate:a,endDate:o})}),s}return t.getNonWorkingTimeRanges(i,n)}getCalendarTimeRanges(t,i=!1){const n=this,{timeAxis:s,fillTicks:a}=n.client,{unit:o,increment:l}=s,c=!n.maxTimeAxisUnit||b.compareUnits(o,n.maxTimeAxisUnit)<=0;if(t&&c&&s.count){const d=n.getNonWorkingTimeRanges(t,s.startDate,s.endDate),u=d.map(f=>new St({name:f.name,cls:`b-nonworkingtime ${f.cls||""}`,startDate:f.startDate,endDate:f.endDate})),h=[];let g=null;for(const f of u)g&&f.startDate<=g.endDate&&(i||f.name===g.name)&&f.duration>0?g.endDate=f.endDate:(h.push(f),f.setData("id",`nonworking-${h.length}`),g=f);return a&&h.forEach(f=>{f.setStartEndDate(b.ceil(f.startDate,{magnitude:l,unit:o}),b.floor(f.endDate,{magnitude:l,unit:o}))}),h}else return[]}setupDefaultCalendar(){const{client:t,project:i}=this;!this.autoGeneratedWeekends&&!t.isSchedulerPro&&!t.isGantt&&i.effectiveCalendar===i.defaultCalendar&&!i.defaultCalendar.intervalStore.count&&(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}updateDefaultCalendar(){if(this.autoGeneratedWeekends){const t=this.client.project.effectiveCalendar,i=this.defaultNonWorkingIntervals,n=!!i.length;t.ignoreTimeZone=!0,t.clearIntervals(n),n&&t.addIntervals(i)}}updateLocalization(){var t;(t=super.updateLocalization)==null||t.call(this),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}get defaultNonWorkingIntervals(){const t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return b.nonWorkingDaysAsArray.map(i=>({recurrentStartDate:`on ${t[i]} at 0:00`,recurrentEndDate:`on ${t[(i+1)%7]} at 0:00`,isWorking:!1}))}},E(r,"$name","NonWorkingTimeMixin"),E(r,"configurable",{maxTimeAxisUnit:"week"}),r},Sc=class extends Q.mixin(xt,Wv){static get properties(){return{calendarRangeCache:new Map}}doDisable(e){this.client.refresh(),super.doDisable(e)}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e);const r=this;e.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:r}),r.client.isScheduler&&r.project.effectiveCalendar.intervals.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:r}),r.setupDefaultCalendar()}onCalendarChange(){this.calendarRangeCache.clear()}onTimeAxisViewModelUpdate(){this.calendarRangeCache.clear()}getRangeDomConfig(e,r,t,i){const n=this,{client:s}=n,{rtl:a}=s,o=s.getCoordinateFromDate(b.max(e.startDate,r))-i,l=e.endDate?s.getCoordinateFromDate(b.min(e.endDate,t))-i:o,c=Math.abs(l-o),d=c>0,u=a?`calc(${o}px - 100%)`:`${o}px`;return{className:{"b-sch-timerange":1,"b-sch-range":1,"b-sch-nonworkingtime":1,[e.cls]:e.cls,"b-rtl":a},dataset:{id:e.id},elementData:{timeRange:e},style:s.isVertical?`transform: translateY(${u}); ${d?`height:${c}px`:""};`:`transform: translateX(${u}); ${d?`width:${c}px`:""};`}}getCalendarTimeRanges(e){let r=this.calendarRangeCache.get(e);return r||(r=super.getCalendarTimeRanges(e,!0),this.calendarRangeCache.set(e,r)),r}onEventDataGenerated({eventRecord:e,endMS:r,startMS:t,start:i,end:n,left:s,top:a,children:o}){var l;if(this.enabled){const{isVertical:c}=this.client,d=(l=e.effectiveCalendarsCombination)!=null?l:this.client.project.calendar;for(const u of this.getCalendarTimeRanges(d))if(u.startDateMS<r&&u.endDateMS>t){const h=this.getRangeDomConfig(u,i,n,c?a:s);o.push(h)}}}};E(Sc,"$name","EventNonWorkingTime"),E(Sc,"pluginConfig",{chain:["onTimeAxisViewModelUpdate","updateLocalization","onEventDataGenerated"]}),Sc._$name="EventNonWorkingTime",j.registerFeature(Sc,!1,"Scheduler");var x0=[0,0],PO=[null,[0,10],[10,0]],gh=class extends ls{static get $name(){return"EventTooltip"}static get defaultConfig(){return{template:e=>`
                ${e.eventRecord.name?O.xss`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:""}
                ${e.startClockHtml}
                ${e.endClockHtml}`,cls:"b-sch-event-tooltip",monitorRecordUpdate:!0,scrollAction:"hide"}}construct(e,r){super.construct(e,r),typeof this.align=="string"&&(this.align={align:this.align})}onPaint({firstPaint:e}){if(super.onPaint(...arguments),e){const{dependencies:r}=this.client.features;r&&this.tooltip.ion({beforeAlign({source:t,offset:i=x0}){const{edgeAligned:n}=LS(t.align.align),s=r.disabled?x0:PO[n];arguments[0].offset=[i[0]+s[0],i[1]+s[1]]}})}}};gh._$name="EventTooltip",j.registerFeature(gh,!0,"Scheduler"),j.registerFeature(gh,!1,"ResourceHistogram");var AO={update:1,filter:1},_O={add:1,remove:1,update:1,removeAll:1,filter:1},Gv=class extends Vl{static get $name(){return"GroupSummary"}static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}static get properties(){return{footersToUpdate:new Set}}static get pluginConfig(){return{chain:["render"]}}construct(e,r){const t=this;if(e.isVertical)throw new Error("GroupSummary feature is not supported in vertical mode");t.scheduler=e,super.construct(e,r),!t.summaries&&t.renderer&&(t.summaries=[{renderer:t.renderer}]),e.isSchedulerBase&&(e.eventStore.ion({changePreCommit:t.onEventStoreChange,thisObj:t}),e.assignmentStore.ion({changePreCommit:t.onAssignmentStoreChange,thisObj:t}),e.ion({timeAxisViewModelUpdate:t.onTimeAxisChange,thisObj:t}),e.project.ion({dataReady:t.onProjectDataReady,thisObj:t}))}doDestroy(){var e;(e=this._tip)==null||e.destroy(),super.doDestroy()}onTimeAxisChange(){this.scheduler.rowManager.forEach(e=>{e.isGroupFooter&&e.render()})}onEventStoreChange({action:e,records:r,changes:t}){if(AO[e]){const i=new Set;r.forEach(n=>n.resources.forEach(s=>i.add(s))),this.afterChange(i)}}onAssignmentStoreChange({action:e,records:r,changes:t}){var i;if(_O[e]){const n=new Set;if(r.forEach(s=>s.resource&&n.add(s.resource)),((i=t==null?void 0:t.resourceId)==null?void 0:i.oldValue)!=null){const s=this.scheduler.resourceStore.getById(t.resourceId.oldValue);s&&n.add(s)}this.afterChange(n)}}afterChange(e){const{rowManager:r}=this.scheduler;for(const t of e){let i=r.getRowFor(t);if(this.target==="header")for(;i&&!i.isGroupHeader;)i=r.getRow(i.index-1);else for(;i&&!i.isGroupFooter;)i=r.getRow(i.index+1);i&&this.footersToUpdate.add(i)}}onProjectDataReady(){var e;const{footersToUpdate:r,client:t}=this;if(t.isVisible){if(r.size){for(const i of r)(e=i.render)==null||e.call(i);r.clear()}}else t.whenVisible("refresh",t,[!0])}onBeforeRenderRow({row:e,record:r}){if(e.isGroupFooter&&!r.meta.hasOwnProperty("groupFooterFor")){const t=e.elements.normal.querySelector(".b-sch-timeaxis-cell");t&&(t.innerHTML="")}super.onBeforeRenderRow(...arguments)}generateHtml(e,r,t,i,n,s){if(e.type==="timeAxis"){const a=this,{scheduler:o}=a,{eventStore:l}=o,c=o.timeAxisViewModel.columnConfig;let d="";const u=o.getResourcesEventsPerTick(r,({event:h})=>h.resources.some(g=>r.includes(g))&&(!l.isFiltered||l.records.includes(h)));return o.timeAxis.forEach((h,g)=>{const f=u[g]||[],m=a.summaries.map(p=>`<div class="b-timeaxis-summary-value">${p.renderer({startDate:h.startDate,endDate:h.endDate,resourceStore:o.resourceStore,events:f,resources:r,eventStore:l,groupRecord:i,groupField:n,groupValue:s})}</div>`).join("");d+=`<div class="b-timeaxis-tick" style="width: ${c[c.length-1][g].width}px">${m}</div>`}),`<div class="b-timeaxis-group-summary">${d}</div>`}return super.generateHtml(e,r,t,i,n,s)}updateSummaryHtml(e,r,t){const i=super.updateSummaryHtml(e,r,t);if(r.type==="timeAxis"){const n={count:0,height:0};return this.summaries.forEach(s=>{s.height?n.height+=s.height:n.count++}),n}return i}getTipHtml({activeTarget:e}){const r=this,t=Array.from(e.parentElement.children).indexOf(e),i=r.scheduler.timeAxis.getAt(t);let n=`<header>${r.L("L{Summary.Summary for}",r.scheduler.getFormattedDate(i.startDate))}</header>`,s=!1;return w.forEachSelector(e,".b-timeaxis-summary-value",(a,o)=>{const l=r._labels[o],c=a.innerText.trim();n+=`<label>${l||""}</label><div class="b-timeaxis-summary-value">${c}</div>`,a.innerHTML&&(s=!0)}),s?n:null}render(){var e;const r=this,{scheduler:t}=r;t.isSchedulerBase&&(e=r.summaries)!=null&&e.some(i=>i.label)&&r.showTooltip&&!r._tip&&(r._labels=r.summaries.map(i=>i.label||""),r._tip=new ve({id:`${t.id}-groupsummary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:t.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",getHtml:r.getTipHtml.bind(r)}))}removeSummaryElements(e){const r=e.querySelector(".b-timeaxis-group-summary");r==null||r.remove(),super.removeSummaryElements()}hasSummary(e){return super.hasSummary(e)||e.isTimeAxisColumn}};Gv._$name="GroupSummary",j.registerFeature(Gv,!1,"Scheduler");var fh=class extends Q{static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"]}}onElementMouseDown(e){const r=this;if(!(e.touches||e.button!==0||r.disabled)&&e.target.closest(".b-sch-header-timeaxis-cell")){const t=r.client.subGrids.normal.header.headersElement;r.startX=e.clientX,r.element=w.createElement({parent:t,tag:"div",className:"b-headerzoom-rect"}),r.headerElementRect=k.from(t),B.on({element:document,mouseup:"onMouseUp",thisObj:r,once:!0})}}onElementMouseMove(e){const r=this;if(typeof r.startX=="number"){const t=Math.max(e.clientX,r.headerElementRect.left),i=Math.min(r.startX,t),n=Math.abs(r.startX-t),s=new k(i-r.headerElementRect.x+r.client.scrollLeft,0,n,r.headerElementRect.height);w.setTranslateX(r.element,s.left),r.element.style.width=s.width+"px"}}onMouseUp(){const e=this;if(typeof e.startX=="number"){const{client:r}=e,t=k.from(e.element),i=r.getDateFromCoordinate(t.left,"round",!1),n=r.getDateFromCoordinate(t.right,"round",!1);e.element.remove(),e.startX=null,r.zoomToSpan({startDate:i,endDate:n})}}};E(fh,"$name","HeaderZoom"),fh._$name="HeaderZoom",j.registerFeature(fh,!1,"Scheduler");var kO=["top","before","after","bottom"],FO=(e,r)=>{switch(e){case"top":return"b-b";case"after":return r.rtl?"r-r":"l-l";case"right":return"l-l";case"bottom":return"t-t";case"before":return r.rtl?"l-l":"r-r";case"left":return"r-r"}},OO={top:1,bottom:1},LO={estimate:1,measure:1},$O={before:1,after:1},Dc=class extends Q{static get $name(){return"Labels"}static get configurable(){return{labelCls:"b-sch-label",top:null,after:null,right:null,bottom:null,before:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(e,r){const t=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");t.scheduler=e,super.construct(e,r),(t.top||t.bottom||t.before||t.after)&&t.updateHostClasslist()}updateHostClasslist(){const{top:e,bottom:r}=this,{classList:t}=this.scheduler.element;t.remove("b-labels-topbottom"),t.remove("b-labels-top"),t.remove("b-labels-bottom"),(e||r)&&(t.add("b-labels-topbottom"),e&&t.add("b-labels-top"),r&&t.add("b-labels-bottom"))}onLabelDblClick(e){const r=this,t=e.target;if(t&&!r.scheduler.readOnly){const{side:i}=t.dataset,n=r[i],{editor:s,field:a}=n;if(s){const o=this.scheduler.resolveEventRecord(e.target);return o.readOnly?void 0:(s instanceof hr||(n.editor=new hr({blurAction:r.blurAction,inputField:s,scrollAction:"realign"})),n.editor.render(r.scheduler.element),n.editor.startEdit({target:t,align:FO(i,r.client),matchSize:!1,record:o,field:a}),e.stopImmediatePropagation(),!1)}}}changeTop(e){return this.processLabelSpec(e,"top")}updateTop(){this.updateHostClasslist()}changeAfter(e){return this.processLabelSpec(e,"after")}updateAfter(){this.updateHostClasslist()}changeRight(e){this[this.client.rtl?"before":"after"]=e}changeBottom(e){return this.processLabelSpec(e,"bottom")}updateBottom(){this.updateHostClasslist()}changeBefore(e){return this.processLabelSpec(e,"before")}updateBefore(){this.updateHostClasslist()}changeLeft(e){this[this.client.rtl?"after":"before"]=e}processLabelSpec(e,r){if(typeof e=="function")e={renderer:e};else if(typeof e=="string")e={field:e};else if(e)e=Object.setPrototypeOf({},e);else return null;const{scheduler:t}=this,{eventStore:i,resourceStore:n,taskStore:s,id:a}=t,{field:o,editor:l}=e;if(OO[r]&&(t.milestoneWidth=null),i&&!s?e.recordType="event":e.recordType="task",o){let c,d=!1;i&&!s&&(c=i.modelClass.fieldMap[o],c?(e.fieldDef=c,e.recordType="event",d=!0):Reflect.has(i.modelClass.prototype,o)&&(e.recordType="event",d=!0)),!c&&s&&(c=s.modelClass.fieldMap[o],c?(e.fieldDef=c,e.recordType="task",d=!0):Reflect.has(n.modelClass.prototype,o)&&(e.recordType="task",d=!0)),!c&&n&&(c=n.modelClass.fieldMap[o],c?(e.fieldDef=c,e.recordType="resource",d=!0):Reflect.has(n.modelClass.prototype,o)&&(e.recordType="resource",d=!0)),l&&(typeof l=="boolean"?t.editor={type:"textfield"}:typeof l=="string"&&(t.editor={type:l}),B.on({element:t.timeAxisSubGrid.element,delegate:".b-sch-label",dblclick:"onLabelDblClick",thisObj:this}))}return e}doDisable(e){super.doDisable(e),this.client.isPainted&&this.client.refresh()}generateLabelConfigs(e){const r=this,t=[];for(const i of kO)if(r[i]){const{field:n,fieldDef:s,recordType:a,renderer:o,thisObj:l}=r[i],c={tag:"label",className:{[r.labelCls]:1,[`${r.labelCls}-${i}`]:1},dataset:{side:i,taskFeature:`label-${i}`}};let d;const u=`${a}Record`,h=e[u];o?d=o.call(l||r.thisObj||r,{[u]:h,resourceRecord:e.resourceRecord,assignmentRecord:e.assignmentRecord,domConfig:c}):(d=h.getValue(n),(s==null?void 0:s.type)==="date"&&!o?d=b.format(d,r.client.displayDateFormat):d=O.encodeHtml(d)),c.html=d||"\xA0",t.push(c)}return t}measureLabels(e,r){const t=this,i=t.client.timeAxisViewModel.getSingleUnitInPixels("millisecond");for(const n of e)if($O[n.dataset.side]){let{html:s}=n,a=0;if(t.labelLayoutMode==="estimate")s.includes("<")&&(s=w.stripTags(s)),a=s.length*t.labelCharWidth+18;else{const l=t.labelMeasureElement||(t.labelMeasureElement=w.createElement({className:"b-sch-event-wrap b-measure-label",parent:t.client.foregroundCanvas}));l.retainElement=!0,X.sync({targetElement:l,childrenOnly:!0,domConfig:{children:[n]}}),a=l.firstElementChild.offsetWidth}const o=a/i;switch(n.dataset.side){case"before":r.startMS-=o;break;case"after":r.endMS+=o;break}}}onEventDataGenerated(e){var r;if(!this.disabled&&!((r=e.eventRecord)!=null&&r.isResourceTimeRange)){const t=this.generateLabelConfigs(e);LO[this.labelLayoutMode]&&this.measureLabels(t,e),e.wrapperChildren.push(...t)}}updateLabelLayoutMode(){this.isConfiguring||this.client.refreshWithTransition()}updateLabelCharWidth(){this.isConfiguring||this.client.refreshWithTransition()}};Dc.featureClass="b-sch-labels",Dc._$name="Labels",j.registerFeature(Dc,!1,"Scheduler");var ro=class extends Ki.mixin(xt,Wv){static get defaultConfig(){return{highlightWeekends:null,hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}doDestroy(){this.attachToCalendar(null),super.doDestroy()}set highlightWeekends(e){ne.deprecate("Scheduler","6.0.0","Deprecated in favour of disabling the feature"),this.disabled=!e}get highlightWeekends(){return!this.disabled}onConfigChange({name:e}){!this.isConfiguring&&e==="fillTicks"&&this.refresh()}attachToProject(e){super.attachToProject(e),this.attachToCalendar(e.effectiveCalendar),!e.graph&&!this.client.isScheduler&&e.ion({name:"project",dataReady:{fn:()=>this.attachToCalendar(e.effectiveCalendar),once:!0},thisObj:this}),e.ion({name:"project",calendarChange:()=>this.attachToCalendar(e.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(...e){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate(...e)}attachToCalendar(e){const r=this,{project:t,client:i}=r;r.detachListeners("calendar"),r.autoGeneratedWeekends=!1,e&&(r.setupDefaultCalendar(),e.intervalStore.ion({name:"calendar",change:()=>r.setTimeout(()=>r.refresh(),1)})),i.isEngineReady&&!i.project.isDelayingCalculation&&!i.isDestroying?r.refresh():t.isDestroyed||(r.detachListeners("initialProjectListener"),t.ion({name:"initialProjectListener",refresh({isCalculated:n}){n!==!1&&(r.refresh(),r.detachListeners("initialProjectListener"))},thisObj:r}))}get calendar(){var e;return(e=this.project)==null?void 0:e.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=b.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(e){return super.shouldRenderRange(e)&&(!this.hideRangesOnZooming||e.durationMS>=this.timeAxisUnitDurationMs)}get timeRanges(){const e=this;return e._timeRanges||(e._timeRanges=e.getCalendarTimeRanges(e.calendar)),e._timeRanges}};E(ro,"$name","NonWorkingTime"),E(ro,"pluginConfig",{chain:["onPaint","attachToProject","updateLocalization","onConfigChange","onSchedulerHorizontalScroll"]}),ro._$name="NonWorkingTime",j.registerFeature(ro,!1,"Scheduler"),j.registerFeature(ro,!0,["SchedulerPro","Gantt","ResourceHistogram"]);var wc=class extends Q{get targetSelector(){return`.b-sch-timeaxis-cell,.b-timeline-subgrid${this.enableInHeader?",.b-sch-header-timeaxis-cell,.b-sch-header-text":""}`}static get pluginConfig(){return{chain:["onElementMouseDown"]}}onElementMouseDown(e){const r=this,{client:t}=r,{button:i,touches:n,target:s,clientX:a,clientY:o}=e,l=t.features.taskDrag||t.features.eventDrag,c=t.readOnly||!(l!=null&&l.enabled);n||i!==0||r.disabled||t.trigger("beforePan",{event:e})===!1||(s.matches(r.targetSelector)||c&&s.closest(t.eventSelector))&&(r.mouseX=a,r.mouseY=o,r.onHeader=r.enableInHeader&&s.closest(".b-sch-header-timeaxis-cell"),r.mouseDetacher=B.on({element:document,mousemove:"onMouseMove",mouseup:"onMouseUp",thisObj:r}))}onMouseMove(e){const r=this,{client:t}=r,i=t.timeAxisSubGrid.scrollable,n=t.scrollable,s=e.clientX,a=e.clientY;e.preventDefault(),r.vertical&&(t.isVertical||!r.onHeader)&&n.scrollBy(0,r.mouseY-a),r.horizontal&&(t.isHorizontal||!r.onHeader)&&i.scrollBy(r.mouseX-s),r.mouseX=s,r.mouseY=a}onMouseUp(){this.mouseDetacher(),this.mouseDetacher=null}get isActive(){return!!this.mouseDetacher}};E(wc,"$name","Pan"),E(wc,"configurable",{horizontal:!0,vertical:!0,enableInHeader:!0}),wc._$name="Pan",j.registerFeature(wc,!1,["Scheduler","Gantt"]);var io=class extends aa{static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateResourceMenu"),e}getDataFromEvent(e){const r=e.target.closest(".b-resourceheader-cell"),t=r==null?void 0:r.dataset.resourceId;if(t){const i=this.client.resourceStore.getById(t);return{cellElement:r,resourceRecord:i}}}populateResourceMenu({items:e,resourceRecord:r}){const{client:t}=this;t.readOnly||(e.remove={text:"L{CellMenu.removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:r.readOnly,onItem:()=>t.resourceStore.remove(r)})}get showMenu(){return!0}};E(io,"$name","ResourceMenu"),E(io,"configurable",{processItems:null,items:null,type:"resource"}),io.featureClass="",io._$name="ResourceMenu",j.registerFeature(io,!1,["Scheduler"]);var no=class extends os{static get pluginConfig(){return{...super.pluginConfig,assign:["resolveResourceTimeRangeRecord","getElementFromResourceTimeRangeRecord"]}}attachToProject(e){const r=this,{client:t}=r;if(super.attachToProject(e),!e.resourceTimeRangeStore){e.resourceTimeRangeStore=t.resourceTimeRangeStore||new hc({owner:r});const{crudManager:n}=t;n&&!n.resourceTimeRangeStore&&(n.resourceTimeRangeStore=e.resourceTimeRangeStore)}const i=e.resourceTimeRangeStore;r.exposedOnScheduler||(t.resourceTimeRanges&&(i.add(t.resourceTimeRanges),delete t.resourceTimeRanges),Object.defineProperty(t,"resourceTimeRanges",{get:()=>i.records,set:n=>i.data=n}),r.exposedOnScheduler=!0),i.resourceStore||(i.resourceStore=e.resourceStore),r.detachListeners("store"),i.ion({name:"store",change:r.onStoreChange,thisObj:r})}attachToResourceTimeRangeStore(e){this.attachToProject(this.project),this.client.refresh()}get store(){return this.project.resourceTimeRangeStore}getEventsToRender(e,r){if(!this.disabled){const{timeRanges:t}=e.$original;if(t!=null&&t.length){const{startDate:i,endDate:n}=this.client;t.forEach(s=>{s.isRecurring?r.push(...s.getOccurrencesForDateRange(i,n)):r.push(s)})}}return r}shouldInclude(e){return e.isResourceTimeRange&&!e.isNonWorking&&!e.isCalendarHighlightModel}doDestroy(){var e;((e=this.store)==null?void 0:e.owner)===this&&this.store.destroy(),super.doDestroy()}};E(no,"$name","ResourceTimeRanges"),E(no,"configurable",{rangeCls:"b-sch-resourcetimerange",enableMouseEvents:!1,tabIndex:0,entityName:"resourceTimeRange"}),no.featureClass="",no._$name="ResourceTimeRanges",j.registerFeature(no,!1,"Scheduler");var mh=class extends Tr(Wi){onDragStart(...e){if(super.onDragStart(...e),this.client.transactionalFeaturesEnabled)return this.startFeatureTransaction()}onDrop(...e){return this.rejectFeatureTransaction(),super.onDrop(...e)}onAbort(...e){return this.rejectFeatureTransaction(),super.onAbort(...e)}};E(mh,"$name","RowReorder"),mh._$name="RowReorder",j.registerFeature(mh,!1,"Scheduler"),j.registerFeature(mh,!0,"Gantt");var ph=class extends dh{static get $name(){return"ScheduleMenu"}static get defaultConfig(){return{type:"schedule",items:null,processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateScheduleMenu"),e}shouldShowMenu(e){const{client:r}=this,{targetElement:t,resourceRecord:i}=e,n=r.timeAxisSubGridElement.contains(t);return!t.closest(r.eventSelector)&&n&&!(i&&i.isSpecialRow)}getDataFromEvent(e){var r,t;if(w.isDOMEvent(e)){const{client:i}=this,n=(r=i.getCellDataFromEvent)==null?void 0:r.call(i,e),s=(t=i.getDateFromDomEvent)==null?void 0:t.call(i,e,"floor"),a=i.resolveResourceRecord(e)||i.isVertical&&i.resourceStore.last;return T.assign(super.getDataFromEvent(e),n,{date:s,resourceRecord:a})}return e}populateScheduleMenu({items:e,resourceRecord:r,date:t}){const{client:i}=this;!i.readOnly&&i.eventStore&&(e.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:!r||r.readOnly||!r.isWorkingTime(t),weight:100,onItem(){i.createEvent(t,r,i.getRowFor(r))}})}};ph.featureClass="",ph._$name="ScheduleMenu",j.registerFeature(ph,!0,"Scheduler");var Ec=class extends Q{static get $name(){return"ScheduleTooltip"}static get configurable(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`,hideForNonWorkingTime:null}}static get pluginConfig(){return{chain:["onPaint"]}}onPaint({firstPaint:e}){if(!e)return;const r=this,{client:t}=r;t.isSchedulerPro&&r.hideForNonWorkingTime===void 0&&(r.hideForNonWorkingTime=!0);let i;const n=r.hoverTip=new ve({id:`${t.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:t.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event):not(.b-dragcreating) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",getHtml:r.getHoverTipHtml.bind(r),onDocumentMouseDown(s){n.forElement.contains(s.event.target)&&(i=B.on({thisObj:r,element:t.timeAxisSubGridElement,mousemove:o=>n.internalOnPointerOver(o),capture:!0}));const a=n.hideAnimation;n.hideAnimation=!1,n.constructor.prototype.onDocumentMouseDown.call(n,s),n.hideAnimation=a},...r.config,internalListeners:r.configuredListeners});n.ion({pointerover({event:s}){const a="buttons"in s?s.buttons>0:s.which>0;return!a&&i&&i(),!r.disabled&&!a},innerhtmlupdate({source:s}){r.clockTemplate.updateDateIndicator(s.element,r.lastTime)}}),t.ion({timeAxisViewModelUpdate:"updateTip",thisObj:r}),r.clockTemplate=new ss({scheduler:t})}processConfiguredListeners(){}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:r}){const t=this,i=t.client,n=r&&i.getDateFromDomEvent(r,"floor",!0);let s=t.lastHtml;if(n&&r.target){const a=i.resolveResourceRecord(r);if(a&&(n-t.lastTime!==0||a.id!==t.lastResourceId)){if(t.hideForNonWorkingTime){const o=a.isWorkingTime(n);e.element.classList.toggle("b-nonworking-time",!o)}t.lastResourceId=a.id,s=t.lastHtml=t.generateTipContent({date:n,event:r,resourceRecord:a})}}else e.hide(),t.lastTime=null,t.lastResourceId=null;return s}generateTipContent({date:e,event:r,resourceRecord:t}){const i=this,n=i.clockTemplate.generateContent({date:e,text:i.client.getFormattedDate(e)}),s=i.messageTemplate({message:i.getText(e,r,t)||""});return i.lastTime=e,n+s}getText(e,r,t){}};Ec.featureClass="b-scheduletip",Ec._$name="ScheduleTooltip",j.registerFeature(Ec,!0,"Scheduler"),j.registerFeature(Ec,!1,"ResourceUtilization");var Uv=class extends Q.mixin(pc){static get $name(){return"SimpleEventEdit"}static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEventEnterKey","editEvent"]}}construct(e,r){const t=this;t.scheduler=e,e.eventEdit=t,super.construct(e,r),t.clientListenersDetacher=e.ion({[t.triggerEvent]:({eventRecord:i,eventElement:n})=>t.editEvent(i,i.resource,n),dragcreateend:t.onDragCreateEnd,thisObj:t})}doDestroy(){var e;this.clientListenersDetacher(),(e=this.editor)==null||e.destroy(),super.doDestroy()}get eventStore(){return this.scheduler.eventStore}get project(){return this.client.project}async editEvent(e,r,t,i){const n=this,{scheduler:s}=n,{eventEdit:a}=n.client.features;if(s.readOnly||n.disabled||e.readOnly||a&&!a.disabled&&!e.isCreating)return;let{editor:o}=n;t=w.down(t,s.eventInnerSelector)||t,e=e.isAssignment?e.event:e,n.resource=r,n.event=e,n.element=t,s.element.classList.add("b-eventeditor-editing"),o?o.render(s.timeAxisSubGridElement):(n.editor=o=hr.new({owner:s.timeAxisSubGrid,appendTo:s.timeAxisSubGridElement,scrollAction:"realign",maxHeight:40,align:{align:s.isHorizontal?"c-c":"t-t"},cls:"b-simpleeventeditor",internalListeners:{complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:n},onInternalKeyDown:l=>l.stopPropagation()},n.editorConfig),n.relayEvents(n.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),i?(n.stmInitiallyAutoRecord=i.stmInitiallyAutoRecord,n.stmInitiallyDisabled=i.stmInitiallyDisabled,n.hasStmCapture=!0,i.transferred=!0):i!==!1&&!n.hasStmCapture&&n.captureStm(!0),e.isCreating&&(e.name=""),await o.startEdit({target:t,record:e,field:n.field}),s.isVertical&&e.startDate<s.visibleDateRange.startDate&&o.element.scrollIntoView(),s.navigator.disabled=!0}onEditorComplete(){this.event.isCreating=!1,this.reset(),this.freeStm(!0)}onEditorCancel(){this.event.isCreating&&this.event.remove(),this.reset(),this.freeStm(!1)}reset(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1,this.event=null,this.resource=null}onEventEnterKey({assignmentRecord:e,eventRecord:r}){const t=e?this.scheduler.getElementFromAssignmentRecord(e):this.scheduler.getElementFromEventRecord(r),i=(e||r).resource;this.editEvent(r,i,t)}onDragCreateEnd({eventRecord:e,resourceRecord:r,eventElement:t,stmCapture:i}){this.element=t,this.editEvent(e,r,t,i)}};Uv._$name="SimpleEventEdit",j.registerFeature(Uv,!1,"Scheduler");var jO=Object.freeze({animate:!1,block:"start"}),BO=Object.freeze({animate:!1,block:"end"}),so=class extends Gi{getClientConfig(e,r,t,i){var n;const{client:s}=this,a=super.getClientConfig(e,r,t,i);return!s.isSchedulerBase&&!s.isSchedulerProBase&&!s.isGanttBase||(delete a.store,delete a.events,delete a.resources,delete a.assignments,delete a.dependencies,delete a.resourceTimeRanges,delete a.timeRanges,a.project=s.project,a.assignmentStore=a.project.assignmentStore,a.crudManager=s.crudManager,a.viewPreset=s.viewPreset,a.startDate=s.startDate,a.endDate=s.endDate,a.selectedCollection=s.selectedCollection,a.useInitialAnimation=!1,((n=a.features)==null?void 0:n.eventDrag)!==!1&&(T.setPath(a,"features.eventDrag.constrainDragToTimeline",!1),s.features.eventDrag.constrainDragToTimeline=!1)),a}unsplitCleanup(e){this.client.timeAxisSubGrid.onElementResize()}processOptions(e){const{client:r}=this;let{atDate:t,atRecord:i}=e;if(e.direction!=="horizontal"&&!e.atColumn&&!e.atRecord&&!t){const n=k.from(r.element),s=r.getDateFromCoordinate(n.center.x,"round",!1);s&&(e.atDate=t=s,e.atColumn=r.timeAxisColumn)}return t&&(e.direction||(e.direction=i?"both":"vertical"),e.splitX=r.getCoordinateFromDate(t,{ignoreRTL:!0})-r.timeAxisSubGrid.scrollable.x,r.rtl?e.splitX+=r._bodyRectangle.width-k.from(r.timeAxisSubGridElement).right+w.scrollBarWidth:e.splitX+=k.from(r.timeAxisSubGridElement,r.bodyContainer).left,e.remainingWidth=k.from(r.element).width-e.splitX),super.processOptions(e)}async split(e={}){const{client:r}=this;if(r.isVertical)throw new Error("Splitting is not supported in vertical mode");const t=await super.split(e);return t&&e.atDate&&await Promise.all([t[0].scrollToDate(b.add(e.atDate,-1,r.timeAxis.unit),BO),t[1].scrollToDate(e.atDate,jO)]),r.timeAxisSubGrid.scrollable.x+=.5,t}populateCellMenu(){}populateScheduleMenu({items:e,date:r,record:t}){const i=this,{isSplit:n}=i,{splitFrom:s}=i.client;!i.disabled&&i.client.isHorizontal&&(e.splitSchedule={text:"L{split}",localeClass:i,icon:"b-icon b-icon-split-vertical",weight:500,separator:!0,hidden:n||s,menu:{splitHorizontally:{text:"L{horizontally}",icon:"b-icon b-icon-split-horizontal",localeClass:i,weight:100,onItem(){i.split({atRecord:t,direction:"horizontal"}).then()}},splitVertically:{text:"L{vertically}",icon:"b-icon b-icon-split-vertical",localeClass:i,weight:200,onItem(){i.split({atDate:r}).then()}},splitBoth:{text:"L{both}",icon:"b-icon b-icon-split-both",localeClass:i,weight:300,onItem(){i.split({atDate:r,atRecord:t,direction:"both"}).then()}}}},e.unsplitSchedule={text:"L{unsplit}",localeClass:i,icon:"b-icon b-icon-clear",hidden:!(n||s),weight:550,onItem(){(s||i).unsplit()}})}};E(so,"$name","Split"),E(so,"configurable",{relayProperties:{value:{barMargin:1,eventColor:1,eventStyle:1,eventLayout:1,fillTicks:1,resourceMargin:1,snap:1,tickSize:1},$config:{merge:"merge"}}}),E(so,"pluginConfig",{chain:["populateCellMenu","populateScheduleMenu","afterConfigChange","afterAddListener","afterRemoveListener"],assign:["split","unsplit","subViews","syncSplits"]}),so._$name="Split",j.registerFeature(so,!1,"Scheduler");var HO={width:0,height:0},us=class extends Q{construct(e,r){super.construct(e,r),e.isVertical&&(this.toUpdate=new Set,e.ion({scroll:"onSchedulerScroll",horizontalScroll:"onHorizontalScroll",thisObj:this,prio:1e4}))}onEventDataGenerated(e){this.client.isHorizontal?e.wrapperCls["b-disable-sticky"]=e.eventRecord.stickyContents===!1:(this.syncEventContentPosition(e,void 0,!0),this.updateStyles())}onSchedulerScroll(){this.disabled||this.verticalSyncAllEventsContentPosition(this.client)}onHorizontalScroll({subGrid:e}){e===this.client.timeAxisSubGrid&&this.verticalSyncAllEventsContentPosition(this.client)}updateStyles(){for(const{contentEl:e,style:r}of this.toUpdate)w.applyStyle(e,r);this.toUpdate.clear()}verticalSyncAllEventsContentPosition(e){const{resourceMap:r}=e.currentOrientation;for(const t of r.values())for(const{renderData:i,elementConfig:n}of Object.values(t)){const s=[i];n&&i.eventRecord.isResourceTimeRange&&s.push(n.children[0]),this.syncEventContentPosition.apply(this,s)}this.toUpdate.size&&this.updateStyles()}syncEventContentPosition(e,r=e.eventContent,t=!1){if(this.disabled||e.eventRecord.stickyContents===!1)return;const{client:i}=this,{eventRecord:n,resourceRecord:s,useEventBuffer:a,bufferAfterWidth:o,bufferBeforeWidth:l,top:c,height:d}=e,u=i.scrollable.y,h=t?null:i.getElementFromEventRecord(n,s,!0),g=h&&X.getChild(h,"event.content"),f=n.instanceMeta(i),m=typeof r.style=="string"?r.style=w.parseStyle(r.style):r.style||(r.style={});if(h!=null&&h.classList.contains("b-dragging"))return;let p=c,v=d,y=p+v;if(a&&(p+=l,v=v-l-o,y=p+v),p<u&&y>=u&&!n.isMilestone){const C=g==null?void 0:g.offsetWidth,D=(g==null?void 0:g.parentNode)&&w.getStyleValue(g.parentNode,"justifyContent"),S=D==="center"?(e.width-C)/2:0,x=p,R=x+v-1;if((!g||C)&&x<u&&R>=u){const I=this.getEventContentMargins(g),M=g?v-g.offsetHeight-I.height-S:Number.MAX_SAFE_INTEGER,P=Math.min(u-x,M-2);m.transform=P>0?`translateY(${P}px)`:"",f.stuck=!0}else m.transform="",f.stuck=!1;g&&this.toUpdate.add({contentEl:g,style:m})}else g&&f.stuck&&(m.transform="",f.stuck=!1,this.toUpdate.add({contentEl:g,style:m}))}getEventContentMargins(e){return e!=null&&e.classList.contains("b-sch-event-content")?w.getEdgeSize(e,"margin"):HO}doDisable(){super.doDisable(...arguments),this.isConfiguring||this.client.refreshWithTransition()}};E(us,"$name","StickyEvents"),E(us,"type","stickyEvents"),E(us,"pluginConfig",{chain:["onEventDataGenerated"]}),us._$name="StickyEvents",j.registerFeature(us,!0,"Scheduler"),j.registerFeature(us,!1,"ResourceHistogram");var vh=class extends ql{static get $name(){return"TimelineSummary"}static get configurable(){return{showTooltip:!0}}static get pluginConfig(){return{chain:["renderRows","updateProject"]}}construct(e,r){const t=this;super.construct(e,r),t.summaries||(t.summaries=[{renderer:t.renderer}]),e.isTimelineBase&&(t.updateProject(e.project),e.ion({timeAxisViewModelUpdate:t.renderRows,thisObj:t}))}updateProject(e){this.detachListeners("summaryProject"),e.ion({name:"summaryProject",dataReady:"updateTimelineSummaries",thisObj:this})}renderRows(){this.client.isHorizontal&&this.client.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer").classList.add("b-sch-summarybar"),super.renderRows(),this.disabled||this.render()}get summaryBarElement(){return this.client.element.querySelector(".b-sch-summarybar")}render(){const e=this,{client:r}=e,t=r.isHorizontal?"width":"height",i=r.timeAxisViewModel.columnConfig,n=e.summaryBarElement;n&&(!e._tip&&e.showTooltip&&e.summaries.some(s=>s.label)&&(e._tip=new ve({id:`${r.id}-summary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:n,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:s})=>s._tipHtml})),n.innerHTML=i[i.length-1].map(s=>`<div class="b-timeaxis-tick" style="${t}: ${s.width}px"></div>`).join(""),e.updateTimelineSummaries())}refresh(){super.refresh(),this.updateTimelineSummaries()}doDisable(e){var r;const{isConfiguring:t}=this.client;super.doDisable(e),(r=this.summaryColumn)==null||r.toggle(!e),!t&&!e&&this.render()}doDestroy(){var e;(e=this._tip)==null||e.destroy(),super.doDestroy()}};vh._$name="TimelineSummary";var Yv=class extends vh{static get $name(){return"Summary"}static get configurable(){return{summaries:null,renderer:null,verticalSummaryColumnConfig:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("bindStore","updateEventStore","updateResourceStore"),e}construct(e,r){const t=this;t.scheduler=e,e.isVertical&&(e.timeAxisSubGrid.resizable=!1,r.hideFooters=!0,e.add(e.createSubGrid("right")),t.summaryColumn=e.columns.add(T.assign({filterable:null,region:"right",cellCls:"b-grid-footer b-sch-summarybar",align:"center",sortable:!1,editor:!1,groupable:!1,htmlEncode:!1,cellMenuItems:!1,enableHeaderContextMenu:!1,hidden:t.disabled},t.verticalSummaryColumnConfig))[0]),super.construct(e,r),e.isSchedulerBase&&(t.updateEventStore(e.eventStore),t.updateResourceStore(e.resourceStore))}updateEventStore(e){this.detachListeners("summaryEventStore"),e.ion({name:"summaryEventStore",filter:"updateTimelineSummaries",thisObj:this})}updateResourceStore(e){this.detachListeners("summaryResourceStore"),e.ion({name:"summaryResourceStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const e=this,{client:r}=e,{eventStore:t,timeAxis:i}=r,n=e.summaryBarElement,s=e.selectedOnly&&r.selectedRecords.length?r.selectedRecords:r.resourceStore.records;if(n&&r.isEngineReady){const a=r.getResourcesEventsPerTick(s,({event:o})=>!t.isFiltered||t.records.includes(o));Array.from(n.children).forEach((o,l)=>{const c=i.getAt(l),d=a[l]||[];let u="",h=`<header>${e.L("L{Summary for}",r.getFormattedDate(c.startDate))}</header>`;e.summaries.forEach(g=>{const f=g.renderer({startDate:c.startDate,endDate:c.endDate,resourceStore:r.resourceStore,eventStore:t,events:d,element:o}),m=f?`<div class="b-timeaxis-summary-value">${f}</div>`:"";(e.summaries.length>1||f)&&(u+=m),h+=m?`<label>${g.label||""}</label>`+m:""}),o.innerHTML=u,o._tipHtml=u?h:""})}}};Yv._$name="Summary",j.registerFeature(Yv,!1,"Scheduler");var VO={maintainVisibleStart:!0},qv=class extends Nl{static get $name(){return"TimeAxisHeaderMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"timeAxisHeader"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTimeAxisHeaderMenu"),e}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(e){const{column:r,targetElement:t}=e,{client:i}=this;return i.isHorizontal?(r==null?void 0:r.enableHeaderContextMenu)!==!1&&(r==null?void 0:r.isTimeAxisColumn):t.matches(".b-sch-header-timeaxis-cell")}showContextMenu(e){super.showContextMenu(...arguments),this.menu&&(this.menu.scrollAction="realign")}populateTimeAxisHeaderMenu({items:e}){const r=this,{client:t}=r,i={magnitude:t.timeAxis.shiftIncrement,unit:t.timeAxis.shiftUnit};Object.assign(e,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:r,icon:"b-fw-icon b-icon-search-plus",disabled:!t.presets.count||r.disabled,weight:200,menu:{type:"popup",items:{zoomSlider:{weight:210,type:"slider",minWidth:130,showValue:!1,triggerChangeOnInput:!0}},onBeforeShow({source:n}){const[s]=n.items;s.min=t.minZoomLevel,s.max=t.maxZoomLevel,s.value=t.zoomLevel,r.zoomDetatcher=s.ion({change:"onZoomSliderChange",thisObj:r})},onHide(){r.zoomDetatcher&&(r.zoomDetatcher(),r.zoomDetatcher=null)}}},dateRange:{text:"L{activeDateRange}",localeClass:r,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:r},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:i,internalListeners:{change:r.onRangeDateFieldChange,thisObj:r}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:i,internalListeners:{change:r.onRangeDateFieldChange,thisObj:r}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-previous",color:"b-blue b-raised",flex:1,margin:0,internalListeners:{click:r.onLeftShiftBtnClick,thisObj:r}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,margin:"0 8",internalListeners:{click:r.onTodayBtnClick,thisObj:r}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,internalListeners:{click:r.onRightShiftBtnClick,thisObj:r}}},internalListeners:{paint:r.initDateRangeFields,thisObj:r}}}})}onZoomSliderChange({value:e}){const r=this;r.menu.scrollAction="realign",r.client.zoomLevel=e,r.menu.setTimeout({fn:()=>r.menu.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDateRangeFields({source:e,firstPaint:r}){if(r){const{widgetMap:t}=e;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const r=this,t=e===r.startDateField,{client:i}=r,{timeAxis:n}=i,s=r.startDateFieldInitialValue&&!t?r.startDateFieldInitialValue:r.startDateField.value;let a=r.endDateFieldInitialValue&&t?r.endDateFieldInitialValue:r.endDateField.value;t?r.startDateFieldInitialValue=null:r.endDateFieldInitialValue=null,a-s?a<s&&(a=b.add(s,n.shiftIncrement,n.shiftUnit)):a=b.add(a,n.shiftIncrement,n.shiftUnit),i.setTimeSpan(s,a,VO),r.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=b.clearTime(new Date);this.client.setTimeSpan(e,b.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}};qv._$name="TimeAxisHeaderMenu",j.registerFeature(qv,!0,["Scheduler","TimelineHistogram","Gantt"]);var yh=class extends Ki.mixin(xt){static get $name(){return"TimeRanges"}static get defaultConfig(){return{store:!0}}doDestroy(){var e;(e=this.storeDetacher)==null||e.call(this),super.doDestroy()}get timeRanges(){const e=this;if(!e._timeRanges){const{store:r}=e;let{records:t}=r;if(r.recurringEvents){const{startDate:i,endDate:n}=e.client.timeAxis;t=t.flatMap(s=>s.isRecurring?s.getOccurrencesForDateRange(i,n):s)}e.currentTimeLine&&(r.recurringEvents||(t=t.slice()),t.push(e.currentTimeLine)),e._timeRanges=t}return e._timeRanges}attachToProject(e){var r,t;super.attachToProject(e);const i=this;(r=i.projectTimeZoneChangeDetacher)==null||r.call(i),i.showCurrentTimeLine&&(i.projectTimeZoneChangeDetacher=(t=i.client.project)==null?void 0:t.ion({timeZoneChange:()=>i.updateCurrentTimeLine()}),i.currentTimeLine&&i.updateCurrentTimeLine())}initCurrentTimeLine(){const e=this;if(e.currentTimeLine||!e.showCurrentTimeLine)return;const r=typeof e.showCurrentTimeLine=="object"?e.showCurrentTimeLine:{};e.currentTimeLine=e.store.modelClass.new({id:"currentTime",cls:"b-sch-current-time"},r),e.currentTimeInterval=e.setInterval(()=>e.updateCurrentTimeLine(),e.currentTimeLineUpdateInterval),e._timeRanges=null,e.updateCurrentTimeLine()}updateCurrentTimeLine(){var e;const r=this,{currentTimeLine:t}=r;t.timeZone=(e=r.project)==null?void 0:e.timeZone,t.setLocalDate("startDate",new Date),t.endDate=t.startDate,t.originalData.name||(t.name=b.format(t.startDate,r.currentDateFormat)),r.renderRanges()}hideCurrentTimeLine(){const e=this;e.currentTimeLine&&(e.clearInterval(e.currentTimeInterval),e.currentTimeLine=null,e.refresh())}updateShowCurrentTimeLine(e){e?this.initCurrentTimeLine():this.hideCurrentTimeLine()}populateTimeAxisHeaderMenu({items:e}){e.currentTimeLine={weight:400,text:this.L("L{showCurrentTimeLine}"),checked:this.currentTimeLine,onToggle:({checked:r})=>this.updateShowCurrentTimeLine(r&&this.showCurrentTimeLine)}}attachToStore(e){const r=this;let t=!1;r.storeDetacher&&(r.storeDetacher(),t=!0),r.storeDetacher=e.ion({change:"onStoreChange",refresh:"onStoreChange",thisObj:r}),r._timeRanges=null,t&&r.renderRanges()}get store(){return this.client.project.timeRangeStore}updateStore(e){const r=this,{client:t}=r,{project:i}=t;e=i.timeRangeStore,r.attachToStore(e),t.timeRanges&&!t._timeRangesExposed&&(e.add(t.timeRanges),delete t.timeRanges)}attachToTimeRangeStore(e){this.store=e}resolveTimeRangeRecord(e){return this.store.getById(e.closest(this.baseSelector).dataset.id)}onStoreChange({type:e,action:r}){const t=this;t._timeRanges=null,!(t.disabled||!t.client.isVisible||t.isConfiguring||e==="refresh"&&r!=="batch")&&t.client.runWithTransition(()=>t.renderRanges(),!t.client.refreshSuspended)}onDragStart(e){const r=this,{context:t}=e,i=r.resolveTimeRangeRecord(t.element.closest(r.baseSelector)),n=r.getBodyElementByRecord(i);t.relatedElements=[n],Object.assign(t,{record:i,rangeBodyEl:n,originRangeX:w.getTranslateX(n),originRangeY:w.getTranslateY(n)}),super.onDragStart(e),r.showTip(t)}onDrop(e){const{context:r}=e;if(!r.valid)return this.onInvalidDrop({context:r});const t=this,{client:i}=t,{record:n}=r,s=k.from(r.rangeBodyEl),a=i.getDateFromCoordinate(s.getStart(i.rtl,i.isHorizontal),"round",!1);n.startDate-a!==0?n.setStartDate(a):t.onInvalidDrop(),t.destroyTip(),super.onDrop(e)}onResizeStart({context:e}){const r=this,t=r.resolveTimeRangeRecord(e.element.closest(r.baseSelector)),i=r.getBodyElementByRecord(t);Object.assign(e,{record:t,rangeBodyEl:i}),r.showTip(e)}onResizeDrag({context:e}){const r=this,{rangeBodyEl:t}=e,{client:i}=r,n=k.from(e.element),s=n.getStart(i.rtl,i.isHorizontal),a=n.getEnd(i.rtl,i.isHorizontal),o=i.getDateFromCoordinate(s,"round",!1),l=i.getDateFromCoordinate(a,"round",!1);r.client.isVertical?(e.edge==="top"&&w.setTranslateY(t,e.newY),t.style.height=e.newHeight+"px"):(e.edge==="left"&&w.setTranslateX(t,e.newX),t.style.width=e.newWidth+"px"),r.updateDateIndicator({startDate:o,endDate:l})}onResize({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const r=this,{client:t}=r,{rtl:i}=t,n=e.record,s=k.from(e.element),a=s.getStart(i,t.isHorizontal),o=s.getEnd(i,t.isHorizontal),l=t.getDateFromCoordinate(a,"round",!1),c=i&&e.edge==="right"||!i&&e.edge==="left"||e.edge==="top",d=t.getDateFromCoordinate(o,"round",!1);(c&&n.startDate-l!==0||d&&n.endDate-d!==0)&&d>l?c?n.setStartDate(l,!1):n.setEndDate(d,!1):r.onInvalidResize({context:e}),r.destroyTip()}onInvalidResize({context:e}){const r=this;r.resize.reset(),e.rangeBodyEl.parentElement.lastDomConfig=e.rangeBodyEl.lastDomConfig=null,r.renderRanges(),r.destroyTip()}};E(yh,"configurable",{store:{modelClass:St},currentTimeLineUpdateInterval:1e4,currentDateFormat:"HH:mm",showCurrentTimeLine:!1}),yh._$name="TimeRanges",j.registerFeature(yh,!1,["Scheduler","Gantt"]);var bh=class extends Ki{static get configurable(){return{enableResizing:!0,showTooltip:!1,dragTipTemplate:null,cls:"b-selected-time-span",dragHelperConfig:{skipUpdatingElement:!0},resizeHelperConfig:{skipUpdatingElement:!0},headerRenderer({timeRange:e}){const{dateFormat:r}=this.client.timeAxisViewModel.bottomHeader;return`<span class="b-selection-start">${b.format(e.startDate,r)}</span>
                        <span class="b-selection-end">${b.format(e.endDate,r)}</span>
                        <i class='b-icon b-icon-close' data-ref="closeButton" data-btip="L{Popup.close}"></i>`},selectedTimeSpan:null}}onUIReady(){super.onUIReady(),this.client.ion({timeAxisHeaderMouseDown:"onTimeAxisHeaderMouseDown",thisObj:this})}onTimeAxisHeaderMouseDown({startDate:e,endDate:r}){this.disabled||(this.selectedTimeSpan={startDate:e,endDate:r})}onTimeRangeClick(e){super.onTimeRangeClick(e);const r=this;!r.disabled&&e.target.closest(".b-selected-time-span")&&(e.target.matches('[data-ref="closeButton"]')?r.selectedTimeSpan=null:r.client.trigger("timeSelectionElementClick",{...r.selectedTimeSpan,domEvent:e}))}updateFromCoords(e,r,t,i){const{client:n}=this,s=n.isHorizontal?t:i;let a=n.isHorizontal?e:r;n.rtl&&n.isHorizontal&&(a=Math.max(n.timeAxisViewModel.totalSize-a-s,0));const o=n.getDateFromCoord({coord:a,roundingMethod:"round",ignoreRTL:!0}),l=n.getDateFromCoord({coord:a+s,roundingMethod:"round",ignoreRTL:!0});this.selectedTimeSpan={startDate:b.max(o,n.startDate),endDate:b.min(l,n.endDate)}}onResizeStart({source:e}){const{timeAxisViewModel:r,timeResolution:t}=this.client,i=b.asMilliseconds(t.increment,t.unit);this.resize.minWidth=r.getDistanceForDuration(i)}onResizeDrag({context:e}){var r,t;this.updateFromCoords(e.newX,e.newY,(r=e.newWidth)!=null?r:e.elementWidth,(t=e.newHeight)!=null?t:e.elementHeight)}onDragStart(e){super.onDragStart(e);const{context:r}=e;r.elementWidth=r.element.offsetWidth,r.elementHeight=r.element.offsetHeight}onDrag({context:e}){this.updateFromCoords(e.newX,e.newY,e.elementWidth,e.elementHeight)}onDrop(){this.client.element.classList.remove("b-dragging-timerange")}onDragReset(){this.refresh()}get timeRanges(){return this.selectedTimeSpan?[this.selectedTimeSpan]:[]}shouldRenderRange(){return!0}changeSelectedTimeSpan(e){return e&&(e.id="time-selection"),e}updateSelectedTimeSpan(e){this.isConfiguring||this.refresh(),this.client.trigger("timeSelectionChange",{...e!=null?e:{}})}};E(bh,"$name","TimeSelection"),bh._$name="TimeSelection",j.registerFeature(bh,!1,"Scheduler");var Ji={completeview:"completeview",currentview:"currentview",daterange:"daterange"},NO=Promise.resolve(),Kv=e=>class extends e{async scrollRowIntoView(t,i){const{rowManager:n,scrollable:s}=t,a=s.y;return i<t.store.count&&(s.scrollTo(null,n.calculateTop(i)),s.y!==a)?new Promise(o=>{const l=t.ion({scroll({scrollTop:c}){c!=null&&n.getRow(i)&&(l(),o())}})}):NO}async scrollToDate(t,i){let n=!1;const s=[],a=t.timeAxisSubGrid.scrollable.ion({scrollStart({x:o}){o!=null&&(n=!0)}});s.push(t.scrollToDate(i,{block:"start"})),a(),n&&s.push(t.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(s)}cloneElement(t,i,n){super.cloneElement(t,i,n);const s=this.element.querySelector(".b-schedulerbase");s==null||s.classList.remove(...["fade-in","slide-from-left","slide-from-top","zoom-in"].map(a=>`b-initial-${a}`))}async prepareComponent(t){const i=this,{client:n}=t,{currentOrientation:s}=n,a=n.timeAxisSubGrid.width>0;switch(t.scheduleRange){case Ji.completeview:t.rangeStart=n.startDate,t.rangeEnd=n.endDate;break;case Ji.currentview:{const{startDate:u,endDate:h}=n.visibleDateRange;t.rangeStart=u,t.rangeEnd=h;break}}await n.waitForAnimations(),t.infiniteScroll=n.infiniteScroll,n.infiniteScroll=!1,a&&(n.setTimeSpan(t.rangeStart,t.rangeEnd),n.svgCanvas),i._oldEnableEventAnimations=n.enableEventAnimations,n.enableEventAnimations=!1,s.isHorizontalRendering&&(i._oldScrollBuffer=s.scrollBuffer,i._oldVerticalBuffer=s.verticalBufferSize,s.scrollBuffer=100,s.verticalBufferSize=-1),n.ignoreViewBox=!0,await super.prepareComponent(t);const{exportMeta:o,element:l}=i,c=l.querySelector(".b-sch-foreground-canvas"),d=l.querySelector(".b-horizontaltimeaxis");if(o.includeTimeline=a,a&&t.scheduleRange!==Ji.completeview){o.totalWidth-=o.subGrids.normal.width,o.totalWidth+=o.subGrids.normal.width=n.timeAxisViewModel.getDistanceBetweenDates(t.rangeStart,t.rangeEnd);const u=Math.ceil(o.totalWidth/o.pageWidth),h=u*o.verticalPages;o.horizontalPages=u,o.totalPages=h,o.subGrids.normal.scrollLeft=n.getCoordinateFromDate(t.rangeStart)}if(o.timeAxisHeaders=[],o.timeAxisPlaceholders=[],o.headersColleted=!1,w.forEachSelector(d,".b-sch-header-row",u=>{o.timeAxisPlaceholders.push(i.createPlaceholder(u)),o.timeAxisHeaders.push(new Map)}),o.subGrids.normal.eventsPlaceholder=i.createPlaceholder(c,!1),w.removeEachSelector(c,".b-sch-event-wrap,.b-sch-resourcetimerange"),w.removeEachSelector(i.element,".b-released"),o.eventsBoxes=new Map,o.client=n,n.hasActiveFeature("columnLines")){const u=l.querySelector(".b-column-lines-canvas");o.columnLinesPlaceholder=i.createPlaceholder(u),o.columnLines={lines:new Map,majorLines:new Map}}if(n.hasActiveFeature("timeRanges")){const u=l.querySelector(".b-sch-timeaxiscolumn .b-sch-timeranges-canvas"),h=l.querySelector(".b-sch-foreground-canvas .b-sch-timeranges-canvas");o.timeRanges={},u&&(o.timeRanges.header=t.enableDirectRendering?"":{},o.timeRangesHeaderPlaceholder=i.createPlaceholder(u)),o.timeRanges.body=t.enableDirectRendering?"":{},o.timeRangesBodyPlaceholder=i.createPlaceholder(h)}if(n.hasActiveFeature("dependencies")){n.features.dependencies.fillDrawingCache();const u=l.querySelector(`[id="${n.svgCanvas.getAttribute("id")}"]`);u&&(o.dependencyCanvasEl=u,o.dependenciesPlaceholder=i.createPlaceholder(u,!1,{ns:"http://www.w3.org/2000/svg",tag:"path"}),w.removeEachSelector(u,".b-sch-dependency"))}a&&!b.betweenLesser(t.rangeStart,n.startDate,n.endDate)&&await i.scrollToDate(n,t.rangeStart)}async restoreState(t){let i=!1;const{client:n}=t,s=[],a=n.timeAxisSubGrid.scrollable.ion({scrollStart({x:o}){this.element.scrollLeft!==o&&(i=!0)}});s.push(super.restoreState(t)),a(),i&&s.push(n.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(s)}async restoreComponent(t){const{client:i}=t,{currentOrientation:n}=i;i.ignoreViewBox=!1,i.infiniteScroll=t.infiniteScroll,i.enableEventAnimations=this._oldEnableEventAnimations,n.isHorizontalRendering&&(n.scrollBuffer=this._oldScrollBuffer,n.verticalBufferSize=this._oldVerticalBuffer),await super.restoreComponent(t)}async onRowsCollected(t,i){const n=this;if(await super.onRowsCollected(t,i),n.exportMeta.includeTimeline){const{client:s,enableDirectRendering:a}=i,{timeView:o}=s,{pageRangeStart:l,pageRangeEnd:c}=n.getCurrentPageDateRange(i);if(a)l&&c&&(n.renderHeaders(i,l,c),n.renderLines(i,l,c),n.renderRanges(i,l,c),n.renderEvents(i,t,l,c));else{if(l){let d=!1;for(await n.scrollToDate(s,l);!d;)if(n.collectLines(i),n.collectHeaders(i),n.collectRanges(i),n.collectEvents(t,i),b.timeSpanContains(o.startDate,o.endDate,l,c))d=!0;else if(o.endDate.getTime()>=c.getTime())d=!0;else{const u=o.endDate;if(await n.scrollToDate(s,o.endDate),u.getTime()===o.endDate.getTime())throw new Error("Could not scroll to date")}}await n.scrollToDate(s,i.rangeStart)}}}getCurrentPageDateRange({rangeStart:t,rangeEnd:i,enableDirectRendering:n,client:s}){const a=this,{exportMeta:o}=a,{horizontalPages:l,horizontalPosition:c,pageWidth:d,subGrids:u}=o;let h,g;if(l>1){const f=c*d,m=(c+1)*d,p=u.locked.width+u.locked.splitterWidth;if(m<=p)g=h=null;else{const{scrollLeft:v=0}=u.normal;h=s.getDateFromCoordinate(Math.max(f-p+v,0));const y=n?1:1.2;g=s.getDateFromCoordinate((m-p+v)*y)||i}}else h=t,g=i;return{pageRangeStart:h,pageRangeEnd:g}}prepareExportElement(){const{element:t,exportMeta:i}=this,{id:n,headerId:s,footerId:a,scrollLeft:o}=i.subGrids.normal,l=t.querySelector(`[id="${n}"]`);return[".b-sch-background-canvas",".b-sch-foreground-canvas"].forEach(c=>{const d=l.querySelector(c);d&&(i.lastExportedRowBottom?d.style.height=`${i.lastExportedRowBottom}px`:d.style.height="",o&&(d.style.marginLeft=`-${o}px`))}),o&&[s,a].forEach(c=>{const d=t.querySelector(`[id="${c}"] .b-widget-scroller`);d&&(d.style.marginLeft=`-${o}px`)}),super.prepareExportElement()}collectHeaders(t){const i=this,{client:n}=t,{exportMeta:s}=i;if(!s.headersCollected){const a=n.timeView.element,o=s.timeAxisHeaders;w.forEachSelector(a,".b-sch-header-row",(l,c,d)=>{const u=o[c];w.forEachSelector(l,".b-sch-header-timeaxis-cell",h=>{u.has(h.dataset.tickIndex)||u.set(h.dataset.tickIndex,h.outerHTML)}),c===d.length-1&&u.has(String(n.timeAxis.count-1))&&(s.headersCollected=!0)})}}collectRanges(t){const i=this,{client:n}=t,{exportMeta:s}=i,{timeRanges:a}=s;if(!s.headersCollected&&a){const{headerCanvas:o,bodyCanvas:l}=n.features.timeRanges;o&&w.forEachSelector(o,".b-sch-timerange",c=>{a.header[c.dataset.id]=c.outerHTML}),w.forEachSelector(l,".b-sch-timerange",c=>{a.body[c.dataset.id]=c.outerHTML})}}collectLines(t){const i=this,{client:n}=t,{exportMeta:s}=i,{columnLines:a}=s;if(!s.headersCollected&&a){const o=n.backgroundCanvas;w.forEachSelector(o,".b-column-line, .b-column-line-major",l=>{if(l.classList.contains("b-column-line")){const c=Number(l.dataset.line.replace(/line-/,""));a.lines.set(c,l.outerHTML)}else{const c=Number(l.dataset.line.replace(/major-/,""));a.majorLines.set(c,l.outerHTML)}})}}collectEvents(t,i){const n=this,s=t.length,{client:a}=i,o=n.exportMeta.subGrids.normal.rows;t.forEach((l,c)=>{var d,u;const h=o[o.length-s+c],g=a.store.getAt(l.dataIndex),f=h[3];(d=g.events)==null||d.forEach(m=>{if(m.isScheduled){let p=a.getElementFromEventRecord(m,g);p&&(p=p.parentElement)&&!f.has(m.id)&&f.set(m.id,[p.outerHTML,k.from(p,p.offsetParent)])}}),(u=g.timeRanges)==null||u.forEach(m=>{var p;const v=((p=a.features.resourceTimeRanges)==null?void 0:p.generateElementId(m))||"",y=a.foregroundCanvas.syncIdMap[v];y&&!f.has(v)&&f.set(v,[y.outerHTML,k.from(y,y.offsetParent)])})})}renderHeaders(t,i,n){const s=this,{exportMeta:a}=s,{client:o}=t,l=a.timeAxisHeaders,{timeAxisView:c}=o.timeAxisColumn,d=c.buildCells(i,n),u=document.createElement("div");X.sync({targetElement:u,domConfig:d}),w.forEachSelector(u,".b-sch-header-row",(h,g)=>{const f=l[g];w.forEachSelector(h,".b-sch-header-timeaxis-cell",m=>{f.has(m.dataset.tickIndex)||f.set(m.dataset.tickIndex,m.outerHTML)})})}renderEvents(t,i,n,s){const a=this,{client:o}=t,l=a.exportMeta.subGrids.normal.rows;i.forEach((c,d)=>{const u=l[d],h=u[3],g=o.store.getAt(c.dataIndex),f=o.currentOrientation.getResourceLayout(g),m=o.getCoordinateFromDate(n),p=o.getCoordinateFromDate(s),v=o.currentOrientation.getEventDOMConfigForCurrentView(f,c,m,p),y=document.createElement("div");v.forEach(C=>{const{eventId:D}=C.dataset,{left:S,top:x,width:R,height:I}=C.style;X.sync({targetElement:y,domConfig:C}),h.set(D,[y.outerHTML,new k(S,x,R,I)])})})}renderLines(t,i,n){const s=this,{client:a}=t,{exportMeta:o}=s,{columnLines:l}=o;if(l){const c=a.features.columnLines.getColumnLinesDOMConfig(i,n),d=document.createElement("div");X.sync({targetElement:d,domConfig:{children:c},onlyChildren:!0}),l.lines.set(0,d.innerHTML)}}renderRanges(t,i,n){const s=this,{client:a}=t,{exportMeta:o}=s,{timeRanges:l}=o;if(l){const c=a.features.timeRanges.getDOMConfig(i,n),d=document.createElement("div");c.forEach((u,h)=>{X.sync({targetElement:d,domConfig:{children:u,onlyChildren:!0}}),h===0?l.body=d.innerHTML:l.header=d.innerHTML})}}buildPageHtml(t){const i=this,{subGrids:n,timeAxisHeaders:s,timeAxisPlaceholders:a,columnLines:o,columnLinesPlaceholder:l,timeRanges:c,timeRangesHeaderPlaceholder:d,timeRangesBodyPlaceholder:u}=i.exportMeta,{enableDirectRendering:h}=t;let g=i.prepareExportElement();if(Object.values(n).forEach(({placeHolder:f,eventsPlaceholder:m,rows:p,mergedCellsHtml:v})=>{const y=f.outerHTML,{resources:C,events:D}=i.positionRows(p,t);let S=C.join("");v!=null&&v.length&&(S+=`<div class="b-grid-merged-cells-container">${v.join("")}</div>`),g=g.replace(y,S),m&&(g=g.replace(m.outerHTML,D.join("")))}),s.forEach((f,m)=>{g=g.replace(a[m].outerHTML,Array.from(f.values()).join(""))}),o){const f=Array.from(o.lines.values()).concat(Array.from(o.majorLines.values()));g=g.replace(l.outerHTML,f.join("")),h&&(i.exportMeta.columnLines.lines.clear(),i.exportMeta.columnLines.majorLines.clear())}return c&&(h?(g=g.replace(u.outerHTML,c.body),d&&(g=g.replace(d.outerHTML,c.header)),i.exportMeta.timeRanges={}):(g=g.replace(u.outerHTML,Object.values(c.body).join("")),d&&(g=g.replace(d.outerHTML,Object.values(c.body).join(""))))),g=i.buildDependenciesHtml(g),g}getEventBox(t){const i=this,{eventsBoxes:n,enableDirectRendering:s}=i.exportMeta,a=t&&n.get(String(t.id));return s&&a&&t.isMilestone&&a.translate(-a.width/2,0),a}renderDependencies(){const t=this,{client:i,eventsBoxes:n}=t.exportMeta,{dependencies:s}=i,a=i.features.dependencies,o=w.createElement();let l=!1;return s.forEach(c=>{if(!n.has(String(c.from))&&!n.has(String(c.to))||!a.isDependencyVisible(c))return;const d=t.getEventBox(c.fromEvent),u=t.getEventBox(c.toEvent);a.drawDependency(c,!0,{from:d==null?void 0:d.clone(),to:u==null?void 0:u.clone()}),l=!0}),l&&a.domSync(o),o.innerHTML}buildDependenciesHtml(t){const{dependenciesPlaceholder:i,includeTimeline:n}=this.exportMeta;if(i&&n){const s=i.outerHTML;t=t.replace(s,this.renderDependencies())}return t}},Ch=class extends Kv(Ia){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}positionRows(e){const r=[],t=[];return e.forEach(([i,n,s,a])=>{r.push(i),a&&Array.from(a.entries()).forEach(([o,[l,c,d=[]]])=>{t.push(l+d.join("")),this.exportMeta.eventsBoxes.set(String(o),c)})}),{resources:r,events:t}}};Ch._$name="MultiPageExporter";var Sh=class extends Kv(Pa){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}async prepareComponent(e){await super.prepareComponent(e),e.scheduleRange!==Ji.completeview&&this.estimateTotalPages(e)}positionRows(e){const r=[],t=[];return e.forEach(([i,,,n])=>{r.push(i),n&&Array.from(n.entries()).forEach(([s,[a,o,l=[]]])=>{t.push(a+l.join("")),this.exportMeta.eventsBoxes.set(String(s),o)})}),{resources:r,events:t}}};Sh._$name="MultiPageVerticalExporter";var Xv=class extends Fe{static get $name(){return"ScheduleRangeCombo"}static get type(){return"schedulerangecombo"}static get defaultConfig(){return{editable:!1,localizeDisplayFields:!0,displayField:"text",buildItems(){return Object.entries(Ji).map(([e,r])=>({value:e,text:"L{"+r+"}"}))}}}};Xv.initClass(),Xv._$name="ScheduleRangeCombo";var Zv=class extends Xl{static get $name(){return"SchedulerExportDialog"}static get type(){return"schedulerexportdialog"}static get configurable(){return{defaults:{localeClass:this},items:{scheduleRangeField:{type:"schedulerangecombo",label:"L{Schedule range}",value:"completeview",weight:150,onChange({value:e}){this.parent.widgetMap.rangesContainer.hidden=e!==Ji.daterange}},rangesContainer:{type:"container",flex:"1 0 100%",weight:151,hidden:!0,defaults:{localeClass:this},items:{filler:{weight:0,type:"widget",style:"margin-inline-end: -1em;"},rangeStartField:{type:"datefield",label:"L{Export from}",labelWidth:"3em",flex:"1 0 25%",weight:10,onChange({value:e}){this.parent.widgetMap.rangeEndField.min=b.add(e,1,"d")}},rangeEndField:{type:"datefield",label:"L{Export to}",labelWidth:"1em",flex:"1 0 25%",weight:30,onChange({value:e}){this.parent.widgetMap.rangeStartField.max=b.add(e,-1,"d")}}}}}}}onLocaleChange(){const e=this.L("labelWidth");this.width=this.L("L{width}"),this.items.forEach(r=>{r instanceof Ue?r.labelWidth=e:r.ref==="rangesContainer"&&(r.items[0].width=e)})}applyInitialValues(e){super.applyInitialValues(e);const r=this,{client:t,scheduleRange:i}=e,n=e.items=e.items||{},s=n.scheduleRangeField=n.scheduleRangeField||{},a=n.rangesContainer=n.rangesContainer||{},o=a.items=a.items||{},l=o.filler=o.filler||{},c=o.rangeStartField=o.rangeStartField||{},d=o.rangeEndField=o.rangeEndField||{};l.width=r.L("labelWidth"),s.value=s.value||i,s.value===Ji.daterange&&(a.hidden=!1);const u=c.value=c.value||t.startDate;c.max=b.max(t.startDate,b.add(t.endDate,-1,"d"));let h=d.value||t.endDate;h<=u&&(h=b.add(u,1,"d")),d.value=h,d.min=b.min(t.endDate,b.add(t.startDate,1,"d"))}};Zv._$name="SchedulerExportDialog";var Dh=class extends Kv(Zl){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}collectDependencies(){}positionRows(e,r){const t=[],i=[],n=/translate\((\d+.?\d*)px, (\d+.?\d*)px\)/,s=/top:.+?px/;if(r.enableDirectRendering)e.forEach(([a,,,o])=>{t.push(a),o&&Array.from(o.entries()).forEach(([l,[c,d,u=[]]])=>{this.exportMeta.eventsBoxes.set(String(l),d),i.push(c+u.join(""))})});else{let a=0;e.forEach(([o,l,c,d])=>{t.push(o.replace(n,`translate($1px, ${a}px)`));const u=a-l;d&&Array.from(d.entries()).forEach(([h,[g,f]])=>{f.translate(0,u),this.exportMeta.eventsBoxes.set(String(h),f),i.push(g.replace(s,`top: ${f.y}px`))}),a+=c})}return{resources:t,events:i}}};Dh._$name="SinglePageExporter";var wh=class extends xu{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[Dh,Ch,Sh],dialogClass:Zv,scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){return T.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"])}buildExportConfig(e){e=super.buildExportConfig(e);const{scheduleRange:r,rangeStart:t,rangeEnd:i}=this;return e.columns&&!e.columns.find(n=>n.type==="timeAxis")&&e.columns.push(e.client.timeAxisColumn.id),T.assign({scheduleRange:r,rangeStart:t,rangeEnd:i},e)}};wh._$name="PdfExport",j.registerFeature(wh,!1,"Scheduler");var Jv=class extends We(Ru){static get defaultConfig(){return{includeUnassigned:!0,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140},{text:"Ends",field:"endDate",width:140}],eventSortFn:null}}construct(e={},...r){super.construct(e,...r),this.eventSortFn||(this.eventSortFn=(t,i)=>t.internalId-i.internalId)}normalizeColumns(e){super.normalizeColumns(e),e.eventColumns=e.eventColumns.map(r=>typeof r=="string"?{field:r}:r)}generateExportData(e){const r=this,t=this.target instanceof pr,i=r.generateColumns(e),n=t?r.generateEventColumns(e):[],s=i.concat(n),a=r.generateRows(e);return{columns:s,rows:a}}generateEventColumns(e){return e.eventColumns.map(r=>this.processEventColumn(r,e))}processEventColumn(e,r){const{width:t,minWidth:i}=e,{defaultColumnWidth:n}=r;return{field:e.field,value:e.text,width:Math.max(t||n,i||n),eventColumn:!0,type:this.getColumnType(e,this.target.eventStore)}}generateRows(e){const r=this,{target:t}=r;let i;if(!(t instanceof pr))i=super.generateRows(e);else{if(i=[],t.resourceStore.map(n=>{const s=n.events||[];s.sort(r.eventSortFn),s.length||s.push(""),s.forEach(a=>i.push(r.getRowData(e,n,a)))}),e.includeUnassigned&&e.eventColumns.length){const n=t.eventStore.query(s=>!s.resources.length);if(n.length){const s=new Array(e.columns.length).fill("");s.push(r.L("L{ExcelExporter.No resource assigned}")),i.push(s),n.forEach(a=>i.push(r.getRowData(e,null,a)))}}i=i.filter(n=>n.length)}return i}getRowData(e,r,t){const{columns:i,eventColumns:n}=e,s=[],a=this.processRecord(r,i,e);if(a&&s.push(...a),!r||!r.isSpecialRow){const o=this.processRecord(t,n,e);o&&s.push(...o)}return s}};Jv._$name="ScheduleTableExporter";var Qv=class extends Tu{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{exporterClass:Jv,exporterConfig:null}}};Qv._$name="ExcelExporter",j.registerFeature(Qv,!1,"Scheduler");var ey=class extends pr{static get $name(){return"Scheduler"}static get type(){return"scheduler"}};ey.initClass(),ey._$name="Scheduler";var R0=e=>{var r;return r=class extends(e||F){static get properties(){return{recordsToRefresh:new Set}}beforeRenderRow({record:t}){var i;return(i=this.recordIsReadyForRendering)!=null&&i.call(this,t)&&this.unscheduleRecordRefresh(t),super.beforeRenderRow(...arguments)}cleanupScheduledRecord(){const{rowManager:t,store:i}=this;for(const n of[...this.recordsToRefresh])(!n.stores.includes(i)||!t.getRowById(n))&&this.recordsToRefresh.delete(n)}renderScheduledRecords(){const t=this;if(t.refreshSuspended)t.scheduleRecordRefresh();else{t.cleanupScheduledRecord();const{rowManager:i}=t,n=[...t.recordsToRefresh],s=n.map(a=>i.getRowById(a));s.length&&(i.renderRows(s),t.trigger("scheduledRecordsRender",{records:n,rows:s})),t.recordsToRefresh.size&&t.scheduleRecordRefresh()}}unscheduleRecordRefresh(t=!0){const i=this;t===!0?i.recordsToRefresh.clear():t&&H.asArray(t).forEach(n=>i.recordsToRefresh.delete(n)),i.scheduledRecordsRefreshTimer&&!i.recordsToRefresh.size&&i.clearTimeout(i.scheduledRecordsRefreshTimer)}scheduleRecordRefresh(t){const i=this;t&&H.asArray(t).forEach(n=>i.recordsToRefresh.add(n)),i.scheduledRecordsRefreshTimer=i.setTimeout({fn:"renderScheduledRecords",delay:i.scheduledRecordsRefreshTimeout,cancelOutstanding:!0})}get widgetClass(){}},E(r,"$name","DelayedRecordsRendering"),E(r,"configurable",{scheduledRecordsRefreshTimeout:10}),r},ty=class extends F{construct(e){super.construct(),this.client=e}init(){}onTimeAxisViewModelUpdate(){const{scrollable:e}=this.client.timeAxisSubGrid;this.updateFromHorizontalScroll(e.x)}updateFromHorizontalScroll(e){const r=this,{client:t,scrollBuffer:i}=r,{timeAxisSubGrid:n,timeAxis:s,rtl:a}=t,{width:o}=n,{totalSize:l}=t.timeAxisViewModel,c=e,d=n.scrollable.maxX!==0&&Math.abs(n.scrollable.maxX)<=Math.round(c)+5,u=t.getDateFromCoord({coord:Math.max(0,c-i),ignoreRTL:!0}),h=d?s.endDate:t.getDateFromCoord({coord:c+o+i,ignoreRTL:!0})||s.endDate;if(u&&!t._viewPresetChanging){r._visibleDateRange={startDate:u,endDate:h,startMS:u.getTime(),endMS:h.getTime()},r.viewportCoords=a?{left:l-e-o+i,right:l-e-i}:{left:e-i,right:e+o+i};const g=t.timeView.range={startDate:u,endDate:h};if(t.onVisibleDateRangeChange(g),!t.refreshSuspended&&t.rowManager.rows.length){if(t.rowManager.rows[0].id===null)return;(r._timeAxisStartDate-s.startDate||r._timeAxisEndDate-s.endDate)&&(r._timeAxisStartDate=s.startDate,r._timeAxisEndDate=s.endDate,t.rowManager.renderRows(t.rowManager.rows))}}}onViewportResize(){}refreshRows(){}get visibleDateRange(){return this._visibleDateRange}translateToPageCoordinate(e){const{client:r}=this,{scrollable:t}=r.timeAxisSubGrid;let i=e+r.timeAxisSubGridElement.getBoundingClientRect().left;return r.rtl?i-=t.maxX-Math.abs(r.scrollLeft):i-=r.scrollLeft,i}translateToScheduleCoordinate(e){const{client:r}=this,{scrollable:t}=r.timeAxisSubGrid;let i=e-r.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return r.rtl?i+=t.maxX-Math.abs(r.scrollLeft):i+=r.scrollLeft,i}getDateFromXY(e,r,t,i=!1){const{client:n}=this;let s=e[0];return t||(s=this.translateToScheduleCoordinate(s)),s=n.getRtlX(s),n.timeAxisViewModel.getDateFromPosition(s,r,i)}};E(ty,"configurable",{scrollBuffer:0}),ty._$name="TimelineHistogramRendering";var zO={series:null,topValue:null},WO=()=>{},Qi=class extends ns.mixin(R0){static get properties(){return{histogramDataByRecord:new Map,collectingDataFor:new Map}}updateGetRecordData(e){this._getRecordData=e?this.resolveCallback(e):null}updateHardRefreshOnTimeAxisReconfigure(e){const r="hardRefreshOnTimeAxisReconfigure";e?this.timeAxis.ion({name:r,endReconfigure:"onTimeAxisEndReconfigure",thisObj:this}):this.detachListeners(r)}construct(e){super.construct(e);const r=this;r.scheduleRefreshRows=r.createOnFrame(r.refreshRows,[],r,!0),r.rowManager.ion({beforeRowHeight:"onBeforeRowHeight",thisObj:r})}onDestroy(){var e;this.clearHistogramDataCache(),(e=this._histogramWidget)==null||e.destroy(),this.barTooltip=null}resolveTimeSpanRecord(e){}getScheduleMouseEventParams(e,r){return{record:this.store.getById(e.id)}}get currentOrientation(){return this._currentOrientation||(this._currentOrientation=new ty(this)),this._currentOrientation}updateSeries(e){const r=this;r.histogramWidget.series=e,r._series=r.histogramWidget.series,r.isPainted&&!r.isConfiguring&&r.scheduleRefreshRows()}getAsyncEventSuffixForStore(e){return e.isAbstractPartOfProjectStoreMixin?"PreCommit":""}scheduleRefreshRows(){}getRowHeight(){return this.rowHeight}onPaint({firstPaint:e}){super.onPaint({firstPaint:e}),e&&this.showBarTip&&(this.barTooltip={})}updateGetBarTip(e){return e&&(this.barTooltipTemplate=null),e}changeBarTooltip(e,r){return r==null||r.destroy(),e?e.isTooltip?e:this.barTooltipClass.new({forElement:this.timeAxisSubGridElement,forSelector:".b-histogram rect",hoverDelay:0,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:this.getTipHtml.bind(this)},this.showBarTip,e):null}async getTipHtml(e){if(this.showBarTip&&this.barTooltipTemplate){const{activeTarget:r}=e,t=parseInt(r.dataset.index,10),i=this.getRecordFromElement(r),n=await this.getRecordHistogramData(i);return this.barTooltipTemplate({...e,datum:this.extractHistogramDataArray(n,i)[t],record:i,index:t})}}collectTicksWidth(){const{ticks:e}=this.timeAxis,r=e[0].endDate-e[0].startDate,t={0:r};let i=r,n=!0;for(let s=1,{length:a}=e;s<a;s++){const o=e[s],l=o.endDate-o.startDate;r!==l&&(n=!1),i+=l,t[s]=l}if(n)this.ticksWidth=null;else{const s={};for(let a=0,{length:o}=e;a<o;a++)s[a]=t[a]/i;this.ticksWidth=s}}changeHistogramWidget(e){var r;const t=this;return e&&!e.isHistogram&&(t.getBarTextRenderData&&!e.getBarTextRenderData&&(e.getBarTextRenderData=t.getBarTextRenderData),e=t.histogramWidgetClass.new({owner:t,appendTo:t.element,height:t.rowHeight,width:((r=t.timeAxisColumn)==null?void 0:r.width)||0,getBarTip:!t.barTooltipTemplate&&t.getBarTip||WO,getRectClass:t.getRectClass||t.getRectClassDefault,getBarText:t.getBarText||t.getBarTextDefault,getOutlineClass:t.getOutlineClass,getRectConfig:t.getRectConfig},e),e.suspendRefresh(),t.getBarTextDefault=t.getBarTextDefault.bind(e)),e}getRectClassDefault(e,r,t){}getBarTextDefault(e,r){}updateShowBarTip(e){this.barTooltip=e}get columns(){return super.columns}set columns(e){const r=this;super.columns=e,r.isDestroying||(r.timeAxisColumn.renderer=r.histogramRenderer.bind(r),r.timeAxisColumn.cellCls=r.timeAxisColumnCellCls)}onHistogramDataCacheSet({record:e,data:r}){this.scheduleRecordRefresh(e)}onTimeAxisEndReconfigure(){this.hardRefreshOnTimeAxisReconfigure&&(this.clearHistogramDataCache(),this.scheduleRefreshRows())}onStoreUpdateRecord({record:e,changes:r}){const t=this;return!t.getRecordData&&t.dataModelField&&r[t.dataModelField]&&t.clearHistogramDataCache(e),super.onStoreUpdateRecord(...arguments)}onStoreRemove({records:e}){super.onStoreRemove(...arguments);for(const r of e)this.clearHistogramDataCache(r)}onBeforeRowHeight({height:e}){if(this._timeAxisColumn){const r=this._histogramWidget;r&&(r.height=e,r.onElementResize(r.element))}}onTimeAxisViewModelUpdate(){super.onTimeAxisViewModelUpdate(...arguments);const e=this._histogramWidget;e&&(e.width=this.timeAxisViewModel.totalSize,e.onElementResize(e.element)),this.collectTicksWidth()}extractHistogramDataArray(e,r){return e}processRecordRenderData(e){return e}clearHistogramDataCache(e){e?this.histogramDataByRecord.delete(e):this.histogramDataByRecord.clear()}setHistogramDataCache(e,r){const t={record:e,data:r};this.trigger("beforeHistogramDataCacheSet",t),this.histogramDataByRecord.set(t.record,t.data),this.trigger("histogramDataCacheSet",t)}getHistogramDataCache(e){return e?this.histogramDataByRecord.get(e):this.histogramDataByRecord}hasHistogramDataCache(e){return this.histogramDataByRecord.has(e)}finalizeDataRetrievingInternal(e,r){return this.collectingDataFor.delete(e),this.setHistogramDataCache(e,r),r}finalizeDataRetrieving(e,r){return N.isPromise(r)?(this.collectingDataFor.set(e,r),r.then(t=>this.finalizeDataRetrievingInternal(e,t))):this.finalizeDataRetrievingInternal(e,r)}getRecordHistogramData(e){const r=this,{getRecordData:t}=r;let i=r.collectingDataFor.get(e)||r.getHistogramDataCache(e);return!i&&!r.hasHistogramDataCache(e)&&(t?i=t.handler.call(t.thisObj,...arguments):i=e.get(r.dataModelField),i=r.finalizeDataRetrieving(e,i)),i}recordIsReadyForRendering(e){return!this.collectingDataFor.has(e)}beforeRenderRow(e){const r=this,t=r.getRecordHistogramData(e.record);if(!N.isPromise(t)){const i=t?r.extractHistogramDataArray(t,e.record):[];if(r.ticksWidth)for(let s=0,{length:a}=i;s<a;s++)i[s].width=r.ticksWidth[s];const n=N.merge({topValue:null},r.initialConfig.histogramWidget,{data:i,series:{...r.series}});e={...e,histogramConfig:n,histogramData:t,histogramWidget:r.histogramWidget},r.trigger("beforeRenderHistogramRow",e),delete e.eventName,delete e.source,delete e.type,delete e.oldId,delete e.row,delete e.recordIndex,r._recordRenderData=r.processRecordRenderData(e)}super.beforeRenderRow(...arguments)}applyHistogramWidgetConfig(e=this.histogramWidget,r){Object.assign(e,zO,r)}renderRecordHistogram(e){const r=this,{histogramData:t,cellElement:i}=e;if(!t){i.innerHTML="";return}r.trigger("beforeRenderRecordHistogram",e),delete e.eventName,delete e.type,delete e.source;const n=e.histogramWidget||r.histogramWidget;r.applyHistogramWidgetConfig(n,e.histogramConfig),n.refresh({args:[e]});const s=n.element.cloneNode(!0);s.removeAttribute("id"),s.classList.remove("b-hide-offscreen"),i.innerHTML="",i.appendChild(s)}histogramRenderer(e){const r=this,t=e.histogramData||r.getRecordHistogramData(e.record);return N.isPromise(t)?"":(Object.assign(e,r._recordRenderData),r.renderRecordHistogram(...arguments))}buildGroupHeader(e){return e.column===this.timeAxisColumn?this.histogramRenderer(e):this.features.group.buildGroupHeader(e)}get widgetClass(){}};E(Qi,"$name","TimelineHistogramBase"),E(Qi,"type","timelinehistogrambase"),E(Qi,"configurable",{timeAxisColumnCellCls:"b-sch-timeaxis-cell b-timelinehistogram-cell",mode:"horizontal",rowHeight:50,showBarTip:!1,barTooltip:null,barTooltipClass:ve,series:null,dataModelField:"histogramData",getRecordData:null,hardRefreshOnTimeAxisReconfigure:!0,getRectClass:null,getOutlineClass(e){return""},readOnly:!0,getBarTip:null,barTooltipTemplate:null,getBarText:null,getRectConfig:null,getBarTextRenderData:void 0,histogramWidgetClass:Yn,histogramWidget:{cls:"b-hide-offscreen b-timelinehistogram-histogram",omitZeroHeightBars:!0,data:[]},fixedRowHeight:!0}),Qi.initClass(),Qi._$name="TimelineHistogramBase";var T0=e=>{var r;return r=class extends(e||Qi){afterConfigure(){const t=this;t.internalAggregateDataEntry=t.internalAggregateDataEntry.bind(this),t.internalInitAggregatedDataEntry=t.internalInitAggregatedDataEntry.bind(this),super.afterConfigure(),t.features.treeGroup&&t.features.treeGroup.ion({beforeDataLoad:t.onTreeGroupBeforeDataLoad,thisObj:t})}updateAggregateFunctions(t){for(const[i,n]of Object.entries(t))if(n.id=i,n.aliases)for(const s of n.aliases)t[s]=n}updateStore(t){super.updateStore(...arguments),this.detachListeners("store"),t&&t.ion({name:"store",group:this.onStoreGroup,thisObj:this})}changeAggregateDataEntry(t){return this.bindCallback(t)}changeGetDataEntryForAggregating(t){return this.bindCallback(t)}changeInitAggregatedDataEntry(t){return this.bindCallback(t)}onHistogramDataCacheSet({record:t,data:i}){super.onHistogramDataCacheSet(...arguments),this.aggregateHistogramDataForGroups&&this.scheduleRecordParentsRefresh(t)}onTreeGroupBeforeDataLoad(){this.aggregateHistogramDataForGroups&&this.resetGeneratedRecordsHistogramDataCache()}onStoreGroup(){this.aggregateHistogramDataForGroups&&this.resetGeneratedRecordsHistogramDataCache()}getRecordHistogramData(t,i){const n=this;let s;return n.aggregateHistogramDataForGroups&&n.isGroupRecord(t)?(s=n.collectingDataFor.get(t)||n.getHistogramDataCache(t),!s&&!n.hasHistogramDataCache(t)&&(s=n.getGroupRecordHistogramData(t,i),s=n.finalizeDataRetrieving(t,s))):s=super.getRecordHistogramData(...arguments),s}internalAggregateDataEntry(t,...i){const{aggregateFunctions:n}=this;for(const{id:s,aggregate:a="sum"}of Object.values(this.series)){let o;a!==!1&&(o=n[a].entry)&&(t=o(s,t,...i))}return this.aggregateDataEntry?this.aggregateDataEntry(t,...i):t}internalInitAggregatedDataEntry(){const t=this.initAggregatedDataEntry?this.initAggregatedDataEntry(...arguments):{},{aggregateFunctions:i}=this;for(const{id:n,aggregate:s="sum"}of Object.values(this.series)){const a=i[s].init;a&&s!==!1&&a(n,t,...arguments)}return t}resetGeneratedRecordsHistogramDataCache(){const{store:t}=this;for(const i of this.getHistogramDataCache().keys())(i.isGroupHeader||i.generatedParent||i.isLinked&&!t.includes(i))&&this.clearHistogramDataCache(i)}setHistogramDataCache(t,i){if(super.setHistogramDataCache(t,i),t.isLinked)super.setHistogramDataCache(t.$original,i);else if(t.$links){const{store:n}=this;for(const s of t.$links)n.includes(s)&&super.setHistogramDataCache(s,i)}}getHistogramDataCache(t){let i=super.getHistogramDataCache(t);return!i&&t.isLinked&&(i=super.getHistogramDataCache(t.$original)),i}getGroupRecordHistogramData(t,i={}){i.parentRecord=t;const n=this.aggregateRecordsHistogramData(this.getGroupChildren(t),i);return N.isPromise(n)?n.then(s=>s):n}aggregateRecordsHistogramData(t,i={}){const n=this,s=[],{parentRecord:a}=i;let o=!1;for(const l of t){const c=n.getRecordHistogramData(l,i);o=o||N.isPromise(c),c&&s.push(c)}return o?Promise.all(s).then(l=>(i.parentRecord=a,l=l.filter(c=>c),n.aggregateHistogramData(l,t,i))):n.aggregateHistogramData(s,t,i)}isGroupRecord(t){return t.isGroupHeader||this.isTreeGrouped&&t.generatedParent}getGroupChildren(t){return t.groupChildren||t.children}getRecordParent(t){const i=t.instanceMeta(this.store.id);return(i==null?void 0:i.groupParent)||this.isTreeGrouped&&t.parent}scheduleRecordParentsRefresh(t,i=!0){const n=this;let s;for(;s=n.getRecordParent(t);)i&&n.clearHistogramDataCache(s),n.scheduleRecordRefresh(s),t=s}aggregateHistogramData(t,i,n={}){const s=this,{aggregateFunctions:a}=s;n.recordsData=t,n.records=i;const o=t.map((c,d)=>s.extractHistogramDataArray(c,i[d])),l=H.aggregate(o,s.getDataEntryForAggregating||(c=>c),s.internalAggregateDataEntry,s.internalInitAggregatedDataEntry,n);for(const{id:c,aggregate:d="sum"}of Object.values(s.series)){const u=a[d].finalize;u&&d!==!1&&u(c,l,...arguments)}return l}get widgetClass(){}},E(r,"$name","TimelineHistogramGrouping"),E(r,"configurable",{aggregateHistogramDataForGroups:!0,aggregateDataEntry:null,getDataEntryForAggregating:null,initAggregatedDataEntry:null,aggregateFunctions:{sum:{aliases:["add"],entry(t,i,n){return i[t]=(i[t]||0)+n[t],i}},min:{entry(t,i,n){const s=n[t];return s<(i[t]||Number.MAX_VALUE)&&(i[t]=s),i}},max:{entry(t,i,n){const s=n[t];return s>(i[t]||Number.MIN_VALUE)&&(i[t]=s),i}},count:{init(t,i,n,s){i[t]=s.arrays.length}},avg:{entry(t,i,n){return i[t]=(i[t]||0)+n[t],i},finalize(t,i,n,s,a){const o=a.arrays.length;i.forEach(l=>l[t]/=o)}}}}),r},M0=e=>{var r;return r=class extends e{updateScalePoints(t){const i=this,n=t[t.length-1];n&&(i.scaleUnit=n.unit,i.histogramWidget.topValue=i.getTopValueByScalePoints(t)),i.scaleColumn&&(i.scaleColumn.scalePoints=t)}changeColumns(t,i){const n=this,s=n.getConfig("scaleColumn");if(t&&s){const a=Array.isArray(t);let o=t;a||(o=t.data);let l=o==null?void 0:o.length,c=s;o.some((d,u)=>{if(d.type==="scale")return l=u,c=T.assign(d,c),!0}),o=o.slice(),o[l]={type:"scale",...c},a?t=o:t.data=o}return super.changeColumns(t,i)}updateColumns(t,i){super.updateColumns(t,i),t&&(this._scaleColumn=this.columns.find(n=>n.isScaleColumn))}onColumnsChanged({action:t,changes:i,record:n,records:s}){const{scaleColumn:a,columns:o}=this;a&&(t==="dataset"||t==="batch")&&!o.includes(a)&&o.add(a,!0),super.onColumnsChanged(...arguments)}convertUnitsToHistogramValue(t,i){return t}convertHistogramValueToUnits(t,i){return t}extractHistogramDataArray(t,i){return t}getTopValueByScalePoints(t){const i=this,{scaleColumn:n}=i,s=t[t.length-1],{value:a,unit:o}=s;let l=a;return n&&(l*=1+(n.scaleWidget.scaleMaxPadding||0)),i.convertUnitsToHistogramValue(l,o||i.scaleUnit)}processRecordRenderData(t){var i;if(t=super.processRecordRenderData(...arguments),this.scaleColumn){const n=this,{record:s,histogramData:a,histogramConfig:o={}}=t;let l=(i=n.initialConfig.histogramWidget)==null?void 0:i.topValue,c=n.scalePoints||s.get(n.scalePointsModelField);if(!l){if(c&&n.calculateTopValueByScalePoints&&(l=n.getTopValueByScalePoints(c)),!l&&a){const d=t.histogramWidget||n.histogramWidget;T.assign(d,o),l=d.getDataTopValue(a),c=[{value:n.convertHistogramValueToUnits(l,n.scaleUnit),text:n.convertHistogramValueToUnits(l,n.scaleUnit)}],l+=n.scaleColumn.scaleWidget.scaleMaxPadding*l}t.scaleWidgetConfig={scalePoints:c},t.histogramConfig={...o,topValue:l}}}return t}buildGroupHeader(t){return t.column===this.scaleColumn?this.scaleColumn.renderer(t):super.buildGroupHeader(...arguments)}beforeRenderCell(t){return this.scaleColumn&&t.column===this.scaleColumn&&(t.histogramData=this.getRecordHistogramData(t.record),T.isPromise(t.histogramData)||Object.assign(t,this._recordRenderData)),super.beforeRenderCell(...arguments)}renderRecordScale(t,i){if(this.scaleColumn){const n=this.getRowFor(t),s=n==null?void 0:n.getCell(this.scaleColumn.id);s&&n.renderCell(s)}}get widgetClass(){}},E(r,"$name","TimelineHistogramScaleColumn"),E(r,"configurable",{scaleColumn:{},scalePoints:null,scalePointsModelField:"scalePoints",calculateTopValueByScalePoints:!0}),r},ao=class extends Qi.mixin(T0,M0){};E(ao,"$name","TimelineHistogram"),E(ao,"type","timelinehistogram"),ao.initClass(),ao._$name="TimelineHistogram";var ry=class extends Fe{static get $name(){return"ProjectCombo"}static get type(){return"projectcombo"}static get configurable(){return{project:null,displayField:"title",valueField:"url",highlightExternalChange:!1,editable:!1}}updateProject(e){var r;(r=e.transport.load)!=null&&r.url&&(this.value=e.transport.load.url)}onChange({value:e,userAction:r}){r&&this.project&&(this.project.transport.load.url=e,this.project.load())}};ry.initClass(),ry._$name="ProjectCombo";var iy=class extends $r{static get $name(){return"ResourceFilter"}static get type(){return"resourcefilter"}static get delayable(){return{applyFilters:"raf"}}static get configurable(){return{eventStore:null,multiSelect:!0,toggleAllIfCtrlPressed:!0,itemTpl:e=>O.encodeHtml(e.name||""),masterFilter:()=>!0,filterResources:null}}itemIconTpl(e,r){const{eventColor:t}=e,i=w.isNamedColor(t)?` b-sch-foreground-${t}`:"",n=!i&&t?` style="color:${t}"`:"";return this.multiSelect?`<div class="b-selected-icon b-icon${i}"${n}></div>`:""}updateEventStore(e){var r,t;const i=this,n=(r=i.initialConfig.store)!=null&&r.isStore?i.initialConfig.store.initialConfig:(t=i.store)==null?void 0:t.config,{resourceStore:s}=e,a=i.store=s.chain(i.masterFilter,null,{...n,syncOrder:!0}),o={change:"onStoreChange",thisObj:i};a.un(o),s.ion(o),s.count?i.initFilter():s.project.ion({name:"project",refresh:"initFilter",thisObj:i})}changeMasterFilter(e){const r=this;if(!r.filterResources)return function(t){return r.callback(e,r,[t])}}initFilter(){const{eventStore:e,selected:r}=this;e.resourceStore.count&&(this.initialSelection||r.add(this.store.getRange()),this.detachListeners("project"))}onStoreRefresh({source:e,action:r}){if(r==="filter"&&this.eventStoreFilter){const{eventStoreFilter:t}=this,{disabled:i}=t,n=!e.isFiltered&&this.allSelected;n!==i&&(t.disabled=n,this.applyFilters())}super.onStoreRefresh(...arguments)}onSelectionChange({source:e,added:r,removed:t}){const i=this,n=!i.store.isFiltered&&i.allSelected;super.onSelectionChange(...arguments);let s=!1;if(i.eventStoreFilter||(i.eventStoreFilter=i.eventStore.addFilter({id:`${i.id}-filter-instance`,filterBy:a=>!a.resource||i.selected.includes(a.resources),disabled:n},(r==null?void 0:r.length)===i.store.count),s=!0),i.filterResources&&!i.resourceStoreFilter&&(i.resourceStoreFilter=i.eventStore.resourceStore.addFilter({id:`${i.id}-filter-instance`,filterBy:a=>i.selected.includes(a),disabled:n},(r==null?void 0:r.length)===i.store.count),s=!0),!s&&(i.eventStoreFilter.disabled=n,i.resourceStoreFilter&&(i.resourceStoreFilter.disabled=n),i.applyFilters(),i.eventListeners.change)){const a=e.values,o=a.concat(t);H.remove(o,...r),i.triggerFieldChange({value:a,oldValue:o})}}get value(){return this.selected.values}applyFilters(){this.eventStore.filter(),this.filterResources&&this.eventStore.resourceStore.filter()}doDestroy(){var e;(e=this.store)==null||e.destroy(),super.doDestroy()}};iy.initClass(),iy._$name="ResourceFilter";var Eh=class extends Rl{static get $name(){return"SchedulerDatePicker"}static get type(){return"datepicker"}static get configurable(){return{showEvents:null,eventStore:null,eventFilter:{$config:"lazy",value:null}}}construct(e){"events"in e&&(e={...e,showEvents:e.events},delete e.events,ne.deprecate(ne.calendar?"Calendar":"Scheduler","6.0.0","DatePicker#events should be configured as showEvents")),super.construct(e)}changeEventFilter(e){if(typeof e=="string"){const{handler:r,thisObj:t}=this.resolveCallback(e);e=r.bind(t)}return e}doRefresh(){if(this.isVisible||!this.showEvents)return this.refreshEventsMap(),super.doRefresh(...arguments);this.whenVisible("doRefresh")}updateShowEvents(e,r){const t=this,{classList:i}=t.contentElement;let{eventStore:n}=t;if(t.requestAnimationFrame(()=>{var s;t.element.classList.toggle("b-datepicker-with-events",!!e),(s=t.owner)==null||s.element.classList.toggle("b-datepicker-with-events",!!e),e&&i.add(`b-show-events-${e}`),i.remove(`b-show-events-${r}`)}),e){if(!n){const s=t.up(a=>a.eventStore);if(s)n=s.eventStore;else throw new Error("DatePicker configured with events but no eventStore")}}else t.eventsMap=null;t.isConfiguring||(t.updateEventStore(n),t.doRefresh())}refreshEventsMap(){const e=this;e.showEvents&&(e.eventsMap=e.eventStore.getEventCounts({startDate:e.startDate,endDate:e.endDate,dateMap:e.eventsMap,filter:e.eventFilter}))}updateEventStore(e){var r;e.findListener("change","refresh",this)===-1&&((r=e==null?void 0:e[this.showEvents?"on":"un"])==null||r.call(e,{change:"refresh",thisObj:this}))}cellRenderer({cell:e,date:r}){var t,i;const{showEvents:n}=this,s=(i=(t=this.eventCounts)==null?void 0:t.get)==null?void 0:i.call(t,b.makeKey(r)),a=n==="count";delete e.dataset.btip,s&&(!a&&this.eventCountTip&&(e.dataset.btip=this.L("L{ResourceInfoColumn.eventCountText}",s)),w.createElement({dataset:{count:s},class:{[a?"b-cell-events-badge":"b-icon b-icon-circle"]:1,[Eh.getEventCountClass(s)]:1},parent:e,[a?"text":""]:s}))}static getEventCountClass(e){return e?e<4?"b-datepicker-1-to-3-events":e<7?"b-datepicker-4-to-6-events":"b-calendar-7-or-more-events":""}static setupClass(e){e.replaceType=!0,super.setupClass(e)}};Eh.initClass(),Eh._$name="SchedulerDatePicker";var GO=e=>e.isProjectConsumer,xh=class extends du{static get $name(){return"UndoRedo"}static get type(){return"undoredo"}static get configurable(){return{scheduler:null,project:null}}construct(){super.construct(...arguments),this.stm||(this.scheduler=this.up(GO))}changeScheduler(e){return e.isProjectConsumer?e:xh.getById(e)}updateScheduler(e){const{crudManager:r}=e;e.ion({projectChange:"onProjectChanged",thisObj:this}),r?this.setupLoadListener(r):this.onLoad(),this.stm=e.project.stm}setupLoadListener(e){e.detachListeners("load"),e.ion({name:"load",load:"onLoad",thisObj:this})}async onLoad(){await this.scheduler.project.commitAsync(),this.isDestroyed||(this.stm.enable(),this.fillUndoRedoCombo())}onProjectChanged({project:e}){this.project=e}updateProject(e){super.updateProject(...arguments),e&&this.scheduler&&!this.scheduler.isConfiguring&&this.setupLoadListener(e)}};xh.initClass(),xh._$name="UndoRedo";var oo=class extends Fe{construct(){super.construct(...arguments),this.scheduler.ion({presetchange:this.onClientPresetChange,thisObj:this})}get scheduler(){return this.client||this.up(e=>e.isTimelineBase)||$.query(e=>e.isTimelineBase)}changeValue(e,r){return this.getConfig("presets"),super.changeValue(e,r)}updatePresets(e){this.store=this.scheduler.presets.chain(r=>e.includes(r.id)),this.store.sort((r,t)=>e.indexOf(r.id)-e.indexOf(t.id))}onClientPresetChange({preset:e}){const r=this;r._isSelecting||(r.isSettingValue=!0,r.store.includes(e.id)?r.value=e:r.clear(),r.isSettingValue=!1)}onSelect({record:e}){var r;if(!this.isSettingValue){const{scheduler:t}=this,{mainUnit:i,start:n,defaultSpan:s}=e;if(t.suspendRefresh(),this._isSelecting=!0,t.viewPreset=e,this._isSelecting=!1,i&&s){let a=i;n&&typeof n=="string"&&(a=(r=b.parseTimeUnit(n))!=null?r:n);let o=b.startOf(t.startDate,a);e.start&&typeof n=="number"&&(o=b.add(o,n,i));const l=b.add(o,s,i);t.setTimeSpan(o,l)}t.isVertical?t.scrollTop=0:t.scrollLeft=0,t.resumeRefresh(!0)}}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue()}};E(oo,"$name","ViewPresetCombo"),E(oo,"type","viewpresetcombo"),E(oo,"configurable",{presets:["hourAndDay","weekAndDay","dayAndMonth"],client:null,editable:!1,valueField:"id",displayField:"name",placeholder:"Select view"}),oo.initClass(),oo._$name="ViewPresetCombo";var UO=-Math.pow(2,30),en=Math.pow(2,30)-1,ny=e=>e.slice(0,1).toUpperCase()+e.slice(1),hs=e=>Object(e)!==e,Rh=(e,r,t)=>(Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0}),t),pe=e=>function(r,t){r[t]=e},YO=(e,r)=>{for(const t of e)r.add(t);return r},xc=e=>new Promise(r=>setTimeout(r,e)),qO=function*(e,r){let t;for(;(t=e.exec(r))!==null;)yield t},sy=null,ay=function(e){return sy===null&&(sy=typeof regeneratorRuntime!="undefined"),sy===!0?regeneratorRuntime.isGeneratorFunction(e):e.constructor.name==="GeneratorFunction"},Th=function(e){return e&&typeof e.then=="function"},lo=!1,KO=(...e)=>{},Mh=e=>lo?e:KO,XO=Mh(e=>{debugger}),Rc=Mh(e=>{typeof console!="undefined"&&console.warn(e)}),ZO=class extends Ke{},I0=class extends Ke{constructor(){super(...arguments),this.stackEntries=[]}static fromError(e){return I0.new({exception:e,stackEntries:JO(e.stack)})}static fromThisCall(){const e=this.fromError(new Error);return e.stackEntries.splice(0,2),e}},JO=e=>Ct(qO(/^   +at\s*(.*?)\s*\((https?:\/\/.*?):(\d+):(\d+)/gm,e)).map(r=>ZO.new({statement:r[1],sourceFile:r[2],sourceLine:Number(r[3]),sourceCharPos:Number(r[4])})).toArray(),oy=Symbol("RequiredProperties"),P0=Mh((e,r)=>{let t=e[oy];t||(t=e[oy]=[]),t.push(r)}),A0=Mh(e=>{const r=e[oy];if(r){for(let t=0;t<r.length;t++)if(e[r[t]]===void 0)throw new Error(`Required attribute [${String(r[t])}] is not provided`)}}),Nr;(function(e){e.Cancel="Cancel",e.Resume="Resume"})(Nr||(Nr={}));var _0=Symbol("WalkSource"),co=-1,gs=-2,ly=class extends Ke{constructor(){super(...arguments),this.visited=new Map,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e.map(r=>({node:r,from:_0,label:void 0}))),this.walkDepth()}onNode(e,r){}onTopologicalNode(e){}onCycle(e,r){return Nr.Cancel}forEachNext(e,r){throw new Error("Abstract method called")}collectNext(e,r,t){throw new Error("Abstract method called")}getVisitedInfo(e){return this.visited.get(e)}setVisitedInfo(e,r,t){return t?(t.visitedAt=r,t.visitEpoch=this.currentEpoch):(t={visitedAt:r,visitEpoch:this.currentEpoch},this.visited.set(e,t)),t}walkDepth(){const e=this.visited,r=this.toVisit;let t;for(;t=r.length;){const i=r[t-1].node,n=this.getVisitedInfo(i);if(n&&n.visitedAt===gs&&n.visitEpoch===this.currentEpoch){r.pop();continue}if(n&&n.visitEpoch===this.currentEpoch&&n.visitedAt!==co){if(n.visitedAt<t){if(this.onCycle(i,r)!==Nr.Resume)break}else n.visitedAt=gs,this.onTopologicalNode(i);r.pop()}else{if(this.onNode(i,r[t-1])===!1)break;const s=this.setVisitedInfo(i,t,n),a=r.length;this.collectNext(i,r,s),r.length===a&&(s.visitedAt=gs,this.onTopologicalNode(i),r.pop())}}}};function k0(e){const r=e.length;if(r===0)return[];const t=e[r-1].node,i=[t];let n=r-1,s=n;for(;n>=0&&e[n].from!==t;){for(;n>=0&&e[n].from===e[s].from;)n--;n>=0&&(i.push(e[n].node),s=n)}return n<0?[]:(i.push(t),i.reverse())}var QO=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},F0=0,Ft=F0++,Ze=class extends Ke{constructor(){super(...arguments),this.formulaId=F0++,this.inputs=new Set}},O0=class extends ly{collectNext(e,r){if(e instanceof Ze)r.push({node:e.output,from:e,label:void 0});else{const t=this.cache.formulasByInput.get(e);t&&t.forEach(i=>r.push({node:i,from:e,label:void 0}))}}},Ih=class extends G([Ke],e=>class extends e{constructor(){super(...arguments),this.variables=new Set,this.formulas=new Set,this.$formulasByInput=void 0,this.$formulasByOutput=void 0}get formulasByInput(){return this.$formulasByInput!==void 0?this.$formulasByInput:(this.fillCache(),this.$formulasByInput)}get formulasByOutput(){return this.$formulasByOutput!==void 0?this.$formulasByOutput:(this.fillCache(),this.$formulasByOutput)}add(t){this.$formulasByInput=void 0,this.$formulasByOutput=void 0,this.formulas.add(t)}has(t){return this.formulas.has(t)}fillCache(){this.$formulasByInput=new Map,this.$formulasByOutput=new Map,this.formulas.forEach(t=>{let i=this.$formulasByOutput.get(t.output);i||(i=new Set,this.$formulasByOutput.set(t.output,i)),i.add(t),t.inputs.forEach(n=>{let s=this.$formulasByInput.get(n);s||(s=new Set,this.$formulasByInput.set(n,s)),s.add(t)})})}allInputVariables(){return sx(ox(ku(this.formulas,t=>t.inputs.values())))}isCyclic(){let t=!1;return O0.new({cache:this,onCycle:()=>(t=!0,Nr.Cancel)}).startFrom(Array.from(this.allInputVariables())),t}}){},tn=class extends Ih{},Pt=class extends Ke{constructor(){super(...arguments),this.description=void 0,this.defaultResolutionFormulas=new Set,this.resolutionsByInputHash=new Map}clear(){this.resolutionsByInputHash.clear()}resolve(e){const r=this.resolutionsByInputHash.get(e.hash);if(r!==void 0)return r;const t=this.buildResolution(e);return this.resolutionsByInputHash.set(e.hash,t),t}buildResolution(e){const r=dy.new({context:this,input:e}),t=Array.from(r.next()).map(i=>({resolution:i.asResolution(),nbrOfDefaultFormulas:Array.from(i.activatedFormulas.formulas).reduce((n,s)=>i.formulaIsDefault(s)?n+1:n,0),unCoveredInputWeight:i.unCoveredInputWeight()}));if(t.sort((i,n)=>i.unCoveredInputWeight<n.unCoveredInputWeight?-1:i.unCoveredInputWeight>n.unCoveredInputWeight?1:n.nbrOfDefaultFormulas-i.nbrOfDefaultFormulas),t.length>0)return t[0].resolution;debugger}},zr;(function(e){e[e.NoInput=0]="NoInput",e[e.HasPreviousValue=1]="HasPreviousValue",e[e.HasProposedValue=2]="HasProposedValue",e[e.KeepIfPossible=4]="KeepIfPossible"})(zr||(zr={}));var cy=class extends Ke{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.$hash=""}get hash(){return this.$hash!==""?this.$hash:this.$hash=this.buildHash()}get description(){return this.context.description}get resolution(){return this.context.resolve(this)}initialize(...e){super.initialize(...e),A0(this),this.input=new Map(Ct(this.description.variables).map(r=>[r,zr.NoInput]))}buildHash(){return String.fromCharCode(...Ct(this.description.variables).inBatchesBySize(5).map(e=>this.batchToCharCode(e)))}batchToCharCode(e){return e.reduceRight((r,t,i)=>r|this.input.get(t)<<i*3,0)}addProposedValueFlag(e){if(lo){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const r=this.input.get(e);this.input.set(e,r|zr.HasProposedValue)}hasProposedValue(e){return!!(this.input.get(e)&zr.HasProposedValue)}hasProposedValueVars(){return Ct(this.description.variables).filter(e=>this.hasProposedValue(e))}addPreviousValueFlag(e){if(lo){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const r=this.input.get(e);this.input.set(e,r|zr.HasPreviousValue)}hasPreviousValue(e){return!!(this.input.get(e)&zr.HasPreviousValue)}hasPreviousValueVars(){return Ct(this.description.variables).filter(e=>this.hasPreviousValue(e))}addKeepIfPossibleFlag(e){if(lo){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const r=this.input.get(e);this.input.set(e,r|zr.KeepIfPossible)}keepIfPossible(e){return!!(this.input.get(e)&zr.KeepIfPossible)}keepIfPossibleVars(){return Ct(this.description.variables).filter(e=>this.keepIfPossible(e))}};QO([P0],cy.prototype,"context",void 0);var dy=class extends Ke{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.previous=void 0,this.activatedFormula=void 0,this.$activatedFormulas=void 0}get activatedFormulas(){if(this.$activatedFormulas!==void 0)return this.$activatedFormulas;const e=Ih.new({variables:this.description.variables,formulas:Ct(this.thisAndPreviousStates()).map(r=>r.activatedFormula).toSet()});return this.$activatedFormulas=e}get description(){return this.context.description}*thisAndPreviousStates(){let e=this;for(;e&&e.activatedFormula;)yield e,e=e.previous}formulaHasProposedValueInInput(e){return Array.from(e.inputs).some(r=>this.input.hasProposedValue(r))}unCoveredInputWeight(){const e=ku(this.input.hasProposedValueVars(),i=>({variable:i,isProposed:!0})),r=ku(this.input.keepIfPossibleVars(),i=>({variable:i,isProposed:!1}));return Ct([e,r]).concat().uniqueOnlyBy(i=>i.variable).reduce((i,{variable:n,isProposed:s})=>{let a=0;const o=this.activatedFormulas.formulasByOutput.get(n);if(o){const c=o.size===1?Array.from(o)[0]:null;c&&this.formulaIsDefault(c)&&this.formulaHasProposedValueInInput(c)?s?a+=1e6:a+=1e4:s?a+=1e7:a+=1e5}const l=this.activatedFormulas.formulasByInput.get(n);return l&&l.size>0||(s?a+=1e3:a+=100),i+a},0)}preferFormula(e,r){const t=this.formulaAllInputsHasProposed(e),i=this.formulaAllInputsHasProposed(r);if(t&&!i)return-1;if(i&&!t)return 1;const n=this.formulaCountInputsWithProposedOrKeep(e),s=this.formulaCountInputsWithProposedOrKeep(r);return n>s?-1:n<s?1:this.formulaIsDefault(e)&&!this.formulaIsDefault(r)?-1:this.formulaIsDefault(r)&&!this.formulaIsDefault(e)?1:0}formulaIsDefault(e){return this.context.defaultResolutionFormulas.has(e)}formulaCountInputsWithProposedOrKeep(e){let r=0;return Array.from(e.inputs).forEach(t=>{(this.input.hasProposedValue(t)||this.input.keepIfPossible(t))&&r++}),r}formulaAllInputsHasProposedOrKeep(e){return Array.from(e.inputs).every(r=>this.input.hasProposedValue(r)||this.input.keepIfPossible(r))}formulaAllInputsHasProposed(e){return Array.from(e.inputs).every(r=>this.input.hasProposedValue(r))}formulaIsApplicable(e){const r=Array.from(e.inputs).every(i=>this.input.hasProposedValue(i)||this.input.hasPreviousValue(i)||this.activatedFormulas.formulasByOutput.has(i)),t=Ih.new({formulas:new Set(this.activatedFormulas.formulas)});return t.add(e),r&&!t.isCyclic()}formulaIsInsignificant(e){const r=this.activatedFormulas.formulasByOutput.has(e.output),t=this.input.hasPreviousValue(e.output);return r||t&&Array.from(e.inputs).some(i=>!this.input.hasPreviousValue(i)&&!this.input.hasProposedValue(i)&&!this.activatedFormulas.formulasByOutput.has(i))}unvisitedFormulas(){return Array.from(this.description.formulas).filter(e=>!this.activatedFormulas.has(e))}*next(){const e=this.unvisitedFormulas();e.sort(this.preferFormula.bind(this));let r=!0;for(const t of e){if(!this.formulaIsApplicable(t)||this.formulaIsInsignificant(t))continue;yield*dy.new({previous:this,context:this.context,input:this.input,activatedFormula:t}).next(),r=!1}r&&(yield this)}asResolution(){return new Map(Ct(this.description.variables).map(e=>{const r=this.activatedFormulas.formulasByOutput.get(e);if(r)for(const t of r)return[e,t.formulaId];return[e,Ft]}))}},Tc=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},uo=Symbol("BreakCurrentStackExecution"),at=class extends Ke{};Tc([pe(!0)],at.prototype,"sync",void 0),Tc([pe(!0)],at.prototype,"pure",void 0);var uy=Symbol("ProposedOrPreviousSymbol"),Ee=at.new({handler:uy}),Mc=Symbol("RejectSymbol"),ho=class extends at{constructor(){super(...arguments),this.handler=Mc}};Tc([pe(!1)],ho.prototype,"pure",void 0);var mi=e=>ho.new({reason:e}),hy=Symbol("TransactionSymbol"),eL=at.new({handler:hy}),gy=Symbol("OwnQuarkSymbol"),tL=at.new({handler:gy}),fy=Symbol("OwnIdentifierSymbol"),rL=at.new({handler:fy}),my=Symbol("WriteSymbol"),py=class extends at{constructor(){super(...arguments),this.handler=my}};Tc([pe(!1)],py.prototype,"pure",void 0);var L0=(e,r,...t)=>py.new({identifier:e,proposedArgs:[r,...t]}),vy=Symbol("WriteSeveralSymbol"),yy=class extends at{constructor(){super(...arguments),this.handler=vy}};Tc([pe(!1)],yy.prototype,"pure",void 0);var $0=e=>yy.new({writes:e}),by=Symbol("PreviousValueOfSymbol"),j0=class extends at{constructor(){super(...arguments),this.handler=by}},Ph=e=>j0.new({identifier:e}),Cy=Symbol("ProposedValueOfSymbol"),B0=class extends at{constructor(){super(...arguments),this.handler=Cy}},H0=e=>B0.new({identifier:e}),Sy=Symbol("HasProposedValueSymbol"),V0=class extends at{constructor(){super(...arguments),this.handler=Sy}},vr=e=>V0.new({identifier:e}),Dy=Symbol("HasProposedNotPreviousValueSymbol"),N0=class extends at{constructor(){super(...arguments),this.handler=Dy}},z0=e=>N0.new({identifier:e}),wy=Symbol("ProposedOrPreviousValueOfSymbol"),W0=class extends at{constructor(){super(...arguments),this.handler=wy}},et=e=>W0.new({identifier:e}),Ey=Symbol("ProposedArgumentsOfSymbol"),G0=class extends at{constructor(){super(...arguments),this.handler=Ey}},fs=e=>G0.new({identifier:e}),xy=Symbol("UnsafeProposedOrPreviousValueOfSymbol"),U0=class extends at{constructor(){super(...arguments),this.handler=xy}},ms=e=>U0.new({identifier:e}),Ry=Symbol("UnsafePreviousValueOfSymbol"),Y0=class extends at{constructor(){super(...arguments),this.handler=Ry}},iL=e=>Y0.new({identifier:e}),q0=class extends cy{collectInfo(e,r,t){e(Ph(r))!=null&&this.addPreviousValueFlag(t),e(z0(r))&&this.addProposedValueFlag(t)}},nL=Symbol("ContextSync"),sL=Symbol("ContextGen"),K0=class extends G([],e=>class extends e{constructor(){super(...arguments),this.iterator=void 0,this.iterationResult=void 0}isCalculationStarted(){return!!(this.iterator||this.iterationResult)}isCalculationCompleted(){return!!(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(t,...i){const n=this.iterator=this.calculation.call(this.context||this,t,...i);return this.iterationResult=n.next()}continueCalculation(t){return this.iterationResult=this.iterator.next(t)}cleanupCalculation(){this.iterationResult=void 0,this.iterator=void 0}*calculation(t,...i){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(t,...i){for(this.startCalculation(t,...i);!this.isCalculationCompleted();)this.continueCalculation(t(this.iterationResult.value));return this.iterator=void 0,this.result}async runAsyncWithEffect(t,...i){for(this.startCalculation(t,...i);!this.isCalculationCompleted();)this.continueCalculation(await t(this.iterationResult.value));return this.iterator=void 0,this.result}}){},Ah=Symbol("SynchronousCalculationStarted"),aL={value:Ah},X0=class extends G([],e=>class extends e{constructor(){super(...arguments),this.iterationResult=void 0}isCalculationStarted(){return!!this.iterationResult}isCalculationCompleted(){return!!(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(t,...i){return this.iterationResult=aL,this.iterationResult={done:!0,value:this.calculation.call(this.context||this,t,...i)}}continueCalculation(t){throw new Error("Can not continue synchronous calculation")}cleanupCalculation(){this.iterationResult=void 0}calculation(t,...i){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(t,...i){return this.startCalculation(t,...i),this.result}async runAsyncWithEffect(t,...i){throw new Error("Can not run synchronous calculation asynchronously")}}){};function Z0(e,r,t,i){const n=r.apply(i||null,t);let s=n.next();for(;!s.done;)s=n.next(e(s.value));return s.value}async function Ic(e,r,t,i){const n=r.apply(i||null,t);let s=n.next();for(;!s.done;){let a,o=!1;do{o=!1;try{a=e(s.value)}catch(l){if(l instanceof at)if(await e(l)==="Cancel"){e(mi(l));return}else o=!0}}while(o);Th(a)?s=n.next(await a):s=n.next(a)}return s.value}var go;(function(e){e[e.Normal=1]="Normal",e[e.Past=2]="Past"})(go||(go={}));var oL=0,_h=class extends xp([Map],e=>class extends e{constructor(){super(...arguments),this.createdAt=void 0,this.identifier=void 0,this.value=void 0,this.proposedValue=void 0,this.proposedIsPrevious=!1,this.proposedArguments=void 0,this.usedProposedOrPrevious=!1,this.previous=void 0,this.origin=void 0,this.originId=UO,this.needToBuildProposedValue=!1,this.edgesFlow=0,this.visitedAt=co,this.visitEpoch=0,this.promise=void 0,this.$outgoingPast=void 0}static new(t){const i=new this;return t&&Object.assign(i,t),i}get level(){return this.identifier.level}get calculation(){return this.identifier.calculation}get context(){return this.identifier.context||this.identifier}forceCalculation(){this.edgesFlow=en}cleanup(){this.cleanupCalculation()}isShadow(){return!!(this.origin&&this.origin!==this)}resetToEpoch(t){this.visitEpoch=t,this.visitedAt=co,this.edgesFlow<0&&(this.edgesFlow=0),this.usedProposedOrPrevious=!1,this.cleanupCalculation(),this.clearOutgoing(),this.promise=void 0,this.origin&&this.origin===this?(this.proposedArguments=void 0,this.value!==void 0&&(this.proposedValue=this.value),this.value=void 0):(this.origin=void 0,this.value=void 0),this.identifier.proposedValueIsBuilt&&this.proposedValue!==xe&&(this.needToBuildProposedValue=!0,this.proposedValue=void 0)}copyFrom(t){this.value=t.value,this.proposedValue=t.proposedValue,this.proposedArguments=t.proposedArguments,this.usedProposedOrPrevious=t.usedProposedOrPrevious}clearProperties(){this.value=void 0,this.proposedValue=void 0,this.proposedArguments=void 0}mergePreviousOrigin(t){const i=this.origin;if(i!==this.previous)throw new Error("Invalid state");this.copyFrom(i);const n=this.getOutgoing();for(const[s,a]of i.getOutgoing())if(!n.get(s)){const l=t.get(s);(!l||l.originId===a.originId)&&n.set(s,l||a)}if(i.$outgoingPast!==void 0){const s=this.getOutgoingPast();for(const[a,o]of i.getOutgoingPast())if(!s.get(a)){const c=t.get(a);(!c||c.originId===o.originId)&&s.set(a,c||o)}}this.origin=this,i.clearProperties(),i.clear()}setOrigin(t){this.origin=t,this.originId=t.originId}getOrigin(){return this.origin?this.origin:this.startOrigin()}startOrigin(){return this.originId=oL++,this.origin=this}getOutgoing(){return this}getOutgoingPast(){return this.$outgoingPast!==void 0?this.$outgoingPast:this.$outgoingPast=new Map}addOutgoingTo(t,i){(i===go.Normal?this:this.getOutgoingPast()).set(t.identifier,t)}clearOutgoing(){this.clear(),this.$outgoingPast!==void 0&&this.$outgoingPast.clear()}getValue(){const t=this.origin;return t===this?this.value:t?t.getValue():void 0}setValue(t){if(this.origin&&this.origin!==this)throw new Error("Can not set value to the shadow entry");this.getOrigin().value=t}hasValue(){return this.getValue()!==void 0}hasProposedValue(){return this.isShadow()?!1:this.hasProposedValueInner()}hasProposedValueInner(){return this.proposedValue!==void 0}getProposedValue(t){return this.needToBuildProposedValue&&(this.proposedValue=this.identifier.buildProposedValue.call(this.identifier.context||this.identifier,this.identifier,this,t),this.needToBuildProposedValue=!1),this.proposedValue}outgoingInTheFutureCb(t,i){let n=this;for(;n;){for(const s of n.getOutgoing().values())s.originId===t.getLatestEntryFor(s.identifier).originId&&i(s);n.isShadow()?n=n.previous:n=null}}outgoingInTheFutureAndPastCb(t,i){let n=this;for(;n;){for(const s of n.getOutgoing().values()){const a=t.getLatestEntryFor(s.identifier);a&&s.originId===a.originId&&i(s)}if(n.$outgoingPast!==void 0)for(const s of n.$outgoingPast.values()){const a=t.getLatestEntryFor(s.identifier);a&&s.originId===a.originId&&i(s)}n.isShadow()?n=n.previous:n=null}}outgoingInTheFutureAndPastTransactionCb(t,i){let n=this;for(;n;){for(const s of n.getOutgoing().values()){const a=t.getLatestStableEntryFor(s.identifier);a&&s.originId===a.originId&&i(s)}if(n.$outgoingPast!==void 0)for(const s of n.$outgoingPast.values()){const a=t.getLatestStableEntryFor(s.identifier);a&&s.originId===a.originId&&i(s)}n.isShadow()?n=n.previous:n=null}}outgoingInTheFutureTransactionCb(t,i){let n=this;for(;n;){for(const s of n.getOutgoing().values()){const a=t.getLatestEntryFor(s.identifier);a&&s.originId===a.originId&&i(s)}n.isShadow()?n=n.previous:n=null}}}){},xe=Symbol("Tombstone"),fo=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Wr;(function(e){e[e.UserInput=0]="UserInput",e[e.DependsOnlyOnUserInput=1]="DependsOnlyOnUserInput",e[e.DependsOnlyOnDependsOnlyOnUserInput=2]="DependsOnlyOnDependsOnlyOnUserInput",e[e.DependsOnSelfKind=3]="DependsOnSelfKind"})(Wr||(Wr={}));var Pc=class extends Ke{constructor(){super(...arguments),this.name=void 0,this.lazy=!1,this.total=!0,this.pure=!0,this.proposedValueIsBuilt=!1}calculation(e){throw new Error("Abstract method `calculation` called")}equality(e,r){return e===r}};fo([pe(Wr.DependsOnSelfKind)],Pc.prototype,"level",void 0),fo([pe(!0)],Pc.prototype,"sync",void 0);var nr=class extends Pc{constructor(){super(...arguments),this.context=void 0,this.isWritingUndefined=!1}newQuark(e){const r=this.quarkClass.new();return r.createdAt=e,r.identifier=this,r.needToBuildProposedValue=this.proposedValueIsBuilt,r}write(e,r,t,i,...n){t=t||r.getWriteTarget(e),t.proposedValue=i,t.proposedArguments=n.length>0?n:void 0,t.proposedIsPrevious=r.graph.isWritingPreviousData}writeToTransaction(e,r,...t){e.write(this,r,...t)}writeToGraph(e,r,...t){e.write(this,r,...t)}readFromGraphAsync(e){return e.readAsync(this)}readFromGraph(e){return e.read(this)}readFromTransaction(e){return e.read(this)}readFromTransactionAsync(e){return e.readAsync(this)}buildProposedValue(e,r,t){}enterGraph(e){}leaveGraph(e){}},lL=e=>nr.new(e),mo=_h.mix(X0.mix(Map)),J0=_h.mix(K0.mix(Map)),Ac=class extends nr{calculation(e){throw new Error("The 'calculation' method of the variables should never be called. Instead, the value will be set directly to quark")}write(e,r,t,i,...n){t=t||r.getWriteTarget(e),t.value=i,t.proposedArguments=n.length>0?n:void 0}};fo([pe(Wr.UserInput)],Ac.prototype,"level",void 0),fo([pe(mo)],Ac.prototype,"quarkClass",void 0);function Ty(...e){return Ac.new(...e)}var po=class extends nr{calculation(e){return e(Ee)}};fo([pe(mo)],po.prototype,"quarkClass",void 0);function My(...e){return po.new(...e)}var Mr=class extends nr{*calculation(e){return yield Ee}};fo([pe(J0)],Mr.prototype,"quarkClass",void 0);function Iy(...e){return Mr.new(...e)}var Ir=e=>{throw new Error(`Unknown identifier ${e}`)},cL=0,kh=class extends Ke{constructor(){super(...arguments),this.createdAt=cL++,this.name="revision-"+this.createdAt,this.previous=void 0,this.scope=new Map,this.reachableCount=0,this.referenceCount=0,this.selfDependent=new Set}getLatestEntryFor(e){let r=this;for(;r;){const t=r.scope.get(e);if(t)return t;r=r.previous}return null}hasIdentifier(e){const r=this.getLatestEntryFor(e);return!!(r&&r.getValue()!==xe)}*previousAxis(){let e=this;for(;e;)yield e,e=e.previous}},dL=class{constructor(){this.length=0,this.levels=[],this.lowestLevel=en}getLowestLevel(){for(let e=this.lowestLevel!==en?this.lowestLevel:0;e<this.levels.length;e++)if(this.levels[e])return this.lowestLevel=e;return this.lowestLevel=en}takeLowestLevel(){for(let e=this.lowestLevel!==en?this.lowestLevel:0;e<this.levels.length;e++){const r=this.levels[e];if(r)return this.length-=r.length,this.levels[e]=null,this.lowestLevel=e+1,r}}pop(){for(let e=this.lowestLevel!==en?this.lowestLevel:0;e<this.levels.length;e++){const r=this.levels[e];if(this.lowestLevel=e,r&&r.length>0)return this.length--,r.pop()}this.lowestLevel=en}push(e){const r=e.level;let t=this.levels[r];if(!t){for(let i=this.levels.length;i<r;i++)this.levels[i]=null;t=this.levels[r]=[]}t.push(e),this.length++,r<this.lowestLevel&&(this.lowestLevel=r)}*[Symbol.iterator](){for(let e=0;e<this.levels.length;e++){const r=this.levels[e];r&&(yield*r)}}},Fh=class extends Ke{toString(){const e=[],r=[];return this.cycle.forEach(({name:t,context:i})=>{e.push(t),r[r.length-1]!==i&&r.push(i)}),`events: 
`+r.map(t=>"#"+t.id).join(" => ")+`

identifiers: 
`+e.join(`
`)}},Q0=class extends ly{constructor(){super(...arguments),this.transaction=void 0}onCycle(e,r){return Nr.Cancel}doCollectNext(e,r,t){let i=this.visited.get(r);i||(i={visitedAt:co,visitEpoch:this.currentEpoch},this.visited.set(r,i)),t.push({node:r,from:e,label:void 0})}collectNext(e,r){const t=this.transaction.getLatestEntryFor(e);t&&t.outgoingInTheFutureTransactionCb(this.transaction,i=>{this.doCollectNext(e,i.identifier,r)})}},eR=class extends Ke{constructor(){super(...arguments),this.visited=new Map,this.transaction=void 0,this.baseRevision=void 0,this.pushTo=void 0,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e),this.walkDepth()}startNewEpoch(){if(this.toVisit.length)throw new Error("Can not start new walk epoch in the middle of the walk");this.currentEpoch++}onTopologicalNode(e,r){!e.lazy&&e.level!==Wr.UserInput&&this.pushTo.push(r)}onCycle(e,r){return Nr.Resume}doCollectNext(e,r,t){let i=this.visited.get(r);i||(i=r.newQuark(this.baseRevision),i.visitEpoch=this.currentEpoch,this.visited.set(r,i)),t.push(r)}collectNext(e,r,t){const i=this.baseRevision.getLatestEntryFor(e);i&&(t.previous=i,i.outgoingInTheFutureAndPastTransactionCb(this.transaction,n=>{this.doCollectNext(e,n.identifier,r)}));for(const n of t.getOutgoing().keys())this.doCollectNext(e,n,r);if(t.$outgoingPast!==void 0)for(const n of t.getOutgoingPast().keys())this.doCollectNext(e,n,r)}walkDepth(){const e=this.visited,r=this.toVisit;let t;for(;t=r.length;){const i=r[t-1];let n=e.get(i);if(n&&n.visitedAt===gs&&n.visitEpoch===this.currentEpoch){n.edgesFlow++,r.pop();continue}if(n&&n.visitEpoch===this.currentEpoch&&n.visitedAt!==co){if(n.visitedAt<t){if(this.onCycle(i,r)!==Nr.Resume)break;n.edgesFlow++}else n.visitedAt=gs,this.onTopologicalNode(i,n);r.pop()}else{const s=r.length;n||(n=i.newQuark(this.baseRevision),n.visitEpoch=this.currentEpoch,e.set(i,n)),this.collectNext(i,r,n),n.visitEpoch<this.currentEpoch&&n.resetToEpoch(this.currentEpoch),n.visitedAt=t,n.edgesFlow++,r.length===s&&(n.visitedAt=gs,this.onTopologicalNode(i,n),r.pop())}}}},_c=go.Normal,ps=go.Past,Py=class extends Ke{constructor(){super(...arguments),this.baseRevision=void 0,this.candidateClass=kh,this.candidate=void 0,this.graph=void 0,this.isClosed=!1,this.walkContext=void 0,this.entries=new Map,this.stackGen=new dL,this.activeStack=[],this.onEffectSync=void 0,this.onEffectAsync=void 0,this.propagationStartDate=0,this.lastProgressNotificationDate=0,this.startProgressNotificationsAfterMs=500,this.emitProgressNotificationsEveryMs=200,this.emitProgressNotificationsEveryCalculations=100,this.plannedTotalIdentifiersToCalculate=0,this.ongoing=Promise.resolve(),this.selfDependedMarked=!1,this.rejectedWith=void 0,this.stopped=!1,this.hasEntryWithProposedValue=!1,this.hasVariableEntry=!1}initialize(...e){super.initialize(...e),this.walkContext=eR.new({visited:this.entries,transaction:this,baseRevision:this.baseRevision,pushTo:this.stackGen}),this.candidate||(this.candidate=this.candidateClass.new({previous:this.baseRevision})),this.onEffectSync=this.read.bind(this),this.onEffectAsync=this.readAsync.bind(this)}get dirty(){return this.entries.size>0}markSelfDependent(){if(!this.selfDependedMarked){this.selfDependedMarked=!0;for(const e of this.baseRevision.selfDependent){const r=this.entries.get(e);r&&r.getValue()===xe||this.touch(e)}}}getActiveEntry(){return this.activeStack[this.activeStack.length-1]}yieldAsync(e){return Th(e)?e:this.graph[e.handler](e,this)}yieldSync(e){if(Th(e))throw new Error("Can not yield a promise in the synchronous context");return this.graph[e.handler](e,this)}readAsync(e){if(!(e instanceof nr))return this.yieldAsync(e);let r;const t=this.getActiveEntry();if(t)r=this.addEdge(e,t,_c);else if(r=this.entries.get(e),!r){const i=this.baseRevision.getLatestEntryFor(e);i||Ir(e),r=i.hasValue()?i:this.touch(e)}return r.hasValue()?r.getValue():r.promise?r.promise:((!r.previous||!r.previous.hasValue())&&r.forceCalculation(),this.ongoing=r.promise=this.ongoing.then(()=>(async()=>{for(;this.stackGen.lowestLevel<e.level;)await Ic(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,this.stackGen.takeLowestLevel()],this);if(this.markSelfDependent(),r.getValue()===void 0)return Ic(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[r]],this)})()).then(()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);if(!r.hasValue())throw new Error("Computation cycle. Sync");return r.getValue()}))}get(e){if(!(e instanceof nr))return this.yieldSync(e);let r;const t=this.getActiveEntry();if(t)r=this.addEdge(e,t,_c);else if(r=this.entries.get(e),!r){const n=this.baseRevision.getLatestEntryFor(e);n||Ir(e),r=n.hasValue()?n:this.touch(e)}const i=r.getValue();if(i===xe&&Ir(e),i!==void 0&&r.hasValue())return i;if(r.promise)return r.promise;for((!r.previous||!r.previous.hasValue())&&r.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());if(this.markSelfDependent(),e.sync){this.calculateTransitionsStackSync(this.onEffectSync,[r]);const n=r.getValue();if(n===void 0)throw new Error("Cycle during synchronous computation");return n===xe&&Ir(e),n}else{const n=this.ongoing=r.promise=this.ongoing.then(()=>{if(r.getValue()===void 0)return Ic(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[r]],this)}).then(()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);const s=r.getValue();if(s===void 0)throw new Error("Computation cycle. Async get");return s===xe&&Ir(e),s});return lo&&(n.quark=r),n}}read(e){if(!(e instanceof nr))return this.yieldSync(e);let r;const t=this.getActiveEntry();if(t)r=this.addEdge(e,t,_c);else if(r=this.entries.get(e),!r){const s=this.baseRevision.getLatestEntryFor(e);s||Ir(e),r=s.hasValue()?s:this.touch(e)}const i=r.getValue();if(i===xe&&Ir(e),i!==void 0)return i;for((!r.previous||!r.previous.hasValue())&&r.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());this.markSelfDependent(),this.calculateTransitionsStackSync(this.onEffectSync,[r]);const n=r.getValue();if(n===void 0)throw new Error("Cycle during synchronous computation");return n===xe&&Ir(e),n}readCurrentOrProposedOrPrevious(e){const r=this.entries.get(e);if(r){const t=r.getValue();if(t!==void 0)return t;if(r.proposedValue!==void 0)return r.proposedValue}return this.readPrevious(e)}readCurrentOrProposedOrPreviousAsync(e){const r=this.entries.get(e);if(r){const t=r.getValue();if(t!==void 0)return t;if(r.proposedValue!==void 0)return r.proposedValue}return this.readPreviousAsync(e)}readPrevious(e){const r=this.baseRevision.getLatestEntryFor(e);if(!r)return;const t=r.getValue();return t!==xe?t===void 0&&e.lazy?this.read(e):t:void 0}readPreviousAsync(e){const r=this.baseRevision.getLatestEntryFor(e);if(!r)return;const t=r.getValue();return t!==xe?t!==void 0?t:this.readAsync(e):void 0}readProposedOrPrevious(e){const r=this.entries.get(e);return r&&r.proposedValue!==void 0?r.proposedValue:this.readPrevious(e)}readProposedOrPreviousAsync(e){const r=this.entries.get(e);return r&&r.proposedValue!==void 0?r.proposedValue:this.readPreviousAsync(e)}write(e,r,...t){r===void 0&&(r=null),e.write.call(e.context||e,e,this,null,r,...t);const i=this.entries.get(e);this.hasVariableEntry=this.hasVariableEntry||!i.isShadow()&&e.level===Wr.UserInput,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||i.hasProposedValue()}getWriteTarget(e){return this.touch(e).startOrigin()}acquireQuarkIfExists(e){const r=this.entries.get(e);return r&&r.origin===r?r.origin:void 0}touch(e){const r=this.entries.get(e);(!r||r.visitEpoch<this.walkContext.currentEpoch)&&this.walkContext.continueFrom([e]);const t=r||this.entries.get(e);return t.forceCalculation(),t}hasIdentifier(e){const r=this.entries.get(e);return r&&r.getValue()===xe?!1:!!(r||this.baseRevision.getLatestEntryFor(e))}addIdentifier(e,r,...t){let i=this.entries.get(e);const n=!!i,s=e.level===Wr.UserInput;return i||(i=e.newQuark(this.baseRevision),i.previous=this.baseRevision.getLatestEntryFor(e),i.forceCalculation(),this.entries.set(e,i),!e.lazy&&!s&&this.stackGen.push(i),this.hasVariableEntry=this.hasVariableEntry||!i.isShadow()&&s,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||i.hasProposedValue()),(r!==void 0||s)&&(i.startOrigin(),(!(n&&(i.proposedValue!==void 0||i.value!==void 0))||i.proposedValue===xe||i.value===xe)&&(e.isWritingUndefined=r===void 0,e.write.call(e.context||e,e,this,i,r===void 0&&s?null:r,...t),e.isWritingUndefined=!1)),i.getValue()===xe&&(i.value=void 0),i.proposedValue===xe&&(i.proposedValue=void 0),e.enterGraph(this.graph),i}removeIdentifier(e){e.leaveGraph(this.graph),this.touch(e).startOrigin().setValue(xe),this.candidate.selfDependent.delete(e)}populateCandidateScopeFromTransitions(e,r){if(e.scope.size===0)e.scope=r;else for(const[t,i]of r)if(i.isShadow()){const n=e.getLatestEntryFor(t);i.getOutgoing().forEach((s,a)=>n.getOutgoing().set(a,s))}else e.scope.set(t,i)}preCommit(e){if(this.isClosed)throw new Error("Can not propagate closed revision");this.markSelfDependent(),this.isClosed=!0,this.propagationStartDate=Date.now(),this.plannedTotalIdentifiersToCalculate=this.stackGen.length}postCommit(){this.populateCandidateScopeFromTransitions(this.candidate,this.entries);const e=this.entries;return this.walkContext=void 0,{revision:this.candidate,entries:e,transaction:this}}commit(e){return this.preCommit(e),this.calculateTransitionsSync(this.onEffectSync),this.postCommit()}reject(e=ho.new()){this.rejectedWith=e,this.walkContext=void 0}stop(){this.stopped=!0}clearRejected(){for(const e of this.entries.values())e.cleanup();this.entries.clear()}async commitAsync(e){return this.preCommit(e),this.ongoing=this.ongoing.then(()=>Ic(this.onEffectAsync,this.calculateTransitions,[this.onEffectAsync],this)).then(()=>this.postCommit())}getLatestEntryFor(e){let r=this.entries.get(e)||this.baseRevision.getLatestEntryFor(e);if(!(r&&r.getValue()===xe))return r}getLatestStableEntryFor(e){let r=this.entries.get(e);if(r){const t=r.getValue();return t===xe?void 0:t===void 0?this.baseRevision.getLatestEntryFor(e):r}else return this.baseRevision.getLatestEntryFor(e)}addEdge(e,r,t){if(r.identifier.level<e.level)throw new Error("Identifier can not read from higher level identifier");let n=this.entries.get(e);if(!n){const s=this.baseRevision.getLatestEntryFor(e);s||Ir(e),n=e.newQuark(this.baseRevision),n.setOrigin(s),n.previous=s,this.entries.set(e,n)}return n.addOutgoingTo(r,t),n}onQuarkCalculationCompleted(e,r){e.cleanup();const t=e.identifier,i=e.previous,n=!!(i&&i.hasValue()&&t.equality(r,i.getValue()));n?(i.outgoingInTheFutureAndPastTransactionCb(this,a=>{const o=this.entries.get(a.identifier);o&&o.edgesFlow--}),e.edgesFlow=en,e.setOrigin(i.origin),e.value=r):(e.startOrigin(),e.setValue(r));let s=!1;e.usedProposedOrPrevious&&(e.proposedValue!==void 0?t.equality(r,e.proposedValue)&&(s=!0):(n||!i&&r===null)&&(s=!0),s||this.candidate.selfDependent.add(t))}onReadIdentifier(e,r,t){const i=this.addEdge(e,r,_c);if(i.hasValue()||i.value!==void 0){const n=i.getValue();return n===xe&&Ir(e),r.continueCalculation(n)}else if(i.isShadow()){i.startOrigin(),i.forceCalculation(),t.push(i);return}else if(i.isCalculationStarted()){let n;return Q0.new({transaction:this,onCycle(a,o){return n=Fh.new({cycle:k0(o),requestedEntry:i,activeEntry:r}),Nr.Cancel}}).startFrom([i.identifier]),n}else{t.push(i),(!i.previous||!i.previous.hasValue())&&i.forceCalculation();return}}*calculateTransitions(e){const r=this.stackGen;for(;r.length;)yield*this.calculateTransitionsStackGen(e,r.takeLowestLevel())}calculateTransitionsSync(e){const r=this.stackGen;for(;r.length;)this.calculateTransitionsStackSync(e,r.takeLowestLevel())}*calculateTransitionsStackGen(e,r){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const t=this.entries,i=this.propagationStartDate,n=this.graph?this.graph.enableProgressNotifications:!1;let s=0;const a=this.activeStack;for(this.activeStack=r;r.length&&!this.rejectedWith&&!this.stopped;){if(n&&!(s++%this.emitProgressNotificationsEveryCalculations)){const h=Date.now();if(h-i>this.startProgressNotificationsAfterMs){const f=this.lastProgressNotificationDate;(!f||h-f>this.emitProgressNotificationsEveryMs)&&(this.lastProgressNotificationDate=h,this.graph.onPropagationProgressNotification({total:this.plannedTotalIdentifiersToCalculate,remaining:this.stackGen.length+r.length,phase:"propagating"}),this.activeStack=a,yield xc(0),this.activeStack=r)}}if(this.rejectedWith||this.stopped)break;const o=r[r.length-1],l=o.identifier;if(t.get(l)!==o){o.cleanup(),r.pop();continue}if(o.edgesFlow==0){o.edgesFlow--;const h=o.previous;h&&h.outgoingInTheFutureAndPastTransactionCb(this,g=>{const f=t.get(g.identifier);f&&f.edgesFlow--})}if(o.edgesFlow<0&&o.previous&&o.previous.origin){o.setOrigin(o.previous.origin),o.size===0&&t.delete(l),o.cleanup(),r.pop();continue}if(o.hasValue()||o.proposedValue===xe){o.cleanup(),r.pop();continue}const d=o.visitEpoch;let u=o.isCalculationStarted()?o.iterationResult:o.startCalculation(this.onEffectSync);for(;u&&!this.rejectedWith&&!this.stopped;){const h=u.value===void 0?null:u.value;if(o.isCalculationCompleted()){o.visitEpoch==d&&this.onQuarkCalculationCompleted(o,h),r.pop();break}else if(h instanceof nr){const g=this.onReadIdentifier(h,o,r);g instanceof Fh?(this.walkContext.startNewEpoch(),yield*this.graph.onComputationCycleHandler(g),o.cleanupCalculation(),u=void 0):u=g}else if(h===Ah){r.pop();break}else{const g=yield h;if(g===uo)break;if(o.visitEpoch===d)u=o.continueCalculation(g);else{r.pop();break}}}}this.activeStack=a}calculateTransitionsStackSync(e,r){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const t=this.entries,i=this.activeStack;for(this.activeStack=r;r.length&&!this.rejectedWith&&!this.stopped;){const n=r[r.length-1],s=n.identifier;if(t.get(s)!==n){n.cleanup(),r.pop();continue}if(n.edgesFlow==0){n.edgesFlow--;const c=n.previous;c&&c.outgoingInTheFutureAndPastTransactionCb(this,d=>{const u=t.get(d.identifier);u&&u.edgesFlow--})}if(n.edgesFlow<0&&n.previous&&n.previous.origin){n.setOrigin(n.previous.origin),n.size===0&&t.delete(s),n.cleanup(),r.pop();continue}if(n.hasValue()||n.proposedValue===xe){n.cleanup(),r.pop();continue}const o=n.visitEpoch;let l=n.isCalculationStarted()?n.iterationResult:n.startCalculation(this.onEffectSync);for(;l&&!this.rejectedWith&&!this.stopped;){const c=l.value===void 0?null:l.value;if(n.isCalculationCompleted()){n.visitEpoch==o&&this.onQuarkCalculationCompleted(n,c),r.pop();break}else if(c instanceof nr){const d=this.onReadIdentifier(c,n,r);d instanceof Fh?(this.walkContext.startNewEpoch(),this.graph.onComputationCycleHandlerSync(d,this),n.cleanupCalculation(),l=void 0):l=d}else if(c===Ah){r.pop();break}else{const d=e(c);if(Th(d))throw new Error("Effect resolved to promise in the synchronous context, check that you marked the asynchronous calculations accordingly");if(d===uo)break;if(n.visitEpoch===o)l=n.continueCalculation(d);else{r.pop();break}}}}this.activeStack=i}},Oh={rejectedWith:null},tR=class extends Ke{constructor(){super(...arguments),this.handlers=[]}trigger(e){for(let r=0;r<this.handlers.length;r++)this.handlers[r](e)}},rR=class extends Ke{constructor(){super(...arguments),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.baseRevision=kh.new(),this.topRevision=void 0,this.historyLimit=0,this.listeners=new Map,this.isWritingPreviousData=!1,this.$activeTransaction=void 0,this.isCommitting=!1,this.enableProgressNotifications=!1,this.ongoing=Promise.resolve(),this._isInitialCommit=!0,this.autoCommitTimeoutId=null,this.autoCommit=!1,this.autoCommitMode="sync",this.autoCommitHandler=null,this.onWriteDuringCommit="throw",this.onComputationCycle="throw",this.transactionClass=Py,this.isJustCleared=!1,this.$followingRevision=void 0}initialize(...e){super.initialize(...e),this.topRevision||(this.topRevision=this.baseRevision),this.autoCommit&&(this.autoCommitHandler=this.autoCommitMode==="sync"?r=>this.commit(r):async r=>this.commitAsync(r)),this.markAndSweep()}hasPendingAutoCommit(){return this.autoCommitTimeoutId!==null}get dirty(){return this.activeTransaction.dirty}clear(){this.reject(),this.unScheduleAutoCommit(),this.baseRevision.scope&&this.baseRevision.scope.clear(),this.baseRevision.previous=null,this.listeners.clear(),this.topRevision=this.baseRevision,this.$followingRevision=void 0,this.$activeTransaction=void 0,this.markAndSweep(),this.isJustCleared=!0}*eachReachableRevision(){let e=!0,r=0;for(const t of this.topRevision.previousAxis())yield[t,e||r<this.historyLimit],t===this.baseRevision?e=!1:e||r++}get isInitialCommit(){return this._isInitialCommit}set isInitialCommit(e){this._isInitialCommit=e}markAndSweep(){let e;const r=[];for(const[t,i]of this.eachReachableRevision())i?(t.reachableCount++,e=t):r.push(t),t.referenceCount++;r.unshift(e);for(let t=r.length-1;t>=1&&r[t].reachableCount===0;t--)this.compactRevisions(r[t-1],r[t])}compactRevisions(e,r){if(r.reachableCount>0||e.previous!==r)throw new Error("Invalid compact operation");if(r.referenceCount<=1){for(const[t,i]of e.scope)if(i.getValue()===xe)r.scope.delete(t);else{const n=r.scope.get(t);i.origin===i?n&&(n.clear(),n.clearProperties()):n&&i.origin===n?i.mergePreviousOrigin(e.scope):t.lazy&&!i.origin&&n&&n.origin&&(i.startOrigin().proposedValue=n.origin.value!==void 0?n.origin.value:n.origin.proposedValue),i.previous=void 0,r.scope.set(t,i)}YO(e.selfDependent,r.selfDependent),e.scope=r.scope,r.scope=null}else e.scope=new Map(ax(r.scope,e.scope)),e.selfDependent=new Set(ax(r.selfDependent,e.selfDependent)),r.referenceCount--;e.previous=null}get followingRevision(){if(this.$followingRevision!==void 0)return this.$followingRevision;const e=Array.from(this.topRevision.previousAxis()),r=[];for(let t=e.length-1;t>0;t--)r.push([e[t],e[t-1]]);return this.$followingRevision=new Map(r)}get activeTransaction(){return this.$activeTransaction?this.$activeTransaction:this.$activeTransaction=this.transactionClass.new({baseRevision:this.baseRevisionTentative||this.baseRevision,graph:this})}branch(e){return this.constructor.new(Object.assign({},e,{baseRevision:this.baseRevision}))}propagate(e){return this.commit(e)}reject(e){this.activeTransaction.reject(ho.new({reason:e})),this.ongoing=Promise.resolve(),this.$activeTransaction=void 0,this.baseRevisionTentative=void 0,this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable,this.baseRevisionStable=void 0)}commit(e){this.isJustCleared=!1,this.unScheduleAutoCommit(),this.baseRevisionStable=this.baseRevision;const t=this.activeTransaction.commit(e);this.$activeTransaction=void 0;const i=this.finalizeCommit(t);return this.baseRevisionStable=void 0,this.isInitialCommit=!1,i}async propagateAsync(e){return this.commitAsync(e)}async commitAsync(e){if(this.isCommitting)return this.ongoing;this.isJustCleared=!1,this.isCommitting=!0,this.baseRevisionStable=this.baseRevision;let r;return this.ongoing=this.ongoing.then(()=>this.doCommitAsync(e)).then(t=>(r=t,t)).finally(()=>{this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.isInitialCommit=!1,this.isCommitting=!1})}async doCommitAsync(e){this.unScheduleAutoCommit();const r=this.activeTransaction,t=await r.commitAsync(e),i=!!r.rejectedWith,n=this.baseRevisionTentative;if(i||(this.baseRevisionTentative=r.candidate),this.$activeTransaction=void 0,await this.finalizeCommitAsync(t),this.isJustCleared)return{rejectedWith:ho.new({reason:"Graph cleared"})};r.rejectedWith&&!i&&(this.baseRevisionTentative=n,this.$activeTransaction=void 0);const s=this.finalizeCommit(t);return r.rejectedWith&&r.clearRejected(),this.dirty&&!r.rejectedWith&&await this.doCommitAsync(e),s}finalizeCommit(e){const{revision:r,entries:t,transaction:i}=e;if(i.rejectedWith)this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0;else{if(r.previous!==this.baseRevision)throw new Error("Invalid revisions chain");for(const[n,s]of this.eachReachableRevision())s&&n.reachableCount--,n.referenceCount--;this.baseRevision=this.topRevision=r;for(const[n,s]of t){if(s.cleanup(),s.isShadow()||!s.hasValue())continue;const a=this.listeners.get(n);a&&a.trigger(s.getValue())}this.$followingRevision=void 0,this.markAndSweep()}return{rejectedWith:i.rejectedWith}}async finalizeCommitAsync(e){}*onComputationCycleHandler(e){const r=new Error(`Computation cycle:
`+e);switch(r.cycle=e,this.onComputationCycle){case"ignore":console.log(r.message);const{requestedEntry:t,activeEntry:i}=e;return i.continueCalculation(t.proposedValue!==void 0?t.proposedValue:t.value);case"throw":throw r;case"reject":this.reject(r);break;case"warn":Rc(r);break}}onComputationCycleHandlerSync(e,r){const t=new Error(`Computation cycle:
`+e);switch(t.cycle=e,this.onComputationCycle){case"ignore":console.log(t.message);const{requestedEntry:i,activeEntry:n}=e;return n.continueCalculation(i.proposedValue!==void 0?i.proposedValue:i.value);case"throw":throw t;case"reject":this.reject(t);break;case"warn":Rc(t);break}}scheduleAutoCommit(){this.autoCommitTimeoutId===null&&!this.isCommitting&&(this.autoCommitTimeoutId=setTimeout(this.autoCommitHandler,10))}unScheduleAutoCommit(){this.autoCommitTimeoutId!==null&&(clearTimeout(this.autoCommitTimeoutId),this.autoCommitTimeoutId=null)}variable(e){const r=Ty();return this.addIdentifier(r,e===void 0?null:e)}variableNamed(e,r){const t=Ty({name:e});return this.addIdentifier(t,r===void 0?null:r)}identifier(e,r){const t=ay(e)?Iy({calculation:e,context:r}):My({calculation:e,context:r});return this.addIdentifier(t)}identifierNamed(e,r,t){const i=r.constructor.name==="GeneratorFunction"?Iy({name:e,calculation:r,context:t}):My({name:e,calculation:r,context:t});return this.addIdentifier(i)}addIdentifier(e,r,...t){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Adding identifier during commit");this.onWriteDuringCommit==="warn"&&Rc(new Error("Adding identifier during commit"))}return this.activeTransaction.addIdentifier(e,r,...t),this.autoCommit&&this.scheduleAutoCommit(),e}removeIdentifier(e){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Removing identifier during commit");this.onWriteDuringCommit==="warn"&&Rc(new Error("Removinfg identifier during commit"))}this.activeTransaction.removeIdentifier(e),this.listeners.delete(e),this.autoCommit&&this.scheduleAutoCommit()}hasIdentifier(e){return this.activeTransaction.hasIdentifier(e)}write(e,r,...t){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Write during commit");this.onWriteDuringCommit==="warn"&&Rc(new Error("Write during commit"))}this.activeTransaction.write(e,r,...t),this.autoCommit&&this.scheduleAutoCommit()}readPrevious(e){return this.activeTransaction.readPrevious(e)}readPreviousAsync(e){return this.activeTransaction.readPreviousAsync(e)}read(e){return this.activeTransaction.read(e)}readAsync(e){return this.activeTransaction.readAsync(e)}get(e){return this.activeTransaction.get(e)}observe(e,r){const t=this.addIdentifier(Mr.new({lazy:!1,calculation:e}));return this.addListener(t,r),t}observeContext(e,r,t){const i=this.addIdentifier(Mr.new({lazy:!1,calculation:e,context:r}));return this.addListener(i,t),i}addListener(e,r){let t=this.listeners.get(e);t||(t=tR.new(),this.listeners.set(e,t)),t.handlers.push(r)}undo(){const r=this.baseRevision.previous;return r?(this.baseRevision=r,this.$activeTransaction=void 0,!0):!1}redo(){const e=this.baseRevision;if(e===this.topRevision)return!1;const r=this.followingRevision.get(e);return this.baseRevision=r,this.$activeTransaction=void 0,!0}onPropagationProgressNotification(e){}[uy](e,r){const t=r.getActiveEntry();t.usedProposedOrPrevious=!0;const i=t.getProposedValue(r);return i!==void 0?i:t.previous?t.identifier.lazy?t.previous.hasValue()?t.previous.getValue():t.previous.hasProposedValue()?t.previous.getProposedValue(r):null:r.readPrevious(t.identifier):void 0}[Mc](e,r){return this.reject(e.reason),uo}[hy](e,r){return r}[gy](e,r){return r.getActiveEntry()}[fy](e,r){return r.getActiveEntry().identifier}[my](e,r){const t=r.getActiveEntry();if(t.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");const i=e.identifier.level>t.identifier.level;return i||r.walkContext.startNewEpoch(),r.write(e.identifier,...e.proposedArgs),i?void 0:uo}[vy](e,r){const t=r.getActiveEntry();if(t.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");let i=!0;return e.writes.forEach(n=>{n.identifier.level<=t.identifier.level&&i&&(r.walkContext.startNewEpoch(),i=!1),r.write(n.identifier,...n.proposedArgs)}),i?void 0:uo}[by](e,r){const t=r.getActiveEntry(),i=e.identifier;return r.addEdge(i,t,ps),r.readPrevious(i)}[Cy](e,r){const t=r.getActiveEntry(),i=e.identifier;r.addEdge(i,t,ps);const n=r.entries.get(i);return n&&!n.isShadow()?n.getProposedValue(r):void 0}[Sy](e,r){const t=r.getActiveEntry(),i=e.identifier;r.addEdge(i,t,ps);const n=r.entries.get(i);return n?n.hasProposedValue():!1}[Dy](e,r){const t=r.getActiveEntry(),i=e.identifier;r.addEdge(i,t,ps);const n=r.entries.get(i);return n?n.hasProposedValue()&&!n.proposedIsPrevious:!1}[wy](e,r){const t=r.getActiveEntry(),i=e.identifier;return r.addEdge(i,t,ps),r.readProposedOrPrevious(i)}[xy](e,r){return r.readProposedOrPrevious(e.identifier)}[Ry](e,r){return r.readPrevious(e.identifier)}[Ey](e,r){const t=r.getActiveEntry(),i=e.identifier;r.addEdge(i,t,ps);const n=r.entries.get(i);return n&&!n.isShadow()?n.proposedArguments:void 0}},iR=class extends Ke{constructor(){super(...arguments),this.name=void 0,this.ownFields=new Map,this.schema=void 0,this.$skeleton={},this.$allFields=void 0}hasField(e){return this.getField(e)!==void 0}getField(e){return this.allFields.get(e)}addField(e){const r=e.name;if(!r)throw new Error("Field must have a name");if(this.ownFields.has(r))throw new Error(`Field with name [${r}] already exists`);return e.entity=this,this.ownFields.set(r,e),e}forEachParent(e){let r=this;for(;r;)e(r),r=r.parentEntity}get allFields(){if(this.$allFields!==void 0)return this.$allFields;const e=new Map,r=new Set;return this.forEachParent(t=>{t.ownFields.forEach((i,n)=>{r.has(n)||(r.add(n),e.set(n,i))})}),this.$allFields=e}forEachField(e){this.allFields.forEach(e)}},pi;(function(e){e[e.Current=0]="Current",e[e.Previous=1]="Previous",e[e.ProposedOrPrevious=2]="ProposedOrPrevious",e[e.CurrentOrProposedOrPrevious=3]="CurrentOrProposedOrPrevious"})(pi||(pi={}));var Ay=class extends G([rR],e=>class extends e{constructor(){super(...arguments),this.autoCommit=!0,this.readMode=pi.Current}addEntity(t){t.enterGraph(this)}addEntities(t){t.forEach(i=>this.addEntity(i))}removeEntity(t){t.leaveGraph(this)}removeEntities(t){t.forEach(i=>this.removeEntity(i))}}){},yr=class extends G([nr],e=>class extends e{constructor(){super(...arguments),this.field=void 0,this.self=void 0,this.DATA=void 0}getFromGraph(t){return t?t.readMode===pi.Current?t.get(this):t.readMode===pi.Previous?t.activeTransaction.readPrevious(this):(t.readMode===pi.ProposedOrPrevious&&t.activeTransaction.readProposedOrPrevious(this),t.activeTransaction.readCurrentOrProposedOrPrevious(this)):this.DATA}readFromGraph(t){return t?t.read(this):this.DATA}writeToGraph(t,i,...n){t?t.write(this,i,...n):this.DATA=i}leaveGraph(t){const i=t.activeTransaction.getLatestStableEntryFor(this);i&&(this.DATA=i.getValue()),super.leaveGraph(t)}toString(){return this.name}}){},kc=class extends yr.mix(po){},_y=class extends yr.mix(Mr){},ky=class extends yr.mix(Ac){},nR=class extends G([nr],e=>class extends e{constructor(){super(...arguments),this.entity=void 0,this.self=void 0}equality(){return!1}toString(){return`Entity identifier [${this.self}]`}}){},sR=class extends nR.mix(Mr){},vo=class extends Pc{constructor(){super(...arguments),this.persistent=!0}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?ay(e)?_y:kc:ky}},aR=Symbol("isEntity"),Gr=class extends G([],e=>{class r extends e{[aR](){}get $entity(){return Fy(this.constructor.prototype)}get $(){const i={};if(this.$entity.forEachField((n,s)=>{i[s]=this.createFieldIdentifier(n)}),lo){const n=new Proxy(i,{get(s,a,o){return s[a]||XO(new Error(`Attempt to read a missing field ${String(a)} on ${s}`)),s[a].SOURCE_POINT=I0.fromThisCall(),s[a]}});return Rh(this,"$",n)}else return Rh(this,"$",i)}get $$(){return Rh(this,"$$",sR.new({name:this.$entityName,entity:this.$entity,calculation:this.calculateSelf,context:this,self:this}))}get $entityName(){return this.constructor.name||this.$entity.name}*calculateSelf(){return this}createFieldIdentifier(i){const n=i.name,s=this.$entity,a=this.constructor,o=s.$skeleton;o[n]||(o[n]=a.getIdentifierTemplateClass(this,i));const l=new o[n];return l.context=this,l.self=this,l.name=`${this.$$.name}.$.${i.name}`,l}forEachFieldIdentifier(i){this.$entity.forEachField((n,s)=>i(this.$[s],s,n))}enterGraph(i){if(this.graph)throw new Error("Already entered replica");this.graph=i,i.addIdentifier(this.$$),this.$entity.forEachField((n,s)=>{const a=this.$[s];i.addIdentifier(a,a.DATA),a.DATA=void 0})}leaveGraph(i){const n=this.graph,s=i||n;s&&(this.$entity.forEachField((a,o)=>s.removeIdentifier(this.$[o])),s.removeIdentifier(this.$$),s===n&&(this.graph=void 0))}propagate(i){return this.commit(i)}commit(i){const n=this.graph;return n?n.commit(i):Oh}async propagateAsync(){return this.commitAsync()}async commitAsync(i){const n=this.graph;return n?n.commitAsync(i):Promise.resolve(Oh)}static get $entity(){return vs(this.prototype)}static getIdentifierTemplateClass(i,n){const s=n.name,a={name:`${i.$$.name}.$.${s}`,field:n};n.hasOwnProperty("sync")&&(a.sync=n.sync),n.hasOwnProperty("lazy")&&(a.lazy=n.lazy),n.hasOwnProperty("equality")&&(a.equality=n.equality);const o=i.$calculations&&i[i.$calculations[s]];o&&(a.calculation=o);const l=i.$writes&&i[i.$writes[s]];l&&(a.write=l);const c=i.$buildProposed&&i[i.$buildProposed[s]];c&&(a.buildProposedValue=c,a.proposedValueIsBuilt=!0);const d=n.getIdentifierClass(o).new(a),u=function(){};return u.prototype=d,u}run(i,...n){const s=c=>{if(c instanceof nr)return this.graph.read(c);throw new Error("Helper methods can not yield effects during computation")},a=this.graph.activeTransaction,o=a.activeStack;a.activeStack=[];const l=Z0(s,this[i],n,this);return a.activeStack=o,l}static createPropertyAccessorsFor(i){const n=i,s=this.prototype;Object.defineProperty(s,n,{get:function(){return this.$[n].getFromGraph(this.graph)},set:function(a){this.$[n].writeToGraph(this.graph,a)}})}static createMethodAccessorsFor(i){const n=i,s=this.prototype,a=`get${ny(n)}`,o=`set${ny(n)}`,l=`put${ny(n)}`;a in s||(s[a]=function(){return this.$[n].getFromGraph(this.graph)}),o in s||(s[o]=function(c,...d){return this.$[n].writeToGraph(this.graph,c,...d),this.graph?this.graph.autoCommitMode==="sync"?this.graph.commit():this.graph.commitAsync():Promise.resolve(Oh)}),l in s||(s[l]=function(c,...d){this.$[n].writeToGraph(this.graph,c,...d)})}}return r}){},Fy=e=>{let r=Object.getPrototypeOf(e);return Rh(e,"$entity",iR.new({parentEntity:r.hasOwnProperty(aR)?null:r.$entity,name:e.constructor.name}))},vs=e=>(e.hasOwnProperty("$entity")||Fy(e),e.$entity),Ut=(e,r=vo)=>function(t,i){const s=vs(t).addField(r.new(Object.assign(e||{},{name:i}))),a=t.constructor;a.createPropertyAccessorsFor(i),a.createMethodAccessorsFor(i)},me=Ut,ie=function(e){return function(r,t,i){vs(r);let n;r.$calculations?r.hasOwnProperty("$calculations")?n=r.$calculations:n=r.$calculations=Object.create(r.$calculations):n=r.$calculations={},n[e]=t}},br=function(e){return function(r,t,i){vs(r);let n;r.$writes?r.hasOwnProperty("$writes")?n=r.$writes:n=r.$writes=Object.create(r.$writes):n=r.$writes={},n[e]=t}},oR=function(e){return function(r,t,i){vs(r);let n;r.$buildProposed?r.hasOwnProperty("$buildProposed")?n=r.$buildProposed:n=r.$buildProposed=Object.create(r.$buildProposed):n=r.$buildProposed={},n[e]=t}},lR=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Oy=class extends G([vo],e=>class extends e{constructor(){super(...arguments),this.identifierCls=dR}}){},cR=(e,r=Oy)=>Ut(e,r),Ly=class extends G([yr],e=>{class r extends e{constructor(){super(...arguments),this.field=void 0,this.proposedValueIsBuilt=!0}hasBucket(){return!!this.field.bucket}getBucket(i){return i.$[this.field.bucket]}buildProposedValue(i,n,s){const a=n.proposedValue;if(a===null)return null;const o=Wt(a,Gr)?a:i.resolve(a);return o&&i.hasBucket()&&i.getBucket(o).addToBucket(s,i.self),o}resolve(i){const n=this.field.resolver;return n?n.call(this.self,i):null}enterGraph(i){if(this.hasBucket()){const n=i.activeTransaction.readProposedOrPrevious(this);n instanceof Gr&&this.getBucket(n).addToBucket(i.activeTransaction,this.self)}super.enterGraph(i)}leaveGraph(i){if(this.hasBucket()){const n=i.activeTransaction.readProposedOrPrevious(this);n instanceof Gr&&this.getBucket(n).removeFromBucket(i.activeTransaction,this.self)}super.leaveGraph(i)}write(i,n,s,a,...o){const l=s||n.acquireQuarkIfExists(i);if(i.hasBucket()){if(l){const c=l.getValue();c instanceof Gr&&i.getBucket(c).removeFromBucket(n,i.self)}else if(n.baseRevision.hasIdentifier(i)){const c=n.readPrevious(i);c instanceof Gr&&i.getBucket(c).removeFromBucket(n,i.self)}}super.write(i,n,s,a)}}return lR([pe(Wr.DependsOnlyOnUserInput)],r.prototype,"level",void 0),lR([pe(mo)],r.prototype,"quarkClass",void 0),r}){},dR=class extends Ly.mix(yr.mix(po)){},uR=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},$y=class extends G([vo],e=>class extends e{constructor(){super(...arguments),this.persistent=!1,this.identifierCls=mR}}){},hR=(e,r=$y)=>Ut(e,r),yo;(function(e){e.Add="Add",e.Remove="Remove"})(yo||(yo={}));var gR=class extends G([_h],e=>class extends e{constructor(){super(...arguments),this.mutations=[],this.previousValue=void 0}hasProposedValueInner(){return this.mutations.length>0}}){},fR=gR.mix(mo),jy=class extends G([yr],e=>{class r extends e{constructor(){super(...arguments),this.proposedValueIsBuilt=!0}addToBucket(i,n){const s=i.getWriteTarget(this);s.mutations.push({type:yo.Add,entity:n});const a=i.baseRevision;!s.previousValue&&a.hasIdentifier(this)&&(s.previousValue=i.readPrevious(this))}removeFromBucket(i,n){const s=i.entries.get(this);if(s&&s.getValue()===xe)return;const a=i.getWriteTarget(this);a.mutations.push({type:yo.Remove,entity:n});const o=i.baseRevision;!a.previousValue&&o.hasIdentifier(this)&&(a.previousValue=i.readPrevious(this))}buildProposedValue(i,n,s){const a=n,o=new Set(a.previousValue);for(let l=0;l<a.mutations.length;l++){const{type:c,entity:d}=a.mutations[l];c===yo.Remove?o.delete(d):c===yo.Add&&o.add(d)}return o}leaveGraph(i){super.leaveGraph(i),this.DATA=void 0}}return uR([pe(Wr.DependsOnlyOnDependsOnlyOnUserInput)],r.prototype,"level",void 0),uR([pe(fR)],r.prototype,"quarkClass",void 0),r}){},mR=class extends jy.mix(yr.mix(po)){},pR=class extends Ke{constructor(){super(...arguments),this.entities=new Map}hasEntity(e){return this.entities.has(e)}getEntity(e){return this.entities.get(e)}addEntity(e){const r=e.name;if(!r)throw new Error("Entity must have a name");if(this.hasEntity(r))throw new Error(`Entity with name [${String(r)}] already exists`);return e.schema=this,this.entities.set(r,e),e}getEntityDecorator(){return e=>{const r=By(e);return this.addEntity(r),e}}},By=e=>{if(!e.name)throw new Error("Can't add entity - the target class has no name");return vs(e.prototype)},uL=()=>e=>(By(e),e),Lh=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},rn=function(e,r){return e===r||(r!=null&&r.isBase?this.serialize(r):r)===(e!=null&&e.isBase?this.serialize(e):e)},$h=class extends vo{constructor(){super(...arguments),this.modelFieldConfig={}}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?ay(e)?bR:yR:CR}},ys=class extends Oy.mix($h){constructor(){super(...arguments),this.identifierCls=Fc}},bs=class extends $y.mix(vo){constructor(){super(...arguments),this.identifierCls=Bh}},jh=Symbol("IsChronoModelSymbol"),bo=class extends G([yr],e=>{const r=e.prototype;class t extends e{[jh](){}getFromGraph(n){var s,a;if(n){if(n.readMode===pi.CurrentOrProposedOrPrevious){const o=n.isCommitting&&this.level>((a=(s=n.activeTransaction.getActiveEntry())==null?void 0:s.level)!=null?a:Number.MAX_SAFE_INTEGER);return this.sync&&!this.context.project.isDelayingCalculation&&!o?n.get(this):n.activeTransaction.readCurrentOrProposedOrPrevious(this)}return r.getFromGraph.call(this,n)}else return this.DATA}writeToGraph(n,s,...a){n?r.writeToGraph.call(this,n,s,...a):(this.DATA=s,!this.self.inSetting&&!this.self.isConstructing&&this.self.set(this.field.name,s,!1,!1,!0))}write(n,s,a,o,...l){o=n.convert(o),r.write.call(this,n,s,a,o,...l)}convert(n){const s=this.field,a=this.self.getFieldDefinition(s.name);return a!=null&&a.convert?n=a.convert(n,this.context.data,this.context):s.converter&&(n=s.converter(n,s)),n}equality(n,s){return n instanceof Date&&s instanceof Date?n.getTime()===s.getTime():n===s}}return Lh([pe(!1)],t.prototype,"sync",void 0),t}){},vR=class extends G([mo],e=>{const r=e.prototype;class t extends e{setValue(n){r.setValue.call(this,n),n!==xe&&(this.identifier.DATA=n)}}return t}){},Fc=class extends Ly.mix(bo.mix(kc)){buildProposedValue(e,r,t){const i=r,n=i.proposedValue;if(n==null)return t.candidate.failedResolutionReferences.delete(i.identifier),null;if(Wt(n,Gr)&&n.graph)return e.hasBucket()&&e.getBucket(n).addToBucket(t,e.self),t.candidate.failedResolutionReferences.delete(i.identifier),n;const s=e.resolve(n);return Wt(s,Gr)&&s.graph?(e.hasBucket()&&e.getBucket(s).addToBucket(t,e.self),t.candidate.failedResolutionReferences.delete(i.identifier),s):(t.candidate.failedResolutionReferences.set(i.identifier,n),null)}};Lh([pe(!0)],Fc.prototype,"sync",void 0),Lh([pe(vR)],Fc.prototype,"quarkClass",void 0);var Bh=class extends jy.mix(bo.mix(kc)){};Lh([pe(!0)],Bh.prototype,"sync",void 0);var yR=class extends bo.mix(kc){},bR=class extends bo.mix(_y){},CR=class extends bo.mix(ky){},de=function(e={},r={},t=$h){return function(i,n){Ut({modelFieldConfig:e,...r},t)(i,n),Hh(i.constructor)}},Hh=e=>{e.hasOwnProperty("fields")||Object.defineProperty(e,"fields",{get:function(){return SR(this)}})},SR=e=>{const r=e.prototype,t=[];return r.hasOwnProperty("$entity")&&r.$entity.ownFields.forEach(i=>{if(i instanceof $h){const n=i.modelFieldConfig||{};!n.convert&&i.converter&&i.converter!==vi&&(n.convert=i.converter),t.push(Object.assign(n,{$chrono:i,name:i.name}))}}),t},vi=(e,r)=>{var t,i;return e===null?null:(e instanceof Date||(e=b.parse(e,((t=r.modelFieldConfig)==null?void 0:t.format)||((i=r.modelFieldConfig)==null?void 0:i.dateFormat)||b.defaultParseFormat)),e||void 0)},Vh=class extends G([Gr,ce],e=>{const r=e.prototype;class t extends e{get isEntity(){return!0}construct(n,...s){this.constructor.exposeProperties(),this.originalData=n=n||{},r.construct.call(this,n,...s);for(const a in this.originalData)this.$[a]&&!this.getFieldDefinition(a)&&(this[a]=n[a])}*userProvidedValue(){return yield Ee}copy(n=null,s=null){const a=r.copy.call(this,n,s),{creatingOccurrence:o}=s!=null?s:{};return(T.isObject(s)&&!s.skipFieldIdentifiers||!T.isObject(s))&&this.forEachFieldIdentifier((l,c,d)=>{var u;!d.lazy&&((u=this.getFieldDefinition(c))==null?void 0:u.type)!=="store"&&(!o||l instanceof Bh||l instanceof Fc)&&(a[c]=this[c])}),a}applyValue(n,s,a,o,l){var c;this.$entity.getField((l==null?void 0:l.name)||s)&&(n=!0),o&&(n=!1),r.applyValue.call(this,n,n&&(c=l==null?void 0:l.name)!=null?c:s,a,o,l)}get isInActiveTransaction(){var n;const s=(n=this.graph)==null?void 0:n.activeTransaction;return!!(s!=null&&s.getLatestEntryFor(this.$$))}get data(){return this._data}set data(n){this._data=n;const{fields:s,$:a,graph:o,generation:l}=this;for(let c=0;c<s.length;c++){const{name:d,dataSource:u,complexMapping:h}=s[c],g=a[d];if(g){const f=h?T.getPath(n,u):n[u];(h||u in n)&&(l!=null||f!==void 0)&&g.writeToGraph(o,f)}}}get $entityName(){const n=this.constructor.name||this.$entity.name,s=this.id;return`${n}${s!=null?"-"+String(s):""}`}}return t}){},hL={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",RemoveDependencyCycleEffectResolution:{descriptionTpl:"Remove dependency"},DeactivateDependencyCycleEffectResolution:{descriptionTpl:"Deactivate dependency"},CycleEffectDescription:{descriptionTpl:"A cycle has been found, formed by: {0}"},EmptyCalendarEffectDescription:{descriptionTpl:'"{0}" calendar does not provide any working time intervals.'},Use24hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 24 hours calendar with non-working Saturdays and Sundays."},Use8hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 8 hours calendar (08:00-12:00, 13:00-17:00) with non-working Saturdays and Sundays."},ConflictEffectDescription:{descriptionTpl:"A scheduling conflict has been found: {0} is conflicting with {1}"},ConstraintIntervalDescription:{dateFormat:"LLL"},ProjectConstraintIntervalDescription:{startDateDescriptionTpl:"Project start date {0}",endDateDescriptionTpl:"Project end date {0}"},DependencyType:{long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},ManuallyScheduledParentConstraintIntervalDescription:{startDescriptionTpl:'Manually scheduled "{2}" forces its children to start no earlier than {0}',endDescriptionTpl:'Manually scheduled "{2}" forces its children to finish no later than {1}'},DisableManuallyScheduledConflictResolution:{descriptionTpl:'Disable manual scheduling for "{0}"'},DependencyConstraintIntervalDescription:{descriptionTpl:'Dependency ({2}) from "{3}" to "{4}"'},RemoveDependencyResolution:{descriptionTpl:'Remove dependency from "{1}" to "{2}"'},DeactivateDependencyResolution:{descriptionTpl:'Deactivate dependency from "{1}" to "{2}"'},DateConstraintIntervalDescription:{startDateDescriptionTpl:'Task "{2}" {3} {0} constraint',endDateDescriptionTpl:'Task "{2}" {3} {1} constraint',constraintTypeTpl:{startnoearlierthan:"Start-No-Earlier-Than",finishnoearlierthan:"Finish-No-Earlier-Than",muststarton:"Must-Start-On",mustfinishon:"Must-Finish-On",startnolaterthan:"Start-No-Later-Than",finishnolaterthan:"Finish-No-Later-Than"}},RemoveDateConstraintConflictResolution:{descriptionTpl:'Remove "{1}" constraint of task "{0}"'}},ej=yt.publishLocale(hL),Nh=class extends Ke{initialize(...e){super.initialize(...e),this.startDate||(this.startDate=Xe),this.endDate||(this.endDate=He)}equalTo(e){return this.startDate.getTime()===e.startDate.getTime()&&this.endDate.getTime()===e.endDate.getTime()}isInfinite(){return this.startDate.getTime()===Xe.getTime()&&this.endDate.getTime()===He.getTime()}startDateIsFinite(){return!this.isIntervalEmpty()&&this.startDate.getTime()!==Xe.getTime()}endDateIsFinite(){return!this.isIntervalEmpty()&&this.endDate.getTime()!==He.getTime()}containsDate(e,r=Br.Left){return r===Br.Left&&e>=this.startDate&&e<this.endDate||r===Br.Right&&e>this.startDate&&e<=this.endDate}isIntervalEmpty(){return this.startDate>this.endDate}intersect(e){const r=e.startDate,t=e.endDate,i=this.startDate,n=this.endDate;if(n<r||i>t)return DR;const s=new Date(Math.max(i.getTime(),r.getTime())),a=new Date(Math.min(n.getTime(),t.getTime()));return this.constructor.new({startDate:s,endDate:a})}intersectMut(e,r=!1){var t;const i=e.startDate,n=e.endDate,s=this.startDate,a=this.endDate;if(r&&(this.intersectionOf||(this.intersectionOf=new Set),((t=e.intersectionOf)==null?void 0:t.size)>0?(e.intersectionOf.forEach(this.intersectionOf.add,this.intersectionOf),this.intersectedAsEmpty=e.intersectedAsEmpty):this.intersectionOf.add(e)),!this.isIntervalEmpty()){if(a<i||s>n)return this.startDate=He,this.endDate=Xe,r&&(this.intersectedAsEmpty=e),this;this.startDate=new Date(Math.max(s.getTime(),i.getTime())),this.endDate=new Date(Math.min(a.getTime(),n.getTime()))}return this}getCopyProperties(e){return e}copyWith(e){const r=this.getCopyProperties(e);return this.constructor.new(r)}},DR=Nh.new({startDate:He,endDate:Xe}),nn=(e,r=!1)=>e.reduce((t,i)=>t.intersectMut(i,r),Nh.new()),wR=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},sr;(function(e){e.Cancel="Cancel",e.Resume="Resume"})(sr||(sr={}));var Oc=class extends F{getDescription(){throw new Error("Abstract method")}resolve(...e){throw new Error("Abstract method")}},Lc=class extends at{getResolutions(){return this._resolutions}getDescriptionBuilderClass(){return this._descriptionBuilderClass}setDescriptionBuilderClass(e){this._descriptionBuilderClass=e}getDescription(){return this.getDescriptionBuilderClass().getDescription(this)}};wR([pe("schedulingIssueEffect")],Lc.prototype,"type",void 0),wR([pe(!1)],Lc.prototype,"sync",void 0);var Hy=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Vy=Symbol("ConflictSymbol"),ER=class extends We(F){static get $name(){return"ConflictEffectDescription"}static getDescription(e){return mr(this.L("L{descriptionTpl}"),e.intervals[0].getDescription(),e.intervals[1].getDescription())}},sn=class extends Lc{constructor(){super(...arguments),this.handler=Vy}initialize(e){super.initialize(e),this.intervals=this.filterConflictingIntervals(this.intervals)}getResolutions(){return this._resolutions||(this._resolutions=[].concat(...this.intervals.map(e=>e.getResolutions()))),this._resolutions}filterConflictingIntervals(e){const r=[],t=[...e].filter(n=>!n.isInfinite()),i=t.find(n=>n.isAffectedByTransaction());if(i){const n=t.sort((o,l)=>o===i?-1:0),a=nn(n,!0).intersectedAsEmpty;r.push(a,i)}else r.push(nn(t,!0).intersectedAsEmpty,nn(t.reverse(),!0).intersectedAsEmpty);return r}};Hy([pe("schedulingConflict")],sn.prototype,"type",void 0),Hy([pe(ER)],sn.prototype,"_descriptionBuilderClass",void 0);var zh=class extends Oc{resolve(){throw new Error("Abstract method")}},Co=class extends We(F){static get $name(){return"ConstraintIntervalDescription"}static getDescription(e){return mr(this.L("L{descriptionTpl}"),...this.getDescriptionParameters(e))}static getDescriptionParameters(e){return[b.format(e.startDate,this.L("L{dateFormat}")),b.format(e.endDate,this.L("L{dateFormat}"))]}},an=class extends Nh{constructor(){super(...arguments),this.owner=void 0,this.reflectionOf=void 0,this.side=void 0,this.resolutions=void 0}get isConstraintInterval(){return!0}getDescription(){return this.descriptionBuilderClass.getDescription(this)}getResolutions(){return[]}isAffectedByTransaction(e){return!1}getCopyProperties(e){const{owner:r,reflectionOf:t,side:i}=this;return Object.assign({owner:r,reflectionOf:t,side:i},e)}};Hy([pe(Co)],an.prototype,"descriptionBuilderClass",void 0);var Ny=class extends G([sc],e=>{const r=e.prototype;class t extends e{getGraph(){const n=this.getProject();return n==null?void 0:n.getGraph()}getEventById(n){var s;return(s=this.getEventStore())==null?void 0:s.getById(n)}getDependencyById(n){var s;return(s=this.getDependencyStore())==null?void 0:s.getById(n)}getResourceById(n){var s;return(s=this.getResourceStore())==null?void 0:s.getById(n)}getAssignmentById(n){var s;return(s=this.getAssignmentStore())==null?void 0:s.getById(n)}getCalendarById(n){var s;return(s=this.getCalendarManagerStore())==null?void 0:s.getById(n)}}return t}){},xR=class extends G([re],e=>class extends e{}){},Cs=class extends G([ir,Ny,xR],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=0}setStoreData(n){var s;(s=this.project)==null||s.repopulateStore(this),r.setStoreData.call(this,n)}register(n){var s,a;r.register.call(this,n),!n.isRoot&&!((s=this.project)!=null&&s.graph)&&((a=this.project)==null||a.scheduleDelayedCalculation())}onModelChange(n,s,a,o,l,c){var d;!c&&!(this.syncDataOnLoad&&this.isLoadingData)&&Object.keys(a).some(u=>u!=="intervals"&&n.$entity.getField(u))&&!((d=this.project)!=null&&d.applyingSyncResponse)&&(o=!0),super.onModelChange(n,s,a,o,l,c)}}return t}){},So=class extends G([La,Ny,Vh],e=>{const r=e.prototype;class t extends e{joinProject(){var n;(n=this.project)!=null&&n.delayEnteringReplica||(this.graph&&this.graph!=this.getGraph()&&(this.graph=null),this.getGraph().addEntity(this))}leaveProject(n=!1){r.leaveProject.call(this,n);const s=this.getGraph();s==null||s.removeEntity(this),this.graph=null}getProject(){return r.getProject.call(this)}calculateProject(){const n=this.stores.find(s=>Wt(s,Cs)&&!!s.getProject());return n==null?void 0:n.getProject()}get graph(){var n;return(n=this.project)!=null&&n.delayEnteringReplica?null:this._graph}set graph(n){this._graph=n}}return t}){},$c=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},zy=Symbol("EmptyCalendarSymbol"),Ss=class extends G([Ap,So],e=>{class r extends e{constructor(){super(...arguments),this.version=1}leaveProject(){this.project.clearCombinationsWith(this),super.leaveProject()}}return $c([de({},{persistent:!1})],r.prototype,"version",void 0),$c([de({type:"boolean",defaultValue:!0})],r.prototype,"unspecifiedTimeIsWorking",void 0),$c([de()],r.prototype,"intervals",void 0),r}){},RR=class extends We(F){static get $name(){return"EmptyCalendarEffectDescription"}static getDescription(e){const r=e.getCalendar();return mr(this.L("L{descriptionTpl}"),r.name||r.id)}},jc=class extends Lc{constructor(){super(...arguments),this.handler=zy}getResolutions(){const e=this.getCalendar();return this._resolutions||(this._resolutions=[TR.new({calendar:e}),MR.new({calendar:e})])}getCalendar(){const{calendars:e}=this;if((e==null?void 0:e.length)>1){for(const r of e)if(!(r.skipNonWorkingTime(this.date,this.isForward)instanceof Date))return r}return e[0]}};$c([pe("emptyCalendar")],jc.prototype,"type",void 0),$c([pe(RR)],jc.prototype,"_descriptionBuilderClass",void 0);var Wy=class extends We(Oc){static get $name(){return"BaseEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{intervals:[{isWorking:!0}]}}}getDescription(){const{calendar:e}=this;return mr(this.L("L{descriptionTpl}"),e.name||e.id)}fixCalendarData(e){var r;e.clearIntervals(!0),Object.assign(e,this.calendarData),(r=e.intervals)!=null&&r.length&&e.addIntervals(e.intervals)}resolve(){const{calendar:e}=this;this.fixCalendarData(e)}},TR=class extends Wy{static get $name(){return"Use24hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"on Mon at 0:00",recurrentEndDate:"on Sat at 0:00",isWorking:!0}]}}}},MR=class extends Wy{static get $name(){return"Use8hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"every weekday at 08:00",recurrentEndDate:"every weekday at 12:00",isWorking:!0},{recurrentStartDate:"every weekday at 13:00",recurrentEndDate:"every weekday at 17:00",isWorking:!0}]}}}},Gy=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Uy=Symbol("CycleSymbol"),Yy=class extends kh{constructor(){super(...arguments),this.failedResolutionReferences=new Map}},IR=class extends Py{constructor(){super(...arguments),this.candidateClass=Yy}initialize(e){var r;(r=e.graph.project)!=null&&r.delayCalculation&&(e.startProgressNotificationsAfterMs=0,e.emitProgressNotificationsEveryMs=100),super.initialize(e),this.candidate.failedResolutionReferences=new Map(this.baseRevision.failedResolutionReferences)}addIdentifier(e,r,...t){return this.candidate.failedResolutionReferences.size&&(this.candidate.failedResolutionReferences.forEach((i,n)=>{this.write(n,i)}),this.candidate.failedResolutionReferences.clear()),super.addIdentifier(e,r,...t)}},PR=class extends G([Ay],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.baseRevision=Yy.new(),this.transactionClass=IR,this.autoCommitMode="async",this.onComputationCycle="effect",this.cycleEffectClass=Ds,this.silenceInitialCommit=!0,this.ignoreInitialCommitComputationCycles=!1}get dirty(){const n=this.activeTransaction;return n.entries.size>0&&(n.hasVariableEntry||n.hasEntryWithProposedValue)}onPropagationProgressNotification(n){var s,a;this.enableProgressNotifications&&this.project&&((a=(s=this.project).trigger)==null||a.call(s,"progress",n))}async commitAsync(n){if(!this.project||this.project.isDestroyed)return;this.project.trigger("beforeCommit"),this.isInitialCommit&&this.ignoreInitialCommitComputationCycles&&(this._onComputationCycle=this._onComputationCycle||this.onComputationCycle,this.onComputationCycle="ignore");const s=this.project.beforeCommitAsync();return s||r.commitAsync.call(this,n)}get isInitialCommit(){return this.project.isInitialCommit||super.isInitialCommit}set isInitialCommit(n){super.isInitialCommit=n}write(n,s,...a){var o,l,c;const d=(o=n.field)==null?void 0:o.name,u=n.self;if(d&&u){const h=(l=u.beforeChronoFieldSet)==null?void 0:l.call(u,d,s);r.write.call(this,n,s,...a),(c=u.afterChronoFieldSet)==null||c.call(u,d,s,h)}else r.write.call(this,n,s,...a)}async finalizeCommitAsync(n){const{project:s}=this;if(!s||s.isDestroyed)return;const{entries:a}=n,o=new Set;globalThis.DEBUG&&console.timeEnd("Time to visible");const{isInitialCommit:l,silenceInitialCommit:c}=this,d=l&&c;l&&(s.isInitialCommitPerformed=!0,this.ignoreInitialCommitComputationCycles&&(this.onComputationCycle=this._onComputationCycle)),s.isWritingData=!0,s.hasLoadedDataToCommit=!1,this.enableProgressNotifications&&s.trigger("progress",{total:n.entries.size,remaining:0,phase:"finalizing"}),n.transaction.rejectedWith&&s.trigger("commitRejected",{transactionResult:n,isInitialCommit:l,silenceCommit:d}),s.trigger("refresh",{isInitialCommit:l,isCalculated:!0}),await new Promise(h=>{setTimeout(()=>{var g,f;if(!s.isDestroyed){if(n.transaction.rejectedWith)s.isWritingData=!1;else{(g=s.suspendChangesTracking)==null||g.call(s),globalThis.DEBUG&&console.time("Finalize propagation");const m=new Set;for(const v of a.values()){const y=v.identifier,C=v.getValue(),{field:D}=y;if(v.isShadow()||!y[jh]||C===xe||D instanceof bs)continue;const S=y.self,x=S.firstStore;m.has(S)||(S.beginBatch(!0),m.add(S)),x!=null&&x.autoCommit&&!o.has(x)&&(x.suspendAutoCommit(),o.add(x)),S.meta.batchChanges[D.name]=C}let p=!1;for(const v of m)if(!v.triggerBeforeUpdate({...v.meta.batchChanges})){p=!0;break}if(p){for(const v of m)v.cancelBatch();n.transaction.reject(),s.trigger("commitRejected",{transactionResult:n,isInitialCommit:l,silenceCommit:d}),s.trigger("refresh",{isInitialCommit:l,isCalculated:!0})}else for(const v of m)v.ignoreBag=d||s.ignoreRecordChanges,v.generation++,v.endBatch(d,!0,!0),v.ignoreBag=!1;s.ignoreRecordChanges=!1,globalThis.DEBUG&&console.timeEnd("Finalize propagation"),s.isWritingData=!1,p||s.trigger("dataReady",{records:m,isInitialCommit:l}),(f=s.resumeChangesTracking)==null||f.call(s,d),o.forEach(v=>v.resumeAutoCommit()),d&&(s.eventStore.acceptChanges(),s.dependencyStore.acceptChanges(),s.resourceStore.acceptChanges(),s.assignmentStore.acceptChanges(),s.calendarManagerStore.acceptChanges(),s.acceptChanges())}s.trigger("commitFinalized",{isInitialCommit:l,transactionResult:n})}h()},0)})}*onComputationCycleHandler(n){if(this.onComputationCycle==="effect"){const s=this.project.cycleEffectClass.new({cycle:n});(yield s)===sr.Cancel&&(yield mi(s))}else return yield*super.onComputationCycleHandler(n)}onComputationCycleHandlerSync(n,s){if(this.onComputationCycle==="effect")throw this.project.cycleEffectClass.new({cycle:n});return super.onComputationCycleHandlerSync(n,s)}async[Uy](n,s){return this.project.onCycleSchedulingIssue(n,s)}async[zy](n,s){return s.walkContext.startNewEpoch(),this.project.onEmptyCalendarSchedulingIssue(n,s)}async[Vy](n,s){return s.walkContext.startNewEpoch(),this.project.onConflictSchedulingIssue(n,s)}[Mc](n,s){return super[Mc](n,s)}}return t}){},AR=class extends We(Oc){static get $name(){return"RemoveDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.remove()}},_R=class extends We(F){static get $name(){return"CycleEffectDescription"}static getDescription(e){return mr(this.L("L{descriptionTpl}"),this.getShortDescription(e))}static getShortDescription(e){const r=e.getEvents().slice();return r.push(r[0]),'"'+r.map(t=>t.name||"#"+t.id).join('" -> "')+'"'}},Ds=class extends Lc{constructor(){super(...arguments),this.handler=Uy}getEvents(){if(!this._events){const e=new Set;this.cycle.cycle.forEach(({context:r})=>e.add(r)),this._events=[...e]}return this._events}matchDependencyBySourceAndTargetEvent(e,r,t){return e.fromEvent===r&&e.toEvent===t}getDependencyForSourceAndTargetEvents(e,r){return this.getEvents()[0].project.getDependencyStore().find(s=>this.matchDependencyBySourceAndTargetEvent(s,e,r))}getDependencies(){if(!this._dependencies){const e=new Set,r=this.getEvents(),t=r.length;let i=r[0],n;if(t===1)(n=this.getDependencyForSourceAndTargetEvents(i,i))&&e.add(n);else for(const s of r)for(const a of r)(n=this.getDependencyForSourceAndTargetEvents(s,a))&&e.add(n),(n=this.getDependencyForSourceAndTargetEvents(a,s))&&e.add(n);this._dependencies=[...e]}return this._dependencies}getResolutions(){return this._resolutions||(this._resolutions=[this.removeDependencyCycleEffectResolutionClass.new()]),this._resolutions}};Gy([pe("cycle")],Ds.prototype,"type",void 0),Gy([pe(_R)],Ds.prototype,"_descriptionBuilderClass",void 0),Gy([pe(AR)],Ds.prototype,"removeDependencyCycleEffectResolutionClass",void 0);var kR=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Wh=class extends G([So],e=>{const r=e.prototype;class t extends e{}return kR([Ut({bucket:"assigned",resolver:function(i){return this.getEventById(i)},modelFieldConfig:{serialize:i=>i==null?void 0:i.id,isEqual:rn,persist:!1}},ys)],t.prototype,"event",void 0),kR([Ut({bucket:"assigned",resolver:function(i){return this.getResourceById(i)},modelFieldConfig:{serialize:i=>i==null?void 0:i.id,isEqual:rn,persist:!1}},ys)],t.prototype,"resource",void 0),Hh(t),t}){},qy=class extends G([Fp,Cs],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=100}static get defaultConfig(){return{modelClass:Wh}}set data(n){this.allAssignmentsForRemoval=!0,super.data=n,this.allAssignmentsForRemoval=!1}}return t}){},Ky=class extends G([Op,Cs],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=500}static get defaultConfig(){return{tree:!0,modelClass:Ss}}}return t}){},Xy=class extends G([Lp,Cs],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=200}set data(n){this.allDependenciesForRemoval=!0,super.data=n,this.allDependenciesForRemoval=!1}}return t}){},Yt;(function(e){e.KeepDuration="KeepDuration",e.KeepStartDate="KeepStartDate",e.KeepEndDate="KeepEndDate"})(Yt||(Yt={}));var De=Symbol("StartDate"),we=Symbol("EndDate"),Re=Symbol("Duration"),qt=Ze.new({output:De,inputs:new Set([Re,we])}),Kt=Ze.new({output:we,inputs:new Set([Re,De])}),Xt=Ze.new({output:Re,inputs:new Set([De,we])}),Zy=tn.new({variables:new Set([De,we,Re]),formulas:new Set([qt,Kt,Xt])}),FR=Pt.new({description:Zy,defaultResolutionFormulas:new Set([Kt])}),OR=Pt.new({description:Zy,defaultResolutionFormulas:new Set([qt])}),Jy=class extends q0{addInstruction(e){e===Yt.KeepStartDate&&this.addKeepIfPossibleFlag(De),e===Yt.KeepEndDate&&this.addKeepIfPossibleFlag(we),e===Yt.KeepDuration&&this.addKeepIfPossibleFlag(Re)}},Qy=class extends yr.mix(Mr){equality(e,r){const t=e.resolution,i=r.resolution;return t.get(De)===i.get(De)&&t.get(we)===i.get(we)&&t.get(Re)===i.get(Re)||t.get(De)===Ft&&t.get(we)===Ft&&t.get(Re)===Ft}},Gh=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Uh=class extends G([So],e=>{class r extends e{writeCalendar(i,n,s,a){const o=this.getCalendarManagerStore(),l=a;a&&o&&a instanceof Ss&&!o.includes(l)&&o.add(a),i.constructor.prototype.write.call(this,i,n,s,a)}resolveCalendar(i){var n;return(n=this.getCalendarManagerStore())==null?void 0:n.getById(i)}*calculateEffectiveCalendar(){let i=yield this.$.calendar;return i||(i=yield this.getProject().$.effectiveCalendar),yield i.$.version,i}shouldRecordFieldChange(i,n,s){if(!super.shouldRecordFieldChange(i,n,s))return!1;const{project:a}=this;if(i==="calendar"&&a){const{calendarManagerStore:o}=a;return o.oldIdMap[n]!==o.getById(s)}return!0}}return Gh([me({equality:()=>!1})],r.prototype,"effectiveCalendar",void 0),Gh([Ut({modelFieldConfig:{persist:!0,serialize:t=>t===void 0?void 0:(t==null?void 0:t.id)||null,isEqual:rn},resolver:function(t){return this.resolveCalendar(t)},sync:!0},ys)],r.prototype,"calendar",void 0),Gh([br("calendar")],r.prototype,"writeCalendar",null),Gh([ie("effectiveCalendar")],r.prototype,"calculateEffectiveCalendar",null),Hh(r),r}){},LR=class extends G([],e=>{class r extends e{constructor(){super(...arguments),this.combinedCalendarsCache=new Map,this.combinationsByCalendar=new Map}combineCalendars(i){const n=Oa(i);if(n.length===0)throw new Error("No calendars to combine");n.sort((c,d)=>c.internalId<d.internalId?-1:1);const s=n.map(c=>c.internalId+"/").join(""),a=n.map(c=>c.version+"/").join(""),o=this.combinedCalendarsCache.get(s);let l;return o&&o.versionsHash===a?l=o.cache:(l=new Ip({calendarCaches:n.map(c=>c.calendarCache)}),this.combinedCalendarsCache.set(s,{versionsHash:a,cache:l}),n.forEach(c=>{let d=this.combinationsByCalendar.get(c);d||(d=new Set,this.combinationsByCalendar.set(c,d)),d.add(s)})),l}clearCombinationsWith(i){const n=this.combinationsByCalendar.get(i);n&&(n.forEach(s=>this.combinedCalendarsCache.delete(s)),this.combinationsByCalendar.delete(i))}}return r}){},Je=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},on=class extends G([Uh],e=>{const r=e.prototype;class t extends e{*calculateDispatcher(n){const s=yield Ee,a=yield*this.prepareDispatcher(n),o=yield fs(this.$.startDate),l=o?o[0]?Yt.KeepDuration:Yt.KeepEndDate:void 0;l&&a.addInstruction(l);const c=yield fs(this.$.endDate),d=c?c[0]?Yt.KeepDuration:Yt.KeepStartDate:void 0;d&&a.addInstruction(d);const u=yield this.$.effectiveDirection,h=yield fs(this.$.duration);let g;if(h)switch(h[0]){case!0:g=Yt.KeepStartDate;break;case!1:g=Yt.KeepEndDate;break}return!g&&a.hasProposedValue(Re)&&(g=u.direction===ae.Forward||u.direction===ae.None?Yt.KeepStartDate:Yt.KeepEndDate),g&&a.addInstruction(g),a}*prepareDispatcher(n){const a=this.dispatcherClass(n).new({context:this.cycleResolutionContext(n)});return a.collectInfo(n,this.$.startDate,De),a.collectInfo(n,this.$.endDate,we),a.collectInfo(n,this.$.duration,Re),a}cycleResolutionContext(n){const s=n(this.$.effectiveDirection);return s.direction===ae.Forward||s.direction===ae.None?FR:OR}dispatcherClass(n){return Jy}buildProposedDispatcher(n,s,a){const o=this.dispatcherClass(a.onEffectSync).new({context:this.cycleResolutionContext(a.onEffectSync)});return o.addPreviousValueFlag(De),o.addPreviousValueFlag(we),o.addPreviousValueFlag(Re),o}*skipNonWorkingTime(n,s){const a=yield this.$.effectiveCalendar;if(!n)return null;const o=a.skipNonWorkingTime(n,s);if(o instanceof Date)return o;{const l=jc.new({calendars:[a],event:this,date:n,isForward:s});if((yield l)===sr.Cancel)yield mi(l);else return null}}*skipWorkingTime(n,s,a,o){const l=yield this.$.durationUnit;return o&&o!==l&&(a=yield*this.getProject().$convertDuration(a,o,l)),yield*this.calculateProjectedXDateWithDuration(n,s,a)}setStartDate(n,s=!0){const{graph:a,project:o}=this;return a?(a.write(this.$.startDate,n,s),a.commitAsync()):(this.$.startDate.DATA=n,o==null?void 0:o.delayedCalculationPromise)}writeStartDate(n,s,a,o,l=!0){!s.baseRevision.hasIdentifier(n)&&o==null||(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,s,void 0,o==null),n.constructor.prototype.write.call(this,n,s,a,o,l))}*calculateStartDate(){const s=(yield this.$.dispatcher).resolution.get(De);if(s===Ft)return yield*this.calculateStartDateProposed();if(s===qt.formulaId)return yield*this.calculateStartDatePure();throw new Error("Unknown formula for `startDate`")}*calculateStartDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.endDate,!1,yield this.$.duration)}*calculateStartDateProposed(){const n=this.getProject(),s=yield Ee;return!(yield this.$.manuallyScheduled)||n.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(s,!0):s}*calculateProjectedXDateWithDuration(n,s,a){const o=yield this.$.durationUnit,l=yield this.$.effectiveCalendar,c=this.getProject();return!n||px(a)?null:(s=s===void 0?!0:s,s?l.calculateEndDate(n,yield*c.$convertDuration(a,o,ee.Millisecond)):l.calculateStartDate(n,yield*c.$convertDuration(a,o,ee.Millisecond)))}setEndDate(n,s=!1){const{graph:a,project:o}=this;return a?(a.write(this.$.endDate,n,s),a.commitAsync()):(this.$.endDate.DATA=n,o==null?void 0:o.delayedCalculationPromise)}writeEndDate(n,s,a,o,l=!1){!s.baseRevision.hasIdentifier(n)&&o==null||(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,s,void 0,o==null),n.constructor.prototype.write.call(this,n,s,a,o,l))}*calculateEndDate(){const s=(yield this.$.dispatcher).resolution.get(we);if(s===Ft)return yield*this.calculateEndDateProposed();if(s===Kt.formulaId)return yield*this.calculateEndDatePure();throw new Error("Unknown formula for `endDate`")}*calculateEndDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.startDate,!0,yield this.$.duration)}*calculateEndDateProposed(){const n=this.getProject(),s=yield Ee;return!(yield this.$.manuallyScheduled)||n.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(s,!1):s}getDuration(n){const s=this.duration;return n!==void 0?this.getProject().convertDuration(s,this.durationUnit,n):s}setDuration(n,s,a){const{graph:o,project:l}=this;if(o){if(n!==void 0)return o.write(this.$.duration,n,s,a),o.commitAsync()}else{const c={duration:n};return this.$.duration.DATA=n,s!=null&&(c.durationUnit=this.$.durationUnit.DATA=s),this.set(c),l==null?void 0:l.delayedCalculationPromise}}setDurationUnit(n){throw new Error("Use `setDuration` instead")}writeDuration(n,s,a,o,l,c=void 0){o<0&&(o=0),!(!s.baseRevision.hasIdentifier(n)&&o==null)&&(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,s,void 0,o==null),n.constructor.prototype.write.call(this,n,s,a,o,c),l!=null&&s.write(this.$.durationUnit,l))}*calculateDuration(){const s=(yield this.$.dispatcher).resolution.get(Re);if(s===Ft)return yield*this.calculateDurationProposed();if(s===Xt.formulaId)return yield*this.calculateDurationPure();throw new Error("Unknown formula for `duration`")}*calculateDurationPure(){const n=yield this.$.startDate,s=yield this.$.endDate;if(!n||!s)return null;if(n>s)yield L0(this.$.duration,0,null);else return yield*this.calculateProjectedDuration(n,s)}*calculateDurationProposed(){return yield Ee}*calculateProjectedDuration(n,s,a){if(!n||!s)return null;a||(a=yield this.$.durationUnit);const o=yield this.$.effectiveCalendar;return yield*this.getProject().$convertDuration(o.calculateDurationMs(n,s),ee.Millisecond,a)}*calculateEffectiveDuration(){const n=yield this.$.dispatcher;let s;const a=n.resolution.get(Re);return a===Ft?s=yield this.$.duration:a===Xt.formulaId&&(s=yield*this.calculateProjectedDuration(yield et(this.$.startDate),yield et(this.$.endDate))),s}*calculateEffectiveDirection(){return{kind:"own",direction:(yield this.$.direction)||ae.Forward}}*calculateStartDateDirection(){return yield this.$.effectiveDirection}*calculateEndDateDirection(){return yield this.$.effectiveDirection}*calculateEffectiveCalendar(){const n=yield this.$.manuallyScheduled,s=this.getProject();return n&&!s.skipNonWorkingTimeInDurationWhenSchedulingManually?s.defaultCalendar:yield*super.calculateEffectiveCalendar()}}return Je([de({type:"date"},{converter:vi})],t.prototype,"startDate",void 0),Je([de({type:"date"},{converter:vi})],t.prototype,"endDate",void 0),Je([de({type:"number",allowNull:!0})],t.prototype,"duration",void 0),Je([de({type:"string",defaultValue:ee.Day},{converter:i=>b.normalizeUnit(i)||ee.Day})],t.prototype,"durationUnit",void 0),Je([de({type:"string"},{sync:!0})],t.prototype,"direction",void 0),Je([me({sync:!0,equality:ic})],t.prototype,"startDateDirection",void 0),Je([me({sync:!0,equality:ic})],t.prototype,"endDateDirection",void 0),Je([de({persist:!1,isEqual:ic},{sync:!0,equality:ic})],t.prototype,"effectiveDirection",void 0),Je([me({identifierCls:Qy})],t.prototype,"dispatcher",void 0),Je([de({type:"boolean",defaultValue:!1},{sync:!0})],t.prototype,"manuallyScheduled",void 0),Je([de({type:"boolean",defaultValue:!1})],t.prototype,"unscheduled",void 0),Je([ie("dispatcher")],t.prototype,"calculateDispatcher",null),Je([oR("dispatcher")],t.prototype,"buildProposedDispatcher",null),Je([br("startDate")],t.prototype,"writeStartDate",null),Je([ie("startDate")],t.prototype,"calculateStartDate",null),Je([br("endDate")],t.prototype,"writeEndDate",null),Je([ie("endDate")],t.prototype,"calculateEndDate",null),Je([br("duration")],t.prototype,"writeDuration",null),Je([ie("duration")],t.prototype,"calculateDuration",null),Je([ie("effectiveDirection")],t.prototype,"calculateEffectiveDirection",null),Je([ie("startDateDirection")],t.prototype,"calculateStartDateDirection",null),Je([ie("endDateDirection")],t.prototype,"calculateEndDateDirection",null),t}){},gL=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},eb=class extends G([on,_p],e=>{const r=e.prototype;class t extends e{get assignments(){return this.assigned?[...this.assigned]:[]}}return gL([Ut({},bs)],t.prototype,"assigned",void 0),t}){},$R=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},tb=class extends G([on],e=>{const r=e.prototype;class t extends e{leaveProject(){var n,s;if(this.isInActiveTransaction){const a=this.graph.activeTransaction,o=this.getDependencyStore(),l=[];for(const c of(n=a.readCurrentOrProposedOrPrevious(this.$.outgoingDeps))!=null?n:[])o.includes(c)&&l.push(c);for(const c of(s=a.readCurrentOrProposedOrPrevious(this.$.incomingDeps))!=null?s:[])o.includes(c)&&l.push(c);this.project.dependencyStore.remove(l)}r.leaveProject.call(this)}}return $R([Ut({},bs)],t.prototype,"outgoingDeps",void 0),$R([Ut({},bs)],t.prototype,"incomingDeps",void 0),t}){},Yh=class extends G([on,eb,tb],e=>{const r=e.prototype;class t extends e{}return t}){},Bc=class extends G([$p,Cs],e=>{class r extends e{constructor(){super(...arguments),this.removalOrder=400}static get defaultConfig(){return{modelClass:Yh}}buildRootNode(){return this.getProject()||{}}set data(i){super.data=i,this.afterEventRemoval()}}return r}){},rb=class extends G([Bc],e=>{class r extends e{static get defaultConfig(){return{tree:!0}}}return r}){},fL=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},qh=class extends G([Uh,So],e=>{const r=e.prototype;class t extends e{get assignments(){return[...this.assigned]}leaveProject(n=!1){if(!this.isStmRestoring&&this.assigned&&!n){const s=this.getResourceStore();this.assigned.forEach(a=>s.assignmentsForRemoval.add(a))}r.leaveProject.call(this)}static get fields(){return[{name:"parentId"},{name:"children",persist:!1}]}}return fL([Ut({},bs)],t.prototype,"assigned",void 0),t}){},ib=class extends G([jp,Cs],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=300}static get defaultConfig(){return{modelClass:qh}}}return t}){},Hc=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},jR=class extends G([Vh],e=>{const r=e.prototype;class t extends e{*calculateUnitsInMs(){const n=yield this.$.hoursPerDay,s=yield this.$.daysPerWeek,a=yield this.$.daysPerMonth;return{millisecond:1,second:1e3,minute:60*1e3,hour:60*60*1e3,day:n*60*60*1e3,week:s*n*60*60*1e3,month:a*n*60*60*1e3,quarter:3*a*n*60*60*1e3,year:4*3*a*n*60*60*1e3}}convertDuration(n,s,a){let o=n;return s!==a&&(o=n*this.unitsInMs[s]/this.unitsInMs[a]),o}*$convertDuration(n,s,a){if(!s||!a)throw new Error("Conversion unit not provided");const o=yield this.$.unitsInMs;let l=n;return s!==a&&(l=n*o[s]/o[a]),l}}return Hc([me()],t.prototype,"unitsInMs",void 0),Hc([de({type:"number",defaultValue:24})],t.prototype,"hoursPerDay",void 0),Hc([de({type:"number",defaultValue:7})],t.prototype,"daysPerWeek",void 0),Hc([de({type:"number",defaultValue:30})],t.prototype,"daysPerMonth",void 0),Hc([ie("unitsInMs")],t.prototype,"calculateUnitsInMs",null),t}){},Vc=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},nb=class extends G([So],e=>{const r=e.prototype;class t extends e{get isValid(){const{$:n,graph:s}=this;return s&&(!s.hasIdentifier(n.fromEvent)||!s.hasIdentifier(n.toEvent))?!1:super.isValid}}return Vc([Ut({bucket:"outgoingDeps",resolver:function(i){return this.getEventById(i)},modelFieldConfig:{persist:!0,serialize:i=>i==null?void 0:i.id,isEqual:rn}},ys)],t.prototype,"fromEvent",void 0),Vc([Ut({bucket:"incomingDeps",resolver:function(i){return this.getEventById(i)},modelFieldConfig:{persist:!0,serialize:i=>i==null?void 0:i.id,isEqual:rn}},ys)],t.prototype,"toEvent",void 0),Vc([de({type:"int",defaultValue:ft.EndToStart})],t.prototype,"type",void 0),Vc([de({type:"string"})],t.prototype,"fromSide",void 0),Vc([de({type:"string"})],t.prototype,"toSide",void 0),t}){},BR=class extends G([Vh,wx],e=>{const r=e.prototype;class t extends e{get isDelayingCalculation(){return!!(this.delayEnteringReplica||this.delayedCalculationPromise)}getGraph(){return this.replica}beforeCommitAsync(){return null}enterReplica(n){}acceptChanges(){}async commitAsync(){var n;return this.delayedCalculationPromise||((n=this.replica)==null?void 0:n.commitAsync())}getSchedulingIssueEventArguments(n,s,a,o){const l=[n.type,{continueWithResolutionResult:a,schedulingIssue:n}];return n instanceof sn&&(l[1].conflict=n),l}async onSchedulingIssueCall(n,s){return n.type&&this.hasListener(n.type)?new Promise((a,o)=>{this.trigger(...this.getSchedulingIssueEventArguments(n,s,a,o))}):sr.Cancel}async onCycleSchedulingIssue(n,s){return this.onSchedulingIssueCall(n,s)}async onEmptyCalendarSchedulingIssue(n,s){return this.onSchedulingIssueCall(n,s)}async onConflictSchedulingIssue(n,s){return this.onSchedulingIssueCall(n,s)}setModelCalculations(n,s){if(!s)return;const a={};for(const o in s)a[o]=n.prototype.$calculations[o];return Object.assign(n.prototype.$calculations,s),a}setRecordCalculations(n,s){const a=this.setModelCalculations(n.constructor,s),o=n.$entity.$skeleton;return Object.keys(s).forEach(l=>{o[l].prototype.calculation=n[s[l]]}),a}setStoreCalculations(n,s){if(!s)return;const a=n.first;return a?this.setRecordCalculations(a,s):this.setModelCalculations(n.modelClass,s)}async setCalculations(n){this.replica&&await this.commitAsync();const s={},a={tasks:this.eventStore,events:this.eventStore,dependencies:this.dependencyStore,resources:this.resourceStore,assignments:this.assignmentStore,calendars:this.calendarManagerStore};Object.keys(a).forEach(l=>{n[l]&&(s[l]=this.setStoreCalculations(a[l],n[l]))});let o=n.project;return o&&(s.project=this.setRecordCalculations(this,o)),this.replica&&this.repopulateReplica.now(),this.replica&&await this.commitAsync(),s}}return t}){},Kh=class extends G([on],e=>{const r=e.prototype;class t extends e{static get $name(){return"HasSubEventsMixin"}*hasSubEvents(){throw new Error("Abstract method `hasSubEvents` has been called")}*subEventsIterable(){throw new Error("Abstract method `subEventsIterable` has been called")}*calculateStartDatePure(){const n=yield this.$.manuallyScheduled,s=yield*this.hasSubEvents();return!n&&s?yield*this.calculateMinChildrenStartDate():yield*r.calculateStartDatePure.call(this)}*calculateEndDatePure(){const n=yield this.$.manuallyScheduled,s=yield*this.hasSubEvents();return!n&&s?yield*this.calculateMaxChildrenEndDate():yield*r.calculateEndDatePure.call(this)}*calculateStartDateProposed(){const n=yield this.$.manuallyScheduled,s=yield*this.hasSubEvents();return!n&&s?yield*this.calculateStartDatePure():yield*r.calculateStartDateProposed.call(this)}*calculateEndDateProposed(){const n=yield this.$.manuallyScheduled,s=yield*this.hasSubEvents();return!n&&s?yield*this.calculateEndDatePure():yield*r.calculateEndDateProposed.call(this)}*calculateDurationProposed(){const n=yield this.$.manuallyScheduled,s=yield*this.hasSubEvents();return!n&&s?yield*this.calculateDurationPure():yield*r.calculateDurationProposed.call(this)}*shouldRollupChildStartDate(n){return!0}*calculateMinChildrenStartDate(){const n=yield*this.subEventsIterable();let s=He.getTime();for(const a of n)if(yield*this.shouldRollupChildStartDate(a)){let o=yield a.$.startDate;if(o||(o=yield a.$.endDate),(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())){const l=yield*a.calculateMinChildrenStartDate();(!o||l&&l.getTime()<o.getTime())&&(o=l)}o&&o.getTime()<s&&(s=o.getTime())}return s===Xe.getTime()||s===He.getTime()?null:new Date(s)}*shouldRollupChildEndDate(n){return!0}*calculateMaxChildrenEndDate(){const n=yield*this.subEventsIterable();let s=Xe.getTime();for(const a of n)if(yield*this.shouldRollupChildEndDate(a)){let o=yield a.$.endDate;if(o||(o=yield a.$.startDate),(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())){const l=yield*a.calculateMaxChildrenEndDate();(!o||l&&l.getTime()>o.getTime())&&(o=l)}o&&o.getTime()>s&&(s=o.getTime())}return s===Xe.getTime()||s===He.getTime()?null:new Date(s)}}return t}){},HR=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},yi=class extends G([Kh],e=>{const r=e.prototype;class t extends e{*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}get parent(){return this._parent}set parent(n){this._parent=n,this.parentEvent=n}*calculateEffectiveDirection(){const n=yield this.$.direction;if(n)return{kind:"own",direction:n};const s=yield this.$.parentEvent;if(s){const a=yield s.$.effectiveDirection;return{kind:"inherited",direction:a.direction,inheritedFrom:a.kind==="own"?s:a.kind==="inherited"?a.inheritedFrom:s}}else return yield*super.calculateEffectiveDirection()}*calculateStartDateDirection(){const n=yield this.getProject().$.effectiveDirection;let s=null;if(!(yield this.$.manuallyScheduled)){const a=yield*this.subEventsIterable();for(const o of a){const l=yield o.$.startDateDirection;if(n.direction!==l.direction){s={kind:"enforced",direction:l.direction,enforcedBy:l.kind==="own"?o:l.kind==="enforced"?l.enforcedBy:l.inheritedFrom};break}}}return s!=null?s:yield*super.calculateStartDateDirection()}*calculateEndDateDirection(){const n=yield this.getProject().$.effectiveDirection;let s=null;if(!(yield this.$.manuallyScheduled)){const a=yield*this.subEventsIterable();for(const o of a){const l=yield o.$.startDateDirection;if(n.direction!==l.direction){s={kind:"enforced",direction:l.direction,enforcedBy:l.kind==="own"?o:l.kind==="enforced"?l.enforcedBy:l.inheritedFrom};break}}}return s!=null?s:yield*super.calculateStartDateDirection()}}return HR([cR({bucket:"childEvents"})],t.prototype,"parentEvent",void 0),HR([hR()],t.prototype,"childEvents",void 0),t}){},VR=class{constructor(){this.ongoing=Promise.resolve(),this.handleReject=()=>{}}queue(e,r=this.handleReject){const t=this.ongoing.then(e);return this.ongoing=t.catch(r),t}};VR._$name="Queue";var Xh=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},NR=class extends xp([BR,on,Kh,Uh,jR,LR],e=>{const r=e.prototype;class t extends e{construct(n={}){this.delayCalculation=n.delayCalculation!==!1,this.enableProgressNotifications=n.enableProgressNotifications||n.delayCalculation!==!1,this._queue=new VR,"expanded"in n||(n.expanded=!0),this.delayCalculation&&(this.delayEnteringReplica=!0),"skipNonWorkingTimeWhenSchedulingManually"in n||(n.skipNonWorkingTimeWhenSchedulingManually=!1),r.construct.call(this,n),this.repopulateStores=new Set,this.ignoreInitialCommitComputationCycles="ignoreInitialCommitComputationCycles"in n?n.ignoreInitialCommitComputationCycles:!1,this.ignoreInitialCommitComputationCycles&&console.warn('Project "ignoreInitialCommitComputationCycles" option is deprecated and will be dropped in the next major release'),this.eventModelClass||(this.eventModelClass=this.getDefaultEventModelClass()),this.eventStoreClass||(this.eventStoreClass=this.getDefaultEventStoreClass()),this.dependencyModelClass||(this.dependencyModelClass=this.getDefaultDependencyModelClass()),this.dependencyStoreClass||(this.dependencyStoreClass=this.getDefaultDependencyStoreClass()),this.resourceModelClass||(this.resourceModelClass=this.getDefaultResourceModelClass()),this.resourceStoreClass||(this.resourceStoreClass=this.getDefaultResourceStoreClass()),this.assignmentModelClass||(this.assignmentModelClass=this.getDefaultAssignmentModelClass()),this.assignmentStoreClass||(this.assignmentStoreClass=this.getDefaultAssignmentStoreClass()),this.calendarModelClass||(this.calendarModelClass=this.getDefaultCalendarModelClass()),this.calendarManagerStoreClass||(this.calendarManagerStoreClass=this.getDefaultCalendarManagerStoreClass()),this.cycleEffectClass||(this.cycleEffectClass=this.getDefaultCycleEffectClass()),this.initializeStm(),this.defaultCalendar=new this.calendarModelClass({unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this,this.delayEnteringReplica||this.enterReplica(!1),this.setCalendarManagerStore(this.calendarManagerStore),this.setEventStore(this.eventStore),this.setDependencyStore(this.dependencyStore),this.setResourceStore(this.resourceStore),this.setAssignmentStore(this.assignmentStore),!!(this.calendarsData||this.eventsData||this.dependenciesData||this.resourcesData||this.assignmentsData)?(this.loadInlineData({calendarsData:this.calendarsData,eventsData:this.eventsData,dependenciesData:this.dependenciesData,resourcesData:this.resourcesData,assignmentsData:this.assignmentsData}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData):this.delayCalculation&&this.hasDataInStores&&this.scheduleDelayedCalculation()}get hasDataInStores(){return[this.calendarManagerStore,this.eventStore,this.dependencyStore,this.resourceStore,this.assignmentStore].some(n=>n.allCount>0)}enterReplica(n){const s=this;s.replica||(s.replica=s.createReplica(),s.replica.addEntity(s),s.replica.addEntity(s.defaultCalendar),s.trigger("graphReady")),n&&!s.isRepopulatingStores&&(s.calendarManagerStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),s.eventStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),s.resourceStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),s.dependencyStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),s.assignmentStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}))}resetStmQueue(){const n=this.stm.disabled;this.stm.disable(),this.stm.resetQueue(),n||this.stm.enable()}doDestroy(){var n,s,a,o,l,c,d,u;const h=this;(n=h.eventStore)==null||n.destroy(),(s=h.dependencyStore)==null||s.destroy(),(a=h.assignmentStore)==null||a.destroy(),(o=h.resourceStore)==null||o.destroy(),(l=h.calendarManagerStore)==null||l.destroy(),(c=h.defaultCalendar)==null||c.destroy(),(d=h.replica)==null||d.clear(),(u=h.stm)==null||u.destroy(),r.doDestroy.call(this)}getReplicaConfig(){return{project:this,schema:pR.new(),enableProgressNotifications:this.enableProgressNotifications,silenceInitialCommit:this.silenceInitialCommit,ignoreInitialCommitComputationCycles:this.ignoreInitialCommitComputationCycles,cycleEffectClass:this.cycleEffectClass,onWriteDuringCommit:"ignore",readMode:pi.CurrentOrProposedOrPrevious}}createReplica(){return PR.mix(Ay).new(this.getReplicaConfig())}*hasSubEvents(){return this.getEventStore().count>0}*subEventsIterable(){return this.getEventStore().getRange()}getType(){return di.SchedulerBasic}get enableProgressNotifications(){return this._enableProgressNotifications}set enableProgressNotifications(n){this._enableProgressNotifications=n,this.replica&&(this.replica.enableProgressNotifications=n)}getDefaultCycleEffectClass(){return Ds}getDefaultEventModelClass(){return Yh}getDefaultEventStoreClass(){return Bc}getDefaultDependencyModelClass(){return nb}getDefaultDependencyStoreClass(){return Xy}getDefaultResourceModelClass(){return qh}getDefaultResourceStoreClass(){return ib}getDefaultAssignmentModelClass(){return Wh}getDefaultAssignmentStoreClass(){return qy}getDefaultCalendarModelClass(){return Ss}getDefaultCalendarManagerStoreClass(){return Ky}usingSyncDataOnLoad(){return[this.eventStore,this.resourceStore,this.dependencyStore,this.assignmentStore].some(n=>n.syncDataOnLoad)}async loadInlineData(n){const{calendarManagerStore:s,eventStore:a,dependencyStore:o,assignmentStore:l,resourceStore:c,replica:d}=this;if(!this.isInitialCommitPerformed)d==null||d.unScheduleAutoCommit();else for(;this.replica.isCommitting;)await this.commitAsync();d!=null&&d.enableProgressNotifications&&!this.delayCalculation&&(await xc(0),await this.commitAsync(),d.onPropagationProgressNotification({total:0,remaining:0,phase:"storePopulation"}),await xc(50)),this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!0,globalThis.DEBUG&&(console.log("%cInitializing project","font-weight:bold;color:darkgreen;text-transform:uppercase;margin-top: 2em"),console.time("Time to visible"),console.time("Populating project")),this.delayCalculation&&!this.delayedCalculationPromise&&!this.usingSyncDataOnLoad()&&this.scheduleDelayedCalculation(),n.calendarsData&&(this.repopulateStore(s),s.data=n.calendarsData),(n.eventsData||n.tasksData)&&(this.repopulateStore(a),a.data=n.eventsData||n.tasksData),n.dependenciesData&&(this.repopulateStore(o),o.data=n.dependenciesData),n.resourcesData&&(this.repopulateStore(c),c.data=n.resourcesData),n.assignmentsData&&(this.repopulateStore(l),l.data=n.assignmentsData),n.project&&this.applyProjectResponse(n.project),globalThis.DEBUG&&console.timeEnd("Populating project");const u=await this.commitLoad();return this.isLoadingInlineData=!1,u}setupTemporaryIndices(){const{storage:n}=this.assignmentStore||{};n&&(n.addIndex({property:"event",unique:!1}),n.addIndex({property:"resource",unique:!1}))}removeTemporaryIndices(){const{storage:n}=this.assignmentStore;n.removeIndex("event"),n.removeIndex("resource")}async internalDelayCalculation(n){const s=this;if(s.delayEnteringReplica=!0,s.setupTemporaryIndices(),await xc(0),s.isDestroyed){n();return}if(s.trigger("delayCalculationStart"),s.trigger("refresh",{isCalculated:!1}),await xc(0),s.isDestroyed){n();return}s.delayEnteringReplica=!1,s.isRepopulatingStores?s.repopulateReplica.now():(s.trigger("recordsUnlinked"),s.enterReplica(!0));const a=await s.replica.commitAsync();if(s.isDestroyed){n();return}n(a),s.delayedCalculationPromise=null,s.trigger("delayCalculationEnd"),s.removeTemporaryIndices()}scheduleDelayedCalculation(){if(this.delayedCalculationPromise)return this.delayedCalculationPromise;if(this.delayCalculation!==!1)return this.delayedCalculationPromise=new Promise(n=>this.internalDelayCalculation(n).then())}async commitLoad(){const n=await this.commitAsync();return this.isDestroyed||this.trigger("load"),n}initializeStm(){const n=this.stmClass||ia;this.stm instanceof ia||this.setStm(n.new({disabled:!0},this.stm)),this.resetUndoRedoQueuesAfterLoad&&this.ion({load:this.resetStmQueue,thisObj:this}),this.ion({beforeCommit:this.onCommitInitialization,commitFinalized:this.onCommitFinalization,commitRejected:this.onCommitRejection,thisObj:this})}removeRejectedRecordsAdd({transactionResult:n,silenceCommit:s}){var a,o,l;const c=new Map;for(const u of n.entries.values()){const h=u.identifier,{field:g}=h;if(u.isShadow()||!h[jh]||g instanceof bs)continue;const f=h.self,m=f.firstStore;m&&!u.previous&&!((a=n.transaction.getLatestStableEntryFor(f.$$))!=null&&a.previous)&&(c.has(m)?c.get(m).has(f)||c.get(m).add(f):c.set(m,new Set([f])))}(o=this.suspendChangesTracking)==null||o.call(this),Array.from(c.keys()).sort((u,h)=>u.removalOrder-h.removalOrder).forEach(u=>u.remove(c.get(u))),(l=this.resumeChangesTracking)==null||l.call(this,s),s&&(this.eventStore.acceptChanges(),this.dependencyStore.acceptChanges(),this.resourceStore.acceptChanges(),this.assignmentStore.acceptChanges(),this.calendarManagerStore.acceptChanges())}onCommitRejection(n){this._stmDisabled?(this.replica.isWritingPreviousData=!0,this.isRestoringData=!0,this.removeRejectedRecordsAdd(n),this.isRestoringData=!1,this.replica.isWritingPreviousData=!1):this.rejectStmTransaction()}onCommitInitialization(){const{stm:n}=this;this._stmDisabled=n.disabled,n.isRecording&&n.autoRecord&&(this._stmAutoRecord=!0,n.autoRecord=!1)}onCommitFinalization(){this._stmAutoRecord&&(this.stm.autoRecord=!0,this._stmAutoRecord=!1)}onSTMRestoringStart({source:n}){this.replica&&(this.replica.isWritingPreviousData=!0)}async onSTMRestoringStop({source:n}){this.replica&&(this.replica.isWritingPreviousData=!1);const s=n;s.disable(),await this.commitAsync(),this.isDestroyed||(s.enable(),this.trigger("stateRestoringDone"))}deferUntilRepopulationIfNeeded(n,s,a){this.isRepopulatingStores?(this.detachListeners(n),this.ion({name:n,repopulateReplica:{fn:async()=>{await this.commitAsync(),this.isDestroyed||s(...a)},once:!0}})):s(...a)}get isRepopulatingStores(){var n;return!!((n=this.repopulateStores)!=null&&n.size)}repopulateStore(n){var s;const a=this;a.repopulateOnDataset&&n.allCount&&!n.syncDataOnLoad&&((s=a.replica)==null||s.activeTransaction.stop(),a.repopulateStores||(a.repopulateStores=new Set),a.repopulateStores.add(n),a.repopulateReplica())}repopulateReplica(){const n=this;if(n.delayEnteringReplica)return;const{calendarManagerStore:s,eventStore:a,dependencyStore:o,assignmentStore:l,resourceStore:c,replica:d}=n;d?(n.unlinkStoreRecords(s,a,o,c,l),n.unlinkRecord(n),n.unlinkRecord(n.defaultCalendar),n.trigger("recordsUnlinked"),d.clear()):n.trigger("recordsUnlinked");const u=n.replica=n.createReplica();u.addEntity(n),u.addEntity(n.defaultCalendar),n.joinStoreRecords(s,!0),n.joinStoreRecords(a,!0),n.joinStoreRecords(o,!0),n.joinStoreRecords(c,!0),n.joinStoreRecords(l,!0),n.repopulateStores.clear(),n.trigger("repopulateReplica")}beforeCommitAsync(){return this.repopulateReplica.isPending&&!this.isDelayingCalculation?(this.repopulateReplica.now(),this.replica.commitAsync()):null}unlinkRecord(n){var s;if(n!=null&&n.graph){const{activeTransaction:a}=this.replica,{$:o}=n,l=Object.keys(o);for(let c=0;c<l.length;c++){const d=l[c],u=o[d],h=a.getLatestEntryFor(u);if(h){let g=h.getValue();g===void 0&&(g=h.proposedValue),g!==void 0&&(u.DATA=u.field instanceof ys&&(s=g==null?void 0:g.id)!=null?s:g)}}n.graph=null}}unlinkStoreRecords(...n){n.forEach(s=>{(!this.repopulateStores.has(s)||s.syncDataOnLoad)&&s.traverse(a=>{this.unlinkRecord(a)},!1,!1,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})})}getGraph(){return this.replica}async addEvents(n){return this.eventStore.add(n),this.commitAsync()}async addEvent(n){return this.eventStore.add(n),this.commitAsync()}includeEvent(n){this.eventStore.add(n)}async removeEvents(n){return this.eventStore.remove(n),this.commitAsync()}excludeEvent(n){this.eventStore.remove(n)}async removeEvent(n){return this.eventStore.remove(n),this.commitAsync()}getStm(){return this.stm}setStm(n){this.stm=n,this.stm.ion({restoringStart:this.onSTMRestoringStart,restoringStop:this.onSTMRestoringStop,thisObj:this})}calculateProject(){return this}*calculateEffectiveCalendar(){let n=yield this.$.calendar;return n?yield n.$.version:n=this.defaultCalendar,n}joinStoreRecords(n,s=!1){const a=o=>{o.setProject(this),o.joinProject()};n.rootNode?n.rootNode.traverse(a,s,!0):n.forEach(a,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}unjoinStoreRecords(n){const s=a=>{a.leaveProject(),a.setProject(this)};n.rootNode?n.rootNode.traverse(a=>{a!==n.rootNode&&s(a)},!1,!0):n.forEach(s,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}setEventStore(n){const s=this.eventStore;if(s&&this.stm.hasStore(s)){this.stm.removeStore(s),this.unjoinStoreRecords(s),this.detachStore(s);const a=s.assignmentsForRemoval;a.forEach(o=>{const l=o.event;if(l){const c=n.getById(l.id);c&&(o.event=c,a.delete(o))}}),s.afterEventRemoval()}if(!n||!(n instanceof re)){const a=(n==null?void 0:n.storeClass)||this.eventStoreClass;this.eventStore=new a(T.assign({modelClass:this.eventModelClass,project:this,stm:this.stm},n||{}))}else this.eventStore=n,n.setProject(this),this.stm.addStore(n),n.tree&&n.rootNode!==this?(this.appendChild(n.rootNode.children||[]),n.rootNode=this):this.joinStoreRecords(n);this.attachStore(this.eventStore),this.trigger("eventStoreChange",{store:this.eventStore})}setDependencyStore(n){const s=this.dependencyStore;if(s&&this.stm.hasStore(s)&&(this.stm.removeStore(s),this.detachStore(s)),!n||!(n instanceof re)){const a=(n==null?void 0:n.storeClass)||this.dependencyStoreClass;this.dependencyStore=new a(T.assign({modelClass:this.dependencyModelClass,project:this,stm:this.stm},n||{}))}else this.dependencyStore=n,n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n);this.attachStore(this.dependencyStore),this.trigger("dependencyStoreChange",{store:this.dependencyStore})}setResourceStore(n){const s=this.resourceStore;if(s&&this.stm.hasStore(s)){this.stm.removeStore(s),this.unjoinStoreRecords(s),this.detachStore(s);const a=s.assignmentsForRemoval;a.forEach(o=>{const l=o.resource;if(l){const c=n.getById(l.id);c&&(o.resource=c,a.delete(o))}}),s.afterResourceRemoval()}if(!n||!(n instanceof re)){const a=(n==null?void 0:n.storeClass)||this.resourceStoreClass;this.resourceStore=new a(T.assign({modelClass:this.resourceModelClass,project:this,stm:this.stm},n||{}))}else this.resourceStore=n,n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n);this.attachStore(this.resourceStore),this.trigger("resourceStoreChange",{store:this.resourceStore})}setAssignmentStore(n){const s=this.assignmentStore;if(s&&this.stm.hasStore(s)&&(this.stm.removeStore(s),this.unjoinStoreRecords(s),this.detachStore(s)),!n||!(n instanceof re)){const a=(n==null?void 0:n.storeClass)||this.assignmentStoreClass;this.assignmentStore=new a(T.assign({modelClass:this.assignmentModelClass,project:this,stm:this.stm},n||{}))}else this.assignmentStore=n,n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n);this.isDelayingCalculation&&this.setupTemporaryIndices(),this.attachStore(this.assignmentStore),this.trigger("assignmentStoreChange",{store:this.assignmentStore})}setCalendarManagerStore(n){const s=this.calendarManagerStore;if(s&&this.stm.hasStore(s)&&(this.stm.removeStore(s),this.detachStore(s)),!n||!(n instanceof re)){const a=(n==null?void 0:n.storeClass)||this.calendarManagerStoreClass;this.calendarManagerStore=new a(T.assign({modelClass:this.calendarModelClass,project:this,stm:this.stm},n||{}))}else this.calendarManagerStore=n,n&&(n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n));this.attachStore(this.calendarManagerStore),this.trigger("calendarManagerStoreChange",{store:this.calendarManagerStore})}async isValidDependency(...n){return!0}rejectStmTransaction(n){n=n||this.stm,n.transaction&&(n.transaction.length?(n.forEachStore(s=>s.beginBatch()),n.rejectTransaction(),n.forEachStore(s=>s.endBatch())):n.stopTransaction())}async tryPropagateWithChanges(n){const s=this.stm,a=s.disabled,o=s.autoRecord;return this.queue(async()=>{a?s.enable():(o&&(s.autoRecord=!1),s.isRecording&&s.stopTransaction()),s.startTransaction(),n();let l=!0;try{l=!(await this.commitAsync()).rejectedWith}catch(c){if(!/cycle/i.test(c))throw c;l=!1}return l?(s.stopTransaction(),a&&s.resetQueue()):(this.replica.reject(),this.rejectStmTransaction(s)),s.disabled=a,s.autoRecord=o,l})}queue(n,s){return this._queue.queue(function(){return n()},s)}isEngineReady(){const{replica:n}=this;return this.delayEnteringReplica||!this.isRepopulatingStores&&(n?!(n.dirty&&(n.hasPendingAutoCommit()||n.isCommitting)):!0)}static get defaultConfig(){return{assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null,eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null,calendarManagerStore:null,eventModelClass:null,resourceModelClass:null,assignmentModelClass:null,dependencyModelClass:null,calendarModelClass:null,repopulateOnDataset:!0}}static get delayable(){return{repopulateReplica:10}}}return t.applyConfigs=!0,Xh([de({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),Xh([de({type:"boolean",defaultValue:!1})],t.prototype,"skipNonWorkingTimeWhenSchedulingManually",void 0),Xh([de({type:"boolean",defaultValue:!0})],t.prototype,"skipNonWorkingTimeInDurationWhenSchedulingManually",void 0),Xh([de({type:"string",defaultValue:ae.Forward},{sync:!0})],t.prototype,"direction",void 0),t}){},Ne=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},zR=function*(e,r,t,i,n){if(t.isIntervalEmpty())return t;if(n&&t.intersectionOf){const o=new Set;for(const l of t.intersectionOf)if(l.isInfinite())o.add(l);else{const c=l.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.startDate,!1,i):l.startDate,d=l.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.endDate,!1,i):l.endDate,u=l;o.add(u.copyWith({reflectionOf:u,side:u.side===Ye.Start?Ye.End:Ye.Start,startDate:c,endDate:d}))}t.intersectionOf=o}const s=t.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.startDate,!1,i):null,a=t.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.endDate,!1,i):null;return nn([r,an.new({intersectionOf:t.intersectionOf,startDate:s,endDate:a})],n)},WR=function*(e,r,t,i,n){if(r.isIntervalEmpty())return r;if(n){const o=new Set;for(const l of r.intersectionOf)if(l.isInfinite())o.add(l);else{const c=l.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.startDate,!0,i):l.startDate,d=l.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.endDate,!0,i):l.endDate,u=l;o.add(u.copyWith({reflectionOf:u,side:u.side===Ye.Start?Ye.End:Ye.Start,startDate:c,endDate:d}))}r.intersectionOf=o}const s=r.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(r.startDate,!0,i):null,a=r.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(r.endDate,!0,i):null;return nn([t,an.new({reflectionOf:s||a?r:void 0,intersectionOf:s||a?r.intersectionOf:void 0,startDate:s,endDate:a})],n)},ot=!0,ws=class extends G([Kh],e=>{const r=e.prototype;class t extends e{*maybeSkipNonWorkingTime(n,s=!0){if(yield*this.hasSubEvents())return n;let a=yield*this.calculateEffectiveDuration();return n&&a>0?yield*this.skipNonWorkingTime(n,s):n}*calculateEffectiveConstraintInterval(n,s,a,o=!1){const l=yield*this.calculateEffectiveDuration();return l==null?null:yield*(n?zR:WR)(this,nn(s,o),nn(a,o),l,o)}*calculateStartDateConstraintIntervals(){return[]}*calculateEndDateConstraintIntervals(){return[]}*calculateEarlyStartDateConstraintIntervals(){return[]}*calculateEarlyEndDateConstraintIntervals(){return[]}*doCalculateEarlyEffectiveStartDateInterval(n=!1){const s=yield this.$.earlyStartDateConstraintIntervals,a=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!0,s.concat(yield this.$.startDateConstraintIntervals),a.concat(yield this.$.endDateConstraintIntervals),n)}*calculateEarlyEffectiveStartDateInterval(){return yield*this.doCalculateEarlyEffectiveStartDateInterval()}*doCalculateEarlyEffectiveEndDateInterval(n=!1){const s=yield this.$.earlyStartDateConstraintIntervals,a=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!1,s.concat(yield this.$.startDateConstraintIntervals),a.concat(yield this.$.endDateConstraintIntervals),n)}*calculateEarlyEffectiveEndDateInterval(){return yield*this.doCalculateEarlyEffectiveEndDateInterval()}*shouldRollupChildEarlyStartDate(n){return!0}*calculateMinChildrenEarlyStartDate(){let n=He;const s=yield*this.subEventsIterable();for(let a of s){let o;(yield*this.shouldRollupChildEarlyStartDate(a))&&((yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.minChildrenEarlyStartDate),o=o||(yield a.$.earlyStartDate),o&&o<n&&(n=o))}return n.getTime()-He.getTime()?n:null}*shouldRollupChildEarlyEndDate(n){return!0}*calculateMaxChildrenEarlyEndDate(){let n=Xe;const s=yield*this.subEventsIterable();for(let a of s){let o;(yield*this.shouldRollupChildEarlyEndDate(a))&&((yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.maxChildrenEarlyEndDate),o=o||(yield a.$.earlyEndDate),o&&o>n&&(n=o))}return n.getTime()-Xe.getTime()?n:null}*calculateEarlyStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===ae.Forward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenEarlyStartDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.startDate;let n=yield this.$.earlyEffectiveStartDateInterval;if(n===null)return null;if(n.isIntervalEmpty()){n=yield*this.doCalculateEarlyEffectiveStartDateInterval(!0);const s=sn.new({intervals:[...n.intersectionOf]});if((yield s)===sr.Cancel)yield mi(s);else return null}return ui(n.startDate)?n.startDate:null}*calculateEarlyStartDate(){const n=yield this.$.earlyStartDateRaw;return yield*this.maybeSkipNonWorkingTime(n,!0)}*calculateEarlyEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===ae.Forward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenEarlyEndDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.endDate;let n=yield this.$.earlyEffectiveEndDateInterval;if(n===null)return null;if(n.isIntervalEmpty()){n=yield*this.doCalculateEarlyEffectiveEndDateInterval(!0);const s=sn.new({intervals:[...n.intersectionOf]});if((yield s)===sr.Cancel)yield mi(s);else return null}return ui(n.startDate)?n.startDate:null}*calculateEarlyEndDate(){return yield this.$.earlyEndDateRaw}*isConstrainedEarly(){const n=yield this.$.startDateConstraintIntervals,s=yield this.$.endDateConstraintIntervals,a=yield this.$.earlyStartDateConstraintIntervals,o=yield this.$.earlyEndDateConstraintIntervals;return!!(n!=null&&n.length||s!=null&&s.length||a!=null&&a.length||o!=null&&o.length)}*calculateStartDatePure(){return(yield this.$.effectiveDirection).direction===ae.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*r.calculateStartDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():(yield this.$.earlyStartDate)||(yield*r.calculateStartDatePure.call(this)):yield*r.calculateStartDatePure.call(this)}*calculateStartDateProposed(){switch((yield this.$.effectiveDirection).direction){case ae.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*r.calculateStartDateProposed.call(this);if(yield*this.hasSubEvents())return yield*this.calculateMinChildrenStartDate();const s=yield this.$.earlyStartDate;if(s){if(ui(s))return s;const a=yield*r.calculateStartDateProposed.call(this),o=yield this.$.earlyEffectiveStartDateInterval;return o.containsDate(a)?a:ui(o.endDate)?o.endDate:a}else return yield*r.calculateStartDateProposed.call(this);default:return yield*r.calculateStartDateProposed.call(this)}}*calculateEndDatePure(){return(yield this.$.effectiveDirection).direction===ae.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*r.calculateEndDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():(yield this.$.earlyEndDate)||(yield*r.calculateEndDatePure.call(this)):yield*r.calculateEndDatePure.call(this)}*calculateEndDateProposed(){switch((yield this.$.effectiveDirection).direction){case ae.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*r.calculateEndDateProposed.call(this);if(yield*this.hasSubEvents())return yield*this.calculateMaxChildrenEndDate();const s=yield this.$.earlyEndDate;if(s){if(ui(s))return s;const a=yield*r.calculateEndDateProposed.call(this),o=yield this.$.earlyEffectiveEndDateInterval;return o.containsDate(a)?a:ui(o.endDate)?o.endDate:a}else return yield*r.calculateEndDateProposed.call(this);default:return yield*r.calculateEndDateProposed.call(this)}}}return Ne([me({lazy:ot})],t.prototype,"minChildrenEarlyStartDate",void 0),Ne([me({lazy:ot})],t.prototype,"earlyStartDateRaw",void 0),Ne([de({type:"date",persist:!1},{lazy:ot,converter:vi,persistent:!1})],t.prototype,"earlyStartDate",void 0),Ne([me({lazy:ot})],t.prototype,"maxChildrenEarlyEndDate",void 0),Ne([me({lazy:ot})],t.prototype,"earlyEndDateRaw",void 0),Ne([de({type:"date",persist:!1},{lazy:ot,converter:vi,persistent:!1})],t.prototype,"earlyEndDate",void 0),Ne([me()],t.prototype,"startDateConstraintIntervals",void 0),Ne([me()],t.prototype,"endDateConstraintIntervals",void 0),Ne([me({lazy:ot})],t.prototype,"earlyStartDateConstraintIntervals",void 0),Ne([me({lazy:ot})],t.prototype,"earlyEndDateConstraintIntervals",void 0),Ne([me()],t.prototype,"earlyEffectiveStartDateInterval",void 0),Ne([me()],t.prototype,"earlyEffectiveEndDateInterval",void 0),Ne([ie("startDateConstraintIntervals")],t.prototype,"calculateStartDateConstraintIntervals",null),Ne([ie("endDateConstraintIntervals")],t.prototype,"calculateEndDateConstraintIntervals",null),Ne([ie("earlyStartDateConstraintIntervals")],t.prototype,"calculateEarlyStartDateConstraintIntervals",null),Ne([ie("earlyEndDateConstraintIntervals")],t.prototype,"calculateEarlyEndDateConstraintIntervals",null),Ne([ie("earlyEffectiveStartDateInterval")],t.prototype,"calculateEarlyEffectiveStartDateInterval",null),Ne([ie("earlyEffectiveEndDateInterval")],t.prototype,"calculateEarlyEffectiveEndDateInterval",null),Ne([ie("minChildrenEarlyStartDate")],t.prototype,"calculateMinChildrenEarlyStartDate",null),Ne([ie("maxChildrenEarlyEndDate")],t.prototype,"calculateMaxChildrenEarlyEndDate",null),Ne([ie("earlyStartDateRaw")],t.prototype,"calculateEarlyStartDateRaw",null),Ne([ie("earlyStartDate")],t.prototype,"calculateEarlyStartDate",null),Ne([ie("earlyEndDateRaw")],t.prototype,"calculateEarlyEndDateRaw",null),Ne([ie("earlyEndDate")],t.prototype,"calculateEarlyEndDate",null),t}){},ln=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},sb=class extends G([ws,yi],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.ignorePinningConstraint=!1}writeStartDate(n,s,a,o,l=!0){const c=this.getProject();if(c!=null&&c.addConstraintOnDateSet&&s.graph.hasIdentifier(this.$.effectiveDirection)&&!(c!=null&&c.eventStore.isSyncingDataOnLoad)&&!this.isReverting&&!(c!=null&&c.getStm().isRestoring)){const d=this.getStartDatePinConstraintType();d&&(this.constraintDate=o,this.constraintType=d)}return r.writeStartDate.call(this,n,s,a,o,l)}writeEndDate(n,s,a,o,l=!1){const c=this.getProject();if(c!=null&&c.addConstraintOnDateSet&&s.graph.hasIdentifier(this.$.direction)&&l&&!(c!=null&&c.eventStore.isSyncingDataOnLoad)&&!(c!=null&&c.getStm().isRestoring)){const d=this.getEndDatePinConstraintType();d&&(this.constraintDate=o,this.constraintType=d)}return r.writeEndDate.call(this,n,s,a,o,l)}writeConstraintType(n,s,a,o,l=!1){const c=this.getProject();!l&&!n.isWritingUndefined&&c.includeAsapAlapAsConstraints&&(o!==ue.AsSoonAsPossible&&o!==ue.AsLateAsPossible?s.baseRevision.hasIdentifier(n)&&this.$.direction.write.call(this,this.$.direction,s,void 0,null,!0):(this.$.direction.write.call(this,this.$.direction,s,void 0,o===ue.AsSoonAsPossible?ae.Forward:ae.Backward,!0),this.$.constraintDate.write.call(this,this.$.constraintDate,s,void 0,null))),n.constructor.prototype.write.call(this,n,s,a,o)}writeDirection(n,s,a,o,l=!1){const c=this.getProject();!l&&!n.isWritingUndefined&&c.includeAsapAlapAsConstraints&&(o||s.baseRevision.hasIdentifier(n))&&this.$.constraintType.write.call(this,this.$.constraintType,s,void 0,o===ae.Forward?ue.AsSoonAsPossible:o===ae.Backward?ue.AsLateAsPossible:null,!0),n.constructor.prototype.write.call(this,n,s,a,o)}*calculateConstraintType(){let n=yield Ee;return(yield*this.isConstraintTypeApplicable(n))||(n=null),n}*calculateConstraintDate(n){let s=yield Ee;const a=yield this.$.constraintType;return a?s||(s=this.getConstraintTypeDefaultDate(n,a)):s=null,s}getStartDatePinConstraintType(){const{effectiveDirection:n}=this.project;if(!this.isTaskPinnableWithConstraint())return null;switch(n.direction){case ae.Forward:return ue.StartNoEarlierThan;case ae.Backward:return ue.StartNoLaterThan}}getEndDatePinConstraintType(){const{effectiveDirection:n}=this.project;if(!this.isTaskPinnableWithConstraint())return null;switch(n.direction){case ae.Forward:return ue.FinishNoEarlierThan;case ae.Backward:return ue.FinishNoLaterThan}}isTaskPinnableWithConstraint(){const{manuallyScheduled:n,ignorePinningConstraint:s,constraintType:a}=this;let o=!1;if(!n&&!s)if(a)switch(a){case ue.AsSoonAsPossible:case ue.AsLateAsPossible:case ue.StartNoEarlierThan:case ue.StartNoLaterThan:case ue.FinishNoEarlierThan:case ue.FinishNoLaterThan:o=!0}else o=!0;return o}applyChangeset(n,s,a){this.ignorePinningConstraint=a;const o=super.applyChangeset(n,s,a);return this.ignorePinningConstraint=!1,o}getConstraintTypeDefaultDate(n,s){switch(s){case ue.StartNoEarlierThan:case ue.StartNoLaterThan:case ue.MustStartOn:return n(et(this.$.startDate));case ue.FinishNoEarlierThan:case ue.FinishNoLaterThan:case ue.MustFinishOn:return n(et(this.$.endDate))}return null}*isConstraintTypeApplicable(n){const s=yield*this.hasSubEvents();switch(n){case ue.FinishNoEarlierThan:case ue.StartNoLaterThan:case ue.MustFinishOn:case ue.MustStartOn:return!s}return!0}async setConstraint(n,s){return this.constraintType=n,s!==void 0&&(this.constraintDate=s),this.commitAsync()}*calculateEndDateConstraintIntervals(){const n=yield*r.calculateEndDateConstraintIntervals.call(this),s=yield this.$.manuallyScheduled,a=yield this.$.constraintType,o=yield this.$.constraintDate,l=this.project.dateConstraintIntervalClass;if(!s&&a&&o)switch(a){case ue.MustFinishOn:n.unshift(l.new({owner:this,side:Ye.End,startDate:o,endDate:o}));break;case ue.FinishNoEarlierThan:n.unshift(l.new({owner:this,side:Ye.End,startDate:o}));break;case ue.FinishNoLaterThan:n.unshift(l.new({owner:this,side:Ye.End,endDate:o}));break}return n}*calculateStartDateConstraintIntervals(){const n=yield*r.calculateStartDateConstraintIntervals.call(this),s=yield this.$.manuallyScheduled,a=yield this.$.constraintType,o=yield this.$.constraintDate,l=this.project.dateConstraintIntervalClass;if(!s&&a&&o)switch(a){case ue.MustStartOn:n.unshift(l.new({owner:this,side:Ye.Start,startDate:o,endDate:o}));break;case ue.StartNoEarlierThan:n.unshift(l.new({owner:this,side:Ye.Start,startDate:o}));break;case ue.StartNoLaterThan:n.unshift(l.new({owner:this,side:Ye.Start,endDate:o}));break}return n}}return ln([de({type:"string"},{sync:!0})],t.prototype,"constraintType",void 0),ln([de({type:"date"},{converter:vi,sync:!0})],t.prototype,"constraintDate",void 0),ln([br("constraintType")],t.prototype,"writeConstraintType",null),ln([br("direction")],t.prototype,"writeDirection",null),ln([ie("constraintType")],t.prototype,"calculateConstraintType",null),ln([ie("constraintDate")],t.prototype,"calculateConstraintDate",null),t}){},GR=class extends We(zh){static get $name(){return"RemoveDateConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return mr(this.L("L{descriptionTpl}"),e.name||e.id,this.interval.getConstraintName(e.constraintType))}resolve(){this.event.constraintType=null}},UR=class extends Co{static get $name(){return"DateConstraintIntervalDescription"}static getDescription(e){let r;switch(e.owner.constraintType){case ue.StartNoEarlierThan:case ue.FinishNoEarlierThan:case ue.MustStartOn:case ue.MustFinishOn:r=this.L("L{startDateDescriptionTpl}");break;case ue.StartNoLaterThan:case ue.FinishNoLaterThan:r=this.L("L{endDateDescriptionTpl}");break}return mr(r,...this.getDescriptionParameters(e))}static getConstraintName(e){return this.L("L{constraintTypeTpl}")[e]}static getDescriptionParameters(e){const r=e.owner;return[b.format(e.startDate,this.L("L{dateFormat}")),b.format(e.endDate,this.L("L{dateFormat}")),r.name||r.id,this.getConstraintName(r.constraintType)]}},Nc=class extends an{getConstraintName(e){return this.descriptionBuilderClass.getConstraintName(e||this.owner.constraintType)}getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const r=this.owner;e=e||r.graph.activeTransaction;const t=e.entries.get(r.$.constraintDate),i=e.entries.get(r.$.constraintType);return!e.baseRevision.hasIdentifier(r.$$)||t&&!t.isShadow()||i&&!i.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.removeDateConstraintConflictResolutionClass.new({interval:this})])}};ln([pe(GR)],Nc.prototype,"removeDateConstraintConflictResolutionClass",void 0),ln([pe(UR)],Nc.prototype,"descriptionBuilderClass",void 0);var Zh=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},ab=class extends G([ws,tb,yi,sb],e=>{const r=e.prototype;class t extends e{*shouldPredecessorAffectScheduling(n){const s=yield n.$.fromEvent;return s&&!hs(s)&&(yield n.$.active)&&(!(yield s.$.inactive)||(yield this.$.inactive))}*calculateEarlyStartDateConstraintIntervals(){const n=yield*r.calculateEarlyStartDateConstraintIntervals.call(this),s=this.getProject(),a=s.dependencyConstraintIntervalClass;for(const o of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(o)))continue;const l=yield o.$.fromEvent,c=yield l.$.manuallyScheduled;let d;switch(yield o.$.type){case ft.EndToStart:d=c?yield l.$.endDate:yield l.$.earlyEndDateRaw;break;case ft.StartToStart:d=c?yield l.$.startDate:yield l.$.earlyStartDateRaw;break}if(d){const u=yield o.$.lag,h=yield o.$.lagUnit,g=yield o.$.calendar;yield g.$.version;const f=a.new({owner:o,startDate:g.calculateEndDate(d,yield*s.$convertDuration(u,h,ee.Millisecond)),endDate:null});n.unshift(f)}}return n}*calculateEarlyEndDateConstraintIntervals(){const n=yield*r.calculateEarlyEndDateConstraintIntervals.call(this),s=this.getProject(),a=s.dependencyConstraintIntervalClass;for(const o of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(o)))continue;const l=yield o.$.fromEvent,c=yield l.$.manuallyScheduled;let d;switch(yield o.$.type){case ft.EndToEnd:d=c?yield l.$.endDate:yield l.$.earlyEndDateRaw;break;case ft.StartToEnd:d=c?yield l.$.startDate:yield l.$.earlyStartDateRaw;break}if(d){const u=yield o.$.lag,h=yield o.$.lagUnit,g=yield o.$.calendar;yield g.$.version;const f=a.new({owner:o,startDate:g.calculateEndDate(d,yield*s.$convertDuration(u,h,ee.Millisecond)),endDate:null});n.unshift(f)}}return n}*calculateEffectiveDirection(){const n=yield this.getProject().$.effectiveDirection,s=yield this.$.constraintType;if(n.direction===ae.Forward&&!(yield this.$.manuallyScheduled)&&!((s===ue.MustStartOn||s===ue.MustFinishOn)&&(yield this.$.constraintDate)))for(const a of yield this.$.incomingDeps){const o=yield a.$.fromEvent,l=o!=null&&!hs(o),c=l?yield o.$.constraintType:void 0;if(!l||!(yield a.$.active)||(yield o.$.manuallyScheduled)||(c===ue.MustStartOn||c===ue.MustFinishOn)&&(yield o.$.constraintDate))continue;const d=yield a.$.type,u=d===ft.EndToEnd||d===ft.EndToStart?yield o.$.endDateDirection:yield o.$.startDateDirection;if(u.direction===ae.Backward)return{kind:"enforced",direction:ae.Backward,enforcedBy:u.kind==="enforced"?u.enforcedBy:u.kind==="own"?o:u.inheritedFrom}}return yield*super.calculateEffectiveDirection()}}return Zh([de({type:"boolean"})],t.prototype,"inactive",void 0),t}){},ob=class extends We(zh){static get $name(){return"BaseDependencyResolution"}getDescription(){const{dependency:e}=this,{type:r,fromEvent:t,toEvent:i}=e;return mr(this.L("L{descriptionTpl}"),this.L("L{DependencyType.long}")[r],t.name||t.id,i.name||i.id)}},lb=class extends ob{static get $name(){return"RemoveDependencyResolution"}resolve(){this.dependency.remove()}},cb=class extends ob{static get $name(){return"DeactivateDependencyResolution"}resolve(){this.dependency.active=!1}},YR=class extends Co{static get $name(){return"DependencyConstraintIntervalDescription"}static getDescriptionParameters(e){const r=e.owner;return[b.format(e.startDate,this.L("L{dateFormat}")),b.format(e.endDate,this.L("L{dateFormat}")),this.L("L{DependencyType.long}")[r.type],r.fromEvent.name,r.toEvent.name]}},Do=class extends an{isAffectedByTransaction(e){const r=this.owner;e=e||r.graph.activeTransaction;const{entries:t}=e,{fromEvent:i,toEvent:n,lag:s,lagUnit:a,type:o}=r.$,l=t.get(i),c=t.get(n),d=t.get(s),u=t.get(a),h=t.get(o);return!e.baseRevision.hasIdentifier(r.$$)||l&&!l.isShadow()||c&&!c.isShadow()||d&&!d.isShadow()||u&&!u.isShadow()||h&&!h.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.deactivateDependencyConflictResolutionClass.new({dependency:this.owner}),this.removeDependencyConflictResolutionClass.new({dependency:this.owner})])}};Zh([pe(lb)],Do.prototype,"removeDependencyConflictResolutionClass",void 0),Zh([pe(cb)],Do.prototype,"deactivateDependencyConflictResolutionClass",void 0),Zh([pe(YR)],Do.prototype,"descriptionBuilderClass",void 0);var cn=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Jh=class extends G([Wh],e=>{const r=e.prototype;class t extends e{*calculateUnits(){const n=yield this.$.event;return n?yield*n.calculateAssignmentUnits(this):yield Ee}*calculateEffort(){const n=yield this.$.event;if(n){const s=yield n.$.startDate,a=yield n.$.endDate,o=yield n.$.effectiveCalendar;if(s&&a){const l=new Map;return l.set(o,[this]),yield*n.calculateProjectedEffort(s,a,l)}}return null}*calculateActualDate(){const n=yield this.$.event;if(n){const s=yield n.$.startDate,a=yield n.$.duration,o=yield n.$.percentDone;return yield*n.calculateProjectedXDateWithDuration(s,!0,a*.01*o)}return null}*calculateActualEffort(){const n=yield this.$.event;if(n){const s=yield n.$.startDate,a=yield n.$.effectiveCalendar,o=yield this.$.actualDate,l=new Map;return l.set(a,[this]),yield*n.calculateProjectedEffort(s,o,l)}return null}}return cn([de({type:"number",defaultValue:100})],t.prototype,"units",void 0),cn([ie("units")],t.prototype,"calculateUnits",null),cn([me({lazy:!0})],t.prototype,"effort",void 0),cn([me({lazy:!0})],t.prototype,"actualDate",void 0),cn([me({lazy:!0})],t.prototype,"actualEffort",void 0),cn([ie("effort")],t.prototype,"calculateEffort",null),cn([ie("actualDate")],t.prototype,"calculateActualDate",null),cn([ie("actualEffort")],t.prototype,"calculateActualEffort",null),t}){},wo=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},db=class extends G([nb],e=>{const r=e.prototype;class t extends e{*calculateCalendar(){const n=this.getProject(),s=yield n.$.dependenciesCalendar;let a;switch(s){case rs.Project:a=yield n.$.effectiveCalendar;break;case rs.FromEvent:const o=yield this.$.fromEvent;a=o&&!hs(o)?yield o.$.effectiveCalendar:null;break;case rs.ToEvent:const l=yield this.$.toEvent;a=l&&!hs(l)?yield l.$.effectiveCalendar:null;break}return a||(a=yield n.$.effectiveCalendar),a}async setLag(n,s){if(this.graph)return this.graph.write(this.$.lag,n,s),this.graph.commitAsync();this.$.lag.DATA=n,s!=null&&(this.$.lagUnit.DATA=s)}writeLag(n,s,a,o,l=void 0){n.constructor.prototype.write.call(this,n,s,a,o),l!=null&&s.write(this.$.lagUnit,l)}}return wo([de({type:"number",defaultValue:0})],t.prototype,"lag",void 0),wo([de({type:"string",defaultValue:ee.Day},{converter:b.normalizeUnit})],t.prototype,"lagUnit",void 0),wo([me()],t.prototype,"calendar",void 0),wo([de({type:"boolean",defaultValue:!0,persist:!0})],t.prototype,"active",void 0),wo([ie("calendar")],t.prototype,"calculateCalendar",null),wo([br("lag")],t.prototype,"writeLag",null),t}){},Qh=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},ub=class extends G([yi],e=>{const r=e.prototype;class t extends e{*calculatePercentDone(){const n=yield this.$.childEvents,a=yield this.getProject().$.autoCalculatePercentDoneForParentTasks;if(n.size&&a){const o=yield this.$.percentDoneSummaryData;return o.totalDuration>0?o.completedDuration/o.totalDuration:o.milestonesNum>0?o.milestonesTotalPercentDone/o.milestonesNum:null}else return yield Ee}*shouldRollupChildPercentDoneSummaryData(n){return!0}*calculatePercentDoneSummaryData(){const n=yield this.$.childEvents;if(n.size){let s={totalDuration:0,completedDuration:0,milestonesNum:0,milestonesTotalPercentDone:0};for(const a of n){if(!(yield*this.shouldRollupChildPercentDoneSummaryData(a)))continue;const o=yield a.$.percentDoneSummaryData;o&&(s.totalDuration+=o.totalDuration,s.completedDuration+=o.completedDuration,s.milestonesNum+=o.milestonesNum,s.milestonesTotalPercentDone+=o.milestonesTotalPercentDone)}return s}else{const s=yield this.$.duration;if(typeof s=="number"){const a=yield*this.getProject().$convertDuration(s,yield this.$.durationUnit,ee.Millisecond),o=yield this.$.percentDone;return{totalDuration:a,completedDuration:a*o,milestonesNum:a===0?1:0,milestonesTotalPercentDone:a===0?o:0}}else return null}}}return Qh([de({type:"number",defaultValue:0})],t.prototype,"percentDone",void 0),Qh([me()],t.prototype,"percentDoneSummaryData",void 0),Qh([ie("percentDone")],t.prototype,"calculatePercentDone",null),Qh([ie("percentDoneSummaryData")],t.prototype,"calculatePercentDoneSummaryData",null),t}){},zc=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},eg=class extends G([eb],e=>{const r=e.prototype;class t extends e{*hasProposedValueForUnits(){const n=yield this.$.assigned;for(const s of n)if((yield s.$.resource)&&(yield vr(s.$.units)))return!0;return!1}async assign(n,s=100){const a=this.getProject().assignmentStore.modelClass;return this.addAssignment(new a({event:this,resource:n,units:s})),this.commitAsync()}*forEachAvailabilityInterval(n,s){const a=yield this.$.effectiveCalendar,o=yield this.$.assignmentsByCalendar,l=yield this.$.effectiveCalendarsCombination,c=(yield this.$.ignoreResourceCalendar)||n.ignoreResourceCalendar||!o.size,d=this.getProject().maxCalendarRange;return d&&(n=Object.assign({maxRange:d},n)),l.forEachAvailabilityInterval(n,(u,h,g)=>{const f=g.getCalendarsWorkStatus(),m=g.getCalendarsWorking();if(f.get(a)&&(c||m.some(p=>o.has(p))))return s(u,h,g)})}*calculateEffectiveCalendarsCombination(){const n=yield this.$.manuallyScheduled,s=this.getProject(),a=[yield this.$.effectiveCalendar];if(!n||s.skipNonWorkingTimeInDurationWhenSchedulingManually){const o=yield this.$.assignmentsByCalendar;a.push(...o.keys())}return this.getProject().combineCalendars(a)}*calculateAssignmentsByCalendar(){const n=yield this.$.assigned,s=new Map;for(const a of n){const o=yield a.$.resource;if(o){const l=yield o.$.effectiveCalendar;let c=s.get(l);c||(c=[],s.set(l,c)),c.push(a)}}return s}*getBaseOptionsForDurationCalculations(){return{ignoreResourceCalendar:!1}}*useEventAvailabilityIterator(){return(yield this.$.assignmentsByCalendar).size>0}*skipNonWorkingTime(n,s=!0,a){if(!n)return null;const o=yield this.$.assignmentsByCalendar,l=yield this.$.ignoreResourceCalendar;if(yield*this.useEventAvailabilityIterator()){const c=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),s?{startDate:n,isForward:s}:{endDate:n,isForward:s},a);let d;const u=yield*this.forEachAvailabilityInterval(c,(h,g,f)=>(d=s?h:g,!1));if(u===_t.MaxRangeReached||u===_t.FullRangeIterated){const h=[yield this.$.effectiveCalendar];!c.ignoreResourceCalendar&&!l&&h.push(...o.keys());const g=jc.new({event:this,calendars:h,date:n,isForward:s});if((yield g)===sr.Cancel)yield mi(g);else return null}return new Date(d)}else return yield*r.skipNonWorkingTime.call(this,n,s)}*calculateProjectedDuration(n,s,a,o){if(!n||!s)return null;if(yield*this.useEventAvailabilityIterator()){const l=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),{startDate:n,endDate:s,isForward:!0},o),c=this.getProject().adjustDurationToDST;let d=0;return yield*this.forEachAvailabilityInterval(l,(u,h)=>{if(d+=h.getTime()-u.getTime(),c){const g=u.getTimezoneOffset()-h.getTimezoneOffset();d+=g*60*1e3}}),a||(a=yield this.$.durationUnit),yield*this.getProject().$convertDuration(d,ee.Millisecond,a)}else return yield*r.calculateProjectedDuration.call(this,n,s,a)}*calculateProjectedXDateWithDuration(n,s=!0,a,o,l){if(a==null||isNaN(a)||n==null)return null;if(a==0)return n;o=o||(yield this.$.durationUnit);const c=yield*this.getProject().$convertDuration(a,o,ee.Millisecond);let d=n.getTime(),u=c;const h=yield this.$.effectiveCalendar;if(yield*this.useEventAvailabilityIterator()){const g=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),s?{startDate:n,isForward:s}:{endDate:n,isForward:s},l),f=this.getProject().adjustDurationToDST;return(yield*this.forEachAvailabilityInterval(g,(p,v,y)=>{const C=p.getTime(),D=v.getTime(),S=D-C;if(S>=u){if(f){const x=s?p.getTimezoneOffset()-new Date(C+u).getTimezoneOffset():new Date(D-u).getTimezoneOffset()-v.getTimezoneOffset();u-=x*60*1e3}return d=s?C+u:D-u,!1}else if(u-=S,f){const x=p.getTimezoneOffset()-v.getTimezoneOffset();u-=x*60*1e3}}))===_t.StoppedByIterator?new Date(d):null}else return h.accumulateWorkingTime(n,c,s).finalDate}}return zc([me()],t.prototype,"effectiveCalendarsCombination",void 0),zc([me()],t.prototype,"assignmentsByCalendar",void 0),zc([de({type:"boolean"})],t.prototype,"ignoreResourceCalendar",void 0),zc([ie("effectiveCalendarsCombination")],t.prototype,"calculateEffectiveCalendarsCombination",null),zc([ie("assignmentsByCalendar")],t.prototype,"calculateAssignmentsByCalendar",null),t}){},ar=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Ur=Symbol("MasterStartDateVar"),Wc=Symbol("MasterEndDateVar"),Gc=Symbol("MasterDurationVar"),Uc=Symbol("MasterTotalDurationVar"),Zt=Symbol("StartOffsetVar"),or=Symbol("EndOffsetVar"),qR=Ze.new({output:Re,inputs:new Set([Zt,or])}),KR=Ze.new({output:De,inputs:new Set([Zt,Ur])}),hb=Ze.new({output:we,inputs:new Set([or,Ur])}),XR=Ze.new({output:Zt,inputs:new Set([De,Ur])}),gb=Ze.new({output:or,inputs:new Set([we,Ur])}),ZR=Ze.new({output:Zt,inputs:new Set([or,Re])}),fb=Ze.new({output:or,inputs:new Set([Zt,Re])}),JR=Ze.new({output:or,inputs:new Set([Zt,Uc])}),QR=Ze.new({output:or,inputs:new Set([Zt,Gc])}),eT=Ze.new({output:Re,inputs:new Set([Zt,Wc])}),mL=tn.new({variables:new Set([De,we,Re,Ur,Wc,Gc,Uc,Zt,or]),formulas:new Set([qR,KR,hb,ZR,XR,fb,JR,QR,gb,eT])}),pL=Pt.new({description:mL,defaultResolutionFormulas:new Set([hb,gb,fb])}),vL=class extends yr.mix(Mr){equality(e,r){const t=e.resolution,i=r.resolution;return t.get(De)===i.get(De)&&t.get(we)===i.get(we)&&t.get(Re)===i.get(Re)&&t.get(Ur)===i.get(Ur)&&t.get(Wc)===i.get(Wc)&&t.get(Gc)===i.get(Gc)&&t.get(Uc)===i.get(Uc)&&t.get(Zt)===i.get(Zt)&&t.get(or)===i.get(or)}},mb=class extends G([on],e=>{class r extends e{get isEventSegment(){return!0}get stm(){var i;return(i=this.event)==null?void 0:i.stm}set stm(i){}writeStartDate(i,n,s,a,o=!0){const l=this.event,c=this.getProject();if(l&&!this.previousSegment&&n.baseRevision.hasIdentifier(i)&&!(c&&c.getStm().isRestoring)?l.$.startDate.constructor.prototype.write.call(this,l.$.startDate,n,null,a,o):i.constructor.prototype.write.call(this,i,n,s,a,o),o&&this.nextSegment){const d=this.endOffset-this.nextSegment.startOffset;if(d>0){let u=this;for(;u=u.nextSegment;)u.startOffset+=d,u.endOffset+=d}}}shouldRecordFieldChange(i,n,s){return i==="startOffset"||i==="endOffset"||super.shouldRecordFieldChange(i,n,s)}*calculateStartOffset(){const n=(yield this.$.dispatcher).resolution.get(Zt);if(!this.event)return yield Ee;let s;if(n===Ft)s=yield Ee;else if(n===ZR.formulaId)s=yield*this.calculateStartOffsetByEndOffsetAndDuration();else if(n===XR.formulaId){const a=yield et(this.event.$.startDate),o=yield et(this.$.startDate);s=yield*this.event.calculateProjectedDuration(a,o,ee.Millisecond,{ignoreSegments:!0})}return s}*calculateEndOffset(){const n=(yield this.$.dispatcher).resolution.get(or);if(!this.event)return yield Ee;let s;if(n===Ft)s=yield Ee;else if(n===fb.formulaId)s=yield*this.calculateEndOffsetByStartOffsetAndDuration();else if(n===gb.formulaId){const a=yield et(this.event.$.startDate),o=yield et(this.$.endDate);s=yield*this.event.calculateProjectedDuration(a,o,ee.Millisecond,{ignoreSegments:!0})}else n===QR.formulaId?s=yield*this.calculateEndOffsetByMasterDurationAndStartOffset():n===JR.formulaId&&(s=yield*this.calculateEndOffsetByMasterTotalDurationAndStartOffset());return s}*calculateStartDate(){const n=(yield this.$.dispatcher).resolution.get(De);if(!this.event)return yield Ee;let s;return n===KR.formulaId?s=yield*this.calculateStartDateByMasterStartAndStartOffset():s=yield*super.calculateStartDate(),s}*calculateEndDate(){const n=(yield this.$.dispatcher).resolution.get(we);if(!this.event)return yield Ee;let s;return n===hb.formulaId?s=yield*this.calculateEndDateByMasterStartAndEndOffset():s=yield*super.calculateEndDate(),s}*calculateDuration(){const n=(yield this.$.dispatcher).resolution.get(Re);if(!this.event)return yield Ee;let s;return n===qR.formulaId?s=yield*this.calculateDurationByOffsets():n===eT.formulaId?s=yield*this.calculateDurationByOffsets():s=yield*super.calculateDuration(),s}buildProposedDispatcher(i,n,s){const a=super.buildProposedDispatcher(i,n,s);return a.addPreviousValueFlag(Ur),a.addPreviousValueFlag(Zt),a.addPreviousValueFlag(or),a}*prepareDispatcher(i){const n=yield*super.prepareDispatcher(i);if(!this.event)return n;if(i(Ph(this.event.$.startDate))!=null&&n.addPreviousValueFlag(Ur),i(vr(this.event.$.startDate))&&n.addProposedValueFlag(Ur),!i(vr(this.event.$.segments))){if(n.collectInfo(i,this.event.$.duration,Gc),i(vr(this.event.$.endDate))){const a=i(fs(this.event.$.endDate));a!=null&&a[0]||n.addProposedValueFlag(Wc)}const s=i(this.event.$.dispatcher);s.resolution.get(De)===Ft&&s.resolution.get(we)===Ft&&n.addProposedValueFlag(Uc)}return n.collectInfo(i,this.$.startOffset,Zt),n.collectInfo(i,this.$.endOffset,or),n}cycleResolutionContext(i){return pL}*calculateEndOffsetByMasterDurationAndStartOffset(){const i=yield et(this.event.$.duration),n=yield this.event.$.durationUnit,s=yield this.$.startOffset,a=this.nextSegment;let o,l=yield*this.getProject().$convertDuration(i,n,ee.Millisecond);const c=[];let d=this;for(;d=d.previousSegment;)c.push(d);for(let u=c.length-1;u>=0;u--){const h=c[u],g=yield et(h.$.startOffset),m=(yield et(h.$.endOffset))-g;l-=m}return l>0?a?o=s+Math.min(l,(yield et(this.$.endOffset))-s):o=s+l:o=s,o}*calculateEndOffsetByMasterTotalDurationAndStartOffset(){const i=yield et(this.event.$.startDate),n=yield et(this.event.$.endDate),s=yield*this.event.calculateProjectedDuration(i,n,ee.Millisecond,{ignoreSegments:!0}),a=yield et(this.$.startOffset);let o=yield et(this.$.endOffset),l=this.nextSegment;return a<=s?o<=s?!l||(yield et(l.$.startOffset))>=s?s:o:s:yield this.$.startOffset}*calculateStartOffsetByEndOffsetAndDuration(){const i=yield this.$.duration,n=yield this.$.durationUnit;return(yield this.$.endOffset)-(yield*this.event.getProject().$convertDuration(i,n,ee.Millisecond))}*calculateEndOffsetByStartOffsetAndDuration(){const i=yield this.$.duration,n=yield this.$.durationUnit;return(yield this.$.startOffset)+(yield*this.event.getProject().$convertDuration(i,n,ee.Millisecond))}*calculateEndDateByMasterStartAndEndOffset(){const i=yield this.event.$.startDate,n=yield this.$.endOffset,s=yield*this.event.calculateProjectedXDateWithDuration(i,!0,n,ee.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?s:yield*this.event.skipNonWorkingTime(s,!1)}*calculateStartDateByMasterStartAndStartOffset(){const i=yield this.event.$.startDate,n=yield this.$.startOffset,s=yield*this.event.calculateProjectedXDateWithDuration(i,!0,n,ee.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?s:yield*this.event.skipNonWorkingTime(s)}*calculateDurationByOffsets(){const i=yield this.$.startOffset,n=yield this.$.endOffset,s=yield this.$.durationUnit;return yield*this.getProject().$convertDuration(n-i,ee.Millisecond,s)}*calculatePercentDone(){let i=0;if(!this.event)return yield Ee;const n=yield this.event.$.segments;if(n){const s=yield this.event.$.percentDone,a=yield this.event.$.duration,o=yield this.event.$.durationUnit;let l=yield*this.getProject().$convertDuration(a,o,ee.Millisecond),c=s*.01*l;for(const d of n){const u=d.startOffset,g=d.endOffset-u;if(d===this)return c>=g?100:c>0?100*c/g:0;c-=g}}return i}*calculateMinPercent(){const i=this.previousSegment;return this.event?i?yield i.$.endPercentDone:0:yield Ee}*calculateMaxPercent(){if(!this.event)return yield Ee;const i=yield this.event.$.duration,n=yield this.event.$.durationUnit;let s=yield*this.getProject().$convertDuration(i,n,ee.Millisecond);const a=yield this.$.startOffset,o=yield this.$.endOffset;return(yield this.$.startPercentDone)+100*(o-a)/s}*calculateProjectedXDateWithDuration(i,n,s,a){return a||(a=yield this.$.durationUnit),yield*this.event.calculateProjectedXDateWithDuration(i,n,s,a,{ignoreSegments:!0})}*calculateProjectedDuration(i,n,s){return s||(s=yield this.$.durationUnit),yield*this.event.calculateProjectedDuration(i,n,s,{ignoreSegments:!0})}*calculateManuallyScheduled(){return this.event?yield this.event.$.manuallyScheduled:yield Ee}}return ar([me({identifierCls:vL})],r.prototype,"dispatcher",void 0),ar([de({persist:!1})],r.prototype,"startOffset",void 0),ar([de({persist:!1})],r.prototype,"endOffset",void 0),ar([me()],r.prototype,"percentDone",void 0),ar([me()],r.prototype,"startPercentDone",void 0),ar([me()],r.prototype,"endPercentDone",void 0),ar([br("startDate")],r.prototype,"writeStartDate",null),ar([ie("startOffset")],r.prototype,"calculateStartOffset",null),ar([ie("endOffset")],r.prototype,"calculateEndOffset",null),ar([ie("percentDone")],r.prototype,"calculatePercentDone",null),ar([ie("startPercentDone")],r.prototype,"calculateMinPercent",null),ar([ie("endPercentDone")],r.prototype,"calculateMaxPercent",null),ar([ie("manuallyScheduled")],r.prototype,"calculateManuallyScheduled",null),r}){},Es=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},xs=Symbol("SegmentsVar"),yL=(e,r,t)=>t.processSegmentsValue(e),pb=Ze.new({output:De,inputs:new Set([we,xs])}),vb=Ze.new({output:we,inputs:new Set([De,xs])}),rj=Ze.new({output:Re,inputs:new Set([De,we,xs])}),tT=tn.new({variables:new Set([De,we,Re,xs]),formulas:new Set([vb,pb,qt,Kt,Xt])}),bL=Pt.new({description:tT,defaultResolutionFormulas:new Set([Kt,vb])}),CL=Pt.new({description:tT,defaultResolutionFormulas:new Set([qt,pb])}),SL=class extends yr.mix(Mr){equality(e,r){const t=e.resolution,i=r.resolution;return t.get(De)===i.get(De)&&t.get(we)===i.get(we)&&t.get(Re)===i.get(Re)&&t.get(xs)===i.get(xs)}};function DL(e,r){return!e&&!r?!0:this._skipSegmentsIsEqual||!e&&r||e&&!r||e.length!==r.length?!1:e.every((t,i)=>wL(t,r[i]))}var wL=(e,r)=>{if(e===r)return!0;const i=(e.isModel?e:r).fieldMap,n=e.startDate instanceof Date?e.startDate.getTime():i.startDate.convert(e.startDate).getTime(),s=r.startDate instanceof Date?r.startDate.getTime():i.startDate.convert(r.startDate).getTime(),a=e.endDate instanceof Date?e.endDate.getTime():i.endDate.convert(e.endDate).getTime(),o=r.endDate instanceof Date?r.endDate.getTime():i.endDate.convert(r.endDate).getTime();return n===s&&a===o},EL=class extends G([eg,ub],e=>{class r extends e{constructor(){super(...arguments),this._segmentGeneration={}}static get $name(){return"SplitEventMixin"}construct(){this.segmentModelClass=this.getDefaultSegmentModelClass(),super.construct(...arguments)}get rawModifications(){let i=super.rawModifications;if(this.segments&&(!i||!("segments"in i))){for(const n of this.segments)if(n.rawModifications){i=i||{},i.segments=this.getFieldPersistentValue("segments");break}}return i}clearChanges(i,n,s){for(const a of this.segments||[])a.clearChanges(i,n,null);super.clearChanges(i,n,s)}getDefaultSegmentModelClass(){return mb}*prepareDispatcher(i){const n=yield*super.prepareDispatcher(i);return(yield*this.hasSegmentChangesProposed())&&n.addProposedValueFlag(xs),n}cycleResolutionContext(i){const n=i(this.$.effectiveDirection);return n.direction===ae.Forward||n.direction===ae.None?bL:CL}*hasSegmentChangesProposed(){const i=yield H0(this.$.segments);let n=!1;(yield vr(this.$.segments))&&(n=!!i);const s=yield et(this.$.segments);if(!s)return!1;for(const a of s){const o=yield vr(a.$.startDate),l=yield vr(a.$.endDate),c=yield vr(a.$.duration);(o||l||c)&&(n=!0)}return n}writeSegments(i,n,s,a){var o;const l=(o=n.getLatestEntryFor(i))==null?void 0:o.getValue(),c=l!==xe?l!=null?l:[]:[],d=new Set(c),u=a!=null?a:[],h=new Set(u);this.project.ion({commitFinalized:()=>f.removeEntities(c.filter(m=>!h.has(m))),once:!0}),i.constructor.prototype.write.call(this,i,n,s,a),this.$.isSegmented.write.call(this,this.$.isSegmented,n,null,!!(a!=null&&a.length));const g=this.project,f=g.replica;for(const m of u)!d.has(m)&&m.graph!==f&&(m.setProject(g),f.addEntity(m))}*doWriteSegments(i,n){if(n=n||[],i.length<=1){const s=i.length?yield*this.getProject().$convertDuration(i[0].endOffset-i[0].startOffset,ee.Millisecond,yield this.$.durationUnit):0;n.push({identifier:this.$.duration,proposedArgs:[s,null]}),i=null}n.push({identifier:this.$.segments,proposedArgs:[i]}),yield $0(n)}*calculateSegments(){const i=yield this.$.dispatcher,{graph:n,project:s}=this,a=yield Ph(this.$.segments);let o=yield Ee;const l=[];let c=!1;if(o){const d=new Set;let u=null,h=!1;const{baseRevision:g}=n.$activeTransaction;for(const f of o){const m=yield f.$.startOffset,p=yield f.$.endOffset,v=g.hasIdentifier(f.$.startDate)&&(yield fs(f.$.startDate)),y=g.hasIdentifier(f.$.endDate)&&(yield fs(f.$.endDate));if(h=h||(v==null?void 0:v[0])||(y==null?void 0:y[0]),m===p)l.push(f);else if(u&&m<=u.endOffset){const C=u.endOffset;if(l.push(f),u.graph){l.push(u);const D=u.startOffset,S=h?p+C-m:Math.max(p,C),x=u.cls;u=this.segmentModelClass.new({event:this,cls:x,startOffset:D,endOffset:S})}else u.endOffset=h?p+u.endOffset-m:Math.max(p,u.endOffset)}else u&&d.add(u),u=f}u&&d.add(u),d.size===1&&l.push(...d),c=l.length>0,c&&(o=Array.from(d)),o.reduce((f,m,p)=>(f&&(f.nextSegment=m),m.previousSegment=f,m.segmentIndex=p,m),null),o.length&&(o[o.length-1].nextSegment=null)}else a&&l.push(...a);return l.length&&(l.forEach(d=>d.event=null),s.ion({commitFinalized:()=>n.removeEntities(l),once:!0})),c&&(yield*this.doWriteSegments(o)),o=(o==null?void 0:o.length)>1?o:null,o}*calculateAdjustedSegments(){const i=yield this.$.dispatcher;let n=yield this.$.segments;const s=yield this.$.startDate,a=yield this.$.endDate,o=yield this.$.duration;let l=yield Ee;if(n){const c=this.project,d=this.graph,u=[],h=[];let g=-1;for(let p=n.length-1;p>=0;p--){const v=n[p],y=yield v.$.startDate,C=yield v.$.endDate;if(y>a)u.push(v),g=p;else{if(C.getTime()!==a.getTime()){const D=v.endOffset+(a.getTime()-C.getTime())-v.startOffset,S=yield*c.$convertDuration(D,ee.Millisecond,yield v.$.durationUnit);h.push({identifier:v.$.duration,proposedArgs:[S,null]},{identifier:v.$.endDate,proposedArgs:[a,!1]},{identifier:v.$.endOffset,proposedArgs:[v.endOffset+(a.getTime()-C.getTime())]})}break}}let f=!1;g>-1&&(f=!0,n.splice(g),n.length&&(n[n.length-1].nextSegment=null),c.ion({commitFinalized:()=>d.removeEntities(u),once:!0}));let m="";n&&(m=this.getSegmentsSnapshot(n)),m!==this._lastSegmentsSnapshot&&(f=!0,n=n&&n.slice(),this._lastSegmentsSnapshot=m),f&&(yield*this.doWriteSegments(n,h))}return l}getSegmentsSnapshot(i){return i=i||this.segments,i==null?void 0:i.map(n=>{var s,a;return""+n.startOffset+"-"+((s=n.startDate)==null?void 0:s.getTime())+"-"+n.endOffset+"-"+((a=n.endDate)==null?void 0:a.getTime())}).join(";")}processSegmentsValue(i){let n=i;if(i)for(let s=0;s<i.length;s++){const a=i[s],o=a.isModel?a:this.segmentModelClass.new(a);o.event||(o.event=this),i[s]=o}return n}*calculateStartDate(){const n=(yield this.$.dispatcher).resolution.get(De);let s;return n===pb.formulaId?s=yield*this.calculateStartDateBySegments():s=yield*super.calculateStartDate(),s}*calculateStartDateBySegments(){const i=yield this.$.dispatcher,n=yield this.$.segments,s=yield this.$.endDate;let a;if(n){const l=yield n[n.length-1].$.endOffset,c=yield*this.calculateProjectedXDateWithDuration(s,!1,l,ee.Millisecond,{ignoreSegments:!0});a=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?c:yield*this.skipNonWorkingTime(c,!0)}return a}*calculateEndDateBySegments(){const i=yield this.$.dispatcher,n=yield this.$.segments,s=yield this.$.startDate;let a;if(n){const l=yield n[n.length-1].$.endOffset,c=yield*this.calculateProjectedXDateWithDuration(s,!0,l,ee.Millisecond,{ignoreSegments:!0});a=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?c:yield*this.skipNonWorkingTime(c,!1)}return a}*calculateEndDate(){const n=(yield this.$.dispatcher).resolution.get(we);let s;return n===vb.formulaId?s=yield*this.calculateEndDateBySegments():s=yield*super.calculateEndDate(),s}*calculateDurationProposed(){let i;return(yield*this.hasSegmentChangesProposed())?i=yield*this.calculateDurationBySegments():i=yield*super.calculateDurationProposed(),i}*skipNonWorkingTime(i,n=!0,s){return i?(s=Object.assign({ignoreSegments:!0},s),yield*super.skipNonWorkingTime(i,n,s)):null}*calculateDurationBySegments(){let i;const n=yield this.$.dispatcher,s=yield this.$.durationUnit,a=yield this.$.segments;if(a){let o=0;for(const l of a)o+=l.endOffset-l.startOffset;i=yield*this.getProject().$convertDuration(o,ee.Millisecond,s)}return i}*forEachAvailabilityInterval(i,n){const s=yield this.$.effectiveCalendar,a=yield this.$.assignmentsByCalendar,o=yield this.$.effectiveCalendarsCombination,l=i.isForward!==!1,c=(yield this.$.ignoreResourceCalendar)||i.ignoreResourceCalendar||!a.size,d=this.getProject().maxCalendarRange;let u=i.ignoreSegments,h=1,g,f,m,p,v;u||(p=yield this.$.segments,u=u||!p,u||(p=p.slice(),l?(g=p.shift(),f=0,h=1,v=g.nextSegment?g.endOffset:He.getTime()):(g=p.pop(),f=g.endOffset,h=-1,v=g.endOffset),m=v-g.startOffset));const y=yield this.$.manuallyScheduled,C=this.getProject();return o.forEachAvailabilityInterval(Object.assign({maxRange:d},i),(D,S,x)=>{const R=x.getCalendarsWorkStatus(),I=x.getCalendarsWorking();if(R.get(s)&&(c||I.some(M=>a.has(M))||y&&!C.skipNonWorkingTimeInDurationWhenSchedulingManually)){if(u)return n(D,S,x);{const M=D.getTime();let P=S.getTime()-D.getTime();if(this.getProject().adjustDurationToDST){const z=D.getTimezoneOffset()-S.getTimezoneOffset();P+=z*60*1e3}let _,A;for(l?(_=f,A=f+P):(_=f-P,A=f);g&&_<=v&&A>g.startOffset;){const z=Math.max(_,g.startOffset),Y=Math.min(A,v),V=new Date(M+z-_),U=new Date(M+Y-_);if(n(V,U,x)===!1)return!1;if(m-=U.getTime()-V.getTime(),!m)g=l?p.shift():p.pop(),g&&(v=!l||g.nextSegment?g.endOffset:He.getTime(),m=v-g.startOffset);else break}f+=h*P}}})}*useEventAvailabilityIterator(){return(yield this.$.isSegmented)?!0:!(yield this.$.manuallyScheduled)}getSegmentByDate(i,n){if(n=n||this.getSegments(),n){const s=this.getSegmentIndexByDate(i,n);return n[s]}}getSegmentIndexByDate(i,n){return n=n||this.getSegments(),n?n.findIndex(s=>i>=s.startDate&&i<s.endDate):-1}get firstSegment(){const i=this.getSegments();return i?i[0]:null}get lastSegment(){const i=this.getSegments();return i?i[i.length-1]:null}getSegment(i){const n=this.getSegments();return n==null?void 0:n[i]}async splitToSegments(i,n=1,s){var a;const o=this.getProject();await o.commitAsync();const l=this;if(!i||l.isHasSubEventsMixin&&((a=l.childEvents)!=null&&a.size))return;const c=l.duration,d=l.durationUnit,u=l.startDate,h=l.endDate;if(s=s?b.normalizeUnit(s):d,!u||!h||u>=i||i>=h||!c)return;const g=l.isSegmented;let f=l.segments||[],m,p;if(g&&(p=l.getSegmentIndexByDate(i,f),m=f[p],!m))return;const v=m||l,y=m?v.startDate:u,C=v.duration,D=v.durationUnit,S=l.run("calculateProjectedDuration",y,i,D,{ignoreSegments:!0}),x=C-S,R=o.run("$convertDuration",n,s,ee.Millisecond),I=R+l.run("calculateProjectedDuration",u,i,ee.Millisecond,{ignoreSegments:!0});if(m){m.duration=S;const M=this.segmentModelClass.new({duration:x,durationUnit:D,startOffset:I});f=f.slice(0),f.splice(p+1,0,M),l.segments=f,l.duration=c;for(let P=p+2,_=f.length;P<_;P++){const A=f[P];A&&(A.startOffset+=R,A.endOffset+=R)}}else{const M=this.segmentModelClass.new({duration:S,durationUnit:D,startOffset:0}),P=this.segmentModelClass.new({duration:c-S,durationUnit:D,startOffset:I});l.duration=c,l.segments=[M,P]}return o.commitAsync()}async mergeSegments(i,n){if(this.isSegmented){if(i=i||this.firstSegment,n=n||this.lastSegment,i.startOffset>n.startOffset){let s=n;n=i,i=s}return i.endDate=n.startDate,this.getProject().commitAsync()}}storeFieldChange(i,n){if(i==="segments"&&n){const s=[];for(const a of n){const o=a.toJSON();(!this._segmentGeneration[a.internalId]||a.generation>this._segmentGeneration[a.internalId])&&Object.assign(o,a.meta.modified),s.push(o),this._segmentGeneration[a.internalId]=a.generation}n=s}super.storeFieldChange(i,n)}leaveProject(){const i=this.segments;i&&this.graph.removeEntities(i),super.leaveProject()}endBatch(...i){this.fieldMap.segments._skipSegmentsIsEqual++,super.endBatch(...i),this.fieldMap.segments._skipSegmentsIsEqual--}copy(i=null,n=null){const s=super.copy(i,n);return s.data.segments=void 0,s.segments&&(s.segments=s.segments.map(a=>Object.assign(a.copy(),{event:s}))),s}}return Es([me({identifierCls:SL})],r.prototype,"dispatcher",void 0),Es([de({type:"array",isEqual:DL,convert:yL,_skipSegmentsIsEqual:0})],r.prototype,"segments",void 0),Es([me()],r.prototype,"adjustedSegments",void 0),Es([me()],r.prototype,"isSegmented",void 0),Es([br("segments")],r.prototype,"writeSegments",null),Es([ie("segments")],r.prototype,"calculateSegments",null),Es([ie("adjustedSegments")],r.prototype,"calculateAdjustedSegments",null),r}){},tg=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},rg=class extends G([eg,yi],e=>{const r=e.prototype;class t extends e{getEffort(n){const s=this.effort;return n?this.getProject().convertDuration(s,this.effortUnit,n):s}writeEffort(n,s,a,o,l){o<0&&(o=0),!(!s.baseRevision.hasIdentifier(n)&&o==null)&&(l!=null&&l!==this.effortUnit&&this.$.effortUnit.write.call(this,this.$.effortUnit,s,null,l),n.constructor.prototype.write(n,s,a,o))}setEffortUnit(n){throw new Error("Use `setEffort` instead")}*shouldRollupChildEffort(n){return!0}*calculateTotalChildrenEffort(){const n=yield this.$.childEvents,s=this.getProject();let a=0;for(const o of n){if(!(yield*this.shouldRollupChildEffort(o)))continue;const l=yield o.$.effortUnit;a+=yield*s.$convertDuration(yield o.$.effort,l,ee.Millisecond)}return yield*s.$convertDuration(a,ee.Millisecond,yield this.$.effortUnit)}*calculateEffort(){if((yield this.$.childEvents).size>0)return yield*this.calculateTotalChildrenEffort();{const s=yield Ee;return s!==void 0?s:yield*this.calculateEffortPure()}}*calculateEffortPure(){return(yield this.$.childEvents).size>0?yield*this.calculateTotalChildrenEffort():yield*this.calculateProjectedEffort(yield this.$.startDate,yield this.$.endDate)}*calculateEffortProposed(){return yield Ee}*calculateAssignmentUnits(n){return yield*this.calculateAssignmentUnitsProposed(n)}*calculateAssignmentUnitsPure(n){return yield*this.calculateUnitsByStartEndAndEffort(n)}*calculateAssignmentUnitsProposed(n){return yield Ee}*getBaseOptionsForEffortCalculations(){return{ignoreResourceCalendar:!1}}*calculateProjectedEffort(n,s,a){if(n==null||s==null||n>s)return null;a||(a=yield this.$.assignmentsByCalendar);const o=new Map;for(const[d,u]of a){let h=0;for(const g of u)h+=yield g.$.units;o.set(d,h)}let l=0;const c=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:n,endDate:s});return o.size===0&&(o.set(yield this.$.effectiveCalendar,100),c.ignoreResourceCalendar=!0),yield*this.forEachAvailabilityInterval(c,(d,u,h)=>{const g=h.getCalendarsWorking(),f=d.getTime(),m=u.getTime(),p=m-f;let v=0;for(const y of g)v+=o.get(y)||0;l+=v*p*.01}),yield*this.getProject().$convertDuration(l,ee.Millisecond,yield this.$.effortUnit)}*calculateUnitsByStartEndAndEffort(n){const s=yield this.$.effort,a=yield this.$.effortUnit,o=yield*this.getProject().$convertDuration(s,a,ee.Millisecond);let l=0;const c=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:yield this.$.startDate,endDate:yield this.$.endDate}),d=yield this.$.assignmentsByCalendar;return yield*this.forEachAvailabilityInterval(c,(u,h,g)=>{const f=g.getCalendarsWorking(),m=u.getTime(),p=h.getTime(),v=p-m;for(const y of f)l+=(d.has(y)?d.get(y).length:0)*v}),l?100*o/l:100}*calculateProjectedXDateByEffort(n,s=!0,a,o){a=a!==void 0?a:yield this.$.effort,o=o!==void 0?o:yield this.$.effortUnit;const l=yield*this.getProject().$convertDuration(a,o,ee.Millisecond);if(n==null||a==null)return null;let c=n.getTime(),d=l;if(d===0)return new Date(c);const u=yield this.$.effectiveCalendar,h=yield this.$.assignmentsByCalendar,g=new Map;let f=!1;for(const[m,p]of h){let v=0;for(const y of p)v+=yield y.$.units;g.set(m,v),v>0&&(f=!0)}if(f&&(yield*this.useEventAvailabilityIterator())){const m=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),s?{startDate:n,isForward:s}:{endDate:n,isForward:s});return yield*this.forEachAvailabilityInterval(m,(p,v,y)=>{const C=y.getCalendarsWorking(),D=p.getTime(),S=v.getTime(),x=S-D;let R=0;for(const M of C)R+=g.get(M)||0;const I=R*x*.01;if(I>=d)return c=s?D+d/(.01*R):S-d/(.01*R),!1;d-=I}),new Date(c)}else return u.accumulateWorkingTime(n,l,s).finalDate}}return tg([de({type:"number"})],t.prototype,"effort",void 0),tg([de({type:"string",defaultValue:ee.Hour},{converter:i=>b.normalizeUnit(i)||ee.Hour})],t.prototype,"effortUnit",void 0),tg([br("effort")],t.prototype,"writeEffort",null),tg([ie("effort")],t.prototype,"calculateEffort",null),t}){},pt=Symbol("EffortVar"),vt=Symbol("UnitsVar"),bi=Ze.new({output:pt,inputs:new Set([De,we,vt])}),dn=Ze.new({output:vt,inputs:new Set([De,we,pt])}),un=Ze.new({output:we,inputs:new Set([De,pt,vt])}),hn=Ze.new({output:De,inputs:new Set([we,pt,vt])}),rT=class extends Jy{},iT=class extends Qy{equality(e,r){const t=e.resolution,i=r.resolution;return(e!==xe||r===xe)&&(e===xe||r!==xe)&&t.get(pt)===i.get(pt)&&t.get(vt)===i.get(vt)&&super.equality(e,r)}},Rs=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Yc=class extends G([rg],e=>{const r=e.prototype;class t extends e{*calculateSchedulingMode(){return(yield Ee)||Oe.Normal}*effectiveSchedulingMode(){return(yield this.$.assignmentsByCalendar).size>0?yield this.$.schedulingMode:Oe.Normal}effectiveSchedulingModeSync(n){return n(this.$.assignmentsByCalendar).size>0?n(this.$.schedulingMode):Oe.Normal}*prepareDispatcher(n){if((yield*this.effectiveSchedulingMode())!==Oe.Normal){const a=yield*r.prepareDispatcher.call(this,n);return a.collectInfo(n,this.$.effort,pt),(yield*this.hasProposedValueForUnits())&&a.addProposedValueFlag(vt),a.addPreviousValueFlag(vt),a}else return yield*r.prepareDispatcher.call(this,n)}dispatcherClass(n){return this.effectiveSchedulingModeSync(n)!==Oe.Normal?rT:r.dispatcherClass.call(this,n)}buildProposedDispatcher(n,s,a){const o=r.buildProposedDispatcher.call(this,n,s,a);return o.addPreviousValueFlag(pt),o.addPreviousValueFlag(vt),o}*calculateAssignmentUnits(n){if((yield*this.effectiveSchedulingMode())!==Oe.Normal){const o=(yield this.$.dispatcher).resolution.get(vt);if(o===Ft)return yield*this.calculateAssignmentUnitsProposed(n);if(o===dn.formulaId)return yield*this.calculateAssignmentUnitsPure(n);throw new Error("Unknown formula for `units`")}else return yield*r.calculateAssignmentUnits.call(this,n)}*calculateEffort(){if((yield*this.effectiveSchedulingMode())!==Oe.Normal){const a=(yield this.$.dispatcher).resolution.get(pt);if(a===Ft)return yield*this.calculateEffortProposed();if(a===bi.formulaId)return yield*this.calculateEffortPure();throw new Error("Unknown formula for `effort`")}else return yield*r.calculateEffort.call(this)}*calculateStartDate(){return(yield*this.effectiveSchedulingMode())!==Oe.Normal?(yield this.$.dispatcher).resolution.get(De)===hn.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.endDate,!1):yield*r.calculateStartDate.call(this):yield*r.calculateStartDate.call(this)}*calculateEndDate(){return(yield*this.effectiveSchedulingMode())!==Oe.Normal?(yield this.$.dispatcher).resolution.get(we)===un.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.startDate,!0):yield*r.calculateEndDate.call(this):yield*r.calculateEndDate.call(this)}*calculateEffectiveDuration(){const n=yield this.$.dispatcher,s=yield*this.effectiveSchedulingMode(),a=n.resolution.get(Re),o=n.resolution.get(pt);let l;if(a===Xt.formulaId&&s!=Oe.Normal){const c=yield et(this.$.startDate),d=yield et(this.$.endDate),u=n.resolution.get(De),h=n.resolution.get(we),g=yield this.$.effortDriven;d&&u===hn.formulaId?l=yield*this.calculateProjectedDuration(yield*this.calculateProjectedXDateByEffort(d,!1),d):c&&h===un.formulaId?l=yield*this.calculateProjectedDuration(c,yield*this.calculateProjectedXDateByEffort(c,!0)):(c&&d||!c&&!d)&&(l=yield*r.calculateEffectiveDuration.call(this))}else l=yield*r.calculateEffectiveDuration.call(this);return l}}return Rs([de({type:"boolean",defaultValue:!1})],t.prototype,"effortDriven",void 0),Rs([de({type:"string",defaultValue:Oe.Normal},{sync:!0})],t.prototype,"schedulingMode",void 0),Rs([me({identifierCls:iT})],t.prototype,"dispatcher",void 0),Rs([ie("schedulingMode")],t.prototype,"calculateSchedulingMode",null),Rs([ie("effort")],t.prototype,"calculateEffort",null),Rs([ie("startDate")],t.prototype,"calculateStartDate",null),Rs([ie("endDate")],t.prototype,"calculateEndDate",null),t}){},yb=tn.new({variables:new Set([De,we,Re,pt,vt]),formulas:new Set([qt,Kt,Xt,dn,bi])}),bb=tn.new({variables:new Set([De,we,Re,pt,vt]),formulas:new Set([qt,Kt,Xt,dn])}),nT=Pt.new({description:yb,defaultResolutionFormulas:new Set([Kt,bi])}),sT=Pt.new({description:bb,defaultResolutionFormulas:new Set([Kt,dn])}),aT=Pt.new({description:yb,defaultResolutionFormulas:new Set([qt,bi])}),oT=Pt.new({description:bb,defaultResolutionFormulas:new Set([qt,dn])}),lT=class extends G([Yc],e=>{const r=e.prototype;class t extends e{*prepareDispatcher(n){if((yield*this.effectiveSchedulingMode())===Oe.FixedDuration){const a=yield*r.prepareDispatcher.call(this,n),o=yield this.$.effortDriven;return o&&a.addKeepIfPossibleFlag(pt),(yield vr(this.$.assigned))&&(o?a.addProposedValueFlag(pt):a.addProposedValueFlag(vt)),a}else return yield*r.prepareDispatcher.call(this,n)}cycleResolutionContext(n){if(this.effectiveSchedulingModeSync(n)===Oe.FixedDuration){const a=n(this.$.effectiveDirection),o=n(this.$.effortDriven);return a.direction===ae.Forward||a.direction===ae.None?o?sT:nT:o?oT:aT}else return r.cycleResolutionContext.call(this,n)}*getBaseOptionsForDurationCalculations(){return(yield*this.effectiveSchedulingMode())===Oe.FixedDuration?{ignoreResourceCalendar:!0}:yield*r.getBaseOptionsForDurationCalculations.call(this)}}return t}){},ig=class extends G([Yh,sb,ub,eg,rg,Yc,lT,ws,ab,EL],e=>{class r extends e{static get fields(){return[{name:"name",type:"string"}]}}return r}){},qc=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},cT=class extends ac{static get fields(){return[{name:"isWorking",type:"boolean",defaultValue:!0}]}},dT=class extends Pp{static get defaultConfig(){return{modelClass:cT}}},Cb=class extends Ss{get intervalStoreClass(){return dT}};qc([de({type:"boolean",defaultValue:!1})],Cb.prototype,"unspecifiedTimeIsWorking",void 0);var ng=class extends Ke{constructor(){super(...arguments),this.effort=0,this.units=0}},uT=class extends ng{constructor(){super(...arguments),this.inEventTimeSpan=!1}},Sb=class extends ng{constructor(){super(...arguments),this.maxEffort=0,this.isOverallocated=!1,this.isUnderallocated=!1,this.inEventTimeSpan=!1,this.assignments=null,this.assignmentIntervals=null}},sg=class extends Gr.mix(Ke){getDefaultAllocationIntervalClass(){return ng}initialize(e){e=Object.assign({includeInactiveEvents:!1,allocationIntervalClass:this.getDefaultAllocationIntervalClass()},e),super.initialize(e)}};qc([me()],sg.prototype,"includeInactiveEvents",void 0),qc([me()],sg.prototype,"allocation",void 0);var ag=class extends sg{enterGraph(e){super.enterGraph(e)}leaveGraph(e){var r,t;this.eventRangesCalendar&&((r=this.resource)==null||r.getProject().clearCombinationsWith(this.eventRangesCalendar)),super.leaveGraph(e),(t=this.resource)==null||t.entities.delete(this)}getDefaultAllocationIntervalClass(){return Sb}*shouldIncludeAssignmentInAllocation(e){const r=yield e.$.event,t=yield this.$.includeInactiveEvents,i=r&&(yield r.$.inactive),n=r&&(yield r.$.startDate),s=r&&(yield r.$.endDate);return!!(r&&n&&s&&(t||!i))}*calculateAllocation(){var e;const r=[],t=yield this.ticks,i=yield this.$.resource,n=yield this.$.includeInactiveEvents,s=yield i.$.assigned,a=yield i.$.effectiveCalendar,o=new Map,l=[],c=new Map,d=new Map;let u=!1,h,g,f;for(const x of s){if(!(yield*this.shouldIncludeAssignmentInAllocation(x)))continue;yield x.$.units;const R=yield x.$.event,I=yield R.$.ignoreResourceCalendar,M=yield R.$.startDate,P=yield R.$.endDate,_=yield R.$.segments,A=yield R.$.effectiveCalendar;if(u=u||I,_)for(const Y of _){const V=yield Y.$.startDate,U=yield Y.$.endDate;l.push({startDate:V,endDate:U,assignment:x})}else l.push({startDate:M,endDate:P,assignment:x});let z=o.get(A);z||(z=[],o.set(A,z)),c.set(x,new Map),d.set(x,[]),z.push(x)}this.eventRangesCalendar&&((e=this.resource)==null||e.getProject().clearCombinationsWith(this.eventRangesCalendar));const m=this.eventRangesCalendar=new Cb({intervals:l}),p=[t,m,...o.keys()],v=new Map;t.intervalStore.forEach(x=>{const R=Sb.new({tick:x,resource:i});v.set(x,R),r.push(R),c.forEach((I,M)=>{const P=uT.new({tick:x,assignment:M});I.set(x,P),d.get(M).push(P)})});const y=r[0].tick.startDate,C=r[r.length-1].tick.endDate,D={startDate:y,endDate:C,calendars:p,includeNonWorkingIntervals:u},S=C.getTime()-y.getTime();if(S>i.getProject().maxCalendarRange&&(D.maxRange=S),yield*i.forEachAvailabilityInterval(D,(x,R,I)=>{const M=I.getCalendarsWorkStatus();if(M.get(t)){const P=I.intervalsByCalendar.get(t)[0],_=R.getTime()-x.getTime(),A=v.get(P),z=A.assignments||new Set,Y=A.assignmentIntervals||new Map;if(f&&f!==P){const Ce=v.get(f);Ce.isUnderallocated=Ce.isUnderallocated||Ce.effort&&Ce.effort<Ce.maxEffort}f=P,A.assignments||(h=0,g=0);let V=0,U=!1,K,le=0;I.intervalsByCalendar.get(m).forEach(Ce=>{const Me=Ce.assignment,te=Me==null?void 0:Me.event;if(te&&M.get(te.effectiveCalendar)&&(te.ignoreResourceCalendar||M.get(a))){const Ie=Math.max(x.getTime(),Me.event.startDate.getTime()),se=Math.min(R.getTime(),Me.event.endDate.getTime());U=!0,K=se-Ie;const he=c.get(Me).get(P),Pr=K*Me.units/100;he.effort+=Pr,he.units=Me.units,he.inEventTimeSpan=!0,le+=Pr,V+=Me.units,z.add(Me),Y.set(Me,he)}}),A.inEventTimeSpan=A.inEventTimeSpan||U,M.get(a)&&(A.maxEffort+=_),V&&(K?(h+=K*V,g+=K,A.units=h/g):h||(A.units=V)),U&&(A.effort+=le,A.assignments=z,A.assignmentIntervals=Y,A.isOverallocated=A.isOverallocated||A.effort>A.maxEffort||A.units>100,A.isUnderallocated=A.isUnderallocated||le<_||A.units<100)}}),f){const x=v.get(f);x.isUnderallocated=x.isUnderallocated||x.effort&&x.effort<x.maxEffort}return{owner:this,resource:i,total:r,byAssignments:d}}};qc([me()],ag.prototype,"resource",void 0),qc([ie("allocation")],ag.prototype,"calculateAllocation",null);var og=class extends G([qh],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.observers=new Set,this.entities=new Set}addObserver(n){this.graph.addIdentifier(n),this.observers.add(n)}removeObserver(n){this.graph&&this.graph.removeIdentifier(n),this.observers.delete(n)}addEntity(n){this.graph.addEntity(n),this.entities.add(n)}removeEntity(n){this.graph&&this.graph.removeEntity(n),this.entities.delete(n)}leaveGraph(n){const{graph:s}=this;for(const a of this.observers)this.removeObserver(a);for(const a of this.entities)this.removeEntity(a);r.leaveGraph.call(this,n)}*forEachAvailabilityInterval(n,s){const a=this.getProject(),o=yield this.$.effectiveCalendar,l=a.combineCalendars([o].concat(n.calendars||[])),c=a.maxCalendarRange,d=n.includeNonWorkingIntervals;return c&&(n=Object.assign({maxRange:c},n)),l.forEachAvailabilityInterval(n,(u,h,g)=>{const f=g.getCalendarsWorkStatus();if(d||f.get(o))return s(u,h,g)})}}return t}){},Eo=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},lg=class extends G([NR,ws,yi],e=>{const r=e.prototype;class t extends e{construct(n={}){var s;this.eventSegmentModelClass=n.eventSegmentModelClass||this.getDefaultEventSegmentModelClass(),r.construct.call(this,n),this.includeAsapAlapAsConstraints=(s=n.includeAsapAlapAsConstraints)!=null?s:!0,this.resourceAllocationInfoClass||(this.resourceAllocationInfoClass=this.getDefaultResourceAllocationInfoClass())}getDefaultEventStoreClass(){return Bc}getDefaultEventSegmentModelClass(){return mb}getDefaultResourceAllocationInfoClass(){return ag}afterConfigure(){r.afterConfigure.apply(this,arguments),this.dateConstraintIntervalClass=this.dateConstraintIntervalClass||Nc,this.dependencyConstraintIntervalClass=this.dependencyConstraintIntervalClass||Do}getType(){return di.SchedulerPro}getDefaultCycleEffectClass(){return Kc}getDefaultEventModelClass(){return ig}getDefaultDependencyModelClass(){return db}getDefaultAssignmentModelClass(){return Jh}getDefaultResourceModelClass(){return og}async validateDependency(n,s,a,o){let l;return o&&(l=Array.isArray(o)?o:[o]),Ct(n.outgoingDeps).some(d=>d.toEvent===s&&!(l!=null&&l.includes(d)))?ci.DuplicatingDependency:await this.isDependencyCyclic(n,s,a,l)?ci.CyclicDependency:ci.NoError}async isValidDependency(n,s,a,o){return await this.validateDependency(n,s,a,o)===ci.NoError}getDependencyCycleDetectionIdentifiers(n,s){return[s.$.earlyStartDateConstraintIntervals,s.$.earlyEndDateConstraintIntervals]}async isDependencyCyclic(n,s,a,o){const l=this.getDependencyStore().modelClass,c=new l({fromEvent:n,toEvent:s,type:a}),d=this.replica.branch({autoCommit:!1,onComputationCycle:"throw"});o&&(Array.isArray(o)||(o=[o]),o.forEach(u=>d.removeEntity(u))),d.addEntity(c),c.project=this;try{return await Promise.all(this.getDependencyCycleDetectionIdentifiers(n,s).map(u=>d.readAsync(u))),!1}catch(u){if(/cycle/i.test(u))return!0;if(!/conflict/i.test(u))throw u}}async isValidDependencyModel(n,s){return this.isValidDependency(n.fromEvent,n.toEvent,n.type,s)}}return Eo([de({type:"string",defaultValue:rs.ToEvent})],t.prototype,"dependenciesCalendar",void 0),Eo([de({type:"boolean",defaultValue:!0})],t.prototype,"autoCalculatePercentDoneForParentTasks",void 0),Eo([de({type:"boolean",defaultValue:!0})],t.prototype,"addConstraintOnDateSet",void 0),t}){},hT=class extends We(Oc){static get $name(){return"DeactivateDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.active=!1}},Kc=class extends Ds{getInvalidDependencies(){if(!this._invalidDependencies){const e=this.getDependencies();this._invalidDependencies=e.filter(r=>r.fromEvent===r.toEvent||r.fromEvent.contains(r.toEvent)||r.toEvent.contains(r.fromEvent))}return this._invalidDependencies}buildInvalidDependencyResolutions(e){return[this.removeDependencyConflictResolutionClass.new(e),this.deactivateDependencyConflictResolutionClass.new(e)]}matchDependencyBySourceAndTargetEvent(e,r,t){return e.active&&super.matchDependencyBySourceAndTargetEvent(e,r,t)}getResolutions(){if(!this._resolutions){const e=this.getInvalidDependencies(),r=[];for(const t of e)r.push(...this.buildInvalidDependencyResolutions({dependency:t}));e.length||r.push(this.deactivateDependencyCycleEffectResolutionClass.new(),...super.getResolutions()),this._resolutions=r}return this._resolutions}};Eo([pe(hT)],Kc.prototype,"deactivateDependencyCycleEffectResolutionClass",void 0),Eo([pe(lb)],Kc.prototype,"removeDependencyConflictResolutionClass",void 0),Eo([pe(cb)],Kc.prototype,"deactivateDependencyConflictResolutionClass",void 0);var cg=class extends Fe{static get $name(){return"ModelCombo"}static get type(){return"modelcombo"}get value(){const e=super.value;return this.store.getById(e)||e}set value(e){super.value=e}};cg.initClass(),cg._$name="ModelCombo";var dg=class extends cg{static get $name(){return"CalendarField"}static get type(){return"calendarfield"}static get defaultConfig(){return{valueField:"id",displayField:"name",editable:!1,store:null,listItemTpl:e=>e.name||this.L("L{Default calendar}"),displayValueRenderer:(e,r)=>{var t,i;return e=e||((i=(t=r.store)==null?void 0:t.project)==null?void 0:i.effectiveCalendar),(e==null?void 0:e.name)||this.L("L{Default calendar}")}}}get value(){return super.value}set value(e){e&&e.isDefault&&e.isDefault()&&(e=null),super.value=e}};dg.initClass(),dg._$name="CalendarField";var Db=class extends ye.mixin(xt){static get $name(){return"ResourceCalendarColumn"}static get type(){return"resourceCalendar"}static get defaults(){return{field:"calendar",text:"Calendar",editor:{type:dg.type,clearable:!0,allowInvalid:!1}}}attachToProject(e){e&&(this.defaultCalendar=e.defaultCalendar,this.editor.store=e.calendarManagerStore)}attachToResourceStore(e){super.attachToResourceStore(e),e&&e.ion({name:"resourceStore",update:"onResourceUpdate",thisObj:this})}onResourceUpdate({record:e,changes:r}){var t;const i=r[this.field];if(i){if(typeof i.oldValue=="string"&&((t=i.value)==null?void 0:t.id)===i.oldValue)return;this.refreshCell(e)}}renderer({value:e}){if(e!=null&&e.id){const r=this.editor.store.getById(e.id);return(r==null?void 0:r.getValue(this.editor.displayField))||""}else return""}};Z.registerColumnType(Db),Db._$name="ResourceCalendarColumn";var Xc=(e,r)=>{if(e!==r)throw new Error("Store set is prohibited for Scheduler Pro entity!")},At=e=>class extends(e||F){static get $name(){return"PartOfProject"}get taskStore(){return this.eventStore}set taskStore(t){this.eventStore=t}get eventStore(){var t;return(t=this.project)==null?void 0:t.eventStore}get leftProjectEventStore(){const t=this.leftProject;return(t==null?void 0:t.getEventStore())||null}set eventStore(t){Xc(this.eventStore,t)}get dependencyStore(){var t;return(t=this.project)==null?void 0:t.dependencyStore}set dependencyStore(t){Xc(this.dependencyStore,t)}get assignmentStore(){var t;return(t=this.project)==null?void 0:t.assignmentStore}set assignmentStore(t){Xc(this.assignmentStore,t)}get resourceStore(){var t;return(t=this.project)==null?void 0:t.resourceStore}set resourceStore(t){Xc(this.resourceStore,t)}get calendarManagerStore(){var t;return(t=this.project)==null?void 0:t.calendarManagerStore}set calendarManagerStore(t){Xc(this.calendarManagerStore,t)}},Ci=class extends At(ov(Jh.derive(ce))){get event(){const{project:e}=this,r=super.event;return e!=null&&e.isDelayingCalculation?e.eventStore.getById(r):r}set event(e){super.event=e}get resource(){const{project:e}=this;let r=super.resource;return e!=null&&e.isDelayingCalculation&&(r=e.resourceStore.getById(r)),r==null?void 0:r.$original}set resource(e){super.resource=e}get eventResourceKey(){return this.isInActiveTransaction?this.buildEventResourceKey(this.event,this.resource):this.buildEventResourceKey(this.$.event.DATA,this.$.resource.DATA)}};E(Ci,"$name","AssignmentModel"),E(Ci,"isProAssignmentModel",!0),Ci._$name="AssignmentModel";var xo=class extends At(lv(qy.derive(bt))){static get defaultConfig(){return{modelClass:Ci}}};E(xo,"$name","AssignmentStore"),xo._$name="AssignmentStore";var ug=class extends At(ac.derive(ce)){static get $name(){return"CalendarIntervalModel"}};ug._$name="CalendarIntervalModel";var Zc=class extends At(Ss.derive(ce)){static get $name(){return"CalendarModel"}static get fields(){return[{name:"expanded",internal:!0,defaultValue:!0},"ignoreTimeZone"]}toString(){return this.name||""}static get defaultConfig(){return{calendarIntervalModelClass:ug}}};Zc._$name="CalendarModel";var hg=class extends At(Ky.derive(bt)){static get defaultConfig(){return{tree:!0,modelClass:Zc,loadPriority:100,syncPriority:100,storeId:"calendars"}}};hg._$name="CalendarManagerStore";var Ts=class extends At(db.derive(mt)){static get $name(){return"DependencyModel"}static get isProDependencyModel(){return!0}get fromEvent(){var e;return(e=this.project)!=null&&e.isDelayingCalculation?this.project.eventStore.getById(super.fromEvent):super.fromEvent}set fromEvent(e){super.fromEvent=e}get toEvent(){var e;return(e=this.project)!=null&&e.isDelayingCalculation?this.project.eventStore.getById(super.toEvent):super.toEvent}set toEvent(e){super.toEvent=e}};Ts._$name="DependencyModel";var gg=class extends At(cv(Xy.derive(bt))){static get defaultConfig(){return{modelClass:Ts}}};gg._$name="DependencyStore";var fg=e=>class extends e{static get $name(){return"PercentDoneMixin"}get isStarted(){return this.percentDone>0}get isCompleted(){return this.percentDone>=100}get isInProgress(){return this.isStarted&&!this.isCompleted}copy(){const t=super.copy(...arguments);return t.percentDone=0,t.clearChanges(),t}get renderedPercentDone(){const t=typeof this.percentDone=="number"&&!isNaN(this.percentDone)?this.percentDone:0;return this.getFormattedPercentDone(t)}getFormattedPercentDone(t=0){return t<=99?Math.round(t):Math.floor(t)}set renderedPercentDone(t){this.percentDone=t}},mg=class extends mb.derive(St).mixin(Qu,fg){static get $name(){return"EventSegmentModel"}get task(){return this.event}};mg._$name="EventSegmentModel";var Jc=class extends ig.derive(St).mixin(Ju,At,Qu,fg){static get $name(){return"EventModel"}static get fields(){return[{name:"showInTimeline",type:"boolean",defaultValue:!1},"note",{name:"preamble",convert:e=>e?new _e(e):null},{name:"postamble",convert:e=>e?new _e(e):null}]}getDefaultSegmentModelClass(){return mg}updateWrapDate(e,r,t=!0){return r=new _e(r),new Date(e.getTime()+(t?1:-1)*r.milliseconds)}get startDate(){var e;let r;return this.isOccurrence?r=this.get("startDate"):r=(e=this._startDate)!=null?e:super.startDate,this.allDay&&(r=this.constructor.getAllDayStartDate(r)),r}set startDate(e){const r=this;if(r.generation&&r.isParent&&!r.$ignoreChange){const t=b.diff(r.startDate,e);if(t)for(const i of this.children)i.startDate=b.add(i.startDate,t)}r.batching?(r._startDate=e,r.set({startDate:e})):(super.startDate=e,r.preamble&&(r.wrapStartDate=null,r.wrapEndDate=null))}get endDate(){var e;let r;return this.isOccurrence?r=this.get("endDate"):r=(e=this._endDate)!=null?e:super.endDate,this.allDay&&(r=this.constructor.getAllDayEndDate(r)),r}set endDate(e){const r=this;r.batching?(r._endDate=e,r.set({endDate:e})):(super.endDate=e,r.postamble&&(r.wrapStartDate=null,r.wrapEndDate=null))}get fullEffort(){return new _e({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get wrapStartDate(){const e=this,{preamble:r,startDate:t}=e,i=e._wrapStartDate;let n;return i?n=i:r?(n=e.updateWrapDate(t,r,!1),e._wrapStartDate=n):n=t,n}set wrapStartDate(e){this._wrapStartDate=e}get wrapEndDate(){const e=this,{postamble:r,endDate:t}=e,i=e._wrapEndDate;let n;return i?n=i:r?(n=e.updateWrapDate(t,r,!0),e._wrapEndDate=n):n=t,n}set wrapEndDate(e){this._wrapEndDate=e}set(e){const r=typeof e=="object";return(e==="preamble"||r&&"preamble"in e)&&(this.wrapStartDate=null),(e==="postamble"||r&&"postamble"in e)&&(this.wrapEndDate=null),super.set(...arguments)}get outerStartDate(){return this.wrapStartDate}get outerEndDate(){return this.wrapEndDate}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":return!1;case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}get stm(){var e,r;return(r=(e=this.recurringEvent)==null?void 0:e.stm)!=null?r:super.stm}set stm(e){super.stm=e}get assigned(){const{project:e}=this,r=super.assigned;return e!=null&&e.isDelayingCalculation&&!r?e.assignmentStore.storage.findItem("event",this):r}set assigned(e){super.assigned=e}getCurrentConfig(e){const{segments:r}=this,t=super.getCurrentConfig(e);return t&&r&&(t.segments=r.map(i=>i.getCurrentConfig(e))),t}};E(Jc,"isProEventModel",!0),Jc._$name="EventModel";var pg=class extends At(rv(Wu(ev(Jp(Bc.derive(bt)))))){static get defaultConfig(){return{modelClass:Jc}}};E(pg,"$name","EventStore"),pg._$name="EventStore";var wb=class extends hl{get type(){return"EventUpdateAction"}construct(e){let{model:r,newData:t,oldData:i}=e;if(t.segments&&i.segments){i={...i},t={...t};const n=i.segments.slice(),s=t.segments.slice();let a=!1;i.segments.forEach((o,l)=>{const c=t.segments.indexOf(o);c>-1&&(n[l]=s[c]=o,a=!0)}),a&&(i.segments=n,t.segments=s)}return super.construct({model:r,newData:t,oldData:i})}};wb._$name="EventUpdateAction";var Ro=class extends At(Zp(og.derive(zi))){static get $name(){return"ResourceModel"}get assigned(){var e,r;const{project:t}=this;return(e=t==null?void 0:t.assignmentStore.storage._indices)!=null&&e.resource?(r=t.assignmentStore.storage.findItem("resource",this))!=null?r:new Set:super.assigned}set assigned(e){super.assigned=e}};Ro._$name="ResourceModel";var vg=class extends At(Xp(ib.derive(bt))){static get defaultConfig(){return{modelClass:Ro}}};vg._$name="ResourceStore";var Ms=class extends ce{construct(e,...r){this._childrenIndex=new Map,e.origin&&Object.assign(e,this.mapOriginValues(e.origin)),super.construct(e,...r),this.origin&&!this.generatedParent&&this.fillChildren()}mapOriginValues(e){var r,t;const i={};return e.isResourceModel?i.name=e.name:e.isAssignmentModel&&(i.name=(r=e.event)==null?void 0:r.name,i.iconCls=(t=e.event)==null?void 0:t.iconCls),i}fillChildren(){var e;const r=this,{children:t}=r,i=new Set(t),n=[];if((e=r.origin)!=null&&e.isResourceModel){const{assigned:s}=r.origin;for(const a of s)r._childrenIndex.has(a)?i.delete(r._childrenIndex.get(a)):n.push(r.constructor.new({origin:a}))}i.size&&this.removeChild([...i]),n.length&&this.appendChild(n)}afterRemoveChild(e){e.forEach(r=>this._childrenIndex.delete(r.origin))}insertChild(...e){var r;let t=super.insertChild(...e);if(t){const{stores:i}=this;if(Array.isArray(t)||(t=[t]),(r=this.origin)!=null&&r.isResourceModel)for(const n of t)n.origin&&!this._childrenIndex.has(n.origin)&&this._childrenIndex.set(n.origin,n);if(i!=null&&i.length)for(const n of i)for(const s of t)s.traverse(a=>a.origin&&n.setModelByOrigin(a.origin,a))}return t}getChildByOrigin(e){return this._childrenIndex.get(e)}};E(Ms,"$name","ResourceUtilizationModel"),E(Ms,"fields",["name","iconCls"]),Ms.convertEmptyParentToLeaf=!0,Ms.exposeProperties(),Ms._$name="ResourceUtilizationModel";var Qc=class extends ir.derive(bt){static get properties(){return{_modelByOrigin:new Map}}updateProject(e){this.setResourceStore(e==null?void 0:e.resourceStore),this.setAssignmentStore(e==null?void 0:e.assignmentStore),this.setEventStore(e==null?void 0:e.eventStore),this.fillStoreFromProject()}setResourceStore(e){this.detachListeners("resourceStore"),e==null||e.ion({name:"resourceStore",change:this.onResourceStoreDataChanged,thisObj:this})}setEventStore(e){this.detachListeners("eventStore"),e==null||e.ion({name:"eventStore",update:this.onEventUpdate,thisObj:this})}setAssignmentStore(e){this.detachListeners("assignmentStore"),e==null||e.ion({name:"assignmentStore",change:this.onAssignmentsChange,refresh:this.onAssignmentsRefresh,add:this.onAssignmentsAdd,update:this.onAssignmentUpdate,remove:this.onAssignmentsRemove,thisObj:this})}onResourceStoreDataChanged(e){e.isMove&&e.action==="remove"||this.fillStoreFromProject()}onAssignmentsChange(){this.forEach(e=>e.fillChildren())}onAssignmentsRefresh(e){e.action==="batch"&&this.forEach(r=>r.fillChildren())}onAssignmentsAdd({records:e}){e.forEach(r=>{const t=this.getModelByOrigin(r==null?void 0:r.resource);t==null||t.fillChildren()})}onAssignmentUpdate({record:e,changes:r}){if("resource"in r){const t=this.getModelByOrigin(e),i=this.getModelByOrigin(e==null?void 0:e.resource);t&&i&&i.appendChild(t)}}onAssignmentsRemove({records:e}){this.remove(e.map(r=>this.getModelByOrigin(r)))}onEventUpdate({record:e,changes:r}){if("name"in r)for(const t of e.assigned)this.getModelByOrigin(t).set("name",e.name)}fillStoreFromProject(){var e;const r=[];(e=this._project)==null||e.resourceStore.forEach(t=>{t.isSpecialRow||r.push(this.modelClass.new({origin:t}))}),this.removeAll(),this.add(r),this.trigger("fillFromProject")}remove(){const e=super.remove(...arguments);return e==null||e.forEach(r=>{this._modelByOrigin.delete(r.origin)}),e}removeAll(){super.removeAll(...arguments),this._modelByOrigin.clear()}getModelByOrigin(e){return this._modelByOrigin.get(e)}setModelByOrigin(e,r){return this._modelByOrigin.set(e,r)}};E(Qc,"$name","ResourceUtilizationStore"),E(Qc,"configurable",{modelClass:Ms,project:null,tree:!0}),Qc._$name="ResourceUtilizationStore";var xL=(e,r,t)=>e.isSplitEventMixin?new wb({model:e,newData:r,oldData:t}):new hl({model:e,newData:r,oldData:t}),yg=class extends ia{static get defaultConfig(){return{makeModelUpdateAction:xL}}};yg._$name="StateTrackingManager";var To=class extends We(ce){static get $name(){return"VersionModel"}onBeforeSave(){}get description(){var e;return(e=this.name)!=null?e:this.defaultDescription}get defaultDescription(){return`${this.isAutosave?"Auto-saved":"Saved"} at ${b.format(this.savedAt,this.L("L{Versions.versionDateFormat}"))}`}};E(To,"fields",[{name:"name",type:"string"},{name:"isAutosave",type:"boolean"},{name:"content",type:"object"},{name:"savedAt",type:"date"}]),To.exposeProperties(),To._$name="VersionModel";var Mo=class extends re.mixin(At){};E(Mo,"$name","VersionStore"),E(Mo,"configurable",{modelClass:To,storeId:"versions"}),Mo._$name="VersionStore";var Is=class extends We(ce){get description(){var e;return(e=this.get("description"))!=null?e:this.defaultDescription}get actions(){var e;return(e=this.get("actions"))!=null?e:[]}get defaultDescription(){var e,r;if(this.actions.length===0)return this.L("L{Versions.noChanges}");const t=this,i=H.unique(t.actions.map(({actionType:u})=>u.startsWith("add")?"add":u.startsWith("remove")?"remove":u.startsWith("update")?"update":u)),n=H.unique(t.actions.map(({entity:u})=>u.type)),s=H.unique(t.actions.map(({entity:u})=>`${u.type}.${u.id}`)).length,a=t.L("L{Versions.transactionDescriptions}"),o=t.L("L{Versions.entityNames}"),l=t.L("L{Versions.entityNamesPlural}"),c=n[0],d=n.length>1;return a[i.length>1?"mixed":i[0]].replace("{n}",s).replace("{entities}",s>1?(e=l[d?"other":c])!=null?e:l.other:(r=o[c])!=null?r:o.other)}};E(Is,"$name","ChangeLogTransactionModel"),E(Is,"fields",[{name:"versionId"},{name:"actions",type:"array"},{name:"occurredAt",type:"date"},{name:"description",type:"string"}]),Is.exposeProperties(),Is._$name="ChangeLogTransactionModel";var Io=class extends re.mixin(At){};E(Io,"$name","ChangeLogStore"),E(Io,"configurable",{modelClass:Is,storeId:"changelogs"}),Io._$name="ChangeLogStore";var Eb=e=>class extends(e||F).mixin(gv){static get configurable(){return{crudLoadValidationWarningPrefix:"Project load response error(s):",crudSyncValidationWarningPrefix:"Project sync response error(s):",trackProjectModelChanges:!1}}construct(...t){const i=this;super.construct(...t),i.addPrioritizedStore(i.calendarManagerStore),i.addPrioritizedStore(i.assignmentStore),i.addPrioritizedStore(i.dependencyStore),i.addPrioritizedStore(i.resourceStore),i.addPrioritizedStore(i.eventStore),i.timeRangeStore&&i.addPrioritizedStore(i.timeRangeStore),i.resourceTimeRangeStore&&i.addPrioritizedStore(i.resourceTimeRangeStore)}get project(){return this}set project(t){super.project=t}get crudLoadValidationMandatoryStores(){return[this.getStoreDescriptor(this.eventStore).storeId]}loadCrudManagerData(...t){this.delayCalculation&&!this.isDelayingCalculation&&!this.usingSyncDataOnLoad()&&this.scheduleDelayedCalculation(),super.loadCrudManagerData(...t)}acceptChanges(){super.acceptChanges(),this.clearChanges(!0,!1)}revertChanges(){this.revertCrudStoreChanges(),this.set(this.meta.modified,void 0,!0)}crudStoreHasChanges(t){const i=this.getCrudStore(t);let n;return i?n=super.crudStoreHasChanges(i):n=this.hasPersistableChanges||super.crudStoreHasChanges(),n}get changes(){let t=super.changes;if(this.trackProjectModelChanges){const i=this.modificationDataToWrite;i&&(t=t||{},t.project=i)}return t}shouldClearRecordFieldChange(t,i,n){return t.isCalendarModel&&i==="intervals"?!t.get("intervals").changes:super.shouldClearRecordFieldChange(...arguments)}},gT=(e,r)=>e<r?-1:e>r?1:0,xb=e=>class extends(e||F){static get configurable(){return{type:null,weights:null,groupBy:null,groupByThisObj:null,layoutFn:null}}get grouped(){return!!this.groupBy}getGroupValue(t){var i;let n;if(t.group!=null)n=t.group;else{const{groupBy:s,weights:a,groupByThisObj:o=this}=this,{eventRecord:l}=t;typeof s=="function"?n=s.call(o,l):(n=l.getValue(s),a&&(n=(i=a[n])!=null?i:1/0)),t.group=n}return n}getEventGroups(t){if(this.grouped){const i=new Set;return t.sort((n,s)=>{const a=this.getGroupValue(n),o=this.getGroupValue(s);return i.add(a),i.add(o),gT(a,o)}),Array.from(i).sort(gT)}else return[]}},Rb=class extends rh.mixin(xb){static get $name(){return"ProHorizontalLayoutStack"}layoutEventsInBands(e,r=!1){return this.getEventGroups(e),super.layoutEventsInBands(e,r)}};Rb._$name="ProHorizontalLayoutStack";var Tb=class extends ih.mixin(xb){static get $name(){return"ProHorizontalLayoutPack"}layoutEventsInBands(e){const r=this.getEventGroups(e),t=r.length||1,i=this.packEventsInBands(e,(n,s,a,o)=>{const l=o/t,c=t===1?0:r.indexOf(n.group),d=c/t;n.height=l,n.top=d+a.start/t+s*l,n.inBandHeight=o,n.inBandTop=a.start+s*o});return e.forEach(n=>{Object.assign(n,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,n.top,n.height,n.eventRecord,n.resourceRecord))}),i}};Tb._$name="ProHorizontalLayoutPack";var RL=0,bg=class extends Vr{static get $name(){return"CalendarHighlightModel"}static generateId(){return++RL}};E(bg,"domIdPrefix","calendarhighlight");var Mb=class extends os{static get $name(){return"CalendarHighlight"}static get configurable(){return{calendar:"event",unhighlightOnDrop:null,collectAvailableResources:null,rangeCls:"b-sch-highlighted-calendar-range",resourceTimeRangeModelClass:bg,inflate:3}}static get pluginConfig(){const e=super.pluginConfig;return e.assign=["highlightEventCalendars","highlightResourceCalendars","unhighlightCalendars"],e}afterConstruct(){super.afterConstruct(),this.client.ion({eventDragStart:"onEventDragStart",eventDragReset:"unhighlightCalendars",eventResizeStart:"onEventResizeStart",eventResizeEnd:"unhighlightCalendars",dragCreateStart:"onDragCreateStart",afterDragCreate:"unhighlightCalendars",thisObj:this})}highlightCalendar(e,r){e=H.asArray(e),r=H.asArray(r),this.calendar==="event"?this.highlightEventCalendars(e,r):this.highlightResourceCalendars(r)}highlightEventCalendars(e,r,t=!0){var i;const n=this,{client:s}=n,{startDate:a,endDate:o}=s;n.disabled||(t&&n.unhighlightCalendars(),e=H.asArray(e),r||(r=e.flatMap(l=>l.$linkedResources)),n.highlight=new Map,r=H.asArray(r),e.forEach(l=>{var c;if(!l.calendar)return;const d=(c=l.calendar)==null?void 0:c.getWorkingTimeRanges(a,o).map(u=>new bg(u));if(d){for(const u of r)n.highlight.set(u,d),s.currentOrientation.refreshEventsForResource(u,!0,!1);r.length>0&&s.currentOrientation.onRenderDone()}}),(i=s.syncSplits)==null||i.call(s,l=>l.highlightEventCalendars(e,r,t)))}highlightResourceCalendars(e,r=!0){var t,i,n;const s=this,{startDate:a,endDate:o,currentOrientation:l}=s.client;if(!s.disabled){r&&s.unhighlightCalendars(),s.highlight=new Map;for(const c of e){const d=(t=c.calendar)==null?void 0:t.getWorkingTimeRanges(a,o).map(u=>new bg(u));d&&(s.highlight.set(c,d),l.refreshEventsForResource(c,!0,!1))}e.length>0&&l.onRenderDone(),(n=(i=s.client).syncSplits)==null||n.call(i,c=>c.highlightResourceCalendars(e,r))}}unhighlightCalendars(){var e,r;const t=this;if(!t.highlight)return;const{currentOrientation:i}=t.client,n=t.highlight.keys();t.highlight=null;for(const s of n)i.refreshEventsForResource(s,!0,!1);i.onRenderDone(),(r=(e=t.client).syncSplits)==null||r.call(e,s=>s.unhighlightCalendars())}onEventDragStart({context:e}){var r,t;if(this.disabled)return;const i=this,{client:n}=i,{eventRecords:s}=e,a=e.availableResources=n.features.eventDrag.constrainDragToResource?[e.resourceRecord]:(t=(r=i.collectAvailableResources)==null?void 0:r.call(i,{scheduler:n,eventRecords:s}))!=null?t:n.resourceStore.records;i.highlightCalendar(s,a)}onEventResizeStart({eventRecord:e,resourceRecord:r}){this.disabled||this.highlightCalendar(e,[r])}onDragCreateStart({eventRecord:e,resourceRecord:r}){this.disabled||this.highlightCalendar(e,[r])}getEventsToRender(e,r){var t;const i=(t=this.highlight)==null?void 0:t.get(e);return i&&r.push(...i),r}onEventDataGenerated(e){const{eventRecord:r}=e;if(r.isCalendarHighlightModel){const{inflate:t}=this;e.fillSize=this.client.isVertical,e.wrapperCls["b-sch-highlighted-calendar-range"]=1,e.children.push({className:"b-sch-event-content",html:r.name,dataset:{taskBarFeature:"content"}}),e.width+=t*2,e.height+=t*2,e.left-=t,e.top-=t,e.eventId=`${this.generateElementId(r)}-resource-${e.resourceRecord.id}`}}updateDisabled(e,r){super.updateDisabled(e,r),e&&this.unhighlightCalendars()}shouldInclude(e){return e.isCalendarHighlightModel}get featureClass(){}};Mb._$name="CalendarHighlight",j.registerFeature(Mb,!1,"SchedulerPro");var Cg=class extends Tr(Ol){static get $name(){return"CellEdit"}async startEditing(e={}){const r=await super.startEditing(e);return r&&await this.startFeatureTransaction(),r}async finishEditing(){var e;const r=await super.finishEditing();return r&&await((e=this.finishFeatureTransaction)==null?void 0:e.call(this)),r}cancelEditing(e=!1,r){this.rejectFeatureTransaction(),super.cancelEditing(e,r)}};Cg._$name="CellEdit",j.registerFeature(Cg,!0,"SchedulerPro");var ed=class extends Tr(Zi){onRequestDragCreate(e){const r=super.onRequestDragCreate(e);return r!==!1&&this.startFeatureTransaction().then(),r}doAfterDependencyDrop(e){const{dependency:r}=e,{taskStore:t,dependencyStore:i}=this.client;r?this.finishFeatureTransaction(()=>{(!t.includes(r.fromEvent)||!t.includes(r.toEvent))&&i.remove(r)}):this.rejectFeatureTransaction(),super.doAfterDependencyDrop(e)}};E(ed,"$name","Dependencies"),ed._$name="Dependencies",j.registerFeature(ed,!0,"SchedulerPro");var Ib=class extends Tr(hh){static get $name(){return"DependencyEdit"}static get configurable(){return{showLagField:!0,editorConfig:{items:{activeField:{type:"checkbox",name:"active",label:"L{Active}"}}}}}async editDependency(e){await super.editDependency(e)&&await this.startFeatureTransaction()}afterSave(){this.finishFeatureTransaction().then(()=>{super.afterSave()})}afterDelete(){this.finishFeatureTransaction().then(()=>{super.afterDelete()})}afterCancel(){this.rejectFeatureTransaction(),super.afterCancel()}};Ib._$name="DependencyEdit",j.registerFeature(Ib,!1);var Pb=class extends Q{static get $name(){return"EventBuffer"}static get configurable(){return{showDuration:!0,tooltipTemplate:{value:null,$config:"nullify"}}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}updateTooltipTemplate(e){var r;const t=this;e?t.tooltip=ve.new({forElement:t.client.timeAxisSubGridElement,forSelector:".b-sch-event-buffer-before,.b-sch-event-buffer-after",align:{align:"b-t",offset:[0,10]},getHtml({activeTarget:i}){const n=t.client.resolveEventRecord(i),s=i.matches(".b-sch-event-buffer-before"),a=s?n.preamble:n.postamble;return t.tooltipTemplate({eventRecord:n,duration:a,before:s})}}):(r=t.tooltip)==null||r.destroy()}onEventDataGenerated({useEventBuffer:e,bufferBeforeWidth:r,bufferAfterWidth:t,eventRecord:i,wrapperChildren:n}){if(this.enabled&&e){const{isHorizontal:s}=this.client,{showDuration:a}=this,{preamble:o,postamble:l}=i,c=s?"width":"height";n.push({className:{"b-sch-event-buffer":1,"b-sch-event-buffer-before":1,"b-buffer-thin":!r},style:`${c}: ${r}px`,children:a&&o?[{tag:"span",className:"b-buffer-label",html:o.toString(!0)}]:void 0},{className:{"b-sch-event-buffer":1,"b-sch-event-buffer-after":1,"b-buffer-thin":!t},style:`${c}: ${t}px`,children:a&&l?[{tag:"span",className:"b-buffer-label",html:l.toString(!0)}]:void 0})}}updateShowDuration(){this.isConfiguring||this.client.refreshWithTransition()}doDisable(e){super.doDisable(e);const{client:r}=this;!r.isConfiguring&&r.isPainted&&(r.element.classList.add("b-eventbuffer-transition"),r.refreshWithTransition(),r.waitForAnimations().then(()=>{r.element.classList.remove("b-eventbuffer-transition")}))}};Pb._$name="EventBuffer",j.registerFeature(Pb,!1,"SchedulerPro");var td=class extends qa{static get $name(){return"EventResize"}render(){const e=this,{client:r}=e;super.render(...arguments),e.dragSelector=e.dragItemSelector=r.eventSelector+":not(.b-sch-event-segment)"}};td._$name="EventResize",j.registerFeature(td,!0,"SchedulerPro");var rd=class extends vc{static get defaultConfig(){return{constrainDragToResource:!0}}static get configurable(){return{capitalizedEventName:"EventSegment"}}static get pluginConfig(){return{chain:["onPaint","isEventElementDraggable"]}}getTriggerParams(e){const{assignmentRecords:r,eventRecords:t,resourceRecord:i,browserEvent:n}=e;return{context:e,eventRecords:t,resourceRecord:i,assignmentRecords:r,event:n}}triggerEventDrag(e,r){this.scheduler.trigger("eventSegmentDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate}))}triggerDragStart(e){this.scheduler.navigator.skipNextClick=!0,this.scheduler.trigger("eventSegmentDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.scheduler.trigger("eventSegmentDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.scheduler.trigger("eventSegmentDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,r){if(this.scheduler.trigger("afterEventSegmentDrop",Object.assign(this.getTriggerParams(e),{valid:r})),!r){const{assignmentStore:t,eventStore:i}=this.client;this.dragData.initialAssignmentsState.find(({resource:s,assignment:a},o)=>{var l;return!t.includes(a)||!i.includes(a.event)||s.id!==((l=this.dragData.assignmentRecords[o])==null?void 0:l.resourceId)})&&this.client.refresh()}}async updateRecords(e){const r=this,{client:t}=r,i=!1;let n;return e.externalDropTarget||(t.eventStore.suspendAutoCommit(),n=await r.updateSegment(t,e,i),t.eventStore.resumeAutoCommit()),t.trigger("eventSegmentDrop",Object.assign(r.getTriggerParams(e),{isCopy:i,event:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),n}async updateSegment(e,r){var t;const i=this,n=e.mode==="vertical",{eventRecords:s,assignmentRecords:a,timeDiff:o}=r;e.suspendRefresh();let l=!1;n&&s.forEach((h,g)=>{const f=r.eventBarEls[g];delete h.instanceMeta(e).hasTemporaryDragElement,f.dataset.transient&&f.remove()});const c=r.eventBarEls.slice(),d=r.eventRecord,u=i.adjustStartDate(r.origStart,o);b.isEqual(d.startDate,u)||(e.endListeningForBatchedUpdates(),i.cancelBatchUpdate(d),d.startDate=u,l=!0,await e.project.commitAsync(),(t=i.endBatchUpdate)==null||t.call(i,d)),e.resumeRefresh(),a.length>0&&(l?(e.fillTicks&&c.forEach(h=>delete h.lastDomConfig),e.refreshWithTransition()):r.valid=!1)}isEventElementDraggable(e,r,t,i){const n=this;return n.disabled||!(r.isEventSegment||r.segments)?!0:!t.closest(n.drag.targetSelector)}buildDragHelperConfig(){const e=super.buildDragHelperConfig();return e.targetSelector=".b-sch-event-segment:not(.b-first)",e}getMinimalDragData(e){const r=this,{client:t}=r,i=r.getElementFromContext(e),n=t.resolveEventRecord(i),s=t.resolveResourceRecord(i),a=t.resolveAssignmentRecord(i);return{eventRecord:n,resourceRecord:s,assignmentRecord:a,eventRecords:[n],assignmentRecords:a?[a]:[]}}beginBatchUpdate(e){e.event.beginBatch(),e.beginBatch()}endBatchUpdate(e){var r;(r=e.event)==null||r.endBatch(),e.endBatch()}cancelBatchUpdate(e){var r;(r=e.event)==null||r.cancelBatch(),e.cancelBatch()}setupProductDragData(e){var r;const t=this,{client:i}=t,n=t.getElementFromContext(e),{eventRecord:s,resourceRecord:a}=t.getMinimalDragData(e),o=[],l=i.getElementsFromEventRecord(s.event,a,!0)[0];if(t.constrainDragToResource&&!a)throw new Error("Resource could not be resolved for event: "+s.id);t.drag.ignoreSamePositionDrop=!i.rtl||s.nextSegment,i.listenToBatchedUpdates||i.beginListeningForBatchedUpdates(),t.beginBatchUpdate(s);const c=(r=t.getDateConstraints)==null?void 0:r.call(t,a,s),d=t.constrainRectangle=t.getConstrainingRectangle(c,a,s),u=k.from(n,i.foregroundCanvas,!0),h=k.from(l,i.foregroundCanvas,!0);return d.translate(-h.x),super.setupConstraints(d,u,i.timeAxisViewModel.snapPixelAmount,!!c.start),o.push(n),{record:s,draggedEntities:[s],dateConstraints:c!=null&&c.start?c:null,eventBarEls:o,mainEventElement:l}}suspendRecordElementRedrawing(){}suspendElementRedrawing(){}getDateConstraints(e,r){let{minDate:t,maxDate:i}=super.getDateConstraints(e,r);return r.previousSegment&&(!t||t<r.previousSegment.endDate)&&(t=r.previousSegment.endDate),r.nextSegment&&(!i||i<r.nextSegment.startDate)&&(i=r.nextSegment.startDate),{start:t,end:i}}get tipId(){return`${this.client.id}-segment-drag-tip`}internalSnapToPosition(e){super.internalSnapToPosition(),this.client.rtl&&!this.dragData.eventRecord.nextSegment&&(e.x=0)}updateDragContext(e,r){var t;super.updateDragContext(...arguments);const{client:i}=this,{dirty:n,eventRecord:s,endDate:a}=this.dragData;if(n&&!s.nextSegment){const{enableEventAnimations:o}=i;i.enableEventAnimations=!1,s.event.set("endDate",a),(t=i.features.eventBuffer)!=null&&t.enabled&&(s.event.wrapEndDate=a),i.enableEventAnimations=o}}};E(rd,"$name","EventSegmentDrag"),rd._$name="EventSegmentDrag",j.registerFeature(rd,!0,"SchedulerPro"),j.registerFeature(rd,!1,"ResourceHistogram");var Po=class extends td{static get pluginConfig(){return{chain:[...super.pluginConfig.chain,"isEventSegmentElementDraggable"]}}render(){super.render(...arguments),this.dragSelector=this.dragItemSelector=".b-sch-event-segment"}isEventSegmentElementDraggable(e,r,t,i){return this.isEventElementDraggable(...arguments)}isEventElementDraggable(e,r,t,i){const n=this,s=r==null?void 0:r.resizable;if(n.disabled||!s||r.isMilestone)return!0;if(r.segments){const a=n.client.scheduledEventName;return r.segments.every((o,l)=>{const c=o.resizable,d=X.getChild(e,`${a}.segments.${l}`);return!c||(c!==!0&&c!=="start"||!n.isOverStartHandle(i,d))&&(c!==!0&&c!=="end"||!n.isOverEndHandle(i,d))})}return super.isEventElementDraggable(...arguments)}get tipId(){return`${this.client.id}-event-segment-resize-tip`}dragStart(e){return this._segmentsSlices=null,this._segmentsSlicesIndex=0,super.dragStart(...arguments)}beginEventRecordBatch(e){super.beginEventRecordBatch(e),e.isEventSegment&&e.event.beginBatch()}triggerBeforeResize(e){const{client:r}=this,t=r.scheduledEventName,i=r.resolveTimeSpanRecord(e.itemElement);return r.trigger(`before${r.capitalizedEventName}SegmentResize`,{[t+"Record"]:i,event:e.event,...this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})})}triggerEventResizeStart(e,r){const{client:t}=this;t.trigger(`${t.scheduledEventName}SegmentResizeStart`,r)}triggerEventResizeEnd(e,r){const{client:t}=this;t.trigger(`${t.scheduledEventName}SegmentResizeEnd`,r)}triggerEventPartialResize(e,r){const{client:t}=this;t.trigger(`${t.scheduledEventName}SegmentPartialResize`,r)}triggerBeforeEventResizeFinalize(e,r){const{client:t}=this;t.trigger(`before${t.capitalizedEventName}SegmentResizeFinalize`,r)}applyDateConstraints(e,r,t){var i,n;let s=(i=t.dateConstraints)==null?void 0:i.start,a=(n=t.dateConstraints)==null?void 0:n.end;if(r.isEventSegment){const{previousSegment:o,nextSegment:l}=r;o&&(s=s?b.max(o.endDate,s):o.endDate),l&&(a=a?b.min(l.startDate,a):l.startDate)}return(s||a)&&(e=b.constrain(e,s,a),t.snappedDate=b.constrain(t.snappedDate,s,a)),e}resizeEventPartiallyInternal(e,r){const{toSet:t}=r;if(super.resizeEventPartiallyInternal(...arguments),e.isEventSegment){const{event:i}=e;if(!e.nextSegment&&t==="endDate")i.set("endDate",r[t]);else if(!e.previousSegment&&t==="startDate")i.set("startDate",r[t]);else{const n=i.fieldMap.segments;n._skipSegmentsIsEqual++,i.set("segments",i.get("segments")),n._skipSegmentsIsEqual--}}}cancelEventRecordBatch(e){super.cancelEventRecordBatch(e),e.isEventSegment&&e.event.cancelBatch()}highlightHandle(){const{overItem:e}=this;e.classList.add("b-resize-handle","b-over-resize-handle")}unHighlightHandle(e=this.overItem){e==null||e.classList.remove("b-resize-handle",this.resizingItemInnerCls,"b-over-resize-handle",this.draggingItemCls)}};E(Po,"$name","EventSegmentResize"),Po._$name="EventSegmentResize",j.registerFeature(Po,!0,"SchedulerPro"),j.registerFeature(Po,!1,"ResourceHistogram");var Ps=class extends Q{onElementMouseOut(e){const r=this,{client:t}=r,{target:i,relatedTarget:n}=e,s=i.closest(t.eventSelector),a=t.resolveTimeSpanRecord(i);a!=null&&a.isEventSegment&&s&&t.hoveredEvents.has(s)&&n&&w.isDescendant(s,n)||this.overridden.onElementMouseOut(...arguments)}getElementsFromEventRecord(e,r){if(e!=null&&e.isEventSegment){const t=this.overridden.getElementsFromEventRecord(e.event,r)[0];return[X.getChild(t,"segments."+e.segmentIndex)]}return this.overridden.getElementsFromEventRecord(...arguments)}resolveEventRecord(e){const r=e instanceof Event?e.target:e,t=r==null?void 0:r.closest(".b-sch-event-segment");let i=this.overridden.resolveEventRecord(e);return i!=null&&i.segments&&t&&(i=i.segments[t.dataset.segment]),i}resolveTaskRecord(e){const r=e==null?void 0:e.closest(".b-sch-event-segment");let t=this.overridden.resolveTaskRecord(e);return t!=null&&t.segments&&r&&(t=t.segments[r.dataset.segment]),t}populateTaskMenu(e){e.eventRecord=e.taskRecord,e.targetElement.closest(e.feature.client.eventSelector)&&this.populateEventMenu(e)}populateEventMenu({eventRecord:e,taskRecord:r,items:t,domEvent:i}){const n=this;if(!n.client.readOnly&&!e.isParent&&!e.milestone){t[`split${r?"Task":"Event"}`]={localeClass:n,text:`L{split${r?"Task":"Event"}}`,icon:"b-icon b-icon-cut",disabled:e.readOnly,weight:650,separator:!0,onItem(a){n.splitEvent(a)}};const s=i.target.closest(".b-sch-event-segment");if(s){const a=n.client.resolveEventRecord(s);t.renameSegment={localeClass:n,text:"L{renameSegment}",icon:"b-icon b-icon-rename",disabled:e.readOnly||a.readOnly,weight:660,onItem(){n.rename(a,s)}}}}}getSplitDate(e){const{eventRecord:r,date:t,timeAxis:i}=e;return i.roundDate(t,r.startDate)}getSplitDuration(e){const{splitDuration:r,minSplitDuration:t,maxSplitDuration:i}=this;if(r!=null&&r.magnitude)return r.magnitude;const{eventRecord:n,tick:s}=e;if(s){const a=this.getSplitDurationUnit(e),{project:o}=n;let l=s.endDate-s.startDate;if(i){const c=o.run("$convertDuration",i.magnitude,i.unit||a,"millisecond");l=Math.min(l,c)}if(t){const c=o.run("$convertDuration",t.magnitude,t.unit||a,"millisecond");l=Math.max(l,c)}return o.run("$convertDuration",l,"millisecond",a)}}getSplitDurationUnit(e){const{splitDuration:r}=this;return(r==null?void 0:r.unit)||e.eventRecord.durationUnit}splitEvent(e){const{client:r}=e.feature,{timeAxis:t}=r;e.date=r.getDateFromXY(e.point,void 0,!1),e.tick=t.getSnappedTickFromDate(e.date),e.timeAxis=t,e.eventRecord.splitToSegments(this.getSplitDate(e),this.getSplitDuration(e),this.getSplitDurationUnit(e))}rename(e,r){const{client:t}=this;new hr({owner:t,appendTo:t.timeAxisSubGridElement,scrollAction:"realign",align:{align:"c-c"},cls:"b-event-segment-renamer",internalListeners:{complete(){t.refresh()},thisObj:this}}).startEdit({target:r,record:e,field:"name"})}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}generateSegmentRenderData(e,r){var t;const{client:i}=this;let n,s;if(i.isGantt){const a=i.currentOrientation,o=a.getTaskBox(e),l={taskRecord:e,task:e,row:r.row,children:[]};o&&Object.assign(l,{isTask:!0,top:o.top,left:o.left,width:o.width,height:o.height}),a.internalPopulateTaskRenderData(l,e),s=l}else s=i.generateRenderData(e,r.resourceRecord,!0);if(s){const a=s.eventColor||r.eventColor,o=w.isNamedColor(a);n={segmentRecord:e,eventContent:s.eventContent||s.taskContent,cls:s.cls||((t=e.cls)==null?void 0:t.clone())||new J,top:r.top,left:s.left-r.left,width:s.width,height:r.height,style:""},a&&!o&&(n.style={"background-color":a},r.eventColor&&r._customColorStyle&&(r.style=r.style.replace(r._customColorStyle,""))),Object.assign(n.cls,{[`b-sch-color-${a}`]:o,"b-sch-color-none":!a,"b-sch-event-segment":!0,"b-first":!e.previousSegment,"b-last":!e.nextSegment},s.cls),w.isNamedColor(a)?n.cls[`b-sch-color-${a}`]=a:a?(n.style=`background-color:${a};`+n.style,n.cls["b-sch-custom-color"]=1):r.wrapperCls["b-sch-color-none"]=1}return n}appendDOMConfig(e){const r=e.eventRecord||e.taskRecord;if(r.segments&&!this.disabled){const t=e.eventContent||e.taskContent,i=e.children.indexOf(t);i>-1&&e.children.splice(i,1),delete e.eventContent,delete e.taskContent,e.cls["b-segmented"]=!0,e.segments=r.segments.map(n=>this.generateSegmentRenderData(n,e)),e.segmentsDOMConfig=e.segments.map(this.getSegmentDOMConfig.bind(this)),e.children.unshift({syncOptions:{syncIdField:"segment",releaseThreshold:0},className:"b-sch-event-segments",dataset:{taskBarFeature:"segments"},children:e.segmentsDOMConfig})}}getSegmentDOMConfig(e,r){return{className:e.cls,style:{style:e.style,left:e.left,height:e.height,width:e.width,...e.style},dataset:{segment:r},syncOptions:{syncIdField:"taskBarFeature"},children:[e.eventContent]}}onEventDataGenerated(e){this.appendDOMConfig(e)}onTaskDataGenerated(e){this.appendDOMConfig(e)}get featureClass(){}};E(Ps,"$name","EventSegments"),E(Ps,"configurable",{splitDuration:0,maxSplitDuration:{magnitude:1,unit:"day"},minSplitDuration:0}),E(Ps,"pluginConfig",{override:["getElementsFromEventRecord","resolveEventRecord","resolveTaskRecord","onElementMouseOut"],chain:["populateTaskMenu","populateEventMenu","onTaskDataGenerated","onEventDataGenerated"]}),Ps._$name="EventSegments",j.registerFeature(Ps,!0,"SchedulerPro"),j.registerFeature(Ps,!0,"Gantt");var TL={border:1,hollow:2},As=class extends Q.mixin(xt,fe){construct(e,r){super.construct(e,r),this.client.eventStore.tree=!0}refreshClient(){!this.client.isConfiguring&&this.client.refreshWithTransition()}doDisable(){this.refreshClient()}updateEventLayout(e){e==="stack"&&this.client.isVertical&&console.warn("Stacked nested events are not supported in vertical mode"),this.refreshClient()}updateBarMargin(){this.refreshClient()}updateResourceMargin(){this.refreshClient()}changeEventHeight(e){return this._eventHeights=H.asArray(e),e}updateEventHeight(){this.refreshClient()}updateHeaderHeight(e){this.client.element.style.setProperty("--schedulerpro-nested-event-header-height",`${e}px`),this.refreshClient()}getEventLayout(e,r){return r?{type:this.eventLayout}:this.overridden.getEventLayout(e)}getResourceMargin(e,r){return r&&!r.isRoot?this.resourceMargin:this.overridden.getResourceMargin(e)}getBarMargin(e,r){return r&&!r.isRoot?this.barMargin:this.overridden.getBarMargin(e)}getAppliedResourceHeight(e,r){var t;const i=this;if(r&&!r.isRoot){if(i.eventLayout==="stack")return i._eventHeights[r.childLevel]+i.resourceMargin*2;{const n=(t=TL[i.client.getEventStyle(r,e)])!=null?t:0;return i.currentParentsHeight-i.headerHeight-n}}return i.overridden.getAppliedResourceHeight(e)}getResourceWidth(e,r){return r&&!r.isRoot?this.currentParentsWidth-this.headerHeight:this.overridden.getResourceWidth(e)}attachToEventStore(e){e==null||e.ion({name:"eventStore",change:"onEventStoreChange",thisObj:this})}onEventStoreChange({records:e}){e!=null&&e.some(r=>r.parent&&!r.parent.isRoot)&&this.refreshClient()}onEventStoreBatchedUpdate({records:e}){if(this.client.listenToBatchedUpdates&&(e!=null&&e.some(r=>r.parent&&!r.parent.isRoot)))return this.refreshClient(),!1}beforeEventDragStart(e,r){const t=this,{client:i}=t,{eventRecord:n,assignmentRecords:s}=r,{parentElement:a}=e.element;if(n.parent&&a!==i.foregroundCanvas){t.isDraggingNestedEvent=!0,e.originalParentElement=a,e.originalBounds=[];for(const o of s){const{event:l}=o;if(l.parent===n.parent){const c=i.getElementFromAssignmentRecord(o,!0);if(e.originalBounds.push({element:c,bounds:k.from(c,a)}),!t.constrainDragToParent&&i.features.eventDrag.constrainDragToTimeline){const d=k.from(c,i.timeAxisSubGridElement);c.style.top=`${d.top}px`,c.style.left=`${d.left}px`,X.addChild(i.foregroundCanvas,c,o.id)}}}}else t.isDraggingNestedEvent=!1}afterEventDragStart(e,r){if(this.isDraggingNestedEvent&&this.constrainDragToParent){const{eventDrag:t}=this.client.features,{parent:i}=r.eventRecord,n=e.originalParentElement.getBoundingClientRect();t.setYConstraint(0,n.height-e.originalBounds[0].bounds.height),t.setXConstraint(0,n.width-e.originalBounds[0].bounds.width),r.dateConstraints={start:i.startDate,end:i.endDate}}}checkEventDragValidity({targetEventRecord:e,eventRecord:r,timeDiff:t,newResource:i,resourceRecord:n}){const s=this;if(s.isDraggingNestedEvent&&!s.allowDeNestingOnDrop&&!e&&(t||i!==n))return{valid:!1,message:s.L("L{deNestingNotAllowed}")};if(!s.allowNestingOnDrop&&e&&e!==r.parent)return{valid:!1,message:s.L("L{nestingNotAllowed}")};if(e&&e!==r.parent){const a=s.maxNesting,o=e.isParent?e.childLevel:e.parent.childLevel,l=Math.max(...r.allChildren.map(d=>d.childLevel)),c=l-r.childLevel;if(o+c>=a)return{valid:!1,message:s.L("L{nestingNotAllowed}")}}}processEventDrop({context:e,toScheduler:r,eventRecord:t,resourceRecord:i,reassignedFrom:n,element:s,eventsToAdd:a,addedEvents:o,draggedAssignment:l}){const{parent:c}=t,{targetEventRecord:d}=e;let u=c;if(c!==d&&!this.constrainDragToParent){if(d&&this.allowNestingOnDrop){u=d.isParent||d.parent.isRoot?d:d.parent;const h=this.client.resolveResourceRecord(e.browserEvent);h!==i&&(i=l.resource=h)}else u=r.eventStore.rootNode;u&&u!==c&&(o.push(u.appendChild(t)),H.remove(a,t))}if(t.isParent&&n&&n!==i)for(const h of t.allChildren){const g=h.assignments.find(f=>f.resource===n);g&&(g.resource=i)}if(u&&!u.isRoot){const h=this.client.getElementFromEventRecord(u,i).syncIdMap.nestedEventsContainer,g=h&&k.from(s,h);h&&(s.style.top=`${g.top}px`,s.style.left=`${g.left}px`,s.lastDomConfig=null,X.addChild(h,s,s.dataset.syncId))}}processCrossSchedulerEventDrop({eventRecord:e}){if(e.isParent)for(const r of e.allChildren)r.resource=e.resource}async afterEventDragAbortFinalized({originalParentElement:e,originalBounds:r}){if(this.isDraggingNestedEvent){for(const t of r[0].element.getAnimations())(t.transitionProperty==="top"||t.transitionProperty==="left")&&await t.finished;for(const{element:t,bounds:i}of r)t.style.top=`${i.top}px`,t.style.left=`${i.left}px`,e.appendChild(t)}}afterEventResizeStart(e){if(this.constrainResizeToParent){const{parent:r}=e.timespanRecord;if(r&&!r.isRoot){let{startDate:t,endDate:i}=r;e.dateConstraints&&(t=b.max(t,e.dateConstraints.start),i=b.min(i,e.dateConstraints.end)),e.dateConstraints={start:t,end:i}}}}getElementFromAssignmentRecord(e,r){var t;if((t=e==null?void 0:e.event)!=null&&t.parent&&!e.event.parent.isRoot){const i=this.client.getElementFromEventRecord(e.event.parent,e.resource);return X.getChild(i,`nestedEventsContainer.${e.id}${r?"":".event"}`)}return this.overridden.getElementFromAssignmentRecord(e,r)}async scheduleEvent({eventRecord:e,parentEventRecord:r,startDate:t,element:i}){if(r){if(e.startDate=t,e=r.appendChild(e),e.assign(r.resource),i){const n=this.client.getElementFromEventRecord(r).syncIdMap.nestedEventsContainer,s=k.from(i,n);w.setTranslateXY(i,0,0),w.setTopLeft(i,s.y,s.x),X.addChild(n,i,e.assignments[0].id)}await this.client.project.commitAsync()}else return this.overridden.scheduleEvent(...arguments)}getEventsToRender(e,r){return this.disabled||H.remove(r,...r.filter(t=>t.isEventModel&&!t.parent.isRoot)),r}afterRenderEvent({renderData:e}){var r;const{eventRecord:t}=e,{childLevel:i}=t;if(t.isParent){const n=this,{resourceRecord:s,width:a,height:o,left:l,top:c,wrapperCls:d}=e;d.add("b-nested-events-parent"),n.currentParentsHeight=o,n.currentParentsWidth=a;const{currentOrientation:u,isVertical:h}=n.client,g=t.children.filter(D=>{var S;return(S=D.$linkedResources)==null?void 0:S.includes(s)}),f=u.layoutEvents(s,g,!1,t,n.overlappingEventSorter),m=[];let p;if(h){p=[];for(const D of Object.values(f))p.push(D.renderData)}else p=f==null?void 0:f.eventsData;if(p)for(const D of p){h?(D.left-=l,D.top-=c,D.absoluteTop=D.top):(n.eventLayout==="none"?(D.top=0,D.height=n.getAppliedResourceHeight(s,t)):n.eventLayout==="stack"&&(D.height=n._eventHeights[i]),D.absoluteLeft=D.left,D.left-=(r=e.absoluteLeft)!=null?r:l,D.absoluteTop=D.top);const S=u.renderEvent(h?{renderData:D}:D,o);S.className["b-nested-event"]=1,m.push(S)}const v={className:{"b-nested-events-container":1,[`b-nested-events-layout-${n.eventLayout}`]:1},dataset:{taskBarFeature:"nestedEventsContainer"},children:m,syncOptions:{syncIdField:"syncId",releaseThreshold:0}},{children:y}=e,C=y.findIndex(D=>D.dataset.taskBarFeature==="nestedEventsContainer");C===-1?y.push(v):y.splice(C,1,v)}e.elementConfig.dataset.level=i}};E(As,"$name","NestedEvents"),E(As,"configurable",{eventLayout:"pack",barMargin:5,resourceMargin:0,eventHeight:30,headerHeight:20,constrainDragToParent:!1,allowNestingOnDrop:!0,allowDeNestingOnDrop:!0,constrainResizeToParent:!0,maxNesting:1}),E(As,"pluginConfig",{before:["onEventStoreBatchedUpdate"],chain:["getEventsToRender","processEventDrop","processCrossSchedulerEventDrop","beforeEventDragStart","afterEventDragStart","afterEventDragAbortFinalized","checkEventDragValidity","afterEventResizeStart","afterRenderEvent"],override:["getResourceMargin","getBarMargin","getAppliedResourceHeight","getResourceWidth","getEventLayout","getElementFromAssignmentRecord","scheduleEvent"]}),E(As,"delayable",{refreshClient:"raf"}),As._$name="NestedEvents",j.registerFeature(As,!1,"SchedulerPro");function _s(e){return`b-task-percent-bar${e[0]?`-${e[0]}`:""}`}var Sg=class extends Tr(Q){static get $name(){return"PercentBar"}static get configurable(){return{allowResize:!0,showPercentage:!0,instantUpdate:!0,valueField:"percentDone",displayField:"renderedPercentDone"}}static get pluginConfig(){return{chain:["onPaint",{fn:"onTaskDataGenerated",prio:-1e4},{fn:"onEventDataGenerated",prio:-1e4}]}}onPaint({firstPaint:e}){if(e){const r=this,{client:t}=r;r.drag=new ki({name:"percentBarHandle",lockX:t.isVertical,lockY:t.isHorizontal,targetSelector:`${t.eventSelector} .b-task-percent-bar-handle`,dragThreshold:1,outerElement:t.timeAxisSubGridElement,internalListeners:{beforeDragStart:"onBeforeDragStart",dragStart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",thisObj:r}}),r.detachListeners("view"),r.client.ion({name:"view",[`${t.scheduledEventName}mouseenter`]:"onTimeSpanMouseEnter",[`${t.scheduledEventName}mouseleave`]:"onTimeSpanMouseLeave",thisObj:r})}}get sizeProp(){return this.client.isVertical?"height":"width"}get offsetSizeProp(){return this.client.isVertical?"offsetHeight":"offsetWidth"}get positionProp(){return this.client.isVertical?"top":this.client.rtl?"right":"left"}get offsetPositionProp(){return this.client.isVertical?"offsetTop":this.client.rtl?"offsetRight":"offsetLeft"}updateAllowResize(e){this.client.element.classList.toggle(_s`drag-disabled`,!e)}updateShowPercentage(e){this.client.element.classList.toggle(_s`show-percentage`,!!e)}doDestroy(){var e;(e=this.drag)==null||e.destroy(),super.doDestroy()}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}reset(e){const r=this,{client:t}=r,{project:i}=t;if(t.element.classList.remove(_s`resizing-task`),r.isMouseInsideEvent||(r.handle.remove(),r.handle=null),t.transactionalFeaturesEnabled)e.valid?r.finishFeatureTransaction():r.rejectFeatureTransaction();else if(r.instantUpdate){const{stm:n}=i;n.disabled||(r._stmTransactionStarted&&(e.valid?n.stopTransaction():n.rejectTransaction()),n.autoRecord=r.oldStmAutoRecord,r._stmTransactionStarted=!1)}r.instantUpdate&&(i.resumeAutoSync(),t.eventStore.resumeAutoCommit())}getPercentBarDOMConfig(e){return{className:_s`outer`,dataset:{taskBarFeature:"percentBar"},children:[{className:_s``,dataset:{percent:e.getValue(this.displayField)},style:{[this.sizeProp]:e.getValue(this.valueField)+"%"}}]}}appendDOMConfig(e,r,t){if((e.isEvent||e.isTask)&&!e.isMilestone&&!this.disabled){const{eventSegments:i}=this.client.features;e.isSegmented&&(i!=null&&i.enabled)?e.segments.forEach((n,s)=>{t.segmentsDOMConfig[s].children.unshift(this.getPercentBarDOMConfig(n))}):r.unshift(this.getPercentBarDOMConfig(e))}}onEventDataGenerated(e){this.appendDOMConfig(e.eventRecord,e.children,e)}onTaskDataGenerated(e){this.appendDOMConfig(e.taskRecord,e.children,e)}getHoverSegment(e){const r=(e.toElement||e.target).closest(".b-sch-event-segment");if(r){const t=k.from(r);if(t!=null&&t.contains(B.getPagePoint(e)))return r}}isOverSegment(e){return!!this.getHoverSegment(e)}onTimeSpanMouseEnter(e){const r=this,{client:t,sizeProp:i}=r,n=e[`${t.scheduledEventName}Record`];if(!(n.isMilestone||n.readOnly||r.disabled||n.isParent||!n.isEditable(r.valueField)))if(r.drag.context)n===r.drag.context.taskRecord&&(r.isMouseInsideEvent=!0);else{const s=e[`${t.scheduledEventName}Element`],a=X.getChild(s,t.scheduledEventName);if(!r.handle){const o={percent:n.getValue(r.valueField)};let l=n.getValue(r.valueField)+"%";const{eventSegments:c}=t.features;if(n.isSegmented&&(c!=null&&c.enabled)){o.segment=0;const d=k.from(a);let u,h;n.segments.some((g,f)=>{if(!g[r.valueField]&&u!==100)return!0;u=g[r.valueField],o.segment=f;const m=X.getChild(a,`segments.${f}.percentBar`).firstChild;h=k.from(m)}),t.isVertical?l=h?h.top+h[i]-d.top:0:t.rtl?l=h?h.right+h[i]-d.right:0:l=h?h.left+h[i]-d.left:0}r.handle=w.createElement({parent:a,className:_s`handle`,style:{[r.positionProp]:l},dataset:o})}r.isMouseInsideEvent=!0}}onTimeSpanMouseLeave(e){const r=this;!r.drag.context&&r.handle&&e.event.toElement!==r.handle&&(r.handle.remove(),r.handle=null),r.isMouseInsideEvent=!1}onBeforeDragStart({source:e,context:r,event:t}){const{client:i,offsetPositionProp:n,offsetSizeProp:s}=this,{eventSegments:a}=i.features,{element:o}=r,l=i.resolveEventRecord(o);let c,d,u,h;if(l.isSegmented&&(a!=null&&a.enabled)){const g=o.dataset.segment;c=X.getChild(o.parentElement,`segments.${g}.percentBar`),d=c.firstElementChild,h=o.parentElement[s],u=X.getChild(o.parentElement,`segments.${g}`)[n]+d[s]}else c=X.getChild(o.parentElement,"percentBar"),d=c.firstElementChild,h=c[s],u=d[s];i.isVertical?(e.minY=-u,e.maxY=h-u):i.rtl?(e.maxX=u,e.minX=-(h-u)):(e.minX=-u,e.maxX=h-u),Object.assign(r,{percentBar:d,initialPos:u,size:h,taskRecord:l,initialValue:l.getValue(this.valueField),domEvent:t})}async onDragStart({context:e,event:r}){const t=this,{client:i}=t,{project:n}=i;i.element.classList.add(_s`resizing-task`),e.element.retainElement=!0,e.domEvent=r,i.trigger("percentBarDragStart",e),i.transactionalFeaturesEnabled?await t.startFeatureTransaction():n.stm.disabled||(this.oldStmAutoRecord=n.stm.autoRecord,n.stm.autoRecord=!1),t.instantUpdate&&(n.suspendAutoSync(),i.eventStore.suspendAutoCommit())}onDrag({context:e,event:r}){const t=this,{sizeProp:i,offsetSizeProp:n,client:s}=t,a=s.isHorizontal?Math.round((e.initialPos+e.newX*(s.rtl?-1:1))/e.size*100):Math.round((e.initialPos+e.newY)/e.size*100),{eventSegments:o}=s.features;if(t.instantUpdate){if(!s.transactionalFeaturesEnabled){const{stm:l}=s.project;!l.disabled&&!l.transaction&&(l.startTransaction(),t._stmTransactionStarted=!0)}e.taskRecord.set(t.valueField,a)}e.domEvent=r,e.percent=e.element.dataset.percent=a,e.taskRecord.isSegmented&&(o!=null&&o.enabled)&&e.taskRecord.segments.forEach((l,c)=>{const d=X.getChild(e.element.parentElement,`segments.${c}.percentBar`).firstChild,u=X.getChild(e.element.parentElement,`segments.${c}`);if(e.percent>=l.endPercentDone)d.style[i]=u[n]+"px";else if(e.percent<=l.startPercentDone)d.style[i]="0";else if(e.percent>=l.startPercentDone&&e.percent<=l.endPercentDone){const h=l.endPercentDone-l.startPercentDone;d.style[i]=(a-l.startPercentDone)*u[n]/h+"px"}}),s.trigger("percentBarDrag",e)}onDragAbort({context:e,event:r}){e.taskRecord.isSegmented&&(e.percentBar.style[this.sizeProp]=e.taskRecord.segments[e.element.dataset.segment][this.valueField]+"%"),e.taskRecord.set(this.valueField,e.initialValue),e.domEvent=r,this.reset(e),this.client.trigger("percentBarDragAbort",e)}onDrop({context:e}){const r=this,{taskRecord:t}=e,{eventSegments:i}=r.client.features;t.set(r.valueField,e.percent),t.isSegmented&&(i!=null&&i.enabled)?t.segments.some((n,s)=>{if(e.percent>=n.startPercentDone&&e.percent<=n.endPercentDone){const a=n.endPercentDone-n.startPercentDone,o=X.getChild(e.element.parentElement,`segments.${s}`),l=parseInt(o.style[r.sizeProp])+(e.percent-n.startPercentDone)*o[r.offsetSizeProp]/a;return e.element.style.cssText=`${r.positionProp}: ${l}px`,e.element.dataset.segment=s,!0}}):e.element.style.cssText=`${r.positionProp}: ${r.client.rtl?100-e.percent:e.percent}%`,r.reset(e),r.client.trigger("percentBarDrop",e)}get featureClass(){}};Sg._$name="PercentBar",j.registerFeature(Sg,!1,"SchedulerPro"),j.registerFeature(Sg,!0,"Gantt");var Ao=class extends os{static get properties(){return{resourceMap:new Map}}construct(){var e;super.construct(...arguments),this.resourceTimeRangeModelClass=(e=class extends this.resourceTimeRangeModelClass{},E(e,"$name","ResourceNonWorkingTimeModel"),E(e,"domIdPrefix","resourcenonworkingtimemodel"),e),this.client.timeAxis.ion({name:"timeAxis",reconfigure:"onTimeAxisReconfigure",prio:100,thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),e==null||e.ion({name:"resourceStore",changePreCommit:"onResourceChange",thisObj:this})}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e),e==null||e.ion({name:"calendarManagerStore",changePreCommit:"onCalendarChange",thisObj:this})}onTimeAxisReconfigure(){this.resourceMap.clear()}onResourceChange({action:e,records:r,record:t,changes:i}){var n;const s=this;if(e==="update"){const a=i.calendar;a&&(typeof a.oldValue!="string"||((n=a.value)==null?void 0:n.id)!==a.oldValue)&&(s.resourceMap.delete(t.id),s.client.runWithTransition(()=>{s.client.currentOrientation.refreshEventsForResource(t)}))}e==="remove"&&r.forEach(a=>s.resourceMap.delete(a.id)),e==="removeall"&&s.resourceMap.clear()}onCalendarChange({action:e,records:r,record:t,changes:i}){this.resourceMap.clear(),this.client.refresh()}getEventsToRender(e,r){const t=this,{resourceMap:i,client:n}=t,{timeAxis:s}=n,a=!t.maxTimeAxisUnit||b.compareUnits(s.unit,t.maxTimeAxisUnit)<=0;if(!t.disabled&&a&&e.effectiveCalendar){if(!i.has(e.id)){const o=e.effectiveCalendar.getNonWorkingTimeRanges(n.startDate,n.endDate),l=o.map((c,d)=>new t.resourceTimeRangeModelClass({id:`r${e.id}i${d}`,iconCls:c.iconCls||e.effectiveCalendar.iconCls||"",cls:`${e.effectiveCalendar.cls||""} ${c.cls||""}`,startDate:c.startDate,endDate:c.endDate,name:c.name||"",resourceId:e.id,isNonWorking:!0}));i.set(e.id,l)}r.push(...i.get(e.id))}return r}shouldInclude({isNonWorking:e}){return e}resolveResourceNonWorkingTimeInterval(e){var r;return(r=e==null?void 0:e.closest(".b-sch-resourcenonworkingtime"))==null?void 0:r.elementData.eventRecord}};E(Ao,"$name","ResourceNonWorkingTime"),E(Ao,"configurable",{rangeCls:"b-sch-resourcenonworkingtime",maxTimeAxisUnit:"hour",enableMouseEvents:!1,resourceTimeRangeModelClass:Vr,entityName:"resourceNonWorkingTime"}),Ao.featureClass="",Ao._$name="ResourceNonWorkingTime",j.registerFeature(Ao,!1,"SchedulerPro");var Ab=e=>class extends(e||Le(F)){get isReadyStatePropagator(){return!0}get canSave(){return!0}requestReadyStateChange(){this.trigger("readystatechange",{canSave:this.canSave})}get widgetClass(){}},ML={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",ConstraintTypePicker:{none:"None",assoonaspossible:"As soon as possible",aslateaspossible:"As late as possible",muststarton:"Must start on",mustfinishon:"Must finish on",startnoearlierthan:"Start no earlier than",startnolaterthan:"Start no later than",finishnoearlierthan:"Finish no earlier than",finishnolaterthan:"Finish no later than"},SchedulingDirectionPicker:{Forward:"Forward",Backward:"Backward",inheritedFrom:"Inherited from",enforcedBy:"Enforced by"},CalendarField:{"Default calendar":"Default calendar"},TaskEditorBase:{Information:"Information",Save:"Save",Cancel:"Cancel",Delete:"Delete",calculateMask:"Calculating...",saveError:"Can't save, please correct errors first",repeatingInfo:"Viewing a repeating event",editRepeating:"Edit"},TaskEdit:{"Edit task":"Edit task",ConfirmDeletionTitle:"Confirm deletion",ConfirmDeletionMessage:"Are you sure you want to delete the event?"},GanttTaskEditor:{editorWidth:"44em"},SchedulerTaskEditor:{editorWidth:"34em"},SchedulerGeneralTab:{labelWidth:"6em",General:"General",Name:"Name",Resources:"Resources","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Preamble:"Preamble",Postamble:"Postamble"},GeneralTab:{labelWidth:"6.5em",General:"General",Name:"Name","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Dates:"Dates"},SchedulerAdvancedTab:{labelWidth:"13em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Inactive:"Inactive","Ignore resource calendar":"Ignore resource calendar"},AdvancedTab:{labelWidth:"11.5em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Constraint:"Constraint",Rollup:"Rollup",Inactive:"Inactive","Ignore resource calendar":"Ignore resource calendar","Scheduling direction":"Scheduling direction"},DependencyTab:{Predecessors:"Predecessors",Successors:"Successors",ID:"ID",Name:"Name",Type:"Type",Lag:"Lag",cyclicDependency:"Cyclic dependency",invalidDependency:"Invalid dependency"},NotesTab:{Notes:"Notes"},ResourcesTab:{unitsTpl:({value:e})=>`${e}%`,Resources:"Resources",Resource:"Resource",Units:"Units"},RecurrenceTab:{title:"Repeat"},SchedulingModePicker:{Normal:"Normal","Fixed Duration":"Fixed Duration","Fixed Units":"Fixed Units","Fixed Effort":"Fixed Effort"},ResourceHistogram:{barTipInRange:'<b>{resource}</b> {startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated',barTipOnDate:'<b>{resource}</b> on {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated',groupBarTipAssignment:'<b>{resource}</b> - <span class="{cls}">{allocated} of {available}</span>',groupBarTipInRange:'{startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',groupBarTipOnDate:'On {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',plusMore:"+{value} more"},ResourceUtilization:{barTipInRange:'<b>{event}</b> {startDate} - {endDate}<br><span class="{cls}">{allocated}</span> allocated',barTipOnDate:'<b>{event}</b> on {startDate}<br><span class="{cls}">{allocated}</span> allocated',groupBarTipAssignment:'<b>{event}</b> - <span class="{cls}">{allocated}</span>',groupBarTipInRange:'{startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',groupBarTipOnDate:'On {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',plusMore:"+{value} more",nameColumnText:"Resource / Event"},SchedulingIssueResolutionPopup:{"Cancel changes":"Cancel the change and do nothing",schedulingConflict:"Scheduling conflict",emptyCalendar:"Calendar configuration error",cycle:"Scheduling cycle",Apply:"Apply"},CycleResolutionPopup:{dependencyLabel:"Please select a dependency:",invalidDependencyLabel:"There are invalid dependencies involved that need to be addressed:"},DependencyEdit:{Active:"Active"},SchedulerProBase:{propagating:"Calculating project",storePopulation:"Loading data",finalizing:"Finalizing results"},EventSegments:{splitEvent:"Split event",renameSegment:"Rename"},NestedEvents:{deNestingNotAllowed:"De-nesting not allowed",nestingNotAllowed:"Nesting not allowed"},VersionGrid:{compare:"Compare",description:"Description",occurredAt:"Occurred At",rename:"Rename",restore:"Restore",stopComparing:"Stop Comparing"},Versions:{entityNames:{TaskModel:"task",AssignmentModel:"assignment",DependencyModel:"link",ProjectModel:"project",ResourceModel:"resource",other:"object"},entityNamesPlural:{TaskModel:"tasks",AssignmentModel:"assignments",DependencyModel:"links",ProjectModel:"projects",ResourceModel:"resources",other:"objects"},transactionDescriptions:{update:"Changed {n} {entities}",add:"Added {n} {entities}",remove:"Removed {n} {entities}",move:"Moved {n} {entities}",mixed:"Changed {n} {entities}"},addEntity:"Added {type} **{name}**",removeEntity:"Removed {type} **{name}**",updateEntity:"Changed {type} **{name}**",moveEntity:"Moved {type} **{name}** from {from} to {to}",addDependency:"Added link from **{from}** to **{to}**",removeDependency:"Removed link from **{from}** to **{to}**",updateDependency:"Edited link from **{from}** to **{to}**",addAssignment:"Assigned **{resource}** to **{event}**",removeAssignment:"Removed assignment of **{resource}** from **{event}**",updateAssignment:"Edited assignment of **{resource}** to **{event}**",noChanges:"No changes",nullValue:"none",versionDateFormat:"M/D/YYYY h:mm a",undid:"Undid changes",redid:"Redid changes",editedTask:"Edited task properties",deletedTask:"Deleted a task",movedTask:"Moved a task",movedTasks:"Moved tasks"}},lj=yt.publishLocale(ML),id=class extends ht.mixin(Ab){static get $name(){return"TaskEditorBase"}static get type(){return"taskeditorbase"}static get configurable(){return{localizableProperties:["width"],title:"L{Information}",cls:"b-schedulerpro-taskeditor",closable:!0,layout:"fit",draggable:{handleSelector:":not(button,.b-field-inner)"},items:null,bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{text:"L{Save}",color:"b-blue",cls:"b-raised",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}},strips:{occurrenceInfoToolbar:{cls:"occurrence-info-toolbar",hidden:!0,ignoreParentReadOnly:!0,items:[{type:"widget",tag:"i",cls:"b-icon b-icon-locked"},{ref:"occurrenceInfoText",type:"label",localeClass:this,text:"L{repeatingInfo}"},"->",{ref:"editOccurrenceButton",localeClass:this,text:"L{editRepeating}",onClick:"up.onEditOccurrenceClick"}]}},width:{$config:{localeKey:"L{editorWidth}"}},maximizeOnMobile:!0,includeAsapAlapAsConstraints:!0}}static get defaultConfig(){return{axisLock:"flexible",autoClose:!0,onChange:null,onCancel:null,onSave:null,autoShow:!1,blurAction:"cancel",scrollAction:"realign",durationDisplayPrecision:1,tabPanelItems:null,defaultTabs:null,calculateMask:null,calculateMaskDelay:100,localizableProperties:["calculateMask"],project:null,dependencyIdField:null}}processWidgetConfig(e){var r;if((r=e.type)!=null&&r.includes("date")&&e.weekStartDay==null&&(e.weekStartDay=this.weekStartDay),e.ref==="tabs"&&this.extraItems){const t={};for(const i in this.extraItems){const n=i.replace("tab","Tab");t[n]={items:Array.isArray(this.extraItems[i])?T.transformArrayToNamedObject(this.extraItems[i]):this.extraItems[i]}}T.merge(e.items,t)}return e}changeItems(e){var r;const{tabPanelItems:t={}}=this,i=T.clone(e),n=((r=i.find)==null?void 0:r.call(i,s=>s.ref==="tabs"))||i.tabs;return this.cleanItemsConfig(t),T.merge(n.items,t),super.changeItems(i)}cleanItemsConfig(e){for(const r in e){const t=e[r];t===!0?delete e[r]:t!=null&&t.items&&this.cleanItemsConfig(t.items)}}afterConfigure(){var e;const r=this,{widgetMap:t}=r,{tabs:i}=t,{cancelButton:n,deleteButton:s,saveButton:a}=((e=r.bbar)==null?void 0:e.widgetMap)||{};a==null||a.ion({click:"onSaveClick",thisObj:r}),n==null||n.ion({click:"onCancelClick",thisObj:r}),s==null||s.ion({click:"onDeleteClick",thisObj:r}),Object.values(t).forEach(o=>{o.isDurationField?o.decimalPrecision=this.durationDisplayPrecision:o.ref==="startDate"||o.ref==="endDate"?o.project=this.project:(o.ref==="predecessorsTab"||o.ref==="successorsTab")&&(o.grid.durationDisplayPrecision=this.durationDisplayPrecision,o.dependencyIdField=o.dependencyIdField||r.dependencyIdField),o.isReadyStatePropagator&&o.ion({readyStateChange:"onReadyStateChange",thisObj:r})}),i.onFieldChange=({source:o})=>{const{name:l,isValid:c,value:d}=o;r.loadedRecord&&l&&c&&!r.isLoadingEvent&&!o.up("recurrenceeditorpanel")&&r.loadedRecord.setValue(l,d)}}get canSave(){let e=!0;return Object.values(this.widgetMap).forEach(r=>{r.isReadyStatePropagator&&(e=e&&r.canSave)}),e}async hide(){const e=this;e.detachListeners("project"),e.detachListeners("eventStore"),e._delayedAction=null;const r=await super.hide(this.element.matches(":focus-within"));return e.isDestroyed||e.trigger(e.blurAction),r}toggleFieldsDisabled(e){this.eachWidget(r=>{r.isField&&r.name&&!r.up("recurrenceeditorpanel")&&e.isEditable(r.name)!==void 0&&(r.disabled=!e.isEditable(r.name))})}loadEvent(e,r=!1){var t;const i=this,n=(t=i.project)!=null?t:e.project;i.isLoadingEvent=!0,i.includeAsapAlapAsConstraints=n.includeAsapAlapAsConstraints,i.widgetMap.occurrenceInfoToolbar.hidden=!e.isOccurrence&&!e.isRecurring||i.editingRecurring,i.toggleFieldsDisabled(e),i.callWidgetHook("loadEvent",e,r),i.detachListeners("project"),i.loadedRecord=e,n.ion({name:"project",beforeCommit:"onProjectBeforeCommit",dataReady:"onProjectDataReady",thisObj:i}),i.detachListeners("eventStore"),n.eventStore.ion({name:"eventStore",remove:"onTaskRemove",thisObj:i}),i.isLoadingEvent=!1,i.trigger("loadEvent")}callWidgetHook(e,...r){this.eachWidget(t=>{typeof t[e]=="function"&&t[e](...r)})}onDocumentMouseDown(e){const r=this,t=Object.values(r.widgetMap).some(n=>n._activeCellEdit);let i=null;if(t){const{event:n}=e,{saveButton:s,cancelButton:a,deleteButton:o}=r.widgetMap,l=n.target.closest("button");if(l)switch(l){case(s==null?void 0:s.element):i=r.onSaveClick;break;case(a==null?void 0:a.element):i=r.onCancelClick;break;case(o==null?void 0:o.element):i=r.onDeleteClick;break}}r._delayedAction=i,super.onDocumentMouseDown(e)}onSaveClick(){const e=this;e._delayedAction=null,e.canSave?e.trigger("save"):It.show({rootElement:e.rootElement,html:e.L("L{saveError}")})}onCancelClick(){this.close()}onDeleteClick(){this._delayedAction=null,this.trigger("delete")}onPropagationRequested(){this.trigger("requestPropagation")}onReadyStateChange({source:e,canSave:r}){this.requestReadyStateChange(),e.couldSaveTitle||(e.couldSaveTitle=e.title),e.parent===this.widgetMap.tabs&&(r?(e.tab.element.classList.remove("b-invalid"),e.tab.icon=null,e.title=e.couldSaveTitle,e.couldSaveTitle=null):(e.tab.element.classList.add("b-invalid"),e.tab.icon="b-icon-warning",e.title=e.couldSaveTitle))}onTaskRemove(){this.afterDelete()}onProjectBeforeCommit(){this.calculateMask&&this.mask({text:this.calculateMask,showDelay:this.calculateMaskDelay})}onProjectDataReady({records:e}){var r;const t=this;t.calculateMask&&t.unmask(),e.has(t.loadedRecord)&&t.callWidgetHook("afterProjectChange"),(r=t._delayedAction)==null||r.call(t)}beforeSave(){this.callWidgetHook("beforeSave")}afterSave(){this.loadedRecord=void 0,this.callWidgetHook("afterSave")}beforeCancel(){this.callWidgetHook("beforeCancel")}afterCancel(){this.loadedRecord=void 0,this.callWidgetHook("afterCancel")}beforeDelete(){this.callWidgetHook("beforeDelete")}afterDelete(){this.loadedRecord=void 0,this.callWidgetHook("afterDelete")}onInternalKeyDown(e){if(!e.handled&&e.key==="Enter"&&this.saveAndCloseOnEnter&&e.target.tagName.toLowerCase()==="input"){if(e.target.matches("input")){const r=$.fromElement(e.target);r!=null&&r.internalOnChange&&!r.isCheckbox&&!r.isSlider&&r.internalOnChange()}e.preventDefault(),this.onSaveClick()}super.onInternalKeyDown(e)}onEditOccurrenceClick(){const e=this;$.create({type:"recurrenceconfirmation",owner:e}).confirm({actionType:"update",eventRecord:e.loadedRecord,changerFn:t=>{var i;const n=(i=t.recurringTimeSpan)!=null?i:t;e.resetRecurrenceData={recurringTimeSpan:n,originalExceptionDates:{...n.exceptionDates}},t.isRecurring||(t.convertToRealEvent({startDate:t.startDate}),t.constraintDate=null)},finalizerFn:t=>{t.isRecurring&&(e.editingRecurring=!0,e.readOnly=!1),e.loadEvent(t)}})}updateReadOnly(e){const{deleteButton:r,saveButton:t,cancelButton:i,tabs:n}=this.widgetMap,{items:s}=n;super.updateReadOnly(e),r&&(r.hidden=e),t&&(t.hidden=e),i&&(i.hidden=e);for(let a=0,{length:o}=s;a<o;a++)s[a].readOnly=e}updateIncludeAsapAlapAsConstraints(){this.eachWidget(e=>{e.includeAsapAlapAsConstraints=this.includeAsapAlapAsConstraints})}};id.initClass(),id._$name="TaskEditorBase";var fT=e=>class extends(e||Ht){get project(){var t,i,n;return(n=(t=this.up(s=>s.isTaskEditorBase))==null?void 0:t.project)!=null?n:(i=this.record)==null?void 0:i.project}loadEvent(t,i){this.setRecord(t,i)}resetData(){this.record=null}beforeSave(){}afterSave(){this.resetData()}beforeCancel(){}afterCancel(){this.resetData()}beforeDelete(){}afterDelete(){this.resetData()}get widgetClass(){}},_o=class extends Ht.mixin(fT,Ab){static get $name(){return"EditorTab"}static get type(){return"editortab"}static get configurable(){return{title:null,strictRecordMapping:!0}}};_o._$name="EditorTab";var gn=class extends _o{static get $name(){return"FormTab"}static get type(){return"formtab"}static get defaultConfig(){return{layoutStyle:{flexFlow:"row wrap",alignItems:"flex-start",alignContent:"flex-start"},autoUpdateRecord:!0}}onFieldChange({source:e,valid:r,userAction:t}){t&&(r=r!==void 0?r:typeof e.isValid=="function"?e.isValid():e.isValid,r&&super.onFieldChange(...arguments))}};gn.initClass(),gn._$name="FormTab";var IL=new Date(2300,0,1),_b=class extends ma{static get $name(){return"StartDateField"}static get type(){return"startdatefield"}static get alias(){return"startdate"}static get defaultConfig(){return{project:null,eventRecord:null,strictParsing:!0,minDateDelta:"-10 years",maxDateDelta:"200 years"}}get calendarProvider(){var e,r;return((r=(e=this.eventRecord)==null?void 0:e.recurringEvent)!=null?r:this.eventRecord)||this.project}get backShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit)}get forwardShiftDate(){const e=this;let r=e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit);return r=r&&e.calendarProvider.run("skipNonWorkingTime",r,!0),r}transformTimeValue(e){const{calendarProvider:r,keepTime:t}=this;if(r&&t!=="entered"){const i=b.clearTime(e),n=r.run("skipNonWorkingTime",i);if(b.isValidDate(n)&&b.isEqual(n,i,"day"))return b.copyTimeValues(i,n)}return super.transformTimeValue(e)}get min(){var e;return super.min||(e=this.project)!=null&&e.startDate?b.add(this.project.startDate,this.minDateDelta):null}set min(e){super.min=e}get max(){var e;return super.max||(e=this.project)!=null&&e.startDate?b.add(this.project.startDate,this.maxDateDelta):IL}set max(e){super.max=e}};_b.initClass(),_b._$name="StartDateField";var PL=new Date(2300,0,1),kb=class extends ma{static get $name(){return"EndDateField"}static get type(){return"enddatefield"}static get alias(){return"enddate"}static get defaultConfig(){return{project:null,eventRecord:null,strictParsing:!0}}get min(){var e;let r=this._min;const t=(e=this.eventRecord)==null?void 0:e.startDate;return t&&(r=b.max(r||t,t)),r}set min(e){super.min=e}get max(){var e;return super.max||(e=this.project)!=null&&e.startDate?b.add(this.project.startDate,200,"year"):PL}set max(e){super.max=e}get calendarProvider(){var e,r;return((r=(e=this.eventRecord)==null?void 0:e.recurringEvent)!=null?r:this.eventRecord)||this.project}get backShiftDate(){const e=this;let r=e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit);return r=r&&e.calendarProvider.run("skipNonWorkingTime",r,!1),r}get forwardShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit)}transformTimeValue(e){const{calendarProvider:r,keepTime:t}=this;if(r&&t!=="entered"){const i=b.clearTime(e),n=b.add(i,1,"day"),s=r.run("skipNonWorkingTime",n,!1);if(b.isValidDate(s)&&b.isEqual(s,i,"day"))return b.copyTimeValues(i,s)}return!t&&e&&this.min&&b.clearTime(e,!1)<this.min?this.min:super.transformTimeValue(e)}};kb.initClass(),kb._$name="EndDateField";var ks=class extends Il{};E(ks,"$name","EffortField"),E(ks,"type","effort"),E(ks,"alias","effortfield"),ks.initClass(),ks._$name="EffortField";var Fb=class extends gn{static get $name(){return"GeneralTab"}static get type(){return"generaltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this},items:{name:{type:"text",weight:100,required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name"},percentDone:{type:"number",weight:200,label:"L{% complete}",name:"renderedPercentDone",cls:"b-percent-done b-half-width",min:0,max:100},effort:{type:"effort",weight:300,label:"L{Effort}",name:"fullEffort",cls:"b-half-width"},divider:{html:"",weight:400,dataset:{text:this.L("L{Dates}")},cls:"b-divider",flex:"1 0 100%"},startDate:{type:"startdate",weight:500,label:"L{Start}",name:"startDate",cls:"b-start-date b-half-width"},endDate:{type:"enddate",weight:600,label:"L{Finish}",name:"endDate",cls:"b-end-date b-half-width"},duration:{type:"durationfield",weight:700,label:"L{Duration}",name:"fullDuration",cls:"b-half-width"},colorField:{type:"eventcolorfield",weight:800,label:"L{SchedulerBase.color}",name:"eventColor",cls:"b-half-width"}}}}loadEvent(e){const r={unit:e.durationUnit,magnitude:1},{startDate:t,endDate:i,effort:n}=this.widgetMap;t&&(t.step=r,t.eventRecord=e),i&&(i.step=r,i.eventRecord=e),n&&(n.unit=e.effortUnit),super.loadEvent(e)}};Fb.initClass(),Fb._$name="GeneralTab";var mT=e=>e.map((r,t)=>[t,r]),Ob=class extends Fe{static get $name(){return"DependencyTypePicker"}static get type(){return"dependencytypepicker"}construct(e){super.construct(e),ze.ion({locale:()=>{this.items=mT(this.L("L{DependencyType.long}"))},thisObj:this})}get store(){return this._items||(this.items=this._items=mT(this.L("L{DependencyType.long}"))),super.store}set store(e){super.store=e}};Ob.initClass(),Ob._$name="DependencyTypePicker";var AL=(e,r)=>{e.instanceMeta(r).valid=!0},pT=(e,r)=>{e.instanceMeta(r).valid=!1},Lb=(e,r)=>e.instanceMeta(r).valid!==!1,Dg=class extends _o{static get $name(){return"DependencyTab"}static get type(){return"dependencytab"}static get configurable(){return{dependencyIdField:null,layoutStyle:{flexFlow:"column nowrap"},sortField:null,taskComboSortField:"name",items:{grid:{type:"grid",weight:100,flex:"1 1 auto",emptyText:"",asyncEventSuffix:"PreCommit",disableGridRowModelWarning:!0,features:{group:!1},columns:{data:{id:{localeClass:this,text:"L{ID}",flex:1,editor:!1,htmlEncode:!1,hidden:!0,sortable(e,r){var t,i;const{dependencyIdField:n,direction:s}=this.grid.parent,a=(t=e[s])==null?void 0:t[n],o=(i=r[s])==null?void 0:i[n];return a===o?0:a<o?-1:1},renderer:({record:e,row:r,grid:t,column:i})=>{let n;const{direction:s}=t.parent,a=e[s];if(a&&Lb(e,t)){const o=t.parent.dependencyIdField,l=a[o];o==="id"?n=!a||a.hasGeneratedId?"*":a.id:n=l}else r.addCls("b-invalid"),n='<div class="b-icon b-icon-warning"></div>';return n}},name:{localeClass:this,text:"L{Name}",flex:5,renderer:({value:e,grid:r,cellElement:t})=>{if(e){t.classList.toggle("b-inactive",e.inactive);const i=e[r.parent.dependencyIdField];return e.name+(i!=null&&!e.hasGeneratedId?` (${i})`:"")}return""},finalizeCellEdit:"up.finalizeLinkedTaskCellEdit",editor:{type:"modelcombo",displayField:"name",valueField:"id",filterOperator:"*",allowInvalid:!0,listItemTpl(e){const r=this,t=r._dependencyTab||(r._dependencyTab=r.up("dependencytab",!0)),{dependencyIdField:i}=t,n=e.hasGeneratedId&&i==="id"?null:e[i];return O.xss`${e.name}${n!=null?` (${n})`:""}`}}},type:{localeClass:this,text:"L{Type}",field:"type",flex:3,sortable:!1,editor:"dependencytypepicker",renderer({value:e}){return this.L("L{DependencyType.long}")[e]}},lag:{localeClass:this,text:"L{Lag}",type:"duration",field:"fullLag",flex:2,editor:{allowNegative:!0}}}}},toolbar:{type:"toolbar",dock:"bottom",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"b-icon b-icon-add",onAction:"up.onAddClick"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0,onAction:"up.onRemoveClick"}}}}}}async finalizeLinkedTaskCellEdit({grid:e,value:r,record:t}){const{project:i}=e.store.masterStore,n=this.direction==="toEvent",s=n?t.fromEvent:r,a=n?r:t.toEvent;switch(await i.validateDependency(s,a,t.type,t)){case ci.NoError:return!0;case ci.CyclicDependency:return"L{DependencyTab.cyclicDependency}"}return"L{DependencyTab.invalidDependency}"}afterConstruct(){super.afterConstruct(),(this.grid=this.widgetMap.grid).ion({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:this})}get taskCombo(){const{grid:e}=this,r=e==null?void 0:e.columns.get(this.direction);return r==null?void 0:r.editor}loadEvent(e){const r=this,{grid:t,taskCombo:i,record:n}=r;super.loadEvent(e);const{dependencyStore:s,eventStore:a}=r.project,o=t.store.masterStore!==s,l=!o&&e!==n;if(o){r.depStoreGeneration=s.storage.generation,r.eventStoreGeneration=a.storage.generation,r.detachListeners("taskCombo"),t.store=s.chain(d=>d[r.negDirection]===r.record,null);const c=i.store=a.chain(d=>d!==r.record,null,{doRelayToMaster:[],excludeCollapsedRecords:!1});c.sort(r.taskComboSortField),c.filterBy(d=>!t.store.find(u=>{const h=u[r.direction],g=r._activeCellEdit,f=g&&h===g.record[r.direction];return h===d&&!f})),i.ion({name:"taskCombo",change:"onGridCellEditChange",thisObj:r})}else t.store.resumeChain(),l||s.storage.generation!==r.depStoreGeneration?(t.store.fillFromMaster(),r.depStoreGeneration=s.storage.generation):t.refreshRows(),(l||a.storage.generation!==r.eventStoreGeneration)&&(i.store.fillFromMaster(),r.eventStoreGeneration=a.storage.generation);l&&t.store.sort(r.sortField),r.requestReadyStateChange()}async insertNewDependency(){const e=this,{grid:r}=e,{cellEdit:t}=r.features;t.isEditing&&!t.editor.isValid&&t.cancelEditing();const[i]=r.store.insert(0,{[e.negDirection]:e.record});return e.depStoreGeneration=e.project.dependencyStore.storage.generation,await r.features.cellEdit.startEditing({field:e.direction,id:i.id}),pT(i,r),i}beforeSave(){this.grid.store.suspendChain()}onAddClick(){this.insertNewDependency()}onRemoveClick(){const e=this,{grid:r}=e,t=r.selectedRecords;r.features.cellEdit.cancelEditing(!0),e.project.dependencyStore.remove(t),r.selectedRecord=r.store.getNext(t[0]),e.taskCombo.store.fillFromMaster()}onGridSelectionChange({selection:e}){const r=this.widgetMap.remove,t=!!(!(e!=null&&e.length)||this.up(i=>i.readOnly));r.containsFocus&&t&&this.grid.focusCell({rowIndex:-1,columnIndex:0}),r.disabled=t}clearActiveEditorErrors(){const e=this._activeCellEdit;e&&e.column.field===this.direction&&e.editor.inputField.clearError()}onGridCellEditChange(){this.clearActiveEditorErrors()}onGridStartCellEdit({editorContext:e}){const r=this,t=r._editingDependency=e.record,{grid:i,direction:n}=r;r._activeCellEdit=e,e.column.field===n&&(Lb(t,i)?r.clearActiveEditorErrors():t[n]?e.editor.inputField.setError("L{DependencyTab.cyclicDependency}"):e.editor.inputField.setError("L{DependencyTab.invalidDependency}"))}async onGridFinishCellEdit({editorContext:e}){const r=this,{record:t,column:i}=e,{grid:n,direction:s}=r;i.field===s?(AL(t,n),r.taskCombo.store.fillFromMaster()):r.redrawDependencyRow(t),r._activeCellEdit=r._editingDependency=null,r.requestReadyStateChange()}afterCancel(){this._activeCellEdit&&this.grid.features.cellEdit.cancelEditing(!0)}onGridCancelCellEdit(){const e=this,r=e._editingDependency;r&&(r[e.direction]||(pT(r,e.grid),e.redrawDependencyRow(r)),e._activeCellEdit=e._editingDependency=null),e.requestReadyStateChange()}redrawDependencyRow(e){const{grid:r}=this,t=r.rowManager.getRowById(e);t&&r.store.indexOf(e)>=0&&t.render(r.store.indexOf(e),e)}get canSave(){const{grid:e}=this;return e.store.every(r=>Lb(r,e))}updateReadOnly(e){const{add:r,remove:t}=this.widgetMap;super.updateReadOnly(...arguments),r.hidden=t.hidden=e}};Dg._$name="DependencyTab";var $b=class extends Dg{static get $name(){return"SuccessorsTab"}static get type(){return"successorstab"}static get configurable(){return{cls:"b-successors-tab",direction:"toEvent",negDirection:"fromEvent",title:"L{DependencyTab.Successors}",sortField:"toEventName",items:{grid:{columns:{data:{name:{field:"toEvent"}}}}}}}};$b.initClass(),$b._$name="SuccessorsTab";var jb=class extends Dg{static get $name(){return"PredecessorsTab"}static get type(){return"predecessorstab"}static get configurable(){return{cls:"b-predecessors-tab",direction:"fromEvent",negDirection:"toEvent",title:"L{DependencyTab.Predecessors}",sortField:"fromEventName",items:{grid:{columns:{data:{name:{field:"fromEvent"}}}}}}}};jb.initClass(),jb._$name="PredecessorsTab";var Bb=class extends _o{static get $name(){return"ResourcesTab"}static get type(){return"resourcestab"}static get configurable(){return{title:"L{Resources}",cls:"b-resources-tab",layoutStyle:{flexFlow:"column nowrap"},showUnits:null,items:{grid:{type:"grid",weight:100,flex:"1 1 auto",columns:{data:{resource:{localeClass:this,text:"L{Resource}",field:"resource",flex:7,renderer:({value:e})=>(e==null?void 0:e.name)||"",editor:{type:"modelcombo",displayField:"name",valueField:"id"}},units:{type:"number",localeClass:this,text:"L{Units}",field:"units",flex:3,renderer:e=>this.L("L{unitsTpl}",e),min:0,max:100,step:10}}},disableGridRowModelWarning:!0,asyncEventSuffix:"PreCommit"},toolbar:{type:"toolbar",dock:"bottom",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"b-icon b-icon-add"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0}}}}}}afterConstruct(){super.afterConstruct();const e=this,r=e.addButton=e.widgetMap.add,t=e.removeButton=e.widgetMap.remove,i=e.grid=e.widgetMap.grid;r==null||r.ion({click:"onAddClick",thisObj:e}),t==null||t.ion({click:"onRemoveClick",thisObj:e}),i.ion({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:e})}updateReadOnly(e){const{add:r,remove:t}=this.widgetMap;super.updateReadOnly(...arguments),r.hidden=t.hidden=e}get resourceCombo(){var e;const r=(e=this.grid)==null?void 0:e.columns.get("resource");return r==null?void 0:r.editor}updateShowUnits(e){const r=this.widgetMap.grid.columns.get("units");r&&(r.hidden=!e)}loadEvent(e){const r=this,{resourceCombo:t,grid:i,record:n}=r;super.loadEvent(e);const{assignmentStore:s,resourceStore:a}=r.project,o=i.store.masterStore!==s,l=!o&&e!==n;typeof this.showUnits!="boolean"&&(i.columns.get("units").hidden=!e.isTask),o?(r.assignmentStoreGeneration=s.storage.generation,r.resourceStoreGeneration=a.storage.generation,i.store=s.chain(c=>r.record&&c.event===r.record,null),t.store=a.chain(c=>!c.isSpecialRow&&r.record&&!r.record.isAssignedTo(c)||!r.activeAssignment||r.activeAssignment.resource===c,null,{groupers:a.groupers})):(i.store.resumeChain(),(l||s.storage.generation!==r.assignmentStoreGeneration)&&i.store.fillFromMaster(),(l||a.storage.generation!==r.resourceStoreGeneration)&&t.store.fillFromMaster())}get activeAssignment(){return this.grid.features.cellEdit.activeRecord}async insertNewAssignment(){const e=this,{project:r,grid:t}=e,i=r.assignmentStore,[n]=i.insert(0,{event:e.record,resource:null,units:100});return e.assignmentStoreGeneration=i.storage.generation,await t.features.cellEdit.startEditing({field:"resource",id:n.id}),n}beforeSave(){this.pruneInvalidAssignments(),this.grid.store.suspendChain()}onAddClick(){this.insertNewAssignment()}onRemoveClick(){const e=this,{grid:r}=e;r.store.remove(r.selectedRecords),r.selectedRecords=null,e.removeButton.disable()}onGridSelectionChange({selection:e}){const{removeButton:r}=this,t=!(e!=null&&e.length)||this.up(i=>i.readOnly);r.containsFocus&&t&&this.grid.focus(),r.disabled=t}onGridStartCellEdit({editorContext:e}){e.column.field==="resource"&&(this.resourceCombo.store.fillFromMaster(),this._editingAssignment=e.record,this._activeCellEdit=e)}onGridFinishCellEdit(){this._activeCellEdit=this._editingAssignment=null}onGridCancelCellEdit(){this._activeCellEdit=this._editingAssignment=null}pruneInvalidAssignments(){const{store:e}=this.grid;e.remove(e.query(r=>!r.isValid))}};Bb.initClass(),Bb._$name="ResourcesTab";var _L={assoonaspossible:1,aslateaspossible:1},ko=class extends Fe{static get $name(){return"ConstraintTypePicker"}static get type(){return"constrainttypepicker"}static get configurable(){return{valueField:"id",store:{data:[{id:"none"},{id:"assoonaspossible"},{id:"aslateaspossible"},{id:"muststarton"},{id:"mustfinishon"},{id:"startnoearlierthan"},{id:"startnolaterthan"},{id:"finishnoearlierthan"},{id:"finishnolaterthan"}]},primaryFilter(e){return ko.localize(e.id).toLowerCase().startsWith(this.value.toLowerCase())},includeAsapAlapAsConstraints:!0,nullValue:"none"}}loadEvent(e){this.taskRecord=e,this.store.filter()}set value(e){super.value=e}get value(){const e=super.value;return e==="none"?null:e}get inputValue(){var e;return this.L(((e=this.selected)==null?void 0:e.id)||this.nullValue)}listItemTpl(e){return ko.localize(e.id)}changeStore(e){return super.changeStore({...e,filters:{filterBy:r=>{var t,i;return _L[r.id]?this._includeAsapAlapAsConstraints:(i=((t=this.taskRecord)==null?void 0:t.recurringEvent)||this.taskRecord)==null?void 0:i.run("isConstraintTypeApplicable",r.id)}}})}updateIncludeAsapAlapAsConstraints(){this.store.filter()}};ko.initClass(),ko._$name="ConstraintTypePicker";var Fo=class extends Fe{static get $name(){return"SchedulingDirectionPicker"}static get type(){return"schedulingdirectionpicker"}static get configurable(){return{store:{data:[{id:"Forward"},{id:"Backward"}]},primaryFilter(e){return Fo.localize(e.id).toLowerCase().startsWith(this.value.toLowerCase())},hasEnforcedBadge:!1,clearable:!1,nullValue:"Forward"}}get inputValue(){return this.L(this.value||"")}listItemTpl(e){return Fo.localize(e.id)}changeHasEnforcedBadge(e){this.element.classList.toggle("b-enforced-sch-direction",!!e)}getEnforcedName(e){return e.name||(e.isRoot?"Project":`Task #${e.id}`)}assignFieldValue(e){const r=this,t=e==null?void 0:e.effectiveDirection;r.taskRecord=e,t?(r.value=t.direction,t.kind==="enforced"?(r.hasEnforcedBadge=!0,r.tooltip=r.L("L{enforcedBy}")+` "${this.getEnforcedName(t.enforcedBy)}"`,r.disable()):t.kind==="inherited"?(r.hasEnforcedBadge=!0,r.tooltip=r.L("L{inheritedFrom}")+` "${this.getEnforcedName(t.inheritedFrom)}"`,r.enable()):(r.hasEnforcedBadge=!1,r.tooltip=void 0,r.enable())):(r.clear(),r.disable())}};Fo.initClass(),Fo._$name="SchedulingDirectionPicker";var nd=class extends Fe{static get $name(){return"SchedulingModePicker"}static get type(){return"schedulingmodecombo"}static get configurable(){return{allowedModes:null,store:{data:this.defaultStoreData}}}static get defaultStoreData(){return[{id:Oe.Normal,text:this.L("L{Normal}")},{id:Oe.FixedDuration,text:this.L("L{Fixed Duration}")},{id:Oe.FixedUnits,text:this.L("L{Fixed Units}")},{id:Oe.FixedEffort,text:this.L("L{Fixed Effort}")}]}changeAllowedModes(e){return typeof e=="string"?e.split(","):e}updateAllowedModes(e){this._allowedModes=e,e?this.store.addFilter({id:"allowed-mode-filter",filterBy:r=>this._allowedModes.includes(r.id)}):this.store.removeFilter("allowed-mode-filter")}updateLocalization(){super.updateLocalization(),this.store.data=this.constructor.defaultStoreData}};nd.initClass(),nd._$name="SchedulingModePicker";var Hb=class extends gn{static get $name(){return"AdvancedTab"}static get type(){return"advancedtab"}static get defaultConfig(){const e={flex:"0 0 calc(64% - var(--autocontainer-gap) / 2)",labelWidth:"30%"},r={flex:"0 0 calc(34% - var(--autocontainer-gap) / 2)",labelWidth:"80%"};return{localeClass:this,title:"L{Advanced}",cls:"b-advanced-tab",defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",weight:100,ref:"",name:"calendar",label:"L{Calendar}",...e},ignoreResourceCalendarField:{type:"checkbox",weight:100,name:"ignoreResourceCalendar",label:"L{Ignore resource calendar}",cls:"b-ignore-resource-calendar",...r},schedulingModeField:{type:"schedulingmodecombo",weight:300,name:"schedulingMode",label:"L{Scheduling mode}",...e},effortDrivenField:{type:"checkbox",weight:400,name:"effortDriven",label:"L{Effort driven}",...r},divider:{weight:500,html:"",dataset:{text:this.L("L{Constraint}")},cls:"b-divider",flex:"1 0 100%"},constraintTypeField:{type:"constrainttypepicker",weight:600,name:"constraintType",label:"L{Constraint type}",clearable:!0,...e},rollupField:{type:"checkbox",weight:700,name:"rollup",label:"L{Rollup}",...r},constraintDateField:{type:"date",weight:800,name:"constraintDate",label:"L{Constraint date}",keepTime:"entered",...e},schedulingDirectionField:{type:"schedulingdirectionpicker",weight:850,name:"direction",label:"L{Scheduling direction}",...e},inactiveField:{type:"checkbox",weight:900,name:"inactive",label:"L{Inactive}",...r},manuallyScheduledField:{type:"checkbox",weight:1e3,name:"manuallyScheduled",label:"L{Manually scheduled}",cls:"b-last-row",style:"margin-left:auto",...r}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get effortDrivenField(){return this.widgetMap.effortDrivenField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}get rollupField(){return this.widgetMap.rollupField}get schedulingModeField(){return this.widgetMap.schedulingModeField}get schedulingDirectionField(){return this.widgetMap.schedulingDirectionField}loadEvent(e){const r=this,{calendarField:t,constraintTypeField:i,includeAsapAlapAsConstraints:n,schedulingDirectionField:s}=r,{calendarManagerStore:a}=e.project,o=(t==null?void 0:t.store)!==a;t&&(o?t.store=a.chain(void 0,void 0,{excludeCollapsedRecords:!1}):t.store.resumeChain()),i&&(i.taskRecord=e,i.includeAsapAlapAsConstraints=n),s&&(s.hidden=n),super.loadEvent(e)}beforeSave(){const{calendarField:e}=this.widgetMap;e&&e.store.suspendChain()}};Hb.initClass(),Hb._$name="AdvancedTab";var Vb=class extends gn{static get $name(){return"NotesTab"}static get type(){return"notestab"}static get configurable(){return{cls:"b-notes-tab",title:this.L("L{Notes}"),tab:{icon:"b-icon-note",titleProperty:"tooltip"},layoutConfig:{alignItems:"flex-start",alignContent:"stretch"},items:{noteField:{weight:100,type:"textfield",inputAttributes:{tag:"textarea"},cls:"b-taskeditor-notes-field",name:"note"}}}}};Vb.initClass(),Vb._$name="NotesTab";var sd=class extends id{static get type(){return"gantttaskeditor"}static get $name(){return"GanttTaskEditor"}};E(sd,"configurable",{items:{tabs:{type:"tabpanel",defaultType:"formtab",flex:"1 0 100%",autoHeight:!0,layoutConfig:{alignItems:"stretch",alignContent:"stretch"},items:{generalTab:{type:"generaltab",weight:100},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},resourcesTab:{type:"resourcestab",weight:400},advancedTab:{type:"advancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}}}),sd.initClass(),sd._$name="GanttTaskEditor";var Nb=class extends gn{static get $name(){return"SchedulerGeneralTab"}static get type(){return"schedulergeneraltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this,weight:10},items:{nameField:{type:"text",required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name",weight:100},resourcesField:{type:"combo",label:"L{Resources}",name:"resources",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,cls:"b-resources",weight:200},startDateField:{type:"datetime",label:"L{Start}",name:"startDate",cls:"b-start-date",flex:"1 0 100%",weight:300,dateField:{type:"startdatefield"}},endDateField:{type:"datetime",label:"L{Finish}",name:"endDate",cls:"b-end-date",flex:"1 0 100%",weight:400,dateField:{type:"enddatefield"}},durationField:{type:"durationfield",label:"L{Duration}",name:"fullDuration",cls:"b-half-width",min:0,weight:500},percentDoneField:{type:"number",label:"L{% complete}",name:"renderedPercentDone",cls:"b-half-width",min:0,max:100,weight:600},effortField:{type:"durationfield",label:"L{Effort}",name:"fullEffort",weight:620},preambleField:{type:"durationfield",hidden:!0,useAbbreviation:!0,weight:650,label:"L{SchedulerGeneralTab.Preamble}",name:"preamble",cls:"b-half-width"},postambleField:{type:"durationfield",hidden:!0,useAbbreviation:!0,weight:660,label:"L{SchedulerGeneralTab.Postamble}",name:"postamble",cls:"b-half-width"},colorField:{type:"eventcolorfield",weight:700,label:"L{SchedulerBase.color}",name:"eventColor"}}}}loadEvent(e){var r;const t=this,{project:i}=t,n={unit:e.durationUnit,magnitude:1},{isParent:s}=e,{durationField:a,percentDoneField:o,startDateField:l,endDateField:c,resourcesField:d}=t.widgetMap,u=(d==null?void 0:d.store.masterStore)!==i.resourceStore;a&&(a.disabled=s),o&&(o.disabled=s),l&&(l.dateField.eventRecord=e,b.compareUnits(n.unit,"hour")>0?l.dateField.step=n:l.timeField.step=n),c&&(c.dateField.eventRecord=e,b.compareUnits(n.unit,"hour")>0?c.dateField.step=n:c.timeField.step=n,c.disabled=s),d&&(d.multiSelect=(r=d.config.multiSelect)!=null?r:!i.eventStore.usesSingleAssignment,u?d.store=i.resourceStore.chain(h=>!h.isSpecialRow):d.store.resumeChain()),super.loadEvent(...arguments)}onFieldChange({source:e,valid:r,userAction:t,value:i}){if(t&&r){const{eventStore:n}=this.record,s=e.name==="resources"&&i.length===0&&this.autoUpdateRecord&&n.removeUnassignedEvent;s&&(n.removeUnassignedEvent=!1),super.onFieldChange(...arguments),s&&(n.removeUnassignedEvent=!0)}}beforeSave(){var e;this.record.resources.length===0&&this.record.eventStore.removeUnassignedEvent&&this.record.remove(),(e=this.widgetMap.resourcesField)==null||e.store.suspendChain(),super.beforeSave()}};Nb.initClass(),Nb._$name="SchedulerGeneralTab";var Oo=class extends _o{get recurrenceEditor(){return this.widgetMap.recurrenceEditor}loadEvent(e){var r;this.recurrenceEditor&&(this.loadingRecord=!0,this.recurrenceEditor.record=(r=e.recurrence)!=null?r:null,this.loadingRecord=!1),super.loadEvent(e)}onFieldChange({source:e,value:r}){const t=this;if(!t.isConfiguring&&!t.recurrenceEditor.assigningValues&&!t.loadingRecord){const{record:i}=t;i.recurrence?e===t.recurrenceEditor.widgetMap.frequencyField&&r==="NONE"?i.recurrence=null:t.recurrenceEditor.syncEventRecord(i.recurrence):i.recurrence=new i.recurrenceModel({}),t.up(n=>n.isTaskEditorBase).editingRecurring=!0}}};E(Oo,"$name","RecurrenceTab"),E(Oo,"type","recurrencetab"),E(Oo,"configurable",{title:"L{title}",cls:"b-recurrence-tab",scrollable:!0,items:{recurrenceEditor:{type:"recurrenceeditorpanel",addNone:!0}}}),Oo.initClass(),Oo._$name="RecurrenceTab";var zb=class extends gn{static get $name(){return"SchedulerAdvancedTab"}static get type(){return"scheduleradvancedtab"}static get configurable(){return{cls:"b-advanced-tab",tab:{icon:"b-icon-advanced",tooltip:"L{SchedulerAdvancedTab.Advanced}"},defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",name:"calendar",label:"L{Calendar}",weight:100},constraintTypeField:{type:"constrainttypepicker",name:"constraintType",label:"L{Constraint type}",clearable:!0,weight:200,includeAsapAlapAsConstraints:!1},constraintDateField:{type:"date",name:"constraintDate",label:"L{Constraint date}",keepTime:"entered",weight:300},manuallyScheduledField:{type:"checkbox",name:"manuallyScheduled",label:"L{Manually scheduled}",weight:400},schedulingModeField:{type:"schedulingmodecombo",name:"schedulingMode",label:"L{Scheduling mode}",hidden:!0,weight:450,allowedModes:`${Oe.Normal},${Oe.FixedDuration}`},effortDrivenField:{type:"checkbox",weight:460,name:"effortDriven",label:"L{Effort driven}",hidden:!0,cls:"b-half-width"},inactiveField:{type:"checkbox",weight:500,name:"inactive",label:"L{Inactive}"},ignoreResourceCalendarField:{type:"checkbox",weight:600,name:"ignoreResourceCalendar",label:"L{Ignore resource calendar}",cls:"b-half-width"}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get effortDrivenField(){return this.widgetMap.effortDrivenField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}get schedulingModeField(){return this.widgetMap.schedulingModeField}loadEvent(e){const r=this,{project:t}=r,i=!r.record,{calendarField:n,constraintTypeField:s}=r;s&&(s.taskRecord=e),n&&(n.store=t.calendarManagerStore,n.hidden=!t.calendarManagerStore.count),super.loadEvent(...arguments)}};zb.initClass(),zb._$name="SchedulerAdvancedTab";var kL=/(pre|post)amble/,Wb=class extends id{static get type(){return"schedulertaskeditor"}static get $name(){return"SchedulerTaskEditor"}static get defaultConfig(){return{enableEventSpanBuffer:!1,items:[{type:"tabpanel",defaultType:"formtab",ref:"tabs",flex:"1 0 100%",autoHeight:!0,layoutConfig:{alignItems:"stretch",alignContent:"stretch"},defaults:{scrollable:{overflowY:!0}},items:{generalTab:{type:"schedulergeneraltab",weight:100},recurrenceTab:{type:"recurrencetab",weight:150},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},advancedTab:{type:"scheduleradvancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}]}}processWidgetConfig(e){var r,t;return(r=e.ref)!=null&&r.match(kL)&&(e.hidden=!this.enableEventSpanBuffer),e.ref==="recurrenceTab"&&(e.hidden=!((t=this.owner)!=null&&t.enableRecurringEvents)),super.processWidgetConfig(e)}onFocusOut({relatedTarget:e}){var r;const t=(r=e==null?void 0:e.closest(".b-sch-event-wrap"))==null?void 0:r.elementData.eventRecord;if(t&&t===this.loadedRecord)this.setTimeout(()=>this.focus(),100);else return super.onFocusOut(...arguments)}};Wb.initClass(),Wb._$name="SchedulerTaskEditor";var ad=class extends Q.mixin(fe,pc,Tr,Mv){static get $name(){return"TaskEdit"}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey"],assign:["editEvent"]}}static get defaultConfig(){return{triggerEvent:"eventdblclick",editorClassMap:{[di.SchedulerBasic]:"schedulertaskeditor",[di.SchedulerPro]:"schedulertaskeditor",[di.Gantt]:"gantttaskeditor"},editorClass:null,editorConfig:null,confirmDelete:!0,saveAndCloseOnEnter:!0,blurAction:"cancel",weekStartDay:null,scrollIntoView:!0}}static get configurable(){return{items:null,suspendHasChangesEvent:!1}}construct(e,r){var t;e.taskEdit=this,super.construct(e,T.assign({weekStartDay:e.weekStartDay,enableEventSpanBuffer:(t=e.features.eventBuffer)==null?void 0:t.enabled},r)),e.ion({[this.triggerEvent]:"onActivateEditor",readOnly:"onClientReadOnlyToggle",dragCreateEnd:"onDragCreateEnd",afterEventDrop:"onEventDropped",eventResizeEnd:"onEventResized",thisObj:this})}doDestroy(){var e;this.cleanupProjectListener(),(e=this.editor)==null||e.destroy(),this.deleteConfirmationPromise&&Bi.hide(),super.doDestroy()}onClientReadOnlyToggle({readOnly:e}){this.editor&&(this.editor.readOnly=e)}get scheduler(){return this.client}getElementFromTaskRecord(e,r){return this.client.getElementFromEventRecord(e,r)}scrollEventIntoView(e,r){this.client.scrollResourceEventIntoView(r,e)}get isValid(){return this.editor.eachWidget(e=>e.isValid===!0||e.hidden||e.disabled||e.isField&&!e.name?!0:e.isValid!==!1,!0)}get project(){return this.scheduler.project}setupProjectListener(){this.cleanupProjectListener(),this.project.ion({name:"project",loadstart:()=>this.save(),dataReady:"onDataReady",thisObj:this})}cleanupProjectListener(){this.detachListeners("project")}onDataReady(){const{record:e}=this;e!=null&&e.project&&this.scheduler.taskStore.includes(e)?this.load(e,!0):this.editor.close()}get isEditing(){return!!this._editing}onActivateEditor({eventRecord:e,resourceRecord:r,eventElement:t}){e===this.record&&this.isEditing||this.editEvent(e,r,t)}async editEvent(e,r=null,t=null,i=null){var n,s;const a=this,{scheduler:o,suspendHasChangesEvent:l}=a,{project:c}=o,d=async()=>{c.resumeAutoSync(),await a.freeStm(!0),!a.isDestroyed&&(l&&!c.isDestroying&&c.resumeChangesTracking(),a._editing=!1)};e=e.isEventSegment?e.event:e;const u=!a.disabled&&!e.readOnly&&!c.isDelayingCalculation&&(e.project||!o.usesDisplayStore);if(u&&i&&(i.transferred=!0),a.isEditing&&await a.cancel(),(n=o.features.cellEdit)!=null&&n.isEditing&&o.cancelEditing(),await Promise.all([a._cancelling,a._hiding]).catch(()=>{}),!o.isGanttBase&&!r&&(r=e.resource||((s=e.resources)==null?void 0:s[0])),u){const{taskStore:h}=o;if(a._editing=!0,i?(a.applyStmCapture(i),a.hasStmCapture=!0,a.stmCapture=i):a.hasStmCapture||await a.captureStm(!0),c.suspendAutoSync(),typeof e=="function"&&(e=e()),e=e.$original,!e.isOccurrence&&!h.includes(e)&&!e.isCreating&&(e.isCreating=!0,h.add(e),r&&o.assignmentStore.assignEventToResource(e,r),await c.commitAsync(),a.isDestroyed)||a.scrollIntoView&&!o.timeAxisSubGrid.collapsed&&!t&&h.includes(e)&&(r||o.isGantt)&&(await a.scrollEventIntoView(e,r),a.isDestroyed))return;const g=t||w.down(a.getElementFromTaskRecord(e,r),o.eventInnerSelector),f=a.getEditor(e);if(await a.triggerOnClient("beforeTaskEdit",{taskEdit:a,taskRecord:e,taskElement:g})!==!1){if(a.suspendHasChangesEvent&&o.project.suspendChangesTracking(),o.element.classList.add("b-taskeditor-editing"),await c.commitAsync(),!e.isOccurrence)if(o.eventStore.includes(e))e=o.eventStore.getById(e.id);else{await d();return}if(a.isDestroyed)return;a.load(e),a.triggerOnClient("beforeTaskEditShow",{taskEdit:a,taskRecord:e,taskElement:g,editor:f});const{widgetMap:m}=f,p=e.parent&&!e.parent.isRoot;m.deleteButton&&(m.deleteButton.hidden=o.readOnly||e.isCreating||f.readOnly),o.features.nestedEvents&&(m.predecessorsTab&&(m.predecessorsTab.disabled=p),m.successorsTab&&(m.successorsTab.disabled=p),m.resourcesField&&(m.resourcesField.disabled=p)),a.setupProjectListener(),f.centered?await f.show():!o.timeAxisSubGrid.collapsed&&g&&(!o.isGanttBase||a.scrollIntoView||k.from(g).intersect(k.from(o.timeAxisSubGridElement)))?await f.showBy({target:g,anchor:!0,offset:-5}):await f.showBy({target:o.element,anchor:!1,align:"c-c",clippedBy:null})}else await d()}}prepareEditorConfig(e){return e}getEditor(e=this.record){var r,t;const i=this,{client:n}=i;let{editor:s}=i;if(!s){const a=i.prepareEditorConfig(T.merge({clippedBy:[n.timeAxisSubGridElement,n.bodyContainer],eventEditFeature:i,weekStartDay:i.weekStartDay,enableEventSpanBuffer:i.enableEventSpanBuffer,saveAndCloseOnEnter:i.saveAndCloseOnEnter,blurAction:i.blurAction,owner:n,dependencyIdField:((r=i.editorConfig)==null?void 0:r.dependencyIdField)||n.dependencyIdField,project:i.project,durationDisplayPrecision:n.durationDisplayPrecision,tabPanelItems:i.items,internalListeners:{beforeHide:{fn:"onBeforeHide",prio:-1e3},cancel:"onCancel",delete:"onDelete",save:"onSave",thisObj:i},tabsConfig:i.tabsConfig},i.editorConfig));if(!n.showTaskColorPickers&&((t=a.tabPanelItems)==null?void 0:t.generalTab)!==!1&&(a.tabPanelItems=T.merge(a.tabPanelItems||{},{generalTab:{items:{colorField:!1}}})),i.editorClass&&!a.type)s=i.editor=i.editorClass.new(a);else{const o=(e==null?void 0:e.project)||i.project,l=o.getType();s=i.editor=$.create(Object.assign({type:i.editorClassMap[l]||"schedulertaskeditor"},a))}}return s.readOnly=(n.readOnly||(e==null?void 0:e.isOccurrence)||(e==null?void 0:e.isRecurring))&&!s.editingRecurring,s.project=i.project,s}load(e,r){const t=this,i=t.getEditor(e);t._loading=!0,e.isEventSegment&&(e=e.event),t.record=e,i.loadEvent(e,r),t._loading=!1}async save(){const e=this,{scheduler:r,record:t}=e;if(e.isEditing){const i=e.getEditor();if(!e.isValid||await e.triggerOnClient("beforeTaskSave",{taskRecord:t,editor:i})===!1)return;e.cleanupProjectListener(),i.beforeSave(),t.isCreating=!1,i.resetRecurrenceData=i.editingRecurring=null;let n=!0;const s=e.freeStm(!0);if(T.isPromise(s)&&s.then(()=>n=!1),e._editing=!1,await i.close(),T.isPromise(s)&&(await s,e.isDestroying))return;r.project.resumeAutoSync(!0),r.element.classList.remove("b-taskeditor-editing"),e.triggerOnClient("afterTaskSave",{taskRecord:t,editor:i}),i.afterSave(),e.suspendHasChangesEvent&&r.project.resumeChangesTracking(n),e.triggerOnClient("afterTaskEdit",{taskRecord:t,editor:i})}}async doCancel(){var e,r,t,i;const n=this,{scheduler:s,record:a}=n;if(n.isEditing){n._editing=!1,n.cleanupProjectListener();const{project:o}=n,l=n.getEditor();if(l.editingRecurring=null,l.beforeCancel(),n.isDestroyed){(e=o.resumeAutoSync)==null||e.call(o,!1);return}if(await n.rejectStmTransaction(),a!=null&&a.isCreating&&a.remove(),n.isDestroyed){(r=o.resumeAutoSync)==null||r.call(o,!1);return}if(await o.commitAsync(),n.isDestroyed){(t=o.resumeAutoSync)==null||t.call(o,!1);return}if(n.isDestroyed){(i=o.resumeAutoSync)==null||i.call(o,!1);return}n.freeStm(),l.afterCancel(),o.resumeAutoSync(!1),s.element.classList.remove("b-taskeditor-editing"),n.trigger("afterTaskEdit"),n.triggerOnClient("taskEditCanceled",{taskRecord:a,editor:l}),n.suspendHasChangesEvent&&o.resumeChangesTracking(),n.triggerOnClient("afterTaskEdit",{taskRecord:a,editor:l})}}async cancel(){const e=this,{editor:r}=e,{resetRecurrenceData:t}=r;return t&&(t.recurringTimeSpan.exceptionDates=t.originalExceptionDates,r.resetRecurrenceData=null),e._cancelling||(e._cancelling=e.doCancel().finally(()=>e._cancelling=void 0))}async delete(){var e;const r=this,{editor:t,scheduler:i,record:n,project:s}=r;if(!(!n.isCreating&&await r.triggerOnClient("beforeTaskDelete",{taskRecord:n,editor:t})===!1)){if(r.cleanupProjectListener(),t.beforeDelete(),n.remove(),await r.commitStmTransaction(),r.isDestroyed){(e=s.resumeAutoSync)==null||e.call(s,!1);return}r.freeStm(),await s.commitAsync(),!r.isDestroyed&&(s.resumeAutoSync(!n.isCreating),r._editing=!1,t.close(),t.afterDelete(),i.element.classList.remove("b-taskeditor-editing"),r.suspendHasChangesEvent&&i.project.resumeChangesTracking(),r.triggerOnClient("afterTaskEdit",{editor:t,taskRecord:n}))}}onSave(){this.requestAnimationFrame(()=>this.save())}onCancel(){this.cancel().then()}async onDelete(){const e=this;if(e.confirmDelete){const{editor:r}=e,t=r.autoClose;r.autoClose=!1,e.deleteConfirmationPromise=Bi.confirm({title:"L{TaskEdit.ConfirmDeletionTitle}",message:"L{TaskEdit.ConfirmDeletionMessage}",okButton:"L{TaskEditorBase.Delete}",rootElement:e.rootElement});const i=await e.deleteConfirmationPromise;r.autoClose=t,e.deleteConfirmationPromise=null,i===Bi.yesButton&&e.delete()}else e.requestAnimationFrame(()=>e.delete())}onBeforeHide({source:e,animate:r}){e.hideAnimation&&r!==!1&&(this._hiding=new Promise(t=>{e.ion({hideAnimationEnd:t})}).finally(()=>this._hiding=void 0))}onDragCreateEnd({eventRecord:e,resourceRecord:r,proxyElement:t,stmCapture:i}){!this.isDestroyed&&!this.disabled&&e.isCreating&&this.editEvent(e,r,null,i)}populateEventMenu({eventRecord:e,resourceRecord:r,items:t}){this.scheduler.readOnly||(t.editEvent={text:"L{Edit task}",localeClass:this,icon:"b-icon b-icon-edit",weight:-200,disabled:this.disabled||e.readOnly,onItem:()=>this.editEvent(e,r)})}onEventEnterKey({assignmentRecord:e,eventRecord:r}){e?this.editEvent(r,e.resource):r&&this.editEvent(r,r.resource)}async triggerOnClient(e,r){const t=e.replace(/task/,"event").replace(/Task/,"Event"),i=await this.scheduler.trigger(...arguments);r.eventRecord=r.taskRecord,r.eventRecords=[r.taskRecord];const n=await this.scheduler.trigger(t,r);return i&&n}onEventDropped({eventRecords:e}){var r;const t=((r=this.editor)==null?void 0:r.loadedRecord)&&e.find(i=>i===this.editor.loadedRecord);t&&this.onEventResized({eventRecord:t})}onEventResized({eventRecord:e}){const{editor:r}=this;r!=null&&r.isVisible&&e===r.loadedRecord&&r.realign()}};ad._$name="TaskEdit",j.registerFeature(ad,!0,"SchedulerPro"),j.registerFeature(ad,!1,"ResourceHistogram");var FL={isHighlightConfig:!0,clearExisting:!1},Gb=class extends Q{constructor(){super(...arguments),E(this,"domConfigs",[]),E(this,"configs",[])}static get $name(){return"TimeSpanHighlight"}static get configurable(){return{padding:0}}static get pluginConfig(){return{assign:["highlightTimeSpan","highlightTimeSpans","unhighlightTimeSpans"],chain:["onTimeAxisViewModelUpdate"]}}construct(){super.construct(...arguments),this.client.rowManager.ion({renderDone:this.onViewChanged,thisObj:this})}highlightTimeSpan(e,r=!0){var t;const i=this,{startDate:n,endDate:s,name:a,surround:o,padding:l=i.padding,clearExisting:c=!0}=e,{client:d}=i,u=e.isTimeSpan?e:e.taskRecord;let h=e.resourceRecord||e.resource;const{animationId:g}=e;if(g&&w.addTemporaryClass(d.element,"b-transition-highlight",500,d),c&&(i.domConfigs.length=i.configs.length=0),i.disabled)return;if(o){i.surroundTimeSpan(e);return}i.configs.push(e);let f;d.isGanttBase?f=d.getScheduleRegion(u,!0,{start:n,end:s}):(h&&(h=d.store.getById(h)),f=d.getScheduleRegion(h,null,!0,{start:n,end:s},!h)),f&&(l&&(d.isHorizontal?f.inflate(l,0,l,0):f.inflate(0,l,0,l)),i.domConfigs.push(f.visualize({children:[{class:"b-sch-highlighted-range-name",html:a}],dataset:{syncId:g},class:{"b-sch-highlighted-range":1,[e.cls]:e.cls,[e.class||"b-sch-highlighted-range-default"]:1}},!0)),r&&i.draw(),(t=d.syncSplits)==null||t.call(d,m=>m.highlightTimeSpan(e,r)))}draw(){X.sync({targetElement:this.containerEl,domConfig:{onlyChildren:!0,children:this.domConfigs}})}surroundTimeSpan(e){this.highlightTimeSpans([Object.assign({},e,{animationId:(e.animationId||"")+"Before",class:"b-unavailable",surround:!1,startDate:this.client.startDate,endDate:e.startDate}),Object.assign({},e,{animationId:(e.animationId||"")+"After",class:"b-unavailable",surround:!1,startDate:e.endDate,endDate:this.client.endDate})],{clearExisting:e.clearExisting})}highlightTimeSpans(e,r={}){const t=this,{clearExisting:i=!0}=r;i&&(e=e.slice(),t.domConfigs.length=t.configs.length=0),!t.disabled&&(e.forEach(n=>{t.highlightTimeSpan(n.isHighlightConfig?n:Object.setPrototypeOf(FL,n),!1)}),t.draw())}async unhighlightTimeSpans(e=!1){var r;const t=this,{client:i}=t;e&&w.addTemporaryClass(i.element,"b-transition-highlight",500,i),Array.from(t.containerEl.children).forEach(n=>{e?(n.style.opacity=0,t.fadeOutDetacher=B.onTransitionEnd({element:n,property:"opacity",thisObj:i,handler:()=>{t.domConfigs.length=t.configs.length=0,t.draw()}})):(t.domConfigs.length=t.configs.length=0,t.draw())}),(r=i.syncSplits)==null||r.call(i,n=>n.unhighlightTimeSpans(e))}get containerEl(){return this._containerEl||(this._containerEl=w.createElement({parent:this.client.foregroundCanvas,retainElement:!0,class:"b-sch-highlight-container"})),this._containerEl}onTimeAxisViewModelUpdate(){this.onViewChanged()}onViewChanged(){this.configs.length>0&&this.highlightTimeSpans(this.configs)}updateDisabled(e,r){e&&this.unhighlightTimeSpans(),super.updateDisabled(e,r)}get featureClass(){}};Gb._$name="TimeSpanHighlight",j.registerFeature(Gb,!1,["SchedulerPro","Gantt"]);var vT=class{constructor({model:e,type:r}){var t,i,n;Object.assign(this,{id:(t=e.id)!=null?t:e.$entityName,type:(i=r==null?void 0:r.$$name)!=null?i:e.constructor.name,name:(n=e.name)!=null?n:e.$entityName}),new.target===vT&&Object.freeze(this)}},Lo=vT;E(Lo,"$name","ChangeLogEntity"),Lo._$name="ChangeLogEntity";var wg=class extends Lo{constructor({model:e,fromTask:r,toTask:t}){super({model:e,type:Ts}),Object.assign(this,{fromTask:r,toTask:t}),Object.freeze(this)}};E(wg,"$name","ChangeLogDependencyEntity"),wg._$name="ChangeLogDependencyEntity";var Eg=class extends Lo{constructor({model:e,event:r,resource:t}){super({model:e,type:Ci}),Object.assign(this,{event:r,resource:t}),Object.freeze(this)}};E(Eg,"$name","ChangeLogAssignmentEntity"),Eg._$name="ChangeLogAssignmentEntity";var yT=class{constructor({entity:e,actionType:r}){Object.assign(this,{entity:e,actionType:r}),this.constructor===yT&&Object.freeze(this)}},Si=yT;E(Si,"$name","ChangeLogAction"),Si._$name="ChangeLogAction";var bT=class extends Si{static get $name(){return"ChangeLogMoveAction"}constructor({entity:e,from:r,to:t}){super({entity:e,actionType:"move"}),Object.assign(this,{from:r,to:t}),Object.freeze(this)}};bT._$name="ChangeLogMoveAction";var CT=class extends Si{static get $name(){return"ChangeLogUpdateAction"}constructor({entity:e,propertyUpdates:r,isInitialUserAction:t}){super({entity:e,actionType:"update"}),Object.assign(this,{propertyUpdates:r,isUser:t}),Object.freeze(this)}};CT._$name="ChangeLogUpdateAction";var Fs=class extends Q.mixin(xt){constructor(){super(...arguments),E(this,"_remoteActionRanges",[]),E(this,"_comparingVersionId")}construct(e,r){super.construct(e,r);const t=this;t.versionStore=new Mo({modelClass:t.versionModelClass,internalListeners:{change:t.onStoreChangeExternal,thisObj:t},id:Mo.configurable.storeId}),t.changeStore=new Io({modelClass:t.transactionModelClass,internalListeners:{change:t.onStoreChangeExternal,thisObj:t},id:Io.configurable.storeId}),t._currentChanges=[],t.client.ion({beforeTaskDelete:t.onBeforeTaskDelete,beforeTaskSave:t.onBeforeTaskSave,gridRowBeforeDropFinalize:t.onGridRowBeforeDropFinalize,thisObj:t})}attachToProject(e){const r=this;super.attachToProject(e),e.addCrudStore([r.versionStore,r.changeStore]),e.ion({name:"project",load:r.onProjectLoad,once:!0,thisObj:r}),r.detachProjectListeners(),r.attachProjectListeners(e)}onBeforeTaskDelete(){this.transactionDescription=this.L("L{Versions.deletedTask}")}onBeforeTaskSave(){this.transactionDescription=this.L("L{Versions.editedTask}")}onGridRowBeforeDropFinalize({context:{valid:e,records:r}}){e&&(this.transactionDescription=r.length===1?this.L("L{Versions.movedTask}"):this.L("L{Versions.movedTasks}"))}attachProjectListeners(e){var r;const t=this;(r=e==null?void 0:e.stm)==null||r.ion({recordingStart:t.onStmRecordingStart,recordingStop:t.handleTransactionStop,restoringStop:t.onStmRestoringStop,thisObj:t,name:"stmListeners"}),e==null||e.ion({wsBeforeReceiveChanges:t.onBeforeApplyRemoteChanges,wsReceiveChanges:t.onAfterApplyRemoteChanges,thisObj:t,name:"stmListeners"})}detachProjectListeners(){this.detachListeners("stmListeners")}updateVersionModelClass(e){if(!e.isVersionModel)throw new Error("versionModelClass config must be a subclass of SchedulerPro.model.VersionModel.")}updateTransactionModelClass(e){if(!e.isChangeLogTransactionModel)throw new Error("transactionModelClass config must be a subclass of SchedulerPro.model.changelog.ChangeLogTransactionModel.")}onStoreChangeExternal(){this.triggerVersionChange()}tryAutoSave(){const e=this,{project:r}=e.client;e.changeStore.find(({versionId:t})=>!t)&&(r!=null&&r.wsSend?(r.wsSend("requestVersionAutoSave",{project:r.wsProjectId}),e.detachListeners("autoSave"),r.ion({name:"autoSave",wsVersionAutoSaveOK:e.autoSave,thisObj:e,once:!0})):e.saveVersionWithConfig({isAutosave:!0}))}autoSave(){this.saveVersionWithConfig({isAutosave:!0})}autoSaveHourly(){new Date().getMinutes()===0&&this.tryAutoSave()}updateAutoSaveInterval(e){const r=this,{client:t}=r;r._autoSaveInterval&&t.clearInterval(r._autosaveInterval),e==="hourly"?r._autoSaveInterval=t.setInterval(r.autoSaveHourly.bind(r),10*1e3):e&&(r._autoSaveInterval=t.setInterval(r.tryAutoSave.bind(r),e*60*1e3))}saveVersion(e=null){return this.saveVersionWithConfig({name:e})}saveVersionWithConfig(e){const r=this,t=r.captureVersionContent(),i=new r.versionModelClass({savedAt:new Date,content:t,...e});return i.onBeforeSave(),r.versionStore.add(i),r.changeStore.query(n=>n.versionId==null).forEach(n=>n.versionId=i.id),r.triggerVersionChange(),r.triggerTransactionChange(),i}async loadVersionContent(e){const r=this,{client:t}=r,{project:i}=t,n={version:e,content:null};if(await r.trigger("beforeLoadVersionContent",{context:n})){if(i!=null&&i.wsSend){i.wsSend("loadVersionContent",{project:i.wsProjectId,versionId:e.id});const s=await new Promise((a,o)=>{const l=Date.now();i.ion({name:"loadVersionContent",loadVersionContent({project:c,versionId:d,content:u}){if(c===i.wsProjectId&&d===e.id)return i.detachListeners("loadVersionContent"),a(u)},thisObj:r,expires:{delay:r.versionContentLoadTimeout-(Date.now()-l),alt:()=>o(`Failed to receive version content within ${this.versionContentLoadTimeout} ms`)}})});return s&&r._versionContentCache.set(e.id,s),s}}else if(n.content)return n.content}async getVersionContent(e){var r;return(r=e.content)!=null?r:await this.loadVersionContent(e)}triggerTransactionChange(){this.client.trigger("transactionChange",{hasUnattachedTransactions:this.hasUnattachedTransactions})}triggerVersionChange(){this.client.trigger("versionChange",{versions:this.versionStore.records})}captureVersionContent(){return this.client.project.toJSON()}async restoreVersion(e){var r,t,i,n;const s=await this.getVersionContent(e),{project:a}=this.client,o=(r=a.stm)==null?void 0:r.enabled;(t=a.stm)==null||t.disable(),a.json=s,await a.commitAsync(),o&&((i=a.stm)==null||i.enable()),(n=a.stm)==null||n.resetQueue()}async compareVersion(e){var r,t,i;const n=await this.getVersionContent(e),s={},{project:a}=this.client,o=(r=a.stm)==null?void 0:r.enabled;(t=a.stm)==null||t.disable();for(const l of n.eventsData)Rn.preWalk(l,c=>c.children,({id:c,startDate:d,endDate:u})=>{s[c]={startDate:d,endDate:u}});a.taskStore.traverse(l=>{s[l.id]&&(l.baselines.removeAll(),l.baselines.loadData([{task:l,...s[l.id]}]))}),o&&((i=a.stm)==null||i.enable()),this._comparingVersionId=e.id}stopComparing(){var e,r,t;if(!this._comparingVersionId)return;const{project:i}=this.client,n=(e=i.stm)==null?void 0:e.enabled;(r=i.stm)==null||r.disable(),i.taskStore.traverse(s=>{s.baselines.removeAll()}),n&&((t=i.stm)==null||t.enable()),this._comparingVersionId=null}doDisable(e){super.doDisable(e),e?this.detachProjectListeners():this.attachProjectListeners(this.client.project),this.client.refresh()}getEntityDescriptor(e){var r;const t=(r=this.knownBaseTypes.find(i=>e instanceof i))!=null?r:e.constructor;return e.isDependencyModel?new wg({model:e,fromTask:this.getEntityDescriptor(e.fromTask),toTask:this.getEntityDescriptor(e.toTask)}):e.isAssignmentModel?new Eg({model:e,event:this.getEntityDescriptor(e.event),resource:this.getEntityDescriptor(e.resource)}):new Lo({model:e,type:t})}getUpdateAction(e){const r=e[0].model,t=e.flatMap(({newData:a,oldData:o})=>Object.entries(a).map(([l,c])=>({property:l,value:c,oldValue:o[l]})).filter(({property:l,value:c,oldValue:d})=>{var u;return!T.isEqual(c,d)&&((u=r.getFieldDefinition(l))==null?void 0:u.persist)})),i=H.groupBy(t,"property"),n=Object.entries(i).map(([a,o])=>({property:a,before:o[0].oldValue,after:o[o.length-1].value})),s=e.some(({isInitialUserAction:a})=>a);return new CT({actionType:"update",entity:this.getEntityDescriptor(r),propertyUpdates:n,isInitialUserAction:s})}onProjectLoad(){this._currentStmTransaction=null,this.stopTransaction()}onStmRecordingStart({transaction:e}){this._transactionStart=new Date,this._currentStmTransaction=e,this.triggerTransactionChange()}stopTransaction(){var e,r;(e=this.client.project)!=null&&e.stm.isRecording&&((r=this.client.project)==null||r.stm.stopTransaction()),this.handleTransactionStop()}async onStmRestoringStop({cause:e,transactions:r}){const t=this;e==="undo"?t.transactionDescription=t.L("L{undid}"):e==="redo"&&(t.transactionDescription=t.L("L{redid}")),await t.client.project.commitAsync(),t._transactionStart=new Date,t.finalizeTransaction({queue:r.flatMap(i=>i.queue)})}onBeforeApplyRemoteChanges(){var e,r;this._remoteChangesStartPos==null&&(this._remoteChangesStartPos=(r=(e=this._currentStmTransaction)==null?void 0:e.queue.length)!=null?r:0)}async onAfterApplyRemoteChanges(){this.endCurrentRemoteActionRange(),await this.client.project.commitAsync()}endCurrentRemoteActionRange(){var e,r;const t=this;if(t._remoteChangesStartPos!=null){const i=(r=(e=t._currentStmTransaction)==null?void 0:e.queue.length)!=null?r:0;i!==t._remoteChangesStartPos&&t._remoteActionRanges.push({start:t._remoteChangesStartPos,end:i}),t._remoteChangesStartPos=null}}handleTransactionStop(){const e=this;e.hasChanges&&e.finalizeTransaction(e._currentStmTransaction),e._currentTransactionDescription=null,e._currentStmTransaction=null,e._remoteActionRanges=[],e.triggerTransactionChange()}excludeRanges(e,r){let t=[],i=0;for(const{start:n,end:s}of r)t=t.concat(e.slice(i,n)),i=s;return t.concat(e.slice(i))}finalizeTransaction(e){const r=this;r.endCurrentRemoteActionRange();const t=r.excludeRanges(e.queue,r._remoteActionRanges);if(t.length===0)return;const i=({model:o})=>o.$entityName,n=H.groupBy(t,"type"),s=[];for(const o of["UpdateAction","EventUpdateAction"]){const l=H.groupBy(n[o]||[],i);for(const c of Object.values(l))s.push(r.getUpdateAction(c))}for(const{modelList:o,isInitialUserAction:l}of n.RemoveAction||[])for(const c of o)s.push(new Si({actionType:"remove",entity:r.getEntityDescriptor(c),isInitialUserAction:l}));for(const{childModels:o}of n.RemoveChildAction||[])for(const l of o)s.push(new Si({actionType:"remove",entity:r.getEntityDescriptor(l)}));for(const{modelList:o}of n.AddAction||[])for(const l of o)s.push(new Si({actionType:"add",entity:r.getEntityDescriptor(l)}));for(const{childModels:o,parentModel:l,context:c,insertIndex:d}of n.InsertChildAction||[])for(const u of o){const h=c.get(u);h!=null?s.push(new bT({actionType:"move",entity:r.getEntityDescriptor(u),from:{parent:r.getEntityDescriptor(h.parent),index:h.index},to:{parent:r.getEntityDescriptor(l),index:d}})):s.push(new Si({actionType:"add",entity:r.getEntityDescriptor(u)}))}const a=new r.transactionModelClass({description:r._currentTransactionDescription,actions:s,occurredAt:r._transactionStart});r.changeStore.add(a)}set transactionDescription(e){this._currentTransactionDescription=e}get hasChanges(){var e,r;return((r=(e=this._currentStmTransaction)==null?void 0:e.queue)==null?void 0:r.length)>0}get hasUnattachedTransactions(){return this.changeStore.find(e=>e.versionId==null)}get isComparing(){return this._comparingVersionId!=null}};E(Fs,"$name","Versions"),E(Fs,"configurable",{versionModelClass:To,transactionModelClass:Is,autoSaveInterval:"hourly",knownBaseTypes:[Ci,Ts,Ro],versionContentLoadTimeout:6e4}),Fs._$name="Versions",j.registerFeature(Fs,!1,"SchedulerPro");var Ub=class{constructor({property:e,before:r,after:t}){Object.assign(this,{property:e,before:r,after:t}),Object.freeze(this)}};E(Ub,"$name","ChangeLogPropertyUpdate"),Ub._$name="ChangeLogPropertyUpdate";var Yb=(e,r,t)=>{const i=t.getFieldDefinition(e),{dataSource:n}=i,s=t.constructor.processField(e,r[n],t);return n in r&&!i.isEqual(s,t.getValue(e))},qb=e=>class extends(e||F){startConfigure(t){this.getConfig("project"),super.startConfigure(t)}beforeApplyProjectChanges(){const{stm:t}=this;let i=!1,n=null;return this.suspendChangesTracking(),t.enabled&&(i=!0,t.isRecording&&(n=t.stash()),this.ignoreRemoteChangesInSTM?t.disable():t.startTransaction()),{shouldResume:i,transactionId:n}}async applyProjectChanges(t){var i,n;const s=this,{shouldResume:a,transactionId:o}=s.beforeApplyProjectChanges();s.trigger("startApplyChangeset"),s.applyingChangeset=!0,t.project&&s.applyProjectResponse(t.project),s.applyChangeset(T.clone(t),(l,c)=>{if(c.id==="tasks"||c.id==="events"){const{modelClass:d}=c,u=d.getFieldDataSource("startDate"),h=d.getFieldDataSource("endDate");if(l.updated)for(const g of l.updated){const f=c.getById(g[d.idField]);Yb("constraintType",g,f)||Yb("constraintDate",g,f)||(delete g[u],delete g[h])}}}),await s.commitAsync(),s.commitRespondedChanges();for(const l in t){const c=s.getStoreDescriptor(l);if(c){const{store:d}=c,u=t[l],h=[...(i=u.updated)!=null?i:[],...(n=u.added)!=null?n:[]];if(d)for(const g of h){const f=d.getById(g[d.modelClass.idField]);if(f)for(const m in f.modifications)Yb(m,g,f)||delete f.meta.modified[m]}}}s.afterApplyProjectChanges(a,o),s.applyingChangeset=!1,await s.commitAsync(),s.trigger("endApplyChangeset")}afterApplyProjectChanges(t,i){if(t){const{stm:n}=this;this.ignoreRemoteChangesInSTM?n.enable():n.stopTransaction(),n.applyStash(i)}this.resumeChangesTracking()}},xg=class extends qb(Eb(vv(lg))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{calendarModelClass:Zc,dependencyModelClass:Ts,eventModelClass:Jc,assignmentModelClass:Ci,resourceModelClass:Ro,calendarManagerStoreClass:hg,dependencyStoreClass:gg,eventStoreClass:pg,assignmentStoreClass:xo,resourceStoreClass:vg,calendarsData:null,supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/schedulerpro/docs/api/SchedulerPro/model/ProjectModel#config-supportShortSyncResponse)',delayCalculation:!0,calendarManagerStore:{},stmClass:yg}}static get configurable(){return{calendars:null}}get taskStore(){return this.eventStore}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}};xg._$name="ProjectModel";var ST=e=>{var r;return r=class extends(e||F){doDestroy(){var t;(t=this.websocketManager)==null||t.destroy(),super.doDestroy()}updateWsAddress(t){var i;const n=this;(i=n.websocketManager)==null||i.destroy(),t&&(n.websocketManager=new wl({address:t,userName:n.wsUserName,internalListeners:{message:"handleWebsocketMessage",close:"handleWebsocketClose",error:"handleWebsocketError",thisObj:n}}),n.wsAutoLoad&&n.wsLoad()),n.toggleAutoSyncListener()}toggleAutoSyncListener(){const t=this;t.detachListeners("websocketlisteners"),t._wsAutoSync&&t._wsAddress&&t.ion({name:"websocketlisteners",hasChanges:"scheduleWebsocketMessage"})}updateWsAutoSync(){this.toggleAutoSyncListener()}updateWsProjectId(t){t!=null&&this.wsAutoLoad&&this.wsLoad()}scheduleWebsocketMessage(){const t=this;!t.hasTimeout("wsAutoSync")&&!t.isAutoSyncSuspended&&t.setTimeout({name:"wsAutoSync",fn:()=>{t.wsSync()},delay:t.autoSyncTimeout})}resumeAutoSync(t=!0){super.resumeAutoSync(t),this.websocketManager&&!this.isAutoSyncSuspended&&this.changes&&this.wsSync()}async wsSend(t,i,n=!1){return await this.wsOpen()?(this.websocketManager.send(t,i),n||this.trigger("wsSendMessage",{command:t,data:i}),!0):!1}wsReceive(t){}handleWebsocketClose(){this.trigger("wsClose")}handleWebsocketError({error:t}){this.trigger("wsError",{error:t})}async handleWebsocketMessage({data:t}){const i=this,{wsProjectId:n}=i,{project:s}=t;if(i.trigger("wsMessage",{data:t}),s===n&&t.command==="projectChange")i.trigger("wsBeforeReceiveChanges"),await i.queue(()=>i.applyProjectChanges(t.changes)),i.trigger("wsReceiveChanges");else if(s===n&&t.command==="dataset")await i.loadInlineData(t.dataset),i.trigger("wsReceiveDataset");else if(s===n&&t.command==="versionAutoSaveOK")i.trigger("wsVersionAutoSaveOK");else if(s===n&&t.command==="loadVersionContent"){const{versionId:a,project:o,content:l}=t;i.trigger("loadVersionContent",{versionId:a,project:o,content:l})}else i.wsReceive(t)}async wsOpen(){const{websocketManager:t}=this;return t?(!t.isOpened&&await t.open()&&this.trigger("wsOpen"),t.isOpened):!1}async wsLoad(){const t=this;t.wsProjectId!=null&&(await t.wsSend("dataset",{project:t.wsProjectId}),await new Promise(i=>{const n=t.ion({wsReceiveDataset(){n(),i(!0)},expires:{delay:t.wsConnectionTimeout,alt:()=>{n(),i(!1)}}})}),await t.commitAsync(),t.trigger("wsLoad"))}async wsSync(){const t=this,{wsProjectId:i}=t;if(i==null)return;await this.commitAsync();const{changes:n}=this;n&&t.wsAutoSync&&!t.autoSyncSuspendCounter&&(t.acceptChanges(),await t.wsSend("projectChange",{project:i,changes:n})&&t.trigger("wsSendChanges"))}wsClose(){var t;(t=this.websocketManager)==null||t.close()}},E(r,"configurable",{wsAddress:null,wsUserName:"",wsAutoLoad:!0,wsAutoSync:!0,wsConnectionTimeout:6e4,wsProjectId:null}),r},Kb=e=>{var r;return r=class extends(e||F){static get $name(){return"ProjectProgressMixin"}updateProject(t,i){super.updateProject(t,i),this.setupProgressListener(),this.detachListeners("delayedCalculation"),t!=null&&t.delayCalculation&&t.ion({name:"delayedCalculation",delayCalculationStart:"internalOnProjectDelayCalculationStart",delayCalculationEnd:"internalOnProjectDelayCalculationEnd",thisObj:this})}setupProgressListener(){var t;const i=this;i.detachListeners("projectProgress"),i.projectProgressReporting&&((t=i.project)==null||t.ion({name:"projectProgress",progress:"onProjectProgress",thisObj:i}))}updateProjectProgressReporting(){this.isConfiguring||this.setupProgressListener()}onProjectProgress({total:t,remaining:i,phase:n="propagating"}){const s=this;if(!s.isPainted||t<s.projectProgressThreshold)return;let a=s.projectProgressReporting;if(a==="auto"&&(a=s.project.delayCalculation?"progressbar":"mask"),a==="progressbar"){let o=s.calculationProgressElement;o||(o=s.calculationProgressElement=w.createElement({parent:s.timeAxisSubGrid.header.element,retainElement:!0,className:"b-calculation-progress-wrap",children:[{className:"b-calculation-progress"}]})),o.firstElementChild.style.width=`${(t-i)/t*100}%`,t>0&&i===0?s.calculationProgressTimeout=s.setTimeout(()=>{o==null||o.remove(),s.calculationProgressElement=null},50):s.clearTimeout(s.calculationProgressTimeout)}else{const o=s.L(`L{SchedulerProBase.${n}}`),l=t?`${o} ${Math.round(100*(t-i)/t)}%`:o;s.masked||s.mask({maxProgress:t,useTransition:!1,text:l}),s.masked.text=l,t&&(s.masked.maxProgress=t,s.masked.progress=t-i),t>0&&i===0&&s.unmask()}}internalOnProjectDelayCalculationStart(){this.readOnly||(this.$delayCalculationReadOnly=this.readOnly=!0)}internalOnProjectDelayCalculationEnd(){this.$delayCalculationReadOnly&&(this.$delayCalculationReadOnly=this.readOnly=!1)}get widgetClass(){}},E(r,"configurable",{projectProgressReporting:"auto",projectProgressThreshold:5e3}),r},DT=e=>class extends(e||F){static get $name(){return"SchedulerProEventRendering"}static get configurable(){return{eventLayout:"stack",horizontalLayoutPackClass:Tb,horizontalLayoutStackClass:Rb}}updateInternalEventLayout(t,i){const n=this;n.isConfiguring||n.clearLayouts(),super.updateInternalEventLayout(t,i)}getEventLayout(t){return t=super.getEventLayout(t),"layoutFn"in t&&(t.type="layoutFn"),t}clearLayouts(){const t=this;if(t.layouts)for(const i in t.layouts)t.layouts[i].destroy(),delete t.layouts[i]}getEventLayoutHandler(t){const i=this;if(!i.isHorizontal)return null;const{timeAxisViewModel:n,horizontal:s}=i;i.layouts||(i.layouts={});const{layouts:a}=i;switch(t.type){case"stack":return a.horizontalStack||(a.horizontalStack=i.horizontalLayoutStackClass.new({scheduler:i,timeAxisViewModel:n,bandIndexToPxConvertFn:s.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:s,groupByThisObj:i},t)),a.horizontalStack;case"pack":return a.horizontalPack||(a.horizontalPack=i.horizontalLayoutPackClass.new({scheduler:i,timeAxisViewModel:n,bandIndexToPxConvertFn:s.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:s,groupByThisObj:i},t)),a.horizontalPack;case"layoutFn":return{type:"layoutFn",scheduler:i,applyLayout:t.layoutFn,layoutEventsInBands:t.layoutFn};default:return null}}get widgetClass(){}},od=class extends ht{static get $name(){return"SchedulingIssueResolutionPopup"}static get type(){return"schedulingissueresolutionpopup"}static get configurable(){return{localizableProperties:[],schedulingIssue:null,align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onCloseButtonClick",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!1,closable:!0,floating:!0,cls:"b-schedulerpro-issueresolutionpopup",layout:"vbox",resolutionsGroup:{type:"radiogroup",name:"resolutions"},items:{description:{type:"widget",cls:"b-error-description",weight:-100}},bbar:{defaults:{localeClass:this},items:{applyButton:{weight:100,color:"b-raised b-blue",text:"L{Apply}",onClick:"up.onApplyButtonClick",disabled:!0},cancelButton:{weight:200,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get selectedResolutions(){var e,r;const t=new Set,i=(r=(e=this.resolutionsGroup)==null?void 0:e.selected)==null?void 0:r.resolution;return i&&t.add(i),t}changeResolutionsGroup(e,r){return hu.reconfigure(r,e,this)}updateResolutionsGroup(e){e&&this.add(e)}getResolutionParameters(e){return[]}onApplyButtonClick(){const e=this,{selectedResolutions:r}=e;r.size?(r.forEach(t=>t.resolve(...e.getResolutionParameters(t))),e.continueWithResolutionResult(sr.Resume),e.doResolve(r)):e.onCancelButtonClick()}onCancelButtonClick(){this.continueWithResolutionResult(sr.Cancel),this.doResolve()}onCloseButtonClick(){this.canCancel&&this.onCancelButtonClick()}get isResolving(){return!!this.resolving}async resolve({source:e,schedulingIssue:r,continueWithResolutionResult:t}){const i=this;return i.project=e,i.schedulingIssue=r,i.continueWithResolutionResult=t,i.updatePopupContent(r,t),i.onResolutionChange({}),i.show(),i.resolving=new gl,i.resolving.promise}doResolve(e){const r=this,{resolving:t}=r;t&&(r.resolving.resolve(e),r.resolving=null,r.schedulingIssue=null,r.hide())}getResolutionWidgetConfig(e){return{text:O.encodeHtml(e.getDescription()),cls:"b-resolution",checkedValue:e.$$name,localeClass:this,name:"resolutions",internalListeners:{change:"up.onResolutionChange"},resolution:e}}getResolutions(){var e;return(e=this.schedulingIssue)==null?void 0:e.getResolutions()}updatePopupContent(e,r){var t;const i=this,{resolutionsGroup:n}=i;r&&(i.continueWithResolutionResult=r),e?i.schedulingIssue=e:e=i.schedulingIssue,i.title=e!=null&&e.type?i.optionalL(e.type):"Unknown error",i.widgetMap.description.content=e&&O.encodeHtml(e.getDescription());const s=i.getResolutions(),a=(s==null?void 0:s.map(l=>i.getResolutionWidgetConfig(l)))||[],o=((t=a[0])==null?void 0:t.name)||"resolutions";n.removeAll(),n.name=o,n.add(...a,{ref:"cancelResolution",text:"L{Cancel changes}",name:o,checkedValue:"cancel",localeClass:this,cls:"b-resolution",internalListeners:{change:"up.onResolutionChange"}}),i.toggleControlsState()}get canApply(){return this.resolutionsGroup.value!=null}get canCancel(){var e;return!((e=this.project)!=null&&e.isInitialCommit)}get cancelResolution(){return this.resolutionsGroup.widgetMap.cancelResolution}onResolutionChange(){this.toggleControlsState()}toggleControlsState(){const e=this,{applyButton:r,cancelButton:t}=e.widgetMap;r.disabled=!e.canApply,e.cancelResolution.hidden=t.hidden=!e.canCancel}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}};od.initClass(),od._$name="SchedulingIssueResolutionPopup";var Rg=class extends od{static get $name(){return"CycleResolutionPopup"}static get type(){return"cycleresolutionpopup"}getDependencyTitle(e){return`"${O.encodeHtml(e.fromEvent.name)}" -> "${O.encodeHtml(e.toEvent.name)}"`}getResolutionWidgetConfig(e){const{dependency:r}=e,t=this.schedulingIssue.getInvalidDependencies(),i=super.getResolutionWidgetConfig(e);return t.includes(r)&&Object.assign(i,{name:"dependency-resolution",checked:!this._dependencyResolutionsChecked++}),i}getResolutions(){const{schedulingIssue:e}=this,r=e==null?void 0:e.getInvalidDependencies();let t=e==null?void 0:e.getResolutions();return t&&r.length&&(t=t.filter(i=>i.dependency&&r.includes(i.dependency))),t}updatePopupContent(e,r){const t=this,{invalidDependenciesDescription:i,dependencyField:n}=t.widgetMap;if(t._dependencyResolutionsChecked=0,super.updatePopupContent(...arguments),i==null||i.hide(),n==null||n.hide(),e=t.schedulingIssue,e){const s=e.getDependencies(),a=e.getInvalidDependencies(),o=s.filter(l=>!a.includes(l));if(a.length)i?i.show():t.add({type:"widget",ref:"invalidDependenciesDescription",weight:-50,width:"100%",cls:"b-invalid-dependencies-description",html:t.L("L{invalidDependencyLabel}")});else{const l=o==null?void 0:o.map(c=>({value:c.id,text:t.getDependencyTitle(c)}));n?(n.value=null,n.items=l,n.show()):t.add({type:"combo",ref:"dependencyField",weight:50,width:"100%",name:"dependency",label:t.L("L{dependencyLabel}"),labelPosition:"above",cls:"b-dependency-field",items:l,internalListeners:{change:"up.onDependencyChange"}})}}}get canApply(){const{widgetMap:e}=this;return super.canApply&&(e.cancelResolution.checked||!e.dependencyField||e.dependencyField.value)}onDependencyChange(){this.toggleControlsState()}getResolutionParameters(e){if(e.isRemoveDependencyCycleEffectResolution||e.isDeactivateDependencyCycleEffectResolution){const r=this.widgetMap.dependencyField.value;return[this.project.dependencyStore.getById(r)]}return super.getResolutionParameters(e)}};Rg.initClass(),Rg._$name="CycleResolutionPopup";var Xb=e=>class extends(e||F){static get $name(){return"SchedulingIssueResolution"}static get configurable(){return{schedulingIssueResolutionPopupClass:od,cycleResolutionPopupClass:Rg,displaySchedulingIssueResolutionPopup:!0}}updateProject(t,i){super.updateProject(t,i),this.unbindSchedulingIssueResolutionFromProject(i),this.displaySchedulingIssueResolutionPopup&&t&&this.bindSchedulingIssueResolutionToProject(t)}bindSchedulingIssueResolutionToProject(t){t.ion({name:"schedulingIssueResolution",schedulingConflict:"onProjectSchedulingIssueEvent",emptyCalendar:"onProjectSchedulingIssueEvent",cycle:"onProjectSchedulingIssueEvent",thisObj:this})}get isResolving(){var t;return(t=this._lastSchedulingIssueResolutionPopup)==null?void 0:t.isResolving}get activeSchedulingIssueResolutionPopup(){return this.isResolving&&this._lastSchedulingIssueResolutionPopup}unbindSchedulingIssueResolutionFromProject(t){this.detachListeners("schedulingIssueResolution")}getSchedulingIssueResolutionPopup(t){return t.type==="cycle"?this._cycleResolutionPopup||(this._cycleResolutionPopup=new this.cycleResolutionPopupClass({rootElement:this.rootElement})):this._schedulingIssueResolutionPopup||(this._schedulingIssueResolutionPopup=new this.schedulingIssueResolutionPopupClass({rootElement:this.rootElement}))}onProjectSchedulingIssueEvent({schedulingIssue:t}){const i=this.getSchedulingIssueResolutionPopup(t);this._lastSchedulingIssueResolutionPopup=i,i.resolve(...arguments)}get widgetClass(){}};function wT(e){return{allocation:{total:e}}}var Os=class extends ao.mixin(Dv,Cv,sh){get timeAxis(){return super.timeAxis}set timeAxis(e){const r=this._timeAxis;super.timeAxis=e,!(this.partner&&!e||r&&r===e)&&this._timeAxis.ion({name:"timeAxis",endReconfigure:"onTimeAxisEndReconfigure",thisObj:this})}afterConfigure(){super.afterConfigure();const e=this;e.onRecordAllocationCalculated=e.onRecordAllocationCalculated.bind(e),e.onCommitAsyncCompletion=e.onCommitAsyncCompletion.bind(e)}onDestroy(){var e,r;super.onDestroy(...arguments);const t=(r=(e=this.project).getGraph)==null?void 0:r.call(e);t&&this.ticksIdentifier&&t.removeIdentifier(this.ticksIdentifier)}clearHistogramDataCache(e){var r,t;if(!e)for(const[i,n]of(r=this.getHistogramDataCache())==null?void 0:r.entries())(t=i.removeEntity)==null||t.call(i,n);super.clearHistogramDataCache(...arguments)}bindProject(e){this.detachListeners("resourceHistogramProject"),e.ion({name:"resourceHistogramProject",refresh:"internalOnProjectRefresh",delayCalculationStart:"onProjectDelayCalculationStart",delayCalculationEnd:"onProjectDelayCalculationEnd",repopulateReplica:"onRepopulateReplica",thisObj:this})}updateProject(e){this.bindProject(e),this.crudManager=e,this.store=e.resourceStore}getRowHeight(){return this.rowHeight}convertEffortUnit(e,r,t){return this.project.run("$convertDuration",e,r,t)}updateUseProjectTimeUnitsForScale(){const e=this;if(e.isPainted){const r={scalePoints:e.generateScalePoints()};e.trigger("generateScalePoints",r),e._generatedScalePoints=e.scalePoints=r.scalePoints,e.scheduleRefreshRows()}}updateShowBarText(e){this.scheduleRefreshRows()}get eventStore(){var e;return(e=this.project)==null?void 0:e.eventStore}set eventStore(e){super.eventStore=e}convertUnitsToHistogramValue(e,r){return this.useProjectTimeUnitsForScale?this.convertEffortUnit(e,r,ee.Millisecond):b.asMilliseconds(e,r)}convertHistogramValueToUnits(e,r){return this.useProjectTimeUnitsForScale?this.convertEffortUnit(e,ee.Millisecond,r):b.as(r,e)}buildScalePointText(e){return`${e.value}${b.getShortNameOfUnit(e.unit)}`}generateScalePoints(e,r){var t;if(!((t=this.project)!=null&&t.graph))return;const{timeAxis:i}=this,n=[];e=e||i.increment,r=r||i.unit;let s;e===1&&(r=b.getSmallerUnit(r),e=Math.round(this.useProjectTimeUnitsForScale?this.convertEffortUnit(e,i.unit,r):b.as(r,e,i.unit)));for(const o of[7,5,4,3,2])if(!(e%o)){s=e/o;break}s||(s=e);for(let o=s;o<=e;o+=s)n.push({value:o});const a=n[n.length-1];return a.unit=r,a.text=this.buildScalePointText(a),n}updateViewPreset(e){const r=this;r._updatingViewPreset=!0,super.updateViewPreset(...arguments),r._updatingViewPreset=!1,r.project.isInitialCommitPerformed&&r.isPainted&&r.onTimeAxisEndReconfigure()}onRepopulateReplica(){this.ticksIdentifier=null,this.clearHistogramDataCache()}buildTicksIdentifier(){const e=this,r=e.project.getGraph();if(!e.ticksIdentifier)e.ticksIdentifier=r.addIdentifier(Mr.new());else{const t=r.read(e.ticksIdentifier);e.project.clearCombinationsWith(t)}return e.ticksIdentifier.writeToGraph(r,new Ss({unspecifiedTimeIsWorking:!1,intervals:e.timeAxis.ticks.map(t=>({startDate:t.startDate,endDate:t.endDate,isWorking:!0}))})),e.collectTicksWidth(),e.ticksIdentifier}onProjectDelayCalculationStart(){this.suspendRefresh()}onProjectDelayCalculationEnd(){this.resumeRefresh()}projectUnitsHasChanged(){const{project:e}=this;return e.daysPerMonth!==this._projectDaysPerMonth||e.daysPerWeek!==this._projectDaysPerWeek||e.hoursPerDay!==this._projectHoursPerDay}internalOnProjectRefresh({source:e,isInitialCommit:r,isCalculated:t}){if(t){const i=this;if(i.ticksIdentifier||i.onTimeAxisEndReconfigure(),i.useProjectTimeUnitsForScale&&i.projectUnitsHasChanged()){i._projectDaysPerMonth=e.daysPerMonth,i._projectDaysPerWeek=e.daysPerWeek,i._projectHoursPerDay=e.hoursPerDay;const n={scalePoints:i.generateScalePoints()};i.trigger("generateScalePoints",n),i._generatedScalePoints=i.scalePoints=n.scalePoints}i.rowManager.topRow?i.resumeRefresh(r):i.rowManager.reinitialize()}}relayStoreDataChange(e){super.relayStoreDataChange(e),this.store.count===0&&(this.histogramWidget.data=[],this.histogramWidget.refresh())}changeHistogramWidget(e,r){const t=this;if(!r){const{series:i}=t;!t.showMaxEffort&&i.maxEffort&&(i.maxEffort=!1),e=super.changeHistogramWidget(...arguments)}return e}getRectConfig(e,r,t,i){if(r.inEventTimeSpan){const{topValue:n}=this,s=r[i.field],a=i.stretch?1:r.height;return e.height=a||(s>n?n:s)/n,e.y=1-e.height,e}}getRectClassDefault(e,r,t){if(e.id==="effort")switch(!0){case t.isOverallocated:return"b-overallocated";case t.isUnderallocated:return"b-underallocated"}return""}get effortFormatter(){const e=this,r=e.effortFormat;let t=e._effortFormatter;return(!t||e._effortFormat!==r)&&(t=Rr.get(e._lastFormat=r),e._effortFormatter=t),t}getEffortText(e,r,t=this.showEffortUnit){var i;if(!((i=this.project)!=null&&i.graph))return;const{scaleUnit:n,effortFormatter:s}=this;r=r||n;const a=b.getShortNameOfUnit(r),o=this.convertHistogramValueToUnits(e,r);return s.format(o)+(t?a:"")}getBarTipEffortUnit(){const{effortUnit:e,barTipEffortUnit:r,timeAxis:t}=this,i=r||e;return b.compareUnits(t.unit,i)<0?t.unit:i}getGroupBarTip({datum:e}){const r=this,{timeAxis:t}=r;let i="";if(e.inEventTimeSpan){const n=r.getBarTipEffortUnit(...arguments),s=r.getEffortText(e.effort,n),a=r.getEffortText(e.maxEffort,n),o=r.L("L{groupBarTipAssignment}");let l="L",c=r.L("L{groupBarTipInRange}"),d="";b.compareUnits(t.unit,ee.Day)===0?c=r.L("L{groupBarTipOnDate}"):b.compareUnits(t.unit,ee.Second)<=0?l="HH:mm:ss A":b.compareUnits(t.unit,ee.Hour)<=0&&(l="LT");let u=[...e.resourceAllocation.entries()].filter(([g,f])=>f.effort).sort(([g,f],[m,p])=>f.effort>p.effort?-1:1);u.length>r.groupBarTipAssignmentLimit&&(d="<br>"+r.L("L{plusMore}").replace("{value}",u.length-r.groupBarTipAssignmentLimit),u=u.slice(0,this.groupBarTipAssignmentLimit));const h=u.map(([g,f])=>o.replace("{resource}",O.encodeHtml(g.name)).replace("{allocated}",r.getEffortText(f.effort,n)).replace("{available}",r.getEffortText(f.maxEffort,n)).replace("{cls}",f.isOverallocated?"b-overallocated":f.isUnderallocated?"b-underallocated":"")).join("<br>")+d;i=c.replace("{assignments}",h).replace("{startDate}",b.format(e.tick.startDate,l)).replace("{endDate}",b.format(e.tick.endDate,l)).replace("{allocated}",s).replace("{available}",a).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),i=`<div class="b-histogram-bar-tooltip">${i}</div>`}return i}getResourceBarTip({datum:e}){const r=this,{timeAxis:t}=r;let i="";if(e.inEventTimeSpan){const n=r.getBarTipEffortUnit(),s=r.getEffortText(e.effort,n),a=r.getEffortText(e.maxEffort,n);let o="L",l=r.L("L{barTipInRange}");b.compareUnits(t.unit,ee.Day)===0?l=r.L("L{barTipOnDate}"):b.compareUnits(t.unit,ee.Second)<=0?o="HH:mm:ss A":b.compareUnits(t.unit,ee.Hour)<=0&&(o="LT"),i=l.replace("{startDate}",b.format(e.tick.startDate,o)).replace("{endDate}",b.format(e.tick.endDate,o)).replace("{allocated}",s).replace("{available}",a).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),e.resource&&(i=i.replace("{resource}",O.encodeHtml(e.resource.name))),i=`<div class="b-histogram-bar-tooltip">${i}</div>`}return i}getBarTextEffortUnit(){const{effortUnit:e,barTextEffortUnit:r,timeAxis:t}=this,i=r||e;return b.compareUnits(t.unit,i)<0?t.unit:i}getBarTextDefault(e,r){const t=this.owner,{showBarText:i}=t;let n="";if(i&&e.inEventTimeSpan){const s=t.getBarTextEffortUnit();n=t.getEffortText(e.effort,s)}return n}updateShowMaxEffort(e){const r=this;if(r._showMaxEffort=e,!r._histogramWidget)return;const{series:i}=r;e?typeof e=="object"?i.maxEffort=e:typeof r._seriesMaxEffort=="object"?i.maxEffort=r._seriesMaxEffort:i.maxEffort={id:"maxEffort",type:"outline",field:"maxEffort"}:i.maxEffort&&(r._seriesMaxEffort=i.maxEffort,i.maxEffort=!1),r.scheduleRefreshRows()}updateIncludeInactiveEvents(e){var r;(r=this.getHistogramDataCache())==null||r.forEach(t=>t.includeInactiveEvents=e)}onTimeAxisEndReconfigureInternal(){const e=this;if(!e._updatingViewPreset){const{unit:r,increment:t}=e.timeAxis;if(r!==e._lastTimeAxisUnit||t!==e._lastTimeAxisIncrement){e._lastTimeAxisUnit=r,e._lastTimeAxisIncrement=t;const i=e.generateScalePoints(),n={scalePoints:i};e.trigger("generateScalePoints",n),e._generatedScalePoints=e.scalePoints=n.scalePoints}e.buildTicksIdentifier()}}calculateRowHeights(){}onTimeAxisEndReconfigure(){const e=this;e._updatingViewPreset||(e.project.graph?e.onTimeAxisEndReconfigureInternal():e.project.ion({graphReady(){e.onTimeAxisEndReconfigureInternal()},thisObj:e,once:!0}))}extractHistogramDataArray(e,r){return e.allocation.total}renderRows(){const e=this;return!e.ticksIdentifier&&e.project.isInitialCommitPerformed&&(e.onTimeAxisEndReconfigure(),(!e.timeView.startDate||!e.timeView.endDate)&&(e.timeView.range={startDate:e.startDate,endDate:e.endDate})),super.renderRows(...arguments)}async shiftPrevious(){super.shiftPrevious(...arguments),await this.project.commitAsync()}async shiftNext(){super.shiftNext(...arguments),await this.project.commitAsync()}onCommitAsyncCompletion(){this.renderScheduledRecords(),this._renderOnCommitPromise=null}onRecordAllocationCalculated(e){this.isDestroying||this.setHistogramDataCache(e.resource,e.owner)}buildResourceAllocationReport(e){return this.project.resourceAllocationInfoClass.new({includeInactiveEvents:this.includeInactiveEvents,ticks:this.ticksIdentifier,resource:e})}async getRecordAllocationData(e){const r=this,{project:t}=r;for(;!r.ticksIdentifier||!t.isInitialCommitPerformed;)await t.await("commitFinalized");if(e.graph){const i=t.getGraph(),n=r.buildResourceAllocationReport(e);return e.addEntity(n),await i.readAsync(n.$.allocation),i.ongoing.then(()=>{i.addListener(n.$.allocation,r.onRecordAllocationCalculated)}),n}}onHistogramDataCacheSet(){super.onHistogramDataCacheSet(...arguments);const e=this;e._renderOnCommitPromise||(e._renderOnCommitPromise=e.project.graph.ongoing.then(e.onCommitAsyncCompletion))}aggregateRecordsHistogramData(e,r){const t=super.aggregateRecordsHistogramData(e,r);return N.isPromise(t)?t.then(wT):wT(t)}initAggregatedAllocationEntry(){return{tick:null,effort:0,maxEffort:0,units:0,isGroup:!0,inEventTimeSpan:!1,resourceAllocation:new Map}}aggregateAllocationEntry(e,r,t,i,n){return e.resourceAllocation.set(r.resource,r),e.tick=r.tick,e.isOverallocated=e.isOverallocated||r.isOverallocated,e.isUnderallocated=e.isUnderallocated||r.isUnderallocated,e.inEventTimeSpan=e.inEventTimeSpan||r.inEventTimeSpan,r.assignments&&(e.assignments?r.assignments.forEach(s=>e.assignments.add(s)):e.assignments=new Set(r.assignments)),e}generateGroupScalePoints(e){const r=this,t=r.getGroupChildren(e),i=r.generateScalePoints(r.timeAxis.increment*t.length),n={scalePoints:i,groupParent:e};return r.trigger("generateScalePoints",n),n.scalePoints}processRecordRenderData(e){if(this.isGroupRecord(e.record)){const r=this.generateGroupScalePoints(e.record),t=this.getTopValueByScalePoints(r);e.scaleWidgetConfig={scalePoints:r},e.histogramConfig={...e.histogramConfig,topValue:t}}else e=super.processRecordRenderData(e);return e}updateLocalization(){const e=this;e._generatedScalePoints===e.scalePoints&&e.scalePoints&&e.scalePoints.forEach(r=>{r.text&&r.unit&&(r.text=e.buildScalePointText(r))}),super.updateLocalization(...arguments)}};E(Os,"$name","ResourceHistogram"),E(Os,"type","resourcehistogram"),E(Os,"configurable",{projectModelClass:xg,sortFeatureStore:"store",timeAxisColumnCellCls:"b-sch-timeaxis-cell b-resourcehistogram-cell",effortFormat:"0.#",getRecordData:"getRecordAllocationData",aggregateDataEntry:"aggregateAllocationEntry",initAggregatedDataEntry:"initAggregatedAllocationEntry",hardRefreshOnTimeAxisReconfigure:!1,showEffortUnit:!0,useProjectTimeUnitsForScale:!1,effortUnit:ee.Hour,barTextEffortUnit:null,barTipEffortUnit:null,showMaxEffort:!0,series:{maxEffort:{type:"outline",field:"maxEffort"},effort:{type:"bar",field:"effort"}},barTooltipTemplate({datum:e}){let r="";const{inEventTimeSpan:t,isGroup:i}=e;return t&&(i?r=this.getGroupBarTip(...arguments):r=this.getResourceBarTip(...arguments)),r},showBarText:!1,groupBarTipAssignmentLimit:5,includeInactiveEvents:!1,histogramWidget:{cls:"b-hide-offscreen b-resourcehistogram-histogram"},fixedRowHeight:!0}),Os.initClass(),Os._$name="ResourceHistogram";var ET=class extends Os{construct(){super.construct(...arguments),this.rowManager.ion({renderRow:"onRowManagerRenderRow",thisObj:this})}updateProject(e){const r=this.store;super.updateProject(e),this.store=r||this.buildStore(e)}updateResourceStore(e){this._resourceStore=e}buildStore(e){return e=this.project,Qc.new({project:e})}async getTipHtml(e){const r=e.activeTarget.dataset.index,t=this.getRecordFromElement(e.activeTarget),i=await this.getRecordHistogramData(t),n=this.extractHistogramDataArray(i,t)[parseInt(r,10)];return this.barTooltipTemplate({...e,record:t,index:r,datum:n})}getRecordAllocationData(e,...r){if(e=this.resolveRecordToOrigin(e),e.isResourceModel)return super.getRecordAllocationData(e,...r);if(e.isAssignmentModel)return this.getRecordHistogramData(e.resource,...r)}onDestroy(){var e;this.destroyStores&&((e=this.store)==null||e.destroy()),super.onDestroy()}onRecordAllocationCalculated(e){const r=this;if(!r.isDestroying){const t=e.owner,i=[...e.byAssignments.keys()].reduce((s,a)=>{const o=r.resolveOriginToRecord(a);return o&&s.push(o),s},[]),n=r.resolveOriginToRecord(e.resource);n&&r.setHistogramDataCache(n,t);for(const s of i)r.setHistogramDataCache(s,t);r._renderOnCommitPromise||(r._renderOnCommitPromise=r.project.graph.ongoing.then(r.onCommitAsyncCompletion.bind(r)))}}onRowManagerRenderRow({row:e,record:r}){const t=this.isGroupRecord(r);r=this.resolveRecordToOrigin(r),e.assignCls({"b-resource-row":r.isResourceModel||t,"b-assignment-row":!t&&r.isAssignmentModel})}resolveRecordToOrigin(e){return e.origin||e.$original||e}resolveOriginToRecord(e){let r=e;if(this.store.isResourceUtilizationStore)r=this.store.getModelByOrigin(e)||r;else if(e.hasLinks){for(const t of e.$links)if(this.store.includes(t))return t}return r}getHistogramDataCache(e){return e&&(e=this.resolveRecordToOrigin(e)),super.getHistogramDataCache(e)}setHistogramDataCache(e,r){return e=this.resolveRecordToOrigin(e),super.setHistogramDataCache(e,r)}scheduleRecordRefresh(e){return e=this.resolveOriginToRecord(e),super.scheduleRecordRefresh(e)}scheduleRecordParentsRefresh(e){return e=this.resolveOriginToRecord(e),super.scheduleRecordParentsRefresh(e)}getCell(e){var r,t;return((r=e.record)!=null&&r.isResourceModel||(t=e.record)!=null&&t.isAssignmentModel)&&(e.record=this.resolveOriginToRecord(e.record)),super.getCell(e)}changeHistogramWidget(e){return e&&!e.isHistogram&&(!this.getBarTextRenderData&&!(e!=null&&e.getBarTextRenderData)&&(e.getBarTextRenderData=this.getBarTextRenderDataDefault),e.height=this.rowHeight),super.changeHistogramWidget(e)}getBarTextRenderDataDefault(e,r,t){return e.y="50%",e}extractHistogramDataArray(e,r){let t;const i=this.resolveRecordToOrigin(r);return this.isGroupRecord(r)||i.isResourceModel?t=e.allocation.total:i.isAssignmentModel&&(t=e.allocation.byAssignments.get(i)||[]),t}initAggregatedAllocationEntry(e,r){return r.targetArray.$resources||(r.targetArray.$resources=new Set),{tick:null,effort:0,maxEffort:0,units:0,isGroup:!0,inEventTimeSpan:!1,members:new Map,resources:new Set}}aggregateAllocationEntry(e,r,t,i,n){const{targetArray:s}=n,a=n.arrays[t];if(e.tick=r.tick,e.isOverallocated=e.isOverallocated||r.isOverallocated,e.isUnderallocated=e.isUnderallocated||r.isUnderallocated,e.inEventTimeSpan=e.inEventTimeSpan||r.inEventTimeSpan,r.members?e.members=new Map([...e.members,...r.members]):e.members.set(r.resource||r.assignment,r),a.$resources)s.$resources=new Set([...s.$resources,...a.$resources]);else if(r.assignment||r.resource){const o=r.resource||r.assignment.resource;s.$resources.add(o);const l=this.getHistogramDataCache(o).allocation.total[i];e.isOverallocated=e.isOverallocated||l.isOverallocated,e.isUnderallocated=e.isUnderallocated||l.isUnderallocated}return e}aggregateHistogramData(){const e=super.aggregateHistogramData(...arguments);for(let r=0,t=e.length;r<t;r++){const i=e[r];i.maxEffort=0;for(const n of e.$resources){const s=this.getHistogramDataCache(n).allocation.total[r];i.maxEffort+=s.maxEffort}}return e}getResourceBarTip({datum:e}){const r=this,{showBarTip:t,timeAxis:i}=r;let n="";if(t&&e.inEventTimeSpan){const s=r.getBarTipEffortUnit(...arguments),a=r.getEffortText(e.effort,s,!0),o=r.getEffortText(e.maxEffort,s,!0),l=r.L("L{groupBarTipAssignment}");let c="L",d=r.L("L{groupBarTipInRange}"),u="";b.compareUnits(i.unit,ee.Day)===0?d=r.L("L{groupBarTipOnDate}"):b.compareUnits(i.unit,ee.Second)<=0?c="HH:mm:ss A":b.compareUnits(i.unit,ee.Hour)<=0&&(c="LT");let h=[...e.assignmentIntervals.entries()].filter(([f,m])=>m.effort).sort(([f,m],[p,v])=>m.effort>v.effort?-1:1);h.length>r.groupBarTipAssignmentLimit&&(u="<br>"+r.L("L{plusMore}").replace("{value}",h.length-r.groupBarTipAssignmentLimit),h=h.slice(0,this.groupBarTipAssignmentLimit));const g=h.map(([f,m])=>l.replace("{event}",O.encodeHtml(f.event.name)).replace("{allocated}",r.getEffortText(m.effort,s,!0)).replace("{available}",r.getEffortText(m.maxEffort,s,!0)).replace("{cls}",m.isOverallocated?"b-overallocated":m.isUnderallocated?"b-underallocated":"")).join("<br>")+u;n=d.replace("{assignments}",g).replace("{startDate}",b.format(e.tick.startDate,c)).replace("{endDate}",b.format(e.tick.endDate,c)).replace("{allocated}",a).replace("{available}",o).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),n=`<div class="b-histogram-bar-tooltip">${n}</div>`}return n}getGroupBarTip({datum:e}){const r=this,{showBarTip:t,timeAxis:i}=r;let n="";if(t&&e.inEventTimeSpan){const s=r.getBarTipEffortUnit(...arguments),a=r.getEffortText(e.effort,s),o=r.getEffortText(e.maxEffort,s),l=r.L("L{groupBarTipAssignment}");let c="L",d=r.L("L{groupBarTipInRange}"),u="";b.compareUnits(i.unit,ee.Day)===0?d=r.L("L{groupBarTipOnDate}"):b.compareUnits(i.unit,ee.Second)<=0?c="HH:mm:ss A":b.compareUnits(i.unit,ee.Hour)<=0&&(c="LT");let h=[...e.members.entries()].filter(([f,m])=>m.effort).sort(([f,m],[p,v])=>m.effort>v.effort?-1:1);h.length>r.groupBarTipAssignmentLimit&&(u="<br>"+r.L("L{plusMore}").replace("{value}",h.length-r.groupBarTipAssignmentLimit),h=h.slice(0,this.groupBarTipAssignmentLimit));const g=h.map(([f,m])=>{var p,v;return l.replace("{resource}",O.encodeHtml(((p=f.resource)==null?void 0:p.name)||f.name)).replace("{event}",O.encodeHtml(((v=f.event)==null?void 0:v.name)||f.name)).replace("{allocated}",r.getEffortText(m.effort,s)).replace("{available}",r.getEffortText(m.maxEffort,s)).replace("{cls}",m.isOverallocated?"b-overallocated":m.isUnderallocated?"b-underallocated":"")}).join("<br>")+u;n=d.replace("{assignments}",g).replace("{startDate}",b.format(e.tick.startDate,c)).replace("{endDate}",b.format(e.tick.endDate,c)).replace("{allocated}",a).replace("{available}",o).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),n=`<div class="b-histogram-bar-tooltip">${n}</div>`}return n}getAssignmentBarTip({datum:e}){const r=this,{showBarTip:t,timeAxis:i}=r;let n="";if(t&&e.inEventTimeSpan){const s=r.getBarTipEffortUnit(...arguments),a=r.getEffortText(e.effort,s,!0),o=r.getEffortText(e.maxEffort,s,!0);let l="L",c=r.L("L{barTipInRange}");b.compareUnits(i.unit,ee.Day)===0?c=r.L("L{barTipOnDate}"):b.compareUnits(i.unit,ee.Second)<=0?l="HH:mm:ss A":b.compareUnits(i.unit,ee.Hour)<=0&&(l="LT"),n=c.replace("{startDate}",b.format(e.tick.startDate,l)).replace("{endDate}",b.format(e.tick.endDate,l)).replace("{allocated}",a).replace("{available}",o).replace("{cls}",e.cls||""),e.assignment&&(n=n.replace("{event}",O.encodeHtml(e.assignment.event.name))),n=`<div class="b-histogram-bar-tooltip">${n}</div>`}return n}},$o=ET;E($o,"$name","ResourceUtilization"),E($o,"type","resourceutilization"),E($o,"configurable",{scaleColumn:null,timeAxisColumnCellCls:"b-sch-timeaxis-cell b-resourceutilization-cell",rowHeight:30,showEffortUnit:!1,showMaxEffort:!1,showBarText:!0,barTooltipTemplate({datum:e}){let r="";const{inEventTimeSpan:t,isGroup:i,resource:n,assignment:s}=e;return t&&(i?r=this.getGroupBarTip(...arguments):s?r=this.getAssignmentBarTip(...arguments):n&&(r=this.getResourceBarTip(...arguments))),r},series:{effort:{stretch:!0}},readOnly:!0,columns:[{type:"tree",field:"name",text:"L{nameColumnText}",localeClass:ET}],histogramWidget:{cls:"b-hide-offscreen b-resourceutilization-histogram"}}),$o.initClass(),$o._$name="ResourceUtilization",j.registerFeature(Ui,!0,"ResourceUtilization");var Zb=class extends gc{fillInnerSpanHorizontalPosition(e){const r=this,{eventRecord:t}=e,{startMS:i,endMS:n,durationMS:s}=r.calculateMS(t,"startDate","endDate"),a=r.calculateHorizontalPosition(e,i,n,s);if(a){const{left:o,width:l}=a;return Object.assign(e,{innerStartMS:i,innerEndMS:n,innerDurationMS:s,bufferBeforeWidth:Math.max(o-e.left,0),bufferAfterWidth:Math.max(Math.floor(e.left+e.width-o-l),0)}),!0}else return!1}getTimeSpanRenderData(e,r,t=!1){const i=super.getTimeSpanRenderData(e,r,t);return i!=null&&i.useEventBuffer&&!this.fillInnerSpanHorizontalPosition(i)?null:i}};E(Zb,"$name","ProHorizontalRendering"),Zb._$name="ProHorizontalRendering";var Jb=class extends ah{fillInnerSpanVerticalPosition(e){const r=this,{scheduler:t}=r,{eventRecord:i}=e,{isBatchUpdating:n}=i,s=n?i.get("startDate"):i.startDate,a=n?i.get("endDate"):i.endDate,o=t.getCoordinateFromDate(s),l=s.getTime(),c=a.getTime(),d=c-l;let u=t.getCoordinateFromDate(a),h=u-o;return u===-1&&(h=Math.round(d*t.timeAxisViewModel.getSingleUnitInPixels("millisecond")),u=o+h),Object.assign(e,{innerStartMS:l,innerEndMS:c,innerDurationMS:d,bufferBeforeWidth:o-e.top,bufferAfterWidth:e.top+e.height-o-h}),!0}getTimeSpanRenderData(e,r,t=!1){const i=super.getTimeSpanRenderData(e,r,t);return i!=null&&i.useEventBuffer&&!this.fillInnerSpanVerticalPosition(i)?null:i}};E(Jb,"$name","ProVerticalRendering"),Jb._$name="ProVerticalRendering";var fn=class extends pr.mixin(Kb,DT,Xb){onPaintOverride(){}set calendars(e){this.project.calendars=e}get calendars(){return this.project.calendars}get mode(){return this._mode}set mode(e){const r=this;r._mode=e,r[e]||(r.element.classList.add(`b-sch-${e}`),e==="horizontal"?(r.horizontal=new Zb(r),r.isPainted&&r.horizontal.init()):e==="vertical"&&(r.vertical=new Jb(r),r.rendered&&r.vertical.init()))}toggleEmptyText(){const e=this;e.bodyContainer&&e.rowManager&&w.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.project.isLoadingOrSyncing))}get taskStore(){return this.project.eventStore}createEvent(e,r,t){if(r.isWorkingTime(e))if(this.taskEdit&&this.taskEdit.isEditing)this.ion({aftertaskedit:()=>super.createEvent(e,r,t),once:!0});else return super.createEvent(e,r,t)}};E(fn,"$name","SchedulerProBase"),E(fn,"type","schedulerprobase"),E(fn,"configurable",{projectModelClass:xg,dependencyIdField:"id",showTaskColorPickers:!1}),E(fn,"isSchedulerPro",!0),fn.initClass(),ne.setVersion("schedulerpro","5.5.0"),fn._$name="SchedulerProBase";var Qb=class extends fn{static get $name(){return"SchedulerPro"}static get type(){return"schedulerpro"}};Qb.initClass(),Qb._$name="SchedulerPro";var eC=class extends pr{static get $name(){return"Timeline"}static get type(){return"timeline"}static get configurable(){return{height:"13em",eventLayout:"pack",barMargin:1,forceFit:!0,timeAxis:{autoAdjust:!1},readOnly:!0,zoomOnMouseWheel:!1,zoomOnTimeAxisDoubleClick:!1,rowHeight:48,displayDateFormat:"L",resources:[{id:1}],columns:[]}}static get delayable(){return{fillFromTaskStore:100}}construct(e={}){const r=this;r.startDateLabel=document.createElement("label"),r.startDateLabel.className="b-timeline-startdate",r.endDateLabel=document.createElement("label"),r.endDateLabel.className="b-timeline-enddate";let t=!0;if("project"in e)if(e.project)e.project instanceof lg&&(r.taskStore=e.project.eventStore,e.project.isInitialCommitPerformed||(t=!1,e.project.ion({name:"initialCommit",refresh({isInitialCommit:i}){i&&(r.fillFromTaskStore(),r.detachListeners("initialCommit"))},thisObj:r})),delete e.project);else throw new Error("You need to configure the Timeline with a Project");e.features=T.assign({cellEdit:!1,cellMenu:!1,columnAutoWidth:!1,columnLines:!1,columnPicker:!1,columnReorder:!1,columnResize:!1,contextMenu:!1,eventContextMenu:!1,eventDrag:!1,eventDragCreate:!1,eventEdit:!1,eventFilter:!1,eventMenu:!1,eventResize:!1,eventTooltip:!1,group:!1,headerMenu:!1,regionResize:!1,scheduleContextMenu:!1,scheduleMenu:!1,scheduleTooltip:!1,sort:!1,timeAxisHeaderMenu:!1,timeRanges:!1},e.features),super.construct(e),r.features.timeRanges&&(r.features.timeRanges.store=new re),t&&r.fillFromTaskStore.now(),r.taskStore.ion({refreshPreCommit:r.fillFromTaskStore,changePreCommit:r.onTaskStoreChange,thisObj:r}),r.ion({resize:r.onSizeChanged,thisObj:r}),r.bodyContainer.appendChild(r.startDateLabel),r.bodyContainer.appendChild(r.endDateLabel)}onSizeChanged({width:e,oldWidth:r}){const t=this,i=e!==r;i&&t.suspendRefresh(),t.syncRowHeight(),i&&(t.resumeRefresh(),t.fitTimeline())}syncRowHeight(){this.bodyContainer.isConnected&&(this.rowHeight=this.bodyContainer.offsetHeight)}fitTimeline(){this.eventStore.count>0&&(this.forceFit=!1,this.zoomToFit({leftMargin:50,rightMargin:50}),this.forceFit=!0),this.updateStartEndLabels()}updateStartEndLabels(){const e=this;e.startDateLabel.innerHTML=e.getFormattedDate(e.startDate),e.endDateLabel.innerHTML=e.getFormattedDate(e.endDate)}async onTaskStoreChange({action:e,record:r,records:t,changes:i,isCollapse:n}){const s=this,a=s.eventStore;let o;switch(e){case"add":t.forEach(l=>{l.showInTimeline&&(a.add(s.cloneTask(l)),o=!0)});break;case"remove":n||t.forEach(l=>{l.showInTimeline&&(a.remove(l.id),o=!0)});break;case"removeall":s.fillFromTaskStore.now();break;case"update":{const l=r;if(i.showInTimeline){if(l.showInTimeline)a.add(s.cloneTask(l));else{const c=a.getById(l.id);c&&a.remove(c)}o=!0}else if(l.showInTimeline){const c=a.getById(l.id);c&&(c.set(s.cloneTask(l)),o=!0)}break}}o&&s.fitTimeline()}cloneTask(e){return{id:e.id,resourceId:1,name:e.name,startDate:e.startDate,endDate:e.endDate,cls:e.cls}}render(){super.render(...arguments),this.syncRowHeight()}async fillFromTaskStore(){const e=this,r=[];e.taskStore.traverse(t=>{t.showInTimeline&&t.isScheduled&&r.push(e.cloneTask(t))}),e.events=r,await e.project.commitAsync(),!e.isDestroyed&&e.fitTimeline()}onLocaleChange(){this.updateStartEndLabels(),super.onLocaleChange()}};eC.initClass(),eC._$name="Timeline";var OL=[],xT={remove:1,add:2,update:3},RT={TaskModel:1,DependencyModel:2,AssignmentModel:3,ProjectModel:4},TT=({parent:e,index:r})=>`${e.name}[${r}]`,LL={AssignmentModel:"Assignment",DependencyModel:"Dependency"},MT=class extends zi{};E(MT,"fields",[{name:"description",type:"string"},{name:"occurredAt",type:"date"},{name:"versionModel"},{name:"transactionModel"},{name:"propertyUpdate"},{name:"action"}]);var mn=class extends _u{constructor(){super(...arguments),E(this,"_transactionChanges",[]),E(this,"_versionChanges",[]),E(this,"comparingRowCls",`b-${mn.type}-comparing`)}static get properties(){return{_rowsByUnderlyingRecord:new WeakMap,_expandedById:new Map}}construct(e){super.construct({...e,features:T.merge({},mn.configurable.features,e.features)})}afterConstruct(){if(!this.project)throw new Error(`${mn.$name} requires the project config.`);this.refreshGrid()}updateDateFormat(e){const r=this.columns.get("occurredAt");r&&(r.format=e)}updateProject(e){const r=this;r.detachListeners("storeChange"),r._versionStore=e.getCrudStore("versions"),r._transactionStore=e.getCrudStore("changelogs"),r._versionStore.ion({name:"storeChange",change:r.onVersionStoreChange,thisObj:r}),r._transactionStore.ion({name:"storeChange",change:r.onTransactionStoreChange,thisObj:r})}updateShowNamedVersionsOnly(){this.isPainted&&this.refreshGrid()}updateShowUnattachedTransactions(){this.isPainted&&this.refreshGrid()}updateShowVersions(){this.isPainted&&this.refreshGrid()}updateComparingVersionId(e,r){const[t,i]=[r,e].map(n=>this.store.getById(`v-${n}`));t&&(t.cls="",t.iconCls="b-icon b-icon-version"),i&&(i.cls=this.comparingRowCls,i.iconCls="b-icon b-icon-compare")}onVersionStoreChange({action:e,records:r}){this._versionChanges.push({action:e,records:r}),this.processUpdates()}onTransactionStoreChange({action:e,records:r}){this._transactionChanges.push({action:e,records:r}),this.processUpdates()}processUpdates(){const e=this,r=H.unique(e._versionChanges.flatMap(({records:n})=>n)),t=new Set(r.map(n=>String(n.id))),i=H.unique(e._transactionChanges.flatMap(({records:n})=>n).concat(r.length===0?[]:e._transactionStore.query(n=>t.has(n.versionId))));for(const n of i)n.versionId&&!t.has(n.versionId)&&(r.push(e._versionStore.getById(n.versionId)),t.add(n.versionId));e.replaceRows(H.unique(r),i),e._transactionChanges=[],e._versionChanges=[]}replaceRows(e,r){var t;const i=this,{showNamedVersionsOnly:n,showUnattachedTransactions:s,store:a}=i,o=new Set,l=H.groupBy(r,"versionId"),c=r.concat(e),d=n?e.filter(u=>u.name!=null):e;for(const u of c)for(const h of(t=i._rowsByUnderlyingRecord.get(u))!=null?t:OL)o.add(h);i.suspendRefresh(),a.remove(Array.from(o));for(const u of d){const h=a.add(i.getGridRows(u,l[u.id]));i._rowsByUnderlyingRecord.set(u,h)}if(s)for(const u of r.filter(h=>h.versionId==null)){const h=a.add(i.getGridRows(null,[u]));i._rowsByUnderlyingRecord.set(u,h)}i.resumeRefresh(),a.sort(a.sorters)}refreshGrid(){this.replaceRows(this._versionStore.records,this._transactionStore.records)}getGridRows(e,r){const t=this,{showVersions:i,comparingVersionId:n}=t,s=(r==null?void 0:r.map(o=>{var l;const c=`t-${o.id}`;return{id:c,expanded:!!((l=t._expandedById)!=null&&l.get(c)),description:o.description,occurredAt:o.occurredAt,transactionModel:o,rootVersionModel:e,children:o.actions.map((d,u)=>{var h,g,f;const m=`a-${o.id}-${u}`;return{id:m,expanded:!!((h=t._expandedById)!=null&&h.get(m)),action:d,rootVersionModel:e,children:(f=(g=d.propertyUpdates)==null?void 0:g.map(p=>({rootVersionModel:e,propertyUpdate:p})))!=null?f:[]}})}}))||[],a=`v-${e==null?void 0:e.id}`;return e&&i?{id:a,expanded:!!t._expandedById.get(a),description:e.description,occurredAt:e.savedAt,children:s,versionModel:e,iconCls:"b-icon-version",cls:e.id===n?t.comparingRowCls:null}:s}renderDescription(e){const{record:r}=e;return r.propertyUpdate?this.renderPropertyUpdate(r.propertyUpdate):r.action?this.renderActionDescription(r.action):r.description}renderPropertyUpdate(e){const r=mn.type,{property:t,before:i,after:n}=e;return{children:[{tag:"div",class:`b-${r}-property-update-desc`,children:[{tag:"span",class:`b-${r}-property-name`,html:`${this.formatPropertyName(t)}`},this.renderPropertyValue(i,"before"),{tag:"i",class:"b-icon b-icon-right"},this.renderPropertyValue(n,"after")]}]}}renderPropertyValue(e,r){var t;return{tag:"span",class:[`b-${mn.type}-property-${r}`,e==null&&`b-${mn.type}-empty-value`],html:e==null?this.L("L{Versions.nullValue}"):(t=this.formatValueString(e))!=null?t:""}}formatValueString(e){return b.isDate(e)?b.format(e,this.dateFormat):typeof e=="number"?e.toFixed(2):e}formatPropertyName(e){return O.separate(e)}getAssignmentTextTokens(e){return{event:e.event.name,resource:e.resource.name}}getDependencyTextTokens(e){return{from:e.fromTask.name,to:e.toTask.name}}renderActionDescription(e){var r;const t=this,{actionType:i,entity:n}=e,s=t.L("L{Versions.entityNames}");let a,o={type:s[n.type],name:n.name};return i==="move"&&(o.from=TT(e.from),o.to=TT(e.to)),a=t.L(`L{Versions.${i}${(r=LL[n.type])!=null?r:"Entity"}}`),n.type==="DependencyModel"?o=t.getDependencyTextTokens(n):n.type==="AssignmentModel"&&(o=t.getAssignmentTextTokens(n)),a=a.replace(/\{(\w+)\}/g,(l,c)=>{var d;return(d=o[c])!=null?d:c}),e.isUser&&(a=`[!] ${a}`),t.renderHighlightedTextElements(O.capitalize(a),o)}static sortActionRows(e,r){if(e.parent===r.parent&&e.action&&r.action){const t=!!e.action.isUser,i=!!r.action.isUser,{actionType:n,entity:{type:s}}=e.action,{actionType:a,entity:{type:o}}=r.action;return t!==i?t?-1:1:Math.sign(xT[n]-xT[a])||Math.sign(RT[s]-RT[o])||0}return 0}triggerRestore(e){this.trigger("restore",{version:e})}triggerCompare(e){this.trigger("compare",{version:e})}triggerStopCompare(e){this.trigger("stopCompare")}renderHighlightedTextElements(e){const r=this.constructor.type;return{children:[{tag:"span",class:`b-${r}-highlighted-text`,children:e.split(/\*\*/g).reduce((t,i)=>(t.children.push({tag:"span",text:i,class:t.isEntity?`b-${r}-highlighted-entity`:null}),t.isEntity=!t.isEntity,t),{children:[],isEntity:!1}).children}]}}},Ls=mn;E(Ls,"$name","VersionGrid"),E(Ls,"type","versiongrid"),E(Ls,"configurable",{store:{tree:!0,modelClass:MT,sorters:[{field:"occurredAt",ascending:!1},mn.sortActionRows],reapplySortersOnAdd:!0},project:null,showUnattachedTransactions:!0,showNamedVersionsOnly:!1,showVersions:!0,comparingVersionId:null,flex:0,features:{group:{field:"id"},cellEdit:{continueEditingOnCellClick:!1,editNextOnEnterPress:!1},cellMenu:{items:{removeRow:!1,cut:!1,copy:!1,paste:!1,renameButton:{text:"L{VersionGrid.rename}",icon:"b-icon b-icon-edit",onItem:({record:e,source:r})=>{r.startEditing({id:e.id,column:r.columns.get("description")})}},restoreButton:{text:"L{VersionGrid.restore}",icon:"b-icon b-icon-undo",onItem:({record:e,source:r})=>{r.triggerRestore(e.versionModel)}},compareButton:{text:"L{VersionGrid.compare}",icon:"b-icon b-icon-compare",onItem:({record:e,source:r})=>{r.triggerCompare(e.versionModel)}},stopComparingButton:{text:"L{VersionGrid.stopComparing}",onItem:({record:e,source:r})=>{r.triggerStopCompare()}}}},rowCopyPaste:!1},columns:[{type:"tree",text:"L{VersionGrid.description}",field:"description",flex:4,groupable:!1,renderer:({grid:e,...r})=>e.renderDescription({grid:e,...r}),autoHeight:!0},{text:"L{VersionGrid.occurredAt}",field:"occurredAt",type:"date",flex:1,groupable:!1}],dateFormat:"M/D/YY h:mm a",internalListeners:{beforeCellEditStart({editorContext:{column:e,record:r}}){if(!(e.field==="description"&&r.versionModel))return!1},finishCellEdit({editorContext:{record:e,value:r}}){e.versionModel.name=r!=null&&r.trim()?r:null},cellMenuBeforeShow({source:e,record:r,items:t}){return t.stopComparingButton.disabled=!e.comparingVersionId,!!r.versionModel},toggleNode({record:e,collapse:r}){this._expandedById.set(e.id,!r)}}}),E(Ls,"delayable",{processUpdates:{type:"raf",cancelOutstanding:!0}}),Ls.initClass(),Ls._$name="VersionGrid";var IT=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},PT=class extends G([on,yi,ws],e=>{const r=e.prototype;class t extends e{*maybeSkipNonWorkingTime(n,s=!0){return(yield this.$.childEvents).size>0?n:yield*r.maybeSkipNonWorkingTime.call(this,n,s)}*calculateStartDateConstraintIntervals(){const n=yield*r.calculateStartDateConstraintIntervals.call(this),s=yield this.$.parentEvent;if(s!=null&&s.graph){const a=yield s.$.startDateConstraintIntervals;n.push.apply(n,a)}return n}*calculateEndDateConstraintIntervals(){const n=yield*r.calculateEndDateConstraintIntervals.call(this),s=yield this.$.parentEvent;if(s!=null&&s.graph){const a=yield s.$.endDateConstraintIntervals;n.push.apply(n,a)}return n}*calculateEarlyStartDateConstraintIntervals(){const n=yield*r.calculateEarlyStartDateConstraintIntervals.call(this),s=yield this.$.parentEvent;if(s!=null&&s.graph){const a=yield s.$.earlyStartDateConstraintIntervals;n.push.apply(n,a),(yield s.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===ae.Forward&&n.push(ld.new({owner:s,side:Ye.Start,startDate:yield s.$.startDate}))}return n}*calculateEarlyEndDateConstraintIntervals(){const n=yield*r.calculateEarlyEndDateConstraintIntervals.call(this),s=yield this.$.parentEvent;if(s!=null&&s.graph){const a=yield s.$.earlyEndDateConstraintIntervals;n.push.apply(n,a)}return n}}return t}){},AT=class extends We(zh){static get $name(){return"RemoveManuallyScheduledParentConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return mr(this.L("L{descriptionTpl}"),e.name||e.id)}resolve(){this.event.manuallyScheduled=!1}},_T=class extends Co{static get $name(){return"ManuallyScheduledParentConstraintIntervalDescription"}static getDescription(e){let r;switch(e.side){case Ye.Start:r=this.L("L{startDescriptionTpl}");break;case Ye.End:r=this.L("L{endDescriptionTpl}");break}return mr(r,...this.getDescriptionParameters(e))}static getDescriptionParameters(e){const r=e.owner;return[b.format(e.startDate,this.L("L{dateFormat}")),b.format(e.endDate,this.L("L{dateFormat}")),r.name||r.id]}},ld=class extends an{getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const r=this.owner;e=e||r.graph.activeTransaction;const t=e.entries.get(r.$.manuallyScheduled);return!e.baseRevision.hasIdentifier(r.$$)||t&&!t.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.resetManuallyScheduledConflictResolutionClass.new({interval:this})])}};IT([pe(AT)],ld.prototype,"resetManuallyScheduledConflictResolutionClass",void 0),IT([pe(_T)],ld.prototype,"descriptionBuilderClass",void 0);var tt=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Tg=class extends G([ws,yi],e=>{const r=e.prototype;class t extends e{*calculateLateStartDateConstraintIntervals(){const n=[],s=yield this.$.parentEvent;if(s){const a=yield s.$.lateStartDateConstraintIntervals;n.push.apply(n,a)}return n}*calculateLateEndDateConstraintIntervals(){const n=[],s=yield this.$.parentEvent;if(s){const a=yield s.$.lateEndDateConstraintIntervals;n.push.apply(n,a),(yield s.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===ae.Backward&&n.push(ld.new({side:Ye.End,endDate:yield s.$.endDate}))}return n}*shouldRollupChildLateStartDate(n){return!0}*calculateMinChildrenLateStartDate(){let n=He;const s=yield*this.subEventsIterable();for(let a of s){if(!(yield*this.shouldRollupChildLateStartDate(a)))continue;let o;(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.minChildrenLateStartDate),o=o||(yield a.$.lateStartDate),o&&o<n&&(n=o)}return n.getTime()-He.getTime()?n:null}*calculateLateStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===ae.Backward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenLateStartDate;if(!(yield*this.isConstrainedLate()))return yield this.$.startDate;const n=(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),s=(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals);let a=yield*this.calculateEffectiveConstraintInterval(!0,n,s);if(a===null)return null;if(a.isIntervalEmpty()){a=yield*this.calculateEffectiveConstraintInterval(!0,n,s,!0);const o=sn.new({intervals:[...a.intersectionOf]});if((yield o)===sr.Cancel)yield mi(o);else return null}return ui(a.endDate)?a.endDate:null}*shouldRollupChildLateEndDate(n){return!0}*calculateMaxChildrenLateEndDate(){let n=Xe;const s=yield*this.subEventsIterable();for(let a of s){if(!(yield*this.shouldRollupChildLateEndDate(a)))continue;let o;(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.maxChildrenLateEndDate),o=o||(yield a.$.lateEndDate),o&&o>n&&(n=o)}return n.getTime()-Xe.getTime()?n:null}*calculateLateStartDate(){return yield this.$.lateStartDateRaw}*calculateLateEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===ae.Backward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenLateEndDate;if(!(yield*this.isConstrainedLate()))return yield this.$.endDate;const n=yield this.$.lateStartDateConstraintIntervals,s=yield this.$.lateEndDateConstraintIntervals;let a=yield*this.calculateEffectiveConstraintInterval(!1,n.concat(yield this.$.startDateConstraintIntervals),s.concat(yield this.$.endDateConstraintIntervals));if(a===null)return null;if(a.isIntervalEmpty()){a=yield*this.calculateEffectiveConstraintInterval(!1,(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals),!0);const o=sn.new({intervals:[...a.intersectionOf]});if((yield o)===sr.Cancel)yield mi(o);else return null}return ui(a.endDate)?a.endDate:null}*calculateLateEndDate(){const n=yield this.$.lateEndDateRaw;return yield*this.maybeSkipNonWorkingTime(n,!1)}*calculateTotalSlack(){const n=yield this.$.earlyStartDateRaw,s=yield this.$.lateStartDateRaw,a=yield this.$.earlyEndDateRaw,o=yield this.$.lateEndDateRaw,l=yield this.$.slackUnit;let c,d;return(n&&s||a&&o)&&(n&&s?(d=yield*this.calculateProjectedDuration(n,s,l),a&&o&&(c=yield*this.calculateProjectedDuration(a,o,l),c<d&&(d=c))):a&&o&&(d=yield*this.calculateProjectedDuration(a,o,l))),d}*calculateCritical(){return(yield this.$.totalSlack)<=0}*isConstrainedLate(){const n=yield this.$.startDateConstraintIntervals,s=yield this.$.endDateConstraintIntervals,a=yield this.$.lateStartDateConstraintIntervals,o=yield this.$.lateEndDateConstraintIntervals;return!!(n!=null&&n.length||s!=null&&s.length||a!=null&&a.length||o!=null&&o.length)}*calculateStartDatePure(){return(yield this.$.effectiveDirection).direction===ae.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*r.calculateStartDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():yield this.$.lateStartDate:yield*r.calculateStartDatePure.call(this)}*calculateStartDateProposed(){switch((yield this.$.effectiveDirection).direction){case ae.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*r.calculateStartDateProposed.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():(yield this.$.lateStartDate)||(yield*r.calculateStartDateProposed.call(this));default:return yield*r.calculateStartDateProposed.call(this)}}*calculateEndDatePure(){return(yield this.$.effectiveDirection).direction===ae.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*r.calculateEndDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():yield this.$.lateEndDate:yield*r.calculateEndDatePure.call(this)}*calculateEndDateProposed(){switch((yield this.$.effectiveDirection).direction){case ae.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*r.calculateEndDateProposed.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():(yield this.$.lateEndDate)||(yield*r.calculateEndDateProposed.call(this));default:return yield*r.calculateEndDateProposed.call(this)}}}return tt([me({lazy:ot})],t.prototype,"minChildrenLateStartDate",void 0),tt([me({lazy:ot})],t.prototype,"lateStartDateRaw",void 0),tt([de({type:"date",persist:!1},{lazy:ot,converter:vi,persistent:!1})],t.prototype,"lateStartDate",void 0),tt([me({lazy:ot})],t.prototype,"maxChildrenLateEndDate",void 0),tt([me({lazy:ot})],t.prototype,"lateEndDateRaw",void 0),tt([de({type:"date",persist:!1},{lazy:ot,converter:vi,persistent:!1})],t.prototype,"lateEndDate",void 0),tt([me({lazy:ot})],t.prototype,"lateStartDateConstraintIntervals",void 0),tt([me({lazy:ot})],t.prototype,"lateEndDateConstraintIntervals",void 0),tt([de({type:"number",persist:!1},{lazy:ot,persistent:!1})],t.prototype,"totalSlack",void 0),tt([de({type:"string",defaultValue:ee.Day,persist:!1},{lazy:ot,converter:b.normalizeUnit,persistent:!1})],t.prototype,"slackUnit",void 0),tt([de({type:"boolean",defaultValue:!1,persist:!1},{persistent:!1,lazy:ot})],t.prototype,"critical",void 0),tt([ie("lateStartDateConstraintIntervals")],t.prototype,"calculateLateStartDateConstraintIntervals",null),tt([ie("lateEndDateConstraintIntervals")],t.prototype,"calculateLateEndDateConstraintIntervals",null),tt([ie("minChildrenLateStartDate")],t.prototype,"calculateMinChildrenLateStartDate",null),tt([ie("lateStartDateRaw")],t.prototype,"calculateLateStartDateRaw",null),tt([ie("maxChildrenLateEndDate")],t.prototype,"calculateMaxChildrenLateEndDate",null),tt([ie("lateStartDate")],t.prototype,"calculateLateStartDate",null),tt([ie("lateEndDateRaw")],t.prototype,"calculateLateEndDateRaw",null),tt([ie("lateEndDate")],t.prototype,"calculateLateEndDate",null),tt([ie("totalSlack")],t.prototype,"calculateTotalSlack",null),tt([ie("critical")],t.prototype,"calculateCritical",null),t}){},$L=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},tC=class extends G([ab,Tg],e=>{const r=e.prototype;class t extends e{*shouldSuccessorAffectScheduling(n){const s=yield n.$.toEvent;return s&&!hs(s)&&(yield n.$.active)&&(!(yield s.$.inactive)||(yield this.$.inactive))}*calculateLateStartDateConstraintIntervals(){const n=yield*r.calculateLateStartDateConstraintIntervals.call(this),s=this.getProject(),a=s.dependencyConstraintIntervalClass;let o;for(o of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(o)))continue;const l=yield o.$.toEvent,c=yield l.$.manuallyScheduled;let d;switch(yield o.$.type){case ft.StartToStart:d=c?yield l.$.startDate:yield l.$.lateStartDateRaw;break;case ft.StartToEnd:d=c?yield l.$.endDate:yield l.$.lateEndDateRaw;break}if(d){const u=yield o.$.lag,h=yield o.$.lagUnit,g=yield*s.$convertDuration(u,h,ee.Millisecond),f=yield o.$.calendar;yield f.$.version;let m=d;g&&(m=f.skipNonWorkingTime(f.calculateStartDate(d,g)));const p=a.new({owner:o,startDate:null,endDate:m});n.unshift(p)}}return n}*calculateLateEndDateConstraintIntervals(){const n=yield*r.calculateLateEndDateConstraintIntervals.call(this),s=this.getProject(),a=s.dependencyConstraintIntervalClass;let o;for(o of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(o)))continue;const l=yield o.$.toEvent,c=yield l.$.manuallyScheduled;let d;switch(yield o.$.type){case ft.EndToEnd:d=c?yield l.$.endDate:yield l.$.lateEndDateRaw;break;case ft.EndToStart:d=c?yield l.$.startDate:yield l.$.lateStartDateRaw;break}if(d){const u=yield o.$.lag,h=yield o.$.lagUnit,g=yield*s.$convertDuration(u,h,ee.Millisecond),f=yield o.$.calendar;yield f.$.version;let m=d;g&&(m=f.skipNonWorkingTime(f.calculateStartDate(d,g)));const p=a.new({owner:o,startDate:null,endDate:m});n.unshift(p)}}return n}*calculateEffectiveDirection(){const n=yield this.getProject().$.effectiveDirection,s=yield this.$.constraintType;if(n.direction===ae.Backward&&!(yield this.$.manuallyScheduled)&&!((s===ue.MustStartOn||s===ue.MustFinishOn)&&(yield this.$.constraintDate)))for(const a of yield this.$.outgoingDeps){const o=yield a.$.toEvent,l=o!=null&&!hs(o),c=l?yield o.$.constraintType:void 0;if(!l||!(yield a.$.active)||(yield o.$.manuallyScheduled)||(c===ue.MustStartOn||c===ue.MustFinishOn)&&(yield o.$.constraintDate))continue;const d=yield a.$.type,u=d===ft.EndToEnd||d===ft.StartToEnd?yield o.$.endDateDirection:yield o.$.startDateDirection;if(u.direction===ae.Forward)return{kind:"enforced",direction:ae.Forward,enforcedBy:u.kind==="enforced"?u.enforcedBy:u.kind==="own"?o:u.inheritedFrom}}return yield*super.calculateEffectiveDirection()}}return $L([ie("lateStartDateIntervals")],t.prototype,"calculateLateStartDateConstraintIntervals",null),t}){},rC=tn.new({variables:new Set([De,we,Re,pt,vt]),formulas:new Set([un,Xt,dn,bi,hn,qt,Kt])}),kT=Pt.new({description:rC,defaultResolutionFormulas:new Set([un,Xt])}),FT=Pt.new({description:rC,defaultResolutionFormulas:new Set([hn,Xt])}),OT=class extends G([Yc],e=>{const r=e.prototype;class t extends e{*prepareDispatcher(n){if((yield*this.effectiveSchedulingMode())===Oe.FixedEffort){const a=yield*r.prepareDispatcher.call(this,n);return(yield vr(this.$.assigned))&&a.addProposedValueFlag(vt),a.addKeepIfPossibleFlag(pt),a}else return yield*r.prepareDispatcher.call(this,n)}cycleResolutionContext(n){if(this.effectiveSchedulingModeSync(n)===Oe.FixedEffort){const a=n(this.$.effectiveDirection);return a.direction===ae.Forward||a.direction===ae.None?kT:FT}else return r.cycleResolutionContext.call(this,n)}}return t}){},cd=tn.new({variables:new Set([De,we,Re,pt,vt]),formulas:new Set([un,Xt,bi,dn,hn,qt,Kt])}),LT=Pt.new({description:cd,defaultResolutionFormulas:new Set([un,Kt,bi])}),$T=Pt.new({description:cd,defaultResolutionFormulas:new Set([un,Kt,Xt])}),jT=Pt.new({description:cd,defaultResolutionFormulas:new Set([hn,qt,bi])}),BT=Pt.new({description:cd,defaultResolutionFormulas:new Set([hn,qt,Xt])}),HT=class extends G([Yc],e=>{const r=e.prototype;class t extends e{*prepareDispatcher(n){if((yield*this.effectiveSchedulingMode())===Oe.FixedUnits){const a=yield*r.prepareDispatcher.call(this,n);return(yield vr(this.$.assigned))&&a.addProposedValueFlag(vt),(yield this.$.effortDriven)&&a.addKeepIfPossibleFlag(pt),a.addKeepIfPossibleFlag(vt),a}else return yield*r.prepareDispatcher.call(this,n)}cycleResolutionContext(n){if(this.effectiveSchedulingModeSync(n)===Oe.FixedUnits){const a=n(this.$.effectiveDirection),o=n(this.$.effortDriven);return a.direction===ae.Forward||a.direction===ae.None?o?$T:LT:o?BT:jT}else return r.cycleResolutionContext.call(this,n)}}return t}){},VT=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},jL=class extends G([tC],e=>{const r=e.prototype;class t extends e{writeInactive(n,s,a,o){var l;const c=!s.baseRevision.hasIdentifier(n);if(n.constructor.prototype.write.call(this,n,s,a,o),!c&&this.children&&!((l=this.stm)!=null&&l.isRestoring))for(const d of this.children)d.inactive=o}*calculateInactive(){const n=yield Ee;if(yield*this.hasSubEvents()){const s=yield*this.subEventsIterable();let a=0;for(const o of s)(yield o.$.inactive)||a++;return!a}return n}*shouldRollupChildEffort(n){return!(yield n.$.inactive)||(yield this.$.inactive)}*shouldRollupChildPercentDoneSummaryData(n){return!(yield n.$.inactive)||(yield this.$.inactive)}*shouldRollupChildStartDate(n){return!(yield n.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEndDate(n){return!(yield n.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyStartDate(n){return!(yield n.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyEndDate(n){return!(yield n.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateStartDate(n){return!(yield n.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateEndDate(n){return!(yield n.$.inactive)||(yield this.$.inactive)}}return VT([br("inactive")],t.prototype,"writeInactive",null),VT([ie("inactive")],t.prototype,"calculateInactive",null),t}){},iC=class extends xp([ig,PT,Tg,tC,OT,HT,jL],e=>{class r extends e{}return r}){},NT=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},zT=class extends G([yi],e=>{const r=e.prototype;class t extends e{*calculateCriticalPaths(){const n=[],s=[],a=yield this.$.childEvents,o=[...a],l=yield this.$.endDate;let c;for(;c=o.shift();){const u=yield c.$.childEvents,h=yield c.$.critical,g=!(yield c.$.inactive),f=yield c.$.endDate;g&&f&&f.getTime()-l.getTime()===0&&h&&s.push([{event:c}]),o.push(...u)}let d;for(;d=s.shift();){let u=d.length-1,h;for(;h=d[u];){const g=[];for(const f of yield h.event.$.incomingDeps){const m=yield f.$.fromEvent;m&&(yield f.$.active)&&!(yield m.$.inactive)&&(yield m.$.critical)&&g.push({event:m,dependency:f})}if(g.length){const f=d.slice();d.push(g[0]);for(let m=1;m<g.length;m++)s.push(f.concat(g[m]));u++}else u=-1}n.push(d.reverse())}return n}}return NT([me({lazy:!0})],t.prototype,"criticalPaths",void 0),NT([ie("criticalPaths")],t.prototype,"calculateCriticalPaths",null),t}){},nC=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},WT=class extends G([lg,rg,Tg,zT],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.nonEqual=!1}*calculateNonEqual(){return!(yield Ee)}get isGanttProjectMixin(){return!0}afterConfigure(){r.afterConfigure.apply(this,arguments),this.projectConstraintIntervalClass=this.projectConstraintIntervalClass||Mg}*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}*calculateStartDate(){const n=yield this.$.effectiveDirection;if(n.direction===ae.Forward){let s=yield Ee;return s||(s=yield*this.unsafeCalculateInitialMinChildrenStartDateDeep(),s||(yield this.$.nonEqual)),s}else if(n.direction===ae.Backward){const s=yield*this.calculateMinChildrenStartDate(),a=yield this.$.endDate;return s&&a>s?s:a}}*calculateEndDate(){const n=yield this.$.effectiveDirection;if(n.direction===ae.Forward){const s=yield this.$.startDate,a=yield*this.calculateMaxChildrenEndDate();return a&&a>s?a:s}else if(n.direction===ae.Backward){let s=yield Ee;return s||(s=yield*this.unsafeCalculateInitialMaxChildrenEndDateDeep(),s||(yield this.$.nonEqual)),s}}*shouldRollupChildStartDate(n){return!(yield n.$.inactive)}*shouldRollupChildEndDate(n){return!(yield n.$.inactive)}*calculateEarlyStartDateConstraintIntervals(){const n=yield*r.calculateEarlyStartDateConstraintIntervals.call(this),s=yield this.$.effectiveDirection;if(s.direction===ae.Forward){const a=yield this.$.startDate;a&&n.push(this.projectConstraintIntervalClass.new({owner:this,side:Ye.Start,startDate:a}))}else if(s.direction===ae.Backward){const a=yield this.$.lateStartDate;a&&n.push(this.projectConstraintIntervalClass.new({owner:this,side:Ye.Start,startDate:a}))}return n}*calculateLateEndDateConstraintIntervals(){const n=yield*r.calculateLateEndDateConstraintIntervals.call(this),s=yield this.$.effectiveDirection;if(s.direction===ae.Forward){const a=yield this.$.earlyEndDate;a&&n.push(this.projectConstraintIntervalClass.new({owner:this,side:Ye.End,endDate:a}))}else if(s.direction===ae.Backward){const a=yield this.$.endDate;a&&n.push(this.projectConstraintIntervalClass.new({owner:this,side:Ye.End,endDate:a}))}return n}getDefaultEventModelClass(){return iC}getDefaultAssignmentModelClass(){return Jh}getDefaultResourceModelClass(){return og}getDefaultEventStoreClass(){return rb}getType(){return di.Gantt}*unsafeCalculateInitialMinChildrenStartDateDeep(){const n=yield this.$.childEvents;if(!n.size)return yield ms(this.$.startDate);let s=He,a;const o=[...n];for(;a=o.shift();){let l=yield ms(a.$.startDate);l||(l=yield ms(a.$.endDate)),l&&l<s&&(s=l),o.push(...yield a.$.childEvents)}return s.getTime()!==Xe.getTime()&&s.getTime()!==He.getTime()?s:null}*unsafeCalculateInitialMaxChildrenEndDateDeep(){const n=yield this.$.childEvents;if(!n.size)return yield ms(this.$.endDate);let s=Xe,a;const o=[...n];for(;a=o.shift();){let l=yield ms(a.$.endDate);l||(l=yield ms(a.$.startDate)),l&&l>s&&(s=l),o.push(...yield a.$.childEvents)}return s.getTime()!==Xe.getTime()&&s.getTime()!==He.getTime()?s:null}getDependencyCycleDetectionIdentifiers(n,s){return[s.$.earlyStartDateConstraintIntervals,s.$.earlyEndDateConstraintIntervals,s.$.lateEndDateConstraintIntervals,s.$.lateStartDateConstraintIntervals]}}return nC([me({equality:()=>!1})],t.prototype,"nonEqual",void 0),nC([ie("nonEqual")],t.prototype,"calculateNonEqual",null),t}){},GT=class extends Co{static get $name(){return"ProjectConstraintIntervalDescription"}static getDescription(e){return mr(e.startDate?this.L("L{startDateDescriptionTpl}"):this.L("L{endDateDescriptionTpl}"),...this.getDescriptionParameters(e))}},Mg=class extends an{isAffectedByTransaction(e){const r=this.owner;e=e||r.graph.activeTransaction;const t=e.entries.get(this.startDate?r.$.startDate:r.$.endDate);return t&&!t.isShadow()}};nC([pe(GT)],Mg.prototype,"descriptionBuilderClass",void 0);var Ig=class extends ye{static get $name(){return"AddNewColumn"}static get type(){return"addnew"}static get defaults(){return{text:"L{New Column}",cls:"b-new-column-column",draggable:!1,sortable:!1,exportable:!1,field:null,editor:null}}doDestroy(){var e;(e=this._combo)==null||e.destroy(),super.doDestroy()}get combo(){const e=this,r=e.grid.columns;return e._combo||(e._combo=new Fe({owner:e.grid,cls:"b-new-column-combo",placeholder:e.L("L{New Column}"),triggers:!1,autoExpand:!0,store:e.ganttColumnStore,displayField:"text",monitorResize:!1,picker:{align:{align:"t0-b0",axisLock:!0},minWidth:200,onItem({record:t}){const i=new t.value({region:e.region},r);r.insert(r.indexOf(e),i),i.element.focus()},onBeforeShow(){this.forElement=e.element}},syncInputFieldValue(){this.input.value=""},internalListeners:{keydown({event:t}){t.stopImmediatePropagation()}}}))}get ganttColumnStore(){return new re({data:Object.values(Z.columnTypes).reduce((e,r)=>(r.$meta.fields.exposedData||r.exposeProperties({}),r.isGanttColumn&&r.text&&e.push({id:r.type,text:r.optionalL(r.text),value:r}),e),[]),filters:[e=>!this.grid.columns.some(r=>r.constructor===e.value)],sorters:[{field:"text"}]})}headerRenderer({column:e,headerElement:r}){e.combo.render(r)}onKeyDown(e){e.key==="Enter"&&this.combo.focus()}updateLocalization(){this._combo&&(this._combo.destroy(),this._combo=null),super.updateLocalization()}};Z.registerColumnType(Ig),Ig._$name="AddNewColumn";var Jt=class extends li{static get defaults(){return{instantUpdate:!0,width:130,step:null,format:"ll"}}construct(e,r){const t=this;t.gantt=r.grid,super.construct(e,r),t.format?t.explicitFormat=!0:t.gantt.ion({displayDateFormatChange({format:i}){t.explicitFormat||t.set("format",i)}})}set format(e){this.explicitFormat=!0,this.set("format",e)}get format(){return this.explicitFormat&&this.data.format||this.gantt.displayDateFormat}set editor(e){super.editor=e}get editor(){const e=super.editor;return e&&(e.project=this.gantt.project),e}};E(Jt,"$name","GanttDateColumn"),E(Jt,"isGanttColumn",!0),Jt._$name="GanttDateColumn";var $s=class extends Jt{};E($s,"$name","BaselineStartDateColumn"),E($s,"type","baselinestartdate"),E($s,"defaults",{text:"L{baselineStart}",field:"baselines[0].startDate"}),Z.registerColumnType($s),$s._$name="BaselineStartDateColumn";var js=class extends Jt{};E(js,"$name","BaselineEndDateColumn"),E(js,"type","baselineenddate"),E(js,"defaults",{text:"L{baselineEnd}",field:"baselines[0].endDate"}),Z.registerColumnType(js),js._$name="BaselineEndDateColumn";var Bs=class extends Hr{};E(Bs,"$name","BaselineDurationColumn"),E(Bs,"type","baselineduration"),E(Bs,"defaults",{text:"L{baselineDuration}",field:"baselines[0].fullDuration"}),Z.registerColumnType(Bs),Bs._$name="BaselineDurationColumn";var Hs=class extends Hr{};E(Hs,"$name","BaselineDurationVarianceColumn"),E(Hs,"type","baselinedurationvariance"),E(Hs,"defaults",{editor:!1,text:"L{durationVariance}",field:"baselines[0].durationVariance"}),Z.registerColumnType(Hs),Hs._$name="BaselineDurationVarianceColumn";var Vs=class extends Hr{};E(Vs,"$name","BaselineStartVarianceColumn"),E(Vs,"type","baselinestartvariance"),E(Vs,"defaults",{editor:!1,text:"L{startVariance}",field:"baselines[0].startVariance"}),Z.registerColumnType(Vs),Vs._$name="BaselineStartVarianceColumn";var Ns=class extends Hr{};E(Ns,"$name","BaselineEndVarianceColumn"),E(Ns,"type","baselineendvariance"),E(Ns,"defaults",{editor:!1,text:"L{endVariance}",field:"baselines[0].endVariance"}),Z.registerColumnType(Ns),Ns._$name="BaselineEndVarianceColumn";var Pg=class extends Fe{static get $name(){return"CalendarPicker"}static get type(){return"calendarpicker"}refreshCalendars(e){this.store.data=e.map(r=>({id:r.id,text:r.name}))}get store(){return this._store||(this.store=new re),this._store}set store(e){super.store=e}get value(){return super.value}set value(e){e&&(e.isDefault&&e.isDefault()?e=null:e.id&&(e=e.id)),super.value=e}};Pg.initClass(),Pg._$name="CalendarPicker";var Ag=class extends ye{static get $name(){return"CalendarColumn"}static get type(){return"calendar"}static get isGanttColumn(){return!0}static get defaults(){return{field:"calendar",text:"L{Calendar}",editor:{type:Pg.type,clearable:!0,allowInvalid:!1}}}afterConstruct(){super.afterConstruct();const e=this,r=e.grid.project;e.defaultCalendar=r.defaultCalendar,e.refreshCalendars(),r.calendarManagerStore.ion({changePreCommit:e.refreshCalendars,refresh:e.refreshCalendars,thisObj:e})}refreshCalendars(){if(this.editor){const e=this.grid.project;this.editor.refreshCalendars(e.calendarManagerStore.allRecords)}}renderer({value:e}){var r;if(e!==this.defaultCalendar&&(e==null?void 0:e.id)!=null){const t=this.grid.project.calendarManagerStore.getById(e.id);return(r=t==null?void 0:t.name)!=null?r:""}return""}};Z.registerColumnType(Ag),Ag._$name="CalendarColumn";var _g=class extends Jt{static get $name(){return"ConstraintDateColumn"}static get type(){return"constraintdate"}static get defaults(){return{field:"constraintDate",text:"L{Constraint Date}",width:146}}};Z.registerColumnType(_g),_g._$name="ConstraintDateColumn";var BL={Forward:"assoonaspossible",Backward:"aslateaspossible"},kg=class extends ye{static get $name(){return"ConstraintTypeColumn"}static get type(){return"constrainttype"}static get isGanttColumn(){return!0}static get defaults(){return{field:"constraintType",text:"L{Constraint Type}",width:146,editor:{type:"constrainttypepicker",clearable:!0,allowInvalid:!1},filterable:{filterField:{type:"constrainttypepicker"}}}}get editor(){const e=super.editor;return e.includeAsapAlapAsConstraints=this.grid.project.includeAsapAlapAsConstraints,e}renderer({record:e,value:r}){return ko.localize(this.grid.project.includeAsapAlapAsConstraints&&BL[e.direction]||r)||""}};Z.registerColumnType(kg),kg._$name="ConstraintTypeColumn";var Fg=class extends Jt{static get $name(){return"DeadlineDateColumn"}static get type(){return"deadlinedate"}static get defaults(){return{field:"deadlineDate",text:"L{Deadline}",width:146}}};Z.registerColumnType(Fg),Fg._$name="DeadlineDateColumn";var Og=class extends Jt{static get $name(){return"EarlyEndDateColumn"}static get type(){return"earlyenddate"}static get defaults(){return{field:"earlyEndDate",text:"L{Early End}"}}};Z.registerColumnType(Og),Og._$name="EarlyEndDateColumn";var Lg=class extends Jt{static get $name(){return"EarlyStartDateColumn"}static get type(){return"earlystartdate"}static get defaults(){return{field:"earlyStartDate",text:"L{Early Start}"}}};Z.registerColumnType(Lg),Lg._$name="EarlyStartDateColumn";var $g=class extends Hr{static get $name(){return"EffortColumn"}static get type(){return"effort"}static get defaults(){return{field:"fullEffort",text:"L{Effort}"}}get defaultEditor(){return{type:ks.type,name:this.field}}};Z.registerColumnType($g),$g._$name="EffortColumn";var jg=class extends Jt{static get $name(){return"EndDateColumn"}static get type(){return"enddate"}static get defaults(){return{field:"endDate",text:"L{Finish}"}}get defaultEditor(){const e=super.defaultEditor;return e.type="enddate",e}};Z.registerColumnType(jg),jg._$name="EndDateColumn";var zs=class extends Nt{static get defaults(){return{field:"ignoreResourceCalendar",text:"L{Ignore resource calendar}"}}};E(zs,"$name","IgnoreResourceCalendarColumn"),E(zs,"type","ignoreresourcecalendar"),E(zs,"isGanttColumn",!0),Z.registerColumnType(zs),zs._$name="IgnoreResourceCalendarColumn";var Bg=class extends Nt{static get $name(){return"InactiveColumn"}static get type(){return"inactive"}static get isGanttColumn(){return!0}static get defaults(){return{field:"inactive",text:"L{Inactive}"}}};Z.registerColumnType(Bg),Bg._$name="InactiveColumn";var Hg=class extends Jt{static get $name(){return"LateEndDateColumn"}static get type(){return"lateenddate"}static get defaults(){return{field:"lateEndDate",text:"L{Late End}"}}};Z.registerColumnType(Hg),Hg._$name="LateEndDateColumn";var Vg=class extends Jt{static get $name(){return"LateStartDateColumn"}static get type(){return"latestartdate"}static get defaults(){return{field:"lateStartDate",text:"L{Late Start}"}}};Z.registerColumnType(Vg),Vg._$name="LateStartDateColumn";var Ng=class extends Nt{static get $name(){return"ManuallyScheduledColumn"}static get type(){return"manuallyscheduled"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",text:"L{Manually scheduled}"}}};Z.registerColumnType(Ng),Ng._$name="ManuallyScheduledColumn";var dd=class extends Nt{static get $name(){return"MilestoneColumn"}static get type(){return"milestone"}static get isGanttColumn(){return!0}static get defaults(){return{field:"milestone",text:"L{Milestone}"}}};E(dd,"suppressNoModelFieldWarning",!0),Z.registerColumnType(dd),dd._$name="MilestoneColumn";var jo=class extends Jn{static get $name(){return"NameColumn"}static get type(){return"name"}static get isGanttColumn(){return!0}static get defaults(){return{width:200,field:"name",text:"L{Name}"}}};Z.registerColumnType(jo),jo._$name="NameColumn";var zg=class extends ye{static get $name(){return"NoteColumn"}static get type(){return"note"}static get isGanttColumn(){return!0}static get defaults(){return{field:"note",text:"L{Note}",width:150,editor:{type:"textareapickerfield"}}}renderer({value:e}){return(e||"").trim()}};Z.registerColumnType(zg),zg._$name="NoteColumn";var Wg=class extends rr{constructor(){super(...arguments),E(this,"circleHeightPercentage",.75)}static get $name(){return"PercentDoneColumn"}static get type(){return"percentdone"}static get isGanttColumn(){return!0}static get fields(){return["showCircle"]}static get defaults(){return{field:"percentDone",text:"L{% Done}",unit:"%",step:1,min:0,max:100,width:90}}construct(e){super.construct(...arguments),this.showCircle&&(this.htmlEncode=!1)}defaultRenderer({record:e,isExport:r,value:t}){return t=e.getFormattedPercentDone(t),r?t:this.showCircle?{className:{"b-percentdone-circle":1,"b-full":t===100,"b-empty":t===0},style:{height:this.circleHeightPercentage*this.grid.rowHeight+"px",width:this.circleHeightPercentage*this.grid.rowHeight+"px","--gantt-percentdone-angle":`${t/100}turn`},dataset:{value:t}}:t+this.unit}};Z.registerColumnType(Wg),Wg._$name="PercentDoneColumn";var HL={from:[2,3,0,1],to:[1,0,3,2]},UT=()=>new RegExp(`(${sC.join("|")})?((?:[+-])\\d+[a-z]*)?`,"i"),sC=["SS","SF","FS","FF"],YT=UT(),qT=class extends Fe{construct(e){const r=this,{ourSide:t,otherSide:i}=e;r.dependencies=new $t({extraKeys:i}),r.startCollection=new $t({extraKeys:i}),super.construct(e),r.delimiterRegEx=new RegExp(`\\s*${r.delimiter}\\s*`);const n=()=>{sC=r.L("L{DependencyType.short}"),YT=UT(),r.syncInputFieldValue()};ze.ion({locale:n,thisObj:r}),n()}internalOnInput(){this.clearError(void 0,!0),this.isValid&&si.prototype.internalOnInput.call(this)}get invalidValueError(){return"L{invalidDependencyFormat}"}onInternalKeyDown(e){var r;const{key:t}=e;t==="Enter"?this.syncInvalid():(r=super.onInternalKeyDown)==null||r.call(this,e),this.pickerVisible&&t==="ArrowDown"&&this.filterField.focus()}onTriggerClick(){this.pickerVisible?super.onTriggerClick(...arguments):this.doFilter(this.filterInput?this.filterInput.value:null)}changeStore(e){return e=e.chain(r=>!this.eventRecord||r.id!==this.eventRecord.id,null,{excludeCollapsedRecords:!1,sorters:this.sorters}),super.changeStore(e)}changePicker(e,r){const t=this,i=t.filterField||(t.filterField=new si({cls:"b-dependency-list-filter",clearable:!0,placeholder:"Filter",triggers:{filter:{cls:"b-icon b-icon-filter",align:"start"}},internalListeners:{input({event:a}){t.filterOnInput(a)},clear({event:a}){Object.defineProperty(a,"target",{configurable:!0,value:n}),t.filterOnInput.now(a)}}})),n=t.filterInput=i.input,s=qT.reconfigure(r,e?N.merge({owner:t,store:t.store,cls:`b-dependency-list ${t.listCls}`,itemTpl:t.listItemTpl,forElement:t[t.pickerAlignElement],align:{anchor:t.overlayAnchor,target:t[t.pickerAlignElement],minHeight:t.inlinePicker?null:Math.min(3,t.store.count)*40},navigator:{keyEventTarget:n,processEvent:a=>{if(a.key==="Escape")t.hidePicker();else return a}},onItem:t.onPredecessorClick.bind(t),getItemClasses:function(a){const o=$r.prototype.getItemClasses.call(this,a),l=t.dependencies.getBy(t.otherSide+"Event",a),c=l?` b-selected b-${l.getConnectorString(1).toLowerCase()}`:"";return o+c}},e):null,t);return s?(s.ion({show(){Object.defineProperty(s.scrollable,"viewport",{get(){return k.client(this.element).deflate(i.height,0,0,0)}})},once:!0,thisObj:t}),i.owner=s,i.render(s.contentElement)):t.destroyProperties("filterField"),s}updateEventRecord(){this.store.fillFromMaster()}onPickerShow({source:e}){const r=this,{element:t}=r.filterField,{contentElement:i}=e;e.minWidth=r[r.pickerAlignElement].offsetWidth,i.firstChild!==t&&i.insertBefore(t,i.firstChild),super.onPickerShow(...arguments)}listItemTpl(e){const r=O.encodeHtml(e.name),{dependencyIdField:t}=this.owner,i=t&&t!==e.constructor.idField?t:e.constructor.idField,n=e.isPhantom?"":String(e[i]);return`<div class="b-predecessor-item-text">${r} ${n.length?`(${n})`:""}</div>
            <div class="b-sch-box b-from" data-side="from"></div>
            <div class="b-sch-box b-to" data-side="to"></div>`}get isValid(){return!!(!this.task||this.parseDependencies(this.input.value))&&super.isValid}set value(e){const r=this,t=r.dependencies;if(typeof e=="string"){if(r.input.value=e,e=r.parseDependencies(e),!e){r.syncInvalid();return}e=e.map(i=>new r.dependencyStore.modelClass(i))}else r.startCollection.clear(),e!==null&&(r.startCollection.values=e);t.clear(),e!==null&&(t.values=e),r.inputting||r.syncInputFieldValue()}get value(){return this.dependencies.values}get inputValue(){const e=this,{value:r}=e;return r==null?"":e.constructor.dependenciesToString(r,e.otherSide,e.delimiter,e.dependencyIdField)}onPredecessorClick({source:e,item:r,record:t,event:i}){const n=this,{dependencies:s}=n,a=i.target.closest(".b-sch-box"),o=a==null?void 0:a.dataset.side;let l=s.getBy(n.otherSide+"Event",t);if(r.dataset.noselect=!0,n.trigger("change",{value:n.value,event:i,userAction:!0}),l&&!a)s.remove(l);else if(l){const{id:c,type:d}=l;l=l.copy({id:c,type:HL[o][d]},{skipFieldIdentifiers:!0}),l[`${n.otherSide}Event`]=t,l[`${n.ourSide}Event`]=n.task,s.add(l)}else s.add(n.dependencyStore.createRecord({[`${n.otherSide}Event`]:t,[`${n.ourSide}Event`]:n.task},!0));n.syncInputFieldValue(),e.refresh()}static dependenciesToString(e,r,t=";",i="id"){const n=`${r}Event`,s=a=>{const o=a[n];return o!=null&&o.isModel?o[i]:o||""};return e!=null&&e.length?e.sort((o,l)=>s(o)-s(l)).map(o=>`${s(o)}${Zi.getLocalizedDependencyType(o.getConnectorString())}${o.getLag()}`).join(t):""}get task(){var e;return(e=this.owner)==null?void 0:e.record}parseDependencies(e){const r=this,{store:t,task:i,dependencyStore:n}=r,s=e.split(r.delimiterRegEx),a=n.modelClass,o=[];for(let l=0;l<s.length;l++){const c=s[l];if(c){let d=c.length+1,u=null,h;for(;d&&!u;d--)h=c.substr(0,d),u=t.find(m=>String(m[r.dependencyIdField])===h,!0);if(!u)return null;const g=c.substr(d+1),f={[`${r.otherSide}Event`]:u,[`${r.ourSide}Event`]:i,type:a.Type.EndToStart};if(g.length){const m=YT.exec(g);if(m&&(m[1]||m[2])){if(m[1]&&(f.type=sC.indexOf(m[1].toUpperCase())),m[2]){const p=b.parseDuration(m[2],!0,i.durationUnit);f.lag=p.magnitude,f.lagUnit=p.unit}}else return null}o.push(f)}}return o}get needsInputSync(){return super.needsInputSync||!this.isValid&&this.inputValue!==this.input.value}doDestroy(){this.dependencies.destroy(),this.startCollection.destroy(),super.doDestroy()}},Ws=qT;E(Ws,"$name","DependencyField"),E(Ws,"type","dependencyfield"),E(Ws,"configurable",{listCls:"b-predecessor-list",displayField:"name",valueField:"name",validateFilter:!1,minChars:0,clearTextOnPickerHide:!1,picker:{floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,minHeight:161,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},delimiter:";",dependencyStore:null,otherSide:null,ourSide:null,multiSelect:!0,chipView:null,validateOnInput:!1,dependencyIdField:null,eventRecord:null,sorters:[{field:"name"}]}),Ws.initClass(),Ws._$name="DependencyField";var VL=e=>!e.project,NL=e=>e,ud=class extends fe(ye){static get $name(){return"DependencyColumn"}static get type(){return"dependency"}static get fields(){return[{name:"delimiter",defaultValue:";"},{name:"dependencyIdField",defaultValue:null}]}static get defaults(){return{htmlEncode:!1,width:120,renderer({record:e,grid:r}){const t=this.dependencyIdField||r.dependencyIdField;return Ws.dependenciesToString(e[this.field],this.field==="predecessors"?"from":"to",this.delimiter,t)},filterable({value:e,record:r,column:t}){const i=t.dependencyIdField||t.grid.dependencyIdField;return e=e.toLowerCase(),r[`${t.field==="predecessors"?"predecessorTasks":"successorTasks"}`].some(n=>{var s;return n&&e.includes((s=n[i])==null?void 0:s.toString().toLowerCase())})}}}afterConstruct(){super.afterConstruct()}getFilterableValue(e){return this.renderer({record:e,grid:this.grid})}async finalizeCellEdit({grid:e,record:r,inputField:t,value:i,oldValue:n,editorContext:s}){if(t.clearError(),r&&i){const a=i.filter(VL),o=e.dependencyStore.getProject(),l=r[this.field];return await o.commitAsync(),o.isDestroyed?void 0:(await Promise.all(a.map(u=>o.isValidDependencyModel(u,l)))).every(NL)?!0:s.column.L("L{Invalid dependency}")}}get defaultEditor(){const e=this,{grid:r}=e,t=e.field==="predecessors";return{type:"dependencyfield",grid:r,name:e.field,delimiter:e.delimiter,dependencyIdField:e.dependencyIdField||r.dependencyIdField,ourSide:t?"to":"from",otherSide:t?"from":"to",store:r.eventStore||r.taskStore,dependencyStore:r.dependencyStore}}};Z.registerColumnType(ud),ud._$name="DependencyColumn";var Gg=class extends ud{constructor(){super(...arguments),E(this,"canFillValue",()=>!1)}static get $name(){return"PredecessorColumn"}static get type(){return"predecessor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Predecessors}",field:"predecessors"}}};Z.registerColumnType(Gg),Gg._$name="PredecessorColumn";var Gs=class extends xo{static get defaultConfig(){return{storage:{extraKeys:["resource"]},callOnFunctions:!0,projectEvent:null,floatAssignedResources:!0,liveFloatAssignedResources:!1}}afterConfigure(){const e=this;super.afterConfigure(),e.addSorter({fn:e.defaultSort.bind(e)})}get projectEvent(){return this._projectEvent}set projectEvent(e){var r,t;const i=this;(e!=i._projectEvent||e&&e.generation!==i._projectEventGeneration||((r=e==null?void 0:e.getProject())==null?void 0:r.assignmentStore.storage.generation)!==i._assignmentStoreGeneration)&&(i._projectEvent=e,i._projectEventGeneration=e==null?void 0:e.generation,i._assignmentStoreGeneration=(t=e==null?void 0:e.getProject())==null?void 0:t.assignmentStore.storage.generation,e?(i.fillFromMaster(),i.sort()):i.removeAll())}get floatAssignedResources(){return this._floatAssignedResources}set floatAssignedResources(e){const r=this;e!==r.floatAssignedResources&&(r._floatAssignedResources=e,r.sort())}fillFromMaster(){const e=this,{projectEvent:r}=e;if(r){const{assignmentStore:t,resourceStore:i}=r,n=t.modelClass.getFieldDefinition("resource").dataSource,s=t.modelClass.getFieldDefinition("event").dataSource,a=[];i.forEach(o=>{const l=t.getAssignmentForEventAndResource(r,o),c=Object.assign({units:0},l==null?void 0:l.data);delete c.id,delete c.eventId,delete c.resourceId,delete c[n],delete c[s],Object.assign(c,{resource:o,event:r}),a.push(c)},this,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0}),e.data=a}}toValue(){return this.query(e=>e.units>0)}toValueString(){return this.toValue().join(", ")}defaultSort(e,r){let t=0;return this.floatAssignedResources?!r.units&&e.units?t=-1:!e.units&&r.units?t=1:t=e.resourceName.localeCompare(r.resourceName):t=e.resourceName.localeCompare(r.resourceName),t}onUpdate({changes:e}){const r=this;r.isConfiguring||Object.hasOwnProperty.call(e,"event")&&r.floatAssignedResources&&r.liveFloatAssignedResources&&r.sort()}};Gs._$name="AssignmentsManipulationStore";var Bo=class extends Ci{static get fields(){return[{name:"event",persist:!0,serialize:e=>e==null?void 0:e.id,isEqual:rn},{name:"resource",persist:!0,serialize:e=>e==null?void 0:e.id,isEqual:rn},"eventId","resourceId"]}};Bo._$name="AssignmentModel";var zL={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{Save:"Save"},IgnoreResourceCalendarColumn:{"Ignore resource calendar":"Ignore resource calendar"},InactiveColumn:{Inactive:"Inactive"},AddNewColumn:{"New Column":"New Column"},BaselineStartDateColumn:{baselineStart:"Baseline Start"},BaselineEndDateColumn:{baselineEnd:"Baseline Finish"},BaselineDurationColumn:{baselineDuration:"Baseline Duration"},BaselineStartVarianceColumn:{startVariance:"Start Variance"},BaselineEndVarianceColumn:{endVariance:"Finish Variance"},BaselineDurationVarianceColumn:{durationVariance:"Duration Variance"},CalendarColumn:{Calendar:"Calendar"},EarlyStartDateColumn:{"Early Start":"Early Start"},EarlyEndDateColumn:{"Early End":"Early End"},LateStartDateColumn:{"Late Start":"Late Start"},LateEndDateColumn:{"Late End":"Late End"},TotalSlackColumn:{"Total Slack":"Total Slack"},ConstraintDateColumn:{"Constraint Date":"Constraint Date"},ConstraintTypeColumn:{"Constraint Type":"Constraint Type"},DeadlineDateColumn:{Deadline:"Deadline"},DependencyColumn:{"Invalid dependency":"Invalid dependency"},DurationColumn:{Duration:"Duration"},EffortColumn:{Effort:"Effort"},EndDateColumn:{Finish:"Finish"},EventModeColumn:{"Event mode":"Event mode",Manual:"Manual",Auto:"Auto"},ManuallyScheduledColumn:{"Manually scheduled":"Manually scheduled"},MilestoneColumn:{Milestone:"Milestone"},NameColumn:{Name:"Name"},NoteColumn:{Note:"Note"},PercentDoneColumn:{"% Done":"% Done"},PredecessorColumn:{Predecessors:"Predecessors"},ResourceAssignmentColumn:{"Assigned Resources":"Assigned Resources","more resources":"more resources"},RollupColumn:{Rollup:"Rollup"},SchedulingModeColumn:{"Scheduling Mode":"Scheduling Mode"},SchedulingDirectionColumn:{schedulingDirection:"Scheduling direction",inheritedFrom:"Inherited from",enforcedBy:"Enforced by"},SequenceColumn:{Sequence:"Sequence"},ShowInTimelineColumn:{"Show in timeline":"Show in timeline"},StartDateColumn:{Start:"Start"},SuccessorColumn:{Successors:"Successors"},TaskCopyPaste:{copyTask:"Copy",cutTask:"Cut",pasteTask:"Paste"},WBSColumn:{WBS:"WBS",renumber:"Renumber"},DependencyField:{invalidDependencyFormat:"Invalid dependency format"},ProjectLines:{"Project Start":"Project start","Project End":"Project end"},TaskTooltip:{Start:"Start",End:"End",Duration:"Duration",Complete:"Complete"},AssignmentGrid:{Name:"Resource name",Units:"Units",unitsTpl:({value:e})=>e?e+"%":""},Gantt:{Edit:"Edit",Indent:"Indent",Outdent:"Outdent","Convert to milestone":"Convert to milestone",Add:"Add...","New task":"New task","New milestone":"New milestone","Task above":"Task above","Task below":"Task below","Delete task":"Delete",Milestone:"Milestone","Sub-task":"Subtask",Successor:"Successor",Predecessor:"Predecessor",changeRejected:"Scheduling engine rejected the changes",linkTasks:"Add dependencies",unlinkTasks:"Remove dependencies",color:"Color"},EventSegments:{splitTask:"Split task"},Indicators:{earlyDates:"Early start/end",lateDates:"Late start/end",Start:"Start",End:"End",deadlineDate:"Deadline"},Versions:{indented:"Indented",outdented:"Outdented",cut:"Cut",pasted:"Pasted",deletedTasks:"Deleted tasks"}},gj=yt.publishLocale(zL),aC=class extends lh{static get $name(){return"ResourceAssignmentGridResourceColumn"}static get type(){return"assignmentResource"}static get defaults(){return{showEventCount:!1,cls:"b-assignmentgrid-resource-column",field:"resourceName",flex:1,editor:null,useNameAsImageName:!1,filterable:{filterField:{placeholder:"L{AssignmentGrid.Name}",triggers:{filter:{align:"start",cls:"b-icon b-icon-filter"}}}}}}defaultRenderer({grid:e,record:r,cellElement:t,value:i,isExport:n}){return r.isSpecialRow||(r=r.resource),super.defaultRenderer({grid:e,record:r,cellElement:t,value:i,isExport:n})}};Z.registerColumnType(aC),aC._$name="ResourceAssignmentGridResourceColumn";var Ug=class extends tc{static get $name(){return"AssignmentGrid"}static get type(){return"assignmentgrid"}static get configurable(){return{resourceImageExtension:".jpg",minHeight:200,resourceColumn:{type:"assignmentResource"},unitsColumn:{field:"units",type:rr.type,text:"L{Units}",localeClass:this,width:70,min:0,max:100,step:10,unit:"%",renderer:({value:e})=>this.L("L{unitsTpl}",{value:Math.round(e)}),filterable:!1}}}static get defaultConfig(){return{selectionMode:{checkboxOnly:!0,multiSelect:!0,showCheckAll:!0},features:{group:!1,filterBar:!0,contextMenu:!1},disableGridRowModelWarning:!0,projectEvent:null}}construct(){super.construct(...arguments),this.ion({selectionChange:({selected:e,deselected:r})=>{e.forEach(t=>t.units=t.units||t.getFieldDefinition("units").defaultValue),r.forEach(t=>{this.store.includes(t)&&(t.units=0)})}})}get projectEvent(){const e=this,r=e.store;let t=e._projectEvent;return r&&t!==r.projectEvent&&(t=e._projectEvent=r.projectEvent),t}set projectEvent(e){const r=this;r._projectEvent=e,r.store.projectEvent=e,e&&(r.selectedRecords=r.store.query(t=>e.assignments.find(i=>i.resource===t.resource)))}get store(){return super.store}set store(e){var r,t;const i=this,n=i.store;e&&n!==e&&(e instanceof Gs||(e=Gs.new({modelClass:((r=i._projectEvent)==null?void 0:r.assignmentStore.modelClass)||Bo,projectEvent:i._projectEvent},e)),super.store=e,(t=i.storeDetacher)==null||t.call(i),i.storeDetacher=e.ion({update:"onAssignmentUpdate",thisObj:i}))}set columns(e){e&&e.unshift(N.clone(this.resourceColumn),N.clone(this.unitsColumn)),super.columns=e}get columns(){return super.columns}onAssignmentUpdate({record:e,changes:r}){const{units:t}=r;t&&(t.value?t.oldValue===0&&this.selectRow({record:e,scrollIntoView:!1,addToSelection:!0}):this.deselectRow(e))}};Ug.initClass(),Ug._$name="AssignmentGrid";var Yg=class extends Ug{static get $name(){return"AssignmentPicker"}static get type(){return"assignmentpicker"}static get defaultConfig(){return{trapFocus:!0,height:"20em",minWidth:"25em",bbar:[{type:"button",text:this.L("L{Object.Save}"),localeClass:this,ref:"saveBtn",color:"b-green"},{type:"button",text:this.L("L{Object.Cancel}"),localeClass:this,ref:"cancelBtn",color:"b-gray"}],projectEvent:null,store:null}}configure(e){e.selectedRecordCollection=e.assignments,super.configure(e)}show(){return this.originalSelected=this.selectedRecords.map(e=>e.copy()),super.show(...arguments)}afterConfigure(){var e,r;const t=this;super.afterConfigure(),(e=t.bbar.widgetMap.saveBtn)==null||e.ion({click:"onSaveClick",thisObj:t}),(r=t.bbar.widgetMap.cancelBtn)==null||r.ion({click:"onCancelClick",thisObj:t})}onSaveClick(){this.hide()}onCancelClick(){this.hide()}};Yg.initClass(),Yg._$name="AssignmentPicker";var qg=class extends Fe{static get $name(){return"AssignmentField"}static get type(){return"assignmentfield"}static get configurable(){return{editingRecords:!0,chipView:{cls:"b-assignment-chipview",itemTpl(e){return O.xss`${e.resourceName} ${Math.round(e.units)}%`},scrollable:{overflowX:"hidden-scroll"}},triggers:{expand:{cls:"b-icon-down",handler:"onTriggerClick"}},multiSelect:!0,clearable:!1,editable:!1,value:null,picker:{type:Yg.type,floating:!0,scrollAction:"realign"},pickerWidth:null,projectEvent:null,store:{},tooltipTemplate(){return O.encodeHtml(this.store.toValueString())}}}onChipClose(e){this.showPicker(),this.picker.deselectRows(e)}syncInputFieldValue(){super.syncInputFieldValue();const{store:e}=this;e&&this.tooltipTemplate&&(this.tooltip=this.tooltipTemplate({taskRecord:e.projectEvent,assignmentRecords:e.toValue()}))}onTriggerClick(e){this.pickerVisible?this.hidePicker():jn.prototype.showPicker.call(this,e&&"key"in e)}focusPicker(){this.picker.focus()}changePicker(e,r){const t=this;return super.changePicker(e&&T.assign({projectEvent:t.projectEvent,store:t.store,readOnly:t.readOnly,resourceImagePath:t.resourceImageFolderPath,assignments:t.valueCollection,onCancelClick(){t.value=this.originalSelected,this.hide()},align:{anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},internalListeners:{hide:()=>{t.isDestroying||t.store.clearFilters(t.containsFocus)}}},e)||null,r)}changeProjectEvent(e){const{picker:r,store:t}=this;return this._projectEvent=e,t&&(t.projectEvent=e),r&&(r.projectEvent=e),e}changeStore(e){return e&&!(e instanceof Gs)&&(e=new Gs(e)),e}updateStore(e){const r=this;if(r.detachListeners("storeMutation"),e instanceof Gs){const{projectEvent:t}=e;t?r.projectEvent=t:e.projectEvent=r.projectEvent}e.ion({name:"storeMutation",change:"syncInputFieldValue",thisObj:r})}get value(){return super.value}set value(e){e=e==null?void 0:e.map(r=>{const t=this.store.find(i=>i.resource===r.resource,!0);return t==null||t.copyData(r),t}),super.value=e}hasChanged(e,r){return!T.isEqual(e,r)}onPickerKeyDown(e){const r=this.picker;e.key==="ArrowDown"&&e.target.compareDocumentPosition(r.bodyContainer)===document.DOCUMENT_POSITION_FOLLOWING?r.element.focus():e.key==="Escape"&&!r.focusedCell.isActionable&&this.hidePicker()}cacheCurrentValue(e){return Array.isArray(e)?this._value=e.map(r=>r.copy(r.id)):super.cacheCurrentValue(e)}};qg.initClass(),qg._$name="AssignmentField";var WL=e=>e.resourceName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Kg=class extends ye{constructor(){super(...arguments),E(this,"internalCellCls","b-resourceassignment-cell")}static get $name(){return"ResourceAssignmentColumn"}static get type(){return"resourceassignment"}static get isGanttColumn(){return!0}static get fields(){return["showAvatars","sideMargin",{name:"itemTpl",defaultValue:(e,r,t=!0)=>t?O.encodeHtml(e.toString()):e.toString()},"avatarTooltipTemplate",{name:"showAllNames",type:"boolean",defaultValue:!0},{name:"enableResourceDragging"},"avatarTooltip",{name:"avatarMaxSize",defaultValue:50}]}static get defaults(){return{field:"assignments",instantUpdate:!1,text:"L{Assigned Resources}",width:250,showAvatars:!1,sideMargin:20,sortable(e,r){const t=e.assignments.join(""),i=r.assignments.join("");return t===i?0:t<i?-1:1},filterable({value:e,record:r}){if(Array.isArray(e)){if(!e.length)return!r.assignments.length;e=e.map(WL).join("|")}const t=new RegExp(e,"gi");return r.assignments.some(i=>t.test(i.resourceName))},alwaysClearCell:!1}}construct(){super.construct(...arguments);const e=this,{grid:r}=e;e.showAvatars&&Object.assign(e,{repaintOnResize:!0,htmlEncode:!1,renderer:e.rendererWithAvatars,avatarRendering:new qn({element:r.element,tooltip:T.assign({forSelector:".b-resourceassignment-cell .b-resource-avatar",internalListeners:{beforeShow({source:t}){var i;const{taskRecord:n,resourceRecord:s,assignmentRecord:a,overflowCount:o,overflowAssignments:l}=t.activeTarget.elementData,c=(i=e.avatarTooltipTemplate)==null?void 0:i.call(e,{taskRecord:n,resourceRecord:s,assignmentRecord:a,overflowCount:o,tooltip:t,overflowAssignments:l});if(t.items.length===0){const d=e.showAllNames?`${O.encodeHtml(a)}<br />${l.join("<br />")}`:O.xss`${a}${o?` (+${o} ${e.L("L{more resources}")})`:""}`;t.html=c!=null?c:d}}}},e.avatarTooltip)})}),e.enableResourceDragging&&e.grid.ion({paint:e.setupDragging,thisObj:e,once:!0}),r.ion({beforeCellEditStart:e.onBeforeCellEditStart,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),e.showAvatars&&(r.ion({beforeRenderRows:e.calculateAvatarSize,once:!0,thisObj:e}),r.rowManager.ion({beforeRowHeight:e.calculateAvatarSize,thisObj:e})),r.resourceStore.ion({name:"resourceStore",update:e.onResourceUpdate,thisObj:e})}calculateAvatarSize({height:e}){const{grid:r}=this,t=e||r.rowHeight,{cellElement:i}=r.beginGridMeasuring();i.classList.add(this.internalCellCls);const n=globalThis.getComputedStyle(i),s=parseInt(n.paddingTop,10);this.avatarRendering.size=Math.min(this.avatarMaxSize,t-2*s),i.classList.remove(this.internalCellCls),r.endGridMeasuring()}doDestroy(){var e,r;super.doDestroy(),(e=this.avatarRendering)==null||e.destroy(),(r=this.dragHelper)==null||r.destroy()}get defaultEditor(){return{type:qg.type,store:{modelClass:this.grid.project.assignmentStore.modelClass}}}onBeforeCellEditStart({editorContext:{record:e,column:r}}){const t=this;if(r===t){const{editor:i}=t;i.resourceImageFolderPath=t.grid.resourceImageFolderPath,i.projectEvent=e,t.detachListeners("editorStore"),i.store.ion({name:"editorStore",changesApplied:t.onEditorChangesApplied,thisObj:t})}}onDoneCellEdit(){this.detachListeners("editorStore")}onEditorChangesApplied(){const e=this,r=e.grid.getCell({id:e.editor.projectEvent.id,columnId:e.id});r&&e.renderer({value:e.editor.projectEvent.assignments,cellElement:r})}onResourceUpdate({source:e}){var r;(r=e.project)!=null&&r.propagatingLoadChanges||this.grid.refreshColumn(this)}get chipView(){const e=this;return e._chipView||(e._chipView=new Bn({parent:e,cls:"b-assignment-chipview",navigator:null,itemsFocusable:!1,closable:!1,itemTpl:e.itemTpl,store:{},scrollable:{overflowX:"hidden-scroll"}}),Object.defineProperty(e.chipView,"isVisible",{get(){return!0}}),e.chipView.triggerPaint()),e._chipView}renderer({cellElement:e,value:r,isExport:t}){if(r=r.filter(i=>i.resource).sort((i,n)=>i.resourceName.localeCompare(n.resourceName)),t)return r.map((i,n)=>this.itemTpl(i,n,!1)).join(",");{const{chipView:i}=this,n=e.querySelector(".b-assignment-chipview-wrap")||w.createElement({parent:e,className:"b-assignment-chipview-wrap"});i.store.storage.replaceValues({values:r,silent:!0}),i.refresh();const s=i.element.cloneNode(!0);s.removeAttribute("id"),n.innerHTML="",n.appendChild(s)}}rendererWithAvatars({record:e,value:r,isExport:t}){r=r.filter(l=>l.resource).sort((l,c)=>l.resourceName.localeCompare(c.resourceName));const i=this,{size:n}=i.avatarRendering,s=Math.floor((i.width-i.sideMargin)/(n+2)),a=r.length>s?r.length-s:0,o=r.length>s?r.filter(l=>r.indexOf(l)>=s):[];return t?r.map((l,c)=>this.itemTpl(l,c,!1)).join(","):{className:"b-resource-avatar-container",children:r.map((l,c)=>{const{resource:d}=l;if(c<s){const u=a>0&&c===s-1,h=i.renderAvatar({taskRecord:e,resourceRecord:d,assignmentRecord:l,overflowCount:u?a:0,overflowAssignments:u?o:[]});return u?{className:"b-overflow-img",style:{height:n+"px",width:n+"px"},children:[h,{tag:"span",className:"b-overflow-count",html:`+${a}`}]}:h}})}}renderAvatar({taskRecord:e,resourceRecord:r,assignmentRecord:t,overflowCount:i,overflowAssignments:n}){const{resourceImageFolderPath:s}=this.grid,a=r.imageUrl||r.image&&s&&s+r.image,o=this.avatarRendering.getResourceAvatar({resourceRecord:r,initials:r.initials,color:r.eventColor,iconCls:r.iconCls,defaultImageUrl:this.defaultAvatar,imageUrl:a});return o.elementData||(o.elementData={}),Object.assign(o.elementData,{taskRecord:e,resourceRecord:r,assignmentRecord:t,overflowCount:i,overflowAssignments:n}),o}get defaultAvatar(){const{grid:e}=this;return e.defaultResourceImageName?e.resourceImageFolderPath+e.defaultResourceImageName:""}toClipboardString({record:e}){return O.safeJsonStringify(e[this.field])}fromClipboardString({string:e,record:r}){const t=O.safeJsonParse(e),i=[];if(t!=null&&t.length)for(const n of t)delete n.id,delete n.event,delete n.resource,n.eventId=r.id,i.push(new Bo(n));return i}canFillValue({range:e}){return e.every(r=>r.column===this)}calculateFillValue({record:e,value:r}){const t=JSON.stringify(r);return this.fromClipboardString({string:t,record:e})}setupDragging(){const e=this,{grid:r}=e;r.features.rowReorder&&(r.features.rowReorder.dragHelper.targetSelector+=" .b-grid-cell:not(.b-resourceassignment-cell)"),e.subGrid.element.classList.add("b-draggable-resource-avatars"),e.dragHelper=new ki({callOnFunctions:!0,cloneTarget:!0,targetSelector:".b-resource-avatar-container > .b-resource-avatar",onDragStart({context:t}){const{grabbed:i}=t;t.resourceRecord=i.elementData.resourceRecord,r.enableScrollingCloseToEdges()},onDrag({context:t,event:i}){const n=t.targetTask=r.resolveTaskRecord(i.target);t.valid=!!(n&&!n.resources.includes(t.resourceRecord))},async onDrop({context:t,event:i}){const{targetTask:n,resourceRecord:s,valid:a,grabbed:o,element:l}=t,{assignmentRecord:c,taskRecord:d}=o.elementData,u=i.target.closest(".b-resourceassignment-cell");if(a&&(o.style.display="none"),!u)l.style.display="none",d.unassign(s);else if(a){const h=r.getCell({column:e,record:n}),g=h==null?void 0:h.querySelector(".b-resource-avatar-container");g&&await this.animateProxyTo(g,{align:"l0-r0"}),n.resources.includes(s)||(c.event=n)}r.disableScrollingCloseToEdges()}})}};Z.registerColumnType(Kg),Kg._$name="ResourceAssignmentColumn";var Xg=class extends Nt{static get $name(){return"RollupColumn"}static get type(){return"rollup"}static get isGanttColumn(){return!0}static get defaults(){return{field:"rollup",text:"L{Rollup}"}}};Z.registerColumnType(Xg),Xg._$name="RollupColumn";var Us=class extends ye{static get defaults(){return{field:"direction",text:"L{schedulingDirection}",width:146,editor:{type:"schedulingdirectionpicker",allowInvalid:!1},filterable:{filterField:{type:"schedulingdirectionpicker"}}}}getEnforcedName(e){return e.name||(e.isRoot?"Project":`Task #${e.id}`)}get tooltipRenderer(){return this._tooltipRenderer!==void 0?this._tooltipRenderer:this._tooltipRenderer=({record:e})=>{const{effectiveDirection:r}=e;return r?r.kind==="enforced"?this.L("L{enforcedBy}")+` "${this.getEnforcedName(r.enforcedBy)}"`:r.kind==="inherited"?this.L("L{inheritedFrom}")+` "${this.getEnforcedName(r.inheritedFrom)}"`:void 0:!1}}renderer({record:e}){const{effectiveDirection:r}=e;if(!r)return"";let t;return r.kind==="enforced"||r.kind==="inherited"?t=r.direction:t=e.direction,Fo.localize(t)||""}};E(Us,"$name","SchedulingDirectionColumn"),E(Us,"type","schedulingdirection"),E(Us,"isGanttColumn",!0),Z.registerColumnType(Us),Us._$name="SchedulingDirectionColumn";var Zg=class extends ye{static get $name(){return"SchedulingModeColumn"}static get type(){return"schedulingmodecolumn"}static get isGanttColumn(){return!0}static get defaults(){return{field:"schedulingMode",text:"L{Scheduling Mode}",editor:{type:nd.type,allowInvalid:!1,picker:{minWidth:"8.5em"}}}}afterConstruct(){const e=this;super.afterConstruct();let r;e.editor?(Te.createSequence(e.editor.updateLocalization,e.onEditorLocaleChange,e),r=e.editor.store):r=new nd().store,this.store=r}renderer({value:e}){const r=this.store.getById(e);return r&&r.text||""}onEditorLocaleChange(){this.grid.refreshColumn(this)}canFillValue({range:e}){return e.every(r=>r.column===this)}};Z.registerColumnType(Zg),Zg._$name="SchedulingModeColumn";var Jg=class extends ye{static get $name(){return"SequenceColumn"}static get type(){return"sequence"}static get isGanttColumn(){return!0}static get defaults(){return{field:"sequenceNumber",text:"L{Sequence}",sortable:!1,groupable:!1,filterable:!1,width:70,editor:null}}};Z.registerColumnType(Jg),Jg._$name="SequenceColumn";var Qg=class extends Nt{static get $name(){return"ShowInTimelineColumn"}static get type(){return"showintimeline"}static get isGanttColumn(){return!0}static get defaults(){return{field:"showInTimeline",text:"L{Show in timeline}"}}};Z.registerColumnType(Qg),Qg._$name="ShowInTimelineColumn";var ef=class extends Jt{static get $name(){return"StartDateColumn"}static get type(){return"startdate"}static get defaults(){return{field:"startDate",text:"L{Start}"}}get defaultEditor(){const e=super.defaultEditor;return e.type="startdate",e}};Z.registerColumnType(ef),ef._$name="StartDateColumn";var tf=class extends ud{constructor(){super(...arguments),E(this,"canFillValue",()=>!1)}static get $name(){return"SuccessorColumn"}static get type(){return"successor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Successors}",field:"successors"}}};Z.registerColumnType(tf),tf._$name="SuccessorColumn";var rf=class extends Hr{static get $name(){return"TotalSlackColumn"}static get type(){return"totalslack"}static get isGanttColumn(){return!0}get durationUnitField(){return"slackUnit"}static get defaults(){return{field:"totalSlack",text:"L{Total Slack}",filterable({value:e,record:r,operator:t,column:i}){const n=b.asMilliseconds(i.roundValue(r.totalSlack),r.slackUnit),s=e.milliseconds;switch(t){case"=":return n===s;case"<":return n<s;case"<=":return n<=s;case">":return n>s;case">=":return n>=s;default:throw new Error("Invalid operator "+t)}}}}getFilterableValue(e){return new _e({magnitude:e.totalSlack,unit:e.slackUnit})}};Z.registerColumnType(rf),rf._$name="TotalSlackColumn";var nf=class extends ye{constructor(){super(...arguments),E(this,"canFillValue",()=>!1)}static get $name(){return"WBSColumn"}static get type(){return"wbs"}static get isGanttColumn(){return!0}static get defaults(){return{field:"wbsValue",text:"L{WBS}",width:70,editor:null,filterable({value:e,record:r}){return r.wbsValue.match(String(e))},headerMenuItems:{renumber:{text:"L{WBSColumn.renumber}",icon:"b-icon-renumber",onItem({source:e}){e.taskStore.rootNode.refreshWbs()}}},renderer({value:e}){return String(e)}}}};Z.registerColumnType(nf),nf._$name="WBSColumn";var GL={AddNewColumn:Ig,BaselineStartDateColumn:$s,BaselineEndDateColumn:js,BaselineDurationColumn:Bs,BaselineStartVarianceColumn:Vs,BaselineEndVarianceColumn:Ns,BaselineDurationVarianceColumn:Hs,CalendarColumn:Ag,ConstraintDateColumn:_g,ConstraintTypeColumn:kg,DeadlineDateColumn:Fg,DurationColumn:Hr,EarlyEndDateColumn:Og,EarlyStartDateColumn:Lg,EffortColumn:$g,EndDateColumn:jg,IgnoreResourceCalendarColumn:zs,InactiveColumn:Bg,LateEndDateColumn:Hg,LateStartDateColumn:Vg,ManuallyScheduledColumn:Ng,MilestoneColumn:dd,NameColumn:jo,NoteColumn:zg,PercentDoneColumn:Wg,PredecessorColumn:Gg,ResourceAssignmentColumn:Kg,RollupColumn:Xg,SchedulingDirectionColumn:Us,SchedulingModeColumn:Zg,SequenceColumn:Jg,ShowInTimelineColumn:Qg,StartDateColumn:ef,SuccessorColumn:tf,TotalSlackColumn:rf,WBSColumn:nf},oC=class extends Nt{static get $name(){return"EventModeColumn"}static get type(){return"eventmode"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",align:"left",text:"L{Event mode}"}}internalRenderer({value:e,cellElement:r,column:t,isExport:i}){if(super.internalRenderer(...arguments),i)return this.renderText(e);r.widget&&(r.widget.text=this.renderText(e))}onCheckboxChange({source:e,checked:r}){super.onCheckboxChange(...arguments),e.text=this.renderText(r)}renderText(e){return e?this.L("L{Manual}"):this.L("L{Auto}")}};Z.registerColumnType(oC),oC._$name="EventModeColumn";var lC=class extends mc{static get defaults(){return{enableCellContextMenu:!0}}};Z.registerColumnType(lC),lC._$name="TimeAxisColumn";var cC=class extends xo{static get defaultConfig(){return{modelClass:Bo,loadPriority:500,syncPriority:400}}};cC._$name="AssignmentStore";var sf=class extends Zc{};sf._$name="CalendarModel";var dC=class extends hg{static get defaultConfig(){return{modelClass:sf}}};dC._$name="CalendarManagerStore";var af=class extends Ts{constructor(...e){const[r]=e;r!=null&&r.fromTask&&(r.fromEvent=r.fromTask),r!=null&&r.toTask&&(r.toEvent=r.toTask),super(...e)}get from(){var e;return(e=this.fromEvent)==null?void 0:e.id}set from(e){super.from=e}get fromTask(){return this.fromEvent}set fromTask(e){this.fromEvent=e}get to(){var e;return(e=this.toEvent)==null?void 0:e.id}set to(e){super.to=e}get toTask(){return this.toEvent}set toTask(e){this.toEvent=e}get persistableData(){const e=super.persistableData,{fromTask:r,toTask:t}=e;return r&&(e.fromTask=r.id),t&&(e.toTask=t.id),e}shouldRecordFieldChange(e,r,t){return e==="from"||e==="to"?!1:super.shouldRecordFieldChange(e,r,t)}};af._$name="DependencyModel";var uC=class extends gg{static get defaultConfig(){return{modelClass:af,loadPriority:300,syncPriority:500}}};uC._$name="DependencyStore";var of=class extends Ro{};of._$name="ResourceModel";var hC=class extends vg{static get defaultConfig(){return{modelClass:of,loadPriority:400,syncPriority:200}}};hC._$name="ResourceStore";var lf=class extends St{constructor(){super(...arguments),E(this,"isBaseline",!0)}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:r}=this;if(e&&r)return r.getTime()===e.getTime()}return this.duration===0}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}normalize(){const e=this,{task:r,startDate:t,endDate:i,duration:n}=e,s=n!=null;r.graph?t&&i&&!s?e.setData("duration",r.run("calculateProjectedDuration",t,i)):t&&!i&&s?e.setData("endDate",r.run("calculateProjectedXDateWithDuration",t,!0,n)):!t&&i&&s&&e.setData("startDate",r.run("calculateProjectedXDateWithDuration",i,!1,n)):super.normalize()}get startVariance(){const{task:e}=this,r=b.getDurationInUnit(this.startDate,e.startDate,e.durationUnit);return new _e({magnitude:r,unit:e.durationUnit})}get endVariance(){const{task:e}=this,r=b.getDurationInUnit(this.endDate,e.endDate,e.durationUnit);return new _e({magnitude:r,unit:e.durationUnit})}get durationVariance(){return this.fullDuration&&this.task.fullDuration.diff(this.fullDuration)}};E(lf,"fields",[{name:"task",persist:!1}]),lf._$name="Baseline";var cf=class extends er{static get type(){return"wbs"}convert(e){return it.from(e)}serialize(e){return String(e)}};cf.prototype.compare=it.compare,cf.initClass(),cf._$name="WbsField";var gC=(e,r)=>{const{startDate:t,durationUnit:i,endDate:n}=e;return r?r.map(s=>{const a=+("startDate"in s)+("endDate"in s)+("duration"in s)>1,o={task:e,...s};return a||Object.assign(o,{startDate:t,endDate:n,durationUnit:i}),o}):[]},UL=e=>e.field==="wbsValue"&&!e.ascending,YL=e=>{for(let r,t,i=0,n=e.length;i<n;++i)if(t=e[i].wbsValue,t){if(r)return t<r;r=t}return!1},qL={deep:!0},KL={deep:!0,silent:!0},Ys=class extends iC.derive(St).mixin(At,fg){constructor(){super(...arguments),E(this,"$manuallyScheduled",null)}static get fields(){return[{name:"cls",serialize:e=>e.isDomClassList?e.toString():e,persist:!0},{name:"fullEffort",persist:!1},{name:"baselines",type:"store",modelClass:lf,storeClass:re,lazy:!0},{name:"note",type:"string"},"parentId",{name:"children",persist:!1},{name:"showInTimeline",type:"boolean"},{name:"rollup",type:"boolean"},{name:"wbsValue",type:"wbs",persist:!1},{name:"deadlineDate",type:"date"},{name:"parentIndex",type:"number",persist:!0},"iconCls","taskIconCls",{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0},"eventColor"]}getDefaultSegmentModelClass(){return mg}endBatch(){const{isPersistable:e}=this;super.endBatch(...arguments),this.isPersistable&&!e&&this.assignments.forEach(r=>{r.stores.forEach(t=>{t.updateModifiedBagForRecord(r)})})}get isTask(){return!0}get isTaskModel(){return!0}get isEvent(){return!0}get wbsCode(){return String(this.wbsValue)}set wbsCode(e){this.wbsValue=it.from(e)}copy(...e){const r=super.copy(...e);return r.setData("wbsValue",null),r}processBaselinesStoreData(e){return gC(this,e)}set baselines(e){this.set({baselines:e})}get baselines(){const e=this;return e.$initializedBaselines||(e.fieldMap.baselines.init(e.data,e),e.assignInitables(),e.$initializedBaselines=!0),e.meta.baselinesStore}get hasBaselines(){var e,r;const t=this.fieldMap.baselines;return!!((r=(e=this.baselines)==null?void 0:e.count)!=null?r:this.originalData[t.dataSource])}setBaseline(e){if(e<=0)return;const{baselines:r}=this,t=e-r.count;t>0?r.add(gC(this,new Array(t).fill({}))):r.getAt(e-1).set(gC(this,[{}])[0])}get successors(){return Array.from(this.outgoingDeps||[])}set successors(e){this.outgoingDeps=e}setSuccessors(e){return this.replaceDependencies(e,!0)}replaceDependencies(e,r){const t=this,{dependencyStore:i}=t.project,n=new Set,s=new Set,a=[],o=r?t.outgoingDeps:t.incomingDeps,l=Array.from(o);return e.forEach(c=>{const d=l.find(r?u=>u.toEvent===c.toEvent:u=>u.fromEvent===c.fromEvent);d?(n.add(d),d.copyData(c)):s.add(c)}),o.forEach(c=>{n.has(c)||a.push(c)}),a.forEach(c=>i.remove(c)),s.forEach(c=>{r?c.fromEvent=t:c.toEvent=t,i.add(c)}),t.commitAsync()}get predecessors(){return Array.from(this.incomingDeps||[])}set predecessors(e){this.incomingDeps=e}setPredecessors(e){return this.replaceDependencies(e,!1)}get assignments(){return super.assignments}set assignments(e){const r=this,{assignmentStore:t}=r.project,i=[],n=r.assignments,s=n.filter(a=>!(e!=null&&e.find(o=>o.resource===a.resource)));e.forEach(a=>{const o=t.getAssignmentForEventAndResource(this,a.resource);o?o.copyData(a):(a.remove(),i.push(a))}),t.remove(s),t.add(i)}get assigned(){var e;const{project:r}=this;return r!=null&&r.isDelayingCalculation?(e=r.assignmentStore.storage.findItem("event",this))!=null?e:new Set:super.assigned}set assigned(e){super.assigned=e}get isDraggable(){return this.draggable}get isResizable(){return this.resizable&&!this.milestone&&this.isEditable("endDate")}get isMilestone(){return this.milestone}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":case"lateStartDate":case"lateEndDate":case"totalSlack":return!1;case"effort":case"fullEffort":case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}isFieldModified(e){return e==="fullEffort"?super.isFieldModified("effort")||super.isFieldModified("effortUnit"):super.isFieldModified(e)}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:r}=this;if(e&&r)return r.getTime()===e.getTime()}return this.duration===0}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}get allDependencies(){return this.dependencies}get dependencies(){var e;return(e=this.project)!=null&&e.isDelayingCalculation?[]:[...this.incomingDeps||[],...this.outgoingDeps||[]]}set dependencies(e){const r=this,t=[],i=[];e==null||e.forEach(n=>{n.fromEvent===r||n.fromEvent===r.id?i.push(n):(n.toEvent===r||n.toEvent===r.id)&&t.push(n)}),r.setPredecessors(t),r.setSuccessors(i)}get predecessorTasks(){return[...this.incomingDeps||[]].map(e=>e.fromEvent)}get successorTasks(){return[...this.outgoingDeps||[]].map(e=>e.toEvent)}get previousSiblingsTotalCount(){let e=this.previousSibling,r=this.parentIndex;for(;e;)r+=e.descendantCount,e=e.previousSibling;return r}get sequenceNumber(){if(this.taskStore)return this.taskStore.allIndexOf(this)+1;let e=0,r=this;for(;r.parent;)e+=r.previousSiblingsTotalCount+1,r=r.parent;return e}get isSubProject(){return!1}get subProject(){const e=this;let r=null;return e.isProject?r=e:e.bubbleWhile(t=>(t.isProject&&(r=t),!r)),r}get fullEffort(){return new _e({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get resources(){return this.assignments.reduce((e,r)=>(r.resource&&e.push(r.resource),e),[])}get $linkedResources(){var e,r;return(r=(e=this.resources)==null?void 0:e.flatMap(t=>[t,...t.$links]))!=null?r:[]}normalize(){}inSetNormalize(e){}joinStore(e){var r,t;const i=this,n=(i.firstStore||e).useOrderedTreeForWbs;!i.wbsValue&&!i.generatedParent&&((i.taskStore||e).isLoadingData||!((r=i.nextSibling)!=null&&r.wbsValue||(t=i.previousSibling)!=null&&t.wbsValue)?i.refreshWbs({useOrderedTree:n,...KL}):i.parent.refreshWbs(qL,-1)),super.joinStore(e)}refreshWbs(e,r){var t,i,n,s,a,o;const l=this,{parent:c}=l,d=l.firstStore||null,{useOrderedTree:u=(t=d==null?void 0:d.useOrderedTreeForWbs)!=null?t:!1}=e||{};if(c&&r!==-1&&l.fieldMap.wbsValue){u?r=l.orderedParentIndex:r=(i=r!=null?r:l.unfilteredIndex)!=null?i:l.parentIndex,r++;const h=c.isRoot?new it(r):c.wbsValue.append(r);e!=null&&e.silent?l.setData("wbsValue",h):l.set("wbsValue",h)}if((n=e==null?void 0:e.deep)==null||n)if(u)for(const h of(s=l.orderedChildren)!=null?s:[])h.refreshWbs(e);else{const h=(a=l.unfilteredChildren)!=null?a:l.children,g=(h==null?void 0:h.length)||0;if(g){const f=YL(h)&&((o=d==null?void 0:d.sorters)==null?void 0:o.findIndex(UL))===0;for(let m=0;m<g;++m)h[m].refreshWbs(e,f?g-m-1:m)}}}async tryInsertChild(){return this.getProject().tryPropagateWithChanges(()=>{this.insertChild(...arguments)})}updateDependencies(e,r){this.outgoingDeps.forEach(t=>{if(t.toEvent.isScheduled){const{type:i,calendar:n,toEvent:s}=t;e&&(i===mt.Type.StartToStart?t.setLag(b.as("hour",n.calculateDurationMs(e,s.startDate,!0)),"hour"):i===mt.Type.StartToEnd&&t.setLag(b.as("hour",n.calculateDurationMs(e,s.endDate,!0)),"hour")),r&&(i===mt.Type.EndToStart?t.setLag(b.as("hour",n.calculateDurationMs(r,s.startDate,!0)),"hour"):i===mt.Type.EndToEnd&&t.setLag(b.as("hour",n.calculateDurationMs(r,s.endDate,!0)),"hour"))}})}async moveTaskPinningSuccessors(e){const r=this;return r.startDate=e,r.bubble(t=>{if(!t.isRoot){const i=t.run("calculateStartDate"),n=t.run("calculateEndDate");t.updateDependencies(i,n)}}),r.project.commitAsync()}async setStartDatePinningSuccessors(e){const r=this,t=r.setStartDate(e,!1);return r.bubble(i=>{if(!i.isRoot){const n=i.run("calculateStartDate");i.updateDependencies(n,null)}}),t}async setEndDatePinningSuccessors(e){const r=this;return r.endDate=e,r.bubble(t=>{if(!t.isRoot){const i=t.run("calculateEndDate");t.updateDependencies(null,i)}}),r.project.commitAsync()}getCurrentConfig(e){const{segments:r}=this,t=super.getCurrentConfig(e);return t&&r&&(t.segments=r.map(i=>i.getCurrentConfig(e))),t}};Ys.convertEmptyParentToLeaf=!0,Ys._$name="TaskModel";var hd={deep:!0},KT=Object.freeze({add:!0,remove:!0,sort:!0}),XL=Object.freeze({add:!1,remove:!1,sort:!1}),fC=(e,r)=>it.compare(e==null?void 0:e.wbsCode,r==null?void 0:r.wbsCode),gd=class extends rb.derive(bt).mixin(At,ev,Wu){static get defaultConfig(){return{modelClass:Ys,loadPriority:200,syncPriority:300,storeId:"tasks",tree:!0}}static get configurable(){return{wbsMode:"manual",useOrderedTreeForWbs:!1,outdentIgnoringSiblings:!1,forceWbsOrderForChanges:!1}}changeWbsMode(e){return e==="auto"?KT:e&&typeof e=="object"?(T.values(e).every(r=>!r)&&(e=T.assign({},KT,e)),e):XL}setBaseline(e){const r=this.storage.values;this.forEach(t=>t.setBaseline(e)),this.trigger("refresh",{action:"batch",records:r,data:r})}async indent(e){const r=this,{taskStore:t,project:i}=r;let n=!1;if(e=Array.isArray(e)?e.slice():[e],e=e.filter(s=>!s.isProjectModel),e=e.filter(s=>{let a;for(a=!!s.previousSibling;a&&!s.isRoot;)a=!e.includes(s.parent),s=s.parent;return a}),e.length&&t.trigger("beforeIndent",{records:e})!==!1){if(e.sort((s,a)=>it.compare(s.wbsCode,a.wbsCode)),t.beginBatch(),n=await i.tryPropagateWithChanges(()=>{for(const s of e){const a=s.previousSibling;a.appendChild(s),r.toggleCollapse(a,!1)}}),r.isDestroyed)return;t.endBatch(),n&&(r.refreshWbsForChildren({up:2,nodes:e}),r.trigger("indent",{records:e}),r.trigger("change",{action:"indent",records:e}))}return n}async outdent(e){const r=this,{taskStore:t,project:i}=r;let n=!1;if(e=Array.isArray(e)?e.slice():[e],e=e.filter(s=>!s.isProjectModel),e=e.filter(s=>{let a;for(a=s.parent&&!s.parent.isRoot;a&&!s.isRoot;)a=!e.includes(s.parent),s=s.parent;return a}),e.length&&t.trigger("beforeOutdent",{records:e})!==!1){if(e.sort((s,a)=>it.compare(a.wbsCode,s.wbsCode)),t.beginBatch(),n=await i.tryPropagateWithChanges(()=>{for(const s of e){const a=!this.outdentIgnoringSiblings&&s.parent.children.slice(s.parent.children.indexOf(s)+1);s.parent.parent.insertChild(s,s.parent.nextSibling,!1,{orderedBeforeNode:s.parent.nextOrderedSibling}),a.length&&s.appendChild(a),r.toggleCollapse(s,!1)}}),r.isDestroyed)return;t.endBatch(),n&&(r.refreshWbsForChildren({up:1,nodes:e}),r.trigger("outdent",{records:e}),r.trigger("change",{action:"outdent",records:e}))}return n}onNodeAddChild(e,r,t,i,n=!1){if(super.onNodeAddChild(e,r,t,i,n),!this.isLoadingData&&this.wbsMode.add){e.refreshWbs(hd);const s=new Set;r.forEach(a=>{const o=this.getById(a.meta.oldParentId);o&&e!==o&&!s.has(o)&&(s.add(o),o.refreshWbs(hd,-1))})}}onNodeRemoveChild(e,r,t,i={isMove:!1,silent:!1,unfiltered:!1}){const n=super.onNodeRemoveChild(e,r,t,i);return this.wbsMode.remove&&!i.isMove&&e.refreshWbs(hd),n}applyChangeset(e,r=null,...t){var i,n,s;const a=this,{updated:o,modified:l}=(i=r==null?void 0:r(e,a))!=null?i:e,c=(n=o!=null?o:l)!=null?n:[],d=a.forceWbsOrderForChanges&&a.tree&&!a.isSorted&&!a.isGrouped?c.reduce((h,{id:g,parentId:f})=>{var m,p;if(f!==void 0){const v=a.getById(g),y=(m=v==null?void 0:v.parent)==null?void 0:m.parentId;f===y&&h.push({node:v,originalNodeAbove:(p=v.previousSibling)!=null?p:v.parent})}return h},[]):[],u=super.applyChangeset(e,r,...t);if(d.length>0)for(const{node:h,originalNodeAbove:g}of d){const{parent:f}=h,m=g.parent===f?g.parentIndex:((s=g.parent)==null?void 0:s.parent)===f?g.parent.parentIndex:void 0;m!==void 0&&f.children.includes(h)&&f.insertChild(h,m+1)}return u}afterChangesetApplied(e){super.afterChangesetApplied(e),e.forEach(r=>{r.refreshWbs({deep:!0,useOrderedTree:!0})})}afterPerformSort(e){this.wbsMode.sort&&this.rootNode.refreshWbs(hd),super.afterPerformSort(e)}refreshWbsForChildren(e){const r=e.nodes,t={...hd,...e},i=new Set,n=t.up||0;let s,a;r.forEach(o=>{for(a=o,s=n;a&&s;--s)a=a.parent;i.add(a)});for(a of i)a.refreshWbs(t)}getTotalTimeSpan(){return{startDate:this.getProject().startDate,endDate:this.getProject().endDate}}getEventsForResource(e){const r=this.resourceStore.getById(e),t=(r==null?void 0:r.assignments.filter(n=>n.isPartOfStore(this.assignmentStore)))||[],i=[];return t.forEach(({event:n})=>n&&i.push(n)),i}isDateRangeAvailable(e,r,t,i){const n=new Set(this.getEventsForResource(i));if(t!=null&&t.isAssignment&&t.event.resources.forEach(o=>{o.id!==t.resourceId&&this.getEventsForResource(o).forEach(l=>n.add(l))}),t){const s=t.isAssignment?t.event:t;n.delete(s)}return!Array.from(n).some(s=>s.isScheduled&&b.intersectSpans(e,r,s.startDate,s.endDate))}linkTasks(e){for(let r=1;r<e.length;r++){const t=e[r-1],i=e[r];this.dependencyStore.getEventsLinkingDependency(t,i)||this.dependencyStore.add({from:t,to:i})}}unlinkTasks(e){this.dependencyStore.remove(this.dependencyStore.query(({fromTask:r,toTask:t})=>e.includes(r)||e.includes(t)))}get changes(){const e=super.changes;return e&&this.forceWbsOrderForChanges&&(e.added.sort(fC),e.modified.sort(fC),e.removed.sort(fC)),e}};E(gd,"$name","TaskStore"),gd._$name="TaskStore";var XT=".b-task-baseline",df=class extends ls{static get $name(){return"Baselines"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:XT,recordType:"baseline"}}static get pluginConfig(){return{chain:["onTaskDataGenerated","onPaint"]}}updateRenderer(){this.gantt.refresh()}construct(e,r){this.tipId=`${e.id}-baselines-tip`,this.gantt=e,super.construct(e,r)}doDisable(e){this.client.refreshWithTransition(),super.doDisable(e)}resolveTimeSpanRecord(e){const r=e.closest(XT);return r==null?void 0:r.elementData.baseline}template(e){const r=this,{baseline:t}=e,{task:i}=t,n=r.client.formatDuration(t.duration);return`
            <div class="b-gantt-task-title">${O.encodeHtml(i.name)} (baseline ${t.parentIndex+1})</div>
            <table>
            <tr><td>${r.L("L{TaskTooltip.Start}")}:</td><td>${e.startClockHtml}</td></tr>
            ${t.milestone?"":`
                <tr><td>${r.L("L{TaskTooltip.End}")}:</td><td>${e.endClockHtml}</td></tr>
                <tr><td>${r.L("L{TaskTooltip.Duration}")}:</td><td class="b-right">${n+" "+b.getLocalizedNameOfUnit(t.durationUnit,t.duration!==1)}</td></tr>
            `}
            </table>
            `}getTaskDOMConfig(e,r){const t=this,i=e.baselines.allRecords,{rtl:n}=t.client,s=n?"right":"left";return{className:{"b-baseline-wrap":!0},style:{transform:`translateY(${r}px)`},dataset:{taskId:`baselinesFor${e.id}`},children:i.map((a,o)=>{const l=t.gantt.taskRendering.getTaskBox(a),c=l?n?t.client.timeAxisSubGrid.totalFixedWidth-l.left:l.left:0;if(l){const d={className:{[a.cls]:a.cls,"b-task-baseline":1,"b-task-baseline-milestone":a.milestone},style:{width:l.width,[s]:c,style:a.style},dataset:{index:o},elementData:{baseline:a}},u=t.renderer?t.renderer({baselineRecord:a,taskRecord:e,renderData:d}):"";return typeof u=="string"?d.html=u:d.children=[u].flat(),d}else return null}),syncOptions:{syncIdField:"index"}}}onTaskDataGenerated({taskRecord:e,top:r,extraConfigs:t,wrapperCls:i}){!this.disabled&&e.hasBaselines&&(i["b-has-baselines"]=1,t.push(this.getTaskDOMConfig(e,r)))}};E(df,"configurable",{renderer:null}),df._$name="Baselines",j.registerFeature(df,!1,"Gantt");var mC=class extends Cg{static get $name(){return"CellEdit"}static get defaultConfig(){return{addNewAtEnd:{duration:1}}}static get pluginConfig(){const e=super.pluginConfig;return e.chain=[...e.chain,"onProjectChange"],e}onProjectChange(){this.cancelEditing(!0)}getEditorForCell({record:e}){var r;const t=super.getEditorForCell(...arguments),{inputField:i}=t;return i.project=e.project,i.eventRecord=e,(r=i.loadEvent)==null||r.call(i,e,!1),t}doAddNewAtEnd(){const e=this,r=e.grid,{addNewAtEnd:t,addToCurrentParent:i}=e,{project:n,newTaskDefaults:s}=r;return n.queue(async()=>{if(await(!n.isDestroying&&n.commitAsync()),r.isDestroyed||r.store!==r.taskStore)return null;const a=T.assign({name:e.L("L{Gantt.New task}"),startDate:n.startDate},t,s);let o;return i?o=r.addTaskBelow(r.taskStore.last,{data:a}):o=r.taskStore.rootNode.appendChild(a),await n.commitAsync(),r.isDestroyed?null:(r.rowManager.getRowFor(o)||r.rowManager.displayRecordAtBottom(),o)})}onCellEditStart(){this.client.project.suspendAutoSync()}afterCellEdit(){this.client.project.resumeAutoSync()}};mC._$name="CellEdit",j.registerFeature(mC,!0,"Gantt");var pC=class extends fe(Q){static get $name(){return"CriticalPaths"}static get defaultConfig(){return{cls:"b-gantt-critical-paths",criticalDependencyCls:"b-critical",disabled:!0}}static get pluginConfig(){return{chain:["onTaskDataGenerated"]}}doDisable(e){const r=this;e?r.unhighlightCriticalPaths():r.client.project.graph?r.highlightCriticalPaths():r.client.project.ion({graphReady(){r.highlightCriticalPaths()},thisObj:r,once:!0}),super.doDisable(e)}getDependenciesFeature(){return this.client.foregroundCanvas&&this.client.features.dependencies}setupObserver(){const e=this,{project:r}=e.client;let t;e.destroyObserver(),e.criticalPathObserver=r.getGraph().observe(function*(){return yield r.$.criticalPaths},i=>{if(!e.disabled){if(e.removeCriticalCls(),t=t||e.getDependenciesFeature())for(const n of i)for(const s of n)s.dependency&&t.highlight(s.dependency,e.criticalDependencyCls);e.client.trigger("criticalPathsHighlighted")}})}destroyObserver(){var e,r;this.criticalPathObserver&&((r=(e=this.client.project)==null?void 0:e.getGraph)==null||r.call(e).removeIdentifier(this.criticalPathObserver),this.criticalPathObserver=null)}doDestroy(){this.destroyObserver(),super.doDestroy()}highlightCriticalPaths(){const e=this,{element:r}=e.client;r.classList.contains(e.cls)&&e.unhighlightCriticalPaths(),e.setupObserver(),r.classList.add(e.cls)}removeCriticalCls(){const e=this.client.project,r=this.getDependenciesFeature();r&&e.dependencyStore.forEach(t=>r.unhighlight(t,this.criticalDependencyCls))}unhighlightCriticalPaths(){const e=this,r=e.client;e.destroyObserver(),e.removeCriticalCls(),r.element.classList.remove(e.cls),r.trigger("criticalPathsUnhighlighted")}onTaskDataGenerated(e){this.disabled||(e.cls["b-critical"]=e.taskRecord.critical)}};pC._$name="CriticalPaths",j.registerFeature(pC,!0,"Gantt");var ZL=["start","start","end","end"],JL=["start","end","start","end"],QL=({fromTask:e},{fromTask:r})=>(e==null?void 0:e.critical)===(r==null?void 0:r.critical)?0:e!=null&&e.critical?1:-1,vC=e=>Math.round(e*2)/2,fd=class extends ed{construct(e,r={}){e.isGantt&&(this.gantt=e),super.construct(e,r)}createMarkers(){super.createMarkers();const e=this.endMarker.cloneNode(!0);e.setAttribute("id","arrowEndCritical"),e.retainElement=!0,this.client.svgCanvas.appendChild(e)}get rowStore(){return this.client.store}attachToResourceStore(...e){this.gantt||super.attachToResourceStore(...e)}getDependencyKey(e,...r){return this.gantt||super.getDependencyKey(e,...r),e.id}getAssignmentElement(e){return this.gantt?this.client.getElementFromTaskRecord(e):super.getAssignmentElement(e)}getAssignmentBounds(e){if(!this.gantt)return super.getAssignmentBounds(e);const{client:r}=this,t=r.getElementFromTaskRecord(e);return t&&!r.isExporting?k.from(t,this.relativeTo):r.isEngineReady&&r.getTaskBox(e,!0,!0)}isDependencyVisible(e){var r,t;return this.gantt?((r=e.fromEvent)==null?void 0:r.isScheduled)&&((t=e.toEvent)==null?void 0:t.isScheduled):super.isDependencyVisible(e)}drawDependency(e,r=!1,t=null){if(!this.gantt)return super.drawDependency(e,r,t);const i=this,{domConfigs:n,client:s}=i,{store:a}=s,o=s.firstVisibleRow.dataIndex,l=s.lastVisibleRow.dataIndex,{startMS:c,endMS:d}=s.visibleDateRange,{fromEvent:u,toEvent:h}=e;if(a.isAvailable(u)&&a.isAvailable(h)){const g=a.indexOf(u),f=a.indexOf(h),m=Math.min(u.startDateMS,h.startDateMS),p=Math.max(u.endDateMS,h.endDateMS);if(s.isExporting||g!=null&&f!=null&&!(g<o&&f<o||g>l&&f>l||m<c&&p<c||m>d&&p>d)){const v=i.getDomConfigs(e,u,h,t);v?n.set(e.id,v):n.delete(e.id)}i.afterDrawDependency(e,g,f,m,p)}r||i.domSync()}getDependenciesToConsider(e,r,t,i){var n;const s=(n=super.getDependenciesToConsider)==null?void 0:n.call(this,e,r,t,i),a=this.client.features.criticalPaths;return s&&(a!=null&&a.enabled)?Array.from(s).sort(QL):s}adjustLineDef(e,r){const t=this;if(!t.gantt)return r;const{rtl:i}=t.gantt,{startBox:n,endBox:s}=r,a=t.pathFinder.startArrowMargin,o=t.client.getRecordCoords(e.fromEvent,!0),l=t.client.getRecordCoords(e.toEvent,!0),c=vC(n.getEnd(i)),d=vC(s.getStart(i)),u=vC(s.getEnd(i)),h=i?d<=c&&u<=c+a:d>=c&&u>=c+a;return e.type===ft.EndToStart&&n.bottom<s.y&&h&&(r.endSide="top",e.toEvent.milestone||(i?s.x=s.right-a*2:s.width=a*2)),{...r,startBox:s,endBox:n,endSide:r.startSide,startSide:r.endSide,boxesReversed:!0,otherBoxes:[{start:n.x,end:n.right,top:o.y,bottom:o.bottom},{start:s.x,end:s.right,top:l.y,bottom:l.bottom}]}}drawForTask(){ne.deprecate("Gantt","6.0.0","Dependencies.drawForTask() is no longer needed"),this.refresh()}getHoverTipHtml({activeTarget:e}){const r=this.resolveDependencyRecord(e);return this.tooltipTemplate(r)}async createDependency(e){const r=this,{source:t,target:i,fromSide:n,toSide:s}=e,a=(n==="start"?0:2)+(s==="end"?1:0),o=r.dependencyStore.add({fromEvent:t,toEvent:i,type:a})[0];return await r.dependencyStore.project.commitAsync(),o}};E(fd,"$name","Dependencies"),E(fd,"configurable",{terminalSides:["left","right"],highlightDependenciesOnEventHover:!0,tooltipTemplate(e){if(!e)return null;const r=this,{dependencyIdField:t}=r.client,{fromEvent:i,toEvent:n}=e;return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:r.L("L{from}")},{text:`${i.name} ${i[t]}`},{className:`b-sch-box b-${e.fromSide||ZL[e.type]}`},{tag:"label",text:r.L("L{to}")},{text:`${n.name} ${n[t]}`},{className:`b-sch-box b-${e.toSide||JL[e.type]}`},e.lag?{tag:"label",text:r.L("L{DependencyEdit.Lag}")}:null,e.lag?{text:e.fullLag}:null]}]}},pathFinderConfig:{otherHorizontalMargin:0,otherVerticalMargin:0}}),fd._$name="Dependencies",j.registerFeature(fd,!0,"Gantt");var yC=class extends ls{static get $name(){return"Indicators"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",forSelector:".b-indicator",recordType:"indicator",hoverDelay:500,layoutStyle:{flexDirection:"column"},defaultIndicators:{earlyDates:e=>e.earlyStartDate&&!e.isMilestone?{startDate:e.earlyStartDate,endDate:e.earlyEndDate,cls:"b-bottom b-early-dates",name:this.L("L{earlyDates}")}:null,lateDates:e=>e.lateStartDate&&!e.isMilestone?{startDate:e.lateStartDate,endDate:e.lateEndDate,cls:"b-bottom b-late-dates",name:this.L("L{lateDates}")}:null,constraintDate:e=>e.constraintDate?{startDate:e.constraintDate,cls:`b-bottom b-constraint-date b-constraint-type-${e.constraintType}`,name:this.L(`L{ConstraintTypePicker.${e.constraintType}}`)}:null,deadlineDate:e=>e.deadlineDate?{startDate:e.deadlineDate,cls:"b-bottom b-deadline-date",name:this.L("L{deadlineDate}")}:null},items:null,tooltipTemplate:e=>{const{indicator:r}=e,t=O.encodeHtml(r.name);return e.endDate?`
                        ${r.name?`<div class="b-gantt-task-title">${t}</div>`:""}
                        <table>
                            <tr><td>${this.L("L{Start}")}:</td><td>${e.startClockHtml}</td></tr>
                            <tr><td>${this.L("L{End}")}:</td><td>${e.endClockHtml}</td></tr>
                        </table>
                    `:`
                    ${r.name?`<div class="b-gantt-task-title">${t}</div>`:""}
                    ${e.startText}
                `}}}static get pluginConfig(){return{chain:["onTaskDataGenerated","onPaint"]}}construct(e,r={}){this.tipId=`${e.id}-indicators-tip`,r=Object.assign({},r);const{items:t}=r;super.construct(e,r),this.items=t}template(...e){return this.tooltipTemplate(...e)}set items(e){const r=this;r._indicators=T.assign({},r.defaultIndicators,e),r._indicatorAccessors={},r._indicatorStatus={};for(const t in r._indicators)r._indicatorStatus[t]=!!r._indicators[t],typeof r._indicators[t]!="function"&&(r._indicators[t]=r.defaultIndicators[t]),Object.defineProperty(r._indicatorAccessors,t,{enumerable:!0,get(){return r._indicatorStatus[t]?r._indicators[t]:!1},set(i){r._indicatorStatus[t]=i,r.client.refresh()}})}get items(){return this._indicatorAccessors}createIndicatorDOMConfig(e,r){const{gantt:t,renderData:i}=this,{taskRecord:n}=i,{cls:s,iconCls:a}=e,{rtl:o,timeAxis:l,timeAxisViewModel:c}=t;let{startDate:d,endDate:u}=e;u&&(u=Math.min(u,c.endDate)),t.fillTicks&&(d=l.getSnappedTickFromDate(d).startDate,u&&(u=l.getSnappedTickFromDate(u).endDate));const h=c.getPositionFromDate(d),g=u?Math.abs(c.getPositionFromDate(u-h)):null,f=s!=null&&s.isDomClassList?s:new J(s),m=i.top||t.store.indexOf(n)*t.rowManager.rowOffsetHeight+t.resourceMargin,p=i.height||t.rowHeight-t.resourceMargin*2;return e.taskRecord=n,{className:Object.assign(f,{"b-indicator":1,"b-has-icon":e.iconCls}),style:{[o?"right":"left"]:h,top:m,height:p,width:g,style:e.style},dataset:{taskId:`${i.taskId}-indicator-${r}`,taskRecordId:i.taskId},children:[a?{tag:"i",className:a}:null],elementData:e}}onTaskDataGenerated(e){if(this.disabled)return;const{items:r}=this,t=[];for(const i in r){const n=r[i];if(this._indicatorStatus[i]&&typeof n=="function"){const s=n(e.taskRecord);s&&this.client.timeAxis.timeSpanInAxis(s.startDate,s.endDate)&&t.push(s)}}e.extraConfigs.push(...t.map(this.createIndicatorDOMConfig,{gantt:this.client,renderData:e}))}resolveTimeSpanRecord(e){return e.lastDomConfig.elementData}};yC._$name="Indicators",j.registerFeature(yC,!1);var bC=class extends Dc{static get $name(){return"Labels"}static get pluginConfig(){return{chain:["onTaskDataGenerated"]}}onTaskDataGenerated(e){this.onEventDataGenerated(e)}};bC._$name="Labels",j.registerFeature(bC,!1,"Gantt");var md=class extends Q{constructor(){super(...arguments),E(this,"highlighted",new Map)}highlightParent(e){const{highlighted:r}=this;if(e&&!e.isProjectModel&&!r.has(e)){const{client:t}=this,{rowOffsetHeight:i}=t.rowManager,n=e.visibleDescendantCount,s=t.getTaskBox(e);if(!s)return;const a={className:{"b-parent-area":1},style:{top:s.top,height:(n+1)*i-s.top%i,left:s.left,width:s.width},dataset:{taskId:`parent-area-${e.id}`}};r.set(e,a),this.highlightParent(e.parent)}}onBeforeTaskSync(e){if(!this.disabled){const{highlighted:r,client:t}=this;r.clear();for(const i of t.rowManager){const n=t.store.getById(i.id);n&&this.highlightParent(n.parent)}e.push(...r.values())}}doDisable(e){super.doDisable(e),this.client.refresh()}};E(md,"$name","ParentArea"),E(md,"pluginConfig",{chain:["onBeforeTaskSync"]}),md._$name="ParentArea",j.registerFeature(md,!1,"Gantt");var CC=class extends fe(Q){static get $name(){return"ProgressLine"}static get defaultConfig(){return{statusDate:new Date,drawLineOnlyWhenStatusDateVisible:!1,lineCls:"b-gantt-progress-line",containerCls:"b-progress-line-canvas"}}static get pluginConfig(){return{chain:["onPaint"]}}construct(e,r={}){const t=this;t.scheduleDraw=t.createOnFrame("draw",[],t,!0),super.construct(e,r),this.lineSegments=[]}doDisable(e){const r=this;r.attachToClient(e?null:r.client),r.client.rendered&&r.draw(),super.doDisable(e)}get statusDate(){return this._statusDate}set statusDate(e){e instanceof Date&&(this._statusDate=e,this.disabled||this.scheduleDraw())}getSVGCanvas(){const e=this,{client:r}=e;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.retainElement=!0,t.classList.add(e.containerCls),r.foregroundCanvas.appendChild(t)}return e._svgCanvas}attachToProject(e){this.detachListeners("project"),e==null||e.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}attachToRowManager(e){this.detachListeners("rowManager"),e==null||e.ion({name:"rowManager",translaterow:"onTranslateRow",refresh:"scheduleDraw",rerender:"scheduleDraw",changetotalheight:"scheduleDraw",thisObj:this})}attachToClient(e){const r=this;r.detachListeners("client"),e==null||e.ion({name:"client",horizontalscroll:"scheduleDraw",togglenode:"scheduleDraw",taskdrag:"onTaskDrag",taskdragabortfinalized:"scheduleDraw",aftertaskdrop:"scheduleDraw",timelineviewportresize:"scheduleDraw",thisObj:r}),r.attachToProject(e==null?void 0:e.project),r.attachToRowManager(e==null?void 0:e.rowManager)}onPaint(){this.attachToProject(this.disabled?null:this.client.project)}onProjectRefresh(){this.scheduleDraw()}onTranslateRow({row:e}){e.lastTop>=0&&e.top!==e.lastTop&&this.scheduleDraw()}onTaskDrag({taskRecords:e,dragData:r}){e.forEach(t=>{this.updateLineForTask(t,{[t.id]:b.add(t.startDate,r.timeDiff)})})}shouldDrawProgressLine(){const e=this;return!e.client.timeAxisSubGrid.collapsed&&!e.disabled&&(!e.drawLineOnlyWhenStatusDateVisible||e.client.timeAxis.dateInAxis(e.statusDate))}getStatusDateX(){let{statusDate:e}=this;const{client:r}=this;return r.timeAxis.dateInAxis(e)||(e=e<r.timeAxis.startDate?r.timeAxis.startDate:r.timeAxis.endDate),r.getCoordinateFromDate(e)}getRenderData(){const e=this.getStatusDateX(),r=this.client.timeAxisSubGridElement.getBoundingClientRect(),t=[this.client.scrollLeft-r.left,-r.top];return{statusDateX:e,viewXY:t}}draw(){const e=this,{client:r}=e;if(e.lineSegments.forEach(n=>n.remove()),e.lineSegments=[],!e.shouldDrawProgressLine())return;if(r.isAnimating){r.ion({transitionend(){e.scheduleDraw()},once:!0});return}const t=e.getRenderData(),i=[];r.rowManager.forEach(n=>i.push(...e.getLineSegmentRenderData(n,t))),i.forEach(n=>e.drawLineSegment(n)),r.trigger("progressLineDrawn")}segmentBelongsToTask(e,r){return e.getAttribute("data-task-id")==r.id}updateLineForTask(e,r){const t=this;if(t.disabled)return;const i=t.client.getRowFor(e);if(i){const n=[];t.lineSegments.forEach(s=>{t.segmentBelongsToTask(s,e)&&(n.push(s),s.remove())}),H.remove(t.lineSegments,...n),t.getLineSegmentRenderData(i,t.getRenderData(),r).forEach(s=>t.drawLineSegment(s))}}getLineSegmentRenderData(e,r,t={}){const i=this,{statusDateX:n,viewXY:s}=r,a=i.client.getRecordFromElement(e.elements.normal),o=a.id,l=[];let c;return i.isStatusLineTask(a,t[a.id])&&(c=i.calculateCoordinateForTask(a,s),c&&l.push({dataset:{taskId:o},x1:n,y1:e.top,x2:c.x,y2:c.y},{dataset:{taskId:o},x1:c.x,y1:c.y,x2:n,y2:e.bottom})),c||l.push({dataset:{taskId:o},x1:n,y1:e.top,x2:n,y2:e.bottom}),l}drawLineSegment(e){const r=this;r.lineSegments.push(w.createElement(Object.assign({tag:"line",ns:"http://www.w3.org/2000/svg",class:r.lineCls,parent:r.getSVGCanvas()},e)))}isStatusLineTask(e,r){const t=this.statusDate;return r=r||e.startDate,(e==null?void 0:e.project)&&!e.inactive&&this.client.timeAxis.isTimeSpanInAxis(e)&&(e.isInProgress||!e.isStarted&&r<t||e.isCompleted&&r>t)}calculateCoordinateForTask(e,r){const{client:t}=this,i=t.getElementFromTaskRecord(e),n=e.milestone,s=n?i:i==null?void 0:i.querySelector(".b-task-percent-bar");if(s){const a=s.getBoundingClientRect(),o=t.timeAxisViewModel.totalSize;return{x:Math.min((n?a.left:a.right)+r[0],o),y:a.top+a.height/2+r[1]}}}};CC._$name="ProgressLine",j.registerFeature(CC);var SC=class extends Ki.mixin(xt){static get $name(){return"ProjectLines"}static get defaultConfig(){return{showHeaderElements:!0,cls:"b-gantt-project-line"}}attachToProject(e){super.attachToProject(e),e.ion({name:"project",refresh:this.onProjectRefresh,thisObj:this})}startConfigure(){}updateLocalization(){this.renderRanges()}onProjectRefresh(){this.renderRanges()}shouldRenderRange(e){const{client:r}=this;return r.timeAxis.dateInAxis(e.startDate)}get timeRanges(){const{startDate:e,endDate:r}=this.client.project;return e&&r?[{name:this.L("L{Project Start}"),startDate:e},{name:this.L("L{Project End}"),startDate:r}]:[]}};SC._$name="ProjectLines",j.registerFeature(SC,!0,"Gantt");var pd="b-task-rollup",e$=`.${pd}`,DC=class extends ls{static get $name(){return"Rollups"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:e$}}static get pluginConfig(){return{chain:["onTaskDataGenerated","onPaint"]}}construct(e,r){this.tipId=`${e.id}-rollups-tip`,super.construct(e,r)}attachToTaskStore(e){this.detachListeners("taskStore"),e==null||e.ion({name:"taskStore",update:"onStoreUpdateRecord",thisObj:this})}doDestroy(){this.attachToTaskStore(null),super.doDestroy()}doDisable(e){const r=this;r.tooltip&&(r.tooltip.disabled=e),r.attachToTaskStore(e?null:r.client.taskStore),r.client.refresh(),super.doDisable(e)}getTipHtml({activeTarget:e,event:r}){const{client:t}=this,i=t.resolveTaskRecord(e),n=document.elementsFromPoint(r.pageX+globalThis.pageXOffset,r.pageY+globalThis.pageYOffset),s=n.filter(o=>o.classList.contains(pd)).sort((o,l)=>parseInt(o.dataset.index,10)-parseInt(l.dataset.index,10)),a=s.map(o=>i.children[parseInt(o.dataset.index,10)]);return this.template({task:i,children:a})}template({children:e}){const r=this,{client:t}=r,i=[];return e.map((n,s)=>{const{startDate:a,endDate:o}=n,l=t.getFormattedDate(a),c=t.getDisplayEndDate(o,a),d=t.getFormattedDate(c);i.push(`<div class="b-gantt-task-title ${s?"b-follow-on":""}">${O.encodeHtml(n.name)}</div><table>`,`<tr><td>${r.L("L{TaskTooltip.Start}")}:</td><td>${r.clockTemplate.template({date:a,text:l,cls:"b-sch-tooltip-startdate"})}</td></tr>`,`<tr><td>${r.L("L{TaskTooltip.End}")}:</td><td>${n.isMilestone?"":r.clockTemplate.template({date:c,text:d,cls:"b-sch-tooltip-enddate"})}</td></tr></table>`)}),i.join("")}onStoreUpdateRecord({record:e,changes:r}){this.client.project.propagatingLoadChanges||e.parent&&(r.rollup||r.startDate||r.endDate)&&this.client.taskRendering.redraw(e.parent)}onTaskDataGenerated({taskRecord:e,left:r,wrapperChildren:t,style:i}){if(!this.disabled&&Array.isArray(e.children)){const n=e.children.slice().sort((s,a)=>a.durationMS-s.durationMS);t.push({className:`${pd}-wrap`,dataset:{taskFeature:"rollups"},children:n.map(s=>{if(s.rollup&&s.isScheduled&&(!s.inactive||e.inactive)){const a=this.client.getSizeAndPosition(s);if(!a)return null;const{position:o,width:l}=a;return{dataset:{index:s.parentIndex,rollupTaskId:s.id},className:{[pd]:pd,[s.cls]:s.cls,"b-milestone":s.isMilestone,"b-inactive":s.inactive},style:{style:i,width:s.isMilestone?null:l,left:o-r}}}return null}),syncOptions:{syncIdField:"rollupTaskId"}})}}};DC._$name="Rollups",j.registerFeature(DC,!1,"Gantt");var wC=class extends vh{static get $name(){return"Summary"}static get configurable(){return{summaries:null,renderer:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("updateTaskStore","bindStore"),e}construct(e,r){super.construct(e,r),e.isGanttBase&&this.updateTaskStore(e.taskStore)}bindStore(){this.updateTimelineSummaries()}updateTaskStore(e){this.detachListeners("summaryTaskStore"),e.ion({name:"summaryTaskStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const e=this,{client:r,summaries:t}=e,{timeAxis:i}=r,n=e.summaryBarElement;n&&r.isEngineReady&&Array.from(n.children).forEach((s,a)=>{const o=i.getAt(a);let l="",c=`<header>${e.L("L{Summary for}",r.getFormattedDate(o.startDate))}</header>`;t.forEach(d=>{const u=d.renderer({startDate:o.startDate,endDate:o.endDate,taskStore:r.taskStore,store:r.store,resourceStore:r.resourceStore,gantt:r,element:s}),h=`<div class="b-timeaxis-summary-value">${u!=null?u:"&nbsp;"}</div>`;(t.length>1||u!=="")&&(l+=h),c+=`<label>${d.label||""}</label>`+h}),s.innerHTML=l,s._tipHtml=c})}};wC._$name="Summary",j.registerFeature(wC,!1,"Gantt");var Ho=class extends Tr(fr){constructor(){super(...arguments),E(this,"entityName","task")}construct(e,r){super.construct(e,r),e.ion({beforeRenderTask:"onBeforeRenderTask",thisObj:this})}populateCellMenu({record:e,items:r}){super.populateCellMenu(...arguments),this.client.usesDisplayStore&&(r.cut&&(r.cut.disabled=!0),r.copy&&(r.copy.disabled=!0),r.paste&&(r.paste.disabled=!0))}isActionAvailable({key:e,action:r,event:t}){return!this.client.usesDisplayStore&&super.isActionAvailable({key:e,action:r,event:t})}setIsCut(e){super.setIsCut(...arguments),this.client.taskRendering.redraw(e)}onBeforeRenderTask({renderData:e}){e.cls["b-cut-row"]=e.row.cls["b-cut-row"]}extractParents(e,r,t=!0){const i=super.extractParents(e,r,t);return this.isCut||(this.depsToCopy=this.extractDependencies(e,r)),i}async insertCopiedRecords(e,r){const t=this;await t.startFeatureTransaction();const i=await super.insertCopiedRecords(e,r);return e.forEach(n=>n.refreshWbs({deep:!0,useOrderedTree:!0})),t.client.dependencyStore.add(t.depsToCopy),delete t.depsToCopy,await t.finishFeatureTransaction(),i}extractDependencies(e,r){const t={};return e.reduce((i,n)=>(n.predecessors.forEach(s=>{const a=s.id;!(a in t)&&e.includes(s.fromEvent)&&(t[a]=!0,i.push(Object.assign({},s.data,{id:void 0,to:void 0,toEvent:r[n.id].id,toTask:void 0,from:void 0,fromEvent:r[s.fromEvent.id].id,fromTask:void 0})))}),n.successors.forEach(s=>{const a=s.id;!(a in t)&&e.includes(s.toEvent)&&(t[a]=!0,i.push(Object.assign({},s.data,{id:void 0,to:void 0,toEvent:r[s.toEvent.id].id,toTask:void 0,from:void 0,fromEvent:r[n.id].id,fromTask:void 0})))}),i),[])}};E(Ho,"$name","TaskCopyPaste"),E(Ho,"type","taskCopyPaste"),E(Ho,"configurable",{copyRecordText:"L{copyTask}",cutRecordText:"L{cutTask}",pasteRecordText:"L{pasteTask}"}),Ho._$name="TaskCopyPaste",j.registerFeature(Ho,!0,"Gantt");var uf=class extends Tr(ch){static get $name(){return"TaskDrag"}static get configurable(){return{validatorFn:(e,r,t,i)=>!0,validatorFnThisObj:null,pinSuccessors:!1,tooltipCls:"b-gantt-taskdrag-tooltip",capitalizedEventName:null}}afterConstruct(){this.capitalizedEventName=this.capitalizedEventName||this.client.capitalizedEventName,super.afterConstruct(...arguments)}changePinSuccessors(e){return B.toSpecialKey(e)}construct(e,r){this.gantt=e,super.construct(e,r)}get store(){return this.gantt.store}getDraggableElement(e){return e==null?void 0:e.closest(this.drag.targetSelector)}resolveEventRecord(e,r=this.client){return r.resolveTaskRecord(e)}isElementDraggable(e,r){var t;const i=this,{client:n}=i,s=i.getDraggableElement(e);if(!s||i.disabled||n.readOnly||e.matches('[class$="-handle"]'))return!1;const a=i.resolveEventRecord(s,n);return!a||!a.isDraggable||a.readOnly||!a.project?!1:!(((t=n[`is${i.capitalizedEventName}ElementDraggable`])==null?void 0:t.call(n,s,a,e,r))===!1)}triggerBeforeEventDrag(e,r){return this.client.trigger(e,r)}triggerEventDrag(e,r){this.client.trigger("taskDrag",{taskRecords:e.draggedEntities,startDate:e.startDate,endDate:e.endDate,dragData:e,changed:e.startDate-r!==0})}triggerDragStart(e){return this.client.trigger("taskDragStart",{taskRecords:e.draggedEntities,dragData:e}),this.startFeatureTransaction()}triggerDragAbort(e){this.client.trigger("taskDragAbort",{taskRecords:e.draggedEntities,context:e})}triggerDragAbortFinalized(e){this.rejectFeatureTransaction(),this.client.trigger("taskDragAbortFinalized",{taskRecords:e.draggedEntities,context:e})}triggerAfterDrop(e,r){this.finishFeatureTransaction(),this.currentOverClient.trigger("afterTaskDrop",{taskRecords:e.draggedEntities,context:e,valid:r})}getProductDragContext(e){return{valid:!0}}getMinimalDragData(e){const r=this.getElementFromContext(e);return{taskRecord:this.client.resolveTaskRecord(r)}}getTaskScheduleRegion(e,r){return this.client.getScheduleRegion(e,!0,r)}getDateConstraints(e){var r,t;return(t=(r=this.client).getDateConstraints)==null?void 0:t.call(r,e)}setupProductDragData(e){const r=this,{client:t}=r,i=e.element,n=t.resolveTaskRecord(i),s=k.from(i),a=r.getRelatedRecords(n)||[],o=r.getDateConstraints(n),l=[i],c=r.getTaskScheduleRegion(n,o);r.setupConstraints(c,s,t.timeAxisViewModel.snapPixelAmount,!!o),a.forEach(u=>{H.include(l,t.getElementFromTaskRecord(u,!1))});const d=[n,...a];return{record:n,dateConstraints:o,eventBarEls:l,draggedEntities:d,taskRecords:d}}getCoordinate(e,r,t){return t[0]}checkDragValidity(e,r){return this.validatorFn.call(this.validatorFnThisObj||this,e.draggedEntities,e.startDate,e.duration,r)}isValidDrop(e){return!0}async updateRecords(e){const{startDate:r,browserEvent:t,draggedEntities:[i]}=e,n=i.startDate;this.pinSuccessors&&t[this.pinSuccessors]?await i.moveTaskPinningSuccessors(r):await i.setStartDate(r,!0),i.startDate-n?this.client.trigger("taskDrop",{taskRecords:e.draggedEntities}):this.dragData.valid=!1}getRecordElement(e){return this.client.getElementFromTaskRecord(e,!0)}get tipId(){return`${this.client.id}-task-drag-tip`}};uf._$name="TaskDrag",j.registerFeature(uf,!0,"Gantt");var EC=class extends Ka{static get $name(){return"TaskDragCreate"}static get configurable(){return{preventMultiple:!0}}construct(e,r){this.gantt=e,super.construct(e,r)}get store(){return this.gantt.store}setupDragContext(e){var r,t;const{client:i}=this;if((t=(r=e.target).closest)!=null&&t.call(r,`.${i.timeAxisColumn.cellCls}`)){const n=i.getRecordFromElement(e.target);if(n){const s=nu().prototype.setupDragContext.call(this,e);return s.scrollManager=i.scrollManager,s.taskRecord=s.rowRecord=n,s}}}startDrag(e){const r=this.draggingEnd=e.event.pageX>e.startEvent.pageX,{client:t}=this,{timeAxis:i}=t,{mousedownDate:n,taskRecord:s,date:a}=e;return t.beginListeningForBatchedUpdates(),s.beginBatch(),s.set("startDate",b.floor(r?n:a,i.resolution,void 0,t.weekStartDay)),s.set("endDate",b.ceil(r?a:n,i.resolution,void 0,t.weekStartDay)),this.handleBeforeDragCreate(e,s,e.event)===!1?(this.onAborted(e),!1):(e.itemElement=e.element=t.getElementFromTaskRecord(e.taskRecord),super.startDrag.call(this,e))}handleBeforeDragCreate(e,r,t){var i,n;const s=this,a=s.gantt.trigger("beforeDragCreate",{taskRecord:r,date:e.mousedownDate,event:t});return s.dateConstraints=(n=(i=s.gantt).getDateConstraints)==null?void 0:n.call(i,r),a}checkValidity(e,r){const t=this;return e.taskRecord=t.dragging.taskRecord,t.createValidatorFn.call(t.validatorFnThisObj||t,e,r)}isRowEmpty(e){return!e.startDate||!e.endDate}onAborted({taskRecord:e}){e.cancelBatch(),this.client.endListeningForBatchedUpdates()}};EC._$name="TaskDragCreate",j.registerFeature(EC,!0,"Gantt");var hf=class extends sd{static get type(){return"taskeditor"}static get $name(){return"TaskEditor"}static get defaultConfig(){return{cls:"b-gantt-taskeditor b-schedulerpro-taskeditor"}}};hf.initClass(),hf._$name="TaskEditor";var gf=class extends ad{static get $name(){return"TaskEdit"}static get pluginConfig(){return{chain:["populateTaskMenu","onTaskEnterKey"],assign:["editTask"]}}editTask(e,r){return this.editEvent(e,null,r)}onActivateEditor({taskRecord:e,taskElement:r}){this.editTask(e,r)}getElementFromTaskRecord(e){return this.client.getElementFromTaskRecord(e)}onTaskEnterKey({taskRecord:e}){this.editTask(e)}populateTaskMenu({taskRecord:e,selection:r,items:t}){!this.client.readOnly&&r.length<=1&&e.project&&(t.editTask={text:"L{Gantt.Edit}",localeClass:this.client,cls:"b-separator",icon:"b-icon b-icon-edit",weight:100,disabled:this.disabled||e.readOnly,onItem:()=>this.editTask(e)})}onEventEnterKey({taskRecord:e,target:r}){this.editTask(e)}scrollTaskIntoView(e){return this.scrollEventIntoView(e)}scrollEventIntoView(e){return this.client.scrollTaskIntoView(e)}};E(gf,"configurable",{triggerEvent:"taskdblclick",saveAndCloseOnEnter:!0,editorClass:hf}),gf._$name="TaskEdit",j.registerFeature(gf,!0,"Gantt");var ff=class extends to{static get $name(){return"TaskMenu"}static get defaultConfig(){return{type:"task",processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTaskMenu"),e}construct(e,r={}){super.construct(...arguments),this.gantt=e,e.features.cellMenu&&(console.warn("`CellMenu` feature is ignored, when `TaskMenu` feature is enabled. If you need cell specific menu items, please configure `TaskMenu` feature items instead."),e.features.cellMenu.disabled=!0)}getDataFromEvent(e){const{client:r}=this,t=this.getTargetElementFromEvent(e),i=r.resolveTaskRecord(t)||r.getRecordFromElement(t),n=i&&r.getElementFromTaskRecord(i,!1);return N.assign({event:e,targetElement:t,taskElement:n,taskRecord:i},r.getCellDataFromEvent(e))}callChainablePopulateMenuMethod(e){e.cellData&&this.client.populateCellMenu&&this.client.populateCellMenu(e),super.callChainablePopulateMenuMethod(...arguments)}shouldShowMenu(e){const{column:r}=e;return e.taskRecord&&(!r||r.enableCellContextMenu!==!1)}getElementFromRecord(e){return this.client.getElementFromTaskRecord(e)}populateTaskMenu({items:e,column:r,selection:t,taskRecord:i}){const{client:n}=this,{isTreeGrouped:s,usesDisplayStore:a}=n,o=t.includes(i)&&t.length>1;e.add={disabled:n.readOnly||s||a,hidden:o},e.convertToMilestone={disabled:n.readOnly||i.readOnly,hidden:i.isParent||i.milestone},e.indent={disabled:n.readOnly||!i.previousSibling||i.readOnly||s||a},e.outdent={disabled:n.readOnly||i.parent===n.taskStore.rootNode||i.readOnly||s||a},e.deleteTask={disabled:n.readOnly||i.readOnly},e.linkTasks={disabled:!o},e.unlinkTasks={disabled:e.linkTasks.disabled},r!=null&&r.cellMenuItems&&N.merge(e,r.cellMenuItems),n.showTaskColorPickers?e.taskColor={disabled:n.readOnly||i.readOnly}:e.taskColor={hidden:!0}}populateItemsWithData({items:e,taskRecord:r}){var t;super.populateItemsWithData(...arguments),this.client.showTaskColorPickers&&((t=e.taskColor)!=null&&t.menu)&&N.merge(e.taskColor.menu.colorMenu,{value:r.eventColor,record:r})}changeItems(e){const{client:r}=this;return N.merge({add:{text:"L{Gantt.Add}",cls:"b-separator",icon:"b-icon-add",weight:500,menu:{addTaskAbove:{text:"L{Gantt.Task above}",weight:510,icon:"b-icon-up",onItem({taskRecord:t}){r.addTaskAbove(t)}},addTaskBelow:{text:"L{Gantt.Task below}",weight:520,icon:"b-icon-down",onItem({taskRecord:t}){r.addTaskBelow(t)}},milestone:{text:"L{Gantt.Milestone}",weight:530,icon:"b-icon-milestone",onItem({taskRecord:t}){r.addMilestoneBelow(t)}},subtask:{text:"L{Gantt.Sub-task}",weight:540,icon:"b-icon-subtask",at:"start",onItem({taskRecord:t}){r.addSubtask(t,{at:this.at})}},successor:{text:"L{Gantt.Successor}",weight:550,icon:"b-icon-successor",onItem({taskRecord:t}){r.addSuccessor(t)}},predecessor:{text:"L{Gantt.Predecessor}",weight:560,icon:"b-icon-predecessor",onItem({taskRecord:t}){r.addPredecessor(t)}}}},convertToMilestone:{icon:"b-icon-milestone",text:"L{Gantt.Convert to milestone}",weight:600,onItem({taskRecord:t}){t.convertToMilestone()}},indent:{text:"L{Gantt.Indent}",icon:"b-icon-indent",weight:700,separator:!0,onItem({selection:t,taskRecord:i}){r.indent(t.includes(i)?t:i)}},outdent:{text:"L{Gantt.Outdent}",icon:"b-icon-outdent",weight:800,onItem({selection:t,taskRecord:i}){r.outdent(t.includes(i)?t:i)}},deleteTask:{text:"L{Gantt.Delete task}",icon:"b-icon-trash",cls:"b-separator",weight:900,onItem({selection:t,taskRecord:i}){r.store.remove(t.includes(i)?t:i)}},linkTasks:{text:"L{Gantt.linkTasks}",icon:"b-icon-link",cls:"b-separator",weight:1e3,onItem({selection:t}){r.store.linkTasks(t)}},unlinkTasks:{text:"L{Gantt.unlinkTasks}",icon:"b-icon-unlink",weight:1010,onItem({selection:t}){r.store.unlinkTasks(t)}},taskColor:{text:"L{Gantt.color}",icon:"b-icon-palette",menu:{colorMenu:{type:"eventcolorpicker"}},separator:!0,weight:1100}},e)}};ff.featureClass="",ff._$name="TaskMenu",j.registerFeature(ff,!0,"Gantt");var t$={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},qs=class extends Q.mixin(xt){static get properties(){return{rowMap:new Map,taskMap:new Map}}construct(){super.construct(...arguments);const e=this,{client:r}=e;r.timeAxis.ion({name:"timeAxis",reconfigure:"onTimeAxisReconfigure",prio:100,thisObj:e}),r.taskStore.ion({filter:"clear",thisObj:e}),r.ion({beforeToggleNode:"clear",thisObj:e})}attachToProject(e){super.attachToProject(e),e.ion({name:"project",refresh:"onProjectRefresh",prio:100,thisObj:this})}onProjectRefresh(){this.clear()}onPaint({firstPaint:e}){e&&(this.mouseEventsDetacher=B.on({element:this.client.foregroundCanvas,delegate:".b-tasknonworkingtime",click:"handleMouseEvent",dblclick:"handleMouseEvent",contextmenu:"handleMouseEvent",thisObj:this}))}doDisable(e){super.doDisable(e),this.clear(),this.client.refresh()}updateMode(){this.isConfiguring||(this.clear(),this.client.refresh())}clear(){this.taskMap.clear(),this.rowMap.clear()}onTimeAxisReconfigure(){this.clear()}onTaskDataGenerated(e){if(e.task.effectiveCalendar){if(this.mode!=="bar"){const r=this.getCalendarIntervalsToRender(e,!1);e.extraConfigs.push(...r)}if(this.mode!=="row"){const r=this.getCalendarIntervalsToRender(e,!0);e.children.push(...r)}}}getCalendarIntervalsToRender(e,r=!1){const t=this,{rowMap:i,taskMap:n,client:s}=t,{timeAxis:a}=s,{task:o}=e,l=[],c=!t.maxTimeAxisUnit||b.compareUnits(a.unit,t.maxTimeAxisUnit)<=0,d=r?n:i;if(!t.disabled&&c){const u=a.first.durationMS;if(!d.has(o.id)){const h=o.effectiveCalendar,g=!r||o.isScheduled?h.getNonWorkingTimeRanges(r?o.startDate:s.startDate,r?o.endDate:s.endDate):[],f=[];for(let m=0;m<g.length;m++){const p=g[m];p.endDate-p.startDate>=u&&f.push(t.createIntervalDOMConfig({id:`r${o.id}i${m}`,iconCls:p.iconCls||h.iconCls||"",cls:`${h.cls?`${h.cls} `:""}${p.cls||""}`,startDate:p.startDate,endDate:p.endDate,name:p.name,isNonWorking:!0},e,r))}d.set(o.id,f)}l.push(...T.clone(d.get(o.id)))}return l}createIntervalDOMConfig(e,r,t=!1){const{client:i}=this,{taskRecord:n}=r,{cls:s,iconCls:a,name:o,startDate:l,endDate:c}=e,d=i.getCoordinateFromDate(l)-(t?r.left:0),u=i.getCoordinateFromDate(c)-d-(t?r.left:0),h=t?null:i.store.indexOf(n)*i.rowManager.rowOffsetHeight,g=t?null:i.rowHeight;return{className:{"b-tasknonworkingtime":1,[s]:1},style:{left:d,top:h,height:g,width:t&&u+d>r.width?r.width-d:u},children:[a?{tag:"i",className:a}:null,o],dataset:{taskId:e.id},elementData:{taskRecord:n,interval:e}}}changeTooltip(e,r){const t=this;return r==null||r.destroy(),!t.tooltipTemplate||!e?null:ve.new({align:"b-t",forSelector:".b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) .b-sch-foreground-canvas > .b-tasknonworkingtime",forElement:t.client.timeAxisSubGridElement,showOnHover:!0,hideDelay:0,anchorToTarget:!0,trackMouse:!1,getHtml:({activeTarget:i})=>{const{taskRecord:n,interval:s}=i.elementData;return t.tooltipTemplate({taskRecord:n,...s})}},e)}handleMouseEvent(e){const r=this,t=e.target.closest(".b-tasknonworkingtime"),{taskRecord:i,interval:n}=t.elementData;r.client.trigger("taskNonWorkingTime"+t$[e.type],{feature:r,taskRecord:i,interval:n,domEvent:e})}};E(qs,"$name","TaskNonWorkingTime"),E(qs,"configurable",{idPrefix:"TaskNonWorkingTime",maxTimeAxisUnit:"week",tooltipTemplate:null,tooltip:{},mode:"row"}),E(qs,"pluginConfig",{chain:["onTaskDataGenerated","onPaint"]}),E(qs,"featureClass",""),qs._$name="TaskNonWorkingTime",j.registerFeature(qs,!1,"Gantt");var xC=class extends Tr(td){static get $name(){return"TaskResize"}static get configurable(){return{draggingItemCls:"b-sch-event-resizing",resizingItemInnerCls:null,pinSuccessors:!1}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isTaskElementDraggable"]}}onDragItemMouseMove(){this[`${this.client.rtl?"right":"left"}Handle`]=!1,super.onDragItemMouseMove(...arguments)}changePinSuccessors(e){return B.toSpecialKey(e)}isTaskElementDraggable(e,r,t,i){return this.isEventElementDraggable(...arguments)}checkValidity(){return this.basicValidityCheck(...arguments)}getBeforeResizeParams(e){return{}}setupProductResizeContext(e,r){var t;const i=this.client,n=i.resolveTaskRecord(e.element);Object.assign(e,{taskRecord:n,eventRecord:n,dateConstraints:(t=i.getDateConstraints)==null?void 0:t.call(i,n)})}async internalUpdateRecord(e,r){const{client:t}=this,{generation:i}=r,{startDate:n,endDate:s}=e,a={endDate:s};e.duration=a.duration=r.run("calculateProjectedDuration",n,s);const o=a[e.toSet]=r.run("calculateProjectedXDateWithDuration",n,!0,e.duration);return r.set(a),t.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(r),this.pinSuccessors&&e.event[this.pinSuccessors]?await r.setEndDatePinningSuccessors(o):await r.setEndDate(o,!1),r.endBatch(),r.generation!==i}triggerEventResizeStart(e,r,t){return super.triggerEventResizeStart(e,r,t),this.startFeatureTransaction()}triggerEventResizeEnd(e,r){super.triggerEventResizeEnd(e,r),r.changed?this.finishFeatureTransaction():this.rejectFeatureTransaction()}};xC._$name="TaskResize",j.registerFeature(xC,!0,"Gantt");var mf=class extends uf{static get configurable(){return{capitalizedEventName:"TaskSegment"}}static get pluginConfig(){return{chain:["onPaint","isTaskElementDraggable"]}}isTaskElementDraggable(e,r,t,i){const n=this;return n.disabled||!r.isEventSegment&&!r.isSegmented?!0:!t.closest(n.drag.targetSelector)}triggerBeforeEventDrag(e,r){return this.client.trigger("beforeTaskSegmentDrag",r)}triggerBeforeEventDropFinalize(e,r,t){t.trigger(`before${this.capitalizedEventName}DropFinalize`,r)}triggerEventDrag(e,r){this.client.trigger("taskSegmentDrag",{taskRecords:e.draggedEntities,startDate:e.startDate,endDate:e.endDate,dragData:e,changed:e.startDate-r!==0})}triggerDragStart(e){this.client.trigger("taskSegmentDragStart",{taskRecords:e.draggedEntities,dragData:e})}triggerDragAbort(e){this.client.trigger("taskSegmentDragAbort",{taskRecords:e.draggedEntities,context:e})}triggerDragAbortFinalized(e){this.client.trigger("taskSegmentDragAbortFinalized",{taskRecords:e.draggedEntities,context:e})}triggerAfterDrop(e,r){this.currentOverClient.trigger("afterTaskSegmentDrop",{taskRecords:e.draggedEntities,context:e,valid:r})}onInternalInvalidDrop(e){super.onInternalInvalidDrop(...arguments),this.dragData.mainTaskElement.style.width=this.dragData.initialMainTaskElementWidth+"px"}buildDragHelperConfig(){const e=super.buildDragHelperConfig();return e.targetSelector=".b-sch-event-segment:not(.b-first)",e}getTaskScheduleRegion(e,r){const{client:t}=this,i=t.getElementFromTaskRecord(e.event),n=k.from(i,t.timeAxisSubGridElement),s=this.client.getScheduleRegion(e.event,!0,r);return s.translate(-n.x),s}setupProductDragData(e){const r=super.setupProductDragData(e);return r.mainTaskElement=this.client.getElementFromTaskRecord(r.record.event,!1),r.initialMainTaskElementWidth=parseFloat(r.mainTaskElement.style.width),r}updateDragContext(e,r){super.updateDragContext(...arguments);const{dirty:t,record:i,mainTaskElement:n,initialMainTaskElementWidth:s}=this.dragData;t&&!i.nextSegment&&(n.style.width=s+e.clientX-e.startClientX+"px")}get tipId(){return`${this.client.id}-task-segment-drag-tip`}async updateRecords(e){const{startDate:r,draggedEntities:[t]}=e,i=t.startDate;t.isEventSegment&&(await t.setStartDate(r,!0),t.startDate-i?this.client.trigger("taskSegmentDrop",{taskRecords:e.draggedEntities}):this.dragData.valid=!1)}getDateConstraints(e){const r=super.getDateConstraints(e)||{};let{minDate:t,maxDate:i}=r;return e.previousSegment&&(!t||t<e.previousSegment.endDate)&&(t=e.previousSegment.endDate),e.nextSegment&&(!i||i<e.nextSegment.startDate)&&(i=e.nextSegment.startDate),(t||i)&&{start:t,end:i}}};E(mf,"$name","TaskSegmentDrag"),mf._$name="TaskSegmentDrag",j.registerFeature(mf,!0,"Gantt");var pf=class extends Po{static get configurable(){return{draggingItemCls:"b-sch-event-resizing",resizingItemInnerCls:null,leftHandle:!1}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isTaskElementDraggable","isTaskSegmentElementDraggable"]}}isTaskElementDraggable(e,r,t,i){return this.isEventElementDraggable(...arguments)}isTaskSegmentElementDraggable(e,r,t,i){return this.isEventElementDraggable(...arguments)}checkValidity(){return this.basicValidityCheck(...arguments)}getBeforeResizeParams(e){return{}}setupProductResizeContext(e,r){var t;const i=this.client,n=i.resolveTaskRecord(e.element);Object.assign(e,{taskRecord:n,eventRecord:n,dateConstraints:(t=i.getDateConstraints)==null?void 0:t.call(i,n)})}async internalUpdateRecord(e,r){const{client:t}=this,{generation:i}=r,{startDate:n,endDate:s}=e,a={endDate:s};e.duration=a.duration=r.run("calculateProjectedDuration",n,s);const o=a[e.toSet]=r.run("calculateProjectedXDateWithDuration",n,!0,e.duration);return r.set(a),t.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(r),this.pinSuccessors&&e.event[this.pinSuccessors]?await r.setEndDatePinningSuccessors(o):await r.setEndDate(o,!1),r.endBatch(),r.generation!==i}get tipId(){return`${this.client.id}-task-segment-resize-tip`}};E(pf,"$name","TaskSegmentResize"),pf._$name="TaskSegmentResize",j.registerFeature(pf,!0,"Gantt");var RC=class extends ls{static get $name(){return"TaskTooltip"}static get defaultConfig(){return{template(e){const r=this,{taskRecord:t}=e,i=r.client.formatDuration(t.duration,r.decimalPrecision);return`
                    ${t.name?`<div class="b-gantt-task-title">${O.encodeHtml(t.name)}</div>`:""}
                    <table>
                    <tr><td>${r.L("L{Start}")}:</td><td>${e.startClockHtml}</td></tr>
                    ${t.milestone?"":`
                        <tr><td>${r.L("L{End}")}:</td><td>${e.endClockHtml}</td></tr>
                        <tr><td>${r.L("L{Duration}")}:</td><td class="b-right">${i} ${b.getLocalizedNameOfUnit(t.durationUnit,t.duration!==1)}</td></tr>
                        <tr><td>${r.L("L{Complete}")}:</td><td class="b-right">${t.renderedPercentDone}%</td></tr>
                    `}
                    </table>                 
                `},decimalPrecision:null,cls:"b-gantt-task-tooltip",monitorRecordUpdate:!0}}};RC._$name="TaskTooltip",j.registerFeature(RC,!0,"Gantt");var vd=class extends Yi.mixin(xt,fe){updateParents(e){var r;(r=e.children)!=null&&r.length&&Rn.postWalk(e,t=>{var i;return!((i=t.children)!=null&&i[0].isLeaf)&&t.children},t=>{const{children:i}=t;let n=i[0].startDate,s=i[0].endDate,a=0;for(const o of i)o.startDate&&(n=Math.min(o.startDate,n||Number.MAX_SAFE_INTEGER)),o.endDate&&(s=Math.max(o.endDate,s)),a+=o.percentDone;t.startDate=new Date(n),t.endDate=new Date(s),t.duration=this.client.project.taskStore.rootNode.run("calculateProjectedDuration",t.startDate,t.endDate),t.percentDone=a/i.length})}processTransformedData(e){this.updateParents(e)}onTaskStoreChange({action:e,records:r}){const{client:t}=this;t.isTreeGrouped&&r.some(i=>i.isLeaf)&&e!=="dataset"&&(t.suspendRefresh(),this.updateParents(t.store.rootNode),t.resumeRefresh(),this.refresh())}refresh(){this.client.refreshWithTransition()}async applyLevels(e){this.detachListeners("taskStore"),await super.applyLevels(e),!this.isDestroyed&&(e==null?void 0:e.length)>0&&(this.detachListeners("taskStore"),this.client.taskStore.ion({name:"taskStore",change:"onTaskStoreChange",thisObj:this}))}};E(vd,"$name","TreeGroup"),E(vd,"delayable",{refresh:"raf"}),vd._$name="TreeGroup",j.registerFeature(vd,!1,"Gantt");var yd=class extends Fs{construct(e,r){super.construct(e,r),e.ion({taskMenuItem:({item:t,selection:i})=>{const n=this,s=i.length>1;t.ref==="deleteTask"?n.transactionDescription=s?n.L("L{Versions.deletedTasks}"):n.L("L{Versions.deletedTask}"):t.ref==="indent"?n.transactionDescription=n.L("L{Versions.indented}"):t.ref==="outdent"?n.transactionDescription=n.L("L{Versions.outdented}"):t.ref==="cut"?n.transactionDescription=n.L("L{Versions.cut}"):t.ref==="paste"&&(n.transactionDescription=n.L("L{Versions.pasted}"))}})}};E(yd,"$name","Versions"),E(yd,"configurable",{knownBaseTypes:[Ys,...Fs.configurable.knownBaseTypes]}),yd._$name="GanttVersions",j.registerFeature(yd,!1,"Gantt");var r$=.4,TC=e=>class extends e{async prepareComponent(t){await super.prepareComponent(t);const i=this,n=i.element.querySelector(".b-sch-foreground-canvas");w.removeEachSelector(n,".b-gantt-task-wrap"),w.removeEachSelector(n,".b-released")}collectEvents(t,i){const n=this,s=t.length,{client:a}=i,o=n.exportMeta.subGrids.normal.rows;t.forEach((l,c)=>{const d=o[o.length-s+c],u=a.store.getAt(l.dataIndex),h=d[3];if(u.isScheduled){const g=a.getElementFromTaskRecord(u,!1);g&&!h.has(u.id)&&h.set(u.id,[g.outerHTML,k.from(g.firstChild,g.offsetParent)])}})}renderEvents(t,i){const n=this,{client:s}=t,a=s.hasActiveFeature("baselines"),o=n.exportMeta.subGrids.normal.rows,l=n.exportMeta.topRowOffset=i[0].top-i[0].dataIndex*i[0].offsetHeight;i.forEach((c,d)=>{const u=o[d],h=u[3],g=s.store.getAt(c.dataIndex),f=s.currentOrientation.getTaskRenderData(c,g),{taskId:m}=f;if(f.top+=l,f.isTask){const p=s.currentOrientation.getTaskDOMConfig(f),v=document.createElement("div"),{isMilestone:y}=g,C=g.baselines.count;X.sync({targetElement:v,domConfig:p});let{left:D,top:S,width:x,height:R}=f;y&&(D=D-R/2,x=R),h.set(m,[v.outerHTML,new k(D,S,x,R*(a&&C?r$:1)),[]])}if(f.extraConfigs.length){const p=document.createElement("div"),v=[];for(const y of f.extraConfigs)X.sync({targetElement:p,domConfig:y}),v.push(p.outerHTML);h.has(m)||h.set(m,["",null,[]]),h.get(m)[2]=v}})}getEventBox(t){if(!t)return;let i=this.exportMeta.eventsBoxes.get(String(t.id));if(!i){const{client:n}=this.exportMeta,s=n.getCoordinateFromDate(t.startDate),a=n.getCoordinateFromDate(t.endDate),{rows:o}=this.exportMeta.subGrids.normal,[l,c,d]=o[0],[,u]=o[o.length-1],h=parseInt(l.match(/data-index="(\d+)?"/)[1]),g=n.taskStore.indexOf(t),f=g<h?c-d:u+d;i=new k(s,f,a-s,d)}return i}},MC=class extends TC(Ch){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}};MC._$name="MultiPageExporter";var IC=class extends TC(Sh){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}};IC._$name="MultiPageVerticalExporter";var PC=class extends TC(Dh){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}};PC._$name="SinglePageExporter";var AC=class extends wh{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[PC,MC,IC]}}};AC._$name="PdfExport",j.registerFeature(AC,!1,"Gantt");var ZT=class extends ug{};ZT._$name="CalendarIntervalModel";var Vo=class extends WT.derive(ce).mixin(qb,Zx,Eb,pv,mv){static get defaults(){return{expanded:!0}}static get defaultConfig(){return{projectConstraintIntervalClass:Mg,dateConstraintIntervalClass:Nc,dependencyConstraintIntervalClass:Do,taskModelClass:Ys,dependencyModelClass:af,resourceModelClass:of,assignmentModelClass:Bo,calendarModelClass:sf,taskStoreClass:gd,dependencyStoreClass:uC,resourceStoreClass:hC,assignmentStoreClass:cC,calendarManagerStoreClass:dC,tasksData:null,eventsData:null,dependenciesData:null,resourcesData:null,assignmentsData:null,calendarsData:null,timeRangeStore:{modelClass:St,storeId:"timeRanges"},convertEmptyParentToLeaf:!1,supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/gantt/docs/api/Gantt/model/ProjectModel#config-supportShortSyncResponse)',delayCalculation:!0,eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},stmClass:yg}}static get configurable(){return{tasks:null,resources:null,assignments:null,dependencies:null,timeRanges:null,calendars:null,timeRangesData:null,syncDataOnLoad:null,ignoreRemoteChangesInSTM:!1}}construct(...e){const r=e[0]||{};e[0]=r,"tasksData"in r&&(r.eventsData=r.tasksData,delete r.tasksData),"taskStore"in r&&(r.eventStore=r.taskStore,delete r.taskStore),r.eventModelClass=r.taskModelClass||r.eventModelClass||this.getDefaultConfiguration().taskModelClass||this.defaultEventModelClass,r.eventStoreClass=r.taskStoreClass||r.eventStoreClass||this.getDefaultConfiguration().taskStoreClass||this.defaultEventStoreClass,super.construct(...e)}attachStore(e){this.syncDataOnLoad&&(e.syncDataOnLoad=this.syncDataOnLoad),e.ion({name:e.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(e)}detachStore(e){e&&this.detachListeners(e.$$name),super.detachStore(e)}relayStoreChange(e){return super.relayStoreChange(e),this.trigger("change",{store:e.source,...e,source:this})}get defaultEventModelClass(){return Ys}get defaultEventStoreClass(){return gd}set taskStore(e){this.eventStore=e}get taskStore(){return this.eventStore}get timeRangeStore(){return this._timeRangeStore}set timeRangeStore(e){const r=this;r.detachStore(r._timeRangeStore),r._timeRangeStore=re.getStore(e,re),r._timeRangeStore.storeId||(r._timeRangeStore.storeId="timeRanges"),r.attachStore(r._timeRangeStore)}async tryInsertChild(){return this.tryPropagateWithChanges(()=>{this.insertChild(...arguments)})}toJSON(){return{eventsData:this.eventStore.toJSON(),resourcesData:this.resourceStore.toJSON(),dependenciesData:this.dependencyStore.toJSON(),assignmentsData:this.assignmentStore.toJSON()}}get json(){return super.json}set json(e){typeof e=="string"&&(e=O.safeJsonParse(e)),this.loadInlineData(e)}get tasks(){return this.taskStore.allRecords}updateTasks(e){this.taskStore.data=e}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}updateTimeRangesData(e){this.timeRangeStore.data=e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}afterChange(e,r){super.afterChange(...arguments),r.calendar&&this.trigger("calendarChange")}refreshWbs(e){var r,t;const i=this,n=(r=i.unfilteredChildren)!=null?r:i.children;n!=null&&n.length&&((t=n[0].refreshWbs)==null||t.call(i,e,-1))}};E(Vo,"$name","ProjectModel"),Vo.applyConfigs=!0,Vo._$name="ProjectModel";var _C=class extends ST(Vo){};E(_C,"$name","WebSocketProjectModel"),_C._$name="WebSocketProjectModel";var i$=new Date().getFullYear(),n$=b.add(b.startOf(new Date(i$,0,5),"week"),1-b.weekStartDay,"day"),pn=new On;function Di(e,r){return parseInt(""+e+r)}var JT=class{static async generateAsync(e,r,t=null,i=n$,n=!0){const s={startDate:i,tasksData:[],dependenciesData:[]},a=Math.ceil(e/10),o=Math.ceil(r/10),l=this.generateBlocks(a,o,s.startDate);let c=0,d=0,u=0,h=0;n&&console.time("generate");for(const g of l)s.tasksData.push(...g.tasksData),s.dependenciesData.push(...g.dependenciesData),g.projectDuration&&(d=Math.max(g.projectDuration,d)),u+=g.taskCount,h+=g.dependencyCount,++c%1e3===0&&(t==null||t(u,h,!1),await bn.animationFrame());return t==null||t(u,h,!0),s.endDate=b.add(s.startDate,Math.max(d,30),"days"),n&&console.timeEnd("generate"),s}static*generateBlocks(e,r,t){let i=1,n=1,s=0,a=0,o=0,l=0,c=t,d=0;function u(m=!0,p=!1){const v=pn.nextRandom(5)+2;return m&&(a+=v),p&&(o=0),o+=v,l=v,v}function h(m=l){return c=b.add(c,m,"days"),c}function g(){return b.add(c,l,"days")}function f(m){d=0;for(const p of m)d+=p.duration*p.percentDone;return m}for(let m=0;m<e;m++){const p=i,v={tasksData:[{id:i++,name:"Parent "+p,startDate:h(m>0?l:0),expanded:!0,inactive:!1,children:[{id:i++,name:"Sub-parent "+Di(p,1),startDate:h(0),expanded:!0,inactive:!1,children:f([{id:i++,name:"Task "+Di(p,11),startDate:h(0),duration:u(!0,!0),effort:l,effortUnit:"day",endDate:g(),percentDone:pn.nextRandom(100),inactive:!1},{id:i++,name:"Task "+Di(p,12),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:pn.nextRandom(100),inactive:!1},{id:i++,name:"Task "+Di(p,13),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:pn.nextRandom(100),inactive:!1},{id:i++,name:"Task "+Di(p,14),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:pn.nextRandom(100),inactive:!1}]),duration:o,effort:o,effortUnit:"day",percentDone:d/o,endDate:g()},{id:i++,name:"Sub-parent "+Di(p,2),startDate:h(),expanded:!0,inactive:!1,children:f([{id:i++,name:"Task "+Di(p,21),startDate:h(0),duration:u(!0,!0),effort:l,effortUnit:"day",endDate:g(),percentDone:pn.nextRandom(100),inactive:!1},{id:i++,name:"Task "+Di(p,22),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:pn.nextRandom(100),inactive:!1},{id:i++,name:"Task "+Di(p,23),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:pn.nextRandom(100),inactive:!1}]),duration:o,effort:o,effortUnit:"day",percentDone:d/o,endDate:g()}],duration:a,effort:a,effortUnit:"day",endDate:g()}],dependenciesData:[{id:n++,fromEvent:p+2,toEvent:p+3},{id:n++,fromEvent:p+3,toEvent:p+4},{id:n++,fromEvent:p+4,toEvent:p+5},{id:n++,fromEvent:p+5,toEvent:p+7},{id:n++,fromEvent:p+7,toEvent:p+8},{id:n++,fromEvent:p+8,toEvent:p+9}],taskCount:10,dependencyCount:5},y=v.tasksData[0],C=y.children[0],D=y.children[1];y.percentDone=(C.duration*C.percentDone+D.duration*D.percentDone)/y.duration,s+=a,a=0,v.projectDuration=s,m%r!==0?(v.dependenciesData.push({id:n++,fromEvent:p-2,toEvent:p+2,type:2,lag:0,lagUnit:"d"}),v.dependencyCount++):s=0,i++,yield v}}};JT._$name="ProjectGenerator";var{defineParser:vn,alt:No,seq:yn,string:QT,regexp:zo,succeed:eM,red:Yr,isSuccess:s$}=EE,tM=vn(Yr(zo("[^\\[\\,]+"),e=>({resourceName:e.trim(),units:100,match:e}))),vf=vn(Yr(zo("[0-9\\s]+"),e=>({value:e.split(/\s*/).join(""),match:e}))),rM=vn(Yr(No(QT("."),QT(",")),e=>({value:e,match:e}))),iM=vn(No(Yr(yn(()=>vf,()=>rM,()=>vf),(e,r,t)=>({value:+`${e.value}.${t.value}`,match:[e.match,r.match,t.match].join("")})),Yr(yn(()=>rM,()=>vf),(e,r)=>({value:+`0.${r.value}`,match:[e.match,r.match].join("")})),Yr(()=>vf,e=>({value:+`${e.value}`,match:e.match})))),a$=vn(No(Yr(yn(()=>iM,zo("\\s*\\%")),(e,r)=>({value:e.value,match:[e.match,r].join("")})),Yr(()=>iM,e=>({value:e.value,match:e.match})))),o$=vn(Yr(yn(zo("\\s*\\[\\s*"),()=>a$,zo("\\s*\\]")),(e,r,t)=>({units:r.value,match:[e,r.match,t].join("")}))),nM=vn(Yr(zo("\\s*,\\s*"),e=>({value:e,match:e}))),kC=vn(No(yn(()=>tM,()=>o$,No(yn(()=>nM,()=>kC),eM(""))),yn(()=>tM,No(yn(()=>nM,()=>kC),eM(""))))),sM=e=>{let r=!1,t=[],i="";kC(e,s=>{if(s$(s)){const[,a,o]=s;a.length>t.length&&(t=a,i=o,r=!0)}});let n=0;return r?{rest:i,assignments:t.reduce((s,a)=>{let o;return typeof a=="object"&&(Object.prototype.hasOwnProperty.call(a,"resourceName")?(o=Object.assign({position:n},a),s.push(o)):(o=s[s.length-1],Object.prototype.hasOwnProperty.call(a,"units")&&(o.units=a.units),o.match+=a.match),n+=a.match.length),s},[])}:!1},aM=(e,r=!1)=>{let t="";return e.assignments&&(t+=e.assignments.reduce((i,{resourceName:n,units:s,match:a})=>(a&&r?i+=a:i+=(i.length?", ":"")+`${n} [${s}%]`,i),t)),e.rest&&(t+=e.rest),r||(t=t.trim()),t},l$=e=>aM(sM(e)),c$={parse:sM,compose:aM,normalize:l$},oM=b.clearTime(new Date(1900,5,15)),lM={minute:3,hour:5,day:7,week:9,month:11},d$={minute:1,hour:2,day:3,week:4,month:5},u$={finishnoearlierthan:6,finishnolaterthan:7,mustfinishon:3,muststarton:2,startnoearlierthan:4,startnolaterthan:5},h$={FixedDuration:1,FixedUnits:0,FixedEffort:2,Normal:0},g$={0:3,1:2,2:1,3:0},Cr=class extends Q{constructor(){super(...arguments),E(this,"resourceCalendar",new Map)}generateExportData(){const e=this;return e.tasks=e.collectProjectTasks(),{...e.getMsProjectConfig(),Calendars:{Calendar:e.getCalendarsData()},Tasks:{Task:e.getTasksData()},Resources:{Resource:e.getResourcesData()},Assignments:{Assignment:e.getAssignmentsData()}}}export(e={}){const r=this;if(!r.disabled&&(r.resourceCalendar.clear(),e=T.assign({},r.config,e),e.filename||(e.filename=`${r.client.$$name}.xml`),r.client.trigger("beforeMspExport",{config:e})!==!1)){const t=r.generateExportData(e);r.trigger("dataCollected",{config:e,data:t});const i=r.convertToXml(t),n={config:e,data:t,fileContent:i};r.client.trigger("mspExport",n),q.download(e.filename,`data:text/xml;charset=utf-8,${encodeURIComponent(n.fileContent)}`)}}convertToXml(e){return Tm.convertFromObject(e,{rootName:"Project",elementName:"",xmlns:"http://schemas.microsoft.com/project",rootElementForArray:!1})}getMsProjectConfig(){const e=this,r=e.dateFormat,{project:t}=e.client,i=e.filename||e.client.$$name;return{CalendarUID:e.getCalendarUID(t.effectiveCalendar),CreationDate:b.format(new Date,r),SplitsInProgressTasks:0,MoveCompletedEndsBack:0,MoveRemainingStartsBack:0,MoveRemainingStartsForward:0,MoveCompletedEndsForward:0,NewTaskStartDate:0,DaysPerMonth:t.daysPerMonth,FinishDate:b.format(t.endDate,r),MinutesPerDay:t.hoursPerDay*60,MinutesPerWeek:t.daysPerWeek*t.hoursPerDay*60,Name:i,ScheduleFromStart:t.direction==="Forward"?1:0,StartDate:b.format(t.startDate,r),Title:i,WorkFormat:d$[t.effortUnit],ProjectExternallyEdited:0}}getCalendarsData(){const e=this,{calendarManagerStore:r,project:t}=e.client,{effectiveCalendar:i}=t,n=r.allRecords||[];return r.getByInternalId(i.internalId)||n.push(i),e.client.resources.forEach(s=>{const a=new s.effectiveCalendar.constructor({name:s.name});a.parent=s.effectiveCalendar,a.isResourceCalendar=!0,e.resourceCalendar.set(s,a),n.push(a)}),n.map(s=>{const a=e.getCalendarUID(s);let o=s.name||s.internalId,l=0,c=0;return s.isResourceCalendar?l=e.getCalendarUID(s.parent,0):(o+=" - imported",c=1),{ID:a,UID:a,BaseCalendarUID:l,IsBaseCalendar:c,Name:o,WeekDays:{WeekDay:e.formatWeekDays(s)}}})}formatWeekDays(e){const{timeFormat:r}=this,t=[],i={};let n=oM,s;for(let l=0;l<7;l++){const c=n.getDay();i[c]={DayType:c+1,DayWorking:0},s=b.clearTime(b.add(n,1,"day")),t.push({startDate:n,endDate:s}),n=s}e=e.copy();const a=new e.constructor({intervals:t});return this.client.project.combineCalendars([e,a]).forEachAvailabilityInterval({startDate:oM,endDate:s},(l,c,d)=>{const u=d.getCalendarsWorkStatus(),h=i[l.getDay()];u.get(e)&&(h.DayWorking=1,h.WorkingTimes=h.WorkingTimes||{WorkingTime:[]},h.WorkingTimes.WorkingTime.push({FromTime:b.format(l,r),ToTime:b.format(c,r)}))}),Object.values(i)}collectProjectTasks(){const e=[];return this.client.store.rootNode.traverse(r=>e.push(r),!0),e}getTasksData(){const e=this,{project:r}=e.client,t=r.direction=="Forward",{dateFormat:i,tasks:n}=e;return n.map(s=>{const{startDate:a,endDate:o,wbsCode:l}=s,c=s.predecessors.filter(({fromEvent:y})=>y),d=r.convertDuration(s.duration,s.durationUnit,"millisecond"),u=r.convertDuration(s.effort,s.effortUnit,"millisecond"),h=s.percentDone*.01*d,g=b.format(a,i),f=b.format(o,i),m=Cr.convertDurationToMspDuration(d,"ms"),p=e.getTaskUID(s),v={UID:p,Name:s.name,Active:e.inactive?0:1,Manual:s.manuallyScheduled?1:0,Type:s.isLeaf?h$[s.schedulingMode]:1,IsNull:a&&o?0:1,WBS:l,OutlineNumber:l,OutlineLevel:l.split(".").length,Start:g,Finish:f,Duration:m,ManualStart:g,ManualFinish:f,ManualDuration:m,DurationFormat:lM[s.durationUnit],Work:Cr.convertDurationToMspDuration(u,"ms"),EffortDriven:s.effortDriven?1:0,Estimated:0,Milestone:s.isMilestone?1:0,Summary:s.isLeaf?0:1,PercentComplete:Math.round(s.percentDone),ActualStart:g,ActualDuration:Cr.convertDurationToMspDuration(h,"ms"),RemainingDuration:Cr.convertDurationToMspDuration(d-h,"ms"),PredecessorLink:c.map(y=>({LagFormat:lM[y.lagUnit],LinkLag:r.convertDuration(y.lag,y.lagUnit,"minute")*10,PredecessorUID:e.getTaskUID(y.fromEvent),Type:g$[y.type]})),Baseline:s.baselines.map((y,C)=>({Number:C,Finish:b.format(y.endDate,i),Start:b.format(y.startDate,i),Duration:Cr.convertDurationToMspDuration(y.duration,y.durationUnit)})),IgnoreResourceCalendar:s.ignoreResourceCalendar?1:0,Rollup:s.rollup?1:0,ConstraintType:s.constraintType?u$[s.constraintType]:t?0:1,CalendarUID:e.getCalendarUID(s.calendar)};return s.constraintDate&&(v.ConstraintDate=b.format(s.constraintDate,i)),s.deadlineDate&&(v.Deadline=b.format(s.deadlineDate,i)),s.note&&(v.Notes=s.note),v})}getTaskUID(e){return e.internalId}getCalendarUID(e,r=-1){return e&&!e.isRoot?e.internalId:r}getResourcesData(){return this.client.resources.map(e=>({UID:e.internalId,Name:e.name,Type:1,MaxUnits:"1.00",PeakUnits:"1.00",CalendarUID:this.msProjectVersion===2013?null:this.getCalendarUID(this.resourceCalendar.get(e))}))}getAssignmentsData(){const e=[];if(this.msProjectVersion===2013)return e;const{project:r}=this.client;for(const t of this.tasks){const i=t.assigned,n=this.getTaskUID(t),s=Math.round(t.percentDone),a=b.format(t.startDate,this.dateFormat),o=b.format(t.endDate,this.dateFormat);if(i.size)for(const l of i){const c=r.convertDuration(l.effort,t.effortUnit,"millisecond"),d=r.convertDuration(l.actualEffort,t.effortUnit,"millisecond"),u=c-d;e.push({UpdateNeeded:0,UID:l.internalId,TaskUID:n,ResourceUID:l.resource.internalId,PercentWorkComplete:s,Work:Cr.convertDurationToMspDuration(c,"ms"),ActualWork:Cr.convertDurationToMspDuration(d,"ms"),RemainingWork:Cr.convertDurationToMspDuration(u,"ms"),Start:a,Finish:o,Units:l.units/100})}else{const l=r.convertDuration(t.effort,t.effortUnit,"millisecond"),c=l*s*.01,d=Cr.convertDurationToMspDuration(l,"ms");e.push({UID:ce._internalIdCounter++,TaskUID:n,ResourceUID:-65535,PercentWorkComplete:s,ActualWork:Cr.convertDurationToMspDuration(c,"ms"),RemainingWork:Cr.convertDurationToMspDuration(l-c,"ms"),Start:a,Finish:o,Units:1,Work:d})}}return e}static convertDurationToMspDuration(e,r){if(e==null)return"";const t=b.getDelta(b.as("ms",e,r),{ignoreLocale:!0,maxUnit:"hour"}),{hour:i=0,minute:n=0,second:s=0}=t;return`PT${i}H${n}M${s}S`}},bd=Cr;E(bd,"$name","MspExport"),E(bd,"configurable",{filename:null,dateFormat:"YYYY-MM-DDTHH:mm:ss",timeFormat:"HH:mm:ss",msProjectVersion:2019}),bd._$name="MspExport",j.registerFeature(bd,!1,"Gantt");var f$=/-/g,cM=e=>class extends(e||F){static get $name(){return"GanttDom"}resolveEventRecord(t){return this.resolveTaskRecord(t)}resolveTaskRecord(t){const i=t.closest(this.eventSelector);return i?this.store.getById(i.dataset.taskId):this.getRecordFromElement(t)}resolveRowRecord(t){return this.resolveTaskRecord(t)}onElementKeyDown(t){const i=this.resolveTaskRecord(t.target);super.onElementKeyDown(t),i&&this.trigger("taskKeyDown",{taskRecord:i,event:t})}onElementKeyUp(t){const i=this.resolveTaskRecord(t.target);super.onElementKeyUp(t),i&&this.trigger("taskKeyUp",{taskRecord:i,event:t})}getElementFromTaskRecord(t,i=!0){return this.taskRendering.getElementFromTaskRecord(t,i)}getElementFromEventRecord(t){return this.getElementFromTaskRecord(t)}getEventRenderId(t){return`${this.id.toString().replace(f$,"_")}-${t.id}`}getEventData(t){const i=this,n=i.resolveTimeSpanRecord(t.target);if(n){const s=i.getCell({record:n,column:i.timeAxisColumn}),a=Ge.get(s),o=a.id,l=a.columnId;return{cellElement:s,cellData:a,columnId:l,id:o,record:n,cellSelector:{id:o,columnId:l}}}else return super.getEventData(t)}get widgetClass(){}},dM=e=>class extends(e||F){static get $name(){return"GanttRegions"}getScheduleRegion(t,i=!0,n){var s;const a=this,{timeAxisSubGridElement:o,timeAxis:l}=a;let c;if(t){const p=a.getElementFromTaskRecord(t),v=a.getRowById(t.id);if(!v)return null;if(c=k.from(v.getElement("normal"),o),p){const y=k.from(p,o);c.y=y.y,c.bottom=y.bottom}else c.y+=a.barMargin,c.bottom-=a.barMargin}else c=k.from(o).moveTo(null,0),c.width=o.scrollWidth,c.y=c.y+a.barMargin,c.bottom=c.bottom-a.barMargin;const d=l.startDate,u=l.endDate,{start:h,end:g}=n||{};if(h&&g&&!l.timeSpanInAxis(h,g))return null;!h&&!g&&(n=((s=a.getDateConstraints)==null?void 0:s.call(a,t))||{start:d,end:u});let f=a.getCoordinateFromDate(n.start?b.max(d,n.start):d),m=a.getCoordinateFromDate(n.end?b.min(u,n.end):u);return i||(f=a.translateToPageCoordinate(f),m=a.translateToPageCoordinate(m)),c.x=Math.min(f,m),c.width=Math.max(f,m)-Math.min(f,m),c}translateToPageCoordinate(t){const i=this.timeAxisSubGridElement;return t+i.getBoundingClientRect().left-i.scrollLeft}isRowVisible(t){return this.store.indexOf(t)>=0}getTaskBox(t,i=!1,n=!1){return this.taskRendering.getTaskBox(...arguments)}getSizeAndPosition(){return this.taskRendering.getSizeAndPosition(...arguments)}get widgetClass(){}},uM={block:"nearest",edgeOffset:20},hM=e=>class extends(e||F){static get $name(){return"GanttScroll"}scrollTaskIntoView(t,i=uM){let n=t.startDate,s=t.endDate;const a=this;if(i.edgeOffset==null&&(i.edgeOffset=20),!t.isScheduled)return this.scrollRowIntoView(t,i);if(a.timeAxisSubGrid.collapsed)return;n=n||s,s=s||n;const o=n<a.timeAxis.startDate|(s>a.timeAxis.endDate)<<1;if(o&&i.extendTimeAxis!==!1){const c=a.timeAxis.endDate-a.timeAxis.startDate;let d,u;o===3?a.timeAxis.setTimeSpan(new Date(n.valueOf()-c/2),new Date(s.getTime()+c/2)):(d=a.getCoordinateFromDate(o&1?s:n),o&1?a.timeAxis.setTimeSpan(new Date(n),new Date(n.valueOf()+c)):a.timeAxis.setTimeSpan(new Date(s.valueOf()-c),new Date(s)),u=o&1?a.getCoordinateFromDate(s):a.getCoordinateFromDate(n),a.timeAxisSubGrid.scrollable.scrollBy(u-d))}const l=a.getElementFromTaskRecord(t);return l?a.timeAxisSubGrid.scrollable.scrollIntoView(l,i):a.scrollUnrenderedTaskIntoView(t,i)}scrollUnrenderedTaskIntoView(t,i=uM){i.edgeOffset==null&&(i.edgeOffset=20);const n=this,s=n.timeAxisSubGrid.scrollable,a=n.getTaskBox(t),o=s.viewport,l=a.translate(o.x-s.x,o.y-s.y);let c=s.scrollIntoView(l,Object.assign({},i,{highlight:!1}));if(i.highlight||i.focus){const d=n.ion({renderTask({taskRecord:u,element:h}){u===t&&(d(),c=c.then(()=>{i.highlight&&w.highlight(h),i.focus&&h.focus()}))}})}else c=Promise.all([c,new Promise(d=>{const u=n.ion({renderTask({taskRecord:h}){h===t&&(u(),d())}})})]);return c}get widgetClass(){}},gM=e=>class extends(e||F){static get $name(){return"GanttState"}updateProject(t,i){super.updateProject(t,i),this.detachListeners("suspendStateDuringDelayedCalculation"),t!=null&&t.delayCalculation&&t.ion({name:"suspendStateDuringDelayedCalculation",delayCalculationStart:{fn:"suspendStateListener",prio:10},delayCalculationEnd:{fn:"resumeStateListener",prio:-10},thisObj:this})}suspendStateListener(){this.stateListenerSuspended=(this.stateListenerSuspended||0)+1}resumeStateListener(){const t=this;t.stateListenerSuspended=(t.stateListenerSuspended||1)-1,!t.stateListenerSuspended&&t.isSaveStatePending&&t.saveState({immediate:!0})}saveState(...t){if(!this.stateListenerSuspended)return super.saveState(...t)}applyState(t){var i,n;const s=this;if(!s.project.isInitialCommitPerformed&&((i=t.store)!=null&&i.sorters||(n=t.store)!=null&&n.filters)){const o=t.store;s.project.commitAsync().then(()=>{s.isDestroyed||(s.suspendRefresh(),s.store.state=o,s.resumeRefresh(!0))}),delete t.store}const a=["selectedCell","selectedRecords"];if(a.some(o=>o in t)){const o={};a.forEach(l=>{l in t&&(o[l]=t[l],delete t[l])}),s._applyStateAfterPaint=()=>{s._applyStateAfterPaint=null,s.suspendRefresh(),Object.keys(o).forEach(l=>s[l]=o[l]),s.resumeRefresh(!0)}}super.applyState(t)}get widgetClass(){}onPaint(...t){super.onPaint(...t);const i=this;i._applyStateAfterPaint&&(i.project.isInitialCommitPerformed?i._applyStateAfterPaint():i.project.ion({commitFinalized(){i._applyStateAfterPaint()},thisObj:i,once:!0}))}},fM=e=>class extends Sv(e||F){static get $name(){return"GanttStores"}static get projectStores(){return{calendarManagerStore:{},resourceStore:{dataName:"resources"},eventStore:{dataName:"events"},assignmentStore:{dataName:"assignments"},dependencyStore:{dataName:"dependencies"}}}static get configurable(){return{projectModelClass:Vo,tasks:null,taskStore:null}}updateProject(t,i){super.updateProject(t,i),this.detachListeners("ganttStores"),this.bindCrudManager(t),t==null||t.ion({name:"ganttStores",refresh:"internalOnProjectRefresh",thisObj:this})}get replica(){return this.project.replica}internalOnProjectRefresh({isInitialCommit:t,isCalculated:i}){const n=this,{project:s,visibleDate:a={}}=n;if(n.isPainted){if(!n.appliedViewStartDate&&!("startDate"in n.initialConfig)&&s.startDate){const o=a==null?void 0:a.date,{startDate:l,endDate:c}=s,d=o?b.min(l,o):l,u=o?c?b.max(c,o):b.add(d,n.visibleDateRange.endDate-n.visibleDateRange.startDate):c;d&&u&&(n.setTimeSpan(d,u,{...a,visibleDate:o}),n.appliedViewStartDate=!0)}!t&&i?n.refreshWithTransition():n.refresh(),n.trigger("projectRefresh",{isInitialCommit:t,isCalculated:i})}}get timeRanges(){return this.project.timeRanges}set timeRanges(t){this.project.timeRanges=t}get calendars(){return this.project.calendars}set calendars(t){this.project.calendars=t}get usesDisplayStore(){return this.store!==this.taskStore}get tasks(){return this.project.eventStore.allRecords}changeTasks(t){const{project:i}=this;this.buildingProjectConfig?i.eventsData=t:i.eventStore.data=t}changeTaskStore(t){const{project:i}=this;if(this.buildingProjectConfig){i.eventStore=t;return}return this.initializingProject||i.eventStore!==t&&(i.setEventStore(t),t=i.eventStore),t}updateEventStore(t){const i=this;t.metaMapId=i.id,i.taskStore=i.store=t}bindStore(t){super.bindStore(t),this.timeAxisViewModel.store=t,this.detachListeners("storeBatchedUpdateListener"),t.ion({name:"storeBatchedUpdateListener",batchedUpdate:"onEventStoreBatchedUpdate",thisObj:this})}onEventStoreBatchedUpdate(t){const i=this;if(i.listenToBatchedUpdates){const n=i.enableEventAnimations;i.enableEventAnimations=!1,i.onStoreUpdateRecord(t),i.enableEventAnimations=n}}get widgetClass(){}},mM=e=>class extends(e||F){static get $name(){return"GanttTimelineDateMapper"}getDisplayEndDate(t,i){return t}get widgetClass(){}},m$={animate:100},pM=e=>class extends(e||F){static get $name(){return"TaskNavigation"}static get defaultConfig(){return{navigator:{inlineFlow:!1,prevKey:"ArrowUp",nextKey:"ArrowDown",keys:{Enter:"onTaskEnterKey"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:0,ArrowRight:0}}}processEvent(t){const i=this,n=t.target.closest(i.eventSelector);return!i.navigator.disabled&&n&&(t.taskRecord=t.eventRecord=i.resolveTaskRecord(n)),t}normalizeTarget(t){return t.taskRecord}onElementMouseDown(t){var i;const n=this,{_focusedCell:s}=n,a=t.target.closest(n.navigator.itemSelector),o=a&&a===(s==null?void 0:s.target);super.onElementMouseDown(t),o&&n.lastNavigationEvent!==t&&((i=n.onCellNavigate)==null||i.call(n,n,s,s,!0),n.lastNavigationEvent=t)}selectEvent(t,i=!1){this.isSelected(t)||this.selectRow({record:t.id,column:!1,addToSelection:i})}deselectEvent(t){this.deselectRow(t.id)}getNext(t){const i=this,{store:n}=i;for(let s=n.indexOf(t)+1;s<n.count;s++){const a=n.getAt(s);if(i.isInTimeAxis(a))return a}}getPrevious(t){const i=this,{store:n}=i;for(let s=n.indexOf(t)-1;s>=0;s--){const a=n.getAt(s);if(i.isInTimeAxis(a))return a}}set activeEvent(t){this.navigator.activeItem=this.getElementFromTaskRecord(t,!1)}get activeEvent(){const{activeItem:t}=this.navigator;if(t)return this.resolveTaskRecord(t)}async navigateTo(t,{scrollIntoView:i=!0,uiEvent:n={}}){const s=this,{navigator:a}=s,{skipScrollIntoView:o}=a;t&&(i?(a.disabled=!0,await s.scrollTaskIntoView(t,m$),a.disabled=!1):a.skipScrollIntoView=!0,s.isDestroyed||(s.activeEvent=t,a.skipScrollIntoView=o,a.trigger("navigate",{event:n,item:s.getElementFromTaskRecord(t,!1)})))}clearEventSelection(){this.deselectAll()}onTaskEnterKey(){}onDeleteKey(t){const i=t.eventRecord;!this.readOnly&&this.enableDeleteKey&&i&&this.removeEvents([i])}onGridBodyFocusIn(t){var i;if(this.timeAxisSubGridElement.contains(t.target)){const n=this,{navigationEvent:s}=n,{target:a}=t,o=a.closest(n.navigator.itemSelector),l=o?n.resolveTaskRecord(a):n.getRecordFromElement(a),c=n.normalizeCellContext({rowIndex:n.store.indexOf(l),column:n.timeAxisColumn,target:a});if(o){if(n.lastNavigationEvent!==s){const{_focusedCell:d}=n;n._focusedCell=c,(i=n.onCellNavigate)==null||i.call(n,n,d,c,!0),n.lastNavigationEvent=s}return}n.navigateTo(l,{scrollIntoView:(s==null?void 0:s.type)!=="mousedown",uiEvent:s});return}super.onGridBodyFocusIn(t)}get widgetClass(){}},p$={releaseElement:1,reuseElement:1},v$={newElement:1,reuseOwnElement:1,reuseElement:1},FC=class extends F{static get properties(){return{rowMap:new Map}}construct(e){this.gantt=e,e.rowManager.ion({renderDone:"onRenderDone",removeRows:"onRemoveRows",beforeRowHeight:"onBeforeRowHeightChange",renderRow:"onRenderRow",thisObj:this}),super.construct({})}init(){}refreshRows(){}onTimeAxisViewModelUpdate(){this.updateFromHorizontalScroll(this.gantt.timeAxisSubGrid.scrollable.x)}onViewportResize(){}onDragAbort(){}onBeforeRowHeightChange(e){var r;const{gantt:t}=this;t.foregroundCanvas&&(t.foregroundCanvas.style.fontSize=`${((r=e==null?void 0:e.height)!=null?r:t.rowHeight)-t.resourceMargin*2}px`)}get visibleDateRange(){return this._visibleDateRange}getTaskBox(e,r=!1,t=!1){const{gantt:i}=this,{isBatchUpdating:n}=e,{store:s}=i,a=n?e.get("startDate"):e.startDate,o=n?e.get("endDate"):e.endDate;if(t){const f=this.getElementFromTaskRecord(e);if(f)return k.from(f,i.timeAxisSubGridElement)}if(!a||!o||e.isTask&&(s.isDestroyed||!s.isAvailable(e)))return null;const l=this.getSizeAndPosition(e,r,t);if(!l)return null;const{position:c,width:d}=l,u=i.rowManager.calculateTop(s.indexOf(e.isBaseline?e.task:e))+i.resourceMargin,h=i.rowHeight-i.resourceMargin*2,g=new k(c,u,d,h);return g.layout=!0,g}getSizeAndPosition(e,r,t){var i;const n=this,{gantt:s}=n,{timeAxis:a}=s,o=a.startDate,l=a.endDate,c=e.milestone,d=c?(i=s.features.dependencies.pathFinder)==null?void 0:i.startArrowMargin:0;let u=e.isBatchUpdating?e.get("startDate"):e.startDate,h=e.isBatchUpdating?e.get("endDate"):e.endDate||(e.duration!=null?b.add(u,e.duration,e.durationUnit):null),g,f;if(!r&&(h<o||u>l))return null;if(r&&u<o)g=s.getCoordinateFromDate(o)-d;else if(r&&u>l)g=s.getCoordinateFromDate(l)+d;else if(u<o){const p=s.timeAxisViewModel.getSingleUnitInPixels("second"),v=(a.startMS-e.startDateMS)/1e3,y=v*p;g=s.getCoordinateFromDate(o)-y}else s.fillTicks&&!c&&(!e.isBatchUpdating||s.snap)&&(u=a.getSnappedTickFromDate(u).startDate),g=s.getCoordinateFromDate(u);if(!c)if(r&&h<o)f=s.getCoordinateFromDate(o);else if(r&&h>l)f=s.getCoordinateFromDate(l);else if(h>l){const p=s.timeAxisViewModel.getSingleUnitInPixels("second"),v=(e.endDateMS-a.endMS)/1e3,y=v*p;f=s.getCoordinateFromDate(l)+y}else{if(s.fillTicks&&(!e.isBatchUpdating||s.snap)){const p=Math.ceil(s.timeAxis.getTickFromDate(h))-1;h=s.timeAxis.getAt(p).endDate}f=s.getCoordinateFromDate(h)}let m=c?0:Math.abs(g-f);return t&&c&&u>o&&u<l&&(m=s.rowHeight-s.resourceMargin*2,g-=m/2),!r&&g+m<0?null:{position:g,width:m}}getRowRegion(e,r,t){const{gantt:i}=this,n=i.getRowFor(e);if(!n)return null;const s=n.getElement(i.timeAxisSubGrid.region),a=i.timeAxis.startDate,o=i.timeAxis.endDate,l=r?b.max(a,r):a,c=t?b.min(o,t):o,d=i.getCoordinateFromDate(l),u=i.getCoordinateFromDate(c,!0,!0),h=n.top+i.scrollTop,g=Math.min(d,u),f=h+s.offsetHeight;return new k(g,h,Math.max(d,u)-g,f-h)}getDateFromXY(e,r,t){let i=e[0];return t||(i=this.translateToScheduleCoordinate(i)),this.gantt.timeAxisViewModel.getDateFromPosition(i,r)}translateToScheduleCoordinate(e){return e-Math.floor(this.gantt.timeAxisSubGridElement.getBoundingClientRect().left)+this.gantt.scrollLeft}translateToPageCoordinate(e){const r=this.gantt.timeAxisSubGridElement;return e+r.getBoundingClientRect().left-r.scrollLeft}getElementFromTaskRecord(e,r=!0){const{syncIdMap:t}=this.gantt.foregroundCanvas;let i=t==null?void 0:t[e.id];return!i&&e.hasLinks&&t&&e.forEachLinked((n,s)=>{t[s.id]&&(i=t[s.id])}),r?i==null?void 0:i.syncIdMap.task:i}getConnectorStartSide(e){return this.gantt.rtl?"right":"left"}getConnectorEndSide(e){return this.gantt.rtl?"left":"right"}onRenderRow({row:e,record:r}){e.assignCls({"b-inactive":r.inactive})}onRemoveRows({rows:e}){e.forEach(r=>this.rowMap.delete(r)),!this.gantt.refreshSuspended&&this.onRenderDone()}updateFromHorizontalScroll(e){const r=this,{gantt:t}=r,{timeAxisSubGrid:i,timeAxis:n,rtl:s}=t,{width:a}=i,{totalSize:o}=t.timeAxisViewModel,l=e,c=i.scrollable.maxX!==0&&Math.abs(i.scrollable.maxX)<=Math.round(l)+5,d=t.getDateFromCoord({coord:Math.max(0,l),ignoreRTL:!0}),u=c?n.endDate:t.getDateFromCoord({coord:l+a,ignoreRTL:!0})||n.endDate;if(d&&!t._viewPresetChanging){r._visibleDateRange={startDate:d,endDate:u,startMS:d.getTime(),endMS:u.getTime()},r.viewportCoords=s?{left:o-e-a,right:o-e}:{left:e,right:e+a};const h=t.timeView.range={startDate:d,endDate:u};t.onVisibleDateRangeChange(h)}}internalPopulateTaskRenderData(e,r){var t;const{gantt:i}=this,n={className:"b-gantt-task-content",dataset:{taskBarFeature:"content"},children:[]};if(e){let s=r.isResizable===void 0?!0:r.isResizable;e.startsOutsideView&&(s===!0?s="end":s==="start"&&(s=!1)),e.endsOutsideView&&(s===!0?s="start":s==="end"&&(s=!1)),Object.assign(e,{iconCls:new J(r.taskIconCls),id:i.getEventRenderId(r),style:r.style||"",taskId:r.id,wrapperCls:new J({[i.eventCls+"-wrap"]:1,[`${i.eventCls}-parent`]:r.isParent,"b-milestone-wrap":r.milestone,"b-inactive":r.inactive,"b-expanded":r.isExpanded(i.store),"b-readonly":r.readOnly,"b-linked":r.isLinked,"b-original":r.hasLinks,"b-temporary":!r.project}),cls:r.isResourceTimeRange?new J:r.cls.clone(),extraConfigs:[]}),Object.assign(e.cls,{[i.eventCls]:1,[i.generatedIdCls]:r.hasGeneratedId,[i.dirtyCls]:r.modifications,[i.committingCls]:r.isCommitting,[i.endsOutsideViewCls]:e.endsOutsideView,[i.startsOutsideViewCls]:e.startsOutsideView,[i.fixedEventCls]:r.isDraggable===!1,[`b-sch-event-resizable-${s}`]:1,"b-milestone":r.milestone,"b-task-started":r.isStarted,"b-task-finished":r.isCompleted,"b-task-selected":i.selectedRecords.includes(r)});const a=r.eventStyle||i.eventStyle,o=r.eventColor||i.eventColor;if(e.eventColor=o,e.eventStyle=a,i.taskRenderer){const l=i.taskRenderer.call(i.taskRendererThisObj||i,{taskRecord:r,renderData:e});typeof e.cls=="string"&&(e.cls=new J(e.cls)),typeof e.iconCls=="string"&&(e.iconCls=new J(e.iconCls)),typeof e.wrapperCls=="string"&&(e.wrapperCls=new J(e.wrapperCls));let c=null;O.isHtml(l)?c={tag:"span",html:l}:typeof l=="string"||typeof l=="object"?c=l:l!=null&&(c=String(l)),c&&(Array.isArray(c)?n.children.push(...c):n.children.push(c),e.cls.add("b-has-content"))}if(e.cls["b-sch-event-withicon"]=e.iconCls.length,e.wrapperCls[`b-sch-style-${e.eventStyle}`]=e.eventStyle,w.isNamedColor(e.eventColor))e.wrapperCls[`b-sch-color-${e.eventColor}`]=e.eventColor;else if(e.eventColor){const l=`background-color:${e.eventColor};`;e.style=l+e.style,e.wrapperCls["b-sch-custom-color"]=1,e._customColorStyle=l}else e.wrapperCls["b-sch-color-none"]=1;e.style&&r.isMilestone&&n&&(n.style=e.style,delete e.style),(t=e.iconCls)!=null&&t.length&&n.children.unshift({tag:"i",className:e.iconCls}),(n.children.length||r.milestone)&&e.children.push(n)}e.taskContent=n,e.wrapperChildren=[]}populateTaskRenderData(e,r){this.internalPopulateTaskRenderData(...arguments),this.gantt.onTaskDataGenerated(e)}getTaskRenderData(e,r){const t=this,i=t.getTaskBox(r,!1,!1,e),n={taskRecord:r,task:r,row:e,children:[]};return i?Object.assign(n,{isTask:!0,top:i.top,left:i.left,width:i.width,height:i.height}):n.top=e.top+t.gantt.resourceMargin,t.populateTaskRenderData(n,r),n}getTaskDOMConfig(e){return{className:e.wrapperCls,tabIndex:"0",children:[{className:e.cls,style:(e.internalStyle||"")+(e.style||""),children:e.children,dataset:{taskFeature:"task"},syncOptions:{syncIdField:"taskBarFeature"}},...e.wrapperChildren],style:{top:e.top,left:e.left-(this.gantt.rtl?e.width:0),width:e.width,zIndex:e.zIndex},dataset:{taskId:e.taskId},elementData:e,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}}}renderer({row:e,record:r}){const t=this,i=t.getTaskRenderData(e,r);let n;if(i.isTask)n=t.getTaskDOMConfig(i),t.gantt.trigger("beforeRenderTask",{renderData:i,domConfig:n});else if(i.extraConfigs.length===0){t.rowMap.delete(e);return}t.rowMap.set(e,[n,...i.extraConfigs])}onRenderDone(){const{gantt:e}=this,r=Array.from(this.rowMap.values()).flat();e.onBeforeTaskSync(r),X.sync({domConfig:{onlyChildren:!0,children:r},targetElement:e.foregroundCanvas,syncIdField:"taskId",callback({action:t,domConfig:i,lastDomConfig:n,targetElement:s}){var a,o;if(t!=="none"&&i&&i.className&&i.className[e.eventCls+"-wrap"]){const l=p$[t],c=v$[t];if(l&&((a=n==null?void 0:n.elementData)!=null&&a.isTask)){const d={renderData:n.elementData,taskRecord:n.elementData.taskRecord,element:s};e.trigger("releaseTask",d)}if(c&&((o=i==null?void 0:i.elementData)!=null&&o.isTask)){const d={renderData:i.elementData,taskRecord:i.elementData.taskRecord,element:s};d.reusingElement=t==="reuseElement",e.trigger("renderTask",d)}}}})}redraw(e){this.gantt.rowManager.refreshCell(e,this.gantt.timeAxisColumn.id)&&this.onRenderDone()}};FC._$name="NewTaskRendering";var y$=Object.freeze({}),b$=0,Wo=class extends ns.mixin(sh,cM,dM,hM,fM,gM,mM,wv,pM,Kb,Xb,Ev,Qx){constructor(){super(...arguments),E(this,"timeCellSelector",".b-sch-timeaxis-cell")}static get type(){return"ganttbase"}static get defaultConfig(){return{project:null,resourceImageFolderPath:null,defaultResourceImageName:null,toggleParentTasksOnClick:!0,scrollTaskIntoViewOnCellClick:!1,calendars:null,resources:null,tasks:null,dependencies:null,assignments:null,eventCls:"b-gantt-task",eventBarTextField:null,eventLayout:"none",eventSelectionDisable:!0,eventColor:null,eventStyle:null,rowHeight:45,scheduledEventName:"task",eventScrollMode:"move",overScheduledEventClass:"b-gantt-task-hover",mode:"horizontal",timeCellCls:"b-sch-timeaxis-cell",focusCls:"b-active",taskRenderer:null,newTaskDefaults:{},dependencyIdField:"id",getDateConstraints:null,showTaskColorPickers:null}}get isGantt(){return!0}construct(e={}){const r=this,t=!!(e.calendars||e.taskStore||e.dependencyStore||e.resourceStore||e.assignmentStore),i=!!(e.calendars||e.tasks||e.dependencies||e.resources||e.assignments);if(!e.features){const s=r.getDefaultConfiguration().features;e.features=s&&typeof s=="object"?s:{}}"tree"in e.features||(e.features.tree=!0),"group"in e.features||(e.features.group=!1);const{project:n}=e;if(n&&(t||i))throw new Error("Providing both project and inline data is not supported");n!=null&&n.isModel||(e.project=T.assign({calendarsData:e.calendars,eventsData:e.tasks,dependenciesData:e.dependencies,resourcesData:e.resources,assignmentsData:e.assignments,resourceStore:e.resourceStore,eventStore:e.taskStore,assignmentStore:e.assignmentStore,dependencyStore:e.dependencyStore,timeRangeStore:e.timeRangeStore},n),delete e.resourceStore,delete e.taskStore,delete e.assignmentStore,delete e.dependencyStore,delete e.timeRangeStore,delete e.calendars,delete e.resources,delete e.tasks,delete e.assignments,delete e.dependencies),super.construct(e),r.ion({taskclick:"onTaskBarClick",cellClick:"onNonTimeAxisCellClick",toggleNode:"onToggleParentNode"})}changeColumns(e,r){if(e){let t=e;Array.isArray(e)||(t=e.data,this._thisIsAUsedExpression(this.taskStore)),t.some(i=>{const n=i instanceof ye?i.constructor:Z.getColumnClass(i.type)||ye;return n===jo||n.prototype instanceof jo})||t.unshift({type:"name"})}return super.changeColumns(e,r)}set timeAxisViewModel(e){super.timeAxisViewModel=e,this.store&&(this.timeAxisViewModel.store=this.store)}get timeAxisViewModel(){return super.timeAxisViewModel}onPaintOverride(){}resumeRefresh(e){super.resumeRefresh(!1),!this.refreshSuspended&&e&&this.isPainted&&(this.rowManager.topRow?this.refreshWithTransition():this.rowManager.reinitialize())}onStoreUpdateRecord(e){if(!this.project.isBatchingChanges){let r;return this.runWithTransition(()=>{r=super.onStoreUpdateRecord(e)},!this.refreshSuspended),r}}onStoreDataChange(e){this.runWithTransition(()=>{super.onStoreDataChange(e)},e.action==="batch")}onTaskDataGenerated(){}onBeforeTaskSync(){}onTaskBarClick({taskRecord:e}){this.toggleParentTasksOnClick&&!e.isLeaf&&this.toggleCollapse(e)}onNonTimeAxisCellClick({record:e,column:r}){const{scrollTaskIntoViewOnCellClick:t}=this;r.type!=="timeAxis"&&t&&e.isScheduled&&this.scrollTaskIntoView(e,t===!0?{animate:!0,block:"center",y:!1}:t)}onToggleParentNode({record:e}){e.parent.isExpanded(this.taskStore)&&this.taskRendering.redraw(e)}afterSelectionChange({selectedRecords:e,deselectedRecords:r}){const t=this;function i(n,s){const a=t.getElementFromTaskRecord(n);a&&X[s?"addCls":"removeCls"]("b-task-selected",a)}e==null||e.map(n=>i(n,!0)),r==null||r.map(n=>i(n,!1))}toggleEmptyText(){const e=this;e.bodyContainer&&e.rowManager&&w.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.project.isLoadingOrSyncing))}get currentOrientation(){const e=this;return e._currentOrientation||(e.taskRendering=e._currentOrientation=new FC(e)),e._currentOrientation}getTimeSpanMouseEventParams(e,r){const t=this.resolveTaskRecord(e);return t?{taskRecord:t,taskElement:e,event:r}:null}getScheduleMouseEventParams(e){return{taskRecord:this.store.getById(e.id)}}resolveTimeSpanRecord(e){return this.resolveTaskRecord(e)}repaintEventsForResource(e){this.taskRendering.redraw(e)}get visibleResources(){var e,r;return{first:this.store.getById((e=this.firstVisibleRow)==null?void 0:e.id),last:this.store.getById((r=this.lastVisibleRow)==null?void 0:r.id)}}populateTaskMenu(){}async addTask(e,r=y$){const t=this,{milestone:i,asPredecessor:n,asSuccessor:s}=r,a=t.project,o=e.parent,l=typeof t.newTaskDefaults=="function"?t.newTaskDefaults(e):t.newTaskDefaults,c=t.taskStore.modelClass.new({startDate:e.startDate,duration:e.duration,durationUnit:e.durationUnit},l,r.data);return t.trigger("beforeTaskAdd",{taskRecord:c}),c.name||(c.name=`${t.L(i?"L{Gantt.New milestone}":"L{Gantt.New task}")} ${++b$}`),a.suspendChangesTracking(),r.asChild?e.insertChild(c,r.at==="end"?null:e.firstChild):r.above?o.insertChild(c,e):o.insertChild(c,e.nextSibling),a.resumeChangesTracking(!0),i?(await a.commitAsync(),await c.convertToMilestone()):await a.commitAsync(),s?t.dependencyStore.add({fromEvent:e,toEvent:c,type:ft.EndToStart,fromSide:"right",toSide:"left"}):n&&t.dependencyStore.add({fromEvent:c,toEvent:e,type:ft.EndToStart,fromSide:"right",toSide:"left"}),(s||n)&&await a.commitAsync(),c}addTaskAbove(e,r){return this.addTask(e,{...r,above:!0})}addTaskBelow(e,r){return this.addTask(e,r)}addMilestoneBelow(e,r){return this.addTask(e,{...r,milestone:!0})}addSubtask(e,r){const t=this.addTask(e,{...r,asChild:!0});return this.toggleCollapse(e,!1),t}addSuccessor(e,r){return this.addTask(e,{...r,asSuccessor:!0})}addPredecessor(e,r){return this.addTask(e,{...r,above:!0,asPredecessor:!0})}async indent(e){const r=this;if(r.isTreeGrouped)return;(!e||e instanceof Event)&&(e=r.selectedRecords),await this.project.commitAsync();const t=await r.taskStore.indent(e);return t||It.show({rootElement:r.rootElement,html:r.L("L{Gantt.changeRejected}")}),t}async outdent(e){const r=this;if(r.isTreeGrouped)return;(!e||e instanceof Event)&&(e=r.selectedRecords),await this.project.commitAsync();const t=await r.taskStore.outdent(e);return t||It.show({rootElement:r.rootElement,html:r.L("L{Gantt.changeRejected}")}),t}onElementKeyDown(e){super.onElementKeyDown(e)}onElementKeyUp(e){super.onElementKeyUp(e)}onElementMouseOver(e){super.onElementMouseOver(e)}onElementMouseOut(e){super.onElementMouseOut(e)}};E(Wo,"$name","GanttBase"),E(Wo,"configurable",{keyMap:{"Alt+Shift+ArrowLeft":"outdent","Alt+Shift+ArrowRight":"indent"}}),Wo.initClass(),ne.setVersion("gantt","5.5.0"),Wo._$name="GanttBase";var OC=class extends Wo{static get $name(){return"Gantt"}static get type(){return"gantt"}};OC.initClass(),OC._$name="Gantt";export{Fp as AbstractAssignmentStoreMixin,Op as AbstractCalendarManagerStoreMixin,Ap as AbstractCalendarMixin,fv as AbstractCrudManager,dv as AbstractCrudManagerMixin,qx as AbstractCrudManagerValidation,Lp as AbstractDependencyStoreMixin,$p as AbstractEventStoreMixin,_p as AbstractHasAssignmentsMixin,sc as AbstractPartOfProjectGenericMixin,La as AbstractPartOfProjectModelMixin,ir as AbstractPartOfProjectStoreMixin,fi as AbstractRecurrenceIterator,jp as AbstractResourceStoreMixin,Ki as AbstractTimeRanges,ri as ActionBase,Kn as ActionColumn,Ig as AddNewColumn,Hb as AdvancedTab,va as AggregateColumn,_r as AjaxHelper,bt as AjaxStore,uv as AjaxTransport,GL as AllColumns,je as Animator,il as ArrayDataField,H as ArrayHelper,uT as AssignmentAllocationInterval,qg as AssignmentField,Ug as AssignmentGrid,Bo as AssignmentModel,ov as AssignmentModelMixin,Yg as AssignmentPicker,cC as AssignmentStore,lv as AssignmentStoreMixin,Gs as AssignmentsManipulationStore,bn as AsyncHelper,xt as AttachToProjectMixin,qn as AvatarRendering,Em as Badge,ll as Bag,Ql as Bar,F as Base,sg as BaseAllocationInfo,ng as BaseAllocationInterval,Wh as BaseAssignmentMixin,Ss as BaseCalendarMixin,nb as BaseDependencyMixin,ob as BaseDependencyResolution,Wy as BaseEmptyCalendarEffectResolution,on as BaseEventMixin,eb as BaseHasAssignmentsMixin,qh as BaseResourceMixin,lf as Baseline,Bs as BaselineDurationColumn,Hs as BaselineDurationVarianceColumn,js as BaselineEndDateColumn,Ns as BaselineEndVarianceColumn,$s as BaselineStartDateColumn,Vs as BaselineStartVarianceColumn,df as Baselines,Vm as BooleanCombo,Zf as BooleanDataField,uo as BreakCurrentStackExecution,q as BrowserHelper,bl as Button,ai as ButtonGroup,Ct as CI,kp as CIFromSetOrArrayOrValue,cm as CSSHelper,Ft as CalculateProposed,Mr as CalculatedValueGen,Iy as CalculatedValueGenC,po as CalculatedValueSync,My as CalculatedValueSyncC,K0 as CalculationGen,X0 as CalculationSync,Rp as CalendarCache,Lu as CalendarCacheInterval,Tp as CalendarCacheIntervalMultiple,Ip as CalendarCacheMultiple,fx as CalendarCacheSingle,Ag as CalendarColumn,dg as CalendarField,Mb as CalendarHighlight,ac as CalendarIntervalMixin,ZT as CalendarIntervalModel,Pp as CalendarIntervalStore,_t as CalendarIteratorResult,dC as CalendarManagerStore,sf as CalendarModel,fa as CalendarPanel,Pg as CalendarPicker,LR as CanCombineCalendarsMixin,Sa as CellCopyPaste,mC as CellEdit,Ll as CellMenu,$l as CellTooltip,Si as ChangeLogAction,Eg as ChangeLogAssignmentEntity,wg as ChangeLogDependencyEntity,Lo as ChangeLogEntity,Ub as ChangeLogPropertyUpdate,Io as ChangeLogStore,Is as ChangeLogTransactionModel,Nt as CheckColumn,Hn as Checkbox,Bn as ChipView,BR as ChronoAbstractProjectMixin,qy as ChronoAssignmentStoreMixin,Ky as ChronoCalendarManagerStoreMixin,Xy as ChronoDependencyStoreMixin,Bc as ChronoEventStoreMixin,rb as ChronoEventTreeStoreMixin,vo as ChronoField,rR as ChronoGraph,Ke as ChronoMixinBase,bo as ChronoModelFieldIdentifier,Vh as ChronoModelMixin,Bh as ChronoModelReferenceBucketFieldIdentifier,Fc as ChronoModelReferenceFieldIdentifier,vR as ChronoModelReferenceFieldQuark,Ny as ChronoPartOfProjectGenericMixin,So as ChronoPartOfProjectModelMixin,Cs as ChronoPartOfProjectStoreMixin,ib as ChronoResourceStoreMixin,xR as ChronoStoreMixin,Py as ChronoTransaction,qd as ClickRepeater,uE as Clipboardable,ss as ClockTemplate,bm as CollapseTool,$t as Collection,dt as CollectionFilter,al as CollectionSorter,Vi as ColorColumn,Nn as ColorField,Vn as ColorPicker,ye as Column,Da as ColumnAutoWidth,Cu as ColumnDragToolbar,Av as ColumnLines,jl as ColumnPicker,Bl as ColumnRename,wa as ColumnReorder,lp as ColumnResize,Z as ColumnStore,Fe as Combo,Oh as CommitZero,Fh as ComputationCycle,Pe as Config,sn as ConflictEffect,ER as ConflictEffectDescription,zh as ConflictResolution,Vy as ConflictSymbol,PT as ConstrainedByParentMixin,ws as ConstrainedEarlyEventMixin,Tg as ConstrainedLateEventMixin,_g as ConstraintDateColumn,an as ConstraintInterval,Co as ConstraintIntervalDescription,Ye as ConstraintIntervalSide,ue as ConstraintType,kg as ConstraintTypeColumn,ko as ConstraintTypePicker,Ht as Container,sL as ContextGen,aa as ContextMenuBase,nL as ContextSync,ba as CopyPasteBase,Bu as CoreAssignmentMixin,Bp as CoreAssignmentStoreMixin,bx as CoreCalendarManagerStoreMixin,Hp as CoreCalendarMixin,Hu as CoreDependencyMixin,Vp as CoreDependencyStoreMixin,hi as CoreEventMixin,Np as CoreEventStoreMixin,Sx as CoreHasAssignmentsMixin,Dx as CoreHasDependenciesMixin,$u as CorePartOfProjectGenericMixin,$a as CorePartOfProjectModelMixin,Ba as CorePartOfProjectStoreMixin,ja as CoreResourceMixin,zp as CoreResourceStoreMixin,ia as CoreStateTrackingManager,pC as CriticalPaths,th as CrudManager,sh as CrudManagerView,tn as CycleDescription,Ds as CycleEffect,_R as CycleEffectDescription,Pt as CycleResolution,cy as CycleResolutionInput,q0 as CycleResolutionInputChrono,Rg as CycleResolutionPopup,Uy as CycleSymbol,Yu as DailyRecurrenceIterator,er as DataField,ca as DataGenerator,li as DateColumn,Nc as DateConstraintInterval,UR as DateConstraintIntervalDescription,Jf as DateDataField,ma as DateField,b as DateHelper,Nh as DateInterval,Rl as DatePicker,Wn as DateTimeField,gt as DayTime,hT as DeactivateDependencyCycleEffectResolution,cb as DeactivateDependencyResolution,Fg as DeadlineDateColumn,fe as Delayable,Ex as DelayableWrapper,R0 as DelayedRecordsRendering,lE as DemoBot,fd as Dependencies,rs as DependenciesCalendar,mt as DependencyBaseModel,ud as DependencyColumn,Do as DependencyConstraintInterval,YR as DependencyConstraintIntervalDescription,y0 as DependencyCreation,Ib as DependencyEdit,Ws as DependencyField,af as DependencyModel,uC as DependencyStore,cv as DependencyStoreMixin,Dg as DependencyTab,C0 as DependencyTooltip,ft as DependencyType,Ob as DependencyTypePicker,ci as DependencyValidationResult,r0 as Describable,ae as Direction,AT as DisableManuallyScheduledConflictResolution,Nm as DisplayField,J as DomClassList,Ge as DomDataStore,w as DomHelper,X as DomSync,ch as DragBase,da as DragContext,Ka as DragCreateBase,ki as DragHelper,ua as DragProxy,Lm as DragTipProxy,nu as Draggable,fE as Droppable,_e as Duration,Hr as DurationColumn,jR as DurationConverterMixin,Il as DurationField,Re as DurationVar,An as DynamicObject,DR as EMPTY_INTERVAL,Og as EarlyEndDateColumn,ot as EarlyLateLazyness,Lg as EarlyStartDateColumn,Br as EdgeInclusion,go as EdgeType,_c as EdgeTypeNormal,ps as EdgeTypePast,Pv as EditBase,hr as Editor,_o as EditorTab,at as Effect,sr as EffectResolutionResult,$g as EffortColumn,ks as EffortField,pt as EffortVar,jc as EmptyCalendarEffect,RR as EmptyCalendarEffectDescription,zy as EmptyCalendarSymbol,jg as EndDateColumn,kb as EndDateField,we as EndDateVar,PR as EngineReplica,Yy as EngineRevision,IR as EngineTransaction,Gr as Entity,nR as EntityIdentifier,iR as EntityMeta,Pb as EventBuffer,Ua as EventColorColumn,eo as EventColorField,Ga as EventColorPicker,cs as EventCopyPaste,Uu as EventDayIndex,vc as EventDrag,Ja as EventDragCreate,yc as EventDragSelect,bc as EventEdit,kv as EventEditor,Cc as EventFilter,B as EventHelper,fT as EventLoader,to as EventMenu,oC as EventModeColumn,Jc as EventModel,Qu as EventModelMixin,wv as EventNavigation,Sc as EventNonWorkingTime,td as EventResize,rd as EventSegmentDrag,mg as EventSegmentModel,Po as EventSegmentResize,Ps as EventSegments,u0 as EventSelection,pg as EventStore,Jp as EventStoreMixin,gh as EventTooltip,wb as EventUpdateAction,Le as Events,Qv as ExcelExporter,Xl as ExportDialog,pp as ExportOrientationCombo,mp as ExportRowsCombo,Ma as Exporter,En as Factoryable,I_ as Featureable,yE as Fencible,Ue as Field,jm as FieldContainer,$i as FieldFilterPicker,Gn as FieldFilterPickerGroup,yr as FieldIdentifier,uu as FieldSet,Mu as FileDrop,Um as FileField,Eu as FileFormat,Ym as FilePicker,Ea as FillHandle,up as Filter,Du as FilterBar,qm as FilterField,hE as Finalizable,lT as FixedDurationMixin,OT as FixedEffortMixin,HT as FixedUnitsMixin,Iu as Footer,gn as FormTab,eu as Formatter,Ze as Formula,Ih as FormulasCache,Or as Fullscreen,Te as FunctionHelper,OC as Gantt,Wo as GanttBase,Jt as GanttDateColumn,cM as GanttDom,iC as GanttEvent,WT as GanttProjectMixin,dM as GanttRegions,hM as GanttScroll,gM as GanttState,fM as GanttStores,sd as GanttTaskEditor,mM as GanttTimelineDateMapper,Fb as GeneralTab,Wu as GetEventsMixin,eL as GetTransaction,be as GlobalEvents,tc as Grid,Aa as GridBase,Ol as GridCellEdit,XE as GridElementEvents,Tu as GridExcelExporter,j as GridFeatureManager,ZE as GridFeatures,Su as GridFieldFilterPicker,Hl as GridFieldFilterPickerGroup,Vl as GridGroupSummary,Ia as GridMultiPageExporter,Pa as GridMultiPageVerticalExporter,xu as GridPdfExport,JE as GridResponsive,zi as GridRowModel,Wi as GridRowReorder,QE as GridSelection,Zl as GridSinglePageExporter,Gi as GridSplit,ex as GridState,tx as GridSubGrids,ql as GridSummary,Yi as GridTreeGroup,wu as Group,_a as GroupBar,Gv as GroupSummary,Uh as HasCalendarMixin,yi as HasChildrenMixin,zT as HasCriticalPathsMixin,sb as HasDateConstraintMixin,tb as HasDependenciesMixin,rg as HasEffortMixin,ub as HasPercentDoneMixin,z0 as HasProposedNotPreviousValue,N0 as HasProposedNotPreviousValueEffect,Dy as HasProposedNotPreviousValueSymbol,vr as HasProposedValue,V0 as HasProposedValueEffect,Sy as HasProposedValueSymbol,Yc as HasSchedulingModeMixin,Kh as HasSubEventsMixin,es as Header,Nl as HeaderMenu,fh as HeaderZoom,Yn as Histogram,ih as HorizontalLayoutPack,rh as HorizontalLayoutStack,gc as HorizontalRendering,za as HorizontalTimeAxis,__ as Hoverable,ti as IdHelper,ea as Identifiable,nr as Identifier,lL as IdentifierC,zs as IgnoreResourceCalendarColumn,Bg as InactiveColumn,is as IndexPosition,yC as Indicators,Q as InstancePlugin,Yt as Instruction,Qf as IntegerDataField,Mp as IntervalCache,jh as IsChronoModelSymbol,hv as JsonEncoder,Ew as KeyMap,pa as Label,$m as Labelable,bC as Labels,Hg as LateEndDateColumn,Vg as LateStartDateColumn,Lr as Layout,Wr as Levels,$r as List,tR as Listener,Am as LoadMaskable,yt as LocaleHelper,ze as LocaleManager,We as Localizable,oe as Location,He as MAX_DATE,cx as MI,Xe as MIN_DATE,Ng as ManuallyScheduledColumn,ld as ManuallyScheduledParentConstraintInterval,_T as ManuallyScheduledParentConstraintIntervalDescription,Bt as Mask,Fn as Menu,Cl as MenuItem,zl as MergeCells,Bi as MessageDialog,Pc as Meta,dd as MilestoneColumn,gk as Minifiable,bR as MinimalChronoModelFieldIdentifierGen,yR as MinimalChronoModelFieldIdentifierSync,CR as MinimalChronoModelFieldVariable,sR as MinimalEntityIdentifier,_y as MinimalFieldIdentifierGen,kc as MinimalFieldIdentifierSync,ky as MinimalFieldVariable,mR as MinimalReferenceBucketIdentifier,fR as MinimalReferenceBucketQuark,dR as MinimalReferenceIdentifier,ce as Model,bs as ModelBucketField,cg as ModelCombo,em as ModelDataField,$h as ModelField,nD as ModelLink,ys as ModelReferenceField,tD as ModelStm,ha as Month,Ku as MonthlyRecurrenceIterator,bd as MspExport,MC as MultiPageExporter,IC as MultiPageVerticalExporter,co as NOT_VISITED,jo as NameColumn,Ln as Navigator,As as NestedEvents,FC as NewTaskRendering,ro as NonWorkingTime,Wv as NonWorkingTimeMixin,zg as NoteColumn,Vb as NotesTab,rr as NumberColumn,tm as NumberDataField,zm as NumberField,Rr as NumberFormat,rm as ObjectDataField,T as ObjectHelper,N as Objects,Nr as OnCycleAction,Ta as Orientation,mE as Override,rL as OwnIdentifier,fy as OwnIdentifierSymbol,tL as OwnQuark,gy as OwnQuarkSymbol,bv as PackMixin,Zm as PagingToolbar,wc as Pan,Vt as Panel,Pn as PanelCollapser,Qm as PanelCollapserOverlay,Kl as PaperFormat,md as ParentArea,EE as Parser,TF as PartOfBaseProject,At as PartOfProject,ep as PasswordField,AC as PdfExport,Sg as PercentBar,Xn as PercentColumn,Wg as PercentDoneColumn,fg as PercentDoneMixin,jn as PickerField,Uf as Pluggable,Sr as Point,ht as Popup,Gg as PredecessorColumn,jb as PredecessorsTab,Ha as PresetManager,Nu as PresetStore,Ph as PreviousValueOf,j0 as PreviousValueOfEffect,by as PreviousValueOfSymbol,xb as ProHorizontalLayout,Tb as ProHorizontalLayoutPack,Rb as ProHorizontalLayoutStack,CC as ProgressLine,qb as ProjectChangeHandlerMixin,ry as ProjectCombo,Mg as ProjectConstraintInterval,GT as ProjectConstraintIntervalDescription,Sv as ProjectConsumer,Eb as ProjectCrudManager,JT as ProjectGenerator,SC as ProjectLines,Vo as ProjectModel,mv as ProjectModelCommon,vv as ProjectModelMixin,pv as ProjectModelTimeZoneMixin,Kb as ProjectProgressMixin,di as ProjectType,ST as ProjectWebSocketHandlerMixin,gl as Promissory,fs as ProposedArgumentsOf,G0 as ProposedArgumentsOfEffect,Ey as ProposedArgumentsOfSymbol,Ee as ProposedOrPrevious,uy as ProposedOrPreviousSymbol,et as ProposedOrPreviousValueOf,W0 as ProposedOrPreviousValueOfEffect,wy as ProposedOrPreviousValueOfSymbol,H0 as ProposedValueOf,B0 as ProposedValueOfEffect,Cy as ProposedValueOfSymbol,_h as Quark,J0 as QuarkGen,mo as QuarkSync,Wl as QuickFind,xw as RTL,tp as Radio,hu as RadioGroup,On as RandomGenerator,Ni as RatingColumn,pi as ReadMode,Ab as ReadyStatePropagator,k as Rectangle,Xa as RectangularPathFinder,Fv as RecurrenceCombo,Yp as RecurrenceConfirmationPopup,Gt as RecurrenceDayRuleEncoder,$v as RecurrenceDaysButtonGroup,Lv as RecurrenceDaysCombo,Nv as RecurrenceEditor,Qa as RecurrenceEditorPanel,ds as RecurrenceFrequencyCombo,Tv as RecurrenceLegend,Ov as RecurrenceLegendButton,av as RecurrenceModel,jv as RecurrenceMonthDaysButtonGroup,Bv as RecurrenceMonthsButtonGroup,Vv as RecurrencePositionsCombo,Hv as RecurrenceStopConditionCombo,Oo as RecurrenceTab,w0 as RecurringEventEdit,_x as RecurringEvents,rv as RecurringEventsMixin,Ju as RecurringTimeSpan,tv as RecurringTimeSpansMixin,$y as ReferenceBucketField,jy as ReferenceBucketIdentifier,gR as ReferenceBucketQuark,Oy as ReferenceField,Ly as ReferenceIdentifier,Gl as RegionResize,mi as Reject,ho as RejectEffect,Mc as RejectSymbol,GR as RemoveDateConstraintConflictResolution,AR as RemoveDependencyCycleEffectResolution,lb as RemoveDependencyResolution,Tn as Renderable,Ay as Replica,Sl as ResizeHelper,st as ResizeMonitor,Cb as ResourceAllocationEventRangeCalendar,cT as ResourceAllocationEventRangeCalendarIntervalMixin,dT as ResourceAllocationEventRangeCalendarIntervalStore,ag as ResourceAllocationInfo,Sb as ResourceAllocationInterval,Kg as ResourceAssignmentColumn,aC as ResourceAssignmentGridResourceColumn,c$ as ResourceAssignmentParser,Db as ResourceCalendarColumn,Rv as ResourceCollapseColumn,zv as ResourceCombo,iy as ResourceFilter,Wa as ResourceHeader,Os as ResourceHistogram,lh as ResourceInfoColumn,io as ResourceMenu,of as ResourceModel,Zp as ResourceModelMixin,Ao as ResourceNonWorkingTime,hC as ResourceStore,Xp as ResourceStoreMixin,Vr as ResourceTimeRangeModel,hc as ResourceTimeRangeStore,no as ResourceTimeRanges,os as ResourceTimeRangesBase,$o as ResourceUtilization,Ms as ResourceUtilizationModel,Qc as ResourceUtilizationStore,Bb as ResourcesTab,yk as Responsive,kh as Revision,vm as Ripple,Xg as RollupColumn,DC as Rollups,Kd as Rotatable,Jl as Row,fr as RowCopyPaste,Ul as RowExpander,Pu as RowManager,kl as RowNumberColumn,Et as RowsRange,OR as SEDBackwardCycleResolutionContext,Jy as SEDDispatcher,Qy as SEDDispatcherIdentifier,FR as SEDForwardCycleResolutionContext,Zy as SEDGraphDescription,rT as SEDWUDispatcher,iT as SEDWUDispatcherIdentifier,vu as Scale,Ya as ScaleColumn,Za as ScheduleContext,ph as ScheduleMenu,Ji as ScheduleRange,Xv as ScheduleRangeCombo,Jv as ScheduleTableExporter,Ec as ScheduleTooltip,ab as ScheduledByDependenciesEarlyEventMixin,tC as ScheduledByDependenciesLateEventMixin,ey as Scheduler,zb as SchedulerAdvancedTab,dc as SchedulerAssignmentModel,uc as SchedulerAssignmentStore,pr as SchedulerBase,Yh as SchedulerBasicEvent,NR as SchedulerBasicProjectMixin,Vu as SchedulerCoreEvent,xx as SchedulerCoreProjectMixin,Eh as SchedulerDatePicker,Zi as SchedulerDependencies,hh as SchedulerDependencyEdit,kt as SchedulerDependencyModel,eh as SchedulerDependencyStore,i0 as SchedulerDom,n0 as SchedulerDomEvents,lc as SchedulerEventModel,s0 as SchedulerEventRendering,qa as SchedulerEventResize,cc as SchedulerEventStore,Zv as SchedulerExportDialog,Nb as SchedulerGeneralTab,Dc as SchedulerLabels,Ch as SchedulerMultiPageExporter,Sh as SchedulerMultiPageVerticalExporter,gi as SchedulerPartOfProject,wh as SchedulerPdfExport,Qb as SchedulerPro,Jh as SchedulerProAssignmentMixin,Ci as SchedulerProAssignmentModel,xo as SchedulerProAssignmentStore,fn as SchedulerProBase,ug as SchedulerProCalendarIntervalModel,hg as SchedulerProCalendarManagerStore,Zc as SchedulerProCalendarModel,Cg as SchedulerProCellEdit,Kc as SchedulerProCycleEffect,ed as SchedulerProDependencies,db as SchedulerProDependencyMixin,Ts as SchedulerProDependencyModel,gg as SchedulerProDependencyStore,ig as SchedulerProEvent,DT as SchedulerProEventRendering,eg as SchedulerProHasAssignmentsMixin,lg as SchedulerProProjectMixin,xg as SchedulerProProjectModel,og as SchedulerProResourceMixin,Ro as SchedulerProResourceModel,vg as SchedulerProResourceStore,ad as SchedulerProTaskEdit,Fs as SchedulerProVersions,gv as SchedulerProjectCrudManager,Na as SchedulerProjectModel,l0 as SchedulerRegions,Va as SchedulerResourceModel,Cv as SchedulerResourceRendering,zu as SchedulerResourceStore,o0 as SchedulerScroll,Dh as SchedulerSinglePageExporter,d0 as SchedulerState,Dv as SchedulerStores,Yv as SchedulerSummary,Wb as SchedulerTaskEditor,mc as SchedulerTimeAxisColumn,Us as SchedulingDirectionColumn,Fo as SchedulingDirectionPicker,Oc as SchedulingIssueEffectResolution,Xb as SchedulingIssueResolution,od as SchedulingIssueResolutionPopup,Oe as SchedulingMode,Zg as SchedulingModeColumn,nd as SchedulingModePicker,pR as Schema,cu as ScrollManager,xr as Scroller,xa as Search,Jg as SequenceColumn,Qg as ShowInTimelineColumn,Uv as SimpleEventEdit,PC as SinglePageExporter,ip as SlideToggle,rp as Slider,Ra as Sort,gx as SortedMap,so as Split,Un as Splitter,ef as StartDateColumn,_b as StartDateField,De as StartDateVar,Ld as State,Pi as StateBase,Qs as StateProvider,Js as StateStorage,yg as StateTrackingManager,hp as StickyCells,us as StickyEvents,re as Store,fD as StoreCRUD,xD as StoreChained,mD as StoreChanges,nl as StoreDataField,pD as StoreFilter,vD as StoreGroup,yD as StoreProxy,bD as StoreRelation,DD as StoreSearch,wD as StoreSort,RD as StoreState,PD as StoreStm,CD as StoreSum,MD as StoreSync,TD as StoreTree,$d as StringDataField,O as StringHelper,gp as Stripe,bk as Styleable,ts as SubGrid,tf as SuccessorColumn,$b as SuccessorsTab,wC as Summary,Ah as SynchronousCalculationStarted,gu as Tab,sp as TabBar,ap as TabPanel,Ru as TableExporter,Ho as TaskCopyPaste,uf as TaskDrag,EC as TaskDragCreate,gf as TaskEdit,pc as TaskEditStm,Mv as TaskEditTransactional,hf as TaskEditor,id as TaskEditorBase,ff as TaskMenu,Ys as TaskModel,pM as TaskNavigation,qs as TaskNonWorkingTime,xC as TaskResize,mf as TaskSegmentDrag,pf as TaskSegmentResize,gd as TaskStore,RC as TaskTooltip,ya as TemplateColumn,tr as TemplateHelper,op as TextAreaField,pu as TextAreaPickerField,si as TextField,Gp as TimeAxis,lC as TimeAxisColumn,qv as TimeAxisHeaderMenu,qp as TimeAxisSubGrid,Up as TimeAxisViewModel,Zn as TimeColumn,Ml as TimeField,zn as TimePicker,yh as TimeRanges,bh as TimeSelection,St as TimeSpan,Gb as TimeSpanHighlight,dh as TimeSpanMenuBase,ee as TimeUnit,Mt as TimeZoneHelper,Rx as TimeZonedDatesMixin,eC as Timeline,ns as TimelineBase,Mx as TimelineDateMapper,Ix as TimelineDomEvents,kx as TimelineEventRendering,ao as TimelineHistogram,Qi as TimelineHistogramBase,T0 as TimelineHistogramGrouping,M0 as TimelineHistogramScaleColumn,Fx as TimelineScroll,Lx as TimelineState,vh as TimelineSummary,Px as TimelineViewPresets,Ax as TimelineZoomable,It as Toast,xe as TombStone,In as Tool,wm as Toolable,sa as Toolbar,ve as Tooltip,ls as TooltipBase,rf as TotalSlackColumn,Nd as Transaction,Q0 as TransactionCycleDetectionWalkContext,hy as TransactionSymbol,eR as TransactionWalkDepth,Tr as TransactionalFeature,Ev as TransactionalFeatureMixin,Ui as Tree,Jn as TreeColumn,ka as TreeCombo,_u as TreeGrid,vd as TreeGroup,rD as TreeNode,xh as UndoRedo,du as UndoRedoBase,vt as UnitsVar,iL as UnsafePreviousValueOf,Y0 as UnsafePreviousValueOfEffect,Ry as UnsafePreviousValueOfSymbol,ms as UnsafeProposedOrPreviousValueOf,U0 as UnsafeProposedOrPreviousValueOfEffect,xy as UnsafeProposedOrPreviousValueOfSymbol,mx as UnspecifiedTimeIntervalModel,hl as UpdateAction,TR as Use24hrsEmptyCalendarEffectResolution,MR as Use8hrsEmptyCalendarEffectResolution,gs as VISITED_TOPOLOGICALLY,Ac as Variable,Ty as VariableC,zr as VariableInputState,O0 as VariableWalkContext,Ls as VersionGrid,ne as VersionHelper,To as VersionModel,Mo as VersionStore,yd as Versions,ah as VerticalRendering,oh as VerticalTimeAxisColumn,qi as ViewPreset,oo as ViewPresetCombo,nf as WBSColumn,ly as WalkContext,Rn as WalkHelper,_0 as WalkSource,dy as WalkState,it as Wbs,cf as WbsField,wl as WebSocketManager,_C as WebSocketProjectModel,qu as WeeklyRecurrenceIterator,$ as Widget,oi as WidgetColumn,la as WidgetHelper,L0 as Write,py as WriteEffect,$0 as WriteSeveral,yy as WriteSeveralEffect,vy as WriteSeveralSymbol,my as WriteSymbol,Tm as XMLHelper,Li as YearPicker,Xu as YearlyRecurrenceIterator,nc as binarySearch,hR as bucket,oR as build_proposed,ie as calculate,WR as calculateEffectiveEndDateConstraintInterval,zR as calculateEffectiveStartDateConstraintInterval,gF as combineCalendars,Fy as createEntityOnPrototype,k0 as cycleInfo,vi as dateConverter,vx as delay,Xt as durationFormula,bi as effortFormula,un as endDateByEffortFormula,Kt as endDateFormula,vs as ensureEntityOnPrototype,uL as entity,By as entityDecoratorBody,me as field,bb as fixedDurationAndEffortSEDWUGraphDescription,oT as fixedDurationSEDWUBackwardEffortDriven,aT as fixedDurationSEDWUBackwardNonEffortDriven,sT as fixedDurationSEDWUForwardEffortDriven,nT as fixedDurationSEDWUForwardNonEffortDriven,yb as fixedDurationSEDWUGraphDescription,FT as fixedEffortSEDWUBackward,kT as fixedEffortSEDWUForward,rC as fixedEffortSEDWUGraphDescription,BT as fixedUnitsSEDWUBackwardEffortDriven,jT as fixedUnitsSEDWUBackwardNonEffortDriven,$T as fixedUnitsSEDWUForwardEffortDriven,LT as fixedUnitsSEDWUForwardNonEffortDriven,cd as fixedUnitsSEDWUGraphDescription,mr as format,Ut as generic_field,SR as getDecoratedModelFields,Hh as injectStaticFieldsProperty,nn as intersectIntervals,hs as isAtomicValue,ui as isDateFinite,ic as isEqualEffectiveDirection,px as isNotNumber,rn as isSerializableEqual,wp as later,de as model_field,pe as prototypeValue,cR as reference,P0 as required,Ic as runGeneratorAsyncWithEffect,Z0 as runGeneratorSyncWithEffect,hn as startDateByEffortFormula,qt as startDateFormula,Oa as stripDuplicates,Ir as throwUnknownIdentifier,dr as unitMagnitudes,dn as unitsFormula,A0 as validateRequiredProperties,br as write};
//# sourceMappingURL=gantt.module.min.js.map
