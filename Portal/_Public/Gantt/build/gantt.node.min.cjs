var As=Object.defineProperty,Ug=Object.getOwnPropertyDescriptor,Wg=Object.getOwnPropertyNames,zg=Object.prototype.hasOwnProperty,qg=(e,n,t)=>n in e?As(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Gg=(e,n)=>{for(var t in n)As(e,t,{get:n[t],enumerable:!0})},Hg=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of Wg(n))!zg.call(e,r)&&r!==t&&As(e,r,{get:()=>n[r],enumerable:!(s=Ug(n,r))||s.enumerable});return e},Yg=e=>Hg(As({},"__esModule",{value:!0}),e),F=(e,n,t)=>(qg(e,typeof n!="symbol"?n+"":n,t),t),Ec={};Gg(Ec,{AbstractAssignmentStoreMixin:()=>nl,AbstractCalendarManagerStoreMixin:()=>il,AbstractCalendarMixin:()=>jo,AbstractCrudManager:()=>Cg,AbstractCrudManagerMixin:()=>Nl,AbstractCrudManagerValidation:()=>yg,AbstractDependencyStoreMixin:()=>ol,AbstractEventStoreMixin:()=>Ho,AbstractHasAssignmentsMixin:()=>zo,AbstractPartOfProjectGenericMixin:()=>zn,AbstractPartOfProjectModelMixin:()=>cn,AbstractPartOfProjectStoreMixin:()=>mt,AbstractResourceStoreMixin:()=>cl,ActionBase:()=>Ht,AjaxStore:()=>We,AjaxTransport:()=>Eg,AssignmentAllocationInterval:()=>Wf,AssignmentModel:()=>oa,AssignmentModelMixin:()=>Ql,AssignmentStore:()=>pc,AssignmentStoreMixin:()=>Zl,Base:()=>$,BaseAllocationInfo:()=>$i,BaseAllocationInterval:()=>Ai,BaseAssignmentMixin:()=>Ei,BaseCalendarMixin:()=>hn,BaseDependencyMixin:()=>dl,BaseDependencyResolution:()=>gl,BaseEmptyCalendarEffectResolution:()=>Lo,BaseEventMixin:()=>or,BaseHasAssignmentsMixin:()=>qo,BaseResourceMixin:()=>bi,Baseline:()=>da,BreakCurrentStackExecution:()=>Gr,CI:()=>Me,CIFromSetOrArrayOrValue:()=>yo,CalculateProposed:()=>Ne,CalculatedValueGen:()=>Mt,CalculatedValueGenC:()=>La,CalculatedValueSync:()=>Xr,CalculatedValueSyncC:()=>ka,CalculationGen:()=>qc,CalculationSync:()=>Gc,CalendarCache:()=>_o,CalendarCacheInterval:()=>di,CalendarCacheIntervalMultiple:()=>Uo,CalendarCacheMultiple:()=>Wo,CalendarCacheSingle:()=>gh,CalendarIntervalMixin:()=>Qn,CalendarIntervalModel:()=>Ng,CalendarIntervalStore:()=>$o,CalendarIteratorResult:()=>Ve,CalendarManagerStore:()=>mc,CalendarModel:()=>la,CanCombineCalendarsMixin:()=>Eh,ChangeLogEntity:()=>Bl,ChronoAbstractProjectMixin:()=>yf,ChronoAssignmentStoreMixin:()=>sl,ChronoCalendarManagerStoreMixin:()=>al,ChronoDependencyStoreMixin:()=>ll,ChronoEventStoreMixin:()=>rs,ChronoEventTreeStoreMixin:()=>Yo,ChronoField:()=>en,ChronoGraph:()=>eu,ChronoMixinBase:()=>de,ChronoModelFieldIdentifier:()=>an,ChronoModelMixin:()=>ii,ChronoModelReferenceBucketFieldIdentifier:()=>ti,ChronoModelReferenceFieldIdentifier:()=>Nn,ChronoModelReferenceFieldQuark:()=>ld,ChronoPartOfProjectGenericMixin:()=>Ro,ChronoPartOfProjectModelMixin:()=>un,ChronoPartOfProjectStoreMixin:()=>_r,ChronoResourceStoreMixin:()=>ul,ChronoStoreMixin:()=>oh,ChronoTransaction:()=>Ba,Collection:()=>ln,CollectionFilter:()=>ke,CollectionSorter:()=>Yn,CommitZero:()=>zs,ComputationCycle:()=>Ws,ConflictEffect:()=>cr,ConflictEffectDescription:()=>Ih,ConflictResolution:()=>mi,ConflictSymbol:()=>Jo,ConstrainedByParentMixin:()=>Gf,ConstrainedEarlyEventMixin:()=>Lr,ConstrainedLateEventMixin:()=>ji,ConstraintInterval:()=>ur,ConstraintIntervalDescription:()=>fn,ConstraintIntervalSide:()=>ce,ConstraintType:()=>N,ContextGen:()=>Cp,ContextSync:()=>Dp,CoreAssignmentMixin:()=>Ni,CoreAssignmentStoreMixin:()=>_l,CoreCalendarManagerStoreMixin:()=>cg,CoreCalendarMixin:()=>Fl,CoreDependencyMixin:()=>Vi,CoreDependencyStoreMixin:()=>jl,CoreEventMixin:()=>Kt,CoreEventStoreMixin:()=>kl,CoreHasAssignmentsMixin:()=>dg,CoreHasDependenciesMixin:()=>hg,CorePartOfProjectGenericMixin:()=>Li,CorePartOfProjectModelMixin:()=>yn,CorePartOfProjectStoreMixin:()=>Dn,CoreResourceMixin:()=>Sn,CoreResourceStoreMixin:()=>Ll,CoreStateTrackingManager:()=>kr,CycleDescription:()=>Xt,CycleEffect:()=>jr,CycleEffectDescription:()=>xh,CycleResolution:()=>Fe,CycleResolutionInput:()=>qa,CycleResolutionInputChrono:()=>Sh,CycleSymbol:()=>Zo,DataField:()=>it,DateConstraintInterval:()=>as,DateConstraintIntervalDescription:()=>Rf,DateInterval:()=>pi,DeactivateDependencyCycleEffectResolution:()=>zf,DeactivateDependencyResolution:()=>ml,Delayable:()=>Ar,DelayableWrapper:()=>fg,DependenciesCalendar:()=>Mr,DependencyBaseModel:()=>St,DependencyConstraintInterval:()=>pn,DependencyConstraintIntervalDescription:()=>If,DependencyModel:()=>ca,DependencyStore:()=>vc,DependencyStoreMixin:()=>oc,DependencyType:()=>_e,DependencyValidationResult:()=>wr,Direction:()=>L,DisableManuallyScheduledConflictResolution:()=>Hf,DomClassList:()=>Ue,DomDataStore:()=>mg,Duration:()=>xe,DurationConverterMixin:()=>pf,DurationVar:()=>te,EMPTY_INTERVAL:()=>Rh,EarlyLateLazyness:()=>Ee,EdgeInclusion:()=>At,EdgeType:()=>Jr,EdgeTypeNormal:()=>An,EdgeTypePast:()=>Ir,Effect:()=>ye,EffectResolutionResult:()=>bt,EffortVar:()=>Pe,EmptyCalendarEffect:()=>ts,EmptyCalendarEffectDescription:()=>mh,EmptyCalendarSymbol:()=>ko,EndDateVar:()=>Q,EngineReplica:()=>wh,EngineRevision:()=>Xo,EngineTransaction:()=>Ph,Entity:()=>xt,EntityIdentifier:()=>ru,EntityMeta:()=>tu,EventModel:()=>Ps,EventModelMixin:()=>Qi,EventSegmentModel:()=>sa,EventStore:()=>ia,EventStoreMixin:()=>Xl,Events:()=>Vt,FieldIdentifier:()=>ut,FixedDurationMixin:()=>Nf,FixedEffortMixin:()=>Qf,FixedUnitsMixin:()=>rg,Formula:()=>fe,FormulasCache:()=>qs,GanttEvent:()=>Al,GanttProjectMixin:()=>ag,GetEventsMixin:()=>Yi,GetTransaction:()=>lp,GridRowModel:()=>vs,HasCalendarMixin:()=>fi,HasChildrenMixin:()=>Gt,HasCriticalPathsMixin:()=>ig,HasDateConstraintMixin:()=>hl,HasDependenciesMixin:()=>Go,HasEffortMixin:()=>Ti,HasPercentDoneMixin:()=>yl,HasProposedNotPreviousValue:()=>jc,HasProposedNotPreviousValueEffect:()=>Fc,HasProposedNotPreviousValueSymbol:()=>Ma,HasProposedValue:()=>ct,HasProposedValueEffect:()=>_c,HasProposedValueSymbol:()=>wa,HasSchedulingModeMixin:()=>ds,HasSubEventsMixin:()=>vi,Identifier:()=>rt,IdentifierC:()=>Rp,IndexPosition:()=>Fr,Instruction:()=>Ke,IntervalCache:()=>Fo,IsChronoModelSymbol:()=>ei,JsonEncoder:()=>bg,Levels:()=>wt,Listener:()=>Xc,MAX_DATE:()=>ae,MI:()=>Mc,MIN_DATE:()=>he,ManuallyScheduledParentConstraintInterval:()=>gs,ManuallyScheduledParentConstraintIntervalDescription:()=>Yf,Meta:()=>Tn,MinimalChronoModelFieldIdentifierGen:()=>ud,MinimalChronoModelFieldIdentifierSync:()=>cd,MinimalChronoModelFieldVariable:()=>dd,MinimalEntityIdentifier:()=>nu,MinimalFieldIdentifierGen:()=>Va,MinimalFieldIdentifierSync:()=>$n,MinimalFieldVariable:()=>Ua,MinimalReferenceBucketIdentifier:()=>od,MinimalReferenceBucketQuark:()=>ad,MinimalReferenceIdentifier:()=>rd,Model:()=>H,ModelBucketField:()=>Or,ModelField:()=>Xs,ModelLink:()=>Ed,ModelReferenceField:()=>Tr,ModelStm:()=>Sd,NOT_VISITED:()=>Kr,OnCycleAction:()=>Pt,OwnIdentifier:()=>up,OwnIdentifierSymbol:()=>Da,OwnQuark:()=>cp,OwnQuarkSymbol:()=>Sa,PartOfProject:()=>tt,PercentDoneMixin:()=>na,PreviousValueOf:()=>js,PreviousValueOfEffect:()=>Oc,PreviousValueOfSymbol:()=>Ia,ProjectChangeHandlerMixin:()=>fc,ProjectConstraintInterval:()=>ki,ProjectConstraintIntervalDescription:()=>og,ProjectCrudManager:()=>dc,ProjectModel:()=>fa,ProjectModelMixin:()=>uc,ProjectModelTimeZoneMixin:()=>cc,ProjectType:()=>tn,ProposedArgumentsOf:()=>Er,ProposedArgumentsOfEffect:()=>Lc,ProposedArgumentsOfSymbol:()=>Ta,ProposedOrPrevious:()=>X,ProposedOrPreviousSymbol:()=>va,ProposedOrPreviousValueOf:()=>pe,ProposedOrPreviousValueOfEffect:()=>kc,ProposedOrPreviousValueOfSymbol:()=>xa,ProposedValueOf:()=>$c,ProposedValueOfEffect:()=>Ac,ProposedValueOfSymbol:()=>Pa,Quark:()=>Vs,QuarkGen:()=>Jc,QuarkSync:()=>Zr,ReadMode:()=>Lt,RecurrenceModel:()=>Kl,RecurringEventsMixin:()=>nc,RecurringTimeSpan:()=>qi,RecurringTimeSpansMixin:()=>Jl,ReferenceBucketField:()=>mo,ReferenceBucketIdentifier:()=>vo,ReferenceBucketQuark:()=>id,ReferenceField:()=>go,ReferenceIdentifier:()=>po,Reject:()=>kt,RejectEffect:()=>Hr,RejectSymbol:()=>Pn,RemoveDateConstraintConflictResolution:()=>bf,RemoveDependencyCycleEffectResolution:()=>Mh,RemoveDependencyResolution:()=>pl,Replica:()=>Na,ResourceAllocationEventRangeCalendar:()=>wl,ResourceAllocationEventRangeCalendarIntervalMixin:()=>Vf,ResourceAllocationEventRangeCalendarIntervalStore:()=>Uf,ResourceAllocationInfo:()=>_i,ResourceAllocationInterval:()=>Ml,ResourceModel:()=>ua,ResourceModelMixin:()=>ic,ResourceStore:()=>yc,ResourceStoreMixin:()=>sc,ResourceTimeRangeModel:()=>Sr,ResourceTimeRangeStore:()=>Gi,Revision:()=>Us,SEDBackwardCycleResolutionContext:()=>Ch,SEDDispatcher:()=>No,SEDDispatcherIdentifier:()=>Vo,SEDForwardCycleResolutionContext:()=>Dh,SEDGraphDescription:()=>Bo,SEDWUDispatcher:()=>_f,SEDWUDispatcherIdentifier:()=>Ff,ScheduledByDependenciesEarlyEventMixin:()=>fl,ScheduledByDependenciesLateEventMixin:()=>Tl,SchedulerAssignmentModel:()=>Ss,SchedulerAssignmentStore:()=>Hi,SchedulerBasicEvent:()=>gi,SchedulerBasicProjectMixin:()=>Df,SchedulerCoreEvent:()=>Ui,SchedulerCoreProjectMixin:()=>gg,SchedulerDependencyModel:()=>Cs,SchedulerDependencyStore:()=>lc,SchedulerEventModel:()=>Ds,SchedulerEventStore:()=>Zi,SchedulerPartOfProject:()=>Jt,SchedulerProAssignmentMixin:()=>Pi,SchedulerProAssignmentModel:()=>zr,SchedulerProAssignmentStore:()=>bs,SchedulerProCalendarIntervalModel:()=>ea,SchedulerProCalendarManagerStore:()=>ta,SchedulerProCalendarModel:()=>Rs,SchedulerProCycleEffect:()=>fs,SchedulerProDependencyMixin:()=>vl,SchedulerProDependencyModel:()=>Is,SchedulerProDependencyStore:()=>ra,SchedulerProEvent:()=>Oi,SchedulerProHasAssignmentsMixin:()=>Mi,SchedulerProProjectMixin:()=>xl,SchedulerProProjectModel:()=>Lg,SchedulerProResourceMixin:()=>Fi,SchedulerProResourceModel:()=>ws,SchedulerProResourceStore:()=>aa,SchedulerProjectCrudManager:()=>$g,SchedulerProjectModel:()=>Xi,SchedulerResourceModel:()=>Cn,SchedulerResourceStore:()=>ac,SchedulingIssueEffectResolution:()=>Vn,SchedulingMode:()=>me,Schema:()=>Oh,SortedMap:()=>ch,StartDateVar:()=>J,StateBase:()=>dr,StateTrackingManager:()=>kr,Store:()=>K,StoreCRUD:()=>qd,StoreChained:()=>th,StoreChanges:()=>Gd,StoreFilter:()=>Hd,StoreGroup:()=>Yd,StoreRelation:()=>Kd,StoreSearch:()=>Zd,StoreSort:()=>Xd,StoreState:()=>rh,StoreStm:()=>ah,StoreSum:()=>Jd,StoreSync:()=>sh,StoreTree:()=>nh,SynchronousCalculationStarted:()=>Ns,TaskModel:()=>En,TaskStore:()=>xs,TimeSpan:()=>lt,TimeUnit:()=>V,TimeZonedDatesMixin:()=>Rg,TombStone:()=>ee,Transaction:()=>Si,TransactionCycleDetectionWalkContext:()=>Qc,TransactionSymbol:()=>ya,TransactionWalkDepth:()=>Zc,TreeNode:()=>Dd,UnitsVar:()=>we,UnsafePreviousValueOf:()=>dp,UnsafePreviousValueOfEffect:()=>Nc,UnsafePreviousValueOfSymbol:()=>Aa,UnsafeProposedOrPreviousValueOf:()=>br,UnsafeProposedOrPreviousValueOfEffect:()=>Bc,UnsafeProposedOrPreviousValueOfSymbol:()=>Oa,UnspecifiedTimeIntervalModel:()=>ph,Use24hrsEmptyCalendarEffectResolution:()=>vh,Use8hrsEmptyCalendarEffectResolution:()=>yh,VISITED_TOPOLOGICALLY:()=>Rr,Variable:()=>On,VariableC:()=>ja,VariableInputState:()=>Tt,VariableWalkContext:()=>cu,WalkContext:()=>Fa,WalkSource:()=>Yc,WalkState:()=>Ga,Wbs:()=>De,WbsField:()=>ha,Write:()=>xc,WriteEffect:()=>Ea,WriteSeveral:()=>Tc,WriteSeveralEffect:()=>Ra,WriteSeveralSymbol:()=>ba,WriteSymbol:()=>Ca,binarySearch:()=>Zn,bucket:()=>sd,build_proposed:()=>iu,calculate:()=>j,calculateEffectiveEndDateConstraintInterval:()=>Ef,calculateEffectiveStartDateConstraintInterval:()=>Cf,combineCalendars:()=>uv,createEntityOnPrototype:()=>Wa,cycleInfo:()=>Kc,dateConverter:()=>zt,delay:()=>pd,durationFormula:()=>Ze,effortFormula:()=>Yt,endDateByEffortFormula:()=>mr,endDateFormula:()=>Qe,ensureEntityOnPrototype:()=>Pr,entity:()=>gv,entityDecoratorBody:()=>el,field:()=>q,fixedDurationAndEffortSEDWUGraphDescription:()=>Pl,fixedDurationSEDWUBackwardEffortDriven:()=>Bf,fixedDurationSEDWUBackwardNonEffortDriven:()=>Lf,fixedDurationSEDWUForwardEffortDriven:()=>kf,fixedDurationSEDWUForwardNonEffortDriven:()=>jf,fixedDurationSEDWUGraphDescription:()=>Il,fixedEffortSEDWUBackward:()=>Jf,fixedEffortSEDWUForward:()=>Kf,fixedEffortSEDWUGraphDescription:()=>Ol,fixedUnitsSEDWUBackwardEffortDriven:()=>tg,fixedUnitsSEDWUBackwardNonEffortDriven:()=>eg,fixedUnitsSEDWUForwardEffortDriven:()=>Xf,fixedUnitsSEDWUForwardNonEffortDriven:()=>Zf,fixedUnitsSEDWUGraphDescription:()=>ps,format:()=>pt,generic_field:()=>qe,getDecoratedModelFields:()=>hd,injectStaticFieldsProperty:()=>ri,intersectIntervals:()=>lr,isAtomicValue:()=>Cr,isDateFinite:()=>Bt,isEqualEffectiveDirection:()=>_n,isNotNumber:()=>gd,isSerializableEqual:()=>ar,later:()=>Ao,model_field:()=>B,prototypeValue:()=>G,reference:()=>td,required:()=>au,runGeneratorAsyncWithEffect:()=>xn,runGeneratorSyncWithEffect:()=>Hc,startDateByEffortFormula:()=>vr,startDateFormula:()=>Je,stripDuplicates:()=>dn,throwUnknownIdentifier:()=>Ct,unitsFormula:()=>pr,validateRequiredProperties:()=>ou,write:()=>dt}),module.exports=Yg(Ec);var de=class{initialize(e){e&&Object.assign(this,e)}static new(e){const n=new this;return n.initialize(e),n}};function bc(e){const n=[],t=[];let s;const r=function*(){for(s||(s=e[Symbol.iterator]());n.length&&(yield*n,n.length=0),!!s;){const{value:a,done:o}=s.next();if(o){s=null,e=null;break}t.push(a),yield a}},i=function*(){for(s||(s=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),!!s;){const{value:a,done:o}=s.next();if(o){s=null,e=null;break}n.push(a),yield a}};return[r(),i()]}function*Kg(e,n){if(n<0)throw new Error("Batch size needs to a natural number");n=n|0;const t=[];for(const s of e)t.length===n&&(yield t,t.length=0),t.push(s);t.length>0&&(yield t)}function*Jg(e,n){let t=0;for(const s of e)n(s,t++)&&(yield s)}function*Qg(e,n){let t=0;for(const s of e)++t>n&&(yield s)}function Zg(e,n){let t=0;for(const s of e)if(!n(s,t++))return!1;return!0}function Xg(e,n){let t=0;for(const s of e)if(n(s,t++))return!0;return!1}function*$s(e,n){let t=0;for(const s of e)yield n(s,t++)}function ep(e,n,t){let s=0,r=t;for(const i of e)r=n(r,i,s++);return r}function*Rc(e){const n=new Set;for(const t of e)n.has(t)||(n.add(t),yield t)}function*tp(e,n){const t=new Set;for(const s of e){const r=n(s);t.has(r)||(t.add(r),yield s)}}function*rp(e,n){let t=0;for(const s of e)if(n(s,t++))yield s;else return}function*Ic(...e){for(let n=0;n<e.length;n++)yield*e[n]}function*Pc(e){for(const n of e)yield*n}var qr=class{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new qr(e)}copy(){const[e,n]=bc(this.iterable);return this.iterable=n,new qr(e)}split(){const[e,n]=bc(this.iterable);return[new qr(e),this.derive(n)]}inBatchesBySize(e){return this.derive(Kg(this.iterable,e))}filter(e){return this.derive(Jg(this.iterable,e))}drop(e){return this.derive(Qg(this.iterable,e))}map(e){return this.derive($s(this.iterable,e))}reduce(e,n){return ep(this,e,n)}concat(){return this.derive(Pc(this.iterable))}uniqueOnly(){return this.derive(Rc(this.iterable))}uniqueOnlyBy(e){return this.derive(tp(this.iterable,e))}every(e){return Zg(this,e)}some(e){return Xg(this,e)}takeWhile(e){return this.derive(rp(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new wc(this)}},np=e=>new qr(e),Me=np,wc=class extends qr{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new qr(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let n=this.$iterator,t=e.length;for(t>0&&(yield*e);;){if(e.length>t){for(let i=t;i<e.length;i++)yield e[i];t=e.length}if(!n)break;const{value:s,done:r}=n.next();r?(n=this.$iterator=null,this.$iterable=null):(e.push(s),t++,yield s)}}else yield*e}},sp=e=>new wc(e),Mc=sp,ip=-Math.pow(2,30),Zt=Math.pow(2,30)-1,ga=e=>e.slice(0,1).toUpperCase()+e.slice(1),Cr=e=>Object(e)!==e,_s=(e,n,t)=>(Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0}),t),G=e=>function(n,t){n[t]=e},ap=(e,n)=>{for(const t of e)n.add(t);return n},Rn=e=>new Promise(n=>setTimeout(n,e)),op=function*(e,n){let t;for(;(t=e.exec(n))!==null;)yield t},pa=null,ma=function(e){return pa===null&&(pa=typeof regeneratorRuntime!="undefined"),pa===!0?regeneratorRuntime.isGeneratorFunction(e):e.constructor.name==="GeneratorFunction"},Fs=function(e){return e&&typeof e.then=="function"},In=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Gr=Symbol("BreakCurrentStackExecution"),ye=class extends de{};In([G(!0)],ye.prototype,"sync",void 0),In([G(!0)],ye.prototype,"pure",void 0);var va=Symbol("ProposedOrPreviousSymbol"),X=ye.new({handler:va}),Pn=Symbol("RejectSymbol"),Hr=class extends ye{constructor(){super(...arguments),this.handler=Pn}};In([G(!1)],Hr.prototype,"pure",void 0);var kt=e=>Hr.new({reason:e}),ya=Symbol("TransactionSymbol"),lp=ye.new({handler:ya}),Sa=Symbol("OwnQuarkSymbol"),cp=ye.new({handler:Sa}),Da=Symbol("OwnIdentifierSymbol"),up=ye.new({handler:Da}),Ca=Symbol("WriteSymbol"),Ea=class extends ye{constructor(){super(...arguments),this.handler=Ca}};In([G(!1)],Ea.prototype,"pure",void 0);var xc=(e,n,...t)=>Ea.new({identifier:e,proposedArgs:[n,...t]}),ba=Symbol("WriteSeveralSymbol"),Ra=class extends ye{constructor(){super(...arguments),this.handler=ba}};In([G(!1)],Ra.prototype,"pure",void 0);var Tc=e=>Ra.new({writes:e}),Ia=Symbol("PreviousValueOfSymbol"),Oc=class extends ye{constructor(){super(...arguments),this.handler=Ia}},js=e=>Oc.new({identifier:e}),Pa=Symbol("ProposedValueOfSymbol"),Ac=class extends ye{constructor(){super(...arguments),this.handler=Pa}},$c=e=>Ac.new({identifier:e}),wa=Symbol("HasProposedValueSymbol"),_c=class extends ye{constructor(){super(...arguments),this.handler=wa}},ct=e=>_c.new({identifier:e}),Ma=Symbol("HasProposedNotPreviousValueSymbol"),Fc=class extends ye{constructor(){super(...arguments),this.handler=Ma}},jc=e=>Fc.new({identifier:e}),xa=Symbol("ProposedOrPreviousValueOfSymbol"),kc=class extends ye{constructor(){super(...arguments),this.handler=xa}},pe=e=>kc.new({identifier:e}),Ta=Symbol("ProposedArgumentsOfSymbol"),Lc=class extends ye{constructor(){super(...arguments),this.handler=Ta}},Er=e=>Lc.new({identifier:e}),Oa=Symbol("UnsafeProposedOrPreviousValueOfSymbol"),Bc=class extends ye{constructor(){super(...arguments),this.handler=Oa}},br=e=>Bc.new({identifier:e}),Aa=Symbol("UnsafePreviousValueOfSymbol"),Nc=class extends ye{constructor(){super(...arguments),this.handler=Aa}},dp=e=>Nc.new({identifier:e}),ks=Symbol("MixinIdentity"),wn=Symbol("MixinStateProperty"),hp=class{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=Mc(this.linearizedByTopoLevels())}static new(e){const n=new this;return e&&Object.assign(n,e),n}get topoLevels(){return this.$topoLevels!==void 0?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort((e,n)=>e-n)}get elementsByTopoLevel(){return this.$elementsByTopoLevel!==void 0?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,n){let t=e.get(n);return t||(t=[],e.set(n,t)),t}buildElementsByTopoLevel(){let e=0;const n=this.baseEl?Me(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,t=Me(this.sourceEl.requirements).map(s=>s.walkDepthState.elementsByTopoLevel).concat().reduce((s,[r,i])=>(r>e&&(e=r),this.getOrCreateLevel(s,r).push(i),s),new Map);return this.getOrCreateLevel(t,e+1).push([this.sourceEl]),Me(t).map(([s,r])=>[s,Me(r).concat().uniqueOnly().filter(i=>!n.has(i)).sort((i,a)=>i.id-a.id)]).toMap()}*linearizedByTopoLevels(){yield*Me(this.topoLevels).map(e=>this.elementsByTopoLevel.get(e)).concat()}},Vc=1,fp=e=>class extends e{},Ls=class{},$a=class{constructor(){this.id=Vc++,this.requirements=[],this.baseClass=Ls,this.identitySymbol=void 0,this.mixinLambda=fp,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(e){const n=new this;e&&Object.assign(n,e),n.walkDepthState=hp.new({sourceEl:n,baseEl:pp(n.baseClass)});const t=n.mixinLambda,s=n.identitySymbol=Symbol(t.name),r=Object.assign(function(i){const a=t(i);return a.prototype[s]=!0,a},{[ks]:s,[wn]:n});return Object.defineProperty(r,Symbol.hasInstance,{value:Wc}),n.mixinLambda=r,n}get minimalClass(){return this.$minimalClass!==void 0?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const n=this.constructor,t=n.baseClassesIds.get(e);if(t!==void 0)return t;const s=Vc++;return n.baseClassesIds.set(e,s),s}buildMinimalClass(){const e=this.constructor;let n=this.baseClass;const t=this.walkDepthState.linearizedByTopoLevelsSource.reduce((r,i)=>{const{cls:a,hash:o}=r,l=o+String.fromCharCode(i.id);let c=e.minimalClassesByLinearHash.get(l);return c||(c=i.mixinLambda(a),i.name=c.name,e.minimalClassesByLinearHash.set(l,c)),r.cls=c,r.hash=l,r},{cls:n,hash:String.fromCharCode(this.getBaseClassMixinId(n))}).cls,s=Object.assign(t,{[ks]:this.identitySymbol,[wn]:this,mix:this.mixinLambda,derive:r=>O([s,r],i=>class extends i{}),$:this,toString:this.toString.bind(this)});return Object.defineProperty(s,Symbol.hasInstance,{value:Wc}),s}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce((e,n)=>`${n.name}(${e})`,this.baseClass.name)}};$a.minimalClassesByLinearHash=new Map,$a.baseClassesIds=new Map;var gp=e=>Object.getPrototypeOf(e.prototype).constructor.hasOwnProperty(wn),pp=e=>Object.getPrototypeOf(e.prototype).constructor[wn],Uc=(e,n)=>{let t;if(e.length>0){const i=e[e.length-1];!gp(i)&&i!==Ls&&(t=i)}const s=[];return e.forEach((i,a)=>{const o=i[wn];if(o!==void 0){const l=o.baseClass;if(l!==Ls)if(t){if(t!==l){const c=l.prototype.isPrototypeOf(t.prototype),u=t.prototype.isPrototypeOf(l.prototype);if(!c&&!u)throw new Error("Base class mismatch");t=u?l:t}}else t=l;s.push(o)}else if(a!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}),$a.new({requirements:s,mixinLambda:n,baseClass:t||Ls}).minimalClass},Wc=function(e){return!!(e&&e[this[ks]])},ze=(e,n)=>!!(e&&e[n[ks]]),O=Uc,_a=Uc,Yr=!1,mp=(...e)=>{},Bs=e=>Yr?e:mp,vp=Bs(e=>{debugger}),Mn=Bs(e=>{typeof console!="undefined"&&console.warn(e)}),yp=class extends de{},zc=class extends de{constructor(){super(...arguments),this.stackEntries=[]}static fromError(e){return zc.new({exception:e,stackEntries:Sp(e.stack)})}static fromThisCall(){const e=this.fromError(new Error);return e.stackEntries.splice(0,2),e}},Sp=e=>Me(op(/^   +at\s*(.*?)\s*\((https?:\/\/.*?):(\d+):(\d+)/gm,e)).map(n=>yp.new({statement:n[1],sourceFile:n[2],sourceLine:Number(n[3]),sourceCharPos:Number(n[4])})).toArray(),Dp=Symbol("ContextSync"),Cp=Symbol("ContextGen"),qc=class extends O([],e=>class extends e{constructor(){super(...arguments),this.iterator=void 0,this.iterationResult=void 0}isCalculationStarted(){return!!(this.iterator||this.iterationResult)}isCalculationCompleted(){return!!(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(t,...s){const r=this.iterator=this.calculation.call(this.context||this,t,...s);return this.iterationResult=r.next()}continueCalculation(t){return this.iterationResult=this.iterator.next(t)}cleanupCalculation(){this.iterationResult=void 0,this.iterator=void 0}*calculation(t,...s){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(t,...s){for(this.startCalculation(t,...s);!this.isCalculationCompleted();)this.continueCalculation(t(this.iterationResult.value));return this.iterator=void 0,this.result}async runAsyncWithEffect(t,...s){for(this.startCalculation(t,...s);!this.isCalculationCompleted();)this.continueCalculation(await t(this.iterationResult.value));return this.iterator=void 0,this.result}}){},Ns=Symbol("SynchronousCalculationStarted"),Ep={value:Ns},Gc=class extends O([],e=>class extends e{constructor(){super(...arguments),this.iterationResult=void 0}isCalculationStarted(){return!!this.iterationResult}isCalculationCompleted(){return!!(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(t,...s){return this.iterationResult=Ep,this.iterationResult={done:!0,value:this.calculation.call(this.context||this,t,...s)}}continueCalculation(t){throw new Error("Can not continue synchronous calculation")}cleanupCalculation(){this.iterationResult=void 0}calculation(t,...s){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(t,...s){return this.startCalculation(t,...s),this.result}async runAsyncWithEffect(t,...s){throw new Error("Can not run synchronous calculation asynchronously")}}){};function Hc(e,n,t,s){const r=n.apply(s||null,t);let i=r.next();for(;!i.done;)i=r.next(e(i.value));return i.value}async function xn(e,n,t,s){const r=n.apply(s||null,t);let i=r.next();for(;!i.done;){let a,o=!1;do{o=!1;try{a=e(i.value)}catch(l){if(l instanceof ye)if(await e(l)==="Cancel"){e(kt(l));return}else o=!0}}while(o);Fs(a)?i=r.next(await a):i=r.next(a)}return i.value}var Pt;(function(e){e.Cancel="Cancel",e.Resume="Resume"})(Pt||(Pt={}));var Yc=Symbol("WalkSource"),Kr=-1,Rr=-2,Fa=class extends de{constructor(){super(...arguments),this.visited=new Map,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e.map(n=>({node:n,from:Yc,label:void 0}))),this.walkDepth()}onNode(e,n){}onTopologicalNode(e){}onCycle(e,n){return Pt.Cancel}forEachNext(e,n){throw new Error("Abstract method called")}collectNext(e,n,t){throw new Error("Abstract method called")}getVisitedInfo(e){return this.visited.get(e)}setVisitedInfo(e,n,t){return t?(t.visitedAt=n,t.visitEpoch=this.currentEpoch):(t={visitedAt:n,visitEpoch:this.currentEpoch},this.visited.set(e,t)),t}walkDepth(){const e=this.visited,n=this.toVisit;let t;for(;t=n.length;){const s=n[t-1].node,r=this.getVisitedInfo(s);if(r&&r.visitedAt===Rr&&r.visitEpoch===this.currentEpoch){n.pop();continue}if(r&&r.visitEpoch===this.currentEpoch&&r.visitedAt!==Kr){if(r.visitedAt<t){if(this.onCycle(s,n)!==Pt.Resume)break}else r.visitedAt=Rr,this.onTopologicalNode(s);n.pop()}else{if(this.onNode(s,n[t-1])===!1)break;const i=this.setVisitedInfo(s,t,r),a=n.length;this.collectNext(s,n,i),n.length===a&&(i.visitedAt=Rr,this.onTopologicalNode(s),n.pop())}}}};function Kc(e){const n=e.length;if(n===0)return[];const t=e[n-1].node,s=[t];let r=n-1,i=r;for(;r>=0&&e[r].from!==t;){for(;r>=0&&e[r].from===e[i].from;)r--;r>=0&&(s.push(e[r].node),i=r)}return r<0?[]:(s.push(t),s.reverse())}var Jr;(function(e){e[e.Normal=1]="Normal",e[e.Past=2]="Past"})(Jr||(Jr={}));var bp=0,Vs=class extends _a([Map],e=>class extends e{constructor(){super(...arguments),this.createdAt=void 0,this.identifier=void 0,this.value=void 0,this.proposedValue=void 0,this.proposedIsPrevious=!1,this.proposedArguments=void 0,this.usedProposedOrPrevious=!1,this.previous=void 0,this.origin=void 0,this.originId=ip,this.needToBuildProposedValue=!1,this.edgesFlow=0,this.visitedAt=Kr,this.visitEpoch=0,this.promise=void 0,this.$outgoingPast=void 0}static new(t){const s=new this;return t&&Object.assign(s,t),s}get level(){return this.identifier.level}get calculation(){return this.identifier.calculation}get context(){return this.identifier.context||this.identifier}forceCalculation(){this.edgesFlow=Zt}cleanup(){this.cleanupCalculation()}isShadow(){return!!(this.origin&&this.origin!==this)}resetToEpoch(t){this.visitEpoch=t,this.visitedAt=Kr,this.edgesFlow<0&&(this.edgesFlow=0),this.usedProposedOrPrevious=!1,this.cleanupCalculation(),this.clearOutgoing(),this.promise=void 0,this.origin&&this.origin===this?(this.proposedArguments=void 0,this.value!==void 0&&(this.proposedValue=this.value),this.value=void 0):(this.origin=void 0,this.value=void 0),this.identifier.proposedValueIsBuilt&&this.proposedValue!==ee&&(this.needToBuildProposedValue=!0,this.proposedValue=void 0)}copyFrom(t){this.value=t.value,this.proposedValue=t.proposedValue,this.proposedArguments=t.proposedArguments,this.usedProposedOrPrevious=t.usedProposedOrPrevious}clearProperties(){this.value=void 0,this.proposedValue=void 0,this.proposedArguments=void 0}mergePreviousOrigin(t){const s=this.origin;if(s!==this.previous)throw new Error("Invalid state");this.copyFrom(s);const r=this.getOutgoing();for(const[i,a]of s.getOutgoing())if(!r.get(i)){const l=t.get(i);(!l||l.originId===a.originId)&&r.set(i,l||a)}if(s.$outgoingPast!==void 0){const i=this.getOutgoingPast();for(const[a,o]of s.getOutgoingPast())if(!i.get(a)){const c=t.get(a);(!c||c.originId===o.originId)&&i.set(a,c||o)}}this.origin=this,s.clearProperties(),s.clear()}setOrigin(t){this.origin=t,this.originId=t.originId}getOrigin(){return this.origin?this.origin:this.startOrigin()}startOrigin(){return this.originId=bp++,this.origin=this}getOutgoing(){return this}getOutgoingPast(){return this.$outgoingPast!==void 0?this.$outgoingPast:this.$outgoingPast=new Map}addOutgoingTo(t,s){(s===Jr.Normal?this:this.getOutgoingPast()).set(t.identifier,t)}clearOutgoing(){this.clear(),this.$outgoingPast!==void 0&&this.$outgoingPast.clear()}getValue(){const t=this.origin;return t===this?this.value:t?t.getValue():void 0}setValue(t){if(this.origin&&this.origin!==this)throw new Error("Can not set value to the shadow entry");this.getOrigin().value=t}hasValue(){return this.getValue()!==void 0}hasProposedValue(){return this.isShadow()?!1:this.hasProposedValueInner()}hasProposedValueInner(){return this.proposedValue!==void 0}getProposedValue(t){return this.needToBuildProposedValue&&(this.proposedValue=this.identifier.buildProposedValue.call(this.identifier.context||this.identifier,this.identifier,this,t),this.needToBuildProposedValue=!1),this.proposedValue}outgoingInTheFutureCb(t,s){let r=this;for(;r;){for(const i of r.getOutgoing().values())i.originId===t.getLatestEntryFor(i.identifier).originId&&s(i);r.isShadow()?r=r.previous:r=null}}outgoingInTheFutureAndPastCb(t,s){let r=this;for(;r;){for(const i of r.getOutgoing().values()){const a=t.getLatestEntryFor(i.identifier);a&&i.originId===a.originId&&s(i)}if(r.$outgoingPast!==void 0)for(const i of r.$outgoingPast.values()){const a=t.getLatestEntryFor(i.identifier);a&&i.originId===a.originId&&s(i)}r.isShadow()?r=r.previous:r=null}}outgoingInTheFutureAndPastTransactionCb(t,s){let r=this;for(;r;){for(const i of r.getOutgoing().values()){const a=t.getLatestStableEntryFor(i.identifier);a&&i.originId===a.originId&&s(i)}if(r.$outgoingPast!==void 0)for(const i of r.$outgoingPast.values()){const a=t.getLatestStableEntryFor(i.identifier);a&&i.originId===a.originId&&s(i)}r.isShadow()?r=r.previous:r=null}}outgoingInTheFutureTransactionCb(t,s){let r=this;for(;r;){for(const i of r.getOutgoing().values()){const a=t.getLatestEntryFor(i.identifier);a&&i.originId===a.originId&&s(i)}r.isShadow()?r=r.previous:r=null}}}){},ee=Symbol("Tombstone"),Qr=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},wt;(function(e){e[e.UserInput=0]="UserInput",e[e.DependsOnlyOnUserInput=1]="DependsOnlyOnUserInput",e[e.DependsOnlyOnDependsOnlyOnUserInput=2]="DependsOnlyOnDependsOnlyOnUserInput",e[e.DependsOnSelfKind=3]="DependsOnSelfKind"})(wt||(wt={}));var Tn=class extends de{constructor(){super(...arguments),this.name=void 0,this.lazy=!1,this.total=!0,this.pure=!0,this.proposedValueIsBuilt=!1}calculation(e){throw new Error("Abstract method `calculation` called")}equality(e,n){return e===n}};Qr([G(wt.DependsOnSelfKind)],Tn.prototype,"level",void 0),Qr([G(!0)],Tn.prototype,"sync",void 0);var rt=class extends Tn{constructor(){super(...arguments),this.context=void 0,this.isWritingUndefined=!1}newQuark(e){const n=this.quarkClass.new();return n.createdAt=e,n.identifier=this,n.needToBuildProposedValue=this.proposedValueIsBuilt,n}write(e,n,t,s,...r){t=t||n.getWriteTarget(e),t.proposedValue=s,t.proposedArguments=r.length>0?r:void 0,t.proposedIsPrevious=n.graph.isWritingPreviousData}writeToTransaction(e,n,...t){e.write(this,n,...t)}writeToGraph(e,n,...t){e.write(this,n,...t)}readFromGraphAsync(e){return e.readAsync(this)}readFromGraph(e){return e.read(this)}readFromTransaction(e){return e.read(this)}readFromTransactionAsync(e){return e.readAsync(this)}buildProposedValue(e,n,t){}enterGraph(e){}leaveGraph(e){}},Rp=e=>rt.new(e),Zr=Vs.mix(Gc.mix(Map)),Jc=Vs.mix(qc.mix(Map)),On=class extends rt{calculation(e){throw new Error("The 'calculation' method of the variables should never be called. Instead, the value will be set directly to quark")}write(e,n,t,s,...r){t=t||n.getWriteTarget(e),t.value=s,t.proposedArguments=r.length>0?r:void 0}};Qr([G(wt.UserInput)],On.prototype,"level",void 0),Qr([G(Zr)],On.prototype,"quarkClass",void 0);function ja(...e){return On.new(...e)}var Xr=class extends rt{calculation(e){return e(X)}};Qr([G(Zr)],Xr.prototype,"quarkClass",void 0);function ka(...e){return Xr.new(...e)}var Mt=class extends rt{*calculation(e){return yield X}};Qr([G(Jc)],Mt.prototype,"quarkClass",void 0);function La(...e){return Mt.new(...e)}var Ct=e=>{throw new Error(`Unknown identifier ${e}`)},Ip=0,Us=class extends de{constructor(){super(...arguments),this.createdAt=Ip++,this.name="revision-"+this.createdAt,this.previous=void 0,this.scope=new Map,this.reachableCount=0,this.referenceCount=0,this.selfDependent=new Set}getLatestEntryFor(e){let n=this;for(;n;){const t=n.scope.get(e);if(t)return t;n=n.previous}return null}hasIdentifier(e){const n=this.getLatestEntryFor(e);return!!(n&&n.getValue()!==ee)}*previousAxis(){let e=this;for(;e;)yield e,e=e.previous}},Pp=class{constructor(){this.length=0,this.levels=[],this.lowestLevel=Zt}getLowestLevel(){for(let e=this.lowestLevel!==Zt?this.lowestLevel:0;e<this.levels.length;e++)if(this.levels[e])return this.lowestLevel=e;return this.lowestLevel=Zt}takeLowestLevel(){for(let e=this.lowestLevel!==Zt?this.lowestLevel:0;e<this.levels.length;e++){const n=this.levels[e];if(n)return this.length-=n.length,this.levels[e]=null,this.lowestLevel=e+1,n}}pop(){for(let e=this.lowestLevel!==Zt?this.lowestLevel:0;e<this.levels.length;e++){const n=this.levels[e];if(this.lowestLevel=e,n&&n.length>0)return this.length--,n.pop()}this.lowestLevel=Zt}push(e){const n=e.level;let t=this.levels[n];if(!t){for(let s=this.levels.length;s<n;s++)this.levels[s]=null;t=this.levels[n]=[]}t.push(e),this.length++,n<this.lowestLevel&&(this.lowestLevel=n)}*[Symbol.iterator](){for(let e=0;e<this.levels.length;e++){const n=this.levels[e];n&&(yield*n)}}},Ws=class extends de{toString(){const e=[],n=[];return this.cycle.forEach(({name:t,context:s})=>{e.push(t),n[n.length-1]!==s&&n.push(s)}),`events: 
`+n.map(t=>"#"+t.id).join(" => ")+`

identifiers: 
`+e.join(`
`)}},Qc=class extends Fa{constructor(){super(...arguments),this.transaction=void 0}onCycle(e,n){return Pt.Cancel}doCollectNext(e,n,t){let s=this.visited.get(n);s||(s={visitedAt:Kr,visitEpoch:this.currentEpoch},this.visited.set(n,s)),t.push({node:n,from:e,label:void 0})}collectNext(e,n){const t=this.transaction.getLatestEntryFor(e);t&&t.outgoingInTheFutureTransactionCb(this.transaction,s=>{this.doCollectNext(e,s.identifier,n)})}},Zc=class extends de{constructor(){super(...arguments),this.visited=new Map,this.transaction=void 0,this.baseRevision=void 0,this.pushTo=void 0,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e),this.walkDepth()}startNewEpoch(){if(this.toVisit.length)throw new Error("Can not start new walk epoch in the middle of the walk");this.currentEpoch++}onTopologicalNode(e,n){!e.lazy&&e.level!==wt.UserInput&&this.pushTo.push(n)}onCycle(e,n){return Pt.Resume}doCollectNext(e,n,t){let s=this.visited.get(n);s||(s=n.newQuark(this.baseRevision),s.visitEpoch=this.currentEpoch,this.visited.set(n,s)),t.push(n)}collectNext(e,n,t){const s=this.baseRevision.getLatestEntryFor(e);s&&(t.previous=s,s.outgoingInTheFutureAndPastTransactionCb(this.transaction,r=>{this.doCollectNext(e,r.identifier,n)}));for(const r of t.getOutgoing().keys())this.doCollectNext(e,r,n);if(t.$outgoingPast!==void 0)for(const r of t.getOutgoingPast().keys())this.doCollectNext(e,r,n)}walkDepth(){const e=this.visited,n=this.toVisit;let t;for(;t=n.length;){const s=n[t-1];let r=e.get(s);if(r&&r.visitedAt===Rr&&r.visitEpoch===this.currentEpoch){r.edgesFlow++,n.pop();continue}if(r&&r.visitEpoch===this.currentEpoch&&r.visitedAt!==Kr){if(r.visitedAt<t){if(this.onCycle(s,n)!==Pt.Resume)break;r.edgesFlow++}else r.visitedAt=Rr,this.onTopologicalNode(s,r);n.pop()}else{const i=n.length;r||(r=s.newQuark(this.baseRevision),r.visitEpoch=this.currentEpoch,e.set(s,r)),this.collectNext(s,n,r),r.visitEpoch<this.currentEpoch&&r.resetToEpoch(this.currentEpoch),r.visitedAt=t,r.edgesFlow++,n.length===i&&(r.visitedAt=Rr,this.onTopologicalNode(s,r),n.pop())}}}},An=Jr.Normal,Ir=Jr.Past,Ba=class extends de{constructor(){super(...arguments),this.baseRevision=void 0,this.candidateClass=Us,this.candidate=void 0,this.graph=void 0,this.isClosed=!1,this.walkContext=void 0,this.entries=new Map,this.stackGen=new Pp,this.activeStack=[],this.onEffectSync=void 0,this.onEffectAsync=void 0,this.propagationStartDate=0,this.lastProgressNotificationDate=0,this.startProgressNotificationsAfterMs=500,this.emitProgressNotificationsEveryMs=200,this.emitProgressNotificationsEveryCalculations=100,this.plannedTotalIdentifiersToCalculate=0,this.ongoing=Promise.resolve(),this.selfDependedMarked=!1,this.rejectedWith=void 0,this.stopped=!1,this.hasEntryWithProposedValue=!1,this.hasVariableEntry=!1}initialize(...e){super.initialize(...e),this.walkContext=Zc.new({visited:this.entries,transaction:this,baseRevision:this.baseRevision,pushTo:this.stackGen}),this.candidate||(this.candidate=this.candidateClass.new({previous:this.baseRevision})),this.onEffectSync=this.read.bind(this),this.onEffectAsync=this.readAsync.bind(this)}get dirty(){return this.entries.size>0}markSelfDependent(){if(!this.selfDependedMarked){this.selfDependedMarked=!0;for(const e of this.baseRevision.selfDependent){const n=this.entries.get(e);n&&n.getValue()===ee||this.touch(e)}}}getActiveEntry(){return this.activeStack[this.activeStack.length-1]}yieldAsync(e){return Fs(e)?e:this.graph[e.handler](e,this)}yieldSync(e){if(Fs(e))throw new Error("Can not yield a promise in the synchronous context");return this.graph[e.handler](e,this)}readAsync(e){if(!(e instanceof rt))return this.yieldAsync(e);let n;const t=this.getActiveEntry();if(t)n=this.addEdge(e,t,An);else if(n=this.entries.get(e),!n){const s=this.baseRevision.getLatestEntryFor(e);s||Ct(e),n=s.hasValue()?s:this.touch(e)}return n.hasValue()?n.getValue():n.promise?n.promise:((!n.previous||!n.previous.hasValue())&&n.forceCalculation(),this.ongoing=n.promise=this.ongoing.then(()=>(async()=>{for(;this.stackGen.lowestLevel<e.level;)await xn(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,this.stackGen.takeLowestLevel()],this);if(this.markSelfDependent(),n.getValue()===void 0)return xn(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[n]],this)})()).then(()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);if(!n.hasValue())throw new Error("Computation cycle. Sync");return n.getValue()}))}get(e){if(!(e instanceof rt))return this.yieldSync(e);let n;const t=this.getActiveEntry();if(t)n=this.addEdge(e,t,An);else if(n=this.entries.get(e),!n){const r=this.baseRevision.getLatestEntryFor(e);r||Ct(e),n=r.hasValue()?r:this.touch(e)}const s=n.getValue();if(s===ee&&Ct(e),s!==void 0&&n.hasValue())return s;if(n.promise)return n.promise;for((!n.previous||!n.previous.hasValue())&&n.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());if(this.markSelfDependent(),e.sync){this.calculateTransitionsStackSync(this.onEffectSync,[n]);const r=n.getValue();if(r===void 0)throw new Error("Cycle during synchronous computation");return r===ee&&Ct(e),r}else{const r=this.ongoing=n.promise=this.ongoing.then(()=>{if(n.getValue()===void 0)return xn(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[n]],this)}).then(()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);const i=n.getValue();if(i===void 0)throw new Error("Computation cycle. Async get");return i===ee&&Ct(e),i});return Yr&&(r.quark=n),r}}read(e){if(!(e instanceof rt))return this.yieldSync(e);let n;const t=this.getActiveEntry();if(t)n=this.addEdge(e,t,An);else if(n=this.entries.get(e),!n){const i=this.baseRevision.getLatestEntryFor(e);i||Ct(e),n=i.hasValue()?i:this.touch(e)}const s=n.getValue();if(s===ee&&Ct(e),s!==void 0)return s;for((!n.previous||!n.previous.hasValue())&&n.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());this.markSelfDependent(),this.calculateTransitionsStackSync(this.onEffectSync,[n]);const r=n.getValue();if(r===void 0)throw new Error("Cycle during synchronous computation");return r===ee&&Ct(e),r}readCurrentOrProposedOrPrevious(e){const n=this.entries.get(e);if(n){const t=n.getValue();if(t!==void 0)return t;if(n.proposedValue!==void 0)return n.proposedValue}return this.readPrevious(e)}readCurrentOrProposedOrPreviousAsync(e){const n=this.entries.get(e);if(n){const t=n.getValue();if(t!==void 0)return t;if(n.proposedValue!==void 0)return n.proposedValue}return this.readPreviousAsync(e)}readPrevious(e){const n=this.baseRevision.getLatestEntryFor(e);if(!n)return;const t=n.getValue();return t!==ee?t===void 0&&e.lazy?this.read(e):t:void 0}readPreviousAsync(e){const n=this.baseRevision.getLatestEntryFor(e);if(!n)return;const t=n.getValue();return t!==ee?t!==void 0?t:this.readAsync(e):void 0}readProposedOrPrevious(e){const n=this.entries.get(e);return n&&n.proposedValue!==void 0?n.proposedValue:this.readPrevious(e)}readProposedOrPreviousAsync(e){const n=this.entries.get(e);return n&&n.proposedValue!==void 0?n.proposedValue:this.readPreviousAsync(e)}write(e,n,...t){n===void 0&&(n=null),e.write.call(e.context||e,e,this,null,n,...t);const s=this.entries.get(e);this.hasVariableEntry=this.hasVariableEntry||!s.isShadow()&&e.level===wt.UserInput,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||s.hasProposedValue()}getWriteTarget(e){return this.touch(e).startOrigin()}acquireQuarkIfExists(e){const n=this.entries.get(e);return n&&n.origin===n?n.origin:void 0}touch(e){const n=this.entries.get(e);(!n||n.visitEpoch<this.walkContext.currentEpoch)&&this.walkContext.continueFrom([e]);const t=n||this.entries.get(e);return t.forceCalculation(),t}hasIdentifier(e){const n=this.entries.get(e);return n&&n.getValue()===ee?!1:!!(n||this.baseRevision.getLatestEntryFor(e))}addIdentifier(e,n,...t){let s=this.entries.get(e);const r=!!s,i=e.level===wt.UserInput;return s||(s=e.newQuark(this.baseRevision),s.previous=this.baseRevision.getLatestEntryFor(e),s.forceCalculation(),this.entries.set(e,s),!e.lazy&&!i&&this.stackGen.push(s),this.hasVariableEntry=this.hasVariableEntry||!s.isShadow()&&i,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||s.hasProposedValue()),(n!==void 0||i)&&(s.startOrigin(),(!(r&&(s.proposedValue!==void 0||s.value!==void 0))||s.proposedValue===ee||s.value===ee)&&(e.isWritingUndefined=n===void 0,e.write.call(e.context||e,e,this,s,n===void 0&&i?null:n,...t),e.isWritingUndefined=!1)),s.getValue()===ee&&(s.value=void 0),s.proposedValue===ee&&(s.proposedValue=void 0),e.enterGraph(this.graph),s}removeIdentifier(e){e.leaveGraph(this.graph),this.touch(e).startOrigin().setValue(ee),this.candidate.selfDependent.delete(e)}populateCandidateScopeFromTransitions(e,n){if(e.scope.size===0)e.scope=n;else for(const[t,s]of n)if(s.isShadow()){const r=e.getLatestEntryFor(t);s.getOutgoing().forEach((i,a)=>r.getOutgoing().set(a,i))}else e.scope.set(t,s)}preCommit(e){if(this.isClosed)throw new Error("Can not propagate closed revision");this.markSelfDependent(),this.isClosed=!0,this.propagationStartDate=Date.now(),this.plannedTotalIdentifiersToCalculate=this.stackGen.length}postCommit(){this.populateCandidateScopeFromTransitions(this.candidate,this.entries);const e=this.entries;return this.walkContext=void 0,{revision:this.candidate,entries:e,transaction:this}}commit(e){return this.preCommit(e),this.calculateTransitionsSync(this.onEffectSync),this.postCommit()}reject(e=Hr.new()){this.rejectedWith=e,this.walkContext=void 0}stop(){this.stopped=!0}clearRejected(){for(const e of this.entries.values())e.cleanup();this.entries.clear()}async commitAsync(e){return this.preCommit(e),this.ongoing=this.ongoing.then(()=>xn(this.onEffectAsync,this.calculateTransitions,[this.onEffectAsync],this)).then(()=>this.postCommit())}getLatestEntryFor(e){let n=this.entries.get(e)||this.baseRevision.getLatestEntryFor(e);if(!(n&&n.getValue()===ee))return n}getLatestStableEntryFor(e){let n=this.entries.get(e);if(n){const t=n.getValue();return t===ee?void 0:t===void 0?this.baseRevision.getLatestEntryFor(e):n}else return this.baseRevision.getLatestEntryFor(e)}addEdge(e,n,t){if(n.identifier.level<e.level)throw new Error("Identifier can not read from higher level identifier");let r=this.entries.get(e);if(!r){const i=this.baseRevision.getLatestEntryFor(e);i||Ct(e),r=e.newQuark(this.baseRevision),r.setOrigin(i),r.previous=i,this.entries.set(e,r)}return r.addOutgoingTo(n,t),r}onQuarkCalculationCompleted(e,n){e.cleanup();const t=e.identifier,s=e.previous,r=!!(s&&s.hasValue()&&t.equality(n,s.getValue()));r?(s.outgoingInTheFutureAndPastTransactionCb(this,a=>{const o=this.entries.get(a.identifier);o&&o.edgesFlow--}),e.edgesFlow=Zt,e.setOrigin(s.origin),e.value=n):(e.startOrigin(),e.setValue(n));let i=!1;e.usedProposedOrPrevious&&(e.proposedValue!==void 0?t.equality(n,e.proposedValue)&&(i=!0):(r||!s&&n===null)&&(i=!0),i||this.candidate.selfDependent.add(t))}onReadIdentifier(e,n,t){const s=this.addEdge(e,n,An);if(s.hasValue()||s.value!==void 0){const r=s.getValue();return r===ee&&Ct(e),n.continueCalculation(r)}else if(s.isShadow()){s.startOrigin(),s.forceCalculation(),t.push(s);return}else if(s.isCalculationStarted()){let r;return Qc.new({transaction:this,onCycle(a,o){return r=Ws.new({cycle:Kc(o),requestedEntry:s,activeEntry:n}),Pt.Cancel}}).startFrom([s.identifier]),r}else{t.push(s),(!s.previous||!s.previous.hasValue())&&s.forceCalculation();return}}*calculateTransitions(e){const n=this.stackGen;for(;n.length;)yield*this.calculateTransitionsStackGen(e,n.takeLowestLevel())}calculateTransitionsSync(e){const n=this.stackGen;for(;n.length;)this.calculateTransitionsStackSync(e,n.takeLowestLevel())}*calculateTransitionsStackGen(e,n){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const t=this.entries,s=this.propagationStartDate,r=this.graph?this.graph.enableProgressNotifications:!1;let i=0;const a=this.activeStack;for(this.activeStack=n;n.length&&!this.rejectedWith&&!this.stopped;){if(r&&!(i++%this.emitProgressNotificationsEveryCalculations)){const h=Date.now();if(h-s>this.startProgressNotificationsAfterMs){const g=this.lastProgressNotificationDate;(!g||h-g>this.emitProgressNotificationsEveryMs)&&(this.lastProgressNotificationDate=h,this.graph.onPropagationProgressNotification({total:this.plannedTotalIdentifiersToCalculate,remaining:this.stackGen.length+n.length,phase:"propagating"}),this.activeStack=a,yield Rn(0),this.activeStack=n)}}if(this.rejectedWith||this.stopped)break;const o=n[n.length-1],l=o.identifier;if(t.get(l)!==o){o.cleanup(),n.pop();continue}if(o.edgesFlow==0){o.edgesFlow--;const h=o.previous;h&&h.outgoingInTheFutureAndPastTransactionCb(this,f=>{const g=t.get(f.identifier);g&&g.edgesFlow--})}if(o.edgesFlow<0&&o.previous&&o.previous.origin){o.setOrigin(o.previous.origin),o.size===0&&t.delete(l),o.cleanup(),n.pop();continue}if(o.hasValue()||o.proposedValue===ee){o.cleanup(),n.pop();continue}const u=o.visitEpoch;let d=o.isCalculationStarted()?o.iterationResult:o.startCalculation(this.onEffectSync);for(;d&&!this.rejectedWith&&!this.stopped;){const h=d.value===void 0?null:d.value;if(o.isCalculationCompleted()){o.visitEpoch==u&&this.onQuarkCalculationCompleted(o,h),n.pop();break}else if(h instanceof rt){const f=this.onReadIdentifier(h,o,n);f instanceof Ws?(this.walkContext.startNewEpoch(),yield*this.graph.onComputationCycleHandler(f),o.cleanupCalculation(),d=void 0):d=f}else if(h===Ns){n.pop();break}else{const f=yield h;if(f===Gr)break;if(o.visitEpoch===u)d=o.continueCalculation(f);else{n.pop();break}}}}this.activeStack=a}calculateTransitionsStackSync(e,n){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const t=this.entries,s=this.activeStack;for(this.activeStack=n;n.length&&!this.rejectedWith&&!this.stopped;){const r=n[n.length-1],i=r.identifier;if(t.get(i)!==r){r.cleanup(),n.pop();continue}if(r.edgesFlow==0){r.edgesFlow--;const c=r.previous;c&&c.outgoingInTheFutureAndPastTransactionCb(this,u=>{const d=t.get(u.identifier);d&&d.edgesFlow--})}if(r.edgesFlow<0&&r.previous&&r.previous.origin){r.setOrigin(r.previous.origin),r.size===0&&t.delete(i),r.cleanup(),n.pop();continue}if(r.hasValue()||r.proposedValue===ee){r.cleanup(),n.pop();continue}const o=r.visitEpoch;let l=r.isCalculationStarted()?r.iterationResult:r.startCalculation(this.onEffectSync);for(;l&&!this.rejectedWith&&!this.stopped;){const c=l.value===void 0?null:l.value;if(r.isCalculationCompleted()){r.visitEpoch==o&&this.onQuarkCalculationCompleted(r,c),n.pop();break}else if(c instanceof rt){const u=this.onReadIdentifier(c,r,n);u instanceof Ws?(this.walkContext.startNewEpoch(),this.graph.onComputationCycleHandlerSync(u,this),r.cleanupCalculation(),l=void 0):l=u}else if(c===Ns){n.pop();break}else{const u=e(c);if(Fs(u))throw new Error("Effect resolved to promise in the synchronous context, check that you marked the asynchronous calculations accordingly");if(u===Gr)break;if(r.visitEpoch===o)l=r.continueCalculation(u);else{n.pop();break}}}}this.activeStack=s}},zs={rejectedWith:null},Xc=class extends de{constructor(){super(...arguments),this.handlers=[]}trigger(e){for(let n=0;n<this.handlers.length;n++)this.handlers[n](e)}},eu=class extends de{constructor(){super(...arguments),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.baseRevision=Us.new(),this.topRevision=void 0,this.historyLimit=0,this.listeners=new Map,this.isWritingPreviousData=!1,this.$activeTransaction=void 0,this.isCommitting=!1,this.enableProgressNotifications=!1,this.ongoing=Promise.resolve(),this._isInitialCommit=!0,this.autoCommitTimeoutId=null,this.autoCommit=!1,this.autoCommitMode="sync",this.autoCommitHandler=null,this.onWriteDuringCommit="throw",this.onComputationCycle="throw",this.transactionClass=Ba,this.isJustCleared=!1,this.$followingRevision=void 0}initialize(...e){super.initialize(...e),this.topRevision||(this.topRevision=this.baseRevision),this.autoCommit&&(this.autoCommitHandler=this.autoCommitMode==="sync"?n=>this.commit(n):async n=>this.commitAsync(n)),this.markAndSweep()}hasPendingAutoCommit(){return this.autoCommitTimeoutId!==null}get dirty(){return this.activeTransaction.dirty}clear(){this.reject(),this.unScheduleAutoCommit(),this.baseRevision.scope&&this.baseRevision.scope.clear(),this.baseRevision.previous=null,this.listeners.clear(),this.topRevision=this.baseRevision,this.$followingRevision=void 0,this.$activeTransaction=void 0,this.markAndSweep(),this.isJustCleared=!0}*eachReachableRevision(){let e=!0,n=0;for(const t of this.topRevision.previousAxis())yield[t,e||n<this.historyLimit],t===this.baseRevision?e=!1:e||n++}get isInitialCommit(){return this._isInitialCommit}set isInitialCommit(e){this._isInitialCommit=e}markAndSweep(){let e;const n=[];for(const[t,s]of this.eachReachableRevision())s?(t.reachableCount++,e=t):n.push(t),t.referenceCount++;n.unshift(e);for(let t=n.length-1;t>=1&&n[t].reachableCount===0;t--)this.compactRevisions(n[t-1],n[t])}compactRevisions(e,n){if(n.reachableCount>0||e.previous!==n)throw new Error("Invalid compact operation");if(n.referenceCount<=1){for(const[t,s]of e.scope)if(s.getValue()===ee)n.scope.delete(t);else{const r=n.scope.get(t);s.origin===s?r&&(r.clear(),r.clearProperties()):r&&s.origin===r?s.mergePreviousOrigin(e.scope):t.lazy&&!s.origin&&r&&r.origin&&(s.startOrigin().proposedValue=r.origin.value!==void 0?r.origin.value:r.origin.proposedValue),s.previous=void 0,n.scope.set(t,s)}ap(e.selfDependent,n.selfDependent),e.scope=n.scope,n.scope=null}else e.scope=new Map(Ic(n.scope,e.scope)),e.selfDependent=new Set(Ic(n.selfDependent,e.selfDependent)),n.referenceCount--;e.previous=null}get followingRevision(){if(this.$followingRevision!==void 0)return this.$followingRevision;const e=Array.from(this.topRevision.previousAxis()),n=[];for(let t=e.length-1;t>0;t--)n.push([e[t],e[t-1]]);return this.$followingRevision=new Map(n)}get activeTransaction(){return this.$activeTransaction?this.$activeTransaction:this.$activeTransaction=this.transactionClass.new({baseRevision:this.baseRevisionTentative||this.baseRevision,graph:this})}branch(e){return this.constructor.new(Object.assign({},e,{baseRevision:this.baseRevision}))}propagate(e){return this.commit(e)}reject(e){this.activeTransaction.reject(Hr.new({reason:e})),this.ongoing=Promise.resolve(),this.$activeTransaction=void 0,this.baseRevisionTentative=void 0,this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable,this.baseRevisionStable=void 0)}commit(e){this.isJustCleared=!1,this.unScheduleAutoCommit(),this.baseRevisionStable=this.baseRevision;const t=this.activeTransaction.commit(e);this.$activeTransaction=void 0;const s=this.finalizeCommit(t);return this.baseRevisionStable=void 0,this.isInitialCommit=!1,s}async propagateAsync(e){return this.commitAsync(e)}async commitAsync(e){if(this.isCommitting)return this.ongoing;this.isJustCleared=!1,this.isCommitting=!0,this.baseRevisionStable=this.baseRevision;let n;return this.ongoing=this.ongoing.then(()=>this.doCommitAsync(e)).then(t=>(n=t,t)).finally(()=>{this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.isInitialCommit=!1,this.isCommitting=!1})}async doCommitAsync(e){this.unScheduleAutoCommit();const n=this.activeTransaction,t=await n.commitAsync(e),s=!!n.rejectedWith,r=this.baseRevisionTentative;if(s||(this.baseRevisionTentative=n.candidate),this.$activeTransaction=void 0,await this.finalizeCommitAsync(t),this.isJustCleared)return{rejectedWith:Hr.new({reason:"Graph cleared"})};n.rejectedWith&&!s&&(this.baseRevisionTentative=r,this.$activeTransaction=void 0);const i=this.finalizeCommit(t);return n.rejectedWith&&n.clearRejected(),this.dirty&&!n.rejectedWith&&await this.doCommitAsync(e),i}finalizeCommit(e){const{revision:n,entries:t,transaction:s}=e;if(s.rejectedWith)this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0;else{if(n.previous!==this.baseRevision)throw new Error("Invalid revisions chain");for(const[r,i]of this.eachReachableRevision())i&&r.reachableCount--,r.referenceCount--;this.baseRevision=this.topRevision=n;for(const[r,i]of t){if(i.cleanup(),i.isShadow()||!i.hasValue())continue;const a=this.listeners.get(r);a&&a.trigger(i.getValue())}this.$followingRevision=void 0,this.markAndSweep()}return{rejectedWith:s.rejectedWith}}async finalizeCommitAsync(e){}*onComputationCycleHandler(e){const n=new Error(`Computation cycle:
`+e);switch(n.cycle=e,this.onComputationCycle){case"ignore":console.log(n.message);const{requestedEntry:t,activeEntry:s}=e;return s.continueCalculation(t.proposedValue!==void 0?t.proposedValue:t.value);case"throw":throw n;case"reject":this.reject(n);break;case"warn":Mn(n);break}}onComputationCycleHandlerSync(e,n){const t=new Error(`Computation cycle:
`+e);switch(t.cycle=e,this.onComputationCycle){case"ignore":console.log(t.message);const{requestedEntry:s,activeEntry:r}=e;return r.continueCalculation(s.proposedValue!==void 0?s.proposedValue:s.value);case"throw":throw t;case"reject":this.reject(t);break;case"warn":Mn(t);break}}scheduleAutoCommit(){this.autoCommitTimeoutId===null&&!this.isCommitting&&(this.autoCommitTimeoutId=setTimeout(this.autoCommitHandler,10))}unScheduleAutoCommit(){this.autoCommitTimeoutId!==null&&(clearTimeout(this.autoCommitTimeoutId),this.autoCommitTimeoutId=null)}variable(e){const n=ja();return this.addIdentifier(n,e===void 0?null:e)}variableNamed(e,n){const t=ja({name:e});return this.addIdentifier(t,n===void 0?null:n)}identifier(e,n){const t=ma(e)?La({calculation:e,context:n}):ka({calculation:e,context:n});return this.addIdentifier(t)}identifierNamed(e,n,t){const s=n.constructor.name==="GeneratorFunction"?La({name:e,calculation:n,context:t}):ka({name:e,calculation:n,context:t});return this.addIdentifier(s)}addIdentifier(e,n,...t){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Adding identifier during commit");this.onWriteDuringCommit==="warn"&&Mn(new Error("Adding identifier during commit"))}return this.activeTransaction.addIdentifier(e,n,...t),this.autoCommit&&this.scheduleAutoCommit(),e}removeIdentifier(e){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Removing identifier during commit");this.onWriteDuringCommit==="warn"&&Mn(new Error("Removinfg identifier during commit"))}this.activeTransaction.removeIdentifier(e),this.listeners.delete(e),this.autoCommit&&this.scheduleAutoCommit()}hasIdentifier(e){return this.activeTransaction.hasIdentifier(e)}write(e,n,...t){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Write during commit");this.onWriteDuringCommit==="warn"&&Mn(new Error("Write during commit"))}this.activeTransaction.write(e,n,...t),this.autoCommit&&this.scheduleAutoCommit()}readPrevious(e){return this.activeTransaction.readPrevious(e)}readPreviousAsync(e){return this.activeTransaction.readPreviousAsync(e)}read(e){return this.activeTransaction.read(e)}readAsync(e){return this.activeTransaction.readAsync(e)}get(e){return this.activeTransaction.get(e)}observe(e,n){const t=this.addIdentifier(Mt.new({lazy:!1,calculation:e}));return this.addListener(t,n),t}observeContext(e,n,t){const s=this.addIdentifier(Mt.new({lazy:!1,calculation:e,context:n}));return this.addListener(s,t),s}addListener(e,n){let t=this.listeners.get(e);t||(t=Xc.new(),this.listeners.set(e,t)),t.handlers.push(n)}undo(){const n=this.baseRevision.previous;return n?(this.baseRevision=n,this.$activeTransaction=void 0,!0):!1}redo(){const e=this.baseRevision;if(e===this.topRevision)return!1;const n=this.followingRevision.get(e);return this.baseRevision=n,this.$activeTransaction=void 0,!0}onPropagationProgressNotification(e){}[va](e,n){const t=n.getActiveEntry();t.usedProposedOrPrevious=!0;const s=t.getProposedValue(n);return s!==void 0?s:t.previous?t.identifier.lazy?t.previous.hasValue()?t.previous.getValue():t.previous.hasProposedValue()?t.previous.getProposedValue(n):null:n.readPrevious(t.identifier):void 0}[Pn](e,n){return this.reject(e.reason),Gr}[ya](e,n){return n}[Sa](e,n){return n.getActiveEntry()}[Da](e,n){return n.getActiveEntry().identifier}[Ca](e,n){const t=n.getActiveEntry();if(t.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");const s=e.identifier.level>t.identifier.level;return s||n.walkContext.startNewEpoch(),n.write(e.identifier,...e.proposedArgs),s?void 0:Gr}[ba](e,n){const t=n.getActiveEntry();if(t.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");let s=!0;return e.writes.forEach(r=>{r.identifier.level<=t.identifier.level&&s&&(n.walkContext.startNewEpoch(),s=!1),n.write(r.identifier,...r.proposedArgs)}),s?void 0:Gr}[Ia](e,n){const t=n.getActiveEntry(),s=e.identifier;return n.addEdge(s,t,Ir),n.readPrevious(s)}[Pa](e,n){const t=n.getActiveEntry(),s=e.identifier;n.addEdge(s,t,Ir);const r=n.entries.get(s);return r&&!r.isShadow()?r.getProposedValue(n):void 0}[wa](e,n){const t=n.getActiveEntry(),s=e.identifier;n.addEdge(s,t,Ir);const r=n.entries.get(s);return r?r.hasProposedValue():!1}[Ma](e,n){const t=n.getActiveEntry(),s=e.identifier;n.addEdge(s,t,Ir);const r=n.entries.get(s);return r?r.hasProposedValue()&&!r.proposedIsPrevious:!1}[xa](e,n){const t=n.getActiveEntry(),s=e.identifier;return n.addEdge(s,t,Ir),n.readProposedOrPrevious(s)}[Oa](e,n){return n.readProposedOrPrevious(e.identifier)}[Aa](e,n){return n.readPrevious(e.identifier)}[Ta](e,n){const t=n.getActiveEntry(),s=e.identifier;n.addEdge(s,t,Ir);const r=n.entries.get(s);return r&&!r.isShadow()?r.proposedArguments:void 0}},tu=class extends de{constructor(){super(...arguments),this.name=void 0,this.ownFields=new Map,this.schema=void 0,this.$skeleton={},this.$allFields=void 0}hasField(e){return this.getField(e)!==void 0}getField(e){return this.allFields.get(e)}addField(e){const n=e.name;if(!n)throw new Error("Field must have a name");if(this.ownFields.has(n))throw new Error(`Field with name [${n}] already exists`);return e.entity=this,this.ownFields.set(n,e),e}forEachParent(e){let n=this;for(;n;)e(n),n=n.parentEntity}get allFields(){if(this.$allFields!==void 0)return this.$allFields;const e=new Map,n=new Set;return this.forEachParent(t=>{t.ownFields.forEach((s,r)=>{n.has(r)||(n.add(r),e.set(r,s))})}),this.$allFields=e}forEachField(e){this.allFields.forEach(e)}},Lt;(function(e){e[e.Current=0]="Current",e[e.Previous=1]="Previous",e[e.ProposedOrPrevious=2]="ProposedOrPrevious",e[e.CurrentOrProposedOrPrevious=3]="CurrentOrProposedOrPrevious"})(Lt||(Lt={}));var Na=class extends O([eu],e=>class extends e{constructor(){super(...arguments),this.autoCommit=!0,this.readMode=Lt.Current}addEntity(t){t.enterGraph(this)}addEntities(t){t.forEach(s=>this.addEntity(s))}removeEntity(t){t.leaveGraph(this)}removeEntities(t){t.forEach(s=>this.removeEntity(s))}}){},ut=class extends O([rt],e=>class extends e{constructor(){super(...arguments),this.field=void 0,this.self=void 0,this.DATA=void 0}getFromGraph(t){return t?t.readMode===Lt.Current?t.get(this):t.readMode===Lt.Previous?t.activeTransaction.readPrevious(this):(t.readMode===Lt.ProposedOrPrevious&&t.activeTransaction.readProposedOrPrevious(this),t.activeTransaction.readCurrentOrProposedOrPrevious(this)):this.DATA}readFromGraph(t){return t?t.read(this):this.DATA}writeToGraph(t,s,...r){t?t.write(this,s,...r):this.DATA=s}leaveGraph(t){const s=t.activeTransaction.getLatestStableEntryFor(this);s&&(this.DATA=s.getValue()),super.leaveGraph(t)}toString(){return this.name}}){},$n=class extends ut.mix(Xr){},Va=class extends ut.mix(Mt){},Ua=class extends ut.mix(On){},ru=class extends O([rt],e=>class extends e{constructor(){super(...arguments),this.entity=void 0,this.self=void 0}equality(){return!1}toString(){return`Entity identifier [${this.self}]`}}){},nu=class extends ru.mix(Mt){},en=class extends Tn{constructor(){super(...arguments),this.persistent=!0}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?ma(e)?Va:$n:Ua}},su=Symbol("isEntity"),xt=class extends O([],e=>{class n extends e{[su](){}get $entity(){return Wa(this.constructor.prototype)}get $(){const s={};if(this.$entity.forEachField((r,i)=>{s[i]=this.createFieldIdentifier(r)}),Yr){const r=new Proxy(s,{get(i,a,o){return i[a]||vp(new Error(`Attempt to read a missing field ${String(a)} on ${i}`)),i[a].SOURCE_POINT=zc.fromThisCall(),i[a]}});return _s(this,"$",r)}else return _s(this,"$",s)}get $$(){return _s(this,"$$",nu.new({name:this.$entityName,entity:this.$entity,calculation:this.calculateSelf,context:this,self:this}))}get $entityName(){return this.constructor.name||this.$entity.name}*calculateSelf(){return this}createFieldIdentifier(s){const r=s.name,i=this.$entity,a=this.constructor,o=i.$skeleton;o[r]||(o[r]=a.getIdentifierTemplateClass(this,s));const l=new o[r];return l.context=this,l.self=this,l.name=`${this.$$.name}.$.${s.name}`,l}forEachFieldIdentifier(s){this.$entity.forEachField((r,i)=>s(this.$[i],i,r))}enterGraph(s){if(this.graph)throw new Error("Already entered replica");this.graph=s,s.addIdentifier(this.$$),this.$entity.forEachField((r,i)=>{const a=this.$[i];s.addIdentifier(a,a.DATA),a.DATA=void 0})}leaveGraph(s){const r=this.graph,i=s||r;i&&(this.$entity.forEachField((a,o)=>i.removeIdentifier(this.$[o])),i.removeIdentifier(this.$$),i===r&&(this.graph=void 0))}propagate(s){return this.commit(s)}commit(s){const r=this.graph;return r?r.commit(s):zs}async propagateAsync(){return this.commitAsync()}async commitAsync(s){const r=this.graph;return r?r.commitAsync(s):Promise.resolve(zs)}static get $entity(){return Pr(this.prototype)}static getIdentifierTemplateClass(s,r){const i=r.name,a={name:`${s.$$.name}.$.${i}`,field:r};r.hasOwnProperty("sync")&&(a.sync=r.sync),r.hasOwnProperty("lazy")&&(a.lazy=r.lazy),r.hasOwnProperty("equality")&&(a.equality=r.equality);const o=s.$calculations&&s[s.$calculations[i]];o&&(a.calculation=o);const l=s.$writes&&s[s.$writes[i]];l&&(a.write=l);const c=s.$buildProposed&&s[s.$buildProposed[i]];c&&(a.buildProposedValue=c,a.proposedValueIsBuilt=!0);const u=r.getIdentifierClass(o).new(a),d=function(){};return d.prototype=u,d}run(s,...r){const i=c=>{if(c instanceof rt)return this.graph.read(c);throw new Error("Helper methods can not yield effects during computation")},a=this.graph.activeTransaction,o=a.activeStack;a.activeStack=[];const l=Hc(i,this[s],r,this);return a.activeStack=o,l}static createPropertyAccessorsFor(s){const r=s,i=this.prototype;Object.defineProperty(i,r,{get:function(){return this.$[r].getFromGraph(this.graph)},set:function(a){this.$[r].writeToGraph(this.graph,a)}})}static createMethodAccessorsFor(s){const r=s,i=this.prototype,a=`get${ga(r)}`,o=`set${ga(r)}`,l=`put${ga(r)}`;a in i||(i[a]=function(){return this.$[r].getFromGraph(this.graph)}),o in i||(i[o]=function(c,...u){return this.$[r].writeToGraph(this.graph,c,...u),this.graph?this.graph.autoCommitMode==="sync"?this.graph.commit():this.graph.commitAsync():Promise.resolve(zs)}),l in i||(i[l]=function(c,...u){this.$[r].writeToGraph(this.graph,c,...u)})}}return n}){},Wa=e=>{let n=Object.getPrototypeOf(e);return _s(e,"$entity",tu.new({parentEntity:n.hasOwnProperty(su)?null:n.$entity,name:e.constructor.name}))},Pr=e=>(e.hasOwnProperty("$entity")||Wa(e),e.$entity),qe=(e,n=en)=>function(t,s){const i=Pr(t).addField(n.new(Object.assign(e||{},{name:s}))),a=t.constructor;a.createPropertyAccessorsFor(s),a.createMethodAccessorsFor(s)},q=qe,j=function(e){return function(n,t,s){Pr(n);let r;n.$calculations?n.hasOwnProperty("$calculations")?r=n.$calculations:r=n.$calculations=Object.create(n.$calculations):r=n.$calculations={},r[e]=t}},dt=function(e){return function(n,t,s){Pr(n);let r;n.$writes?n.hasOwnProperty("$writes")?r=n.$writes:r=n.$writes=Object.create(n.$writes):r=n.$writes={},r[e]=t}},iu=function(e){return function(n,t,s){Pr(n);let r;n.$buildProposed?n.hasOwnProperty("$buildProposed")?r=n.$buildProposed:r=n.$buildProposed=Object.create(n.$buildProposed):r=n.$buildProposed={},r[e]=t}},V;(function(e){e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"})(V||(V={}));var N;(function(e){e.MustStartOn="muststarton",e.MustFinishOn="mustfinishon",e.StartNoEarlierThan="startnoearlierthan",e.StartNoLaterThan="startnolaterthan",e.FinishNoEarlierThan="finishnoearlierthan",e.FinishNoLaterThan="finishnolaterthan",e.AsSoonAsPossible="assoonaspossible",e.AsLateAsPossible="aslateaspossible"})(N||(N={}));var me;(function(e){e.Normal="Normal",e.FixedDuration="FixedDuration",e.FixedEffort="FixedEffort",e.FixedUnits="FixedUnits"})(me||(me={}));var wr;(function(e){e[e.NoError=0]="NoError",e[e.CyclicDependency=1]="CyclicDependency",e[e.DuplicatingDependency=2]="DuplicatingDependency"})(wr||(wr={}));var _e;(function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToStart=2]="EndToStart",e[e.EndToEnd=3]="EndToEnd"})(_e||(_e={}));var Mr;(function(e){e.Project="Project",e.FromEvent="FromEvent",e.ToEvent="ToEvent"})(Mr||(Mr={}));var tn;(function(e){e[e.SchedulerBasic=1]="SchedulerBasic",e[e.SchedulerPro=2]="SchedulerPro",e[e.Gantt=3]="Gantt"})(tn||(tn={}));var L;(function(e){e.Forward="Forward",e.Backward="Backward",e.None="None"})(L||(L={}));var _n=(e,n)=>e&&!n||!e&&n?!1:!e&&!n?!0:e.direction===n.direction&&(e.kind==="own"&&n.kind==="own"||e.kind==="enforced"&&n.kind==="enforced"&&e.enforcedBy===n.enforcedBy||e.kind==="inherited"&&n.kind==="inherited"&&e.inheritedFrom===n.inheritedFrom),ce;(function(e){e.Start="Start",e.End="End"})(ce||(ce={}));var he=new Date(-864e13),ae=new Date(864e13),Bt=e=>{if(!e)return!1;const n=e.getTime();return n!==he.getTime()&&n!==ae.getTime()},za=Symbol("RequiredProperties"),au=Bs((e,n)=>{let t=e[za];t||(t=e[za]=[]),t.push(n)}),ou=Bs(e=>{const n=e[za];if(n){for(let t=0;t<n.length;t++)if(e[n[t]]===void 0)throw new Error(`Required attribute [${String(n[t])}] is not provided`)}}),wp=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},lu=0,Ne=lu++,fe=class extends de{constructor(){super(...arguments),this.formulaId=lu++,this.inputs=new Set}},cu=class extends Fa{collectNext(e,n){if(e instanceof fe)n.push({node:e.output,from:e,label:void 0});else{const t=this.cache.formulasByInput.get(e);t&&t.forEach(s=>n.push({node:s,from:e,label:void 0}))}}},qs=class extends O([de],e=>class extends e{constructor(){super(...arguments),this.variables=new Set,this.formulas=new Set,this.$formulasByInput=void 0,this.$formulasByOutput=void 0}get formulasByInput(){return this.$formulasByInput!==void 0?this.$formulasByInput:(this.fillCache(),this.$formulasByInput)}get formulasByOutput(){return this.$formulasByOutput!==void 0?this.$formulasByOutput:(this.fillCache(),this.$formulasByOutput)}add(t){this.$formulasByInput=void 0,this.$formulasByOutput=void 0,this.formulas.add(t)}has(t){return this.formulas.has(t)}fillCache(){this.$formulasByInput=new Map,this.$formulasByOutput=new Map,this.formulas.forEach(t=>{let s=this.$formulasByOutput.get(t.output);s||(s=new Set,this.$formulasByOutput.set(t.output,s)),s.add(t),t.inputs.forEach(r=>{let i=this.$formulasByInput.get(r);i||(i=new Set,this.$formulasByInput.set(r,i)),i.add(t)})})}allInputVariables(){return Rc(Pc($s(this.formulas,t=>t.inputs.values())))}isCyclic(){let t=!1;return cu.new({cache:this,onCycle:()=>(t=!0,Pt.Cancel)}).startFrom(Array.from(this.allInputVariables())),t}}){},Xt=class extends qs{},Fe=class extends de{constructor(){super(...arguments),this.description=void 0,this.defaultResolutionFormulas=new Set,this.resolutionsByInputHash=new Map}clear(){this.resolutionsByInputHash.clear()}resolve(e){const n=this.resolutionsByInputHash.get(e.hash);if(n!==void 0)return n;const t=this.buildResolution(e);return this.resolutionsByInputHash.set(e.hash,t),t}buildResolution(e){const n=Ga.new({context:this,input:e}),t=Array.from(n.next()).map(s=>({resolution:s.asResolution(),nbrOfDefaultFormulas:Array.from(s.activatedFormulas.formulas).reduce((r,i)=>s.formulaIsDefault(i)?r+1:r,0),unCoveredInputWeight:s.unCoveredInputWeight()}));if(t.sort((s,r)=>s.unCoveredInputWeight<r.unCoveredInputWeight?-1:s.unCoveredInputWeight>r.unCoveredInputWeight?1:r.nbrOfDefaultFormulas-s.nbrOfDefaultFormulas),t.length>0)return t[0].resolution;debugger}},Tt;(function(e){e[e.NoInput=0]="NoInput",e[e.HasPreviousValue=1]="HasPreviousValue",e[e.HasProposedValue=2]="HasProposedValue",e[e.KeepIfPossible=4]="KeepIfPossible"})(Tt||(Tt={}));var qa=class extends de{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.$hash=""}get hash(){return this.$hash!==""?this.$hash:this.$hash=this.buildHash()}get description(){return this.context.description}get resolution(){return this.context.resolve(this)}initialize(...e){super.initialize(...e),ou(this),this.input=new Map(Me(this.description.variables).map(n=>[n,Tt.NoInput]))}buildHash(){return String.fromCharCode(...Me(this.description.variables).inBatchesBySize(5).map(e=>this.batchToCharCode(e)))}batchToCharCode(e){return e.reduceRight((n,t,s)=>n|this.input.get(t)<<s*3,0)}addProposedValueFlag(e){if(Yr){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const n=this.input.get(e);this.input.set(e,n|Tt.HasProposedValue)}hasProposedValue(e){return!!(this.input.get(e)&Tt.HasProposedValue)}hasProposedValueVars(){return Me(this.description.variables).filter(e=>this.hasProposedValue(e))}addPreviousValueFlag(e){if(Yr){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const n=this.input.get(e);this.input.set(e,n|Tt.HasPreviousValue)}hasPreviousValue(e){return!!(this.input.get(e)&Tt.HasPreviousValue)}hasPreviousValueVars(){return Me(this.description.variables).filter(e=>this.hasPreviousValue(e))}addKeepIfPossibleFlag(e){if(Yr){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const n=this.input.get(e);this.input.set(e,n|Tt.KeepIfPossible)}keepIfPossible(e){return!!(this.input.get(e)&Tt.KeepIfPossible)}keepIfPossibleVars(){return Me(this.description.variables).filter(e=>this.keepIfPossible(e))}};wp([au],qa.prototype,"context",void 0);var Ga=class extends de{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.previous=void 0,this.activatedFormula=void 0,this.$activatedFormulas=void 0}get activatedFormulas(){if(this.$activatedFormulas!==void 0)return this.$activatedFormulas;const e=qs.new({variables:this.description.variables,formulas:Me(this.thisAndPreviousStates()).map(n=>n.activatedFormula).toSet()});return this.$activatedFormulas=e}get description(){return this.context.description}*thisAndPreviousStates(){let e=this;for(;e&&e.activatedFormula;)yield e,e=e.previous}formulaHasProposedValueInInput(e){return Array.from(e.inputs).some(n=>this.input.hasProposedValue(n))}unCoveredInputWeight(){const e=$s(this.input.hasProposedValueVars(),s=>({variable:s,isProposed:!0})),n=$s(this.input.keepIfPossibleVars(),s=>({variable:s,isProposed:!1}));return Me([e,n]).concat().uniqueOnlyBy(s=>s.variable).reduce((s,{variable:r,isProposed:i})=>{let a=0;const o=this.activatedFormulas.formulasByOutput.get(r);if(o){const c=o.size===1?Array.from(o)[0]:null;c&&this.formulaIsDefault(c)&&this.formulaHasProposedValueInInput(c)?i?a+=1e6:a+=1e4:i?a+=1e7:a+=1e5}const l=this.activatedFormulas.formulasByInput.get(r);return l&&l.size>0||(i?a+=1e3:a+=100),s+a},0)}preferFormula(e,n){const t=this.formulaAllInputsHasProposed(e),s=this.formulaAllInputsHasProposed(n);if(t&&!s)return-1;if(s&&!t)return 1;const r=this.formulaCountInputsWithProposedOrKeep(e),i=this.formulaCountInputsWithProposedOrKeep(n);return r>i?-1:r<i?1:this.formulaIsDefault(e)&&!this.formulaIsDefault(n)?-1:this.formulaIsDefault(n)&&!this.formulaIsDefault(e)?1:0}formulaIsDefault(e){return this.context.defaultResolutionFormulas.has(e)}formulaCountInputsWithProposedOrKeep(e){let n=0;return Array.from(e.inputs).forEach(t=>{(this.input.hasProposedValue(t)||this.input.keepIfPossible(t))&&n++}),n}formulaAllInputsHasProposedOrKeep(e){return Array.from(e.inputs).every(n=>this.input.hasProposedValue(n)||this.input.keepIfPossible(n))}formulaAllInputsHasProposed(e){return Array.from(e.inputs).every(n=>this.input.hasProposedValue(n))}formulaIsApplicable(e){const n=Array.from(e.inputs).every(s=>this.input.hasProposedValue(s)||this.input.hasPreviousValue(s)||this.activatedFormulas.formulasByOutput.has(s)),t=qs.new({formulas:new Set(this.activatedFormulas.formulas)});return t.add(e),n&&!t.isCyclic()}formulaIsInsignificant(e){const n=this.activatedFormulas.formulasByOutput.has(e.output),t=this.input.hasPreviousValue(e.output);return n||t&&Array.from(e.inputs).some(s=>!this.input.hasPreviousValue(s)&&!this.input.hasProposedValue(s)&&!this.activatedFormulas.formulasByOutput.has(s))}unvisitedFormulas(){return Array.from(this.description.formulas).filter(e=>!this.activatedFormulas.has(e))}*next(){const e=this.unvisitedFormulas();e.sort(this.preferFormula.bind(this));let n=!0;for(const t of e){if(!this.formulaIsApplicable(t)||this.formulaIsInsignificant(t))continue;yield*Ga.new({previous:this,context:this.context,input:this.input,activatedFormula:t}).next(),n=!1}n&&(yield this)}asResolution(){return new Map(Me(this.description.variables).map(e=>{const n=this.activatedFormulas.formulasByOutput.get(e);if(n)for(const t of n)return[e,t.formulaId];return[e,Ne]}))}},uu,Oe=class{static cacheFlags(e=navigator.platform,n=navigator.userAgent){const t=this;t._isLinux=!!e.match(/Linux/),t._isMac=!!e.match(/Mac/),t._isWindows=!!e.match(/Win32/),t._isMobile=!!(n.match(/Mobile|Opera Mini|Opera Mobi|Puffin/)||typeof globalThis.orientation=="number"),t._isWebkit=!!(n.match(/WebKit/)&&!n.match(/Edg/)),t._firefoxVersion=t.getVersion(n,/Firefox\/(\d+)\./),t._isFirefox=t._firefoxVersion>0,t._chromeVersion=t.getVersion(n,/Chrom(?:e|ium)\/(\d+)\./),t._isChrome=t._chromeVersion>0,t._isSafari=!!n.match(/Safari/)&&!t._isChrome,t._isMobileSafari=!!n.match(/Mobile.*Safari/),t._safariVersion=t.getVersion(n,/Version\/(.*).Safari/),t._isAndroid=!!n.match(/Android/g)}static get supportsOverflowClip(){if(this._supportsOverflowClip==null){const e=document.createElement("div");e.style.overflow="clip",e.style.display="none",document.documentElement.appendChild(e),this._supportsOverflowClip=e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("overflow")==="clip",e.remove()}return this._supportsOverflowClip}static get supportsSticky(){return!0}static getVersion(e,n){const t=e.match(n);return t?parseFloat(t[1]):0}static get isTouchDevice(){return this._isTouchDevice===void 0&&(this._isTouchDevice=globalThis.matchMedia("(pointer:coarse)").matches),this._isTouchDevice}static get isHoverableDevice(){return this._isHoverableDevice===void 0&&(this._isHoverableDevice=globalThis.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}static get isBrowserEnv(){return typeof window!="undefined"}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isAndroid(){return this._isAndroid}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get safariVersion(){return this._safariVersion}static get isMobileSafari(){return this._isMobileSafari}static get isMobile(){return this._isMobile}static get platform(){const e=this;return e._isLinux?"linux":e._isMac?"mac":e._isWindows?"windows":e._isAndroid?"android":e._isMobileSafari?"ios":null}static get supportsPassive(){return!0}static get supportsRandomUUID(){if(this._supportsRandomUUID===void 0)try{this._supportsRandomUUID=globalThis.crypto.randomUUID().length>0}catch(e){this._supportsRandomUUID=!1}return this._supportsRandomUUID}static get storageAvailable(){let e,n;try{return e=localStorage,n="__storage_test__",e.setItem(n,n),e.removeItem(n),!0}catch(t){return t instanceof DOMException&&(t.code===22||t.code===1014||t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e.length!==0}}static setLocalStorageItem(e,n){this.storageAvailable&&localStorage.setItem(e,n)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static searchParam(e,n=null,t=document.location.search){const s=new RegExp(`[?&]${e}=?([^&]*)`),r=t.match(s);return r&&r[1]||n}static getCookie(e){const n=encodeURIComponent(e)+"=",t=document.cookie.split(";");for(let s=0;s<t.length;s++){let r=t[s];for(;r.charAt(0)===" ";)r=r.substring(1,r.length);if(r.indexOf(n)===0)return decodeURIComponent(r.substring(n.length,r.length))}return""}static download(e,n){const t=document.createElement("a");t.download=e,t.href=n||e,t.style.cssText="display:none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}static downloadBlob(e,n){const t=globalThis.URL.createObjectURL(e);this.download(n,t),globalThis.URL.revokeObjectURL(t)}static get queryString(){var e;const n=new URL(globalThis.location.href).searchParams;return(e=Object.fromEntries)==null?void 0:e.call(Object,n.entries())}static copyToClipboard(e){let n=!0;const t=document.createElement("textarea");t.value=e,t.style.height=t.style.width=0,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(s){n=!1}return t.remove(),n}static isBryntumOnline(e){return e=Array.isArray(e)?e:[e],!!(/^(www\.)?bryntum\.com/.test(globalThis.location.host)||e!=null&&e.some(n=>this.queryString[n]!=null))}static get isCSP(){const{bryntum:e,document:n}=globalThis;return e.CSP==null&&(e.CSP=!!n.querySelector('meta[http-equiv="Content-Security-Policy"]')),e.CSP}};F(Oe,"supportsPointerEvents",!!(globalThis.PointerEvent||globalThis.MSPointerEvent)),F(Oe,"supportsPointerEventConstructor",typeof PointerEvent!="undefined"),F(Oe,"PointerEventConstructor",globalThis.PointerEvent||globalThis.CustomEvent),F(Oe,"isPhone",(uu=globalThis.matchMedia)==null?void 0:uu.call(globalThis,"(max-height:414px) or (max-width:414px)").matches),Oe.isBrowserEnv&&Oe.cacheFlags(),Oe._$name="BrowserHelper";var du,hu,fu,gu,pu=/([a-z])([A-Z])/g,Mp=/[\n\r]/g,xp=/[.*+?^${}()|[\]\\]/g,Tp=/[&<]/,Op=/(^[^a-z]+[^\w]+)/gi,Ap=/\s+/,$p=/^[^a-z]+|[^\w:.-]+/gi,_p=(e,n)=>hu[n.toLowerCase()]||String.fromCharCode(parseInt(n.substr(2),10)),Fp=(e,n)=>du[n],jp=(e,n,t)=>`${n}-${t.toLowerCase()}`,kp=(e,n,t)=>`${n} ${t.toLowerCase()}`,Lp=e=>e?`_x${[...e].map(n=>n.charCodeAt(0).toString(16)).join("")}`:"__blank__",mu={},vu={},er=class{static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){const n=mu[e];return n||(mu[e]=e.replace(pu,jp))}static separate(e){const n=vu[e];return n||(vu[e]=this.capitalize(e.replace(pu,kp)))}static createId(e){return String(e).replace(Op,Lp)}static makeValidDomId(e,n=""){return e==null?null:String(e).replace($p,n)}static escapeRegExp(e,n){let t=e.replace(xp,"\\$&");return n!==void 0&&(t=new RegExp(t,n)),t}static decodeHtml(e){return e&&String(e).replace(gu,_p)}static encodeHtml(e=""){return e&&String(e).replace(fu,Fp)}static encodeHtmlBR(e){var n;return(n=er.encodeHtml(e))==null?void 0:n.replace(Mp,"<br>")}static isHtml(e){return typeof e=="string"&&Tp.test(e||"")}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const n=Object.keys(e);du=e,hu=n.reduce((t,s)=>(t[e[s]]=s,t),{}),fu=new RegExp(`([${n.map(t=>"[-]".includes(t)?"\\"+t:t).join("")}])`,"g"),gu=new RegExp(`(${Object.values(e).join("|")}|&#[0-9]+;)`,"ig")}static safeJsonParse(e){let n=null;try{n=JSON.parse(e)}catch(t){}return n}static safeJsonStringify(e,n=null,t=null){let s=null;try{s=JSON.stringify(e,n,t)}catch(r){}return s}static joinPaths(e,n="/"){return e.join(n).replace(new RegExp("\\"+n+"+","g"),n)}static split(e,n=Ap){let t=e;return typeof t=="string"&&(t=e.trim(),t=t?t.split(n):[]),t}static xss(e,...n){const t=[];let s=n.length;for(t[s]=e[s];s-- >0;)t[s]=e[s]+er.encodeHtml(n[s]);return t.join("")}static xssBR(e,...n){const t=[];let s=n.length;for(t[s]=e[s];s-- >0;)t[s]=e[s]+er.encodeHtmlBR(n[s]);return t.join("")}static toJavaScriptValue(e,n){const t=_.typeOf(e);if(t==="boolean"||t==="string"||t==="number"||e===null)return er.safeJsonStringify(e);if(e===globalThis)return"window";if(t==="date")return`new Date(${e.getFullYear()}, ${e.getMonth()}, ${e.getDate()}, ${e.getHours()}, ${e.getMinutes()}, ${e.getSeconds()}, ${e.getMilliseconds()})`;if(t==="array")return`[${e.map(s=>er.toJavaScriptValue(s,n))}]`;if(t==="object"||t==="instance")return this.toJavaScriptString(e,n);if(t==="function"){let s=e.toString();return s.match(/^async (\w+?)\(/)?s=s.replace(/^async (\w+?)\(/,"async function("):!s.startsWith("async(")&&s.match(/^(\w+?)\(/)&&(s=s.replace(/^(\w+?)\(/,"function(")),s}if(t==="class")return e.toJavaScriptValue?e.toJavaScriptValue(n):Object.prototype.hasOwnProperty.call(e,"$name")?e.$name:e.name}static toJavaScriptString(e,n={}){var t;const s=(t=n.level)!=null?t:0,r=2;return`{
`+Object.keys(e).map(i=>" ".repeat((s+1)*r)+(i.match(/[- *]/)?`"${i}"`:i)+`: ${er.toJavaScriptValue(e[i],{...n,level:s+1})}`).join(`,
`)+`
`+" ".repeat(s*r)+"}"}static encodeAttributeSelector(e,n){return`[${e}="${String(n).replace(/["\\]/g,"\\$&")}"]`}static generateUUID(){var e;return Oe.supportsRandomUUID?globalThis.crypto.randomUUID():(e=globalThis.crypto)!=null&&e.getRandomValues?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,n=>(n^globalThis.crypto.getRandomValues(new Uint8Array(1))[0]&15>>n/4).toString(16)):`${Date.now()}-${++er.fakeNodeUUIDIndex}`}},U=er;F(U,"fakeNodeUUIDIndex",0),U.initHtmlEntities(),U._$name="StringHelper";var{hasOwnProperty:Bp,toString:Np}=Object.prototype,{isFrozen:yu}=Object,Vp=/\s*<\s*/,Up=/\s*>\s*/,Su={},Du={},Cu=Object.freeze({}),_=class{static assign(e,...n){for(let t,s,r=0;r<n.length;r++)if(t=n[r],t)for(s in t)e[s]=t[s];return e}static assignIf(e,...n){for(let t,s,r=0;r<n.length;r++)if(t=n[r],t)for(s in t)(!(s in e)||e[s]===void 0)&&(e[s]=t[s]);return e}static blend(e,n,t){t=t||Su,e=e||{};const{clone:s=_.clone,merge:r=_.blend}=t;if(Array.isArray(n)){if(n.length>1)return n.forEach(i=>{e=_.blend(e,i,t)}),e;n=n[0]}if(n){let i,a,o;for(a in n)o=n[a],o&&_.isObject(o)&&(i=e[a],t.key=a,i&&_.isObject(i)?(yu(i)&&(e[a]=i=s(i,t)),o=r(i,o,t)):o=yu(o)?o:s(o,t)),e[a]=o}return e}static clone(e,n){let t=e,s;if(e&&typeof e=="object")if(n&&typeof n=="object"&&n&&(n=null),_.isObject(e))if(e.skipClone)t=e;else{t={};for(s in e)t[s]=_.clone(e[s])}else if(Array.isArray(e))for(t=[],s=e.length;s-- >0;)t[s]=_.clone(e[s]);else _.isDate(e)?t=new Date(e.getTime()):n&&(t=n(e));return t}static createTruthyKeys(e){const n=U.split(e),t=n&&{};if(n)for(const s of n)s&&(t[s]=!0);return t}static getPath(e,n){return n.split(".").reduce((t,s)=>(t||Cu)[s],e)}static getPathDefault(e,n,t){const s=Array.isArray(n)?n:typeof n=="string"?n.split("."):[n],r=s.length-1;return s.reduce((i,a,o)=>(t&&!(a in i)&&(i[a]=o===r?t:{}),(i||Cu)[a]),e)}static hasPath(e,n){return n.split(".").every(t=>e&&t in e?(e=e[t],!0):!1)}static getTruthyKeys(e){const n=[];for(const t in e)e[t]&&n.push(t);return n}static getTruthyValues(e){const n=[];for(const t in e)e[t]&&n.push(e[t]);return n}static isClass(e){var n;return typeof e=="function"&&((n=e.prototype)==null?void 0:n.constructor)===e}static isDate(e){return!!(e!=null&&e.getUTCDate)&&_.typeOf(e)==="date"}static isPromise(e){if(Promise&&Promise.resolve)return Promise.resolve(e)===e||typeof(e==null?void 0:e.then)=="function";throw new Error("Promise not supported in your environment")}static isEmpty(e){if(e&&typeof e=="object")for(const n in e)return!1;return!0}static isObject(e){const n=e==null?void 0:e.constructor;return!!(n?n===Object||n.getPrototypeOf&&n.prototype&&!Object.getPrototypeOf(n.prototype):e&&typeof e=="object")}static isInstantiated(e){return e?typeof e=="object"&&!_.isObject(e):!1}static merge(e,...n){return _.blend(e,n)}static mergeItems(e,n,t){t=t||Su;let s,r,i,a,o,l,c;const{merge:u=_.blend}=t;if(e=e||{},Array.isArray(n))n.forEach(d=>{e=_.mergeItems(e,d,t)});else if(n)for(o in n)if(c=n[o],s=null,o.includes(">")?([o,s]=o.split(Up),r=0):o.includes("<")&&([s,o]=o.split(Vp),r=1),o in e)c&&e[o]&&u&&(t.key=o,c=u(e[o],c,t)),e[o]=c;else if(!s)e[o]=c,a==null||a.set(o,a.size);else{if(!a){a=new Map,i=0;for(const d in e)a.set(d,i++)}if(i=a.get(s),e[o]=c,i==null&&r)i=a.size;else{l=l||[],i=(i||0)+r;for(const d of a){const[h,f]=d;i<=f&&(l&&(l[a.size-f-1]=h),a.set(h,f+1))}if(l)for(;l.length;){const d=l.pop(),h=e[d];delete e[d],e[d]=h}}a.set(o,i)}return e}static setPath(e,n,t){return n.split(".").reduce((s,r,i,a)=>i===a.length-1?s[r]=t:(s[r]instanceof Object||(s[r]={}),s[r]),e),e}static typeOf(e){let n,t;return e===null?t="null":e!==e?t="nan":(t=typeof e,t==="object"?e.isBase?t="instance":Array.isArray(e)?t="array":(t=Du[n=Np.call(e)])||(Du[n]=t=n.slice(8,-1).toLowerCase()):t==="function"&&e.isBase&&(t="class")),t}};Object.defineProperty(_,"hasOwn",{value:Object.hasOwn||((e,n)=>Bp.call(e,n))}),_._$name="Objects";var Se=class{static setVersion(e,n){e=e.toLowerCase(),ht[e]={version:n,isNewerThan(r){return Se.semanticCompareVersion(r,n,"<")},isOlderThan(r){return Se.semanticCompareVersion(r,n,">")}};let t="";typeof productName!="undefined"&&(t=productName);const s=`${t}.${e}${n.replace(/\./g,"-")}`;if(Oe.isBrowserEnv&&!globalThis.bryntum.silenceBundleException)if(globalThis.bryntum[s]===!0)if(this.isTestEnv)globalThis.BUNDLE_EXCEPTION=!0;else{let r=t||e;r==="core"&&(r="grid");let i=U.capitalize(r);throw r==="schedulerpro"&&(i="SchedulerPro"),new Error(`The Bryntum ${i} bundle was loaded multiple times by the application.

Common reasons you are getting this error includes:

* Imports point to different types of the bundle (e.g. *.module.js and *.umd.js)
* Imports point to both sources and bundle
* Imports do not use the shortest relative path, JS treats them as different files
* Cache busters differ between imports, JS treats ${r}.module.js?1 and ${r}.module.js?2 as different files
* Imports missing file type, verify they all end in .js

See https://bryntum.com/products/${r}/docs/guide/${i}/gettingstarted/es6bundle#troubleshooting for more information

`)}else globalThis.bryntum[s]=!0}static getVersion(e){if(e=e.toLowerCase(),!ht[e])throw new Error("No version specified! Please check that you import VersionHelper correctly into the class from where you call `deprecate` function.");return ht[e].version}static semanticCompareVersion(e,n,t="="){e=e||"",n=n||"";const s=e.split(/[-.]/),r=n.split(/[-.]/),i=t.includes("<"),a=(l,c)=>{const u=["rc","beta","alpha"],d=l.map(h=>{if(u.includes(h))return-u.indexOf(h)-2;const f=Number.parseInt(h);return Number.isNaN(f)?-u.length:f});for(;d.length<c;)d.push(-1);return d},o=()=>{const l=Math.max(s.length,r.length),c=a(s,l),u=a(r,l);for(let d=0;d<l;d++)if(c[d]!==u[d])return i?c[d]<u[d]:c[d]>u[d];return!0};switch(t){case"=":return e===n;case"<=":case">=":return e===n||o();case"<":case">":return e!==n&&o()}return!1}static checkVersion(e,n,t){return Se.semanticCompareVersion(ht.getVersion(e),n,t)}static deprecate(e,n,t){if(ht.checkVersion(e,n,"<"))console.warn(`Deprecation warning: You are using a deprecated API which will change in v${n}. ${t}`);else throw new Error(`Deprecated API use. ${t}`)}static get isTestEnv(){var e,n,t;const s=!!((e=globalThis.bryntum)!=null&&e.isTestEnv);try{return s||!!((t=(n=globalThis.parent)==null?void 0:n.bryntum)!=null&&t.isTestEnv)}catch(r){return s}}static get isDebug(){return!1}},ht=Se;Oe.isBrowserEnv&&(ht.isTestEnv&&(Oe._isHoverableDevice=!0),globalThis.bryntum=Object.assign(globalThis.bryntum||{},{getVersion:ht.getVersion.bind(ht),checkVersion:ht.checkVersion.bind(ht),deprecate:ht.deprecate.bind(ht),license:"%LICENSE%"})),Se._$name="VersionHelper";var{defineProperty:Gs,getOwnPropertyDescriptor:Eu}=Reflect,{hasOwnProperty:bu,toString:Ha}=Object.prototype,Ya=Symbol("instanceProperties"),Ru=Symbol("configuring"),rn=Symbol("lazyConfigValues"),Iu=Ha.call(new Date),Wp=/\s+/,zp=(e,n)=>(e[n]=1,e),ue=class{static get(e,n){const{cache:t}=this,s=t[e]||(t[e]=new ue(e));let r=s,i;return n&&(i=ue.makeCacheKey(e,n),(r=i&&t[i])||(r=s.extend(n),i&&(t[i]=r))),r}constructor(e){const n=this,t=e[0].toUpperCase()+e.substr(1);n.base=n,n.name=e,n.field="_"+e,n.capName=t,n.changer="change"+t,n.initializing="initializing"+t,n.updater="update"+t}get descriptor(){let e=this._descriptor;return(!e||!bu.call(this,"_descriptor"))&&(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return(!e||!bu.call(this,"_initDescriptor"))&&(this._initDescriptor=e=this.makeInitter()),e}equal(e,n){return e===n}extend(e){const n=Object.assign(Object.create(this),e),{equal:t,merge:s}=e,{equalityMethods:r}=ue;return typeof t=="string"&&(t.endsWith("[]")?n.equal=ue.makeArrayEquals(r[t.substr(0,t.length-2)]):n.equal=r[t]),typeof s=="string"&&(n.merge=ue.mergeMethods[s]),n}define(e){const n=Eu(e,this.name);let t=this.descriptor;n&&n.get&&(t=Object.assign({},t),t.get=n.get),Gs(e,this.name,t)}defineInitter(e,n){const{name:t}=this,s=e[Ya];let r,i;!s[t]&&(i=Eu(e,t))&&!("value"in i)&&(s[t]=i),Gs(e,t,this.initDescriptor),this.lazy&&(r=e[rn]||(e[rn]=new Map),r.set(t,n))}static makeArrayEquals(e){return(n,t)=>{let s,r=n&&t&&n.length===(s=t.length);if(r&&Array.isArray(n)&&Array.isArray(t))if(e)for(;r&&s-- >0;)r=e(n[s],t[s]);else for(;r&&s-- >0;)r=n[s]===t[s];else r=e?e(n,t):n===t;return r}}static makeCacheKey(e,n){const t=Object.keys(n).sort();for(let s,r,i,a=t.length;a-- >0;)if(i=n[s=t[a]],i==null&&i===!1)t.splice(a,1);else{if(r=typeof i,r==="function")return null;r==="string"?t[a]=`${s}:"${i}"`:r==="number"&&(t[a]=`${s}:${i}`)}return t.length?`${e}>${t.join("|")}`:e}makeDescriptor(){const e=this,{base:n,field:t,changer:s,updater:r,name:i}=e;return n!==e&&n.equal===e.equal?n.descriptor:{get(){var a;return(a=this.configObserver)==null||a.get(i,this),this[t]},set(a){var o,l;const c=this;let u=c[t],d,h;if(typeof a=="string"){let f=a;a.startsWith("up.")?f=(o=c.owner)==null?void 0:o.resolveProperty(a.substr(3)):a.startsWith("this.")&&(f=c.resolveProperty(a.substr(5))),f!==void 0&&typeof f!="function"&&(a=f)}c[s]&&(d=(h=c[s](a,u))===void 0,d||(a=h,u=c[t])),!d&&!(e.equal===Pu?u===a:e.equal(u,a))&&(c[t]=a,d=!0,(l=c[r])==null||l.call(c,a,u)),d&&!c.isDestroyed&&!c.onConfigChange.$nullFn&&c.onConfigChange({name:i,value:a,was:u,config:e})}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:n,name:t}=e;return{configurable:!0,get(){const s=this;return e.removeInitter(s),s[n]=!0,s[t]=s[Ru][t],s[n]=!1,s.configDone[t]=!0,s[t]},set(s){e.removeInitter(this),this.configDone[t]=!0,this[t]=s}}}makeLazyInitter(){const e=this,{initializing:n,name:t}=e;return{configurable:!0,get(){const s=this,r=s[rn].get(t);return e.removeInitter(s),s.isDestroying||(s[n]=!0,s[t]=r,s[n]=!1),s[t]},set(s){e.removeInitter(this),this[t]=s}}}removeInitter(e){const{name:n}=this,t=e[Ya][n],s=e[rn];t?Gs(e,n,t):delete e[n],s!=null&&s.delete(n)&&!s.size&&delete e[rn]}setDefault(e,n){Gs(e.prototype,this.field,{configurable:!0,writable:!0,value:n})}merge(e,n){if(n&&e&&_.isObject(e)){if(n.isBase)return n.setConfig(e);_.isObject(n)&&(e=_.merge(_.clone(n),e))}return e}},{prototype:Fn}=ue,{equal:Pu}=Fn;ue.symbols={configuring:Ru,instanceProperties:Ya,lazyConfigs:rn},ue.cache=Object.create(null),ue.equalityMethods={array:ue.makeArrayEquals(),date(e,n){return e===n?!0:e&&n&&Ha.call(e)===Iu&&Ha.call(n)===Iu?e.getTime()===n.getTime():!1},strict:ue.equal=Pu},ue.mergeMethods={distinct(e,n){let t=n?n.slice():[];if(e!=null)if(_.isObject(e))if(n===void 0)t=e;else{let s,r;for(s in e)r=t.indexOf(s),e[s]?r<0&&t.push(s):r>-1&&t.splice(r,1)}else Array.isArray(e)?e.forEach(s=>!t.includes(s)&&t.push(s)):t.includes(e)||t.push(e);return t},merge:ue.merge=Fn.merge,classList(e,n){if(typeof e=="string"){if(!e.length)return n;e=e.split(Wp)}return Array.isArray(e)&&(e=e.reduce(zp,{})),ue.merge(e,n)},objects(e,n){return e===!0?n||{}:ue.merge(e,n)},replace(e){return e},items(e,n,t,s){return s?_.mergeItems(n,e,{merge:(r,i)=>Fn.merge(i,r)}):Fn.merge(e,n)}},Object.assign(Fn,{_descriptor:null,_initDescriptor:null,lazy:!1,nullify:!1,render:!1}),ue._$name="Config";var qp=class{constructor(e){e&&Object.assign(this,e)}getInherited(e,n=!0){var t;let s=this[e];return e in this||(s=(t=this.super)==null?void 0:t.getInherited(e,n),(s||n)&&(this[e]=s=Object.create(s||null))),s}},{getPrototypeOf:wu}=Object,{hasOwn:Ot}=_,{defineProperty:Mu}=Reflect,Hs=Symbol("classMetaData"),xu=Symbol("mixinTag"),Ka=Symbol("originalConfig"),_y=Symbol("createdAt"),Nt=ue.symbols.configuring,Gp=ue.symbols.instanceProperties,jn=ue.symbols.lazyConfigs,Hp={merge:"replace",simple:!0},Ys=()=>{},Tu=e=>new qp(e),Ou={},Yp=Object.freeze({}),Au=Object.freeze([]),$=class{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const n=this,t=n.constructor;n.$meta.class!==t&&Ys(t.$meta),n.construct(...e),n.afterConstruct(),n.isConstructing=!1}static new(...e){return e=e.filter(n=>n),new this(e.length>1?this.mergeConfigs(...e):e[0])}construct(...e){e[0]!==null&&this.configure(...e),this.afterConfigure()}static destroy(...e){const n=t=>{t!=null&&t.destroy?t.destroy():Array.isArray(t)&&t.forEach(n)};n(e)}destroy(){const e=this,{id:n}=e;e.isDestroying=!0,e.destroy=Ys,e.doDestroy(),Object.setPrototypeOf(e,null);for(const t in e)t!=="destroy"&&t!=="isDestroying"&&delete e[t];delete e[Ka],e.isDestroyed=!0,e.id=n}_thisIsAUsedExpression(e){}static get $$name(){return Ot(this,"$name")&&this.$name||Ot(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,n,t=Au){const{handler:s,thisObj:r}=this.resolveCallback(e,n==="this"?this:n)||Yp;return s==null?void 0:s.apply(r,t)}resolveProperty(e){let n=this;for(;n;){if(_.hasPath(n,e))return _.getPath(n,e);n=n.owner}}resolveCallback(e,n=this,t=!0){if(e!=null&&e.substring){if(e.endsWith("?")&&(t=!1,e=e.substring(0,e.length-1)),e.startsWith("up.")){for(e=e.substring(3),n=this.owner;n&&!n[e];n=n.owner);if(!n)return}else e.startsWith("this.")&&(e=e.substring(5),n=this);if(!n||!(n instanceof Object))return;e=n[e]}if(typeof e=="function")return{handler:e,thisObj:n};if(t)throw new Error(`No method named ${e} on ${n.$$name||"thisObj object"}`)}bindCallback(e,n=this){if(e){const{handler:t,thisObj:s}=this.resolveCallback(e,n);if(t)return t.bind(s)}}delay(e,n,t=e.name||e){return e=this.setTimeout?e:e.bind(this),(this.setTimeout?this:globalThis)[typeof n=="number"?"setTimeout":"requestAnimationFrame"](e,n,t)}doDestroy(){const e=this,{nullify:n}=e.$meta;if(n)for(let t=0;t<n.length;++t)e[n[t].field]!=null&&(e[n[t].name]=null)}destroyProperties(...e){var n,t;const s=this;let r;for(r of e)r in s&&(!s[Nt]||!s[Nt][r])&&((t=(n=s[r])==null?void 0:n.destroy)==null||t.call(n),delete s[r])}configure(e={}){const n=this,t=n.$meta,{beforeConfigure:s}=e,r=t.configs,i=n.getDefaultConfiguration();let a,o,l;n.initialConfig=e,n.isConfiguring=!0,Object.assign(n,n.getProperties());for(o in e)l=e[o],a=r[o],i[o]=a?a.merge(l,i[o],null,t):l;s&&(delete i.beforeConfigure,s(n,i)),n.setConfig(n[Ka]=i,!0),n.isConfiguring=!1}getConfig(e){return this[e]}setConfig(e,n){var t;const s=this,r=s[Nt],i=r?s.configDone:s.configDone={},a=s.$meta.configs;let o,l;s[Gp]={},s[Nt]=r?Object.setPrototypeOf(Object.assign({},e),r):e;for(l in e)e[l]!=null||Ot(e,l)?(o=a[l]||ue.get(l),o.defineInitter(s,e[l]),n||(i[l]=!1)):i[l]=!0;n&&s.startConfigure(e);for(l in e)!i[l]&&!((t=a[l])!=null&&t.lazy)&&(s[l]=e[l]);return r?s[Nt]=r:delete s[Nt],n&&s.finishConfigure(e),s}hasConfig(e){var n;const t=this,s=t[Nt];return!!(t["_"+e]!=null||((n=t[jn])==null?void 0:n.get(e))!=null||!t.configDone[e]&&s&&(s[e]!=null||Ot(s,e)))}peekConfig(e){const n=this,t=n[jn],s=n[Nt];if(t!=null&&t.has(e))return t.get(e);if(s&&e in s){if(n.configDone[e])return n[e];if(s[e]!=null||Ot(s,e))return s[e]}}triggerConfig(e){const n=this,{configDone:t}=n,s=n[jn],r=n[Nt],i=s!=null&&s.has(e)||r&&(r[e]!=null||Ot(r,e))?!t[e]:null;return i&&n.getConfig(e),i}triggerConfigs(e){const n=this,t=n.$meta.configs,s=n[jn],r=s?[...s.keys()].filter(i=>t[i].lazy===e):Au;for(const i of r)n.triggerConfig(i);return r.length?r:null}onConfigChange(){}get config(){const e={},n=this[Ka];for(const t in n)e[t]=n[t];return e}static processConfigValue(e,n){if(e===globalThis)return globalThis;if(Array.isArray(e))return e.map(t=>$.processConfigValue(t,n));if(e instanceof $)return n.visited.has(e)?void 0:e.getCurrentConfig(n);if(e instanceof HTMLElement||e instanceof DocumentFragment)return null;if(_.isObject(e)){const t={};for(const s in e)s!=="owner"&&(t[s]=$.processConfigValue(e[s],n));return t}return e}getConfigValue(e,n){var t;const s=this,r=s[jn];if(!((t=s.$meta.configs[e])!=null&&t.lazy))return $.processConfigValue(s[e],n);if(r!=null&&r.has(e))return $.processConfigValue(r.get(e),n)}preProcessCurrentConfigs(){}getCurrentConfig(e={}){const n=this,t=e.configs==="all"?n.config:_.clone(n.initialConfig),s=e.visited||(e.visited=new Set),r=e.depth||(e.depth=0),i={};if(!s.has(n)){s.add(n),this.preProcessCurrentConfigs(t);for(const a in t){const o=n.getConfigValue(a,{...e,depth:r+1});o!==void 0&&(i[a]=o)}return i}}getConfigString(e={}){return U.toJavaScriptString(this.getCurrentConfig(e))}getTestCase(e={}){const n=this.isGantt?"Gantt":this.isSchedulerPro?"SchedulerPro":this.isCalendar?"Calendar":this.isScheduler?"Scheduler":this.isGrid?"Grid":this.isTaskBoard?"TaskBoard":null;if(n){const t=n.toLowerCase(),s=`../../build/${t}.module.js`;let r,i;e.import==="static"?(r=`import * as module from "${s}";Object.assign(window, module);`,i=""):(r=`import("${s}").then(module => { Object.assign(window, module);
`,i="});");const a=Se.getVersion(t);return a&&(r+=`
console.log('${n} ${a}');
`),`${r}      
const ${t} = new ${n}(${this.getConfigString(e)});
${i}`}}downloadTestCase(e={}){e.output="return";const n=this.getTestCase(e);Oe.download("app.js","data:application/javascript;charset=utf-8,"+escape(n))}static initClass(){return this.$meta.class}static get $meta(){const e=this;let n=e[Hs];return Ot(e,Hs)||(e[Hs]=n=Tu(),n.class=e,e.setupClass(n)),n}static onClassMixedIn(){}static mergeConfigs(e,...n){const t=this.$meta.configs,s=_.clone(e)||{};let r,i,a,o;for(i=0;i<n.length;++i)if(r=n[i],r)for(a in r)o=r[a],t[a]?o=t[a].merge(o,s[a]):s[a]&&o&&(o=ue.merge(o,s[a])),s[a]=o;return s}static mixin(...e){let n=this,t;for(t=0;t<e.length;++t){const s=e[t],r=s[xu]||(s[xu]=Symbol("mixinTag"));n[r]||(n=s(n),n[r]=!0,Ot(n,"onClassMixedIn")&&n.onClassMixedIn())}return n}static setupClass(e){var n;const t=e.class,s=wu(t).$meta,r=t.$$name,i=s.names,a=t.prototype;if(Mu(a,"$meta",{value:e}),Object.assign(e,{super:s,config:Object.create(s.config),configs:Object.create(s.configs),declarables:s.declarables,forkConfigs:s.forkConfigs,hierarchy:Object.freeze([...s.hierarchy,t]),names:i.includes(r)?i:Object.freeze([...i,r]),properties:s.properties,nullify:(n=s.nullify)==null?void 0:n.slice()}),i!==e.names){const o=`is${r}`,l=c=>{Ot(c,o)||Mu(c,o,{get(){return!0}})};l(a),l(t)}for(let o,l,c=0;c<e.declarables.length;++c)o=e.declarables[c],Ot(t,o)&&(l=Ou[o]||(Ou[o]=`setup${U.capitalize(o)}`),t[l](t,e))}static setupConfigs(e,n,t){const s=e.config,r=e.configs,i=e.class,a=e.super;let{nullify:o}=e,l,c,u,d,h,f;for(const g in n)h=n[g],t?(l=r[g])?h=l.merge(h,s[g],e,a):l=ue.get(g,Hp):(c=u=d=void 0,h&&typeof h=="object"&&"$config"in h&&(u=h.$config,u&&!_.isObject(u)&&(u=_.createTruthyKeys(u)),d="default"in h,c=d?h.default:c,h=h.value),(l=r[g])?(f=l.nullify,u&&(l=l.extend(u)),h=l.merge(h,s[g],e,a)):(l=ue.get(g,u),l.define(i.prototype),d=!(l.field in i.prototype),f=!1),d&&l.setDefault(i,c),l.nullify&&!f&&(o||(o=e.nullify||(e.nullify=[]))).push(l)),h&&(_.isObject(h)||Array.isArray(h))&&!Object.isFrozen(h)&&(e.forkConfigs=!0),r[g]=l,s[g]=h}static setupConfigurable(e,n){e.setupConfigs(n,e.configurable,!1)}static setupDefaultConfig(e,n){e.setupConfigs(n,e.defaultConfig,!0)}static setupDeclarable(e,n){const t=e.declarable;let s=n.declarables,r,i;for(i=0;i<t.length;++i)s.includes(t[i])||(r||(n.declarables=r=s=s.slice()),s.push(t[i]))}static setupProperties(e,n){n.properties=n.super.properties.slice(),n.properties.push(e),Object.freeze(n.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.$meta,n=e.forkConfigs?$.fork(e.config):Object.create(e.config);if(Se.isTestEnv&&Oe.isBrowserEnv&&n.testConfig&&globalThis.__applyTestConfigs)for(const t in n.testConfig)n[t]=n.testConfig[t];return n}static fork(e){let n=e,t,s;if(e&&_.isObject(e)&&!Object.isFrozen(e)){n=Object.create(e);for(t in e)s=e[t],s&&(_.isObject(s)?n[t]=$.fork(s):Array.isArray(s)&&(n[t]=s.slice()))}return n}getProperties(){const e=this.$meta.properties,n={};for(let t=0;t<e.length;t++)Object.assign(n,e[t].properties);return n}static get superclass(){return wu(this)}classHierarchy(e){const n=this.$meta.hierarchy,t=e?n.indexOf(e):0;return t>0?n.slice(t):n}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(e){let n=this.$detachers;if(n=n==null?void 0:n[e],n)for(;n.length;)n.pop()()}trackDetacher(e,n){const t=this.$detachers||(this.$detachers={});(t[e]||(t[e]=[])).push(n)}untrackDetachers(e){const n=this.$detachers;if(n)for(const t in n){const s=n[t];for(let r=s.length;r-- >0;)s[r].eventer===e&&s.splice(r,1)}}},Ja=$.prototype;Ja.onConfigChange.$nullFn=Ys.$nullFn=!0,$[Hs]=Ja.$meta=Tu({class:$,config:Object.freeze({}),configs:Object.create(null),declarables:$.declarable,forkConfigs:!1,hierarchy:Object.freeze([$]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null}),Object.assign(Ja,{$detachers:null,configObserver:null,isConstructing:!0,isDestroyed:!1,isDestroying:!1}),$.emptyFn=Ys,Se.setVersion("core","5.5.0"),$._$name="Base";var Kp=/^(\w+)=(.*)$/,Jp=function(e){const n={},t=e.split("&");for(const s of t){const[r,i,a]=Kp.exec(s),o=decodeURIComponent(i),l=decodeURIComponent(a);if(r){let c=n[o];c?(Array.isArray(c)||(c=n[o]=[c]),c.push(l)):n[o]=l}}return n},xr=class{static get(e,n){return this.fetch(e,n)}static post(e,n,t={}){return!(n instanceof FormData)&&typeof n!="string"&&(n=JSON.stringify(n),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:n},t))}static fetch(e,n){let t;if(n=_.merge({},xr.DEFAULT_FETCH_OPTIONS,n),typeof AbortController!="undefined"&&(t=n.abortController=new AbortController,n.signal=t.signal),"credentials"in n||(n.credentials="include"),n.queryParams){const r=Object.entries(n.queryParams);if(r.length){let i=!1;if(n.headers&&n.addQueryParamsToBody===!0){const a=new Headers(n.headers).get("Content-Type");let o;switch(a){case"application/x-www-form-urlencoded":o=URLSearchParams;break;case"multipart/form-data":o=FormData;break}if(o){const l=n.body||(n.body=new o);l instanceof o&&(r.forEach(([c,u])=>l.set(c,u)),i=!0)}}i||(e+=(e.includes("?")?"&":"?")+r.map(([a,o])=>`${a}=${encodeURIComponent(o)}`).join("&"))}}const s=new Promise((r,i)=>{fetch(e,n).then(a=>{n.parseJson?a.json().then(o=>{a.parsedJson=o,r(a)}).catch(o=>{a.parsedJson=null,a.error=o,i(a)}):r(a)}).catch(a=>{a.stack=s.stack,i(a)})});return s.stack=new Error().stack,s.abort=function(){t==null||t.abort()},s}static mockUrl(e,n){const t=this;(t.mockAjaxMap||(t.mockAjaxMap={}))[e]=n,xr.originalFetch||(xr.originalFetch=xr.fetch,xr.fetch=t.mockAjaxFetch.bind(t))}static async mockAjaxFetch(e,n){const t=e.split("?");let s=this.mockAjaxMap[t[0]],r=null;if(s){typeof s=="function"&&(s=await s(t[0],t[1]&&Jp(t[1]),n));try{r=(n==null?void 0:n.parseJson)&&JSON.parse(s.responseText)}catch(i){r=null,s.error=i}return s=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:r,text:()=>new Promise(i=>{i(s.responseText)}),json:()=>new Promise(i=>{i(r)})},s),new Promise(function(i,a){s.synchronous?i(s):setTimeout(function(){i(s)},"delay"in s?s.delay:100)})}else return xr.originalFetch(e,n)}},tr=xr;F(tr,"DEFAULT_FETCH_OPTIONS",{}),tr._$name="AjaxHelper";var W=class{static clean(e){return e.reduce((n,t)=>(t!=null&&!(Array.isArray(t)&&t.length===0)&&t!==""&&n.push(t),n),[])}static from(e,n,t){const s=[];if(e)for(const r of e)(!n||n(r))&&s.push(t?t(r):r);return s}static remove(e,...n){let t,s,r=!1;n=n[0]instanceof Set?[...n[0]]:n;for(let i=0;i<n.length;i++)s=n[i],(t=e.indexOf(s))!==-1&&(e.splice(t,1),r=!0);return r}static findInsertionIndex(e,n,t=this.lexicalCompare,s){const r=n.length;let i,a;return s<r&&(i=s>0?t(n[s-1],e):0,a=s<r-1?t(e,n[s]):0,i<1&&a<1)?s:this.binarySearch(n,e,t)}static findLast(e,n,t){for(let{length:s}=e,r=s-1;r>=0;r--)if(n.call(t,e[r],r,e))return e[r]}static binarySearch(e,n,t=0,s=e.length,r=this.lexicalCompare){const i=e.length;let a,o;for(t instanceof Function?(r=t,t=0):s instanceof Function&&(r=s,s=i),--s;t<=s;)a=t+s>>1,o=r(n,e[a]),o>=0?t=a+1:o<0&&(s=a-1);return t}magnitudeCompare(e,n){return e<n?-1:e>n?1:0}lexicalCompare(e,n){return e=String(e),n=String(n),e<n?-1:e>n?1:0}static fill(e,n={},t=null){const s=[],r=Array.isArray(n)?n:[n];for(let i=0;i<e;i++)for(const a of r){const o=Object.assign({},a);t&&t(o,i),s.push(o)}return s}static populate(e,n,t=!1){const s=[];for(let r=0;r<e;r++)s.push(n(r+(t?1:0)));return s}static include(e,...n){for(const t of n)e.includes(t)||e.push(t)}static unique(e){return[...new Set(e)]}static allowNegative(e){return new Proxy(e,{get(n,t,s){if(typeof t!="string")return Reflect.get(n,t,s);const r=Number(t);return Number.isNaN(r)?Reflect.get(n,t,s):n[r<0?n.length+r:r]},set(n,t,s,r){if(typeof t!="string")return Reflect.set(n,t,s,r);const i=Number(t);return Number.isNaN(i)?Reflect.set(n,t,s,r):(n[i<0?n.length+i:i]=s,!0)}})}static delta(e,n,t=!1){if(!n)return t?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const s=[],r=[],i=new Set,a=new Set(n);for(let o=0;o<e.length;o++){const l=e[o];a.has(l)?i.add(l):s.push(l)}for(let o=0;o<n.length;o++){const l=n[o];i.has(l)||r.push(l)}return t?{toAdd:s,toRemove:r,toKeep:i}:{onlyInA:s,onlyInB:r,inBoth:[...i]}}static asArray(e){return e==null?e:e instanceof Set?Array.from(e):Array.isArray(e)?e:[e]}static identity(e){return e}static keyBy(e,n,t=W.identity){const s=typeof n=="string"?i=>i==null?void 0:i[n]:n,r=typeof t=="string"?i=>i==null?void 0:i[t]:t;return e.reduce((i,a)=>(i[s(a)]=r(a),i),{})}static aggregate(e,n,t,s,r={}){const i=e.length,a=e[0].length,o=[];r.targetArray=o,r.arrays=e;for(let l=0;l<a;l++)r.entryIndex=l,o.push(s(l,r));for(let l=0;l<i;l++){const c=e[l];r.rowIndex=l;for(let u=0;u<a;u++){r.entryIndex=u;const d=n(c[u],r);o[u]=t(o[u],d,l,u,r)}}return o}static groupBy(e,n){const t=typeof n=="string"?s=>s==null?void 0:s[n]:n;return e.reduce((s,r)=>{const i=t(r);return(s[i]=s[i]||[]).push(r),s},{})}};W._$name="ArrayHelper";var $u=/,\s*/,Qa=Symbol("decompiled"),Qp=/^\s*(async\s+)?([a-z_]\w*)\s*=>([\s\S]+)$/i,Zp=/^\s*(async\s*)?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)\s+=>([\s\S]+)$/i,Xp=/^(\s*async)?(?:\s*function)?(?:\s*([a-z_]\w*))?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)([\s\S]+)$/i,{hasOwnProperty:em}=Object.prototype,Et=class{static after(e,n,t,s,r){const i=typeof t=="string",a=(r==null?void 0:r.return)!==!1,o=(...l)=>{const c=o.$nextHook.call(e,...l),u=s!=null&&s.isDestroyed?void 0:a?i?s[t](c,...l):t.call(s,c,...l):i?s[t](...l):t.call(s,...l);return u===void 0?c:u};return Et.hookMethod(e,n,o)}static before(e,n,t,s){const r=typeof t=="string",i=(...a)=>{const o=s!=null&&s.isDestroyed?0:r?s[t](...a):t.call(s,...a);return o===!1?o:i.$nextHook.call(e,...a)};return Et.hookMethod(e,n,i)}static curry(e){return function n(...t){return t.length>=e.length?e.apply(this,t):function(...s){return n.apply(this,t.concat(s))}}}static bindAll(e){for(const n in e)typeof e[n]=="function"&&(e[n]=e[n].bind(e))}static createInterceptor(e,n,t){return function(...s){const r=t||this;return n.call(r,...s)!==!1?e.call(r,...s):!1}}static createSequence(e,n,t){return(...s)=>{const r=e.call(t,...s),i=n.call(t,...s);return i===void 0?r:i}}static createThrottled(e,n,t,s,r){let i=-Number.MAX_VALUE,a,o;const l=()=>{o=0,i=performance.now(),a.push.apply(a,s),e.apply(t,a)},c=function(...u){const d=performance.now()-i;a=u,d>=n?(clearTimeout(o),l()):(o||(o=setTimeout(l,n-d)),r&&(a.push.apply(a,s),r.apply(t,a)))};return c.cancel=()=>clearTimeout(o),c}static createBuffered(e,n,t,s){let r,i;const a=()=>{i=0,o.isPending=!1,r.push.apply(r,s),e.apply(t,r)},o=function(...l){r=l,i&&clearTimeout(i),o.isPending=!0,i=setTimeout(a,n)};return o.cancel=()=>{o.isPending=!1,clearTimeout(i)},o}static decompile(e){if(!(Qa in e)){const n=e.toString();let t=Qp.exec(n),s,r,i,a,o;t?(s=[t[2]],r=t[3]):(t=Zp.exec(n))?(o=t[2].trim(),s=o?o.split($u):[],r=t[3]):(t=Xp.exec(n))&&(i=t[2],o=t[3].trim(),s=o?o.split($u):[],r=t[4]),r=r==null?void 0:r.trim(),e[Qa]=a=t&&{args:s,async:!!t[1],body:r!=null&&r.startsWith("{")?r.substring(1,r.length-1).trim():r},i&&(a.name=i)}return e[Qa]}static hookMethod(e,n,t){return t.$nextHook=e[n],e[n]=t,()=>{var s;if(em.call(e,n)){let r=e[n],i;if(r===t)((s=Object.getPrototypeOf(e))==null?void 0:s[n])===t.$nextHook?delete e[n]:e[n]=t.$nextHook;else for(;i=r==null?void 0:r.$nextHook;r=i)if(i===t){r.$nextHook=t.$nextHook;break}}}}static noThrow(e,n,t){const s=e[n];e[n]=(...r)=>{try{return s.apply(e,r)}catch(i){return t==null?void 0:t(i)}}}static returnTrue(){return!0}static animate(e,n,t,s="linear"){let r=!1;const i=new Promise(a=>{const o=performance.now(),l=()=>{const c=Math.min((performance.now()-o)/e,1),u=t&&t.setTimeout?t:globalThis;r||n.call(t,this.easingFunctions[s](c))===!1&&a(),r||c===1?u.requestAnimationFrame(()=>a()):u.requestAnimationFrame(l)};l()});return i.cancel=()=>(r=!0,i.cancelled=!0,!1),i}},ne=.5,rr=1.70158,ft=7.5625,Ks=1.525,Za=2/2.75,Xa=2.25/2.75,eo=1/2.75,to=1.5/2.75,ro=2.5/2.75,no=2.625/2.75,so=.75,io=.9375,ao=.984375,tm=1.70158,rm=1.70158;Et.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=ne)<1?ne*Math.pow(e,2):-ne*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=ne)<1?ne*Math.pow(e,3):ne*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=ne)<1?ne*Math.pow(e,4):-ne*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=ne)<1?ne*Math.pow(e,5):ne*(Math.pow(e-2,5)+2),easeInSine:e=>-Math.cos(e*(Math.PI/2))+1,easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-ne*(Math.cos(Math.PI*e)-1),easeInExpo:e=>e===0?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>e===1?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>e===0?0:e===1?1:(e/=ne)<1?ne*Math.pow(2,10*(e-1)):ne*(-Math.pow(2,-10*--e)+2),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=ne)<1?-ne*(Math.sqrt(1-e*e)-1):ne*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<eo?ft*e*e:e<Za?ft*(e-=to)*e+so:e<ro?ft*(e-=Xa)*e+io:ft*(e-=no)*e+ao,easeInBack:e=>e*e*((rr+1)*e-rr),easeOutBack:e=>(e=e-1)*e*((rr+1)*e+rr)+1,easeInOutBack:e=>{let n=tm;return(e/=ne)<1?ne*(e*e*(((n*=Ks)+1)*e-n)):ne*((e-=2)*e*(((n*=Ks)+1)*e+n)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((e*6-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let n=rm;return(e/=ne)<1?ne*(e*e*(((n*=Ks)+1)*e-n)):ne*((e-=2)*e*(((n*=Ks)+1)*e+n)+2)},swingFrom:e=>e*e*((rr+1)*e-rr),swingTo:e=>(e-=1)*e*((rr+1)*e+rr)+1,bounce:e=>e<eo?ft*e*e:e<Za?ft*(e-=to)*e+so:e<ro?ft*(e-=Xa)*e+io:ft*(e-=no)*e+ao,bouncePast:e=>e<eo?ft*e*e:e<Za?2-(ft*(e-=to)*e+so):e<ro?2-(ft*(e-=Xa)*e+io):2-(ft*(e-=no)*e+ao),easeFromTo:e=>(e/=ne)<1?ne*Math.pow(e,4):-ne*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},Et._$name="FunctionHelper";var{isArray:_u}=Array,{hasOwnProperty:nm}=Object.prototype,Fu={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1,$internal:1},ju=(e,n)=>n.prio-e.prio,Vt=e=>class Cc extends(e||$){constructor(){super(...arguments),F(this,"eventsSuspended",null)}static get $name(){return"Events"}static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(t,s){const r=s.getInherited("deprecatedEvents"),i=t.deprecatedEvents;for(const a in i)r[a.toLowerCase()]=r[a]=i[a]}static get configurable(){return{listeners:{value:null,$config:{merge(t,s){if(t!==null){if(!t)return s;s&&(t=t?[t]:[],t.push[_u(s)?"apply":"call"](t,s))}return t}}},internalListeners:null,bubbleEvents:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(t,...s){(this.configuredListeners=t==null?void 0:t.listeners)&&(t=_.assign({},t),delete t.listeners),super.construct(t,...s),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const t=this,{isConfiguring:s}=t;t.isConfiguring=!1,t.listeners=t.configuredListeners,t.configuredListeners=null,t.isConfiguring=s}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(!1),super.doDestroy()}static setupClass(t){super.setupClass(t),Cc.prototype.onListen.$nullFn=!0,Cc.prototype.onUnlisten.$nullFn=!0}addListener(t,s,r){var i;if(_u(t)){for(let l=0,{length:c}=t;l<c;l++)this.addListener(t[l],s);return}const a=this,o=a.$meta.getInherited("deprecatedEvents");if(typeof t=="string")return a.addListener({[t]:s,detachable:s.detachable!==!1,thisObj:r});{s=t.thisObj=t.thisObj!==void 0?t.thisObj:s;for(const d in t)if(!Fu[d]&&t[d]!=null){const h=d.toLowerCase(),f=o==null?void 0:o[h],g=a.eventListeners||(a.eventListeners={}),p=t[d],m=p.expires||t.expires,y={fn:typeof p=="object"?p.fn:p,thisObj:p.thisObj!==void 0?p.thisObj:s,args:p.args||t.args,prio:p.prio!==void 0?p.prio:t.prio!==void 0?t.prio:0,once:p.once!==void 0?p.once:t.once!==void 0?t.once:!1,buffer:p.buffer||t.buffer,throttle:p.throttle||t.throttle,$internal:t.$internal,catchAll:d==="catchAll"};if(f){const{product:E,invalidAsOfVersion:C,message:v}=f;Se.deprecate(E,C,v)}if(m){const{alt:E}=m,C=E?m.delay:m,v=t.name||d,S=()=>{a.un(h,y),E&&!y.called&&a.callback(E,s)};a.isDelayable?a.setTimeout({fn:S,name:v,cancelOutstanding:!0,delay:C}):globalThis.setTimeout(S,C)}let D=g[h]||(g[h]=[]);D.$firing&&(g[h]=D=D.slice()),D.splice(W.findInsertionIndex(y,D,ju,D.length),0,y),!a.onListen.$nullFn&&D.length<2&&a.onListen(h),(i=a.afterAddListener)==null||i.call(a,h,y)}t.relayAll&&a.relayAll(t.relayAll),s&&s!==a&&a.attachAutoDetacher(t,s);const l=t.detachable!==!1,c=t.name,u=t.expires||l||c?()=>{a.isDestroyed||a.removeListener(t,s)}:null;if(u&&(u.eventer=a,u.listenerName=c,c&&(s!=null&&s.trackDetacher)&&s.trackDetacher(c,u),t.expires&&a.delay(u,isNaN(t.expires)?t.expires.delay:t.expires,c),l))return u}}on(t,s,r){return this.addListener(t,s,r)}ion(t){return t.$internal=!0,this.on(t)}un(...t){this.removeListener(...t)}updateInternalListeners(t,s){s==null||s.detach(),t&&(t.detach=this.ion(t))}get listeners(){return this.eventListeners}changeListeners(t){if(this.isConfiguring)this.getConfig("internalListeners"),t&&this.on(t,this);else{if(Array.isArray(t))for(let s=0,r=t[0],{length:i}=t;s<i;r=t[++s])"thisObj"in r||(t[s]=_.assign({thisObj:this},r));else t&&!("thisObj"in t)&&(t=_.assign({thisObj:this},t));return t}}updateListeners(t,s){s&&this.un(s),t&&this.on(t)}removeListener(t,s=t.thisObj,r){const i=this;if(typeof t=="string")return i.removeListener({[t]:s},r);Object.entries(t).forEach(([a,o])=>{var l;if(!Fu[a]&&o!=null){a=a.toLowerCase();const{eventListeners:c}=i,u=i.findListener(a,o,s);if(u>=0){let d=c[a];(l=i.afterRemoveListener)==null||l.call(i,a,d[u]),d.length>1?(d.$firing&&(c[a]=d=d.slice()),d.splice(u,1)):(delete c[a],i.onUnlisten.$nullFn||i.onUnlisten(a))}}}),t.thisObj&&!t.thisObj.isDestroyed&&i.detachAutoDetacher(t)}findListener(t,s,r){var i;const a=(i=this.eventListeners)==null?void 0:i[t],o=s.fn||s,l=s.thisObj||r;if(a){for(let c,u=0,{length:d}=a;u<d;u++)if(c=a[u],c.fn===o&&c.thisObj===l)return u}return-1}hasListener(t){var s;return!!((s=this.eventListeners)!=null&&s[t==null?void 0:t.toLowerCase()])}relayAll(t,s,r=!0){this.relayAllTargets||(this.relayAllTargets=[]);const{relayAllTargets:i}=this;t.ion({beforeDestroy:({source:a})=>{a===t&&i.filter(l=>l.through===t).forEach(l=>W.remove(i,l))}}),i.push({through:t,prefix:s,transformCase:r})}removeAllListeners(t=!0){var s;const r=this.eventListeners;let i,a;for(const o in r){const l=r[o];for(i=l.length;i-- >0;){const c=l[i];(!c.$internal||!t)&&(this.removeListener(o,c),a=c.thisObj,(s=a==null?void 0:a.untrackDetachers)==null||s.call(a,this))}}}relayEvents(t,s,r=""){const i={detachable:!0,thisObj:this};return s.forEach(a=>{i[a]=(o,...l)=>this.trigger(r+a,o,...l)}),t.on(i)}onListen(){}onUnlisten(){}destructorInterceptor(){const{autoDetachers:t,target:s,oldDestructor:r}=this;for(let i=0;i<t.length;i++){const{dispatcher:a,config:o}=t[i];a.isDestroyed||a.removeListener(o,s)}r.call(s)}attachAutoDetacher(t,s){const r=t.thisObj||s,i="doDestroy"in r?"doDestroy":"destroy";if(i in r){let{$autoDetachers:a}=r;a||(r.$autoDetachers=a=[]),r.$oldDestructor||(r.$oldDestructor=r[i],r[i]=this.destructorInterceptor.bind({autoDetachers:a,oldDestructor:r.$oldDestructor,target:r})),a.push({config:t,dispatcher:this})}else r[i]=()=>{this.removeListener(t)}}detachAutoDetacher(t){const s=t.thisObj;s.$oldDestructor&&!s.isDestroying&&(W.remove(s.$autoDetachers,s.$autoDetachers.find(r=>r.config===t&&r.dispatcher===this)),s.$autoDetachers.length||(s["doDestroy"in s?"doDestroy":"destroy"]=s.$oldDestructor,s.$oldDestructor=null))}await(t,s={checkLog:!0,resetLog:!0,args:null}){const r=this;s===!1&&(s={checkLog:!1});const{args:i}=s;return new Promise(a=>{var o;if(s.checkLog&&((o=r._triggered)!=null&&o[t])&&(a(),s.resetLog&&r.clearLog(t)),i){const l=r.on({[t]:(...c)=>{(typeof i=="function"?i(...c):Object.keys(i).every(d=>d in c[0]&&c[0][d]===i[d]))&&(a(...c),s.resetLog&&r.clearLog(t),l())},prio:-1e4})}else r.on({[t]:(...l)=>{a(...l),s.resetLog&&r.clearLog(t)},prio:-1e4,once:!0})})}clearLog(t){this._triggered&&(t?delete this._triggered[t]:this._triggered={})}trigger(t,s){var r,i,a,o;const l=this,c=t.toLowerCase(),{eventsSuspended:u,relayAllTargets:d,callOnFunctions:h}=l;let f=(r=l.eventListeners)==null?void 0:r[c],g;if(l._triggered||(l._triggered={}),l._triggered[t]=!0,u)return u.shouldQueue&&u.queue.push(arguments),!0;if((i=l.eventListeners)!=null&&i.catchall&&((f=f?f.slice():[]).push(...l.eventListeners.catchall),f.sort(ju)),!f&&!d&&!h)return!0;if(s?"source"in s||(Object.isExtensible(s)?s.source=l:s=Object.setPrototypeOf({source:l},s)):s={source:l},s.type!==c&&(s.constructor!==Object?Reflect.defineProperty(s,"type",{get:()=>c}):s.type=c),s.eventName=t,!("bubbles"in s)&&((a=l.bubbleEvents)!=null&&a[t])&&(s.bubbles=l.bubbleEvents[t]),h){const m="on"+U.capitalize(t);if(m in l){const y=l[m]?l.callback(l[m],l,[s]):!0;let D;if(_.isPromise(y)?(g||(g=[])).push(y):D=y===!1||D,!l.isDestroyed&&nm.call(l,m)&&!((o=l.pluginFunctionChain)!=null&&o[m])){const E=Object.getPrototypeOf(l);if(m in E){const C=E[m].call(l,s);if(_.isPromise(C)?(g||(g=[])).push(C):D=C===!1||D,l.isDestroyed)return}}if(D)return!1}}let p;if(f){let m=0,y=!1;for(f.$firing=!0,m;m<f.length&&!l.isDestroyed&&!y;m++){const D=f[m];if(p===!1&&!D.$internal)continue;let E,C=D.thisObj;if(!C||!C.isDestroyed){if(D.called=!0,D.once&&l.removeListener(c,D),typeof D.fn=="string"){if(C&&(E=C[D.fn]),!E){const S=l.resolveCallback(D.fn);E=S.handler,C=S.thisObj}}else E=D.fn;if(D.buffer){if(!D.bufferFn){const S=Number(D.buffer);if(typeof S!="number"||isNaN(S))throw new Error(`Incorrect type for buffer, got "${S}" (expected a Number)`);D.bufferFn=Et.createBuffered(E,S,C,D.args)}E=D.bufferFn}if(D.throttle){const S=Number(D.throttle);if(typeof S!="number"||isNaN(S))throw new Error(`Incorrect type for throttle, got "${S}" (expected a Number)`);D.throttledFn||(D.throttledFn=Et.createThrottled(E,S,C,D.args)),E=D.throttledFn}const v=E.call(C||l,...D.args||[],s);p!==!1&&(p=v),D.$internal&&v===!1&&(y=!0),_.isPromise(v)&&(v.$internal=D.$internal,(g||(g=[])).push(v))}}if(f.$firing=!1,y)return!1}return d==null||d.forEach(m=>{let y=t;if(m.transformCase&&(y=U.capitalize(y)),m.prefix&&(y=m.prefix+y),m.through.trigger(y,s)===!1)return!1}),s.bubbles&&l.owner&&!l.owner.isDestroyed?l.owner.trigger(t,s):(g=g==null?void 0:g.filter(m=>p!==!1||m.$internal),g!=null&&g.length?new Promise(m=>{Promise.all(g).then(y=>{const D=!y.some(E=>E===!1);m(D)})}):p!==!1)}suspendEvents(t=!1){const s=this.eventsSuspended||(this.eventsSuspended={shouldQueue:t,queue:[],count:0});s.count++}resumeEvents(){const t=this.eventsSuspended;if(t&&--t.count===0&&(this.eventsSuspended=null,t.shouldQueue))for(const s of t.queue)this.trigger(...s);return!this.eventsSuspended}},kn=class{static mergeLocales(...e){const n={};return e.forEach(t=>{Object.keys(t).forEach(s=>{typeof t[s]=="object"?n[s]={...n[s],...t[s]}:n[s]=t[s]})}),n}static trimLocale(e,n){const t=(s,r)=>{e[s]&&(r?e[s][r]&&delete e[s][r]:delete e[s])};Object.keys(n).forEach(s=>{Object.keys(n[s]).length>0?Object.keys(n[s]).forEach(r=>t(s,r)):t(s)})}static normalizeLocale(e,n){if(!e)throw new Error('"nameOrConfig" parameter can not be empty');if(typeof e=="string"){if(!n)throw new Error('"config" parameter can not be empty');n.locale?n.name=e||n.name:n.localeName=e}else n=e;let t={};if(n.name||n.locale)t=Object.assign({localeName:n.name},n.locale),n.desc&&(t.localeDesc=n.desc),n.code&&(t.localeCode=n.code),n.path&&(t.localePath=n.path);else{if(!n.localeName)throw new Error(`"config" parameter doesn't have "localeName" property`);t=Object.assign({},n)}for(const s of["name","desc","code","path"])t[s]&&delete t[s];if(!t.localeName)throw new Error("Locale name can not be empty");return t}static get locales(){return globalThis.bryntum.locales||{}}static set locales(e){globalThis.bryntum.locales=e}static get localeName(){return globalThis.bryntum.locale||"En"}static set localeName(e){globalThis.bryntum.locale=e||kn.localeName}static get locale(){return kn.localeName&&this.locales[kn.localeName]||this.locales.En||Object.values(this.locales)[0]||{localeName:"",localeDesc:"",localeCoode:""}}static publishLocale(e,n){const{locales:t}=globalThis.bryntum,s=kn.normalizeLocale(e,n),{localeName:r}=s;return!t[r]||n===!0?t[r]=s:t[r]=this.mergeLocales(t[r]||{},s||{}),t[r]}},nt=kn;F(nt,"skipLocaleIntegrityCheck",!1),globalThis.bryntum=globalThis.bryntum||{},globalThis.bryntum.locales=globalThis.bryntum.locales||{},nt._$name="LocaleHelper";var sm=class extends Vt($){static get defaultConfig(){return{throwOnMissingLocale:Se.isTestEnv}}construct(...e){var n;const t=this;if(super.construct(...e),Oe.isBrowserEnv){const s=document.querySelector("script[data-default-locale]");s?t.applyLocale(s.dataset.defaultLocale):(n=t.locale)!=null&&n.localeName&&t.applyLocale(t.locale.localeName)}}get locales(){return nt.locales}set locales(e){nt.locales=e}set locale(e){this.applyLocale(e)}get locale(){return nt.locale}registerLocale(e,n){Se.deprecate("Core","6.0.0","LocaleManager.registerLocale deprecated, use LocaleHelper.publishLocale instead"),nt.publishLocale(e,n)}extendLocale(e,n){Se.deprecate("Core","6.0.0","LocaleManager.extendLocale deprecated, use LocaleManager.applyLocale instead");const t=nt.publishLocale(e,n);return this.applyLocale(t,!0)}applyLocale(e,n,t=!1){const s=this;let r;if(typeof e=="string")if(typeof n!="object"){if(r=s.locales[e],!r){if(t)return!0;throw new Error(`Locale "${e}" is not published. Publish with LocaleHelper.publishLocale() before applying.`)}}else r=nt.publishLocale(e,n);else r=nt.publishLocale(e);if(s.locale.localeName&&s.locale.localeName===r.localeName&&n!==!0)return s.locale;nt.localeName=r.localeName;const i=()=>{s.trigger("locale",r)};return r.localePath?new Promise((a,o)=>{s.loadLocale(r.localePath).then(l=>{l.text().then(c=>{new Function(c)(),Oe.isBrowserEnv&&(r=s.locales[r.localeName],r&&delete r.localePath),i(),a(r)})}).catch(l=>o(l))}):(i(),r)}loadLocale(e){return tr.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}},im=new sm,Ge=im,am=Object.getPrototypeOf(Object),ku=/L{.*?}/g,Lu=/L{(.*?)}/g,Bu=/((.*?)\.)?(.+)/g,om=e=>e.replace(/{(\d+)}/gm,"[[$1]]"),Nu=e=>e.replace(/\[\[(\d+)]]/gm,"{$1}"),lm=Object.freeze(Object.create(null)),gt=e=>class Ft extends(e||$){static get $name(){return"Localizable"}static get configurable(){return{localeClass:null,localizable:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(t){var s,r;return typeof t=="string"?t:t===am?"Object":t.$$name||t.name||((s=t.prototype)==null?void 0:s.$$name)||((r=t.prototype)==null?void 0:r.name)}static parseLocaleString(t){const s=[];let r;if(t!=null&&t.includes("L{"))for(t=om(t),Lu.lastIndex=0;(r=Lu.exec(t))!=null;){Bu.lastIndex=0;const i=Bu.exec(r[1]);s.push({match:Nu(r[0]),localeKey:Nu(i[3]),localeClass:i[2]})}return s.length>0?s:[{match:t,localeKey:t,localeClass:void 0}]}construct(t={},...s){super.construct(t,...s),Ge.ion({locale:"updateLocalization",thisObj:this}),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(t){var s,r,i;const a=this,o=_.getPath(a,t),l=((s=a.$meta.configs[t])==null?void 0:s.localeKey)||((i=(r=a.fieldMap)==null?void 0:r[t])==null?void 0:i.defaultValue);let c;return l?(c=Ft.localize(l,a,a.localeClass||a),c&&!(t in(a.initialConfig||lm))&&_.setPath(a.isColumn?a.data:a,t,c)):typeof o=="string"&&(a.originalLocales=a.originalLocales||{},c=_.getPath(a.originalLocales,t),c===void 0&&(_.setPath(a.originalLocales,t,o),c=o),c&&_.setPath(a,t,c=a.optionalL(c,a))),c||o}updateLocalization(){var t,s;this.localizable!==!1&&((t=this.localizableProperties)==null||t.forEach(this.localizeProperty,this),(s=this.trigger)==null||s.call(this,"localized"))}static getTranslation(t,s,r){const i=Ge.locale;let a=null,o,l;if(i)for(const{match:c,localeKey:u,localeClass:d}of this.parseLocaleString(t)){const h=g=>{var p;const m=(p=i[g])==null?void 0:p[u];return m&&(typeof m=="function"?a=s!=null?m(s):m:typeof m=="object"||t===c?a=m:a=(a||t).replace(c,m),typeof m=="string"&&m.includes("L{")&&(a=this.getTranslation(m,s,r))),m};let f=!1;for(l=r;l&&(o=Ft.clsName(l))&&!(f=h(o));l=Object.getPrototypeOf(l))if(typeof l=="string")break;!f&&d&&h(d)}return a}static localize(t,s=void 0,...r){(r==null?void 0:r.length)===0&&(r=[this]);let i=null;return r.some(a=>(i=Ft.getTranslation(t,s,a),i!=null)),i}static L(t,s=void 0,...r){(r==null?void 0:r.length)===0&&(r=[this]);const i=this.localize(t,s,...r);if(i==null&&Ge.throwOnMissingLocale&&t.includes("L{"))throw new Error(`Localization is not found for '${t}' in '${r.map(a=>Ft.clsName(a)).join(", ")}'. ${Ge.locale.localeName?`Locale : ${Ge.locale.localeName}`:""}`);return i!=null?i:t}L(t,s){const{localeClass:r,constructor:i}=this;return r&&Ft.clsName(r)!==Ft.clsName(i)?Ft.L(t,s,r,i):Ft.L(t,s,i)}static optionalL(t,s=void 0,...r){const i=Ge.throwOnMissingLocale;Ge.throwOnMissingLocale=i&&ku.test(t),(r==null?void 0:r.length)===0&&(r=[this]);const a=Ft.L(t,s,...r);return Ge.throwOnMissingLocale=i,a}optionalL(t,s=this,r=!1){const i=Ge.throwOnMissingLocale;Ge.throwOnMissingLocale=i&&ku.test(t)&&!r;const a=this.L(t,s);return Ge.throwOnMissingLocale=i,a}get localeManager(){return Ge}get localeHelper(){return nt}},cm={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{Yes:"Yes",No:"No",Cancel:"Cancel",Ok:"OK",Week:"Week"},ColorPicker:{noColor:"No color"},Combo:{noResults:"No results",recordNotCommitted:"Record could not be added",addNewValue:e=>`Add ${e}`},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:e=>`Value must be less than or equal to ${e.max}`,rangeUnderflow:e=>`Value must be greater than or equal to ${e.min}`,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},DatePicker:{gotoPrevYear:"Go to previous year",gotoPrevMonth:"Go to previous month",gotoNextMonth:"Go to next month",gotoNextYear:"Go to next year"},NumberFormat:{locale:"en-US",currency:"USD"},DurationField:{invalidUnit:"Invalid unit"},TimeField:{invalidTime:"Invalid time input"},TimePicker:{hour:"Hour",minute:"Minute",second:"Second"},List:{loading:"Loading...",selectAll:"Select All"},GridBase:{loadMask:"Loading...",syncMask:"Saving changes, please wait..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:e=>`of ${e.lastPage}`,summaryTemplate:e=>`Displaying records ${e.start} - ${e.end} of ${e.allCount}`},PanelCollapser:{Collapse:"Collapse",Expand:"Expand"},Popup:{close:"Close"},UndoRedo:{Undo:"Undo",Redo:"Redo",UndoLastAction:"Undo last action",RedoLastAction:"Redo last undone action",NoActions:"No items in the undo queue"},FieldFilterPicker:{equals:"equals",doesNotEqual:"does not equal",isEmpty:"empty",isNotEmpty:"not empty",contains:"contains",doesNotContain:"does not contain",startsWith:"starts with",endsWith:"ends with",isOneOf:"one of",isNotOneOf:"not one of",isGreaterThan:"greater than",isLessThan:"less than",isGreaterThanOrEqualTo:"greater than or equal to",isLessThanOrEqualTo:"less than or equal to",isBetween:"between",isNotBetween:"not between",isBefore:"before",isAfter:"after",isToday:"today",isTomorrow:"tomorrow",isYesterday:"yesterday",isThisWeek:"this week",isNextWeek:"next week",isLastWeek:"last week",isThisMonth:"this month",isNextMonth:"next month",isLastMonth:"last month",isThisYear:"this year",isNextYear:"next year",isLastYear:"last year",isYearToDate:"year to date",isTrue:"true",isFalse:"false",selectAProperty:"Select a property",selectAnOperator:"Select an operator",caseSensitive:"Case-sensitive",and:"and",dateFormat:"D/M/YY",selectOneOrMoreValues:"Select one or more values",enterAValue:"Enter a value",enterANumber:"Enter a number",selectADate:"Select a date"},FieldFilterPickerGroup:{addFilter:"Add filter"},DateHelper:{locale:"en-US",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"},{single:"decade",plural:"decades",abbrev:"dec"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A"},ordinalSuffix:e=>{const n=["11","12","13"].find(s=>e.endsWith(s));let t="th";if(!n){const s=e[e.length-1];t={1:"st",2:"nd",3:"rd"}[s]||"th"}return e+t}}},Fy=nt.publishLocale(cm),{toString:Vu}=Object.prototype,um=Vu.call(new Date),Js=new Date,oo=1e3*60*60,lo=(e,n)=>isNaN(e)||e==null?n:e,dm=/([ES]){([^}]+)}/g,Uu=e=>{const n=["11","12","13"].find(s=>e.endsWith(s));let t="th";if(!n){const s=e[e.length-1];t={1:"st",2:"nd",3:"rd"}[s]||"th"}return e+t},Ae=(e,n,t)=>(sr[e]||(sr[e]=new Intl.DateTimeFormat(nr,n))).format(t),Ln=(e,n,t,s=!1)=>{let r=Ae(e,n,t);return/am|pm/i.test(r)&&(r=r.replace(/^0/,""),s&&(r=r.replace(/:00/,""))),r},hm=(e,n)=>Math.floor((e.getTime()-n.getTime()-(e.getTimezoneOffset()-n.getTimezoneOffset())*He.minute.millisecond)/He.day.millisecond)+1,Wu=e=>e>=0?e:e+7,fm=/([^\w])(S+)/gm,gm=(e,n)=>n+"SSS",zu=/[:.\-/\s]/,nr="en-US",Ut=Uu,Qs={},Bn={},sr={},co={},qu=e=>{const n=uo[e];if(!n)throw new Error("Only international formats should be used here");if(Bn[e]!==void 0)return Bn[e];const t=new Intl.DateTimeFormat(nr,n),s=t.formatToParts(new Date(2001,1,2,3,4,5,6)).map(r=>{const i=r.type,a=n[i];if(i==="literal")return r.value.replace(/,/g,"");if(i==="day")return a==="numeric"?"D":"DD";if(i==="month")return a==="short"?"MMM":a==="long"?"MMMM":a==="numeric"?"M":"MM";if(i==="year")return a==="numeric"?"YYYY":"YY"}).join("");return Bn[e]=s},Gu=2020,Hu=0,Yu=1,uo={l:{year:"numeric",month:"numeric",day:"numeric"},ll:{year:"numeric",month:"short",day:"numeric"}},Re={M:e=>e.getMonth()+1,Mo:e=>Ut(Re.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>Ae("MMM",{month:"short"},e),MMMM:e=>Ae("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/3),Qo:e=>Ut(Re.Q(e).toString()),D:e=>e.getDate(),Do:e=>Ut(Re.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/He.day.millisecond),DDDo:e=>Ut(Re.DDD(e).toString()),DDDD:e=>Re.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>Ut(e.getDay().toString()),d1:e=>Ae("d1",{weekday:"narrow"},e).substr(0,1),dd:e=>Re.ddd(e).substring(0,2),ddd:e=>Ae("ddd",{weekday:"short"},e),dddd:e=>Ae("dddd",{weekday:"long"},e),u:e=>{const n=sr.u||(sr.u=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"})),t=n.formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}Z`},uu:e=>{const n=sr.uu||(sr.uu=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),t=n.formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}T${t[6].value}${t[8].value}${t[10].value}Z`},e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>R.getWeekNumber(e)[1],Wo:e=>Ut(Re.W(e).toString()),WW:e=>Re.W(e).toString().padStart(2,"0"),Wp:e=>`${R.localize("L{Week}")} ${Re.W(e)}`,WWp:e=>`${R.localize("L{Week}")} ${Re.WW(e)}`,Wp0:e=>`${R.localize("L{Week}")[0]}${Re.W(e)}`,WWp0:e=>`${R.localize("L{Week}")[0]}${Re.WW(e)}`,Y:e=>e.getFullYear(),YY:e=>(e.getFullYear()%100).toString().padStart(2,"0"),YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>Re.h(e).toString().padStart(2,"0"),k:e=>e.getHours()||24,kk:e=>Re.k(e).toString().padStart(2,"0"),K:e=>Ln("K",{hour:"numeric"},e),KK:e=>Ln("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>Re.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>Re.s(e).toString().padStart(2,"0"),S:e=>Math.floor(e.getMilliseconds()/100).toString(),SS:e=>Math.floor(e.getMilliseconds()/10).toString().padStart(2,"0"),SSS:e=>e.getMilliseconds().toString().padStart(3,"0"),z:e=>Ae("z",{timeZoneName:"short"},e),zz:e=>Ae("zz",{timeZoneName:"long"},e),Z:e=>P.getGMTOffset(e),LT:e=>Ln("LT",{hour:"2-digit",minute:"2-digit"},e),LST:e=>Ln("LST",{hour:"numeric",minute:"2-digit"},e,!0),LTS:e=>Ln("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>Ae("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>Ae("l",uo.l,e),LL:e=>Ae("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>Ae("ll",uo.ll,e),LLL:e=>Ae("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>Ae("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>Ae("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>Ae("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},pm=Object.keys(Re).sort((e,n)=>n.length-e.length),mm=`^(?:${pm.join("|")})`,je=()=>({}),vm=e=>Im.test(e),ho=e=>vm(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))},Ku={YYYY:e=>{const n=parseInt(e);return{year:n>=1e3&&n<=9999?n:NaN}},Y:e=>({year:parseInt(e)}),YY:e=>{const n=parseInt(e);return{year:n+(n>1968?1900:2e3)}},M:e=>({month:parseInt(e)-1}),MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),MMM:e=>{const n=(e||"").toLowerCase();for(const[t,s]of Object.entries(R._monthShortNamesIndex))if(n.startsWith(t))return{month:s.value}},MMMM:e=>{const n=(e||"").toLowerCase();for(const[t,s]of Object.entries(R._monthNamesIndex))if(n.startsWith(t))return{month:s.value}},DD:e=>({date:parseInt(e)}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:je,DDDo:je,DDDD:je,d:je,do:je,d1:je,dd:je,ddd:je,dddd:je,Q:je,Qo:je,W:je,Wo:je,WW:je,e:je,E:je,HH:e=>({hours:parseInt(e)}),hh:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:ho,SS:ho,SSS:ho,A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A",l:{type:"dynamic",parser:()=>qu("l")},ll:{type:"dynamic",parser:()=>qu("ll")},Z:e=>{if(!e||!Zu.test(e)&&e!=="Z")return null;let n=0;if(e!=="Z"){const t=Zu.exec(e);if(t){const s=t[1]==="+"?1:-1,r=parseInt(t[2])||0,i=parseInt(t[3])||0;n=s*(r*60+i)}else n=-1*new Date().getTimezoneOffset()}return{timeZone:n}}},ym=Object.keys(Ku).sort((e,n)=>n.length-e.length),Ju=new RegExp(`(${ym.join("|")})`),Sm=new RegExp("^(LL|LLL|lll|LLLL|llll)$"),He={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:24*3652,minute:1440*3652,second:86400*3652,millisecond:864e5*3652},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:24*365,minute:1440*365,second:86400*365,millisecond:864e5*365},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:24*91,minute:1440*91,second:86400*91,millisecond:864e5*91},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-24*30,minute:-1440*30,second:-86400*30,millisecond:-864e5*30},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/(3652*24),year:-1/(365*24),quarter:-1/(91*24),month:-1/(30*24),week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/(3652*1440),year:-1/(365*1440),quarter:-1/(91*1440),month:-1/(30*1440),week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/(3652*86400),year:-1/(365*86400),quarter:-1/(91*86400),month:-1/(30*86400),week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/(3652*864e5),year:-1/(365*864e5),quarter:-1/(91*864e5),month:-1/(30*864e5),week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:1/1e3}},Qu={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",mi:"minute",min:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",mo:"month",mon:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year",dec:"decade",decades:"decade"},Dm=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,Cm=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,nn=["millisecond","second","minute","hour","day","week","month","quarter","year","decade"],Em=[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],fo=["decade","year","month","week","day","hour","minute","second","millisecond"],bm=["milliseconds","seconds","minutes","hours","date","month","year"],Rm=e=>{const n=parseFloat(e);return isNaN(n)?null:n},Im=/^[0-9]+$/,Zu=/([+-])(\d\d):*(\d\d)*$/,ir={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8,decade:9},Pm={round(e,n=1){return Math.round(e/n)*n},floor(e,n=1){return Math.floor(e/n)*n},ceil(e,n=1){return Math.ceil(e/n)*n}},Xu={},Wt=class extends gt(){static get $name(){return"DateHelper"}static set defaultFormat(e){P._defaultFormat=e}static get defaultFormat(){return P._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static buildParser(e){const n=e.split(Ju),t=[];return n.length===1||Sm.test(e)?[]:(n.reduce((s,r,i,a)=>{if(i!==0||r!=="")if(Ju.test(r)){const o=this.localize("L{parsers}")||{},l=o[r]||Ku[r];if(r==="Z"&&i<a.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);const c=typeof l=="function"||typeof l=="string"?l:l.parser();if(typeof c=="string"){const u=P.buildParser(c),d=u.pop();delete d.last,t.push(...u),s=d}else s.pattern=r,s.fn=c}else s.splitter=r,t.push(s),s={};else Object.prototype.hasOwnProperty.call(s,"pattern")&&t.push(s);return s},{}),t[t.length-1].last=!0,t)}static makeKey(e){if(e.length===10)return e;e.getTime&&(e=e.getTime());const n=Xu[Math.trunc(e/oo)];if(n)return n;Js.setTime(e);const t=Js.getMonth()+1,s=Js.getDate();return Xu[Math.trunc(e/oo)]=`${Js.getFullYear()}-${t<10?"0"+t:t}-${s<10?"0"+s:s}`}static parseKey(e){return P.parse(e,"YYYY-MM-DD")}static parse(e,n=P.defaultParseFormat,t=!1){if(e instanceof Date)return e;if(typeof e!="string"||!e)return null;const s={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};n=n.replace(fm,gm);let r=co[n],i;if(r||(r=co[n]=P.buildParser(n)),e.includes("\u202F")&&(e=e.replace(/\s/g," ")),r.reduce((o,l)=>{var c;if(l.last)Object.assign(s,l.fn(o));else{let u;if(l.splitter==="T"&&o.indexOf("T")===-1)u=o.indexOf(" ");else{const f=o.indexOf("+");let{splitter:g}=l;!t&&zu.test(g)&&(g=zu),u=l.splitter!==""?o.search(typeof g=="string"?U.escapeRegExp(g):g):((c=l.pattern)==null?void 0:c.length)||-1,f>-1&&u>f&&(u=-1)}let d,h;if(u===-1||l.pattern==="SSS"&&o.match(/^\d+Z$/)){const f=o.split(/([Z\-+])/);f.length===1?(d=o,h=""):(d=f[0],h=`${f[1]}${f[2]}`)}else d=o.substring(0,u)||o,h=o.substring(u+l.splitter.length);if(l.fn){const f=l.fn(d);f?Object.assign(s,f):h=d+h}return h}},e),s.year&&!s.date&&(s.date=1),s.date>31||s.month>12)return null;const a=P.create(s,t);return a?i=a:t||(i=new Date(e)),i}static create(e,n=!1){const t={...e};let s=isNaN(t.year)||n&&(isNaN(t.month)||isNaN(t.date)),r=!1;if(!s){let a=!0;bm.forEach(o=>{(!(o in t)||isNaN(t[o]))&&(t[o]=0),a=a&&t[o]===null}),s=a}if(s||(t.amPm==="am"?t.hours=t.hours%12:t.amPm==="pm"&&(t.hours=t.hours%12+12),"timeZone"in t&&(r=!0,t.minutes-=t.timeZone),n&&(t.year==null||t.month==null||t.date==null)))return null;const i=[lo(t.year,Gu),lo(t.month,Hu),lo(t.date,Yu),t.hours,t.minutes,t.seconds,t.milliseconds];return r?new Date(Date.UTC(...i)):new Date(...i)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,n=P.defaultFormat){if(!e||isNaN(e))return null;let t=Qs[n],s="";if(!t){t=Qs[n]=[];for(let r=0;r<n.length;r++){const i=n.slice(r).match(mm),a=i==null?void 0:i[0];if(a){const o=this.localize("L{formats}")||{},l=o[a]||Re[a];t.push(l),r+=a.length-1}else if(n[r]==="{"){const o=n.indexOf("}",r+1);o===-1?(t.push(n.substr(r+1)),r=n.length):(t.push(n.substring(r+1,o)),r=o)}else t.push(n[r])}}return t.forEach(r=>{typeof r=="string"?s+=r:s+=r(e)}),s}static formatRange(e,n){return n.replace(dm,(t,s,r)=>Wt.format(e[s==="S"?0:1],r))}static asMilliseconds(e,n=null){return typeof e=="string"&&(n=e,e=1),P.as("millisecond",e,n)}static asMonths(e){const n=P.as("ms",P.daysInMonth(e),"day"),t=(e.valueOf()-P.startOf(e,"month").valueOf())/n;return e.getYear()*12+e.getMonth()+t}static monthsToDate(e){const n=Math.floor(e),t=e-n,s=new Date(0,n),r=P.as("ms",P.daysInMonth(s),"days");return s.setTime(s.getTime()+t*r),s}static formatDelta(e,n){let t,s;typeof n=="boolean"?t=n:n&&(t=n.abbrev);const r=this.getDelta(e,n),i=[],a=(n==null?void 0:n.separator)||(t?"":" ");for(s in r)i.push(`${r[s]}${a}${s}`);return(n==null?void 0:n.asString)===!1?i:i.join(", ")}static getDelta(e,n){let t,s,r,i,a,o,l;typeof n=="boolean"?t=n:n&&(t=n.abbrev,i=P.normalizeUnit(n.precision),o=n.maxUnit,l=!t&&n.ignoreLocale);const c={},u=t?P.getShortNameOfUnit:P.getLocalizedNameOfUnit,d=o?fo.slice(fo.indexOf(o)):fo;for(a of d)if(s=P.as(a,e),r=i===a,s=Math[r?"round":"floor"](s),(s||r&&!c.length)&&(c[l?a:u.call(P,a,s!==1)]=s,e-=P.as("ms",s,a)),r||!e)break;return c}static as(e,n,t="ms"){return typeof n=="string"&&(n=P.parseDuration(n)),typeof n=="object"&&(t=n.unit,n=n.magnitude),e===t||(e=P.normalizeUnit(e),t=P.normalizeUnit(t),e===t)?n:ir[t]>ir[e]?n*Math.abs(He[t][e]):n/Math.abs(He[e][t])}static formatContainsHourInfo(e){const n=/(\\.)/g;return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(n,""))}static is24HourFormat(e){return P.format(P.getTime(13,0,0),e).includes("13")}static add(e,n,t="ms",s=!0){let r;if(typeof e=="string"?r=P.parse(e):s?r=new Date(e.getTime()):r=e,typeof n=="string"){const i=Wt.parseDuration(n);n=i.magnitude,t=i.unit}else n&&typeof n=="object"&&(t=n.unit,n=n.magnitude);if(!t||n===0)return r;switch(t=P.normalizeUnit(t),t){case"millisecond":r.setTime(r.getTime()+n);break;case"second":r.setTime(r.getTime()+n*1e3);break;case"minute":r.setTime(r.getTime()+n*6e4);break;case"hour":r.setTime(r.getTime()+n*36e5);break;case"day":n%1===0?(r.setDate(r.getDate()+n),r.getHours()===23&&e.getHours()===0&&r.setHours(r.getHours()+1)):r.setTime(r.getTime()+n*864e5);break;case"week":r.setDate(r.getDate()+n*7);break;case"month":{let i=r.getDate();i>28&&(i=Math.min(i,P.getLastDateOfMonth(P.add(P.getFirstDateOfMonth(r),n,"month")).getDate())),r.setDate(i),r.setMonth(r.getMonth()+n);break}case"quarter":P.add(r,n*3,"month",!1);break;case"year":r.setFullYear(r.getFullYear()+n);break;case"decade":r.setFullYear(r.getFullYear()+n*10);break}return r}static diff(e,n,t="ms",s=!0){if(t=P.normalizeUnit(t),!e||!n)return 0;let r;switch(t){case"year":r=P.diff(e,n,"month")/12;break;case"quarter":r=P.diff(e,n,"month")/3;break;case"month":r=(n.getFullYear()-e.getFullYear())*12+(n.getMonth()-e.getMonth()),r===0&&s&&(r=P.diff(e,n,"day",s)/P.daysInMonth(e));break;case"week":r=P.diff(e,n,"day")/7;break;case"day":{const i=e.getTimezoneOffset()-n.getTimezoneOffset();r=(n-e+i*60*1e3)/864e5;break}case"hour":r=(n-e)/36e5;break;case"minute":r=(n-e)/6e4;break;case"second":r=(n-e)/1e3;break;case"millisecond":r=n-e;break}return s?r:Math.round(r)}static startOf(e,n="day",t=!0,s=P.weekStartDay){if(!e)return null;switch(n=P.normalizeUnit(n),t&&(e=P.clone(e)),n){case"year":return e.setMonth(0,1),e.setHours(0,0,0,0),e;case"quarter":return e.setMonth((P.get(e,"quarter")-1)*3,1),e.setHours(0,0,0,0),e;case"month":return e.setDate(1),e.setHours(0,0,0,0),e;case"week":{const r=e.getDay()-s;return e.setDate(e.getDate()-r),e.setHours(0,0,0,0),e}case"day":return e.setHours(0,0,0,0),e;case"hour":e.getMinutes()>0&&e.setMinutes(0);case"minute":e.getSeconds()>0&&e.setSeconds(0);case"second":e.getMilliseconds()>0&&e.setMilliseconds(0);case"millisecond":return e}}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,n=!0){return e?(n&&(e=new Date(e.getTime())),e.setHours(0,0,0,0),e):null}static midnight(e,n){let t=P.clearTime(e);return n&&t<e&&(t=P.add(t,1,"d")),t}static getTimeOfDay(e,n="ms"){const t=e.getHours()*He.hour.millisecond+e.getMinutes()*He.minute.millisecond+e.getSeconds()*He.second.millisecond+e.getMilliseconds();return n==="ms"?t:P.as(n,t,"ms")}static set(e,n,t){if(!n)return e;if(typeof n=="string")switch(P.normalizeUnit(n)){case"millisecond":(t!==0||e.getMilliseconds()>0)&&e.setMilliseconds(t);break;case"second":(t!==0||e.getSeconds()>0)&&e.setSeconds(t);break;case"minute":(t!==0||e.getMinutes()>0)&&e.setMinutes(t);break;case"hour":e.setHours(t);break;case"day":case"date":e.setDate(t);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(t);break;case"quarter":e.setDate(1),e.setMonth((t-1)*3);break;case"year":e.setFullYear(t);break}else Object.entries(n).sort((s,r)=>ir[s[0]]-ir[r[0]]).forEach(([s,r])=>{P.set(e,s,r)});return e}static setDateToMidday(e,n=!0){return P.set(P.clearTime(e,n),"hour",12)}static constrain(e,n,t){return n!=null&&(e=P.max(e,n)),t==null?e:P.min(e,t)}static getTime(e,n=0,t=0,s=0){return e instanceof Date&&(s=e.getMilliseconds(),t=e.getSeconds(),n=e.getMinutes(),e=e.getHours()),new Date(Gu,Hu,Yu,e,n,t,s)}static copyTimeValues(e,n){return e.setHours(n.getHours()),e.setMinutes(n.getMinutes()),e.setSeconds(n.getSeconds()),e.setMilliseconds(n.getMilliseconds()),e}static get isDSTEnabled(){const e=new Date().getFullYear(),n=new Date(e,0,1),t=new Date(e,6,1);return n.getTimezoneOffset()!==t.getTimezoneOffset()}static isDST(e){const n=e.getFullYear(),t=new Date(n,0,1),s=new Date(n,6,1);return e.getTimezoneOffset()<Math.max(t.getTimezoneOffset(),s.getTimezoneOffset())}static isBefore(e,n){return e<n}static isAfter(e,n){return e>n}static isEqual(e,n,t=null){return t===null?e&&n&&e.getTime()===n.getTime():P.startOf(e,t)-P.startOf(n,t)===0}static compare(e,n,t=null){return t&&(e=P.startOf(e,t),n=P.startOf(n,t)),e<n?-1:e>n?1:0}static clamp(e,n,t){if(!isNaN(e))return n!=null&&(e=Math.max(e,n)),t!=null&&(e=Math.min(e,t)),new Date(e)}static isSameDate(e,n){return P.compare(e,n,"d")===0}static isSameTime(e,n){return e.getHours()===n.getHours()&&e.getMinutes()===n.getMinutes()&&e.getSeconds()===n.getSeconds()&&e.getMilliseconds()===n.getMilliseconds()}static isStartOf(e,n){return P.isEqual(e,P.startOf(e,n))}static betweenLesser(e,n,t){return n.getTime()<=e.getTime()&&e.getTime()<t.getTime()}static betweenLesserEqual(e,n,t){return n.getTime()<=e.getTime()&&e.getTime()<=t.getTime()}static intersectSpans(e,n,t,s){return P.betweenLesser(e,t,s)||P.betweenLesser(t,e,n)}static compareUnits(e,n){return Math.sign(ir[P.normalizeUnit(e)]-ir[P.normalizeUnit(n)])}static timeSpanContains(e,n,t,s){return t-e>=0&&n-s>=0}static get weekStartDay(){return P._weekStartDay==null&&(P._weekStartDay=this.localize("L{weekStartDay}")||0),P._weekStartDay}static get nonWorkingDays(){return{...this.localize("L{nonWorkingDays}")}}static get nonWorkingDaysAsArray(){return Object.keys(this.nonWorkingDays).map(Number)}static get weekends(){return{...this.localize("L{weekends}")}}static get(e,n){switch(P.normalizeUnit(n)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return Re.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInYear(e){const n=e.getFullYear(),t=new Date(n+1,0,1)-new Date(n,0,1);return this.as("day",t)}static daysInMonth(e){return 32-new Date(e.getFullYear(),e.getMonth(),32).getDate()}static hoursInDay(e){const n=e.getFullYear(),t=e.getMonth(),s=e.getDate(),r=new Date(n,t,s+1)-new Date(n,t,s);return this.as("hour",r)}static getNormalizedUnitDuration(e,n){let t;switch(n){case"month":t=P.asMilliseconds(P.daysInMonth(e),"day");break;case"year":t=P.asMilliseconds(P.daysInYear(e),"day");break;case"day":t=P.asMilliseconds(P.hoursInDay(e),"hour");break;default:t=P.asMilliseconds(n)}return t}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,n){return e.getTime()<n.getTime()?e:n}static max(e,n){return e.getTime()>n.getTime()?e:n}static getNext(e,n,t=1,s=P.weekStartDay){if(n==="week"){const r=P.clone(e),i=r.getDay();return P.startOf(r,"day",!1),P.add(r,s-i+7*(t-(s<=i?0:1)),"day",!1),r.getDay()!==s&&P.add(r,1,"hour"),r}return P.startOf(P.add(e,t,n),n,!1)}static isValidDate(e){return P.isDate(e)&&!isNaN(e)}static isDate(e){return e&&Vu.call(e)===um}static getStartOfNextDay(e,n=!1,t=!1){let s=P.add(t?e:P.clearTime(e,n),1,"day");if(s.getDate()===e.getDate()){const r=P.add(P.clearTime(e,n),2,"day").getTimezoneOffset(),i=e.getTimezoneOffset();s=P.add(s,i-r,"minute")}return s}static getEndOfPreviousDay(e,n=!1){const t=n?e:P.clearTime(e,!0);return t-e?t:P.add(t,-1,"day")}static getWeekDescription(e,n=e){const t=e.getMonth()===n.getMonth()?Wt.format(e,"MMMM"):`${Wt.format(e,"MMM")} - ${Wt.format(n,"MMM")}`,s=Wt.getWeekNumber(e);return`${s[1]}, ${t} ${s[0]}`}static getWeekNumber(e,n=Wt.weekStartDay){const t=new Date(e.getFullYear(),0,1),s=new Date(e.getFullYear(),11,31),r=Wu(t.getDay()-n),i=Wu(s.getDay()-n),a=hm(e,t);let o;if(r<4?o=Math.floor((a+r-1)/7)+1:o=Math.floor((a+r-1)/7),o){let c=e.getFullYear();return o===53&&i<3&&(c++,o=1),[c,o]}const l=Wt.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,l]}static formatCount(e,n){return n=P.normalizeUnit(n),e!==1&&(n+="s"),e+" "+n}static getUnitToBaseUnitRatio(e,n,t=!1){return e=P.normalizeUnit(e),n=P.normalizeUnit(n),e===n?1:He[e]&&He[e][n]&&(t||He[e][n]>0)?1/P.as(n,1,e):He[n]&&He[n][e]&&(t||He[n][e]>0)?P.as(e,1,n):-1}static getShortNameOfUnit(e){return e=P.parseTimeUnit(e),P.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,n=!1){const t=e.charAt(0)===e.charAt(0).toUpperCase();return e=P.normalizeUnit(e),e=P.parseTimeUnit(e),e=P.unitLookup[e][n?"plural":"single"],t&&(e=U.capitalize(e)),e}static normalizeUnit(e){if(!e)return null;const n=e.toLowerCase();return n==="date"||nn.includes(n)?n:Qu[e]||Qu[n]}static getUnitByName(e){return P.normalizeUnit(e)||P.normalizeUnit(P.parseTimeUnit(e))}static getDurationInUnit(e,n,t,s){return P.diff(e,n,t,s)}static doesUnitsAlign(e,n){return!(e!==n&&n==="week")}static getSmallerUnit(e){return nn[ir[P.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return nn[ir[P.normalizeUnit(e)]+1]||null}static round(e,n,t,s){return P.snap("round",e,n,t,s)}static floor(e,n,t,s){return P.snap("floor",e,n,t,s)}static ceil(e,n,t,s){return P.snap("ceil",e,n,t,s)}static snap(e,n,t,s,r=P.weekStartDay){const i=Pm[e];if(typeof t=="string"&&(t=P.parseDuration(t)),_.isObject(t)){const a=t.magnitude||t.increment;switch(t.unit){case"week":{const o=n.getDay();return s=P.add(P.clearTime(n),o>=r?r-o:-(o-r+7),"day"),P[e](n,`${a*7} days`,s)}case"month":{n=P.asMonths(n);let o;return s?(s=P.asMonths(s),o=n+i(n-s,a)):o=i(n,a),P.monthsToDate(o)}case"quarter":return P[e](n,`${a*3} months`,s);case"year":return P[e](n,`${a*12} months`,s);case"decade":return P[e](n,`${a*10} years`,s)}t=P.as("ms",a,t.unit)}if(s){const a=P.as("ms",s.getTimezoneOffset()-n.getTimezoneOffset(),"ms");return new Date(s.valueOf()+i(P.diff(s,n,"ms")+a,t))}else{const a=n.getTimezoneOffset()*60*1e3;return new Date(i(n.valueOf()-a,t)+a)}}static parseDuration(e,n=!0,t){var s;const r=n?Dm:Cm,i=r.exec(e);if(e==null||!i)return null;const a=Rm((s=i[1])==null?void 0:s.replace(",",".")),o=P.parseTimeUnit(i[2])||t;return o?{magnitude:a,unit:o}:null}static parseTimeUnit(e){const n=e==null?null:P.durationRegEx.exec(e.toLowerCase());if(!n)return null;for(let t=0;t<nn.length;t++)if(n[t+1])return nn[t]}static getGMTOffset(e=new Date){if(!e)return;const n=e.getTimezoneOffset();return n?(n>0?"-":"+")+Math.abs(Math.trunc(n/60)).toString().padStart(2,"0")+":"+Math.abs(n%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),n=P._dayNames||[],t=P._dayShortNames||[];n.length=0,t.length=0;for(let s=2;s<9;s++)e.setDate(s),n.push(P.format(e,"dddd")),t.push(P.format(e,"ddd"));P._dayNames=n,P._dayShortNames=t}static getDayNames(){return P._dayNames}static getDayName(e){return P._dayNames[e]}static getDayShortNames(){return P._dayShortNames}static getDayShortName(e){return P._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),n=P._monthNames||[],t=P._monthShortNames||[],s={},r={};n.length=0,t.length=0;for(let i=0;i<12;i++){e.setMonth(i);const a=P.format(e,"MMMM");n.push(a);const o=P.format(e,"MMM");t.push(o),s[a.toLowerCase()]={name:a,value:i},r[o.toLowerCase()]={name:o,value:i}}P._monthNames=n,P._monthShortNames=t,P._monthNamesIndex=s,P._monthShortNamesIndex=r}static getMonthShortNames(){return P._monthShortNames}static getMonthShortName(e){return P._monthShortNames[e]}static getMonthNames(){return P._monthNames}static getMonthName(e){return P._monthNames[e]}static set locale(e){nr=e,sr={},Qs={},Bn={}}static get locale(){return nr}static setupDurationRegEx(e=[],n=[]){const t=this,s={};let r="";for(let i=0;i<n.length;i++){const a=n[i],o=e[i];o.canonicalUnitName=nn[i],s[o.single]=s[o.single.toUpperCase()]=s[o.canonicalUnitName]=s[o.canonicalUnitName.toUpperCase()]=o,r+=`${i?"|":""}(`;for(let l=0;l<a.length;l++)r+=`${a[l]}|`;if(nr=t.localize("L{locale}")||"en-US",nr!=="en-US"){const l=Em[i];for(let c=0;c<l.length;c++)r+=`${l[c]}|`}r+=`${o.single}|${o.plural}|${o.canonicalUnitName}|${o.canonicalUnitName}s)`}t.unitLookup=s,t.durationRegEx=new RegExp(`^(?:${r})$`)}static applyLocale(){const e=this,n=e.localize("L{unitAbbreviations}")||[],t=e.unitNames=e.localize("L{unitNames}");t!=="unitNames"&&(nr=e.localize("L{locale}")||"en-US",nr==="en-US"?Ut=Uu:Ut=e.localize("L{ordinalSuffix}")||Ut,Qs={},Bn={},co={},sr={},P._weekStartDay=null,P.setupDurationRegEx(t,n),P.fillDayNames(),P.fillMonthNames())}},R=Wt;F(R,"MS_PER_DAY",oo*24);var P=R;P.useIntlFormat=Ae,Ge.ion({locale:"applyLocale",prio:1e3,thisObj:P}),Ge.locale&&P.applyLocale(),R._$name="DateHelper";var ed=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},go=class extends O([en],e=>class extends e{constructor(){super(...arguments),this.identifierCls=rd}}){},td=(e,n=go)=>qe(e,n),po=class extends O([ut],e=>{class n extends e{constructor(){super(...arguments),this.field=void 0,this.proposedValueIsBuilt=!0}hasBucket(){return!!this.field.bucket}getBucket(s){return s.$[this.field.bucket]}buildProposedValue(s,r,i){const a=r.proposedValue;if(a===null)return null;const o=ze(a,xt)?a:s.resolve(a);return o&&s.hasBucket()&&s.getBucket(o).addToBucket(i,s.self),o}resolve(s){const r=this.field.resolver;return r?r.call(this.self,s):null}enterGraph(s){if(this.hasBucket()){const r=s.activeTransaction.readProposedOrPrevious(this);r instanceof xt&&this.getBucket(r).addToBucket(s.activeTransaction,this.self)}super.enterGraph(s)}leaveGraph(s){if(this.hasBucket()){const r=s.activeTransaction.readProposedOrPrevious(this);r instanceof xt&&this.getBucket(r).removeFromBucket(s.activeTransaction,this.self)}super.leaveGraph(s)}write(s,r,i,a,...o){const l=i||r.acquireQuarkIfExists(s);if(s.hasBucket()){if(l){const c=l.getValue();c instanceof xt&&s.getBucket(c).removeFromBucket(r,s.self)}else if(r.baseRevision.hasIdentifier(s)){const c=r.readPrevious(s);c instanceof xt&&s.getBucket(c).removeFromBucket(r,s.self)}}super.write(s,r,i,a)}}return ed([G(wt.DependsOnlyOnUserInput)],n.prototype,"level",void 0),ed([G(Zr)],n.prototype,"quarkClass",void 0),n}){},rd=class extends po.mix(ut.mix(Xr)){},nd=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},mo=class extends O([en],e=>class extends e{constructor(){super(...arguments),this.persistent=!1,this.identifierCls=od}}){},sd=(e,n=mo)=>qe(e,n),sn;(function(e){e.Add="Add",e.Remove="Remove"})(sn||(sn={}));var id=class extends O([Vs],e=>class extends e{constructor(){super(...arguments),this.mutations=[],this.previousValue=void 0}hasProposedValueInner(){return this.mutations.length>0}}){},ad=id.mix(Zr),vo=class extends O([ut],e=>{class n extends e{constructor(){super(...arguments),this.proposedValueIsBuilt=!0}addToBucket(s,r){const i=s.getWriteTarget(this);i.mutations.push({type:sn.Add,entity:r});const a=s.baseRevision;!i.previousValue&&a.hasIdentifier(this)&&(i.previousValue=s.readPrevious(this))}removeFromBucket(s,r){const i=s.entries.get(this);if(i&&i.getValue()===ee)return;const a=s.getWriteTarget(this);a.mutations.push({type:sn.Remove,entity:r});const o=s.baseRevision;!a.previousValue&&o.hasIdentifier(this)&&(a.previousValue=s.readPrevious(this))}buildProposedValue(s,r,i){const a=r,o=new Set(a.previousValue);for(let l=0;l<a.mutations.length;l++){const{type:c,entity:u}=a.mutations[l];c===sn.Remove?o.delete(u):c===sn.Add&&o.add(u)}return o}leaveGraph(s){super.leaveGraph(s),this.DATA=void 0}}return nd([G(wt.DependsOnlyOnDependsOnlyOnUserInput)],n.prototype,"level",void 0),nd([G(ad)],n.prototype,"quarkClass",void 0),n}){},od=class extends vo.mix(ut.mix(Xr)){},Zs=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},ar=function(e,n){return e===n||(n!=null&&n.isBase?this.serialize(n):n)===(e!=null&&e.isBase?this.serialize(e):e)},Xs=class extends en{constructor(){super(...arguments),this.modelFieldConfig={}}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?ma(e)?ud:cd:dd}},Tr=class extends go.mix(Xs){constructor(){super(...arguments),this.identifierCls=Nn}},Or=class extends mo.mix(en){constructor(){super(...arguments),this.identifierCls=ti}},ei=Symbol("IsChronoModelSymbol"),an=class extends O([ut],e=>{const n=e.prototype;class t extends e{[ei](){}getFromGraph(r){var i,a;if(r){if(r.readMode===Lt.CurrentOrProposedOrPrevious){const o=r.isCommitting&&this.level>((a=(i=r.activeTransaction.getActiveEntry())==null?void 0:i.level)!=null?a:Number.MAX_SAFE_INTEGER);return this.sync&&!this.context.project.isDelayingCalculation&&!o?r.get(this):r.activeTransaction.readCurrentOrProposedOrPrevious(this)}return n.getFromGraph.call(this,r)}else return this.DATA}writeToGraph(r,i,...a){r?n.writeToGraph.call(this,r,i,...a):(this.DATA=i,!this.self.inSetting&&!this.self.isConstructing&&this.self.set(this.field.name,i,!1,!1,!0))}write(r,i,a,o,...l){o=r.convert(o),n.write.call(this,r,i,a,o,...l)}convert(r){const i=this.field,a=this.self.getFieldDefinition(i.name);return a!=null&&a.convert?r=a.convert(r,this.context.data,this.context):i.converter&&(r=i.converter(r,i)),r}equality(r,i){return r instanceof Date&&i instanceof Date?r.getTime()===i.getTime():r===i}}return Zs([G(!1)],t.prototype,"sync",void 0),t}){},ld=class extends O([Zr],e=>{const n=e.prototype;class t extends e{setValue(r){n.setValue.call(this,r),r!==ee&&(this.identifier.DATA=r)}}return t}){},Nn=class extends po.mix(an.mix($n)){buildProposedValue(e,n,t){const s=n,r=s.proposedValue;if(r==null)return t.candidate.failedResolutionReferences.delete(s.identifier),null;if(ze(r,xt)&&r.graph)return e.hasBucket()&&e.getBucket(r).addToBucket(t,e.self),t.candidate.failedResolutionReferences.delete(s.identifier),r;const i=e.resolve(r);return ze(i,xt)&&i.graph?(e.hasBucket()&&e.getBucket(i).addToBucket(t,e.self),t.candidate.failedResolutionReferences.delete(s.identifier),i):(t.candidate.failedResolutionReferences.set(s.identifier,r),null)}};Zs([G(!0)],Nn.prototype,"sync",void 0),Zs([G(ld)],Nn.prototype,"quarkClass",void 0);var ti=class extends vo.mix(an.mix($n)){};Zs([G(!0)],ti.prototype,"sync",void 0);var cd=class extends an.mix($n){},ud=class extends an.mix(Va){},dd=class extends an.mix(Ua){},B=function(e={},n={},t=Xs){return function(s,r){qe({modelFieldConfig:e,...n},t)(s,r),ri(s.constructor)}},ri=e=>{e.hasOwnProperty("fields")||Object.defineProperty(e,"fields",{get:function(){return hd(this)}})},hd=e=>{const n=e.prototype,t=[];return n.hasOwnProperty("$entity")&&n.$entity.ownFields.forEach(s=>{if(s instanceof Xs){const r=s.modelFieldConfig||{};!r.convert&&s.converter&&s.converter!==zt&&(r.convert=s.converter),t.push(Object.assign(r,{$chrono:s,name:s.name}))}}),t},zt=(e,n)=>{var t,s;return e===null?null:(e instanceof Date||(e=R.parse(e,((t=n.modelFieldConfig)==null?void 0:t.format)||((s=n.modelFieldConfig)==null?void 0:s.dateFormat)||R.defaultParseFormat)),e||void 0)},fd=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},bt;(function(e){e.Cancel="Cancel",e.Resume="Resume"})(bt||(bt={}));var Vn=class extends ${getDescription(){throw new Error("Abstract method")}resolve(...e){throw new Error("Abstract method")}},Un=class extends ye{getResolutions(){return this._resolutions}getDescriptionBuilderClass(){return this._descriptionBuilderClass}setDescriptionBuilderClass(e){this._descriptionBuilderClass=e}getDescription(){return this.getDescriptionBuilderClass().getDescription(this)}};fd([G("schedulingIssueEffect")],Un.prototype,"type",void 0),fd([G(!1)],Un.prototype,"sync",void 0);var gd=e=>Number(e)!==e,yo=e=>e instanceof Set||e instanceof Array?Me(e):Me([e]),pd=e=>new Promise(n=>setTimeout(n,e)),pt=(e,...n)=>e.replace(/{(\d+)}/g,(t,s)=>typeof n[s]!="undefined"?n[s]:t),{hasOwn:So}=_,md=1.005.toFixed(2)==="1.01"?null:function(e,n){const t=e.toString().split("."),s=+(t[1]?t.join(".")+"1":t[0]);return e.toFixed.call(s,n)},x=class extends _{static transformArrayToNamedObject(e,n="ref"){const t={};return e.forEach((s,r)=>{const i=s[n]!=null&&s[n].toString().length?s[n]:r;t[i]=s}),t}static transformNamedObjectToArray(e,n="ref"){return Object.keys(e).filter(t=>e[t]).map(t=>{const s=e[t];return s[n]=t,s})}static isEqual(e,n,t=!1){if(e===null&&n!==null||e===void 0&&n!==void 0||n===null&&e!==null||n===void 0&&e!==void 0)return!1;if(e==null&&n==null||e===n)return!0;const s=typeof e;if(s===typeof n){switch(s){case"number":case"string":case"boolean":return e===n}switch(!0){case(e instanceof Date&&n instanceof Date):return e.getTime()===n.getTime();case(Array.isArray(e)&&Array.isArray(n)):return e.length===n.length?e.every((i,a)=>st.isEqual(i,n[a],t)):!1;case(s==="object"&&e.constructor.prototype===n.constructor.prototype):return t?st.isDeeplyEqual(e,n,t):U.safeJsonStringify(e)===U.safeJsonStringify(n)}}return String(e)===String(n)}static isDeeplyEqual(e,n,t={}){if(e===n)return!0;if(!e||!n)return!1;const s=st.keys(e,t.ignore),r=st.keys(n,t.ignore);if(s.length!==r.length)return!1;for(let i=0;i<s.length;i++){const a=s[i],o=r[i];if(a!==o)return!1;const l=e[a],c=n[o];if(!(t.shouldEvaluate&&t.shouldEvaluate(a,{value:l,object:e},{value:c,object:n})===!1)){if(t.evaluate){const u=t.evaluate(a,{value:l,object:e},{value:c,object:n});if(u===!1)return!1;if(u===!0)continue}if(!st.isEqual(l,c,t))return!1}}return!0}static isPartial(e,n){return e=String(e).toLowerCase(),n=String(n).toLowerCase(),e.indexOf(n)!==-1}static isLessThan(e,n){return e instanceof Date&&n instanceof Date?R.isBefore(e,n):e<n}static isMoreThan(e,n){return e instanceof Date&&n instanceof Date?R.isAfter(e,n):e>n}static fork(e){let n,t,s;if(e&&e.constructor===Object){n=Object.setPrototypeOf({},e);for(t in e)s=e[t],s&&(s.constructor===Object?n[t]=st.fork(s):s instanceof Array&&(n[t]=s.slice()))}else n=e;return n}static copyProperties(e,n,t){let s,r;for(r=0;r<t.length;r++)s=t[r],s in n&&(e[s]=n[s]);return e}static copyPropertiesIf(e,n,t){if(n)for(const s of t)!(s in e)&&s in n&&(e[s]=n[s]);return e}static entries(e,n){const t=[],s=typeof n=="function";if(e)for(const r in e)(s?!n(r,e[r]):!(n!=null&&n[r]))&&t.push([r,e[r]]);return t}static fromEntries(e,n){if(n=n||{},e)for(let t=0;t<e.length;++t)n[e[t][0]]=e[t][1];return n}static keys(e,n,t){const s=[],r=typeof n=="function";if(e){let i=0;for(const a in e)(r?!n(a,e[a]):!(n!=null&&n[a]))&&(s.push(t?t(a,i):a),++i)}return s}static values(e,n,t){const s=[],r=typeof n=="function";if(e){let i=0;for(const a in e)(r?!n(a,e[a]):!(n!=null&&n[a]))&&(s.push(t?t(e[a],i):e[a]),++i)}return s}static pathExists(e,n){return n.split(".").every(s=>!e||!(s in e)?!1:(e=e[s],!0))}static pathifyKeys(e,n){const t={};for(const s in e)if(So(e,s)){const r=n==null?void 0:n[s],i=(r==null?void 0:r.type)==="object"||(r==null?void 0:r.complexMapping)||!n;if(i&&Array.isArray(e[s]))t[s]=e[s].slice();else if(i&&e[s]instanceof Object){const a=this.pathifyKeys(e[s]);for(const o in a)t[`${s}.${o}`]=a[o]}else t[s]=e[s]}return t}static deletePath(e,n){n.split(".").reduce((t,s,r,i)=>{if(t==null)return null;if(So(t,s))if(r===i.length-1)delete t[s];else return t[s]},e)}static coerce(e,n){const t=_.typeOf(e),s=_.typeOf(n),r=typeof e=="string";if(t!==s)switch(s){case"string":return String(e);case"number":return Number(e);case"boolean":return r&&(!e||e==="false"||e==="0")?!1:!!e;case"null":return r&&(!e||e==="null")?null:!1;case"undefined":return r&&(!e||e==="undefined")?void 0:!1;case"date":return r&&isNaN(e)?R.parse(e):Date(Number(e))}return e}static wrapProperty(e,n,t,s,r=!0){const i={};let a=Object.getPrototypeOf(e),o=Object.getOwnPropertyDescriptor(a,n);for(;!o&&a&&r;)a=Object.getPrototypeOf(a),a&&(o=Object.getOwnPropertyDescriptor(a,n));o?(o.set?i.set=l=>{o.set.call(e,l),s&&s.call(e,o.get.call(e))}:i.set=s,o.get?i.get=()=>{let l=o.get.call(e);return t&&(l=t.call(e,l)),l}:i.get=t):(i.set=l=>{e[`_${n}`]=l,s&&s.call(e,l)},i.get=()=>{let l=e[`_${n}`];return t&&(l=t.call(e,l)),l}),Object.defineProperty(e,n,i)}static hookProperty(e,n,t){const s=x.getPropertyDescriptor(t.prototype,"value"),r=x.getPropertyDescriptor(e,n),i=`_${n}`,a=class{get value(){return r?r.get.call(this):this[i]}set value(l){r?r.set.call(this,l):this[i]=l}},o=x.getPropertyDescriptor(a.prototype,"value");return Object.setPrototypeOf(t.prototype,a.prototype),Object.defineProperty(e,n,{configurable:!0,get:s.get||o.get,set:s.set||o.set}),()=>delete e[n]}static getPropertyDescriptor(e,n){let t=null;for(let s=e;s&&!t&&!So(s,"isBase");s=Object.getPrototypeOf(s))t=Object.getOwnPropertyDescriptor(s,n);return t}static cleanupProperties(e,n=!1){return Object.entries(e).forEach(([t,s])=>{n?s===void 0&&delete e[t]:s==null&&delete e[t]}),e}static removeAllProperties(e){return Object.keys(e).forEach(n=>delete e[n]),e}static assertType(e,n,t){const s=_.typeOf(e);if(e!=null&&s!==n)throw new Error(`Incorrect type "${s}" for ${t}, expected "${n}"`)}static assertObject(e,n){st.assertType(e,"object",n)}static assertInstance(e,n){st.assertType(e,"instance",n)}static assertClass(e,n){st.assertType(e,"class",n)}static assertFunction(e,n){if(typeof e!="function"||e.isBase||e.$$name)throw new Error(`Incorrect type for ${n}, got "${e}" (expected a function)`)}static assertNumber(e,n){const t=Number(e);if(typeof e!="number"||isNaN(t))throw new Error(`Incorrect type for ${n}, got "${e}" (expected a Number)`)}static assertBoolean(e,n){st.assertType(e,"boolean",n)}static assertString(e,n){st.assertType(e,"string",n)}static assertArray(e,n){st.assertType(e,"array",n)}static toFixed(e,n){return md?md(e,n):e.toFixed(n)}static roundTo(e,n=1){return Math.round(e/n)*n}static round(e,n){if(n==null)return e;const t=10**n;return Math.round(e*t)/t}static getMapPath(e,n,t){const s=Array.isArray(n)?n:typeof n=="string"?n.split("."):[n],r=s.length===1,i=s[0],a=e.has(i)?e.get(i):e.set(i,r?t:{}).get(i);return r?a:st.getPathDefault(a,s.slice(1),t)}},st=x;x._$name="ObjectHelper";var vd=Symbol("STM_PROP"),yd={parentIndex:1},Sd=e=>class extends(e||$){static get $name(){return"ModelStm"}static get defaultConfig(){return{stm:null}}joinStore(t){this.stm||(this.stm=t.stm)}unjoinStore(t,s=!1){var r;this.stm===t.stm&&(this.stm=null),(r=super.unjoinStore)==null||r.call(this,t,s)}get stm(){return this[vd]}set stm(t){this[vd]=t}beforeChronoFieldSet(t,s){var r;const i=this;return!i.inSetting&&((r=i.stm)!=null&&r.enabled)&&!yd[t]&&!i.constructor.nonPersistableFields[t]&&i.getFieldDefinition(t)?{[t]:{value:s,oldValue:i[t]}}:null}afterChronoFieldSet(t,s,r){r&&this.afterSet(t,s,!1,!1,r,!0)}shouldRecordFieldChange(t,s,r){const i=this.firstStore;return!(this.constructor.nonPersistableFields[t]||s==null&&r==null||s===r||s instanceof Date&&r instanceof Date&&s.getTime()===r.getTime()||t==="id"||t==="$PhantomId"||t==="parentId"&&i&&i.oldIdMap[s]===i.getById(r))}afterSet(t,s,r,i,a,o){const{stm:l}=this,c=this.constructor.nonPersistableFields;if(l!=null&&l.isBase&&l.enabled&&!yd[t]&&!c[t]&&a){let u;const[d,h]=Object.keys(a).reduce((f,g)=>{const{value:p,oldValue:m}=a[g];return this.shouldRecordFieldChange(g,m,p)&&(u=!0,f[0][g]=p,f[1][g]=m),f},[{},{}]);u&&l.onModelUpdate(this,d,h,o)}}beforeInsertChild(t){var s;const r=((s=super.beforeInsertChild)==null?void 0:s.call(this,t))||[],{stm:i}=this;return i!=null&&i.enabled&&r.push(t.reduce((a,o)=>(o.root===this.root&&a.set(o,{parent:o.parent,index:o.parent?o.parentIndex:void 0}),a),new Map)),r}afterInsertChild(t,s,r,i){var a;const{stm:o}=this;if(o!=null&&o.enabled){const l=r.pop();i&&o.onModelInsertChild(this,t,i,l)}(a=super.afterInsertChild)==null||a.call(this,t,s,r,i)}beforeRemoveChild(t,s){const r=super.beforeRemoveChild?super.beforeRemoveChild(t,s):[],{stm:i}=this;return i!=null&&i.enabled&&!s&&r.push(t.reduce((a,o)=>(a.set(o,{parentIndex:o.parentIndex,orderedParentIndex:o.orderedParentIndex}),a),new Map)),r}afterRemoveChild(t,s,r){var i;const{stm:a}=this;if(a!=null&&a.enabled&&!r){const o=s.pop();t&&t.length&&a.onModelRemoveChild(this,t,o)}(i=super.afterRemoveChild)==null||i.call(this,t,s,r)}},wm={includeFilteredOutRecords:!1},Do=e=>(e=e||!1,typeof e=="boolean"&&(e={includeFilteredOutRecords:e}),e||wm),Dd=e=>class extends(e||$){static get $name(){return"TreeNode"}static set convertEmptyParentToLeaf(t){t===!0?t={onLoad:!0,onRemove:!0}:t===!1&&(t={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=t}constructor(...t){super(...t),this.children&&(this.orderedChildren=this.orderedChildren||[])}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(t,s=this.stores){const{inProcessChildren:r,constructor:i}=this,a=s[0];if(t===!0)return r?!0:[];if(t){t=W.asArray(t);const o=t.length,l=[];for(let c=0,u;c<o;c++)u=t[c],u=u.isModel?u:a?a.createRecord(u,!1,!0):new i(u,null,null,!0),u=a?a.processRecord(u):u,l.push(u);if(this.children===!0&&a){const c=a.createSorterFn(a.sorters);l.sort(c)}return l}}processChildren(t=this.stores){const s=this,{meta:r}=s;s.inProcessChildren=!0;const i=s.ingestChildren(s.data[s.constructor.childrenField],t);if(i){const{convertEmptyParentToLeaf:a}=s.constructor;if(a===!0||a.onLoad?i.length:Array.isArray(i)){if(r.isLeaf=!1,s.children===!0)s.children=[];else if(i.length===0){s.children=i;return}s.insertChild(i)}else i===!0?(r.isLeaf=!1,s.children=!0):s.isRoot||(r.isLeaf=s.constructor.convertEmptyParentToLeaf.onLoad)}s.inProcessChildren=!1}ancestorsExpanded(t=this.firstStore){const{parent:s}=this;return!s||s.isExpanded(t)&&s.ancestorsExpanded(t)}isExpanded(t=this.firstStore){const s=this.instanceMeta(t.id);return Object.prototype.hasOwnProperty.call(s,"collapsed")||(s.collapsed=!this.expanded),!s.collapsed}get expanded(){return this.data.expanded}get childLevel(){let t=this,s=-1;for(;t&&!t.isRoot;)++s,t=t.parent;return s}get isLeaf(){return this.meta.isLeaf!==!1&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(t=!1,s=this.firstStore){const{children:r}=this;return!r||!Array.isArray(r)||t&&!this.isExpanded(s)?0:r.reduce((i,a)=>i+a.getDescendantCount(t),r.length)}get allChildren(){return this.getAllChildren(!1)}get allUnfilteredChildren(){return this.getAllChildren(!0)}getAllChildren(t=!1){const{[t?"unfilteredChildren":"children"]:s}=this;return!s||s===!0?[]:s.reduce((r,i)=>(r.push(i),r.push.apply(r,t?i.allUnfilteredChildren:i.allChildren),r),[])}get firstChild(){const{children:t}=this;return(t==null?void 0:t.length)&&t[0]||null}get lastChild(){const{children:t}=this;return(t==null?void 0:t.length)&&t[t.length-1]||null}get previousSiblingsTotalCount(){let t=this.previousSibling,s=this.parentIndex;for(;t;)s+=t.descendantCount,t=t.previousSibling;return s}get previousOrderedSibling(){var t;return(t=this.parent)==null?void 0:t.orderedChildren[this.orderedParentIndex-1]}get nextOrderedSibling(){var t;return(t=this.parent)==null?void 0:t.orderedChildren[this.orderedParentIndex+1]}get root(){var t;return((t=this.parent)==null?void 0:t.root)||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(t){const s=this,{parent:r}=s,i=t===null?s.firstStore.rootNode:s.firstStore.getById(t);i===r||!r&&!i||(s.isBatchUpdating?s.meta.batchChanges.parentId=t:i?i.appendChild(s):s.parent.removeChild(s))}static set parentIdField(t){this._parentIdField=t,Object.defineProperty(this.prototype,t,{set:function(s){this.parentId=s},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}getChildren(t){let s;return t.includeFilteredOutRecords?s=this.unfilteredChildren||this.children:t.useOrderedTree?s=this.orderedChildren:s=this.children,s}traverse(t,s,r){r=Do(r);const i=this,a=i.getChildren(r);s||t.call(i,i);for(let o=0,l=a==null?void 0:a.length;o<l;o++)a[o].traverse(t,!1,r)}traverseBefore(t,s,r){r=Do(r);const i=this,a=i.getChildren(r);for(let o=0,l=a==null?void 0:a.length;o<l;o++)a[o].traverse(t,!1,r);s||t.call(i,i)}traverseWhile(t,s,r){r=Do(r);const i=this;let a=s||t.call(i,i)!==!1;if(a){const o=i.getChildren(r);o!=null&&o.length&&(a=o.every(l=>l.traverseWhile(t,!1,r)))}return a}bubble(t,s=!1){let r=this;for(s||t.call(r,r);r.parent;)r=r.parent,t.call(r,r)}bubbleWhile(t,s=!1){let r=this,i=!0;for(s||(i=t.call(r,r));i&&r.parent;)r=r.parent,i=t.call(r,r);return i}contains(t,s=!1){return t&&typeof t=="object"&&(t=t.id),!this.traverseWhile(r=>r.id!=t,s)}getTopParent(t){let s;return t?(s=[],this.bubbleWhile(r=>(s.push(r),r.parent&&!r.parent.isRoot))):(s=null,this.bubbleWhile(r=>(s=r,r.parent&&!r.parent.isRoot))),s}appendChild(t,s=!1){return this.insertChild(t,null,s)}insertChild(t,s=null,r=!1,i={}){var a,o,l,c,u,d,h;const f=this,g=Array.isArray(t);if(t=W.asArray(t),typeof s=="number"&&(s=(o=(a=f.children)==null?void 0:a[s])!=null?o:null),!r&&!f.stores.every(D=>D.trigger("beforeAdd",{records:t,parent:f})!==!1))return null;t=f.ingestChildren(t);const p=(u=(c=s==null?void 0:s.parentIndex)!=null?c:(l=f.children)==null?void 0:l.length)!=null?u:0,m=(d=f.beforeInsertChild)==null?void 0:d.call(f,t),y=f.internalAppendInsert(t,s,r,i);return y.length&&f.convertToParent(r),(h=f.afterInsertChild)==null||h.call(f,p,t,m,y),g||!y?y:y[0]}convertToParent(t=!1){const s=this,r=s.isLeaf;s.meta.isLeaf=!1,s.children||(s.children=[]),r&&!s.root.isLoading&&!t&&s.signalNodeChanged({isLeaf:{value:!1,oldValue:!0}})}signalNodeChanged(t,s=this.stores){s.forEach(r=>{r.trigger("update",{record:this,records:[this],changes:t}),r.trigger("change",{action:"update",record:this,records:[this],changes:t})})}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(t,s,r,i){const a=this,{stores:o,root:l,children:c}=a,{firstStore:u}=l,{parentIdField:d}=a.constructor,h=a.id;let f,g,p,m,y,D;if(!l.isLoading&&u)for(D={},y=[],p=0;p<t.length;p++){const E=t[p];D[E.id]=E.root===l,y[p]=E.parentIndex}if(s&&s.parent!==a&&(s=null),c){const E=s?s.parentIndex:c.length;if(c[g=E]===t[0]||c[g=E-1]===t[0])for(f=!0,p=0;f&&p<t.length;p++)t[p]!==c[g+p]&&(f=!1)}if(f)return t;for(p=0;p<t.length;p++){const E=t[p],C=E.parent;if(u&&!l.isLoading&&E.traverse(v=>{v.root===l&&(D[v.id]=!0)}),(C==null?void 0:C.removeChild(E,D==null?void 0:D[E.id],r,{isInserting:!0,...i}))===!1)m||(t=t.slice(),m=!0),t.splice(p--,1);else{E.parent=a,E.data[d]=h;const{meta:v}=E;v.modified[d]===h&&!C&&(v.oldParentId=h),C&&(v.oldParentId=C.id)}}if(t.length){Array.isArray(c)||(a.children=[]),Array.isArray(a.orderedChildren)||(a.orderedChildren=[]);const E=a.addToChildren(s,t,i);o.forEach(C=>{C.isChained||(t.forEach(v=>{v.joinStore(C)}),C.onNodeAddChild(a,t,E,D,r),t.forEach((v,S)=>{if(v.meta.oldParentId!=null&&!(a.inProcessChildren||a.isLoading)){const b={[d]:h,[a.getDataSource("parentIndex")]:v.parentIndex},w={},{modified:M,oldParentId:I}=v.meta,A=y[S];if(delete v.meta.oldParentId,a.id!==I&&(w[d]={value:h,oldValue:I}),v.parentIndex!==A&&(w.parentIndex={value:v.parentIndex,oldValue:A}),M[d]===a.id?Reflect.deleteProperty(M,d):d in M||(M[d]=I),D[v.id]){const T=C.getById(I);T.isLeaf&&!r&&T.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}},[C])}v.afterChange(b,w)}v.traverse(b=>{!b.ignoreBag&&!b.isLinked&&C.updateModifiedBagForRecord(b)})}))})}return t}removeChild(t,s=!1,r=!1,i={}){var a,o;const l=this,c=[],u=l.isLeaf,{children:d,stores:h}=l;if(t=W.asArray(t),t=t.filter(g=>g.parent===l),!r){for(const g of h)if(!g.isChained&&g.trigger("beforeRemove",{parent:l,records:t,isMove:s})===!1)return!1}const f=(a=l.beforeRemoveChild)==null?void 0:a.call(l,t,s);for(const g of t){const{parentIdField:p}=g.constructor,{modified:m}=g.meta,y=g.parent?g.parent.id:null;!(p in m)&&!g.isLinked&&(m[p]=y);const D=l.removeFromChildren(g,i);h.forEach(E=>{if(!E.isChained){const{isRemoving:C}=E;E.isRemoving=!0,c.push(...E.onNodeRemoveChild(l,[g],D,{isMove:s,silent:r})),E.isRemoving=C}}),s||(g.parent=g.parentIndex=g.unfilteredIndex=g.nextSibling=g.previousSibling=null,g.data[p]=null)}return(l.unfilteredChildren||d).length===0&&l.constructor.convertEmptyParentToLeaf.onRemove&&!l.isRoot&&(l.meta.isLeaf=!0),l.isLeaf!==u&&!r&&!s&&l.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}}),(o=l.afterRemoveChild)==null||o.call(l,t,f,s),c}clearParentId(){const t=this;Reflect.deleteProperty(t.data,t.parentIdField),Reflect.deleteProperty(t.originalData,t.parentIdField),t.meta.modified&&Reflect.deleteProperty(t.meta.modified,t.parentIdField)}replaceChildren(t){return this.clearChildren(),this.data[this.constructor.childrenField]=t,this.processChildren(),this.children}clearChildren(t=!1){const s=this,{stores:r}=s,i=s.unfilteredChildren||s.children;s.children=[],s.orderedChildren=[],i&&i!==!0&&(r.forEach(a=>{a.isChained||a.onNodeRemoveChild(s,i,0,{unfiltered:!0,silent:t})}),s.unfilteredChildren&&(s.unfilteredChildren=[]))}clear(){var t;const s=this,{stores:r}=s,i=(t=s.children)==null?void 0:t.slice();if(!(!s.isRoot||!i)){for(const a of r)if(!a.isChained&&a.trigger("beforeRemove",{parent:s,records:i,isMove:!1,removingAll:!0})===!1)return!1;s.children.length=0,s.unfilteredChildren&&(s.unfilteredChildren.length=0),r.forEach(a=>{i.forEach(o=>{o.stores.includes(a)&&o.unjoinStore(a),o.parent=o.parentIndex=o.nextSibling=o.previousSibling=null}),a.storage.suspendEvents(),a.storage.clear(),a.storage.resumeEvents(),a.added.clear(),a.modified.clear(),a.trigger("removeAll"),a.trigger("change",{action:"removeall"})})}}updateChildrenIndices(t,s,r=!1){let i=null;for(let a=0;a<t.length;a++){const o=t[a],l=o[s];s==="parentIndex"||s==="orderedParentIndex"?l===void 0||r?o.setData(s,a):l!==a&&o.set(s,a,!0):o[s]=a,s==="parentIndex"&&(o.previousSibling=i,i&&(i.nextSibling=o),a===t.length-1&&(o.nextSibling=null),i=o)}}addToChildren(t,s,r={}){var i,a;const o=this,l=[[o.children,"parentIndex",t],[o.unfilteredChildren,"unfilteredIndex",t],[o.orderedChildren,"orderedParentIndex",(i=r==null?void 0:r.orderedBeforeNode)!=null?i:(r==null?void 0:r.orderedParentIndex)!==void 0?o.orderedChildren[r==null?void 0:r.orderedParentIndex]:t]];for(const c of l){const[u,d,h]=c;if(u){const f=h?d==="orderedParentIndex"?u.indexOf(h):h[d]:u.length;c.push(f),u.splice(f,0,...s),(a=r==null?void 0:r[d])!=null&&a.skip||o.updateChildrenIndices(u,d)}}return l[0][3]}removeFromChildren(t,s){var r;const i=[[this.children,"parentIndex"],[this.unfilteredChildren,"unfilteredIndex"],[this.orderedChildren,"orderedParentIndex"]];for(const a of i){const[o,l]=a;if(o){const c=o.indexOf(t);a.push(c),c>-1&&(o.splice(c,1),(r=s==null?void 0:s[l])!=null&&r.skip||this.updateChildrenIndices(o,l))}}return i[0][2]}sortOrderedChildren(t=!0,s=!1){const r=[];return this.isLeaf||(this.orderedChildren.sort((i,a)=>{var o,l;if(s){const c=(o=i.meta.modified.orderedParentIndex)!=null?o:i.orderedParentIndex,u=(l=a.meta.modified.orderedParentIndex)!=null?l:a.orderedParentIndex,d=c-u;return d!==0&&(r.push(i),r.push(a)),d}else return i.orderedParentIndex-a.orderedParentIndex}),t&&this.orderedChildren.forEach(i=>{r.push(...i.sortOrderedChildren(t,s))}),this.updateChildrenIndices(this.orderedChildren,"orderedParentIndex",!0)),new Set(r)}unjoinStore(t,s=!1){var r;const i=this;i.unfilteredChildren&&(i.children=i.unfilteredChildren.slice(),i.unfilteredChildren=null),(r=super.unjoinStore)==null||r.call(this,t,s)}},Cd={id:1,stores:1,parentIndex:1,parent:1,previousSibling:1,nextSibling:1,unfilteredIndex:1},Mm={get(e,n){return n==="proxyMeta"?this.proxyMeta:n==="constructor"?e.constructor:n==="setData"?this.setDataOverride:n==="set"?this.setOverride:Cd[n]?this.proxyMeta.data[n]:Reflect.get(e,n,this.proxyRecord)},set(e,n,t){return Cd[n]?this.proxyMeta.data[n]=t:e[n]=t,!0},setDataOverride(e,n){e==="parentIndex"?this.proxyMeta.data.parentIndex=n:this.proxyMeta.originalRecord.setData(e,n)},setOverride(e,n,...t){e==="parentIndex"?this.proxyMeta.data.parentIndex=n:this.proxyMeta.originalRecord.set(e,n,...t)}},Ed=e=>{var n;return n=class extends(e||$){link(){if(this.isLinked)return this.$original.link();const t=this,s={...Mm,proxyMeta:{originalRecord:t,data:{id:`${t.id}_link_${U.generateUUID()}`,stores:[]}}},r=new Proxy(t,s);return s.proxyRecord=r,(t.meta.linkedRecords||(t.meta.linkedRecords=[])).push(r),r}get isLinked(){var t;return!!((t=this.proxyMeta)!=null&&t.originalRecord)}get hasLinks(){return!!(!this.proxyMeta&&this.$links.length)}removeLink(t,s=null,r=!1){if(t.hasLinks)for(const i of t.$links.slice())s?W.include(s,i):i.remove(r);else t.isLinked&&W.remove(t.$original.$links,t)}beforeRemove(t){this.removeLink(this,t)}removeChild(t,s,r,i){if(!(i!=null&&i.isInserting)){t=W.asArray(t);for(const a of t)this.removeLink(a,null,r)}return super.removeChild(t,s,r,i)}get $originalId(){return this.$original.id}get $links(){var t;return(t=this.meta.linkedRecords)!=null?t:[]}},F(n,"$name","ModelLink"),n},{defineProperty:bd}=Reflect,Co=Symbol("owner"),xm=/[\s,]+/,Tm=e=>class extends(e||$){static get $name(){return"Factoryable"}static get declarable(){return["factoryable","alias","type"]}static register(t,s,r=globalThis.__BRYNTUM_EXAMPLE){const{factoryable:i}=this.initClass(),{caseless:a,registry:o}=i,l=U.split(t,xm);for(let c,u,d=0;d<l.length;++d){if(u=l[d],c=a?u.toLowerCase():u,!r&&c in o)throw new Error(`Type "${u}" already registered with ${i.class.name} factory`);o[u]=o[c]=s.initClass()}}static isA(t,s){return this.isType(t,s,!0)}static isType(t,s,r){const{factoryable:i}=this,{caseless:a,registry:o}=i,l=o[a?s.toLowerCase():s];return l?r?t instanceof l:t.constructor===l:!1}static setupAlias(t){t.register(t.alias,t)}static setupFactoryable(t,s){const r=s.super.class;let{factoryable:i}=t;i={caseless:!0,defaultType:null,extends:r.factoryable?[r]:null,typeKey:"type",...i},i.class=t,i.registry=Object.create(null),i.extends&&!Array.isArray(i.extends)&&(i.extends=[i.extends]),bd(t,"factoryable",{get(){return i}})}static setupType(t,s){const{type:r}=t;t.register(r,t,s.replaceType),bd(t.prototype,"type",{value:r})}static create(t,s){return this.reconfigure(null,t,s)}static reconfigure(t,s,r){const i=this,{factoryable:a}=i,{typeKey:o}=a;let l=r,c,u,d,h,f,g,p,m,y;if(r&&!x.isClass(r)&&(l=null,p=typeof r,p==="function"?g=r:p==="string"?l=r:x.isObject(r)?(c=r.cleanup,u=r.defaults,h=r.owner,g=r.setup,l=r.type,m=r.transform):h=r),m&&(s=typeof m=="string"?h[m](s):m(s)),y=s,typeof y=="string")s={};else if(s){if(s===!0&&(s={}),!x.isObject(s))return h&&s!==t&&(t==null?void 0:t[Co])===h&&(typeof c=="string"?h[c](t):c==null||c(t),t.destroy()),s;y=s[o]}if(y=y&&i.resolveType(y),t){if(s&&(!y||t.constructor===y))return o in s&&(s=x.assign({},s),delete s[o]),t.setConfig(s),t;h&&t[Co]===h&&(typeof c=="string"?h[c](t):c==null||c(t),t.destroy())}if(s){if(u){if(!(d=y)){if(!(d=u[o]||l||a.defaultType))throw new Error(`No default mergeType defined for ${a.class.name} factory`);d=i.resolveType(d)}d&&(s=d.mergeConfigs(u,s))}if(g){if(f=typeof g=="string"?h[g](s,y,u):g(s,y,u),f===null)return f;s=f||s}if(!y){if(!(y=s[o]||l||a.defaultType))throw new Error(`No default type defined for ${a.class.name} factory`);y=i.resolveType(y)}u&&!d&&(s=y.mergeConfigs(u,s)),o in s&&(s=x.assign({},s),delete s[o]),s=new y(s),h&&(s[Co]=h)}return s||null}static resolveType(t,s){if(typeof t!="string")return t;const{factoryable:r}=this,i=r.extends;let a=r.registry[r.caseless?t.toLowerCase():t],o;for(o=0;!a&&i&&o<i.length;++o)a=i[o].resolveType(t,!0);if(!a&&!s)throw new Error(`Invalid type name "${t}" passed to ${r.class.name} factory`);return a}},{getOwnPropertyDescriptor:Om}=Reflect,it=class extends $.mixin(Tm){static get $name(){return"DataField"}static get type(){return"auto"}static get factoryable(){return{defaultType:"auto"}}static get prototypeProperties(){return{compare:null,compareItems:null,dataSource:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:void 0,persist:!0,readOnly:!1,internal:!1,useProp:null}}construct(e){const n=this;e&&(n.name=e.name,Object.assign(n,e)),n.compare&&(n.compareItems=(t,s)=>n.compare(t==null?void 0:t[n.name],s==null?void 0:s[n.name]))}defineAccessor(e,n){const{name:t,dataSource:s}=this;!n&&t in e&&e.$meta.hierarchy.some(r=>{var i;return((i=Om(r.prototype,t))==null?void 0:i.enumerable)===!1})||Reflect.defineProperty(e,t,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(t,s)}:function(){return this.batching&&t in this.meta.batchChanges?this.meta.batchChanges[t]:s in this.data?this.data[s]:this.data[t]},set(r){const i=this.$meta.fields.map[t];i&&i.readOnly||this.set(t,r)}})}isEqual(e,n){return x.isEqual(e,n)}print(e){return e==null?this.nullText:this.printValue(e)}printValue(e){return String(e)}};it._$name="DataField";var ni=class extends it{isEqual(e,n){return e===n}getAt(e,n){return e.get(this.name)[n]}};F(ni,"$name","ArrayDataField"),F(ni,"type","array"),ni.initClass(),ni._$name="ArrayDataField";var Rd=class extends it{static get $name(){return"BooleanDataField"}static get type(){return"boolean"}static get alias(){return"bool"}static get prototypeProperties(){return{nullValue:!1}}isEqual(e,n){return e==null&&n==null?!0:super.isEqual(e,n)}convert(e){var n;return e==null?this.nullable?e:this.nullValue:((n=e.toLowerCase)==null?void 0:n.call(e))==="false"?!1:!!e}};Rd.initClass(),Rd._$name="BooleanDataField";var Id=class extends it{static get $name(){return"DateDataField"}static get type(){return"date"}static get prototypeProperties(){return{format:null}}convert(e){return e==null?this.nullable||(e=this.nullValue):e==="now"?e=new Date:e instanceof Date||(e=R.parse(e,this.format||R.defaultParseFormat),(!e||isNaN(e))&&(e=void 0)),e}serialize(e){return e instanceof Date&&(e=R.format(e,this.format||R.defaultFormat)),e}printValue(e){return R.format(e,this.format||R.defaultFormat)}};Id.initClass(),Id._$name="DateDataField";var Eo=class extends it{static get $name(){return"StringDataField"}static get type(){return"string"}static get prototypeProperties(){return{nullValue:""}}convert(e){return e==null?this.nullable?e:this.nullValue:String(e)}};Eo.initClass(),Eo._$name="StringDataField";var Pd=class extends Eo{static get $name(){return"DurationUnitDataField"}static get type(){return"durationunit"}isEqual(e,n){return R.compareUnits(e,n)===0}};Pd.initClass(),Pd._$name="DurationUnitDataField";var wd=class extends it{static get $name(){return"IntegerDataField"}static get type(){return"integer"}static get alias(){return"int"}static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(e){return e==null?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}};wd.initClass(),wd._$name="IntegerDataField";var Md=class extends it{static get $name(){return"ModelDataField"}static get type(){return"model"}static get prototypeProperties(){return{complexMapping:!0}}isEqual(e,n){return e&&n&&n instanceof e.constructor&&n.id==e.id}};Md.initClass(),Md._$name="ModelDataField";var xd=class extends it{static get $name(){return"NumberDataField"}static get type(){return"number"}static get alias(){return"float"}static get prototypeProperties(){return{nullValue:0,precision:null}}isEqual(e,n){return isNaN(Number(e))&&isNaN(Number(n))||super.isEqual(e,n)}convert(e){if(e==null)return this.nullable?e:this.nullValue;if(e=Number(e),isNaN(e))return;let n=this.precision;return n?(n=10**n,e=Math.round(e*n)/n):n===0&&(e=Math.round(e)),e}};xd.initClass(),xd._$name="NumberDataField";var Td=class extends it{static get $name(){return"ObjectDataField"}static get type(){return"object"}static get prototypeProperties(){return{complexMapping:!0}}};Td.initClass(),Td._$name="ObjectDataField";var si=class extends it{init(e,n){var t;const s=this,r=`${s.name}Store`,i={skipStack:!0,syncDataOnLoad:!0};if(s.store&&x.assign(i,s.store),s.modelClass&&(i.modelClass=s.modelClass),(t=n[`init${U.capitalize(r)}`])==null||t.call(n,i),!i.storeClass&&!s.storeClass)throw new Error(`Field '${s.name}' with type 'store' must have a storeClass configured`);const a=n.meta[r]=new(i.storeClass||s.storeClass)(i);s.complexMapping?x.setPath(e,s.dataSource,a):e[s.dataSource]=a,a.verifyNoGeneratedIds=!1,a.usesId=!a.count||!a.every(o=>o.hasGeneratedId),a.$currentValue=s.getValue(a),a.ion({change:({action:o})=>{const l=s.getValue(a);if(!a.$isSettingStoreFieldData){const c=a.$preserveCurrentDataset;a.$preserveCurrentDataset=s.subStore&&(o==="update"||o==="remove"||o==="add"),s.$isUpdatingRecord=!0,n.set(s.name,l),s.$isUpdatingRecord=!1,a.$preserveCurrentDataset=c}a.$currentValue=l}})}set(e,n,t){var s,r;const i=this,a=`${i.name}Store`,{[a]:o}=t.meta;if(!o)return t.meta.initableValues.set(i,e),!1;o.$isSettingStoreFieldData||(o.$isSettingStoreFieldData=!0,e=(r=(s=t[`process${U.capitalize(a)}Data`])==null?void 0:s.call(t,e,t))!=null?r:e,o.$preserveCurrentDataset||(o.data=e),o.$isSettingStoreFieldData=!1,o.usesId=!o.count||!o.every(l=>l.hasGeneratedId))}serialize(e,n){const t=n.meta[`${this.name}Store`];return this.$isUpdatingRecord?this.getValue(t):t.$currentValue}getValue(e){return e.allRecords.map(n=>{const t=n.persistableData;return e.usesId||delete t.id,t})}isEqual(e,n){return e!=null&&e.isStore&&(e=e.$currentValue),n!=null&&n.isStore&&(n=n.$currentValue),x.isDeeplyEqual(e,n)}getOldValue(e){const n=e.meta[`${this.name}Store`];return n?x.clone(n.$currentValue):null}getAt(e,n){const t=e.meta[`${this.name}Store`];return t==null?void 0:t.getAt(n)}};F(si,"$name","StoreDataField"),F(si,"type","store"),si.initClass(),si._$name="StoreDataField";var Od=new RegExp(/^(.*?)\.(.*)/),Ad=/(.*)\[(.*)]\.?(.*)/,{defineProperty:Am}=Reflect,{hasOwn:Wn}=x,qt=void 0,$m={children:1,data:1,meta:1},_m=["name","title","text","label","description"],Fm={boolean:1,number:1,date:1,object:1},$d={parentId:1,$PhantomId:2,id:3},bo=class extends $.mixin(Sd,Dd,Ed){static get $name(){return"Model"}static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0},{name:"orderedParentIndex",type:"number",persist:!1,internal:!0},{name:"readOnly",type:"boolean"},{name:"expanded",internal:!0}]}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){if(!this._childrenField){const e=this.fieldMap.children;this._childrenField=(e==null?void 0:e.dataSource)||"children"}return this._childrenField}get indexPath(){const e=[];let n=this,t=n.childLevel;for(n=this;n&&!n.isRoot;n=n.parent)e[t--]=n.parentIndex+1;return e}construct(e={},n=null,t=null,s=!1,r=!1,i=!1){var a,o;const l=this,c=(a=W.asArray(n))!=null?a:[],{constructor:u,fieldMap:d}=l;let h=null;if(n=c[0],l.meta={modified:{},...u.metaConfig,...t},u.applyConfigs)for(const f in l.getDefaultConfiguration())h||(h={},(!l.useRawData||!l.useRawData.enabled)&&(e={...e})),f in e&&(e[f]!==void 0&&(h[f]=e[f]),delete e[f]);if(super.construct(h),s||u.exposeProperties(e,i),!Wn(u,"idFieldProcessed")){let f=l.meta.idField;f||(u._assignedIdField?f=u.idField:n&&(f=n.idField)),f&&f!==d.id.dataSource&&u.addField({name:"id",dataSource:f,internal:!0}),u._idField=d.id.dataSource,u.idFieldProcessed=!0}l._internalId=bo._internalIdCounter++,l.stores=[],l.unjoinedStores=[],l.originalData||(l.originalData=e),l.data=u.processData(e,!1,n,l,r),(o=l.meta.initableValues)!=null&&o.size&&l.assignInitables(),l.id==null&&l.setData("id",l.generateId(n)),l.data[u.childrenField]&&l.processChildren(c),l.generation=0}set isCreating(e){const n=this;!!n.meta.isCreating!==e&&(n.meta.isCreating=e,n.stores.forEach(t=>{t.onIsCreatingToggle(n,e)}))}get isCreating(){return!!this.meta.isCreating}equals(e){if(e instanceof this.constructor){for(let n=this.$meta.fields.defs,t=0,{length:s}=n;t<s;t++){const r=n[t],{name:i}=r;if(i!=="id"&&!r.isEqual(this.getValue(i),e.getValue(i)))return!1}return!0}return!1}get subclass(){return new this.constructor(Object.setPrototypeOf({id:qt},this.data),this.stores[0],null,!0)}static processData(e,n=!1,t,s,r){const{fieldMap:i,defaultValues:a}=this,{useRawData:o={enabled:!1}}=t||{},l=r||o.enabled?e:x.clone(e);let c;if(n=n||o.disableDefaultValue||r,!n){for(c in a)if(l[c]===qt){let u=a[c];Array.isArray(u)&&(u=u.slice()),l[c]=u}}if(!o.disableTypeConversion&&!r)for(c in i){const u=i[c],{name:d,dataSource:h}=u,f=h!==d,g=u.complexMapping,p=f&&(g?x.pathExists(e,h):h in e),m=d in e&&(!f||!p),y=!o.disableTypeConversion&&u.convert;if((m||y)&&(!n||m||p)){const D=m?l[d]:g?x.getPath(l,h):l[h],E=y?u.convert(D,e,s):D;g?x.setPath(l,h,E):l[h]=E,f&&delete l[d]}}return this.$meta.fields.initable.length&&this.initInitables(s,l),l}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,n){var t,s,r,i,a;const o=Wn(e,"fields")&&e.fields,l=n.super.fields,c=n.fields={defs:(t=l==null?void 0:l.defs.slice())!=null?t:[],exposedData:!1,defaults:l?{...l.defaults}:{},exposed:Object.create((s=l==null?void 0:l.exposed)!=null?s:null),ordinals:Object.create((r=l==null?void 0:l.ordinals)!=null?r:null),map:Object.create((i=l==null?void 0:l.map)!=null?i:null),sources:Object.create((a=l==null?void 0:l.sources)!=null?a:null)};Wn(e,"defaults")&&Object.assign(c.defaults,e.defaults),Wn(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),c.exposed[e.idField]=!0),o!=null&&o.length&&o.map(e.addField,e),c.initable=c.defs.filter(u=>u.init),e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get allFields(){return this.$meta.fields.defs}get allFields(){return this.$meta.fields.defs}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e,n=!0){const t=this,s=t.$meta.fields,r=n?"exposed":"map";if(e&&t.autoExposeFields&&!s.exposedData){let i,a,o;for(i in e)!s[r][i]&&i!==t.childrenField&&(o=x.typeOf(e[i]),a={name:i,dataSource:i,fromData:!0},Fm[o]&&(a.type=o),t.addField(a));s.exposedData=!0}t.exposeRelations()}static addField(e){if(e==null)return;typeof e=="string"&&(e={name:e});const n=this.initClass(),t=n.$meta.fields,{ordinals:s}=t,r=t.exposed,{name:i}=e,a=t.map[i],o=e.dataSource||(e.dataSource=i);let l,c;if(!a||e.type&&e.type!==a.type)l=it.create(e),l.definedBy=a?a.definedBy:n,l.ordinal=a?a.ordinal:s[i]=t.defs.length;else{l=Object.create(a);for(c in e)c!=="type"&&(l[c]=e[c])}return l.owner=n,t.defs[l.ordinal]=l,t.map[i]=l,t.sources[o]||(t.sources[o]=l),o.includes(".")&&(l.complexMapping=!0),l.complexMapping?r[o.split(".")[0]]=!0:r[o]=!0,"defaultValue"in l&&(t.defaults[o]=l.defaultValue),$m[i]||l.defineAccessor(n.prototype),n._nonPersistableFields=null,n._alwaysWriteFields=null,l}static removeField(e){const n=this.initClass(),t=n.$meta.fields,s=t.map[e],{ordinals:r}=t,i=r[e];if(s){t.defs.splice(i,1),delete r[e],delete t.defaults[e],delete t.exposed[e],delete t.map[e],delete t.sources[s.dataSource];for(const a in r)r[a]>i&&--r[a];delete n.prototype[e]}}static exposeRelations(){const e=this;if(!Wn(e,"exposedRelations")&&e.relations){e.exposedRelations=[];for(const n in e.relations){const t=e.relations[n];t.relationName=n,e.exposedRelations.push(t),Reflect.ownKeys(e.prototype).includes(n)||Am(e.prototype,n,{enumerable:!0,get:function(){return this.getForeign(n)},set:function(s){this.setForeign(n,s,t)}})}}}static initInitables(e,n){const t=e.meta.initableValues=new Map;for(const s of this.$meta.fields.initable){const r=x.getPath(n,s.dataSource);r!==void 0&&t.set(s,r),!s.lazy&&s.init(n,e)}}assignInitables(){const{initableValues:e}=this.meta;for(const[n,t]of e)n.set(t,this.data,this)!==!1&&e.delete(n)}static get autoExposeFields(){return!0}static fieldSorter(e,n){return($d[e]||100)-($d[n]||100)}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.$meta.fields.map[e]}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.$meta.fields.map[e]}static getFieldDataSource(e){var n;return((n=this.getFieldDefinition(e))==null?void 0:n.dataSource)||e}getDataSource(e){const n=this.constructor.getFieldDefinition(e);return(n==null?void 0:n.dataSource)||(n==null?void 0:n.name)}static processField(e,n,t){const s=this.fieldMap[e];return s!=null&&s.convert?s.convert(n,this.data,t):n}initRelations(){const e=this;e.constructor.exposedRelations&&e.stores.forEach(t=>{var s;t.modelRelations||t.initRelations();const r=[];(s=t.modelRelations)==null||s.forEach(i=>{r.push({related:e.initRelation(i),config:i})}),t.updateRecordRelationCache(e,r)})}initRelation(e){const n=this,t=n.get(e.foreignKey),s=t!==qt&&typeof e.foreignStore!="string"&&e.foreignStore.getById(t),r=n.meta.relationCache||(n.meta.relationCache={});return r[e.relationName]=s||(t!=null?{id:t,placeHolder:!0}:null),s}removeRelation(e){const{relationName:n,foreignKey:t,nullFieldOnRemove:s}=e;this.meta.relationCache[n]&&(delete this.meta.relationCache[n],s&&this.setData(t,null))}getForeign(e){var n;return(n=this.meta.relationCache)==null?void 0:n[e]}setForeign(e,n,t){const s=bo.asId(n);return this.set(t.foreignKey,s)}getRelationConfig(e){var n,t;return(t=(n=this.firstStore)==null?void 0:n.modelRelations)==null?void 0:t.find(s=>s.foreignKey===e)}flatGet(e,n){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:n in this.data?this.data[n]:this.data[e]}complexGet(e,n){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:x.getPath(this.data,n)}get(e){if(!e)return;const n=this,t=n.fieldMap[e];if(!t){if(e.includes("[")){const[,s,r,i]=e.match(Ad),a=n.fieldMap[s];if(a!=null&&a.getAt){n._thisIsAUsedExpression(n[s]);const o=a.getAt(n,r);return o&&i?o.isModel?o.getValue(i):o[i]:o}return null}if(e.includes("."))return x.hasPath(n.data,e)?n.complexGet(e,e):x.getPath(n,e)}return t!=null&&t.complexMapping?n.complexGet(e,t.dataSource):n.flatGet(e,(t==null?void 0:t.dataSource)||e)}getValue(e){if(e)return e in this?this[e]:this.get(e)}setValue(e,n){e in this?this[e]=n:this.set(e,n)}setData(e,n){var t,s;const{data:r,fieldMap:i}=this;if(typeof e=="string"){const a=i[e],o=(t=a==null?void 0:a.dataSource)!=null?t:e;a!=null&&a.set?a.set(n,this.data,this):a!=null&&a.complexMapping?x.setPath(r,o,n):r[o]=n}else{const a=Object.keys(e);for(let o=0;o<a.length;o++){const l=a[o],c=i[l],u=(s=c==null?void 0:c.dataSource)!=null?s:l;c!=null&&c.set?c.set(n,this.data,this):u&&(c!=null&&c.complexMapping?x.setPath(r,u,e[l]):r[u]=e[l])}}}getData(e){var n;const t=this.fieldMap[e],s=(n=t==null?void 0:t.dataSource)!=null?n:e;if(s)return t!=null&&t.complexMapping?x.getPath(this.data,s):this.data[s]}syncId(e){const n=this.id;if(n!==e){this.setData("id",e);const t={id:{value:e,oldValue:n}};this.afterChange(t,t)}}set(e,n,t=!1,s=!1,r=!1,i=!1,a=!0){var o;const l=this;if(l.isBatchUpdating)return l.inBatchSet(e,n,t||l.$silenceBatch),null;{const c=l.inSet(e,n,t,s,r,i,a);return(o=l.afterSet)==null||o.call(l,e,n,t,s,c),c}}fieldToKeys(e,n){return typeof e!="string"?x.assign({},e):{[e]:n}}inBatchSet(e,n,t){const s=this,{meta:r,constructor:i,fieldMap:a}=s,o={};let l,c=!1;if(typeof e!="string"?Object.keys(s.fieldToKeys(e,n)).forEach(u=>{l=a[u]||x,n=i.processField(u,e[u],s),l.isEqual(r.batchChanges[u],n)||(o[u]={value:n,oldValue:s.get(u)},r.batchChanges[u]=n,c=!0)}):(l=a[e]||x,l.isEqual(r.batchChanges[e],n)||(o[e]={value:n,oldValue:s.get(e)},r.batchChanges[e]=n,c=!0)),c&&(s.generation++,!t)){const u={action:"update",record:s,records:[s],changes:o};s.stores.forEach(d=>{d.trigger("batchedUpdate",{...u})}),s.forEachLinked((d,h)=>d.trigger("batchedUpdate",{...u,record:h,records:[h]}))}}inSet(e,n,t,s,r=!1,i=!1,a=!0){var o,l,c;const u=this,{data:d,meta:h,fieldMap:f,constructor:g}=u,{prototype:p,childrenField:m,relations:y}=g,D={},E=u.fieldToKeys(e,n),C=Object.keys(E).sort(g.fieldSorter);let v=!1;if(!t&&!u.triggerBeforeUpdate(E))return null;u.inSetting=!0;for(let S=0;S<C.length;S++){const b=C[S];if(b===m)continue;if(b.includes("[")){const[,Le,Te,Be]=b.match(Ad),Dt=u.fieldMap[Le];if(Dt!=null&&Dt.getAt){const Dr=Dt.getAt(u,Te);Dr.isModel?Dr.set(Be,E[b]):x.setPath(Dr,Be,E[b]);continue}}const w=b.includes(".");if(y&&w){const[,Le,Te]=b.match(Od);if(y[Le]){u[Le].set(Te,E[b]);continue}}const M=f[b],I=M||x,A=M==null?void 0:M.readOnly,T=(o=M==null?void 0:M.dataSource)!=null?o:b,k=!r&&!M&&b in p||(M==null?void 0:M.useProp),Z=k?u[T]:M!=null&&M.complexMapping||w?x.getPath(d,T):d[T],z=g.processField(b,E[b],u),re=E[b]={value:z},be=u.getRelationConfig(b);!A&&!I.isEqual(Z,z)&&(!i||z!==void 0)&&(u.generation++,re.oldValue=(c=(l=M==null?void 0:M.getOldValue)==null?void 0:l.call(M,u))!=null?c:Z,v=!0,b in h.modified&&I.isEqual(h.modified[b],z)?(Reflect.deleteProperty(h.modified,b),u.isReverting&&(u.data[T]=z)):u.ignoreBag||(b in h.modified||u.storeFieldChange(b,Z),re.oldValue===qt&&Reflect.deleteProperty(re,"oldValue")),D[b]=re,u.applyValue(k,T,z,r,M),be&&!s&&(u.initRelation(be),u.stores.forEach(Le=>Le.cacheRelatedRecord(u,z,be.relationName,re.oldValue))))}return v&&u.afterChange(E,D,t,s,r),u.inSetting=!1,v?D:null}applyValue(e,n,t,s,r){var i;const a=this;if(((r==null?void 0:r.name)||n)===a.constructor.parentIdField)(i=a.parent)!=null&&i.isRoot&&(t==null||!a.firstStore.getById(t))||(a.firstStore.getById(t)||a.firstStore.rootNode).insertChild(a,null,!1,{orderedParentIndex:{skip:!0}});else if(e)a[(r==null?void 0:r.name)||n]=t;else if(r!=null&&r.set)r.set(t,a.data,a);else{let o=r==null?void 0:r.complexMapping;if(!r&&n.includes(".")){const l=n.split(".")[0];r=a.constructor.fieldMap[l],o=(r==null?void 0:r.complexMapping)||(r==null?void 0:r.type)==="object"}o?x.setPath(a.data,n,t):a.data[n]=t}}afterChange(e,n,t,s,r){for(const i of this.stores)i.onModelChange(this,e,n,t,s,r);this.forEachLinked((i,a)=>i.onModelChange(a,e,n,t,s,r))}forEachLinked(e){for(const n of this.$links)for(const t of n.stores)e(t,n)}get isPersistable(){return!this.isBatchUpdating&&!this.isCreating}get isModified(){return!!(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!x.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&e in this.meta.modified}getFieldPersistentValue(e){const n=typeof e=="string"?this.getFieldDefinition(e):e,t=(n==null?void 0:n.name)||e;let s;return(!n||n.persist)&&(s=this.getValue(t),n!=null&&n.serialize&&(s=n.serialize(s,this))),s}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,n={};if(!e.isModified)return null;let t=!1;return Object.keys(e.meta.modified).forEach(s=>{const r=e.getFieldPersistentValue(s);r!==qt&&(n[s]=r,t=!0)}),t?n:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&x.setPath(e,this.constructor.idField,this.id),e}get rawModificationData(){const e=this,{fieldMap:n}=e.constructor,t={};if(!e.isModified)return null;let s=!1;return Object.keys(e.meta.modified).forEach(r=>{let i=n[r],a=i==null?void 0:i.dataSource;if(r.includes(".")){const o=r.match(Od)[1];i=n[o],a=r}if(i!=null&&i.persist){const o=e.getFieldPersistentValue(r);o!==qt&&(x.setPath(t,a,o),s=!0)}}),s?t:null}get modificationDataToWrite(){const e=this.constructor.alwaysWriteFields,n=this.modificationData;return e.forEach(t=>{n[this.getFieldDefinition(t).dataSource]=this.getFieldPersistentValue(t)}),n}get persistableData(){const e=this,n={};return e.fields.forEach(t=>{const s=e.getFieldPersistentValue(t);s!==qt&&(t!=null&&t.complexMapping?x.setPath(n,t.dataSource,s):n[t.dataSource]=s)}),n}get dataByFieldName(){const{data:e}=this;return this.fields.reduce((n,t)=>(x.hasPath(e,t.dataSource)&&(n[t.name]=e[t.dataSource]),n),{})}get isCommitting(){return!!this.meta.committing}clearChanges(e=!0,n=!0,t=null){const s=this,{meta:r}=s;if(t)for(const a in t)delete r.modified[a];else r.modified={};const i=x.isEmpty(r.modified);r.committing=!1,n&&s.stores.forEach(a=>{if(i&&a.modified.remove(s),a.added.remove(s),e){const o=a.collectDescendants(s).all;a.added.remove(o),i&&a.modified.remove(o)}})}storeFieldChange(e,n){this.meta.modified[e]=n}revertChanges(e=!1){this.isReverting=!0,this.set(this.meta.modified,qt,e),this.isReverting=!1}applyChangeset(e,n="$PhantomId",t=!0){var s;const r=this,i=r.constructor,{idField:a,fieldDataSourceMap:o}=i,l=x.pathifyKeys(e,o),c=x.pathifyKeys(r.modificationData),u={},d=n in e;for(const f in l){const g=o[f],p=(s=g==null?void 0:g.name)!=null?s:f;(t||((g==null?void 0:g.name)===a?d:l[f]===c[f]))&&(u[p]=l[f])}const h=r.set(u);return r.clearChanges(!1,!0,t?null:u),h?Object.entries(h).reduce((f,[g,p])=>(f[g]=p.value,f),{}):{}}get internalId(){return this._internalId}get isPhantom(){return this.id===""||this.id==null||this.hasGeneratedId}get isModel(){return!0}get hasGeneratedId(){return typeof this.id=="string"&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return`_generated${e}_${U.generateUUID()}`}generateId(){return this.constructor.generateId()}static asId(e){return e!=null&&e.isModel?e.id:x.isObject(e)?e[this.fieldMap.id.dataSource]:e}get json(){return U.safeJsonStringify(this)}toJSON(){const{children:e,unfilteredChildren:n}=this,t=this.persistableData;return(n||e)&&(t[this.constructor.childrenField]=(n||e).map(s=>s.toJSON())),t}toString(){const e=this,n=_m.find(s=>s in e.constructor.fieldMap),t=n?{[e.constructor.idField]:e.id,[n]:e[n]}:e.data;return U.safeJsonStringify(t)}get isBatchUpdating(){return!!this.batching}hasBatchedChange(e){var n,t;return(t=(n=this.meta)==null?void 0:n.batchChanges)==null?void 0:t[e]}beginBatch(e=!1){const n=this;n.batching||(n.batching=0,n.meta.batchChanges={}),e&&(n.$silenceBatch=(n.$silenceBatch||0)+1),n.batching++}endBatch(e=!1,n=!1,t=!0){const s=this,{parentIdField:r}=s.constructor;if(s.batching&&(s.batching--,s.$silenceBatch&&s.$silenceBatch--,!(s.batching>0)&&!x.isEmpty(s.meta.batchChanges))){let{batchChanges:i}=s.meta;s.meta.batchChanges=null,i[r]&&(i={...i},s.parentId=i[r],delete i[r]),s.set(i,qt,e,!1,n,void 0,t)}}cancelBatch(){if(this.batching){const e=this,{batchChanges:n}=e.meta,t={};if(e.batching=null,e.meta.batchChanges=null,e.generation++,!e.$silenceBatch){Object.entries(n).forEach(([r,i])=>{t[r]={oldValue:i,value:e[r]}});const s={action:"update",record:e,records:[e],changes:t};e.stores.forEach(r=>{r.trigger("batchedUpdate",{...s})}),e.forEachLinked((r,i)=>{r.trigger("batchedUpdate",{...s,record:i,records:[i]})})}e.$silenceBatch&&e.$silenceBatch--}}triggerBeforeUpdate(e){var n;return!((n=this.stores)!=null&&n.some(t=>t.trigger("beforeUpdate",{record:this,changes:e})===!1))}copy(e=null,n){const t=this,s=x.clone(t.data),r=t.constructor.idField,i=x.isObject(n)?n.deep:n;let a;if(e&&typeof e=="object"?(a=e[r],Object.assign(s,e)):a=e,i&&t.children?s.children=t.children.map(l=>l.copy(void 0,n)):(delete s.children,delete s.expanded),t.$meta.fields.initable.length>0){const l=t.toJSON();for(const c of t.$meta.fields.initable)s[c.name]=l[c.name]}e!==!1&&(s[r]=a||t.generateId(t.firstStore));const o=new t.constructor(s,null,null,!1,!0);return o.originalInternalId=t.internalId,o}copyData(e,n,t){const s={};e.allFields.forEach(({name:r})=>{r!==e.constructor.idField&&(s[r]=n?e.get(r):e.getValue(r))}),this.set(s,null,t)}remove(e=!1){const n=this,{parent:t}=this;t?t.removeChild(n):n.stores.length&&!n.isSpecialRow&&n.stores.forEach(s=>s.remove(n,e,!1,!0))}beforeRemove(e,n){return super.beforeRemove(e,n)}get isValid(){return!0}get firstStore(){return this.stores.length>0&&this.stores[0]}joinStore(e){var n;const t=this,{stores:s}=t;if(!s.includes(e)){const{unjoinedStores:r}=t;super.joinStore(e),e.register(t),s.push(e),r.includes(e)&&r.splice(r.indexOf(e),1),t.isLoaded&&t.children.forEach(i=>i.joinStore(e)),t.initRelations(),e.tree&&!t.isRoot&&!((n=e.stm)!=null&&n.isRestoring)&&(t.instanceMeta(e.id).collapsed=!t.expanded)}}unjoinStore(e,n=!1){var t,s,r;const i=this,{stores:a,unjoinedStores:o}=i;a.includes(e)&&(e.isDestroying||(e.unregister(i),o.push(e)),(s=(t=i.unfilteredChildren||i.children)==null?void 0:t.forEach)==null||s.call(t,l=>l.unjoinStore(e,n)),a.splice(a.indexOf(e),1),(r=super.unjoinStore)==null||r.call(this,e,n),e.uncacheRelatedRecord(i))}isPartOfStore(e){return e?e.includes(this):this.stores.length>0}get isRemoved(){return!this.isPartOfStore()}instanceMeta(e){const{meta:n}=this,t=e.id||e;return n.map||(n.map={}),n.map[t]||(n.map[t]={})}get isGroupHeader(){return"groupRowFor"in this.meta}get isGroupFooter(){return"groupFooterFor"in this.meta}get isSpecialRow(){var e;return!!((e=this.meta)!=null&&e.specialRow)}get $original(){return this.isLinked?this.proxyMeta.originalRecord:this}static get nonPersistableFields(){const e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach(n=>{(!n.persist||n.calculated)&&(e._nonPersistableFields[n.name]=1)})),e._nonPersistableFields}static get alwaysWriteFields(){const e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=[],e.allFields.forEach(n=>{n.alwaysWrite&&e._alwaysWriteFields.push(n.name)})),e._alwaysWriteFields}get domId(){return typeof this.id=="string"?this.id.replace(/[ .]/g,"-"):this.id}static toJavaScriptValue(e){const{names:n}=this.$meta,t=n[n.length-2],s=n[n.length-3];return`class ${t} extends ${s} { static fields = ${U.toJavaScriptValue(this.fields,e)}; }`}getCurrentConfig(e){const{data:n,children:t}=this,{defaultValues:s,applyConfigs:r}=this.constructor,i=r?super.getCurrentConfig(e):{};if(i){for(const a of this.fields)if(a.persist){const o=x.getPath(n,a.dataSource);a.isEqual(o,s[a.name])||x.setPath(i,a.dataSource,$.processConfigValue(o,e))}if(t)if(Array.isArray(t)){i.children=[];for(const a of t)i.children.push(a.getCurrentConfig(e))}else i.children=t;this.hasGeneratedId&&delete i.id,delete i.parentId,delete i.parentIndex}return i}},H=bo;F(H,"relations",null),H._idField="id",H._internalIdCounter=1,H._assignedIdField=!1,H.exposeProperties(),H._$name="Model";var ii=class extends O([xt,H],e=>{const n=e.prototype;class t extends e{get isEntity(){return!0}construct(r,...i){this.constructor.exposeProperties(),this.originalData=r=r||{},n.construct.call(this,r,...i);for(const a in this.originalData)this.$[a]&&!this.getFieldDefinition(a)&&(this[a]=r[a])}*userProvidedValue(){return yield X}copy(r=null,i=null){const a=n.copy.call(this,r,i),{creatingOccurrence:o}=i!=null?i:{};return(x.isObject(i)&&!i.skipFieldIdentifiers||!x.isObject(i))&&this.forEachFieldIdentifier((l,c,u)=>{var d;!u.lazy&&((d=this.getFieldDefinition(c))==null?void 0:d.type)!=="store"&&(!o||l instanceof ti||l instanceof Nn)&&(a[c]=this[c])}),a}applyValue(r,i,a,o,l){var c;this.$entity.getField((l==null?void 0:l.name)||i)&&(r=!0),o&&(r=!1),n.applyValue.call(this,r,r&&(c=l==null?void 0:l.name)!=null?c:i,a,o,l)}get isInActiveTransaction(){var r;const i=(r=this.graph)==null?void 0:r.activeTransaction;return!!(i!=null&&i.getLatestEntryFor(this.$$))}get data(){return this._data}set data(r){this._data=r;const{fields:i,$:a,graph:o,generation:l}=this;for(let c=0;c<i.length;c++){const{name:u,dataSource:d,complexMapping:h}=i[c],f=a[u];if(f){const g=h?x.getPath(r,d):r[d];(h||d in r)&&(l!=null||g!==void 0)&&f.writeToGraph(o,g)}}}get $entityName(){const r=this.constructor.name||this.$entity.name,i=this.id;return`${r}${i!=null?"-"+String(i):""}`}}return t}){},zn=class extends O([],e=>{const n=e.prototype;class t extends e{async commitAsync(){return this.project.commitAsync()}set project(r){this.$project=r}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(r){return this.project=r}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const r=this.getProject();return r==null?void 0:r.assignmentStore}getDependencyStore(){const r=this.getProject();return r==null?void 0:r.dependencyStore}getEventStore(){const r=this.getProject();return r==null?void 0:r.eventStore}getResourceStore(){const r=this.getProject();return r==null?void 0:r.resourceStore}getCalendarManagerStore(){const r=this.getProject();return r==null?void 0:r.calendarManagerStore}}return t}){},Ro=class extends O([zn],e=>{const n=e.prototype;class t extends e{getGraph(){const r=this.getProject();return r==null?void 0:r.getGraph()}getEventById(r){var i;return(i=this.getEventStore())==null?void 0:i.getById(r)}getDependencyById(r){var i;return(i=this.getDependencyStore())==null?void 0:i.getById(r)}getResourceById(r){var i;return(i=this.getResourceStore())==null?void 0:i.getById(r)}getAssignmentById(r){var i;return(i=this.getAssignmentStore())==null?void 0:i.getById(r)}getCalendarById(r){var i;return(i=this.getCalendarManagerStore())==null?void 0:i.getById(r)}}return t}){};function jm(e,n){const t=x.getPropertyDescriptor(e,n);return t&&(t.get||t.set)?t:null}var ai=class extends $.mixin(Vt,gt){static get configurable(){return{clientListeners:null,disabled:!1,client:null,keyMap:null}}updateClient(e){this.owner||(this.owner=e)}updateKeyMap(e){const{client:n}=this;n.keyMap=n.mergeKeyMaps(n.keyMap,e,U.uncapitalize(this.constructor.$name))}static initPlugins(e,...n){const t=e.plugins||(e.plugins={});for(const s of n)t[s.$$name]=new s(e)}get enabled(){return!this.disabled}getFocusRevertTarget(){var e;return(e=this.client)==null?void 0:e.getFocusRevertTarget()}construct(...e){const n=this;let[t,s]=e,r;e.length===1?x.isObject(t)&&(s=t,t=s.client):(s=x.assign({},s),delete s.client),n.client=t,super.construct(s),n.applyPluginConfig(t),r=n.clientListeners,r&&(r=x.assign({},r),r.thisObj=n,t.ion(r))}applyPluginConfig(e){const n=this,t=n.pluginConfig||n.constructor.pluginConfig;if(t){const{assign:s,chain:r,after:i,before:a,override:o}=t;s&&n.applyAssign(e,s),(r||i)&&n.applyChain(e,r||i),a&&n.applyChain(e,a,!1),o&&n.applyOverride(e,o)}}applyAssign(e,n){n.forEach(t=>this.assign(e,t))}applyChain(e,n,t=!0){if(Array.isArray(n))for(const s of n)this.chain(e,s,s,t);else for(const s in n)this.chain(e,s,n[s],t)}applyOverride(e,n){const t=this;t.overridden||(t.overridden={}),n.forEach(s=>{if(!t[s])throw new Error(`Trying to chain fn ${e.$$name}#${s}, but plugin fn ${t.$$name}#${s} does not exist`);typeof e[s]=="function"&&(t.overridden[s]=e[s].bind(e)),e[s]=t[s].bind(t)})}assign(e,n){const t=this,s=jm(t,n);s?Object.defineProperty(e,n,{configurable:!0,enumerable:!0,get:s.get&&s.get.bind(t),set:s.set&&s.set.bind(t)}):e[n]=t[n].bind(t)}chain(e,n,t,s=!0){let r=0;typeof n=="object"&&(n=n.fn),typeof t=="object"&&(r=t.prio||0,t=t.fn);const i=this,a=e.pluginFunctionChain||(e.pluginFunctionChain={}),o=i[t]&&i[t].bind(i),l=i.functionChainRunner;if(!o)throw new Error(`Trying to chain fn ${e.$$name}#${t}, but plugin fn ${i.$$name}#${t} does not exist`);if(!a[n]){let c=e[n];c&&(c=c.bind(e),c.$this=e,c.$prio=0),a[n]=c?[c]:[],e[n]=(...u)=>l(a[n],u)}o.$this=i,o.$prio=r,a[n][s?"push":"unshift"](o),a[n].$sorted=!1}functionChainRunner(e,n){let t,s,r;for(e.$sorted||(e.sort((i,a)=>a.$prio-i.$prio),e.$sorted=!0),s=0;s<e.length&&(t=e[s],!(!t.$this.isDestroyed&&(r=t(...n),r===!1)));s++);return r}doDisable(e){var n,t,s,r;const i=this,{constructor:a}=i,o="featureClass"in a?a.featureClass:`b-${a.$$name.toLowerCase()}`,l=U.uncapitalize(a.$$name);o&&((t=(n=i.client)==null?void 0:n._element)==null||t.classList[e?"remove":"add"](o)),i.isConfiguring||(e?i.trigger("disable"):i.trigger("enable"),(r=(s=i.client).syncSplits)==null||r.call(s,c=>{const u=c.features[l];u&&(u.disabled=e)}))}updateDisabled(e){this.doDisable(e)}throwOverrideIsMissing(e){throw new Error(`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`)}get rootElement(){return this.client.rootElement}};F(ai,"$name","InstancePlugin"),ai._$name="InstancePlugin";var km=e=>class extends(e||$){static get $name(){return"Pluggable"}get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(t){t&&(Array.isArray(t)||(t=[t]),ai.initPlugins(this,...t)),this.initPlugins()}initPlugins(){}addPlugins(...t){ai.initPlugins(this,...t)}hasPlugin(t){return this.getPlugin(t)!=null}getPlugin(t){var s;return typeof t=="function"&&(t=t.$$name),(s=this.plugins)==null?void 0:s[t]}get widgetClass(){}},{defineProperty:Io}=Reflect,oi;Oe.isBrowserEnv?oi=globalThis.performance:oi={now(){return new Date().getTime()}};var Y=null;if(Se.isTestEnv){const e=globalThis.bryntum||(globalThis.bryntum={});Y=e.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,idleCallbacks:new Map,isEmpty(n=!1){return Y.timeouts.size+Y.animationFrames.size+Y.idleCallbacks.size+(n?Y.intervals.size:0)===0},getFiltered({ignoreTimeouts:n=[],maxDelay:t=5e3,includeIntervals:s=!1}){const r=[],i=["timeouts","animationFrames","idleCallbacks"];s&&i.push("intervals");for(const a of i){const o=Y[a];for(const[,l]of o.entries())!n.includes(l.name)&&(!Number.isInteger(l.delay)||l.delay<t)&&r.push(l)}return r}}}var qn=(e,n,t,s)=>{const r=typeof n=="string",i=(s==null?void 0:s.appendArgs)||[],a=()=>{t.timerId=null,t.lastCallTime=oi.now();const o=t.args;t.args=null,r?e[n](...o,...i):n.call(e,...o,...i),t.called=!0,++t.calls};return s&&(e=s.thisObj||e),t.lastCallTime=-9e9,t.calls=0,t.invoker=a,a.wrapFn=t,a},li=(e,n,t="clearTimeout")=>(n.cancel=()=>{n.isPending&&(e[t](n.timerId),n.args=n.timerId=null)},n.flush=()=>{n.isPending&&(e[t](n.timerId),n.timerId=null,n.invoker())},n.now=(...s)=>{n.cancel(),n.args=s,n.invoker()},n.resume=s=>{const r=n.suspended;n.suspended=s||r<1?0:r-1},n.suspend=()=>{++n.suspended},n.immediate=!1,n.suspended=0,n.timerId=null,Io(n,"isPending",{get(){return n.timerId!==null}}),n),Ar=e=>class extends(e||$){static get $name(){return"Delayable"}static get declarable(){return["delayable"]}doDestroy(){const t=this;super.doDestroy(),t.timeoutIds&&(t.timeoutIds.forEach((s,r)=>{typeof s=="function"&&s(),clearTimeout(r),Y==null||Y.timeouts.delete(r)}),t.timeoutIds=null),t.timeoutMap&&(t.timeoutMap.forEach((s,r)=>clearTimeout(r)),t.timeoutMap=null),t.intervalIds&&(t.intervalIds.forEach(s=>{clearInterval(s),Y==null||Y.intervals.delete(s)}),t.intervalIds=null),t.animationFrameIds&&(t.animationFrameIds.forEach(s=>{cancelAnimationFrame(s),Y==null||Y.animationFrames.delete(s)}),t.animationFrameIds=null),t.idleCallbackIds&&(t.idleCallbackIds.forEach(s=>{cancelIdleCallback(s),Y==null||Y.idleCallbacks.delete(s)}),t.idleCallbackIds=null)}hasTimeout(t){var s;return!!((s=this.timeoutMap)!=null&&s.has(t))}setTimeout({fn:t,delay:s,name:r,runOnDestroy:i,cancelOutstanding:a,args:o}){(arguments.length>1||typeof arguments[0]=="function")&&([t,s,r,i]=arguments),typeof t=="string"?r=t:r||(r=t.name||t),a&&this.clearTimeout(r);const l=this,c=l.timeoutIds||(l.timeoutIds=new Map),u=l.timeoutMap||(l.timeoutMap=new Map),d=setTimeout(()=>{typeof t=="string"&&(t=l[r]),c==null||c.delete(d),u==null||u.delete(r),Y==null||Y.timeouts.delete(d),t.apply(l,o)},s);return c.set(d,i?t:!0),Y==null||Y.timeouts.set(d,{fn:t,delay:s,name:r}),r&&u.set(r,d),d}clearTimeout(t){var s;let r=t;if(typeof r=="string")if(this.timeoutMap)r=this.timeoutMap.get(t),this.timeoutMap.delete(t);else return;clearTimeout(r),(s=this.timeoutIds)==null||s.delete(r),Y==null||Y.timeouts.delete(r)}clearInterval(t){var s;clearInterval(t),(s=this.intervalIds)==null||s.delete(t),Y==null||Y.intervals.delete(t)}setInterval(t,s,r){const i=setInterval(t,s);return(this.intervalIds||(this.intervalIds=new Set)).add(i),Y==null||Y.intervals.set(i,{fn:t,delay:s,name:r}),i}requestAnimationFrame(t,s=[],r=this){const i=this.animationFrameIds||(this.animationFrameIds=new Set),a=requestAnimationFrame(()=>{Y==null||Y.animationFrames.delete(a),i.delete(a)&&t.apply(r,s)});return i.add(a),Y==null||Y.animationFrames.set(a,{fn:t,extraArgs:s,thisObj:r}),a}requestIdleCallback(t,s=[],r=this){const i=this.idleCallbackIds||(this.idleCallbackIds=new Set),a=requestIdleCallback(()=>{Y==null||Y.idleCallbacks.delete(a),i.delete(a)&&t.apply(r,s)});return i.add(a),Y==null||Y.idleCallbacks.set(a,{fn:t,extraArgs:s,thisObj:r}),a}createOnFrame(t,s=[],r=this,i){let a;const o=(...l)=>{a!=null&&i&&(this.cancelAnimationFrame(a),a=null),a==null&&(a=this.requestAnimationFrame(()=>{typeof t=="string"&&(t=r[t]),a=null,l.push(...s),t.apply(r,l)}))};return o.cancel=()=>this.cancelAnimationFrame(a),o}cancelAnimationFrame(t){var s;cancelAnimationFrame(t),(s=this.animationFrameIds)==null||s.delete(t),Y==null||Y.animationFrames.delete(t)}cancelIdleCallback(t){var s;cancelIdleCallback(t),(s=this.idleCallbackIds)==null||s.delete(t),Y==null||Y.idleCallbacks.delete(t)}async nextAnimationFrame(){return new Promise(t=>this.requestAnimationFrame(t))}buffer(t,s){let r=s;s&&typeof s!="number"?r=s.delay:s=null;const i=(...o)=>{if(i.suspended)return;const{delay:l}=i;i.cancel(),i.called=!1,i.args=o,i.immediate||!l?a():i.timerId=this.setTimeout(a,l)},a=qn(this,t,i,s);return i.delay=r,li(this,i)}raf(t,s){let r=s;s&&typeof s!="boolean"?r=s.cancelOutstanding:s=null;const i=(...o)=>{i.suspended||(i.cancelOutstanding&&i.cancel(),i.called=!1,i.args=o,i.immediate?a():i.isPending||(i.timerId=this.requestAnimationFrame(a)))},a=qn(this,t,i,s);return i.cancelOutstanding=r,li(this,i,"cancelAnimationFrame")}idle(t,s){let r=s;s&&typeof s!="boolean"?r=s.cancelOutstanding:s=null;const i=(...o)=>{i.suspended||(i.cancelOutstanding&&i.cancel(),i.called=!1,i.args=o,i.immediate?a():i.isPending||(i.timerId=this.requestIdleCallback(a)))},a=qn(this,t,i,s);return i.cancelOutstanding=r,this.setTimeout(()=>this.idleCallbackIds.delete(i.timerId)&&i.now(),100),li(this,i,"cancelIdleCallback")}throttle(t,s){let r=s,i;s&&typeof s!="number"?(r=s.delay,i=s.throttled):s=null;const a=this,o=(...c)=>{if(o.suspended)return;const{delay:u}=o,d=oi.now()-o.lastCallTime;o.args=c,o.immediate||d>=u?(a.clearTimeout(o.timerId),l()):(o.isPending||(o.timerId=a.setTimeout(l,u-d),o.called=!1),i&&(i.wrapFn.args=c,i()))},l=qn(a,t,o,s);return o.delay=r,i&&(i=qn(a,i,()=>{},s)),li(a,o)}static setupDelayable(t){t.setupDelayableMethods(t.delayable)}static setupDelayableMethods(t,s=null){const r=this,i=t.static,a=s||r.prototype;i&&delete t.static;for(const o in t){let l=t[o];const c=o+"Now",u=typeof l;a[c]||(a[c]=a[o]),u==="number"?l={type:"buffer",delay:l}:u==="string"&&(l={type:l}),Io(a,o,{get(){const d=this[l.type]((...h)=>{this[c](...h)},l);return Io(this,o,{value:d}),d}})}}get widgetClass(){}},Gn=class{get data(){return Object.create(null)}get keys(){return[]}clear(){}getItem(e){return null}removeItem(e){}setItem(e,n){}};Gn._$name="StateStorage";var Lm=class extends Gn{constructor(e){super(),this.prefix=e.prefix||""}get isLocal(){return!0}get data(){const e=_d(),n=this.keys;for(const t of n)e[t]=this.getItem(t);return e}get keys(){return Fd(this.prefix,this.prefix.length)}clear(){const e=Fd(this.prefix);for(const n of e)localStorage.removeItem(n)}getItem(e){const n=localStorage.getItem(this.prefix+e);return n===null?n:JSON.parse(n)}removeItem(e){return localStorage.removeItem(this.prefix+e)}setItem(e,n){return localStorage.setItem(this.prefix+e,JSON.stringify(n))}},Bm=class extends Gn{constructor(){super(),this.clear()}get isMemory(){return!0}get data(){return x.clone(this._data)}get keys(){return Object.keys(this._data)}clear(){this._data=_d()}getItem(e){return e in this._data?this._data[e]:null}removeItem(e){delete this._data[e]}setItem(e,n){this._data[e]=n}},_d=()=>Object.create(null),Fd=(e,n=0)=>{const t=[],s=localStorage.length;for(let r,i=0;i<s;++i)r=localStorage.key(i),r.startsWith(e)&&t.push(r.slice(n));return t},jd=new Gn,Po={local:Lm,memory:Bm},Hn=class extends $.mixin(Ar,Vt){static get $name(){return"StateProvider"}static get configurable(){return{prefix:"bryntum-state:",storage:"local"}}static get delayable(){return{writeStatefuls:50}}static get instance(){return this._instance}static set instance(e){e==null?e=kd:((typeof e=="string"||x.isClass(e)||e instanceof Gn)&&(e={storage:e}),x.isObject(e)&&(e=new Hn(e))),this._instance=e}static setup(e){return this.instance=e,this.instance}doDestroy(){self.writeStatefuls.flush(),super.doDestroy()}get data(){return this.storage.data}set data(e){if(!e)this.clear();else for(const n in e)this.setValue(n,e[n])}clear(){return this.storage.clear(),this}changeStorage(e){if(e==null)e=jd;else{if(typeof e=="string"){if(!Po[e])throw new Error(`Invalid storage type "${e}" (expected one of: "${Object.keys(Po).join('", "')}")`);e=Po[e]}x.isClass(e)&&(e=new e(this))}return e}saveStateful(e,n){(this.pendingSaves||(this.pendingSaves=[])).push([e,n]),this.writeStatefuls()}writeStatefuls(){const e=this,{pendingSaves:n}=e,t=n==null?void 0:n.length,s=[],r=[];if(e.pendingSaves=null,t){for(let i,a,o,l=0;l<t;++l)[a,i]=n[l],!a.isDestroying&&a.isSaveStatePending&&(o=a.saveState({...i,immediate:!0}),o&&(s.push(o),r.push(a)));s.length&&e.trigger("save",{stateIds:s,saved:r})}}getValue(e){return this.writeStatefuls.flush(),this.storage.getItem(e)}setValue(e,n){const t=this,{storage:s}=t,r=t.getValue(e);return n!=null?(s.setItem(e,n),t.trigger("set",{key:e,value:n,was:r})):r!==null&&(s.removeItem(e),t.trigger("remove",{key:e,was:r})),t}},kd=new Hn({storage:jd});Hn._instance=kd,Hn._$name="StateProvider";var Nm=/boolean|number|string/,Vm=e=>{var n;return n=class extends(e||$){afterConstruct(){super.afterConstruct(),this.loadState()}finalizeInit(){this.loadState(),super.finalizeInit()}get isStateful(){return!0}get isStatefulActive(){return!this.statefulSuspended&&!this.isResponsivePending&&!this.isResponsiveUpdating}get state(){return this._state=this.getState()}set state(t){this._state=t,t&&this.applyState(t)}updateStatefulEvents(t){var s;const r=this,i={name:"statefulEvents",thisObj:r};if(r.detachListeners(i.name),t&&(typeof t=="string"?t=U.split(t):Array.isArray(t)||(t=x.getTruthyKeys(t)),t.length)){for(const a of t)i[a]="onStatefulEvent";(s=r.ion)==null||s.call(r,i)}}get statefulId(){const t=this,{responsiveState:s}=t;let r=t.stateId;return r==null&&t.hasGeneratedId===!1&&t.stateful!==!1&&(r=t.id),r&&s&&(r=`${r}[${s}]`),r}get statefulness(){const{stateful:t}=this;return Array.isArray(t)?x.createTruthyKeys(t):t}get stateProvider(){return this._stateProvider||Hn.instance}applyState(t){t=this.pruneState(t),t&&this.setConfig(t)}getState(){const t=this,{initialConfig:s,statefulness:r,isConstructing:i}=t,{configs:a}=t.$meta,o=i?Object.setPrototypeOf(s,t.$meta.config):t;let l=null,c,u;if(r){l={};for(c in r)if(r[c]){if(u=o[c],u!=null&&u.isStateful)u=u.state;else if(!i&&(x.isDate(u)&&(u=R.format(u,"YYYY-MM-DDTHH:mm:ssZ")),a[c].equal(u,s==null?void 0:s[c])||!Nm.test(typeof u)))continue;l[c]=u}}return l}loadState(t,s){typeof t=="boolean"&&(s=t,t=null);const r=this,{statefulLoaded:i}=r;if(r.isStatefulActive&&(s||!i)){const a=r.loadStatefulData(t||(t=r.statefulId));!i&&t&&(r.defaultState=r.state,r.statefulLoaded=!0),a&&(r.state=a)}}loadStatefulData(t){var s;return t=this.isStatefulActive?t||this.statefulId:null,t&&((s=this.stateProvider)==null?void 0:s.getValue(t))}resetDefaultState(){this.defaultState&&(this.state=this.defaultState)}resumeStateful(t=!1){this.statefulSuspended=t?0:Math.max(this.statefulSuspended-1,0)}saveState(t){typeof t=="string"?t={id:t}:t=t||{};const s=this,{stateProvider:r}=s,i=t.id||s.isStatefulActive&&s.statefulId;if(i&&r)return t.immediate?(s.isSaveStatePending=!1,r.setValue(i,s.state)):s.isSaveStatePending||(s.isSaveStatePending=!0,r.saveStateful(s,t)),i}suspendStateful(){++this.statefulSuspended}onConfigChange({name:t,value:s,was:r,config:i}){if(super.onConfigChange({name:t,value:s,was:r,config:i}),!this.isConstructing&&this.isStatefulActive&&this.statefulId){const{stateful:a}=this;(Array.isArray(a)?a.includes(t):a!=null&&a[t])&&this.saveState()}}onStatefulEvent(){this.isConstructing||this.saveState()}pruneState(t){const{statefulness:s}=this;if(s){const r={};for(const i in t)s[i]&&(r[i]=t[i]);t=r}return t}get widgetClass(){}},F(n,"$name","State"),F(n,"configurable",{stateful:{value:null,$config:{merge:"classList"}},statefulEvents:{$config:{merge:"classList"},value:["stateChange"]},stateId:null,stateProvider:null}),F(n,"prototypeProperties",{statefulLoaded:!1,statefulSuspended:0}),n},Ld=x.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),Um={string:1,number:1},Bd=e=>class extends(e||$){static get $name(){return"Identifiable"}static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(t,s){const{identifiable:r}=t;r.idMap=Object.create(null),Reflect.defineProperty(t,"identifiable",{get(){return r}})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(t){return(this.hasGeneratedId=!t)?this.generateAutoId():t}updateId(t,s){const r=this,i=r.constructor;s&&i.unregisterInstance(r,s),(!r.hasGeneratedId||i.identifiable.registerGeneratedId!==!1)&&i.registerInstance(r,t)}generateAutoId(){return this.constructor.generateId(`b-${this.$$name.toLowerCase()}-`)}static get all(){return Object.values(this.identifiable.idMap)}static generateId(t="generatedId"){return t+(Ld[t]=(Ld[t]||0)+1)}static registerInstance(t,s=t.id){const{idMap:r}=this.identifiable;if(s in r&&!this.disableThrow)throw new Error("Id "+s+" already in use");r[s]=t}static unregisterInstance(t,s=t.id){const{idMap:r}=this.identifiable;Um[typeof t]?delete r[t]:r[s]===t&&delete r[s]}static getById(t){const s=this.identifiable.idMap;if(s)return s[t]}static get registeredInstances(){const t=this.identifiable.idMap;return t?Object.values(t):[]}},xe=class{constructor(e,n){typeof e=="number"||e===null?(this._magnitude=e,this._unit=n):(typeof e=="string"&&Object.assign(this,R.parseDuration(e)),typeof e=="object"&&Object.assign(this,e))}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude=typeof e=="number"&&e}get unit(){return this._unit}set unit(e){this._unit=R.parseTimeUnit(e)}get isValid(){return this._magnitude!=null&&!!R.normalizeUnit(this._unit)}get milliseconds(){return this.isValid?Math.round(R.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return!!e&&this._magnitude!=null&&e._magnitude!=null&&this.milliseconds===e.milliseconds}toString(e){const n=this,t=e?"getShortNameOfUnit":"getLocalizedNameOfUnit";return n.isValid?`${n._magnitude} ${R[t](n._unit,n._magnitude!==1)}`:""}toJSON(){return this.toString()}valueOf(){return this.milliseconds}diff(e){return new xe({unit:this.unit,magnitude:R.as(this.unit,this.milliseconds-e.milliseconds)})}};xe._$name="Duration";var Wm=(e,n)=>e==null?void 0:e[n],zm=/^is(this|next|last)(week|month|year)$/i,qm=["isToday","isTomorrow","isYesterday","isThisWeek","isNextWeek","isLastWeek","isThisMonth","isNextMonth","isLastMonth","isThisYear","isNextYear","isLastYear","isYearToDate"],ci=class extends $.mixin(Bd){static get defaultConfig(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null,internal:null,disabled:!1}}static get configurable(){return{property:null}}construct(e){typeof e=="function"&&(e={filterBy:e}),e.type?e.type==="date"&&e.value!=null&&!Array.isArray(e.value)?e.value=new Date(e.value):e.type==="duration"&&e.value!=null&&!Array.isArray(e.value)&&(e.value=new xe(e.value)):R.isDate(e.value)||Array.isArray(e.value)&&e.value.every(R.isDate)?e.type="date":e.value instanceof xe&&(e.type="duration"),super.construct(e)}get id(){return this._id||(this.internal?this._id=ci.generateId(`b-internal-${this.property}-filter-`):this._id=this.property||ci.generateId("b-filter-")),this._id}set id(e){this._id=e}onChange(e){var n;const t=this;!t.isConfiguring&&((n=t.owner)!=null&&n.onFilterChanged)&&!t.owner.isConfiguring&&t.owner.onFilterChanged(t,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){const n=this;let t;return e.isModel?t=e.getValue(n.property):n._propertyItems.length>1?t=n._propertyItems.reduce(Wm,e):t=e[n.property],n[n.operator](n.convert(t))}updateProperty(e){this._propertyItems=e.split("."),this.onChange("property")}set value(e){const n=this;n._value=e,Array.isArray(e)&&({date:1,duration:1}[n.type]||e.length>0&&typeof e[0]=="string")?n._filterValue=e.map(t=>n.convert(t)):!n.caseSensitive&&Array.isArray(e)&&e.length>0&&typeof e[0]=="string"?n._filterValue=e.map(t=>t==null?void 0:t.toLowerCase()):!n.caseSensitive&&typeof e=="string"?n._filterValue=e.toLowerCase():n._filterValue=n.convert(e),n.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){const e=this;return e._operator?e._operator:Array.isArray(e.filterValue)?"isIncludedIn":typeof e.filterValue=="string"?"*":"="}convert(e){var n;return this.operator!=="sameTime"&&!(typeof this.filterValue=="string"&&e instanceof Date)&&(this.operator==="sameDay"&&(e=R.clearTime(e)),e=(n=e==null?void 0:e.valueOf())!=null?n:e),e=!this.caseSensitive&&typeof e=="string"?e.toLowerCase():e,e}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}isIncludedIn(e){return this.filterValue.length===0||this.filterValue.includes(e)}isNotIncludedIn(e){return!this.isIncludedIn(e)}includes(e){return this.filterValue.length===0||String(e).includes(this.filterValue)}doesNotInclude(e){return!this.includes(e)}sameTime(e){return R.isSameTime(e,this.filterValue)}sameDay(e){return e===this.filterValue}"="(e){return x.isEqual(e,this.filterValue)}"!="(e){return!x.isEqual(e,this.filterValue)}">"(e){return x.isMoreThan(e,this.filterValue)}">="(e){return x.isMoreThan(e,this.filterValue)||x.isEqual(e,this.filterValue)}"<"(e){return x.isLessThan(e,this.filterValue)}"<="(e){return x.isLessThan(e,this.filterValue)||x.isEqual(e,this.filterValue)}"*"(e){return x.isPartial(e,this.filterValue)}between(e){const[n,t]=this._filterValue;return(x.isMoreThan(e,n)||x.isEqual(e,n))&&(x.isLessThan(e,t)||x.isEqual(e,t))}notBetween(e){return!this.between(e)}empty(e){return e==null||String(e).length===0}notEmpty(e){return!this.empty(e)}isToday(e){return this.between(e)}isTomorrow(e){return this.between(e)}isYesterday(e){return this.between(e)}isThisWeek(e){return this.between(e)}isNextWeek(e){return this.between(e)}isLastWeek(e){return this.between(e)}isThisMonth(e){return this.between(e)}isNextMonth(e){return this.between(e)}isLastMonth(e){return this.between(e)}isThisYear(e){return this.between(e)}isNextYear(e){return this.between(e)}isLastYear(e){return this.between(e)}isYearToDate(e){return this.between(e)}isTrue(e){return e===!0}isFalse(e){return e===!1}setRelativeDateValues(){this._filterValue=ci.getRelativeDateRange(this._operator).map(e=>e.valueOf())}static getRelativeDateRange(e,n=new Date){let t,s,r,i,a,o,l;switch(e){case"isYearToDate":return[R.floor(n,"1 year"),n];case"isToday":return t=R.floor(n,"1 day"),[t,R.add(t,1,"day")];case"isYesterday":return t=R.floor(n,"1 day"),[R.add(t,-1,"day"),t];case"isTomorrow":return s=R.getStartOfNextDay(n),[s,R.add(s,1,"day")];case"isThisWeek":case"isNextWeek":case"isLastWeek":case"isThisMonth":case"isNextMonth":case"isLastMonth":case"isThisYear":case"isNextYear":case"isLastYear":if(r=e.toLowerCase().match(zm),!r)throw new Error(`Unrecognized relative date expression: ${e}`);return[,o,l]=r,i=`1 ${l}`,a=R.floor(n,i),o==="next"?a=R.add(a,1,l):o==="last"&&(a=R.add(a,-1,l)),[a,R.add(a,1,l)]}}static generateFiltersFunction(e){if(!e||!e.length&&!e.count)return Et.returnTrue;for(const n of e)n.type==="date"&&qm.includes(n._operator)&&n.setRelativeDateValues();return function(n){let t=!0;for(const s of e)if(s.disabled||(t=s.filter(n)),!t)break;return t}}},ke=ci;F(ke,"$name","CollectionFilter"),ke._$name="CollectionFilter";var Nd=x.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),wo=class{static generateId(e="generatedId"){return e+(Nd[e]=(Nd[e]||0)+1)}};wo._$name="IdHelper";var Yn=class extends ${static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){typeof e=="function"&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||wo.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,n){const t=this,{convert:s,property:r,useLocaleSort:i}=t,a=t.direction.toLowerCase()==="desc"?-1:1;if(e=e[r],n=n[r],s&&(e=s(e),n=s(n)),i&&e!=null&&n!=null&&typeof e=="string"){if(i===!0)return String(e).localeCompare(n);if(typeof i=="string")return String(e).localeCompare(n,i);if(typeof i=="object")return String(e).localeCompare(n,i.locale,i)}return(e>n?1:e<n?-1:0)*a}static generateSortFunction(e,n){const t=e.isCollection?e.values:e,s=t.length;return(r,i)=>{let a,o;for(o=0;o<s;++o)if(a=t[o].sortFn(r,i),a)return a;return n?n(r,i):0}}};Yn._$name="CollectionSorter";var Gm=()=>0,Hm=(e,n)=>n-e,Mo=Symbol("filteredIndicesProperty"),on=Object.freeze([]),Ym=Object.freeze({action:"sort",added:on,removed:on,replaced:on}),Km=Object.freeze({action:"filter",added:on,removed:on,replaced:on}),$r={string:1,number:1};function Vd(e,n,t){if(n.unique!==!1)n.set(t,e);else{let s=n.get(t);s||(s=new Set,n.set(t,s)),s.add(e)}}function Jm(e,n,t){n.unique!==!1?n.delete(t):n.has(t)&&(n.get(t).delete(e),n.get(t).size||n.delete(t))}function Ud(e,n,t,s){for(let r=0;r<e.length;r++){const i=e[r];for(let a=0;a<s;a++){const o=t[a],l=i[o],c=n[o];Vd(i,c,l)}}}var ln=class extends $.mixin(Vt){constructor(){super(...arguments),F(this,"_sortFunction",null),F(this,"_addedValues",null)}static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,autoSort:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const n=this;n._values.length=0,n.isFiltered&&(n._filteredValues.length=0,n.filters.destroy()),(e=n._sorters)==null||e.destroy()}clear(){const e=this,n=e._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:n}))}equals(e,n){if(e.isCollection&&(e=e.values),e.length===this.count){let{values:t}=this;return n&&(e=e.map(n),t=t.map(n)),W.delta(e,t).inBoth.length===this.count}return!1}replaceValues({values:e,filteredValues:n,silent:t=!1,isNewDataset:s=!1}){const r=this;let i,a;r.isFiltered&&!s?(!!n?e&&(i=r._values,r._values=e.slice()):(n=e.slice(),e=null),a=r._filteredValues,r._filteredValues=n.slice()):(i=r._values,r._values=e.slice(),n=null,r.isFiltered&&s&&r.autoFilter?(r._filterFunction=null,r._filteredValues=r._values.filter(r.filterFunction)):r._filteredValues&&(r._filteredValues.length=0)),r._indicesInvalid=!0,r._addedValues=void 0,r.generation++,t||r.trigger("change",{action:"replaceValues",replacedValues:i,replacedFilteredValues:a,values:e,filteredValues:n})}set values(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}get filteredValues(){return this._filteredValues}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,n=!1){(this.isFiltered&&!n?this._filteredValues:this._values).forEach(e)}map(e,n=!1){return(this.isFiltered&&!n?this._filteredValues:this._values).map(e)}find(e,n=!1){return(this.isFiltered&&!n?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}get addedValues(){return this._addedValues}match(e,n=!0){const t=this,{_values:s}=t,r=[];return t.forEach(i=>{const a=e.get(i.id,!0);if(a){const o=t.indexOf(i,!0),l=s[o];s[o]=a,t.removeFromIndices(l),t.addToIndices(a)}else n&&r.push(i)}),r.length&&t.remove(r),t.isFiltered&&(t._filteredValues=t._values.filter(t.filterFunction)),r}add(...e){e.length===1?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){e.length===1?this.splice(0,...e):this.splice(0,e)}move(e,n){for(e=W.asArray(e);e.length&&e[0]===n;)e.shift();if(!e.length)return;const t=this,{_values:s}=t,r=t.indexOf(e[0],!0);if(e.length===1&&s[r+1]===n)return;t.suspendEvents(),t.remove(e),t.resumeEvents();const i=n?t.indexOf(n,!0):s.length;if(i===-1)throw new Error("Collection move beforeItem parameter must be present in Collection");return s.splice(i,0,...e),t._indicesInvalid=1,t.trigger("change",{action:"move",items:e,from:r,to:i}),i}splice(e=0,n,...t){const s=this,r=s.idProperty,i=s._values,a={},o=[],l=[],c=s.totalCount;let u,d;if(s.trigger("beforeSplice",{index:e,toRemove:n,toAdd:t})!==!1){if(t)if(t.length===1&&Array.isArray(t[0])&&(t=t[0]),c&&t.length){const h=s.indices[r];u=[];for(let f=0;f<t.length;f++){const g=t[f],p=g[r],m=h.get(p),y=m?i.indexOf(m):-1;a[p]=!0,y!==-1?i[y]!==g&&(l.push([i[y],g]),i[y]=g):u.push(g)}}else u=t;if(n){if(typeof n=="number"){n=Math.min(n,i.length-e);for(let h=e;n;--n){const f=i[h][r];a[f]?(e++,h++):(o.push(i[h]),i.splice(h,1),d=!0)}}else{let h=u.length===0,f;n=W.asArray(n);const g=n.reduce((p,m)=>{const y=typeof m=="number",D=y?m:s.indexOf(m,!0);return h&&(f!=null&&D!==f+1||y)&&(h=!1),D>=0&&D<c&&p.push(D),f=D,p},[]).sort(Hm);if(h)g.length&&(o.push.apply(o,n),i.splice(g[g.length-1],g.length),d=!0);else for(let p=0;p<g.length;p++){const m=g[p];if(m!==-1){const y=i[m][r];a[y]||(o.unshift(i[m]),i.splice(m,1),d=!0)}}}o.length&&!s._indicesInvalid&&o.forEach(s.removeFromIndices,s)}if(u.length){i.splice(Math.min(e,i.length),0,...u),d=!0,s._indicesInvalid||u.forEach(s.addToIndices,s),s._addedValues||(s._addedValues=new Set);for(const h of u)s._addedValues.add(h)}if(o.length&&s._addedValues)for(const h of o)s._addedValues.delete(h);l.length&&!s._indicesInvalid&&l.forEach(h=>{s.removeFromIndices(h[0]),s.addToIndices(h[1])}),d||l.length?(s.isSorted?s.onSortersChanged():s.isFiltered&&(s.autoFilter?s.onFiltersChanged({action:"splice",oldCount:1}):s._filteredValues.splice(Math.min(e,s._filteredValues.length),0,...u)),s.generation++,s.trigger("change",{action:"splice",removed:o,added:u,replaced:l,oldCount:c})):s.trigger("noChange",{index:e,toRemove:n,toAdd:t})}}changeId(e,n){const t=this,{idProperty:s}=t,r=$r[typeof e]?e:e[s],i=t.get(r);if(i){const a=t.get(n);if(a&&i!==a)throw new Error(`Attempt to set item ${r} to already existing member's id ${n}`);t.removeIndexEntry(e,s,r),t.addIndexEntry(e,s,n),i[s]=n}}get(e,n=!1){return this.getBy(this.idProperty,e,n)}getAt(e,n=!1){return this.isFiltered&&!n?this._filteredValues[e]:this._values[e]}getBy(e,n,t=!1){return this.findItem(e,n,this.isFiltered&&t)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new ln({values:W.asArray(e),internalListeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const n=e instanceof Yn?e:new Yn(e);return this.sorters.add(n),n}get isSorted(){var e;return!!((e=this._sorters)!=null&&e.count)}onSortersChanged(){const e=this;e._sortFunction=null,e._addedValues=null,e._values.sort(e.sortFunction),e.trigger("change",Ym)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=Yn.generateSortFunction(this.sorters.values):this._sortFunction=Gm),this._sortFunction}get filters(){return this._filters||(this._filters=new ln({internalListeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const n=e instanceof ke?e:new ke(e);return this.filters.add(n),n}removeFilter(e){const{filters:n}=this;e.isCollectionFilter||(e=n.get(e)),n.remove(e)}clearFilters(){this.filters.clear()}get isFiltered(){return!!(this._filters&&this._filters.count)}onFiltersChanged({action:e,removed:n,oldCount:t}){const s=this,r=t||e==="clear"&&n.length?s._filteredValues:s._values;s._filterFunction=null,s._filteredValues=s._values.filter(s.filterFunction),s._indicesInvalid=!0;const{toAdd:i,toRemove:a}=W.delta(s._filteredValues,r,!0);s.trigger("change",{...Km,added:i,removed:a})}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=ke.generateFiltersFunction(this.filters.values):this._filterFunction=Et.returnTrue),this._filterFunction}changeExtraKeys(e){return W.asArray(e).map(t=>typeof t=="string"?{property:t,unique:!0}:t)}updateExtraKeys(e){for(let n=0;n<e.length;n++)this.addIndex(e[n])}addIndex(e){const n=this;e&&((n._indices||(n._indices={}))[e.property]=new Map,Object.assign(n._indices[e.property],e),n.invalidateIndices(),e.dependentOn&&(n.hasCompositeIndex=!0))}findIndex(e,n,t=!1){const s=this.findItem(e,n,t);return s?(this.isFiltered&&!t?this._filteredValues:this._values).indexOf(s):-1}findItem(e,n,t=!1){var s;const r=this,{isFiltered:i}=r,a=i&&!t?r.indices[Mo][e]:r.indices[e];if(a){const o=(s=a.get(n))!=null?s:typeof n=="string"&&n.length&&!isNaN(n)&&a.get(Number(n))||null;if(o!=null)return o}else{const o=i&&!t?r._filteredValues:r._values,l=o.length;for(let c=0;c<l;c++){const u=o[c];if(u[e]==n)return u}}return null}removeIndex(e){delete this._indices[e],this.hasCompositeIndex=Object.values(this.indices).some(n=>n.dependentOn)}indexOf(e,n=!1){return this.findIndex(this.idProperty,$r[typeof e]?e:e[this.idProperty],n)}includes(e,n=!1){return Array.isArray(e)?e.some(t=>this.includes(t)):!!this.findItem(this.idProperty,$r[typeof e]?e:e[this.idProperty],n)}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}invalidateIndices(){this._indicesInvalid=!0}rebuildIndices(){const e=this,n=e.isFiltered,t=e._indices||(e._indices={}),s=Object.keys(t),r=s.length,i=e._values;let a;n&&(a=t[Mo]={});for(let o=0;o<r;o++){const l=t[s[o]];if(l.clear(),n){let c=a[s[o]];c?c.clear():(c=a[s[o]]=new Map,c.unique=l.unique)}}Ud(i,t,s,r),n&&Ud(e._filteredValues,a,s,r),e._indicesInvalid=!1}getIndices(e){const n=[this.indices[e]];return this.isFiltered&&n.push(this.indices[Mo][e]),n}addToIndices(e){Object.keys(this.indices).forEach(n=>{this.addIndexEntry(e,n,e[n])})}removeFromIndices(e){Object.keys(this.indices).forEach(n=>{this.removeIndexEntry(e,n,e[n])})}removeIndexEntry(e,n,t){this.getIndices(n).forEach(s=>Jm(e,s,t))}addIndexEntry(e,n,t){this.getIndices(n).forEach(s=>Vd(e,s,t))}onItemMutation(e,n){const t=this;!t._indicesInvalid&&Object.keys(t.indices).length>1&&Object.keys(n).forEach(s=>{var r;if(t.indices[s]){const{value:a,oldValue:o}=n[s];t.removeIndexEntry(e,s,o),t.addIndexEntry(e,s,a)}if(t.hasCompositeIndex){const a=Object.values(t.indices).find(o=>{var l;return(l=o.dependentOn)==null?void 0:l[s]});if(a){const o={};for(const c in a.dependentOn)o[c]=((r=n[c])==null?void 0:r.oldValue)||e[c];const l=e.buildIndexKey(o);t.removeIndexEntry(e,a.property,l),t.addIndexEntry(e,a.property,e[a.property])}}})}};ln._$name="Collection";var Wd=new WeakMap,Kn=e=>{if(e&&typeof e=="object"){let n=Wd.get(e);n===void 0&&(n=Symbol("bscik"),Wd.set(e,n)),e=n}return e},zd=class{constructor(e){const n=this;n.generation=0,n.items=new Set,n.idMap={},n.idProperty="id",e&&(e.idProperty&&(n.idProperty=e.idProperty),e.values&&(n.values=e.values))}get(e){return this.idMap[Kn(e)]}get count(){return this.items.size}add(...e){e.length===1&&Array.isArray(e[0])&&(e=e[0]);const n=this,{items:t,idMap:s,idProperty:r}=n,i=e.length;for(let a=0;a<i;a++){const o=e[a],l=$r[typeof o]?o:Kn(o[r]),c=s[l];c==null?(s[l]=o,t.add(o),n.generation++):c!==o&&(s[l]=o,t.delete(c),t.add(o))}}at(e){let n,t;e<0&&(e+=this.count);for(n of this.items)if(!e--){t=n;break}return t}remove(e){e=W.asArray(e);const{items:n,idMap:t,idProperty:s}=this,r=e.length;for(let i=0;i<r;i++){const a=e[i],o=$r[typeof a]?a:Kn(a[s]),l=t[o];l!=null&&(n.delete(l),delete t[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}countOf(e){let n=0,t;for(t of this.items)e(t)&&++n;return n}changeId(e,n){const t=this,{idMap:s,idProperty:r}=t,i=$r[typeof e]?e:Kn(e[r]),a=t.get(i);if(a){const o=t.get(n);if(o&&a!==o)throw new Error(`Attempt to set item ${i} to already existing member's id ${n}`);a[r]=n,delete s[i],s[n]=a}}filter(e,n){const{items:t}=this,s=[];let r=0;return t.forEach(i=>{e.call(n,i,r++,t)&&s.push(i)}),s}includes(e){const n=$r[typeof e]?e:Kn(e[this.idProperty]);return!!this.idMap[n]}map(e,n){const{items:t}=this,s=new Array(t.size);let r=0;return t.forEach(i=>{s[r]=e.call(n,i,r++,t)}),s}forEach(e,n){return this.items.forEach(e,n)}find(e,n=0){let t,s;n<0&&(n+=this.countOf(e));for(t of this.items)if(e(t)&&!n--){s=t;break}return s}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e,n){let t=-1,s;for(s of this.items)if((!n||n(s))&&(++t,s===e))return t;return-1}get values(){return[...this.items]}set values(e){e=W.asArray(e),this.clear(),this.add.apply(this,e),this.generation++}sort(e){this.values=this.values.sort(e)}some(e,n){return this.values.some(e,n)}};zd._$name="Bag";var ui=class extends zd{add(...e){return e.length===1&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter(n=>n.isPersistable))}};ui._$name="StoreBag";var qd=e=>class extends(e||$){static get $name(){return"StoreCRUD"}static get defaultConfig(){return{autoCommit:!1}}static get properties(){return{isRemoving:!1,suspendCount:0}}remove(t,s=!1){const r=this,{storage:i}=r;if(t=W.asArray(t).reduce((a,o)=>(o=r.getById(o),o&&a.push(o),a),[]),t.length===0)return t;if(!r.tree&&!s&&r.trigger("beforeRemove",{records:t})===!1)return[];if(r.isRemoving=!0,r.isGrouped){const a=i.count,o=[],l=new Set;for(const c of t){const{groupParent:u}=c.instanceMeta(r);u.meta.collapsed&&o.push(c),W.remove(u.groupChildren,c),W.remove(u.unfilteredGroupChildren,c),u.meta.childCount--,l.add(u)}for(const c of l)c.groupChildren.length>0&&r.onModelChange(c,{},{});o.length&&i.trigger("change",{action:"splice",removed:o,added:[],replaced:[],oldCount:a})}else if(r.tree){const a=[],o=t.length>1,l=t[0],c=o?void 0:i.indexOf(l),u=t.reduce((h,f)=>{const{parent:g}=f;return g&&(h[g.id]||(h[g.id]=[g,[]]),h[g.id][1].push(f)),h},{}),d=Array.from(Object.values(u));if(!s&&r.trigger("beforeRemove",{records:t,isMove:!1,parent:o?void 0:l.parent})===!1)return r.isRemoving=!1,[];d.sort((h,f)=>f[0].childLevel-h[0].childLevel);for(const[h,f]of d)a.push(...h.removeChild(f,!1,!0));return s||(r.trigger("remove",{parent:o?void 0:l.parent,index:c,isChild:!0,allRecords:a,isMove:!1,records:t}),r.trigger("change",{action:"remove",records:t})),r.isRemoving=!1,t}if(t.length===0)return r.isRemoving=!1,t;for(const a of t)a.beforeRemove(t);return s&&r.suspendEvents(),i.remove(t),s&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),r.isRemoving=!1,t}clear(t=!1){var s,r;const i=this,{storage:a}=i;if(i.storage.totalCount||(r=(s=i.rootNode)==null?void 0:s.unfilteredChildren)!=null&&r.length){if(!t&&i.trigger("beforeRemove",{records:a.allValues,removingAll:!0})===!1)return null;if(i.rootNode)i.isChained||i.rootNode.clearChildren(t);else if(t){const o=i.registeredRecords;for(let l=o.length-1,c;l>=0;l--)c=o[l],c&&!c.isDestroyed&&c.unjoinStore(i)}t&&(i.removed.clear(),a.suspendEvents()),a.clear(),t&&a.resumeEvents(),i.added.clear(),i.modified.clear()}}removeAll(t=!1){const s=this,r=s.storage;let i;if(s.isRemoving=!0,t){r.suspendEvents();const a=s.registeredRecords;for(let o=a.length-1,l;o>=0;o--)l=a[o],l&&!l.isDestroyed&&!l.isRoot&&l.unjoinStore(s)}return s.tree?i=s.rootNode.clear()!==!1:i=s.clear()!==null,t&&r.resumeEvents(),s.isRemoving=!1,i}add(t,s=!1,r={}){const i=this,{storage:a}=i;if(t=W.asArray(t),!(t!=null&&t.length))return;if(i.tree=i.tree||!!(i.autoTree&&t[0].children),i.tree){const l=new Map,c=i.modelClass.getFieldDataSource("parentIndex"),{parentIdField:u}=i.modelClass,d=[];return t.forEach(h=>{const f=h[u];l.has(f)||l.set(f,{append:[],insert:[]});const g=l.get(f);!h.isModel&&c in h?g.insert.push(h):g.append.push(h)}),l.forEach(({append:h,insert:f},g)=>{const p=g==null?i.rootNode:i.getById(g);if(!p)throw new Error(`Parent node with id ${g} not found, cannot add children.`);if(h.length&&d.push(...p.appendChild(h,s)),f.length)for(const m of f)d.push(p.insertChild(m,m[c],s,r))}),i.isFiltered&&i.reapplyFilterOnAdd&&i.filter({silent:!0}),i.reapplySortersOnAdd&&!i.isSyncingDataOnLoad&&i.sort(),d}if(!s&&i.trigger("beforeAdd",{records:t})===!1)return null;if(i.tree=i.tree||!!(i.autoTree&&t[0].children),i.tree)return i.rootNode.appendChild(t);const o=i.processRecords(t);return s&&i.suspendEvents(),a.add(o),s&&i.resumeEvents(),i.autoCommit&&i.doAutoCommit(),o}processRecords(t,s){return t.map(r=>{const i=this.processRecord(r.isModel?r:this.createRecord(r));return s==null||s.call(this,i),i})}insert(t,s,r=!1){var i;const a=this,o=a.storage,l=a.getAt(t),c=o.values,u=[];if(s=W.asArray(s),a.tree){const p=a.rootNode;return p.insertChild(s,(i=p.children)==null?void 0:i[t],r)}if(!r&&a.trigger("beforeAdd",{records:s})===!1)return null;let d,h,f;if(c[h=t]===s[0]||c[h=t-1]===s[0])for(d=!0,f=0;d&&f<s.length;f++)s[f]!==c[h+f]&&(d=!1);if(d)return null;const g=a.processRecords(s,p=>{const m=o.indexOf(p);p.children&&p.children.length&&a.autoTree&&(a.tree=!0),m>-1&&(m<t&&l&&t--,u.push(m)),p.meta.previousIndex=m});return a.suspendEvents(),a.storage.remove(u),a.resumeEvents(),r&&a.suspendEvents(),o.splice(t,0,...g),r&&a.resumeEvents(),a.autoCommit&&a.doAutoCommit(),g}move(t,s){this.isTree?s.parent.insertChild(t,s):this.storage.move(t,s)}setMultiple(t,s,r){const i=this,a=[],o=[];i.forEach(l=>{t(l)&&(o.push(l.set(s,r,!0)),a.push(l))}),i.trigger("updateMultiple",{records:a,all:i.records.length===a.length}),i.trigger("change",{action:"updatemultiple",records:a,all:i.records.length===a.length}),i.reapplyFilterOnUpdate&&i.isFiltered&&i.filter()}setAll(t,s){const r=this,i=[];r.forEach(a=>{i.push(a.set(t,s,!0))}),r.trigger("updateMultiple",{records:r.records,all:!0}),r.trigger("change",{action:"updatemultiple",records:r.records,all:!0}),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}acceptChanges(){const t=this;t.added.forEach(s=>s.clearChanges(!0,!1)),t.modified.forEach(s=>s.clearChanges(!0,!1)),t.added.clear(),t.modified.clear(),t.removed.clear()}commit(t=!1){const{changes:s}=this;return!t&&this.trigger("beforeCommit",{changes:s})===!1?!1:(this.acceptChanges(),t||this.trigger("commit",{changes:s}),s)}revertChanges(){const t=this,{changes:s}=t;if(s){const r={action:"clearchanges",changes:s};t.add(t.removed.values,!0),t.remove(t.added.values,!0),t.modified.forEach(i=>i.revertChanges(!0)),t.added.clear(),t.modified.clear(),t.removed.clear(),t.trigger("change",r),t.trigger("refresh",r)}}get changes(){const t=this,s=t.modified.values.filter(r=>r.rawModifications);return t.added.count||s.length||t.removed.count?{added:t.added.values.slice(),modified:s,removed:t.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(t){this._autoCommit=t,t&&this.changes&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(t=!0){this.suspendCount--,this.autoCommit&&t&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}},Gd=e=>class extends(e||$){static get $name(){return"StoreChanges"}static get configurable(){return{applyChangesetFilterSortTarget:"changes"}}applyChangesFromStore(t){const s=this,{changes:r}=t;r&&(r.added&&s.add(r.added),r.removed&&s.remove(r.removed.map(i=>i.id)),r.modified&&r.modified.forEach(i=>{const a=s.getById(i.id);a==null||a.set(i.modifications)}))}applyChangeset(t,s=null,r="$PhantomId",i=!0,a=!1){var o,l,c,u;const d=this,{added:h,updated:f,modified:g,removed:p}=(o=s==null?void 0:s(t,d))!=null?o:t,m=(l=f!=null?f:g)!=null?l:[],y=d.modelClass.getFieldDataSource("id"),D=a?new Map:null,E=[],C=[];let v=!1,S=[];if(d._groupVisibleRecordIds=[],d.isGrouped&&d.forEach(b=>{d._groupVisibleRecordIds.push(b.id)}),(h==null?void 0:h.length)>0){const b=[],w=[];for(const I of h)d.getById((c=I[r])!=null?c:x.getPath(I,y))?b.push(I):w.push(I);m.unshift.apply(m,b);const M=(u=d.add(w,!1,{orderedParentIndex:{skip:!0}}))!=null?u:[];if(E.push(...M),d.tree)for(const I of M){const{parent:A}=I;if(A.isRoot){v=!0,S=[A];break}!A.isRoot&&S.every(T=>!T.contains(A))&&S.push(A)}for(const I of M)D==null||D.set(I.id,I.data),I.clearChanges()}if((m==null?void 0:m.length)>0)for(const b of m){const w=b[r],M=x.getPath(b,y),I=d.getById(w!=null?w:M);if(I){const A=I.applyChangeset(b,r,i);d.tree&&!v&&S.every(T=>!T.contains(I))&&(I.parent.isRoot?(v=!0,S=[I.parent]):S.push(I.parent)),D==null||D.set(M,A),C.push(I)}}if((p==null?void 0:p.length)>0&&d.applyRemovals(p),d.applyChangesetFilterSortTarget==="changes"){const b=d.filterChangeset(E,C);S.push(...b)}return d.afterChangesetApplied(S),d._groupVisibleRecordIds=null,D}afterChangesetApplied(t){t.forEach(s=>{s.traverse(r=>{r.sortOrderedChildren(!1,!1),r.children&&r.updateChildrenIndices(r.children,"parentIndex",!0),r.unfilteredChildren&&r.updateChildrenIndices(r.unfilteredChildren,"unfilteredIndex",!0)})})}applyRemovals(t){const s=this,{removed:r}=s,i=s.modelClass.idField,a=[];for(const o of t){const l=x.getPath(o,i);r.includes(l)?r.remove(l):a.push(l)}s.remove(a);for(const o of a)r.remove(o)}filterChangeset(t,s){const r=this,{isFiltered:i,tree:a,isGrouped:o,filtersFunction:l}=r,c=r.isSorted?r.createSorterFn(r.sorters):void 0,{allValues:u,addedValues:d,isSorted:h}=r.storage,f=c!=null||h?c!=null?c:r.storage.sortFunction:null,g=new Set;if(!i)return[];let p=!1,m;if(o&&(m=r.groupers,r.clearGroupers(!0)),a){const D=new Set(s.filter(l));for(const C of t.filter(l))D.add(C);D.forEach(C=>C.bubble(v=>D.add(v))),D.delete(r.rootNode);const E=W.groupBy(Array.from(D),"parentId");for(const C of Object.values(E)){const{parent:v}=C[0];v.unfilteredChildren&&(v.children.push(...C.filter(S=>!v.children.includes(S))),g.add(v))}}else if(f&&!o){const{filteredValues:D}=r.storage,E=d?D.findLastIndex(S=>!d.has(S))+1:D.length,C=D.slice(0,E),v=new Set(s.filter(l));for(const S of D)v.has(S)&&v.delete(S);for(const S of v)C.push(S);C.sort(f),D.splice(0,E,...C),p=!0}else{const D=s.filter(E=>l(E)&&!r.storage.includes(E));D.length>0&&(r.includeInSubset(u,r.storage.filteredValues,D),p=!0)}const y=new Set(t.filter(D=>!l(D)));if(y.size>0){if(a)for(const D of y)W.remove(D.parent.children,D),g.add(D.parent);else W.remove(r.storage.filteredValues,y);p=!0}return m&&(r.group(m[0],null,!1,!0,!0),p=!0),a&&g.size>0?r.storage.replaceValues({values:r.collectDescendants(r.rootNode).visible,silent:!0}):p&&(r._idMap=null,r.trigger("refresh")),[...g]}includeInSubset(t,s,r){const i=new Set(r);let a=0,o=0,l=i.size===0;for(;o<t.length&&!l;){const c=s[a];let u=t[o];for(;c!==u;)i.has(u)&&(s.splice(a,0,u),a++,i.delete(u),l=i.size===0),u=t[++o];i.has(c)&&i.delete(c),a<s.length&&a++}return s}},Hd=e=>class extends(e||$){static get $name(){return"StoreFilter"}static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set reapplyFilterOnAdd(t){this.storage.autoFilter=t}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(t){const s=this,r=s.filters;if(r.clear(),s._filtersFunction=null,t){if(t.constructor.name==="Object")for(const i of Object.entries(t))i[0]==="filterBy"&&typeof i[1]=="function"?r.add(new ke({filterBy:i[1]})):r.add(new ke(i[1].constructor.name==="Object"?Object.assign({property:i[0]},i[1]):{property:i[0],value:i[1]}));else Array.isArray(t)?r.add(...t.map(i=>i instanceof ke?i:new ke(i))):t.isCollection?r.add(...t.values):r.add(new ke({filterBy:t}));r.forEach(i=>i.owner=s)}}get filters(){return this._filters||(this._filters=new ln({extraKeys:["property"]}))}set filtersFunction(t){this._filtersFunction=t}get filtersFunction(){const t=this,{filters:s,isGrouped:r}=t;if(!t._filtersFunction)if(s.count){const i=ke.generateFiltersFunction(s);t._filtersFunction=a=>r&&a.isSpecialRow?a.groupChildren.some(i):i(a)}else t._filtersFunction=Et.returnTrue;return t._filtersFunction}get isFiltered(){return this.filters.values.some(t=>!t.disabled)}traverseFilter(t){const s=this,r=!t.isRoot&&s.filtersFunction(t),i=t.unfilteredChildren||t.children;return!i||!i.length?r:(t.unfilteredChildren||(t.unfilteredChildren=t.children.slice()),t.children=t.unfilteredChildren.filter(a=>s.traverseFilter(a)),t.updateChildrenIndices(t.unfilteredChildren,"unfilteredIndex",!0),t.updateChildrenIndices(t.children,"parentIndex",!0),r||!!t.children.length)}traverseClearFilter(t){const s=this;t.unfilteredChildren&&(t.children=t.orderedChildren.slice(),t.unfilteredChildren=null),t.children&&(t.children.forEach(r=>s.traverseClearFilter(r)),t.updateChildrenIndices(t.children,"parentIndex",!0))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(t,s=!1){const r=this;if(t=t instanceof ke?t:new ke(t),t.owner=r,r.filters.add(t),!s){if(r.remoteFilter)return r.filter().then(()=>t);r.filter()}return t}filter(t){const s=this;let r=!1,i;if(t){let o=typeof t;if(o==="object"&&("silent"in t||"replace"in t||t.filters)&&(r=t.silent,t.replace&&s.clearFilters(t.filters.length===0),i=t.internal,t=t.filters,o=typeof t),t){const l=s.isFiltered;if(s.isConfiguring=!0,Array.isArray(t))t.forEach(c=>s.addFilter(c,!0),s);else if(o==="function"){const c=new ke(t);c.internal=i,s.addFilter(c,!0)}else o==="string"?s.addFilter({property:t,value:arguments[1]},!0):s.addFilter(t,!0);if(s.isConfiguring=!1,!s.isFiltered&&!l)return null}}s.filtersFunction=null;const a=s.performFilter(r);return s._idMap=null,a}performFilter(t){const s=this,{storage:r,filters:i,rootNode:a}=s,o=s.count;s.trigger("beforeFilter",{filters:i});let l,c;if(s.tree){const u=r.values;s.isFiltered?s.traverseFilter(a):s.traverseClearFilter(a);const d=s.collectDescendants(a).visible;r.replaceValues({values:d,silent:!0});const h=W.delta(d,u,!0);l=h.toAdd,c=h.toRemove}else r.ion({change({removed:u,added:d}){c=u,l=d},once:!0}),s.isFiltered?(s.isGrouped&&s.includeCollapsed(),r.addFilter({id:"primary-filter",filterBy:s.filtersFunction}),s.isGrouped&&s.excludeCollapsed()):r.filters.clear();s.afterPerformFilter(t||s.isRemoteDataLoading?null:{action:"filter",filters:i,oldCount:o,added:l,removed:c,records:s.storage.values})}afterPerformFilter(t){this.resetRelationCache(),t&&this.triggerFilterEvent(t)}triggerFilterEvent(t){this.trigger("filter",t),this.remoteFilter||(this.trigger("refresh",t),this.trigger("change",t))}filterBy(t){return this.filter(t)}removeFilter(t,s=!1){const r=this,i=t instanceof ke?t:r.filters.get(t);if(i){if(r.filters.remove(i),r._filtersFunction=null,!s){if(r.remoteFilter)return r.filter().then(()=>i);r.filter()}return i}}clearFilters(t=!0){if(this.filters.remove(this.filters.values.filter(s=>!s.internal)),t)return this.filter()}convertFilterToString(t){const s=this.filters.getBy("property",t);return s&&!s.filterBy?String(s):""}doDestroy(){var t;(t=this._filters)==null||t.destroy(),super.doDestroy()}},Qm={add:1,replace:1},Yd=e=>{var n;return n=class extends(e||$){static get properties(){return{collapsedGroups:new Set}}construct(t){super.construct(t),this.ion({change:"onDataChanged",thisObj:this})}updateGroupers(t){this.setGroupers(t)}setGroupers(t,s=null){const r=this,{storage:i}=r;let a;return t!=null&&t.length?r._groupers=t:r.groupers&&(delete r._groupers,r.includeCollapsed(),i.replaceValues({values:r.removeHeadersAndFooters(i._values),filteredValues:i.isFiltered?r.removeHeadersAndFooters(i._filteredValues):null,silent:!0}),a=r.group(null,null,null,!1,s==null?void 0:s.silent)),r._idMap=null,a}get groupRecords(){const t=[];if(this.isGrouped)for(const s of this)s.isSpecialRow&&t.push(s);return t}get unfilteredGroupRecords(){var t;const s=this;if(s.isGrouped){const{generation:r}=s.storage;((t=s._unfilteredGroupRecords)==null?void 0:t.generation)!==r&&(s._unfilteredGroupRecords=s.storage.allValues.filter(i=>i.isSpecialRow),s._unfilteredGroupRecords.generation=r)}return s._unfilteredGroupRecords||[]}getGroupHeaderForRecord(t,s=!1){if(this.isGrouped){let r;const i=s?this.storage._values:this.storage.values;for(const a of i)if(a.isGroupHeader){if(!t)r=a;else if(a===t||a.unfilteredGroupChildren.includes(t)){r=a;break}}return r}}includeCollapsed(){for(const t of this.collapsedGroups)this.expand(this.getById(t),!1)}excludeCollapsed(){for(const t of this.collapsedGroups)this.collapse(this.getById(t))}onDataChange({source:t,action:s,removed:r}){var i;const a=this,{groupers:o}=a;o&&(o.length?(s==="splice"&&(r!=null&&r.length)||s==="move")&&t.replaceValues({...a.prepareGroupRecords(),silent:!0}):t.replaceValues({values:a.removeHeadersAndFooters(t._values),filteredValues:t.isFiltered?a.removeHeadersAndFooters(t._filteredValues):null,silent:!0})),(i=super.onDataChange)==null||i.call(this,...arguments)}move(t,s){const r=this;if(r.isGrouped&&!r.tree){let i=s;if(s!=null&&s.isSpecialRow&&(i=r.getPrev(s,!1,!1),!i))return;const a=r.getGroupHeaderForRecord(i),o=r.groupers[0].field,l=a.meta.groupRowFor,{reapplyFilterOnUpdate:c}=r;if(r.reapplyFilterOnUpdate=!1,r.beginBatch(),t.forEach(u=>u.setValue(o,l)),r.endBatch(),r.reapplyFilterOnUpdate=c,r.isFiltered&&(s!=null&&s.isSpecialRow)){const{unfilteredGroupRecords:u}=r,d=u.indexOf(a);s=u[d+1]}}super.move(t,s)}collapse(t){return t&&!t.meta.collapsed?(this.excludeGroupRecords(t),t.meta.collapsed=!0,this.collapsedGroups.add(t.id),this.trigger("toggleGroup",{groupRecord:t,collapse:!0}),!0):!1}expand(t,s=!0){return t!=null&&t.meta.collapsed?(this.includeGroupRecords(t),t.meta.collapsed=!1,s&&this.collapsedGroups.delete(t.id),s&&this.trigger("toggleGroup",{groupRecord:t,collapse:!1}),!0):!1}removeHeadersAndFooters(t){return t.filter(s=>s.isSpecialRow?(this.unregister(s),!1):!0)}prepareGroupRecords(t){const s=this,{isFiltered:r,reapplyFilterOnUpdate:i,startGroupsCollapsed:a}=s,o=s.collapsedGroups,{allValues:l}=s.storage,c=[],u=s._groupVisibleRecordIds||[],d=C=>{const v=!r||s.filtersFunction(C);return i?v:v||u.includes(C.id)};for(const C of l)C.isGroupHeader&&(C.meta.collapsed||o.has(C.id))&&(o.add(C.id),c.push(C));for(const C of c)s.includeGroupRecords(C);const h=s.removeHeadersAndFooters(s.storage._values);t&&h.sort(t),r&&(s.filtersFunction=null);const f=[],g=s.groupers[0].field;let p=null,m=null,y=0;function D(){const C=m.meta.groupRowFor,v=`group-footer-${typeof C=="number"?C:U.createId(C)}`,S=s.getById(v)||new s.modelClass({id:v},s,{specialRow:!0,groupFooterFor:C,groupRecord:m});return S.stores=[s],s.register(S),S.groupChildren=m.groupChildren,m.meta.collapsed||f.push(S),s.allRecords.push(S),m.groupChildren.push(S),m.unfilteredGroupChildren.push(S),y++,S}h.forEach(C=>{var v;const S=C.getValue(g),b=S==null?"__novalue__":S,w=`group-header-${typeof b=="number"?b:U.createId(b)}`;if(((v=C.unfilteredGroupChildren)==null?void 0:v.length)===0){s.unregister(C);return}x.isEqual(b,p)||(m&&(s.useGroupFooters&&D(m),m.meta.childCount=y),m=s.getById(w),m||(m=new s.modelClass({id:w},s,{specialRow:!0,groupRowFor:b,groupField:g}),a&&(o.add(w),s.startGroupsCollapsed=!1)),m.meta.collapsed=o.has(w),m.stores=[s],s.register(m),m.groupChildren=[],m.unfilteredGroupChildren=[],f.push(m),s.allRecords.push(m),p=b,y=0),C.instanceMeta(s.id).groupParent=m,o.has(w)||f.push(C),d(C)&&(m.groupChildren.push(C),y++),m.unfilteredGroupChildren.push(C)}),m&&(s.useGroupFooters&&D(),m.meta.childCount=y),s._idMap=null;const E={values:f};return r&&(E.filteredValues=f.filter(d)),E}get isGrouped(){var t;return!!((t=this.groupers)!=null&&t.length)}group(t,s,r=!1,i=!0,a=!1){var o,l;const c=this;let u,d;if(t&&typeof t=="object"&&(s=t.ascending,d=t.fn,t=t.field),r?c.groupers.push(u={field:t,ascending:s,complexMapping:t.includes(".")}):t&&(s==null&&(s=((o=c.groupInfo)==null?void 0:o.field)===t&&((l=c.groupInfo)==null?void 0:l.fn)===d?!c.groupInfo.ascending:!0),c.groupInfo=u={field:t,ascending:s,fn:d,complexMapping:t.includes(".")},c.groupers=[c.groupInfo]),u){const{prototype:h}=c.modelClass;u.complexMapping&&!Object.prototype.hasOwnProperty.call(h,t)&&Object.defineProperty(h,t,{get(){return x.getPath(this,t)}})}if(i!==!1){if(c.remoteSort&&!c.isRemoteDataLoading)return c.sort(null,null,!1,!0).then(()=>c.onAfterGrouping(a));c.sort(null,null,!1,!0)}c.onAfterGrouping(a)}onAfterGrouping(t){if(t)return;const s=this,r=s.groupers||[];s.trigger("group",{isGrouped:s.isGrouped,groupers:r,records:s.storage.values}),s.trigger("refresh",{action:"group",isGrouped:s.isGrouped,groupers:r,records:s.storage.values})}addGrouper(t,s=!0){return this.group(t,s,!0)}removeGrouper(t){const s=this,{groupers:r}=s;if(!r)return;const i=r.findIndex(a=>a.field===t);if(i>-1)return r.splice(i,1),r.length?s.group():s.clearGroupers()}clearGroupers(t=!1){return this.setGroupers(null,{silent:t})}isRecordInGroup(t,s){var r;if(!this.isGrouped)return null;const i=(r=this.groupers[0])==null?void 0:r.field;return t.getValue(i)===s&&!t.isSpecialRow}isInCollapsedGroup(t){const s=t.instanceMeta(this).groupParent;return s==null?void 0:s.meta.collapsed}getGroupRecords(t){return this.isGrouped?this.storage.values.filter(s=>this.isRecordInGroup(s,t)):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0].field):null}onDataChanged({changes:t,action:s}){this.isGrouped&&(!t&&Qm[s]||t&&this.groupers.some(r=>r.field in t))&&this.sort()}internalIncludeExcludeGroupRecords(t,s){const r=this,i=r.indexOf(t),a=r.allIndexOf(t),{id:o,storage:l}=r,{_filteredValues:c,_values:u}=l,{meta:d,groupChildren:h,unfilteredGroupChildren:f}=t;a===-1||d.collapsed&&!s||!d.collapsed&&s||(f.forEach(g=>g.instanceMeta(o).hiddenByCollapse=!s),s?(c&&c.splice(i+1,0,...h.filter(g=>!r.isAvailable(g))),l._values.splice(a+1,0,...f.filter(g=>!r.isAvailable(g)))):(c&&c.splice(i+1,h.length),u.splice(a+1,f.length)),l._indicesInvalid=!0,r._idMap=null)}excludeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!1)}includeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!0)}collectGroupRecords(t,s=!0){return(t?this.storage.allValues:this.storage.values).reduce((i,a)=>(a.isSpecialRow&&(s&&!a.isGroupFooter&&i.push(a),a.isGroupHeader&&i.push.apply(i,a.groupChildren)),i),[])}},F(n,"$name","StoreGroup"),F(n,"configurable",{groupers:null,useGroupFooters:!1,startGroupsCollapsed:null}),n},Zm=e=>class extends(e||$){static get configurable(){return{objectify:null}}initProxy(){if(!globalThis.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(s,r){if(r in s)return s[r];if(r==="$store")return s;let i=s.getById(r);return!i&&!isNaN(parseInt(r))&&(i=s.getAt(parseInt(r))),i},set(s,r,i){return r in s||s.isDestroying?s[r]=i:s.add({[s.modelClass.idField]:r,...i}),!0},deleteProperty(s,r){return s.isDestroying?(delete s[r],!0):!!s.remove(r).length},has(s,r){if(r in s)return!0;if(r.startsWith("{")&&r.endsWith("}")){const i=U.safeJsonParse(r);r=i==null?void 0:i.id}return s.includes(r)}})}},Kd=e=>{var n;return n=class extends(e||$){initRelations(t){const s=this,r=s.modelClass.exposedRelations;t&&s.modelRelations&&s.modelRelations.forEach(i=>{var a;return(a=i.storeDetacher)==null?void 0:a.call(i)}),(!s.modelRelations||s.modelRelations.length===0||t)&&r&&(s.modelRelations=[],r==null||r.forEach(i=>{const a={...i},{foreignStore:o,relationName:l,relatedCollectionName:c}=a,u=typeof o=="string"?s[o]:o;if(a.dependentStore=s,s.modelRelations.push(a),u){a.foreignStoreProperty=a.foreignStore,a.foreignStore=u;const d=u.dependentStoreConfigs;if(d.has(s)){const h=d.get(s);if(t){const f=h.find(g=>g.relationName===l);f&&W.remove(h,f)}h.push(a)}else d.set(s,[a]);c&&u.initRelationCollection(a,s),u.count>0&&u.updateDependentStores("dataset",u.records)}}))}initRelationCollection(t,s){const r=this,i=t.relatedCollectionName,a=r.collectionStores||(r.collectionStores={});a[i]={store:s,config:t},r[i+"Store"]||(r[i+"Store"]=s),r.count>0&&r.initModelRelationCollection(i,r.records)}initModelRelationCollection(t,s){const r=this;s.forEach(i=>{i.traverse(a=>{const o=t in a?`$related${U.capitalize(t)}`:t;Object.defineProperty(a,o,{enumerable:!0,configurable:!0,get:function(){return r.getCollection(this,t)},set:function(l){return r.setCollection(this,t,l)}})})})}resetRelationCache(){this.relationCache={},this.forEach(t=>t.initRelations())}updateRecordRelationCache(t,s){s==null||s.forEach(r=>{const{config:i}=r,a=r.related?r.related.id:t.getValue(i.foreignKey);a!==void 0&&this.cacheRelatedRecord(t,a,i.relationName,a)})}getRelationCollection(t,s){var r;const i=H.asId(s);return((r=this.relationCache[t])==null?void 0:r[i])||[]}getCollection(t,s){var r;const{config:i,store:a}=this.collectionStores[s];return((r=a.relationCache[i.relationName])==null?void 0:r[t.id])||[]}setCollection(t,s,r){const{config:i,store:a}=this.collectionStores[s],o=a.relationCache[i.relationName]||(a.relationCache[i.relationName]={}),l=(o[t.id]||[]).slice(),c=[],u=[];a.suspendEvents(),l.forEach(d=>{r.includes(d)||(d[i.foreignKey]=null,a.remove(d),u.push(d))}),r.forEach(d=>{d.isModel instanceof H?d.stores.includes(a)||(a.add(d),c.push(d)):([d]=a.add(d),c.push(d)),d[i.foreignKey]=t.id}),a.resumeEvents(),u.length&&(a.trigger("remove",{records:u}),a.trigger("change",{action:"remove",records:u})),c.length&&(a.trigger("add",{records:c}),a.trigger("change",{action:"add",records:c}))}cacheRelatedRecord(t,s,r,i=null){const a=this,o=a.relationCache[r]||(a.relationCache[r]={});i!==null&&a.uncacheRelatedRecord(t,r,i),s!=null&&W.include(o[s]||(o[s]=[]),t)}uncacheRelatedRecord(t,s=null,r=null){const i=this;function a(o,l){const c=i.relationCache[o],u=c==null?void 0:c[l];if(u){const d=u.indexOf(t);d>=0&&u.splice(d,1),u.length===0&&delete c[l]}}r!=null?a(s,r):t.meta.relationCache&&Object.entries(t.meta.relationCache).forEach(([o,l])=>a(o,l==null?void 0:l.id))}updateDependentStores(t,s){this.dependentStoreConfigs.forEach(r=>{r.forEach(i=>{const{dependentStore:a,relatedCollectionName:o,relationName:l,foreignKey:c}=i,u=a.relationCache[l];if(t==="dataset"){o&&this.initModelRelationCollection(o,s),a.forEach(d=>{const h=d.initRelation(i);h&&a.cacheRelatedRecord(d,h.id,l,h.id)});return}if(t==="removeall"){a.forEach(d=>d.removeRelation(i)),delete a.relationCache[l];return}t==="add"&&o&&this.initModelRelationCollection(o,s),(t==="add"||t==="remove")&&s.forEach(d=>{const h=u==null?void 0:u[d.id];switch(t){case"remove":h&&h.forEach(f=>f.removeRelation(i));break;case"add":a.forEach(f=>{f.getValue(c)==d.id&&(f.initRelation(i),a.cacheRelatedRecord(f,d.id,l))});break}})})})}updateDependentRecordIds(t,s){var r;(r=this.dependentStoreConfigs)==null||r.forEach(i=>{i.forEach(a=>{var o;const{dependentStore:l,relationName:c,foreignKey:u}=a,d=l.relationCache[c],h=(o=d==null?void 0:d[t])==null?void 0:o.slice();h==null||h.forEach(f=>{l.cacheRelatedRecord(f,s,c,t),f.set(u,s,!1,!0)})})})}},F(n,"$name","StoreRelation"),n},Jd=e=>class extends(e||$){static get $name(){return"StoreSum"}sum(t,s=this.storage.values){return s?s.reduce((r,i)=>{if(i.isSpecialRow)return r;const a=Number(i.getValue(t));return isNaN(a)?r:r+a},0):0}min(t,s=this.storage.values){return s!=null&&s.length?s.reduce((r,i)=>{const a=i.getValue(t);return typeof(a==null?void 0:a.valueOf())==="number"&&a<r&&(r=a),r},s[0].getValue(t)):0}max(t,s=this.storage.values){return s!=null&&s.length?s.reduce((r,i)=>{const a=i.getValue(t);return typeof(a==null?void 0:a.valueOf())==="number"&&a>r&&(r=a),r},s[0].getValue(t)):0}average(t,s=this.storage.values){if(!(s!=null&&s.length))return 0;let r=0;const i=s.reduce((a,o)=>{if(o.isSpecialRow)return a;const l=parseFloat(o.getValue(t));return isNaN(l)?a:(r++,a+l)},0);return r>0?i/r:0}groupSum(t,s){return this.sum(s,this.getGroupRecords(t))}},xo=(e,n)=>String(e).toLowerCase().includes(n),Qd={string:xo,number:xo,boolean:xo,date:(e,n)=>e instanceof Date&&n instanceof Date?e-n===0:String(e.getMonth()+1).includes(n)||String(e.getDate()).includes(n)||String(e.getFullYear()).includes(n),object:(e,n)=>e===n,undefined:(e,n)=>e===n},Zd=e=>class extends(e||$){static get $name(){return"StoreSearch"}search(t,s=null,r,i){const a=this.isTree&&!i?this.rootNode.allChildren:this.getAllDataRecords(i),o=a.length,l=[];if(t==null)return[];typeof t=="string"&&(t=t.toLowerCase());let c,u,d,h,f,g;for(c=0;c<o;c++){d=a[c],u=0;for(const p of s||d.fieldNames){h=d.getValue(p),f=h instanceof Date?"date":typeof h;const m=r==null?void 0:r[u];m&&(h=m(h),f="string"),g=Qd[f],h&&(g!=null&&g(h,t))&&l.push({index:c,data:d,field:p,id:d.id}),u++}}return l}findByField(t,s,r=!1,i=!1){const a=this.getAllDataRecords(i),o=a.length,l=new Set,c=[];let u,d,h;for(s!=null&&(s=String(s).toLowerCase()),u=0;u<o;u++)if(d=a[u],h=d.getValue(t),!r||!l.has(h)){const f=h instanceof Date?"date":typeof h,g=Qd[f];(s==null&&h===s||s&&g(h,s))&&(c.push({id:d.id,index:u,data:d}),r&&l.add(h))}return c}find(t,s=!1){return this.getAllDataRecords(s).find(t)}findRecord(t,s,r=!1){const i=a=>x.isEqual(a[t],s);return this.isTree?this.query(i,r)[0]:this.getAllDataRecords(r).find(i)}query(t,s=!1){if(this.isTree){const r=[];return this.traverse(i=>{t(i)&&r.push(i)},void 0,void 0,s),r}return this.getAllDataRecords(s).filter(t)}some(t,s=!1){return this.getAllDataRecords(s).some(t)}},Xd=e=>class extends(e||$){static get $name(){return"StoreSort"}static get defaultConfig(){return{useLocaleSort:null}}static get configurable(){return{sorters:[],reapplySortersOnAdd:!1}}get isSorted(){return!!this.sorters.length||this.isGrouped}changeSorters(t){return t.map(s=>this.normalizeSorterConfig(s,!0))}updateReapplySortersOnAdd(t){this.storage.autoSort=t}sort(t,s,r=!1,i=!1){const a=this,o=a.allRecords,l=a.sorters?a.sorters.slice():[];let c=null,u;if(t)if(Array.isArray(t))a.sorters=t.map(d=>a.normalizeSorterConfig(d,typeof d=="string"?!0:s));else{const d=a.normalizeSorterConfig(t,s);r?(u=a.getCurrentSorterByField(d.field),u?(c=u.ascending,u.ascending=d.ascending):a.sorters.push(d)):a.sorters=[d]}return!i&&a.trigger("beforeSort",{sorters:a.sorters,records:o,currentSorters:l})===!1?(a.sorters=l,c!==null&&(u.ascending=c),null):a.performSort(i)}normalizeSorterConfig(t,s){var r,i,a;const o=this,l={ascending:s};if(typeof t=="object"?(x.assign(l,t),t.fn&&(delete l.fn,l.sortFn=t.fn),l.ascending=(r=t.ascending)!=null?r:s):typeof t=="function"?l.sortFn=t:l.field=t,l.ascending==null){const c=o.getCurrentSorterByField(l.field);l.ascending=c?!c.ascending:!0}if(l.sortFn==null){const c=(a=(i=o.modelClass)==null?void 0:i.$meta.fields.map[l.field])==null?void 0:a.compareItems;c&&(l.sortFn=c)}return l}getCurrentSorterByField(t){return typeof t=="string"&&this.sorters.find(s=>s.field===t)||null}addSorter(t,s=!0){return this.sort(t,s,!0)}removeSorter(t){const s=this.sorters.findIndex(r=>r.field===t||r.sortFn===t);if(s>-1)return this.sorters.splice(s,1),this.sort()}clearSorters(t=!1){if(this.sorters.length)return this.sorters.length=0,this.sort(void 0,void 0,void 0,t)}createSorterFn(t){const s=this.useLocaleSort;return(r,i)=>{for(let a=0;a<t.length;a++){const o=t[a],{field:l,ascending:c=!0,useLocaleSort:u=s}=o,d=o.fn||o.sortFn,h=c?1:-1;if(d){const p=d.call(o,r,i);if(p===0)continue;if(p!==null)return p*h}const f=r.isModel?r.getValue(l):r[l],g=i.isModel?i.getValue(l):i[l];if(f!==g){if(f==null)return-h;if(g==null)return h;if(u&&typeof f=="string"){if(u===!0)return String(f).localeCompare(g)*h;if(typeof u=="string")return String(f).localeCompare(g,u)*h;if(typeof u=="object")return String(f).localeCompare(g,u.locale,u)*h}if(f>g)return h;if(f<g)return-h}}return 0}}get sorterFn(){const t=this,{sorters:s}=t;return t.createSorterFn(t.remoteSort?[{field:"_remoteSortIndex"}]:t.isGrouped?t.groupers.concat(s):s)}performSort(t){const s=this,{rootNode:r,storage:i,sorterFn:a}=s;s.tree?(!s.isChained&&r.traverse(o=>{o.isLoaded&&o.isParent&&(o.children.sort(a),o.updateChildrenIndices(o.children,"parentIndex",!0))}),i.replaceValues({values:s.collectDescendants(r).visible,silent:!0})):s.isGrouped?i.replaceValues({...s.prepareGroupRecords(a),silent:!0}):i.replaceValues({values:i.values.sort(a),silent:!0}),s.afterPerformSort(t||s.isRemoteDataLoading)}afterPerformSort(t){if(t)return;const s=this;s._idMap=null;const r={action:"sort",sorters:s.sorters,records:s.allRecords};s.trigger("sort",r),s.trigger("refresh",r)}},eh=()=>!0,th=e=>class extends(e||$){static get $name(){return"StoreChained"}static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],excludeCollapsedRecords:!0,chainSuspended:0}}static get properties(){return{chainedStores:null}}construct(t){super.construct(t);const s=this,{masterStore:r}=s,i=s.syncOrder?"sort":"";r&&(s.methodNamesToRelay.forEach(a=>s[a]=(...o)=>s.relayToMaster(a,o)),s.removeAll=(...a)=>{r.remove(s.getRange(),...a)},r.ion({changePreCommit:s.onMasterDataChangedPreCommit,change:s.onMasterDataChanged,[i]:s.onMasterDataChanged,prio:1,thisObj:s}),r.chainedStores||(r.chainedStores=[]),r.chainedStores.push(s),s.fillFromMaster())}get $master(){return this.masterStore||this}get isChained(){return!!this.masterStore}set chainedFilterFn(t){this._chainedFilterFn=this.thisObj?t.bind(this.thisObj):t}get chainedFilterFn(){return this._chainedFilterFn||eh}get methodNamesToRelay(){const t=Array.isArray(this.doRelayToMaster),s=Array.isArray(this.dontRelayToMaster);return t&&this.doRelayToMaster.filter(r=>!s||!this.dontRelayToMaster.includes(r))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach(t=>t.fillFromMaster())}fillFromMaster(){const t=this,{masterStore:s,isTree:r}=t;let i=[];if(!t.isChained)throw new Error("fillFromMaster only allowed on chained store");if(!t.isChainSuspended){if(s.isGrouped&&s.isFiltered?s.forEach(a=>i.push(a),s,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0}):i=s.allRecords.filter(a=>!a.isSpecialRow&&t.chainedFilterFn(a)),r&&(t.idRegister={},t.internalIdRegister={},i.forEach(a=>{a.stores.includes(t)?t.register(a):a.joinStore(t)}),t.excludeCollapsedRecords)){const a=t.getChildren(t.rootNode);i=t.doIncludeExclude(a,!0)}t.isFillingFromMaster=!0,t.data=i,t.isFillingFromMaster=!1}}commitToMaster(){const t=this,s=t.masterStore;if(!t.isChained)throw new Error("commitToMaster only allowed on chained store");return s.beginBatch(),s.remove(t.removed.values),s.add(t.added.values),s.endBatch(),t.commit()}relayToMaster(t,s){return this.masterStore[t](...s)}onMasterDataChangedPreCommit(t){this.onMasterDataChanged(t),this.$masterEventhandled=!0}onMasterDataChanged({action:t,changes:s,$handled:r,isMove:i}){var a;if(this.$masterEventhandled){this.$masterEventhandled=!1;return}i&&t==="remove"||(t!=="update"||(a=this.chainedFields)!=null&&a.some(o=>o in s))&&this.fillFromMaster()}makeChained(t=eh,s,r){return new((r==null?void 0:r.storeClass)||this.constructor)({...r||{},tree:!1,autoTree:!1,masterStore:this.$master,modelClass:this.modelClass,syncDataOnLoad:!1,chainedFilterFn:t,chainedFields:s})}chain(){return this.makeChained(...arguments)}doDestroy(){var t;(t=this.chainedStores)==null||t.forEach(s=>s.destroy()),super.doDestroy()}suspendChain(){this.chainSuspended++}resumeChain(t=!1){this.chainSuspended&&!--this.chainSuspended&&t&&this.fillFromMaster()}get isChainSuspended(){return this.chainSuspended>0}},rh=e=>class extends(e||$){static get $name(){return"StoreState"}getState(){const{sorters:t,groupers:s,filters:r}=this,i={};return t!=null&&t.length&&(i.sorters=t.map(a=>{const o=x.cleanupProperties(x.clone(a));return delete o.fn,delete o.sortFn,o})),s!=null&&s.length&&(i.groupers=s.map(a=>{const o=x.cleanupProperties(x.clone(a));return delete o.fn,o})),r!=null&&r.values.length&&(i.filters=r.values.map(a=>{const o=x.cleanupProperties(x.clone(a.config));return o.value=a.value,o.caseSensitive&&delete o.caseSensitive,o})),i}applyState(t){const s=this,{sorters:r=[],groupers:i=[],filters:a=[]}=t,{sortParamName:o,filterParamName:l}=s;s.sorters=r.filter(c=>c.field||c.sortFn&&!o),s.groupers=i.slice(),s.sort(),s.filters=a.filter(c=>c.property||c.filterBy&&!l),s.filter()}},Xm=e=>String(e).padStart(6,"0"),De=class{constructor(e){this.value=e,this._padded=null}set value(e){this._value=String(e!=null?e:"")}get value(){return this._value}static from(e){return e==null||e instanceof De?e:new De(e)}static pad(e){return e instanceof De?e.valueOf():De.split(e).map(Xm).join(".")}static split(e){let n,t;if(e||e===0)switch(typeof e){case"object":e=String(e);case"string":for(t=e.split("."),n=t.length;n-- >0;)t[n]=parseInt(t[n],10);break;case"number":t=[e];break}return t||[]}static compare(e,n){return e===n?0:!e||!n?e?1:n?-1:0:(e=De.pad(e),n=De.pad(n),e<n?-1:n<e?1:0)}append(e){const n=this.value;return De.from(n?`${n}.${e}`:e)}isEqual(e){return!De.compare(this,e)}match(e){let n=!1;if(e){const t=this.value,s=e[0]==="*",r=e.endsWith("*"),i=e.length;s===r?n=t.indexOf(s?e.substr(1,i-2):e)>-1:s?n=t.endsWith(e.substr(1)):n=t.startsWith(e.substr(0,i-1))}return n}toString(){return this.value}toJSON(){return this.toString()}valueOf(){var e;return(e=this._padded)!=null?e:this._padded=De.pad(this.value)}};De._$name="Wbs";var ev=Object.freeze([]),Jn=Symbol("StopBranch"),nh=e=>{var n;return n=class extends(e||$){get StopBranch(){return Jn}get isTree(){return this.tree||this.masterStore&&this.masterStore.tree}get leaves(){const t=this,s=[];return t.isTree?(t.traverse(r=>{r.isLeaf&&s.push(r)}),s):(t.allRecords.forEach(r=>{r.isLeaf&&s.push(r),r.traverse(i=>{i.isLeaf&&s.push(i)},!0)}),s)}async loadChildren(t){}onNodeAddChild(t,s,r,i,a=!1){var o;const l=this,c=t===l.rootNode&&t.isLoading,{storage:u}=l,{previousSibling:d}=s[0];let h;const{visible:f,all:g}=l.collectDescendants(s,void 0,void 0,{inCollapsedBranch:!(t.isExpanded(l)&&t.ancestorsExpanded(l)),applyFilter:l.isFiltered&&l.reapplyFilterOnAdd});if(!c&&g.length)for(const p of g)!l.modified.includes(p)&&!i[p.id]&&(l.removed.includes(p)?l.removed.remove(p):p.isLinked||l.added.add(p));if(c&&l.rootVisible&&(f.unshift(t),g.unshift(t)),f.length?(r===0||!d?h=u.indexOf(t):h=u.indexOf(d)+d.getDescendantCount(!0,l),u.suspendEvents(),l.storage.splice(++h,0,f),u.resumeEvents(),l._idMap=null):l._allRecords=null,l.updateDependentStores("add",s),c&&f.length){if(l.sorters.length&&l.sort(null,null,!1,!0),(o=l.afterLoadData)==null||o.call(l),!a){const p={action:"dataset",data:l._data,records:f};l.trigger("refresh",p),l.trigger("change",p)}}else if(!a){const p={action:"add",parent:t,isChild:!0,isMove:i,records:s,allRecords:g,index:h};if(l.trigger("add",p),l.trigger("change",p),Object.values(i).some(m=>m)){const m={newParent:t,records:s.filter(y=>i[y.id]),oldParents:s.map(y=>l.getById(y.meta.oldParentId))};l.trigger("move",m)}}}onNodeRemoveChild(t,s,r,i={isMove:!1,silent:!1,unfiltered:!1}){const a=this,{storage:o}=a,l=[],c=[],{isMove:u,silent:d,unfiltered:h}=i,f=h&&a.isFiltered,g=f&&t.unfilteredChildren?t.unfilteredChildren:s;if(a.collectDescendants(g,l,c,{inCollapsedBranch:!(t.isExpanded(a)&&t.ancestorsExpanded(a)),unfiltered:f}),!u){for(const p of s)p.unjoinStore(a);for(const p of c)p.stores.includes(a)&&p.unjoinStore(a),a.added.includes(p)?a.added.remove(p):p.isLinked||a.removed.add(p);a.modified.remove(c)}if(l.length?(r=o.indexOf(l[0]),r>-1&&(o.suspendEvents(),o.splice(r,l.length),o.resumeEvents(),a._idMap=null)):(r=-1,a._allRecords=null),!d&&(a.fireRemoveEventForMoveAction||!u)){const p={action:"remove",parent:t,isChild:!0,isMove:u,records:s,allRecords:c,index:r};a.trigger("remove",p),a.trigger("change",p)}return c}collectDescendants(t,s=[],r=[],i={}){var a;const o=this,{inCollapsedBranch:l=!1,unfiltered:c=!1,applyFilter:u=!1}=i,d=Array.isArray(t)?t:(a=o.getChildren(t,c))!=null?a:[];if(u)return{visible:d.flatMap(h=>this.collectVisibleNodeDescendantsFiltered(h)),all:d.flatMap(h=>h.allChildren)};for(let h=0,f=d.length,g;h<f;h++)g=d[h],l||s.push(g),r.push(g),o.collectDescendants(g,s,r,{inCollapsedBranch:l||!g.isExpanded(o),unfiltered:c});return{visible:s,all:r}}collectVisibleNodeDescendantsFiltered(t){const s=t.unfilteredChildren||t.children;if(!s||s.length===0||!t.isLeaf&&!t.isExpanded(this))return this.filtersFunction(t)?[t]:[];const r=s.flatMap(i=>this.collectVisibleNodeDescendantsFiltered(i));return r.length||this.filtersFunction(t)?[t,...r]:[]}getChildren(t,s=!1){const r=this,i=(s||r.isChained)&&t.unfilteredChildren||t.children;return i!=null&&i.length?r.isChained?i.filter(r.chainedFilterFn).sort(r.sorterFn):i:ev}internalToggleTreeSubRecords(t,s){const r=this,{storage:i}=r,a=i.indexOf(t),o=r.doIncludeExclude(r.getChildren(t),s);if(r.isFiltered&&s&&t.unfilteredChildren&&r.updateChildrenHiddenState(t),o.length&&a!==!1){if(i.suspendEvents(),s){i.splice(a+1,0,...o);const l={action:"add",isExpand:!0,records:o,index:a+1};r.trigger("add",l),r.trigger("change",l)}else{i.splice(a+1,o.length);const l={action:"remove",isCollapse:!0,records:o,index:a+1};r.trigger("remove",l),r.trigger("change",l)}i.resumeEvents(),r._idMap=null}}updateChildrenHiddenState(t){var s;(s=t.unfilteredChildren)==null||s.forEach(r=>{r.instanceMeta(this.id).hidden=!1,r.isLeaf||this.updateChildrenHiddenState(r)})}doIncludeExclude(t,s,r=[]){const i=this,a=(t==null?void 0:t.length)||0;for(let o=0;o<a;o++){const l=t[o];if(!i.isChained||i.chainedFilterFn(l)){const c=l.instanceMeta(i.id);(s||!c.hidden)&&r.push(l),c.hidden=!s,l.isExpanded(i)&&i.doIncludeExclude(i.getChildren(l),s,r)}}return r}async toggleCollapse(t,s){const r=this,i=r.getById(t),a=i.instanceMeta(r);if(s===void 0&&(s=!a.collapsed),!a.isLoadingChildren&&!i.isLeaf&&i.isExpanded(r)===s){if(r.trigger("beforeToggleNode",{record:i,collapse:s}),a.collapsed=s,a.collapsed)return r.onNodeCollapse(i),!0;{r.onNodeExpand(i);let o=!0;if(!i.isLoaded){a.isLoadingChildren=!0;try{await r.loadChildren(i)}catch(l){a.collapsed=!0,o=!1,r.trigger("loadChildrenException",{record:i,exception:l})}finally{a.isLoadingChildren=!1}}return o}}}onNodeCollapse(t){if(t.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(t,!1)}onNodeExpand(t){if(t.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(t,!0)}transformToTree(t){const{parentIdField:s,idField:r,childrenField:i}=this.modelClass,a=new Map,o=new Set,l=[];for(const u of t){const d=u[r];d!=null&&a.set(d,u),u[s]!=null&&o.add(u[s])}const c=u=>{const d=Object.assign({},u);return d[i]=[],a.set(d.id,d),d};for(let u of t){o.has(u.id)&&!u[i]&&(u=c(u));const d=u[s];if(d!=null){let h=a.get(d);h&&(h[i]||(h=c(h)),h[i].push(u))}else u[i]?l.push(u):u[r]!=null?l.push(c(u)):l.push(u)}return l}treeify(t,s,r=!1){const{length:i}=t,a=[],o=[],l={};let c,u;for(c=0;c<i;c++){let h=t[c];h=h.field||h,t[c].call||(t[c]=f=>f[h],t[c].fieldName=h),a[c]=new Map}this.rootNode.traverse(h=>{if(u=null,h.isLeaf){for(c=0;c<i;c++){const f=(u==null?void 0:u.path)||"",g=a[c],p=t[c](h);if(p===Jn)break;const m=`${f+(p!=null&&p.isModel?p.id:p)}/`,y=U.makeValidDomId(`generated_${m}`,"_"),D=t[c].fieldName,E=g.get(y)||g.set(y,{id:y,key:p,path:m,expanded:!0,readOnly:!0,children:[],generatedParent:!0,field:D,firstGroupChild:h}).get(y);u&&!u.children.includes(E)&&u.children.push(E),u=E}u?u.children.push(h):o.push(h)}},!0),(s||r)&&a.forEach(h=>h.forEach((f,g,p)=>{s==null||s(f),r&&(f=this.createRecord(f),p.set(g,f))})),l.children=[...a[0].values(),...o];const d=h=>{h.children&&(h.children.sort((f,g)=>{if(f.isLeaf===g.isLeaf)if(f.isLeaf){let p;for(let m=0;!p&&m<i;m++){const y=t[m](f),D=t[m](g);if(y===Jn||D===Jn)return f.isLeaf<g.isLeaf?-1:f.isLeaf>g.isLeaf?1:0;p=y<D?-1:D>y?1:0}return p}else return typeof f.key=="string"&&typeof g.key=="string"?f.key.localeCompare(g.key,void 0,{numeric:!0}):f.key<g.key?-1:f.key>g.key?1:0;else return f.isLeaf<g.isLeaf?-1:f.isLeaf>g.isLeaf?1:0}),h.children.forEach(d))};return d(l),l}treeifyFlatData(t){const{childrenField:s,parentIdField:r}=this.modelClass;let i=!1,a=!0;for(const o of t){if(o.isModel||Array.isArray(o[s])){a=!1;break}o[r]!=null&&(i=!0)}return a&&i&&(t=this.transformToTree(t)),t}async indent(t){const s=this;if(t=Array.isArray(t)?t:[t],t=t.filter(r=>{let i=!!r.previousSibling;for(;i&&!r.isRoot;)i=!t.includes(r.parent),r=r.parent;return i}),t.length&&s.trigger("beforeIndent",{records:t})!==!1){t.sort((r,i)=>De.compare(r.wbsCode,i.wbsCode)),s.beginBatch();for(const r of t){const i=r.previousSibling;i.appendChild(r),s.toggleCollapse(i,!1)}s.endBatch(),s.trigger("indent",{records:t}),s.trigger("change",{action:"indent",records:t})}}async outdent(t){const s=this;if(t=Array.isArray(t)?t:[t],t=t.filter(r=>{const{parent:i}=r;let a=i&&!i.isRoot;for(;a&&!r.isRoot;)a=!t.includes(i),r=r.parent;return a}),t.length&&s.trigger("beforeOutdent",{records:t})!==!1){t.sort((r,i)=>De.compare(r.wbsCode,i.wbsCode)),s.beginBatch();for(const r of t){const{parent:i}=r,a=i.children.slice(i.children.indexOf(r)+1);i.parent.insertChild(r,i.nextSibling),r.appendChild(a),s.toggleCollapse(r,!1)}s.endBatch(),s.trigger("outdent",{records:t}),s.trigger("change",{action:"outdent",records:t})}}},F(n,"$name","StoreTree"),F(n,"StopBranch",Jn),F(n,"configurable",{transformFlatData:null,fireRemoveEventForMoveAction:Se.checkVersion("core","6.0","<")}),n},To=class{static preWalk(e,n,t){const s=[e];let r,i;for(;s.length;)r=s.pop(),t(r),i=n(r),i&&s.push.apply(s,i.slice().reverse())}static preWalkWithParent(e,n,t){const s=[{node:e,parent:null}];for(;s.length;){const{parent:r,node:i}=s.pop();t(r,i);const a=n(i);Array.isArray(a)&&s.push(...a.slice().reverse().map(o=>({node:o,parent:i})))}}static preWalkUnordered(e,n,t){const s=[e];let r,i;for(;s.length;)r=s[s.length-1],t(r),i=n(r),i?s.splice(s.length-1,1,...i):s.length=s.length-1}static postWalk(e,n,t){const s=new Map,r=[e];let i,a;for(;r.length;)i=r[r.length-1],s.has(i)?(t(i),r.pop()):(a=n(i),a&&r.push(...a.slice().reverse()),s.set(i,i))}static prePostWalk(e,n,t,s){const r=new Map,i=[e];let a,o;for(;i.length;)a=i[i.length-1],r.has(a)?(s(a),i.pop()):(t(a),o=n(a),o&&i.push(...o.slice().reverse()),r.set(a,a))}};To._$name="WalkHelper";var sh=e=>class extends(e||$){static get $name(){return"StoreSync"}static get configurable(){return{syncDataOnLoad:null,shouldSyncDataset:null,shouldSyncRecord:null}}syncDataset(t){var s;const r=this,{storage:i}=r,a=(s=r.shouldSyncDataset)==null?void 0:s.call(r,{data:t});if(a===!1)return;r.isSyncingDataOnLoad=!0;const{toAdd:o,toRemove:l,toMove:c,updated:u,ids:d}=r.tree?r.syncTreeDataset(t,a):r.syncFlatDataset(t,a);let{threshold:h}=r.syncDataOnLoad,f=!1;if(h&&(typeof h=="string"&&(h=parseInt(h,10)/100*r.count),f=o.length+l.length+c.length+u.length>h),r.tree){if(o.length&&r.add(o,f).forEach(m=>m.clearParentId()),c.length)for(const{parent:p,node:m,index:y}of c)r.getById(p.id).insertChild(m,y);r.remove(l,f)}else f&&r.suspendEvents(),r.remove(l),r.add(o),f&&r.resumeEvents();h&&!f&&u.forEach(({record:p,toSet:m,wasSet:y})=>r.onModelChange(p,m,y)),r.acceptChanges();const g={added:o,removed:l,updated:u,thresholdSurpassed:f};if(r.isFiltered&&!r.remoteFilter&&r.filter({silent:r.isRemoteDataLoading}),r.isGrouped)r.group(null,null,!1,!0,r.isRemoteDataLoading);else if(r.isSorted)r.remoteSort?i.replaceValues({values:i.values.sort(r.createSorterFn(r.sorters)),silent:!0}):r.sort();else if(!r.tree)i.values.some((p,m)=>p.id!==d[m])&&(i.replaceValues({values:i.values.sort((p,m)=>d.indexOf(p.id)-d.indexOf(m.id)),silent:!0}),!f&&r.afterPerformSort());else{let p=!1,m=0;To.preWalk(r.rootNode,y=>Array.isArray(y.children)&&!p?y.children:null,y=>{y.id!==d[m++]&&(p=!0)}),p&&(r.sort((y,D)=>d.indexOf(y.id)-d.indexOf(D.id),void 0,void 0,!0),r.clearSorters(!0),!f&&r.afterPerformSort())}f&&r.trigger("refresh",{action:"batch",data:t,records:i.values,syncInfo:g}),r.isSyncingDataOnLoad=!1,r.trigger("loadSync",g)}syncFlatDataset(t,s){if(!t)return{toRemove:this.records};const r=this,{idField:i,allFields:a}=r.modelClass,o=[],l=[],c=[],u={},d=[],h=Array.isArray(s),{threshold:f,keepMissingValues:g}=r.syncDataOnLoad;let p=0;if(t.forEach(m=>{var y;m=m.isModel?m.data:m;const D=m[i],E=r.getById(D);if(!h||s.includes(D))if(E){if(((y=r.shouldSyncRecord)==null?void 0:y.call(r,{record:E,data:m}))!==!1){if(g===!1)for(const v of a)!(v.dataSource in m)&&v.dataSource in E.data&&(m[v.dataSource]=v.defaultValue);const C=E.set(m,null,!!f);C&&c.push({record:E,wasSet:C,toSet:m})}}else l.push(r.processRecord(r.createRecord(m)));E&&p++,u[D]=1,d.push(D)}),p<r.storage.totalCount)if(s)for(const m of s)u[m]||o.push(r.getById(m));else r.forEach(m=>{u[m.id]||o.push(m)});return{toAdd:l,toRemove:o,toMove:[],updated:c,ids:d}}syncTreeDataset(t){if(!t)return{toRemove:this.records};const s=this,{idField:r,parentIdField:i,childrenField:a,allFields:o}=s.modelClass,{keepMissingValues:l,threshold:c}=s.syncDataOnLoad,u=[],d=[],h=[],f=[],g=new Set,p=[];return s.transformFlatData&&(t=s.treeifyFlatData(t)),To.preWalkWithParent({isRoot:!0,id:s.rootNode.id,children:t},m=>m.children,(m,y)=>{var D;if(m){const{id:E,node:C}=s.resolveSyncNode(y);if(C){if(((D=s.shouldSyncRecord)==null?void 0:D.call(s,{record:C,data:y}))!==!1){let v;const S=C.children;if(S!==!0&&y[a]===!0&&(C.clearChildren(),C.data[a]=C.children=!0,delete y[a],s.toggleCollapse(C,!0),v=!0),C.parent.id!==m[r]&&h.push({node:C,parent:m,index:m[a].indexOf(y)}),l===!1)for(const w of o)w.name!=="parentId"&&!(w.dataSource in y)&&w.dataSource in C.data&&(y[w.dataSource]=w.defaultValue);const b=C.set(y,null,!!c);b?f.push({record:C,wasSet:b,toSet:y}):v&&C.signalNodeChanged({[a]:{value:!0,oldValue:S}})}}else y[i]=m[r],d.push({...y,...Array.isArray(y[a])?{children:[]}:void 0});g.add(C),p.push(E)}}),g.length!==t.length&&s.traverse(m=>{g.has(m)||u.push(m)}),{toAdd:d,toRemove:u,toMove:h,updated:f,ids:p}}resolveSyncNode(t){const s=t[this.modelClass.idField],r=this.getById(s);return{id:s,node:r}}},ih=Symbol("STM_PROP"),ah=e=>class extends(e||$){static get $name(){return"StoreStm"}static get defaultConfig(){return{stm:null,ignoreRemoteChangesInSTM:!1}}get stm(){return this[ih]}set stm(t){var s;const r=this;r.stm!==t&&((s=r.stm)!=null&&s.hasStore(r)&&r.stm.removeStore(r),r[ih]=t,r.stm&&!r.stm.hasStore(r)&&r.stm.addStore(r))}add(t,s=!1,r={}){let i;const{stm:a}=this;return!this.tree&&(a!=null&&a.enabled)?(i=super.add(t,s),i!=null&&i.length&&a.onStoreModelAdd(this,i,s)):i=super.add(t,s,r),i}insert(t,s,r=!1){let i;const{stm:a}=this;if(!this.tree&&(a!=null&&a.enabled)){const o=(Array.isArray(s)?s:[s]).reduce((l,c)=>{const u=c instanceof H?this.indexOf(c):void 0;return u!==void 0&&u!==-1&&l.set(c,u),l},new Map);i=super.insert(t,s),i!=null&&i.length&&(t=this.indexOf(i[0]),a.onStoreModelInsert(this,t,i,o,r))}else i=super.insert(t,s,r);return i}remove(t,s=!1,r){let i;const{stm:a}=this;if(!this.tree&&(a!=null&&a.enabled)){const l=(Array.isArray(t)?t:[t]).map(c=>this.getById(c)).filter(c=>!!c).reduce((c,u)=>{const d=this.indexOf(u);return d!==void 0&&d!==-1&&c.set(u,d),c},new Map);i=super.remove(t,s,r),i!=null&&i.length&&a.onStoreModelRemove(this,i,l,s)}else i=super.remove(t,s,r);return i}removeAll(t){const{stm:s}=this;let r;if(s!=null&&s.enabled){const{tree:i,rootNode:a,allRecords:o}=this,l=o.length,c=i?a.children.slice():o.slice();r=super.removeAll(t),l&&this.count===0&&s.onStoreRemoveAll(this,c,t)}else r=super.removeAll(t);return r}beforeApplyChangeset(){const{stm:t,crudManager:s}=this;let r=!1,i=null;return!(s!=null&&s.applyingChangeset)&&(t!=null&&t.enabled)&&(r=!0,t.isRecording&&(i=t.stash()),this.ignoreRemoteChangesInSTM?t.disable():t.startTransaction()),{shouldResume:r,transactionId:i}}applyChangeset(t,s,r,i,a){const{shouldResume:o,transactionId:l}=this.beforeApplyChangeset(),c=super.applyChangeset(t,s,r,i,a);return this.afterApplyChangeset(o,l),c}afterApplyChangeset(t,s){if(t){const{stm:r}=this;this.ignoreRemoteChangesInSTM?r.enable():r.stopTransaction(),r.applyStash(s)}}},tv={splice:1,clear:1},rv={includeFilteredOutRecords:!1,includeCollapsedGroupRecords:!1},Oo=(e,n)=>(n=n||!1,typeof n=="boolean"&&(n={includeFilteredOutRecords:n,includeCollapsedGroupRecords:!1}),n||rv),K=class extends $.mixin(Ar,Bd,Vt,km,Vm,Hd,Gd,qd,Kd,Jd,Zd,Xd,Yd,th,rh,nh,ah,sh,Zm){static get $name(){return"Store"}static get properties(){return{relationCache:{},dependentStoreConfigs:new Map}}static get configurable(){return{id:!0,modelClass:H,verifyNoGeneratedIds:!0}}static get defaultConfig(){return{fields:null,autoTree:!0,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:!1,allowNoId:!0,preventSubClassingModel:null}}static get identifiable(){return{registerGeneratedId:!1}}constructor(...e){if(super(...e),this.objectify)return this.initProxy()}construct(e={}){const n=this;Object.assign(n,{added:new ui,removed:new ui,modified:new ui,idRegister:{},internalIdRegister:{},oldIdMap:{}}),e.storeId&&(e=x.assign({id:e.storeId},e)),super.construct(e),n.initRelations()}static from(e,n={},t=null){return e&&!e.isStore&&(typeof e=="string"?e=K.getStore(e):(Array.isArray(e)&&(t&&(e=e.map(s=>s.isModel?s:t(s))),e=x.assign({},n,{data:e})),e=new K(e))),e}doDestroy(){var e,n,t,s;const r=this,i=r.registeredRecords;(n=(e=r.stm)==null?void 0:e.removeStore)==null||n.call(e,r);for(let a=i.length-1,o;a>=0;a--)o=i[a],o!=null&&o.isDestroyed||o.unjoinStore(r);(t=r._storage)==null||t.destroy(),r.isChained||(s=r.rootNode)==null||s.destroy(),super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const n=this;e!=null&&e.isCollection?n._storage=e:n._storage=new ln(e),n._storage.autoFilter=n.reapplyFilterOnAdd,n._storage.autoSort=n.reapplySortersOnAdd;for(const t of n._storage)t.joinStore(n);n._storage.ion({change:"onDataChange",thisObj:n})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){var e;const n=this;if(((e=n._allRecords)==null?void 0:e.generation)!==n.storage.generation){if(n.isTree){const t=n.collectDescendants(n.rootNode,void 0,void 0,{unfiltered:!0}).all;n.rootVisible&&t.unshift(n.rootNode),n._allRecords=t}else n._allRecords=n.isGrouped?n.collectGroupRecords():n.storage.allValues;n._allRecords.generation=n.storage.generation}return n._allRecords}getAllDataRecords(e){const n=this;return n.tree?e?n.allRecords:n.rootNode.allChildren:n.isGrouped?n.collectGroupRecords(e,!1):e?n.storage.allValues:n.storage.values}onIsCreatingToggle(e,n){const t=this,s=e.isPersistable&&!n;t.added[s?"add":"remove"](e),s&&(t.trigger("addConfirmed",{record:e}),t.autoCommit&&t.doAutoCommit())}joinRecordsToStore(e){const{allCount:n}=this;for(let t=0;t<e.length;t++){const s=e[t];s.setData("parentIndex",n+t-e.length),s.joinStore(this)}}onDataChange({source:e,action:n,added:t,removed:s,replaced:r,oldCount:i,items:a,from:o,to:l}){const c=this,u=tv[n],d=u&&(t==null?void 0:t.length),h=u&&(s==null?void 0:s.length);let f,g;if(c._idMap=null,d&&c.joinRecordsToStore(t),r==null||r.forEach(([p,m])=>{p.unjoinStore(c,!0),m.joinStore(c)}),super.onDataChange(...arguments),!c.isTree){if(d){for(const p of t)c.removed.includes(p)?c.removed.remove(p):p.isLinked||c.added.add(p);f=!c.remoteFilter&&c.isFiltered&&c.reapplyFilterOnAdd,f&&c.filter({silent:!0}),g=!c.remoteSort&&c.isSorted&&c.reapplySortersOnAdd,g&&c.sort(null,null,!1,!0)}if(h){for(const p of s)p.cancelBatch(),p.unjoinStore(c),c.added.includes(p)?c.added.remove(p):!p._undoingInsertion&&!p.isCreating&&!p.isLinked&&c.removed.add(p);c.modified.remove(s),f=!c.remoteFilter&&c.isFiltered,f&&c.filter({silent:!0})}}switch(n){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(d){c.updateDependentStores("add",t);const p=t.reduce((D,E)=>{const{previousIndex:C}=E.meta;return C>-1&&C<D&&(D=C),D},t[0].meta.previousIndex),m=e.indexOf(t[0],!e.autoFilter),y={records:t,index:m};p>-1&&(y.oldIndex=p),c.trigger("add",y),c.trigger("change",Object.assign({action:"add"},y)),f&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:i,records:c.storage.allValues}),g&&c.trigger("sort",{action:"sort",sorters:c.sorters,records:c.storage.allValues})}s.length&&(c.updateDependentStores("remove",s),c.trigger("remove",{records:s}),c.trigger("change",{action:"remove",records:s})),r.length&&(c.trigger("replace",{records:r,all:c.records.length===r.length}),c.trigger("change",{action:"replace",replaced:r,all:c.records.length===r.length}));break;case"filter":(c.isGrouped||c.isSorted)&&c.performSort(!0);break;case"move":{const p=Math.min(o,l),m=Math.min(c.storage.allValues.length-1,Math.max(o,l));for(let y=c.storage.allValues,D=p;D<=m;D++)y[D].setData("parentIndex",D);c.trigger("move",{record:a[0],records:a,from:o,to:l}),c.isFiltered&&c.performFilter(),c.trigger("change",{action:n,record:a[0],records:a,from:o,to:l});break}}}onDataReplaced(e,n){var t;const s=this,{storage:r}=s,i=r.allValues,a=s.sorters.length>0;for(let l=0;l<i.length;l++)i[l].joinStore(s);if(!s.remoteFilter&&s.isFiltered&&s.filter({silent:!0}),s.remoteSort?s.isGrouped&&r.replaceValues({...s.prepareGroupRecords(),silent:!0}):(s.isGrouped&&s.group(null,null,!1,!a,!0),a&&s.sort(null,null,!1,!0)),!s.useRawData.disableDuplicateIdCheck){const{idMap:l}=s;if(Object.keys(l).length<r.values.length){const c=[];throw r.values.forEach(u=>l[u.id]?delete l[u.id]:c.push(u)),new Error(`Id collision on ${c.map(u=>u.id)}`)}}const o={action:e,data:n,records:r.values};s.updateDependentStores(e,o.records),(t=s.afterLoadData)==null||t.call(s),s.isRemoteDataLoading||s.trigger("refresh",o),s.trigger("change",o)}onModelChange(e,n,t,s,r){const i=this,a={record:e,records:[e],changes:t,batch:e.batching!=null,fromRelationUpdate:r},o=e.ignoreBag||e.isLinked?!1:i.updateModifiedBagForRecord(e);if(i.storage.onItemMutation(e,t),"id"in t){const{oldValue:l,value:c}=n.id;i.updateDependentRecordIds(l,c),i.onRecordIdChange({record:e,oldValue:l,value:c})}if(!s){if("id"in t){const{oldValue:l,value:c}=n.id;i.trigger("idChange",{store:i,record:e,oldValue:l,value:c})}i.onUpdateRecord(e,t),i.trigger("update",a),i.trigger("change",Object.assign({action:"update"},a))}i.autoCommit&&o&&i.doAutoCommit()}updateModifiedBagForRecord(e){const n=this;let t=!1;return e.isModified?!n.modified.includes(e)&&!n.added.includes(e)&&e.isPartOfStore(n)&&!e.isAutoRoot&&(e.isPhantom?n.added.add(e):n.modified.add(e),t=!0):n.modified.remove(e),t}get idMap(){const e=this,n=!e._idMap,t=e._idMap||(e._idMap={});if(n){const s=e.storage.values;for(let r,i=0,a=0;i<s.length;i++)r=s[i],t[r.id]={index:i,visibleIndex:a,record:r},r.isSpecialRow||a++;if(e.isFiltered)for(let r=0,i=e.storage._values.length;r<i;r++){const a=e.storage._values[r];a.id in t?t[a.id].unfilteredIndex=r:t[a.id]={index:-1,unfilteredIndex:r,record:a}}}return t}changeModelClass(e){const{fields:n}=this;this.originalModelClass=e;let t=e;if(n!=null&&n.length){class s extends e{static get fields(){return n}}t=s}else if(!this.preventSubClassingModel){class s extends e{}t=s}return t.initClass(),t}set storeId(e){this.id=e}get storeId(){return this.id}changeId(e,n){return super.changeId(e!==!0&&e,n)}updateId(e,n){const t=K.getById(e);t&&K.unregisterInstance(t),super.updateId(e,n)}generateAutoId(){return K.generateId("store-")}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}buildRootNode(){return{}}static getStore(e,n){if(e instanceof K)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let t;const s=e.map(r=>(r instanceof H?t=r.constructor:typeof r=="string"&&(r={text:r}),r));if(!t){class r extends H{}t=r}e={autoCreated:!0,data:s,modelClass:t,allowNoId:!0},n||(n=K)}if(n)return new n(e)}static get stores(){return K.registeredInstances}get rootNode(){return this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var n;const t=this,s=t._rootNode;e!==s&&(s&&t.clear(!0),e instanceof H?(e.instanceMeta(t).collapsed=!1,t._rootNode=e):t._rootNode=e=new t.modelClass(Object.assign({expanded:!0,[t.modelClass.idField]:`${t.id}-rootNode`},e),t,null,!0),t._tree=!0,e.isRoot=!0,e.joinStore(t),((n=e.children)!=null&&n.length||t.rootVisible)&&(e.isLoading=!0,t.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),t.trigger("rootChange",{oldRoot:s,rootNode:e}))}set data(e){this.setStoreData(e)}setStoreData(e){const n=this,{idField:t,childrenField:s}=n.modelClass;if(n.transformFlatData&&(e==null?void 0:e.length)>0&&!Object.isExtensible(e[0])&&(n.useRawData=n.useRawData||{disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1},e=x.clone(e)),n.getConfig("plugins"),n.processConfiguredListeners(),e&&!Array.isArray(e)&&(e=x.transformNamedObjectToArray(e,t)),n.tree=!n.isChained&&(n.tree||!!(n.autoTree&&(e!=null&&e.some(r=>r[s])))),e&&(n.remoteSort||n.remoteFilter))for(let r=0;r<e.length;r++)e[r]._remoteSortIndex=r;if(!n.syncDataOnLoad||!n._data){if(n._data=e,n.tree){n.transformFlatData&&(e=n.treeifyFlatData(e));const r=n.rootNode;if(r.isLoading=!0,n.clear(!0),r.appendChild(e),n.updateDependentStores("dataset",[r]),r.isLoading=!1,e.length===0){const i={action:"dataset",data:[],records:[]};n.trigger("refresh",i),n.trigger("change",i)}else n.isFiltered&&n.filter()}else n.loadData(e);n.added.clear(),n.removed.clear(),n.modified.clear()}else n.syncDataset(e)}loadData(e,n="dataset"){var t,s;const r=this,{storage:i,allowNoId:a}=r,o=r.modelClass.fieldMap.id.dataSource,l=r.find(u=>u.isCreating);l&&i.values.splice(r.records.indexOf(l),1);let c=r.verifyNoGeneratedIds;if(r.removeHeadersAndFooters(r.storage.values),r._idMap=null,r.oldIdMap={},e){if(!(e[0]instanceof H)){r.modelClass.exposeProperties(e[0]);const d=e.length,h=new Array(d);for(let f=0;f<d;f++){const g=e[f];if(!a&&g[o]==null)throw new Error(`Id required but not found on row ${f}`);c&&((s=(t=g[o])==null?void 0:t.startsWith)!=null&&s.call(t,"_generated"))&&(console.warn(`Generated id found in data: ${g[o]}. Generated ids are temporary and should be replaced with real ids by the backend`),c=!1),h[f]=r.processRecord(r.createRecord(g,!0),!0),h[f].setData("parentIndex",f)}r.clear(!0),i.replaceValues({values:h,isNewDataset:!0,silent:!0})}else r.clear(!0),i.replaceValues({values:e.slice(),isNewDataset:!0,silent:!0});l&&!i.values.includes(l)&&i.values.push(l),r._data=e,r.onDataReplaced(n,e)}else r.clear(!0),r._data=null;r.isSyncingDataOnLoad=!1}get data(){return this._data}getRange(e,n,t=!0){return(t?this.storage.allValues:this.storage.values).slice(e,n)}createRecord(e,n=!1,t=!1){return new this.modelClass(e,this,null,n,!1,t)}processRecord(e,n=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:n,value:t}){const s=this,r=s._idMap,{idRegister:i,oldIdMap:a}=s;if(s.storage._indicesInvalid=!0,a[n]=e,r&&!r[t]){const o=r[n];delete r[n],r[t]=o}s.added.changeId(n,t),s.removed.changeId(n,t),s.modified.changeId(n,t),delete i[n],i[t]=e,e.index=s.storage.indexOf(e)}onUpdateRecord(e,n){const t=this,{internalId:s}=n,{internalIdRegister:r}=t;s&&(this.storage._indicesInvalid=!0,delete r[s.oldValue],r[s.value]=e),t.reapplyFilterOnUpdate&&t.isFiltered&&t.filter()}get useRawData(){return this._useRawData}set useRawData(e){e===!0?this._useRawData={enabled:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0,disableDefaultValue:!1}:this._useRawData=e?Object.assign(e,{enabled:!0}):{enabled:!1}}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){var e;return this.storage.totalCount-(((e=this.groupRecords)==null?void 0:e.length)||0)}get count(){return this.storage.count}get allCount(){return this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,n=!1){return this.storage.getAt(e,n)}register(e){const n=this;if(!n.useRawData.disableDuplicateIdCheck){const t=n.isTree&&n.idRegister[e.id];if(t&&t!==e)throw new Error(`Id collision on ${e.id}`)}n.idRegister[e.id]=e,n.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){if(e!=null&&e.isModel){const n=e;return n.hasLinks&&!this.storage.allValues.includes(n)?n.$links.find(t=>this.storage.allValues.includes(t)):n}return this.idRegister[e]}isAvailable(e){const n=this.getById(e);return n&&this.storage.includes(n)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?this.idRegister[H.asId(e)]!=null:this.indexOf(e)>-1}indexOf(e,n=!1,t=!1){if(e!=null&&e.isModel&&!e.stores.includes(this.$store||this)){const i=e.$links.find(a=>this.storage.allValues.includes(a));return i?this.indexOf(i,n):-1}if(this.isTree)return(t?this.rootNode.allChildren:this.storage.values).indexOf(this.getById(e));const s=H.asId(e);if(s==null)return-1;const r=this.idMap[s];return r?r[n?"visibleIndex":"index"]:-1}allIndexOf(e){return this.isTree?this.allRecords.indexOf(this.getById(e)):this.storage.indexOf(e,!0)}getDistinctValues(e,n=!1){const t=this,s=[],r={};let i;return t.forEach(a=>{if(!a.isSpecialRow&&!a.isRoot){i=a.getValue(e);const o=i instanceof Date?i.getTime():i;r[o]||(s.push(i),r[o]=1)}},t,n),s}getValueCount(e,n){let t=0;return this.forEach(s=>{x.isEqual(s.getValue(e),n)&&t++}),t}set json(e){typeof e=="string"&&(e=U.safeJsonParse(e)),this.data=e}get json(){return U.safeJsonStringify(this)}get formattedJSON(){return U.safeJsonStringify(this,null,4)}toJSON(){return(this.isTree?this.rootNode.unfilteredChildren||this.rootNode.children||[]:this.allRecords).map(e=>e.toJSON())}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.project}getInlineData(e){var n;const t=[];return this.tree?(n=this.rootNode.children)==null||n.forEach(s=>t.push(s.getCurrentConfig(e))):this.forEach(s=>t.push(s.getCurrentConfig(e))),t}getCurrentConfig(e){var n;const t=super.getCurrentConfig(e),{state:s}=this;return t&&(t.data&&(t.data=this.getInlineData(e)),delete t.project,delete t.stm,delete t.asyncEvents,((n=t.modelClass)==null?void 0:n.$meta.hierarchy[t.modelClass.$meta.hierarchy.length-2])===this.constructor.defaultConfig.modelClass&&delete t.modelClass,this.tree||delete t.tree,s&&Object.assign(t,s)),t}forEach(e,n=this,t){const s=this,r=(i,a)=>{if(!i.isRoot&&!i.isSpecialRow)return e.call(n,i,a)};if(t=Oo(s,t),s.isTree)s.isChained&&(t={...t,sorterFn:s.sorterFn}),s.rootNode.traverseWhile(r,!1,t);else{const i=t.includeFilteredOutRecords?s.storage.allValues:s.storage.values;if(s.isGrouped&&t.includeCollapsedGroupRecords)for(let a=0;a<i.length;a++){const o=i[a],l=t.includeFilteredOutRecords?o.unfilteredGroupChildren:o.groupChildren;if(l&&o.meta.collapsed===!0)for(let c=0;c<l.length;c++){const u=l[c];if(r(u,c)===!1)return}else if(r(o,a)===!1)return}else for(let a=0;a<i.length;a++)if(r(i[a],a)===!1)return}}map(e,n=this){return this.storage.values.map(e,n)}flatMap(e,n=this){return this.storage.values.flatMap(e,n)}every(e,n=this,t){return this.storage[t?"allValues":"values"].every(e,n)}reduce(e,n=[],t=this){return t!==this&&(e=e.bind(t)),this.storage.values.reduce(e,n,t)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,n=this.rootNode,t=n===this.rootNode,s){const r=this;if(s=Oo(r,s),r.isTree){if(typeof n=="boolean"&&(t=n,n=r.rootNode),r.isChained){const i=e;e=a=>{r.chainedFilterFn(a)&&i(a)}}n.traverse(e,t,s)}else r.forEach(i=>i.traverse(e,!1,s),r,s)}traverseWhile(e,n=this.rootNode,t=n===this.rootNode,s){const r=this;if(s=Oo(r,s),r.isTree){if(typeof n=="boolean"&&(t=n,n=r.rootNode),r.isChained){const i=e;e=a=>{r.chainedFilterFn(a)&&i(a)}}n.traverseWhile(e,t,s)}else for(const i of r.storage)if(i.traverse(e,!1,s)===!1)break}getNext(e,n=!1,t=!1){const s=this,r=s.storage.values;let i=s.indexOf(e);if(i>=r.length-1)if(n)i=-1;else return null;const a=r[i+1];return t&&a&&a.isSpecialRow?s.getNext(r[i+1],n,!0):a}getPrev(e,n=!1,t=!1){const s=this,r=s.storage.values;let i=s.indexOf(e);if(i===0)if(n)i=r.length;else return null;const a=r[i-1];return t&&a&&a.isSpecialRow&&i>0?s.getPrev(r[i-1],n,!0):a}getAdjacent(e,n=!0,t=!1,s=!1){return n?this.getNext(e,t,s):this.getPrev(e,t,s)}getNextLeaf(e,n=!1){const t=this,s=t.leaves,r=t.getById(e);let i=s.indexOf(r);if(i>=s.length-1)if(n)i=-1;else return null;return s[i+1]}getPrevLeaf(e,n=!1){const t=this,s=t.leaves,r=t.getById(e);let i=s.indexOf(r);if(i===0)if(n)i=s.length;else return null;return s[i-1]}getAdjacentLeaf(e,n=!0,t=!1){return n?this.getNextLeaf(e,t):this.getPrevLeaf(e,t)}};K.initClass(),K._$name="Store";var oh=class extends O([K],e=>class extends e{}){},mt=class extends O([zn,K],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}static get $name(){return"AbstractPartOfProjectStoreMixin"}construct(r={}){return r.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},n.construct.call(this,r)}trigger(r,i){const a=this,{asyncEvents:o,project:l}=a,c=o==null?void 0:o[r];return c&&(c===!0||c[i.action])?(n.trigger.call(a,`${r}PreCommit`,{...i}),!l||l.isEngineReady()&&!l.isWritingData?n.trigger.call(a,r,i):!a.eventsSuspended&&l&&(l.dataReadyDetacher||(l.queuedDataReadyEvents=[],l.dataReadyDetacher=l.ion({dataReady(){this.queuedDataReadyEvents.forEach(([d,h,f,g])=>{d.trigger.call(h,f,g)}),l.queuedDataReadyEvents=null,l.dataReadyDetacher(),l.dataReadyDetacher=null},once:!0})),l.queuedDataReadyEvents.push([n,a,r,i])),!0):n.trigger.call(a,r,i)}calculateProject(){return this.project}setStoreData(r){var i;this.project&&!(this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag)&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,n.setStoreData.call(this,r),this.isLoadingData=!1,(i=this.project)==null||i.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),n.doAutoCommit.call(this)}async addAsync(r,i){const a=this.add(r,i);return await this.project.commitAsync(),a}async insertAsync(r,i,a){const o=this.insert(r,i,a);return await this.project.commitAsync(),o}async loadDataAsync(r){this.data=r,await this.project.commitAsync()}performFilter(){var r;return this.project&&(this.isLoadingData||(r=this.rootNode)!=null&&r.isLoading)&&this.project.commitAsync().then(()=>this.filter()),super.performFilter(...arguments)}}return t}){},_r=class extends O([mt,Ro,oh],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=0}setStoreData(r){var i;(i=this.project)==null||i.repopulateStore(this),n.setStoreData.call(this,r)}register(r){var i,a;n.register.call(this,r),!r.isRoot&&!((i=this.project)!=null&&i.graph)&&((a=this.project)==null||a.scheduleDelayedCalculation())}onModelChange(r,i,a,o,l,c){var u;!c&&!(this.syncDataOnLoad&&this.isLoadingData)&&Object.keys(a).some(d=>d!=="intervals"&&r.$entity.getField(d))&&!((u=this.project)!=null&&u.applyingSyncResponse)&&(o=!0),super.onModelChange(r,i,a,o,l,c)}}return t}){},cn=class extends O([zn,H],e=>{const n=e.prototype;class t extends e{joinStore(r){let i=null;if(ze(r,mt)){const a=r.getProject();a&&!this.getProject()&&(this.setProject(a),i=a)}n.joinStore.call(this,r),i&&!i.isRepopulatingStores&&this.joinProject()}unjoinStore(r,i=!1){n.unjoinStore.call(this,r,i);const{project:a}=this,o=ze(r,mt)&&!r.isFillingFromMaster&&a===(r.isChained&&r.project?r.masterStore.project:r.project);a&&!a.isDestroying&&!a.isRepopulatingStores&&o&&(this.leaveProject(i),this.setProject(null)),o&&(this.graph=null)}joinProject(){}leaveProject(r=!1){}calculateProject(){const r=this.stores.find(i=>ze(i,mt)&&!!i.getProject());return r==null?void 0:r.getProject()}async setAsync(r,i,a){var o;const l=this.set(r,i,a);return await((o=this.project)==null?void 0:o.commitAsync()),l}async getAsync(r){var i;return await((i=this.project)==null?void 0:i.commitAsync()),this.get(r)}get isStmRestoring(){const r=this.getProject();return(r==null?void 0:r.isRestoringData)||(r==null?void 0:r.stm.isRestoring)||!1}}return t}){},un=class extends O([cn,Ro,ii],e=>{const n=e.prototype;class t extends e{joinProject(){var r;(r=this.project)!=null&&r.delayEnteringReplica||(this.graph&&this.graph!=this.getGraph()&&(this.graph=null),this.getGraph().addEntity(this))}leaveProject(r=!1){n.leaveProject.call(this,r);const i=this.getGraph();i==null||i.removeEntity(this),this.graph=null}getProject(){return n.getProject.call(this)}calculateProject(){const r=this.stores.find(i=>ze(i,_r)&&!!i.getProject());return r==null?void 0:r.getProject()}get graph(){var r;return(r=this.project)!=null&&r.delayEnteringReplica?null:this._graph}set graph(r){this._graph=r}}return t}){},lh=(e,n)=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()+n,e.getMilliseconds()),Ao=function(){"use strict";var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(n){"use strict";if(this==null)throw new TypeError;var t=Object(this),s=t.length>>>0;if(s===0)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=s)return-1;for(var i=r>=0?r:Math.max(s-Math.abs(r),0);i<s;i++)if(i in t&&t[i]===n)return i;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(n,t){n.sort(function(s,r){return+s-+r}),t&&n[0]===0&&n.push(n.shift())},e.array.next=function(n,t,s){for(var r,i=s[0]!==0,a=0,o=t.length-1;o>-1;--o){if(r=t[o],r===n)return r;if(r>n||r===0&&i&&s[1]>n){a=o;continue}break}return t[a]},e.array.nextInvalid=function(n,t,s){for(var r=s[0],i=s[1],a=t.length,o=t[a-1]===0&&r!==0?i:0,l=n,c=t.indexOf(n),u=l;l===(t[c]||o);)if(l++,l>i&&(l=r),c++,c===a&&(c=0),l===u)return;return l},e.array.prev=function(n,t,s){for(var r,i=t.length,a=s[0]!==0,o=i-1,l=0;l<i;l++){if(r=t[l],r===n)return r;if(r<n||r===0&&a&&s[1]<n){o=l;continue}break}return t[o]},e.array.prevInvalid=function(n,t,s){for(var r=s[0],i=s[1],a=t.length,o=t[a-1]===0&&r!==0?i:0,l=n,c=t.indexOf(n),u=l;l===(t[c]||o);)if(l--,l<r&&(l=i),c--,c===-1&&(c=a-1),l===u)return;return l},e.day=e.D={name:"day",range:86400,val:function(n){return n.D||(n.D=e.date.getDate.call(n))},isValid:function(n,t){return e.D.val(n)===(t||e.D.extent(n)[1])},extent:function(n){if(n.DExtent)return n.DExtent;var t=e.M.val(n),s=e.DAYS_IN_MONTH[t-1];return t===2&&e.dy.extent(n)[1]===366&&(s=s+1),n.DExtent=[1,s]},start:function(n){return n.DStart||(n.DStart=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n)))},end:function(n){return n.DEnd||(n.DEnd=e.date.prev(e.Y.val(n),e.M.val(n),e.D.val(n)))},next:function(n,t){t=t>e.D.extent(n)[1]?1:t;var s=e.date.nextRollover(n,t,e.D,e.M),r=e.D.extent(s)[1];return t=t>r?1:t||r,e.date.next(e.Y.val(s),e.M.val(s),t)},prev:function(n,t){var s=e.date.prevRollover(n,t,e.D,e.M),r=e.D.extent(s)[1];return e.date.prev(e.Y.val(s),e.M.val(s),t>r?r:t||r)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(n){return n.dc||(n.dc=Math.floor((e.D.val(n)-1)/7)+1)},isValid:function(n,t){return e.dc.val(n)===t||t===0&&e.D.val(n)>e.D.extent(n)[1]-7},extent:function(n){return n.dcExtent||(n.dcExtent=[1,Math.ceil(e.D.extent(n)[1]/7)])},start:function(n){return n.dcStart||(n.dcStart=e.date.next(e.Y.val(n),e.M.val(n),Math.max(1,(e.dc.val(n)-1)*7+1||1)))},end:function(n){return n.dcEnd||(n.dcEnd=e.date.prev(e.Y.val(n),e.M.val(n),Math.min(e.dc.val(n)*7,e.D.extent(n)[1])))},next:function(n,t){t=t>e.dc.extent(n)[1]?1:t;var s=e.date.nextRollover(n,t,e.dc,e.M),r=e.dc.extent(s)[1];t=t>r?1:t;var i=e.date.next(e.Y.val(s),e.M.val(s),t===0?e.D.extent(s)[1]-6:1+7*(t-1));return i.getTime()<=n.getTime()?(s=e.M.next(n,e.M.val(n)+1),e.date.next(e.Y.val(s),e.M.val(s),t===0?e.D.extent(s)[1]-6:1+7*(t-1))):i},prev:function(n,t){var s=e.date.prevRollover(n,t,e.dc,e.M),r=e.dc.extent(s)[1];return t=t>r?r:t||r,e.dc.end(e.date.prev(e.Y.val(s),e.M.val(s),1+7*(t-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(n){return n.dw||(n.dw=e.date.getDay.call(n)+1)},isValid:function(n,t){return e.dw.val(n)===(t||7)},extent:function(){return[1,7]},start:function(n){return e.D.start(n)},end:function(n){return e.D.end(n)},next:function(n,t){return t=t>7?1:t||7,e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n)+(t-e.dw.val(n))+(t<=e.dw.val(n)?7:0))},prev:function(n,t){return t=t>7?7:t||7,e.date.prev(e.Y.val(n),e.M.val(n),e.D.val(n)+(t-e.dw.val(n))+(t>=e.dw.val(n)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(n){return n.dy||(n.dy=Math.ceil(1+(e.D.start(n).getTime()-e.Y.start(n).getTime())/e.DAY))},isValid:function(n,t){return e.dy.val(n)===(t||e.dy.extent(n)[1])},extent:function(n){var t=e.Y.val(n);return n.dyExtent||(n.dyExtent=[1,t%4?365:366])},start:function(n){return e.D.start(n)},end:function(n){return e.D.end(n)},next:function(n,t){t=t>e.dy.extent(n)[1]?1:t;var s=e.date.nextRollover(n,t,e.dy,e.Y),r=e.dy.extent(s)[1];return t=t>r?1:t||r,e.date.next(e.Y.val(s),e.M.val(s),t)},prev:function(n,t){var s=e.date.prevRollover(n,t,e.dy,e.Y),r=e.dy.extent(s)[1];return t=t>r?r:t||r,e.date.prev(e.Y.val(s),e.M.val(s),t)}},e.hour=e.h={name:"hour",range:3600,val:function(n){return n.h||(n.h=e.date.getHour.call(n))},isValid:function(n,t){return e.h.val(n)===t},extent:function(){return[0,23]},start:function(n){return n.hStart||(n.hStart=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n),e.h.val(n)))},end:function(n){return n.hEnd||(n.hEnd=e.date.prev(e.Y.val(n),e.M.val(n),e.D.val(n),e.h.val(n)))},next:function(n,t){t=t>23?0:t;var s=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n)+(t<=e.h.val(n)?1:0),t);return!e.date.isUTC&&s.getTime()<=n.getTime()&&(s=e.date.next(e.Y.val(s),e.M.val(s),e.D.val(s),t+1)),s},prev:function(n,t){return t=t>23?23:t,e.date.prev(e.Y.val(n),e.M.val(n),e.D.val(n)+(t>=e.h.val(n)?-1:0),t)}},e.minute=e.m={name:"minute",range:60,val:function(n){return n.m||(n.m=e.date.getMin.call(n))},isValid:function(n,t){return e.m.val(n)===t},extent:function(n){return[0,59]},start:function(n){return n.mStart||(n.mStart=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n),e.h.val(n),e.m.val(n)))},end:function(n){return n.mEnd||(n.mEnd=e.date.prev(e.Y.val(n),e.M.val(n),e.D.val(n),e.h.val(n),e.m.val(n)))},next:function(n,t){var s=e.m.val(n),r=e.s.val(n),i=t>59?60-s:t<=s?60-s+t:t-s,a=new Date(n.getTime()+i*e.MIN-r*e.SEC);return!e.date.isUTC&&a.getTime()<=n.getTime()&&(a=new Date(n.getTime()+(i+120)*e.MIN-r*e.SEC)),a},prev:function(n,t){return t=t>59?59:t,e.date.prev(e.Y.val(n),e.M.val(n),e.D.val(n),e.h.val(n)+(t>=e.m.val(n)?-1:0),t)}},e.month=e.M={name:"month",range:2629740,val:function(n){return n.M||(n.M=e.date.getMonth.call(n)+1)},isValid:function(n,t){return e.M.val(n)===(t||12)},extent:function(){return[1,12]},start:function(n){return n.MStart||(n.MStart=e.date.next(e.Y.val(n),e.M.val(n)))},end:function(n){return n.MEnd||(n.MEnd=e.date.prev(e.Y.val(n),e.M.val(n)))},next:function(n,t){return t=t>12?1:t||12,e.date.next(e.Y.val(n)+(t>e.M.val(n)?0:1),t)},prev:function(n,t){return t=t>12?12:t||12,e.date.prev(e.Y.val(n)-(t>=e.M.val(n)?1:0),t)}},e.second=e.s={name:"second",range:1,val:function(n){return n.s||(n.s=e.date.getSec.call(n))},isValid:function(n,t){return e.s.val(n)===t},extent:function(){return[0,59]},start:function(n){return n},end:function(n){return n},next:function(n,t){var s=e.s.val(n),r=t>59?60-s:t<=s?60-s+t:t-s,i=new Date(n.getTime()+r*e.SEC);return!e.date.isUTC&&i.getTime()<=n.getTime()&&(i=new Date(n.getTime()+(r+7200)*e.SEC)),i},prev:function(n,t,s){return t=t>59?59:t,e.date.prev(e.Y.val(n),e.M.val(n),e.D.val(n),e.h.val(n),e.m.val(n)+(t>=e.s.val(n)?-1:0),t)}},e.time=e.t={name:"time",range:1,val:function(n){return n.t||(n.t=e.h.val(n)*3600+e.m.val(n)*60+e.s.val(n))},isValid:function(n,t){return e.t.val(n)===t},extent:function(){return[0,86399]},start:function(n){return n},end:function(n){return n},next:function(n,t){t=t>86399?0:t;var s=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n)+(t<=e.t.val(n)?1:0),0,0,t);return!e.date.isUTC&&s.getTime()<n.getTime()&&(s=e.date.next(e.Y.val(s),e.M.val(s),e.D.val(s),e.h.val(s),e.m.val(s),t+7200)),s},prev:function(n,t){return t=t>86399?86399:t,e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n)+(t>=e.t.val(n)?-1:0),0,0,t)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(n){return n.wm||(n.wm=(e.D.val(n)+(e.dw.val(e.M.start(n))-1)+(7-e.dw.val(n)))/7)},isValid:function(n,t){return e.wm.val(n)===(t||e.wm.extent(n)[1])},extent:function(n){return n.wmExtent||(n.wmExtent=[1,(e.D.extent(n)[1]+(e.dw.val(e.M.start(n))-1)+(7-e.dw.val(e.M.end(n))))/7])},start:function(n){return n.wmStart||(n.wmStart=e.date.next(e.Y.val(n),e.M.val(n),Math.max(e.D.val(n)-e.dw.val(n)+1,1)))},end:function(n){return n.wmEnd||(n.wmEnd=e.date.prev(e.Y.val(n),e.M.val(n),Math.min(e.D.val(n)+(7-e.dw.val(n)),e.D.extent(n)[1])))},next:function(n,t){t=t>e.wm.extent(n)[1]?1:t;var s=e.date.nextRollover(n,t,e.wm,e.M),r=e.wm.extent(s)[1];return t=t>r?1:t||r,e.date.next(e.Y.val(s),e.M.val(s),Math.max(1,(t-1)*7-(e.dw.val(s)-2)))},prev:function(n,t){var s=e.date.prevRollover(n,t,e.wm,e.M),r=e.wm.extent(s)[1];return t=t>r?r:t||r,e.wm.end(e.date.next(e.Y.val(s),e.M.val(s),Math.max(1,(t-1)*7-(e.dw.val(s)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(n){if(n.wy)return n.wy;var t=e.dw.next(e.wy.start(n),5),s=e.dw.next(e.Y.prev(t,e.Y.val(t)-1),5);return n.wy=1+Math.ceil((t.getTime()-s.getTime())/e.WEEK)},isValid:function(n,t){return e.wy.val(n)===(t||e.wy.extent(n)[1])},extent:function(n){if(n.wyExtent)return n.wyExtent;var t=e.dw.next(e.wy.start(n),5),s=e.dw.val(e.Y.start(t)),r=e.dw.val(e.Y.end(t));return n.wyExtent=[1,s===5||r===5?53:52]},start:function(n){return n.wyStart||(n.wyStart=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n)-(e.dw.val(n)>1?e.dw.val(n)-2:6)))},end:function(n){return n.wyEnd||(n.wyEnd=e.date.prev(e.Y.val(n),e.M.val(n),e.D.val(n)+(e.dw.val(n)>1?8-e.dw.val(n):0)))},next:function(n,t){t=t>e.wy.extent(n)[1]?1:t;var s=e.dw.next(e.wy.start(n),5),r=e.date.nextRollover(s,t,e.wy,e.Y);e.wy.val(r)!==1&&(r=e.dw.next(r,2));var i=e.wy.extent(r)[1],a=e.wy.start(r);return t=t>i?1:t||i,e.date.next(e.Y.val(a),e.M.val(a),e.D.val(a)+7*(t-1))},prev:function(n,t){var s=e.dw.next(e.wy.start(n),5),r=e.date.prevRollover(s,t,e.wy,e.Y);e.wy.val(r)!==1&&(r=e.dw.next(r,2));var i=e.wy.extent(r)[1],a=e.wy.end(r);return t=t>i?i:t||i,e.wy.end(e.date.next(e.Y.val(a),e.M.val(a),e.D.val(a)+7*(t-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(n){return n.Y||(n.Y=e.date.getYear.call(n))},isValid:function(n,t){return e.Y.val(n)===t},extent:function(){return[1970,2099]},start:function(n){return n.YStart||(n.YStart=e.date.next(e.Y.val(n)))},end:function(n){return n.YEnd||(n.YEnd=e.date.prev(e.Y.val(n)))},next:function(n,t){return t>e.Y.val(n)&&t<=e.Y.extent()[1]?e.date.next(t):e.NEVER},prev:function(n,t){return t<e.Y.val(n)&&t>=e.Y.extent()[0]?e.date.prev(t):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(n){return n.fd||(n.fd=n.getTime())},isValid:function(n,t){return e.fd.val(n)===t},extent:function(){return[0,3250368e7]},start:function(n){return n},end:function(n){return n},next:function(n,t){return e.fd.val(n)<t?new Date(t):e.NEVER},prev:function(n,t){return e.fd.val(n)>t?new Date(t):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(n,t){var s=t[0];return{name:"after "+n.name,range:(n.extent(new Date)[1]-s)*n.range,val:n.val,isValid:function(r,i){return this.val(r)>=s},extent:n.extent,start:n.start,end:n.end,next:function(r,i){return i!=s&&(i=n.extent(r)[0]),n.next(r,i)},prev:function(r,i){return i=i===s?n.extent(r)[1]:s-1,n.prev(r,i)}}},e.modifier.before=e.modifier.b=function(n,t){var s=t[t.length-1];return{name:"before "+n.name,range:n.range*(s-1),val:n.val,isValid:function(r,i){return this.val(r)<s},extent:n.extent,start:n.start,end:n.end,next:function(r,i){return i=i===s?n.extent(r)[0]:s,n.next(r,i)},prev:function(r,i){return i=i===s?s-1:n.extent(r)[1],n.prev(r,i)}}},e.compile=function(n){var t=[],s=0,r;for(var i in n){var a=i.split("_"),o=a[0],l=a[1],c=n[i],u=l?e.modifier[l](e[o],c):e[o];t.push({constraint:u,vals:c}),s++}t.sort(function(h,f){var g=h.constraint.range,p=f.constraint.range;return p<g?-1:p>g?1:0}),r=t[s-1].constraint;function d(h){return h==="next"?function(f,g){return f.getTime()>g.getTime()}:function(f,g){return g.getTime()>f.getTime()}}return{start:function(h,f){for(var g=f,p=e.array[h],m=1e3,y;m--&&!y&&g;){y=!0;for(var D=0;D<s;D++){var E=t[D].constraint,C=E.val(g),v=E.extent(g),S=p(C,t[D].vals,v);if(!E.isValid(g,S)){g=E[h](g,S),y=!1;break}}}return g!==e.NEVER&&(g=h==="next"?r.start(g):r.end(g)),g},end:function(h,f){for(var g,p=e.array[h+"Invalid"],m=d(h),y=s-1;y>=0;y--){var D=t[y].constraint,E=D.val(f),C=D.extent(f),v=p(E,t[y].vals,C),S;v!==void 0&&(S=D[h](f,v),S&&(!g||m(g,S))&&(g=S))}return g},tick:function(h,f){return new Date(h==="next"?r.end(f).getTime()+e.SEC:r.start(f).getTime()-e.SEC)},tickSafe:function(h,f){return h==="next"?lh(r.end(f),1):lh(r.start(f),-1)},tickStart:function(h){return r.start(h)}}},e.schedule=function(n){if(!n)throw new Error("Missing schedule definition.");if(!n.schedules)throw new Error("Definition must include at least one schedule.");for(var t=[],s=n.schedules.length,r=[],i=n.exceptions?n.exceptions.length:0,a=0;a<s;a++)t.push(e.compile(n.schedules[a]));for(var o=0;o<i;o++)r.push(e.compile(n.exceptions[o]));function l(v,S,b,w,M){var I=E(v),A=S,T=1e6,k=[],Z=[],z,re,be=[],Le=v==="next",Te,Be=Le?0:1,Dt=Le?1:0;if(b=b?new Date(b):new Date,!b||!b.getTime())throw new Error("Invalid start date.");for(u(v,t,k,b),h(v,r,Z,b);T--&&A&&(z=C(k,I))&&!(w&&I(z,w));){if(i&&(f(v,r,Z,z),re=m(v,Z,z))){d(v,t,k,re);continue}if(M){var Dr=y(Z,I);re=D(v,t,k,z,Dr);var bn=Le?[new Date(Math.max(b,z)),re?new Date(w?Math.min(re,w):re):void 0]:[re?new Date(w?Math.max(w,re.getTime()+e.SEC):re.getTime()+e.SEC):void 0,new Date(Math.min(b,z.getTime()+e.SEC))];if(Te&&bn[Be].getTime()===Te[Dt].getTime()?(Te[Dt]=bn[Dt],A++):(Te=bn,be.push(Te)),!re)break;d(v,t,k,re)}else be.push(Le?new Date(Math.max(b,z)):p(t,k,z,w)),g(v,t,k,z);A--}for(var jt=0,Ts=be.length;jt<Ts;jt++){var Os=be[jt];be[jt]=Object.prototype.toString.call(Os)==="[object Array]"?[c(Os[0]),c(Os[1])]:c(Os)}return be.length===0?e.NEVER:S===1?be[0]:be}function c(v){if(v instanceof Date&&!isNaN(v.valueOf()))return new Date(v)}function u(v,S,b,w){for(var M=0,I=S.length;M<I;M++)b[M]=S[M].start(v,w)}function d(v,S,b,w){for(var M=E(v),I=0,A=S.length;I<A;I++)b[I]&&!M(b[I],w)&&(b[I]=S[I].start(v,w))}function h(v,S,b,w){for(var M=E(v),I=0,A=S.length;I<A;I++){var T=S[I].start(v,w);T?b[I]=[T,S[I].end(v,T)]:b[I]=e.NEVER}}function f(v,S,b,w){for(var M=E(v),I=0,A=S.length;I<A;I++)if(b[I]&&!M(b[I][0],w)){var T=S[I].start(v,w);T?b[I]=[T,S[I].end(v,T)]:b[I]=e.NEVER}}function g(v,S,b,w){for(var M=0,I=S.length;M<I;M++)if(b[M]&&b[M].getTime()===w.getTime()){const A=S[M].start(v,S[M].tick(v,w));A!==e.NEVER&&A.getTime()===b[M].getTime()?b[M]=S[M].start(v,S[M].tickSafe(v,w)):b[M]=A}}function p(v,S,b,w){for(var M,I=0,A=S.length;I<A;I++)if(S[I]&&S[I].getTime()===b.getTime()){var T=v[I].tickStart(b);if(w&&T<w)return w;(!M||T>M)&&(M=T)}return M}function m(v,S,b){for(var w=E(v),M,I=0,A=S.length;I<A;I++){var T=S[I];T&&!w(T[0],b)&&(!T[1]||w(T[1],b))&&(!M||w(T[1],M))&&(M=T[1])}return M}function y(v,S){for(var b,w=0,M=v.length;w<M;w++)v[w]&&(!b||S(b,v[w][0]))&&(b=v[w][0]);return b}function D(v,S,b,w,M){for(var I=E(v),A,T=0,k=S.length;T<k;T++){var Z=b[T];if(Z&&Z.getTime()===w.getTime()){var z=S[T].end(v,Z);if(M&&(!z||I(z,M)))return M;(!A||I(z,A))&&(A=z)}}return A}function E(v){return v==="next"?function(S,b){return!b||S.getTime()>b.getTime()}:function(S,b){return!S||b.getTime()>S.getTime()}}function C(v,S){for(var b=v[0],w=1,M=v.length;w<M;w++)v[w]&&S(b,v[w])&&(b=v[w]);return b}return{isValid:function(v){return l("next",1,v,v)!==e.NEVER},next:function(v,S,b){return l("next",v||1,S,b)},prev:function(v,S,b){return l("prev",v||1,S,b)},nextRange:function(v,S,b){return l("next",v||1,S,b,!0)},prevRange:function(v,S,b){return l("prev",v||1,S,b,!0)}}},e.setTimeout=function(n,t){var s=e.schedule(t),r;n&&i();function i(){var a=Date.now(),o=s.next(2,a);if(!o[0]){r=void 0;return}var l=o[0].getTime()-a;l<1e3&&(l=o[1]?o[1].getTime()-a:1e3),l<2147483647?r=setTimeout(n,l):r=setTimeout(i,2147483647)}return{isDone:function(){return!r},clear:function(){clearTimeout(r)}}},e.setInterval=function(n,t){if(!n)return;var s=e.setTimeout(i,t),r=s.isDone();function i(){r||(n(),s=e.setTimeout(i,t))}return{isDone:function(){return s.isDone()},clear:function(){r=!0,s.clear()}}},e.date={},e.date.timezone=function(n){e.date.build=n?function(r,i,a,o,l,c){return new Date(r,i,a,o,l,c)}:function(r,i,a,o,l,c){return new Date(Date.UTC(r,i,a,o,l,c))};var t=n?"get":"getUTC",s=Date.prototype;e.date.getYear=s[t+"FullYear"],e.date.getMonth=s[t+"Month"],e.date.getDate=s[t+"Date"],e.date.getDay=s[t+"Day"],e.date.getHour=s[t+"Hours"],e.date.getMin=s[t+"Minutes"],e.date.getSec=s[t+"Seconds"],e.date.isUTC=!n},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=e.SEC*60,e.HOUR=e.MIN*60,e.DAY=e.HOUR*24,e.WEEK=e.DAY*7,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(n,t,s,r,i,a){return e.date.build(n,t!==void 0?t-1:0,s!==void 0?s:1,r||0,i||0,a||0)},e.date.nextRollover=function(n,t,s,r){var i=s.val(n),a=s.extent(n)[1];return(t||a)<=i||t>a?new Date(r.end(n).getTime()+e.SEC):r.start(n)},e.date.prev=function(n,t,s,r,i,a){var o=arguments.length;return t=o<2?11:t-1,s=o<3?e.D.extent(e.date.next(n,t+1))[1]:s,r=o<4?23:r,i=o<5?59:i,a=o<6?59:a,e.date.build(n,t,s,r,i,a)},e.date.prevRollover=function(n,t,s,r){var i=s.val(n);return t>=i||!t?r.start(r.prev(n,r.val(n)-1)):r.start(n)},e.parse={},e.parse.cron=function(n,t){var s={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},r={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},i={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function a(D,E,C){return isNaN(D)?s[D]||null:Math.min(+D+(E||0),C||9999)}function o(D){var E={},C;for(C in D)C!=="dc"&&C!=="d"&&(E[C]=D[C].slice(0));return E}function l(D,E,C,v,S){var b=C;for(D[E]||(D[E]=[]);b<=v;)D[E].indexOf(b)<0&&D[E].push(b),b+=S||1;D[E].sort(function(w,M){return w-M})}function c(D,E,C,v){(E.d&&!E.dc||E.dc&&E.dc.indexOf(v)<0)&&(D.push(o(E)),E=D[D.length-1]),l(E,"d",C,C),l(E,"dc",v,v)}function u(D,E,C){var v={},S={};C===1?(l(E,"D",1,3),l(E,"d",s.MON,s.FRI),l(v,"D",2,2),l(v,"d",s.TUE,s.FRI),l(S,"D",3,3),l(S,"d",s.TUE,s.FRI)):(l(E,"D",C-1,C+1),l(E,"d",s.MON,s.FRI),l(v,"D",C-1,C-1),l(v,"d",s.MON,s.THU),l(S,"D",C+1,C+1),l(S,"d",s.TUE,s.FRI)),D.exceptions.push(v),D.exceptions.push(S)}function d(D,E,C,v,S,b){var w=D.split("/"),M=+w[1],I=w[0];if(I!=="*"&&I!=="0"){var A=I.split("-");v=a(A[0],b,S),S=a(A[1],b,S)||S}l(E,C,v,S,M)}function h(D,E,C,v,S,b){var w,M,I=E.schedules,A=I[I.length-1];D==="L"&&(D=v-1),(w=a(D,b,S))!==null?l(A,C,w,w):(w=a(D.replace("W",""),b,S))!==null?u(E,A,w):(w=a(D.replace("L",""),b,S))!==null?c(I,A,w,v-1):(M=D.split("#")).length===2?(w=a(M[0],b,S),c(I,A,w,a(M[1]))):d(D,A,C,v,S,b)}function f(D){return D.indexOf("#")>-1||D.indexOf("L")>0}function g(D,E){return f(D)&&!f(E)?1:D-E}function p(D){var E={schedules:[{}],exceptions:[]},C=D.replace(/(\s)+/g," ").split(" "),v,S,b,w;for(v in i)if(S=i[v],b=C[S[0]],b&&b!=="*"&&b!=="?"){w=b.split(",").sort(g);var M,I=w.length;for(M=0;M<I;M++)h(w[M],E,v,S[1],S[2],S[3])}return E}function m(D){var E=D.toUpperCase();return r[E]||E}var y=m(n);return p(t?y:"0 "+y)},e.parse.recur=function(){var n=[],t=[],s,r=n,i,a,o,l,c,u,d,h;function f(g,p,m){if(g=l?g+"_"+l:g,s||(r.push({}),s=r[0]),s[g]||(s[g]=[]),i=s[g],o){for(a=[],d=p;d<=m;d+=o)a.push(d);h={n:g,x:o,c:i.length,m}}a=c?[p]:u?[m]:a;var y=a.length;for(d=0;d<y;d+=1){var D=a[d];i.indexOf(D)<0&&i.push(D)}a=o=l=c=u=0}return{schedules:n,exceptions:t,on:function(){return a=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(g){return o=g||1,this},after:function(g){return l="a",a=[g],this},before:function(g){return l="b",a=[g],this},first:function(){return c=1,this},last:function(){return u=1,this},time:function(){for(var g=0,p=a.length;g<p;g++){var m=a[g].split(":");m.length<3&&m.push(0),a[g]=+m[0]*3600+ +m[1]*60+ +m[2]}return f("t"),this},second:function(){return f("s",0,59),this},minute:function(){return f("m",0,59),this},hour:function(){return f("h",0,23),this},dayOfMonth:function(){return f("D",1,u?0:31),this},dayOfWeek:function(){return f("d",1,7),this},onWeekend:function(){return a=[1,7],this.dayOfWeek()},onWeekday:function(){return a=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return f("dc",1,u?0:5),this},dayOfYear:function(){return f("dy",1,u?0:366),this},weekOfMonth:function(){return f("wm",1,u?0:5),this},weekOfYear:function(){return f("wy",1,u?0:53),this},month:function(){return f("M",1,12),this},year:function(){return f("Y",1970,2450),this},fullDate:function(){for(var g=0,p=a.length;g<p;g++)a[g]=a[g].getTime();return f("fd"),this},customModifier:function(g,p){var m=e.modifier[g];if(!m)throw new Error("Custom modifier "+g+" not recognized!");return l=g,a=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(g){var p=e[g];if(!p)throw new Error("Custom time period "+g+" not recognized!");return f(g,p.extent(new Date)[0],p.extent(new Date)[1]),this},startingOn:function(g){return this.between(g,h.m)},between:function(g,p){return s[h.n]=s[h.n].splice(0,h.c),o=h.x,f(h.n,g,p),this},and:function(){return s=r[r.push({})-1],this},except:function(){return r=t,s=null,this}}},e.parse.text=function(n){var t=e.parse.recur,s=0,r="",i,a={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},o={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(v,S,b,w){return{startPos:v,endPos:S,text:b,type:w}}function c(v){var S=v instanceof Array?v:[v],b=/\s+/,w,M,I,A,T,k;for(S.push(b),T=s;!w||w.type===b;){k=-1,M=r.substring(T),w=l(T,T,r.split(b)[0]);var Z,z=S.length;for(Z=0;Z<z;Z++)A=S[Z],I=A.exec(M),I&&I.index===0&&I[0].length>k&&(k=I[0].length,w=l(T,T+k,M.substring(0,k),A));w.type===b&&(T=w.endPos)}return w}function u(v){var S=c(v);return s=S.endPos,S}function d(v){for(var S=+E(v),b=y(a.through)?+E(v):S,w=[],M=S;M<=b;M++)w.push(M);return w}function h(v){for(var S=d(v);y(a.and);)S=S.concat(d(v));return S}function f(v){var S,b,w,M;y(a.weekend)?v.on(o.sun,o.sat).dayOfWeek():y(a.weekday)?v.on(o.mon,o.tue,o.wed,o.thu,o.fri).dayOfWeek():(S=E(a.rank),v.every(S),b=m(v),y(a.start)?(S=E(a.rank),v.startingOn(S),D(b.type)):y(a.between)&&(w=E(a.rank),y(a.and)&&(M=E(a.rank),v.between(w,M))))}function g(v){y(a.first)?v.first():y(a.last)?v.last():v.on(h(a.rank)),m(v)}function p(v){s=0,r=v,i=-1;for(var S=t();s<r.length&&i<0;){var b=D([a.every,a.after,a.before,a.onthe,a.on,a.of,a.in,a.at,a.and,a.except,a.also]);switch(b.type){case a.every:f(S);break;case a.after:c(a.time).type!==void 0?(S.after(E(a.time)),S.time()):c(a.fullDate).type!==void 0?(S.after(E(a.fullDate)),S.fullDate()):(S.after(E(a.rank)),m(S));break;case a.before:c(a.time).type!==void 0?(S.before(E(a.time)),S.time()):c(a.fullDate).type!==void 0?(S.before(E(a.fullDate)),S.fullDate()):(S.before(E(a.rank)),m(S));break;case a.onthe:g(S);break;case a.on:S.on(h(a.dayName)).dayOfWeek();break;case a.of:S.on(h(a.monthName)).month();break;case a.in:S.on(h(a.yearIndex)).year();break;case a.at:for(S.on(E(a.time)).time();y(a.and);)S.on(E(a.time)).time();break;case a.and:break;case a.also:S.and();break;case a.except:S.except();break;default:i=s}}return{schedules:S.schedules,exceptions:S.exceptions,error:i}}function m(v){var S=D([a.second,a.minute,a.hour,a.dayOfYear,a.dayOfWeek,a.dayInstance,a.day,a.month,a.year,a.weekOfMonth,a.weekOfYear]);switch(S.type){case a.second:v.second();break;case a.minute:v.minute();break;case a.hour:v.hour();break;case a.dayOfYear:v.dayOfYear();break;case a.dayOfWeek:v.dayOfWeek();break;case a.dayInstance:v.dayOfWeekCount();break;case a.day:v.dayOfMonth();break;case a.weekOfMonth:v.weekOfMonth();break;case a.weekOfYear:v.weekOfYear();break;case a.month:v.month();break;case a.year:v.year();break;default:i=s}return S}function y(v){var S=c(v).type===v;return S&&u(v),S}function D(v){var S=u(v);return S.type?S.text=C(S.text,v):i=s,S}function E(v){return D(v).text}function C(v,S){var b=v;switch(S){case a.time:var w=v.split(/(:|am|pm)/),M=w[3]==="pm"&&w[0]<12?parseInt(w[0],10)+12:w[0],I=w[2].trim();b=(M.length===1?"0":"")+M+":"+I;break;case a.rank:b=parseInt(/^\d+/.exec(v)[0],10);break;case a.monthName:case a.dayName:b=o[v.substring(0,3)];break;case a.fullDate:b=new Date(v.toUpperCase());break}return b}return p(n.toLowerCase())},e}();Ao.date.localTime();var Ye=Ao,Qn=class extends O([cn],e=>{const n=e.prototype;class t extends e{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(this.priorityField!=null)return this.priorityField;let r=1e4+this.getCalendar().getDepth()*100,i=this.priority;return i==null&&(i=this.isRecurrent()?20:30),this.priorityField=r+i}isRecurrent(){return!!(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return!!(this.startDate&&this.endDate)}parseDateSchedule(r){let i=r;if(r&&r!==Object(r)&&(i=Ye.parse.text(r),i!==Object(i)||i.error>=0))try{i=JSON.parse(r)}catch(a){return null}return i}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const r=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=Ye.schedule(r)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if(this.recurrentEndDate==="EOD")return"EOD";const r=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=Ye.schedule(r)}}return t}){},$o=class extends O([mt],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:Qn}}}return t}){},At;(function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"})(At||(At={}));var Ve;(function(e){e[e.FullRangeIterated=0]="FullRangeIterated",e[e.StoppedByIterator=1]="StoppedByIterator",e[e.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",e[e.MaxRangeReached=3]="MaxRangeReached"})(Ve||(Ve={}));var _o=class{constructor(e){this.cacheFilledStartDate=ae,this.cacheFilledEndDate=he,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=V.Day,this.maxCacheExtendCycles=1e3,this.maxRange=5*365*24*60*60*1e3,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,n,t){e.ensureCacheFilledForInterval(n,t),this.intervalCache.includeWrappingRange(e.intervalCache,n,t)}ensureCacheFilledForInterval(e,n){const t=this.cacheFilledStartDate.getTime(),s=this.cacheFilledEndDate.getTime();if(t!==ae.getTime()){const r=e.getTime(),i=n.getTime();if(t<=r&&i<=s)return;if(i<=t)n=new Date(t-1);else if(r>=s)e=new Date(s);else if(t<=r&&r<=s)e=new Date(s+1);else if(t<=i&&i<=s)n=new Date(t-1);else{this.ensureCacheFilledForInterval(e,new Date(t-1)),this.ensureCacheFilledForInterval(new Date(s+1),n);return}}(t===ae.getTime()||e.getTime()<s)&&(this.cacheFilledStartDate=e),(s===he.getTime()||s<n.getTime())&&(this.cacheFilledEndDate=n),this.fillCache(e,n)}fillCache(e,n){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=ae,this.cacheFilledEndDate=he,this.intervalCache.clear()}forEachAvailabilityInterval(e,n,t){var s;t=t||this;const r=e.startDate,i=e.endDate,a=r&&r.getTime(),o=i&&i.getTime(),l=(s=e.maxRange)!=null?s:this.maxRange,c=e.isForward!==!1;if(c?!r:!i)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const u=this.intervalCache;let d=c?r:i,h=c?r:i;const f=h.getTime();for(let g=1;g<this.maxCacheExtendCycles;g++){c?this.ensureCacheFilledForInterval(d,i||R.add(d,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(r||R.add(d,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),d);let p=u.getIntervalOf(h,c?At.Left:At.Right);for(;p;){const m=p.startDate,y=p.endDate;if(c&&o&&m.getTime()>=o||!c&&a&&y.getTime()<=a)return Ve.FullRangeIterated;if(c&&m.getTime()-f>=l||!c&&f-y.getTime()>=l)return Ve.MaxRangeReached;if(c&&m.getTime()>=this.cacheFilledEndDate.getTime()||!c&&y.getTime()<=this.cacheFilledStartDate.getTime())break;h=c?y:m;const D=a&&m.getTime()<a?r:m,E=o&&y.getTime()>o?i:y;if(n.call(t,D,E,p.cacheInterval)===!1)return Ve.StoppedByIterator;p=c?u.getNextInterval(p):u.getPrevInterval(p)}if(c&&h.getTime()===ae.getTime()||!c&&h.getTime()===he.getTime())return Ve.FullRangeIterated;d=c?this.cacheFilledEndDate:this.cacheFilledStartDate}return Ve.MaxCacheExtendCyclesReached}},dn=e=>Array.from(new Set(e)),di=class{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(this.intervals.indexOf(e)==-1){const n=this.intervals.slice();return n.push(e),new di({intervals:n,calendar:this.calendar})}else return this}combineWith(e){return new di({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(this.isWorking!=null)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const n=dn(e);return n.sort((t,s)=>s.getPriorityField()-t.getPriorityField()),n}},Zn=(e,n,t=(s,r)=>s-r)=>{let s=0,r=n.length;for(;s<r;){const i=(s+r)/2|0,a=t(e,n[i]);if(a===0)return{found:!0,index:i};a<0?r=i:s=i+1}return{found:!1,index:r}},Fr;(function(e){e[e.Exact=0]="Exact",e[e.Next=1]="Next"})(Fr||(Fr={}));var ch=class{constructor(e){this.keys=[],this.values=[],this.comparator=e||((n,t)=>n-t)}set(e,n){const t=Zn(e,this.keys,this.comparator);return t.found?this.values[t.index]=n:(this.keys.splice(t.index,0,e),this.values.splice(t.index,0,n)),t.index}insertAt(e,n,t){this.keys.splice(e,0,n),this.values.splice(e,0,t)}setValueAt(e,n){this.values[e]=n}get(e){const n=Zn(e,this.keys,this.comparator);return n.found?this.values[n.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const n=Zn(e,this.keys,this.comparator);n.found&&this.deleteAt(n.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const n=Zn(e,this.keys,this.comparator);return{found:n.found?Fr.Exact:Fr.Next,index:n.index}}map(e){const n=this.keys,t=this.values,s=[];for(let r=0;r<n.length;r++)s.push(e(t[r],n[r],r));return s}getAllEntries(){return this.map((e,n)=>({value:e,key:n}))}clear(){this.keys.length=0,this.values.length=0}},Fo=class{constructor(e){if(this.points=new ch((n,t)=>n.getTime()-t.getTime()),this.leftInfinityKey=he,this.rightInfinityKey=ae,Object.assign(this,e),this.emptyInterval===void 0||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,n=At.Left){let{found:t,index:s}=this.indexOf(e),r;return n===At.Left?r=t===Fr.Exact?s:s-1:r=s-1,this.getIntervalWithStartDateIndex(r)}getPrevInterval(e){return e.startDateIndex===0?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,n,t){const s=this.points,{found:r,index:i}=s.indexOfKey(e);let a,o;if(r==Fr.Exact){const l=t(o=s.getValueAt(i));s.setValueAt(i,l),a=i+1}else{const l=t(o=s.getValueAt(i-1));s.insertAt(i,e,l),a=i+1}for(;a<s.size()&&!(s.getKeyAt(a).getTime()>=n.getTime());){const c=t(o=s.getValueAt(a));s.setValueAt(a,c),a++}a===s.size()?s.insertAt(s.size(),n,this.emptyInterval):s.getKeyAt(a).getTime()===n.getTime()||s.insertAt(a,n,o)}includeWrappingRange(e,n,t){let s=e.getIntervalOf(n);for(;s&&(this.addInterval(s.startDate,s.endDate,r=>this.combineIntervalsFn(r,s.cacheInterval)),!(s.endDate.getTime()>t.getTime()));)s=e.getNextInterval(s)}getSummary(){return this.points.map((e,n)=>({label:e,date:n}))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}},nv=class extends Array{constructor(e,n){super(),this.timeZone=e,this.year=n}},sv=class{constructor(e,n){this.asString=e,this.timeZone=n,this.asArray=av(e)}get asLocalDate(){return this._asLocalDate||(this._asLocalDate=new Date(...this.asArray)),this._asLocalDate}get asTicksUtc(){return this._asTicksUtc||(this._asTicksUtc=new Date(Date.UTC(...this.asArray)).getTime()),this._asTicksUtc}},uh=(e,n)=>{const t=e.toLocaleString("sv-SE",{timeZone:n});return new sv(t,n)},iv=(e,n)=>{const{asTicksUtc:t,asString:s}=uh(new Date(e),n);return{offset:(e-t)/6e4,tzTicksUtc:t,tzString:s}},av=e=>{const n=e.split(/[\s-:]/).map(t=>t*1);return n[1]-=1,n},ov=-6e4,lv=36e5,dh=-864e5,Xn=2592e6,hh=(e,n)=>{const t=fh.get(e,n);if(t)return t;const s=new nv(e,n),r=new Date(Date.UTC(n,0,1)).getTime();let i=r,a=Xn,o=0,l=[],c=null,u,d,h,f;for(;!f;)({offset:h,tzTicksUtc:u,tzString:d}=iv(i,e)),c==null?(c=h,s.push({offset:h})):a>0&&h!==c?a=a===Xn?dh:ov:a<0&&h===c&&(a===dh?a=lv:(s.length===1?(s.push(l),c=l.offset):(s[0].startTicks=l.startTicks,s[0].startDateString=l.startDateString,f=!0),a=Xn)),l={offset:h,startDateString:d,startTicks:u},a===Xn&&(i=r,i+=o*Xn,o+=1),i+=a,o>11&&(f=!0);return fh.set(s),s},fh={_cache:{},get(e,n){var t;return(t=this._cache[e])==null?void 0:t[n]},set(e){const{timeZone:n}=e,{_cache:t}=this;t[n]||(t[n]={}),t[n][e.year]=e}},vt=class{static get $name(){return"TimeZoneHelper"}static toTimeZone(e,n){if(typeof n=="number")return this.toUtcOffset(e,n);const t=uh(e,n);return t.asArray[3]!==t.asLocalDate.getHours()&&console.warn("Incorrect time zone conversion due to local DST-switch detected"),t.asLocalDate}static fromTimeZone(e,n){if(typeof n=="number")return this.fromUtcOffset(e,n);const t=this.dateAsArray(e),s=hh(n,e.getUTCFullYear());let r=s[0].offset;if(s.length===2){const i=Date.UTC(...t);i>=s[1].startTicks&&i<s[0].startTicks&&(r=s[1].offset)}return t[4]+=r,new Date(Date.UTC(...t))}static toUtcOffset(e,n){const t=e.getTimezoneOffset()+n;return new Date(e.getTime()+t*60*1e3)}static fromUtcOffset(e,n){const t=-e.getTimezoneOffset()-n;return new Date(e.getTime()+t*60*1e3)}static dateAsArray(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}};vt.findOffsetDates=hh,vt._$name="TimeZoneHelper";var gh=class extends _o{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new Fo({emptyInterval:new di({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(n,t)=>n.combineWith(t)})}fillCache(e,n){var t;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,n);const s=e.getTime(),r=n.getTime(),i=this.calendar.ignoreTimeZone?null:(t=this.calendar.project)==null?void 0:t.timeZone;if(s>r)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval(a=>{const o=a.getStartDateSchedule(),l=a.getEndDateSchedule();let c=o.prev(1,e),u;if(l==="EOD"){const f=o.next(1,n);f!==Ye.NEVER?u=R.getStartOfNextDay(f,!0):u=Ye.NEVER}else u=l.next(1,n);if(c!==Ye.NEVER&&c.getTime()===s){const f=o.prev(2,e);f!==Ye.NEVER&&f.length===2&&(c=f[1])}if(u!==Ye.NEVER&&u.getTime()===r){const f=l.next(2,n);f!==Ye.NEVER&&f.length===2&&(u=f[1])}const d=o.next(1/0,c!==Ye.NEVER?c:e,u!==Ye.NEVER?new Date(u.getTime()-1):n);if(d===Ye.NEVER)return;const h=l==="EOD"?d.map(f=>R.getStartOfNextDay(f,!0)):l.next(1/0,new Date(d[0].getTime()+1),u!==Ye.NEVER?u:n);h!==Ye.NEVER&&(h.length>d.length?h.length=d.length:h.length<d.length&&(d.length=h.length),d.forEach((f,g)=>{let p=f,m=h[g];i!=null&&(p=vt.toTimeZone(p,i),m=vt.toTimeZone(m,i)),this.intervalCache.addInterval(p,m,y=>y.includeInterval(a))}))})}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval(e=>{var n;const t=(n=this.calendar.project)==null?void 0:n.timeZone;let{startDate:s,endDate:r}=e;t!=null&&(s=vt.toTimeZone(s,t),r=vt.toTimeZone(r,t)),this.intervalCache.addInterval(s,r,i=>i.includeInterval(e))})}forEachStaticInterval(e){this.intervalStore.forEach(n=>{n.isStatic()&&e(n)})}forEachRecurrentInterval(e){this.intervalStore.forEach(n=>{n.isRecurrent()&&e(n)})}},ph=class extends O([Qn],e=>{const n=e.prototype;class t extends e{getCalendar(){return this.calendar}getPriorityField(){return this.priorityField!=null?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}return t}){},jo=class extends O([cn],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls"]}get intervalStoreClass(){return $o}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(r){r.storeClass=this.intervalStoreClass,r.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,r.calendar=this}processIntervalsStoreData(r){this.bumpVersion()}isDefault(){const r=this.getProject();return r?this===r.defaultCalendar:!1}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(r,i,a){var o;const l=(o=this.getProject())==null?void 0:o.maxCalendarRange;return l&&(r=Object.assign({maxRange:l},r)),this.calendarCache.forEachAvailabilityInterval(r,i,a)}accumulateWorkingTime(r,i,a){var o,l;if(i===0)return{finalDate:new Date(r),remainingDurationInMs:0};if(isNaN(i))throw new Error("Invalid duration");let c=r;const u=(l=(o=this.getProject())==null?void 0:o.adjustDurationToDST)!=null?l:!1;return this.forEachAvailabilityInterval(a?{startDate:r,isForward:!0}:{endDate:r,isForward:!1},(d,h,f)=>{let g=!0;if(f.getIsWorking()){let p=h.getTime()-d.getTime();if(i<=p){if(u){const m=a?d.getTimezoneOffset()-new Date(d.getTime()+i).getTimezoneOffset():new Date(h.getTime()-i).getTimezoneOffset()-h.getTimezoneOffset();i-=m*60*1e3}c=a?new Date(d.getTime()+i):new Date(h.getTime()-i),i=0,g=!1}else{if(u){const m=d.getTimezoneOffset()-h.getTimezoneOffset();p+=m*60*1e3}c=a?h:d,i-=p}}return g}),{finalDate:new Date(c),remainingDurationInMs:i}}calculateDurationMs(r,i,a=!1){let o=0;const l=r.getTime()<=i.getTime()||!a?1:-1;l<0&&([r,i]=[i,r]);const c=this.getProject().adjustDurationToDST;return this.forEachAvailabilityInterval({startDate:r,endDate:i},(u,d,h)=>{if(h.getIsWorking()&&(o+=d.getTime()-u.getTime(),c)){const f=u.getTimezoneOffset()-d.getTimezoneOffset();o+=f*60*1e3}}),o*l}calculateEndDate(r,i){const a=i>=0,o=this.accumulateWorkingTime(r,Math.abs(i),a);return o.remainingDurationInMs===0?o.finalDate:null}calculateStartDate(r,i){const a=i<=0,o=this.accumulateWorkingTime(r,Math.abs(i),a);return o.remainingDurationInMs===0?o.finalDate:null}skipNonWorkingTime(r,i=!0){let a;const o=this.forEachAvailabilityInterval(i?{startDate:r,isForward:!0}:{endDate:r,isForward:!1},(l,c,u)=>{if(u.getIsWorking())return a=i?l:c,!1});return o===Ve.MaxRangeReached||o===Ve.FullRangeIterated?"empty_calendar":a?new Date(a):new Date(r)}addInterval(r){return this.addIntervals([r])}addIntervals(r){return this.bumpVersion(),this.intervalStore.add(r)}removeInterval(r){return this.removeIntervals([r])}removeIntervals(r){return this.bumpVersion(),this.intervalStore.remove(r)}clearIntervals(r){return r||this.bumpVersion(),this.intervalStore.removeAll(r)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(this.$calendarCache!==void 0)return this.$calendarCache;const r=new ph({isWorking:this.unspecifiedTimeIsWorking});return r.calendar=this,this.$calendarCache=new gh({calendar:this,unspecifiedTimeInterval:r,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse(r=>{r.intervalStore.forEach(i=>i.resetPriority())})}insertChild(r,i,a){let o=n.insertChild.call(this,...arguments);return Array.isArray(o)||(o=[o]),o.forEach(l=>{l.bumpVersion(),l.resetPriorityOfAllIntervals()}),o}joinProject(){n.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){n.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(r){const i=R.clearTime(r),a=R.getNext(r,V.Day);let o=!1;return this.forEachAvailabilityInterval({startDate:i,endDate:a,isForward:!0},(l,c,u)=>(o=u.getIsWorking(),!o)),!o}getDailyHolidaysRanges(r,i){const a=[];for(r=R.clearTime(r);r<i;)this.isDayHoliday(r)&&a.push({startDate:r,endDate:R.getStartOfNextDay(r,!0,!0)}),r=R.getNext(r,V.Day);return a}getWorkingTimeRanges(r,i){const a=[];return this.forEachAvailabilityInterval({startDate:r,endDate:i,isForward:!0},(o,l,c)=>{if(c.getIsWorking()){const u=c.intervals[0];a.push({name:u.name,startDate:o,endDate:l})}}),a}getNonWorkingTimeRanges(r,i){const a=[];return this.forEachAvailabilityInterval({startDate:r,endDate:i,isForward:!0},(o,l,c)=>{if(!c.getIsWorking()){const u=c.intervals[0];a.push({name:u.name,iconCls:u.iconCls,cls:u.cls,startDate:o,endDate:l})}}),a}isWorkingTime(r,i,a){if(a){let o;const l=this.forEachAvailabilityInterval({startDate:r,endDate:i,isForward:!0},(c,u,d)=>{if(d.getIsWorking()&&c<=r&&u>=i)return o=!0,!1});return l===Ve.MaxRangeReached||l===Ve.FullRangeIterated?!1:o}else{const o=this.skipNonWorkingTime(r);return o&&o!=="empty_calendar"?i?o<i:o.getTime()===r.getTime():!1}}}return t}){},es=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},ko=Symbol("EmptyCalendarSymbol"),hn=class extends O([jo,un],e=>{class n extends e{constructor(){super(...arguments),this.version=1}leaveProject(){this.project.clearCombinationsWith(this),super.leaveProject()}}return es([B({},{persistent:!1})],n.prototype,"version",void 0),es([B({type:"boolean",defaultValue:!0})],n.prototype,"unspecifiedTimeIsWorking",void 0),es([B()],n.prototype,"intervals",void 0),n}){},mh=class extends gt($){static get $name(){return"EmptyCalendarEffectDescription"}static getDescription(e){const n=e.getCalendar();return pt(this.L("L{descriptionTpl}"),n.name||n.id)}},ts=class extends Un{constructor(){super(...arguments),this.handler=ko}getResolutions(){const e=this.getCalendar();return this._resolutions||(this._resolutions=[vh.new({calendar:e}),yh.new({calendar:e})])}getCalendar(){const{calendars:e}=this;if((e==null?void 0:e.length)>1){for(const n of e)if(!(n.skipNonWorkingTime(this.date,this.isForward)instanceof Date))return n}return e[0]}};es([G("emptyCalendar")],ts.prototype,"type",void 0),es([G(mh)],ts.prototype,"_descriptionBuilderClass",void 0);var Lo=class extends gt(Vn){static get $name(){return"BaseEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{intervals:[{isWorking:!0}]}}}getDescription(){const{calendar:e}=this;return pt(this.L("L{descriptionTpl}"),e.name||e.id)}fixCalendarData(e){var n;e.clearIntervals(!0),Object.assign(e,this.calendarData),(n=e.intervals)!=null&&n.length&&e.addIntervals(e.intervals)}resolve(){const{calendar:e}=this;this.fixCalendarData(e)}},vh=class extends Lo{static get $name(){return"Use24hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"on Mon at 0:00",recurrentEndDate:"on Sat at 0:00",isWorking:!0}]}}}},yh=class extends Lo{static get $name(){return"Use8hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"every weekday at 08:00",recurrentEndDate:"every weekday at 12:00",isWorking:!0},{recurrentStartDate:"every weekday at 13:00",recurrentEndDate:"every weekday at 17:00",isWorking:!0}]}}}},Sh=class extends qa{collectInfo(e,n,t){e(js(n))!=null&&this.addPreviousValueFlag(t),e(jc(n))&&this.addProposedValueFlag(t)}},Ke;(function(e){e.KeepDuration="KeepDuration",e.KeepStartDate="KeepStartDate",e.KeepEndDate="KeepEndDate"})(Ke||(Ke={}));var J=Symbol("StartDate"),Q=Symbol("EndDate"),te=Symbol("Duration"),Je=fe.new({output:J,inputs:new Set([te,Q])}),Qe=fe.new({output:Q,inputs:new Set([te,J])}),Ze=fe.new({output:te,inputs:new Set([J,Q])}),Bo=Xt.new({variables:new Set([J,Q,te]),formulas:new Set([Je,Qe,Ze])}),Dh=Fe.new({description:Bo,defaultResolutionFormulas:new Set([Qe])}),Ch=Fe.new({description:Bo,defaultResolutionFormulas:new Set([Je])}),No=class extends Sh{addInstruction(e){e===Ke.KeepStartDate&&this.addKeepIfPossibleFlag(J),e===Ke.KeepEndDate&&this.addKeepIfPossibleFlag(Q),e===Ke.KeepDuration&&this.addKeepIfPossibleFlag(te)}},Vo=class extends ut.mix(Mt){equality(e,n){const t=e.resolution,s=n.resolution;return t.get(J)===s.get(J)&&t.get(Q)===s.get(Q)&&t.get(te)===s.get(te)||t.get(J)===Ne&&t.get(Q)===Ne&&t.get(te)===Ne}},Uo=class{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const n=this.intervalGroups.slice();return n.push([e.calendar,e]),new Uo({intervalGroups:n})}getIsWorkingForEvery(){if(this.isWorkingForEvery!=null)return this.isWorkingForEvery;for(let[e,n]of this.getGroups())if(!n[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(this.isWorkingForSome!=null)return this.isWorkingForSome;for(let[e,n]of this.getGroups())if(n[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[n,t]of this.getGroups())e.set(n,t[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[n,t]of this.getGroups())t[0].isWorking&&e.push(n);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[n,t]of this.getGroups())t[0].isWorking||e.push(n);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const e=this.calendars=[],n=new Map;return this.intervalGroups.forEach(([t,s])=>{let r=n.get(t);r||(e.push(t),r=[],n.set(t,r)),r.push.apply(r,s.intervals)}),n.forEach((t,s)=>{const r=dn(t);r.sort((i,a)=>a.getPriorityField()-i.getPriorityField()),n.set(s,r)}),this.intervalsByCalendar=n}},Wo=class extends _o{constructor(e){super(e),this.calendarCaches=dn(this.calendarCaches),this.intervalCache=new Fo({emptyInterval:new Uo,combineIntervalsFn:(n,t)=>n.combineWith(t)})}fillCache(e,n){this.calendarCaches.forEach(t=>{t.fillCache(e,n),this.includeWrappingRangeFrom(t,e,n)})}},cv=new Map,uv=e=>{const n=dn(e);if(n.length===0)throw new Error("No calendars to combine");n.sort((a,o)=>a.internalId<o.internalId?-1:1);const t=n.map(a=>a.internalId+"/").join(""),s=n.map(a=>a.version+"/").join("");let r=cv.get(t),i;return r&&r.versionsHash===s?i=r.cache:i=new Wo({calendarCaches:n.map(a=>a.calendarCache)}),i},hi=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},fi=class extends O([un],e=>{class n extends e{writeCalendar(s,r,i,a){const o=this.getCalendarManagerStore(),l=a;a&&o&&a instanceof hn&&!o.includes(l)&&o.add(a),s.constructor.prototype.write.call(this,s,r,i,a)}resolveCalendar(s){var r;return(r=this.getCalendarManagerStore())==null?void 0:r.getById(s)}*calculateEffectiveCalendar(){let s=yield this.$.calendar;return s||(s=yield this.getProject().$.effectiveCalendar),yield s.$.version,s}shouldRecordFieldChange(s,r,i){if(!super.shouldRecordFieldChange(s,r,i))return!1;const{project:a}=this;if(s==="calendar"&&a){const{calendarManagerStore:o}=a;return o.oldIdMap[r]!==o.getById(i)}return!0}}return hi([q({equality:()=>!1})],n.prototype,"effectiveCalendar",void 0),hi([qe({modelFieldConfig:{persist:!0,serialize:t=>t===void 0?void 0:(t==null?void 0:t.id)||null,isEqual:ar},resolver:function(t){return this.resolveCalendar(t)},sync:!0},Tr)],n.prototype,"calendar",void 0),hi([dt("calendar")],n.prototype,"writeCalendar",null),hi([j("effectiveCalendar")],n.prototype,"calculateEffectiveCalendar",null),ri(n),n}){},Eh=class extends O([],e=>{class n extends e{constructor(){super(...arguments),this.combinedCalendarsCache=new Map,this.combinationsByCalendar=new Map}combineCalendars(s){const r=dn(s);if(r.length===0)throw new Error("No calendars to combine");r.sort((c,u)=>c.internalId<u.internalId?-1:1);const i=r.map(c=>c.internalId+"/").join(""),a=r.map(c=>c.version+"/").join(""),o=this.combinedCalendarsCache.get(i);let l;return o&&o.versionsHash===a?l=o.cache:(l=new Wo({calendarCaches:r.map(c=>c.calendarCache)}),this.combinedCalendarsCache.set(i,{versionsHash:a,cache:l}),r.forEach(c=>{let u=this.combinationsByCalendar.get(c);u||(u=new Set,this.combinationsByCalendar.set(c,u)),u.add(i)})),l}clearCombinationsWith(s){const r=this.combinationsByCalendar.get(s);r&&(r.forEach(i=>this.combinedCalendarsCache.delete(i)),this.combinationsByCalendar.delete(s))}}return n}){},ge=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},or=class extends O([fi],e=>{const n=e.prototype;class t extends e{*calculateDispatcher(r){const i=yield X,a=yield*this.prepareDispatcher(r),o=yield Er(this.$.startDate),l=o?o[0]?Ke.KeepDuration:Ke.KeepEndDate:void 0;l&&a.addInstruction(l);const c=yield Er(this.$.endDate),u=c?c[0]?Ke.KeepDuration:Ke.KeepStartDate:void 0;u&&a.addInstruction(u);const d=yield this.$.effectiveDirection,h=yield Er(this.$.duration);let f;if(h)switch(h[0]){case!0:f=Ke.KeepStartDate;break;case!1:f=Ke.KeepEndDate;break}return!f&&a.hasProposedValue(te)&&(f=d.direction===L.Forward||d.direction===L.None?Ke.KeepStartDate:Ke.KeepEndDate),f&&a.addInstruction(f),a}*prepareDispatcher(r){const a=this.dispatcherClass(r).new({context:this.cycleResolutionContext(r)});return a.collectInfo(r,this.$.startDate,J),a.collectInfo(r,this.$.endDate,Q),a.collectInfo(r,this.$.duration,te),a}cycleResolutionContext(r){const i=r(this.$.effectiveDirection);return i.direction===L.Forward||i.direction===L.None?Dh:Ch}dispatcherClass(r){return No}buildProposedDispatcher(r,i,a){const o=this.dispatcherClass(a.onEffectSync).new({context:this.cycleResolutionContext(a.onEffectSync)});return o.addPreviousValueFlag(J),o.addPreviousValueFlag(Q),o.addPreviousValueFlag(te),o}*skipNonWorkingTime(r,i){const a=yield this.$.effectiveCalendar;if(!r)return null;const o=a.skipNonWorkingTime(r,i);if(o instanceof Date)return o;{const l=ts.new({calendars:[a],event:this,date:r,isForward:i});if((yield l)===bt.Cancel)yield kt(l);else return null}}*skipWorkingTime(r,i,a,o){const l=yield this.$.durationUnit;return o&&o!==l&&(a=yield*this.getProject().$convertDuration(a,o,l)),yield*this.calculateProjectedXDateWithDuration(r,i,a)}setStartDate(r,i=!0){const{graph:a,project:o}=this;return a?(a.write(this.$.startDate,r,i),a.commitAsync()):(this.$.startDate.DATA=r,o==null?void 0:o.delayedCalculationPromise)}writeStartDate(r,i,a,o,l=!0){!i.baseRevision.hasIdentifier(r)&&o==null||(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,i,void 0,o==null),r.constructor.prototype.write.call(this,r,i,a,o,l))}*calculateStartDate(){const i=(yield this.$.dispatcher).resolution.get(J);if(i===Ne)return yield*this.calculateStartDateProposed();if(i===Je.formulaId)return yield*this.calculateStartDatePure();throw new Error("Unknown formula for `startDate`")}*calculateStartDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.endDate,!1,yield this.$.duration)}*calculateStartDateProposed(){const r=this.getProject(),i=yield X;return!(yield this.$.manuallyScheduled)||r.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(i,!0):i}*calculateProjectedXDateWithDuration(r,i,a){const o=yield this.$.durationUnit,l=yield this.$.effectiveCalendar,c=this.getProject();return!r||gd(a)?null:(i=i===void 0?!0:i,i?l.calculateEndDate(r,yield*c.$convertDuration(a,o,V.Millisecond)):l.calculateStartDate(r,yield*c.$convertDuration(a,o,V.Millisecond)))}setEndDate(r,i=!1){const{graph:a,project:o}=this;return a?(a.write(this.$.endDate,r,i),a.commitAsync()):(this.$.endDate.DATA=r,o==null?void 0:o.delayedCalculationPromise)}writeEndDate(r,i,a,o,l=!1){!i.baseRevision.hasIdentifier(r)&&o==null||(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,i,void 0,o==null),r.constructor.prototype.write.call(this,r,i,a,o,l))}*calculateEndDate(){const i=(yield this.$.dispatcher).resolution.get(Q);if(i===Ne)return yield*this.calculateEndDateProposed();if(i===Qe.formulaId)return yield*this.calculateEndDatePure();throw new Error("Unknown formula for `endDate`")}*calculateEndDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.startDate,!0,yield this.$.duration)}*calculateEndDateProposed(){const r=this.getProject(),i=yield X;return!(yield this.$.manuallyScheduled)||r.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(i,!1):i}getDuration(r){const i=this.duration;return r!==void 0?this.getProject().convertDuration(i,this.durationUnit,r):i}setDuration(r,i,a){const{graph:o,project:l}=this;if(o){if(r!==void 0)return o.write(this.$.duration,r,i,a),o.commitAsync()}else{const c={duration:r};return this.$.duration.DATA=r,i!=null&&(c.durationUnit=this.$.durationUnit.DATA=i),this.set(c),l==null?void 0:l.delayedCalculationPromise}}setDurationUnit(r){throw new Error("Use `setDuration` instead")}writeDuration(r,i,a,o,l,c=void 0){o<0&&(o=0),!(!i.baseRevision.hasIdentifier(r)&&o==null)&&(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,i,void 0,o==null),r.constructor.prototype.write.call(this,r,i,a,o,c),l!=null&&i.write(this.$.durationUnit,l))}*calculateDuration(){const i=(yield this.$.dispatcher).resolution.get(te);if(i===Ne)return yield*this.calculateDurationProposed();if(i===Ze.formulaId)return yield*this.calculateDurationPure();throw new Error("Unknown formula for `duration`")}*calculateDurationPure(){const r=yield this.$.startDate,i=yield this.$.endDate;if(!r||!i)return null;if(r>i)yield xc(this.$.duration,0,null);else return yield*this.calculateProjectedDuration(r,i)}*calculateDurationProposed(){return yield X}*calculateProjectedDuration(r,i,a){if(!r||!i)return null;a||(a=yield this.$.durationUnit);const o=yield this.$.effectiveCalendar;return yield*this.getProject().$convertDuration(o.calculateDurationMs(r,i),V.Millisecond,a)}*calculateEffectiveDuration(){const r=yield this.$.dispatcher;let i;const a=r.resolution.get(te);return a===Ne?i=yield this.$.duration:a===Ze.formulaId&&(i=yield*this.calculateProjectedDuration(yield pe(this.$.startDate),yield pe(this.$.endDate))),i}*calculateEffectiveDirection(){return{kind:"own",direction:(yield this.$.direction)||L.Forward}}*calculateStartDateDirection(){return yield this.$.effectiveDirection}*calculateEndDateDirection(){return yield this.$.effectiveDirection}*calculateEffectiveCalendar(){const r=yield this.$.manuallyScheduled,i=this.getProject();return r&&!i.skipNonWorkingTimeInDurationWhenSchedulingManually?i.defaultCalendar:yield*super.calculateEffectiveCalendar()}}return ge([B({type:"date"},{converter:zt})],t.prototype,"startDate",void 0),ge([B({type:"date"},{converter:zt})],t.prototype,"endDate",void 0),ge([B({type:"number",allowNull:!0})],t.prototype,"duration",void 0),ge([B({type:"string",defaultValue:V.Day},{converter:s=>R.normalizeUnit(s)||V.Day})],t.prototype,"durationUnit",void 0),ge([B({type:"string"},{sync:!0})],t.prototype,"direction",void 0),ge([q({sync:!0,equality:_n})],t.prototype,"startDateDirection",void 0),ge([q({sync:!0,equality:_n})],t.prototype,"endDateDirection",void 0),ge([B({persist:!1,isEqual:_n},{sync:!0,equality:_n})],t.prototype,"effectiveDirection",void 0),ge([q({identifierCls:Vo})],t.prototype,"dispatcher",void 0),ge([B({type:"boolean",defaultValue:!1},{sync:!0})],t.prototype,"manuallyScheduled",void 0),ge([B({type:"boolean",defaultValue:!1})],t.prototype,"unscheduled",void 0),ge([j("dispatcher")],t.prototype,"calculateDispatcher",null),ge([iu("dispatcher")],t.prototype,"buildProposedDispatcher",null),ge([dt("startDate")],t.prototype,"writeStartDate",null),ge([j("startDate")],t.prototype,"calculateStartDate",null),ge([dt("endDate")],t.prototype,"writeEndDate",null),ge([j("endDate")],t.prototype,"calculateEndDate",null),ge([dt("duration")],t.prototype,"writeDuration",null),ge([j("duration")],t.prototype,"calculateDuration",null),ge([j("effectiveDirection")],t.prototype,"calculateEffectiveDirection",null),ge([j("startDateDirection")],t.prototype,"calculateStartDateDirection",null),ge([j("endDateDirection")],t.prototype,"calculateEndDateDirection",null),t}){},zo=class extends O([cn],e=>{const n=e.prototype;class t extends e{getAssignmentFor(r){var i;for(const a of(i=this.assigned)!=null?i:[])if(a.resource===r)return a;return null}isAssignedTo(r){return!!this.getAssignmentFor(r)}async assign(r){const i=this.project.assignmentStore.modelClass;return this.addAssignment(new i({event:this,resource:r})),this.commitAsync()}async unassign(r){const i=this.getAssignmentFor(r);return this.removeAssignment(i),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const r=this.getEventStore();this.assigned.forEach(i=>r.assignmentsForRemoval.add(i))}n.leaveProject.call(this,...arguments)}remove(){if(this.parent){const r=this.getEventStore();n.remove.call(this),r&&r.afterEventRemoval()}else return n.remove.call(this)}addAssignment(r){return this.getProject().assignmentStore.add(r),r}removeAssignment(r){return this.getProject().assignmentStore.remove(r),r}}return t}){},dv=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},qo=class extends O([or,zo],e=>{const n=e.prototype;class t extends e{get assignments(){return this.assigned?[...this.assigned]:[]}}return dv([qe({},Or)],t.prototype,"assigned",void 0),t}){},bh=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Go=class extends O([or],e=>{const n=e.prototype;class t extends e{leaveProject(){var r,i;if(this.isInActiveTransaction){const a=this.graph.activeTransaction,o=this.getDependencyStore(),l=[];for(const c of(r=a.readCurrentOrProposedOrPrevious(this.$.outgoingDeps))!=null?r:[])o.includes(c)&&l.push(c);for(const c of(i=a.readCurrentOrProposedOrPrevious(this.$.incomingDeps))!=null?i:[])o.includes(c)&&l.push(c);this.project.dependencyStore.remove(l)}n.leaveProject.call(this)}}return bh([qe({},Or)],t.prototype,"outgoingDeps",void 0),bh([qe({},Or)],t.prototype,"incomingDeps",void 0),t}){},gi=class extends O([or,qo,Go],e=>{const n=e.prototype;class t extends e{}return t}){},hv={splice:1,clear:1},Ho=class extends O([mt],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(r){var i;const a=hv[r.action];super.onDataChange(r),a&&((i=r.removed)!=null&&i.length)&&this.afterEventRemoval()}remove(r,i){const a=n.remove.call(this,r,i);return this.afterEventRemoval(),a}removeAll(r){const i=n.removeAll.call(this,r);return this.afterEventRemoval(),i}onNodeRemoveChild(r,i,a,o){const l=n.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),l}afterEventRemoval(){const{assignmentsForRemoval:r,dependenciesForRemoval:i}=this;if(!r)return;const a=this.getAssignmentStore();if(a&&!a.allAssignmentsForRemoval&&r.size){const l=[...r].filter(c=>!a.assignmentsForRemoval.has(c));l.length>0&&a.remove(l)}r.clear();const o=this.getDependencyStore();if(o&&!o.allDependenciesForRemoval&&i.size){const l=[...i].filter(c=>!o.dependenciesForRemoval.has(c));l.length>0&&o.remove(l)}i.clear()}processRecord(r,i=!1){var a;if(!((a=this.project)!=null&&a.isRepopulatingStores)){const o=this.getById(r.id);if(o&&o!==r&&o.assigned)for(const c of o.assigned)c.event=r}return r}}return t}){},rs=class extends O([Ho,_r],e=>{class n extends e{constructor(){super(...arguments),this.removalOrder=400}static get defaultConfig(){return{modelClass:gi}}buildRootNode(){return this.getProject()||{}}set data(s){super.data=s,this.afterEventRemoval()}}return n}){},Yo=class extends O([rs],e=>{class n extends e{static get defaultConfig(){return{tree:!0}}}return n}){},fv={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",RemoveDependencyCycleEffectResolution:{descriptionTpl:"Remove dependency"},DeactivateDependencyCycleEffectResolution:{descriptionTpl:"Deactivate dependency"},CycleEffectDescription:{descriptionTpl:"A cycle has been found, formed by: {0}"},EmptyCalendarEffectDescription:{descriptionTpl:'"{0}" calendar does not provide any working time intervals.'},Use24hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 24 hours calendar with non-working Saturdays and Sundays."},Use8hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 8 hours calendar (08:00-12:00, 13:00-17:00) with non-working Saturdays and Sundays."},ConflictEffectDescription:{descriptionTpl:"A scheduling conflict has been found: {0} is conflicting with {1}"},ConstraintIntervalDescription:{dateFormat:"LLL"},ProjectConstraintIntervalDescription:{startDateDescriptionTpl:"Project start date {0}",endDateDescriptionTpl:"Project end date {0}"},DependencyType:{long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},ManuallyScheduledParentConstraintIntervalDescription:{startDescriptionTpl:'Manually scheduled "{2}" forces its children to start no earlier than {0}',endDescriptionTpl:'Manually scheduled "{2}" forces its children to finish no later than {1}'},DisableManuallyScheduledConflictResolution:{descriptionTpl:'Disable manual scheduling for "{0}"'},DependencyConstraintIntervalDescription:{descriptionTpl:'Dependency ({2}) from "{3}" to "{4}"'},RemoveDependencyResolution:{descriptionTpl:'Remove dependency from "{1}" to "{2}"'},DeactivateDependencyResolution:{descriptionTpl:'Deactivate dependency from "{1}" to "{2}"'},DateConstraintIntervalDescription:{startDateDescriptionTpl:'Task "{2}" {3} {0} constraint',endDateDescriptionTpl:'Task "{2}" {3} {1} constraint',constraintTypeTpl:{startnoearlierthan:"Start-No-Earlier-Than",finishnoearlierthan:"Finish-No-Earlier-Than",muststarton:"Must-Start-On",mustfinishon:"Must-Finish-On",startnolaterthan:"Start-No-Later-Than",finishnolaterthan:"Finish-No-Later-Than"}},RemoveDateConstraintConflictResolution:{descriptionTpl:'Remove "{1}" constraint of task "{0}"'}},nS=nt.publishLocale(fv),pi=class extends de{initialize(...e){super.initialize(...e),this.startDate||(this.startDate=he),this.endDate||(this.endDate=ae)}equalTo(e){return this.startDate.getTime()===e.startDate.getTime()&&this.endDate.getTime()===e.endDate.getTime()}isInfinite(){return this.startDate.getTime()===he.getTime()&&this.endDate.getTime()===ae.getTime()}startDateIsFinite(){return!this.isIntervalEmpty()&&this.startDate.getTime()!==he.getTime()}endDateIsFinite(){return!this.isIntervalEmpty()&&this.endDate.getTime()!==ae.getTime()}containsDate(e,n=At.Left){return n===At.Left&&e>=this.startDate&&e<this.endDate||n===At.Right&&e>this.startDate&&e<=this.endDate}isIntervalEmpty(){return this.startDate>this.endDate}intersect(e){const n=e.startDate,t=e.endDate,s=this.startDate,r=this.endDate;if(r<n||s>t)return Rh;const i=new Date(Math.max(s.getTime(),n.getTime())),a=new Date(Math.min(r.getTime(),t.getTime()));return this.constructor.new({startDate:i,endDate:a})}intersectMut(e,n=!1){var t;const s=e.startDate,r=e.endDate,i=this.startDate,a=this.endDate;if(n&&(this.intersectionOf||(this.intersectionOf=new Set),((t=e.intersectionOf)==null?void 0:t.size)>0?(e.intersectionOf.forEach(this.intersectionOf.add,this.intersectionOf),this.intersectedAsEmpty=e.intersectedAsEmpty):this.intersectionOf.add(e)),!this.isIntervalEmpty()){if(a<s||i>r)return this.startDate=ae,this.endDate=he,n&&(this.intersectedAsEmpty=e),this;this.startDate=new Date(Math.max(i.getTime(),s.getTime())),this.endDate=new Date(Math.min(a.getTime(),r.getTime()))}return this}getCopyProperties(e){return e}copyWith(e){const n=this.getCopyProperties(e);return this.constructor.new(n)}},Rh=pi.new({startDate:ae,endDate:he}),lr=(e,n=!1)=>e.reduce((t,s)=>t.intersectMut(s,n),pi.new()),Ko=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Jo=Symbol("ConflictSymbol"),Ih=class extends gt($){static get $name(){return"ConflictEffectDescription"}static getDescription(e){return pt(this.L("L{descriptionTpl}"),e.intervals[0].getDescription(),e.intervals[1].getDescription())}},cr=class extends Un{constructor(){super(...arguments),this.handler=Jo}initialize(e){super.initialize(e),this.intervals=this.filterConflictingIntervals(this.intervals)}getResolutions(){return this._resolutions||(this._resolutions=[].concat(...this.intervals.map(e=>e.getResolutions()))),this._resolutions}filterConflictingIntervals(e){const n=[],t=[...e].filter(r=>!r.isInfinite()),s=t.find(r=>r.isAffectedByTransaction());if(s){const r=t.sort((o,l)=>o===s?-1:0),a=lr(r,!0).intersectedAsEmpty;n.push(a,s)}else n.push(lr(t,!0).intersectedAsEmpty,lr(t.reverse(),!0).intersectedAsEmpty);return n}};Ko([G("schedulingConflict")],cr.prototype,"type",void 0),Ko([G(Ih)],cr.prototype,"_descriptionBuilderClass",void 0);var mi=class extends Vn{resolve(){throw new Error("Abstract method")}},fn=class extends gt($){static get $name(){return"ConstraintIntervalDescription"}static getDescription(e){return pt(this.L("L{descriptionTpl}"),...this.getDescriptionParameters(e))}static getDescriptionParameters(e){return[R.format(e.startDate,this.L("L{dateFormat}")),R.format(e.endDate,this.L("L{dateFormat}"))]}},ur=class extends pi{constructor(){super(...arguments),this.owner=void 0,this.reflectionOf=void 0,this.side=void 0,this.resolutions=void 0}get isConstraintInterval(){return!0}getDescription(){return this.descriptionBuilderClass.getDescription(this)}getResolutions(){return[]}isAffectedByTransaction(e){return!1}getCopyProperties(e){const{owner:n,reflectionOf:t,side:s}=this;return Object.assign({owner:n,reflectionOf:t,side:s},e)}};Ko([G(fn)],ur.prototype,"descriptionBuilderClass",void 0);var Qo=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Zo=Symbol("CycleSymbol"),Xo=class extends Us{constructor(){super(...arguments),this.failedResolutionReferences=new Map}},Ph=class extends Ba{constructor(){super(...arguments),this.candidateClass=Xo}initialize(e){var n;(n=e.graph.project)!=null&&n.delayCalculation&&(e.startProgressNotificationsAfterMs=0,e.emitProgressNotificationsEveryMs=100),super.initialize(e),this.candidate.failedResolutionReferences=new Map(this.baseRevision.failedResolutionReferences)}addIdentifier(e,n,...t){return this.candidate.failedResolutionReferences.size&&(this.candidate.failedResolutionReferences.forEach((s,r)=>{this.write(r,s)}),this.candidate.failedResolutionReferences.clear()),super.addIdentifier(e,n,...t)}},wh=class extends O([Na],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.baseRevision=Xo.new(),this.transactionClass=Ph,this.autoCommitMode="async",this.onComputationCycle="effect",this.cycleEffectClass=jr,this.silenceInitialCommit=!0,this.ignoreInitialCommitComputationCycles=!1}get dirty(){const r=this.activeTransaction;return r.entries.size>0&&(r.hasVariableEntry||r.hasEntryWithProposedValue)}onPropagationProgressNotification(r){var i,a;this.enableProgressNotifications&&this.project&&((a=(i=this.project).trigger)==null||a.call(i,"progress",r))}async commitAsync(r){if(!this.project||this.project.isDestroyed)return;this.project.trigger("beforeCommit"),this.isInitialCommit&&this.ignoreInitialCommitComputationCycles&&(this._onComputationCycle=this._onComputationCycle||this.onComputationCycle,this.onComputationCycle="ignore");const i=this.project.beforeCommitAsync();return i||n.commitAsync.call(this,r)}get isInitialCommit(){return this.project.isInitialCommit||super.isInitialCommit}set isInitialCommit(r){super.isInitialCommit=r}write(r,i,...a){var o,l,c;const u=(o=r.field)==null?void 0:o.name,d=r.self;if(u&&d){const h=(l=d.beforeChronoFieldSet)==null?void 0:l.call(d,u,i);n.write.call(this,r,i,...a),(c=d.afterChronoFieldSet)==null||c.call(d,u,i,h)}else n.write.call(this,r,i,...a)}async finalizeCommitAsync(r){const{project:i}=this;if(!i||i.isDestroyed)return;const{entries:a}=r,o=new Set;globalThis.DEBUG&&console.timeEnd("Time to visible");const{isInitialCommit:l,silenceInitialCommit:c}=this,u=l&&c;l&&(i.isInitialCommitPerformed=!0,this.ignoreInitialCommitComputationCycles&&(this.onComputationCycle=this._onComputationCycle)),i.isWritingData=!0,i.hasLoadedDataToCommit=!1,this.enableProgressNotifications&&i.trigger("progress",{total:r.entries.size,remaining:0,phase:"finalizing"}),r.transaction.rejectedWith&&i.trigger("commitRejected",{transactionResult:r,isInitialCommit:l,silenceCommit:u}),i.trigger("refresh",{isInitialCommit:l,isCalculated:!0}),await new Promise(h=>{setTimeout(()=>{var f,g;if(!i.isDestroyed){if(r.transaction.rejectedWith)i.isWritingData=!1;else{(f=i.suspendChangesTracking)==null||f.call(i),globalThis.DEBUG&&console.time("Finalize propagation");const p=new Set;for(const y of a.values()){const D=y.identifier,E=y.getValue(),{field:C}=D;if(y.isShadow()||!D[ei]||E===ee||C instanceof Or)continue;const v=D.self,S=v.firstStore;p.has(v)||(v.beginBatch(!0),p.add(v)),S!=null&&S.autoCommit&&!o.has(S)&&(S.suspendAutoCommit(),o.add(S)),v.meta.batchChanges[C.name]=E}let m=!1;for(const y of p)if(!y.triggerBeforeUpdate({...y.meta.batchChanges})){m=!0;break}if(m){for(const y of p)y.cancelBatch();r.transaction.reject(),i.trigger("commitRejected",{transactionResult:r,isInitialCommit:l,silenceCommit:u}),i.trigger("refresh",{isInitialCommit:l,isCalculated:!0})}else for(const y of p)y.ignoreBag=u||i.ignoreRecordChanges,y.generation++,y.endBatch(u,!0,!0),y.ignoreBag=!1;i.ignoreRecordChanges=!1,globalThis.DEBUG&&console.timeEnd("Finalize propagation"),i.isWritingData=!1,m||i.trigger("dataReady",{records:p,isInitialCommit:l}),(g=i.resumeChangesTracking)==null||g.call(i,u),o.forEach(y=>y.resumeAutoCommit()),u&&(i.eventStore.acceptChanges(),i.dependencyStore.acceptChanges(),i.resourceStore.acceptChanges(),i.assignmentStore.acceptChanges(),i.calendarManagerStore.acceptChanges(),i.acceptChanges())}i.trigger("commitFinalized",{isInitialCommit:l,transactionResult:r})}h()},0)})}*onComputationCycleHandler(r){if(this.onComputationCycle==="effect"){const i=this.project.cycleEffectClass.new({cycle:r});(yield i)===bt.Cancel&&(yield kt(i))}else return yield*super.onComputationCycleHandler(r)}onComputationCycleHandlerSync(r,i){if(this.onComputationCycle==="effect")throw this.project.cycleEffectClass.new({cycle:r});return super.onComputationCycleHandlerSync(r,i)}async[Zo](r,i){return this.project.onCycleSchedulingIssue(r,i)}async[ko](r,i){return i.walkContext.startNewEpoch(),this.project.onEmptyCalendarSchedulingIssue(r,i)}async[Jo](r,i){return i.walkContext.startNewEpoch(),this.project.onConflictSchedulingIssue(r,i)}[Pn](r,i){return super[Pn](r,i)}}return t}){},Mh=class extends gt(Vn){static get $name(){return"RemoveDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.remove()}},xh=class extends gt($){static get $name(){return"CycleEffectDescription"}static getDescription(e){return pt(this.L("L{descriptionTpl}"),this.getShortDescription(e))}static getShortDescription(e){const n=e.getEvents().slice();return n.push(n[0]),'"'+n.map(t=>t.name||"#"+t.id).join('" -> "')+'"'}},jr=class extends Un{constructor(){super(...arguments),this.handler=Zo}getEvents(){if(!this._events){const e=new Set;this.cycle.cycle.forEach(({context:n})=>e.add(n)),this._events=[...e]}return this._events}matchDependencyBySourceAndTargetEvent(e,n,t){return e.fromEvent===n&&e.toEvent===t}getDependencyForSourceAndTargetEvents(e,n){return this.getEvents()[0].project.getDependencyStore().find(i=>this.matchDependencyBySourceAndTargetEvent(i,e,n))}getDependencies(){if(!this._dependencies){const e=new Set,n=this.getEvents(),t=n.length;let s=n[0],r;if(t===1)(r=this.getDependencyForSourceAndTargetEvents(s,s))&&e.add(r);else for(const i of n)for(const a of n)(r=this.getDependencyForSourceAndTargetEvents(i,a))&&e.add(r),(r=this.getDependencyForSourceAndTargetEvents(a,i))&&e.add(r);this._dependencies=[...e]}return this._dependencies}getResolutions(){return this._resolutions||(this._resolutions=[this.removeDependencyCycleEffectResolutionClass.new()]),this._resolutions}};Qo([G("cycle")],jr.prototype,"type",void 0),Qo([G(xh)],jr.prototype,"_descriptionBuilderClass",void 0),Qo([G(Mh)],jr.prototype,"removeDependencyCycleEffectResolutionClass",void 0);var vi=class extends O([or],e=>{const n=e.prototype;class t extends e{static get $name(){return"HasSubEventsMixin"}*hasSubEvents(){throw new Error("Abstract method `hasSubEvents` has been called")}*subEventsIterable(){throw new Error("Abstract method `subEventsIterable` has been called")}*calculateStartDatePure(){const r=yield this.$.manuallyScheduled,i=yield*this.hasSubEvents();return!r&&i?yield*this.calculateMinChildrenStartDate():yield*n.calculateStartDatePure.call(this)}*calculateEndDatePure(){const r=yield this.$.manuallyScheduled,i=yield*this.hasSubEvents();return!r&&i?yield*this.calculateMaxChildrenEndDate():yield*n.calculateEndDatePure.call(this)}*calculateStartDateProposed(){const r=yield this.$.manuallyScheduled,i=yield*this.hasSubEvents();return!r&&i?yield*this.calculateStartDatePure():yield*n.calculateStartDateProposed.call(this)}*calculateEndDateProposed(){const r=yield this.$.manuallyScheduled,i=yield*this.hasSubEvents();return!r&&i?yield*this.calculateEndDatePure():yield*n.calculateEndDateProposed.call(this)}*calculateDurationProposed(){const r=yield this.$.manuallyScheduled,i=yield*this.hasSubEvents();return!r&&i?yield*this.calculateDurationPure():yield*n.calculateDurationProposed.call(this)}*shouldRollupChildStartDate(r){return!0}*calculateMinChildrenStartDate(){const r=yield*this.subEventsIterable();let i=ae.getTime();for(const a of r)if(yield*this.shouldRollupChildStartDate(a)){let o=yield a.$.startDate;if(o||(o=yield a.$.endDate),(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())){const l=yield*a.calculateMinChildrenStartDate();(!o||l&&l.getTime()<o.getTime())&&(o=l)}o&&o.getTime()<i&&(i=o.getTime())}return i===he.getTime()||i===ae.getTime()?null:new Date(i)}*shouldRollupChildEndDate(r){return!0}*calculateMaxChildrenEndDate(){const r=yield*this.subEventsIterable();let i=he.getTime();for(const a of r)if(yield*this.shouldRollupChildEndDate(a)){let o=yield a.$.endDate;if(o||(o=yield a.$.startDate),(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())){const l=yield*a.calculateMaxChildrenEndDate();(!o||l&&l.getTime()>o.getTime())&&(o=l)}o&&o.getTime()>i&&(i=o.getTime())}return i===he.getTime()||i===ae.getTime()?null:new Date(i)}}return t}){},Th=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Gt=class extends O([vi],e=>{const n=e.prototype;class t extends e{*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}get parent(){return this._parent}set parent(r){this._parent=r,this.parentEvent=r}*calculateEffectiveDirection(){const r=yield this.$.direction;if(r)return{kind:"own",direction:r};const i=yield this.$.parentEvent;if(i){const a=yield i.$.effectiveDirection;return{kind:"inherited",direction:a.direction,inheritedFrom:a.kind==="own"?i:a.kind==="inherited"?a.inheritedFrom:i}}else return yield*super.calculateEffectiveDirection()}*calculateStartDateDirection(){const r=yield this.getProject().$.effectiveDirection;let i=null;if(!(yield this.$.manuallyScheduled)){const a=yield*this.subEventsIterable();for(const o of a){const l=yield o.$.startDateDirection;if(r.direction!==l.direction){i={kind:"enforced",direction:l.direction,enforcedBy:l.kind==="own"?o:l.kind==="enforced"?l.enforcedBy:l.inheritedFrom};break}}}return i!=null?i:yield*super.calculateStartDateDirection()}*calculateEndDateDirection(){const r=yield this.getProject().$.effectiveDirection;let i=null;if(!(yield this.$.manuallyScheduled)){const a=yield*this.subEventsIterable();for(const o of a){const l=yield o.$.startDateDirection;if(r.direction!==l.direction){i={kind:"enforced",direction:l.direction,enforcedBy:l.kind==="own"?o:l.kind==="enforced"?l.enforcedBy:l.inheritedFrom};break}}}return i!=null?i:yield*super.calculateStartDateDirection()}}return Th([td({bucket:"childEvents"})],t.prototype,"parentEvent",void 0),Th([sd()],t.prototype,"childEvents",void 0),t}){},Oh=class extends de{constructor(){super(...arguments),this.entities=new Map}hasEntity(e){return this.entities.has(e)}getEntity(e){return this.entities.get(e)}addEntity(e){const n=e.name;if(!n)throw new Error("Entity must have a name");if(this.hasEntity(n))throw new Error(`Entity with name [${String(n)}] already exists`);return e.schema=this,this.entities.set(n,e),e}getEntityDecorator(){return e=>{const n=el(e);return this.addEntity(n),e}}},el=e=>{if(!e.name)throw new Error("Can't add entity - the target class has no name");return Pr(e.prototype)},gv=()=>e=>(el(e),e),Ce=()=>{throw new Error("Abstract method call!")},ie=()=>{throw new Error("Method cannot be called at this state!")},dr=class extends ${canUndo(e){Ce()}canRedo(e){Ce()}onUndo(e){Ce()}onRedo(e){Ce()}onStartTransaction(e){Ce()}onStopTransaction(e){Ce()}onStopTransactionDelayed(e){Ce()}onRejectTransaction(e){Ce()}onEnable(e){Ce()}onDisable(e){Ce()}onAutoRecordOn(e){Ce()}onAutoRecordOff(e){Ce()}onResetQueue(e){Ce()}onModelUpdate(e){Ce()}onStoreModelAdd(e){Ce()}onStoreModelInsert(e){Ce()}onStoreModelRemove(e){Ce()}onStoreModelRemoveAll(e){Ce()}onModelInsertChild(e){Ce()}onModelRemoveChild(e){Ce()}};dr._$name="StateBase";var se=Symbol("STATE_PROP"),hr=Symbol("STORES_PROP"),Xe=Symbol("QUEUE_PROP"),Rt=Symbol("POS_PROP"),oe=Symbol("TRANSACTION_PROP"),yt=Symbol("TRANSACTION_TIMER_PROP"),It=Symbol("AUTO_RECORD_PROP"),ns=Symbol("IS_APPLYING_STASH"),sS=Object.freeze([se,hr,Xe,Rt,oe,yt,It,ns]),Ah=new Map,pv=(e,n)=>{Ah.set(e,n)},mv=e=>(typeof e=="string"&&(e=Ah.get(e)),e),$t={registerStmState:pv,resolveStmState:mv},yi=(e,n)=>{const{undo:t,redo:s}=n;let r;return t&&!s?r={[Xe]:e[Xe].slice(e.position),[Rt]:0}:s&&!t?r={[Xe]:e[Xe].slice(0,e.position)}:r={[Xe]:[],[Rt]:0},[r,()=>{e.notifyStoresAboutQueueReset(n)}]},vv=class extends dr{canUndo(){return!1}canRedo(){return!1}onUndo(){ie()}onRedo(){ie()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){ie()}onAutoRecordOn(){return{[It]:!0}}onAutoRecordOff(){return{[It]:!1}}onStartTransaction(){ie()}onStopTransaction(){ie()}onStopTransactionDelayed(){ie()}onRejectTransaction(){ie()}onResetQueue(e,n){return yi(e,n)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},$h=new vv,yv=$h;$t.registerStmState("disabledstate",$h);var gn=Symbol("ACTION_QUEUE_PROP"),Si=class extends ${get defaultConfig(){return{title:null}}construct(...e){this[gn]=[],super.construct(...e)}get queue(){return this[gn].slice(0)}get length(){return this[gn].length}addAction(e){this[gn].push(e)}undo(){const e=this[gn];for(let n=e.length-1;n>=0;--n)e[n].undo()}redo(){const e=this[gn];for(let n=0,t=e.length;n<t;++n)e[n].redo()}};Si._$name="Transaction";var _h=class extends dr{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,n){let t=e.position;const s=e[Xe],r=Math.max(0,t-n),i=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];for(;t!==r;){const o=s[--t];o.undo(),a.push(o)}return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"undo",transactions:a})}]};return[{[se]:"restoringstate",[Rt]:r},i]}onRedo(e,n){let t=e.position;const s=e[Xe],r=Math.min(s.length,t+n),i=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];do{const o=s[t++];o.redo(),a.push(o)}while(t!==r);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"redo",transactions:a})}]};return[{[se]:"restoringstate",[Rt]:r},i]}onEnable(){ie()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[se]:"autoreadystate",[It]:!0}}onAutoRecordOff(){ie()}onStartTransaction(e,n){const t=new Si({title:n});return[{[se]:"recordingstate",[oe]:t},()=>{e.notifyStoresAboutStateRecordingStart(t)}]}onStopTransaction(){ie()}onStopTransactionDelayed(){ie()}onRejectTransaction(){ie()}onResetQueue(e,n){return yi(e,n)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},Fh=new _h,Di=Fh;$t.registerStmState("readystate",Fh);var jh=class extends dr{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const n=e[oe];return e.notifyStoresAboutStateRecordingStop(n,{disabled:!0}),{[se]:"disabledstate",[oe]:null}}onAutoRecordOn(e){return[{[se]:"autorecordingstate",[It]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){ie()}onStartTransaction(){ie()}onStopTransaction(e,n){const t=e[oe],s=e[Xe];let r=e[Rt];return t.length&&(!t.title&&!n&&e.getTransactionTitle?t.title=e.getTransactionTitle(t):n&&(t.title=n),s[r]=t,s.length=++r),[{[se]:"readystate",[Rt]:r,[oe]:null},()=>{e.notifyStoresAboutStateRecordingStop(t,{stop:!0})}]}onRejectTransaction(e){const n=e[oe];return[{[se]:"restoringstate",[oe]:null},()=>(n.length&&n.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(n,{rejected:!0})}])]}onStopTransactionDelayed(){ie()}onResetQueue(e,n){return yi(e,n)}onModelUpdate(e,n,t,s,r){e[oe].addAction(e.makeModelUpdateAction(n,t,s,r))}onModelInsertChild(e,n,t,s,r,i){e[oe].addAction(e.makeModelInsertChildAction(n,t,s,r,i))}onModelRemoveChild(e,n,t,s){e[oe].addAction(e.makeModelRemoveChildAction(n,t,s))}onStoreModelAdd(e,n,t,s){e[oe].addAction(e.makeStoreModelAddAction(n,t,s))}onStoreModelInsert(e,n,t,s,r,i){e[oe].addAction(e.makeStoreModelInsertAction(n,t,s,r,i))}onStoreModelRemove(e,n,t,s,r){e[oe].addAction(e.makeStoreModelRemoveAction(n,t,s,r))}onStoreRemoveAll(e,n,t,s){e[oe].addAction(e.makeStoreRemoveAllAction(n,t,s))}},kh=new jh,Sv=kh;$t.registerStmState("recordingstate",kh);var Dv=class extends dr{static get $name(){return"RestoringStateClass"}canUndo(){return!1}canRedo(){return!1}onUndo(){ie()}onRedo(){ie()}onEnable(){ie()}onDisable(){ie()}onAutoRecordOn(){return{[It]:!0}}onAutoRecordOff(){return{[It]:!1}}onStartTransaction(){ie()}onStopTransaction(){ie()}onStopTransactionDelayed(){ie()}onRejectTransaction(){ie()}onQueueReset(){ie()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},Lh=new Dv,Cv=Lh;$t.registerStmState("restoringstate",Lh);var Ev=class extends _h{onAutoRecordOn(){ie()}onAutoRecordOff(){return{[se]:"readystate",[It]:!1}}onStartTransaction(e,n){const t=new Si({title:n});return[{[se]:"autorecordingstate",[oe]:t},()=>{e.notifyStoresAboutStateRecordingStart(t),e.stopTransactionDelayed()}]}onModelUpdate(e,n,t,s){e.startTransaction(),e.onModelUpdate(n,t,s)}onModelInsertChild(e,n,t,s,r){e.startTransaction(),e.onModelInsertChild(n,t,s,r)}onModelRemoveChild(e,n,t,s){e.startTransaction(),e.onModelRemoveChild(n,t,s)}onStoreModelAdd(e,n,t,s){e.startTransaction(),e.onStoreModelAdd(n,t,s)}onStoreModelInsert(e,n,t,s,r,i){e.startTransaction(),e.onStoreModelInsert(n,t,s,r,i)}onStoreModelRemove(e,n,t,s,r){e.startTransaction(),e.onStoreModelRemove(n,t,s,r)}onStoreRemoveAll(e,n,t,s){e.startTransaction(),e.onStoreRemoveAll(n,t,s)}},Bh=new Ev,tl=Bh;$t.registerStmState("autoreadystate",Bh);var bv=class extends jh.mixin(Ar){onDisable(e){const n=e[oe],t=e[yt];return t&&this.clearTimeout(t),e.notifyStoresAboutStateRecordingStop(n,{disabled:!0}),{[se]:"disabledstate",[oe]:null,[yt]:null}}onAutoRecordOn(e){ie()}onAutoRecordOff(e){const n=e[yt];return n&&this.clearTimeout(n),{[se]:"recordingstate",[It]:!1,[yt]:null}}onStopTransaction(e,n){const t=e[oe],s=e[yt],r=e[Xe];let i=e[Rt];return s&&this.clearTimeout(s),t.length&&(!t.title&&!n&&e.getTransactionTitle?t.title=e.getTransactionTitle(t):n&&(t.title=n),r[i]=t,r.length=++i),[{[se]:"autoreadystate",[Rt]:i,[oe]:null,[yt]:null},()=>{e.notifyStoresAboutStateRecordingStop(t,{stop:!0})}]}onStopTransactionDelayed(e){let n=e[yt];return n&&this.clearTimeout(n),n=this.setTimeout(()=>{e.stopTransaction()},e.autoRecordTransactionStopTimeout),{[se]:rl,[yt]:n}}onResetQueue(e,n){return yi(e,n)}onRejectTransaction(e){const n=e[oe],t=e[yt];return t&&this.clearTimeout(t),[{[se]:"restoringstate",[oe]:null,[yt]:null},()=>(n.length&&n.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(n,{rejected:!0})}])]}onModelUpdate(e,...n){super.onModelUpdate(e,...n),e.stopTransactionDelayed()}onModelInsertChild(e,...n){super.onModelInsertChild(e,...n),e.stopTransactionDelayed()}onModelRemoveChild(e,...n){super.onModelRemoveChild(e,...n),e.stopTransactionDelayed()}onStoreModelAdd(e,...n){super.onStoreModelAdd(e,...n),e.stopTransactionDelayed()}onStoreModelInsert(e,...n){super.onStoreModelInsert(e,...n),e.stopTransactionDelayed()}onStoreModelRemove(e,...n){super.onStoreModelRemove(e,...n),e.stopTransactionDelayed()}onStoreRemoveAll(e,...n){super.onStoreRemoveAll(e,...n),e.stopTransactionDelayed()}},rl=new bv,Rv=rl;$t.registerStmState("autorecordingstate",rl);var Nh=()=>{throw new Error("Abstract method call!")},Ht=class extends ${get type(){return this.constructor.name}undo(){Nh()}redo(){Nh()}};Ht._$name="ActionBase";var Vh=Symbol("MODEL_PROP"),Uh=Symbol("NEW_DATA_PROP"),Wh=Symbol("OLD_DATA_PROP"),Ci=class extends Ht{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0,isInitialUserAction:!1}}get type(){return"UpdateAction"}get model(){return this[Vh]}set model(e){this[Vh]=e}get newData(){return this[Uh]}set newData(e){this[Uh]={...e}}get oldData(){return this[Wh]}set oldData(e){this[Wh]={...e}}undo(){const{model:e,oldData:n}=this;e.$&&Object.assign(e,n),e.set(n,null,null,null,!!e.$)}redo(){const{model:e,newData:n}=this;e.$&&Object.assign(e,n),e.set(n,null,null,null,!!e.$)}};Ci._$name="UpdateAction";var zh=Symbol("PARENT_MODEL_PROP"),qh=Symbol("CHILD_MODELS_PROP"),Gh=Symbol("INSERT_INDEX_PROP"),Hh=Symbol("CONTEXT_PROP"),Yh=class extends Ht{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[zh]}set parentModel(e){this[zh]=e}get childModels(){return this[qh]}set childModels(e){this[qh]=e.slice(0)}get insertIndex(){return this[Gh]}set insertIndex(e){this[Gh]=e}get context(){return this[Hh]}set context(e){this[Hh]=e}undo(){const{parentModel:e,context:n,childModels:t}=this,s=new Map,r=new Set;for(const i of t){const a=n.get(i);if(!a)r.add(i);else{let o=s.get(a.parent);o||(o={moveRight:[],moveLeft:[],moveFromAnotherParent:[]},s.set(a.parent,o)),a.parent===e?a.index>i.parentIndex?o.moveRight.push({parent:a.parent,model:i,index:a.index+1}):o.moveLeft.push({parent:a.parent,model:i,index:a.index}):o.moveFromAnotherParent.push({parent:a.parent,model:i,index:a.index})}}for(const i of s.values()){const{moveRight:a,moveLeft:o}=i;o.sort((l,c)=>l.index-c.index),a.sort((l,c)=>c.index-l.index)}r.forEach(i=>i.parent.removeChild(i));for(const i of s.values()){const{moveRight:a,moveLeft:o,moveFromAnotherParent:l}=i;o.forEach(c=>{c.parent.insertChild(c.model,c.index)}),a.forEach(c=>{c.parent.insertChild(c.model,c.index)}),l.forEach(c=>{c.parent.insertChild(c.model,c.index)})}}redo(){var e;const{parentModel:n,insertIndex:t,childModels:s}=this,r=n.children[t];n.insertChild(s,r,!1,{orderedBeforeNode:(e=r==null?void 0:r.previousSibling)==null?void 0:e.nextOrderedSibling})}};Yh._$name="InsertChildAction";var Kh=Symbol("PARENT_MODEL_PROP"),Jh=Symbol("CHILD_MODELS_PROP"),Qh=Symbol("CONTEXT_PROP"),Zh=class extends Ht{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[Kh]}set parentModel(e){this[Kh]=e}get childModels(){return this[Jh]}set childModels(e){this[Jh]=e.slice(0)}get context(){return this[Qh]}set context(e){this[Qh]=e}undo(){const{parentModel:e,context:n,childModels:t}=this;t.sort((s,r)=>{const i=n.get(s),a=n.get(r);return i-a}),t.forEach(s=>{const r=n.get(s);e.insertChild(s,r.parentIndex,void 0,{orderedParentIndex:r.orderedParentIndex})})}redo(){this.parentModel.removeChild(this.childModels)}};Zh._$name="RemoveChildAction";var Xh=Symbol("STORE_PROP"),ef=Symbol("MODEL_LIST_PROP"),tf=class extends Ht{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[Xh]}set store(e){this[Xh]=e}get modelList(){return this[ef]}set modelList(e){this[ef]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}};tf._$name="AddAction";var rf=Symbol("STORE_PROP"),nf=Symbol("MODEL_LIST_PROP"),sf=Symbol("INSERT_INDEX_PROP"),af=Symbol("CONTEXT_PROP"),of=class extends Ht{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[rf]}set store(e){this[rf]=e}get modelList(){return this[nf]}set modelList(e){this[nf]=e.slice(0)}get insertIndex(){return this[sf]}set insertIndex(e){this[sf]=e}get context(){return this[af]}set context(e){this[af]=e}undo(){const{store:e,modelList:n,context:t,silent:s}=this;n.sort((r,i)=>{const a=t.get(r),o=t.get(i);return a!==void 0&&o!==void 0?a-o:0}),n.forEach(r=>{const i=t.get(r);r._undoingInsertion=!0,i!==void 0?e.insert(i,r,s):e.remove(r,s),r._undoingInsertion=!1})}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}};of._$name="InsertAction";var lf=Symbol("STORE_PROP"),cf=Symbol("MODEL_LIST_PROP"),uf=Symbol("CONTEXT_PROP"),df=class extends Ht{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[lf]}set store(e){this[lf]=e}get modelList(){return this[cf]}set modelList(e){this[cf]=e.slice(0)}get context(){return this[uf]}set context(e){this[uf]=e}undo(){const{store:e,context:n,modelList:t,silent:s}=this;t.sort((r,i)=>{const a=n.get(r),o=n.get(i);return a-o}),t.forEach(r=>{const i=n.get(r);e.insert(i,r,s)})}redo(){this.store.remove(this.modelList,this.silent)}};df._$name="RemoveAction";var hf=Symbol("STORE_PROP"),ff=Symbol("ALL_RECORDS_PROP"),gf=class extends Ht{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[hf]}set store(e){this[hf]=e}get allRecords(){return this[ff]}set allRecords(e){this[ff]=e.slice(0)}undo(){const{store:e,allRecords:n,silent:t}=this;e.add(n,t)}redo(){this.store.removeAll(this.silent)}};gf._$name="RemoveAllAction";var Iv=(e,n,t,s)=>new Ci({model:e,newData:n,oldData:t,isInitialUserAction:s}),Pv=(e,n,t,s)=>new Yh({parentModel:e,childModels:t,insertIndex:n,context:s}),wv=(e,n,t)=>new Zh({parentModel:e,childModels:n,context:t}),Mv=(e,n,t)=>new tf({store:e,modelList:n,silent:t}),xv=(e,n,t,s,r)=>new of({store:e,insertIndex:n,modelList:t,context:s,silent:r}),Tv=(e,n,t,s)=>new df({store:e,modelList:n,context:t,silent:s}),Ov=(e,n,t)=>new gf({store:e,allRecords:n,silent:t}),Ie=(e,n,...t)=>{const s=e.state,r=n.call(e[se],e,...t);if(typeof r=="string")e[se]=$t.resolveStmState(r);else if(r instanceof dr)e[se]=r;else if(Array.isArray(r)){const[i,a]=r;typeof i=="string"?e[se]=$t.resolveStmState(i):i instanceof dr?e[se]=i:i&&typeof i=="object"&&(e=Object.assign(e,i),e[se]=$t.resolveStmState(e[se])),typeof a=="function"&&Ie(e,a,...t)}else r&&typeof r=="object"&&(e=Object.assign(e,r),e[se]=$t.resolveStmState(e[se]));s!==Di&&s!==tl&&r!==Di&&r!==tl&&e.trigger("ready")},kr=class extends Vt($){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:Iv,makeModelInsertChildAction:Pv,makeModelRemoveChildAction:wv,makeStoreModelAddAction:Mv,makeStoreModelInsertAction:xv,makeStoreModelRemoveAction:Tv,makeStoreRemoveAllAction:Ov,getTransactionTitle:null}}construct(...e){Object.assign(this,{[se]:Di,[hr]:[],[Xe]:[],[Rt]:0,[oe]:null,[yt]:null,[It]:!1,[ns]:!1,stashedTransactions:{}}),super.construct(...e)}get state(){return this[se]}get position(){return this[Rt]}get length(){return this[Xe].length}get stores(){return Array.from(this[hr])}hasStore(e){return this[hr].includes(e)}addStore(e){this.hasStore(e)||(this[hr].push(e),e.stm=this,e.forEach(n=>n.stm=this))}removeStore(e){this.hasStore(e)&&(this[hr]=this[hr].filter(n=>n!==e),e.stm=null,e.forEach(n=>n.stm=null))}forEachStore(e){this[hr].forEach(n=>e(n,n.id))}get disabled(){return this.state===yv}set disabled(e){const n=this;n.disabled!==e&&(e?Ie(n,n.state.onDisable,n):Ie(n,n.state.onEnable,n),n.trigger("stmDisabled",{disabled:e}),n.trigger("disabled",{disabled:e}))}get enabled(){return!this.disabled}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===Di||this.state===tl}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===Sv||this.state===Rv}get isApplyingStash(){return this[ns]}get autoRecord(){return this[It]}set autoRecord(e){const n=this;n.autoRecord!=e&&(e?Ie(n,n.state.onAutoRecordOn,n):Ie(n,n.state.onAutoRecordOff,n))}startTransaction(e=null){Ie(this,this.state.onStartTransaction,e)}stopTransaction(e=null){Ie(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){Ie(this,this.state.onStopTransactionDelayed)}rejectTransaction(){Ie(this,this.state.onRejectTransaction)}get transaction(){return this[oe]}get queue(){return this[Xe].map(e=>e.title)}get rawQueue(){return this[Xe]}get isRestoring(){return this.state===Cv||this.isApplyingStash}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(e=1){this.isReady||await this.waitForReadiness(),Ie(this,this.state.onUndo,e)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(e=1){this.isReady||await this.waitForReadiness(),Ie(this,this.state.onRedo,e)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){Ie(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore(n=>{var t;return(t=n.onStmRecordingStart)==null?void 0:t.call(n,this,e)}),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,n){this.forEachStore(t=>{var s;return(s=t.onStmRecordingStop)==null?void 0:s.call(t,this,e,n)}),this.trigger("recordingStop",{stm:this,transaction:e,reason:n})}notifyStoresAboutStateRestoringStart(){this.forEachStore(e=>{var n;return(n=e.onStmRestoringStart)==null?void 0:n.call(e,this)}),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop({cause:e,transactions:n}){this.forEachStore(t=>{var s;return(s=t.onStmRestoringStop)==null?void 0:s.call(t,this)}),this.trigger("restoringStop",{stm:this,cause:e,transactions:n})}notifyStoresAboutQueueReset(e){this.forEachStore(n=>{var t;return(t=n.onStmQueueReset)==null?void 0:t.call(n,this,e)}),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,n,t,s){Ie(this,this.state.onModelUpdate,e,n,t,s)}onModelInsertChild(e,n,t,s){Ie(this,this.state.onModelInsertChild,e,n,t,s)}onModelRemoveChild(e,n,t){Ie(this,this.state.onModelRemoveChild,e,n,t)}onStoreModelAdd(e,n,t){Ie(this,this.state.onStoreModelAdd,e,n,t)}onStoreModelInsert(e,n,t,s,r){Ie(this,this.state.onStoreModelInsert,e,n,t,s,r)}onStoreModelRemove(e,n,t,s){Ie(this,this.state.onStoreModelRemove,e,n,t,s)}onStoreRemoveAll(e,n,t){Ie(this,this.state.onStoreRemoveAll,e,n,t)}onUndoKeyPress(e){const n=this;n.enabled&&(e.shiftKey?n.canRedo&&(e.preventDefault(),n.redo()):n.canUndo&&(e.preventDefault(),n.undo()))}stash(){const e=this;if(this.transaction){const n=wo.generateId("_stashedTransactionGeneratedId_");return e.stashedTransactions[n]=e.transaction,e.rejectTransaction(),n}}applyStash(e){const n=this,t=n.stashedTransactions[e];n[ns]=!0,t&&(n.startTransaction(t.title),t.redo(),delete n.stashedTransactions[e]),n[ns]=!1}};kr._$name="StateTrackingManager";var ss=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},pf=class extends O([ii],e=>{const n=e.prototype;class t extends e{*calculateUnitsInMs(){const r=yield this.$.hoursPerDay,i=yield this.$.daysPerWeek,a=yield this.$.daysPerMonth;return{millisecond:1,second:1e3,minute:60*1e3,hour:60*60*1e3,day:r*60*60*1e3,week:i*r*60*60*1e3,month:a*r*60*60*1e3,quarter:3*a*r*60*60*1e3,year:4*3*a*r*60*60*1e3}}convertDuration(r,i,a){let o=r;return i!==a&&(o=r*this.unitsInMs[i]/this.unitsInMs[a]),o}*$convertDuration(r,i,a){if(!i||!a)throw new Error("Conversion unit not provided");const o=yield this.$.unitsInMs;let l=r;return i!==a&&(l=r*o[i]/o[a]),l}}return ss([q()],t.prototype,"unitsInMs",void 0),ss([B({type:"number",defaultValue:24})],t.prototype,"hoursPerDay",void 0),ss([B({type:"number",defaultValue:7})],t.prototype,"daysPerWeek",void 0),ss([B({type:"number",defaultValue:30})],t.prototype,"daysPerMonth",void 0),ss([j("unitsInMs")],t.prototype,"calculateUnitsInMs",null),t}){},mf=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Ei=class extends O([un],e=>{const n=e.prototype;class t extends e{}return mf([qe({bucket:"assigned",resolver:function(s){return this.getEventById(s)},modelFieldConfig:{serialize:s=>s==null?void 0:s.id,isEqual:ar,persist:!1}},Tr)],t.prototype,"event",void 0),mf([qe({bucket:"assigned",resolver:function(s){return this.getResourceById(s)},modelFieldConfig:{serialize:s=>s==null?void 0:s.id,isEqual:ar,persist:!1}},Tr)],t.prototype,"resource",void 0),ri(t),t}){},nl=class extends O([mt],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(r,i){this.assignmentsForRemoval=yo(r).toSet();const a=n.remove.call(this,r,i);return this.assignmentsForRemoval.clear(),a}removeAll(r){this.allAssignmentsForRemoval=!0;const i=n.removeAll.call(this,r);return this.allAssignmentsForRemoval=!1,i}}return t}){},sl=class extends O([nl,_r],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=100}static get defaultConfig(){return{modelClass:Ei}}set data(r){this.allAssignmentsForRemoval=!0,super.data=r,this.allAssignmentsForRemoval=!1}}return t}){},il=class extends O([mt],e=>{const n=e.prototype;class t extends e{doDestroy(){var r;const i=[];(r=this.rootNode)!=null&&r.isDestroyed||this.traverse(a=>i.push(a)),super.doDestroy(),i.forEach(a=>a.destroy())}}return t}){},al=class extends O([il,_r],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=500}static get defaultConfig(){return{tree:!0,modelClass:hn}}}return t}){},ol=class extends O([mt],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(r,i){this.dependenciesForRemoval=yo(r).toSet();const a=n.remove.call(this,r,i);return this.dependenciesForRemoval.clear(),a}removeAll(r){this.allDependenciesForRemoval=!0;const i=n.removeAll.call(this,r);return this.allDependenciesForRemoval=!1,i}}return t}){},ll=class extends O([ol,_r],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=200}set data(r){this.allDependenciesForRemoval=!0,super.data=r,this.allDependenciesForRemoval=!1}}return t}){},Av=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},bi=class extends O([fi,un],e=>{const n=e.prototype;class t extends e{get assignments(){return[...this.assigned]}leaveProject(r=!1){if(!this.isStmRestoring&&this.assigned&&!r){const i=this.getResourceStore();this.assigned.forEach(a=>i.assignmentsForRemoval.add(a))}n.leaveProject.call(this)}static get fields(){return[{name:"parentId"},{name:"children",persist:!1}]}}return Av([qe({},Or)],t.prototype,"assigned",void 0),t}){},$v={splice:1,clear:1},cl=class extends O([mt],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(r){var i;const a=$v[r.action];super.onDataChange(r),a&&((i=r.removed)!=null&&i.length)&&this.afterResourceRemoval()}remove(r,i){const a=n.remove.call(this,r,i);return this.afterResourceRemoval(),a}removeAll(r){const i=n.removeAll.call(this,r);return this.afterResourceRemoval(),i}afterResourceRemoval(){const r=this.getAssignmentStore();if(r&&!r.allAssignmentsForRemoval){const i=[...this.assignmentsForRemoval].filter(a=>!r.assignmentsForRemoval.has(a));i.length>0&&r.remove(i)}this.assignmentsForRemoval.clear()}processRecord(r,i=!1){const a=this.getById(r.id);if(a&&a!==r)for(const l of a.assigned||[])l.resource=r;return r}}return t}){},ul=class extends O([cl,_r],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=300}static get defaultConfig(){return{modelClass:bi}}}return t}){},_v=class extends O([],Vt){},Fv=class extends O([],Ar){},vf=class extends O([_v,Fv,H],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(r={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const i="silenceInitialCommit"in r?r.silenceInitialCommit:!0,a="adjustDurationToDST"in r?r.adjustDurationToDST:!1;this.maxCalendarRange="maxCalendarRange"in r?r.maxCalendarRange:15768e7,delete r.maxCalendarRange,delete r.silenceInitialCommit,delete r.adjustDurationToDST,n.construct.call(this,r),this.silenceInitialCommit=i,this.adjustDurationToDST=a}repopulateStore(r){}repopulateReplica(){}deferUntilRepopulationIfNeeded(r,i,a){i(...a)}attachStore(r){}detachStore(r){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}return t}){},yf=class extends O([ii,vf],e=>{const n=e.prototype;class t extends e{get isDelayingCalculation(){return!!(this.delayEnteringReplica||this.delayedCalculationPromise)}getGraph(){return this.replica}beforeCommitAsync(){return null}enterReplica(r){}acceptChanges(){}async commitAsync(){var r;return this.delayedCalculationPromise||((r=this.replica)==null?void 0:r.commitAsync())}getSchedulingIssueEventArguments(r,i,a,o){const l=[r.type,{continueWithResolutionResult:a,schedulingIssue:r}];return r instanceof cr&&(l[1].conflict=r),l}async onSchedulingIssueCall(r,i){return r.type&&this.hasListener(r.type)?new Promise((a,o)=>{this.trigger(...this.getSchedulingIssueEventArguments(r,i,a,o))}):bt.Cancel}async onCycleSchedulingIssue(r,i){return this.onSchedulingIssueCall(r,i)}async onEmptyCalendarSchedulingIssue(r,i){return this.onSchedulingIssueCall(r,i)}async onConflictSchedulingIssue(r,i){return this.onSchedulingIssueCall(r,i)}setModelCalculations(r,i){if(!i)return;const a={};for(const o in i)a[o]=r.prototype.$calculations[o];return Object.assign(r.prototype.$calculations,i),a}setRecordCalculations(r,i){const a=this.setModelCalculations(r.constructor,i),o=r.$entity.$skeleton;return Object.keys(i).forEach(l=>{o[l].prototype.calculation=r[i[l]]}),a}setStoreCalculations(r,i){if(!i)return;const a=r.first;return a?this.setRecordCalculations(a,i):this.setModelCalculations(r.modelClass,i)}async setCalculations(r){this.replica&&await this.commitAsync();const i={},a={tasks:this.eventStore,events:this.eventStore,dependencies:this.dependencyStore,resources:this.resourceStore,assignments:this.assignmentStore,calendars:this.calendarManagerStore};Object.keys(a).forEach(l=>{r[l]&&(i[l]=this.setStoreCalculations(a[l],r[l]))});let o=r.project;return o&&(i.project=this.setRecordCalculations(this,o)),this.replica&&this.repopulateReplica.now(),this.replica&&await this.commitAsync(),i}}return t}){},is=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},dl=class extends O([un],e=>{const n=e.prototype;class t extends e{get isValid(){const{$:r,graph:i}=this;return i&&(!i.hasIdentifier(r.fromEvent)||!i.hasIdentifier(r.toEvent))?!1:super.isValid}}return is([qe({bucket:"outgoingDeps",resolver:function(s){return this.getEventById(s)},modelFieldConfig:{persist:!0,serialize:s=>s==null?void 0:s.id,isEqual:ar}},Tr)],t.prototype,"fromEvent",void 0),is([qe({bucket:"incomingDeps",resolver:function(s){return this.getEventById(s)},modelFieldConfig:{persist:!0,serialize:s=>s==null?void 0:s.id,isEqual:ar}},Tr)],t.prototype,"toEvent",void 0),is([B({type:"int",defaultValue:_e.EndToStart})],t.prototype,"type",void 0),is([B({type:"string"})],t.prototype,"fromSide",void 0),is([B({type:"string"})],t.prototype,"toSide",void 0),t}){},Sf=class{constructor(){this.ongoing=Promise.resolve(),this.handleReject=()=>{}}queue(e,n=this.handleReject){const t=this.ongoing.then(e);return this.ongoing=t.catch(n),t}};Sf._$name="Queue";var Ri=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Df=class extends _a([yf,or,vi,fi,pf,Eh],e=>{const n=e.prototype;class t extends e{construct(r={}){this.delayCalculation=r.delayCalculation!==!1,this.enableProgressNotifications=r.enableProgressNotifications||r.delayCalculation!==!1,this._queue=new Sf,"expanded"in r||(r.expanded=!0),this.delayCalculation&&(this.delayEnteringReplica=!0),"skipNonWorkingTimeWhenSchedulingManually"in r||(r.skipNonWorkingTimeWhenSchedulingManually=!1),n.construct.call(this,r),this.repopulateStores=new Set,this.ignoreInitialCommitComputationCycles="ignoreInitialCommitComputationCycles"in r?r.ignoreInitialCommitComputationCycles:!1,this.ignoreInitialCommitComputationCycles&&console.warn('Project "ignoreInitialCommitComputationCycles" option is deprecated and will be dropped in the next major release'),this.eventModelClass||(this.eventModelClass=this.getDefaultEventModelClass()),this.eventStoreClass||(this.eventStoreClass=this.getDefaultEventStoreClass()),this.dependencyModelClass||(this.dependencyModelClass=this.getDefaultDependencyModelClass()),this.dependencyStoreClass||(this.dependencyStoreClass=this.getDefaultDependencyStoreClass()),this.resourceModelClass||(this.resourceModelClass=this.getDefaultResourceModelClass()),this.resourceStoreClass||(this.resourceStoreClass=this.getDefaultResourceStoreClass()),this.assignmentModelClass||(this.assignmentModelClass=this.getDefaultAssignmentModelClass()),this.assignmentStoreClass||(this.assignmentStoreClass=this.getDefaultAssignmentStoreClass()),this.calendarModelClass||(this.calendarModelClass=this.getDefaultCalendarModelClass()),this.calendarManagerStoreClass||(this.calendarManagerStoreClass=this.getDefaultCalendarManagerStoreClass()),this.cycleEffectClass||(this.cycleEffectClass=this.getDefaultCycleEffectClass()),this.initializeStm(),this.defaultCalendar=new this.calendarModelClass({unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this,this.delayEnteringReplica||this.enterReplica(!1),this.setCalendarManagerStore(this.calendarManagerStore),this.setEventStore(this.eventStore),this.setDependencyStore(this.dependencyStore),this.setResourceStore(this.resourceStore),this.setAssignmentStore(this.assignmentStore),!!(this.calendarsData||this.eventsData||this.dependenciesData||this.resourcesData||this.assignmentsData)?(this.loadInlineData({calendarsData:this.calendarsData,eventsData:this.eventsData,dependenciesData:this.dependenciesData,resourcesData:this.resourcesData,assignmentsData:this.assignmentsData}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData):this.delayCalculation&&this.hasDataInStores&&this.scheduleDelayedCalculation()}get hasDataInStores(){return[this.calendarManagerStore,this.eventStore,this.dependencyStore,this.resourceStore,this.assignmentStore].some(r=>r.allCount>0)}enterReplica(r){const i=this;i.replica||(i.replica=i.createReplica(),i.replica.addEntity(i),i.replica.addEntity(i.defaultCalendar),i.trigger("graphReady")),r&&!i.isRepopulatingStores&&(i.calendarManagerStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),i.eventStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),i.resourceStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),i.dependencyStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),i.assignmentStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}))}resetStmQueue(){const r=this.stm.disabled;this.stm.disable(),this.stm.resetQueue(),r||this.stm.enable()}doDestroy(){var r,i,a,o,l,c,u,d;const h=this;(r=h.eventStore)==null||r.destroy(),(i=h.dependencyStore)==null||i.destroy(),(a=h.assignmentStore)==null||a.destroy(),(o=h.resourceStore)==null||o.destroy(),(l=h.calendarManagerStore)==null||l.destroy(),(c=h.defaultCalendar)==null||c.destroy(),(u=h.replica)==null||u.clear(),(d=h.stm)==null||d.destroy(),n.doDestroy.call(this)}getReplicaConfig(){return{project:this,schema:Oh.new(),enableProgressNotifications:this.enableProgressNotifications,silenceInitialCommit:this.silenceInitialCommit,ignoreInitialCommitComputationCycles:this.ignoreInitialCommitComputationCycles,cycleEffectClass:this.cycleEffectClass,onWriteDuringCommit:"ignore",readMode:Lt.CurrentOrProposedOrPrevious}}createReplica(){return wh.mix(Na).new(this.getReplicaConfig())}*hasSubEvents(){return this.getEventStore().count>0}*subEventsIterable(){return this.getEventStore().getRange()}getType(){return tn.SchedulerBasic}get enableProgressNotifications(){return this._enableProgressNotifications}set enableProgressNotifications(r){this._enableProgressNotifications=r,this.replica&&(this.replica.enableProgressNotifications=r)}getDefaultCycleEffectClass(){return jr}getDefaultEventModelClass(){return gi}getDefaultEventStoreClass(){return rs}getDefaultDependencyModelClass(){return dl}getDefaultDependencyStoreClass(){return ll}getDefaultResourceModelClass(){return bi}getDefaultResourceStoreClass(){return ul}getDefaultAssignmentModelClass(){return Ei}getDefaultAssignmentStoreClass(){return sl}getDefaultCalendarModelClass(){return hn}getDefaultCalendarManagerStoreClass(){return al}usingSyncDataOnLoad(){return[this.eventStore,this.resourceStore,this.dependencyStore,this.assignmentStore].some(r=>r.syncDataOnLoad)}async loadInlineData(r){const{calendarManagerStore:i,eventStore:a,dependencyStore:o,assignmentStore:l,resourceStore:c,replica:u}=this;if(!this.isInitialCommitPerformed)u==null||u.unScheduleAutoCommit();else for(;this.replica.isCommitting;)await this.commitAsync();u!=null&&u.enableProgressNotifications&&!this.delayCalculation&&(await Rn(0),await this.commitAsync(),u.onPropagationProgressNotification({total:0,remaining:0,phase:"storePopulation"}),await Rn(50)),this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!0,globalThis.DEBUG&&(console.log("%cInitializing project","font-weight:bold;color:darkgreen;text-transform:uppercase;margin-top: 2em"),console.time("Time to visible"),console.time("Populating project")),this.delayCalculation&&!this.delayedCalculationPromise&&!this.usingSyncDataOnLoad()&&this.scheduleDelayedCalculation(),r.calendarsData&&(this.repopulateStore(i),i.data=r.calendarsData),(r.eventsData||r.tasksData)&&(this.repopulateStore(a),a.data=r.eventsData||r.tasksData),r.dependenciesData&&(this.repopulateStore(o),o.data=r.dependenciesData),r.resourcesData&&(this.repopulateStore(c),c.data=r.resourcesData),r.assignmentsData&&(this.repopulateStore(l),l.data=r.assignmentsData),r.project&&this.applyProjectResponse(r.project),globalThis.DEBUG&&console.timeEnd("Populating project");const d=await this.commitLoad();return this.isLoadingInlineData=!1,d}setupTemporaryIndices(){const{storage:r}=this.assignmentStore||{};r&&(r.addIndex({property:"event",unique:!1}),r.addIndex({property:"resource",unique:!1}))}removeTemporaryIndices(){const{storage:r}=this.assignmentStore;r.removeIndex("event"),r.removeIndex("resource")}async internalDelayCalculation(r){const i=this;if(i.delayEnteringReplica=!0,i.setupTemporaryIndices(),await Rn(0),i.isDestroyed){r();return}if(i.trigger("delayCalculationStart"),i.trigger("refresh",{isCalculated:!1}),await Rn(0),i.isDestroyed){r();return}i.delayEnteringReplica=!1,i.isRepopulatingStores?i.repopulateReplica.now():(i.trigger("recordsUnlinked"),i.enterReplica(!0));const a=await i.replica.commitAsync();if(i.isDestroyed){r();return}r(a),i.delayedCalculationPromise=null,i.trigger("delayCalculationEnd"),i.removeTemporaryIndices()}scheduleDelayedCalculation(){if(this.delayedCalculationPromise)return this.delayedCalculationPromise;if(this.delayCalculation!==!1)return this.delayedCalculationPromise=new Promise(r=>this.internalDelayCalculation(r).then())}async commitLoad(){const r=await this.commitAsync();return this.isDestroyed||this.trigger("load"),r}initializeStm(){const r=this.stmClass||kr;this.stm instanceof kr||this.setStm(r.new({disabled:!0},this.stm)),this.resetUndoRedoQueuesAfterLoad&&this.ion({load:this.resetStmQueue,thisObj:this}),this.ion({beforeCommit:this.onCommitInitialization,commitFinalized:this.onCommitFinalization,commitRejected:this.onCommitRejection,thisObj:this})}removeRejectedRecordsAdd({transactionResult:r,silenceCommit:i}){var a,o,l;const c=new Map;for(const d of r.entries.values()){const h=d.identifier,{field:f}=h;if(d.isShadow()||!h[ei]||f instanceof Or)continue;const g=h.self,p=g.firstStore;p&&!d.previous&&!((a=r.transaction.getLatestStableEntryFor(g.$$))!=null&&a.previous)&&(c.has(p)?c.get(p).has(g)||c.get(p).add(g):c.set(p,new Set([g])))}(o=this.suspendChangesTracking)==null||o.call(this),Array.from(c.keys()).sort((d,h)=>d.removalOrder-h.removalOrder).forEach(d=>d.remove(c.get(d))),(l=this.resumeChangesTracking)==null||l.call(this,i),i&&(this.eventStore.acceptChanges(),this.dependencyStore.acceptChanges(),this.resourceStore.acceptChanges(),this.assignmentStore.acceptChanges(),this.calendarManagerStore.acceptChanges())}onCommitRejection(r){this._stmDisabled?(this.replica.isWritingPreviousData=!0,this.isRestoringData=!0,this.removeRejectedRecordsAdd(r),this.isRestoringData=!1,this.replica.isWritingPreviousData=!1):this.rejectStmTransaction()}onCommitInitialization(){const{stm:r}=this;this._stmDisabled=r.disabled,r.isRecording&&r.autoRecord&&(this._stmAutoRecord=!0,r.autoRecord=!1)}onCommitFinalization(){this._stmAutoRecord&&(this.stm.autoRecord=!0,this._stmAutoRecord=!1)}onSTMRestoringStart({source:r}){this.replica&&(this.replica.isWritingPreviousData=!0)}async onSTMRestoringStop({source:r}){this.replica&&(this.replica.isWritingPreviousData=!1);const i=r;i.disable(),await this.commitAsync(),this.isDestroyed||(i.enable(),this.trigger("stateRestoringDone"))}deferUntilRepopulationIfNeeded(r,i,a){this.isRepopulatingStores?(this.detachListeners(r),this.ion({name:r,repopulateReplica:{fn:async()=>{await this.commitAsync(),this.isDestroyed||i(...a)},once:!0}})):i(...a)}get isRepopulatingStores(){var r;return!!((r=this.repopulateStores)!=null&&r.size)}repopulateStore(r){var i;const a=this;a.repopulateOnDataset&&r.allCount&&!r.syncDataOnLoad&&((i=a.replica)==null||i.activeTransaction.stop(),a.repopulateStores||(a.repopulateStores=new Set),a.repopulateStores.add(r),a.repopulateReplica())}repopulateReplica(){const r=this;if(r.delayEnteringReplica)return;const{calendarManagerStore:i,eventStore:a,dependencyStore:o,assignmentStore:l,resourceStore:c,replica:u}=r;u?(r.unlinkStoreRecords(i,a,o,c,l),r.unlinkRecord(r),r.unlinkRecord(r.defaultCalendar),r.trigger("recordsUnlinked"),u.clear()):r.trigger("recordsUnlinked");const d=r.replica=r.createReplica();d.addEntity(r),d.addEntity(r.defaultCalendar),r.joinStoreRecords(i,!0),r.joinStoreRecords(a,!0),r.joinStoreRecords(o,!0),r.joinStoreRecords(c,!0),r.joinStoreRecords(l,!0),r.repopulateStores.clear(),r.trigger("repopulateReplica")}beforeCommitAsync(){return this.repopulateReplica.isPending&&!this.isDelayingCalculation?(this.repopulateReplica.now(),this.replica.commitAsync()):null}unlinkRecord(r){var i;if(r!=null&&r.graph){const{activeTransaction:a}=this.replica,{$:o}=r,l=Object.keys(o);for(let c=0;c<l.length;c++){const u=l[c],d=o[u],h=a.getLatestEntryFor(d);if(h){let f=h.getValue();f===void 0&&(f=h.proposedValue),f!==void 0&&(d.DATA=d.field instanceof Tr&&(i=f==null?void 0:f.id)!=null?i:f)}}r.graph=null}}unlinkStoreRecords(...r){r.forEach(i=>{(!this.repopulateStores.has(i)||i.syncDataOnLoad)&&i.traverse(a=>{this.unlinkRecord(a)},!1,!1,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})})}getGraph(){return this.replica}async addEvents(r){return this.eventStore.add(r),this.commitAsync()}async addEvent(r){return this.eventStore.add(r),this.commitAsync()}includeEvent(r){this.eventStore.add(r)}async removeEvents(r){return this.eventStore.remove(r),this.commitAsync()}excludeEvent(r){this.eventStore.remove(r)}async removeEvent(r){return this.eventStore.remove(r),this.commitAsync()}getStm(){return this.stm}setStm(r){this.stm=r,this.stm.ion({restoringStart:this.onSTMRestoringStart,restoringStop:this.onSTMRestoringStop,thisObj:this})}calculateProject(){return this}*calculateEffectiveCalendar(){let r=yield this.$.calendar;return r?yield r.$.version:r=this.defaultCalendar,r}joinStoreRecords(r,i=!1){const a=o=>{o.setProject(this),o.joinProject()};r.rootNode?r.rootNode.traverse(a,i,!0):r.forEach(a,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}unjoinStoreRecords(r){const i=a=>{a.leaveProject(),a.setProject(this)};r.rootNode?r.rootNode.traverse(a=>{a!==r.rootNode&&i(a)},!1,!0):r.forEach(i,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}setEventStore(r){const i=this.eventStore;if(i&&this.stm.hasStore(i)){this.stm.removeStore(i),this.unjoinStoreRecords(i),this.detachStore(i);const a=i.assignmentsForRemoval;a.forEach(o=>{const l=o.event;if(l){const c=r.getById(l.id);c&&(o.event=c,a.delete(o))}}),i.afterEventRemoval()}if(!r||!(r instanceof K)){const a=(r==null?void 0:r.storeClass)||this.eventStoreClass;this.eventStore=new a(x.assign({modelClass:this.eventModelClass,project:this,stm:this.stm},r||{}))}else this.eventStore=r,r.setProject(this),this.stm.addStore(r),r.tree&&r.rootNode!==this?(this.appendChild(r.rootNode.children||[]),r.rootNode=this):this.joinStoreRecords(r);this.attachStore(this.eventStore),this.trigger("eventStoreChange",{store:this.eventStore})}setDependencyStore(r){const i=this.dependencyStore;if(i&&this.stm.hasStore(i)&&(this.stm.removeStore(i),this.detachStore(i)),!r||!(r instanceof K)){const a=(r==null?void 0:r.storeClass)||this.dependencyStoreClass;this.dependencyStore=new a(x.assign({modelClass:this.dependencyModelClass,project:this,stm:this.stm},r||{}))}else this.dependencyStore=r,r.setProject(this),this.stm.addStore(r),this.joinStoreRecords(r);this.attachStore(this.dependencyStore),this.trigger("dependencyStoreChange",{store:this.dependencyStore})}setResourceStore(r){const i=this.resourceStore;if(i&&this.stm.hasStore(i)){this.stm.removeStore(i),this.unjoinStoreRecords(i),this.detachStore(i);const a=i.assignmentsForRemoval;a.forEach(o=>{const l=o.resource;if(l){const c=r.getById(l.id);c&&(o.resource=c,a.delete(o))}}),i.afterResourceRemoval()}if(!r||!(r instanceof K)){const a=(r==null?void 0:r.storeClass)||this.resourceStoreClass;this.resourceStore=new a(x.assign({modelClass:this.resourceModelClass,project:this,stm:this.stm},r||{}))}else this.resourceStore=r,r.setProject(this),this.stm.addStore(r),this.joinStoreRecords(r);this.attachStore(this.resourceStore),this.trigger("resourceStoreChange",{store:this.resourceStore})}setAssignmentStore(r){const i=this.assignmentStore;if(i&&this.stm.hasStore(i)&&(this.stm.removeStore(i),this.unjoinStoreRecords(i),this.detachStore(i)),!r||!(r instanceof K)){const a=(r==null?void 0:r.storeClass)||this.assignmentStoreClass;this.assignmentStore=new a(x.assign({modelClass:this.assignmentModelClass,project:this,stm:this.stm},r||{}))}else this.assignmentStore=r,r.setProject(this),this.stm.addStore(r),this.joinStoreRecords(r);this.isDelayingCalculation&&this.setupTemporaryIndices(),this.attachStore(this.assignmentStore),this.trigger("assignmentStoreChange",{store:this.assignmentStore})}setCalendarManagerStore(r){const i=this.calendarManagerStore;if(i&&this.stm.hasStore(i)&&(this.stm.removeStore(i),this.detachStore(i)),!r||!(r instanceof K)){const a=(r==null?void 0:r.storeClass)||this.calendarManagerStoreClass;this.calendarManagerStore=new a(x.assign({modelClass:this.calendarModelClass,project:this,stm:this.stm},r||{}))}else this.calendarManagerStore=r,r&&(r.setProject(this),this.stm.addStore(r),this.joinStoreRecords(r));this.attachStore(this.calendarManagerStore),this.trigger("calendarManagerStoreChange",{store:this.calendarManagerStore})}async isValidDependency(...r){return!0}rejectStmTransaction(r){r=r||this.stm,r.transaction&&(r.transaction.length?(r.forEachStore(i=>i.beginBatch()),r.rejectTransaction(),r.forEachStore(i=>i.endBatch())):r.stopTransaction())}async tryPropagateWithChanges(r){const i=this.stm,a=i.disabled,o=i.autoRecord;return this.queue(async()=>{a?i.enable():(o&&(i.autoRecord=!1),i.isRecording&&i.stopTransaction()),i.startTransaction(),r();let l=!0;try{l=!(await this.commitAsync()).rejectedWith}catch(c){if(!/cycle/i.test(c))throw c;l=!1}return l?(i.stopTransaction(),a&&i.resetQueue()):(this.replica.reject(),this.rejectStmTransaction(i)),i.disabled=a,i.autoRecord=o,l})}queue(r,i){return this._queue.queue(function(){return r()},i)}isEngineReady(){const{replica:r}=this;return this.delayEnteringReplica||!this.isRepopulatingStores&&(r?!(r.dirty&&(r.hasPendingAutoCommit()||r.isCommitting)):!0)}static get defaultConfig(){return{assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null,eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null,calendarManagerStore:null,eventModelClass:null,resourceModelClass:null,assignmentModelClass:null,dependencyModelClass:null,calendarModelClass:null,repopulateOnDataset:!0}}static get delayable(){return{repopulateReplica:10}}}return t.applyConfigs=!0,Ri([B({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),Ri([B({type:"boolean",defaultValue:!1})],t.prototype,"skipNonWorkingTimeWhenSchedulingManually",void 0),Ri([B({type:"boolean",defaultValue:!0})],t.prototype,"skipNonWorkingTimeInDurationWhenSchedulingManually",void 0),Ri([B({type:"string",defaultValue:L.Forward},{sync:!0})],t.prototype,"direction",void 0),t}){},le=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Cf=function*(e,n,t,s,r){if(t.isIntervalEmpty())return t;if(r&&t.intersectionOf){const o=new Set;for(const l of t.intersectionOf)if(l.isInfinite())o.add(l);else{const c=l.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.startDate,!1,s):l.startDate,u=l.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.endDate,!1,s):l.endDate,d=l;o.add(d.copyWith({reflectionOf:d,side:d.side===ce.Start?ce.End:ce.Start,startDate:c,endDate:u}))}t.intersectionOf=o}const i=t.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.startDate,!1,s):null,a=t.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.endDate,!1,s):null;return lr([n,ur.new({intersectionOf:t.intersectionOf,startDate:i,endDate:a})],r)},Ef=function*(e,n,t,s,r){if(n.isIntervalEmpty())return n;if(r){const o=new Set;for(const l of n.intersectionOf)if(l.isInfinite())o.add(l);else{const c=l.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.startDate,!0,s):l.startDate,u=l.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.endDate,!0,s):l.endDate,d=l;o.add(d.copyWith({reflectionOf:d,side:d.side===ce.Start?ce.End:ce.Start,startDate:c,endDate:u}))}n.intersectionOf=o}const i=n.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(n.startDate,!0,s):null,a=n.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(n.endDate,!0,s):null;return lr([t,ur.new({reflectionOf:i||a?n:void 0,intersectionOf:i||a?n.intersectionOf:void 0,startDate:i,endDate:a})],r)},Ee=!0,Lr=class extends O([vi],e=>{const n=e.prototype;class t extends e{*maybeSkipNonWorkingTime(r,i=!0){if(yield*this.hasSubEvents())return r;let a=yield*this.calculateEffectiveDuration();return r&&a>0?yield*this.skipNonWorkingTime(r,i):r}*calculateEffectiveConstraintInterval(r,i,a,o=!1){const l=yield*this.calculateEffectiveDuration();return l==null?null:yield*(r?Cf:Ef)(this,lr(i,o),lr(a,o),l,o)}*calculateStartDateConstraintIntervals(){return[]}*calculateEndDateConstraintIntervals(){return[]}*calculateEarlyStartDateConstraintIntervals(){return[]}*calculateEarlyEndDateConstraintIntervals(){return[]}*doCalculateEarlyEffectiveStartDateInterval(r=!1){const i=yield this.$.earlyStartDateConstraintIntervals,a=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!0,i.concat(yield this.$.startDateConstraintIntervals),a.concat(yield this.$.endDateConstraintIntervals),r)}*calculateEarlyEffectiveStartDateInterval(){return yield*this.doCalculateEarlyEffectiveStartDateInterval()}*doCalculateEarlyEffectiveEndDateInterval(r=!1){const i=yield this.$.earlyStartDateConstraintIntervals,a=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!1,i.concat(yield this.$.startDateConstraintIntervals),a.concat(yield this.$.endDateConstraintIntervals),r)}*calculateEarlyEffectiveEndDateInterval(){return yield*this.doCalculateEarlyEffectiveEndDateInterval()}*shouldRollupChildEarlyStartDate(r){return!0}*calculateMinChildrenEarlyStartDate(){let r=ae;const i=yield*this.subEventsIterable();for(let a of i){let o;(yield*this.shouldRollupChildEarlyStartDate(a))&&((yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.minChildrenEarlyStartDate),o=o||(yield a.$.earlyStartDate),o&&o<r&&(r=o))}return r.getTime()-ae.getTime()?r:null}*shouldRollupChildEarlyEndDate(r){return!0}*calculateMaxChildrenEarlyEndDate(){let r=he;const i=yield*this.subEventsIterable();for(let a of i){let o;(yield*this.shouldRollupChildEarlyEndDate(a))&&((yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.maxChildrenEarlyEndDate),o=o||(yield a.$.earlyEndDate),o&&o>r&&(r=o))}return r.getTime()-he.getTime()?r:null}*calculateEarlyStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Forward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenEarlyStartDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.startDate;let r=yield this.$.earlyEffectiveStartDateInterval;if(r===null)return null;if(r.isIntervalEmpty()){r=yield*this.doCalculateEarlyEffectiveStartDateInterval(!0);const i=cr.new({intervals:[...r.intersectionOf]});if((yield i)===bt.Cancel)yield kt(i);else return null}return Bt(r.startDate)?r.startDate:null}*calculateEarlyStartDate(){const r=yield this.$.earlyStartDateRaw;return yield*this.maybeSkipNonWorkingTime(r,!0)}*calculateEarlyEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Forward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenEarlyEndDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.endDate;let r=yield this.$.earlyEffectiveEndDateInterval;if(r===null)return null;if(r.isIntervalEmpty()){r=yield*this.doCalculateEarlyEffectiveEndDateInterval(!0);const i=cr.new({intervals:[...r.intersectionOf]});if((yield i)===bt.Cancel)yield kt(i);else return null}return Bt(r.startDate)?r.startDate:null}*calculateEarlyEndDate(){return yield this.$.earlyEndDateRaw}*isConstrainedEarly(){const r=yield this.$.startDateConstraintIntervals,i=yield this.$.endDateConstraintIntervals,a=yield this.$.earlyStartDateConstraintIntervals,o=yield this.$.earlyEndDateConstraintIntervals;return!!(r!=null&&r.length||i!=null&&i.length||a!=null&&a.length||o!=null&&o.length)}*calculateStartDatePure(){return(yield this.$.effectiveDirection).direction===L.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateStartDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():(yield this.$.earlyStartDate)||(yield*n.calculateStartDatePure.call(this)):yield*n.calculateStartDatePure.call(this)}*calculateStartDateProposed(){switch((yield this.$.effectiveDirection).direction){case L.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*n.calculateStartDateProposed.call(this);if(yield*this.hasSubEvents())return yield*this.calculateMinChildrenStartDate();const i=yield this.$.earlyStartDate;if(i){if(Bt(i))return i;const a=yield*n.calculateStartDateProposed.call(this),o=yield this.$.earlyEffectiveStartDateInterval;return o.containsDate(a)?a:Bt(o.endDate)?o.endDate:a}else return yield*n.calculateStartDateProposed.call(this);default:return yield*n.calculateStartDateProposed.call(this)}}*calculateEndDatePure(){return(yield this.$.effectiveDirection).direction===L.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateEndDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():(yield this.$.earlyEndDate)||(yield*n.calculateEndDatePure.call(this)):yield*n.calculateEndDatePure.call(this)}*calculateEndDateProposed(){switch((yield this.$.effectiveDirection).direction){case L.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*n.calculateEndDateProposed.call(this);if(yield*this.hasSubEvents())return yield*this.calculateMaxChildrenEndDate();const i=yield this.$.earlyEndDate;if(i){if(Bt(i))return i;const a=yield*n.calculateEndDateProposed.call(this),o=yield this.$.earlyEffectiveEndDateInterval;return o.containsDate(a)?a:Bt(o.endDate)?o.endDate:a}else return yield*n.calculateEndDateProposed.call(this);default:return yield*n.calculateEndDateProposed.call(this)}}}return le([q({lazy:Ee})],t.prototype,"minChildrenEarlyStartDate",void 0),le([q({lazy:Ee})],t.prototype,"earlyStartDateRaw",void 0),le([B({type:"date",persist:!1},{lazy:Ee,converter:zt,persistent:!1})],t.prototype,"earlyStartDate",void 0),le([q({lazy:Ee})],t.prototype,"maxChildrenEarlyEndDate",void 0),le([q({lazy:Ee})],t.prototype,"earlyEndDateRaw",void 0),le([B({type:"date",persist:!1},{lazy:Ee,converter:zt,persistent:!1})],t.prototype,"earlyEndDate",void 0),le([q()],t.prototype,"startDateConstraintIntervals",void 0),le([q()],t.prototype,"endDateConstraintIntervals",void 0),le([q({lazy:Ee})],t.prototype,"earlyStartDateConstraintIntervals",void 0),le([q({lazy:Ee})],t.prototype,"earlyEndDateConstraintIntervals",void 0),le([q()],t.prototype,"earlyEffectiveStartDateInterval",void 0),le([q()],t.prototype,"earlyEffectiveEndDateInterval",void 0),le([j("startDateConstraintIntervals")],t.prototype,"calculateStartDateConstraintIntervals",null),le([j("endDateConstraintIntervals")],t.prototype,"calculateEndDateConstraintIntervals",null),le([j("earlyStartDateConstraintIntervals")],t.prototype,"calculateEarlyStartDateConstraintIntervals",null),le([j("earlyEndDateConstraintIntervals")],t.prototype,"calculateEarlyEndDateConstraintIntervals",null),le([j("earlyEffectiveStartDateInterval")],t.prototype,"calculateEarlyEffectiveStartDateInterval",null),le([j("earlyEffectiveEndDateInterval")],t.prototype,"calculateEarlyEffectiveEndDateInterval",null),le([j("minChildrenEarlyStartDate")],t.prototype,"calculateMinChildrenEarlyStartDate",null),le([j("maxChildrenEarlyEndDate")],t.prototype,"calculateMaxChildrenEarlyEndDate",null),le([j("earlyStartDateRaw")],t.prototype,"calculateEarlyStartDateRaw",null),le([j("earlyStartDate")],t.prototype,"calculateEarlyStartDate",null),le([j("earlyEndDateRaw")],t.prototype,"calculateEarlyEndDateRaw",null),le([j("earlyEndDate")],t.prototype,"calculateEarlyEndDate",null),t}){},fr=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},hl=class extends O([Lr,Gt],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.ignorePinningConstraint=!1}writeStartDate(r,i,a,o,l=!0){const c=this.getProject();if(c!=null&&c.addConstraintOnDateSet&&i.graph.hasIdentifier(this.$.effectiveDirection)&&!(c!=null&&c.eventStore.isSyncingDataOnLoad)&&!this.isReverting&&!(c!=null&&c.getStm().isRestoring)){const u=this.getStartDatePinConstraintType();u&&(this.constraintDate=o,this.constraintType=u)}return n.writeStartDate.call(this,r,i,a,o,l)}writeEndDate(r,i,a,o,l=!1){const c=this.getProject();if(c!=null&&c.addConstraintOnDateSet&&i.graph.hasIdentifier(this.$.direction)&&l&&!(c!=null&&c.eventStore.isSyncingDataOnLoad)&&!(c!=null&&c.getStm().isRestoring)){const u=this.getEndDatePinConstraintType();u&&(this.constraintDate=o,this.constraintType=u)}return n.writeEndDate.call(this,r,i,a,o,l)}writeConstraintType(r,i,a,o,l=!1){const c=this.getProject();!l&&!r.isWritingUndefined&&c.includeAsapAlapAsConstraints&&(o!==N.AsSoonAsPossible&&o!==N.AsLateAsPossible?i.baseRevision.hasIdentifier(r)&&this.$.direction.write.call(this,this.$.direction,i,void 0,null,!0):(this.$.direction.write.call(this,this.$.direction,i,void 0,o===N.AsSoonAsPossible?L.Forward:L.Backward,!0),this.$.constraintDate.write.call(this,this.$.constraintDate,i,void 0,null))),r.constructor.prototype.write.call(this,r,i,a,o)}writeDirection(r,i,a,o,l=!1){const c=this.getProject();!l&&!r.isWritingUndefined&&c.includeAsapAlapAsConstraints&&(o||i.baseRevision.hasIdentifier(r))&&this.$.constraintType.write.call(this,this.$.constraintType,i,void 0,o===L.Forward?N.AsSoonAsPossible:o===L.Backward?N.AsLateAsPossible:null,!0),r.constructor.prototype.write.call(this,r,i,a,o)}*calculateConstraintType(){let r=yield X;return(yield*this.isConstraintTypeApplicable(r))||(r=null),r}*calculateConstraintDate(r){let i=yield X;const a=yield this.$.constraintType;return a?i||(i=this.getConstraintTypeDefaultDate(r,a)):i=null,i}getStartDatePinConstraintType(){const{effectiveDirection:r}=this.project;if(!this.isTaskPinnableWithConstraint())return null;switch(r.direction){case L.Forward:return N.StartNoEarlierThan;case L.Backward:return N.StartNoLaterThan}}getEndDatePinConstraintType(){const{effectiveDirection:r}=this.project;if(!this.isTaskPinnableWithConstraint())return null;switch(r.direction){case L.Forward:return N.FinishNoEarlierThan;case L.Backward:return N.FinishNoLaterThan}}isTaskPinnableWithConstraint(){const{manuallyScheduled:r,ignorePinningConstraint:i,constraintType:a}=this;let o=!1;if(!r&&!i)if(a)switch(a){case N.AsSoonAsPossible:case N.AsLateAsPossible:case N.StartNoEarlierThan:case N.StartNoLaterThan:case N.FinishNoEarlierThan:case N.FinishNoLaterThan:o=!0}else o=!0;return o}applyChangeset(r,i,a){this.ignorePinningConstraint=a;const o=super.applyChangeset(r,i,a);return this.ignorePinningConstraint=!1,o}getConstraintTypeDefaultDate(r,i){switch(i){case N.StartNoEarlierThan:case N.StartNoLaterThan:case N.MustStartOn:return r(pe(this.$.startDate));case N.FinishNoEarlierThan:case N.FinishNoLaterThan:case N.MustFinishOn:return r(pe(this.$.endDate))}return null}*isConstraintTypeApplicable(r){const i=yield*this.hasSubEvents();switch(r){case N.FinishNoEarlierThan:case N.StartNoLaterThan:case N.MustFinishOn:case N.MustStartOn:return!i}return!0}async setConstraint(r,i){return this.constraintType=r,i!==void 0&&(this.constraintDate=i),this.commitAsync()}*calculateEndDateConstraintIntervals(){const r=yield*n.calculateEndDateConstraintIntervals.call(this),i=yield this.$.manuallyScheduled,a=yield this.$.constraintType,o=yield this.$.constraintDate,l=this.project.dateConstraintIntervalClass;if(!i&&a&&o)switch(a){case N.MustFinishOn:r.unshift(l.new({owner:this,side:ce.End,startDate:o,endDate:o}));break;case N.FinishNoEarlierThan:r.unshift(l.new({owner:this,side:ce.End,startDate:o}));break;case N.FinishNoLaterThan:r.unshift(l.new({owner:this,side:ce.End,endDate:o}));break}return r}*calculateStartDateConstraintIntervals(){const r=yield*n.calculateStartDateConstraintIntervals.call(this),i=yield this.$.manuallyScheduled,a=yield this.$.constraintType,o=yield this.$.constraintDate,l=this.project.dateConstraintIntervalClass;if(!i&&a&&o)switch(a){case N.MustStartOn:r.unshift(l.new({owner:this,side:ce.Start,startDate:o,endDate:o}));break;case N.StartNoEarlierThan:r.unshift(l.new({owner:this,side:ce.Start,startDate:o}));break;case N.StartNoLaterThan:r.unshift(l.new({owner:this,side:ce.Start,endDate:o}));break}return r}}return fr([B({type:"string"},{sync:!0})],t.prototype,"constraintType",void 0),fr([B({type:"date"},{converter:zt,sync:!0})],t.prototype,"constraintDate",void 0),fr([dt("constraintType")],t.prototype,"writeConstraintType",null),fr([dt("direction")],t.prototype,"writeDirection",null),fr([j("constraintType")],t.prototype,"calculateConstraintType",null),fr([j("constraintDate")],t.prototype,"calculateConstraintDate",null),t}){},bf=class extends gt(mi){static get $name(){return"RemoveDateConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return pt(this.L("L{descriptionTpl}"),e.name||e.id,this.interval.getConstraintName(e.constraintType))}resolve(){this.event.constraintType=null}},Rf=class extends fn{static get $name(){return"DateConstraintIntervalDescription"}static getDescription(e){let n;switch(e.owner.constraintType){case N.StartNoEarlierThan:case N.FinishNoEarlierThan:case N.MustStartOn:case N.MustFinishOn:n=this.L("L{startDateDescriptionTpl}");break;case N.StartNoLaterThan:case N.FinishNoLaterThan:n=this.L("L{endDateDescriptionTpl}");break}return pt(n,...this.getDescriptionParameters(e))}static getConstraintName(e){return this.L("L{constraintTypeTpl}")[e]}static getDescriptionParameters(e){const n=e.owner;return[R.format(e.startDate,this.L("L{dateFormat}")),R.format(e.endDate,this.L("L{dateFormat}")),n.name||n.id,this.getConstraintName(n.constraintType)]}},as=class extends ur{getConstraintName(e){return this.descriptionBuilderClass.getConstraintName(e||this.owner.constraintType)}getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const n=this.owner;e=e||n.graph.activeTransaction;const t=e.entries.get(n.$.constraintDate),s=e.entries.get(n.$.constraintType);return!e.baseRevision.hasIdentifier(n.$$)||t&&!t.isShadow()||s&&!s.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.removeDateConstraintConflictResolutionClass.new({interval:this})])}};fr([G(bf)],as.prototype,"removeDateConstraintConflictResolutionClass",void 0),fr([G(Rf)],as.prototype,"descriptionBuilderClass",void 0);var Ii=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},fl=class extends O([Lr,Go,Gt,hl],e=>{const n=e.prototype;class t extends e{*shouldPredecessorAffectScheduling(r){const i=yield r.$.fromEvent;return i&&!Cr(i)&&(yield r.$.active)&&(!(yield i.$.inactive)||(yield this.$.inactive))}*calculateEarlyStartDateConstraintIntervals(){const r=yield*n.calculateEarlyStartDateConstraintIntervals.call(this),i=this.getProject(),a=i.dependencyConstraintIntervalClass;for(const o of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(o)))continue;const l=yield o.$.fromEvent,c=yield l.$.manuallyScheduled;let u;switch(yield o.$.type){case _e.EndToStart:u=c?yield l.$.endDate:yield l.$.earlyEndDateRaw;break;case _e.StartToStart:u=c?yield l.$.startDate:yield l.$.earlyStartDateRaw;break}if(u){const d=yield o.$.lag,h=yield o.$.lagUnit,f=yield o.$.calendar;yield f.$.version;const g=a.new({owner:o,startDate:f.calculateEndDate(u,yield*i.$convertDuration(d,h,V.Millisecond)),endDate:null});r.unshift(g)}}return r}*calculateEarlyEndDateConstraintIntervals(){const r=yield*n.calculateEarlyEndDateConstraintIntervals.call(this),i=this.getProject(),a=i.dependencyConstraintIntervalClass;for(const o of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(o)))continue;const l=yield o.$.fromEvent,c=yield l.$.manuallyScheduled;let u;switch(yield o.$.type){case _e.EndToEnd:u=c?yield l.$.endDate:yield l.$.earlyEndDateRaw;break;case _e.StartToEnd:u=c?yield l.$.startDate:yield l.$.earlyStartDateRaw;break}if(u){const d=yield o.$.lag,h=yield o.$.lagUnit,f=yield o.$.calendar;yield f.$.version;const g=a.new({owner:o,startDate:f.calculateEndDate(u,yield*i.$convertDuration(d,h,V.Millisecond)),endDate:null});r.unshift(g)}}return r}*calculateEffectiveDirection(){const r=yield this.getProject().$.effectiveDirection,i=yield this.$.constraintType;if(r.direction===L.Forward&&!(yield this.$.manuallyScheduled)&&!((i===N.MustStartOn||i===N.MustFinishOn)&&(yield this.$.constraintDate)))for(const a of yield this.$.incomingDeps){const o=yield a.$.fromEvent,l=o!=null&&!Cr(o),c=l?yield o.$.constraintType:void 0;if(!l||!(yield a.$.active)||(yield o.$.manuallyScheduled)||(c===N.MustStartOn||c===N.MustFinishOn)&&(yield o.$.constraintDate))continue;const u=yield a.$.type,d=u===_e.EndToEnd||u===_e.EndToStart?yield o.$.endDateDirection:yield o.$.startDateDirection;if(d.direction===L.Backward)return{kind:"enforced",direction:L.Backward,enforcedBy:d.kind==="enforced"?d.enforcedBy:d.kind==="own"?o:d.inheritedFrom}}return yield*super.calculateEffectiveDirection()}}return Ii([B({type:"boolean"})],t.prototype,"inactive",void 0),t}){},gl=class extends gt(mi){static get $name(){return"BaseDependencyResolution"}getDescription(){const{dependency:e}=this,{type:n,fromEvent:t,toEvent:s}=e;return pt(this.L("L{descriptionTpl}"),this.L("L{DependencyType.long}")[n],t.name||t.id,s.name||s.id)}},pl=class extends gl{static get $name(){return"RemoveDependencyResolution"}resolve(){this.dependency.remove()}},ml=class extends gl{static get $name(){return"DeactivateDependencyResolution"}resolve(){this.dependency.active=!1}},If=class extends fn{static get $name(){return"DependencyConstraintIntervalDescription"}static getDescriptionParameters(e){const n=e.owner;return[R.format(e.startDate,this.L("L{dateFormat}")),R.format(e.endDate,this.L("L{dateFormat}")),this.L("L{DependencyType.long}")[n.type],n.fromEvent.name,n.toEvent.name]}},pn=class extends ur{isAffectedByTransaction(e){const n=this.owner;e=e||n.graph.activeTransaction;const{entries:t}=e,{fromEvent:s,toEvent:r,lag:i,lagUnit:a,type:o}=n.$,l=t.get(s),c=t.get(r),u=t.get(i),d=t.get(a),h=t.get(o);return!e.baseRevision.hasIdentifier(n.$$)||l&&!l.isShadow()||c&&!c.isShadow()||u&&!u.isShadow()||d&&!d.isShadow()||h&&!h.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.deactivateDependencyConflictResolutionClass.new({dependency:this.owner}),this.removeDependencyConflictResolutionClass.new({dependency:this.owner})])}};Ii([G(pl)],pn.prototype,"removeDependencyConflictResolutionClass",void 0),Ii([G(ml)],pn.prototype,"deactivateDependencyConflictResolutionClass",void 0),Ii([G(If)],pn.prototype,"descriptionBuilderClass",void 0);var gr=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Pi=class extends O([Ei],e=>{const n=e.prototype;class t extends e{*calculateUnits(){const r=yield this.$.event;return r?yield*r.calculateAssignmentUnits(this):yield X}*calculateEffort(){const r=yield this.$.event;if(r){const i=yield r.$.startDate,a=yield r.$.endDate,o=yield r.$.effectiveCalendar;if(i&&a){const l=new Map;return l.set(o,[this]),yield*r.calculateProjectedEffort(i,a,l)}}return null}*calculateActualDate(){const r=yield this.$.event;if(r){const i=yield r.$.startDate,a=yield r.$.duration,o=yield r.$.percentDone;return yield*r.calculateProjectedXDateWithDuration(i,!0,a*.01*o)}return null}*calculateActualEffort(){const r=yield this.$.event;if(r){const i=yield r.$.startDate,a=yield r.$.effectiveCalendar,o=yield this.$.actualDate,l=new Map;return l.set(a,[this]),yield*r.calculateProjectedEffort(i,o,l)}return null}}return gr([B({type:"number",defaultValue:100})],t.prototype,"units",void 0),gr([j("units")],t.prototype,"calculateUnits",null),gr([q({lazy:!0})],t.prototype,"effort",void 0),gr([q({lazy:!0})],t.prototype,"actualDate",void 0),gr([q({lazy:!0})],t.prototype,"actualEffort",void 0),gr([j("effort")],t.prototype,"calculateEffort",null),gr([j("actualDate")],t.prototype,"calculateActualDate",null),gr([j("actualEffort")],t.prototype,"calculateActualEffort",null),t}){},mn=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},vl=class extends O([dl],e=>{const n=e.prototype;class t extends e{*calculateCalendar(){const r=this.getProject(),i=yield r.$.dependenciesCalendar;let a;switch(i){case Mr.Project:a=yield r.$.effectiveCalendar;break;case Mr.FromEvent:const o=yield this.$.fromEvent;a=o&&!Cr(o)?yield o.$.effectiveCalendar:null;break;case Mr.ToEvent:const l=yield this.$.toEvent;a=l&&!Cr(l)?yield l.$.effectiveCalendar:null;break}return a||(a=yield r.$.effectiveCalendar),a}async setLag(r,i){if(this.graph)return this.graph.write(this.$.lag,r,i),this.graph.commitAsync();this.$.lag.DATA=r,i!=null&&(this.$.lagUnit.DATA=i)}writeLag(r,i,a,o,l=void 0){r.constructor.prototype.write.call(this,r,i,a,o),l!=null&&i.write(this.$.lagUnit,l)}}return mn([B({type:"number",defaultValue:0})],t.prototype,"lag",void 0),mn([B({type:"string",defaultValue:V.Day},{converter:R.normalizeUnit})],t.prototype,"lagUnit",void 0),mn([q()],t.prototype,"calendar",void 0),mn([B({type:"boolean",defaultValue:!0,persist:!0})],t.prototype,"active",void 0),mn([j("calendar")],t.prototype,"calculateCalendar",null),mn([dt("lag")],t.prototype,"writeLag",null),t}){},wi=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},yl=class extends O([Gt],e=>{const n=e.prototype;class t extends e{*calculatePercentDone(){const r=yield this.$.childEvents,a=yield this.getProject().$.autoCalculatePercentDoneForParentTasks;if(r.size&&a){const o=yield this.$.percentDoneSummaryData;return o.totalDuration>0?o.completedDuration/o.totalDuration:o.milestonesNum>0?o.milestonesTotalPercentDone/o.milestonesNum:null}else return yield X}*shouldRollupChildPercentDoneSummaryData(r){return!0}*calculatePercentDoneSummaryData(){const r=yield this.$.childEvents;if(r.size){let i={totalDuration:0,completedDuration:0,milestonesNum:0,milestonesTotalPercentDone:0};for(const a of r){if(!(yield*this.shouldRollupChildPercentDoneSummaryData(a)))continue;const o=yield a.$.percentDoneSummaryData;o&&(i.totalDuration+=o.totalDuration,i.completedDuration+=o.completedDuration,i.milestonesNum+=o.milestonesNum,i.milestonesTotalPercentDone+=o.milestonesTotalPercentDone)}return i}else{const i=yield this.$.duration;if(typeof i=="number"){const a=yield*this.getProject().$convertDuration(i,yield this.$.durationUnit,V.Millisecond),o=yield this.$.percentDone;return{totalDuration:a,completedDuration:a*o,milestonesNum:a===0?1:0,milestonesTotalPercentDone:a===0?o:0}}else return null}}}return wi([B({type:"number",defaultValue:0})],t.prototype,"percentDone",void 0),wi([q()],t.prototype,"percentDoneSummaryData",void 0),wi([j("percentDone")],t.prototype,"calculatePercentDone",null),wi([j("percentDoneSummaryData")],t.prototype,"calculatePercentDoneSummaryData",null),t}){},os=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Mi=class extends O([qo],e=>{const n=e.prototype;class t extends e{*hasProposedValueForUnits(){const r=yield this.$.assigned;for(const i of r)if((yield i.$.resource)&&(yield ct(i.$.units)))return!0;return!1}async assign(r,i=100){const a=this.getProject().assignmentStore.modelClass;return this.addAssignment(new a({event:this,resource:r,units:i})),this.commitAsync()}*forEachAvailabilityInterval(r,i){const a=yield this.$.effectiveCalendar,o=yield this.$.assignmentsByCalendar,l=yield this.$.effectiveCalendarsCombination,c=(yield this.$.ignoreResourceCalendar)||r.ignoreResourceCalendar||!o.size,u=this.getProject().maxCalendarRange;return u&&(r=Object.assign({maxRange:u},r)),l.forEachAvailabilityInterval(r,(d,h,f)=>{const g=f.getCalendarsWorkStatus(),p=f.getCalendarsWorking();if(g.get(a)&&(c||p.some(m=>o.has(m))))return i(d,h,f)})}*calculateEffectiveCalendarsCombination(){const r=yield this.$.manuallyScheduled,i=this.getProject(),a=[yield this.$.effectiveCalendar];if(!r||i.skipNonWorkingTimeInDurationWhenSchedulingManually){const o=yield this.$.assignmentsByCalendar;a.push(...o.keys())}return this.getProject().combineCalendars(a)}*calculateAssignmentsByCalendar(){const r=yield this.$.assigned,i=new Map;for(const a of r){const o=yield a.$.resource;if(o){const l=yield o.$.effectiveCalendar;let c=i.get(l);c||(c=[],i.set(l,c)),c.push(a)}}return i}*getBaseOptionsForDurationCalculations(){return{ignoreResourceCalendar:!1}}*useEventAvailabilityIterator(){return(yield this.$.assignmentsByCalendar).size>0}*skipNonWorkingTime(r,i=!0,a){if(!r)return null;const o=yield this.$.assignmentsByCalendar,l=yield this.$.ignoreResourceCalendar;if(yield*this.useEventAvailabilityIterator()){const c=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),i?{startDate:r,isForward:i}:{endDate:r,isForward:i},a);let u;const d=yield*this.forEachAvailabilityInterval(c,(h,f,g)=>(u=i?h:f,!1));if(d===Ve.MaxRangeReached||d===Ve.FullRangeIterated){const h=[yield this.$.effectiveCalendar];!c.ignoreResourceCalendar&&!l&&h.push(...o.keys());const f=ts.new({event:this,calendars:h,date:r,isForward:i});if((yield f)===bt.Cancel)yield kt(f);else return null}return new Date(u)}else return yield*n.skipNonWorkingTime.call(this,r,i)}*calculateProjectedDuration(r,i,a,o){if(!r||!i)return null;if(yield*this.useEventAvailabilityIterator()){const l=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),{startDate:r,endDate:i,isForward:!0},o),c=this.getProject().adjustDurationToDST;let u=0;return yield*this.forEachAvailabilityInterval(l,(d,h)=>{if(u+=h.getTime()-d.getTime(),c){const f=d.getTimezoneOffset()-h.getTimezoneOffset();u+=f*60*1e3}}),a||(a=yield this.$.durationUnit),yield*this.getProject().$convertDuration(u,V.Millisecond,a)}else return yield*n.calculateProjectedDuration.call(this,r,i,a)}*calculateProjectedXDateWithDuration(r,i=!0,a,o,l){if(a==null||isNaN(a)||r==null)return null;if(a==0)return r;o=o||(yield this.$.durationUnit);const c=yield*this.getProject().$convertDuration(a,o,V.Millisecond);let u=r.getTime(),d=c;const h=yield this.$.effectiveCalendar;if(yield*this.useEventAvailabilityIterator()){const f=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),i?{startDate:r,isForward:i}:{endDate:r,isForward:i},l),g=this.getProject().adjustDurationToDST;return(yield*this.forEachAvailabilityInterval(f,(m,y,D)=>{const E=m.getTime(),C=y.getTime(),v=C-E;if(v>=d){if(g){const S=i?m.getTimezoneOffset()-new Date(E+d).getTimezoneOffset():new Date(C-d).getTimezoneOffset()-y.getTimezoneOffset();d-=S*60*1e3}return u=i?E+d:C-d,!1}else if(d-=v,g){const S=m.getTimezoneOffset()-y.getTimezoneOffset();d-=S*60*1e3}}))===Ve.StoppedByIterator?new Date(u):null}else return h.accumulateWorkingTime(r,c,i).finalDate}}return os([q()],t.prototype,"effectiveCalendarsCombination",void 0),os([q()],t.prototype,"assignmentsByCalendar",void 0),os([B({type:"boolean"})],t.prototype,"ignoreResourceCalendar",void 0),os([j("effectiveCalendarsCombination")],t.prototype,"calculateEffectiveCalendarsCombination",null),os([j("assignmentsByCalendar")],t.prototype,"calculateAssignmentsByCalendar",null),t}){},at=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},_t=Symbol("MasterStartDateVar"),ls=Symbol("MasterEndDateVar"),cs=Symbol("MasterDurationVar"),us=Symbol("MasterTotalDurationVar"),et=Symbol("StartOffsetVar"),ot=Symbol("EndOffsetVar"),Pf=fe.new({output:te,inputs:new Set([et,ot])}),wf=fe.new({output:J,inputs:new Set([et,_t])}),Sl=fe.new({output:Q,inputs:new Set([ot,_t])}),Mf=fe.new({output:et,inputs:new Set([J,_t])}),Dl=fe.new({output:ot,inputs:new Set([Q,_t])}),xf=fe.new({output:et,inputs:new Set([ot,te])}),Cl=fe.new({output:ot,inputs:new Set([et,te])}),Tf=fe.new({output:ot,inputs:new Set([et,us])}),Of=fe.new({output:ot,inputs:new Set([et,cs])}),Af=fe.new({output:te,inputs:new Set([et,ls])}),jv=Xt.new({variables:new Set([J,Q,te,_t,ls,cs,us,et,ot]),formulas:new Set([Pf,wf,Sl,xf,Mf,Cl,Tf,Of,Dl,Af])}),kv=Fe.new({description:jv,defaultResolutionFormulas:new Set([Sl,Dl,Cl])}),Lv=class extends ut.mix(Mt){equality(e,n){const t=e.resolution,s=n.resolution;return t.get(J)===s.get(J)&&t.get(Q)===s.get(Q)&&t.get(te)===s.get(te)&&t.get(_t)===s.get(_t)&&t.get(ls)===s.get(ls)&&t.get(cs)===s.get(cs)&&t.get(us)===s.get(us)&&t.get(et)===s.get(et)&&t.get(ot)===s.get(ot)}},El=class extends O([or],e=>{class n extends e{get isEventSegment(){return!0}get stm(){var s;return(s=this.event)==null?void 0:s.stm}set stm(s){}writeStartDate(s,r,i,a,o=!0){const l=this.event,c=this.getProject();if(l&&!this.previousSegment&&r.baseRevision.hasIdentifier(s)&&!(c&&c.getStm().isRestoring)?l.$.startDate.constructor.prototype.write.call(this,l.$.startDate,r,null,a,o):s.constructor.prototype.write.call(this,s,r,i,a,o),o&&this.nextSegment){const u=this.endOffset-this.nextSegment.startOffset;if(u>0){let d=this;for(;d=d.nextSegment;)d.startOffset+=u,d.endOffset+=u}}}shouldRecordFieldChange(s,r,i){return s==="startOffset"||s==="endOffset"||super.shouldRecordFieldChange(s,r,i)}*calculateStartOffset(){const r=(yield this.$.dispatcher).resolution.get(et);if(!this.event)return yield X;let i;if(r===Ne)i=yield X;else if(r===xf.formulaId)i=yield*this.calculateStartOffsetByEndOffsetAndDuration();else if(r===Mf.formulaId){const a=yield pe(this.event.$.startDate),o=yield pe(this.$.startDate);i=yield*this.event.calculateProjectedDuration(a,o,V.Millisecond,{ignoreSegments:!0})}return i}*calculateEndOffset(){const r=(yield this.$.dispatcher).resolution.get(ot);if(!this.event)return yield X;let i;if(r===Ne)i=yield X;else if(r===Cl.formulaId)i=yield*this.calculateEndOffsetByStartOffsetAndDuration();else if(r===Dl.formulaId){const a=yield pe(this.event.$.startDate),o=yield pe(this.$.endDate);i=yield*this.event.calculateProjectedDuration(a,o,V.Millisecond,{ignoreSegments:!0})}else r===Of.formulaId?i=yield*this.calculateEndOffsetByMasterDurationAndStartOffset():r===Tf.formulaId&&(i=yield*this.calculateEndOffsetByMasterTotalDurationAndStartOffset());return i}*calculateStartDate(){const r=(yield this.$.dispatcher).resolution.get(J);if(!this.event)return yield X;let i;return r===wf.formulaId?i=yield*this.calculateStartDateByMasterStartAndStartOffset():i=yield*super.calculateStartDate(),i}*calculateEndDate(){const r=(yield this.$.dispatcher).resolution.get(Q);if(!this.event)return yield X;let i;return r===Sl.formulaId?i=yield*this.calculateEndDateByMasterStartAndEndOffset():i=yield*super.calculateEndDate(),i}*calculateDuration(){const r=(yield this.$.dispatcher).resolution.get(te);if(!this.event)return yield X;let i;return r===Pf.formulaId?i=yield*this.calculateDurationByOffsets():r===Af.formulaId?i=yield*this.calculateDurationByOffsets():i=yield*super.calculateDuration(),i}buildProposedDispatcher(s,r,i){const a=super.buildProposedDispatcher(s,r,i);return a.addPreviousValueFlag(_t),a.addPreviousValueFlag(et),a.addPreviousValueFlag(ot),a}*prepareDispatcher(s){const r=yield*super.prepareDispatcher(s);if(!this.event)return r;if(s(js(this.event.$.startDate))!=null&&r.addPreviousValueFlag(_t),s(ct(this.event.$.startDate))&&r.addProposedValueFlag(_t),!s(ct(this.event.$.segments))){if(r.collectInfo(s,this.event.$.duration,cs),s(ct(this.event.$.endDate))){const a=s(Er(this.event.$.endDate));a!=null&&a[0]||r.addProposedValueFlag(ls)}const i=s(this.event.$.dispatcher);i.resolution.get(J)===Ne&&i.resolution.get(Q)===Ne&&r.addProposedValueFlag(us)}return r.collectInfo(s,this.$.startOffset,et),r.collectInfo(s,this.$.endOffset,ot),r}cycleResolutionContext(s){return kv}*calculateEndOffsetByMasterDurationAndStartOffset(){const s=yield pe(this.event.$.duration),r=yield this.event.$.durationUnit,i=yield this.$.startOffset,a=this.nextSegment;let o,l=yield*this.getProject().$convertDuration(s,r,V.Millisecond);const c=[];let u=this;for(;u=u.previousSegment;)c.push(u);for(let d=c.length-1;d>=0;d--){const h=c[d],f=yield pe(h.$.startOffset),p=(yield pe(h.$.endOffset))-f;l-=p}return l>0?a?o=i+Math.min(l,(yield pe(this.$.endOffset))-i):o=i+l:o=i,o}*calculateEndOffsetByMasterTotalDurationAndStartOffset(){const s=yield pe(this.event.$.startDate),r=yield pe(this.event.$.endDate),i=yield*this.event.calculateProjectedDuration(s,r,V.Millisecond,{ignoreSegments:!0}),a=yield pe(this.$.startOffset);let o=yield pe(this.$.endOffset),l=this.nextSegment;return a<=i?o<=i?!l||(yield pe(l.$.startOffset))>=i?i:o:i:yield this.$.startOffset}*calculateStartOffsetByEndOffsetAndDuration(){const s=yield this.$.duration,r=yield this.$.durationUnit;return(yield this.$.endOffset)-(yield*this.event.getProject().$convertDuration(s,r,V.Millisecond))}*calculateEndOffsetByStartOffsetAndDuration(){const s=yield this.$.duration,r=yield this.$.durationUnit;return(yield this.$.startOffset)+(yield*this.event.getProject().$convertDuration(s,r,V.Millisecond))}*calculateEndDateByMasterStartAndEndOffset(){const s=yield this.event.$.startDate,r=yield this.$.endOffset,i=yield*this.event.calculateProjectedXDateWithDuration(s,!0,r,V.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?i:yield*this.event.skipNonWorkingTime(i,!1)}*calculateStartDateByMasterStartAndStartOffset(){const s=yield this.event.$.startDate,r=yield this.$.startOffset,i=yield*this.event.calculateProjectedXDateWithDuration(s,!0,r,V.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?i:yield*this.event.skipNonWorkingTime(i)}*calculateDurationByOffsets(){const s=yield this.$.startOffset,r=yield this.$.endOffset,i=yield this.$.durationUnit;return yield*this.getProject().$convertDuration(r-s,V.Millisecond,i)}*calculatePercentDone(){let s=0;if(!this.event)return yield X;const r=yield this.event.$.segments;if(r){const i=yield this.event.$.percentDone,a=yield this.event.$.duration,o=yield this.event.$.durationUnit;let l=yield*this.getProject().$convertDuration(a,o,V.Millisecond),c=i*.01*l;for(const u of r){const d=u.startOffset,f=u.endOffset-d;if(u===this)return c>=f?100:c>0?100*c/f:0;c-=f}}return s}*calculateMinPercent(){const s=this.previousSegment;return this.event?s?yield s.$.endPercentDone:0:yield X}*calculateMaxPercent(){if(!this.event)return yield X;const s=yield this.event.$.duration,r=yield this.event.$.durationUnit;let i=yield*this.getProject().$convertDuration(s,r,V.Millisecond);const a=yield this.$.startOffset,o=yield this.$.endOffset;return(yield this.$.startPercentDone)+100*(o-a)/i}*calculateProjectedXDateWithDuration(s,r,i,a){return a||(a=yield this.$.durationUnit),yield*this.event.calculateProjectedXDateWithDuration(s,r,i,a,{ignoreSegments:!0})}*calculateProjectedDuration(s,r,i){return i||(i=yield this.$.durationUnit),yield*this.event.calculateProjectedDuration(s,r,i,{ignoreSegments:!0})}*calculateManuallyScheduled(){return this.event?yield this.event.$.manuallyScheduled:yield X}}return at([q({identifierCls:Lv})],n.prototype,"dispatcher",void 0),at([B({persist:!1})],n.prototype,"startOffset",void 0),at([B({persist:!1})],n.prototype,"endOffset",void 0),at([q()],n.prototype,"percentDone",void 0),at([q()],n.prototype,"startPercentDone",void 0),at([q()],n.prototype,"endPercentDone",void 0),at([dt("startDate")],n.prototype,"writeStartDate",null),at([j("startOffset")],n.prototype,"calculateStartOffset",null),at([j("endOffset")],n.prototype,"calculateEndOffset",null),at([j("percentDone")],n.prototype,"calculatePercentDone",null),at([j("startPercentDone")],n.prototype,"calculateMinPercent",null),at([j("endPercentDone")],n.prototype,"calculateMaxPercent",null),at([j("manuallyScheduled")],n.prototype,"calculateManuallyScheduled",null),n}){},Br=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Nr=Symbol("SegmentsVar"),Bv=(e,n,t)=>t.processSegmentsValue(e),bl=fe.new({output:J,inputs:new Set([Q,Nr])}),Rl=fe.new({output:Q,inputs:new Set([J,Nr])}),iS=fe.new({output:te,inputs:new Set([J,Q,Nr])}),$f=Xt.new({variables:new Set([J,Q,te,Nr]),formulas:new Set([Rl,bl,Je,Qe,Ze])}),Nv=Fe.new({description:$f,defaultResolutionFormulas:new Set([Qe,Rl])}),Vv=Fe.new({description:$f,defaultResolutionFormulas:new Set([Je,bl])}),Uv=class extends ut.mix(Mt){equality(e,n){const t=e.resolution,s=n.resolution;return t.get(J)===s.get(J)&&t.get(Q)===s.get(Q)&&t.get(te)===s.get(te)&&t.get(Nr)===s.get(Nr)}};function Wv(e,n){return!e&&!n?!0:this._skipSegmentsIsEqual||!e&&n||e&&!n||e.length!==n.length?!1:e.every((t,s)=>zv(t,n[s]))}var zv=(e,n)=>{if(e===n)return!0;const s=(e.isModel?e:n).fieldMap,r=e.startDate instanceof Date?e.startDate.getTime():s.startDate.convert(e.startDate).getTime(),i=n.startDate instanceof Date?n.startDate.getTime():s.startDate.convert(n.startDate).getTime(),a=e.endDate instanceof Date?e.endDate.getTime():s.endDate.convert(e.endDate).getTime(),o=n.endDate instanceof Date?n.endDate.getTime():s.endDate.convert(n.endDate).getTime();return r===i&&a===o},qv=class extends O([Mi,yl],e=>{class n extends e{constructor(){super(...arguments),this._segmentGeneration={}}static get $name(){return"SplitEventMixin"}construct(){this.segmentModelClass=this.getDefaultSegmentModelClass(),super.construct(...arguments)}get rawModifications(){let s=super.rawModifications;if(this.segments&&(!s||!("segments"in s))){for(const r of this.segments)if(r.rawModifications){s=s||{},s.segments=this.getFieldPersistentValue("segments");break}}return s}clearChanges(s,r,i){for(const a of this.segments||[])a.clearChanges(s,r,null);super.clearChanges(s,r,i)}getDefaultSegmentModelClass(){return El}*prepareDispatcher(s){const r=yield*super.prepareDispatcher(s);return(yield*this.hasSegmentChangesProposed())&&r.addProposedValueFlag(Nr),r}cycleResolutionContext(s){const r=s(this.$.effectiveDirection);return r.direction===L.Forward||r.direction===L.None?Nv:Vv}*hasSegmentChangesProposed(){const s=yield $c(this.$.segments);let r=!1;(yield ct(this.$.segments))&&(r=!!s);const i=yield pe(this.$.segments);if(!i)return!1;for(const a of i){const o=yield ct(a.$.startDate),l=yield ct(a.$.endDate),c=yield ct(a.$.duration);(o||l||c)&&(r=!0)}return r}writeSegments(s,r,i,a){var o;const l=(o=r.getLatestEntryFor(s))==null?void 0:o.getValue(),c=l!==ee?l!=null?l:[]:[],u=new Set(c),d=a!=null?a:[],h=new Set(d);this.project.ion({commitFinalized:()=>g.removeEntities(c.filter(p=>!h.has(p))),once:!0}),s.constructor.prototype.write.call(this,s,r,i,a),this.$.isSegmented.write.call(this,this.$.isSegmented,r,null,!!(a!=null&&a.length));const f=this.project,g=f.replica;for(const p of d)!u.has(p)&&p.graph!==g&&(p.setProject(f),g.addEntity(p))}*doWriteSegments(s,r){if(r=r||[],s.length<=1){const i=s.length?yield*this.getProject().$convertDuration(s[0].endOffset-s[0].startOffset,V.Millisecond,yield this.$.durationUnit):0;r.push({identifier:this.$.duration,proposedArgs:[i,null]}),s=null}r.push({identifier:this.$.segments,proposedArgs:[s]}),yield Tc(r)}*calculateSegments(){const s=yield this.$.dispatcher,{graph:r,project:i}=this,a=yield js(this.$.segments);let o=yield X;const l=[];let c=!1;if(o){const u=new Set;let d=null,h=!1;const{baseRevision:f}=r.$activeTransaction;for(const g of o){const p=yield g.$.startOffset,m=yield g.$.endOffset,y=f.hasIdentifier(g.$.startDate)&&(yield Er(g.$.startDate)),D=f.hasIdentifier(g.$.endDate)&&(yield Er(g.$.endDate));if(h=h||(y==null?void 0:y[0])||(D==null?void 0:D[0]),p===m)l.push(g);else if(d&&p<=d.endOffset){const E=d.endOffset;if(l.push(g),d.graph){l.push(d);const C=d.startOffset,v=h?m+E-p:Math.max(m,E),S=d.cls;d=this.segmentModelClass.new({event:this,cls:S,startOffset:C,endOffset:v})}else d.endOffset=h?m+d.endOffset-p:Math.max(m,d.endOffset)}else d&&u.add(d),d=g}d&&u.add(d),u.size===1&&l.push(...u),c=l.length>0,c&&(o=Array.from(u)),o.reduce((g,p,m)=>(g&&(g.nextSegment=p),p.previousSegment=g,p.segmentIndex=m,p),null),o.length&&(o[o.length-1].nextSegment=null)}else a&&l.push(...a);return l.length&&(l.forEach(u=>u.event=null),i.ion({commitFinalized:()=>r.removeEntities(l),once:!0})),c&&(yield*this.doWriteSegments(o)),o=(o==null?void 0:o.length)>1?o:null,o}*calculateAdjustedSegments(){const s=yield this.$.dispatcher;let r=yield this.$.segments;const i=yield this.$.startDate,a=yield this.$.endDate,o=yield this.$.duration;let l=yield X;if(r){const c=this.project,u=this.graph,d=[],h=[];let f=-1;for(let m=r.length-1;m>=0;m--){const y=r[m],D=yield y.$.startDate,E=yield y.$.endDate;if(D>a)d.push(y),f=m;else{if(E.getTime()!==a.getTime()){const C=y.endOffset+(a.getTime()-E.getTime())-y.startOffset,v=yield*c.$convertDuration(C,V.Millisecond,yield y.$.durationUnit);h.push({identifier:y.$.duration,proposedArgs:[v,null]},{identifier:y.$.endDate,proposedArgs:[a,!1]},{identifier:y.$.endOffset,proposedArgs:[y.endOffset+(a.getTime()-E.getTime())]})}break}}let g=!1;f>-1&&(g=!0,r.splice(f),r.length&&(r[r.length-1].nextSegment=null),c.ion({commitFinalized:()=>u.removeEntities(d),once:!0}));let p="";r&&(p=this.getSegmentsSnapshot(r)),p!==this._lastSegmentsSnapshot&&(g=!0,r=r&&r.slice(),this._lastSegmentsSnapshot=p),g&&(yield*this.doWriteSegments(r,h))}return l}getSegmentsSnapshot(s){return s=s||this.segments,s==null?void 0:s.map(r=>{var i,a;return""+r.startOffset+"-"+((i=r.startDate)==null?void 0:i.getTime())+"-"+r.endOffset+"-"+((a=r.endDate)==null?void 0:a.getTime())}).join(";")}processSegmentsValue(s){let r=s;if(s)for(let i=0;i<s.length;i++){const a=s[i],o=a.isModel?a:this.segmentModelClass.new(a);o.event||(o.event=this),s[i]=o}return r}*calculateStartDate(){const r=(yield this.$.dispatcher).resolution.get(J);let i;return r===bl.formulaId?i=yield*this.calculateStartDateBySegments():i=yield*super.calculateStartDate(),i}*calculateStartDateBySegments(){const s=yield this.$.dispatcher,r=yield this.$.segments,i=yield this.$.endDate;let a;if(r){const l=yield r[r.length-1].$.endOffset,c=yield*this.calculateProjectedXDateWithDuration(i,!1,l,V.Millisecond,{ignoreSegments:!0});a=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?c:yield*this.skipNonWorkingTime(c,!0)}return a}*calculateEndDateBySegments(){const s=yield this.$.dispatcher,r=yield this.$.segments,i=yield this.$.startDate;let a;if(r){const l=yield r[r.length-1].$.endOffset,c=yield*this.calculateProjectedXDateWithDuration(i,!0,l,V.Millisecond,{ignoreSegments:!0});a=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?c:yield*this.skipNonWorkingTime(c,!1)}return a}*calculateEndDate(){const r=(yield this.$.dispatcher).resolution.get(Q);let i;return r===Rl.formulaId?i=yield*this.calculateEndDateBySegments():i=yield*super.calculateEndDate(),i}*calculateDurationProposed(){let s;return(yield*this.hasSegmentChangesProposed())?s=yield*this.calculateDurationBySegments():s=yield*super.calculateDurationProposed(),s}*skipNonWorkingTime(s,r=!0,i){return s?(i=Object.assign({ignoreSegments:!0},i),yield*super.skipNonWorkingTime(s,r,i)):null}*calculateDurationBySegments(){let s;const r=yield this.$.dispatcher,i=yield this.$.durationUnit,a=yield this.$.segments;if(a){let o=0;for(const l of a)o+=l.endOffset-l.startOffset;s=yield*this.getProject().$convertDuration(o,V.Millisecond,i)}return s}*forEachAvailabilityInterval(s,r){const i=yield this.$.effectiveCalendar,a=yield this.$.assignmentsByCalendar,o=yield this.$.effectiveCalendarsCombination,l=s.isForward!==!1,c=(yield this.$.ignoreResourceCalendar)||s.ignoreResourceCalendar||!a.size,u=this.getProject().maxCalendarRange;let d=s.ignoreSegments,h=1,f,g,p,m,y;d||(m=yield this.$.segments,d=d||!m,d||(m=m.slice(),l?(f=m.shift(),g=0,h=1,y=f.nextSegment?f.endOffset:ae.getTime()):(f=m.pop(),g=f.endOffset,h=-1,y=f.endOffset),p=y-f.startOffset));const D=yield this.$.manuallyScheduled,E=this.getProject();return o.forEachAvailabilityInterval(Object.assign({maxRange:u},s),(C,v,S)=>{const b=S.getCalendarsWorkStatus(),w=S.getCalendarsWorking();if(b.get(i)&&(c||w.some(M=>a.has(M))||D&&!E.skipNonWorkingTimeInDurationWhenSchedulingManually)){if(d)return r(C,v,S);{const M=C.getTime();let I=v.getTime()-C.getTime();if(this.getProject().adjustDurationToDST){const k=C.getTimezoneOffset()-v.getTimezoneOffset();I+=k*60*1e3}let A,T;for(l?(A=g,T=g+I):(A=g-I,T=g);f&&A<=y&&T>f.startOffset;){const k=Math.max(A,f.startOffset),Z=Math.min(T,y),z=new Date(M+k-A),re=new Date(M+Z-A);if(r(z,re,S)===!1)return!1;if(p-=re.getTime()-z.getTime(),!p)f=l?m.shift():m.pop(),f&&(y=!l||f.nextSegment?f.endOffset:ae.getTime(),p=y-f.startOffset);else break}g+=h*I}}})}*useEventAvailabilityIterator(){return(yield this.$.isSegmented)?!0:!(yield this.$.manuallyScheduled)}getSegmentByDate(s,r){if(r=r||this.getSegments(),r){const i=this.getSegmentIndexByDate(s,r);return r[i]}}getSegmentIndexByDate(s,r){return r=r||this.getSegments(),r?r.findIndex(i=>s>=i.startDate&&s<i.endDate):-1}get firstSegment(){const s=this.getSegments();return s?s[0]:null}get lastSegment(){const s=this.getSegments();return s?s[s.length-1]:null}getSegment(s){const r=this.getSegments();return r==null?void 0:r[s]}async splitToSegments(s,r=1,i){var a;const o=this.getProject();await o.commitAsync();const l=this;if(!s||l.isHasSubEventsMixin&&((a=l.childEvents)!=null&&a.size))return;const c=l.duration,u=l.durationUnit,d=l.startDate,h=l.endDate;if(i=i?R.normalizeUnit(i):u,!d||!h||d>=s||s>=h||!c)return;const f=l.isSegmented;let g=l.segments||[],p,m;if(f&&(m=l.getSegmentIndexByDate(s,g),p=g[m],!p))return;const y=p||l,D=p?y.startDate:d,E=y.duration,C=y.durationUnit,v=l.run("calculateProjectedDuration",D,s,C,{ignoreSegments:!0}),S=E-v,b=o.run("$convertDuration",r,i,V.Millisecond),w=b+l.run("calculateProjectedDuration",d,s,V.Millisecond,{ignoreSegments:!0});if(p){p.duration=v;const M=this.segmentModelClass.new({duration:S,durationUnit:C,startOffset:w});g=g.slice(0),g.splice(m+1,0,M),l.segments=g,l.duration=c;for(let I=m+2,A=g.length;I<A;I++){const T=g[I];T&&(T.startOffset+=b,T.endOffset+=b)}}else{const M=this.segmentModelClass.new({duration:v,durationUnit:C,startOffset:0}),I=this.segmentModelClass.new({duration:c-v,durationUnit:C,startOffset:w});l.duration=c,l.segments=[M,I]}return o.commitAsync()}async mergeSegments(s,r){if(this.isSegmented){if(s=s||this.firstSegment,r=r||this.lastSegment,s.startOffset>r.startOffset){let i=r;r=s,s=i}return s.endDate=r.startDate,this.getProject().commitAsync()}}storeFieldChange(s,r){if(s==="segments"&&r){const i=[];for(const a of r){const o=a.toJSON();(!this._segmentGeneration[a.internalId]||a.generation>this._segmentGeneration[a.internalId])&&Object.assign(o,a.meta.modified),i.push(o),this._segmentGeneration[a.internalId]=a.generation}r=i}super.storeFieldChange(s,r)}leaveProject(){const s=this.segments;s&&this.graph.removeEntities(s),super.leaveProject()}endBatch(...s){this.fieldMap.segments._skipSegmentsIsEqual++,super.endBatch(...s),this.fieldMap.segments._skipSegmentsIsEqual--}copy(s=null,r=null){const i=super.copy(s,r);return i.data.segments=void 0,i.segments&&(i.segments=i.segments.map(a=>Object.assign(a.copy(),{event:i}))),i}}return Br([q({identifierCls:Uv})],n.prototype,"dispatcher",void 0),Br([B({type:"array",isEqual:Wv,convert:Bv,_skipSegmentsIsEqual:0})],n.prototype,"segments",void 0),Br([q()],n.prototype,"adjustedSegments",void 0),Br([q()],n.prototype,"isSegmented",void 0),Br([dt("segments")],n.prototype,"writeSegments",null),Br([j("segments")],n.prototype,"calculateSegments",null),Br([j("adjustedSegments")],n.prototype,"calculateAdjustedSegments",null),n}){},xi=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Ti=class extends O([Mi,Gt],e=>{const n=e.prototype;class t extends e{getEffort(r){const i=this.effort;return r?this.getProject().convertDuration(i,this.effortUnit,r):i}writeEffort(r,i,a,o,l){o<0&&(o=0),!(!i.baseRevision.hasIdentifier(r)&&o==null)&&(l!=null&&l!==this.effortUnit&&this.$.effortUnit.write.call(this,this.$.effortUnit,i,null,l),r.constructor.prototype.write(r,i,a,o))}setEffortUnit(r){throw new Error("Use `setEffort` instead")}*shouldRollupChildEffort(r){return!0}*calculateTotalChildrenEffort(){const r=yield this.$.childEvents,i=this.getProject();let a=0;for(const o of r){if(!(yield*this.shouldRollupChildEffort(o)))continue;const l=yield o.$.effortUnit;a+=yield*i.$convertDuration(yield o.$.effort,l,V.Millisecond)}return yield*i.$convertDuration(a,V.Millisecond,yield this.$.effortUnit)}*calculateEffort(){if((yield this.$.childEvents).size>0)return yield*this.calculateTotalChildrenEffort();{const i=yield X;return i!==void 0?i:yield*this.calculateEffortPure()}}*calculateEffortPure(){return(yield this.$.childEvents).size>0?yield*this.calculateTotalChildrenEffort():yield*this.calculateProjectedEffort(yield this.$.startDate,yield this.$.endDate)}*calculateEffortProposed(){return yield X}*calculateAssignmentUnits(r){return yield*this.calculateAssignmentUnitsProposed(r)}*calculateAssignmentUnitsPure(r){return yield*this.calculateUnitsByStartEndAndEffort(r)}*calculateAssignmentUnitsProposed(r){return yield X}*getBaseOptionsForEffortCalculations(){return{ignoreResourceCalendar:!1}}*calculateProjectedEffort(r,i,a){if(r==null||i==null||r>i)return null;a||(a=yield this.$.assignmentsByCalendar);const o=new Map;for(const[u,d]of a){let h=0;for(const f of d)h+=yield f.$.units;o.set(u,h)}let l=0;const c=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:r,endDate:i});return o.size===0&&(o.set(yield this.$.effectiveCalendar,100),c.ignoreResourceCalendar=!0),yield*this.forEachAvailabilityInterval(c,(u,d,h)=>{const f=h.getCalendarsWorking(),g=u.getTime(),p=d.getTime(),m=p-g;let y=0;for(const D of f)y+=o.get(D)||0;l+=y*m*.01}),yield*this.getProject().$convertDuration(l,V.Millisecond,yield this.$.effortUnit)}*calculateUnitsByStartEndAndEffort(r){const i=yield this.$.effort,a=yield this.$.effortUnit,o=yield*this.getProject().$convertDuration(i,a,V.Millisecond);let l=0;const c=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:yield this.$.startDate,endDate:yield this.$.endDate}),u=yield this.$.assignmentsByCalendar;return yield*this.forEachAvailabilityInterval(c,(d,h,f)=>{const g=f.getCalendarsWorking(),p=d.getTime(),m=h.getTime(),y=m-p;for(const D of g)l+=(u.has(D)?u.get(D).length:0)*y}),l?100*o/l:100}*calculateProjectedXDateByEffort(r,i=!0,a,o){a=a!==void 0?a:yield this.$.effort,o=o!==void 0?o:yield this.$.effortUnit;const l=yield*this.getProject().$convertDuration(a,o,V.Millisecond);if(r==null||a==null)return null;let c=r.getTime(),u=l;if(u===0)return new Date(c);const d=yield this.$.effectiveCalendar,h=yield this.$.assignmentsByCalendar,f=new Map;let g=!1;for(const[p,m]of h){let y=0;for(const D of m)y+=yield D.$.units;f.set(p,y),y>0&&(g=!0)}if(g&&(yield*this.useEventAvailabilityIterator())){const p=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),i?{startDate:r,isForward:i}:{endDate:r,isForward:i});return yield*this.forEachAvailabilityInterval(p,(m,y,D)=>{const E=D.getCalendarsWorking(),C=m.getTime(),v=y.getTime(),S=v-C;let b=0;for(const M of E)b+=f.get(M)||0;const w=b*S*.01;if(w>=u)return c=i?C+u/(.01*b):v-u/(.01*b),!1;u-=w}),new Date(c)}else return d.accumulateWorkingTime(r,l,i).finalDate}}return xi([B({type:"number"})],t.prototype,"effort",void 0),xi([B({type:"string",defaultValue:V.Hour},{converter:s=>R.normalizeUnit(s)||V.Hour})],t.prototype,"effortUnit",void 0),xi([dt("effort")],t.prototype,"writeEffort",null),xi([j("effort")],t.prototype,"calculateEffort",null),t}){},Pe=Symbol("EffortVar"),we=Symbol("UnitsVar"),Yt=fe.new({output:Pe,inputs:new Set([J,Q,we])}),pr=fe.new({output:we,inputs:new Set([J,Q,Pe])}),mr=fe.new({output:Q,inputs:new Set([J,Pe,we])}),vr=fe.new({output:J,inputs:new Set([Q,Pe,we])}),_f=class extends No{},Ff=class extends Vo{equality(e,n){const t=e.resolution,s=n.resolution;return(e!==ee||n===ee)&&(e===ee||n!==ee)&&t.get(Pe)===s.get(Pe)&&t.get(we)===s.get(we)&&super.equality(e,n)}},Vr=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},ds=class extends O([Ti],e=>{const n=e.prototype;class t extends e{*calculateSchedulingMode(){return(yield X)||me.Normal}*effectiveSchedulingMode(){return(yield this.$.assignmentsByCalendar).size>0?yield this.$.schedulingMode:me.Normal}effectiveSchedulingModeSync(r){return r(this.$.assignmentsByCalendar).size>0?r(this.$.schedulingMode):me.Normal}*prepareDispatcher(r){if((yield*this.effectiveSchedulingMode())!==me.Normal){const a=yield*n.prepareDispatcher.call(this,r);return a.collectInfo(r,this.$.effort,Pe),(yield*this.hasProposedValueForUnits())&&a.addProposedValueFlag(we),a.addPreviousValueFlag(we),a}else return yield*n.prepareDispatcher.call(this,r)}dispatcherClass(r){return this.effectiveSchedulingModeSync(r)!==me.Normal?_f:n.dispatcherClass.call(this,r)}buildProposedDispatcher(r,i,a){const o=n.buildProposedDispatcher.call(this,r,i,a);return o.addPreviousValueFlag(Pe),o.addPreviousValueFlag(we),o}*calculateAssignmentUnits(r){if((yield*this.effectiveSchedulingMode())!==me.Normal){const o=(yield this.$.dispatcher).resolution.get(we);if(o===Ne)return yield*this.calculateAssignmentUnitsProposed(r);if(o===pr.formulaId)return yield*this.calculateAssignmentUnitsPure(r);throw new Error("Unknown formula for `units`")}else return yield*n.calculateAssignmentUnits.call(this,r)}*calculateEffort(){if((yield*this.effectiveSchedulingMode())!==me.Normal){const a=(yield this.$.dispatcher).resolution.get(Pe);if(a===Ne)return yield*this.calculateEffortProposed();if(a===Yt.formulaId)return yield*this.calculateEffortPure();throw new Error("Unknown formula for `effort`")}else return yield*n.calculateEffort.call(this)}*calculateStartDate(){return(yield*this.effectiveSchedulingMode())!==me.Normal?(yield this.$.dispatcher).resolution.get(J)===vr.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.endDate,!1):yield*n.calculateStartDate.call(this):yield*n.calculateStartDate.call(this)}*calculateEndDate(){return(yield*this.effectiveSchedulingMode())!==me.Normal?(yield this.$.dispatcher).resolution.get(Q)===mr.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.startDate,!0):yield*n.calculateEndDate.call(this):yield*n.calculateEndDate.call(this)}*calculateEffectiveDuration(){const r=yield this.$.dispatcher,i=yield*this.effectiveSchedulingMode(),a=r.resolution.get(te),o=r.resolution.get(Pe);let l;if(a===Ze.formulaId&&i!=me.Normal){const c=yield pe(this.$.startDate),u=yield pe(this.$.endDate),d=r.resolution.get(J),h=r.resolution.get(Q),f=yield this.$.effortDriven;u&&d===vr.formulaId?l=yield*this.calculateProjectedDuration(yield*this.calculateProjectedXDateByEffort(u,!1),u):c&&h===mr.formulaId?l=yield*this.calculateProjectedDuration(c,yield*this.calculateProjectedXDateByEffort(c,!0)):(c&&u||!c&&!u)&&(l=yield*n.calculateEffectiveDuration.call(this))}else l=yield*n.calculateEffectiveDuration.call(this);return l}}return Vr([B({type:"boolean",defaultValue:!1})],t.prototype,"effortDriven",void 0),Vr([B({type:"string",defaultValue:me.Normal},{sync:!0})],t.prototype,"schedulingMode",void 0),Vr([q({identifierCls:Ff})],t.prototype,"dispatcher",void 0),Vr([j("schedulingMode")],t.prototype,"calculateSchedulingMode",null),Vr([j("effort")],t.prototype,"calculateEffort",null),Vr([j("startDate")],t.prototype,"calculateStartDate",null),Vr([j("endDate")],t.prototype,"calculateEndDate",null),t}){},Il=Xt.new({variables:new Set([J,Q,te,Pe,we]),formulas:new Set([Je,Qe,Ze,pr,Yt])}),Pl=Xt.new({variables:new Set([J,Q,te,Pe,we]),formulas:new Set([Je,Qe,Ze,pr])}),jf=Fe.new({description:Il,defaultResolutionFormulas:new Set([Qe,Yt])}),kf=Fe.new({description:Pl,defaultResolutionFormulas:new Set([Qe,pr])}),Lf=Fe.new({description:Il,defaultResolutionFormulas:new Set([Je,Yt])}),Bf=Fe.new({description:Pl,defaultResolutionFormulas:new Set([Je,pr])}),Nf=class extends O([ds],e=>{const n=e.prototype;class t extends e{*prepareDispatcher(r){if((yield*this.effectiveSchedulingMode())===me.FixedDuration){const a=yield*n.prepareDispatcher.call(this,r),o=yield this.$.effortDriven;return o&&a.addKeepIfPossibleFlag(Pe),(yield ct(this.$.assigned))&&(o?a.addProposedValueFlag(Pe):a.addProposedValueFlag(we)),a}else return yield*n.prepareDispatcher.call(this,r)}cycleResolutionContext(r){if(this.effectiveSchedulingModeSync(r)===me.FixedDuration){const a=r(this.$.effectiveDirection),o=r(this.$.effortDriven);return a.direction===L.Forward||a.direction===L.None?o?kf:jf:o?Bf:Lf}else return n.cycleResolutionContext.call(this,r)}*getBaseOptionsForDurationCalculations(){return(yield*this.effectiveSchedulingMode())===me.FixedDuration?{ignoreResourceCalendar:!0}:yield*n.getBaseOptionsForDurationCalculations.call(this)}}return t}){},Oi=class extends O([gi,hl,yl,Mi,Ti,ds,Nf,Lr,fl,qv],e=>{class n extends e{static get fields(){return[{name:"name",type:"string"}]}}return n}){},hs=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Vf=class extends Qn{static get fields(){return[{name:"isWorking",type:"boolean",defaultValue:!0}]}},Uf=class extends $o{static get defaultConfig(){return{modelClass:Vf}}},wl=class extends hn{get intervalStoreClass(){return Uf}};hs([B({type:"boolean",defaultValue:!1})],wl.prototype,"unspecifiedTimeIsWorking",void 0);var Ai=class extends de{constructor(){super(...arguments),this.effort=0,this.units=0}},Wf=class extends Ai{constructor(){super(...arguments),this.inEventTimeSpan=!1}},Ml=class extends Ai{constructor(){super(...arguments),this.maxEffort=0,this.isOverallocated=!1,this.isUnderallocated=!1,this.inEventTimeSpan=!1,this.assignments=null,this.assignmentIntervals=null}},$i=class extends xt.mix(de){getDefaultAllocationIntervalClass(){return Ai}initialize(e){e=Object.assign({includeInactiveEvents:!1,allocationIntervalClass:this.getDefaultAllocationIntervalClass()},e),super.initialize(e)}};hs([q()],$i.prototype,"includeInactiveEvents",void 0),hs([q()],$i.prototype,"allocation",void 0);var _i=class extends $i{enterGraph(e){super.enterGraph(e)}leaveGraph(e){var n,t;this.eventRangesCalendar&&((n=this.resource)==null||n.getProject().clearCombinationsWith(this.eventRangesCalendar)),super.leaveGraph(e),(t=this.resource)==null||t.entities.delete(this)}getDefaultAllocationIntervalClass(){return Ml}*shouldIncludeAssignmentInAllocation(e){const n=yield e.$.event,t=yield this.$.includeInactiveEvents,s=n&&(yield n.$.inactive),r=n&&(yield n.$.startDate),i=n&&(yield n.$.endDate);return!!(n&&r&&i&&(t||!s))}*calculateAllocation(){var e;const n=[],t=yield this.ticks,s=yield this.$.resource,r=yield this.$.includeInactiveEvents,i=yield s.$.assigned,a=yield s.$.effectiveCalendar,o=new Map,l=[],c=new Map,u=new Map;let d=!1,h,f,g;for(const S of i){if(!(yield*this.shouldIncludeAssignmentInAllocation(S)))continue;yield S.$.units;const b=yield S.$.event,w=yield b.$.ignoreResourceCalendar,M=yield b.$.startDate,I=yield b.$.endDate,A=yield b.$.segments,T=yield b.$.effectiveCalendar;if(d=d||w,A)for(const Z of A){const z=yield Z.$.startDate,re=yield Z.$.endDate;l.push({startDate:z,endDate:re,assignment:S})}else l.push({startDate:M,endDate:I,assignment:S});let k=o.get(T);k||(k=[],o.set(T,k)),c.set(S,new Map),u.set(S,[]),k.push(S)}this.eventRangesCalendar&&((e=this.resource)==null||e.getProject().clearCombinationsWith(this.eventRangesCalendar));const p=this.eventRangesCalendar=new wl({intervals:l}),m=[t,p,...o.keys()],y=new Map;t.intervalStore.forEach(S=>{const b=Ml.new({tick:S,resource:s});y.set(S,b),n.push(b),c.forEach((w,M)=>{const I=Wf.new({tick:S,assignment:M});w.set(S,I),u.get(M).push(I)})});const D=n[0].tick.startDate,E=n[n.length-1].tick.endDate,C={startDate:D,endDate:E,calendars:m,includeNonWorkingIntervals:d},v=E.getTime()-D.getTime();if(v>s.getProject().maxCalendarRange&&(C.maxRange=v),yield*s.forEachAvailabilityInterval(C,(S,b,w)=>{const M=w.getCalendarsWorkStatus();if(M.get(t)){const I=w.intervalsByCalendar.get(t)[0],A=b.getTime()-S.getTime(),T=y.get(I),k=T.assignments||new Set,Z=T.assignmentIntervals||new Map;if(g&&g!==I){const Te=y.get(g);Te.isUnderallocated=Te.isUnderallocated||Te.effort&&Te.effort<Te.maxEffort}g=I,T.assignments||(h=0,f=0);let z=0,re=!1,be,Le=0;w.intervalsByCalendar.get(p).forEach(Te=>{const Be=Te.assignment,Dt=Be==null?void 0:Be.event;if(Dt&&M.get(Dt.effectiveCalendar)&&(Dt.ignoreResourceCalendar||M.get(a))){const Dr=Math.max(S.getTime(),Be.event.startDate.getTime()),bn=Math.min(b.getTime(),Be.event.endDate.getTime());re=!0,be=bn-Dr;const jt=c.get(Be).get(I),Ts=be*Be.units/100;jt.effort+=Ts,jt.units=Be.units,jt.inEventTimeSpan=!0,Le+=Ts,z+=Be.units,k.add(Be),Z.set(Be,jt)}}),T.inEventTimeSpan=T.inEventTimeSpan||re,M.get(a)&&(T.maxEffort+=A),z&&(be?(h+=be*z,f+=be,T.units=h/f):h||(T.units=z)),re&&(T.effort+=Le,T.assignments=k,T.assignmentIntervals=Z,T.isOverallocated=T.isOverallocated||T.effort>T.maxEffort||T.units>100,T.isUnderallocated=T.isUnderallocated||Le<A||T.units<100)}}),g){const S=y.get(g);S.isUnderallocated=S.isUnderallocated||S.effort&&S.effort<S.maxEffort}return{owner:this,resource:s,total:n,byAssignments:u}}};hs([q()],_i.prototype,"resource",void 0),hs([j("allocation")],_i.prototype,"calculateAllocation",null);var Fi=class extends O([bi],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.observers=new Set,this.entities=new Set}addObserver(r){this.graph.addIdentifier(r),this.observers.add(r)}removeObserver(r){this.graph&&this.graph.removeIdentifier(r),this.observers.delete(r)}addEntity(r){this.graph.addEntity(r),this.entities.add(r)}removeEntity(r){this.graph&&this.graph.removeEntity(r),this.entities.delete(r)}leaveGraph(r){const{graph:i}=this;for(const a of this.observers)this.removeObserver(a);for(const a of this.entities)this.removeEntity(a);n.leaveGraph.call(this,r)}*forEachAvailabilityInterval(r,i){const a=this.getProject(),o=yield this.$.effectiveCalendar,l=a.combineCalendars([o].concat(r.calendars||[])),c=a.maxCalendarRange,u=r.includeNonWorkingIntervals;return c&&(r=Object.assign({maxRange:c},r)),l.forEachAvailabilityInterval(r,(d,h,f)=>{const g=f.getCalendarsWorkStatus();if(u||g.get(o))return i(d,h,f)})}}return t}){},vn=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},xl=class extends O([Df,Lr,Gt],e=>{const n=e.prototype;class t extends e{construct(r={}){var i;this.eventSegmentModelClass=r.eventSegmentModelClass||this.getDefaultEventSegmentModelClass(),n.construct.call(this,r),this.includeAsapAlapAsConstraints=(i=r.includeAsapAlapAsConstraints)!=null?i:!0,this.resourceAllocationInfoClass||(this.resourceAllocationInfoClass=this.getDefaultResourceAllocationInfoClass())}getDefaultEventStoreClass(){return rs}getDefaultEventSegmentModelClass(){return El}getDefaultResourceAllocationInfoClass(){return _i}afterConfigure(){n.afterConfigure.apply(this,arguments),this.dateConstraintIntervalClass=this.dateConstraintIntervalClass||as,this.dependencyConstraintIntervalClass=this.dependencyConstraintIntervalClass||pn}getType(){return tn.SchedulerPro}getDefaultCycleEffectClass(){return fs}getDefaultEventModelClass(){return Oi}getDefaultDependencyModelClass(){return vl}getDefaultAssignmentModelClass(){return Pi}getDefaultResourceModelClass(){return Fi}async validateDependency(r,i,a,o){let l;return o&&(l=Array.isArray(o)?o:[o]),Me(r.outgoingDeps).some(u=>u.toEvent===i&&!(l!=null&&l.includes(u)))?wr.DuplicatingDependency:await this.isDependencyCyclic(r,i,a,l)?wr.CyclicDependency:wr.NoError}async isValidDependency(r,i,a,o){return await this.validateDependency(r,i,a,o)===wr.NoError}getDependencyCycleDetectionIdentifiers(r,i){return[i.$.earlyStartDateConstraintIntervals,i.$.earlyEndDateConstraintIntervals]}async isDependencyCyclic(r,i,a,o){const l=this.getDependencyStore().modelClass,c=new l({fromEvent:r,toEvent:i,type:a}),u=this.replica.branch({autoCommit:!1,onComputationCycle:"throw"});o&&(Array.isArray(o)||(o=[o]),o.forEach(d=>u.removeEntity(d))),u.addEntity(c),c.project=this;try{return await Promise.all(this.getDependencyCycleDetectionIdentifiers(r,i).map(d=>u.readAsync(d))),!1}catch(d){if(/cycle/i.test(d))return!0;if(!/conflict/i.test(d))throw d}}async isValidDependencyModel(r,i){return this.isValidDependency(r.fromEvent,r.toEvent,r.type,i)}}return vn([B({type:"string",defaultValue:Mr.ToEvent})],t.prototype,"dependenciesCalendar",void 0),vn([B({type:"boolean",defaultValue:!0})],t.prototype,"autoCalculatePercentDoneForParentTasks",void 0),vn([B({type:"boolean",defaultValue:!0})],t.prototype,"addConstraintOnDateSet",void 0),t}){},zf=class extends gt(Vn){static get $name(){return"DeactivateDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.active=!1}},fs=class extends jr{getInvalidDependencies(){if(!this._invalidDependencies){const e=this.getDependencies();this._invalidDependencies=e.filter(n=>n.fromEvent===n.toEvent||n.fromEvent.contains(n.toEvent)||n.toEvent.contains(n.fromEvent))}return this._invalidDependencies}buildInvalidDependencyResolutions(e){return[this.removeDependencyConflictResolutionClass.new(e),this.deactivateDependencyConflictResolutionClass.new(e)]}matchDependencyBySourceAndTargetEvent(e,n,t){return e.active&&super.matchDependencyBySourceAndTargetEvent(e,n,t)}getResolutions(){if(!this._resolutions){const e=this.getInvalidDependencies(),n=[];for(const t of e)n.push(...this.buildInvalidDependencyResolutions({dependency:t}));e.length||n.push(this.deactivateDependencyCycleEffectResolutionClass.new(),...super.getResolutions()),this._resolutions=n}return this._resolutions}};vn([G(zf)],fs.prototype,"deactivateDependencyCycleEffectResolutionClass",void 0),vn([G(pl)],fs.prototype,"removeDependencyConflictResolutionClass",void 0),vn([G(ml)],fs.prototype,"deactivateDependencyConflictResolutionClass",void 0);var qf=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Gf=class extends O([or,Gt,Lr],e=>{const n=e.prototype;class t extends e{*maybeSkipNonWorkingTime(r,i=!0){return(yield this.$.childEvents).size>0?r:yield*n.maybeSkipNonWorkingTime.call(this,r,i)}*calculateStartDateConstraintIntervals(){const r=yield*n.calculateStartDateConstraintIntervals.call(this),i=yield this.$.parentEvent;if(i!=null&&i.graph){const a=yield i.$.startDateConstraintIntervals;r.push.apply(r,a)}return r}*calculateEndDateConstraintIntervals(){const r=yield*n.calculateEndDateConstraintIntervals.call(this),i=yield this.$.parentEvent;if(i!=null&&i.graph){const a=yield i.$.endDateConstraintIntervals;r.push.apply(r,a)}return r}*calculateEarlyStartDateConstraintIntervals(){const r=yield*n.calculateEarlyStartDateConstraintIntervals.call(this),i=yield this.$.parentEvent;if(i!=null&&i.graph){const a=yield i.$.earlyStartDateConstraintIntervals;r.push.apply(r,a),(yield i.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Forward&&r.push(gs.new({owner:i,side:ce.Start,startDate:yield i.$.startDate}))}return r}*calculateEarlyEndDateConstraintIntervals(){const r=yield*n.calculateEarlyEndDateConstraintIntervals.call(this),i=yield this.$.parentEvent;if(i!=null&&i.graph){const a=yield i.$.earlyEndDateConstraintIntervals;r.push.apply(r,a)}return r}}return t}){},Hf=class extends gt(mi){static get $name(){return"RemoveManuallyScheduledParentConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return pt(this.L("L{descriptionTpl}"),e.name||e.id)}resolve(){this.event.manuallyScheduled=!1}},Yf=class extends fn{static get $name(){return"ManuallyScheduledParentConstraintIntervalDescription"}static getDescription(e){let n;switch(e.side){case ce.Start:n=this.L("L{startDescriptionTpl}");break;case ce.End:n=this.L("L{endDescriptionTpl}");break}return pt(n,...this.getDescriptionParameters(e))}static getDescriptionParameters(e){const n=e.owner;return[R.format(e.startDate,this.L("L{dateFormat}")),R.format(e.endDate,this.L("L{dateFormat}")),n.name||n.id]}},gs=class extends ur{getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const n=this.owner;e=e||n.graph.activeTransaction;const t=e.entries.get(n.$.manuallyScheduled);return!e.baseRevision.hasIdentifier(n.$$)||t&&!t.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.resetManuallyScheduledConflictResolutionClass.new({interval:this})])}};qf([G(Hf)],gs.prototype,"resetManuallyScheduledConflictResolutionClass",void 0),qf([G(Yf)],gs.prototype,"descriptionBuilderClass",void 0);var ve=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},ji=class extends O([Lr,Gt],e=>{const n=e.prototype;class t extends e{*calculateLateStartDateConstraintIntervals(){const r=[],i=yield this.$.parentEvent;if(i){const a=yield i.$.lateStartDateConstraintIntervals;r.push.apply(r,a)}return r}*calculateLateEndDateConstraintIntervals(){const r=[],i=yield this.$.parentEvent;if(i){const a=yield i.$.lateEndDateConstraintIntervals;r.push.apply(r,a),(yield i.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Backward&&r.push(gs.new({side:ce.End,endDate:yield i.$.endDate}))}return r}*shouldRollupChildLateStartDate(r){return!0}*calculateMinChildrenLateStartDate(){let r=ae;const i=yield*this.subEventsIterable();for(let a of i){if(!(yield*this.shouldRollupChildLateStartDate(a)))continue;let o;(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.minChildrenLateStartDate),o=o||(yield a.$.lateStartDate),o&&o<r&&(r=o)}return r.getTime()-ae.getTime()?r:null}*calculateLateStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Backward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenLateStartDate;if(!(yield*this.isConstrainedLate()))return yield this.$.startDate;const r=(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),i=(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals);let a=yield*this.calculateEffectiveConstraintInterval(!0,r,i);if(a===null)return null;if(a.isIntervalEmpty()){a=yield*this.calculateEffectiveConstraintInterval(!0,r,i,!0);const o=cr.new({intervals:[...a.intersectionOf]});if((yield o)===bt.Cancel)yield kt(o);else return null}return Bt(a.endDate)?a.endDate:null}*shouldRollupChildLateEndDate(r){return!0}*calculateMaxChildrenLateEndDate(){let r=he;const i=yield*this.subEventsIterable();for(let a of i){if(!(yield*this.shouldRollupChildLateEndDate(a)))continue;let o;(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.maxChildrenLateEndDate),o=o||(yield a.$.lateEndDate),o&&o>r&&(r=o)}return r.getTime()-he.getTime()?r:null}*calculateLateStartDate(){return yield this.$.lateStartDateRaw}*calculateLateEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Backward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenLateEndDate;if(!(yield*this.isConstrainedLate()))return yield this.$.endDate;const r=yield this.$.lateStartDateConstraintIntervals,i=yield this.$.lateEndDateConstraintIntervals;let a=yield*this.calculateEffectiveConstraintInterval(!1,r.concat(yield this.$.startDateConstraintIntervals),i.concat(yield this.$.endDateConstraintIntervals));if(a===null)return null;if(a.isIntervalEmpty()){a=yield*this.calculateEffectiveConstraintInterval(!1,(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals),!0);const o=cr.new({intervals:[...a.intersectionOf]});if((yield o)===bt.Cancel)yield kt(o);else return null}return Bt(a.endDate)?a.endDate:null}*calculateLateEndDate(){const r=yield this.$.lateEndDateRaw;return yield*this.maybeSkipNonWorkingTime(r,!1)}*calculateTotalSlack(){const r=yield this.$.earlyStartDateRaw,i=yield this.$.lateStartDateRaw,a=yield this.$.earlyEndDateRaw,o=yield this.$.lateEndDateRaw,l=yield this.$.slackUnit;let c,u;return(r&&i||a&&o)&&(r&&i?(u=yield*this.calculateProjectedDuration(r,i,l),a&&o&&(c=yield*this.calculateProjectedDuration(a,o,l),c<u&&(u=c))):a&&o&&(u=yield*this.calculateProjectedDuration(a,o,l))),u}*calculateCritical(){return(yield this.$.totalSlack)<=0}*isConstrainedLate(){const r=yield this.$.startDateConstraintIntervals,i=yield this.$.endDateConstraintIntervals,a=yield this.$.lateStartDateConstraintIntervals,o=yield this.$.lateEndDateConstraintIntervals;return!!(r!=null&&r.length||i!=null&&i.length||a!=null&&a.length||o!=null&&o.length)}*calculateStartDatePure(){return(yield this.$.effectiveDirection).direction===L.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateStartDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():yield this.$.lateStartDate:yield*n.calculateStartDatePure.call(this)}*calculateStartDateProposed(){switch((yield this.$.effectiveDirection).direction){case L.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateStartDateProposed.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():(yield this.$.lateStartDate)||(yield*n.calculateStartDateProposed.call(this));default:return yield*n.calculateStartDateProposed.call(this)}}*calculateEndDatePure(){return(yield this.$.effectiveDirection).direction===L.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateEndDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():yield this.$.lateEndDate:yield*n.calculateEndDatePure.call(this)}*calculateEndDateProposed(){switch((yield this.$.effectiveDirection).direction){case L.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*n.calculateEndDateProposed.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():(yield this.$.lateEndDate)||(yield*n.calculateEndDateProposed.call(this));default:return yield*n.calculateEndDateProposed.call(this)}}}return ve([q({lazy:Ee})],t.prototype,"minChildrenLateStartDate",void 0),ve([q({lazy:Ee})],t.prototype,"lateStartDateRaw",void 0),ve([B({type:"date",persist:!1},{lazy:Ee,converter:zt,persistent:!1})],t.prototype,"lateStartDate",void 0),ve([q({lazy:Ee})],t.prototype,"maxChildrenLateEndDate",void 0),ve([q({lazy:Ee})],t.prototype,"lateEndDateRaw",void 0),ve([B({type:"date",persist:!1},{lazy:Ee,converter:zt,persistent:!1})],t.prototype,"lateEndDate",void 0),ve([q({lazy:Ee})],t.prototype,"lateStartDateConstraintIntervals",void 0),ve([q({lazy:Ee})],t.prototype,"lateEndDateConstraintIntervals",void 0),ve([B({type:"number",persist:!1},{lazy:Ee,persistent:!1})],t.prototype,"totalSlack",void 0),ve([B({type:"string",defaultValue:V.Day,persist:!1},{lazy:Ee,converter:R.normalizeUnit,persistent:!1})],t.prototype,"slackUnit",void 0),ve([B({type:"boolean",defaultValue:!1,persist:!1},{persistent:!1,lazy:Ee})],t.prototype,"critical",void 0),ve([j("lateStartDateConstraintIntervals")],t.prototype,"calculateLateStartDateConstraintIntervals",null),ve([j("lateEndDateConstraintIntervals")],t.prototype,"calculateLateEndDateConstraintIntervals",null),ve([j("minChildrenLateStartDate")],t.prototype,"calculateMinChildrenLateStartDate",null),ve([j("lateStartDateRaw")],t.prototype,"calculateLateStartDateRaw",null),ve([j("maxChildrenLateEndDate")],t.prototype,"calculateMaxChildrenLateEndDate",null),ve([j("lateStartDate")],t.prototype,"calculateLateStartDate",null),ve([j("lateEndDateRaw")],t.prototype,"calculateLateEndDateRaw",null),ve([j("lateEndDate")],t.prototype,"calculateLateEndDate",null),ve([j("totalSlack")],t.prototype,"calculateTotalSlack",null),ve([j("critical")],t.prototype,"calculateCritical",null),t}){},Gv=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Tl=class extends O([fl,ji],e=>{const n=e.prototype;class t extends e{*shouldSuccessorAffectScheduling(r){const i=yield r.$.toEvent;return i&&!Cr(i)&&(yield r.$.active)&&(!(yield i.$.inactive)||(yield this.$.inactive))}*calculateLateStartDateConstraintIntervals(){const r=yield*n.calculateLateStartDateConstraintIntervals.call(this),i=this.getProject(),a=i.dependencyConstraintIntervalClass;let o;for(o of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(o)))continue;const l=yield o.$.toEvent,c=yield l.$.manuallyScheduled;let u;switch(yield o.$.type){case _e.StartToStart:u=c?yield l.$.startDate:yield l.$.lateStartDateRaw;break;case _e.StartToEnd:u=c?yield l.$.endDate:yield l.$.lateEndDateRaw;break}if(u){const d=yield o.$.lag,h=yield o.$.lagUnit,f=yield*i.$convertDuration(d,h,V.Millisecond),g=yield o.$.calendar;yield g.$.version;let p=u;f&&(p=g.skipNonWorkingTime(g.calculateStartDate(u,f)));const m=a.new({owner:o,startDate:null,endDate:p});r.unshift(m)}}return r}*calculateLateEndDateConstraintIntervals(){const r=yield*n.calculateLateEndDateConstraintIntervals.call(this),i=this.getProject(),a=i.dependencyConstraintIntervalClass;let o;for(o of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(o)))continue;const l=yield o.$.toEvent,c=yield l.$.manuallyScheduled;let u;switch(yield o.$.type){case _e.EndToEnd:u=c?yield l.$.endDate:yield l.$.lateEndDateRaw;break;case _e.EndToStart:u=c?yield l.$.startDate:yield l.$.lateStartDateRaw;break}if(u){const d=yield o.$.lag,h=yield o.$.lagUnit,f=yield*i.$convertDuration(d,h,V.Millisecond),g=yield o.$.calendar;yield g.$.version;let p=u;f&&(p=g.skipNonWorkingTime(g.calculateStartDate(u,f)));const m=a.new({owner:o,startDate:null,endDate:p});r.unshift(m)}}return r}*calculateEffectiveDirection(){const r=yield this.getProject().$.effectiveDirection,i=yield this.$.constraintType;if(r.direction===L.Backward&&!(yield this.$.manuallyScheduled)&&!((i===N.MustStartOn||i===N.MustFinishOn)&&(yield this.$.constraintDate)))for(const a of yield this.$.outgoingDeps){const o=yield a.$.toEvent,l=o!=null&&!Cr(o),c=l?yield o.$.constraintType:void 0;if(!l||!(yield a.$.active)||(yield o.$.manuallyScheduled)||(c===N.MustStartOn||c===N.MustFinishOn)&&(yield o.$.constraintDate))continue;const u=yield a.$.type,d=u===_e.EndToEnd||u===_e.StartToEnd?yield o.$.endDateDirection:yield o.$.startDateDirection;if(d.direction===L.Forward)return{kind:"enforced",direction:L.Forward,enforcedBy:d.kind==="enforced"?d.enforcedBy:d.kind==="own"?o:d.inheritedFrom}}return yield*super.calculateEffectiveDirection()}}return Gv([j("lateStartDateIntervals")],t.prototype,"calculateLateStartDateConstraintIntervals",null),t}){},Ol=Xt.new({variables:new Set([J,Q,te,Pe,we]),formulas:new Set([mr,Ze,pr,Yt,vr,Je,Qe])}),Kf=Fe.new({description:Ol,defaultResolutionFormulas:new Set([mr,Ze])}),Jf=Fe.new({description:Ol,defaultResolutionFormulas:new Set([vr,Ze])}),Qf=class extends O([ds],e=>{const n=e.prototype;class t extends e{*prepareDispatcher(r){if((yield*this.effectiveSchedulingMode())===me.FixedEffort){const a=yield*n.prepareDispatcher.call(this,r);return(yield ct(this.$.assigned))&&a.addProposedValueFlag(we),a.addKeepIfPossibleFlag(Pe),a}else return yield*n.prepareDispatcher.call(this,r)}cycleResolutionContext(r){if(this.effectiveSchedulingModeSync(r)===me.FixedEffort){const a=r(this.$.effectiveDirection);return a.direction===L.Forward||a.direction===L.None?Kf:Jf}else return n.cycleResolutionContext.call(this,r)}}return t}){},ps=Xt.new({variables:new Set([J,Q,te,Pe,we]),formulas:new Set([mr,Ze,Yt,pr,vr,Je,Qe])}),Zf=Fe.new({description:ps,defaultResolutionFormulas:new Set([mr,Qe,Yt])}),Xf=Fe.new({description:ps,defaultResolutionFormulas:new Set([mr,Qe,Ze])}),eg=Fe.new({description:ps,defaultResolutionFormulas:new Set([vr,Je,Yt])}),tg=Fe.new({description:ps,defaultResolutionFormulas:new Set([vr,Je,Ze])}),rg=class extends O([ds],e=>{const n=e.prototype;class t extends e{*prepareDispatcher(r){if((yield*this.effectiveSchedulingMode())===me.FixedUnits){const a=yield*n.prepareDispatcher.call(this,r);return(yield ct(this.$.assigned))&&a.addProposedValueFlag(we),(yield this.$.effortDriven)&&a.addKeepIfPossibleFlag(Pe),a.addKeepIfPossibleFlag(we),a}else return yield*n.prepareDispatcher.call(this,r)}cycleResolutionContext(r){if(this.effectiveSchedulingModeSync(r)===me.FixedUnits){const a=r(this.$.effectiveDirection),o=r(this.$.effortDriven);return a.direction===L.Forward||a.direction===L.None?o?Xf:Zf:o?tg:eg}else return n.cycleResolutionContext.call(this,r)}}return t}){},ng=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},Hv=class extends O([Tl],e=>{const n=e.prototype;class t extends e{writeInactive(r,i,a,o){var l;const c=!i.baseRevision.hasIdentifier(r);if(r.constructor.prototype.write.call(this,r,i,a,o),!c&&this.children&&!((l=this.stm)!=null&&l.isRestoring))for(const u of this.children)u.inactive=o}*calculateInactive(){const r=yield X;if(yield*this.hasSubEvents()){const i=yield*this.subEventsIterable();let a=0;for(const o of i)(yield o.$.inactive)||a++;return!a}return r}*shouldRollupChildEffort(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildPercentDoneSummaryData(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildStartDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEndDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyStartDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyEndDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateStartDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateEndDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}}return ng([dt("inactive")],t.prototype,"writeInactive",null),ng([j("inactive")],t.prototype,"calculateInactive",null),t}){},Al=class extends _a([Oi,Gf,ji,Tl,Qf,rg,Hv],e=>{class n extends e{}return n}){},sg=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},ig=class extends O([Gt],e=>{const n=e.prototype;class t extends e{*calculateCriticalPaths(){const r=[],i=[],a=yield this.$.childEvents,o=[...a],l=yield this.$.endDate;let c;for(;c=o.shift();){const d=yield c.$.childEvents,h=yield c.$.critical,f=!(yield c.$.inactive),g=yield c.$.endDate;f&&g&&g.getTime()-l.getTime()===0&&h&&i.push([{event:c}]),o.push(...d)}let u;for(;u=i.shift();){let d=u.length-1,h;for(;h=u[d];){const f=[];for(const g of yield h.event.$.incomingDeps){const p=yield g.$.fromEvent;p&&(yield g.$.active)&&!(yield p.$.inactive)&&(yield p.$.critical)&&f.push({event:p,dependency:g})}if(f.length){const g=u.slice();u.push(f[0]);for(let p=1;p<f.length;p++)i.push(g.concat(f[p]));d++}else d=-1}r.push(u.reverse())}return r}}return sg([q({lazy:!0})],t.prototype,"criticalPaths",void 0),sg([j("criticalPaths")],t.prototype,"calculateCriticalPaths",null),t}){},$l=function(e,n,t,s){var r=arguments.length,i=r<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(n,t,i):a(n,t))||i);return r>3&&i&&Object.defineProperty(n,t,i),i},ag=class extends O([xl,Ti,ji,ig],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.nonEqual=!1}*calculateNonEqual(){return!(yield X)}get isGanttProjectMixin(){return!0}afterConfigure(){n.afterConfigure.apply(this,arguments),this.projectConstraintIntervalClass=this.projectConstraintIntervalClass||ki}*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}*calculateStartDate(){const r=yield this.$.effectiveDirection;if(r.direction===L.Forward){let i=yield X;return i||(i=yield*this.unsafeCalculateInitialMinChildrenStartDateDeep(),i||(yield this.$.nonEqual)),i}else if(r.direction===L.Backward){const i=yield*this.calculateMinChildrenStartDate(),a=yield this.$.endDate;return i&&a>i?i:a}}*calculateEndDate(){const r=yield this.$.effectiveDirection;if(r.direction===L.Forward){const i=yield this.$.startDate,a=yield*this.calculateMaxChildrenEndDate();return a&&a>i?a:i}else if(r.direction===L.Backward){let i=yield X;return i||(i=yield*this.unsafeCalculateInitialMaxChildrenEndDateDeep(),i||(yield this.$.nonEqual)),i}}*shouldRollupChildStartDate(r){return!(yield r.$.inactive)}*shouldRollupChildEndDate(r){return!(yield r.$.inactive)}*calculateEarlyStartDateConstraintIntervals(){const r=yield*n.calculateEarlyStartDateConstraintIntervals.call(this),i=yield this.$.effectiveDirection;if(i.direction===L.Forward){const a=yield this.$.startDate;a&&r.push(this.projectConstraintIntervalClass.new({owner:this,side:ce.Start,startDate:a}))}else if(i.direction===L.Backward){const a=yield this.$.lateStartDate;a&&r.push(this.projectConstraintIntervalClass.new({owner:this,side:ce.Start,startDate:a}))}return r}*calculateLateEndDateConstraintIntervals(){const r=yield*n.calculateLateEndDateConstraintIntervals.call(this),i=yield this.$.effectiveDirection;if(i.direction===L.Forward){const a=yield this.$.earlyEndDate;a&&r.push(this.projectConstraintIntervalClass.new({owner:this,side:ce.End,endDate:a}))}else if(i.direction===L.Backward){const a=yield this.$.endDate;a&&r.push(this.projectConstraintIntervalClass.new({owner:this,side:ce.End,endDate:a}))}return r}getDefaultEventModelClass(){return Al}getDefaultAssignmentModelClass(){return Pi}getDefaultResourceModelClass(){return Fi}getDefaultEventStoreClass(){return Yo}getType(){return tn.Gantt}*unsafeCalculateInitialMinChildrenStartDateDeep(){const r=yield this.$.childEvents;if(!r.size)return yield br(this.$.startDate);let i=ae,a;const o=[...r];for(;a=o.shift();){let l=yield br(a.$.startDate);l||(l=yield br(a.$.endDate)),l&&l<i&&(i=l),o.push(...yield a.$.childEvents)}return i.getTime()!==he.getTime()&&i.getTime()!==ae.getTime()?i:null}*unsafeCalculateInitialMaxChildrenEndDateDeep(){const r=yield this.$.childEvents;if(!r.size)return yield br(this.$.endDate);let i=he,a;const o=[...r];for(;a=o.shift();){let l=yield br(a.$.endDate);l||(l=yield br(a.$.startDate)),l&&l>i&&(i=l),o.push(...yield a.$.childEvents)}return i.getTime()!==he.getTime()&&i.getTime()!==ae.getTime()?i:null}getDependencyCycleDetectionIdentifiers(r,i){return[i.$.earlyStartDateConstraintIntervals,i.$.earlyEndDateConstraintIntervals,i.$.lateEndDateConstraintIntervals,i.$.lateStartDateConstraintIntervals]}}return $l([q({equality:()=>!1})],t.prototype,"nonEqual",void 0),$l([j("nonEqual")],t.prototype,"calculateNonEqual",null),t}){},og=class extends fn{static get $name(){return"ProjectConstraintIntervalDescription"}static getDescription(e){return pt(e.startDate?this.L("L{startDateDescriptionTpl}"):this.L("L{endDateDescriptionTpl}"),...this.getDescriptionParameters(e))}},ki=class extends ur{isAffectedByTransaction(e){const n=this.owner;e=e||n.graph.activeTransaction;const t=e.entries.get(this.startDate?n.$.startDate:n.$.endDate);return t&&!t.isShadow()}};$l([G(og)],ki.prototype,"descriptionBuilderClass",void 0);var Li=class extends O([zn],e=>{const n=e.prototype;class t extends e{get eventStore(){var r;return(r=this.project)==null?void 0:r.eventStore}get resourceStore(){var r;return(r=this.project)==null?void 0:r.resourceStore}get assignmentStore(){var r;return(r=this.project)==null?void 0:r.assignmentStore}get dependencyStore(){var r;return(r=this.project)==null?void 0:r.dependencyStore}get calendarManagerStore(){var r;return(r=this.project)==null?void 0:r.calendarManagerStore}getEventById(r){var i;return(i=this.eventStore)==null?void 0:i.getById(r)}getDependencyById(r){var i;return(i=this.dependencyStore)==null?void 0:i.getById(r)}getResourceById(r){var i;return(i=this.resourceStore)==null?void 0:i.getById(r)}getAssignmentById(r){var i;return(i=this.assignmentStore)==null?void 0:i.getById(r)}getCalendarById(r){var i;return(i=this.calendarManagerStore)==null?void 0:i.getById(r)}}return t}){},yn=class extends O([cn,Li,H],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(r=!1){var i;n.leaveProject.call(this,r),(i=this.project)==null||i.bufferedCommitAsync()}invalidate(){var r;(r=this.project)==null||r.invalidate(this)}getCurrentOrProposed(r){var i;return r in this.$changed&&this.$changed[r]!==!0?this.$changed[r]:(i=this.get(r))!=null?i:null}hasCurrentOrProposed(r){return r in this.$changed&&this.$changed[r]!=!0||this.get(r)!=null}propose(r){var i;if(this.project||(i=this.recurringTimeSpan)!=null&&i.project){const a=Object.keys(r);for(let o=0;o<a.length;o++){const l=a[o];this.$changed[l]=r[l]}this.invalidate()}else this.set(r)}setChanged(r,i,a=!0,o=!1){const l=this;l.$changed[r]=i,o&&(r in l.$beforeChange||(l.$beforeChange[r]=l.get(r)),l.setData(r,i)),a&&l.invalidate()}calculateInvalidated(){}finalizeInvalidated(r=!1){const i=this;i.$isCalculating=!0,r?i.setData(i.$changed):(i.setData(i.$beforeChange),i.set(i.$changed)),i.$changed={},i.$beforeChange={},i.$isCalculating=!1}}return t}){},Kt=class extends O([yn],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var r,i;return(i=(r=this._startDate)!=null?r:this.get("startDate"))!=null?i:null}get endDate(){var r,i;return(i=(r=this._endDate)!=null?r:this.get("endDate"))!=null?i:null}get duration(){var r,i;return(i=(r=this._duration)!=null?r:this.get("duration"))!=null?i:null}set startDate(r){this.proposeStartDate(r)}set endDate(r){this.proposeEndDate(r)}set duration(r){this.proposeDuration(r)}inSet(r,i,a,o,l){const c=this;return c.project&&!c.project.isWritingData&&typeof r!="string"&&!l&&("startDate"in r&&!("startDate"in c.$changed)&&(c.$changed.startDate=!0,c.invalidate()),"endDate"in r&&!("endDate"in c.$changed)&&(c.$changed.endDate=!0,c.invalidate())),n.inSet.call(c,r,i,a,o,l)}getStartDate(){return this.startDate}proposeStartDate(r,i=!("endDate"in this.$changed)){var a;(this.inSetting||(r==null?void 0:r.getTime())!==((a=this.startDate)==null?void 0:a.getTime()))&&(this._startDate=r,this.propose({startDate:r,keepDuration:i}))}async setStartDate(r,i=!0){var a;return this.proposeStartDate(r,i),(a=this.project)==null?void 0:a.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(r,i=!1){var a;(this.inSetting||(r==null?void 0:r.getTime())!==((a=this.endDate)==null?void 0:a.getTime()))&&(this._endDate=r,this.propose({endDate:r,keepDuration:i}))}async setEndDate(r,i=!1){var a;return this.proposeEndDate(r,i),(a=this.project)==null?void 0:a.commitAsync()}getDuration(){return this.duration}proposeDuration(r,i,a=!0){this._duration=r,this.propose({duration:r,keepStart:a}),i&&this.propose({durationUnit:i})}async setDuration(r,i,a=!0){var o;return this.proposeDuration(r,i,a),(o=this.project)==null?void 0:o.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){var r,i;const a=this,o=a.$changed,l=a.getCurrentOrProposed("startDate"),c=a.getCurrentOrProposed("endDate"),u=a.getCurrentOrProposed("duration");if(l!=null&&(o.startDate=a._startDate=l),c!=null&&(o.endDate=a._endDate=c),u!=null&&(o.duration=a._duration=u),a.eventStore&&!a.eventStore.isLoadingData){const d=(r=a.assignmentStore)==null?void 0:r.storage.findItem("event",null);if(d){const h=(i=a.assignmentStore)==null?void 0:i.storage.findItem("eventId",a.id);if(h)for(const f of h)f.setChanged("event",a);else for(const f of d)f.getCurrentOrProposed("event")===a.id&&f.setChanged("event",a)}}n.joinProject.call(a)}applyValue(r,i,a,o,l){var c;if((this.project||(c=this.recurringTimeSpan)!=null&&c.project)&&l){const{name:u}=l;(u==="startDate"||u=="duration"||u==="endDate")&&(r=!0,this["_"+u]=a),o&&(r=!1)}n.applyValue.call(this,r,i,a,o,l)}afterChange(r,i,a,o,l){!this.$isCalculating&&!l&&this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),n.afterChange.call(this,r,i,a,o,l)}calculateInvalidated(){const r=this,i=r.$changed,a="startDate"in i,o="endDate"in i,l="duration"in i,{startDate:c,endDate:u,duration:d,keepDuration:h,keepStart:f}=i;let g=null;a&&!o&&!l?c===null?i.endDate=null:r.hasCurrentOrProposed("endDate")&&c>r.getCurrentOrProposed("endDate")&&!h?(i.endDate=c,i.duration=0):r.hasCurrentOrProposed("duration")&&(h||!r.hasCurrentOrProposed("endDate"))?g="endDate":r.hasCurrentOrProposed("endDate")&&(g="duration"):!a&&o&&!l?u===null?i.startDate=null:r.hasCurrentOrProposed("startDate")&&!h&&u!==!0&&u<r.getCurrentOrProposed("startDate")?(i.startDate=u,i.duration=0):r.hasCurrentOrProposed("duration")&&(h||!r.hasCurrentOrProposed("startDate"))?g="startDate":r.hasCurrentOrProposed("startDate")&&(g="duration"):!a&&!o&&l?d===null?i.endDate=null:r.hasCurrentOrProposed("startDate")&&(f||!r.hasCurrentOrProposed("endDate"))?(f&&i.duration<0&&(i.duration=0),g="endDate"):r.hasCurrentOrProposed("endDate")&&(g="startDate"):a&&o&&!l?c===null&&u===null?i.duration=null:g="duration":a&&!o&&l?g="endDate":!a&&o&&l?g="startDate":a&&o&&l&&(d==null?g="duration":c==null?g="startDate":g="endDate");const p=r.getCurrentOrProposed("startDate"),m=r.getCurrentOrProposed("endDate"),y=r.getCurrentOrProposed("duration"),D=r.getCurrentOrProposed("durationUnit");let E,C;switch(g){case"startDate":i.startDate=R.add(m,-y,D);break;case"endDate":E=R.as("hour",y,D),C=R.as(D,E,"h"),i.endDate=R.add(p,C,D);break;case"duration":E=R.diff(p,m,"h"),i.duration=R.as(D,E,"h");break}"startDate"in i&&i.startDate!==!0&&(this._startDate=i.startDate),"endDate"in i&&i.endDate!==!0&&(this._endDate=i.endDate),"duration"in i&&i.duration!==!0&&(this._duration=i.duration),i.startDate===!0&&delete i.startDate,i.endDate===!0&&delete i.endDate,delete i.keepDuration,delete i.keepStart}}return t}){},Sn=class extends O([yn],e=>{const n=e.prototype;class t extends e{get assigned(){var r;return(r=this.project)==null?void 0:r.assignmentStore.getResourcesAssignments(this)}joinProject(){var r;this.resourceStore&&!this.resourceStore.isLoadingData&&((r=this.assignmentStore)==null||r.query(i=>i.get("resource")===this.id).forEach(i=>i.setChanged("resource",this))),n.joinProject.call(this)}leaveProject(r=!1){var i;if(this.assigned&&!r&&!((i=this.resourceStore)!=null&&i.isLoadingData)){const a=this.resourceStore;this.assigned.forEach(o=>a.assignmentsForRemoval.add(o))}n.leaveProject.call(this)}applyValue(r,i,a,o,l){(l==null?void 0:l.name)==="id"&&this.assigned.forEach(c=>{c.set("resourceId",a)}),n.applyValue.call(this,r,i,a,o,l)}}return t}){};function Bi(e){return e!=null&&e.isModel?e.id:e}var Ni=class extends O([yn],e=>{const n=e.prototype;class t extends e{static get fields(){return[{name:"resource",isEqual:(r,i)=>r===i,persist:!1},{name:"event",isEqual:(r,i)=>r===i,persist:!1}]}setChanged(r,i,a){const{assignmentStore:o,eventStore:l,resourceStore:c,project:u}=this;let d=!1;if(r==="event"){const h=ze(i,Kt)?i:l==null?void 0:l.$master.getById(i);h&&(d=!0),i=h||i}if(r==="resource"){const h=ze(i,Sn)?i:c==null?void 0:c.$master.getById(i);h&&(d=!0),i=h||i}n.setChanged.call(this,r,i,a,!0),o&&d&&!u.isPerformingCommit&&!o.isLoadingData&&!(c!=null&&c.isLoadingData)&&!o.skipInvalidateIndices&&o.invalidateIndices()}joinProject(){n.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){var r,i;let{event:a=this.event,resource:o=this.resource}=this.$changed;if(a!==null&&!ze(a,Kt)){const l=(r=this.eventStore)==null?void 0:r.getById(a);l&&this.setChanged("event",l,!1)}if(o!==null&&!ze(o,Sn)){const l=(i=this.resourceStore)==null?void 0:i.getById(o);l&&this.setChanged("resource",l,!1)}}finalizeInvalidated(r){const i=this.$changed;"resource"in i&&(i.resourceId=Bi(i.resource)),"event"in i&&(i.eventId=Bi(i.event)),n.finalizeInvalidated.call(this,r)}set event(r){this.setChanged("event",r),this.setChanged("eventId",Bi(r))}get event(){const r=this.get("event");return(r==null?void 0:r.id)!=null?r:null}set resource(r){this.setChanged("resource",r),this.setChanged("resourceId",Bi(r))}get resource(){const r=this.get("resource");return(r==null?void 0:r.id)!=null?r:null}}return t}){},Dn=class extends O([mt,Li,K],e=>{const n=e.prototype;class t extends e{setProject(r){const i=n.setProject.call(this,r);return r&&this.joinProject(r),i}joinProject(r){}onCommitAsync(){}}return t}){},lg=new Set,_l=class extends O([nl,Dn],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:Ni,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(r){this.allAssignmentsForRemoval=!0,super.data=r,this.allAssignmentsForRemoval=!1}getEventsAssignments(r){return this.storage.findItem("event",r,!0)||lg}getResourcesAssignments(r){return this.storage.findItem("resource",r.$original,!0)||lg}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(r,i){r=r.masterStore||r;const a=this.count&&this.storage.findItem(i,null,!0);if(a){for(const o of a){const l=r.getById(o.getCurrentOrProposed(i));l&&o.setChanged(i,l)}this.invalidateIndices()}}unlinkAssignments(r){this.forEach(i=>{var a,o,l;return i.setChanged(r,(l=(o=(a=i[r])==null?void 0:a.id)!=null?o:i==null?void 0:i.getData(r))!=null?l:i[r+"Id"])}),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},Fl=class extends O([jo,yn],e=>{const n=e.prototype;class t extends e{}return t}){},cg=class extends O([il,Dn],e=>{const n=e.prototype;class t extends e{static get defaultConfig(){return{tree:!0,modelClass:Fl}}}return t}){},Vi=class extends O([yn],e=>{const n=e.prototype;class t extends e{static get fields(){return[{name:"fromEvent",isEqual:(r,i)=>r===i,persist:!1},{name:"toEvent",isEqual:(r,i)=>r===i,persist:!1}]}setChanged(r,i,a){var o,l,c;let u=!1;if(r==="fromEvent"||r==="toEvent"){const d=ze(i,Kt)?i:(o=this.eventStore)==null?void 0:o.getById(i);d&&(u=!0),i=d||i}n.setChanged.call(this,r,i,a,!0),u&&!this.project.isPerformingCommit&&!((l=this.dependencyStore)!=null&&l.isLoadingData)&&((c=this.dependencyStore)==null||c.invalidateIndices())}joinProject(){n.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){var r,i;let{fromEvent:a,toEvent:o}=this.$changed;if(a!==null&&!ze(a,Kt)){const l=(r=this.eventStore)==null?void 0:r.getById(a);l&&(this.$changed.fromEvent=l)}if(o!==null&&!ze(o,Kt)){const l=(i=this.eventStore)==null?void 0:i.getById(o);l&&(this.$changed.toEvent=l)}}set fromEvent(r){this.setChanged("fromEvent",r)}get fromEvent(){const r=this.get("fromEvent");return(r==null?void 0:r.id)!=null?r:null}set toEvent(r){this.setChanged("toEvent",r)}get toEvent(){const r=this.get("toEvent");return(r==null?void 0:r.id)!=null?r:null}}return t}){},ug=new Set,jl=class extends O([ol,Dn],e=>{const n=e.prototype;class t extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:Vi,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(r){return this.storage.findItem("toEvent",r)||ug}getOutgoingDepsForEvent(r){return this.storage.findItem("fromEvent",r)||ug}set data(r){this.allDependenciesForRemoval=!0,super.data=r,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},dg=class extends O([Kt,zo],e=>{const n=e.prototype;class t extends e{get assigned(){var r,i;return(i=(r=this.project)==null?void 0:r.assignmentStore.getEventsAssignments(this))!=null?i:this.$cachedAssignments}leaveProject(r=!1){this.$cachedAssignments=this.assigned,super.leaveProject(r)}applyValue(r,i,a,o,l){var c;i==="id"&&((c=this.assigned)==null||c.forEach(u=>u.set("eventId",a))),n.applyValue.call(this,r,i,a,o,l)}copy(r=null,i=null){const a=n.copy.call(this,r,i);return(x.isObject(i)&&!i.skipFieldIdentifiers||!x.isObject(i))&&(a.$cachedAssignments=this.assigned),a}}return t}){},hg=class extends O([Kt],e=>{const n=e.prototype;class t extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const r=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach(i=>r.dependenciesForRemoval.add(i)),this.incomingDeps&&this.incomingDeps.forEach(i=>r.dependenciesForRemoval.add(i)),n.leaveProject.call(this)}}return t}){},Ui=class extends O([Kt,dg,hg],e=>{const n=e.prototype;class t extends e{}return t}){},kl=class extends O([Ho,Dn],e=>{const n=e.prototype;class t extends e{static get defaultConfig(){return{modelClass:Ui}}joinProject(){var r;(r=this.assignmentStore)==null||r.linkAssignments(this,"event")}afterLoadData(){var r;this.afterEventRemoval(),(r=this.assignmentStore)==null||r.linkAssignments(this,"event")}}return t}){},Ll=class extends O([cl,Dn],e=>{const n=e.prototype;class t extends e{static get defaultConfig(){return{modelClass:Sn}}joinProject(){var r;(r=this.assignmentStore)==null||r.linkAssignments(this,"resource")}afterLoadData(){var r;(r=this.assignmentStore)==null||r.linkAssignments(this,"resource")}clear(r){var i;n.clear.call(this,r),(i=this.assignmentStore)==null||i.unlinkAssignments("resource")}}return t}){},fg=class extends O([],Ar){},gg=class extends O([vf,Li,fg,H],e=>{const n=e.prototype;class t extends e{static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:Ui,assignmentModelClass:Ni,resourceModelClass:Sn,dependencyModelClass:Vi,calendarModelClass:Fl,eventStoreClass:kl,assignmentStoreClass:_l,resourceStoreClass:Ll,dependencyStoreClass:jl,calendarManagerStoreClass:cg,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(r={}){var i;const a=this;if(a.$invalidated=new Set,a.isPerformingCommit=!1,a.silenceInitialCommit=!0,a.ongoing=Promise.resolve(),r.eventStore&&!r.assignmentStore){const f=r.eventStore.masterStore||r.eventStore,g=f.assignmentStore||((i=f.crudManager)==null?void 0:i.assignmentStore);g!=null&&g.isAssignmentStore&&(r.assignmentStore=g,a.isSharingAssignmentStore=!0)}n.construct.call(a,r),a.defaultCalendar=new a.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:a.unspecifiedTimeIsWorking}),a.defaultCalendar.project=a;const{calendarsData:o,eventsData:l,dependenciesData:c,resourcesData:u,assignmentsData:d}=a;!!(o||l||c||u||d)?(a.loadInlineData({calendarsData:o,eventsData:l,dependenciesData:c,resourcesData:u,assignmentsData:d}),delete a.calendarsData,delete a.eventsData,delete a.dependenciesData,delete a.resourcesData,delete a.assignmentsData):a.bufferedCommitAsync()}doDestroy(){var r,i,a,o,l,c;const u=this;(r=u.eventStore)==null||r.destroy(),(i=u.dependencyStore)==null||i.destroy(),(a=u.assignmentStore)==null||a.destroy(),(o=u.resourceStore)==null||o.destroy(),(l=u.calendarManagerStore)==null||l.destroy(),u.defaultCalendar.destroy(),(c=u.stm)==null||c.destroy(),n.doDestroy.call(this)}async loadInlineData(r){const i=this;i.isLoadingInlineData=!0,r.calendarsData&&(i.calendarManagerStore.data=r.calendarsData),r.resourcesData&&(i.resourceStore.data=r.resourcesData),r.assignmentsData&&(i.assignmentStore.data=r.assignmentsData),r.eventsData&&(i.eventStore.data=r.eventsData),r.tasksData&&(i.eventStore.data=r.tasksData),r.dependenciesData&&(i.dependencyStore.data=r.dependenciesData),await i.commitLoad(),i.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(r){const i=a=>{a.setProject(this),a.joinProject()};r.rootNode?r.rootNode.traverse(i):r.forEach(i)}unJoinStoreRecords(r){const i=a=>{a.leaveProject(),a.setProject(this)};r.rootNode?r.rootNode.traverse(a=>{a!==r.rootNode&&i(a)}):r.forEach(i)}resolveStoreAndModelClass(r,i){const a=(i==null?void 0:i.storeClass)||this[`${r}StoreClass`];let o=i==null?void 0:i.modelClass;return o||(this.getDefaultConfiguration()[`${r}ModelClass`]!==a.getDefaultConfiguration().modelClass?o=a.getDefaultConfiguration().modelClass:o=this[`${r}ModelClass`]),{storeClass:a,modelClass:o}}setEventStore(r){this.eventStore=r}changeEventStore(r,i){const a=this,{stm:o}=a;if(a.detachStore(i),r instanceof K)r.project=a,o.addStore(r),a.joinStoreRecords(r);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("event",r);r=new l(x.assign({modelClass:c,project:a,stm:o},r))}if(i&&o.hasStore(i)){o.removeStore(i),a.unJoinStoreRecords(i);const{assignmentsForRemoval:l}=i;l.forEach(c=>{const u=c.event;if(u){const d=r.getById(u.id);d&&(c.event=d,l.delete(c))}}),i.afterEventRemoval()}return r.setProject(a),r}updateEventStore(r,i){this.attachStore(r),this.trigger("eventStoreChange",{store:r})}setAssignmentStore(r){this.assignmentStore=r}changeAssignmentStore(r,i){const a=this,{stm:o}=a;if(a.detachStore(i),i&&o.hasStore(i)&&(o.removeStore(i),a.unJoinStoreRecords(i)),r instanceof K)r.project=a,o.addStore(r),a.joinStoreRecords(r);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("assignment",r);r=new l(x.assign({modelClass:c,project:a,stm:o},r))}return r.setProject(a),r}updateAssignmentStore(r,i){this.attachStore(r),this.trigger("assignmentStoreChange",{store:r})}setResourceStore(r){this.resourceStore=r}changeResourceStore(r,i){const a=this,{stm:o}=a;if(a.detachStore(i),r instanceof K)r.project=a,o.addStore(r),a.joinStoreRecords(r);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("resource",r);r=new l(x.assign({modelClass:c,project:a,stm:o},r))}if(i&&o.hasStore(i)){o.removeStore(i),a.unJoinStoreRecords(i);const{assignmentsForRemoval:l}=i;l.forEach(c=>{const u=c.resource;if(u){const d=r.getById(u.id);d&&(c.resource=d,l.delete(c))}}),i.afterResourceRemoval()}return r.setProject(a),r}updateResourceStore(r,i){this.attachStore(r),this.trigger("resourceStoreChange",{store:r})}setDependencyStore(r){this.dependencyStore=r}changeDependencyStore(r,i){const a=this;if(a.detachStore(i),r instanceof K)r.project=a,a.stm.addStore(r),a.joinStoreRecords(r);else{const{storeClass:o,modelClass:l}=a.resolveStoreAndModelClass("dependency",r);r=new o(x.assign({modelClass:l,project:a,stm:a.stm},r))}return r}updateDependencyStore(r,i){this.attachStore(r),this.trigger("dependencyStoreChange",{store:r})}setCalendarManagerStore(r){this.calendarManagerStore=r}changeCalendarManagerStore(r,i){const a=this;if(a.detachStore(i),r instanceof K)a.stm.addStore(r);else{const o=(r==null?void 0:r.storeClass)||a.calendarManagerStoreClass,l=(r==null?void 0:r.modelClass)||o.getDefaultConfiguration().modelClass||a.calendarModelClass;r=new o(x.assign({modelClass:l,project:a,stm:a.stm},r))}return r.setProject(a),r}updateCalendarManagerStore(r,i){this.attachStore(r),this.trigger("calendarManagerStoreChange",{store:r})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(r){this.$calendar=r}get effectiveCalendar(){return this.calendar}async addEvent(r){return this.eventStore.add(r),this.commitAsync()}async addAssignment(r){return this.assignmentStore.add(r),this.commitAsync()}async addResource(r){return this.resourceStore.add(r),this.commitAsync()}async addDependency(r){return this.dependencyStore.add(r),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const r=this;if(r.isPerformingCommit=!0,r.unScheduleAutoCommit(),await pd(0),!r.isDestroyed){for(const c of r.$invalidated)c.calculateInvalidated();const{isInitialCommit:i,silenceInitialCommit:a}=r,o=i&&a;r.assignmentStore.onCommitAsync(),r.dependencyStore.onCommitAsync(),r.isInitialCommitPerformed=!0,r.hasLoadedDataToCommit=!1,r.isPerformingCommit=!1;const l=[r.assignmentStore,r.dependencyStore,r.eventStore,r.resourceStore,r.calendarManagerStore];if(l.forEach(c=>{var u;return(u=c.suspendAutoCommit)==null?void 0:u.call(c)}),r.isWritingData=!0,r.trigger("refresh",{isInitialCommit:i,isCalculated:!0}),o)for(const c of r.$invalidated)c.finalizeInvalidated(!0);else{for(const c of r.$invalidated)c.beginBatch(!0),c.finalizeInvalidated();for(const c of r.$invalidated)c.endBatch(!1,!0)}return r.isWritingData=!1,r.$invalidated.clear(),r.trigger("dataReady"),l.forEach(c=>{var u;return(u=c.resumeAutoCommit)==null?void 0:u.call(c)}),r.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(r){this.$invalidated.add(r),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(r){r=this.$stm=new kr(x.assign({disabled:!0},r)),r.ion({restoringStop:async()=>{r.disable(),await this.commitAsync(),this.isDestroyed||(r.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return t.applyConfigs=!0,t}){},Ur=Symbol("value"),pg=Symbol("length"),Ue=class{static change(e,n,t,s="string"){t=Ue.normalize(t,"object");const r=Ue.normalize(e,"array").filter(i=>!t[i]);if(n){n=Ue.normalize(n,"array");for(let i=0;i<n.length;++i)r.includes(n[i])||r.push(n[i])}return Ue.normalize(r,s)}static from(e,n){return e&&(e.isDomClassList?n=n!=null?n:!0:(n=n!=null?n:_.isObject(e)&&!_.isEmpty(e),e=new Ue(e)),!e.value&&!n&&(e=null)),e||(n?new Ue:null)}static normalize(e,n="string"){e=e||"";const t=typeof e,s=n==="array",r=n==="object",i=!s&&!r;let a=t==="string",o,l,c;for(t==="object"&&(e.nodeType===Element.ELEMENT_NODE&&typeof e.getAttribute=="function"?(e=e.getAttribute("class")||"",a=!0):e!=null&&e.isDomClassList?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof Map?e=Array.from(e.keys()).filter(u=>e.get(u)):e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=_.getTruthyKeys(e))),a&&(e=[...new Set(U.split(e))]),l=e.length;l-- >0;)o=e[l],o.length?o.includes(" ")&&e.splice(l,1,...U.split(o)):e.splice(l,1);if(s)c=e;else if(i)c=e.join(" ");else for(c=Object.create(null),l=0;l<e.length;++l)c[e[l]]=!0;return c}constructor(...e){this.process(1,e)}clear(){for(const e in this)this[e]=!1;return this}set(...e){return this.clear().process(1,e)}get isDomClassList(){return!0}clone(){return new Ue(this)}contains(e){return typeof e=="string"&&e?!!this[e]:!1}toString(){return this.length?`${this.value} `:""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){const n=Ue.normalize(e,"array"),t=n.length;if(this.length===t){for(let s=0;s<t;s++)if(!this[n[s]])return!1;return!0}return!1}get value(){let e=this[Ur],n;return e==null&&(n=_.getTruthyKeys(this),this[pg]=n.length,this[Ur]=e=n.join(" ")),e}set value(e){const n=this,t=Object.keys(n),s=t.length;for(let r=0;r<s;r++)delete n[t[r]];e?n.process(1,[e]):delete n[Ur]}get values(){return _.getTruthyKeys(this)}get length(){return this.value?this[pg]:0}process(e,n){for(let t,s,r=0;r<n.length;r++)if(n[r])if(t=n[r],t.isDomClassList||_.isObject(t))for(s in t)this[s]=e?t[s]:!t[s];else for(t=Ue.normalize(n[r],"array"),s=0;s<t.length;++s)this[t[s]]=e;return delete this[Ur],this}assign(e){for(const n in e)!this[n]!=!e[n]&&(this[n]=e[n],delete this[Ur]);return this}assignTo(e){const n=e.nodeType===Element.ELEMENT_NODE?e.classList:e,t=Ue.from(n);t.add(this),n.value=t.value}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}toggle(e,n=!this[e]){if(n=!!n,!!this[e]!==n)return this[e]=n,delete this[Ur],!0}split(){return _.getTruthyKeys(this)}forEach(e){return _.getTruthyKeys(this).forEach(e)}};Ue.prototype[Ur]=null,Ue._$name="DomClassList";var Yv=(e,n)=>(Array.isArray(n[1])?n[1].forEach(t=>e.push(encodeURIComponent(n[0])+"="+encodeURIComponent(t))):e.push(encodeURIComponent(n[0])+"="+encodeURIComponent(n[1])),e),Wi=Promise.resolve(),ms=e=>String(e).padStart(2,"0"),Kv=e=>`${e.getFullYear()}-${ms(e.getMonth()+1)}-${ms(e.getDate())}T${ms(e.getHours())}:${ms(e.getMinutes())}:${ms(e.getSeconds())}.${e.getMilliseconds()}`,We=class extends K{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:null,writeAllFields:null,parentIdParamName:"id",responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",filterParamName:null,restfulFilter:!1,sortParamName:null,pageParamName:null,pageStartParamName:null,pageSizeParamName:"pageSize",pageSize:50,useRestfulMethods:null,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"}}}static get configurable(){return{params:null}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch(()=>{})}get isLoading(){return this._isLoading?2:this.loadTriggerPromise?1:!1}get isCommitting(){return!!this.commitPromise}set pageParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this._pageParamName=e}get pageParamName(){return this._pageParamName}set pageStartParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this._pageStartParamName=e}get pageStartParamName(){return this._pageStartParamName}get isPaged(){return this.pageParamName||this.pageStartParamName}get allCount(){return"remoteTotal"in this?this.remoteTotal:super.allCount}get lastPage(){if(this.isPaged)return Math.floor((this.allCount+this.pageSize-1)/this.pageSize)}buildQueryString(e,...n){const t=e.includes("?"),s=Object.entries(Object.assign({},...n)).reduce(Yv,[]).join("&");return s?(t?"&":"?")+s:""}async performSort(e){const n=this;if(n.remoteSort&&!n.isRemoteDataLoading){n.isRemoteDataLoading=!0;const t=await n.internalLoad({},"",s=>{n.data=s.data,n.afterPerformSort(e)});return n.isRemoteDataLoading=!1,t}else super.performSort(e)}async performFilter(e){var n;const t=this;if(t.remoteFilter){(n=t.loadingPromise)==null||n.abort(),t.isRemoteDataLoading=!0;const s=t.count,{filters:r}=t;t.currentPage=1;const i=await t.internalLoad({},"",a=>{t.data=a.data,a=e?null:{action:"filter",filters:r,oldCount:s,records:t.storage.values},t.afterPerformFilter(a),t.trigger("refresh",a)});return t.isRemoteDataLoading=!1,i}else super.performFilter(e)}encodeFilterParams(e){const n=[];for(const{property:t,operator:s,value:r,caseSensitive:i}of e)n.push({field:t,operator:s,value:r,caseSensitive:i});return JSON.stringify(n,function(t,s){return t===""?s:this[t]instanceof Date?Kv(this[t]):s})}encodeSorterParams(e){return JSON.stringify(e.filter(n=>!n.sortFn).map(n=>n))}buildReadUrl(){const{readUrl:e}=this;return this.restfulFilter&&this.filters.count?(e.endsWith("/")?e:e+"/")+this.filters.first.value:e}internalLoad(e,n,t,s=0){e=x.assign({},this.params,e);const r=this,i=r.buildReadUrl(),a={action:"read"+n,params:e,url:i};if(!i)throw new Error("No load url specified");if(r.trigger("beforeLoad"+n,a)===!1)throw!1;return r.loadArgs=[i,a,e,n,t],s===!1?new Promise((o,l)=>r.sendLoadRequest(o,l)):r.loadTriggerPromise||(r.loadTriggerPromise=new Promise((o,l)=>{r.setTimeout({delay:s,fn:"sendLoadRequest",args:[o,l],cancelOutstanding:!0})}))}async sendLoadRequest(e,n){const t=this,[s,r,i,a,o]=t.loadArgs;if(t.loadTriggerPromise=null,s){if(t._isLoading=!0,t.trigger(`load${a}Start`,r),t.trigger("beforeRequest",r),t.filterParamName&&t.isFiltered&&(i[t.filterParamName]=t.encodeFilterParams(t.filters.values)),t.remoteSort&&t.isSorted&&(i[t.sortParamName]=t.encodeSorterParams(t.groupers?t.groupers.concat(t.sorters):t.sorters)),t.isPaged){if(!(t.pageParamName in i||t.pageStartParamName in i)){const c=Math.min(t.currentPage||1,t.allCount?t.lastPage:1/0);t.pageParamName?i[t.pageParamName]=c:i[t.pageStartParamName]=(c-1)*t.pageSize}i[t.pageSizeParamName]=t.pageSize}const l={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(l.method=t.httpMethods.read,r.body&&(l.body=JSON.stringify(r.body)));try{const c=t.loadingPromise=tr.get(r.url+t.buildQueryString(r.url,i),x.assign(l,t.fetchOptions)),u=await c,d=u.parsedJson,h=Array.isArray(d),f=h||d&&x.getPath(d,t.responseSuccessProperty)!==!1,g=h?null:x.getPath(d,t.responseTotalProperty);if(t.isDestroyed)return;if(t.loadingPromise=null,t._isLoading=!1,r.response=u,r.json=d,f){if(g!=null&&(t.remoteTotal=parseInt(g,10)),t.isPaged)if(t.remoteTotal>=0){const p=t.pageParamName?i[t.pageParamName]:i[t.pageStartParamName]/t.pageSize+1;t.currentPage=Math.min(p,t.lastPage)}else throw new Error("A paged store must receive its responseTotalProperty in each data packet");r.data=h?d:x.getPath(d,t.responseDataProperty),await o(r),!t.isDestroyed&&t.trigger("load"+a,r),e(r)}else Object.assign(r,{exception:!0,exceptionType:"server",error:d==null?void 0:d.error}),!t.isDestroyed&&t.trigger("exception",r),n(r);!t.isDestroyed&&t.trigger("afterRequest",r)}catch(c){t._isLoading=!1,r.exception=!0,c instanceof Response?(r.exceptionType=c.ok?"server":"network",r.response=c,r.error=c.error):(r.exceptionType="server",r.error=c),!t.isDestroyed&&t.trigger("exception",r),n(r),!t.isDestroyed&&t.trigger("afterRequest",r)}}}async load(e){const n=this;return n.isPaged?n.loadPage(n.currentPage||1,e):n.internalLoad(e,"",t=>{n.data=t.data})}async loadChildren(e){return this.readUrl?this.internalLoad({[this.parentIdParamName]:e.id},"Children",n=>{n.parentRecord=e,e.children.length&&e.clearChildren(!0),e.data[e.constructor.childrenField]=n.data,e.processChildren(e.stores)},!1):this.immediatePromise}async loadPage(e,n){this.allCount&&(e=Math.min(e,this.lastPage));const t=this,s=t.pageParamName?{[t.pageParamName]:e}:{[t.pageStartParamName]:(e-1)*t.pageSize};return s[t.pageSizeParamName]=t.pageSize,t.internalLoad(x.assign(s,n),"Page",r=>{t.loadData(r.data,"pageLoad")})}async nextPage(e){const n=this;return n.isPaged&&n.currentPage!==n.lastPage?n.loadPage(n.currentPage+1,e):Wi}async previousPage(e){return this.isPaged&&this.currentPage!==1?this.loadPage(this.currentPage-1,e):Wi}async commit(){const e=this,{changes:n}=e,t=[];if(e.commitPromise)return!1;if(!n)return e.modified.count&&(e.modified.forEach(s=>s.clearChanges(!0,!1)),e.modified.clear()),Wi;if(e.trigger("beforeCommit",{changes:n})!==!1){[...n.added,...n.modified,...n.removed].forEach(i=>i.meta.committing=!0),e.trigger("commitStart",{changes:n});const s={action:"commit",exception:!1,changes:n};let r=e.commitRemoved(s);return r&&t.push(r),r=e.commitAdded(s),r&&t.push(r),r=e.commitModified(s),r&&t.push(r),t.length?(r=t.length===1?t[0]:Promise.all(t),e.commitPromise=new Promise((i,a)=>{r.then(()=>{e.commitPromise=null,s.exception?(e.trigger("exception",s),a(s)):(e.trigger("commit",{changes:n}),i(s))}).catch(()=>{e.commitPromise=null,a(s)})})):(e.modified.forEach(i=>i.clearChanges(!0,!1)),e.modified.clear(),e.added.forEach(i=>i.clearChanges(!0,!1)),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:n}),Wi)}}doAutoCommit(){this.suspendCount<=0&&this.commit().catch(e=>{const{response:n}=e;if(!(n&&(n.ok&&n.parsedJson||[500,404].includes(n.status))))throw e})}commitAdded(e){const n=this,t=n.added,s={action:"create",params:n.params};return t.count&&n.createUrl?new Promise(r=>{const i=t.values.map(c=>c.persistableData);e.create=s,s.body={data:i},n.trigger("beforeRequest",s);let a=s.body;if(n.sendAsFormData){const c=new FormData;c.append("data",JSON.stringify(i)),a=c}const o={headers:n.headers,parseJson:!0},l=n.createUrl+n.buildQueryString(n.createUrl,n.params);n.useRestfulMethods&&(o.method=n.httpMethods.create),tr.post(l,a,x.assign(o,n.fetchOptions)).then(c=>{const u=c.parsedJson,d=Array.isArray(u),h=d||u&&u.success!==!1;e.response=c,s.json=u,s.response=c,h?(n.processReturnedData(t.values,d?u:x.getPath(u,n.responseDataProperty)),t.clear(),n.trigger("commitAdded"),n.trigger("refresh",s),r(e)):(t.forEach(f=>f.meta.committing=!1),e.exception=s.exception=!0,e.exceptionType=s.exceptionType="server",n.trigger("exception",s),r(e)),n.trigger("afterRequest",s)}).catch(c=>{t.forEach(u=>u.meta.committing=!1),e.exception=s.exception=!0,c instanceof Response?(e.response=c,s.exceptionType=c.ok?"server":"network",s.response=c,s.error=c.error):(s.exceptionType="server",s.error=c),n.trigger("exception",s),r(e),n.trigger("afterRequest",s)})}):null}commitModified(e){const n=this,{modified:t}=n.changes,s={action:"update",params:n.params},r=t.length&&n.updateUrl?new Promise(i=>{const a=t.map(c=>n.writeAllFields?c.persistableData:c.modificationDataToWrite).filter(c=>!x.isEmpty(c));if(a.length===0){n.modified.clear(),t.forEach(c=>c.meta.committing=!1),i();return}e.update=s,s.body={data:a},n.trigger("beforeRequest",s);let o=s.body;if(n.sendAsFormData){const c=new FormData;c.append("data",JSON.stringify(a)),o=c}const l={headers:n.headers,parseJson:!0};n.useRestfulMethods&&(l.method=n.httpMethods.update),tr.post(n.updateUrl+n.buildQueryString(n.updateUrl,n.params),o,x.assign(l,n.fetchOptions)).then(c=>{const u=c.parsedJson,d=Array.isArray(u),h=d||u&&u.success!==!1;e.response=c,s.json=u,s.response=c,h?(n.processReturnedData(t,d?u:x.getPath(u,n.responseDataProperty),!0),n.modified.clear(),n.trigger("commitModified"),n.trigger("refresh",s),i(e)):(t.forEach(f=>f.meta.committing=!1),e.exception=s.exception=!0,s.exceptionType="server",n.trigger("exception",s),i(e)),n.trigger("afterRequest",s)}).catch(c=>{t.forEach(u=>u.meta.committing=!1),e.exception=s.exception=!0,c instanceof Response?(e.response=c,s.exceptionType=c.ok?"server":"network",s.response=c,s.error=c.error):(s.exceptionType="server",s.error=c),n.trigger("exception",s),i(e),n.trigger("afterRequest",s)})}):null;return!t.length&&n.modified.count&&n.modified.clear(),r}processReturnedData(e,n,t=!1){const s=this,r=s.modelClass,i=r.fieldMap.id.dataSource;n.forEach((a,o)=>{const l=e[o];l.clearChanges(!0,!1),l.syncId(a[i]),Object.assign(e[o].data,r.processData(a,t,s,l))})}commitRemoved(e){const n=this,t=n.removed,s={action:"delete",params:n.params};return t.count&&n.deleteUrl?new Promise(r=>{e.delete=s,s.body={ids:t.map(o=>o.id)},n.trigger("beforeRequest",s);let i=s.body;if(n.sendAsFormData){const o=new FormData;o.append("id",JSON.stringify(i.ids)),i=o}const a={headers:n.headers,parseJson:!0};n.useRestfulMethods&&(a.method=n.httpMethods.delete),tr.post(n.deleteUrl+n.buildQueryString(n.deleteUrl,n.params),i,x.assign(a,n.fetchOptions)).then(o=>{const l=o.parsedJson,c=Array.isArray(l),u=c||l&&l.success!==!1;e.response=o,s.json=l,s.response=o,u?(t.forEach(d=>d.meta.committing=!1),t.clear(),n.trigger("commitRemoved"),n.trigger("refresh",s),r(e)):(t.forEach(d=>d.meta.committing=!1),e.exception=s.exception=!0,s.exceptionType="server",n.trigger("exception",s),r(e)),n.trigger("afterRequest",s)}).catch(o=>{t.forEach(l=>l.meta.committing=!1),e.exception=s.exception=!0,o instanceof Response?(e.response=o,s.exceptionType=o.ok?"server":"network",s.response=o,s.error=o.error):(s.exceptionType="server",s.error=o),n.trigger("exception",s),r(e),n.trigger("afterRequest",s)})}):null}get remoteFilter(){return!!(this.filterParamName||this.restfulFilter)}get remoteSort(){return!!this.sortParamName}};F(We,"$name","AjaxStore"),We._$name="AjaxStore";var mg=class{static get(e,n){const t=e._domData||(e._domData={});return n!=null?t[n]:t}static remove(e,n){const{_domData:t}=e,s=t==null?void 0:t[n];return t==null||delete t[n],s}static set(e,n,t){arguments.length===3?(e._domData||(e._domData={}))[n]=t:e._domData=n}static assign(e,n){Object.assign(e._domData||(e._domData={}),n)}};mg._$name="DomDataStore";var vg=class{constructor({model:e,type:n}){var t,s,r;Object.assign(this,{id:(t=e.id)!=null?t:e.$entityName,type:(s=n==null?void 0:n.$$name)!=null?s:e.constructor.name,name:(r=e.name)!=null?r:e.$entityName}),new.target===vg&&Object.freeze(this)}},Bl=vg;F(Bl,"$name","ChangeLogEntity"),Bl._$name="ChangeLogEntity";var vs=class extends H{static get fields(){return[{name:"iconCls",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0}]}};vs.exposeProperties(),vs._$name="GridRowModel";var yg=e=>class extends e{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(t,s,r){const i=[],{storeId:a}=t,o=this.crudLoadValidationMandatoryStores,l={[a]:{}};return s?s.rows||(i.push(`- "${a}" store section should have a "rows" property with an array of the store records.`),l[a].rows=["..."]):o!=null&&o.includes(a)&&(i.push(`- No "${a}" store section found. It should contain the store data.`),l[a].rows=["..."]),i.length&&Object.assign(r,l),i}getLoadResponseWarnings(t){const s=[],r={};return this.skipSuccessProperty||(r.success=!0),this.forEachCrudStore((i,a,o)=>{s.push(...this.getStoreLoadResponseWarnings(o,t==null?void 0:t[a],r))}),s.length&&(s.push(`Please adjust your response to look like this:
`+JSON.stringify(r,null,4).replace(/"\.\.\."/g,"...")),s.push(this.disableValidationNote)),s}validateLoadResponse(t){const s=this.getLoadResponseWarnings(t);s.length&&console.warn(this.crudLoadValidationWarningPrefix+`
`+s.join(`
`))}getStoreSyncResponseWarnings(t,s,r,i){const a=[],o=[],l=[],{storeId:c}=t,u={[c]:{}},d=t.phantomIdField||this.phantomIdField,{modelClass:h}=t.store,{idField:f}=h,g=(r==null?void 0:r.rows)||[],p=(r==null?void 0:r.removed)||[];let m=!1;if(s!=null&&s.added&&(o.push(...s.added.filter(y=>!g.find(D=>D[d]==y[d])&&!p.find(D=>D[d]==y[d]||D[f]==y[d])).map(y=>({[d]:y[d],[f]:"..."}))),o.length)){const y=o.map(D=>"#"+D[d]).join(", ");a.push(`- "${c}" store "rows" section should mention added record(s) ${y} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!o.length&&r&&((typeof r!="object"||Array.isArray(r))&&(a.push(`- "${c}" store section should be an Object.`),u[c]["..."]="..."),r.rows&&!Array.isArray(r.rows)&&(a.push(`- "${c}" store "rows" section should be an array`),o.push("...")),r.removed&&!Array.isArray(r.removed)&&(a.push(`- "${c}" store "removed" section should be an array:`),l.push("...")));else{if(s!=null&&s.updated){const y=s.updated.filter(D=>!g.find(E=>E[f]==D[f])).map(D=>({[f]:D[f]}));if(o.push(...y),y.length){const D=y.map(E=>"#"+E[f]).join(", ");a.push(`- "${c}" store "rows" section should mention updated record(s) ${D} sent in the request. It should contain the updated record identifiers.`),m=!0}}if(o.length&&o.push("..."),s!=null&&s.removed&&(l.push(...s.removed.filter(y=>!g.find(D=>D[f]==y[f])).map(y=>({[f]:y[f]}))),l.length)){const y=l.map(D=>"#"+D[f]).join(", ");a.push(`- "${c}" store "removed" section should mention removed record(s) ${y} sent in the request. It should contain the removed record identifiers.`),u[c].removed=l,l.push("..."),m=!0}}return o.length&&(u[c].rows=o),a.length||delete u[c],Object.assign(i,u),{messages:a,showSupportShortSyncResponseNote:m}}getSyncResponseWarnings(t,s){const r=[],i={},a=s.pack;this.skipSuccessProperty||(i.success=!0);let o=!1;return this.forEachCrudStore((l,c,u)=>{const d=this.getStoreSyncResponseWarnings(u,a==null?void 0:a[c],t[c],i);o=o||d.showSupportShortSyncResponseNote,r.push(...d.messages)}),r.length&&(r.push(`Please adjust your response to look like this:
`+JSON.stringify(i,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),o&&r.push(this.supportShortSyncResponseNote),r.push(this.disableValidationNote)),r}validateSyncResponse(t,s){const r=this.getSyncResponseWarnings(t,s);r.length&&console.warn(this.crudSyncValidationWarningPrefix+`
`+r.join(`
`))}},Jv=class extends Error{},Sg=class extends Jv{constructor(e={}){var n,t;super(e.message||e.request&&U.capitalize((n=e.request)==null?void 0:n.type)+" failed"||"Crud Manager request failed"),Object.assign(this,e),this.action=(t=this.request)==null?void 0:t.type}},Dg=function(e,n,t){return e.store&&(e=e.store),n.store&&(n=n.store),e=e[t]||0,n=n[t]||0,e<n?-1:e>n?1:0},Qv=function(e,n){return Dg(e,n,"loadPriority")},Zv=function(e,n){return Dg(e,n,"syncPriority")},Nl=e=>{var n;e.$$meta=e.$meta;const t=[];return e.isEvents||t.push(Vt),e.isDelayable||t.push(Ar),t.push(yg),n=class extends(e||$).mixin(...t){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(s={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(s)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var s,r;return(r=(s=this.transport)==null?void 0:s.load)==null?void 0:r.url}updateLoadUrl(s){x.setPath(this,"transport.load.url",s)}get syncUrl(){var s,r;return(r=(s=this.transport)==null?void 0:s.sync)==null?void 0:r.url}updateSyncUrl(s){x.setPath(this,"transport.sync.url",s)}getStoreDescriptor(s){return s?s instanceof K?this.crudStores.find(r=>r.store===s):typeof s=="object"?this.crudStoresIndex[s.storeId]:this.crudStoresIndex[s]||this.getStoreDescriptor(K.getStore(s)):null}fillStoreDescriptor(s){const{store:r}=s,{storeIdProperty:i=this.storeIdProperty,modelClass:a}=r;return s.storeId||(s.storeId=r[i]||r.id),s.idField||(s.idField=a.idField),s.phantomIdField||(s.phantomIdField=a.phantomIdField),s.phantomParentIdField||(s.phantomParentIdField=a.phantomParentIdField),"writeAllFields"in s||(s.writeAllFields=r.writeAllFields),s}updateCrudStoreIndex(){const s=this.crudStoresIndex={};this.crudStores.forEach(r=>r.storeId&&(s[r.storeId]=r))}getCrudStore(s){const r=this.getStoreDescriptor(s);return r==null?void 0:r.store}forEachCrudStore(s,r=this){if(!s)throw new Error("Iterator function must be provided");this.crudStores.every(i=>s.call(r,i.store,i.storeId,i)!==!1)}set crudStores(s){this._crudStores=[],this.addCrudStore(s);for(const r of this._crudStores)r.loadPriority=r.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(s){return this._orderedCrudStores=s}set syncApplySequence(s){this._syncApplySequence=[],this.addStoreToApplySequence(s)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(s){const r=this;let i;return s instanceof K?i={store:s}:typeof s=="object"?(s.store||(s={storeId:s.id,store:new K(s)}),i=s):i={store:K.getStore(s)},r.fillStoreDescriptor(i),s=i.store,s.setCrudManager?s.setCrudManager(r):s.crudManager=r,s.pageSize=null,(r.loadUrl||r.syncUrl)&&(s.autoCommit=!1,s.autoLoad=!1,(s.createUrl||s.updateUrl||s.deleteUrl||s.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),r.bindCrudStoreListeners(s),i}addCrudStore(s,r,i){if(s=W.asArray(s),!(s!=null&&s.length))return;const a=this,o=s.map(a.internalAddCrudStore,a);typeof r=="undefined"?a.crudStores.push(...o):(i&&((i instanceof K||typeof i!="object")&&(i=a.getStoreDescriptor(i)),r+=a.crudStores.indexOf(i)),a.crudStores.splice(r,0,...o)),a.orderedCrudStores.push(...o),a.updateCrudStoreIndex()}addPrioritizedStore(s){const r=this;r.hasCrudStore(s)||r.addCrudStore(s,W.findInsertionIndex(s,r.crudStores,Qv)),r.hasApplySequenceStore(s)||r.addStoreToApplySequence(s,W.findInsertionIndex(s,r.syncApplySequence,Zv))}hasCrudStore(s){var r;return(r=this.crudStores)==null?void 0:r.some(i=>i===s||i.store===s||i.storeId===s)}removeCrudStore(s){const r=this,i=r.crudStores,a=i.find(o=>o===s||o.store===s||o.storeId===s);if(a)r.unbindCrudStoreListeners(a.store),delete r.crudStoresIndex[a.storeId],W.remove(i,a),r.syncApplySequence&&r.removeStoreFromApplySequence(s);else throw new Error("Store not found in stores collection")}bindCrudStoreListeners(s){s.ion({name:s.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(s){this.detachListeners(s.id)}addStoreToApplySequence(s,r,i){if(!s)return;s=W.asArray(s);const a=this,o=s.reduce((c,u)=>{const d=a.getStoreDescriptor(u);return d&&c.push(d),c},[]);if(typeof r=="undefined")a.syncApplySequence.push(...o);else{let c=r;i&&((i instanceof K||typeof i!="object")&&(i=a.getStoreDescriptor(i)),c+=a.syncApplySequence.indexOf(i)),a.syncApplySequence.splice(c,0,...o)}const l=a.syncApplySequence.map(({storeId:c})=>c);a.orderedCrudStores=[...a.syncApplySequence],a.crudStores.forEach(c=>{l.includes(c.storeId)||a.orderedCrudStores.push(c)})}removeStoreFromApplySequence(s){const r=this.syncApplySequence.findIndex(i=>i===s||i.store===s||i.storeId===s);r>-1&&(this.syncApplySequence.splice(r,1),this.orderedCrudStores.splice(r,1))}hasApplySequenceStore(s){return this.syncApplySequence.some(r=>r===s||r.store===s||r.storeId===s)}onCrudStoreDestroy({source:s}){this.removeCrudStore(s)}onCrudStoreChange(s){const r=this;r.crudIgnoreUpdates||(r.crudStoreHasChanges(s==null?void 0:s.source)?(r.trigger("hasChanges"),r.autoSync&&r.scheduleAutoSync()):r.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(s=!0){const r=this;r.autoSyncSuspendCounter--,r.autoSyncSuspendCounter<=0&&(r.autoSyncSuspendCounter=0,s&&r.autoSync&&r.crudStoreHasChanges()&&r.scheduleAutoSync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const s=this;!s.hasTimeout("autoSync")&&!s.isAutoSyncSuspended&&s.setTimeout({name:"autoSync",fn:()=>{s.sync().catch(r=>{})},delay:s.autoSyncTimeout})}async triggerFailedRequestEvents(s,r,i,a){const{options:o,type:l}=s;this.trigger("requestFail",{requestType:l,response:r,responseText:i,responseOptions:a}),this.trigger(l+"Fail",{response:r,responseOptions:a,responseText:i,options:o})}async internalOnResponse(s,r,i){const a=this,o=r?a.decode(r):null,{options:l,type:c}=s;if(r&&!o&&console.error("Failed to parse response: "+r),!o||(a.skipSuccessProperty?o.success===!1:!o.success))a.triggerFailedRequestEvents(s,o,r,i);else if(a.trigger("beforeResponseApply",{requestType:c,response:o})!==!1&&a.trigger(`before${U.capitalize(c)}Apply`,{response:o,options:l})!==!1){if(a.crudRevision=o.revision,await a.applyResponse(s,o,l),a.isDestroyed)return;a.trigger("requestDone",{requestType:c,response:o,responseOptions:i}),a.trigger(c,{response:o,responseOptions:i,options:l}),(c==="load"||!a.crudStoreHasChanges())&&(a.trigger("noChanges"),c==="load"&&a.emitCrudStoreEvents(s.pack.stores,"afterRequest"))}return o}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(s){this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&!s&&this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(s){return s?this.isCrudStoreDirty(this.getCrudStore(s)):this.crudStores.some(r=>this.isCrudStoreDirty(r.store))}isCrudStoreDirty(s){return!!s.changes}doAutoLoad(){return this.load().catch(s=>{})}emitCrudStoreEvents(s,r,i){const a={action:"read"+r,...i};for(const o of this.crudStores)s.includes(o.storeId)&&o.store.trigger(r,a)}getLoadPackage(s){const r={type:"load",requestId:this.requestId},i=this.crudStores,a=Object.assign({},s);return delete a.request,r.stores=i.map(o=>{var l;const c=a==null?void 0:a[o.storeId],u=o.pageSize||((l=o.store)==null?void 0:l.pageSize);if(c||u){const d=Object.assign({storeId:o.storeId,page:1},c);return u&&(d.pageSize=u),o.currentPage=d.page,c&&delete a[o.storeId],d}return o.storeId}),Object.assign(r,a),r}loadCrudStore(s,r,i){const a=r==null?void 0:r.rows;i!=null&&i.append||r!=null&&r.append?s.add(a):s.data=a,s.trigger("load",{data:a})}loadDataToCrudStore(s,r,i){const a=s.store,o=r==null?void 0:r.rows;a.__loading=!0,o&&this.loadCrudStore(a,r,i,s),a.__loading=!1}loadCrudManagerData(s,r={}){this.suspendChangesTracking(),this.crudStores.forEach(i=>{const a=i.storeId,o=s[a];o&&this.loadDataToCrudStore(i,o,r[a])}),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return!!(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return!!(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return!!(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(s){typeof s=="string"&&(s={request:{url:s}});const r=this,i=r.getLoadPackage(s);return r._autoLoadPromise=null,new Promise((a,o)=>{if(r.trigger("beforeLoad",{pack:i})!==!1){const{load:l}=r.activeRequests;l&&(r.cancelRequest(l.desc,l.reject),r.trigger("loadCanceled",{pack:i}));const c=_.assign({id:i.requestId,data:r.encode(i),type:"load",success:r.onCrudRequestSuccess,failure:r.onCrudRequestFailure,thisObj:r},s==null?void 0:s.request);r.activeRequests.load={type:"load",options:s,pack:i,resolve:a,reject(...u){c.success=c.failure=null,o(...u)},id:i.requestId,desc:r.sendRequest(c)},r.emitCrudStoreEvents(i.stores,"loadStart"),r.trigger("loadStart",{pack:i})}else r.trigger("loadCanceled",{pack:i}),o({cancelled:!0})})}getActiveCrudManagerRequest(s){let r=this.activeRequests[s];return!r&&this.trackResponseType&&(r=Object.values(this.activeRequests)[0]),r}prepareAddedRecordData(s,r){const i=this,{store:a}=r,{isTree:o}=a,l=r.phantomIdField||i.phantomIdField,c=r.phantomParentIdField||i.phantomParentIdField,u=a.modelClass.allFields.filter(f=>f.subStore),d=s.constructor,h=Object.assign(s.persistableData,{[l]:s.id});if(o){const{parent:f}=s;f&&!f.isRoot&&f.isPhantom&&(h[c]=f.id)}return i.resetIdsBeforeSync&&x.deletePath(h,d.idField),u.forEach(f=>{const g=s.get(f.name);g.allCount&&(h[f.dataSource]={added:g.getRange().map(p=>i.prepareAddedRecordData(p,{store:g}))})}),h}prepareAdded(s,r){return s.filter(i=>i.isValid).map(i=>this.prepareAddedRecordData(i,r))}prepareUpdated(s,r){const{store:i}=r,{isTree:a}=i,o=r.writeAllFields||r.writeAllFields!==!1&&this.writeAllFields,l=r.phantomParentIdField||this.phantomParentIdField,c=i.modelClass.allFields.filter(u=>u.subStore);if(r.store.tree){const u=r.store.rootNode;s=s.filter(d=>d!==u)}return s.filter(u=>u.isValid).reduce((u,d)=>{let h;if(o?h=d.persistableData:h=d.modificationDataToWrite,a){const{parent:f}=d;f&&!f.isRoot&&f.isPhantom&&(h[l]=f.id)}return c.forEach(f=>{const g=d.get(f.name);h[f.dataSource]=this.getCrudStoreChanges({store:g})}),x.isEmpty(h)||u.push(h),u},[])}prepareRemoved(s){return s.map(r=>{const i=r.constructor;return x.setPath({},i.idField,r.id)})}getCrudStoreChanges(s){const{store:r}=s;let{added:i=[],modified:a=[],removed:o=[]}=r.changes||{},l;return i.length&&(i=this.prepareAdded(i,s)),a.length&&(a=this.prepareUpdated(a,s)),o.length&&(o=this.prepareRemoved(o)),(i.length||a.length||o.length)&&(l={},i.length&&(l.added=i),a.length&&(l.updated=a),o.length&&(l.removed=o)),l}getChangesetPackage(){const{changes:s}=this;return s||this.forceSync?{type:"sync",requestId:this.requestId,revision:this.crudRevision,...s}:null}get changes(){const s={};return this.crudStores.forEach(r=>{const i=this.getCrudStoreChanges(r);i&&(s[r.storeId]=i)}),Object.keys(s).length>0?s:null}getRowsToApplyChangesTo({store:s,storeId:r},i,a){var o,l;const c=this,{modelClass:u}=s,d=u.idField,{updated:h,removed:f}=a||{};let g,p,m;if(i){m=!0;const y={};g=((o=i.rows)==null?void 0:o.slice())||[],p=((l=i.removed)==null?void 0:l.slice())||[],[...g,...p].forEach(D=>{const E=x.getPath(D,d);y[E]=!0}),c.supportShortSyncResponse&&(h==null||h.forEach(D=>{const E=x.getPath(D,d);y[E]||g.push({[d]:E})}),f==null||f.forEach(D=>{const E=x.getPath(D,d);y[E]||p.push({[d]:E})}))}else(h||f)&&(m=!1,g=h,p=f);return g=g!=null&&g.length?g:null,p=p!=null&&p.length?p:null,{rows:g,removed:p,remote:m}}applyChangesToStore(s,r,i){var a;const o=this,l=s.phantomIdField||o.phantomIdField,{store:c}=s,u=c.modelClass.getFieldDataSource("id"),d=c.modelClass.allFields.filter(E=>E.subStore),{rows:h,removed:f,remote:g}=o.getRowsToApplyChangesTo(s,r,i),p=[],m=[];if(h)for(const E of h)c.getById((a=E[l])!=null?a:E[u])?m.push(E):p.push(E);const y=[];m.length&&d.length&&m.forEach(E=>{var C,v,S;const b=c.getById((C=E[l])!=null?C:E[u]),w=((v=i.added)==null?void 0:v.find(I=>I[l]==E[l]))||((S=i.updated)==null?void 0:S.find(I=>I[u]==E[u])),M={};d.forEach(I=>{const A=b.get(I.name);o.applyChangesToStore({store:A},E[I.dataSource],w==null?void 0:w[I.dataSource]),M[I.dataSource]="foo",delete E[I.dataSource]}),y.push([b,M])});const D=c.applyChangeset({removed:f,added:p,updated:m},null,l,g,!0);return y.forEach(([E,C])=>Object.assign(D.get(E.id),C)),D}applySyncResponse(s,r){var i;const a=this,o=a.orderedCrudStores;a.applyingChangeset=a.applyingSyncResponse=!0,a.suspendChangesTracking();for(const l of o)a.applyChangesToStore(l,s[l.storeId],(i=r==null?void 0:r.pack)==null?void 0:i[l.storeId]);a.resumeChangesTracking(!0),a.applyingChangeset=a.applyingSyncResponse=!1}applyLoadResponse(s,r){this.applyingLoadResponse=!0,this.loadCrudManagerData(s,r),this.applyingLoadResponse=!1}async applyResponse(s,r,i){const a=this;switch(a.trackResponseType&&r.type||s.type){case"load":a.validateResponse&&a.validateLoadResponse(r),a.applyLoadResponse(r,i);break;case"sync":a.validateResponse&&a.validateSyncResponse(r,s),a.applySyncResponse(r,s);break}}applyChangeset(s,r=null,i,a=!1){const o=this,l=a?new Map:void 0;o.suspendAutoSync(),o.suspendChangesTracking();for(const{store:c,phantomIdField:u}of o.orderedCrudStores)if(s[c.id]){const d=c.applyChangeset(s[c.id],r,u||o.phantomIdField,!0,a);d&&l.set(c.id,d)}return o.resumeChangesTracking(!0),o.resumeAutoSync(!1),l}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const s=this;return s.clearTimeout("autoSync"),s.activeRequests.sync?(s.trigger("syncDelayed"),s.activeSyncPromise=s.activeSyncPromise.finally(()=>s.sync())):s.activeSyncPromise=new Promise((r,i)=>{const a=s.getChangesetPackage();if(!a){r(null);return}s.trigger("beforeSync",{pack:a})!==!1?(s.trigger("syncStart",{pack:a}),s.activeRequests.sync={type:"sync",pack:a,resolve:r,reject:i,id:a.requestId,desc:s.sendRequest({id:a.requestId,data:s.encode(a),type:"sync",success:s.onCrudRequestSuccess,failure:s.onCrudRequestFailure,thisObj:s})}):(s.trigger("syncCanceled",{pack:a}),i({cancelled:!0}))}).catch(r=>{if(r&&!r.cancelled)throw r;return r})}async onCrudRequestSuccess(s,r,i){const a=this,{type:o,id:l}=i;if(a.isDestroyed)return;let c="";i=a.activeRequests[o];try{c=await s.text()}catch(d){}if(a.isDestroyed)return;if((i==null?void 0:i.id)!==l)throw new Error(`Interleaved ${o} operation detected`);a.activeRequests[o]=null;const u=await a.internalOnResponse(i,c,r);if(!a.isDestroyed){if(!u||(a.skipSuccessProperty?(u==null?void 0:u.success)===!1:!(u!=null&&u.success))){const d={rawResponse:s,response:u,request:i};u!=null&&u.message&&(d.message=u.message),i.reject(new Sg(d))}a["crud"+U.capitalize(i.type)+"ed"]=!0,i.resolve({response:u,rawResponse:s,responseText:c,request:i})}}async onCrudRequestFailure(s,r,i){var a;const o=this;if(o.isDestroyed)return;i=o.activeRequests[i.type];const l=(a=r==null?void 0:r.abortController)==null?void 0:a.signal;if(!!!(l!=null&&l.aborted)){let u,d="";try{d=await s.text(),u=o.decode(d)}catch(h){}if(o.isDestroyed||(o.triggerFailedRequestEvents(i,u,d,r),o.isDestroyed))return;i.reject(new Sg({rawResponse:s,request:i}))}o.activeRequests[i.type]=null}acceptChanges(){this.crudStores.forEach(s=>s.store.acceptChanges())}revertChanges(){this.revertCrudStoreChanges()}revertCrudStoreChanges(){const{usesSingleAssignment:s}=this.eventStore;this.orderedCrudStores.forEach(({store:r})=>(!r.isAssignmentStore||!s)&&r.revertChanges())}doDestroy(){const s=this,{load:r,sync:i}=s.activeRequests;for(r&&s.cancelRequest(r.desc,r.reject),i&&s.cancelRequest(i.desc,i.reject);s.crudStores.length>0;)s.removeCrudStore(s.crudStores[0]);super.doDestroy&&super.doDestroy()}},F(n,"configurable",{loadUrl:null,syncUrl:null,forceSync:null}),F(n,"delayable",{doAutoLoad:"raf"}),n},Cg=class extends $.mixin(Nl){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}get json(){return U.safeJsonStringify(this)}set json(e){typeof e=="string"&&(e=U.safeJsonParse(e)),this.forEachCrudStore(n=>{const t=`${n.storeId}Data`;e[t]&&(n.data=e[t])})}static get defaultConfig(){return{stores:null}}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}toJSON(){const e={};return this.forEachCrudStore((n,t)=>e[`${t}Data`]=n.toJSON()),e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}};Cg._$name="AbstractCrudManager";var Eg=e=>class Vg extends(e||$){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(t,s){var r;(r=t.abort)==null||r.call(t),this.isDestroying||s({cancelled:!0})}shouldUseBodyForRequestData(t,s,r){return!(s==="HEAD"||s==="GET")&&!r}sendRequest(t){const s=this,{data:r}=t,i=s.transport[t.type]||{},a=_.assign({},i,i.requestConfig);t.url&&(a.url=t.url),a.method=a.method||Vg.defaultMethod[t.type],a.params=_.assign(a.params||{},t.params);let{paramName:o}=a;if(s.shouldUseBodyForRequestData(i,a.method,o)?(a.body=r,a.headers=a.headers||{},a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"):(o=o||"data",a.params[o]=r),!a.url)throw new Error("Trying to request without URL specified");delete a.requestConfig,delete a.paramName;let l,c;function u(){a.queryParams=a.params,delete a.params;let h=!1;const f=_.assign({},a,a.fetchOptions);return l=tr.fetch(a.url,f),l.catch(g=>{var p,m;l.done=!0,(p=s.trigger)==null||p.call(s,"responseReceived",{success:!1});const y=(m=f.abortController)==null?void 0:m.signal;return y&&(h=y.aborted,h||console.warn(g)),{error:g,cancelled:h}}).then(g=>{var p;l.done=!0,(p=s.trigger)==null||p.call(s,"responseReceived",{success:!!(g!=null&&g.ok)});const m=g!=null&&g.ok?t.success:t.failure;return m==null?void 0:m.call(t.thisObj||s,g,f,t)})}const d=s.trigger("beforeSend",{params:a.params,requestType:t.type,requestConfig:a,config:t});return _.isPromise(d)?c=d.then(u):c=u(),c.abort=()=>{var h;l.done||(h=l.abort)==null||h.call(l)},c}},bg=e=>class extends(e||$){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(t){var s;return t=Object.assign({},(s=this.encoder)==null?void 0:s.requestData,t),U.safeJsonStringify(t)}decode(t){return U.safeJsonParse(t)}},Vl={startDate:1,endDate:1,constraintDate:1,deadlineDate:1},Rg=e=>{var n;return n=class extends(e||lt){get timeZone(){return this.getData("timeZone")}set timeZone(t){this.setData("timeZone",t)}setLocalDate(t,s){this.set(t,this.timeZone!=null?vt.toTimeZone(s,this.timeZone):s,!0),this.data[t]=this[t]}getLocalDate(t){return this.timeZone!=null&&this[t]?vt.fromTimeZone(this[t],this.timeZone):this[t]}applyChangeset(t){if(this.timeZone!=null)for(const s in Vl)t[s]&&(this.setLocalDate(s,new Date(t[s])),delete t[s]);return super.applyChangeset(...arguments)}getFieldPersistentValue(t){var s,r;if(this.timeZone!=null){const i=(r=(s=t==null?void 0:t.field)!=null?s:t==null?void 0:t.name)!=null?r:t;if(Vl[i])return this.getLocalDate(i)}return super.getFieldPersistentValue(t)}convertToTimeZone(t){const s=this,r={...s.meta.modified},i={...Vl};s.isTask&&!s.manuallyScheduled&&(delete i.startDate,delete i.endDate);for(const a in i)s[a]!=null?(i[a]=s[a],s.timeZone!=null&&(i[a]=s.getLocalDate(a),r[a]&&(r[a]=vt.fromTimeZone(r[a],s.timeZone)))):delete i[a];s.timeZone=t;for(const a in i)s.setLocalDate(a,i[a],!1),i[a]=1,s.timeZone!=null&&r[a]&&(r[a]=vt.toTimeZone(r[a],s.timeZone));s.clearChanges(!0,!0,i),x.isEmpty(r)||(s.meta.modified=r,s.stores.forEach(a=>a.modified.add(s)))}},F(n,"$name","TimeZonedDatesMixin"),F(n,"fields",[{name:"timeZone",persist:!1}]),n},lt=class extends H.mixin(Rg){static get $name(){return"TimeSpan"}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"},useProp:!0},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]}construct(e,...n){if(e!=null&&e.fullDuration){const{magnitude:t,unit:s}=e.fullDuration;e.duration=t,e.unit=s,delete e.fullDuration}super.construct(e,...n),this.normalize()}get eventStore(){var e;const n=this;return n.isOccurrence?n.recurringTimeSpan.eventStore:(n._eventStore||(n._eventStore=(e=n.stores)==null?void 0:e.find(t=>t.isEventStore)),n._eventStore)}normalize(){const e=this,{startDate:n,endDate:t,duration:s,durationUnit:r}=e,i=s!=null;n&&t&&!i?e.setData("duration",R.diff(n,t,r,!0)):n&&!t&&i?e.setData("endDate",R.add(n,s,r)):!n&&t&&i&&e.setData("startDate",R.add(t,-s,r))}updateInternalCls(e){this._cls?this._cls.value=e:this._cls=new Ue(e)}set internalCls(e){this.updateInternalCls(e),this.set("cls",this._cls.value)}get internalCls(){const{cls:e}=this;return e!=null&&e.isDomClassList?e:(this.internalCls=e,this._cls)}get cls(){return this._cls||(this._cls=new Ue(super.get("cls"))),this._cls}set cls(e){this.internalCls=e}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get endingDate(){const e=this,{endDate:n,startDate:t}=e;return n||R.add(t,e.duration,e.durationUnit)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,n=this.durationUnit){e=parseFloat(e),this.set({duration:e,durationUnit:n,...this.updateDatesFromDuration(e,n)})}updateDatesFromDuration(e,n,t=this.startDate,s=this.endDate){const r={};return t?r.endDate=R.add(t,e,n):s&&(r.startDate=R.add(s,-e,n)),r}getDurationInUnit(e,n){const t=this;return t.startDate&&t.endDate?R.getDurationInUnit(t.startDate,t.endDate,e,n):R.as(e,t.duration,t.durationUnit)}get fullDuration(){return new xe({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){typeof e=="string"&&(e=R.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,n=!0){const t=this,s={startDate:e};if(e){let r;if(n)r=t.duration!=null;else if(t.endDate){if(s.duration=R.diff(e,t.endDate,t.durationUnit,!0),s.duration<0)throw new Error("Negative duration")}else r=this.duration!=null;r&&(s.endDate=R.add(e,t.getDurationInUnit("h"),"h"))}else s.duration=null;t.set(s)}setEndDate(e,n=!1){const t=this,s={endDate:e};if(e){let r;if(n===!0)r=t.duration!=null;else if(t.startDate){if(s.duration=R.diff(t.startDate,e,t.durationUnit,!0),s.duration<0)throw new Error("Negative duration")}else r=this.duration!=null;r&&(s.startDate=R.add(e,-t.duration,t.durationUnit))}t.set(s)}setStartEndDate(e,n,t){this.set({startDate:e,endDate:n},null,t)}get dates(){const e=[],n=R.startOf(this.startDate,"day"),t=this.endDate;for(let s=n;s<t;s=R.add(s,1,"day"))e.push(s);return e}get startDateMS(){var e;return(e=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)==null?void 0:e.getTime()}get endDateMS(){var e;return(e=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)==null?void 0:e.getTime()}get durationMS(){const{endDateMS:e,startDateMS:n}=this;return e&&n?e-n:R.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return this.duration===0}inSetNormalize(e){if(typeof e!="string"){let{startDate:n,endDate:t,duration:s,durationUnit:r=this.durationUnit}=e;typeof n=="string"&&(n=this.getFieldDefinition("startDate").convert(n)),typeof t=="string"&&(t=this.getFieldDefinition("endDate").convert(t)),"duration"in e?(n&&!t&&(t=R.add(n,s,r,!0,!0)),!n&&t&&(n=R.add(t,-s,r,!0,!0))):n&&t&&(s=R.as(r,R.diff(n,t,"h",!0),"h"));const i=Object.isFrozen(e)?x.clone(e):e;return n&&(i.startDate=n),t&&(i.endDate=t),s!=null&&(i.duration=s),i}}fieldToKeys(e,n){var t,s;const r=super.fieldToKeys(e,n);if(r.fullDuration){const{magnitude:i,unit:a}=r.fullDuration;r.duration=i,r.durationUnit=a}return!this.isEventModel&&!this.isTaskModel&&("duration"in r||r.durationUnit)&&!(r.startDate&&r.endDate)&&Object.assign(r,this.updateDatesFromDuration((t=r.duration)!=null?t:this.duration,(s=r.durationUnit)!=null?s:this.durationUnit,r.startDate,r.endDate)),r}inSet(e,n,t,s,r,i){return r||(e=this.inSetNormalize(e)||e),super.inSet(e,n,t,s,r,i)}applyValue(e,n,t,s,r){n==="cls"&&this.updateInternalCls(t),super.applyValue(e,n,t,s,r)}forEachDate(e,n){return this.dates.forEach(e.bind(n))}get isScheduled(){const{startDateMS:e,endDateMS:n}=this;return n-e>=0}get isValid(){const{startDate:e,endDate:n}=this;return!e||!n||n-e>=0}shift(e,n=this.durationUnit){if(typeof e=="string"){const t=e;e=n,n=t}return this.setStartDate(R.add(this.startDate,e,n,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,n){const t=this.startDate,s=this.endDate;return t&&s&&R.intersectSpans(t,s,e,n)}split(e=.5){const n=this,t=n.copy(),{fullDuration:s,eventStore:r,assignmentStore:i}=n,a=new xe(s),o=new xe(s);let l,c;return typeof e=="string"?(l=new xe(e),l.unit===a.unit?o.magnitude-=l.magnitude:(o.magnitude=R.as(l.unit,a)-l.magnitude,o.unit=l.unit,c=!0)):(l=new xe(e>1?e:n.duration*e,n.durationUnit),o.magnitude-=l.magnitude),t.startDate=R.add(n.startDate,l.magnitude,l.unit),c?(t.fullDuration=o,n.fullDuration=l):(t.duration=o.magnitude,n.duration=l.magnitude),r&&(r.add(t),i&&!r.usesSingleAssignment&&i.add(n.assignments.map(u=>{const d=Object.assign({},u.data,{eventId:t.id,event:null,resource:null});return delete d.id,d}))),t}toICSString(e={}){if(!this.isScheduled)return"";const{startDate:n,endDate:t}=this,s=e.DTSTAMP||R.format(new Date,"uu");delete e.DTSTAMP;let r={};this.allDay?r={"DTSTART;VALUE=DATE":R.format(n,"u"),"DTEND;VALUE=DATE":R.format(t,"u")}:r={DTSTART:R.format(n,"uu"),DTEND:R.format(t,"uu")};const i=Se.scheduler&&Se.getVersion("scheduler")||Se.calendar&&Se.getVersion("calendar")||"",a={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${i} //EN`,END:"VCALENDAR"},o={BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:s,...r,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...e,END:"VEVENT"},l=Object.keys(a).map(u=>`${u}:${a[u]}`),c=Object.keys(o).map(u=>`${u}:${o[u]}`);return l.splice(l.length-1,0,...c),l.join(`
`)}exportToICS(e){if(this.isScheduled){const n=new Blob([this.toICSString(e)],{type:"text/calendar"});Oe.downloadBlob(n,(this.name||"Event")+".ics")}}isEditable(e){return this.getFieldDefinition(e)?!0:void 0}isFieldModified(e){return e==="fullDuration"?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(e)}};lt._$name="TimeSpan";var Xv=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,Ig=["SU","MO","TU","WE","TH","FR","SA"],ys=class extends ${static decodeDay(e){let n,t;return(n=Xv.exec(e))&&(t=[Ig.indexOf(n[2])],n[1]&&(n[1]=parseInt(n[1],10),t.push(n[1]))),t}static encodeDay(e){let n;return Array.isArray(e)&&([e,n]=e),(n?n.toString():"")+Ig[e]}static decode(e){const n=[];let t;if(e)for(let s=0;s<e.length;s++)(t=this.decodeDay(e[s]))&&n.push(t);return n}static encode(e){const n=[];let t;if(e)for(let s=0;s<e.length;s++)(t=this.encodeDay(e[s]))&&n.push(t);return n}};ys._$name="RecurrenceDayRuleEncoder";var ey=/ly$/i,Ul=e=>{const n=e.replace(ey,"");return n==="DAI"?"DAY":n},ty=(e,n,t,s)=>s.buildOccurrence(e,t),ry=e=>Wl=e,Wl,yr=class extends ${static processIterationConfig(e){const{recurrence:n}=e,{frequency:t,interval:s,timeSpan:r,endDate:i,count:a}=n;if(!e.syncingStartDate&&!r.meta.isSyncedWithRule){const d=R.add(r.startDate,s,Ul(t)),h=R.min(d,e.endDate||d);this.forEachDate({syncingStartDate:!0,startDate:r.startDate,endDate:h,recurrence:n,fn:ty})}const o=r.startDate;let{startDate:l=o,endDate:c=i}=e;l<o&&(l=o),i?(!c||c>i)&&(c=i):a&&l>o&&(this.forEachDate({recurrence:n,fn:ry}),(!c||c>Wl)&&(c=new Date(Wl.getTime()+1)));const u=l;return e.startOnly||(l=new Date(R.max(R.add(l,-s,Ul(t)),o))),Object.assign({extraArgs:[],startOnly:!r.durationMS},e,{startDate:l,endDate:c,timeSpan:r,timeSpanStart:o,earliestVisibleDate:u,endDateMS:c==null?void 0:c.getTime(),timeSpanStartMS:o.getTime(),earliestVisibleDateMS:u.getTime(),durationMS:r.durationMS,spansStart:l<=o&&c>o})}static getOccurrenceIndex(e){if(e.isOccurrence)return R.diff(e.recurringTimeSpan.startDate,e.startDate,Ul(e.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(e,n,t,s){let r,i,a;if(s){s>0?(i=1,a=e):(i=-1,a=n);const o=t-a.getDay();i*o<0&&(s+=i),r=new Date(a),r.setDate(a.getDate()+(s-i)*7+o),(r<e||r>n)&&(r=null)}return r}static buildDate(e,n,t){const s=new Date(e,n,t);if(s.getFullYear()===e&&s.getMonth()===n&&s.getDate()===t)return s}static isValidPosition(e){return!!e}static forEachDateAtPositions(e,n,t,s){const r=e.length,i={};for(let a=0;a<n.length;a++){const o=n[a];if(this.isValidPosition(o)){const l=o>0?e[o-1]:e[r+o];if(l&&!i[l.getTime()]&&(i[l.getTime()]=!0,t.call(s,l)===!1))return!1}}}static isInView(e,n,t,s,r){return(e?n>=t:n.valueOf()+s>t)&&!r.hasException(n)}static isInViewMS(e,n,t,s,r,i){return(e?t>=s:t+r>s)&&!i.hasException(n)}};F(yr,"frequency","NONE"),F(yr,"MAX_OCCURRENCES_COUNT",1e6),yr._$name="AbstractRecurrenceIterator";var zl=class extends yr{static forEachDate(e){const{startOnly:n,startDate:t,endDate:s,endDateMS:r,timeSpan:i,timeSpanStart:a,earliestVisibleDateMS:o,durationMS:l,spansStart:c,recurrence:u,fn:d,extraArgs:h,scope:f=this}=this.processIterationConfig(e),{interval:g}=u,p=t-a,m=g*864e5,y=Math.floor(p/m);let{count:D}=u,E=0,C=R.add(a,y*g,"day"),v=C.getTime();for(!s&&!D&&(D=this.MAX_OCCURRENCES_COUNT);!r||v<r;){const S=this.isInViewMS(n,C,v,o,l,i);if(E++,S&&(r&&v>r||d.apply(f,[C,E,E===1&&c,i,...h])===!1||D&&E>=D))break;C=R.add(C,g,"day"),v=C.getTime()}}};F(zl,"frequency","DAILY"),zl._$name="DailyRecurrenceIterator";var ql=class extends yr{static forEachDate(e){const{startOnly:n,startDate:t,endDateMS:s,timeSpan:r,timeSpanStart:i,timeSpanStartMS:a,earliestVisibleDateMS:o,durationMS:l,spansStart:c,recurrence:u,fn:d,extraArgs:h,scope:f=this}=this.processIterationConfig(e),{interval:g,days:p}=u,{weekStartDay:m}=R,y=i.getHours(),D=i.getMinutes(),E=i.getSeconds(),C=i.getMilliseconds();let v=0,{count:S}=u,b=ys.decode(p),w,M;if(b!=null&&b.length||(b=[[i.getDay()]]),m>0)for(let I=0;I<b.length;I++)m>b[I][0]?b[I][0]=7-m-b[I][0]:b[I][0]-=m;for(b.sort((I,A)=>I[0]-A[0]),w=R.getNext(S||g>1?i:t,"week",0),!s&&!S&&(S=this.MAX_OCCURRENCES_COUNT);!s||w.getTime()<s;){for(let I=0;I<b.length;I++){M=new Date(w.getFullYear(),w.getMonth(),w.getDate()+b[I][0],y,D,E,C);const A=M.getTime();if(A>=a){const T=this.isInViewMS(n,M,A,o,l,r);if(v++,T&&(s&&A>=s||d.apply(f,[M,v,v===1&&c,r,...h])===!1||S&&v>=S))return}}w=R.getNext(w,"week",g)}}};F(ql,"frequency","WEEKLY"),ql._$name="WeeklyRecurrenceIterator";var Gl=class extends yr{static getNthDayOfMonth(e,n){const t=R.daysInMonth(e);let s=null;return n&&Math.abs(n)<=t&&(s=new Date(e.getFullYear(),e.getMonth(),n<0?t+n+1:n)),s}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const{startOnly:n,startDate:t,endDate:s,timeSpan:r,timeSpanStart:i,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:c,fn:u,extraArgs:d,scope:h=this}=this.processIterationConfig(e),{interval:f,days:g,count:p,positions:m}=c,y=ys.decode(g),D=m&&m.length,E={};let{monthDays:C}=c,v=0,S,b,w,M,I,A;for(b=R.startOf(p||f>1?i:t,"month"),w=new Date(R.getNext(b,"month",1)-1),!(C&&C.length)&&!(y&&y.length)&&(C=[i.getDate()]),y&&y.length&&y.forEach(T=>{T[1]&&(S=S||{},S[T[0]]=T[1])});(!s||s>b)&&(!p||v<p);){if(M=[],y&&y.length){if(y.forEach(T=>{const k=T[0];let Z=1,z=53;for(T[1]&&(Z=z=T[1]),A=Z;A<=z;A++)(I=this.getNthDayInPeriod(b,w,k,A))&&(I=R.copyTimeValues(I,i),E[I.getTime()]||(E[I.getTime()]=!0,M.push(I)))}),M.sort((T,k)=>T-k),!D){for(A=0;A<M.length;A++)if(I=M[A],I>=i){const T=this.isInView(n,I,a,o,r);if(v++,T&&(s&&I>=s||u.apply(h,[I,v,v===1&&l,r,...d])===!1||p&&v>=p))return!1}}}else{const T=[];for(A=0;A<C.length;A++)(I=this.getNthDayOfMonth(b,C[A]))&&!E[I.getTime()]&&(E[I.getTime()]=!0,T.push(I));for(T.sort((k,Z)=>k-Z),A=0;A<T.length;A++)if(I=R.copyTimeValues(T[A],i),D)M.push(I);else if(I>=i){const k=this.isInView(n,I,a,o,r);if(v++,k&&(s&&I>s||u.apply(h,[I,v,v===1&&l,r,...d])===!1||p&&v>=p))return}}D&&M.length&&this.forEachDateAtPositions(M,m,T=>{if(T>=i){const k=n?T>=a:T.valueOf()+o>a&&!r.hasException(T);if(v++,k&&(!s||T<=s)&&(u.apply(h,[T,v,v===1&&l,r,...d])===!1||p&&v>=p))return!1}}),b=R.getNext(b,"month",f),w=new Date(R.getNext(b,"month",1)-1)}}};F(Gl,"frequency","MONTHLY"),Gl._$name="MonthlyRecurrenceIterator";var Hl=class extends yr{static forEachDate(e){const{startOnly:n,startDate:t,endDate:s,timeSpan:r,timeSpanStart:i,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:c,fn:u,extraArgs:d,scope:h=this}=this.processIterationConfig(e),{interval:f,days:g,count:p,positions:m}=c,y=ys.decode(g),D=m&&m.length,E={};let{months:C}=c,v=0,S,b,w,M,I,A;for(M=R.startOf(p||f>1?i:t,"year"),I=new Date(R.getNext(M,"year",1)-1),C&&C.sort((T,k)=>T-k),!(C&&C.length)&&!(y&&y.length)&&(C=[i.getMonth()+1]),y&&y.length&&y.forEach(T=>{T[1]&&(A=A||{},A[T[0]]=T[1])});(!s||s>M)&&(!p||v<p);){if(w=[],y&&y.length){if(y.forEach(T=>{const k=T[0];let Z=1,z=53;for(T[1]&&(Z=z=T[1]),S=Z;S<=z;S++)(b=this.getNthDayInPeriod(M,I,k,S))&&(b=R.copyTimeValues(b,i),E[b.getTime()]||(E[b.getTime()]=!0,w.push(b)))}),w.sort((T,k)=>T-k),!D){for(S=0;S<w.length;S++)if(b=w[S],b>=i){const T=this.isInView(n,b,a,o,r);if(v++,T&&(s&&b>=s||u.apply(h,[b,v,v===1&&l,r,...d])===!1||p&&v>=p))return}}}else for(S=0;S<C.length;S++)if((b=this.buildDate(M.getFullYear(),C[S]-1,i.getDate()))&&(b=R.copyTimeValues(b,i),!E[b.getTime()])){if(E[b.getTime()]=!0,D)w.push(b);else if(b>=i){const T=n?b>=a:b.valueOf()+o>a&&!r.hasException(b);if(v++,T&&(s&&b>=s||u.apply(h,[b,v,v===1&&l,r,...d])===!1||p&&v>=p))return}}D&&w.length&&this.forEachDateAtPositions(w,m,T=>{if(T>=i){const k=n?T>=a:T.valueOf()+o>a&&!r.hasException(T);if(v++,k&&(!s||T<s)&&(u.apply(h,[T,v,v===1&&l,r,...d])===!1||p&&v>=p))return!1}}),M=R.getNext(M,"year",f),I=new Date(R.getNext(M,"year",1)-1)}}};F(Hl,"frequency","YEARLY"),Hl._$name="YearlyRecurrenceIterator";var Pg={};[zl,ql,Gl,Hl].forEach(e=>{Pg[e.frequency]=e});function Yl(e){return e?typeof e=="string"&&(e=e.split(",").map(n=>parseInt(n,10))):e=null,e}function ny(e){return e?typeof e=="string"&&(e=e.split(",")):e=null,e}function zi(e,n){return String(e)===String(n)}function wg(e){return this.defaultValue&&e===void 0?this.defaultValue:this.allowNull&&e==null?null:(e=parseInt(e),isNaN(e)?void 0:e)}var Kl=class extends H{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:wg},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:wg},{name:"days",convert:ny,isEqual:zi},{name:"monthDays",convert:Yl,isEqual:zi},{name:"months",convert:Yl,isEqual:zi},{name:"positions",convert:Yl,isEqual:zi}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return Pg[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const e=this,n=[];return e.frequency&&(n.push(`FREQ=${e.frequency}`),e.interval>1&&n.push(`INTERVAL=${e.interval}`),e.days&&e.days.length&&n.push("BYDAY="+e.days.join(",")),e.monthDays&&e.monthDays.length&&n.push("BYMONTHDAY="+e.monthDays.join(",")),e.months&&e.months.length&&n.push("BYMONTH="+e.months.join(",")),e.count&&n.push(`COUNT=${e.count}`),e.endDate&&n.push("UNTIL="+R.format(e.endDate,e.dateFormat)),e.positions&&e.positions.length&&n.push("BYSETPOS="+e.positions.join(","))),n.join(";")}set rule(e){const n=this,t={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(n.beginBatch(),e){const s=e.split(";");for(let r=0,i=s.length;r<i;r++){const a=s[r].split("="),o=a[1];switch(a[0]){case"FREQ":t.frequency=o;break;case"INTERVAL":t.interval=o;break;case"COUNT":t.count=o,t.until=null;break;case"UNTIL":o?t.endDate=R.parse(o,n.dateFormat):t.endDate=null,t.count=null;break;case"BYDAY":t.days=o;break;case"BYMONTHDAY":t.monthDays=o;break;case"BYMONTH":t.months=o;break;case"BYSETPOS":t.positions=o;break}}}n.set(t),e&&n.sanitize(),n.endBatch()}construct(e={}){const n=this,{rule:t,timeSpan:s}=e;n._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),t&&(n.suspendTimeSpanNotifying(),n.rule=t,n.resumeTimeSpanNotifying()),n.timeSpan=s}forEachOccurrence(e,n,t){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:n,fn(s,r,i,a){return t(a.buildOccurrence(s,i),i,r,s)}})}sanitize(){var e,n;const t=this,s=(e=t.timeSpan)==null?void 0:e.startDate,r={};switch(t.isSanitizing=!0,t.frequency){case"DAILY":r.positions=null,r.days=null,r.monthDays=null,r.months=null;break;case"WEEKLY":{r.positions=null,r.monthDays=null,r.months=null;const{days:i}=t;s&&(i==null?void 0:i.length)===1&&i[0]===ys.encodeDay(s.getDay())&&(r.days=null);break}case"MONTHLY":{(n=t.monthDays)!=null&&n.length&&(r.positions=null,r.days=null),r.months=null;const{monthDays:i}=t;s&&(i==null?void 0:i.length)===1&&i[0]===s.getDate()&&(r.monthDays=null);break}case"YEARLY":{r.monthDays=null;const{months:i}=t;s&&(i==null?void 0:i.length)===1&&i[0]===s.getMonth()+1&&(r.months=null);break}}t.set(r),t.isSanitizing=!1}copy(...e){const n=super.copy(...e);return n.dateFormat=this.dateFormat,n.timeSpan=this.timeSpan,n}afterChange(e,n,t){const s=super.afterChange(e,n,t),{timeSpan:r}=this;return this.isSanitizing||this.sanitize(),r&&(r.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||r.onRecurrenceChanged()),s}set(e,n,...t){const s=typeof e=="object"?e:{[e]:n};s.count?s.endDate=null:s.endDate&&(s.count=null),super.set(s,void 0,...t)}get isTimeSpanNotifyingSuspended(){return!!this._suspendedTimeSpanNotifying}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}};Kl._$name="RecurrenceModel";function sy(e){const n={},{dateFormat:t}=this;return e&&(e=typeof e=="string"?e.split(","):W.asArray(e),e.forEach(s=>{typeof s=="string"&&(s=R.parse(s,t)),isNaN(s)||(n[R.makeKey(s)]=1)})),n}function iy(e){const n=[],{dateFormat:t}=this;for(const s in e)e[s]&&n.push(R.format(R.parseKey(s),t));return n}var ay=[],qi=e=>class extends(e||lt){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:sy,serialize:iy,internal:!0}]}remove(){if(this.isOccurrence){const t=this,{recurringTimeSpan:s}=t;t.cancelBatch(),s.beginBatch(),t.detachFromRecurringEvent(),s.endBatch()}else return super.remove(...arguments)}get eventStore(){var t;let s=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!s&&((t=this.firstStore)!=null&&t.isRecurringTimeSpansMixin)&&(s=this.firstStore),s}get recurrenceModel(){return this._recurrenceModel||Kl}set recurrenceModel(t){this._recurrenceModel=t}setRecurrence(t,s,r){const i=this;let a;t&&(t.isRecurrenceModel||(typeof t=="string"&&(t={frequency:t},s&&(t.interval=s),r&&(r instanceof Date?t.endDate=r:t.count=r)),t=new i.recurrenceModel(t)),t.timeSpan=i,a=t.rule),i.recurrence=t,i.recurrenceRule=a}get recurrence(){const t=this,s=t.recurrenceRule;return!t._recurrence&&s&&(t._recurrence=new t.recurrenceModel({rule:s,timeSpan:t,id:`${t.id}-recurrence`})),t._recurrence}set recurrence(t){const s=this;s._recurrence=t,t?(t.timeSpan=s,s.recurrenceRule=t.rule):s.isOccurrence?s.setData("recurrenceRule",null):s.recurrenceRule=null}get isRecurring(){return!!(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return!!this.recurringTimeSpan}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(t){this._recurringTimeSpan=t}getOccurrencesForDateRange(t,s=t){return this.eventStore.getOccurrencesForTimeSpan(this,t,s)}get occurrences(){if(this.isRecurring){const t=[];return this.occurrenceMap.forEach(s=>{s!==this&&t.push(s)}),t}return ay}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(t){var s;const r=t.isTimeSpan?t.occurrenceDate:t;(s=this.eventStore)==null||s.globalOccurrences.delete(this.createRecurrenceKey(r)),this.occurrenceMap.delete(R.makeKey(r))}removeOccurrencesFrom(t){this.occurrenceMap.forEach((s,r)=>{R.parseKey(r)>=t&&this.removeOccurrence(s)})}removeOccurrences(){[this,...this.occurrences].forEach(t=>this.removeOccurrence(t))}onRecurrenceChanged(){var t;this.recurrenceRule=((t=this.recurrence)==null?void 0:t.rule)||null}sanitizeRecurrenceData(t=this.recurrence){if(t.endDate){const s=R.clearTime(t.endDate),{exceptionDates:r}=this;if(this.removeOccurrencesFrom(s),r)for(const i in r)R.parseKey(i)>=s&&delete r[i]}}get occurrenceDate(){var t;return((t=this.meta.modified)==null?void 0:t.startDate)||this.startDate}get occurrenceIndex(){return yr.getOccurrenceIndex(this)}buildOccurrence(t,s){var r;const i=this,{occurrenceMap:a,recurrence:o,meta:l}=i,c=(r=i.eventStore)==null?void 0:r.globalOccurrences,u=R.makeKey(t),d=i.createRecurrenceKey(t,u),h=!(t-i.startDate),{fieldMap:f}=i.constructor;let g=c==null?void 0:c.get(d),{duration:p}=i;i.endDate&&(i.allDay||!p)&&(p=R.as(i.durationUnit,i.endDate.getTime()-i.startDate.getTime()));const m=p!==void 0?R.add(t,p,i.durationUnit):void 0;return g||(s||h?(g=i,h||(i.setStartEndDate(t,m,!0),o.suspendTimeSpanNotifying(),o.sanitize(),o.resumeTimeSpanNotifying()),l.isSyncedWithRule=!0):(g=i.copy({[f.id.dataSource]:d,[f.startDate.dataSource]:t,[f.endDate.dataSource]:m,[f.duration.dataSource]:p,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),g.recurringTimeSpan=i),c==null||c.set(d,g),a.set(u,g)),g}createRecurrenceKey(t=this.startDate,s=null){return`_generated:${this.id}:${s||R.makeKey(t)}`}convertToRealEvent(t,s){var r;if(!this.isOccurrence)return;const i=this,{recurringTimeSpan:a,resource:o,occurrenceIndex:l,recurrence:c}=i,u=c&&a.recurrence.count,d=((r=t==null?void 0:t.resourceRecords)==null?void 0:r.value)||i.data.newResource;a.beginBatch(),i.detachFromRecurringEvent(),i.clearChanges(),i.setData("id",i.generateId(a.eventStore)),d&&delete i.data.resourceId,a.eventStore.add(i,s),u&&(i.recurrence.count=u-l),(d||o)&&i.assign(d||o),d&&delete i.data.resourceRecords,t&&delete t.resourceRecords,a.endBatch()}afterChange(t,s,r,...i){const a=this,{eventStore:o}=a;return"recurrenceRule"in s&&(a._recurrence=null,o==null||o.recurringEvents[s.recurrenceRule.value?"add":"delete"](a)),a.isOccurrence?a.convertToRealEvent(s,r):"newExceptionDate"in s&&(a.meta.modified.exceptionDates=!0,delete a.meta.modified.newExceptionDate,a.removeOccurrence(s.newExceptionDate.value)),super.afterChange(t,s,r,...i)}detachFromRecurringEvent(){const t=this,{recurringTimeSpan:s,occurrenceDate:r,startDate:i}=t;t.recurringTimeSpan=null,s.addExceptionDate(r),t.recurrenceRule&&(s.recurrence.endDate=R.add(i,-1,"minute"))}set newExceptionDate(t){if(t){const s=this.exceptionDates||(this.exceptionDates={});s[R.makeKey(t)]=1}}addExceptionDate(t){return this.set({newExceptionDate:t})}hasException(t){var s;return(s=this.exceptionDates)==null?void 0:s[R.makeKey(t)]}},Sr=class extends lt.mixin(qi){get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}};F(Sr,"$name","ResourceTimeRangeModel"),F(Sr,"fields",["resourceId","timeRangeColor"]),F(Sr,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}}),F(Sr,"domIdPrefix","resourcetimerange"),Sr._$name="ResourceTimeRangeModel";var Mg=Object.freeze([]),Jl=e=>class extends(e||$){static get $name(){return"RecurringTimeSpansMixin"}construct(...t){const s=this;s.globalOccurrences=new Map,s.recurringEvents=new Set,super.construct(...t)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:t,added:s,removed:r,replaced:i}){this.refreshRecurringEventsCache(t,s,r,i),super.onDataChange(...arguments)}refreshRecurringEventsCache(t,s=Mg,r=Mg,i){const a=this,{recurringEvents:o}=a,l=i==null?void 0:i.length;switch(t){case"clear":o.clear();break;case"splice":{if(l){s=s.slice(),r=r.slice();for(let d=0;d<l;d++)r.push(i[d][0]),s.push(i[d][1])}const c=s.length,u=r.length;if(u&&o.size)for(let d=0;d<u;d++)o.delete(r[d]);if(c)for(let d=0;d<c;d++){const h=s[d];h.isRecurring&&o.add(h)}break}}}getById(t){let s=super.getById(t);return s||(s=this.globalOccurrences.get(this.modelClass.asId(t))),s}onModelChange(t,s,r,i,a){const o=!i&&this.isRecurrenceRelatedFieldChange(t,r);if(o&&t.removeOccurrences(),super.onModelChange(...arguments),o){const l={action:"batch",records:this.storage.values};this.trigger("refresh",l),this.trigger("change",l)}}isRecurrenceRelatedFieldChange(t,s){return t.isRecurring||"recurrenceRule"in s}getOccurrencesForTimeSpan(t,s,r){const i=[];return t.isRecurring&&t.recurrence.forEachOccurrence(s,r,a=>i.push(a)),i}set data(t){this.globalOccurrences.clear(),super.data=t}getRecurringTimeSpans(){return[...this.recurringEvents]}},Gi=class extends We.mixin(Jl){static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:Sr,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}getRanges({resourceRecord:e,startDate:n,endDate:t}){return e.timeRanges.flatMap(r=>r.supportsRecurring?r.getOccurrencesForDateRange(n,t):r.intersectsRange(n,t)?r:[]).sort((r,i)=>r.startDate-i.startDate)}};F(Gi,"$name","ResourceTimeRangeStore"),Gi._$name="ResourceTimeRangeStore";var Jt=e=>class extends(e||$){static get $name(){return"PartOfProject"}},Ql=e=>class extends e{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(t,...s){t=t||{};const{fieldMap:r}=this,i=r.eventId.dataSource,a=r.resourceId.dataSource,o=r.event.dataSource,l=r.resource.dataSource,c=t[i],u=t[a],d=t[o],h=t[l];c!=null?t[o]=c:d!=null&&(t[i]=d.isModel?d.id:d),u!=null?t[l]=u:h!=null&&(t[a]=h.isModel?h.id:h),super.construct(t,...s)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(t,s){let r,i;return t?r=t.isModel?t.id:t:r=this.internalId,s?i=s.isModel?s.id:s:i=this.internalId,`${r}-${i}`}buildIndexKey({event:t,resource:s}){return this.buildEventResourceKey(t,s)}set(t,s,...r){var i,a;const o=this.fieldToKeys(t,s);return"resource"in o?((i=o.resource)==null?void 0:i.id)!==void 0&&(o.resourceId=o.resource.id):"resourceId"in o&&this.constructor.isProAssignmentModel&&(o.resource=o.resourceId),"event"in o?((a=o.event)==null?void 0:a.id)!==void 0&&(o.eventId=o.event.id):"eventId"in o&&this.constructor.isProAssignmentModel&&(o.event=o.eventId),super.set(o,null,...r)}afterChange(t,s,r,i,a){var o,l;const c=this;return!c.constructor.isProAssignmentModel&&(s!=null&&s.resourceId)&&((o=c.resource)==null?void 0:o.id)!==s.resourceId.value?c.resource=s.resourceId.value:c.constructor.isProAssignmentModel&&((l=c.project)!=null&&l.propagatingSyncChanges)&&(s!=null&&s.eventId)&&!(s!=null&&s.event)&&(t.event.value===s.eventId.value||t.event.value.id===s.eventId.value)&&(delete s.eventId,delete c.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(t){const{resource:s}=this;s!=null&&s.isModel&&s.id===t?this.set("resourceId",t):this.resource=t}get resourceId(){var t,s;return(s=(t=this.resource)==null?void 0:t.id)!=null?s:this.get("resourceId")}set eventId(t){const{event:s}=this;s!=null&&s.isModel&&s.id===t?this.set("eventId",t):this.event=t}get eventId(){var t,s;return(s=(t=this.event)==null?void 0:t.id)!=null?s:this.get("eventId")}get eventName(){var t;return(t=this.event)==null?void 0:t.name}get resourceName(){var t;return(t=this.resource)==null?void 0:t.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var t;const{event:s,resource:r,unjoinedStores:i,assignmentStore:a}=this,o=a==null?void 0:a.crudManager;let l;return a?l=this.isValid&&s.isPersistable&&(o||!s.hasGeneratedId&&!r.hasGeneratedId):l=!this.isPhantom&&!!i[0],l&&super.isPersistable&&!((t=this.event)!=null&&t.isCreating)}get isValid(){return this.resource!=null&&this.event!=null}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(t,s,r){var i,a;if(!super.shouldRecordFieldChange(t,s,r))return!1;if(t==="event"||t==="eventId"){const o=(i=this.project)==null?void 0:i.eventStore;if(o&&o.oldIdMap[s]===o.getById(r))return!1}if(t==="resource"||t==="resourceId"){const o=(a=this.project)==null?void 0:a.resourceStore;if(o&&o.oldIdMap[s]===o.getById(r))return!1}return!0}},oy=Ni,Ss=class extends Ql(Jt(oy.derive(H))){static get $name(){return"AssignmentModel"}};Ss.exposeProperties(),Ss._$name="AssignmentModel";var Zl=e=>class extends e{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(t,...s){var r;t=W.asArray(t);for(let i=0;i<t.length;i++){let a=t[i];if(a instanceof H||(t[i]=a=this.createRecord(a)),!this.isSyncingDataOnLoad&&this.storage.findIndex("eventResourceKey",a.eventResourceKey,!0)!==-1)throw new Error(`Duplicate assignment Event: ${a.eventId} to resource: ${a.resourceId}`);(r=a.event)!=null&&r.isCreating&&(a.isCreating=!0)}return super.add(t,...s)}includesAssignment(t,s){return this.storage.findIndex("eventResourceKey",`${t}-${s}`,!0)!==-1}setStoreData(t){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined EventStore data containing resourceId (single-assignment mode)");super.setStoreData(t)}set storage(t){super.storage=t,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(t,s){if(!t||!(s!=null&&s.isOccurrence))return t;const r=this;return{id:`${s.id}:a${t.id}`,event:s,resource:t.resource,eventId:s.id,resourceId:t.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(i){return r.occurrenceInstanceMeta(this,i)}}}occurrenceInstanceMeta(t,s){const r=this,i=s.id||s,{id:a}=t;let{occurrenceMeta:o}=r;return o||(o=r.occurrenceMeta={}),o[a]||(o[a]={}),o[a][i]||(o[a][i]={})}mapAssignmentsForEvent(t,s,r){t=this.eventStore.getById(t);const i=!!s,a=!!r;return i||a?t.assignments.reduce((o,l)=>{const c=i?s(l):l;return(!a||r(c))&&o.push(c),o},[]):t.assignments}mapAssignmentsForResource(t,s,r){t=this.resourceStore.getById(t);const i=!!s,a=!!r;return i||a?t.assignments.reduce((o,l)=>{const c=i?s(l):l;return(!a||r(c))&&o.push(c),o},[]):t.assignments}getAssignmentsForEvent(t){return t.assignments}removeAssignmentsForEvent(t){return this.remove(t.assignments)}getAssignmentsForResource(t){return t=this.resourceStore.getById(t),t.assignments}removeAssignmentsForResource(t){this.remove(this.getAssignmentsForResource(t))}getResourcesForEvent(t){return t.resources}getEventsForResource(t){return t=this.resourceStore.getById(t),t==null?void 0:t.events}assignEventToResource(t,s,r=null,i=!1){var a,o;const l=this,c=i?new Set(t.assignments):null;if(s=W.asArray(s).map(d=>{var h;return(h=d.$original)!=null?h:d}),(a=l.eventStore)!=null&&a.usesSingleAssignment){if((o=t.assignments)!=null&&o.length)return l.isEventAssignedToResource(t,s[0])||(t.resource=s[0]),[];t.resourceId=s[0].id}let u=[];return l.suspendAutoCommit(),s.forEach(d=>{var h;const f=l.getAssignmentForEventAndResource(t,d);if(f)i&&c.delete(f);else{const g={event:t,resource:d};u.push((h=r==null?void 0:r(g))!=null?h:g)}}),u=l.add(u),i&&l.remove(Array.from(c)),l.resumeAutoCommit(),u}unassignEventFromResource(t,s){const r=this,i=[];if(!s)return r.removeAssignmentsForEvent(t);s=W.asArray(s);for(let a=0;a<s.length;a++)r.isEventAssignedToResource(t,s[a])&&i.push(r.getAssignmentForEventAndResource(t,s[a]));return r.remove(i)}isEventAssignedToResource(t,s){return!!this.getAssignmentForEventAndResource(t,s)}getAssignmentForEventAndResource(t,s){let r;return!(t=this.eventStore.getById(t))||!(r=t.assignments)||!(s=this.resourceStore.$master.getById(s))?null:this.getOccurrence(r.find(i=>{var a;return((a=i.resource)==null?void 0:a.$original)===s.$original}),t)}},ly=Jt(_l.derive(We)),Hi=class extends Zl(ly){static get defaultConfig(){return{modelClass:Ss}}};F(Hi,"$name","AssignmentStore"),Hi._$name="AssignmentStore";var Xl=e=>{var n;return n=class extends(e||$){static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(t){if(super.construct(t),this.autoTree=!0,this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}set filtersFunction(t){super.filtersFunction=t}get filtersFunction(){const t=super.filtersFunction;return t&&t!==Et.returnTrue?s=>s.isCreating||t(s):t}getEventCounts(t){const s=this,{filtersFunction:r,added:i}=s,a=s.getEvents({...t,storeFilterFn:s.isFiltered?s.reapplyFilterOnAdd?r:o=>i.includes(o)?s.indexOf(o)>-1:r(o):null,dateMap:t.dateMap||!0});return a.forEach((o,l)=>a.set(l,o.length)),a}forEachScheduledEvent(t,s=this){this.forEach(r=>{const{startDate:i,endDate:a}=r;if(i&&a)return t.call(s,r,i,a)})}getTotalTimeSpan(){let t=new Date(9999,0,1),s=new Date(0);return this.forEach(r=>{r.startDate&&(t=R.min(r.startDate,t)),r.endDate&&(s=R.max(r.endDate,s))}),t=t<new Date(9999,0,1)?t:null,s=s>new Date(0)?s:null,this.lastTotalTimeSpan={startDate:t||null,endDate:s||t||null}}isEventPersistable(t){return t.isPersistable}isDateRangeAvailable(t,s,r,i){if(i.data.generatedParent)return!1;const a=new Set(this.getEventsForResource(i));if(r!=null&&r.isAssignment&&r.event.resources.forEach(c=>{c.id!==r.resourceId&&this.getEventsForResource(c).forEach(u=>a.add(u))}),r){const o=r.isAssignment?r.event:r;a.delete(o)}return!Array.from(a).some(o=>o.isScheduled&&R.intersectSpans(t,s,o.startDate,o.endDate))}filterEventsForResource(t,s,r=this){return t.getEvents(this).filter(s.bind(r))}getResourcesForEvent(t){return t.isOccurrence&&(t=t.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(t)}getEventsForResource(t){return this.assignmentStore.getEventsForResource(t)}getAssignmentsForEvent(t){return this.assignmentStore.getAssignmentsForEvent(t)||[]}getAssignmentsForResource(t){return this.assignmentStore.getAssignmentsForResource(t)||[]}assignEventToResource(t,s,r=!1){return this.assignmentStore.assignEventToResource(t,s,void 0,r)}unassignEventFromResource(t,s){this.assignmentStore.unassignEventFromResource(t,s)}reassignEventFromResourceToResource(t,s,r){const i=this,a=H.asId(r),o=i.assignmentStore.getAssignmentForEventAndResource(t,s);o?o.resourceId=a:i.assignmentStore.assignEventToResource(t,r)}isEventAssignedToResource(t,s){return this.assignmentStore.isEventAssignedToResource(t,s)}removeAssignmentsForEvent(t){this.assignmentStore.removeAssignmentsForEvent(t)}removeAssignmentsForResource(t){this.assignmentStore.removeAssignmentsForResource(t)}append(t){return this.add(t)}get project(){return super.project}set project(t){var s;super.project=t,this.detachListeners("project"),t&&((s=t.assignmentStore)!=null&&s.isAssignmentStore&&this.attachToAssignmentStore(t.assignmentStore),t.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(t){this._usesSingleAssignment=t;const{assignmentStore:s}=this;s!=null&&s.isStore&&!s.hasGenerateIdOverride&&(s.modelClass.generateId=function(){return this.singleAssignmentIdCounter==null&&(this.singleAssignmentIdCounter=0),`a-${++this.singleAssignmentIdCounter}`},s.hasGenerateIdOverride=!0)}processRecords(t){var s;const{assignmentStore:r}=this,i=[];return r&&(r.skipInvalidateIndices=!0),t=super.processRecords(t,r&&!((s=this.stm)!=null&&s.isRestoring)&&(a=>{const o=a.get("resourceId");!a.reassignedFromReplace&&o!=null&&(r.includesAssignment(a.id,o)||i.push({id:r.modelClass.generateId(""),resourceId:o,eventId:a.id})),a.reassignedFromReplace=!1})||void 0),r&&(r.storage.invalidateIndices(),r.skipInvalidateIndices=!1,r.add(i)),t}joinRecordsToStore(t){const{assignmentStore:s}=this;s?(s.skipInvalidateIndices=!0,super.joinRecordsToStore(t),s.storage.invalidateIndices(),s.skipInvalidateIndices=!1):super.joinRecordsToStore(t)}processRecord(t,s=!1){var r,i,a;t=super.processRecord(t,s);const o=this,l=(i=o.assignmentStore)!=null?i:(r=o.crudManager)==null?void 0:r.assignmentStore,c=t.get("resourceId"),{resourceIds:u}=t;if(u!=null&&u.length&&t.meta.skipEnforcingSingleAssignment!==!1&&((a=o.modelClass.fieldMap)!=null&&a.resourceIds.persist))l?l.add(u.filter(d=>!l.some(h=>h.eventId===t.id&&h.resourceId===d)).map(d=>({resource:d,event:t}))):o.$processResourceIds=!0;else if(c!=null&&!t.meta.skipEnforcingSingleAssignment){const d=o.getById(t.id);if(d&&d!==t&&!s){const f=l.storage.findItem("eventId",t.id);if(f!=null&&f.size){const g=f.values().next().value;g.resource=c,t.reassignedFromReplace=!0}}else o.$processResourceIds=!0;o.usesSingleAssignment=!0}return t}processResourceIds(){var t,s,r;const i=this,a=(s=i.assignmentStore)!=null?s:(t=i.crudManager)==null?void 0:t.assignmentStore;if(i.$processResourceIds&&(a!=null&&a.isAssignmentStore)&&!((r=i.project)!=null&&r.isSharingAssignmentStore&&i.isChained)){const o=[];i.forEach(l=>{const{resourceId:c,resourceIds:u,id:d}=l;c!=null?o.push({id:a.modelClass.generateId(""),resourceId:c,eventId:d}):u!=null&&u.length&&u.forEach(h=>{o.push({id:a.modelClass.generateId(""),resourceId:h,eventId:d})})}),a.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},a.usesSingleAssignment=!1,a.verifyNoGeneratedIds=!1,a.data=o,a.usesSingleAssignment=!0,i.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:t}){var s;const r=this;if(r.removeUnassignedEvent&&!r.isRemoving&&!r.isSettingData&&!((s=r.stm)!=null&&s.isRestoring)&&!r.usesSingleAssignment&&!r.assignmentStore.isSyncingDataOnLoad&&!r.resourceStore.isSyncingDataOnLoad){const i=new Set;t.forEach(a=>{const{event:o}=a;o&&!o.isRemoved&&o.assignments.every(l=>t.includes(l))&&i.add(o)}),i.size&&r.remove([...i])}}onProjectAssignmentStoreChange({store:t}){this.attachToAssignmentStore(t)}attachToAssignmentStore(t){const s=this;s.detachListeners("assignmentStore"),t&&(s.processResourceIds(),t.ion({name:"assignmentStore",addPreCommit({records:r}){var i;!s.isSettingData&&!s.isAssigning&&(s.usesSingleAssignment?r.forEach(a=>{const{event:o}=a;o!=null&&o.isEvent&&o.resourceId!==a.resourceId&&(o.meta.isAssigning=!0,o.set("resourceId",a.resourceId),o.meta.isAssigning=!1)}):(i=s.modelClass.fieldMap)!=null&&i.resourceIds.persist&&r.forEach(a=>{var o;const{event:l}=a;if(l!=null&&l.isEvent){l.meta.isAssigning=!0;const c=(o=l.resourceIds)!=null?o:[];c.includes(a.resourceId)||(l.resourceIds=[...c,a.resourceId]),l.meta.isAssigning=!1}}))},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:r}){var i;!s.isSettingData&&!s.isAssigning&&(s.usesSingleAssignment?r.forEach(a=>{var o;(o=s.getById(a.eventId))==null||o.set("resourceId",null)}):(i=s.modelClass.fieldMap)!=null&&i.resourceIds.persist&&r.forEach(({event:a,resourceId:o})=>{const l=a.resourceIds.slice(),c=l==null?void 0:l.indexOf(o);c>=0&&(l.splice(c,1),a.resourceIds=l)}))},removeAllPreCommit(){var r;!s.isSettingData&&!s.isAssigning&&(s.usesSingleAssignment?s.allRecords.forEach(i=>i.set("resourceId",null)):(r=s.modelClass.fieldMap)!=null&&r.resourceIds.persist&&s.allRecords.forEach(i=>{i.resourceIds=[]}))},update({record:r,changes:i}){var a;if("resourceId"in i){const{event:o}=r;if(s.usesSingleAssignment)o.meta.isAssigning=!0,o.set("resourceId",i.resourceId.value),o.meta.isAssigning=!1;else if((a=s.modelClass.fieldMap)!=null&&a.resourceIds.persist){o.meta.isAssigning=!0;const l=o.resourceIds.slice(),c=l==null?void 0:l.indexOf(i.resourceId.oldValue);c>=0&&l.splice(c,1),l!=null&&l.includes(i.resourceId.value)||(l.push(i.resourceId.value),o.resourceIds=l),o.meta.isAssigning=!1}}},change({action:r,records:i}){var a;r==="dataset"&&((a=s.modelClass.fieldMap)!=null&&a.resourceIds.persist)&&i.forEach(({event:o,resourceId:l})=>{var c;const u=(c=o.resourceIds)!=null?c:[];u.includes(l)||(u.push(l),o.meta.isAssigning=!0,o.setData("resourceIds",u),o.meta.isAssigning=!1)})},thisObj:s}))}set data(t){this.isSettingData=!0,this.usesSingleAssignment&&!this.syncDataOnLoad&&!this.isChained&&this.assignmentStore.removeAll(!0),super.data=t,this.isSettingData=!1}trigger(t,s){var r;const{changes:i}=s||{};return i&&"resourceId"in i&&Object.keys(i).length===1&&!((r=this.stm)!=null&&r.isRestoring)&&(s.isAssign=!0),super.trigger(...arguments)}remove(t,...s){var r,i;const a=super.remove(t,...s);if(a.length&&this.usesSingleAssignment)for(const o of a)o.isOccurrence||(i=this.assignmentStore||((r=this.crudManager)==null?void 0:r.assignmentStore))==null||i.remove(o.assignments,!0);return a}},F(n,"$name","EventStoreMixin"),n},cy=()=>!0,uy=e=>!e.isRecurring,Yi=e=>{var n;return n=class extends e{getEvents({filter:t,date:s,startDate:r,endDate:i,startOnly:a,includeOccurrences:o,allowPartial:l,onlyAssigned:c=!1,dateMap:u=!1,dayTime:d=null,getDateIndex:h}){const f=this,g=arguments[0],{lastDateRange:p,added:m,filtersFunction:y}=f,D=t;if(c&&(g.filter=D?C=>D(C)&&C.resources.length:C=>C.resources.length),"startDate"in g||(r=g.startDate=s),"includeOccurrences"in g||(o=g.includeOccurrences=!0),"allowPartial"in g||(l=g.allowPartial=!a),g.storeFilterFn=f.isFiltered&&!g.ignoreFilters?f.reapplyFilterOnAdd?y:C=>m.includes(C)?f.indexOf(C)>-1:y(C):null,!i)if(r)i=g.endDate=R.clearTime(r),i.setDate(i.getDate()+1);else{if(o)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");g.dateFilter=cy}g.dateFilter||(a?g.dateFilter=C=>{const v=C.hasBatchedChange("startDate")?C.get("startDate"):C.startDate;return v&&!(R.clearTime(v)-r)}:l?g.dateFilter=C=>{const v=C.hasBatchedChange("startDate")?C.get("startDate"):C.startDate,S=C.hasBatchedChange("endDate")?C.get("endDate"):C.endDate||v,b=!(v-S);return v&&(b?R.betweenLesserEqual(v,r,i):R.intersectSpans(v,S,r,i))}:g.dateFilter=C=>{const v=C.hasBatchedChange("startDate")?C.get("startDate"):C.startDate,S=C.hasBatchedChange("endDate")?C.get("endDate"):C.endDate||v;return v&&v>=r&&S<=i});const E={startDate:r,endDate:i};return f.processConfiguredListeners(),f.trigger("loadDateRange",{old:p||{},new:_.clone(E),changed:!!(!p||p.startDate-E.startDate||p.endDate-E.endDate)}),f.lastDateRange=_.clone(E),u?f.getEventsAsMap(g):f.getEventsAsArray(g)}getEventsAsArray({filter:t,date:s,resourceRecord:r,startDate:i=s,endDate:a,startOnly:o,includeOccurrences:l=!0,dayTime:c=null,dateFilter:u,storeFilterFn:d,getDateIndex:h}){const f=this,g=[];if(d?f.count:f.allCount){let m=r?f.getEventsForResource(r):null;if(!r){const y=f.useDayIndex(c),D=new Set,E=o?"startDate":"date";f.recurringEvents.forEach(C=>{y.dayTime.startOfDay(C.startDate)<=i&&D.add(C)});for(const C=new Date(i);C<a;C.setDate(C.getDate()+1)){const v=y.get(h?h(C):E,C);v==null||v.forEach(S=>D.add(S))}m=[...D]}d&&(m=m.filter(d));for(let y=0,{length:D}=m;y<D;y++){const E=m[y];l&&E.isRecurring?g.push.apply(g,E.getOccurrencesForDateRange(i,a).filter(u)):u(E)&&g.push(E)}}return t?g.filter(t):g}getEventsAsMap({filter:t,date:s,resourceRecord:r,startDate:i=s,endDate:a,startOnly:o,includeOccurrences:l=!0,dateMap:c,dayTime:u=null,storeFilterFn:d,getDateIndex:h}){var f;const g=this;if(c!=null&&c.clear?c.clear():c=new Map,g.count){const p=g.useDayIndex(u),m=o?"startDate":"date",y=[],D=C=>(!t||t(C))&&(!d||d(C)),E=C=>uy(C)&&D(C);if(u=p.dayTime,r)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");(f=g.recurringEvents)==null||f.forEach(C=>{u.startOfDay(C.startDate)<a&&y.push(C)});for(const C=new Date(i);C<a;C.setDate(C.getDate()+1)){let[v,S]=p.get(h?h(C):m,C,!0);v!=null&&v.size&&(v=[...v].filter(E),v.length&&(c.get(S)||c.set(S,[]).get(S)).push(...v))}for(let C=0,{length:v}=y;C<v;C++){const S=y[C],b=(l?S.getOccurrencesForDateRange(i,a):[S]).filter(D),w=R.add(a,1,"day");for(let M,I=0,{length:A}=b;I<A;I++){const T=b[I],k=u.startOfDay(T.startDate),Z=h?h(k):o?"startDate":"date",z=Z==="startDate"||!T.durationMS?R.add(k,1,"day"):R.min(T.endDate||R.add(T.startDate,T.duration,T.durationUnit),w);for(;k<z;k.setDate(k.getDate()+1)){const re=u.dateKey(k);(M=c.get(re))||c.set(re,M=[]),M.push(T)}}}}return c}},F(n,"$name","GetEventsMixin"),n},Ki=60*1e3,Wr=60*Ki,Qt=24*Wr,dy=/(\d+)?:?(\d*)/,$e=class{static format(e){const n=Math.floor(e/Wr),t=Math.floor(e/Ki)%60;return`${n}:${t<10?"0":""}${t}`}static parse(e){const n=typeof e;if(n==="string"){const t=dy.exec(e);e=Number(t[1]||0)*Wr+Number(t[2]||0)*Ki}else n!=="number"?e=R.getTimeOfDay(e):e<=24&&(e*=Wr);return Math.min(Math.max(Math.floor(e),0),Qt)}constructor(e){let n=0,t,s;e!=null&&e.isDayView?(n=e.dayStartShift,t=e.dayStartTime,s=e.dayEndTime):typeof e=="number"?n=t=s=e:e&&(n=e.startShift,t=e.timeStart,s=e.timeEnd),this.startShift=n=$e.parse(n||0),this.timeEnd=(s==null?(n+Qt)%Qt:$e.parse(s))||Qt,this.timeStart=t==null?n:$e.parse(t)}get startHour(){return Math.floor(this.timeStart/Wr)}get endHour(){return Math.floor(this.timeEnd/Wr)}get startTimeOffsetMs(){const{startShift:e,timeStart:n}=this;return n<e?Qt-e+n:n-e}get today(){return this.startOfDay(new Date)}ceil(e){const n=this.startOfDay(e);return n<e&&n.setDate(n.getDate()+1),n}contains(e){return!this.outside(e)}dateKey(e){return e=this.shiftDate(e,-1),R.makeKey(e)}dayOfDate(e){return this.shiftDate(R.clearTime(e))}dayOfWeek(e){return e=this.shiftDate(e,-1),e.getDay()}delta(e,n="ms"){const{timeStart:t}=this,s=$e.parse(e),r=(this.startShift&&s<t?s+Qt:s)-t;return n==="ms"?r:R.as(n,r,"ms")}duration(e="ms"){const{timeStart:n,timeEnd:t}=this,s=n<t?t-n:Qt-n+t;return e==="ms"?s:R.as(e,s,"ms")}equals(e){return this.startShift===(e==null?void 0:e.startShift)&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}intersects(e,n){const t=this,{timeStart:s,timeEnd:r}=t,[i,a]=t._dateRangeArgs(e,n),[o,l]=t.timeRange(i,a);return s<r?o<l?o<r&&s<=l:o<r||s<=l:!(o<l)||o<r||s<=l}isIntraDay(e,n){const t=this,[s,r]=t._dateRangeArgs(e,n),i=t.startOfDay(s),a=Qt-R.diff(i,r,"ms");return a<0?!1:a>0||i<s}isInterDay(e){return e.allDay||!this.isIntraDay(...arguments)}outside(e){const{startShift:n,timeStart:t,timeEnd:s}=this,r=$e.parse(e);return t<s?r<t?r<n?1:-1:r<s?0:r<n?-1:1:r<s||r>=t?0:r<n?1:-1}parseKey(e){return this.dayOfDate(R.parseKey(e))}shiftDate(e,n=1){const{startShift:t}=this,s=typeof e;return e=s==="number"?new Date(e):s==="string"?R.parse(e):new Date(e.getTime()),n&&t&&e.setMilliseconds(n>0?t:-t),e}sortEvents(e,n){const t=this.startOfDay(e);return n==null?void 0:n.sort((s,r)=>{s=s.eventRecord||s,r=r.eventRecord||r;let{startDate:i}=s,{startDate:a}=r;return i?a?(i=i<t?t:i,a=a<t?t:a,i-a||r.endDate-a-(s.endDate-i)):1:-1})}startOfDay(e){return e=this.shiftDate(e,-1),e=R.clearTime(e),e=this.shiftDate(e),e}timeRange(e,n){const[t,s]=this._dateRangeArgs(e,n);return[R.getTimeOfDay(t),R.getTimeOfDay(s)]}toString(){const{startShift:e,timeEnd:n,timeStart:t}=this,s=e?`@${$e.format(e)}`:"",r=$e.format(t);return t===n?e?s:r:`${r}-${$e.format(n)}${s}`}_dateRangeArgs(e,n){return e.isModel?[e.startDate,e.endingDate]:[e,n]}};$e.MIDNIGHT=new $e({startShift:0,timeStart:0,timeEnd:24}),$e.MILLIS_PER_MINUTE=Ki,$e.MILLIS_PER_HOUR=Wr,$e.MILLIS_PER_DAY=Qt,$e._$name="DayTime";var Ji={date:"_dateIndex",startDate:"_startDateIndex"},ec=Object.values(Ji),xg=Object.freeze([]),{MILLIS_PER_DAY:Tg}=$e,tc=class{constructor(e,n){this.dayTime=n||$e.MIDNIGHT,this.store=e,this.users=[this.dayTime]}add(e,n,t){const s=this[Ji[e]],r=this.dayTime.dateKey(n);(s[r]||(s[r]=new Set)).add(t)}addEvent(e){var n,t,s;let r=(n=this.dayTime.startOfDay(e.startDate))==null?void 0:n.getTime(),i;if(r){i=(s=(t=e.endDate)==null?void 0:t.getTime())!=null?s:r,this.add("startDate",r,e);do this.add("date",r,e),r+=Tg;while(r<i)}}clear(){ec.forEach(e=>this[e]=Object.create(null))}get(e,n,t){!this.initialized&&this.initialize();let s=this[Ji[e]],r;return n&&(r=this.dayTime.dateKey(n),s=t?[s[r],r]:s[r]),s}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,ec.forEach(e=>this[e]=null)}matches(e){return this.dayTime.startShift===e.startShift}remove(e,n,t){const s=this[Ji[e]],r=this.dayTime.dateKey(n),i=s[r];i&&i.delete(t)}removeEvent(e,n,t){var s,r;let i=(s=this.dayTime.startOfDay(n))==null?void 0:s.getTime(),a;if(i){a=(r=t==null?void 0:t.getTime())!=null?r:i,this.remove("startDate",i,e);do this.remove("date",i,e),i+=Tg;while(i<a)}}sync(e,n,t,s,r){var i,a;n=n||xg,t=t||xg;const o=this,l=n.length,c=t.length,u=s==null?void 0:s.length;let d,h,f;if(o.initialized)switch(e){case"clear":o.clear();break;case"splice":if(u)for(n=n.slice(),t=t.slice(),d=0;d<u;d++)t.push(s[d][0]),n.push(s[d][1]);if(c)for(d=0;d<c;d++)f=t[d],o.removeEvent(f,f.startDate,f.endDate);if(l)for(d=0;d<l;d++)h=n[d],h.isScheduled&&!h.isParent&&o.addEvent(h);break;case"reschedule":f=n[0],o.removeEvent(f,((i=r.startDate)==null?void 0:i.oldValue)||f.startDate,((a=r.endDate)==null?void 0:a.oldValue)||f.endDate),o.sync("splice",n);break}}register(e){this.users.push(e)}unregister(e){const{users:n}=this,t=n.indexOf(e);return t>-1&&n.splice(t,1),!n.length}},Og=tc.prototype;ec.forEach(e=>Og[e]=null),Og.initialized=!1,tc._$name="EventDayIndex";var{MIDNIGHT:Ag}=$e,rc=e=>{var n;return n=class extends e{construct(t){super.construct(t),this.dayIndices=null}afterLoadData(){var t;this.syncIndices("splice",this.storage.allValues),(t=super.afterLoadData)==null||t.call(this)}onDataChange({action:t,added:s,removed:r,replaced:i}){this.syncIndices(t,s,r,i),super.onDataChange(...arguments)}onDataReplaced(t,s){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(t,s)}onModelChange(t,s,r,i,a){("startDate"in r||"endDate"in r)&&this.syncIndices("reschedule",[t],null,null,r),super.onModelChange(...arguments)}invalidateDayIndices(){var t;(t=this.dayIndices)==null||t.forEach(s=>s.invalidate())}registerDayIndex(t){const s=this,r=s.dayIndices||(s.dayIndices=[]);let i,a;for(a=0;!i&&a<r.length;++a)r[a].matches(t)&&(i=r[a]).register(t);return!i&&r.push(i=new tc(s,t)),i}syncIndices(...t){var s;(s=this.dayIndices)==null||s.forEach(r=>r.sync(...t))}unregisterDayIndex(t){const s=this,{dayIndices:r}=s;for(let i=r==null?void 0:r.length;i-- >0;)if(r[i].matches(t)){r[i].unregister(t)&&r.splice(i,1);break}}useDayIndex(t){const s=this,{dayIndices:r}=s;t=t||Ag;for(let i=0;r&&i<r.length;++i)if(r[i].matches(t))return r[i];if(t.startShift)throw new Error(`No day index registered for ${t} on ${s.id}`);return s.registerDayIndex(Ag)}},F(n,"$name","DayIndexMixin"),n},nc=e=>class extends Jl(e||$){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(t){return super.isEventPersistable(t)&&(!t.supportsRecurring||!t.isOccurrence)}},hy=1e3*60*60*24,Qi=e=>class extends e{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resourceIds",type:"array",persist:!1,internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0,useProp:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach(t=>{t.eventId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentEventIds()}get resources(){return this.assignments.reduce((t,{resource:s})=>(s&&t.push(s.$original),t),[])}set resources(t){var s;t=W.asArray(t);const r=this,i=t.map(r.constructor.asId);if(r.usesSingleAssignment)r.set("resourceId",i[0]);else if((s=r.fieldMap)!=null&&s.resourceIds.persist)r.resourceIds=i;else{const a=r.assignments.map(c=>c.resource.id),{onlyInA:o,onlyInB:l}=W.delta(i,a);r.assignmentStore.add(o.map(c=>({resource:c,event:r}))),r.assignmentStore.remove(l.map(c=>r.assignments.find(u=>u.resource.id===c)))}}forEachResource(t,s=this){for(const r of this.resources)if(t.call(s,r)===!1)return}getResource(t){return t==null?this.resource:this.resourceStore?this.resourceStore.getById(t):null}get startDate(){var t;let s;return this.isOccurrence?s=this.get("startDate"):s=(t=this._startDate)!=null?t:super.startDate,this.allDay&&(s=this.constructor.getAllDayStartDate(s)),s}set startDate(t){this.batching?(this._startDate=t,this.set({startDate:t})):super.startDate=t}get endDate(){var t;let s;return this.isOccurrence?s=this.get("endDate"):s=(t=this._endDate)!=null?t:super.endDate,this.allDay&&(s=this.constructor.getAllDayEndDate(s)),s}set endDate(t){this.batching?(this._endDate=t,this.set({endDate:t})):super.endDate=t}get wrapStartDate(){return this.startDate}set wrapStartDate(t){}get wrapEndDate(){return this.endDate}set wrapEndDate(t){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(){const t=this,{isPersistable:s,meta:{batchChanges:r}}=t;if(r&&("endDate"in r&&(delete t._endDate,t.postamble&&(t.wrapEndDate=null)),"startDate"in r&&(delete t._startDate,t.preamble&&(t.wrapStartDate=null))),super.endBatch(...arguments),t.isPersistable&&!s&&!t.ignoreBag&&t.assigned)for(const i of t.assigned)i.stores.forEach(a=>a.updateModifiedBagForRecord(i))}get isCreating(){return super.isCreating}set isCreating(t){var s,r;super.isCreating=t,(s=this.assignmentStore)==null||s.suspendAutoCommit(),this.assignments.forEach(i=>i.isCreating=t),(r=this.assignmentStore)==null||r.resumeAutoCommit()}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...t){const s=super.copy(...t);return this.usesSingleAssignment||(s.resourceId=null),s}get persistableData(){const t=super.persistableData;return this.usesSingleAssignment||delete t.resourceId,t}get resource(){const{resources:t}=this;return t.length?t[0]:null}set resource(t){this.resourceId=this.constructor.asId(t)}get resourceId(){var t;return this.usesSingleAssignment?this.get("resourceId"):(t=this.resource)==null?void 0:t.id}set resourceId(t){this.applyResourceId(t)}get resourceIds(){var t,s,r;return(t=this.fieldMap)!=null&&t.resourceIds.persist?this.get("resourceIds"):(r=(s=this.resources)==null?void 0:s.map(i=>i.id))!=null?r:[]}set resourceIds(t){this.set("resourceIds",t)}get $linkedResources(){var t,s;return(s=(t=this.resources)==null?void 0:t.flatMap(r=>[r,...r.$links]))!=null?s:[]}applyResourceId(t,s=!1){var r,i;const a=this,{eventStore:o,assignments:l}=a;if(o){const c=o.assignmentStore||((r=o.crudManager)==null?void 0:r.assignmentStore);if(t!=null)if(a.meta.skipEnforcingSingleAssignment||(o.usesSingleAssignment=!0),l!=null&&l.length&&t!==l[0].resourceId){const u=!!o.eventsSuspended;u&&c.suspendEvents(),l[0].resource=t,u&&c.resumeEvents()}else c.assignEventToResource(a,t);else(a.usesSingleAssignment||(i=a.resourceIds)!=null&&i.length)&&c.remove(l)}else s||a.set({resourceId:t})}applyResourceIds(t,s=!1){var r;const i=this,{eventStore:a,assignments:o}=i;if(i.fieldMap.resourceIds.persist===!1)return!1;if(t=[...new Set(t)],a){const l=a.assignmentStore||((r=a.crudManager)==null?void 0:r.assignmentStore);if(t!=null&&t.length)if(o!=null&&o.length){const c=!!a.eventsSuspended;c&&l.suspendEvents(),o.forEach(h=>{const f=t.find(g=>!o.some(p=>p.resourceId===g));f&&(h.resource=f)});const{onlyInA:u,onlyInB:d}=W.delta(t,o.map(h=>h.resourceId));l.add(u.map(h=>({resource:h,event:i}))),l.remove(d.map(h=>o.find(f=>f.resource.id===h))),c&&l.resumeEvents()}else l.add(t.map(c=>({resource:c,event:i})));else l.remove(o)}else s||i.set({resourceIds:t})}applyValue(t,s,r,i,a){if(a&&!this.meta.isAssigning){const{eventStore:o}=this;switch(a.name){case"resourceId":o&&(o.isAssigning=!0),this.applyResourceId(r,!0);break;case"resourceIds":o&&(o.isAssigning=!0),this.applyResourceIds(r,!0);break}o&&(o.isAssigning=!1)}super.applyValue(t,s,r,i,a)}get assignments(){return[...this.assigned||[]]}assign(t,s=!1){const{eventStore:r}=this;r&&!r.usesSingleAssignment?r.assignEventToResource(this,t,s):(this.resourceId=this.constructor.asId(t),r||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(t,s=!1){var r;const i=this;t=i.constructor.asId(t),i.meta.removingResource=s,(r=i.eventStore)==null||r.unassignEventFromResource(i,t),i.meta.removingResource=null}reassign(t,s){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,t,s)}isAssignedTo(t){const s=this.constructor.asId(t);return this.assignments.some(r=>r.resourceId===s)}get predecessors(){var t;return[...(t=this.incomingDeps)!=null?t:[]]}get successors(){var t;return[...(t=this.outgoingDeps)!=null?t:[]]}get dependencies(){var t,s;return[...(t=this.incomingDeps)!=null?t:[],...(s=this.outgoingDeps)!=null?s:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:t}=this;if(t>=hy||!t&&this.allDay)return!0;const{endDate:s,startDate:r}=this,i=R.clearTime(r);if(r&&s)return i.setDate(i.getDate()+1),(s||R.add(r,t))>i}static getAllDayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),t&&(t=R.clearTime(t,!0)),t}static getAllDayEndDate(t){return t&&t.isEvent&&(t=t.get("endDate")),t&&(t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0||t.getMilliseconds()>0)&&(t=R.getNext(t,"d",1)),t}static getAllDayDisplayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),R.clearTime(t,!0)}static getAllDayDisplayEndDate(t,s){return t&&t.isEvent&&(s=t.get("endDate"),t=t.get("startDate")),s&&(t=this.constructor.getAllDayDisplayStartDate(t),R.clearTime(s,!0).valueOf()===s.valueOf()?s=R.add(s,R.DAY,-1):t.valueOf()!==s.valueOf()&&(s=R.clearTime(s,!0))),s}isEditable(t){switch(t){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(t)}},fy=Ui,Ds=class extends fy.derive(lt).mixin(qi,Jt,Qi){static get $name(){return"EventModel"}};Ds.exposeProperties(),Ds._$name="EventModel";var gy=Jt(kl.derive(We)),Zi=class extends gy.mixin(nc,Xl,rc,Yi){static get defaultConfig(){return{modelClass:Ds}}};F(Zi,"$name","EventStore"),Zi._$name="EventStore";var sc=e=>class extends(e||$){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(t){if(super.construct(t),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const t=super.removeAll(...arguments);return t&&this.assignmentStore.removeAll(),t}onRecordIdChange({record:t,oldValue:s,value:r}){super.onRecordIdChange({record:t,oldValue:s,value:r}),t.isFieldModified("id")&&(this.isChangingId=!0,t.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:t,endDate:s}){return this.query(r=>this.eventStore.isDateRangeAvailable(t,s,null,r))}},ic=e=>class extends e{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image",{name:"resourceMargin",type:"number"},{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach(t=>{t.resourceId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce((t,s)=>(s.event&&t.push(s.event),t),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(t){t.forEach(s=>{s.resource=this})}getEvents(){return Se.deprecate("scheduler","6.0.0","getEvents() is deprecated, use the events property instead"),this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:t=""}=this;if(!t)return"";const s=t.split(" "),r=s[0][0],i=s.length>1?s[s.length-1][0]:"";return r+i}isWorkingTime(t){var s,r;const i=this.effectiveCalendar||((s=this.project)==null?void 0:s.calendar);return!i||((r=i.isWorkingTime)==null?void 0:r.call(i,t))}},py=Sn,Cn=class extends ic(Jt(py.derive(vs))){};F(Cn,"$name","ResourceModel"),Cn.exposeProperties(),Cn._$name="ResourceModel";var my=Jt(Ll.derive(We)),ac=class extends sc(my){static get defaultConfig(){return{modelClass:Cn}}};ac._$name="ResourceStore";var vy=["SS","SF","FS","FF"],St=class extends H{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(e){const n=e[this.fieldMap.from.dataSource],t=e[this.fieldMap.to.dataSource];n!=null&&(e.fromEvent=n),t!=null&&(e.toEvent=t),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||((e=this.unjoinedStores[0])==null?void 0:e.eventStore)}set from(e){const{fromEvent:n}=this;n!=null&&n.isModel&&n.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:n}=this;n!=null&&n.isModel&&n.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let n;return e!==this.hardType&&(n=this.set({type:e,fromSide:null,toSide:null})),n}get lag(){return this.get("lag")}set lag(e){this.setLag(e)}setLag(e,n=this.lagUnit){if(arguments.length===1){typeof e=="number"?this.lag=e:(e=R.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}));return}e=parseFloat(e),this.set({lag:e,lagUnit:n})}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${R.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new xe({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){typeof e=="string"?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:n,unjoinedStores:t}=e,s=n[0];let r;if(s){const{fromEvent:i,toEvent:a}=e,o=s.crudManager;r=i&&(o||!i.hasGeneratedId)&&a&&(o||!a.hasGeneratedId)}else r=!!t[0];return r&&super.isPersistable}getDateRange(){const{fromEvent:e,toEvent:n}=this;if(e!=null&&e.isScheduled&&(n!=null&&n.isScheduled)){const t=St.Type;let s,r;switch(this.type){case t.StartToStart:s=e.startDateMS,r=n.startDateMS;break;case t.StartToEnd:s=e.startDateMS,r=n.endDateMS;break;case t.EndToEnd:s=e.endDateMS,r=n.endDateMS;break;case t.EndToStart:s=e.endDateMS,r=n.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(s,r),end:Math.max(s,r)}}return null}highlight(e){var n,t;const s=(t=(n=this.highlighted)==null?void 0:n.split(" "))!=null?t:[];s.includes(e)||(this.highlighted=s.concat(e).join(" "))}unhighlight(e){const{highlighted:n}=this;if(n){const t=n.split(" "),s=t.indexOf(e);s>=0&&(t.splice(s,1),this.highlighted=t.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const n=vy[this.type];return e?n:this.type===St.Type.EndToStart?"":n}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:e,toEvent:n,type:t}=this;return typeof t=="number"&&e&&n&&e!==n}get fromEventName(){var e;return((e=this.fromEvent)==null?void 0:e.name)||""}get toEventName(){var e;return((e=this.toEvent)==null?void 0:e.name)||""}shouldRecordFieldChange(e,n,t){var s;if(!super.shouldRecordFieldChange(e,n,t))return!1;if(e==="from"||e==="to"||e==="fromEvent"||e==="toEvent"){const r=(s=this.project)==null?void 0:s.eventStore;if(r&&r.oldIdMap[n]===r.getById(t))return!1}return!0}};St.exposeProperties(),St._$name="DependencyBaseModel";var yy=Vi,Cs=class extends Jt(yy.derive(St)){static get $name(){return"DependencyModel"}getTypeFromSides(e,n,t){const s=St.Type,r=t?"right":"left",i=t?"left":"right";return e===r?n===r?s.StartToStart:s.StartToEnd:n===i?s.EndToEnd:s.EndToStart}};Cs.exposeProperties(),Cs._$name="DependencyModel";var oc=e=>class extends e{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(t,s,r,i=!0,a){return a=a||(o=>this.getEventDependencies(o)),t=W.asArray(t),t.reduce((o,l)=>{l.children&&!i?l.traverse(c=>{o=a(c).reduce(s,o)}):o=a(l).reduce(s,o)},r),r}mapEventDependencies(t,s,r,i,a){return this.reduceEventDependencies(t,(o,l)=>(r(l)&&o.push(l),o),[],i,a)}mapEventPredecessors(t,s,r,i){return this.reduceEventPredecessors(t,(a,o)=>(r(o)&&a.push(o),a),[],i)}mapEventSuccessors(t,s,r,i){return this.reduceEventSuccessors(t,(a,o)=>(r(o)&&a.push(o),a),[],i)}getEventDependencies(t){return[].concat(t.predecessors||[],t.successors||[])}removeEventDependencies(t){this.remove(this.getEventDependencies(t))}removeEventPredecessors(t){this.remove(t.predecessors)}removeEventSuccessors(t,s){this.remove(t.successors)}getBySourceTargetId(t){return this.records.find(s=>t==this.constructor.makeDependencySourceTargetCompositeKey(s.from,s.to))}getDependencyForSourceAndTargetEvents(t,s){return t=H.asId(t),s=H.asId(s),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(t,s))}getEventsLinkingDependency(t,s){return this.getDependencyForSourceAndTargetEvents(t,s)||this.getDependencyForSourceAndTargetEvents(s,t)}async isValidDependency(t,s,r){let i=t,a=s;return t==null?!1:(t.isDependencyModel&&({fromEvent:i,toEvent:a}=t),i=this.eventStore.getById(i),a=this.eventStore.getById(a),i&&a?!i.project||!a.project?!1:this.project.isValidDependency(i,a,r):t!==s)}isValidDependencyToCreate(t,s,r){return this.isValidDependency(t,s,r)}getHighlightedDependencies(t){return this.records.reduce((s,r)=>(r.isHighlightedWith(t)&&s.push(r),s),[])}static makeDependencySourceTargetCompositeKey(t,s){return`source(${t})-target(${s})`}getTimeSpanDependencies(t){return this.getEventDependencies(t)}},Sy=Jt(jl.derive(We)),lc=class extends oc(Sy.derive(We)){static get defaultConfig(){return{modelClass:Cs}}};lc._$name="DependencyStore";var $g=e=>class extends(e||$).mixin(Nl,Eg,bg){static get defaultConfig(){return{project:null}}startConfigure(t){this.getConfig("project"),super.startConfigure(t),this._changesToClear=new Map}async doAutoLoad(){const{project:t}=this;return t&&await t.commitAsync(),super.doAutoLoad()}applyProjectResponse(t){const s=this,{project:r}=s;s.applyingProjectResponse=!0;const i=r.fieldMap.startDate,a=r.fieldMap.endDate,o=x.getPath(t,i.dataSource),l=x.getPath(t,a.dataSource);typeof o=="string"&&x.setPath(t,i.dataSource,i.convert(o)),typeof l=="string"&&x.setPath(t,a.dataSource,a.convert(l)),Object.assign(r,t),s._changesToClear.set(s,t),s.applyingProjectResponse=!1}loadCrudManagerData(t,s={}){const r=this,{project:i}=r;r.suspendChangesTracking(),super.loadCrudManagerData(...arguments),t!=null&&t.project&&(i.delayEnteringReplica?i.ion({recordsUnlinked:()=>{r.suspendChangesTracking(),r.applyProjectResponse(t.project),r.resumeChangesTracking()},once:!0}):r.applyProjectResponse(t.project)),r.resumeChangesTracking()}async sync(){const{project:t}=this;if(this.suspendAutoSync(),t&&await t.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(t,s,r){var i,a,o,l,c,u;const d=this;if(!(d.isDestroyed||(i=d.project)!=null&&i.isDestroyed)){if(d.trigger("beforeApplyResponse"),await super.applyResponse(t,s,r),(s!=null&&s.project||d.supportShortSyncResponse&&((a=t==null?void 0:t.pack)!=null&&a.project))&&d.applyProjectResponse(s.project||((o=t==null?void 0:t.pack)==null?void 0:o.project)),d.project){let h=t.type;d.trackResponseType&&(h=s.type||h);const f=`propagating${U.capitalize(h)}Changes`;d.suspendAutoSync(),d[f]=!0;const g=d.project.isInitialCommit&&!d.project.silenceInitialCommit;await d.project.commitAsync(),d[f]=!1,(l=d.resumeAutoSync)==null||l.call(d,g),(c=d.commitRespondedChanges)==null||c.call(d)}(u=d.trigger)==null||u.call(d,"applyResponse")}}applySyncResponse(...t){var s;const r=this,i=(s=r.project)==null?void 0:s.stm.disabled;i===!1&&r.ignoreRemoteChangesInSTM&&r.project.stm.disable(),super.applySyncResponse(...t),i===!1&&r.project.stm.enable()}shouldClearRecordFieldChange(t,s,r){const i=t.getValue(s);return s=t.getFieldDefinition(s),s!=null&&s.isEqual?s.isEqual(i,r):x.isEqual(i,r)}commitRespondedChanges(){this._changesToClear.forEach((t,s)=>{Object.entries(t).forEach(([r,i])=>{this.shouldClearRecordFieldChange(s,r,i)&&delete s.meta.modified[r]})}),this._changesToClear.clear()}applyChangesToStore(t,s,r,...i){const a=super.applyChangesToStore(t,s,r,...i);if(a.size&&this.project)for(const[o,l]of a){const c=t.store.getById(o);c&&this._changesToClear.set(c,l)}return a}},_g=e=>{var n;return n=class extends(e||H){static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null}}get assignments(){return this.assignmentStore.allRecords}updateAssignments(t){this.assignmentStore.data=t}get dependencies(){return this.dependencyStore.allRecords}updateDependencies(t){this.dependencyStore.data=t}get resources(){return this.resourceStore.allRecords}updateResources(t){this.resourceStore.data=t}get timeRanges(){return this.timeRangeStore.allRecords}getTimeRanges(t,s){const r=this.timeRangeStore,i=[];for(const a of r)a.isRecurring?i.push(...a.getOccurrencesForDateRange(t,s)):a.startDate<s&&t<a.endDate&&i.push(a);return i}updateTimeRanges(t){this.timeRangeStore.data=t}getResourceTimeRanges(t,s){const r=this.resourceTimeRangeStore,i=[];for(const a of r)a.isRecurring?i.push(...a.getOccurrencesForDateRange(t,s)):a.startDate<s&&t<a.endDate&&i.push(a);return i}},F(n,"$name","ProjectModelCommon"),n},cc=e=>{var n;return n=class extends(e||H){get _storesWithDates(){return[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore].filter(t=>t)}overrideStoreProcessRecord(t){this._storesWithDates.includes(t)&&!t.$originalProcessRecord&&(t.$originalProcessRecord=Et.before(t,"processRecord",(s,r)=>{(r||t.isLoadingData)&&this.convertRecordToTimeZone(s)}))}attachStore(t){super.attachStore(t),t&&this.timeZone!=null&&this._storesWithDates.includes(t)&&(this.convertStoresToTimeZone([t]),this.overrideStoreProcessRecord())}detachStore(t){if(super.detachStore(t),t&&!t.isDestroyed){const{$originalProcessRecord:s}=t;s&&(s(),t.$originalProcessRecord=null,this.convertStoresToTimeZone([t],null))}}relayStoreChange({source:t,action:s,records:r,replaced:i}){const a=this;a.timeZone!=null&&a._storesWithDates.includes(t)&&["add","replace"].includes(s)&&(!(r!=null&&r.length)&&(i!=null&&i.length)&&(r=i),r.length&&r.forEach(o=>o.timeZone=a.timeZone))}convertStoresToTimeZone(t,s=this.timeZone){var r;const i=this,a=(r=i.stm)==null?void 0:r.autoRecord;a&&(i.stm.autoRecord=!1);for(const o of t)o==null||o.forEach(l=>i.convertRecordToTimeZone(l,s));a&&(i.stmAutoRecord=a)}convertRecordToTimeZone(t,s=this.timeZone){var r;if(t.timeZone!==s){if(t.$ignoreChange=!0,(r=t.baselines)!=null&&r.count)for(const i of t.baselines)t.timeZone!==i.timeZone&&(i.timeZone=t.timeZone),i.convertToTimeZone(s);t.convertToTimeZone(s),t.$ignoreChange=!1}}updateTimeZone(t,s){const r=this,i=r._isConfiguringTimeZone||r.isConfiguring;if(r.trigger("beforeTimeZoneChange",{timeZone:t,oldTimeZone:s,isConfiguring:i}),r.calendarManagerStore.forEach(a=>a.bumpVersion()),r.convertStoresToTimeZone(r._storesWithDates),r._storesWithDates.forEach(a=>r.overrideStoreProcessRecord(a)),r.startDate){const a=s!=null?vt.fromTimeZone(r.startDate,s):r.startDate;r.startDate=t!=null?vt.toTimeZone(a,t):a}r.ignoreRecordChanges=!0,r.commitAsync().then(()=>{r.isDestroyed||r.trigger("timeZoneChange",{timeZone:t,oldTimeZone:s,isConfiguring:i}),delete r._isConfiguringTimeZone})}},F(n,"$name","ProjectModelTimeZoneMixin"),F(n,"configurable",{timeZone:{$config:"lazy",value:null}}),n},uc=e=>{var n;return n=class extends(e||H).mixin(_g,cc){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:lt,resourceTimeRangeModelClass:Sr,timeRangeStoreClass:K,resourceTimeRangeStoreClass:Gi,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null}}get inlineData(){return U.safeJsonParse(super.json)}set inlineData(t){this.json=t}construct(t={}){super.construct(...arguments),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const t=this;!t.timeRangeStore.stm&&t.stm.addStore(t.timeRangeStore),!t.resourceTimeRangeStore.stm&&t.stm.addStore(t.resourceTimeRangeStore)}attachStore(t){t&&t.ion({name:t.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(t)}detachStore(t){t&&(this.detachListeners(t.$$name),super.detachStore(t))}relayStoreChange(t){return super.relayStoreChange(t),this.trigger("change",{store:t.source,...t,source:this})}updateTimeRangeStore(t,s){this.detachStore(s),this.attachStore(t)}setTimeRangeStore(t){this.timeRangeStore=t}changeTimeRangeStore(t){return t&&!t.isStore&&(t=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},t)),t}updateResourceTimeRangeStore(t,s){this.detachStore(s),this.attachStore(t)}changeResourceTimeRangeStore(t){return t&&!t.isStore&&(t=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},t)),t}setResourceTimeRangeStore(t){this.resourceTimeRangeStore=t}get events(){return this.eventStore.allRecords}updateEvents(t){this.eventStore.data=t}get resourceTimeRanges(){return this.resourceTimeRangeStore.allRecords}updateResourceTimeRanges(t){this.resourceTimeRangeStore.data=t}async loadInlineData(t){return this.isLoadingInlineData=!0,t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),super.loadInlineData(t)}toJSON(){const t=this,s={eventsData:t.eventStore.toJSON(),resourcesData:t.resourceStore.toJSON(),dependenciesData:t.dependencyStore.toJSON(),timeRangesData:t.timeRangeStore.toJSON(),resourceTimeRangesData:t.resourceTimeRangeStore.toJSON()};return t.eventStore.usesSingleAssignment||(s.assignmentsData=t.assignmentStore.toJSON()),s}get json(){return super.json}changeJson(t){return typeof t=="string"&&(t=U.safeJsonParse(t)),t}updateJson(t){t&&this.loadInlineData(t)}afterChange(t,s){super.afterChange(...arguments),s.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},F(n,"configurable",{json:null,timeRangeStore:{value:{id:"timeRanges",modelClass:lt},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),n},Fg=e=>class extends e{getCurrentConfig(t){const s=this,r=super.getCurrentConfig(t);if(r){for(const i of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const a=s[i];if(a){a.count&&(r[a.id+"Data"]=a.getInlineData(t));const o=a.getCurrentConfig(t);o&&Object.keys(o).length>0?r[i]=Object.assign(r[i]||{},o):r[i]&&Object.keys(r[i]).length===0&&delete r[i]}}return r.timeRangeStore&&((s.timeRangeStore.originalModelClass===s.timeRangeModelClass||s.timeRangeStore.originalModelClass.$name==="TimeSpan")&&delete r.timeRangeStore.modelClass,r.timeRangeStore.storeId==="timeRanges"&&delete r.timeRangeStore.storeId,Object.keys(r.timeRangeStore).length===1&&delete r.timeRangeStore),s.taskStore.isTaskStore&&(delete r.eventModelClass,delete r.eventStoreClass,delete r.children),r}}},jg=class extends ${set eventStore(e){const n=this;n.eventStoreDetacher&&n.eventStoreDetacher(),n._eventStore=e,e&&e.autoCommit&&(n.eventStoreDetacher=e.ion({beforecommit:n.onEventStoreBeforeSync,thisObj:n,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const n=this;n.resourceStoreDetacher&&n.resourceStoreDetacher(),n._resourceStore=e,e&&e.autoCommit&&(n.resourceStoreDetacher=e.ion({beforecommit:n.onResourceStoreBeforeSync,thisObj:n,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const n=this;n.assignmentStoreDetacher&&n.assignmentStoreDetacher(),n._assignmentStore=e,e&&e.autoSync&&(n.assignmentStoreDetacher=e.ion({beforecommit:n.onAssignmentStoreBeforeSync,thisObj:n,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const n=this;n.dependencyStoreDetacher&&n.dependencyStoreDetacher(),n._dependencyStore=e,e&&e.autoSync&&(n.dependencyStoreDetacher=e.ion({beforecommit:n.onDependencyStoreBeforeSync,thisObj:n,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){const n=this;return n.removeNonPersistableRecordsToCreate(e),n.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){const n=this;return n.removeNonPersistableRecordsToCreate(e),n.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){const n=this;return n.removeNonPersistableRecordsToCreate(e),n.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){const n=this;return n.removeNonPersistableRecordsToCreate(e),n.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){const n=e.added||[];let t,s;for(s=n.length-1;s>=0;--s)t=n[s],t.isPersistable||n.splice(n.indexOf(t),1);n.length===0&&(e.added.length=0)}shallContinueSync(e){return!!(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}};jg._$name="ModelPersistencyManager";var Dy=gg,Xi=class extends Fg(uc(Dy)){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:Ds,dependencyModelClass:Cs,resourceModelClass:Cn,assignmentModelClass:Ss,eventStoreClass:Zi,dependencyStoreClass:lc,resourceStoreClass:ac,assignmentStoreClass:Hi}}construct(...e){super.construct(...e),Se.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new jg({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}};Xi.applyConfigs=!0,Xi.initClass(),Xi._$name="ProjectModel";var Es=(e,n)=>{if(e!==n)throw new Error("Store set is prohibited for Scheduler Pro entity!")},tt=e=>class extends(e||$){static get $name(){return"PartOfProject"}get taskStore(){return this.eventStore}set taskStore(t){this.eventStore=t}get eventStore(){var t;return(t=this.project)==null?void 0:t.eventStore}get leftProjectEventStore(){const t=this.leftProject;return(t==null?void 0:t.getEventStore())||null}set eventStore(t){Es(this.eventStore,t)}get dependencyStore(){var t;return(t=this.project)==null?void 0:t.dependencyStore}set dependencyStore(t){Es(this.dependencyStore,t)}get assignmentStore(){var t;return(t=this.project)==null?void 0:t.assignmentStore}set assignmentStore(t){Es(this.assignmentStore,t)}get resourceStore(){var t;return(t=this.project)==null?void 0:t.resourceStore}set resourceStore(t){Es(this.resourceStore,t)}get calendarManagerStore(){var t;return(t=this.project)==null?void 0:t.calendarManagerStore}set calendarManagerStore(t){Es(this.calendarManagerStore,t)}},zr=class extends tt(Ql(Pi.derive(H))){get event(){const{project:e}=this,n=super.event;return e!=null&&e.isDelayingCalculation?e.eventStore.getById(n):n}set event(e){super.event=e}get resource(){const{project:e}=this;let n=super.resource;return e!=null&&e.isDelayingCalculation&&(n=e.resourceStore.getById(n)),n==null?void 0:n.$original}set resource(e){super.resource=e}get eventResourceKey(){return this.isInActiveTransaction?this.buildEventResourceKey(this.event,this.resource):this.buildEventResourceKey(this.$.event.DATA,this.$.resource.DATA)}};F(zr,"$name","AssignmentModel"),F(zr,"isProAssignmentModel",!0),zr._$name="AssignmentModel";var bs=class extends tt(Zl(sl.derive(We))){static get defaultConfig(){return{modelClass:zr}}};F(bs,"$name","AssignmentStore"),bs._$name="AssignmentStore";var ea=class extends tt(Qn.derive(H)){static get $name(){return"CalendarIntervalModel"}};ea._$name="CalendarIntervalModel";var Rs=class extends tt(hn.derive(H)){static get $name(){return"CalendarModel"}static get fields(){return[{name:"expanded",internal:!0,defaultValue:!0},"ignoreTimeZone"]}toString(){return this.name||""}static get defaultConfig(){return{calendarIntervalModelClass:ea}}};Rs._$name="CalendarModel";var ta=class extends tt(al.derive(We)){static get defaultConfig(){return{tree:!0,modelClass:Rs,loadPriority:100,syncPriority:100,storeId:"calendars"}}};ta._$name="CalendarManagerStore";var Is=class extends tt(vl.derive(St)){static get $name(){return"DependencyModel"}static get isProDependencyModel(){return!0}get fromEvent(){var e;return(e=this.project)!=null&&e.isDelayingCalculation?this.project.eventStore.getById(super.fromEvent):super.fromEvent}set fromEvent(e){super.fromEvent=e}get toEvent(){var e;return(e=this.project)!=null&&e.isDelayingCalculation?this.project.eventStore.getById(super.toEvent):super.toEvent}set toEvent(e){super.toEvent=e}};Is._$name="DependencyModel";var ra=class extends tt(oc(ll.derive(We))){static get defaultConfig(){return{modelClass:Is}}};ra._$name="DependencyStore";var na=e=>class extends e{static get $name(){return"PercentDoneMixin"}get isStarted(){return this.percentDone>0}get isCompleted(){return this.percentDone>=100}get isInProgress(){return this.isStarted&&!this.isCompleted}copy(){const t=super.copy(...arguments);return t.percentDone=0,t.clearChanges(),t}get renderedPercentDone(){const t=typeof this.percentDone=="number"&&!isNaN(this.percentDone)?this.percentDone:0;return this.getFormattedPercentDone(t)}getFormattedPercentDone(t=0){return t<=99?Math.round(t):Math.floor(t)}set renderedPercentDone(t){this.percentDone=t}},sa=class extends El.derive(lt).mixin(Qi,na){static get $name(){return"EventSegmentModel"}get task(){return this.event}};sa._$name="EventSegmentModel";var Ps=class extends Oi.derive(lt).mixin(qi,tt,Qi,na){static get $name(){return"EventModel"}static get fields(){return[{name:"showInTimeline",type:"boolean",defaultValue:!1},"note",{name:"preamble",convert:e=>e?new xe(e):null},{name:"postamble",convert:e=>e?new xe(e):null}]}getDefaultSegmentModelClass(){return sa}updateWrapDate(e,n,t=!0){return n=new xe(n),new Date(e.getTime()+(t?1:-1)*n.milliseconds)}get startDate(){var e;let n;return this.isOccurrence?n=this.get("startDate"):n=(e=this._startDate)!=null?e:super.startDate,this.allDay&&(n=this.constructor.getAllDayStartDate(n)),n}set startDate(e){const n=this;if(n.generation&&n.isParent&&!n.$ignoreChange){const t=R.diff(n.startDate,e);if(t)for(const s of this.children)s.startDate=R.add(s.startDate,t)}n.batching?(n._startDate=e,n.set({startDate:e})):(super.startDate=e,n.preamble&&(n.wrapStartDate=null,n.wrapEndDate=null))}get endDate(){var e;let n;return this.isOccurrence?n=this.get("endDate"):n=(e=this._endDate)!=null?e:super.endDate,this.allDay&&(n=this.constructor.getAllDayEndDate(n)),n}set endDate(e){const n=this;n.batching?(n._endDate=e,n.set({endDate:e})):(super.endDate=e,n.postamble&&(n.wrapStartDate=null,n.wrapEndDate=null))}get fullEffort(){return new xe({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get wrapStartDate(){const e=this,{preamble:n,startDate:t}=e,s=e._wrapStartDate;let r;return s?r=s:n?(r=e.updateWrapDate(t,n,!1),e._wrapStartDate=r):r=t,r}set wrapStartDate(e){this._wrapStartDate=e}get wrapEndDate(){const e=this,{postamble:n,endDate:t}=e,s=e._wrapEndDate;let r;return s?r=s:n?(r=e.updateWrapDate(t,n,!0),e._wrapEndDate=r):r=t,r}set wrapEndDate(e){this._wrapEndDate=e}set(e){const n=typeof e=="object";return(e==="preamble"||n&&"preamble"in e)&&(this.wrapStartDate=null),(e==="postamble"||n&&"postamble"in e)&&(this.wrapEndDate=null),super.set(...arguments)}get outerStartDate(){return this.wrapStartDate}get outerEndDate(){return this.wrapEndDate}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":return!1;case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}get stm(){var e,n;return(n=(e=this.recurringEvent)==null?void 0:e.stm)!=null?n:super.stm}set stm(e){super.stm=e}get assigned(){const{project:e}=this,n=super.assigned;return e!=null&&e.isDelayingCalculation&&!n?e.assignmentStore.storage.findItem("event",this):n}set assigned(e){super.assigned=e}getCurrentConfig(e){const{segments:n}=this,t=super.getCurrentConfig(e);return t&&n&&(t.segments=n.map(s=>s.getCurrentConfig(e))),t}};F(Ps,"isProEventModel",!0),Ps._$name="EventModel";var ia=class extends tt(nc(Yi(rc(Xl(rs.derive(We)))))){static get defaultConfig(){return{modelClass:Ps}}};F(ia,"$name","EventStore"),ia._$name="EventStore";var ws=class extends tt(ic(Fi.derive(vs))){static get $name(){return"ResourceModel"}get assigned(){var e,n;const{project:t}=this;return(e=t==null?void 0:t.assignmentStore.storage._indices)!=null&&e.resource?(n=t.assignmentStore.storage.findItem("resource",this))!=null?n:new Set:super.assigned}set assigned(e){super.assigned=e}};ws._$name="ResourceModel";var aa=class extends tt(sc(ul.derive(We))){static get defaultConfig(){return{modelClass:ws}}};aa._$name="ResourceStore";var dc=e=>class extends(e||$).mixin($g){static get configurable(){return{crudLoadValidationWarningPrefix:"Project load response error(s):",crudSyncValidationWarningPrefix:"Project sync response error(s):",trackProjectModelChanges:!1}}construct(...t){const s=this;super.construct(...t),s.addPrioritizedStore(s.calendarManagerStore),s.addPrioritizedStore(s.assignmentStore),s.addPrioritizedStore(s.dependencyStore),s.addPrioritizedStore(s.resourceStore),s.addPrioritizedStore(s.eventStore),s.timeRangeStore&&s.addPrioritizedStore(s.timeRangeStore),s.resourceTimeRangeStore&&s.addPrioritizedStore(s.resourceTimeRangeStore)}get project(){return this}set project(t){super.project=t}get crudLoadValidationMandatoryStores(){return[this.getStoreDescriptor(this.eventStore).storeId]}loadCrudManagerData(...t){this.delayCalculation&&!this.isDelayingCalculation&&!this.usingSyncDataOnLoad()&&this.scheduleDelayedCalculation(),super.loadCrudManagerData(...t)}acceptChanges(){super.acceptChanges(),this.clearChanges(!0,!1)}revertChanges(){this.revertCrudStoreChanges(),this.set(this.meta.modified,void 0,!0)}crudStoreHasChanges(t){const s=this.getCrudStore(t);let r;return s?r=super.crudStoreHasChanges(s):r=this.hasPersistableChanges||super.crudStoreHasChanges(),r}get changes(){let t=super.changes;if(this.trackProjectModelChanges){const s=this.modificationDataToWrite;s&&(t=t||{},t.project=s)}return t}shouldClearRecordFieldChange(t,s,r){return t.isCalendarModel&&s==="intervals"?!t.get("intervals").changes:super.shouldClearRecordFieldChange(...arguments)}},hc=(e,n,t)=>{const s=t.getFieldDefinition(e),{dataSource:r}=s,i=t.constructor.processField(e,n[r],t);return r in n&&!s.isEqual(i,t.getValue(e))},fc=e=>class extends(e||$){startConfigure(t){this.getConfig("project"),super.startConfigure(t)}beforeApplyProjectChanges(){const{stm:t}=this;let s=!1,r=null;return this.suspendChangesTracking(),t.enabled&&(s=!0,t.isRecording&&(r=t.stash()),this.ignoreRemoteChangesInSTM?t.disable():t.startTransaction()),{shouldResume:s,transactionId:r}}async applyProjectChanges(t){var s,r;const i=this,{shouldResume:a,transactionId:o}=i.beforeApplyProjectChanges();i.trigger("startApplyChangeset"),i.applyingChangeset=!0,t.project&&i.applyProjectResponse(t.project),i.applyChangeset(x.clone(t),(l,c)=>{if(c.id==="tasks"||c.id==="events"){const{modelClass:u}=c,d=u.getFieldDataSource("startDate"),h=u.getFieldDataSource("endDate");if(l.updated)for(const f of l.updated){const g=c.getById(f[u.idField]);hc("constraintType",f,g)||hc("constraintDate",f,g)||(delete f[d],delete f[h])}}}),await i.commitAsync(),i.commitRespondedChanges();for(const l in t){const c=i.getStoreDescriptor(l);if(c){const{store:u}=c,d=t[l],h=[...(s=d.updated)!=null?s:[],...(r=d.added)!=null?r:[]];if(u)for(const f of h){const g=u.getById(f[u.modelClass.idField]);if(g)for(const p in g.modifications)hc(p,f,g)||delete g.meta.modified[p]}}}i.afterApplyProjectChanges(a,o),i.applyingChangeset=!1,await i.commitAsync(),i.trigger("endApplyChangeset")}afterApplyProjectChanges(t,s){if(t){const{stm:r}=this;this.ignoreRemoteChangesInSTM?r.enable():r.stopTransaction(),r.applyStash(s)}this.resumeChangesTracking()}},kg=class extends Ci{get type(){return"EventUpdateAction"}construct(e){let{model:n,newData:t,oldData:s}=e;if(t.segments&&s.segments){s={...s},t={...t};const r=s.segments.slice(),i=t.segments.slice();let a=!1;s.segments.forEach((o,l)=>{const c=t.segments.indexOf(o);c>-1&&(r[l]=i[c]=o,a=!0)}),a&&(s.segments=r,t.segments=i)}return super.construct({model:n,newData:t,oldData:s})}};kg._$name="EventUpdateAction";var Cy=(e,n,t)=>e.isSplitEventMixin?new kg({model:e,newData:n,oldData:t}):new Ci({model:e,newData:n,oldData:t}),gc=class extends kr{static get defaultConfig(){return{makeModelUpdateAction:Cy}}};gc._$name="StateTrackingManager";var Lg=class extends fc(dc(uc(xl))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{calendarModelClass:Rs,dependencyModelClass:Is,eventModelClass:Ps,assignmentModelClass:zr,resourceModelClass:ws,calendarManagerStoreClass:ta,dependencyStoreClass:ra,eventStoreClass:ia,assignmentStoreClass:bs,resourceStoreClass:aa,calendarsData:null,supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/schedulerpro/docs/api/SchedulerPro/model/ProjectModel#config-supportShortSyncResponse)',delayCalculation:!0,calendarManagerStore:{},stmClass:gc}}static get configurable(){return{calendars:null}}get taskStore(){return this.eventStore}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}};Lg._$name="ProjectModel";var oa=class extends zr{static get fields(){return[{name:"event",persist:!0,serialize:e=>e==null?void 0:e.id,isEqual:ar},{name:"resource",persist:!0,serialize:e=>e==null?void 0:e.id,isEqual:ar},"eventId","resourceId"]}};oa._$name="AssignmentModel";var pc=class extends bs{static get defaultConfig(){return{modelClass:oa,loadPriority:500,syncPriority:400}}};pc._$name="AssignmentStore";var la=class extends Rs{};la._$name="CalendarModel";var mc=class extends ta{static get defaultConfig(){return{modelClass:la}}};mc._$name="CalendarManagerStore";var ca=class extends Is{constructor(...e){const[n]=e;n!=null&&n.fromTask&&(n.fromEvent=n.fromTask),n!=null&&n.toTask&&(n.toEvent=n.toTask),super(...e)}get from(){var e;return(e=this.fromEvent)==null?void 0:e.id}set from(e){super.from=e}get fromTask(){return this.fromEvent}set fromTask(e){this.fromEvent=e}get to(){var e;return(e=this.toEvent)==null?void 0:e.id}set to(e){super.to=e}get toTask(){return this.toEvent}set toTask(e){this.toEvent=e}get persistableData(){const e=super.persistableData,{fromTask:n,toTask:t}=e;return n&&(e.fromTask=n.id),t&&(e.toTask=t.id),e}shouldRecordFieldChange(e,n,t){return e==="from"||e==="to"?!1:super.shouldRecordFieldChange(e,n,t)}};ca._$name="DependencyModel";var vc=class extends ra{static get defaultConfig(){return{modelClass:ca,loadPriority:300,syncPriority:500}}};vc._$name="DependencyStore";var ua=class extends ws{};ua._$name="ResourceModel";var yc=class extends aa{static get defaultConfig(){return{modelClass:ua,loadPriority:400,syncPriority:200}}};yc._$name="ResourceStore";var da=class extends lt{constructor(){super(...arguments),F(this,"isBaseline",!0)}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:n}=this;if(e&&n)return n.getTime()===e.getTime()}return this.duration===0}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}normalize(){const e=this,{task:n,startDate:t,endDate:s,duration:r}=e,i=r!=null;n.graph?t&&s&&!i?e.setData("duration",n.run("calculateProjectedDuration",t,s)):t&&!s&&i?e.setData("endDate",n.run("calculateProjectedXDateWithDuration",t,!0,r)):!t&&s&&i&&e.setData("startDate",n.run("calculateProjectedXDateWithDuration",s,!1,r)):super.normalize()}get startVariance(){const{task:e}=this,n=R.getDurationInUnit(this.startDate,e.startDate,e.durationUnit);return new xe({magnitude:n,unit:e.durationUnit})}get endVariance(){const{task:e}=this,n=R.getDurationInUnit(this.endDate,e.endDate,e.durationUnit);return new xe({magnitude:n,unit:e.durationUnit})}get durationVariance(){return this.fullDuration&&this.task.fullDuration.diff(this.fullDuration)}};F(da,"fields",[{name:"task",persist:!1}]),da._$name="Baseline";var ha=class extends it{static get type(){return"wbs"}convert(e){return De.from(e)}serialize(e){return String(e)}};ha.prototype.compare=De.compare,ha.initClass(),ha._$name="WbsField";var Sc=(e,n)=>{const{startDate:t,durationUnit:s,endDate:r}=e;return n?n.map(i=>{const a=+("startDate"in i)+("endDate"in i)+("duration"in i)>1,o={task:e,...i};return a||Object.assign(o,{startDate:t,endDate:r,durationUnit:s}),o}):[]},Ey=e=>e.field==="wbsValue"&&!e.ascending,by=e=>{for(let n,t,s=0,r=e.length;s<r;++s)if(t=e[s].wbsValue,t){if(n)return t<n;n=t}return!1},Ry={deep:!0},Iy={deep:!0,silent:!0},En=class extends Al.derive(lt).mixin(tt,na){constructor(){super(...arguments),F(this,"$manuallyScheduled",null)}static get fields(){return[{name:"cls",serialize:e=>e.isDomClassList?e.toString():e,persist:!0},{name:"fullEffort",persist:!1},{name:"baselines",type:"store",modelClass:da,storeClass:K,lazy:!0},{name:"note",type:"string"},"parentId",{name:"children",persist:!1},{name:"showInTimeline",type:"boolean"},{name:"rollup",type:"boolean"},{name:"wbsValue",type:"wbs",persist:!1},{name:"deadlineDate",type:"date"},{name:"parentIndex",type:"number",persist:!0},"iconCls","taskIconCls",{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0},"eventColor"]}getDefaultSegmentModelClass(){return sa}endBatch(){const{isPersistable:e}=this;super.endBatch(...arguments),this.isPersistable&&!e&&this.assignments.forEach(n=>{n.stores.forEach(t=>{t.updateModifiedBagForRecord(n)})})}get isTask(){return!0}get isTaskModel(){return!0}get isEvent(){return!0}get wbsCode(){return String(this.wbsValue)}set wbsCode(e){this.wbsValue=De.from(e)}copy(...e){const n=super.copy(...e);return n.setData("wbsValue",null),n}processBaselinesStoreData(e){return Sc(this,e)}set baselines(e){this.set({baselines:e})}get baselines(){const e=this;return e.$initializedBaselines||(e.fieldMap.baselines.init(e.data,e),e.assignInitables(),e.$initializedBaselines=!0),e.meta.baselinesStore}get hasBaselines(){var e,n;const t=this.fieldMap.baselines;return!!((n=(e=this.baselines)==null?void 0:e.count)!=null?n:this.originalData[t.dataSource])}setBaseline(e){if(e<=0)return;const{baselines:n}=this,t=e-n.count;t>0?n.add(Sc(this,new Array(t).fill({}))):n.getAt(e-1).set(Sc(this,[{}])[0])}get successors(){return Array.from(this.outgoingDeps||[])}set successors(e){this.outgoingDeps=e}setSuccessors(e){return this.replaceDependencies(e,!0)}replaceDependencies(e,n){const t=this,{dependencyStore:s}=t.project,r=new Set,i=new Set,a=[],o=n?t.outgoingDeps:t.incomingDeps,l=Array.from(o);return e.forEach(c=>{const u=l.find(n?d=>d.toEvent===c.toEvent:d=>d.fromEvent===c.fromEvent);u?(r.add(u),u.copyData(c)):i.add(c)}),o.forEach(c=>{r.has(c)||a.push(c)}),a.forEach(c=>s.remove(c)),i.forEach(c=>{n?c.fromEvent=t:c.toEvent=t,s.add(c)}),t.commitAsync()}get predecessors(){return Array.from(this.incomingDeps||[])}set predecessors(e){this.incomingDeps=e}setPredecessors(e){return this.replaceDependencies(e,!1)}get assignments(){return super.assignments}set assignments(e){const n=this,{assignmentStore:t}=n.project,s=[],r=n.assignments,i=r.filter(a=>!(e!=null&&e.find(o=>o.resource===a.resource)));e.forEach(a=>{const o=t.getAssignmentForEventAndResource(this,a.resource);o?o.copyData(a):(a.remove(),s.push(a))}),t.remove(i),t.add(s)}get assigned(){var e;const{project:n}=this;return n!=null&&n.isDelayingCalculation?(e=n.assignmentStore.storage.findItem("event",this))!=null?e:new Set:super.assigned}set assigned(e){super.assigned=e}get isDraggable(){return this.draggable}get isResizable(){return this.resizable&&!this.milestone&&this.isEditable("endDate")}get isMilestone(){return this.milestone}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":case"lateStartDate":case"lateEndDate":case"totalSlack":return!1;case"effort":case"fullEffort":case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}isFieldModified(e){return e==="fullEffort"?super.isFieldModified("effort")||super.isFieldModified("effortUnit"):super.isFieldModified(e)}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:n}=this;if(e&&n)return n.getTime()===e.getTime()}return this.duration===0}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}get allDependencies(){return this.dependencies}get dependencies(){var e;return(e=this.project)!=null&&e.isDelayingCalculation?[]:[...this.incomingDeps||[],...this.outgoingDeps||[]]}set dependencies(e){const n=this,t=[],s=[];e==null||e.forEach(r=>{r.fromEvent===n||r.fromEvent===n.id?s.push(r):(r.toEvent===n||r.toEvent===n.id)&&t.push(r)}),n.setPredecessors(t),n.setSuccessors(s)}get predecessorTasks(){return[...this.incomingDeps||[]].map(e=>e.fromEvent)}get successorTasks(){return[...this.outgoingDeps||[]].map(e=>e.toEvent)}get previousSiblingsTotalCount(){let e=this.previousSibling,n=this.parentIndex;for(;e;)n+=e.descendantCount,e=e.previousSibling;return n}get sequenceNumber(){if(this.taskStore)return this.taskStore.allIndexOf(this)+1;let e=0,n=this;for(;n.parent;)e+=n.previousSiblingsTotalCount+1,n=n.parent;return e}get isSubProject(){return!1}get subProject(){const e=this;let n=null;return e.isProject?n=e:e.bubbleWhile(t=>(t.isProject&&(n=t),!n)),n}get fullEffort(){return new xe({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get resources(){return this.assignments.reduce((e,n)=>(n.resource&&e.push(n.resource),e),[])}get $linkedResources(){var e,n;return(n=(e=this.resources)==null?void 0:e.flatMap(t=>[t,...t.$links]))!=null?n:[]}normalize(){}inSetNormalize(e){}joinStore(e){var n,t;const s=this,r=(s.firstStore||e).useOrderedTreeForWbs;!s.wbsValue&&!s.generatedParent&&((s.taskStore||e).isLoadingData||!((n=s.nextSibling)!=null&&n.wbsValue||(t=s.previousSibling)!=null&&t.wbsValue)?s.refreshWbs({useOrderedTree:r,...Iy}):s.parent.refreshWbs(Ry,-1)),super.joinStore(e)}refreshWbs(e,n){var t,s,r,i,a,o;const l=this,{parent:c}=l,u=l.firstStore||null,{useOrderedTree:d=(t=u==null?void 0:u.useOrderedTreeForWbs)!=null?t:!1}=e||{};if(c&&n!==-1&&l.fieldMap.wbsValue){d?n=l.orderedParentIndex:n=(s=n!=null?n:l.unfilteredIndex)!=null?s:l.parentIndex,n++;const h=c.isRoot?new De(n):c.wbsValue.append(n);e!=null&&e.silent?l.setData("wbsValue",h):l.set("wbsValue",h)}if((r=e==null?void 0:e.deep)==null||r)if(d)for(const h of(i=l.orderedChildren)!=null?i:[])h.refreshWbs(e);else{const h=(a=l.unfilteredChildren)!=null?a:l.children,f=(h==null?void 0:h.length)||0;if(f){const g=by(h)&&((o=u==null?void 0:u.sorters)==null?void 0:o.findIndex(Ey))===0;for(let p=0;p<f;++p)h[p].refreshWbs(e,g?f-p-1:p)}}}async tryInsertChild(){return this.getProject().tryPropagateWithChanges(()=>{this.insertChild(...arguments)})}updateDependencies(e,n){this.outgoingDeps.forEach(t=>{if(t.toEvent.isScheduled){const{type:s,calendar:r,toEvent:i}=t;e&&(s===St.Type.StartToStart?t.setLag(R.as("hour",r.calculateDurationMs(e,i.startDate,!0)),"hour"):s===St.Type.StartToEnd&&t.setLag(R.as("hour",r.calculateDurationMs(e,i.endDate,!0)),"hour")),n&&(s===St.Type.EndToStart?t.setLag(R.as("hour",r.calculateDurationMs(n,i.startDate,!0)),"hour"):s===St.Type.EndToEnd&&t.setLag(R.as("hour",r.calculateDurationMs(n,i.endDate,!0)),"hour"))}})}async moveTaskPinningSuccessors(e){const n=this;return n.startDate=e,n.bubble(t=>{if(!t.isRoot){const s=t.run("calculateStartDate"),r=t.run("calculateEndDate");t.updateDependencies(s,r)}}),n.project.commitAsync()}async setStartDatePinningSuccessors(e){const n=this,t=n.setStartDate(e,!1);return n.bubble(s=>{if(!s.isRoot){const r=s.run("calculateStartDate");s.updateDependencies(r,null)}}),t}async setEndDatePinningSuccessors(e){const n=this;return n.endDate=e,n.bubble(t=>{if(!t.isRoot){const s=t.run("calculateEndDate");t.updateDependencies(null,s)}}),n.project.commitAsync()}getCurrentConfig(e){const{segments:n}=this,t=super.getCurrentConfig(e);return t&&n&&(t.segments=n.map(s=>s.getCurrentConfig(e))),t}};En.convertEmptyParentToLeaf=!0,En._$name="TaskModel";var Ms={deep:!0},Bg=Object.freeze({add:!0,remove:!0,sort:!0}),Py=Object.freeze({add:!1,remove:!1,sort:!1}),Dc=(e,n)=>De.compare(e==null?void 0:e.wbsCode,n==null?void 0:n.wbsCode),xs=class extends Yo.derive(We).mixin(tt,rc,Yi){static get defaultConfig(){return{modelClass:En,loadPriority:200,syncPriority:300,storeId:"tasks",tree:!0}}static get configurable(){return{wbsMode:"manual",useOrderedTreeForWbs:!1,outdentIgnoringSiblings:!1,forceWbsOrderForChanges:!1}}changeWbsMode(e){return e==="auto"?Bg:e&&typeof e=="object"?(x.values(e).every(n=>!n)&&(e=x.assign({},Bg,e)),e):Py}setBaseline(e){const n=this.storage.values;this.forEach(t=>t.setBaseline(e)),this.trigger("refresh",{action:"batch",records:n,data:n})}async indent(e){const n=this,{taskStore:t,project:s}=n;let r=!1;if(e=Array.isArray(e)?e.slice():[e],e=e.filter(i=>!i.isProjectModel),e=e.filter(i=>{let a;for(a=!!i.previousSibling;a&&!i.isRoot;)a=!e.includes(i.parent),i=i.parent;return a}),e.length&&t.trigger("beforeIndent",{records:e})!==!1){if(e.sort((i,a)=>De.compare(i.wbsCode,a.wbsCode)),t.beginBatch(),r=await s.tryPropagateWithChanges(()=>{for(const i of e){const a=i.previousSibling;a.appendChild(i),n.toggleCollapse(a,!1)}}),n.isDestroyed)return;t.endBatch(),r&&(n.refreshWbsForChildren({up:2,nodes:e}),n.trigger("indent",{records:e}),n.trigger("change",{action:"indent",records:e}))}return r}async outdent(e){const n=this,{taskStore:t,project:s}=n;let r=!1;if(e=Array.isArray(e)?e.slice():[e],e=e.filter(i=>!i.isProjectModel),e=e.filter(i=>{let a;for(a=i.parent&&!i.parent.isRoot;a&&!i.isRoot;)a=!e.includes(i.parent),i=i.parent;return a}),e.length&&t.trigger("beforeOutdent",{records:e})!==!1){if(e.sort((i,a)=>De.compare(a.wbsCode,i.wbsCode)),t.beginBatch(),r=await s.tryPropagateWithChanges(()=>{for(const i of e){const a=!this.outdentIgnoringSiblings&&i.parent.children.slice(i.parent.children.indexOf(i)+1);i.parent.parent.insertChild(i,i.parent.nextSibling,!1,{orderedBeforeNode:i.parent.nextOrderedSibling}),a.length&&i.appendChild(a),n.toggleCollapse(i,!1)}}),n.isDestroyed)return;t.endBatch(),r&&(n.refreshWbsForChildren({up:1,nodes:e}),n.trigger("outdent",{records:e}),n.trigger("change",{action:"outdent",records:e}))}return r}onNodeAddChild(e,n,t,s,r=!1){if(super.onNodeAddChild(e,n,t,s,r),!this.isLoadingData&&this.wbsMode.add){e.refreshWbs(Ms);const i=new Set;n.forEach(a=>{const o=this.getById(a.meta.oldParentId);o&&e!==o&&!i.has(o)&&(i.add(o),o.refreshWbs(Ms,-1))})}}onNodeRemoveChild(e,n,t,s={isMove:!1,silent:!1,unfiltered:!1}){const r=super.onNodeRemoveChild(e,n,t,s);return this.wbsMode.remove&&!s.isMove&&e.refreshWbs(Ms),r}applyChangeset(e,n=null,...t){var s,r,i;const a=this,{updated:o,modified:l}=(s=n==null?void 0:n(e,a))!=null?s:e,c=(r=o!=null?o:l)!=null?r:[],u=a.forceWbsOrderForChanges&&a.tree&&!a.isSorted&&!a.isGrouped?c.reduce((h,{id:f,parentId:g})=>{var p,m;if(g!==void 0){const y=a.getById(f),D=(p=y==null?void 0:y.parent)==null?void 0:p.parentId;g===D&&h.push({node:y,originalNodeAbove:(m=y.previousSibling)!=null?m:y.parent})}return h},[]):[],d=super.applyChangeset(e,n,...t);if(u.length>0)for(const{node:h,originalNodeAbove:f}of u){const{parent:g}=h,p=f.parent===g?f.parentIndex:((i=f.parent)==null?void 0:i.parent)===g?f.parent.parentIndex:void 0;p!==void 0&&g.children.includes(h)&&g.insertChild(h,p+1)}return d}afterChangesetApplied(e){super.afterChangesetApplied(e),e.forEach(n=>{n.refreshWbs({deep:!0,useOrderedTree:!0})})}afterPerformSort(e){this.wbsMode.sort&&this.rootNode.refreshWbs(Ms),super.afterPerformSort(e)}refreshWbsForChildren(e){const n=e.nodes,t={...Ms,...e},s=new Set,r=t.up||0;let i,a;n.forEach(o=>{for(a=o,i=r;a&&i;--i)a=a.parent;s.add(a)});for(a of s)a.refreshWbs(t)}getTotalTimeSpan(){return{startDate:this.getProject().startDate,endDate:this.getProject().endDate}}getEventsForResource(e){const n=this.resourceStore.getById(e),t=(n==null?void 0:n.assignments.filter(r=>r.isPartOfStore(this.assignmentStore)))||[],s=[];return t.forEach(({event:r})=>r&&s.push(r)),s}isDateRangeAvailable(e,n,t,s){const r=new Set(this.getEventsForResource(s));if(t!=null&&t.isAssignment&&t.event.resources.forEach(o=>{o.id!==t.resourceId&&this.getEventsForResource(o).forEach(l=>r.add(l))}),t){const i=t.isAssignment?t.event:t;r.delete(i)}return!Array.from(r).some(i=>i.isScheduled&&R.intersectSpans(e,n,i.startDate,i.endDate))}linkTasks(e){for(let n=1;n<e.length;n++){const t=e[n-1],s=e[n];this.dependencyStore.getEventsLinkingDependency(t,s)||this.dependencyStore.add({from:t,to:s})}}unlinkTasks(e){this.dependencyStore.remove(this.dependencyStore.query(({fromTask:n,toTask:t})=>e.includes(n)||e.includes(t)))}get changes(){const e=super.changes;return e&&this.forceWbsOrderForChanges&&(e.added.sort(Dc),e.modified.sort(Dc),e.removed.sort(Dc)),e}};F(xs,"$name","TaskStore"),xs._$name="TaskStore";var Ng=class extends ea{};Ng._$name="CalendarIntervalModel";var fa=class extends ag.derive(H).mixin(fc,Fg,dc,cc,_g){static get defaults(){return{expanded:!0}}static get defaultConfig(){return{projectConstraintIntervalClass:ki,dateConstraintIntervalClass:as,dependencyConstraintIntervalClass:pn,taskModelClass:En,dependencyModelClass:ca,resourceModelClass:ua,assignmentModelClass:oa,calendarModelClass:la,taskStoreClass:xs,dependencyStoreClass:vc,resourceStoreClass:yc,assignmentStoreClass:pc,calendarManagerStoreClass:mc,tasksData:null,eventsData:null,dependenciesData:null,resourcesData:null,assignmentsData:null,calendarsData:null,timeRangeStore:{modelClass:lt,storeId:"timeRanges"},convertEmptyParentToLeaf:!1,supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/gantt/docs/api/Gantt/model/ProjectModel#config-supportShortSyncResponse)',delayCalculation:!0,eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},stmClass:gc}}static get configurable(){return{tasks:null,resources:null,assignments:null,dependencies:null,timeRanges:null,calendars:null,timeRangesData:null,syncDataOnLoad:null,ignoreRemoteChangesInSTM:!1}}construct(...e){const n=e[0]||{};e[0]=n,"tasksData"in n&&(n.eventsData=n.tasksData,delete n.tasksData),"taskStore"in n&&(n.eventStore=n.taskStore,delete n.taskStore),n.eventModelClass=n.taskModelClass||n.eventModelClass||this.getDefaultConfiguration().taskModelClass||this.defaultEventModelClass,n.eventStoreClass=n.taskStoreClass||n.eventStoreClass||this.getDefaultConfiguration().taskStoreClass||this.defaultEventStoreClass,super.construct(...e)}attachStore(e){this.syncDataOnLoad&&(e.syncDataOnLoad=this.syncDataOnLoad),e.ion({name:e.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(e)}detachStore(e){e&&this.detachListeners(e.$$name),super.detachStore(e)}relayStoreChange(e){return super.relayStoreChange(e),this.trigger("change",{store:e.source,...e,source:this})}get defaultEventModelClass(){return En}get defaultEventStoreClass(){return xs}set taskStore(e){this.eventStore=e}get taskStore(){return this.eventStore}get timeRangeStore(){return this._timeRangeStore}set timeRangeStore(e){const n=this;n.detachStore(n._timeRangeStore),n._timeRangeStore=K.getStore(e,K),n._timeRangeStore.storeId||(n._timeRangeStore.storeId="timeRanges"),n.attachStore(n._timeRangeStore)}async tryInsertChild(){return this.tryPropagateWithChanges(()=>{this.insertChild(...arguments)})}toJSON(){return{eventsData:this.eventStore.toJSON(),resourcesData:this.resourceStore.toJSON(),dependenciesData:this.dependencyStore.toJSON(),assignmentsData:this.assignmentStore.toJSON()}}get json(){return super.json}set json(e){typeof e=="string"&&(e=U.safeJsonParse(e)),this.loadInlineData(e)}get tasks(){return this.taskStore.allRecords}updateTasks(e){this.taskStore.data=e}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}updateTimeRangesData(e){this.timeRangeStore.data=e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}afterChange(e,n){super.afterChange(...arguments),n.calendar&&this.trigger("calendarChange")}refreshWbs(e){var n,t;const s=this,r=(n=s.unfilteredChildren)!=null?n:s.children;r!=null&&r.length&&((t=r[0].refreshWbs)==null||t.call(s,e,-1))}};F(fa,"$name","ProjectModel"),fa.applyConfigs=!0,fa._$name="ProjectModel";
//# sourceMappingURL=gantt.node.min.cjs.map
