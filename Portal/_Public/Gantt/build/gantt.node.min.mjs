var Bg=Object.defineProperty,Vg=(e,s,t)=>s in e?Bg(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,F=(e,s,t)=>(Vg(e,typeof s!="symbol"?s+"":s,t),t),de=class{initialize(e){e&&Object.assign(this,e)}static new(e){const s=new this;return s.initialize(e),s}};function Cc(e){const s=[],t=[];let n;const r=function*(){for(n||(n=e[Symbol.iterator]());s.length&&(yield*s,s.length=0),!!n;){const{value:a,done:o}=n.next();if(o){n=null,e=null;break}t.push(a),yield a}},i=function*(){for(n||(n=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),!!n;){const{value:a,done:o}=n.next();if(o){n=null,e=null;break}s.push(a),yield a}};return[r(),i()]}function*Ug(e,s){if(s<0)throw new Error("Batch size needs to a natural number");s=s|0;const t=[];for(const n of e)t.length===s&&(yield t,t.length=0),t.push(n);t.length>0&&(yield t)}function*Wg(e,s){let t=0;for(const n of e)s(n,t++)&&(yield n)}function*zg(e,s){let t=0;for(const n of e)++t>s&&(yield n)}function qg(e,s){let t=0;for(const n of e)if(!s(n,t++))return!1;return!0}function Gg(e,s){let t=0;for(const n of e)if(s(n,t++))return!0;return!1}function*An(e,s){let t=0;for(const n of e)yield s(n,t++)}function Hg(e,s,t){let n=0,r=t;for(const i of e)r=s(r,i,n++);return r}function*Ec(e){const s=new Set;for(const t of e)s.has(t)||(s.add(t),yield t)}function*Yg(e,s){const t=new Set;for(const n of e){const r=s(n);t.has(r)||(t.add(r),yield n)}}function*Kg(e,s){let t=0;for(const n of e)if(s(n,t++))yield n;else return}function*bc(...e){for(let s=0;s<e.length;s++)yield*e[s]}function*Rc(e){for(const s of e)yield*s}var qr=class{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new qr(e)}copy(){const[e,s]=Cc(this.iterable);return this.iterable=s,new qr(e)}split(){const[e,s]=Cc(this.iterable);return[new qr(e),this.derive(s)]}inBatchesBySize(e){return this.derive(Ug(this.iterable,e))}filter(e){return this.derive(Wg(this.iterable,e))}drop(e){return this.derive(zg(this.iterable,e))}map(e){return this.derive(An(this.iterable,e))}reduce(e,s){return Hg(this,e,s)}concat(){return this.derive(Rc(this.iterable))}uniqueOnly(){return this.derive(Ec(this.iterable))}uniqueOnlyBy(e){return this.derive(Yg(this.iterable,e))}every(e){return qg(this,e)}some(e){return Gg(this,e)}takeWhile(e){return this.derive(Kg(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new wc(this)}},Jg=e=>new qr(e),Me=Jg,wc=class extends qr{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new qr(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let s=this.$iterator,t=e.length;for(t>0&&(yield*e);;){if(e.length>t){for(let i=t;i<e.length;i++)yield e[i];t=e.length}if(!s)break;const{value:n,done:r}=s.next();r?(s=this.$iterator=null,this.$iterable=null):(e.push(n),t++,yield n)}}else yield*e}},Qg=e=>new wc(e),Ic=Qg,Zg=-Math.pow(2,30),Zt=Math.pow(2,30)-1,fa=e=>e.slice(0,1).toUpperCase()+e.slice(1),Cr=e=>Object(e)!==e,$n=(e,s,t)=>(Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0}),t),G=e=>function(s,t){s[t]=e},Xg=(e,s)=>{for(const t of e)s.add(t);return s},bs=e=>new Promise(s=>setTimeout(s,e)),ep=function*(e,s){let t;for(;(t=e.exec(s))!==null;)yield t},ga=null,pa=function(e){return ga===null&&(ga=typeof regeneratorRuntime!="undefined"),ga===!0?regeneratorRuntime.isGeneratorFunction(e):e.constructor.name==="GeneratorFunction"},_n=function(e){return e&&typeof e.then=="function"},Rs=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Gr=Symbol("BreakCurrentStackExecution"),ye=class extends de{};Rs([G(!0)],ye.prototype,"sync",void 0),Rs([G(!0)],ye.prototype,"pure",void 0);var ma=Symbol("ProposedOrPreviousSymbol"),X=ye.new({handler:ma}),ws=Symbol("RejectSymbol"),Hr=class extends ye{constructor(){super(...arguments),this.handler=ws}};Rs([G(!1)],Hr.prototype,"pure",void 0);var kt=e=>Hr.new({reason:e}),va=Symbol("TransactionSymbol"),tp=ye.new({handler:va}),ya=Symbol("OwnQuarkSymbol"),rp=ye.new({handler:ya}),Sa=Symbol("OwnIdentifierSymbol"),sp=ye.new({handler:Sa}),Da=Symbol("WriteSymbol"),Ca=class extends ye{constructor(){super(...arguments),this.handler=Da}};Rs([G(!1)],Ca.prototype,"pure",void 0);var Pc=(e,s,...t)=>Ca.new({identifier:e,proposedArgs:[s,...t]}),Ea=Symbol("WriteSeveralSymbol"),ba=class extends ye{constructor(){super(...arguments),this.handler=Ea}};Rs([G(!1)],ba.prototype,"pure",void 0);var Mc=e=>ba.new({writes:e}),Ra=Symbol("PreviousValueOfSymbol"),xc=class extends ye{constructor(){super(...arguments),this.handler=Ra}},Fn=e=>xc.new({identifier:e}),wa=Symbol("ProposedValueOfSymbol"),Tc=class extends ye{constructor(){super(...arguments),this.handler=wa}},Oc=e=>Tc.new({identifier:e}),Ia=Symbol("HasProposedValueSymbol"),Ac=class extends ye{constructor(){super(...arguments),this.handler=Ia}},ct=e=>Ac.new({identifier:e}),Pa=Symbol("HasProposedNotPreviousValueSymbol"),$c=class extends ye{constructor(){super(...arguments),this.handler=Pa}},_c=e=>$c.new({identifier:e}),Ma=Symbol("ProposedOrPreviousValueOfSymbol"),Fc=class extends ye{constructor(){super(...arguments),this.handler=Ma}},pe=e=>Fc.new({identifier:e}),xa=Symbol("ProposedArgumentsOfSymbol"),jc=class extends ye{constructor(){super(...arguments),this.handler=xa}},Er=e=>jc.new({identifier:e}),Ta=Symbol("UnsafeProposedOrPreviousValueOfSymbol"),kc=class extends ye{constructor(){super(...arguments),this.handler=Ta}},br=e=>kc.new({identifier:e}),Oa=Symbol("UnsafePreviousValueOfSymbol"),Lc=class extends ye{constructor(){super(...arguments),this.handler=Oa}},np=e=>Lc.new({identifier:e}),jn=Symbol("MixinIdentity"),Is=Symbol("MixinStateProperty"),ip=class{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=Ic(this.linearizedByTopoLevels())}static new(e){const s=new this;return e&&Object.assign(s,e),s}get topoLevels(){return this.$topoLevels!==void 0?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort((e,s)=>e-s)}get elementsByTopoLevel(){return this.$elementsByTopoLevel!==void 0?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,s){let t=e.get(s);return t||(t=[],e.set(s,t)),t}buildElementsByTopoLevel(){let e=0;const s=this.baseEl?Me(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,t=Me(this.sourceEl.requirements).map(n=>n.walkDepthState.elementsByTopoLevel).concat().reduce((n,[r,i])=>(r>e&&(e=r),this.getOrCreateLevel(n,r).push(i),n),new Map);return this.getOrCreateLevel(t,e+1).push([this.sourceEl]),Me(t).map(([n,r])=>[n,Me(r).concat().uniqueOnly().filter(i=>!s.has(i)).sort((i,a)=>i.id-a.id)]).toMap()}*linearizedByTopoLevels(){yield*Me(this.topoLevels).map(e=>this.elementsByTopoLevel.get(e)).concat()}},Nc=1,ap=e=>class extends e{},kn=class{},Aa=class{constructor(){this.id=Nc++,this.requirements=[],this.baseClass=kn,this.identitySymbol=void 0,this.mixinLambda=ap,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(e){const s=new this;e&&Object.assign(s,e),s.walkDepthState=ip.new({sourceEl:s,baseEl:lp(s.baseClass)});const t=s.mixinLambda,n=s.identitySymbol=Symbol(t.name),r=Object.assign(function(i){const a=t(i);return a.prototype[n]=!0,a},{[jn]:n,[Is]:s});return Object.defineProperty(r,Symbol.hasInstance,{value:Vc}),s.mixinLambda=r,s}get minimalClass(){return this.$minimalClass!==void 0?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const s=this.constructor,t=s.baseClassesIds.get(e);if(t!==void 0)return t;const n=Nc++;return s.baseClassesIds.set(e,n),n}buildMinimalClass(){const e=this.constructor;let s=this.baseClass;const t=this.walkDepthState.linearizedByTopoLevelsSource.reduce((r,i)=>{const{cls:a,hash:o}=r,l=o+String.fromCharCode(i.id);let c=e.minimalClassesByLinearHash.get(l);return c||(c=i.mixinLambda(a),i.name=c.name,e.minimalClassesByLinearHash.set(l,c)),r.cls=c,r.hash=l,r},{cls:s,hash:String.fromCharCode(this.getBaseClassMixinId(s))}).cls,n=Object.assign(t,{[jn]:this.identitySymbol,[Is]:this,mix:this.mixinLambda,derive:r=>O([n,r],i=>class extends i{}),$:this,toString:this.toString.bind(this)});return Object.defineProperty(n,Symbol.hasInstance,{value:Vc}),n}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce((e,s)=>`${s.name}(${e})`,this.baseClass.name)}};Aa.minimalClassesByLinearHash=new Map,Aa.baseClassesIds=new Map;var op=e=>Object.getPrototypeOf(e.prototype).constructor.hasOwnProperty(Is),lp=e=>Object.getPrototypeOf(e.prototype).constructor[Is],Bc=(e,s)=>{let t;if(e.length>0){const i=e[e.length-1];!op(i)&&i!==kn&&(t=i)}const n=[];return e.forEach((i,a)=>{const o=i[Is];if(o!==void 0){const l=o.baseClass;if(l!==kn)if(t){if(t!==l){const c=l.prototype.isPrototypeOf(t.prototype),u=t.prototype.isPrototypeOf(l.prototype);if(!c&&!u)throw new Error("Base class mismatch");t=u?l:t}}else t=l;n.push(o)}else if(a!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}),Aa.new({requirements:n,mixinLambda:s,baseClass:t||kn}).minimalClass},Vc=function(e){return!!(e&&e[this[jn]])},ze=(e,s)=>!!(e&&e[s[jn]]),O=Bc,$a=Bc,Yr=!1,cp=(...e)=>{},Ln=e=>Yr?e:cp,up=Ln(e=>{debugger}),Ps=Ln(e=>{typeof console!="undefined"&&console.warn(e)}),dp=class extends de{},Uc=class extends de{constructor(){super(...arguments),this.stackEntries=[]}static fromError(e){return Uc.new({exception:e,stackEntries:hp(e.stack)})}static fromThisCall(){const e=this.fromError(new Error);return e.stackEntries.splice(0,2),e}},hp=e=>Me(ep(/^   +at\s*(.*?)\s*\((https?:\/\/.*?):(\d+):(\d+)/gm,e)).map(s=>dp.new({statement:s[1],sourceFile:s[2],sourceLine:Number(s[3]),sourceCharPos:Number(s[4])})).toArray(),fp=Symbol("ContextSync"),gp=Symbol("ContextGen"),Wc=class extends O([],e=>class extends e{constructor(){super(...arguments),this.iterator=void 0,this.iterationResult=void 0}isCalculationStarted(){return!!(this.iterator||this.iterationResult)}isCalculationCompleted(){return!!(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(t,...n){const r=this.iterator=this.calculation.call(this.context||this,t,...n);return this.iterationResult=r.next()}continueCalculation(t){return this.iterationResult=this.iterator.next(t)}cleanupCalculation(){this.iterationResult=void 0,this.iterator=void 0}*calculation(t,...n){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(t,...n){for(this.startCalculation(t,...n);!this.isCalculationCompleted();)this.continueCalculation(t(this.iterationResult.value));return this.iterator=void 0,this.result}async runAsyncWithEffect(t,...n){for(this.startCalculation(t,...n);!this.isCalculationCompleted();)this.continueCalculation(await t(this.iterationResult.value));return this.iterator=void 0,this.result}}){},Nn=Symbol("SynchronousCalculationStarted"),pp={value:Nn},zc=class extends O([],e=>class extends e{constructor(){super(...arguments),this.iterationResult=void 0}isCalculationStarted(){return!!this.iterationResult}isCalculationCompleted(){return!!(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(t,...n){return this.iterationResult=pp,this.iterationResult={done:!0,value:this.calculation.call(this.context||this,t,...n)}}continueCalculation(t){throw new Error("Can not continue synchronous calculation")}cleanupCalculation(){this.iterationResult=void 0}calculation(t,...n){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(t,...n){return this.startCalculation(t,...n),this.result}async runAsyncWithEffect(t,...n){throw new Error("Can not run synchronous calculation asynchronously")}}){};function qc(e,s,t,n){const r=s.apply(n||null,t);let i=r.next();for(;!i.done;)i=r.next(e(i.value));return i.value}async function Ms(e,s,t,n){const r=s.apply(n||null,t);let i=r.next();for(;!i.done;){let a,o=!1;do{o=!1;try{a=e(i.value)}catch(l){if(l instanceof ye)if(await e(l)==="Cancel"){e(kt(l));return}else o=!0}}while(o);_n(a)?i=r.next(await a):i=r.next(a)}return i.value}var It;(function(e){e.Cancel="Cancel",e.Resume="Resume"})(It||(It={}));var Gc=Symbol("WalkSource"),Kr=-1,Rr=-2,_a=class extends de{constructor(){super(...arguments),this.visited=new Map,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e.map(s=>({node:s,from:Gc,label:void 0}))),this.walkDepth()}onNode(e,s){}onTopologicalNode(e){}onCycle(e,s){return It.Cancel}forEachNext(e,s){throw new Error("Abstract method called")}collectNext(e,s,t){throw new Error("Abstract method called")}getVisitedInfo(e){return this.visited.get(e)}setVisitedInfo(e,s,t){return t?(t.visitedAt=s,t.visitEpoch=this.currentEpoch):(t={visitedAt:s,visitEpoch:this.currentEpoch},this.visited.set(e,t)),t}walkDepth(){const e=this.visited,s=this.toVisit;let t;for(;t=s.length;){const n=s[t-1].node,r=this.getVisitedInfo(n);if(r&&r.visitedAt===Rr&&r.visitEpoch===this.currentEpoch){s.pop();continue}if(r&&r.visitEpoch===this.currentEpoch&&r.visitedAt!==Kr){if(r.visitedAt<t){if(this.onCycle(n,s)!==It.Resume)break}else r.visitedAt=Rr,this.onTopologicalNode(n);s.pop()}else{if(this.onNode(n,s[t-1])===!1)break;const i=this.setVisitedInfo(n,t,r),a=s.length;this.collectNext(n,s,i),s.length===a&&(i.visitedAt=Rr,this.onTopologicalNode(n),s.pop())}}}};function Hc(e){const s=e.length;if(s===0)return[];const t=e[s-1].node,n=[t];let r=s-1,i=r;for(;r>=0&&e[r].from!==t;){for(;r>=0&&e[r].from===e[i].from;)r--;r>=0&&(n.push(e[r].node),i=r)}return r<0?[]:(n.push(t),n.reverse())}var Jr;(function(e){e[e.Normal=1]="Normal",e[e.Past=2]="Past"})(Jr||(Jr={}));var mp=0,Bn=class extends $a([Map],e=>class extends e{constructor(){super(...arguments),this.createdAt=void 0,this.identifier=void 0,this.value=void 0,this.proposedValue=void 0,this.proposedIsPrevious=!1,this.proposedArguments=void 0,this.usedProposedOrPrevious=!1,this.previous=void 0,this.origin=void 0,this.originId=Zg,this.needToBuildProposedValue=!1,this.edgesFlow=0,this.visitedAt=Kr,this.visitEpoch=0,this.promise=void 0,this.$outgoingPast=void 0}static new(t){const n=new this;return t&&Object.assign(n,t),n}get level(){return this.identifier.level}get calculation(){return this.identifier.calculation}get context(){return this.identifier.context||this.identifier}forceCalculation(){this.edgesFlow=Zt}cleanup(){this.cleanupCalculation()}isShadow(){return!!(this.origin&&this.origin!==this)}resetToEpoch(t){this.visitEpoch=t,this.visitedAt=Kr,this.edgesFlow<0&&(this.edgesFlow=0),this.usedProposedOrPrevious=!1,this.cleanupCalculation(),this.clearOutgoing(),this.promise=void 0,this.origin&&this.origin===this?(this.proposedArguments=void 0,this.value!==void 0&&(this.proposedValue=this.value),this.value=void 0):(this.origin=void 0,this.value=void 0),this.identifier.proposedValueIsBuilt&&this.proposedValue!==ee&&(this.needToBuildProposedValue=!0,this.proposedValue=void 0)}copyFrom(t){this.value=t.value,this.proposedValue=t.proposedValue,this.proposedArguments=t.proposedArguments,this.usedProposedOrPrevious=t.usedProposedOrPrevious}clearProperties(){this.value=void 0,this.proposedValue=void 0,this.proposedArguments=void 0}mergePreviousOrigin(t){const n=this.origin;if(n!==this.previous)throw new Error("Invalid state");this.copyFrom(n);const r=this.getOutgoing();for(const[i,a]of n.getOutgoing())if(!r.get(i)){const l=t.get(i);(!l||l.originId===a.originId)&&r.set(i,l||a)}if(n.$outgoingPast!==void 0){const i=this.getOutgoingPast();for(const[a,o]of n.getOutgoingPast())if(!i.get(a)){const c=t.get(a);(!c||c.originId===o.originId)&&i.set(a,c||o)}}this.origin=this,n.clearProperties(),n.clear()}setOrigin(t){this.origin=t,this.originId=t.originId}getOrigin(){return this.origin?this.origin:this.startOrigin()}startOrigin(){return this.originId=mp++,this.origin=this}getOutgoing(){return this}getOutgoingPast(){return this.$outgoingPast!==void 0?this.$outgoingPast:this.$outgoingPast=new Map}addOutgoingTo(t,n){(n===Jr.Normal?this:this.getOutgoingPast()).set(t.identifier,t)}clearOutgoing(){this.clear(),this.$outgoingPast!==void 0&&this.$outgoingPast.clear()}getValue(){const t=this.origin;return t===this?this.value:t?t.getValue():void 0}setValue(t){if(this.origin&&this.origin!==this)throw new Error("Can not set value to the shadow entry");this.getOrigin().value=t}hasValue(){return this.getValue()!==void 0}hasProposedValue(){return this.isShadow()?!1:this.hasProposedValueInner()}hasProposedValueInner(){return this.proposedValue!==void 0}getProposedValue(t){return this.needToBuildProposedValue&&(this.proposedValue=this.identifier.buildProposedValue.call(this.identifier.context||this.identifier,this.identifier,this,t),this.needToBuildProposedValue=!1),this.proposedValue}outgoingInTheFutureCb(t,n){let r=this;for(;r;){for(const i of r.getOutgoing().values())i.originId===t.getLatestEntryFor(i.identifier).originId&&n(i);r.isShadow()?r=r.previous:r=null}}outgoingInTheFutureAndPastCb(t,n){let r=this;for(;r;){for(const i of r.getOutgoing().values()){const a=t.getLatestEntryFor(i.identifier);a&&i.originId===a.originId&&n(i)}if(r.$outgoingPast!==void 0)for(const i of r.$outgoingPast.values()){const a=t.getLatestEntryFor(i.identifier);a&&i.originId===a.originId&&n(i)}r.isShadow()?r=r.previous:r=null}}outgoingInTheFutureAndPastTransactionCb(t,n){let r=this;for(;r;){for(const i of r.getOutgoing().values()){const a=t.getLatestStableEntryFor(i.identifier);a&&i.originId===a.originId&&n(i)}if(r.$outgoingPast!==void 0)for(const i of r.$outgoingPast.values()){const a=t.getLatestStableEntryFor(i.identifier);a&&i.originId===a.originId&&n(i)}r.isShadow()?r=r.previous:r=null}}outgoingInTheFutureTransactionCb(t,n){let r=this;for(;r;){for(const i of r.getOutgoing().values()){const a=t.getLatestEntryFor(i.identifier);a&&i.originId===a.originId&&n(i)}r.isShadow()?r=r.previous:r=null}}}){},ee=Symbol("Tombstone"),Qr=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Pt;(function(e){e[e.UserInput=0]="UserInput",e[e.DependsOnlyOnUserInput=1]="DependsOnlyOnUserInput",e[e.DependsOnlyOnDependsOnlyOnUserInput=2]="DependsOnlyOnDependsOnlyOnUserInput",e[e.DependsOnSelfKind=3]="DependsOnSelfKind"})(Pt||(Pt={}));var xs=class extends de{constructor(){super(...arguments),this.name=void 0,this.lazy=!1,this.total=!0,this.pure=!0,this.proposedValueIsBuilt=!1}calculation(e){throw new Error("Abstract method `calculation` called")}equality(e,s){return e===s}};Qr([G(Pt.DependsOnSelfKind)],xs.prototype,"level",void 0),Qr([G(!0)],xs.prototype,"sync",void 0);var rt=class extends xs{constructor(){super(...arguments),this.context=void 0,this.isWritingUndefined=!1}newQuark(e){const s=this.quarkClass.new();return s.createdAt=e,s.identifier=this,s.needToBuildProposedValue=this.proposedValueIsBuilt,s}write(e,s,t,n,...r){t=t||s.getWriteTarget(e),t.proposedValue=n,t.proposedArguments=r.length>0?r:void 0,t.proposedIsPrevious=s.graph.isWritingPreviousData}writeToTransaction(e,s,...t){e.write(this,s,...t)}writeToGraph(e,s,...t){e.write(this,s,...t)}readFromGraphAsync(e){return e.readAsync(this)}readFromGraph(e){return e.read(this)}readFromTransaction(e){return e.read(this)}readFromTransactionAsync(e){return e.readAsync(this)}buildProposedValue(e,s,t){}enterGraph(e){}leaveGraph(e){}},vp=e=>rt.new(e),Zr=Bn.mix(zc.mix(Map)),Yc=Bn.mix(Wc.mix(Map)),Ts=class extends rt{calculation(e){throw new Error("The 'calculation' method of the variables should never be called. Instead, the value will be set directly to quark")}write(e,s,t,n,...r){t=t||s.getWriteTarget(e),t.value=n,t.proposedArguments=r.length>0?r:void 0}};Qr([G(Pt.UserInput)],Ts.prototype,"level",void 0),Qr([G(Zr)],Ts.prototype,"quarkClass",void 0);function Fa(...e){return Ts.new(...e)}var Xr=class extends rt{calculation(e){return e(X)}};Qr([G(Zr)],Xr.prototype,"quarkClass",void 0);function ja(...e){return Xr.new(...e)}var Mt=class extends rt{*calculation(e){return yield X}};Qr([G(Yc)],Mt.prototype,"quarkClass",void 0);function ka(...e){return Mt.new(...e)}var Ct=e=>{throw new Error(`Unknown identifier ${e}`)},yp=0,Vn=class extends de{constructor(){super(...arguments),this.createdAt=yp++,this.name="revision-"+this.createdAt,this.previous=void 0,this.scope=new Map,this.reachableCount=0,this.referenceCount=0,this.selfDependent=new Set}getLatestEntryFor(e){let s=this;for(;s;){const t=s.scope.get(e);if(t)return t;s=s.previous}return null}hasIdentifier(e){const s=this.getLatestEntryFor(e);return!!(s&&s.getValue()!==ee)}*previousAxis(){let e=this;for(;e;)yield e,e=e.previous}},Sp=class{constructor(){this.length=0,this.levels=[],this.lowestLevel=Zt}getLowestLevel(){for(let e=this.lowestLevel!==Zt?this.lowestLevel:0;e<this.levels.length;e++)if(this.levels[e])return this.lowestLevel=e;return this.lowestLevel=Zt}takeLowestLevel(){for(let e=this.lowestLevel!==Zt?this.lowestLevel:0;e<this.levels.length;e++){const s=this.levels[e];if(s)return this.length-=s.length,this.levels[e]=null,this.lowestLevel=e+1,s}}pop(){for(let e=this.lowestLevel!==Zt?this.lowestLevel:0;e<this.levels.length;e++){const s=this.levels[e];if(this.lowestLevel=e,s&&s.length>0)return this.length--,s.pop()}this.lowestLevel=Zt}push(e){const s=e.level;let t=this.levels[s];if(!t){for(let n=this.levels.length;n<s;n++)this.levels[n]=null;t=this.levels[s]=[]}t.push(e),this.length++,s<this.lowestLevel&&(this.lowestLevel=s)}*[Symbol.iterator](){for(let e=0;e<this.levels.length;e++){const s=this.levels[e];s&&(yield*s)}}},Un=class extends de{toString(){const e=[],s=[];return this.cycle.forEach(({name:t,context:n})=>{e.push(t),s[s.length-1]!==n&&s.push(n)}),`events: 
`+s.map(t=>"#"+t.id).join(" => ")+`

identifiers: 
`+e.join(`
`)}},Kc=class extends _a{constructor(){super(...arguments),this.transaction=void 0}onCycle(e,s){return It.Cancel}doCollectNext(e,s,t){let n=this.visited.get(s);n||(n={visitedAt:Kr,visitEpoch:this.currentEpoch},this.visited.set(s,n)),t.push({node:s,from:e,label:void 0})}collectNext(e,s){const t=this.transaction.getLatestEntryFor(e);t&&t.outgoingInTheFutureTransactionCb(this.transaction,n=>{this.doCollectNext(e,n.identifier,s)})}},Jc=class extends de{constructor(){super(...arguments),this.visited=new Map,this.transaction=void 0,this.baseRevision=void 0,this.pushTo=void 0,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e),this.walkDepth()}startNewEpoch(){if(this.toVisit.length)throw new Error("Can not start new walk epoch in the middle of the walk");this.currentEpoch++}onTopologicalNode(e,s){!e.lazy&&e.level!==Pt.UserInput&&this.pushTo.push(s)}onCycle(e,s){return It.Resume}doCollectNext(e,s,t){let n=this.visited.get(s);n||(n=s.newQuark(this.baseRevision),n.visitEpoch=this.currentEpoch,this.visited.set(s,n)),t.push(s)}collectNext(e,s,t){const n=this.baseRevision.getLatestEntryFor(e);n&&(t.previous=n,n.outgoingInTheFutureAndPastTransactionCb(this.transaction,r=>{this.doCollectNext(e,r.identifier,s)}));for(const r of t.getOutgoing().keys())this.doCollectNext(e,r,s);if(t.$outgoingPast!==void 0)for(const r of t.getOutgoingPast().keys())this.doCollectNext(e,r,s)}walkDepth(){const e=this.visited,s=this.toVisit;let t;for(;t=s.length;){const n=s[t-1];let r=e.get(n);if(r&&r.visitedAt===Rr&&r.visitEpoch===this.currentEpoch){r.edgesFlow++,s.pop();continue}if(r&&r.visitEpoch===this.currentEpoch&&r.visitedAt!==Kr){if(r.visitedAt<t){if(this.onCycle(n,s)!==It.Resume)break;r.edgesFlow++}else r.visitedAt=Rr,this.onTopologicalNode(n,r);s.pop()}else{const i=s.length;r||(r=n.newQuark(this.baseRevision),r.visitEpoch=this.currentEpoch,e.set(n,r)),this.collectNext(n,s,r),r.visitEpoch<this.currentEpoch&&r.resetToEpoch(this.currentEpoch),r.visitedAt=t,r.edgesFlow++,s.length===i&&(r.visitedAt=Rr,this.onTopologicalNode(n,r),s.pop())}}}},Os=Jr.Normal,wr=Jr.Past,La=class extends de{constructor(){super(...arguments),this.baseRevision=void 0,this.candidateClass=Vn,this.candidate=void 0,this.graph=void 0,this.isClosed=!1,this.walkContext=void 0,this.entries=new Map,this.stackGen=new Sp,this.activeStack=[],this.onEffectSync=void 0,this.onEffectAsync=void 0,this.propagationStartDate=0,this.lastProgressNotificationDate=0,this.startProgressNotificationsAfterMs=500,this.emitProgressNotificationsEveryMs=200,this.emitProgressNotificationsEveryCalculations=100,this.plannedTotalIdentifiersToCalculate=0,this.ongoing=Promise.resolve(),this.selfDependedMarked=!1,this.rejectedWith=void 0,this.stopped=!1,this.hasEntryWithProposedValue=!1,this.hasVariableEntry=!1}initialize(...e){super.initialize(...e),this.walkContext=Jc.new({visited:this.entries,transaction:this,baseRevision:this.baseRevision,pushTo:this.stackGen}),this.candidate||(this.candidate=this.candidateClass.new({previous:this.baseRevision})),this.onEffectSync=this.read.bind(this),this.onEffectAsync=this.readAsync.bind(this)}get dirty(){return this.entries.size>0}markSelfDependent(){if(!this.selfDependedMarked){this.selfDependedMarked=!0;for(const e of this.baseRevision.selfDependent){const s=this.entries.get(e);s&&s.getValue()===ee||this.touch(e)}}}getActiveEntry(){return this.activeStack[this.activeStack.length-1]}yieldAsync(e){return _n(e)?e:this.graph[e.handler](e,this)}yieldSync(e){if(_n(e))throw new Error("Can not yield a promise in the synchronous context");return this.graph[e.handler](e,this)}readAsync(e){if(!(e instanceof rt))return this.yieldAsync(e);let s;const t=this.getActiveEntry();if(t)s=this.addEdge(e,t,Os);else if(s=this.entries.get(e),!s){const n=this.baseRevision.getLatestEntryFor(e);n||Ct(e),s=n.hasValue()?n:this.touch(e)}return s.hasValue()?s.getValue():s.promise?s.promise:((!s.previous||!s.previous.hasValue())&&s.forceCalculation(),this.ongoing=s.promise=this.ongoing.then(()=>(async()=>{for(;this.stackGen.lowestLevel<e.level;)await Ms(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,this.stackGen.takeLowestLevel()],this);if(this.markSelfDependent(),s.getValue()===void 0)return Ms(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[s]],this)})()).then(()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);if(!s.hasValue())throw new Error("Computation cycle. Sync");return s.getValue()}))}get(e){if(!(e instanceof rt))return this.yieldSync(e);let s;const t=this.getActiveEntry();if(t)s=this.addEdge(e,t,Os);else if(s=this.entries.get(e),!s){const r=this.baseRevision.getLatestEntryFor(e);r||Ct(e),s=r.hasValue()?r:this.touch(e)}const n=s.getValue();if(n===ee&&Ct(e),n!==void 0&&s.hasValue())return n;if(s.promise)return s.promise;for((!s.previous||!s.previous.hasValue())&&s.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());if(this.markSelfDependent(),e.sync){this.calculateTransitionsStackSync(this.onEffectSync,[s]);const r=s.getValue();if(r===void 0)throw new Error("Cycle during synchronous computation");return r===ee&&Ct(e),r}else{const r=this.ongoing=s.promise=this.ongoing.then(()=>{if(s.getValue()===void 0)return Ms(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[s]],this)}).then(()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);const i=s.getValue();if(i===void 0)throw new Error("Computation cycle. Async get");return i===ee&&Ct(e),i});return Yr&&(r.quark=s),r}}read(e){if(!(e instanceof rt))return this.yieldSync(e);let s;const t=this.getActiveEntry();if(t)s=this.addEdge(e,t,Os);else if(s=this.entries.get(e),!s){const i=this.baseRevision.getLatestEntryFor(e);i||Ct(e),s=i.hasValue()?i:this.touch(e)}const n=s.getValue();if(n===ee&&Ct(e),n!==void 0)return n;for((!s.previous||!s.previous.hasValue())&&s.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());this.markSelfDependent(),this.calculateTransitionsStackSync(this.onEffectSync,[s]);const r=s.getValue();if(r===void 0)throw new Error("Cycle during synchronous computation");return r===ee&&Ct(e),r}readCurrentOrProposedOrPrevious(e){const s=this.entries.get(e);if(s){const t=s.getValue();if(t!==void 0)return t;if(s.proposedValue!==void 0)return s.proposedValue}return this.readPrevious(e)}readCurrentOrProposedOrPreviousAsync(e){const s=this.entries.get(e);if(s){const t=s.getValue();if(t!==void 0)return t;if(s.proposedValue!==void 0)return s.proposedValue}return this.readPreviousAsync(e)}readPrevious(e){const s=this.baseRevision.getLatestEntryFor(e);if(!s)return;const t=s.getValue();return t!==ee?t===void 0&&e.lazy?this.read(e):t:void 0}readPreviousAsync(e){const s=this.baseRevision.getLatestEntryFor(e);if(!s)return;const t=s.getValue();return t!==ee?t!==void 0?t:this.readAsync(e):void 0}readProposedOrPrevious(e){const s=this.entries.get(e);return s&&s.proposedValue!==void 0?s.proposedValue:this.readPrevious(e)}readProposedOrPreviousAsync(e){const s=this.entries.get(e);return s&&s.proposedValue!==void 0?s.proposedValue:this.readPreviousAsync(e)}write(e,s,...t){s===void 0&&(s=null),e.write.call(e.context||e,e,this,null,s,...t);const n=this.entries.get(e);this.hasVariableEntry=this.hasVariableEntry||!n.isShadow()&&e.level===Pt.UserInput,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||n.hasProposedValue()}getWriteTarget(e){return this.touch(e).startOrigin()}acquireQuarkIfExists(e){const s=this.entries.get(e);return s&&s.origin===s?s.origin:void 0}touch(e){const s=this.entries.get(e);(!s||s.visitEpoch<this.walkContext.currentEpoch)&&this.walkContext.continueFrom([e]);const t=s||this.entries.get(e);return t.forceCalculation(),t}hasIdentifier(e){const s=this.entries.get(e);return s&&s.getValue()===ee?!1:!!(s||this.baseRevision.getLatestEntryFor(e))}addIdentifier(e,s,...t){let n=this.entries.get(e);const r=!!n,i=e.level===Pt.UserInput;return n||(n=e.newQuark(this.baseRevision),n.previous=this.baseRevision.getLatestEntryFor(e),n.forceCalculation(),this.entries.set(e,n),!e.lazy&&!i&&this.stackGen.push(n),this.hasVariableEntry=this.hasVariableEntry||!n.isShadow()&&i,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||n.hasProposedValue()),(s!==void 0||i)&&(n.startOrigin(),(!(r&&(n.proposedValue!==void 0||n.value!==void 0))||n.proposedValue===ee||n.value===ee)&&(e.isWritingUndefined=s===void 0,e.write.call(e.context||e,e,this,n,s===void 0&&i?null:s,...t),e.isWritingUndefined=!1)),n.getValue()===ee&&(n.value=void 0),n.proposedValue===ee&&(n.proposedValue=void 0),e.enterGraph(this.graph),n}removeIdentifier(e){e.leaveGraph(this.graph),this.touch(e).startOrigin().setValue(ee),this.candidate.selfDependent.delete(e)}populateCandidateScopeFromTransitions(e,s){if(e.scope.size===0)e.scope=s;else for(const[t,n]of s)if(n.isShadow()){const r=e.getLatestEntryFor(t);n.getOutgoing().forEach((i,a)=>r.getOutgoing().set(a,i))}else e.scope.set(t,n)}preCommit(e){if(this.isClosed)throw new Error("Can not propagate closed revision");this.markSelfDependent(),this.isClosed=!0,this.propagationStartDate=Date.now(),this.plannedTotalIdentifiersToCalculate=this.stackGen.length}postCommit(){this.populateCandidateScopeFromTransitions(this.candidate,this.entries);const e=this.entries;return this.walkContext=void 0,{revision:this.candidate,entries:e,transaction:this}}commit(e){return this.preCommit(e),this.calculateTransitionsSync(this.onEffectSync),this.postCommit()}reject(e=Hr.new()){this.rejectedWith=e,this.walkContext=void 0}stop(){this.stopped=!0}clearRejected(){for(const e of this.entries.values())e.cleanup();this.entries.clear()}async commitAsync(e){return this.preCommit(e),this.ongoing=this.ongoing.then(()=>Ms(this.onEffectAsync,this.calculateTransitions,[this.onEffectAsync],this)).then(()=>this.postCommit())}getLatestEntryFor(e){let s=this.entries.get(e)||this.baseRevision.getLatestEntryFor(e);if(!(s&&s.getValue()===ee))return s}getLatestStableEntryFor(e){let s=this.entries.get(e);if(s){const t=s.getValue();return t===ee?void 0:t===void 0?this.baseRevision.getLatestEntryFor(e):s}else return this.baseRevision.getLatestEntryFor(e)}addEdge(e,s,t){if(s.identifier.level<e.level)throw new Error("Identifier can not read from higher level identifier");let r=this.entries.get(e);if(!r){const i=this.baseRevision.getLatestEntryFor(e);i||Ct(e),r=e.newQuark(this.baseRevision),r.setOrigin(i),r.previous=i,this.entries.set(e,r)}return r.addOutgoingTo(s,t),r}onQuarkCalculationCompleted(e,s){e.cleanup();const t=e.identifier,n=e.previous,r=!!(n&&n.hasValue()&&t.equality(s,n.getValue()));r?(n.outgoingInTheFutureAndPastTransactionCb(this,a=>{const o=this.entries.get(a.identifier);o&&o.edgesFlow--}),e.edgesFlow=Zt,e.setOrigin(n.origin),e.value=s):(e.startOrigin(),e.setValue(s));let i=!1;e.usedProposedOrPrevious&&(e.proposedValue!==void 0?t.equality(s,e.proposedValue)&&(i=!0):(r||!n&&s===null)&&(i=!0),i||this.candidate.selfDependent.add(t))}onReadIdentifier(e,s,t){const n=this.addEdge(e,s,Os);if(n.hasValue()||n.value!==void 0){const r=n.getValue();return r===ee&&Ct(e),s.continueCalculation(r)}else if(n.isShadow()){n.startOrigin(),n.forceCalculation(),t.push(n);return}else if(n.isCalculationStarted()){let r;return Kc.new({transaction:this,onCycle(a,o){return r=Un.new({cycle:Hc(o),requestedEntry:n,activeEntry:s}),It.Cancel}}).startFrom([n.identifier]),r}else{t.push(n),(!n.previous||!n.previous.hasValue())&&n.forceCalculation();return}}*calculateTransitions(e){const s=this.stackGen;for(;s.length;)yield*this.calculateTransitionsStackGen(e,s.takeLowestLevel())}calculateTransitionsSync(e){const s=this.stackGen;for(;s.length;)this.calculateTransitionsStackSync(e,s.takeLowestLevel())}*calculateTransitionsStackGen(e,s){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const t=this.entries,n=this.propagationStartDate,r=this.graph?this.graph.enableProgressNotifications:!1;let i=0;const a=this.activeStack;for(this.activeStack=s;s.length&&!this.rejectedWith&&!this.stopped;){if(r&&!(i++%this.emitProgressNotificationsEveryCalculations)){const h=Date.now();if(h-n>this.startProgressNotificationsAfterMs){const g=this.lastProgressNotificationDate;(!g||h-g>this.emitProgressNotificationsEveryMs)&&(this.lastProgressNotificationDate=h,this.graph.onPropagationProgressNotification({total:this.plannedTotalIdentifiersToCalculate,remaining:this.stackGen.length+s.length,phase:"propagating"}),this.activeStack=a,yield bs(0),this.activeStack=s)}}if(this.rejectedWith||this.stopped)break;const o=s[s.length-1],l=o.identifier;if(t.get(l)!==o){o.cleanup(),s.pop();continue}if(o.edgesFlow==0){o.edgesFlow--;const h=o.previous;h&&h.outgoingInTheFutureAndPastTransactionCb(this,f=>{const g=t.get(f.identifier);g&&g.edgesFlow--})}if(o.edgesFlow<0&&o.previous&&o.previous.origin){o.setOrigin(o.previous.origin),o.size===0&&t.delete(l),o.cleanup(),s.pop();continue}if(o.hasValue()||o.proposedValue===ee){o.cleanup(),s.pop();continue}const u=o.visitEpoch;let d=o.isCalculationStarted()?o.iterationResult:o.startCalculation(this.onEffectSync);for(;d&&!this.rejectedWith&&!this.stopped;){const h=d.value===void 0?null:d.value;if(o.isCalculationCompleted()){o.visitEpoch==u&&this.onQuarkCalculationCompleted(o,h),s.pop();break}else if(h instanceof rt){const f=this.onReadIdentifier(h,o,s);f instanceof Un?(this.walkContext.startNewEpoch(),yield*this.graph.onComputationCycleHandler(f),o.cleanupCalculation(),d=void 0):d=f}else if(h===Nn){s.pop();break}else{const f=yield h;if(f===Gr)break;if(o.visitEpoch===u)d=o.continueCalculation(f);else{s.pop();break}}}}this.activeStack=a}calculateTransitionsStackSync(e,s){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const t=this.entries,n=this.activeStack;for(this.activeStack=s;s.length&&!this.rejectedWith&&!this.stopped;){const r=s[s.length-1],i=r.identifier;if(t.get(i)!==r){r.cleanup(),s.pop();continue}if(r.edgesFlow==0){r.edgesFlow--;const c=r.previous;c&&c.outgoingInTheFutureAndPastTransactionCb(this,u=>{const d=t.get(u.identifier);d&&d.edgesFlow--})}if(r.edgesFlow<0&&r.previous&&r.previous.origin){r.setOrigin(r.previous.origin),r.size===0&&t.delete(i),r.cleanup(),s.pop();continue}if(r.hasValue()||r.proposedValue===ee){r.cleanup(),s.pop();continue}const o=r.visitEpoch;let l=r.isCalculationStarted()?r.iterationResult:r.startCalculation(this.onEffectSync);for(;l&&!this.rejectedWith&&!this.stopped;){const c=l.value===void 0?null:l.value;if(r.isCalculationCompleted()){r.visitEpoch==o&&this.onQuarkCalculationCompleted(r,c),s.pop();break}else if(c instanceof rt){const u=this.onReadIdentifier(c,r,s);u instanceof Un?(this.walkContext.startNewEpoch(),this.graph.onComputationCycleHandlerSync(u,this),r.cleanupCalculation(),l=void 0):l=u}else if(c===Nn){s.pop();break}else{const u=e(c);if(_n(u))throw new Error("Effect resolved to promise in the synchronous context, check that you marked the asynchronous calculations accordingly");if(u===Gr)break;if(r.visitEpoch===o)l=r.continueCalculation(u);else{s.pop();break}}}}this.activeStack=n}},Wn={rejectedWith:null},Qc=class extends de{constructor(){super(...arguments),this.handlers=[]}trigger(e){for(let s=0;s<this.handlers.length;s++)this.handlers[s](e)}},Zc=class extends de{constructor(){super(...arguments),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.baseRevision=Vn.new(),this.topRevision=void 0,this.historyLimit=0,this.listeners=new Map,this.isWritingPreviousData=!1,this.$activeTransaction=void 0,this.isCommitting=!1,this.enableProgressNotifications=!1,this.ongoing=Promise.resolve(),this._isInitialCommit=!0,this.autoCommitTimeoutId=null,this.autoCommit=!1,this.autoCommitMode="sync",this.autoCommitHandler=null,this.onWriteDuringCommit="throw",this.onComputationCycle="throw",this.transactionClass=La,this.isJustCleared=!1,this.$followingRevision=void 0}initialize(...e){super.initialize(...e),this.topRevision||(this.topRevision=this.baseRevision),this.autoCommit&&(this.autoCommitHandler=this.autoCommitMode==="sync"?s=>this.commit(s):async s=>this.commitAsync(s)),this.markAndSweep()}hasPendingAutoCommit(){return this.autoCommitTimeoutId!==null}get dirty(){return this.activeTransaction.dirty}clear(){this.reject(),this.unScheduleAutoCommit(),this.baseRevision.scope&&this.baseRevision.scope.clear(),this.baseRevision.previous=null,this.listeners.clear(),this.topRevision=this.baseRevision,this.$followingRevision=void 0,this.$activeTransaction=void 0,this.markAndSweep(),this.isJustCleared=!0}*eachReachableRevision(){let e=!0,s=0;for(const t of this.topRevision.previousAxis())yield[t,e||s<this.historyLimit],t===this.baseRevision?e=!1:e||s++}get isInitialCommit(){return this._isInitialCommit}set isInitialCommit(e){this._isInitialCommit=e}markAndSweep(){let e;const s=[];for(const[t,n]of this.eachReachableRevision())n?(t.reachableCount++,e=t):s.push(t),t.referenceCount++;s.unshift(e);for(let t=s.length-1;t>=1&&s[t].reachableCount===0;t--)this.compactRevisions(s[t-1],s[t])}compactRevisions(e,s){if(s.reachableCount>0||e.previous!==s)throw new Error("Invalid compact operation");if(s.referenceCount<=1){for(const[t,n]of e.scope)if(n.getValue()===ee)s.scope.delete(t);else{const r=s.scope.get(t);n.origin===n?r&&(r.clear(),r.clearProperties()):r&&n.origin===r?n.mergePreviousOrigin(e.scope):t.lazy&&!n.origin&&r&&r.origin&&(n.startOrigin().proposedValue=r.origin.value!==void 0?r.origin.value:r.origin.proposedValue),n.previous=void 0,s.scope.set(t,n)}Xg(e.selfDependent,s.selfDependent),e.scope=s.scope,s.scope=null}else e.scope=new Map(bc(s.scope,e.scope)),e.selfDependent=new Set(bc(s.selfDependent,e.selfDependent)),s.referenceCount--;e.previous=null}get followingRevision(){if(this.$followingRevision!==void 0)return this.$followingRevision;const e=Array.from(this.topRevision.previousAxis()),s=[];for(let t=e.length-1;t>0;t--)s.push([e[t],e[t-1]]);return this.$followingRevision=new Map(s)}get activeTransaction(){return this.$activeTransaction?this.$activeTransaction:this.$activeTransaction=this.transactionClass.new({baseRevision:this.baseRevisionTentative||this.baseRevision,graph:this})}branch(e){return this.constructor.new(Object.assign({},e,{baseRevision:this.baseRevision}))}propagate(e){return this.commit(e)}reject(e){this.activeTransaction.reject(Hr.new({reason:e})),this.ongoing=Promise.resolve(),this.$activeTransaction=void 0,this.baseRevisionTentative=void 0,this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable,this.baseRevisionStable=void 0)}commit(e){this.isJustCleared=!1,this.unScheduleAutoCommit(),this.baseRevisionStable=this.baseRevision;const t=this.activeTransaction.commit(e);this.$activeTransaction=void 0;const n=this.finalizeCommit(t);return this.baseRevisionStable=void 0,this.isInitialCommit=!1,n}async propagateAsync(e){return this.commitAsync(e)}async commitAsync(e){if(this.isCommitting)return this.ongoing;this.isJustCleared=!1,this.isCommitting=!0,this.baseRevisionStable=this.baseRevision;let s;return this.ongoing=this.ongoing.then(()=>this.doCommitAsync(e)).then(t=>(s=t,t)).finally(()=>{this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.isInitialCommit=!1,this.isCommitting=!1})}async doCommitAsync(e){this.unScheduleAutoCommit();const s=this.activeTransaction,t=await s.commitAsync(e),n=!!s.rejectedWith,r=this.baseRevisionTentative;if(n||(this.baseRevisionTentative=s.candidate),this.$activeTransaction=void 0,await this.finalizeCommitAsync(t),this.isJustCleared)return{rejectedWith:Hr.new({reason:"Graph cleared"})};s.rejectedWith&&!n&&(this.baseRevisionTentative=r,this.$activeTransaction=void 0);const i=this.finalizeCommit(t);return s.rejectedWith&&s.clearRejected(),this.dirty&&!s.rejectedWith&&await this.doCommitAsync(e),i}finalizeCommit(e){const{revision:s,entries:t,transaction:n}=e;if(n.rejectedWith)this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0;else{if(s.previous!==this.baseRevision)throw new Error("Invalid revisions chain");for(const[r,i]of this.eachReachableRevision())i&&r.reachableCount--,r.referenceCount--;this.baseRevision=this.topRevision=s;for(const[r,i]of t){if(i.cleanup(),i.isShadow()||!i.hasValue())continue;const a=this.listeners.get(r);a&&a.trigger(i.getValue())}this.$followingRevision=void 0,this.markAndSweep()}return{rejectedWith:n.rejectedWith}}async finalizeCommitAsync(e){}*onComputationCycleHandler(e){const s=new Error(`Computation cycle:
`+e);switch(s.cycle=e,this.onComputationCycle){case"ignore":console.log(s.message);const{requestedEntry:t,activeEntry:n}=e;return n.continueCalculation(t.proposedValue!==void 0?t.proposedValue:t.value);case"throw":throw s;case"reject":this.reject(s);break;case"warn":Ps(s);break}}onComputationCycleHandlerSync(e,s){const t=new Error(`Computation cycle:
`+e);switch(t.cycle=e,this.onComputationCycle){case"ignore":console.log(t.message);const{requestedEntry:n,activeEntry:r}=e;return r.continueCalculation(n.proposedValue!==void 0?n.proposedValue:n.value);case"throw":throw t;case"reject":this.reject(t);break;case"warn":Ps(t);break}}scheduleAutoCommit(){this.autoCommitTimeoutId===null&&!this.isCommitting&&(this.autoCommitTimeoutId=setTimeout(this.autoCommitHandler,10))}unScheduleAutoCommit(){this.autoCommitTimeoutId!==null&&(clearTimeout(this.autoCommitTimeoutId),this.autoCommitTimeoutId=null)}variable(e){const s=Fa();return this.addIdentifier(s,e===void 0?null:e)}variableNamed(e,s){const t=Fa({name:e});return this.addIdentifier(t,s===void 0?null:s)}identifier(e,s){const t=pa(e)?ka({calculation:e,context:s}):ja({calculation:e,context:s});return this.addIdentifier(t)}identifierNamed(e,s,t){const n=s.constructor.name==="GeneratorFunction"?ka({name:e,calculation:s,context:t}):ja({name:e,calculation:s,context:t});return this.addIdentifier(n)}addIdentifier(e,s,...t){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Adding identifier during commit");this.onWriteDuringCommit==="warn"&&Ps(new Error("Adding identifier during commit"))}return this.activeTransaction.addIdentifier(e,s,...t),this.autoCommit&&this.scheduleAutoCommit(),e}removeIdentifier(e){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Removing identifier during commit");this.onWriteDuringCommit==="warn"&&Ps(new Error("Removinfg identifier during commit"))}this.activeTransaction.removeIdentifier(e),this.listeners.delete(e),this.autoCommit&&this.scheduleAutoCommit()}hasIdentifier(e){return this.activeTransaction.hasIdentifier(e)}write(e,s,...t){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Write during commit");this.onWriteDuringCommit==="warn"&&Ps(new Error("Write during commit"))}this.activeTransaction.write(e,s,...t),this.autoCommit&&this.scheduleAutoCommit()}readPrevious(e){return this.activeTransaction.readPrevious(e)}readPreviousAsync(e){return this.activeTransaction.readPreviousAsync(e)}read(e){return this.activeTransaction.read(e)}readAsync(e){return this.activeTransaction.readAsync(e)}get(e){return this.activeTransaction.get(e)}observe(e,s){const t=this.addIdentifier(Mt.new({lazy:!1,calculation:e}));return this.addListener(t,s),t}observeContext(e,s,t){const n=this.addIdentifier(Mt.new({lazy:!1,calculation:e,context:s}));return this.addListener(n,t),n}addListener(e,s){let t=this.listeners.get(e);t||(t=Qc.new(),this.listeners.set(e,t)),t.handlers.push(s)}undo(){const s=this.baseRevision.previous;return s?(this.baseRevision=s,this.$activeTransaction=void 0,!0):!1}redo(){const e=this.baseRevision;if(e===this.topRevision)return!1;const s=this.followingRevision.get(e);return this.baseRevision=s,this.$activeTransaction=void 0,!0}onPropagationProgressNotification(e){}[ma](e,s){const t=s.getActiveEntry();t.usedProposedOrPrevious=!0;const n=t.getProposedValue(s);return n!==void 0?n:t.previous?t.identifier.lazy?t.previous.hasValue()?t.previous.getValue():t.previous.hasProposedValue()?t.previous.getProposedValue(s):null:s.readPrevious(t.identifier):void 0}[ws](e,s){return this.reject(e.reason),Gr}[va](e,s){return s}[ya](e,s){return s.getActiveEntry()}[Sa](e,s){return s.getActiveEntry().identifier}[Da](e,s){const t=s.getActiveEntry();if(t.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");const n=e.identifier.level>t.identifier.level;return n||s.walkContext.startNewEpoch(),s.write(e.identifier,...e.proposedArgs),n?void 0:Gr}[Ea](e,s){const t=s.getActiveEntry();if(t.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");let n=!0;return e.writes.forEach(r=>{r.identifier.level<=t.identifier.level&&n&&(s.walkContext.startNewEpoch(),n=!1),s.write(r.identifier,...r.proposedArgs)}),n?void 0:Gr}[Ra](e,s){const t=s.getActiveEntry(),n=e.identifier;return s.addEdge(n,t,wr),s.readPrevious(n)}[wa](e,s){const t=s.getActiveEntry(),n=e.identifier;s.addEdge(n,t,wr);const r=s.entries.get(n);return r&&!r.isShadow()?r.getProposedValue(s):void 0}[Ia](e,s){const t=s.getActiveEntry(),n=e.identifier;s.addEdge(n,t,wr);const r=s.entries.get(n);return r?r.hasProposedValue():!1}[Pa](e,s){const t=s.getActiveEntry(),n=e.identifier;s.addEdge(n,t,wr);const r=s.entries.get(n);return r?r.hasProposedValue()&&!r.proposedIsPrevious:!1}[Ma](e,s){const t=s.getActiveEntry(),n=e.identifier;return s.addEdge(n,t,wr),s.readProposedOrPrevious(n)}[Ta](e,s){return s.readProposedOrPrevious(e.identifier)}[Oa](e,s){return s.readPrevious(e.identifier)}[xa](e,s){const t=s.getActiveEntry(),n=e.identifier;s.addEdge(n,t,wr);const r=s.entries.get(n);return r&&!r.isShadow()?r.proposedArguments:void 0}},Xc=class extends de{constructor(){super(...arguments),this.name=void 0,this.ownFields=new Map,this.schema=void 0,this.$skeleton={},this.$allFields=void 0}hasField(e){return this.getField(e)!==void 0}getField(e){return this.allFields.get(e)}addField(e){const s=e.name;if(!s)throw new Error("Field must have a name");if(this.ownFields.has(s))throw new Error(`Field with name [${s}] already exists`);return e.entity=this,this.ownFields.set(s,e),e}forEachParent(e){let s=this;for(;s;)e(s),s=s.parentEntity}get allFields(){if(this.$allFields!==void 0)return this.$allFields;const e=new Map,s=new Set;return this.forEachParent(t=>{t.ownFields.forEach((n,r)=>{s.has(r)||(s.add(r),e.set(r,n))})}),this.$allFields=e}forEachField(e){this.allFields.forEach(e)}},Lt;(function(e){e[e.Current=0]="Current",e[e.Previous=1]="Previous",e[e.ProposedOrPrevious=2]="ProposedOrPrevious",e[e.CurrentOrProposedOrPrevious=3]="CurrentOrProposedOrPrevious"})(Lt||(Lt={}));var Na=class extends O([Zc],e=>class extends e{constructor(){super(...arguments),this.autoCommit=!0,this.readMode=Lt.Current}addEntity(t){t.enterGraph(this)}addEntities(t){t.forEach(n=>this.addEntity(n))}removeEntity(t){t.leaveGraph(this)}removeEntities(t){t.forEach(n=>this.removeEntity(n))}}){},ut=class extends O([rt],e=>class extends e{constructor(){super(...arguments),this.field=void 0,this.self=void 0,this.DATA=void 0}getFromGraph(t){return t?t.readMode===Lt.Current?t.get(this):t.readMode===Lt.Previous?t.activeTransaction.readPrevious(this):(t.readMode===Lt.ProposedOrPrevious&&t.activeTransaction.readProposedOrPrevious(this),t.activeTransaction.readCurrentOrProposedOrPrevious(this)):this.DATA}readFromGraph(t){return t?t.read(this):this.DATA}writeToGraph(t,n,...r){t?t.write(this,n,...r):this.DATA=n}leaveGraph(t){const n=t.activeTransaction.getLatestStableEntryFor(this);n&&(this.DATA=n.getValue()),super.leaveGraph(t)}toString(){return this.name}}){},As=class extends ut.mix(Xr){},Ba=class extends ut.mix(Mt){},Va=class extends ut.mix(Ts){},eu=class extends O([rt],e=>class extends e{constructor(){super(...arguments),this.entity=void 0,this.self=void 0}equality(){return!1}toString(){return`Entity identifier [${this.self}]`}}){},tu=class extends eu.mix(Mt){},es=class extends xs{constructor(){super(...arguments),this.persistent=!0}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?pa(e)?Ba:As:Va}},ru=Symbol("isEntity"),xt=class extends O([],e=>{class s extends e{[ru](){}get $entity(){return Ua(this.constructor.prototype)}get $(){const n={};if(this.$entity.forEachField((r,i)=>{n[i]=this.createFieldIdentifier(r)}),Yr){const r=new Proxy(n,{get(i,a,o){return i[a]||up(new Error(`Attempt to read a missing field ${String(a)} on ${i}`)),i[a].SOURCE_POINT=Uc.fromThisCall(),i[a]}});return $n(this,"$",r)}else return $n(this,"$",n)}get $$(){return $n(this,"$$",tu.new({name:this.$entityName,entity:this.$entity,calculation:this.calculateSelf,context:this,self:this}))}get $entityName(){return this.constructor.name||this.$entity.name}*calculateSelf(){return this}createFieldIdentifier(n){const r=n.name,i=this.$entity,a=this.constructor,o=i.$skeleton;o[r]||(o[r]=a.getIdentifierTemplateClass(this,n));const l=new o[r];return l.context=this,l.self=this,l.name=`${this.$$.name}.$.${n.name}`,l}forEachFieldIdentifier(n){this.$entity.forEachField((r,i)=>n(this.$[i],i,r))}enterGraph(n){if(this.graph)throw new Error("Already entered replica");this.graph=n,n.addIdentifier(this.$$),this.$entity.forEachField((r,i)=>{const a=this.$[i];n.addIdentifier(a,a.DATA),a.DATA=void 0})}leaveGraph(n){const r=this.graph,i=n||r;i&&(this.$entity.forEachField((a,o)=>i.removeIdentifier(this.$[o])),i.removeIdentifier(this.$$),i===r&&(this.graph=void 0))}propagate(n){return this.commit(n)}commit(n){const r=this.graph;return r?r.commit(n):Wn}async propagateAsync(){return this.commitAsync()}async commitAsync(n){const r=this.graph;return r?r.commitAsync(n):Promise.resolve(Wn)}static get $entity(){return Ir(this.prototype)}static getIdentifierTemplateClass(n,r){const i=r.name,a={name:`${n.$$.name}.$.${i}`,field:r};r.hasOwnProperty("sync")&&(a.sync=r.sync),r.hasOwnProperty("lazy")&&(a.lazy=r.lazy),r.hasOwnProperty("equality")&&(a.equality=r.equality);const o=n.$calculations&&n[n.$calculations[i]];o&&(a.calculation=o);const l=n.$writes&&n[n.$writes[i]];l&&(a.write=l);const c=n.$buildProposed&&n[n.$buildProposed[i]];c&&(a.buildProposedValue=c,a.proposedValueIsBuilt=!0);const u=r.getIdentifierClass(o).new(a),d=function(){};return d.prototype=u,d}run(n,...r){const i=c=>{if(c instanceof rt)return this.graph.read(c);throw new Error("Helper methods can not yield effects during computation")},a=this.graph.activeTransaction,o=a.activeStack;a.activeStack=[];const l=qc(i,this[n],r,this);return a.activeStack=o,l}static createPropertyAccessorsFor(n){const r=n,i=this.prototype;Object.defineProperty(i,r,{get:function(){return this.$[r].getFromGraph(this.graph)},set:function(a){this.$[r].writeToGraph(this.graph,a)}})}static createMethodAccessorsFor(n){const r=n,i=this.prototype,a=`get${fa(r)}`,o=`set${fa(r)}`,l=`put${fa(r)}`;a in i||(i[a]=function(){return this.$[r].getFromGraph(this.graph)}),o in i||(i[o]=function(c,...u){return this.$[r].writeToGraph(this.graph,c,...u),this.graph?this.graph.autoCommitMode==="sync"?this.graph.commit():this.graph.commitAsync():Promise.resolve(Wn)}),l in i||(i[l]=function(c,...u){this.$[r].writeToGraph(this.graph,c,...u)})}}return s}){},Ua=e=>{let s=Object.getPrototypeOf(e);return $n(e,"$entity",Xc.new({parentEntity:s.hasOwnProperty(ru)?null:s.$entity,name:e.constructor.name}))},Ir=e=>(e.hasOwnProperty("$entity")||Ua(e),e.$entity),qe=(e,s=es)=>function(t,n){const i=Ir(t).addField(s.new(Object.assign(e||{},{name:n}))),a=t.constructor;a.createPropertyAccessorsFor(n),a.createMethodAccessorsFor(n)},q=qe,j=function(e){return function(s,t,n){Ir(s);let r;s.$calculations?s.hasOwnProperty("$calculations")?r=s.$calculations:r=s.$calculations=Object.create(s.$calculations):r=s.$calculations={},r[e]=t}},dt=function(e){return function(s,t,n){Ir(s);let r;s.$writes?s.hasOwnProperty("$writes")?r=s.$writes:r=s.$writes=Object.create(s.$writes):r=s.$writes={},r[e]=t}},su=function(e){return function(s,t,n){Ir(s);let r;s.$buildProposed?s.hasOwnProperty("$buildProposed")?r=s.$buildProposed:r=s.$buildProposed=Object.create(s.$buildProposed):r=s.$buildProposed={},r[e]=t}},V;(function(e){e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"})(V||(V={}));var B;(function(e){e.MustStartOn="muststarton",e.MustFinishOn="mustfinishon",e.StartNoEarlierThan="startnoearlierthan",e.StartNoLaterThan="startnolaterthan",e.FinishNoEarlierThan="finishnoearlierthan",e.FinishNoLaterThan="finishnolaterthan",e.AsSoonAsPossible="assoonaspossible",e.AsLateAsPossible="aslateaspossible"})(B||(B={}));var me;(function(e){e.Normal="Normal",e.FixedDuration="FixedDuration",e.FixedEffort="FixedEffort",e.FixedUnits="FixedUnits"})(me||(me={}));var Pr;(function(e){e[e.NoError=0]="NoError",e[e.CyclicDependency=1]="CyclicDependency",e[e.DuplicatingDependency=2]="DuplicatingDependency"})(Pr||(Pr={}));var _e;(function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToStart=2]="EndToStart",e[e.EndToEnd=3]="EndToEnd"})(_e||(_e={}));var Mr;(function(e){e.Project="Project",e.FromEvent="FromEvent",e.ToEvent="ToEvent"})(Mr||(Mr={}));var ts;(function(e){e[e.SchedulerBasic=1]="SchedulerBasic",e[e.SchedulerPro=2]="SchedulerPro",e[e.Gantt=3]="Gantt"})(ts||(ts={}));var L;(function(e){e.Forward="Forward",e.Backward="Backward",e.None="None"})(L||(L={}));var $s=(e,s)=>e&&!s||!e&&s?!1:!e&&!s?!0:e.direction===s.direction&&(e.kind==="own"&&s.kind==="own"||e.kind==="enforced"&&s.kind==="enforced"&&e.enforcedBy===s.enforcedBy||e.kind==="inherited"&&s.kind==="inherited"&&e.inheritedFrom===s.inheritedFrom),ce;(function(e){e.Start="Start",e.End="End"})(ce||(ce={}));var he=new Date(-864e13),ae=new Date(864e13),Nt=e=>{if(!e)return!1;const s=e.getTime();return s!==he.getTime()&&s!==ae.getTime()},Wa=Symbol("RequiredProperties"),nu=Ln((e,s)=>{let t=e[Wa];t||(t=e[Wa]=[]),t.push(s)}),iu=Ln(e=>{const s=e[Wa];if(s){for(let t=0;t<s.length;t++)if(e[s[t]]===void 0)throw new Error(`Required attribute [${String(s[t])}] is not provided`)}}),Dp=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},au=0,Be=au++,fe=class extends de{constructor(){super(...arguments),this.formulaId=au++,this.inputs=new Set}},ou=class extends _a{collectNext(e,s){if(e instanceof fe)s.push({node:e.output,from:e,label:void 0});else{const t=this.cache.formulasByInput.get(e);t&&t.forEach(n=>s.push({node:n,from:e,label:void 0}))}}},zn=class extends O([de],e=>class extends e{constructor(){super(...arguments),this.variables=new Set,this.formulas=new Set,this.$formulasByInput=void 0,this.$formulasByOutput=void 0}get formulasByInput(){return this.$formulasByInput!==void 0?this.$formulasByInput:(this.fillCache(),this.$formulasByInput)}get formulasByOutput(){return this.$formulasByOutput!==void 0?this.$formulasByOutput:(this.fillCache(),this.$formulasByOutput)}add(t){this.$formulasByInput=void 0,this.$formulasByOutput=void 0,this.formulas.add(t)}has(t){return this.formulas.has(t)}fillCache(){this.$formulasByInput=new Map,this.$formulasByOutput=new Map,this.formulas.forEach(t=>{let n=this.$formulasByOutput.get(t.output);n||(n=new Set,this.$formulasByOutput.set(t.output,n)),n.add(t),t.inputs.forEach(r=>{let i=this.$formulasByInput.get(r);i||(i=new Set,this.$formulasByInput.set(r,i)),i.add(t)})})}allInputVariables(){return Ec(Rc(An(this.formulas,t=>t.inputs.values())))}isCyclic(){let t=!1;return ou.new({cache:this,onCycle:()=>(t=!0,It.Cancel)}).startFrom(Array.from(this.allInputVariables())),t}}){},Xt=class extends zn{},Fe=class extends de{constructor(){super(...arguments),this.description=void 0,this.defaultResolutionFormulas=new Set,this.resolutionsByInputHash=new Map}clear(){this.resolutionsByInputHash.clear()}resolve(e){const s=this.resolutionsByInputHash.get(e.hash);if(s!==void 0)return s;const t=this.buildResolution(e);return this.resolutionsByInputHash.set(e.hash,t),t}buildResolution(e){const s=qa.new({context:this,input:e}),t=Array.from(s.next()).map(n=>({resolution:n.asResolution(),nbrOfDefaultFormulas:Array.from(n.activatedFormulas.formulas).reduce((r,i)=>n.formulaIsDefault(i)?r+1:r,0),unCoveredInputWeight:n.unCoveredInputWeight()}));if(t.sort((n,r)=>n.unCoveredInputWeight<r.unCoveredInputWeight?-1:n.unCoveredInputWeight>r.unCoveredInputWeight?1:r.nbrOfDefaultFormulas-n.nbrOfDefaultFormulas),t.length>0)return t[0].resolution;debugger}},Tt;(function(e){e[e.NoInput=0]="NoInput",e[e.HasPreviousValue=1]="HasPreviousValue",e[e.HasProposedValue=2]="HasProposedValue",e[e.KeepIfPossible=4]="KeepIfPossible"})(Tt||(Tt={}));var za=class extends de{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.$hash=""}get hash(){return this.$hash!==""?this.$hash:this.$hash=this.buildHash()}get description(){return this.context.description}get resolution(){return this.context.resolve(this)}initialize(...e){super.initialize(...e),iu(this),this.input=new Map(Me(this.description.variables).map(s=>[s,Tt.NoInput]))}buildHash(){return String.fromCharCode(...Me(this.description.variables).inBatchesBySize(5).map(e=>this.batchToCharCode(e)))}batchToCharCode(e){return e.reduceRight((s,t,n)=>s|this.input.get(t)<<n*3,0)}addProposedValueFlag(e){if(Yr){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const s=this.input.get(e);this.input.set(e,s|Tt.HasProposedValue)}hasProposedValue(e){return!!(this.input.get(e)&Tt.HasProposedValue)}hasProposedValueVars(){return Me(this.description.variables).filter(e=>this.hasProposedValue(e))}addPreviousValueFlag(e){if(Yr){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const s=this.input.get(e);this.input.set(e,s|Tt.HasPreviousValue)}hasPreviousValue(e){return!!(this.input.get(e)&Tt.HasPreviousValue)}hasPreviousValueVars(){return Me(this.description.variables).filter(e=>this.hasPreviousValue(e))}addKeepIfPossibleFlag(e){if(Yr){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const s=this.input.get(e);this.input.set(e,s|Tt.KeepIfPossible)}keepIfPossible(e){return!!(this.input.get(e)&Tt.KeepIfPossible)}keepIfPossibleVars(){return Me(this.description.variables).filter(e=>this.keepIfPossible(e))}};Dp([nu],za.prototype,"context",void 0);var qa=class extends de{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.previous=void 0,this.activatedFormula=void 0,this.$activatedFormulas=void 0}get activatedFormulas(){if(this.$activatedFormulas!==void 0)return this.$activatedFormulas;const e=zn.new({variables:this.description.variables,formulas:Me(this.thisAndPreviousStates()).map(s=>s.activatedFormula).toSet()});return this.$activatedFormulas=e}get description(){return this.context.description}*thisAndPreviousStates(){let e=this;for(;e&&e.activatedFormula;)yield e,e=e.previous}formulaHasProposedValueInInput(e){return Array.from(e.inputs).some(s=>this.input.hasProposedValue(s))}unCoveredInputWeight(){const e=An(this.input.hasProposedValueVars(),n=>({variable:n,isProposed:!0})),s=An(this.input.keepIfPossibleVars(),n=>({variable:n,isProposed:!1}));return Me([e,s]).concat().uniqueOnlyBy(n=>n.variable).reduce((n,{variable:r,isProposed:i})=>{let a=0;const o=this.activatedFormulas.formulasByOutput.get(r);if(o){const c=o.size===1?Array.from(o)[0]:null;c&&this.formulaIsDefault(c)&&this.formulaHasProposedValueInInput(c)?i?a+=1e6:a+=1e4:i?a+=1e7:a+=1e5}const l=this.activatedFormulas.formulasByInput.get(r);return l&&l.size>0||(i?a+=1e3:a+=100),n+a},0)}preferFormula(e,s){const t=this.formulaAllInputsHasProposed(e),n=this.formulaAllInputsHasProposed(s);if(t&&!n)return-1;if(n&&!t)return 1;const r=this.formulaCountInputsWithProposedOrKeep(e),i=this.formulaCountInputsWithProposedOrKeep(s);return r>i?-1:r<i?1:this.formulaIsDefault(e)&&!this.formulaIsDefault(s)?-1:this.formulaIsDefault(s)&&!this.formulaIsDefault(e)?1:0}formulaIsDefault(e){return this.context.defaultResolutionFormulas.has(e)}formulaCountInputsWithProposedOrKeep(e){let s=0;return Array.from(e.inputs).forEach(t=>{(this.input.hasProposedValue(t)||this.input.keepIfPossible(t))&&s++}),s}formulaAllInputsHasProposedOrKeep(e){return Array.from(e.inputs).every(s=>this.input.hasProposedValue(s)||this.input.keepIfPossible(s))}formulaAllInputsHasProposed(e){return Array.from(e.inputs).every(s=>this.input.hasProposedValue(s))}formulaIsApplicable(e){const s=Array.from(e.inputs).every(n=>this.input.hasProposedValue(n)||this.input.hasPreviousValue(n)||this.activatedFormulas.formulasByOutput.has(n)),t=zn.new({formulas:new Set(this.activatedFormulas.formulas)});return t.add(e),s&&!t.isCyclic()}formulaIsInsignificant(e){const s=this.activatedFormulas.formulasByOutput.has(e.output),t=this.input.hasPreviousValue(e.output);return s||t&&Array.from(e.inputs).some(n=>!this.input.hasPreviousValue(n)&&!this.input.hasProposedValue(n)&&!this.activatedFormulas.formulasByOutput.has(n))}unvisitedFormulas(){return Array.from(this.description.formulas).filter(e=>!this.activatedFormulas.has(e))}*next(){const e=this.unvisitedFormulas();e.sort(this.preferFormula.bind(this));let s=!0;for(const t of e){if(!this.formulaIsApplicable(t)||this.formulaIsInsignificant(t))continue;yield*qa.new({previous:this,context:this.context,input:this.input,activatedFormula:t}).next(),s=!1}s&&(yield this)}asResolution(){return new Map(Me(this.description.variables).map(e=>{const s=this.activatedFormulas.formulasByOutput.get(e);if(s)for(const t of s)return[e,t.formulaId];return[e,Be]}))}},lu,Oe=class{static cacheFlags(e=navigator.platform,s=navigator.userAgent){const t=this;t._isLinux=!!e.match(/Linux/),t._isMac=!!e.match(/Mac/),t._isWindows=!!e.match(/Win32/),t._isMobile=!!(s.match(/Mobile|Opera Mini|Opera Mobi|Puffin/)||typeof globalThis.orientation=="number"),t._isWebkit=!!(s.match(/WebKit/)&&!s.match(/Edg/)),t._firefoxVersion=t.getVersion(s,/Firefox\/(\d+)\./),t._isFirefox=t._firefoxVersion>0,t._chromeVersion=t.getVersion(s,/Chrom(?:e|ium)\/(\d+)\./),t._isChrome=t._chromeVersion>0,t._isSafari=!!s.match(/Safari/)&&!t._isChrome,t._isMobileSafari=!!s.match(/Mobile.*Safari/),t._safariVersion=t.getVersion(s,/Version\/(.*).Safari/),t._isAndroid=!!s.match(/Android/g)}static get supportsOverflowClip(){if(this._supportsOverflowClip==null){const e=document.createElement("div");e.style.overflow="clip",e.style.display="none",document.documentElement.appendChild(e),this._supportsOverflowClip=e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("overflow")==="clip",e.remove()}return this._supportsOverflowClip}static get supportsSticky(){return!0}static getVersion(e,s){const t=e.match(s);return t?parseFloat(t[1]):0}static get isTouchDevice(){return this._isTouchDevice===void 0&&(this._isTouchDevice=globalThis.matchMedia("(pointer:coarse)").matches),this._isTouchDevice}static get isHoverableDevice(){return this._isHoverableDevice===void 0&&(this._isHoverableDevice=globalThis.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}static get isBrowserEnv(){return typeof window!="undefined"}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isAndroid(){return this._isAndroid}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get safariVersion(){return this._safariVersion}static get isMobileSafari(){return this._isMobileSafari}static get isMobile(){return this._isMobile}static get platform(){const e=this;return e._isLinux?"linux":e._isMac?"mac":e._isWindows?"windows":e._isAndroid?"android":e._isMobileSafari?"ios":null}static get supportsPassive(){return!0}static get supportsRandomUUID(){if(this._supportsRandomUUID===void 0)try{this._supportsRandomUUID=globalThis.crypto.randomUUID().length>0}catch(e){this._supportsRandomUUID=!1}return this._supportsRandomUUID}static get storageAvailable(){let e,s;try{return e=localStorage,s="__storage_test__",e.setItem(s,s),e.removeItem(s),!0}catch(t){return t instanceof DOMException&&(t.code===22||t.code===1014||t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e.length!==0}}static setLocalStorageItem(e,s){this.storageAvailable&&localStorage.setItem(e,s)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static searchParam(e,s=null,t=document.location.search){const n=new RegExp(`[?&]${e}=?([^&]*)`),r=t.match(n);return r&&r[1]||s}static getCookie(e){const s=encodeURIComponent(e)+"=",t=document.cookie.split(";");for(let n=0;n<t.length;n++){let r=t[n];for(;r.charAt(0)===" ";)r=r.substring(1,r.length);if(r.indexOf(s)===0)return decodeURIComponent(r.substring(s.length,r.length))}return""}static download(e,s){const t=document.createElement("a");t.download=e,t.href=s||e,t.style.cssText="display:none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}static downloadBlob(e,s){const t=globalThis.URL.createObjectURL(e);this.download(s,t),globalThis.URL.revokeObjectURL(t)}static get queryString(){var e;const s=new URL(globalThis.location.href).searchParams;return(e=Object.fromEntries)==null?void 0:e.call(Object,s.entries())}static copyToClipboard(e){let s=!0;const t=document.createElement("textarea");t.value=e,t.style.height=t.style.width=0,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(n){s=!1}return t.remove(),s}static isBryntumOnline(e){return e=Array.isArray(e)?e:[e],!!(/^(www\.)?bryntum\.com/.test(globalThis.location.host)||e!=null&&e.some(s=>this.queryString[s]!=null))}static get isCSP(){const{bryntum:e,document:s}=globalThis;return e.CSP==null&&(e.CSP=!!s.querySelector('meta[http-equiv="Content-Security-Policy"]')),e.CSP}};F(Oe,"supportsPointerEvents",!!(globalThis.PointerEvent||globalThis.MSPointerEvent)),F(Oe,"supportsPointerEventConstructor",typeof PointerEvent!="undefined"),F(Oe,"PointerEventConstructor",globalThis.PointerEvent||globalThis.CustomEvent),F(Oe,"isPhone",(lu=globalThis.matchMedia)==null?void 0:lu.call(globalThis,"(max-height:414px) or (max-width:414px)").matches),Oe.isBrowserEnv&&Oe.cacheFlags(),Oe._$name="BrowserHelper";var cu,uu,du,hu,fu=/([a-z])([A-Z])/g,Cp=/[\n\r]/g,Ep=/[.*+?^${}()|[\]\\]/g,bp=/[&<]/,Rp=/(^[^a-z]+[^\w]+)/gi,wp=/\s+/,Ip=/^[^a-z]+|[^\w:.-]+/gi,Pp=(e,s)=>uu[s.toLowerCase()]||String.fromCharCode(parseInt(s.substr(2),10)),Mp=(e,s)=>cu[s],xp=(e,s,t)=>`${s}-${t.toLowerCase()}`,Tp=(e,s,t)=>`${s} ${t.toLowerCase()}`,Op=e=>e?`_x${[...e].map(s=>s.charCodeAt(0).toString(16)).join("")}`:"__blank__",gu={},pu={},er=class{static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){const s=gu[e];return s||(gu[e]=e.replace(fu,xp))}static separate(e){const s=pu[e];return s||(pu[e]=this.capitalize(e.replace(fu,Tp)))}static createId(e){return String(e).replace(Rp,Op)}static makeValidDomId(e,s=""){return e==null?null:String(e).replace(Ip,s)}static escapeRegExp(e,s){let t=e.replace(Ep,"\\$&");return s!==void 0&&(t=new RegExp(t,s)),t}static decodeHtml(e){return e&&String(e).replace(hu,Pp)}static encodeHtml(e=""){return e&&String(e).replace(du,Mp)}static encodeHtmlBR(e){var s;return(s=er.encodeHtml(e))==null?void 0:s.replace(Cp,"<br>")}static isHtml(e){return typeof e=="string"&&bp.test(e||"")}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const s=Object.keys(e);cu=e,uu=s.reduce((t,n)=>(t[e[n]]=n,t),{}),du=new RegExp(`([${s.map(t=>"[-]".includes(t)?"\\"+t:t).join("")}])`,"g"),hu=new RegExp(`(${Object.values(e).join("|")}|&#[0-9]+;)`,"ig")}static safeJsonParse(e){let s=null;try{s=JSON.parse(e)}catch(t){}return s}static safeJsonStringify(e,s=null,t=null){let n=null;try{n=JSON.stringify(e,s,t)}catch(r){}return n}static joinPaths(e,s="/"){return e.join(s).replace(new RegExp("\\"+s+"+","g"),s)}static split(e,s=wp){let t=e;return typeof t=="string"&&(t=e.trim(),t=t?t.split(s):[]),t}static xss(e,...s){const t=[];let n=s.length;for(t[n]=e[n];n-- >0;)t[n]=e[n]+er.encodeHtml(s[n]);return t.join("")}static xssBR(e,...s){const t=[];let n=s.length;for(t[n]=e[n];n-- >0;)t[n]=e[n]+er.encodeHtmlBR(s[n]);return t.join("")}static toJavaScriptValue(e,s){const t=_.typeOf(e);if(t==="boolean"||t==="string"||t==="number"||e===null)return er.safeJsonStringify(e);if(e===globalThis)return"window";if(t==="date")return`new Date(${e.getFullYear()}, ${e.getMonth()}, ${e.getDate()}, ${e.getHours()}, ${e.getMinutes()}, ${e.getSeconds()}, ${e.getMilliseconds()})`;if(t==="array")return`[${e.map(n=>er.toJavaScriptValue(n,s))}]`;if(t==="object"||t==="instance")return this.toJavaScriptString(e,s);if(t==="function"){let n=e.toString();return n.match(/^async (\w+?)\(/)?n=n.replace(/^async (\w+?)\(/,"async function("):!n.startsWith("async(")&&n.match(/^(\w+?)\(/)&&(n=n.replace(/^(\w+?)\(/,"function(")),n}if(t==="class")return e.toJavaScriptValue?e.toJavaScriptValue(s):Object.prototype.hasOwnProperty.call(e,"$name")?e.$name:e.name}static toJavaScriptString(e,s={}){var t;const n=(t=s.level)!=null?t:0,r=2;return`{
`+Object.keys(e).map(i=>" ".repeat((n+1)*r)+(i.match(/[- *]/)?`"${i}"`:i)+`: ${er.toJavaScriptValue(e[i],{...s,level:n+1})}`).join(`,
`)+`
`+" ".repeat(n*r)+"}"}static encodeAttributeSelector(e,s){return`[${e}="${String(s).replace(/["\\]/g,"\\$&")}"]`}static generateUUID(){var e;return Oe.supportsRandomUUID?globalThis.crypto.randomUUID():(e=globalThis.crypto)!=null&&e.getRandomValues?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,s=>(s^globalThis.crypto.getRandomValues(new Uint8Array(1))[0]&15>>s/4).toString(16)):`${Date.now()}-${++er.fakeNodeUUIDIndex}`}},U=er;F(U,"fakeNodeUUIDIndex",0),U.initHtmlEntities(),U._$name="StringHelper";var{hasOwnProperty:Ap,toString:$p}=Object.prototype,{isFrozen:mu}=Object,_p=/\s*<\s*/,Fp=/\s*>\s*/,vu={},yu={},Su=Object.freeze({}),_=class{static assign(e,...s){for(let t,n,r=0;r<s.length;r++)if(t=s[r],t)for(n in t)e[n]=t[n];return e}static assignIf(e,...s){for(let t,n,r=0;r<s.length;r++)if(t=s[r],t)for(n in t)(!(n in e)||e[n]===void 0)&&(e[n]=t[n]);return e}static blend(e,s,t){t=t||vu,e=e||{};const{clone:n=_.clone,merge:r=_.blend}=t;if(Array.isArray(s)){if(s.length>1)return s.forEach(i=>{e=_.blend(e,i,t)}),e;s=s[0]}if(s){let i,a,o;for(a in s)o=s[a],o&&_.isObject(o)&&(i=e[a],t.key=a,i&&_.isObject(i)?(mu(i)&&(e[a]=i=n(i,t)),o=r(i,o,t)):o=mu(o)?o:n(o,t)),e[a]=o}return e}static clone(e,s){let t=e,n;if(e&&typeof e=="object")if(s&&typeof s=="object"&&s&&(s=null),_.isObject(e))if(e.skipClone)t=e;else{t={};for(n in e)t[n]=_.clone(e[n])}else if(Array.isArray(e))for(t=[],n=e.length;n-- >0;)t[n]=_.clone(e[n]);else _.isDate(e)?t=new Date(e.getTime()):s&&(t=s(e));return t}static createTruthyKeys(e){const s=U.split(e),t=s&&{};if(s)for(const n of s)n&&(t[n]=!0);return t}static getPath(e,s){return s.split(".").reduce((t,n)=>(t||Su)[n],e)}static getPathDefault(e,s,t){const n=Array.isArray(s)?s:typeof s=="string"?s.split("."):[s],r=n.length-1;return n.reduce((i,a,o)=>(t&&!(a in i)&&(i[a]=o===r?t:{}),(i||Su)[a]),e)}static hasPath(e,s){return s.split(".").every(t=>e&&t in e?(e=e[t],!0):!1)}static getTruthyKeys(e){const s=[];for(const t in e)e[t]&&s.push(t);return s}static getTruthyValues(e){const s=[];for(const t in e)e[t]&&s.push(e[t]);return s}static isClass(e){var s;return typeof e=="function"&&((s=e.prototype)==null?void 0:s.constructor)===e}static isDate(e){return!!(e!=null&&e.getUTCDate)&&_.typeOf(e)==="date"}static isPromise(e){if(Promise&&Promise.resolve)return Promise.resolve(e)===e||typeof(e==null?void 0:e.then)=="function";throw new Error("Promise not supported in your environment")}static isEmpty(e){if(e&&typeof e=="object")for(const s in e)return!1;return!0}static isObject(e){const s=e==null?void 0:e.constructor;return!!(s?s===Object||s.getPrototypeOf&&s.prototype&&!Object.getPrototypeOf(s.prototype):e&&typeof e=="object")}static isInstantiated(e){return e?typeof e=="object"&&!_.isObject(e):!1}static merge(e,...s){return _.blend(e,s)}static mergeItems(e,s,t){t=t||vu;let n,r,i,a,o,l,c;const{merge:u=_.blend}=t;if(e=e||{},Array.isArray(s))s.forEach(d=>{e=_.mergeItems(e,d,t)});else if(s)for(o in s)if(c=s[o],n=null,o.includes(">")?([o,n]=o.split(Fp),r=0):o.includes("<")&&([n,o]=o.split(_p),r=1),o in e)c&&e[o]&&u&&(t.key=o,c=u(e[o],c,t)),e[o]=c;else if(!n)e[o]=c,a==null||a.set(o,a.size);else{if(!a){a=new Map,i=0;for(const d in e)a.set(d,i++)}if(i=a.get(n),e[o]=c,i==null&&r)i=a.size;else{l=l||[],i=(i||0)+r;for(const d of a){const[h,f]=d;i<=f&&(l&&(l[a.size-f-1]=h),a.set(h,f+1))}if(l)for(;l.length;){const d=l.pop(),h=e[d];delete e[d],e[d]=h}}a.set(o,i)}return e}static setPath(e,s,t){return s.split(".").reduce((n,r,i,a)=>i===a.length-1?n[r]=t:(n[r]instanceof Object||(n[r]={}),n[r]),e),e}static typeOf(e){let s,t;return e===null?t="null":e!==e?t="nan":(t=typeof e,t==="object"?e.isBase?t="instance":Array.isArray(e)?t="array":(t=yu[s=$p.call(e)])||(yu[s]=t=s.slice(8,-1).toLowerCase()):t==="function"&&e.isBase&&(t="class")),t}};Object.defineProperty(_,"hasOwn",{value:Object.hasOwn||((e,s)=>Ap.call(e,s))}),_._$name="Objects";var Se=class{static setVersion(e,s){e=e.toLowerCase(),ht[e]={version:s,isNewerThan(r){return Se.semanticCompareVersion(r,s,"<")},isOlderThan(r){return Se.semanticCompareVersion(r,s,">")}};let t="";typeof productName!="undefined"&&(t=productName);const n=`${t}.${e}${s.replace(/\./g,"-")}`;if(Oe.isBrowserEnv&&!globalThis.bryntum.silenceBundleException)if(globalThis.bryntum[n]===!0)if(this.isTestEnv)globalThis.BUNDLE_EXCEPTION=!0;else{let r=t||e;r==="core"&&(r="grid");let i=U.capitalize(r);throw r==="schedulerpro"&&(i="SchedulerPro"),new Error(`The Bryntum ${i} bundle was loaded multiple times by the application.

Common reasons you are getting this error includes:

* Imports point to different types of the bundle (e.g. *.module.js and *.umd.js)
* Imports point to both sources and bundle
* Imports do not use the shortest relative path, JS treats them as different files
* Cache busters differ between imports, JS treats ${r}.module.js?1 and ${r}.module.js?2 as different files
* Imports missing file type, verify they all end in .js

See https://bryntum.com/products/${r}/docs/guide/${i}/gettingstarted/es6bundle#troubleshooting for more information

`)}else globalThis.bryntum[n]=!0}static getVersion(e){if(e=e.toLowerCase(),!ht[e])throw new Error("No version specified! Please check that you import VersionHelper correctly into the class from where you call `deprecate` function.");return ht[e].version}static semanticCompareVersion(e,s,t="="){e=e||"",s=s||"";const n=e.split(/[-.]/),r=s.split(/[-.]/),i=t.includes("<"),a=(l,c)=>{const u=["rc","beta","alpha"],d=l.map(h=>{if(u.includes(h))return-u.indexOf(h)-2;const f=Number.parseInt(h);return Number.isNaN(f)?-u.length:f});for(;d.length<c;)d.push(-1);return d},o=()=>{const l=Math.max(n.length,r.length),c=a(n,l),u=a(r,l);for(let d=0;d<l;d++)if(c[d]!==u[d])return i?c[d]<u[d]:c[d]>u[d];return!0};switch(t){case"=":return e===s;case"<=":case">=":return e===s||o();case"<":case">":return e!==s&&o()}return!1}static checkVersion(e,s,t){return Se.semanticCompareVersion(ht.getVersion(e),s,t)}static deprecate(e,s,t){if(ht.checkVersion(e,s,"<"))console.warn(`Deprecation warning: You are using a deprecated API which will change in v${s}. ${t}`);else throw new Error(`Deprecated API use. ${t}`)}static get isTestEnv(){var e,s,t;const n=!!((e=globalThis.bryntum)!=null&&e.isTestEnv);try{return n||!!((t=(s=globalThis.parent)==null?void 0:s.bryntum)!=null&&t.isTestEnv)}catch(r){return n}}static get isDebug(){return!1}},ht=Se;Oe.isBrowserEnv&&(ht.isTestEnv&&(Oe._isHoverableDevice=!0),globalThis.bryntum=Object.assign(globalThis.bryntum||{},{getVersion:ht.getVersion.bind(ht),checkVersion:ht.checkVersion.bind(ht),deprecate:ht.deprecate.bind(ht),license:"%LICENSE%"})),Se._$name="VersionHelper";var{defineProperty:qn,getOwnPropertyDescriptor:Du}=Reflect,{hasOwnProperty:Cu,toString:Ga}=Object.prototype,Ha=Symbol("instanceProperties"),Eu=Symbol("configuring"),rs=Symbol("lazyConfigValues"),bu=Ga.call(new Date),jp=/\s+/,kp=(e,s)=>(e[s]=1,e),ue=class{static get(e,s){const{cache:t}=this,n=t[e]||(t[e]=new ue(e));let r=n,i;return s&&(i=ue.makeCacheKey(e,s),(r=i&&t[i])||(r=n.extend(s),i&&(t[i]=r))),r}constructor(e){const s=this,t=e[0].toUpperCase()+e.substr(1);s.base=s,s.name=e,s.field="_"+e,s.capName=t,s.changer="change"+t,s.initializing="initializing"+t,s.updater="update"+t}get descriptor(){let e=this._descriptor;return(!e||!Cu.call(this,"_descriptor"))&&(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return(!e||!Cu.call(this,"_initDescriptor"))&&(this._initDescriptor=e=this.makeInitter()),e}equal(e,s){return e===s}extend(e){const s=Object.assign(Object.create(this),e),{equal:t,merge:n}=e,{equalityMethods:r}=ue;return typeof t=="string"&&(t.endsWith("[]")?s.equal=ue.makeArrayEquals(r[t.substr(0,t.length-2)]):s.equal=r[t]),typeof n=="string"&&(s.merge=ue.mergeMethods[n]),s}define(e){const s=Du(e,this.name);let t=this.descriptor;s&&s.get&&(t=Object.assign({},t),t.get=s.get),qn(e,this.name,t)}defineInitter(e,s){const{name:t}=this,n=e[Ha];let r,i;!n[t]&&(i=Du(e,t))&&!("value"in i)&&(n[t]=i),qn(e,t,this.initDescriptor),this.lazy&&(r=e[rs]||(e[rs]=new Map),r.set(t,s))}static makeArrayEquals(e){return(s,t)=>{let n,r=s&&t&&s.length===(n=t.length);if(r&&Array.isArray(s)&&Array.isArray(t))if(e)for(;r&&n-- >0;)r=e(s[n],t[n]);else for(;r&&n-- >0;)r=s[n]===t[n];else r=e?e(s,t):s===t;return r}}static makeCacheKey(e,s){const t=Object.keys(s).sort();for(let n,r,i,a=t.length;a-- >0;)if(i=s[n=t[a]],i==null&&i===!1)t.splice(a,1);else{if(r=typeof i,r==="function")return null;r==="string"?t[a]=`${n}:"${i}"`:r==="number"&&(t[a]=`${n}:${i}`)}return t.length?`${e}>${t.join("|")}`:e}makeDescriptor(){const e=this,{base:s,field:t,changer:n,updater:r,name:i}=e;return s!==e&&s.equal===e.equal?s.descriptor:{get(){var a;return(a=this.configObserver)==null||a.get(i,this),this[t]},set(a){var o,l;const c=this;let u=c[t],d,h;if(typeof a=="string"){let f=a;a.startsWith("up.")?f=(o=c.owner)==null?void 0:o.resolveProperty(a.substr(3)):a.startsWith("this.")&&(f=c.resolveProperty(a.substr(5))),f!==void 0&&typeof f!="function"&&(a=f)}c[n]&&(d=(h=c[n](a,u))===void 0,d||(a=h,u=c[t])),!d&&!(e.equal===Ru?u===a:e.equal(u,a))&&(c[t]=a,d=!0,(l=c[r])==null||l.call(c,a,u)),d&&!c.isDestroyed&&!c.onConfigChange.$nullFn&&c.onConfigChange({name:i,value:a,was:u,config:e})}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:s,name:t}=e;return{configurable:!0,get(){const n=this;return e.removeInitter(n),n[s]=!0,n[t]=n[Eu][t],n[s]=!1,n.configDone[t]=!0,n[t]},set(n){e.removeInitter(this),this.configDone[t]=!0,this[t]=n}}}makeLazyInitter(){const e=this,{initializing:s,name:t}=e;return{configurable:!0,get(){const n=this,r=n[rs].get(t);return e.removeInitter(n),n.isDestroying||(n[s]=!0,n[t]=r,n[s]=!1),n[t]},set(n){e.removeInitter(this),this[t]=n}}}removeInitter(e){const{name:s}=this,t=e[Ha][s],n=e[rs];t?qn(e,s,t):delete e[s],n!=null&&n.delete(s)&&!n.size&&delete e[rs]}setDefault(e,s){qn(e.prototype,this.field,{configurable:!0,writable:!0,value:s})}merge(e,s){if(s&&e&&_.isObject(e)){if(s.isBase)return s.setConfig(e);_.isObject(s)&&(e=_.merge(_.clone(s),e))}return e}},{prototype:_s}=ue,{equal:Ru}=_s;ue.symbols={configuring:Eu,instanceProperties:Ha,lazyConfigs:rs},ue.cache=Object.create(null),ue.equalityMethods={array:ue.makeArrayEquals(),date(e,s){return e===s?!0:e&&s&&Ga.call(e)===bu&&Ga.call(s)===bu?e.getTime()===s.getTime():!1},strict:ue.equal=Ru},ue.mergeMethods={distinct(e,s){let t=s?s.slice():[];if(e!=null)if(_.isObject(e))if(s===void 0)t=e;else{let n,r;for(n in e)r=t.indexOf(n),e[n]?r<0&&t.push(n):r>-1&&t.splice(r,1)}else Array.isArray(e)?e.forEach(n=>!t.includes(n)&&t.push(n)):t.includes(e)||t.push(e);return t},merge:ue.merge=_s.merge,classList(e,s){if(typeof e=="string"){if(!e.length)return s;e=e.split(jp)}return Array.isArray(e)&&(e=e.reduce(kp,{})),ue.merge(e,s)},objects(e,s){return e===!0?s||{}:ue.merge(e,s)},replace(e){return e},items(e,s,t,n){return n?_.mergeItems(s,e,{merge:(r,i)=>_s.merge(i,r)}):_s.merge(e,s)}},Object.assign(_s,{_descriptor:null,_initDescriptor:null,lazy:!1,nullify:!1,render:!1}),ue._$name="Config";var Lp=class{constructor(e){e&&Object.assign(this,e)}getInherited(e,s=!0){var t;let n=this[e];return e in this||(n=(t=this.super)==null?void 0:t.getInherited(e,s),(n||s)&&(this[e]=n=Object.create(n||null))),n}},{getPrototypeOf:wu}=Object,{hasOwn:Ot}=_,{defineProperty:Iu}=Reflect,Gn=Symbol("classMetaData"),Pu=Symbol("mixinTag"),Ya=Symbol("originalConfig"),Py=Symbol("createdAt"),Bt=ue.symbols.configuring,Np=ue.symbols.instanceProperties,Fs=ue.symbols.lazyConfigs,Bp={merge:"replace",simple:!0},Hn=()=>{},Mu=e=>new Lp(e),xu={},Vp=Object.freeze({}),Tu=Object.freeze([]),$=class{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const s=this,t=s.constructor;s.$meta.class!==t&&Hn(t.$meta),s.construct(...e),s.afterConstruct(),s.isConstructing=!1}static new(...e){return e=e.filter(s=>s),new this(e.length>1?this.mergeConfigs(...e):e[0])}construct(...e){e[0]!==null&&this.configure(...e),this.afterConfigure()}static destroy(...e){const s=t=>{t!=null&&t.destroy?t.destroy():Array.isArray(t)&&t.forEach(s)};s(e)}destroy(){const e=this,{id:s}=e;e.isDestroying=!0,e.destroy=Hn,e.doDestroy(),Object.setPrototypeOf(e,null);for(const t in e)t!=="destroy"&&t!=="isDestroying"&&delete e[t];delete e[Ya],e.isDestroyed=!0,e.id=s}_thisIsAUsedExpression(e){}static get $$name(){return Ot(this,"$name")&&this.$name||Ot(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,s,t=Tu){const{handler:n,thisObj:r}=this.resolveCallback(e,s==="this"?this:s)||Vp;return n==null?void 0:n.apply(r,t)}resolveProperty(e){let s=this;for(;s;){if(_.hasPath(s,e))return _.getPath(s,e);s=s.owner}}resolveCallback(e,s=this,t=!0){if(e!=null&&e.substring){if(e.endsWith("?")&&(t=!1,e=e.substring(0,e.length-1)),e.startsWith("up.")){for(e=e.substring(3),s=this.owner;s&&!s[e];s=s.owner);if(!s)return}else e.startsWith("this.")&&(e=e.substring(5),s=this);if(!s||!(s instanceof Object))return;e=s[e]}if(typeof e=="function")return{handler:e,thisObj:s};if(t)throw new Error(`No method named ${e} on ${s.$$name||"thisObj object"}`)}bindCallback(e,s=this){if(e){const{handler:t,thisObj:n}=this.resolveCallback(e,s);if(t)return t.bind(n)}}delay(e,s,t=e.name||e){return e=this.setTimeout?e:e.bind(this),(this.setTimeout?this:globalThis)[typeof s=="number"?"setTimeout":"requestAnimationFrame"](e,s,t)}doDestroy(){const e=this,{nullify:s}=e.$meta;if(s)for(let t=0;t<s.length;++t)e[s[t].field]!=null&&(e[s[t].name]=null)}destroyProperties(...e){var s,t;const n=this;let r;for(r of e)r in n&&(!n[Bt]||!n[Bt][r])&&((t=(s=n[r])==null?void 0:s.destroy)==null||t.call(s),delete n[r])}configure(e={}){const s=this,t=s.$meta,{beforeConfigure:n}=e,r=t.configs,i=s.getDefaultConfiguration();let a,o,l;s.initialConfig=e,s.isConfiguring=!0,Object.assign(s,s.getProperties());for(o in e)l=e[o],a=r[o],i[o]=a?a.merge(l,i[o],null,t):l;n&&(delete i.beforeConfigure,n(s,i)),s.setConfig(s[Ya]=i,!0),s.isConfiguring=!1}getConfig(e){return this[e]}setConfig(e,s){var t;const n=this,r=n[Bt],i=r?n.configDone:n.configDone={},a=n.$meta.configs;let o,l;n[Np]={},n[Bt]=r?Object.setPrototypeOf(Object.assign({},e),r):e;for(l in e)e[l]!=null||Ot(e,l)?(o=a[l]||ue.get(l),o.defineInitter(n,e[l]),s||(i[l]=!1)):i[l]=!0;s&&n.startConfigure(e);for(l in e)!i[l]&&!((t=a[l])!=null&&t.lazy)&&(n[l]=e[l]);return r?n[Bt]=r:delete n[Bt],s&&n.finishConfigure(e),n}hasConfig(e){var s;const t=this,n=t[Bt];return!!(t["_"+e]!=null||((s=t[Fs])==null?void 0:s.get(e))!=null||!t.configDone[e]&&n&&(n[e]!=null||Ot(n,e)))}peekConfig(e){const s=this,t=s[Fs],n=s[Bt];if(t!=null&&t.has(e))return t.get(e);if(n&&e in n){if(s.configDone[e])return s[e];if(n[e]!=null||Ot(n,e))return n[e]}}triggerConfig(e){const s=this,{configDone:t}=s,n=s[Fs],r=s[Bt],i=n!=null&&n.has(e)||r&&(r[e]!=null||Ot(r,e))?!t[e]:null;return i&&s.getConfig(e),i}triggerConfigs(e){const s=this,t=s.$meta.configs,n=s[Fs],r=n?[...n.keys()].filter(i=>t[i].lazy===e):Tu;for(const i of r)s.triggerConfig(i);return r.length?r:null}onConfigChange(){}get config(){const e={},s=this[Ya];for(const t in s)e[t]=s[t];return e}static processConfigValue(e,s){if(e===globalThis)return globalThis;if(Array.isArray(e))return e.map(t=>$.processConfigValue(t,s));if(e instanceof $)return s.visited.has(e)?void 0:e.getCurrentConfig(s);if(e instanceof HTMLElement||e instanceof DocumentFragment)return null;if(_.isObject(e)){const t={};for(const n in e)n!=="owner"&&(t[n]=$.processConfigValue(e[n],s));return t}return e}getConfigValue(e,s){var t;const n=this,r=n[Fs];if(!((t=n.$meta.configs[e])!=null&&t.lazy))return $.processConfigValue(n[e],s);if(r!=null&&r.has(e))return $.processConfigValue(r.get(e),s)}preProcessCurrentConfigs(){}getCurrentConfig(e={}){const s=this,t=e.configs==="all"?s.config:_.clone(s.initialConfig),n=e.visited||(e.visited=new Set),r=e.depth||(e.depth=0),i={};if(!n.has(s)){n.add(s),this.preProcessCurrentConfigs(t);for(const a in t){const o=s.getConfigValue(a,{...e,depth:r+1});o!==void 0&&(i[a]=o)}return i}}getConfigString(e={}){return U.toJavaScriptString(this.getCurrentConfig(e))}getTestCase(e={}){const s=this.isGantt?"Gantt":this.isSchedulerPro?"SchedulerPro":this.isCalendar?"Calendar":this.isScheduler?"Scheduler":this.isGrid?"Grid":this.isTaskBoard?"TaskBoard":null;if(s){const t=s.toLowerCase(),n=`../../build/${t}.module.js`;let r,i;e.import==="static"?(r=`import * as module from "${n}";Object.assign(window, module);`,i=""):(r=`import("${n}").then(module => { Object.assign(window, module);
`,i="});");const a=Se.getVersion(t);return a&&(r+=`
console.log('${s} ${a}');
`),`${r}      
const ${t} = new ${s}(${this.getConfigString(e)});
${i}`}}downloadTestCase(e={}){e.output="return";const s=this.getTestCase(e);Oe.download("app.js","data:application/javascript;charset=utf-8,"+escape(s))}static initClass(){return this.$meta.class}static get $meta(){const e=this;let s=e[Gn];return Ot(e,Gn)||(e[Gn]=s=Mu(),s.class=e,e.setupClass(s)),s}static onClassMixedIn(){}static mergeConfigs(e,...s){const t=this.$meta.configs,n=_.clone(e)||{};let r,i,a,o;for(i=0;i<s.length;++i)if(r=s[i],r)for(a in r)o=r[a],t[a]?o=t[a].merge(o,n[a]):n[a]&&o&&(o=ue.merge(o,n[a])),n[a]=o;return n}static mixin(...e){let s=this,t;for(t=0;t<e.length;++t){const n=e[t],r=n[Pu]||(n[Pu]=Symbol("mixinTag"));s[r]||(s=n(s),s[r]=!0,Ot(s,"onClassMixedIn")&&s.onClassMixedIn())}return s}static setupClass(e){var s;const t=e.class,n=wu(t).$meta,r=t.$$name,i=n.names,a=t.prototype;if(Iu(a,"$meta",{value:e}),Object.assign(e,{super:n,config:Object.create(n.config),configs:Object.create(n.configs),declarables:n.declarables,forkConfigs:n.forkConfigs,hierarchy:Object.freeze([...n.hierarchy,t]),names:i.includes(r)?i:Object.freeze([...i,r]),properties:n.properties,nullify:(s=n.nullify)==null?void 0:s.slice()}),i!==e.names){const o=`is${r}`,l=c=>{Ot(c,o)||Iu(c,o,{get(){return!0}})};l(a),l(t)}for(let o,l,c=0;c<e.declarables.length;++c)o=e.declarables[c],Ot(t,o)&&(l=xu[o]||(xu[o]=`setup${U.capitalize(o)}`),t[l](t,e))}static setupConfigs(e,s,t){const n=e.config,r=e.configs,i=e.class,a=e.super;let{nullify:o}=e,l,c,u,d,h,f;for(const g in s)h=s[g],t?(l=r[g])?h=l.merge(h,n[g],e,a):l=ue.get(g,Bp):(c=u=d=void 0,h&&typeof h=="object"&&"$config"in h&&(u=h.$config,u&&!_.isObject(u)&&(u=_.createTruthyKeys(u)),d="default"in h,c=d?h.default:c,h=h.value),(l=r[g])?(f=l.nullify,u&&(l=l.extend(u)),h=l.merge(h,n[g],e,a)):(l=ue.get(g,u),l.define(i.prototype),d=!(l.field in i.prototype),f=!1),d&&l.setDefault(i,c),l.nullify&&!f&&(o||(o=e.nullify||(e.nullify=[]))).push(l)),h&&(_.isObject(h)||Array.isArray(h))&&!Object.isFrozen(h)&&(e.forkConfigs=!0),r[g]=l,n[g]=h}static setupConfigurable(e,s){e.setupConfigs(s,e.configurable,!1)}static setupDefaultConfig(e,s){e.setupConfigs(s,e.defaultConfig,!0)}static setupDeclarable(e,s){const t=e.declarable;let n=s.declarables,r,i;for(i=0;i<t.length;++i)n.includes(t[i])||(r||(s.declarables=r=n=n.slice()),n.push(t[i]))}static setupProperties(e,s){s.properties=s.super.properties.slice(),s.properties.push(e),Object.freeze(s.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.$meta,s=e.forkConfigs?$.fork(e.config):Object.create(e.config);if(Se.isTestEnv&&Oe.isBrowserEnv&&s.testConfig&&globalThis.__applyTestConfigs)for(const t in s.testConfig)s[t]=s.testConfig[t];return s}static fork(e){let s=e,t,n;if(e&&_.isObject(e)&&!Object.isFrozen(e)){s=Object.create(e);for(t in e)n=e[t],n&&(_.isObject(n)?s[t]=$.fork(n):Array.isArray(n)&&(s[t]=n.slice()))}return s}getProperties(){const e=this.$meta.properties,s={};for(let t=0;t<e.length;t++)Object.assign(s,e[t].properties);return s}static get superclass(){return wu(this)}classHierarchy(e){const s=this.$meta.hierarchy,t=e?s.indexOf(e):0;return t>0?s.slice(t):s}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(e){let s=this.$detachers;if(s=s==null?void 0:s[e],s)for(;s.length;)s.pop()()}trackDetacher(e,s){const t=this.$detachers||(this.$detachers={});(t[e]||(t[e]=[])).push(s)}untrackDetachers(e){const s=this.$detachers;if(s)for(const t in s){const n=s[t];for(let r=n.length;r-- >0;)n[r].eventer===e&&n.splice(r,1)}}},Ka=$.prototype;Ka.onConfigChange.$nullFn=Hn.$nullFn=!0,$[Gn]=Ka.$meta=Mu({class:$,config:Object.freeze({}),configs:Object.create(null),declarables:$.declarable,forkConfigs:!1,hierarchy:Object.freeze([$]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null}),Object.assign(Ka,{$detachers:null,configObserver:null,isConstructing:!0,isDestroyed:!1,isDestroying:!1}),$.emptyFn=Hn,Se.setVersion("core","5.5.0"),$._$name="Base";var Up=/^(\w+)=(.*)$/,Wp=function(e){const s={},t=e.split("&");for(const n of t){const[r,i,a]=Up.exec(n),o=decodeURIComponent(i),l=decodeURIComponent(a);if(r){let c=s[o];c?(Array.isArray(c)||(c=s[o]=[c]),c.push(l)):s[o]=l}}return s},xr=class{static get(e,s){return this.fetch(e,s)}static post(e,s,t={}){return!(s instanceof FormData)&&typeof s!="string"&&(s=JSON.stringify(s),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:s},t))}static fetch(e,s){let t;if(s=_.merge({},xr.DEFAULT_FETCH_OPTIONS,s),typeof AbortController!="undefined"&&(t=s.abortController=new AbortController,s.signal=t.signal),"credentials"in s||(s.credentials="include"),s.queryParams){const r=Object.entries(s.queryParams);if(r.length){let i=!1;if(s.headers&&s.addQueryParamsToBody===!0){const a=new Headers(s.headers).get("Content-Type");let o;switch(a){case"application/x-www-form-urlencoded":o=URLSearchParams;break;case"multipart/form-data":o=FormData;break}if(o){const l=s.body||(s.body=new o);l instanceof o&&(r.forEach(([c,u])=>l.set(c,u)),i=!0)}}i||(e+=(e.includes("?")?"&":"?")+r.map(([a,o])=>`${a}=${encodeURIComponent(o)}`).join("&"))}}const n=new Promise((r,i)=>{fetch(e,s).then(a=>{s.parseJson?a.json().then(o=>{a.parsedJson=o,r(a)}).catch(o=>{a.parsedJson=null,a.error=o,i(a)}):r(a)}).catch(a=>{a.stack=n.stack,i(a)})});return n.stack=new Error().stack,n.abort=function(){t==null||t.abort()},n}static mockUrl(e,s){const t=this;(t.mockAjaxMap||(t.mockAjaxMap={}))[e]=s,xr.originalFetch||(xr.originalFetch=xr.fetch,xr.fetch=t.mockAjaxFetch.bind(t))}static async mockAjaxFetch(e,s){const t=e.split("?");let n=this.mockAjaxMap[t[0]],r=null;if(n){typeof n=="function"&&(n=await n(t[0],t[1]&&Wp(t[1]),s));try{r=(s==null?void 0:s.parseJson)&&JSON.parse(n.responseText)}catch(i){r=null,n.error=i}return n=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:r,text:()=>new Promise(i=>{i(n.responseText)}),json:()=>new Promise(i=>{i(r)})},n),new Promise(function(i,a){n.synchronous?i(n):setTimeout(function(){i(n)},"delay"in n?n.delay:100)})}else return xr.originalFetch(e,s)}},tr=xr;F(tr,"DEFAULT_FETCH_OPTIONS",{}),tr._$name="AjaxHelper";var W=class{static clean(e){return e.reduce((s,t)=>(t!=null&&!(Array.isArray(t)&&t.length===0)&&t!==""&&s.push(t),s),[])}static from(e,s,t){const n=[];if(e)for(const r of e)(!s||s(r))&&n.push(t?t(r):r);return n}static remove(e,...s){let t,n,r=!1;s=s[0]instanceof Set?[...s[0]]:s;for(let i=0;i<s.length;i++)n=s[i],(t=e.indexOf(n))!==-1&&(e.splice(t,1),r=!0);return r}static findInsertionIndex(e,s,t=this.lexicalCompare,n){const r=s.length;let i,a;return n<r&&(i=n>0?t(s[n-1],e):0,a=n<r-1?t(e,s[n]):0,i<1&&a<1)?n:this.binarySearch(s,e,t)}static findLast(e,s,t){for(let{length:n}=e,r=n-1;r>=0;r--)if(s.call(t,e[r],r,e))return e[r]}static binarySearch(e,s,t=0,n=e.length,r=this.lexicalCompare){const i=e.length;let a,o;for(t instanceof Function?(r=t,t=0):n instanceof Function&&(r=n,n=i),--n;t<=n;)a=t+n>>1,o=r(s,e[a]),o>=0?t=a+1:o<0&&(n=a-1);return t}magnitudeCompare(e,s){return e<s?-1:e>s?1:0}lexicalCompare(e,s){return e=String(e),s=String(s),e<s?-1:e>s?1:0}static fill(e,s={},t=null){const n=[],r=Array.isArray(s)?s:[s];for(let i=0;i<e;i++)for(const a of r){const o=Object.assign({},a);t&&t(o,i),n.push(o)}return n}static populate(e,s,t=!1){const n=[];for(let r=0;r<e;r++)n.push(s(r+(t?1:0)));return n}static include(e,...s){for(const t of s)e.includes(t)||e.push(t)}static unique(e){return[...new Set(e)]}static allowNegative(e){return new Proxy(e,{get(s,t,n){if(typeof t!="string")return Reflect.get(s,t,n);const r=Number(t);return Number.isNaN(r)?Reflect.get(s,t,n):s[r<0?s.length+r:r]},set(s,t,n,r){if(typeof t!="string")return Reflect.set(s,t,n,r);const i=Number(t);return Number.isNaN(i)?Reflect.set(s,t,n,r):(s[i<0?s.length+i:i]=n,!0)}})}static delta(e,s,t=!1){if(!s)return t?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const n=[],r=[],i=new Set,a=new Set(s);for(let o=0;o<e.length;o++){const l=e[o];a.has(l)?i.add(l):n.push(l)}for(let o=0;o<s.length;o++){const l=s[o];i.has(l)||r.push(l)}return t?{toAdd:n,toRemove:r,toKeep:i}:{onlyInA:n,onlyInB:r,inBoth:[...i]}}static asArray(e){return e==null?e:e instanceof Set?Array.from(e):Array.isArray(e)?e:[e]}static identity(e){return e}static keyBy(e,s,t=W.identity){const n=typeof s=="string"?i=>i==null?void 0:i[s]:s,r=typeof t=="string"?i=>i==null?void 0:i[t]:t;return e.reduce((i,a)=>(i[n(a)]=r(a),i),{})}static aggregate(e,s,t,n,r={}){const i=e.length,a=e[0].length,o=[];r.targetArray=o,r.arrays=e;for(let l=0;l<a;l++)r.entryIndex=l,o.push(n(l,r));for(let l=0;l<i;l++){const c=e[l];r.rowIndex=l;for(let u=0;u<a;u++){r.entryIndex=u;const d=s(c[u],r);o[u]=t(o[u],d,l,u,r)}}return o}static groupBy(e,s){const t=typeof s=="string"?n=>n==null?void 0:n[s]:s;return e.reduce((n,r)=>{const i=t(r);return(n[i]=n[i]||[]).push(r),n},{})}};W._$name="ArrayHelper";var Ou=/,\s*/,Ja=Symbol("decompiled"),zp=/^\s*(async\s+)?([a-z_]\w*)\s*=>([\s\S]+)$/i,qp=/^\s*(async\s*)?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)\s+=>([\s\S]+)$/i,Gp=/^(\s*async)?(?:\s*function)?(?:\s*([a-z_]\w*))?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)([\s\S]+)$/i,{hasOwnProperty:Hp}=Object.prototype,Et=class{static after(e,s,t,n,r){const i=typeof t=="string",a=(r==null?void 0:r.return)!==!1,o=(...l)=>{const c=o.$nextHook.call(e,...l),u=n!=null&&n.isDestroyed?void 0:a?i?n[t](c,...l):t.call(n,c,...l):i?n[t](...l):t.call(n,...l);return u===void 0?c:u};return Et.hookMethod(e,s,o)}static before(e,s,t,n){const r=typeof t=="string",i=(...a)=>{const o=n!=null&&n.isDestroyed?0:r?n[t](...a):t.call(n,...a);return o===!1?o:i.$nextHook.call(e,...a)};return Et.hookMethod(e,s,i)}static curry(e){return function s(...t){return t.length>=e.length?e.apply(this,t):function(...n){return s.apply(this,t.concat(n))}}}static bindAll(e){for(const s in e)typeof e[s]=="function"&&(e[s]=e[s].bind(e))}static createInterceptor(e,s,t){return function(...n){const r=t||this;return s.call(r,...n)!==!1?e.call(r,...n):!1}}static createSequence(e,s,t){return(...n)=>{const r=e.call(t,...n),i=s.call(t,...n);return i===void 0?r:i}}static createThrottled(e,s,t,n,r){let i=-Number.MAX_VALUE,a,o;const l=()=>{o=0,i=performance.now(),a.push.apply(a,n),e.apply(t,a)},c=function(...u){const d=performance.now()-i;a=u,d>=s?(clearTimeout(o),l()):(o||(o=setTimeout(l,s-d)),r&&(a.push.apply(a,n),r.apply(t,a)))};return c.cancel=()=>clearTimeout(o),c}static createBuffered(e,s,t,n){let r,i;const a=()=>{i=0,o.isPending=!1,r.push.apply(r,n),e.apply(t,r)},o=function(...l){r=l,i&&clearTimeout(i),o.isPending=!0,i=setTimeout(a,s)};return o.cancel=()=>{o.isPending=!1,clearTimeout(i)},o}static decompile(e){if(!(Ja in e)){const s=e.toString();let t=zp.exec(s),n,r,i,a,o;t?(n=[t[2]],r=t[3]):(t=qp.exec(s))?(o=t[2].trim(),n=o?o.split(Ou):[],r=t[3]):(t=Gp.exec(s))&&(i=t[2],o=t[3].trim(),n=o?o.split(Ou):[],r=t[4]),r=r==null?void 0:r.trim(),e[Ja]=a=t&&{args:n,async:!!t[1],body:r!=null&&r.startsWith("{")?r.substring(1,r.length-1).trim():r},i&&(a.name=i)}return e[Ja]}static hookMethod(e,s,t){return t.$nextHook=e[s],e[s]=t,()=>{var n;if(Hp.call(e,s)){let r=e[s],i;if(r===t)((n=Object.getPrototypeOf(e))==null?void 0:n[s])===t.$nextHook?delete e[s]:e[s]=t.$nextHook;else for(;i=r==null?void 0:r.$nextHook;r=i)if(i===t){r.$nextHook=t.$nextHook;break}}}}static noThrow(e,s,t){const n=e[s];e[s]=(...r)=>{try{return n.apply(e,r)}catch(i){return t==null?void 0:t(i)}}}static returnTrue(){return!0}static animate(e,s,t,n="linear"){let r=!1;const i=new Promise(a=>{const o=performance.now(),l=()=>{const c=Math.min((performance.now()-o)/e,1),u=t&&t.setTimeout?t:globalThis;r||s.call(t,this.easingFunctions[n](c))===!1&&a(),r||c===1?u.requestAnimationFrame(()=>a()):u.requestAnimationFrame(l)};l()});return i.cancel=()=>(r=!0,i.cancelled=!0,!1),i}},se=.5,rr=1.70158,ft=7.5625,Yn=1.525,Qa=2/2.75,Za=2.25/2.75,Xa=1/2.75,eo=1.5/2.75,to=2.5/2.75,ro=2.625/2.75,so=.75,no=.9375,io=.984375,Yp=1.70158,Kp=1.70158;Et.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=se)<1?se*Math.pow(e,2):-se*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=se)<1?se*Math.pow(e,3):se*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=se)<1?se*Math.pow(e,4):-se*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=se)<1?se*Math.pow(e,5):se*(Math.pow(e-2,5)+2),easeInSine:e=>-Math.cos(e*(Math.PI/2))+1,easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-se*(Math.cos(Math.PI*e)-1),easeInExpo:e=>e===0?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>e===1?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>e===0?0:e===1?1:(e/=se)<1?se*Math.pow(2,10*(e-1)):se*(-Math.pow(2,-10*--e)+2),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=se)<1?-se*(Math.sqrt(1-e*e)-1):se*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<Xa?ft*e*e:e<Qa?ft*(e-=eo)*e+so:e<to?ft*(e-=Za)*e+no:ft*(e-=ro)*e+io,easeInBack:e=>e*e*((rr+1)*e-rr),easeOutBack:e=>(e=e-1)*e*((rr+1)*e+rr)+1,easeInOutBack:e=>{let s=Yp;return(e/=se)<1?se*(e*e*(((s*=Yn)+1)*e-s)):se*((e-=2)*e*(((s*=Yn)+1)*e+s)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((e*6-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let s=Kp;return(e/=se)<1?se*(e*e*(((s*=Yn)+1)*e-s)):se*((e-=2)*e*(((s*=Yn)+1)*e+s)+2)},swingFrom:e=>e*e*((rr+1)*e-rr),swingTo:e=>(e-=1)*e*((rr+1)*e+rr)+1,bounce:e=>e<Xa?ft*e*e:e<Qa?ft*(e-=eo)*e+so:e<to?ft*(e-=Za)*e+no:ft*(e-=ro)*e+io,bouncePast:e=>e<Xa?ft*e*e:e<Qa?2-(ft*(e-=eo)*e+so):e<to?2-(ft*(e-=Za)*e+no):2-(ft*(e-=ro)*e+io),easeFromTo:e=>(e/=se)<1?se*Math.pow(e,4):-se*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},Et._$name="FunctionHelper";var{isArray:Au}=Array,{hasOwnProperty:Jp}=Object.prototype,$u={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1,$internal:1},_u=(e,s)=>s.prio-e.prio,Vt=e=>class Dc extends(e||$){constructor(){super(...arguments),F(this,"eventsSuspended",null)}static get $name(){return"Events"}static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(t,n){const r=n.getInherited("deprecatedEvents"),i=t.deprecatedEvents;for(const a in i)r[a.toLowerCase()]=r[a]=i[a]}static get configurable(){return{listeners:{value:null,$config:{merge(t,n){if(t!==null){if(!t)return n;n&&(t=t?[t]:[],t.push[Au(n)?"apply":"call"](t,n))}return t}}},internalListeners:null,bubbleEvents:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(t,...n){(this.configuredListeners=t==null?void 0:t.listeners)&&(t=_.assign({},t),delete t.listeners),super.construct(t,...n),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const t=this,{isConfiguring:n}=t;t.isConfiguring=!1,t.listeners=t.configuredListeners,t.configuredListeners=null,t.isConfiguring=n}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(!1),super.doDestroy()}static setupClass(t){super.setupClass(t),Dc.prototype.onListen.$nullFn=!0,Dc.prototype.onUnlisten.$nullFn=!0}addListener(t,n,r){var i;if(Au(t)){for(let l=0,{length:c}=t;l<c;l++)this.addListener(t[l],n);return}const a=this,o=a.$meta.getInherited("deprecatedEvents");if(typeof t=="string")return a.addListener({[t]:n,detachable:n.detachable!==!1,thisObj:r});{n=t.thisObj=t.thisObj!==void 0?t.thisObj:n;for(const d in t)if(!$u[d]&&t[d]!=null){const h=d.toLowerCase(),f=o==null?void 0:o[h],g=a.eventListeners||(a.eventListeners={}),p=t[d],m=p.expires||t.expires,y={fn:typeof p=="object"?p.fn:p,thisObj:p.thisObj!==void 0?p.thisObj:n,args:p.args||t.args,prio:p.prio!==void 0?p.prio:t.prio!==void 0?t.prio:0,once:p.once!==void 0?p.once:t.once!==void 0?t.once:!1,buffer:p.buffer||t.buffer,throttle:p.throttle||t.throttle,$internal:t.$internal,catchAll:d==="catchAll"};if(f){const{product:E,invalidAsOfVersion:C,message:v}=f;Se.deprecate(E,C,v)}if(m){const{alt:E}=m,C=E?m.delay:m,v=t.name||d,S=()=>{a.un(h,y),E&&!y.called&&a.callback(E,n)};a.isDelayable?a.setTimeout({fn:S,name:v,cancelOutstanding:!0,delay:C}):globalThis.setTimeout(S,C)}let D=g[h]||(g[h]=[]);D.$firing&&(g[h]=D=D.slice()),D.splice(W.findInsertionIndex(y,D,_u,D.length),0,y),!a.onListen.$nullFn&&D.length<2&&a.onListen(h),(i=a.afterAddListener)==null||i.call(a,h,y)}t.relayAll&&a.relayAll(t.relayAll),n&&n!==a&&a.attachAutoDetacher(t,n);const l=t.detachable!==!1,c=t.name,u=t.expires||l||c?()=>{a.isDestroyed||a.removeListener(t,n)}:null;if(u&&(u.eventer=a,u.listenerName=c,c&&(n!=null&&n.trackDetacher)&&n.trackDetacher(c,u),t.expires&&a.delay(u,isNaN(t.expires)?t.expires.delay:t.expires,c),l))return u}}on(t,n,r){return this.addListener(t,n,r)}ion(t){return t.$internal=!0,this.on(t)}un(...t){this.removeListener(...t)}updateInternalListeners(t,n){n==null||n.detach(),t&&(t.detach=this.ion(t))}get listeners(){return this.eventListeners}changeListeners(t){if(this.isConfiguring)this.getConfig("internalListeners"),t&&this.on(t,this);else{if(Array.isArray(t))for(let n=0,r=t[0],{length:i}=t;n<i;r=t[++n])"thisObj"in r||(t[n]=_.assign({thisObj:this},r));else t&&!("thisObj"in t)&&(t=_.assign({thisObj:this},t));return t}}updateListeners(t,n){n&&this.un(n),t&&this.on(t)}removeListener(t,n=t.thisObj,r){const i=this;if(typeof t=="string")return i.removeListener({[t]:n},r);Object.entries(t).forEach(([a,o])=>{var l;if(!$u[a]&&o!=null){a=a.toLowerCase();const{eventListeners:c}=i,u=i.findListener(a,o,n);if(u>=0){let d=c[a];(l=i.afterRemoveListener)==null||l.call(i,a,d[u]),d.length>1?(d.$firing&&(c[a]=d=d.slice()),d.splice(u,1)):(delete c[a],i.onUnlisten.$nullFn||i.onUnlisten(a))}}}),t.thisObj&&!t.thisObj.isDestroyed&&i.detachAutoDetacher(t)}findListener(t,n,r){var i;const a=(i=this.eventListeners)==null?void 0:i[t],o=n.fn||n,l=n.thisObj||r;if(a){for(let c,u=0,{length:d}=a;u<d;u++)if(c=a[u],c.fn===o&&c.thisObj===l)return u}return-1}hasListener(t){var n;return!!((n=this.eventListeners)!=null&&n[t==null?void 0:t.toLowerCase()])}relayAll(t,n,r=!0){this.relayAllTargets||(this.relayAllTargets=[]);const{relayAllTargets:i}=this;t.ion({beforeDestroy:({source:a})=>{a===t&&i.filter(l=>l.through===t).forEach(l=>W.remove(i,l))}}),i.push({through:t,prefix:n,transformCase:r})}removeAllListeners(t=!0){var n;const r=this.eventListeners;let i,a;for(const o in r){const l=r[o];for(i=l.length;i-- >0;){const c=l[i];(!c.$internal||!t)&&(this.removeListener(o,c),a=c.thisObj,(n=a==null?void 0:a.untrackDetachers)==null||n.call(a,this))}}}relayEvents(t,n,r=""){const i={detachable:!0,thisObj:this};return n.forEach(a=>{i[a]=(o,...l)=>this.trigger(r+a,o,...l)}),t.on(i)}onListen(){}onUnlisten(){}destructorInterceptor(){const{autoDetachers:t,target:n,oldDestructor:r}=this;for(let i=0;i<t.length;i++){const{dispatcher:a,config:o}=t[i];a.isDestroyed||a.removeListener(o,n)}r.call(n)}attachAutoDetacher(t,n){const r=t.thisObj||n,i="doDestroy"in r?"doDestroy":"destroy";if(i in r){let{$autoDetachers:a}=r;a||(r.$autoDetachers=a=[]),r.$oldDestructor||(r.$oldDestructor=r[i],r[i]=this.destructorInterceptor.bind({autoDetachers:a,oldDestructor:r.$oldDestructor,target:r})),a.push({config:t,dispatcher:this})}else r[i]=()=>{this.removeListener(t)}}detachAutoDetacher(t){const n=t.thisObj;n.$oldDestructor&&!n.isDestroying&&(W.remove(n.$autoDetachers,n.$autoDetachers.find(r=>r.config===t&&r.dispatcher===this)),n.$autoDetachers.length||(n["doDestroy"in n?"doDestroy":"destroy"]=n.$oldDestructor,n.$oldDestructor=null))}await(t,n={checkLog:!0,resetLog:!0,args:null}){const r=this;n===!1&&(n={checkLog:!1});const{args:i}=n;return new Promise(a=>{var o;if(n.checkLog&&((o=r._triggered)!=null&&o[t])&&(a(),n.resetLog&&r.clearLog(t)),i){const l=r.on({[t]:(...c)=>{(typeof i=="function"?i(...c):Object.keys(i).every(d=>d in c[0]&&c[0][d]===i[d]))&&(a(...c),n.resetLog&&r.clearLog(t),l())},prio:-1e4})}else r.on({[t]:(...l)=>{a(...l),n.resetLog&&r.clearLog(t)},prio:-1e4,once:!0})})}clearLog(t){this._triggered&&(t?delete this._triggered[t]:this._triggered={})}trigger(t,n){var r,i,a,o;const l=this,c=t.toLowerCase(),{eventsSuspended:u,relayAllTargets:d,callOnFunctions:h}=l;let f=(r=l.eventListeners)==null?void 0:r[c],g;if(l._triggered||(l._triggered={}),l._triggered[t]=!0,u)return u.shouldQueue&&u.queue.push(arguments),!0;if((i=l.eventListeners)!=null&&i.catchall&&((f=f?f.slice():[]).push(...l.eventListeners.catchall),f.sort(_u)),!f&&!d&&!h)return!0;if(n?"source"in n||(Object.isExtensible(n)?n.source=l:n=Object.setPrototypeOf({source:l},n)):n={source:l},n.type!==c&&(n.constructor!==Object?Reflect.defineProperty(n,"type",{get:()=>c}):n.type=c),n.eventName=t,!("bubbles"in n)&&((a=l.bubbleEvents)!=null&&a[t])&&(n.bubbles=l.bubbleEvents[t]),h){const m="on"+U.capitalize(t);if(m in l){const y=l[m]?l.callback(l[m],l,[n]):!0;let D;if(_.isPromise(y)?(g||(g=[])).push(y):D=y===!1||D,!l.isDestroyed&&Jp.call(l,m)&&!((o=l.pluginFunctionChain)!=null&&o[m])){const E=Object.getPrototypeOf(l);if(m in E){const C=E[m].call(l,n);if(_.isPromise(C)?(g||(g=[])).push(C):D=C===!1||D,l.isDestroyed)return}}if(D)return!1}}let p;if(f){let m=0,y=!1;for(f.$firing=!0,m;m<f.length&&!l.isDestroyed&&!y;m++){const D=f[m];if(p===!1&&!D.$internal)continue;let E,C=D.thisObj;if(!C||!C.isDestroyed){if(D.called=!0,D.once&&l.removeListener(c,D),typeof D.fn=="string"){if(C&&(E=C[D.fn]),!E){const S=l.resolveCallback(D.fn);E=S.handler,C=S.thisObj}}else E=D.fn;if(D.buffer){if(!D.bufferFn){const S=Number(D.buffer);if(typeof S!="number"||isNaN(S))throw new Error(`Incorrect type for buffer, got "${S}" (expected a Number)`);D.bufferFn=Et.createBuffered(E,S,C,D.args)}E=D.bufferFn}if(D.throttle){const S=Number(D.throttle);if(typeof S!="number"||isNaN(S))throw new Error(`Incorrect type for throttle, got "${S}" (expected a Number)`);D.throttledFn||(D.throttledFn=Et.createThrottled(E,S,C,D.args)),E=D.throttledFn}const v=E.call(C||l,...D.args||[],n);p!==!1&&(p=v),D.$internal&&v===!1&&(y=!0),_.isPromise(v)&&(v.$internal=D.$internal,(g||(g=[])).push(v))}}if(f.$firing=!1,y)return!1}return d==null||d.forEach(m=>{let y=t;if(m.transformCase&&(y=U.capitalize(y)),m.prefix&&(y=m.prefix+y),m.through.trigger(y,n)===!1)return!1}),n.bubbles&&l.owner&&!l.owner.isDestroyed?l.owner.trigger(t,n):(g=g==null?void 0:g.filter(m=>p!==!1||m.$internal),g!=null&&g.length?new Promise(m=>{Promise.all(g).then(y=>{const D=!y.some(E=>E===!1);m(D)})}):p!==!1)}suspendEvents(t=!1){const n=this.eventsSuspended||(this.eventsSuspended={shouldQueue:t,queue:[],count:0});n.count++}resumeEvents(){const t=this.eventsSuspended;if(t&&--t.count===0&&(this.eventsSuspended=null,t.shouldQueue))for(const n of t.queue)this.trigger(...n);return!this.eventsSuspended}},js=class{static mergeLocales(...e){const s={};return e.forEach(t=>{Object.keys(t).forEach(n=>{typeof t[n]=="object"?s[n]={...s[n],...t[n]}:s[n]=t[n]})}),s}static trimLocale(e,s){const t=(n,r)=>{e[n]&&(r?e[n][r]&&delete e[n][r]:delete e[n])};Object.keys(s).forEach(n=>{Object.keys(s[n]).length>0?Object.keys(s[n]).forEach(r=>t(n,r)):t(n)})}static normalizeLocale(e,s){if(!e)throw new Error('"nameOrConfig" parameter can not be empty');if(typeof e=="string"){if(!s)throw new Error('"config" parameter can not be empty');s.locale?s.name=e||s.name:s.localeName=e}else s=e;let t={};if(s.name||s.locale)t=Object.assign({localeName:s.name},s.locale),s.desc&&(t.localeDesc=s.desc),s.code&&(t.localeCode=s.code),s.path&&(t.localePath=s.path);else{if(!s.localeName)throw new Error(`"config" parameter doesn't have "localeName" property`);t=Object.assign({},s)}for(const n of["name","desc","code","path"])t[n]&&delete t[n];if(!t.localeName)throw new Error("Locale name can not be empty");return t}static get locales(){return globalThis.bryntum.locales||{}}static set locales(e){globalThis.bryntum.locales=e}static get localeName(){return globalThis.bryntum.locale||"En"}static set localeName(e){globalThis.bryntum.locale=e||js.localeName}static get locale(){return js.localeName&&this.locales[js.localeName]||this.locales.En||Object.values(this.locales)[0]||{localeName:"",localeDesc:"",localeCoode:""}}static publishLocale(e,s){const{locales:t}=globalThis.bryntum,n=js.normalizeLocale(e,s),{localeName:r}=n;return!t[r]||s===!0?t[r]=n:t[r]=this.mergeLocales(t[r]||{},n||{}),t[r]}},st=js;F(st,"skipLocaleIntegrityCheck",!1),globalThis.bryntum=globalThis.bryntum||{},globalThis.bryntum.locales=globalThis.bryntum.locales||{},st._$name="LocaleHelper";var Qp=class extends Vt($){static get defaultConfig(){return{throwOnMissingLocale:Se.isTestEnv}}construct(...e){var s;const t=this;if(super.construct(...e),Oe.isBrowserEnv){const n=document.querySelector("script[data-default-locale]");n?t.applyLocale(n.dataset.defaultLocale):(s=t.locale)!=null&&s.localeName&&t.applyLocale(t.locale.localeName)}}get locales(){return st.locales}set locales(e){st.locales=e}set locale(e){this.applyLocale(e)}get locale(){return st.locale}registerLocale(e,s){Se.deprecate("Core","6.0.0","LocaleManager.registerLocale deprecated, use LocaleHelper.publishLocale instead"),st.publishLocale(e,s)}extendLocale(e,s){Se.deprecate("Core","6.0.0","LocaleManager.extendLocale deprecated, use LocaleManager.applyLocale instead");const t=st.publishLocale(e,s);return this.applyLocale(t,!0)}applyLocale(e,s,t=!1){const n=this;let r;if(typeof e=="string")if(typeof s!="object"){if(r=n.locales[e],!r){if(t)return!0;throw new Error(`Locale "${e}" is not published. Publish with LocaleHelper.publishLocale() before applying.`)}}else r=st.publishLocale(e,s);else r=st.publishLocale(e);if(n.locale.localeName&&n.locale.localeName===r.localeName&&s!==!0)return n.locale;st.localeName=r.localeName;const i=()=>{n.trigger("locale",r)};return r.localePath?new Promise((a,o)=>{n.loadLocale(r.localePath).then(l=>{l.text().then(c=>{new Function(c)(),Oe.isBrowserEnv&&(r=n.locales[r.localeName],r&&delete r.localePath),i(),a(r)})}).catch(l=>o(l))}):(i(),r)}loadLocale(e){return tr.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}},Zp=new Qp,Ge=Zp,Xp=Object.getPrototypeOf(Object),Fu=/L{.*?}/g,ju=/L{(.*?)}/g,ku=/((.*?)\.)?(.+)/g,em=e=>e.replace(/{(\d+)}/gm,"[[$1]]"),Lu=e=>e.replace(/\[\[(\d+)]]/gm,"{$1}"),tm=Object.freeze(Object.create(null)),gt=e=>class Ft extends(e||$){static get $name(){return"Localizable"}static get configurable(){return{localeClass:null,localizable:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(t){var n,r;return typeof t=="string"?t:t===Xp?"Object":t.$$name||t.name||((n=t.prototype)==null?void 0:n.$$name)||((r=t.prototype)==null?void 0:r.name)}static parseLocaleString(t){const n=[];let r;if(t!=null&&t.includes("L{"))for(t=em(t),ju.lastIndex=0;(r=ju.exec(t))!=null;){ku.lastIndex=0;const i=ku.exec(r[1]);n.push({match:Lu(r[0]),localeKey:Lu(i[3]),localeClass:i[2]})}return n.length>0?n:[{match:t,localeKey:t,localeClass:void 0}]}construct(t={},...n){super.construct(t,...n),Ge.ion({locale:"updateLocalization",thisObj:this}),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(t){var n,r,i;const a=this,o=_.getPath(a,t),l=((n=a.$meta.configs[t])==null?void 0:n.localeKey)||((i=(r=a.fieldMap)==null?void 0:r[t])==null?void 0:i.defaultValue);let c;return l?(c=Ft.localize(l,a,a.localeClass||a),c&&!(t in(a.initialConfig||tm))&&_.setPath(a.isColumn?a.data:a,t,c)):typeof o=="string"&&(a.originalLocales=a.originalLocales||{},c=_.getPath(a.originalLocales,t),c===void 0&&(_.setPath(a.originalLocales,t,o),c=o),c&&_.setPath(a,t,c=a.optionalL(c,a))),c||o}updateLocalization(){var t,n;this.localizable!==!1&&((t=this.localizableProperties)==null||t.forEach(this.localizeProperty,this),(n=this.trigger)==null||n.call(this,"localized"))}static getTranslation(t,n,r){const i=Ge.locale;let a=null,o,l;if(i)for(const{match:c,localeKey:u,localeClass:d}of this.parseLocaleString(t)){const h=g=>{var p;const m=(p=i[g])==null?void 0:p[u];return m&&(typeof m=="function"?a=n!=null?m(n):m:typeof m=="object"||t===c?a=m:a=(a||t).replace(c,m),typeof m=="string"&&m.includes("L{")&&(a=this.getTranslation(m,n,r))),m};let f=!1;for(l=r;l&&(o=Ft.clsName(l))&&!(f=h(o));l=Object.getPrototypeOf(l))if(typeof l=="string")break;!f&&d&&h(d)}return a}static localize(t,n=void 0,...r){(r==null?void 0:r.length)===0&&(r=[this]);let i=null;return r.some(a=>(i=Ft.getTranslation(t,n,a),i!=null)),i}static L(t,n=void 0,...r){(r==null?void 0:r.length)===0&&(r=[this]);const i=this.localize(t,n,...r);if(i==null&&Ge.throwOnMissingLocale&&t.includes("L{"))throw new Error(`Localization is not found for '${t}' in '${r.map(a=>Ft.clsName(a)).join(", ")}'. ${Ge.locale.localeName?`Locale : ${Ge.locale.localeName}`:""}`);return i!=null?i:t}L(t,n){const{localeClass:r,constructor:i}=this;return r&&Ft.clsName(r)!==Ft.clsName(i)?Ft.L(t,n,r,i):Ft.L(t,n,i)}static optionalL(t,n=void 0,...r){const i=Ge.throwOnMissingLocale;Ge.throwOnMissingLocale=i&&Fu.test(t),(r==null?void 0:r.length)===0&&(r=[this]);const a=Ft.L(t,n,...r);return Ge.throwOnMissingLocale=i,a}optionalL(t,n=this,r=!1){const i=Ge.throwOnMissingLocale;Ge.throwOnMissingLocale=i&&Fu.test(t)&&!r;const a=this.L(t,n);return Ge.throwOnMissingLocale=i,a}get localeManager(){return Ge}get localeHelper(){return st}},rm={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{Yes:"Yes",No:"No",Cancel:"Cancel",Ok:"OK",Week:"Week"},ColorPicker:{noColor:"No color"},Combo:{noResults:"No results",recordNotCommitted:"Record could not be added",addNewValue:e=>`Add ${e}`},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:e=>`Value must be less than or equal to ${e.max}`,rangeUnderflow:e=>`Value must be greater than or equal to ${e.min}`,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},DatePicker:{gotoPrevYear:"Go to previous year",gotoPrevMonth:"Go to previous month",gotoNextMonth:"Go to next month",gotoNextYear:"Go to next year"},NumberFormat:{locale:"en-US",currency:"USD"},DurationField:{invalidUnit:"Invalid unit"},TimeField:{invalidTime:"Invalid time input"},TimePicker:{hour:"Hour",minute:"Minute",second:"Second"},List:{loading:"Loading...",selectAll:"Select All"},GridBase:{loadMask:"Loading...",syncMask:"Saving changes, please wait..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:e=>`of ${e.lastPage}`,summaryTemplate:e=>`Displaying records ${e.start} - ${e.end} of ${e.allCount}`},PanelCollapser:{Collapse:"Collapse",Expand:"Expand"},Popup:{close:"Close"},UndoRedo:{Undo:"Undo",Redo:"Redo",UndoLastAction:"Undo last action",RedoLastAction:"Redo last undone action",NoActions:"No items in the undo queue"},FieldFilterPicker:{equals:"equals",doesNotEqual:"does not equal",isEmpty:"empty",isNotEmpty:"not empty",contains:"contains",doesNotContain:"does not contain",startsWith:"starts with",endsWith:"ends with",isOneOf:"one of",isNotOneOf:"not one of",isGreaterThan:"greater than",isLessThan:"less than",isGreaterThanOrEqualTo:"greater than or equal to",isLessThanOrEqualTo:"less than or equal to",isBetween:"between",isNotBetween:"not between",isBefore:"before",isAfter:"after",isToday:"today",isTomorrow:"tomorrow",isYesterday:"yesterday",isThisWeek:"this week",isNextWeek:"next week",isLastWeek:"last week",isThisMonth:"this month",isNextMonth:"next month",isLastMonth:"last month",isThisYear:"this year",isNextYear:"next year",isLastYear:"last year",isYearToDate:"year to date",isTrue:"true",isFalse:"false",selectAProperty:"Select a property",selectAnOperator:"Select an operator",caseSensitive:"Case-sensitive",and:"and",dateFormat:"D/M/YY",selectOneOrMoreValues:"Select one or more values",enterAValue:"Enter a value",enterANumber:"Enter a number",selectADate:"Select a date"},FieldFilterPickerGroup:{addFilter:"Add filter"},DateHelper:{locale:"en-US",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"},{single:"decade",plural:"decades",abbrev:"dec"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A"},ordinalSuffix:e=>{const s=["11","12","13"].find(n=>e.endsWith(n));let t="th";if(!s){const n=e[e.length-1];t={1:"st",2:"nd",3:"rd"}[n]||"th"}return e+t}}},My=st.publishLocale(rm),{toString:Nu}=Object.prototype,sm=Nu.call(new Date),Kn=new Date,ao=1e3*60*60,oo=(e,s)=>isNaN(e)||e==null?s:e,nm=/([ES]){([^}]+)}/g,Bu=e=>{const s=["11","12","13"].find(n=>e.endsWith(n));let t="th";if(!s){const n=e[e.length-1];t={1:"st",2:"nd",3:"rd"}[n]||"th"}return e+t},Ae=(e,s,t)=>(nr[e]||(nr[e]=new Intl.DateTimeFormat(sr,s))).format(t),ks=(e,s,t,n=!1)=>{let r=Ae(e,s,t);return/am|pm/i.test(r)&&(r=r.replace(/^0/,""),n&&(r=r.replace(/:00/,""))),r},im=(e,s)=>Math.floor((e.getTime()-s.getTime()-(e.getTimezoneOffset()-s.getTimezoneOffset())*He.minute.millisecond)/He.day.millisecond)+1,Vu=e=>e>=0?e:e+7,am=/([^\w])(S+)/gm,om=(e,s)=>s+"SSS",Uu=/[:.\-/\s]/,sr="en-US",Ut=Bu,Jn={},Ls={},nr={},lo={},Wu=e=>{const s=co[e];if(!s)throw new Error("Only international formats should be used here");if(Ls[e]!==void 0)return Ls[e];const t=new Intl.DateTimeFormat(sr,s),n=t.formatToParts(new Date(2001,1,2,3,4,5,6)).map(r=>{const i=r.type,a=s[i];if(i==="literal")return r.value.replace(/,/g,"");if(i==="day")return a==="numeric"?"D":"DD";if(i==="month")return a==="short"?"MMM":a==="long"?"MMMM":a==="numeric"?"M":"MM";if(i==="year")return a==="numeric"?"YYYY":"YY"}).join("");return Ls[e]=n},zu=2020,qu=0,Gu=1,co={l:{year:"numeric",month:"numeric",day:"numeric"},ll:{year:"numeric",month:"short",day:"numeric"}},Re={M:e=>e.getMonth()+1,Mo:e=>Ut(Re.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>Ae("MMM",{month:"short"},e),MMMM:e=>Ae("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/3),Qo:e=>Ut(Re.Q(e).toString()),D:e=>e.getDate(),Do:e=>Ut(Re.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/He.day.millisecond),DDDo:e=>Ut(Re.DDD(e).toString()),DDDD:e=>Re.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>Ut(e.getDay().toString()),d1:e=>Ae("d1",{weekday:"narrow"},e).substr(0,1),dd:e=>Re.ddd(e).substring(0,2),ddd:e=>Ae("ddd",{weekday:"short"},e),dddd:e=>Ae("dddd",{weekday:"long"},e),u:e=>{const s=nr.u||(nr.u=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"})),t=s.formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}Z`},uu:e=>{const s=nr.uu||(nr.uu=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),t=s.formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}T${t[6].value}${t[8].value}${t[10].value}Z`},e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>R.getWeekNumber(e)[1],Wo:e=>Ut(Re.W(e).toString()),WW:e=>Re.W(e).toString().padStart(2,"0"),Wp:e=>`${R.localize("L{Week}")} ${Re.W(e)}`,WWp:e=>`${R.localize("L{Week}")} ${Re.WW(e)}`,Wp0:e=>`${R.localize("L{Week}")[0]}${Re.W(e)}`,WWp0:e=>`${R.localize("L{Week}")[0]}${Re.WW(e)}`,Y:e=>e.getFullYear(),YY:e=>(e.getFullYear()%100).toString().padStart(2,"0"),YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>Re.h(e).toString().padStart(2,"0"),k:e=>e.getHours()||24,kk:e=>Re.k(e).toString().padStart(2,"0"),K:e=>ks("K",{hour:"numeric"},e),KK:e=>ks("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>Re.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>Re.s(e).toString().padStart(2,"0"),S:e=>Math.floor(e.getMilliseconds()/100).toString(),SS:e=>Math.floor(e.getMilliseconds()/10).toString().padStart(2,"0"),SSS:e=>e.getMilliseconds().toString().padStart(3,"0"),z:e=>Ae("z",{timeZoneName:"short"},e),zz:e=>Ae("zz",{timeZoneName:"long"},e),Z:e=>I.getGMTOffset(e),LT:e=>ks("LT",{hour:"2-digit",minute:"2-digit"},e),LST:e=>ks("LST",{hour:"numeric",minute:"2-digit"},e,!0),LTS:e=>ks("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>Ae("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>Ae("l",co.l,e),LL:e=>Ae("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>Ae("ll",co.ll,e),LLL:e=>Ae("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>Ae("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>Ae("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>Ae("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},lm=Object.keys(Re).sort((e,s)=>s.length-e.length),cm=`^(?:${lm.join("|")})`,je=()=>({}),um=e=>ym.test(e),uo=e=>um(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))},Hu={YYYY:e=>{const s=parseInt(e);return{year:s>=1e3&&s<=9999?s:NaN}},Y:e=>({year:parseInt(e)}),YY:e=>{const s=parseInt(e);return{year:s+(s>1968?1900:2e3)}},M:e=>({month:parseInt(e)-1}),MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),MMM:e=>{const s=(e||"").toLowerCase();for(const[t,n]of Object.entries(R._monthShortNamesIndex))if(s.startsWith(t))return{month:n.value}},MMMM:e=>{const s=(e||"").toLowerCase();for(const[t,n]of Object.entries(R._monthNamesIndex))if(s.startsWith(t))return{month:n.value}},DD:e=>({date:parseInt(e)}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:je,DDDo:je,DDDD:je,d:je,do:je,d1:je,dd:je,ddd:je,dddd:je,Q:je,Qo:je,W:je,Wo:je,WW:je,e:je,E:je,HH:e=>({hours:parseInt(e)}),hh:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:uo,SS:uo,SSS:uo,A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A",l:{type:"dynamic",parser:()=>Wu("l")},ll:{type:"dynamic",parser:()=>Wu("ll")},Z:e=>{if(!e||!Ju.test(e)&&e!=="Z")return null;let s=0;if(e!=="Z"){const t=Ju.exec(e);if(t){const n=t[1]==="+"?1:-1,r=parseInt(t[2])||0,i=parseInt(t[3])||0;s=n*(r*60+i)}else s=-1*new Date().getTimezoneOffset()}return{timeZone:s}}},dm=Object.keys(Hu).sort((e,s)=>s.length-e.length),Yu=new RegExp(`(${dm.join("|")})`),hm=new RegExp("^(LL|LLL|lll|LLLL|llll)$"),He={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:24*3652,minute:1440*3652,second:86400*3652,millisecond:864e5*3652},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:24*365,minute:1440*365,second:86400*365,millisecond:864e5*365},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:24*91,minute:1440*91,second:86400*91,millisecond:864e5*91},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-24*30,minute:-1440*30,second:-86400*30,millisecond:-864e5*30},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/(3652*24),year:-1/(365*24),quarter:-1/(91*24),month:-1/(30*24),week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/(3652*1440),year:-1/(365*1440),quarter:-1/(91*1440),month:-1/(30*1440),week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/(3652*86400),year:-1/(365*86400),quarter:-1/(91*86400),month:-1/(30*86400),week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/(3652*864e5),year:-1/(365*864e5),quarter:-1/(91*864e5),month:-1/(30*864e5),week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:1/1e3}},Ku={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",mi:"minute",min:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",mo:"month",mon:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year",dec:"decade",decades:"decade"},fm=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,gm=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,ss=["millisecond","second","minute","hour","day","week","month","quarter","year","decade"],pm=[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],ho=["decade","year","month","week","day","hour","minute","second","millisecond"],mm=["milliseconds","seconds","minutes","hours","date","month","year"],vm=e=>{const s=parseFloat(e);return isNaN(s)?null:s},ym=/^[0-9]+$/,Ju=/([+-])(\d\d):*(\d\d)*$/,ir={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8,decade:9},Sm={round(e,s=1){return Math.round(e/s)*s},floor(e,s=1){return Math.floor(e/s)*s},ceil(e,s=1){return Math.ceil(e/s)*s}},Qu={},Wt=class extends gt(){static get $name(){return"DateHelper"}static set defaultFormat(e){I._defaultFormat=e}static get defaultFormat(){return I._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static buildParser(e){const s=e.split(Yu),t=[];return s.length===1||hm.test(e)?[]:(s.reduce((n,r,i,a)=>{if(i!==0||r!=="")if(Yu.test(r)){const o=this.localize("L{parsers}")||{},l=o[r]||Hu[r];if(r==="Z"&&i<a.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);const c=typeof l=="function"||typeof l=="string"?l:l.parser();if(typeof c=="string"){const u=I.buildParser(c),d=u.pop();delete d.last,t.push(...u),n=d}else n.pattern=r,n.fn=c}else n.splitter=r,t.push(n),n={};else Object.prototype.hasOwnProperty.call(n,"pattern")&&t.push(n);return n},{}),t[t.length-1].last=!0,t)}static makeKey(e){if(e.length===10)return e;e.getTime&&(e=e.getTime());const s=Qu[Math.trunc(e/ao)];if(s)return s;Kn.setTime(e);const t=Kn.getMonth()+1,n=Kn.getDate();return Qu[Math.trunc(e/ao)]=`${Kn.getFullYear()}-${t<10?"0"+t:t}-${n<10?"0"+n:n}`}static parseKey(e){return I.parse(e,"YYYY-MM-DD")}static parse(e,s=I.defaultParseFormat,t=!1){if(e instanceof Date)return e;if(typeof e!="string"||!e)return null;const n={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};s=s.replace(am,om);let r=lo[s],i;if(r||(r=lo[s]=I.buildParser(s)),e.includes("\u202F")&&(e=e.replace(/\s/g," ")),r.reduce((o,l)=>{var c;if(l.last)Object.assign(n,l.fn(o));else{let u;if(l.splitter==="T"&&o.indexOf("T")===-1)u=o.indexOf(" ");else{const f=o.indexOf("+");let{splitter:g}=l;!t&&Uu.test(g)&&(g=Uu),u=l.splitter!==""?o.search(typeof g=="string"?U.escapeRegExp(g):g):((c=l.pattern)==null?void 0:c.length)||-1,f>-1&&u>f&&(u=-1)}let d,h;if(u===-1||l.pattern==="SSS"&&o.match(/^\d+Z$/)){const f=o.split(/([Z\-+])/);f.length===1?(d=o,h=""):(d=f[0],h=`${f[1]}${f[2]}`)}else d=o.substring(0,u)||o,h=o.substring(u+l.splitter.length);if(l.fn){const f=l.fn(d);f?Object.assign(n,f):h=d+h}return h}},e),n.year&&!n.date&&(n.date=1),n.date>31||n.month>12)return null;const a=I.create(n,t);return a?i=a:t||(i=new Date(e)),i}static create(e,s=!1){const t={...e};let n=isNaN(t.year)||s&&(isNaN(t.month)||isNaN(t.date)),r=!1;if(!n){let a=!0;mm.forEach(o=>{(!(o in t)||isNaN(t[o]))&&(t[o]=0),a=a&&t[o]===null}),n=a}if(n||(t.amPm==="am"?t.hours=t.hours%12:t.amPm==="pm"&&(t.hours=t.hours%12+12),"timeZone"in t&&(r=!0,t.minutes-=t.timeZone),s&&(t.year==null||t.month==null||t.date==null)))return null;const i=[oo(t.year,zu),oo(t.month,qu),oo(t.date,Gu),t.hours,t.minutes,t.seconds,t.milliseconds];return r?new Date(Date.UTC(...i)):new Date(...i)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,s=I.defaultFormat){if(!e||isNaN(e))return null;let t=Jn[s],n="";if(!t){t=Jn[s]=[];for(let r=0;r<s.length;r++){const i=s.slice(r).match(cm),a=i==null?void 0:i[0];if(a){const o=this.localize("L{formats}")||{},l=o[a]||Re[a];t.push(l),r+=a.length-1}else if(s[r]==="{"){const o=s.indexOf("}",r+1);o===-1?(t.push(s.substr(r+1)),r=s.length):(t.push(s.substring(r+1,o)),r=o)}else t.push(s[r])}}return t.forEach(r=>{typeof r=="string"?n+=r:n+=r(e)}),n}static formatRange(e,s){return s.replace(nm,(t,n,r)=>Wt.format(e[n==="S"?0:1],r))}static asMilliseconds(e,s=null){return typeof e=="string"&&(s=e,e=1),I.as("millisecond",e,s)}static asMonths(e){const s=I.as("ms",I.daysInMonth(e),"day"),t=(e.valueOf()-I.startOf(e,"month").valueOf())/s;return e.getYear()*12+e.getMonth()+t}static monthsToDate(e){const s=Math.floor(e),t=e-s,n=new Date(0,s),r=I.as("ms",I.daysInMonth(n),"days");return n.setTime(n.getTime()+t*r),n}static formatDelta(e,s){let t,n;typeof s=="boolean"?t=s:s&&(t=s.abbrev);const r=this.getDelta(e,s),i=[],a=(s==null?void 0:s.separator)||(t?"":" ");for(n in r)i.push(`${r[n]}${a}${n}`);return(s==null?void 0:s.asString)===!1?i:i.join(", ")}static getDelta(e,s){let t,n,r,i,a,o,l;typeof s=="boolean"?t=s:s&&(t=s.abbrev,i=I.normalizeUnit(s.precision),o=s.maxUnit,l=!t&&s.ignoreLocale);const c={},u=t?I.getShortNameOfUnit:I.getLocalizedNameOfUnit,d=o?ho.slice(ho.indexOf(o)):ho;for(a of d)if(n=I.as(a,e),r=i===a,n=Math[r?"round":"floor"](n),(n||r&&!c.length)&&(c[l?a:u.call(I,a,n!==1)]=n,e-=I.as("ms",n,a)),r||!e)break;return c}static as(e,s,t="ms"){return typeof s=="string"&&(s=I.parseDuration(s)),typeof s=="object"&&(t=s.unit,s=s.magnitude),e===t||(e=I.normalizeUnit(e),t=I.normalizeUnit(t),e===t)?s:ir[t]>ir[e]?s*Math.abs(He[t][e]):s/Math.abs(He[e][t])}static formatContainsHourInfo(e){const s=/(\\.)/g;return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(s,""))}static is24HourFormat(e){return I.format(I.getTime(13,0,0),e).includes("13")}static add(e,s,t="ms",n=!0){let r;if(typeof e=="string"?r=I.parse(e):n?r=new Date(e.getTime()):r=e,typeof s=="string"){const i=Wt.parseDuration(s);s=i.magnitude,t=i.unit}else s&&typeof s=="object"&&(t=s.unit,s=s.magnitude);if(!t||s===0)return r;switch(t=I.normalizeUnit(t),t){case"millisecond":r.setTime(r.getTime()+s);break;case"second":r.setTime(r.getTime()+s*1e3);break;case"minute":r.setTime(r.getTime()+s*6e4);break;case"hour":r.setTime(r.getTime()+s*36e5);break;case"day":s%1===0?(r.setDate(r.getDate()+s),r.getHours()===23&&e.getHours()===0&&r.setHours(r.getHours()+1)):r.setTime(r.getTime()+s*864e5);break;case"week":r.setDate(r.getDate()+s*7);break;case"month":{let i=r.getDate();i>28&&(i=Math.min(i,I.getLastDateOfMonth(I.add(I.getFirstDateOfMonth(r),s,"month")).getDate())),r.setDate(i),r.setMonth(r.getMonth()+s);break}case"quarter":I.add(r,s*3,"month",!1);break;case"year":r.setFullYear(r.getFullYear()+s);break;case"decade":r.setFullYear(r.getFullYear()+s*10);break}return r}static diff(e,s,t="ms",n=!0){if(t=I.normalizeUnit(t),!e||!s)return 0;let r;switch(t){case"year":r=I.diff(e,s,"month")/12;break;case"quarter":r=I.diff(e,s,"month")/3;break;case"month":r=(s.getFullYear()-e.getFullYear())*12+(s.getMonth()-e.getMonth()),r===0&&n&&(r=I.diff(e,s,"day",n)/I.daysInMonth(e));break;case"week":r=I.diff(e,s,"day")/7;break;case"day":{const i=e.getTimezoneOffset()-s.getTimezoneOffset();r=(s-e+i*60*1e3)/864e5;break}case"hour":r=(s-e)/36e5;break;case"minute":r=(s-e)/6e4;break;case"second":r=(s-e)/1e3;break;case"millisecond":r=s-e;break}return n?r:Math.round(r)}static startOf(e,s="day",t=!0,n=I.weekStartDay){if(!e)return null;switch(s=I.normalizeUnit(s),t&&(e=I.clone(e)),s){case"year":return e.setMonth(0,1),e.setHours(0,0,0,0),e;case"quarter":return e.setMonth((I.get(e,"quarter")-1)*3,1),e.setHours(0,0,0,0),e;case"month":return e.setDate(1),e.setHours(0,0,0,0),e;case"week":{const r=e.getDay()-n;return e.setDate(e.getDate()-r),e.setHours(0,0,0,0),e}case"day":return e.setHours(0,0,0,0),e;case"hour":e.getMinutes()>0&&e.setMinutes(0);case"minute":e.getSeconds()>0&&e.setSeconds(0);case"second":e.getMilliseconds()>0&&e.setMilliseconds(0);case"millisecond":return e}}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,s=!0){return e?(s&&(e=new Date(e.getTime())),e.setHours(0,0,0,0),e):null}static midnight(e,s){let t=I.clearTime(e);return s&&t<e&&(t=I.add(t,1,"d")),t}static getTimeOfDay(e,s="ms"){const t=e.getHours()*He.hour.millisecond+e.getMinutes()*He.minute.millisecond+e.getSeconds()*He.second.millisecond+e.getMilliseconds();return s==="ms"?t:I.as(s,t,"ms")}static set(e,s,t){if(!s)return e;if(typeof s=="string")switch(I.normalizeUnit(s)){case"millisecond":(t!==0||e.getMilliseconds()>0)&&e.setMilliseconds(t);break;case"second":(t!==0||e.getSeconds()>0)&&e.setSeconds(t);break;case"minute":(t!==0||e.getMinutes()>0)&&e.setMinutes(t);break;case"hour":e.setHours(t);break;case"day":case"date":e.setDate(t);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(t);break;case"quarter":e.setDate(1),e.setMonth((t-1)*3);break;case"year":e.setFullYear(t);break}else Object.entries(s).sort((n,r)=>ir[n[0]]-ir[r[0]]).forEach(([n,r])=>{I.set(e,n,r)});return e}static setDateToMidday(e,s=!0){return I.set(I.clearTime(e,s),"hour",12)}static constrain(e,s,t){return s!=null&&(e=I.max(e,s)),t==null?e:I.min(e,t)}static getTime(e,s=0,t=0,n=0){return e instanceof Date&&(n=e.getMilliseconds(),t=e.getSeconds(),s=e.getMinutes(),e=e.getHours()),new Date(zu,qu,Gu,e,s,t,n)}static copyTimeValues(e,s){return e.setHours(s.getHours()),e.setMinutes(s.getMinutes()),e.setSeconds(s.getSeconds()),e.setMilliseconds(s.getMilliseconds()),e}static get isDSTEnabled(){const e=new Date().getFullYear(),s=new Date(e,0,1),t=new Date(e,6,1);return s.getTimezoneOffset()!==t.getTimezoneOffset()}static isDST(e){const s=e.getFullYear(),t=new Date(s,0,1),n=new Date(s,6,1);return e.getTimezoneOffset()<Math.max(t.getTimezoneOffset(),n.getTimezoneOffset())}static isBefore(e,s){return e<s}static isAfter(e,s){return e>s}static isEqual(e,s,t=null){return t===null?e&&s&&e.getTime()===s.getTime():I.startOf(e,t)-I.startOf(s,t)===0}static compare(e,s,t=null){return t&&(e=I.startOf(e,t),s=I.startOf(s,t)),e<s?-1:e>s?1:0}static clamp(e,s,t){if(!isNaN(e))return s!=null&&(e=Math.max(e,s)),t!=null&&(e=Math.min(e,t)),new Date(e)}static isSameDate(e,s){return I.compare(e,s,"d")===0}static isSameTime(e,s){return e.getHours()===s.getHours()&&e.getMinutes()===s.getMinutes()&&e.getSeconds()===s.getSeconds()&&e.getMilliseconds()===s.getMilliseconds()}static isStartOf(e,s){return I.isEqual(e,I.startOf(e,s))}static betweenLesser(e,s,t){return s.getTime()<=e.getTime()&&e.getTime()<t.getTime()}static betweenLesserEqual(e,s,t){return s.getTime()<=e.getTime()&&e.getTime()<=t.getTime()}static intersectSpans(e,s,t,n){return I.betweenLesser(e,t,n)||I.betweenLesser(t,e,s)}static compareUnits(e,s){return Math.sign(ir[I.normalizeUnit(e)]-ir[I.normalizeUnit(s)])}static timeSpanContains(e,s,t,n){return t-e>=0&&s-n>=0}static get weekStartDay(){return I._weekStartDay==null&&(I._weekStartDay=this.localize("L{weekStartDay}")||0),I._weekStartDay}static get nonWorkingDays(){return{...this.localize("L{nonWorkingDays}")}}static get nonWorkingDaysAsArray(){return Object.keys(this.nonWorkingDays).map(Number)}static get weekends(){return{...this.localize("L{weekends}")}}static get(e,s){switch(I.normalizeUnit(s)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return Re.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInYear(e){const s=e.getFullYear(),t=new Date(s+1,0,1)-new Date(s,0,1);return this.as("day",t)}static daysInMonth(e){return 32-new Date(e.getFullYear(),e.getMonth(),32).getDate()}static hoursInDay(e){const s=e.getFullYear(),t=e.getMonth(),n=e.getDate(),r=new Date(s,t,n+1)-new Date(s,t,n);return this.as("hour",r)}static getNormalizedUnitDuration(e,s){let t;switch(s){case"month":t=I.asMilliseconds(I.daysInMonth(e),"day");break;case"year":t=I.asMilliseconds(I.daysInYear(e),"day");break;case"day":t=I.asMilliseconds(I.hoursInDay(e),"hour");break;default:t=I.asMilliseconds(s)}return t}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,s){return e.getTime()<s.getTime()?e:s}static max(e,s){return e.getTime()>s.getTime()?e:s}static getNext(e,s,t=1,n=I.weekStartDay){if(s==="week"){const r=I.clone(e),i=r.getDay();return I.startOf(r,"day",!1),I.add(r,n-i+7*(t-(n<=i?0:1)),"day",!1),r.getDay()!==n&&I.add(r,1,"hour"),r}return I.startOf(I.add(e,t,s),s,!1)}static isValidDate(e){return I.isDate(e)&&!isNaN(e)}static isDate(e){return e&&Nu.call(e)===sm}static getStartOfNextDay(e,s=!1,t=!1){let n=I.add(t?e:I.clearTime(e,s),1,"day");if(n.getDate()===e.getDate()){const r=I.add(I.clearTime(e,s),2,"day").getTimezoneOffset(),i=e.getTimezoneOffset();n=I.add(n,i-r,"minute")}return n}static getEndOfPreviousDay(e,s=!1){const t=s?e:I.clearTime(e,!0);return t-e?t:I.add(t,-1,"day")}static getWeekDescription(e,s=e){const t=e.getMonth()===s.getMonth()?Wt.format(e,"MMMM"):`${Wt.format(e,"MMM")} - ${Wt.format(s,"MMM")}`,n=Wt.getWeekNumber(e);return`${n[1]}, ${t} ${n[0]}`}static getWeekNumber(e,s=Wt.weekStartDay){const t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),11,31),r=Vu(t.getDay()-s),i=Vu(n.getDay()-s),a=im(e,t);let o;if(r<4?o=Math.floor((a+r-1)/7)+1:o=Math.floor((a+r-1)/7),o){let c=e.getFullYear();return o===53&&i<3&&(c++,o=1),[c,o]}const l=Wt.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,l]}static formatCount(e,s){return s=I.normalizeUnit(s),e!==1&&(s+="s"),e+" "+s}static getUnitToBaseUnitRatio(e,s,t=!1){return e=I.normalizeUnit(e),s=I.normalizeUnit(s),e===s?1:He[e]&&He[e][s]&&(t||He[e][s]>0)?1/I.as(s,1,e):He[s]&&He[s][e]&&(t||He[s][e]>0)?I.as(e,1,s):-1}static getShortNameOfUnit(e){return e=I.parseTimeUnit(e),I.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,s=!1){const t=e.charAt(0)===e.charAt(0).toUpperCase();return e=I.normalizeUnit(e),e=I.parseTimeUnit(e),e=I.unitLookup[e][s?"plural":"single"],t&&(e=U.capitalize(e)),e}static normalizeUnit(e){if(!e)return null;const s=e.toLowerCase();return s==="date"||ss.includes(s)?s:Ku[e]||Ku[s]}static getUnitByName(e){return I.normalizeUnit(e)||I.normalizeUnit(I.parseTimeUnit(e))}static getDurationInUnit(e,s,t,n){return I.diff(e,s,t,n)}static doesUnitsAlign(e,s){return!(e!==s&&s==="week")}static getSmallerUnit(e){return ss[ir[I.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return ss[ir[I.normalizeUnit(e)]+1]||null}static round(e,s,t,n){return I.snap("round",e,s,t,n)}static floor(e,s,t,n){return I.snap("floor",e,s,t,n)}static ceil(e,s,t,n){return I.snap("ceil",e,s,t,n)}static snap(e,s,t,n,r=I.weekStartDay){const i=Sm[e];if(typeof t=="string"&&(t=I.parseDuration(t)),_.isObject(t)){const a=t.magnitude||t.increment;switch(t.unit){case"week":{const o=s.getDay();return n=I.add(I.clearTime(s),o>=r?r-o:-(o-r+7),"day"),I[e](s,`${a*7} days`,n)}case"month":{s=I.asMonths(s);let o;return n?(n=I.asMonths(n),o=s+i(s-n,a)):o=i(s,a),I.monthsToDate(o)}case"quarter":return I[e](s,`${a*3} months`,n);case"year":return I[e](s,`${a*12} months`,n);case"decade":return I[e](s,`${a*10} years`,n)}t=I.as("ms",a,t.unit)}if(n){const a=I.as("ms",n.getTimezoneOffset()-s.getTimezoneOffset(),"ms");return new Date(n.valueOf()+i(I.diff(n,s,"ms")+a,t))}else{const a=s.getTimezoneOffset()*60*1e3;return new Date(i(s.valueOf()-a,t)+a)}}static parseDuration(e,s=!0,t){var n;const r=s?fm:gm,i=r.exec(e);if(e==null||!i)return null;const a=vm((n=i[1])==null?void 0:n.replace(",",".")),o=I.parseTimeUnit(i[2])||t;return o?{magnitude:a,unit:o}:null}static parseTimeUnit(e){const s=e==null?null:I.durationRegEx.exec(e.toLowerCase());if(!s)return null;for(let t=0;t<ss.length;t++)if(s[t+1])return ss[t]}static getGMTOffset(e=new Date){if(!e)return;const s=e.getTimezoneOffset();return s?(s>0?"-":"+")+Math.abs(Math.trunc(s/60)).toString().padStart(2,"0")+":"+Math.abs(s%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),s=I._dayNames||[],t=I._dayShortNames||[];s.length=0,t.length=0;for(let n=2;n<9;n++)e.setDate(n),s.push(I.format(e,"dddd")),t.push(I.format(e,"ddd"));I._dayNames=s,I._dayShortNames=t}static getDayNames(){return I._dayNames}static getDayName(e){return I._dayNames[e]}static getDayShortNames(){return I._dayShortNames}static getDayShortName(e){return I._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),s=I._monthNames||[],t=I._monthShortNames||[],n={},r={};s.length=0,t.length=0;for(let i=0;i<12;i++){e.setMonth(i);const a=I.format(e,"MMMM");s.push(a);const o=I.format(e,"MMM");t.push(o),n[a.toLowerCase()]={name:a,value:i},r[o.toLowerCase()]={name:o,value:i}}I._monthNames=s,I._monthShortNames=t,I._monthNamesIndex=n,I._monthShortNamesIndex=r}static getMonthShortNames(){return I._monthShortNames}static getMonthShortName(e){return I._monthShortNames[e]}static getMonthNames(){return I._monthNames}static getMonthName(e){return I._monthNames[e]}static set locale(e){sr=e,nr={},Jn={},Ls={}}static get locale(){return sr}static setupDurationRegEx(e=[],s=[]){const t=this,n={};let r="";for(let i=0;i<s.length;i++){const a=s[i],o=e[i];o.canonicalUnitName=ss[i],n[o.single]=n[o.single.toUpperCase()]=n[o.canonicalUnitName]=n[o.canonicalUnitName.toUpperCase()]=o,r+=`${i?"|":""}(`;for(let l=0;l<a.length;l++)r+=`${a[l]}|`;if(sr=t.localize("L{locale}")||"en-US",sr!=="en-US"){const l=pm[i];for(let c=0;c<l.length;c++)r+=`${l[c]}|`}r+=`${o.single}|${o.plural}|${o.canonicalUnitName}|${o.canonicalUnitName}s)`}t.unitLookup=n,t.durationRegEx=new RegExp(`^(?:${r})$`)}static applyLocale(){const e=this,s=e.localize("L{unitAbbreviations}")||[],t=e.unitNames=e.localize("L{unitNames}");t!=="unitNames"&&(sr=e.localize("L{locale}")||"en-US",sr==="en-US"?Ut=Bu:Ut=e.localize("L{ordinalSuffix}")||Ut,Jn={},Ls={},lo={},nr={},I._weekStartDay=null,I.setupDurationRegEx(t,s),I.fillDayNames(),I.fillMonthNames())}},R=Wt;F(R,"MS_PER_DAY",ao*24);var I=R;I.useIntlFormat=Ae,Ge.ion({locale:"applyLocale",prio:1e3,thisObj:I}),Ge.locale&&I.applyLocale(),R._$name="DateHelper";var Zu=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},fo=class extends O([es],e=>class extends e{constructor(){super(...arguments),this.identifierCls=ed}}){},Xu=(e,s=fo)=>qe(e,s),go=class extends O([ut],e=>{class s extends e{constructor(){super(...arguments),this.field=void 0,this.proposedValueIsBuilt=!0}hasBucket(){return!!this.field.bucket}getBucket(n){return n.$[this.field.bucket]}buildProposedValue(n,r,i){const a=r.proposedValue;if(a===null)return null;const o=ze(a,xt)?a:n.resolve(a);return o&&n.hasBucket()&&n.getBucket(o).addToBucket(i,n.self),o}resolve(n){const r=this.field.resolver;return r?r.call(this.self,n):null}enterGraph(n){if(this.hasBucket()){const r=n.activeTransaction.readProposedOrPrevious(this);r instanceof xt&&this.getBucket(r).addToBucket(n.activeTransaction,this.self)}super.enterGraph(n)}leaveGraph(n){if(this.hasBucket()){const r=n.activeTransaction.readProposedOrPrevious(this);r instanceof xt&&this.getBucket(r).removeFromBucket(n.activeTransaction,this.self)}super.leaveGraph(n)}write(n,r,i,a,...o){const l=i||r.acquireQuarkIfExists(n);if(n.hasBucket()){if(l){const c=l.getValue();c instanceof xt&&n.getBucket(c).removeFromBucket(r,n.self)}else if(r.baseRevision.hasIdentifier(n)){const c=r.readPrevious(n);c instanceof xt&&n.getBucket(c).removeFromBucket(r,n.self)}}super.write(n,r,i,a)}}return Zu([G(Pt.DependsOnlyOnUserInput)],s.prototype,"level",void 0),Zu([G(Zr)],s.prototype,"quarkClass",void 0),s}){},ed=class extends go.mix(ut.mix(Xr)){},td=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},po=class extends O([es],e=>class extends e{constructor(){super(...arguments),this.persistent=!1,this.identifierCls=id}}){},rd=(e,s=po)=>qe(e,s),ns;(function(e){e.Add="Add",e.Remove="Remove"})(ns||(ns={}));var sd=class extends O([Bn],e=>class extends e{constructor(){super(...arguments),this.mutations=[],this.previousValue=void 0}hasProposedValueInner(){return this.mutations.length>0}}){},nd=sd.mix(Zr),mo=class extends O([ut],e=>{class s extends e{constructor(){super(...arguments),this.proposedValueIsBuilt=!0}addToBucket(n,r){const i=n.getWriteTarget(this);i.mutations.push({type:ns.Add,entity:r});const a=n.baseRevision;!i.previousValue&&a.hasIdentifier(this)&&(i.previousValue=n.readPrevious(this))}removeFromBucket(n,r){const i=n.entries.get(this);if(i&&i.getValue()===ee)return;const a=n.getWriteTarget(this);a.mutations.push({type:ns.Remove,entity:r});const o=n.baseRevision;!a.previousValue&&o.hasIdentifier(this)&&(a.previousValue=n.readPrevious(this))}buildProposedValue(n,r,i){const a=r,o=new Set(a.previousValue);for(let l=0;l<a.mutations.length;l++){const{type:c,entity:u}=a.mutations[l];c===ns.Remove?o.delete(u):c===ns.Add&&o.add(u)}return o}leaveGraph(n){super.leaveGraph(n),this.DATA=void 0}}return td([G(Pt.DependsOnlyOnDependsOnlyOnUserInput)],s.prototype,"level",void 0),td([G(nd)],s.prototype,"quarkClass",void 0),s}){},id=class extends mo.mix(ut.mix(Xr)){},Qn=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},ar=function(e,s){return e===s||(s!=null&&s.isBase?this.serialize(s):s)===(e!=null&&e.isBase?this.serialize(e):e)},Zn=class extends es{constructor(){super(...arguments),this.modelFieldConfig={}}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?pa(e)?ld:od:cd}},Tr=class extends fo.mix(Zn){constructor(){super(...arguments),this.identifierCls=Ns}},Or=class extends po.mix(es){constructor(){super(...arguments),this.identifierCls=ei}},Xn=Symbol("IsChronoModelSymbol"),is=class extends O([ut],e=>{const s=e.prototype;class t extends e{[Xn](){}getFromGraph(r){var i,a;if(r){if(r.readMode===Lt.CurrentOrProposedOrPrevious){const o=r.isCommitting&&this.level>((a=(i=r.activeTransaction.getActiveEntry())==null?void 0:i.level)!=null?a:Number.MAX_SAFE_INTEGER);return this.sync&&!this.context.project.isDelayingCalculation&&!o?r.get(this):r.activeTransaction.readCurrentOrProposedOrPrevious(this)}return s.getFromGraph.call(this,r)}else return this.DATA}writeToGraph(r,i,...a){r?s.writeToGraph.call(this,r,i,...a):(this.DATA=i,!this.self.inSetting&&!this.self.isConstructing&&this.self.set(this.field.name,i,!1,!1,!0))}write(r,i,a,o,...l){o=r.convert(o),s.write.call(this,r,i,a,o,...l)}convert(r){const i=this.field,a=this.self.getFieldDefinition(i.name);return a!=null&&a.convert?r=a.convert(r,this.context.data,this.context):i.converter&&(r=i.converter(r,i)),r}equality(r,i){return r instanceof Date&&i instanceof Date?r.getTime()===i.getTime():r===i}}return Qn([G(!1)],t.prototype,"sync",void 0),t}){},ad=class extends O([Zr],e=>{const s=e.prototype;class t extends e{setValue(r){s.setValue.call(this,r),r!==ee&&(this.identifier.DATA=r)}}return t}){},Ns=class extends go.mix(is.mix(As)){buildProposedValue(e,s,t){const n=s,r=n.proposedValue;if(r==null)return t.candidate.failedResolutionReferences.delete(n.identifier),null;if(ze(r,xt)&&r.graph)return e.hasBucket()&&e.getBucket(r).addToBucket(t,e.self),t.candidate.failedResolutionReferences.delete(n.identifier),r;const i=e.resolve(r);return ze(i,xt)&&i.graph?(e.hasBucket()&&e.getBucket(i).addToBucket(t,e.self),t.candidate.failedResolutionReferences.delete(n.identifier),i):(t.candidate.failedResolutionReferences.set(n.identifier,r),null)}};Qn([G(!0)],Ns.prototype,"sync",void 0),Qn([G(ad)],Ns.prototype,"quarkClass",void 0);var ei=class extends mo.mix(is.mix(As)){};Qn([G(!0)],ei.prototype,"sync",void 0);var od=class extends is.mix(As){},ld=class extends is.mix(Ba){},cd=class extends is.mix(Va){},N=function(e={},s={},t=Zn){return function(n,r){qe({modelFieldConfig:e,...s},t)(n,r),ti(n.constructor)}},ti=e=>{e.hasOwnProperty("fields")||Object.defineProperty(e,"fields",{get:function(){return ud(this)}})},ud=e=>{const s=e.prototype,t=[];return s.hasOwnProperty("$entity")&&s.$entity.ownFields.forEach(n=>{if(n instanceof Zn){const r=n.modelFieldConfig||{};!r.convert&&n.converter&&n.converter!==zt&&(r.convert=n.converter),t.push(Object.assign(r,{$chrono:n,name:n.name}))}}),t},zt=(e,s)=>{var t,n;return e===null?null:(e instanceof Date||(e=R.parse(e,((t=s.modelFieldConfig)==null?void 0:t.format)||((n=s.modelFieldConfig)==null?void 0:n.dateFormat)||R.defaultParseFormat)),e||void 0)},dd=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},bt;(function(e){e.Cancel="Cancel",e.Resume="Resume"})(bt||(bt={}));var Bs=class extends ${getDescription(){throw new Error("Abstract method")}resolve(...e){throw new Error("Abstract method")}},Vs=class extends ye{getResolutions(){return this._resolutions}getDescriptionBuilderClass(){return this._descriptionBuilderClass}setDescriptionBuilderClass(e){this._descriptionBuilderClass=e}getDescription(){return this.getDescriptionBuilderClass().getDescription(this)}};dd([G("schedulingIssueEffect")],Vs.prototype,"type",void 0),dd([G(!1)],Vs.prototype,"sync",void 0);var hd=e=>Number(e)!==e,vo=e=>e instanceof Set||e instanceof Array?Me(e):Me([e]),fd=e=>new Promise(s=>setTimeout(s,e)),pt=(e,...s)=>e.replace(/{(\d+)}/g,(t,n)=>typeof s[n]!="undefined"?s[n]:t),{hasOwn:yo}=_,gd=1.005.toFixed(2)==="1.01"?null:function(e,s){const t=e.toString().split("."),n=+(t[1]?t.join(".")+"1":t[0]);return e.toFixed.call(n,s)},x=class extends _{static transformArrayToNamedObject(e,s="ref"){const t={};return e.forEach((n,r)=>{const i=n[s]!=null&&n[s].toString().length?n[s]:r;t[i]=n}),t}static transformNamedObjectToArray(e,s="ref"){return Object.keys(e).filter(t=>e[t]).map(t=>{const n=e[t];return n[s]=t,n})}static isEqual(e,s,t=!1){if(e===null&&s!==null||e===void 0&&s!==void 0||s===null&&e!==null||s===void 0&&e!==void 0)return!1;if(e==null&&s==null||e===s)return!0;const n=typeof e;if(n===typeof s){switch(n){case"number":case"string":case"boolean":return e===s}switch(!0){case(e instanceof Date&&s instanceof Date):return e.getTime()===s.getTime();case(Array.isArray(e)&&Array.isArray(s)):return e.length===s.length?e.every((i,a)=>nt.isEqual(i,s[a],t)):!1;case(n==="object"&&e.constructor.prototype===s.constructor.prototype):return t?nt.isDeeplyEqual(e,s,t):U.safeJsonStringify(e)===U.safeJsonStringify(s)}}return String(e)===String(s)}static isDeeplyEqual(e,s,t={}){if(e===s)return!0;if(!e||!s)return!1;const n=nt.keys(e,t.ignore),r=nt.keys(s,t.ignore);if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++){const a=n[i],o=r[i];if(a!==o)return!1;const l=e[a],c=s[o];if(!(t.shouldEvaluate&&t.shouldEvaluate(a,{value:l,object:e},{value:c,object:s})===!1)){if(t.evaluate){const u=t.evaluate(a,{value:l,object:e},{value:c,object:s});if(u===!1)return!1;if(u===!0)continue}if(!nt.isEqual(l,c,t))return!1}}return!0}static isPartial(e,s){return e=String(e).toLowerCase(),s=String(s).toLowerCase(),e.indexOf(s)!==-1}static isLessThan(e,s){return e instanceof Date&&s instanceof Date?R.isBefore(e,s):e<s}static isMoreThan(e,s){return e instanceof Date&&s instanceof Date?R.isAfter(e,s):e>s}static fork(e){let s,t,n;if(e&&e.constructor===Object){s=Object.setPrototypeOf({},e);for(t in e)n=e[t],n&&(n.constructor===Object?s[t]=nt.fork(n):n instanceof Array&&(s[t]=n.slice()))}else s=e;return s}static copyProperties(e,s,t){let n,r;for(r=0;r<t.length;r++)n=t[r],n in s&&(e[n]=s[n]);return e}static copyPropertiesIf(e,s,t){if(s)for(const n of t)!(n in e)&&n in s&&(e[n]=s[n]);return e}static entries(e,s){const t=[],n=typeof s=="function";if(e)for(const r in e)(n?!s(r,e[r]):!(s!=null&&s[r]))&&t.push([r,e[r]]);return t}static fromEntries(e,s){if(s=s||{},e)for(let t=0;t<e.length;++t)s[e[t][0]]=e[t][1];return s}static keys(e,s,t){const n=[],r=typeof s=="function";if(e){let i=0;for(const a in e)(r?!s(a,e[a]):!(s!=null&&s[a]))&&(n.push(t?t(a,i):a),++i)}return n}static values(e,s,t){const n=[],r=typeof s=="function";if(e){let i=0;for(const a in e)(r?!s(a,e[a]):!(s!=null&&s[a]))&&(n.push(t?t(e[a],i):e[a]),++i)}return n}static pathExists(e,s){return s.split(".").every(n=>!e||!(n in e)?!1:(e=e[n],!0))}static pathifyKeys(e,s){const t={};for(const n in e)if(yo(e,n)){const r=s==null?void 0:s[n],i=(r==null?void 0:r.type)==="object"||(r==null?void 0:r.complexMapping)||!s;if(i&&Array.isArray(e[n]))t[n]=e[n].slice();else if(i&&e[n]instanceof Object){const a=this.pathifyKeys(e[n]);for(const o in a)t[`${n}.${o}`]=a[o]}else t[n]=e[n]}return t}static deletePath(e,s){s.split(".").reduce((t,n,r,i)=>{if(t==null)return null;if(yo(t,n))if(r===i.length-1)delete t[n];else return t[n]},e)}static coerce(e,s){const t=_.typeOf(e),n=_.typeOf(s),r=typeof e=="string";if(t!==n)switch(n){case"string":return String(e);case"number":return Number(e);case"boolean":return r&&(!e||e==="false"||e==="0")?!1:!!e;case"null":return r&&(!e||e==="null")?null:!1;case"undefined":return r&&(!e||e==="undefined")?void 0:!1;case"date":return r&&isNaN(e)?R.parse(e):Date(Number(e))}return e}static wrapProperty(e,s,t,n,r=!0){const i={};let a=Object.getPrototypeOf(e),o=Object.getOwnPropertyDescriptor(a,s);for(;!o&&a&&r;)a=Object.getPrototypeOf(a),a&&(o=Object.getOwnPropertyDescriptor(a,s));o?(o.set?i.set=l=>{o.set.call(e,l),n&&n.call(e,o.get.call(e))}:i.set=n,o.get?i.get=()=>{let l=o.get.call(e);return t&&(l=t.call(e,l)),l}:i.get=t):(i.set=l=>{e[`_${s}`]=l,n&&n.call(e,l)},i.get=()=>{let l=e[`_${s}`];return t&&(l=t.call(e,l)),l}),Object.defineProperty(e,s,i)}static hookProperty(e,s,t){const n=x.getPropertyDescriptor(t.prototype,"value"),r=x.getPropertyDescriptor(e,s),i=`_${s}`,a=class{get value(){return r?r.get.call(this):this[i]}set value(l){r?r.set.call(this,l):this[i]=l}},o=x.getPropertyDescriptor(a.prototype,"value");return Object.setPrototypeOf(t.prototype,a.prototype),Object.defineProperty(e,s,{configurable:!0,get:n.get||o.get,set:n.set||o.set}),()=>delete e[s]}static getPropertyDescriptor(e,s){let t=null;for(let n=e;n&&!t&&!yo(n,"isBase");n=Object.getPrototypeOf(n))t=Object.getOwnPropertyDescriptor(n,s);return t}static cleanupProperties(e,s=!1){return Object.entries(e).forEach(([t,n])=>{s?n===void 0&&delete e[t]:n==null&&delete e[t]}),e}static removeAllProperties(e){return Object.keys(e).forEach(s=>delete e[s]),e}static assertType(e,s,t){const n=_.typeOf(e);if(e!=null&&n!==s)throw new Error(`Incorrect type "${n}" for ${t}, expected "${s}"`)}static assertObject(e,s){nt.assertType(e,"object",s)}static assertInstance(e,s){nt.assertType(e,"instance",s)}static assertClass(e,s){nt.assertType(e,"class",s)}static assertFunction(e,s){if(typeof e!="function"||e.isBase||e.$$name)throw new Error(`Incorrect type for ${s}, got "${e}" (expected a function)`)}static assertNumber(e,s){const t=Number(e);if(typeof e!="number"||isNaN(t))throw new Error(`Incorrect type for ${s}, got "${e}" (expected a Number)`)}static assertBoolean(e,s){nt.assertType(e,"boolean",s)}static assertString(e,s){nt.assertType(e,"string",s)}static assertArray(e,s){nt.assertType(e,"array",s)}static toFixed(e,s){return gd?gd(e,s):e.toFixed(s)}static roundTo(e,s=1){return Math.round(e/s)*s}static round(e,s){if(s==null)return e;const t=10**s;return Math.round(e*t)/t}static getMapPath(e,s,t){const n=Array.isArray(s)?s:typeof s=="string"?s.split("."):[s],r=n.length===1,i=n[0],a=e.has(i)?e.get(i):e.set(i,r?t:{}).get(i);return r?a:nt.getPathDefault(a,n.slice(1),t)}},nt=x;x._$name="ObjectHelper";var pd=Symbol("STM_PROP"),md={parentIndex:1},vd=e=>class extends(e||$){static get $name(){return"ModelStm"}static get defaultConfig(){return{stm:null}}joinStore(t){this.stm||(this.stm=t.stm)}unjoinStore(t,n=!1){var r;this.stm===t.stm&&(this.stm=null),(r=super.unjoinStore)==null||r.call(this,t,n)}get stm(){return this[pd]}set stm(t){this[pd]=t}beforeChronoFieldSet(t,n){var r;const i=this;return!i.inSetting&&((r=i.stm)!=null&&r.enabled)&&!md[t]&&!i.constructor.nonPersistableFields[t]&&i.getFieldDefinition(t)?{[t]:{value:n,oldValue:i[t]}}:null}afterChronoFieldSet(t,n,r){r&&this.afterSet(t,n,!1,!1,r,!0)}shouldRecordFieldChange(t,n,r){const i=this.firstStore;return!(this.constructor.nonPersistableFields[t]||n==null&&r==null||n===r||n instanceof Date&&r instanceof Date&&n.getTime()===r.getTime()||t==="id"||t==="$PhantomId"||t==="parentId"&&i&&i.oldIdMap[n]===i.getById(r))}afterSet(t,n,r,i,a,o){const{stm:l}=this,c=this.constructor.nonPersistableFields;if(l!=null&&l.isBase&&l.enabled&&!md[t]&&!c[t]&&a){let u;const[d,h]=Object.keys(a).reduce((f,g)=>{const{value:p,oldValue:m}=a[g];return this.shouldRecordFieldChange(g,m,p)&&(u=!0,f[0][g]=p,f[1][g]=m),f},[{},{}]);u&&l.onModelUpdate(this,d,h,o)}}beforeInsertChild(t){var n;const r=((n=super.beforeInsertChild)==null?void 0:n.call(this,t))||[],{stm:i}=this;return i!=null&&i.enabled&&r.push(t.reduce((a,o)=>(o.root===this.root&&a.set(o,{parent:o.parent,index:o.parent?o.parentIndex:void 0}),a),new Map)),r}afterInsertChild(t,n,r,i){var a;const{stm:o}=this;if(o!=null&&o.enabled){const l=r.pop();i&&o.onModelInsertChild(this,t,i,l)}(a=super.afterInsertChild)==null||a.call(this,t,n,r,i)}beforeRemoveChild(t,n){const r=super.beforeRemoveChild?super.beforeRemoveChild(t,n):[],{stm:i}=this;return i!=null&&i.enabled&&!n&&r.push(t.reduce((a,o)=>(a.set(o,{parentIndex:o.parentIndex,orderedParentIndex:o.orderedParentIndex}),a),new Map)),r}afterRemoveChild(t,n,r){var i;const{stm:a}=this;if(a!=null&&a.enabled&&!r){const o=n.pop();t&&t.length&&a.onModelRemoveChild(this,t,o)}(i=super.afterRemoveChild)==null||i.call(this,t,n,r)}},Dm={includeFilteredOutRecords:!1},So=e=>(e=e||!1,typeof e=="boolean"&&(e={includeFilteredOutRecords:e}),e||Dm),yd=e=>class extends(e||$){static get $name(){return"TreeNode"}static set convertEmptyParentToLeaf(t){t===!0?t={onLoad:!0,onRemove:!0}:t===!1&&(t={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=t}constructor(...t){super(...t),this.children&&(this.orderedChildren=this.orderedChildren||[])}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(t,n=this.stores){const{inProcessChildren:r,constructor:i}=this,a=n[0];if(t===!0)return r?!0:[];if(t){t=W.asArray(t);const o=t.length,l=[];for(let c=0,u;c<o;c++)u=t[c],u=u.isModel?u:a?a.createRecord(u,!1,!0):new i(u,null,null,!0),u=a?a.processRecord(u):u,l.push(u);if(this.children===!0&&a){const c=a.createSorterFn(a.sorters);l.sort(c)}return l}}processChildren(t=this.stores){const n=this,{meta:r}=n;n.inProcessChildren=!0;const i=n.ingestChildren(n.data[n.constructor.childrenField],t);if(i){const{convertEmptyParentToLeaf:a}=n.constructor;if(a===!0||a.onLoad?i.length:Array.isArray(i)){if(r.isLeaf=!1,n.children===!0)n.children=[];else if(i.length===0){n.children=i;return}n.insertChild(i)}else i===!0?(r.isLeaf=!1,n.children=!0):n.isRoot||(r.isLeaf=n.constructor.convertEmptyParentToLeaf.onLoad)}n.inProcessChildren=!1}ancestorsExpanded(t=this.firstStore){const{parent:n}=this;return!n||n.isExpanded(t)&&n.ancestorsExpanded(t)}isExpanded(t=this.firstStore){const n=this.instanceMeta(t.id);return Object.prototype.hasOwnProperty.call(n,"collapsed")||(n.collapsed=!this.expanded),!n.collapsed}get expanded(){return this.data.expanded}get childLevel(){let t=this,n=-1;for(;t&&!t.isRoot;)++n,t=t.parent;return n}get isLeaf(){return this.meta.isLeaf!==!1&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(t=!1,n=this.firstStore){const{children:r}=this;return!r||!Array.isArray(r)||t&&!this.isExpanded(n)?0:r.reduce((i,a)=>i+a.getDescendantCount(t),r.length)}get allChildren(){return this.getAllChildren(!1)}get allUnfilteredChildren(){return this.getAllChildren(!0)}getAllChildren(t=!1){const{[t?"unfilteredChildren":"children"]:n}=this;return!n||n===!0?[]:n.reduce((r,i)=>(r.push(i),r.push.apply(r,t?i.allUnfilteredChildren:i.allChildren),r),[])}get firstChild(){const{children:t}=this;return(t==null?void 0:t.length)&&t[0]||null}get lastChild(){const{children:t}=this;return(t==null?void 0:t.length)&&t[t.length-1]||null}get previousSiblingsTotalCount(){let t=this.previousSibling,n=this.parentIndex;for(;t;)n+=t.descendantCount,t=t.previousSibling;return n}get previousOrderedSibling(){var t;return(t=this.parent)==null?void 0:t.orderedChildren[this.orderedParentIndex-1]}get nextOrderedSibling(){var t;return(t=this.parent)==null?void 0:t.orderedChildren[this.orderedParentIndex+1]}get root(){var t;return((t=this.parent)==null?void 0:t.root)||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(t){const n=this,{parent:r}=n,i=t===null?n.firstStore.rootNode:n.firstStore.getById(t);i===r||!r&&!i||(n.isBatchUpdating?n.meta.batchChanges.parentId=t:i?i.appendChild(n):n.parent.removeChild(n))}static set parentIdField(t){this._parentIdField=t,Object.defineProperty(this.prototype,t,{set:function(n){this.parentId=n},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}getChildren(t){let n;return t.includeFilteredOutRecords?n=this.unfilteredChildren||this.children:t.useOrderedTree?n=this.orderedChildren:n=this.children,n}traverse(t,n,r){r=So(r);const i=this,a=i.getChildren(r);n||t.call(i,i);for(let o=0,l=a==null?void 0:a.length;o<l;o++)a[o].traverse(t,!1,r)}traverseBefore(t,n,r){r=So(r);const i=this,a=i.getChildren(r);for(let o=0,l=a==null?void 0:a.length;o<l;o++)a[o].traverse(t,!1,r);n||t.call(i,i)}traverseWhile(t,n,r){r=So(r);const i=this;let a=n||t.call(i,i)!==!1;if(a){const o=i.getChildren(r);o!=null&&o.length&&(a=o.every(l=>l.traverseWhile(t,!1,r)))}return a}bubble(t,n=!1){let r=this;for(n||t.call(r,r);r.parent;)r=r.parent,t.call(r,r)}bubbleWhile(t,n=!1){let r=this,i=!0;for(n||(i=t.call(r,r));i&&r.parent;)r=r.parent,i=t.call(r,r);return i}contains(t,n=!1){return t&&typeof t=="object"&&(t=t.id),!this.traverseWhile(r=>r.id!=t,n)}getTopParent(t){let n;return t?(n=[],this.bubbleWhile(r=>(n.push(r),r.parent&&!r.parent.isRoot))):(n=null,this.bubbleWhile(r=>(n=r,r.parent&&!r.parent.isRoot))),n}appendChild(t,n=!1){return this.insertChild(t,null,n)}insertChild(t,n=null,r=!1,i={}){var a,o,l,c,u,d,h;const f=this,g=Array.isArray(t);if(t=W.asArray(t),typeof n=="number"&&(n=(o=(a=f.children)==null?void 0:a[n])!=null?o:null),!r&&!f.stores.every(D=>D.trigger("beforeAdd",{records:t,parent:f})!==!1))return null;t=f.ingestChildren(t);const p=(u=(c=n==null?void 0:n.parentIndex)!=null?c:(l=f.children)==null?void 0:l.length)!=null?u:0,m=(d=f.beforeInsertChild)==null?void 0:d.call(f,t),y=f.internalAppendInsert(t,n,r,i);return y.length&&f.convertToParent(r),(h=f.afterInsertChild)==null||h.call(f,p,t,m,y),g||!y?y:y[0]}convertToParent(t=!1){const n=this,r=n.isLeaf;n.meta.isLeaf=!1,n.children||(n.children=[]),r&&!n.root.isLoading&&!t&&n.signalNodeChanged({isLeaf:{value:!1,oldValue:!0}})}signalNodeChanged(t,n=this.stores){n.forEach(r=>{r.trigger("update",{record:this,records:[this],changes:t}),r.trigger("change",{action:"update",record:this,records:[this],changes:t})})}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(t,n,r,i){const a=this,{stores:o,root:l,children:c}=a,{firstStore:u}=l,{parentIdField:d}=a.constructor,h=a.id;let f,g,p,m,y,D;if(!l.isLoading&&u)for(D={},y=[],p=0;p<t.length;p++){const E=t[p];D[E.id]=E.root===l,y[p]=E.parentIndex}if(n&&n.parent!==a&&(n=null),c){const E=n?n.parentIndex:c.length;if(c[g=E]===t[0]||c[g=E-1]===t[0])for(f=!0,p=0;f&&p<t.length;p++)t[p]!==c[g+p]&&(f=!1)}if(f)return t;for(p=0;p<t.length;p++){const E=t[p],C=E.parent;if(u&&!l.isLoading&&E.traverse(v=>{v.root===l&&(D[v.id]=!0)}),(C==null?void 0:C.removeChild(E,D==null?void 0:D[E.id],r,{isInserting:!0,...i}))===!1)m||(t=t.slice(),m=!0),t.splice(p--,1);else{E.parent=a,E.data[d]=h;const{meta:v}=E;v.modified[d]===h&&!C&&(v.oldParentId=h),C&&(v.oldParentId=C.id)}}if(t.length){Array.isArray(c)||(a.children=[]),Array.isArray(a.orderedChildren)||(a.orderedChildren=[]);const E=a.addToChildren(n,t,i);o.forEach(C=>{C.isChained||(t.forEach(v=>{v.joinStore(C)}),C.onNodeAddChild(a,t,E,D,r),t.forEach((v,S)=>{if(v.meta.oldParentId!=null&&!(a.inProcessChildren||a.isLoading)){const b={[d]:h,[a.getDataSource("parentIndex")]:v.parentIndex},P={},{modified:M,oldParentId:w}=v.meta,A=y[S];if(delete v.meta.oldParentId,a.id!==w&&(P[d]={value:h,oldValue:w}),v.parentIndex!==A&&(P.parentIndex={value:v.parentIndex,oldValue:A}),M[d]===a.id?Reflect.deleteProperty(M,d):d in M||(M[d]=w),D[v.id]){const T=C.getById(w);T.isLeaf&&!r&&T.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}},[C])}v.afterChange(b,P)}v.traverse(b=>{!b.ignoreBag&&!b.isLinked&&C.updateModifiedBagForRecord(b)})}))})}return t}removeChild(t,n=!1,r=!1,i={}){var a,o;const l=this,c=[],u=l.isLeaf,{children:d,stores:h}=l;if(t=W.asArray(t),t=t.filter(g=>g.parent===l),!r){for(const g of h)if(!g.isChained&&g.trigger("beforeRemove",{parent:l,records:t,isMove:n})===!1)return!1}const f=(a=l.beforeRemoveChild)==null?void 0:a.call(l,t,n);for(const g of t){const{parentIdField:p}=g.constructor,{modified:m}=g.meta,y=g.parent?g.parent.id:null;!(p in m)&&!g.isLinked&&(m[p]=y);const D=l.removeFromChildren(g,i);h.forEach(E=>{if(!E.isChained){const{isRemoving:C}=E;E.isRemoving=!0,c.push(...E.onNodeRemoveChild(l,[g],D,{isMove:n,silent:r})),E.isRemoving=C}}),n||(g.parent=g.parentIndex=g.unfilteredIndex=g.nextSibling=g.previousSibling=null,g.data[p]=null)}return(l.unfilteredChildren||d).length===0&&l.constructor.convertEmptyParentToLeaf.onRemove&&!l.isRoot&&(l.meta.isLeaf=!0),l.isLeaf!==u&&!r&&!n&&l.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}}),(o=l.afterRemoveChild)==null||o.call(l,t,f,n),c}clearParentId(){const t=this;Reflect.deleteProperty(t.data,t.parentIdField),Reflect.deleteProperty(t.originalData,t.parentIdField),t.meta.modified&&Reflect.deleteProperty(t.meta.modified,t.parentIdField)}replaceChildren(t){return this.clearChildren(),this.data[this.constructor.childrenField]=t,this.processChildren(),this.children}clearChildren(t=!1){const n=this,{stores:r}=n,i=n.unfilteredChildren||n.children;n.children=[],n.orderedChildren=[],i&&i!==!0&&(r.forEach(a=>{a.isChained||a.onNodeRemoveChild(n,i,0,{unfiltered:!0,silent:t})}),n.unfilteredChildren&&(n.unfilteredChildren=[]))}clear(){var t;const n=this,{stores:r}=n,i=(t=n.children)==null?void 0:t.slice();if(!(!n.isRoot||!i)){for(const a of r)if(!a.isChained&&a.trigger("beforeRemove",{parent:n,records:i,isMove:!1,removingAll:!0})===!1)return!1;n.children.length=0,n.unfilteredChildren&&(n.unfilteredChildren.length=0),r.forEach(a=>{i.forEach(o=>{o.stores.includes(a)&&o.unjoinStore(a),o.parent=o.parentIndex=o.nextSibling=o.previousSibling=null}),a.storage.suspendEvents(),a.storage.clear(),a.storage.resumeEvents(),a.added.clear(),a.modified.clear(),a.trigger("removeAll"),a.trigger("change",{action:"removeall"})})}}updateChildrenIndices(t,n,r=!1){let i=null;for(let a=0;a<t.length;a++){const o=t[a],l=o[n];n==="parentIndex"||n==="orderedParentIndex"?l===void 0||r?o.setData(n,a):l!==a&&o.set(n,a,!0):o[n]=a,n==="parentIndex"&&(o.previousSibling=i,i&&(i.nextSibling=o),a===t.length-1&&(o.nextSibling=null),i=o)}}addToChildren(t,n,r={}){var i,a;const o=this,l=[[o.children,"parentIndex",t],[o.unfilteredChildren,"unfilteredIndex",t],[o.orderedChildren,"orderedParentIndex",(i=r==null?void 0:r.orderedBeforeNode)!=null?i:(r==null?void 0:r.orderedParentIndex)!==void 0?o.orderedChildren[r==null?void 0:r.orderedParentIndex]:t]];for(const c of l){const[u,d,h]=c;if(u){const f=h?d==="orderedParentIndex"?u.indexOf(h):h[d]:u.length;c.push(f),u.splice(f,0,...n),(a=r==null?void 0:r[d])!=null&&a.skip||o.updateChildrenIndices(u,d)}}return l[0][3]}removeFromChildren(t,n){var r;const i=[[this.children,"parentIndex"],[this.unfilteredChildren,"unfilteredIndex"],[this.orderedChildren,"orderedParentIndex"]];for(const a of i){const[o,l]=a;if(o){const c=o.indexOf(t);a.push(c),c>-1&&(o.splice(c,1),(r=n==null?void 0:n[l])!=null&&r.skip||this.updateChildrenIndices(o,l))}}return i[0][2]}sortOrderedChildren(t=!0,n=!1){const r=[];return this.isLeaf||(this.orderedChildren.sort((i,a)=>{var o,l;if(n){const c=(o=i.meta.modified.orderedParentIndex)!=null?o:i.orderedParentIndex,u=(l=a.meta.modified.orderedParentIndex)!=null?l:a.orderedParentIndex,d=c-u;return d!==0&&(r.push(i),r.push(a)),d}else return i.orderedParentIndex-a.orderedParentIndex}),t&&this.orderedChildren.forEach(i=>{r.push(...i.sortOrderedChildren(t,n))}),this.updateChildrenIndices(this.orderedChildren,"orderedParentIndex",!0)),new Set(r)}unjoinStore(t,n=!1){var r;const i=this;i.unfilteredChildren&&(i.children=i.unfilteredChildren.slice(),i.unfilteredChildren=null),(r=super.unjoinStore)==null||r.call(this,t,n)}},Sd={id:1,stores:1,parentIndex:1,parent:1,previousSibling:1,nextSibling:1,unfilteredIndex:1},Cm={get(e,s){return s==="proxyMeta"?this.proxyMeta:s==="constructor"?e.constructor:s==="setData"?this.setDataOverride:s==="set"?this.setOverride:Sd[s]?this.proxyMeta.data[s]:Reflect.get(e,s,this.proxyRecord)},set(e,s,t){return Sd[s]?this.proxyMeta.data[s]=t:e[s]=t,!0},setDataOverride(e,s){e==="parentIndex"?this.proxyMeta.data.parentIndex=s:this.proxyMeta.originalRecord.setData(e,s)},setOverride(e,s,...t){e==="parentIndex"?this.proxyMeta.data.parentIndex=s:this.proxyMeta.originalRecord.set(e,s,...t)}},Dd=e=>{var s;return s=class extends(e||$){link(){if(this.isLinked)return this.$original.link();const t=this,n={...Cm,proxyMeta:{originalRecord:t,data:{id:`${t.id}_link_${U.generateUUID()}`,stores:[]}}},r=new Proxy(t,n);return n.proxyRecord=r,(t.meta.linkedRecords||(t.meta.linkedRecords=[])).push(r),r}get isLinked(){var t;return!!((t=this.proxyMeta)!=null&&t.originalRecord)}get hasLinks(){return!!(!this.proxyMeta&&this.$links.length)}removeLink(t,n=null,r=!1){if(t.hasLinks)for(const i of t.$links.slice())n?W.include(n,i):i.remove(r);else t.isLinked&&W.remove(t.$original.$links,t)}beforeRemove(t){this.removeLink(this,t)}removeChild(t,n,r,i){if(!(i!=null&&i.isInserting)){t=W.asArray(t);for(const a of t)this.removeLink(a,null,r)}return super.removeChild(t,n,r,i)}get $originalId(){return this.$original.id}get $links(){var t;return(t=this.meta.linkedRecords)!=null?t:[]}},F(s,"$name","ModelLink"),s},{defineProperty:Cd}=Reflect,Do=Symbol("owner"),Em=/[\s,]+/,bm=e=>class extends(e||$){static get $name(){return"Factoryable"}static get declarable(){return["factoryable","alias","type"]}static register(t,n,r=globalThis.__BRYNTUM_EXAMPLE){const{factoryable:i}=this.initClass(),{caseless:a,registry:o}=i,l=U.split(t,Em);for(let c,u,d=0;d<l.length;++d){if(u=l[d],c=a?u.toLowerCase():u,!r&&c in o)throw new Error(`Type "${u}" already registered with ${i.class.name} factory`);o[u]=o[c]=n.initClass()}}static isA(t,n){return this.isType(t,n,!0)}static isType(t,n,r){const{factoryable:i}=this,{caseless:a,registry:o}=i,l=o[a?n.toLowerCase():n];return l?r?t instanceof l:t.constructor===l:!1}static setupAlias(t){t.register(t.alias,t)}static setupFactoryable(t,n){const r=n.super.class;let{factoryable:i}=t;i={caseless:!0,defaultType:null,extends:r.factoryable?[r]:null,typeKey:"type",...i},i.class=t,i.registry=Object.create(null),i.extends&&!Array.isArray(i.extends)&&(i.extends=[i.extends]),Cd(t,"factoryable",{get(){return i}})}static setupType(t,n){const{type:r}=t;t.register(r,t,n.replaceType),Cd(t.prototype,"type",{value:r})}static create(t,n){return this.reconfigure(null,t,n)}static reconfigure(t,n,r){const i=this,{factoryable:a}=i,{typeKey:o}=a;let l=r,c,u,d,h,f,g,p,m,y;if(r&&!x.isClass(r)&&(l=null,p=typeof r,p==="function"?g=r:p==="string"?l=r:x.isObject(r)?(c=r.cleanup,u=r.defaults,h=r.owner,g=r.setup,l=r.type,m=r.transform):h=r),m&&(n=typeof m=="string"?h[m](n):m(n)),y=n,typeof y=="string")n={};else if(n){if(n===!0&&(n={}),!x.isObject(n))return h&&n!==t&&(t==null?void 0:t[Do])===h&&(typeof c=="string"?h[c](t):c==null||c(t),t.destroy()),n;y=n[o]}if(y=y&&i.resolveType(y),t){if(n&&(!y||t.constructor===y))return o in n&&(n=x.assign({},n),delete n[o]),t.setConfig(n),t;h&&t[Do]===h&&(typeof c=="string"?h[c](t):c==null||c(t),t.destroy())}if(n){if(u){if(!(d=y)){if(!(d=u[o]||l||a.defaultType))throw new Error(`No default mergeType defined for ${a.class.name} factory`);d=i.resolveType(d)}d&&(n=d.mergeConfigs(u,n))}if(g){if(f=typeof g=="string"?h[g](n,y,u):g(n,y,u),f===null)return f;n=f||n}if(!y){if(!(y=n[o]||l||a.defaultType))throw new Error(`No default type defined for ${a.class.name} factory`);y=i.resolveType(y)}u&&!d&&(n=y.mergeConfigs(u,n)),o in n&&(n=x.assign({},n),delete n[o]),n=new y(n),h&&(n[Do]=h)}return n||null}static resolveType(t,n){if(typeof t!="string")return t;const{factoryable:r}=this,i=r.extends;let a=r.registry[r.caseless?t.toLowerCase():t],o;for(o=0;!a&&i&&o<i.length;++o)a=i[o].resolveType(t,!0);if(!a&&!n)throw new Error(`Invalid type name "${t}" passed to ${r.class.name} factory`);return a}},{getOwnPropertyDescriptor:Rm}=Reflect,it=class extends $.mixin(bm){static get $name(){return"DataField"}static get type(){return"auto"}static get factoryable(){return{defaultType:"auto"}}static get prototypeProperties(){return{compare:null,compareItems:null,dataSource:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:void 0,persist:!0,readOnly:!1,internal:!1,useProp:null}}construct(e){const s=this;e&&(s.name=e.name,Object.assign(s,e)),s.compare&&(s.compareItems=(t,n)=>s.compare(t==null?void 0:t[s.name],n==null?void 0:n[s.name]))}defineAccessor(e,s){const{name:t,dataSource:n}=this;!s&&t in e&&e.$meta.hierarchy.some(r=>{var i;return((i=Rm(r.prototype,t))==null?void 0:i.enumerable)===!1})||Reflect.defineProperty(e,t,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(t,n)}:function(){return this.batching&&t in this.meta.batchChanges?this.meta.batchChanges[t]:n in this.data?this.data[n]:this.data[t]},set(r){const i=this.$meta.fields.map[t];i&&i.readOnly||this.set(t,r)}})}isEqual(e,s){return x.isEqual(e,s)}print(e){return e==null?this.nullText:this.printValue(e)}printValue(e){return String(e)}};it._$name="DataField";var ri=class extends it{isEqual(e,s){return e===s}getAt(e,s){return e.get(this.name)[s]}};F(ri,"$name","ArrayDataField"),F(ri,"type","array"),ri.initClass(),ri._$name="ArrayDataField";var Ed=class extends it{static get $name(){return"BooleanDataField"}static get type(){return"boolean"}static get alias(){return"bool"}static get prototypeProperties(){return{nullValue:!1}}isEqual(e,s){return e==null&&s==null?!0:super.isEqual(e,s)}convert(e){var s;return e==null?this.nullable?e:this.nullValue:((s=e.toLowerCase)==null?void 0:s.call(e))==="false"?!1:!!e}};Ed.initClass(),Ed._$name="BooleanDataField";var bd=class extends it{static get $name(){return"DateDataField"}static get type(){return"date"}static get prototypeProperties(){return{format:null}}convert(e){return e==null?this.nullable||(e=this.nullValue):e==="now"?e=new Date:e instanceof Date||(e=R.parse(e,this.format||R.defaultParseFormat),(!e||isNaN(e))&&(e=void 0)),e}serialize(e){return e instanceof Date&&(e=R.format(e,this.format||R.defaultFormat)),e}printValue(e){return R.format(e,this.format||R.defaultFormat)}};bd.initClass(),bd._$name="DateDataField";var Co=class extends it{static get $name(){return"StringDataField"}static get type(){return"string"}static get prototypeProperties(){return{nullValue:""}}convert(e){return e==null?this.nullable?e:this.nullValue:String(e)}};Co.initClass(),Co._$name="StringDataField";var Rd=class extends Co{static get $name(){return"DurationUnitDataField"}static get type(){return"durationunit"}isEqual(e,s){return R.compareUnits(e,s)===0}};Rd.initClass(),Rd._$name="DurationUnitDataField";var wd=class extends it{static get $name(){return"IntegerDataField"}static get type(){return"integer"}static get alias(){return"int"}static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(e){return e==null?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}};wd.initClass(),wd._$name="IntegerDataField";var Id=class extends it{static get $name(){return"ModelDataField"}static get type(){return"model"}static get prototypeProperties(){return{complexMapping:!0}}isEqual(e,s){return e&&s&&s instanceof e.constructor&&s.id==e.id}};Id.initClass(),Id._$name="ModelDataField";var Pd=class extends it{static get $name(){return"NumberDataField"}static get type(){return"number"}static get alias(){return"float"}static get prototypeProperties(){return{nullValue:0,precision:null}}isEqual(e,s){return isNaN(Number(e))&&isNaN(Number(s))||super.isEqual(e,s)}convert(e){if(e==null)return this.nullable?e:this.nullValue;if(e=Number(e),isNaN(e))return;let s=this.precision;return s?(s=10**s,e=Math.round(e*s)/s):s===0&&(e=Math.round(e)),e}};Pd.initClass(),Pd._$name="NumberDataField";var Md=class extends it{static get $name(){return"ObjectDataField"}static get type(){return"object"}static get prototypeProperties(){return{complexMapping:!0}}};Md.initClass(),Md._$name="ObjectDataField";var si=class extends it{init(e,s){var t;const n=this,r=`${n.name}Store`,i={skipStack:!0,syncDataOnLoad:!0};if(n.store&&x.assign(i,n.store),n.modelClass&&(i.modelClass=n.modelClass),(t=s[`init${U.capitalize(r)}`])==null||t.call(s,i),!i.storeClass&&!n.storeClass)throw new Error(`Field '${n.name}' with type 'store' must have a storeClass configured`);const a=s.meta[r]=new(i.storeClass||n.storeClass)(i);n.complexMapping?x.setPath(e,n.dataSource,a):e[n.dataSource]=a,a.verifyNoGeneratedIds=!1,a.usesId=!a.count||!a.every(o=>o.hasGeneratedId),a.$currentValue=n.getValue(a),a.ion({change:({action:o})=>{const l=n.getValue(a);if(!a.$isSettingStoreFieldData){const c=a.$preserveCurrentDataset;a.$preserveCurrentDataset=n.subStore&&(o==="update"||o==="remove"||o==="add"),n.$isUpdatingRecord=!0,s.set(n.name,l),n.$isUpdatingRecord=!1,a.$preserveCurrentDataset=c}a.$currentValue=l}})}set(e,s,t){var n,r;const i=this,a=`${i.name}Store`,{[a]:o}=t.meta;if(!o)return t.meta.initableValues.set(i,e),!1;o.$isSettingStoreFieldData||(o.$isSettingStoreFieldData=!0,e=(r=(n=t[`process${U.capitalize(a)}Data`])==null?void 0:n.call(t,e,t))!=null?r:e,o.$preserveCurrentDataset||(o.data=e),o.$isSettingStoreFieldData=!1,o.usesId=!o.count||!o.every(l=>l.hasGeneratedId))}serialize(e,s){const t=s.meta[`${this.name}Store`];return this.$isUpdatingRecord?this.getValue(t):t.$currentValue}getValue(e){return e.allRecords.map(s=>{const t=s.persistableData;return e.usesId||delete t.id,t})}isEqual(e,s){return e!=null&&e.isStore&&(e=e.$currentValue),s!=null&&s.isStore&&(s=s.$currentValue),x.isDeeplyEqual(e,s)}getOldValue(e){const s=e.meta[`${this.name}Store`];return s?x.clone(s.$currentValue):null}getAt(e,s){const t=e.meta[`${this.name}Store`];return t==null?void 0:t.getAt(s)}};F(si,"$name","StoreDataField"),F(si,"type","store"),si.initClass(),si._$name="StoreDataField";var xd=new RegExp(/^(.*?)\.(.*)/),Td=/(.*)\[(.*)]\.?(.*)/,{defineProperty:wm}=Reflect,{hasOwn:Us}=x,qt=void 0,Im={children:1,data:1,meta:1},Pm=["name","title","text","label","description"],Mm={boolean:1,number:1,date:1,object:1},Od={parentId:1,$PhantomId:2,id:3},Eo=class extends $.mixin(vd,yd,Dd){static get $name(){return"Model"}static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0},{name:"orderedParentIndex",type:"number",persist:!1,internal:!0},{name:"readOnly",type:"boolean"},{name:"expanded",internal:!0}]}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){if(!this._childrenField){const e=this.fieldMap.children;this._childrenField=(e==null?void 0:e.dataSource)||"children"}return this._childrenField}get indexPath(){const e=[];let s=this,t=s.childLevel;for(s=this;s&&!s.isRoot;s=s.parent)e[t--]=s.parentIndex+1;return e}construct(e={},s=null,t=null,n=!1,r=!1,i=!1){var a,o;const l=this,c=(a=W.asArray(s))!=null?a:[],{constructor:u,fieldMap:d}=l;let h=null;if(s=c[0],l.meta={modified:{},...u.metaConfig,...t},u.applyConfigs)for(const f in l.getDefaultConfiguration())h||(h={},(!l.useRawData||!l.useRawData.enabled)&&(e={...e})),f in e&&(e[f]!==void 0&&(h[f]=e[f]),delete e[f]);if(super.construct(h),n||u.exposeProperties(e,i),!Us(u,"idFieldProcessed")){let f=l.meta.idField;f||(u._assignedIdField?f=u.idField:s&&(f=s.idField)),f&&f!==d.id.dataSource&&u.addField({name:"id",dataSource:f,internal:!0}),u._idField=d.id.dataSource,u.idFieldProcessed=!0}l._internalId=Eo._internalIdCounter++,l.stores=[],l.unjoinedStores=[],l.originalData||(l.originalData=e),l.data=u.processData(e,!1,s,l,r),(o=l.meta.initableValues)!=null&&o.size&&l.assignInitables(),l.id==null&&l.setData("id",l.generateId(s)),l.data[u.childrenField]&&l.processChildren(c),l.generation=0}set isCreating(e){const s=this;!!s.meta.isCreating!==e&&(s.meta.isCreating=e,s.stores.forEach(t=>{t.onIsCreatingToggle(s,e)}))}get isCreating(){return!!this.meta.isCreating}equals(e){if(e instanceof this.constructor){for(let s=this.$meta.fields.defs,t=0,{length:n}=s;t<n;t++){const r=s[t],{name:i}=r;if(i!=="id"&&!r.isEqual(this.getValue(i),e.getValue(i)))return!1}return!0}return!1}get subclass(){return new this.constructor(Object.setPrototypeOf({id:qt},this.data),this.stores[0],null,!0)}static processData(e,s=!1,t,n,r){const{fieldMap:i,defaultValues:a}=this,{useRawData:o={enabled:!1}}=t||{},l=r||o.enabled?e:x.clone(e);let c;if(s=s||o.disableDefaultValue||r,!s){for(c in a)if(l[c]===qt){let u=a[c];Array.isArray(u)&&(u=u.slice()),l[c]=u}}if(!o.disableTypeConversion&&!r)for(c in i){const u=i[c],{name:d,dataSource:h}=u,f=h!==d,g=u.complexMapping,p=f&&(g?x.pathExists(e,h):h in e),m=d in e&&(!f||!p),y=!o.disableTypeConversion&&u.convert;if((m||y)&&(!s||m||p)){const D=m?l[d]:g?x.getPath(l,h):l[h],E=y?u.convert(D,e,n):D;g?x.setPath(l,h,E):l[h]=E,f&&delete l[d]}}return this.$meta.fields.initable.length&&this.initInitables(n,l),l}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,s){var t,n,r,i,a;const o=Us(e,"fields")&&e.fields,l=s.super.fields,c=s.fields={defs:(t=l==null?void 0:l.defs.slice())!=null?t:[],exposedData:!1,defaults:l?{...l.defaults}:{},exposed:Object.create((n=l==null?void 0:l.exposed)!=null?n:null),ordinals:Object.create((r=l==null?void 0:l.ordinals)!=null?r:null),map:Object.create((i=l==null?void 0:l.map)!=null?i:null),sources:Object.create((a=l==null?void 0:l.sources)!=null?a:null)};Us(e,"defaults")&&Object.assign(c.defaults,e.defaults),Us(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),c.exposed[e.idField]=!0),o!=null&&o.length&&o.map(e.addField,e),c.initable=c.defs.filter(u=>u.init),e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get allFields(){return this.$meta.fields.defs}get allFields(){return this.$meta.fields.defs}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e,s=!0){const t=this,n=t.$meta.fields,r=s?"exposed":"map";if(e&&t.autoExposeFields&&!n.exposedData){let i,a,o;for(i in e)!n[r][i]&&i!==t.childrenField&&(o=x.typeOf(e[i]),a={name:i,dataSource:i,fromData:!0},Mm[o]&&(a.type=o),t.addField(a));n.exposedData=!0}t.exposeRelations()}static addField(e){if(e==null)return;typeof e=="string"&&(e={name:e});const s=this.initClass(),t=s.$meta.fields,{ordinals:n}=t,r=t.exposed,{name:i}=e,a=t.map[i],o=e.dataSource||(e.dataSource=i);let l,c;if(!a||e.type&&e.type!==a.type)l=it.create(e),l.definedBy=a?a.definedBy:s,l.ordinal=a?a.ordinal:n[i]=t.defs.length;else{l=Object.create(a);for(c in e)c!=="type"&&(l[c]=e[c])}return l.owner=s,t.defs[l.ordinal]=l,t.map[i]=l,t.sources[o]||(t.sources[o]=l),o.includes(".")&&(l.complexMapping=!0),l.complexMapping?r[o.split(".")[0]]=!0:r[o]=!0,"defaultValue"in l&&(t.defaults[o]=l.defaultValue),Im[i]||l.defineAccessor(s.prototype),s._nonPersistableFields=null,s._alwaysWriteFields=null,l}static removeField(e){const s=this.initClass(),t=s.$meta.fields,n=t.map[e],{ordinals:r}=t,i=r[e];if(n){t.defs.splice(i,1),delete r[e],delete t.defaults[e],delete t.exposed[e],delete t.map[e],delete t.sources[n.dataSource];for(const a in r)r[a]>i&&--r[a];delete s.prototype[e]}}static exposeRelations(){const e=this;if(!Us(e,"exposedRelations")&&e.relations){e.exposedRelations=[];for(const s in e.relations){const t=e.relations[s];t.relationName=s,e.exposedRelations.push(t),Reflect.ownKeys(e.prototype).includes(s)||wm(e.prototype,s,{enumerable:!0,get:function(){return this.getForeign(s)},set:function(n){this.setForeign(s,n,t)}})}}}static initInitables(e,s){const t=e.meta.initableValues=new Map;for(const n of this.$meta.fields.initable){const r=x.getPath(s,n.dataSource);r!==void 0&&t.set(n,r),!n.lazy&&n.init(s,e)}}assignInitables(){const{initableValues:e}=this.meta;for(const[s,t]of e)s.set(t,this.data,this)!==!1&&e.delete(s)}static get autoExposeFields(){return!0}static fieldSorter(e,s){return(Od[e]||100)-(Od[s]||100)}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.$meta.fields.map[e]}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.$meta.fields.map[e]}static getFieldDataSource(e){var s;return((s=this.getFieldDefinition(e))==null?void 0:s.dataSource)||e}getDataSource(e){const s=this.constructor.getFieldDefinition(e);return(s==null?void 0:s.dataSource)||(s==null?void 0:s.name)}static processField(e,s,t){const n=this.fieldMap[e];return n!=null&&n.convert?n.convert(s,this.data,t):s}initRelations(){const e=this;e.constructor.exposedRelations&&e.stores.forEach(t=>{var n;t.modelRelations||t.initRelations();const r=[];(n=t.modelRelations)==null||n.forEach(i=>{r.push({related:e.initRelation(i),config:i})}),t.updateRecordRelationCache(e,r)})}initRelation(e){const s=this,t=s.get(e.foreignKey),n=t!==qt&&typeof e.foreignStore!="string"&&e.foreignStore.getById(t),r=s.meta.relationCache||(s.meta.relationCache={});return r[e.relationName]=n||(t!=null?{id:t,placeHolder:!0}:null),n}removeRelation(e){const{relationName:s,foreignKey:t,nullFieldOnRemove:n}=e;this.meta.relationCache[s]&&(delete this.meta.relationCache[s],n&&this.setData(t,null))}getForeign(e){var s;return(s=this.meta.relationCache)==null?void 0:s[e]}setForeign(e,s,t){const n=Eo.asId(s);return this.set(t.foreignKey,n)}getRelationConfig(e){var s,t;return(t=(s=this.firstStore)==null?void 0:s.modelRelations)==null?void 0:t.find(n=>n.foreignKey===e)}flatGet(e,s){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:s in this.data?this.data[s]:this.data[e]}complexGet(e,s){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:x.getPath(this.data,s)}get(e){if(!e)return;const s=this,t=s.fieldMap[e];if(!t){if(e.includes("[")){const[,n,r,i]=e.match(Td),a=s.fieldMap[n];if(a!=null&&a.getAt){s._thisIsAUsedExpression(s[n]);const o=a.getAt(s,r);return o&&i?o.isModel?o.getValue(i):o[i]:o}return null}if(e.includes("."))return x.hasPath(s.data,e)?s.complexGet(e,e):x.getPath(s,e)}return t!=null&&t.complexMapping?s.complexGet(e,t.dataSource):s.flatGet(e,(t==null?void 0:t.dataSource)||e)}getValue(e){if(e)return e in this?this[e]:this.get(e)}setValue(e,s){e in this?this[e]=s:this.set(e,s)}setData(e,s){var t,n;const{data:r,fieldMap:i}=this;if(typeof e=="string"){const a=i[e],o=(t=a==null?void 0:a.dataSource)!=null?t:e;a!=null&&a.set?a.set(s,this.data,this):a!=null&&a.complexMapping?x.setPath(r,o,s):r[o]=s}else{const a=Object.keys(e);for(let o=0;o<a.length;o++){const l=a[o],c=i[l],u=(n=c==null?void 0:c.dataSource)!=null?n:l;c!=null&&c.set?c.set(s,this.data,this):u&&(c!=null&&c.complexMapping?x.setPath(r,u,e[l]):r[u]=e[l])}}}getData(e){var s;const t=this.fieldMap[e],n=(s=t==null?void 0:t.dataSource)!=null?s:e;if(n)return t!=null&&t.complexMapping?x.getPath(this.data,n):this.data[n]}syncId(e){const s=this.id;if(s!==e){this.setData("id",e);const t={id:{value:e,oldValue:s}};this.afterChange(t,t)}}set(e,s,t=!1,n=!1,r=!1,i=!1,a=!0){var o;const l=this;if(l.isBatchUpdating)return l.inBatchSet(e,s,t||l.$silenceBatch),null;{const c=l.inSet(e,s,t,n,r,i,a);return(o=l.afterSet)==null||o.call(l,e,s,t,n,c),c}}fieldToKeys(e,s){return typeof e!="string"?x.assign({},e):{[e]:s}}inBatchSet(e,s,t){const n=this,{meta:r,constructor:i,fieldMap:a}=n,o={};let l,c=!1;if(typeof e!="string"?Object.keys(n.fieldToKeys(e,s)).forEach(u=>{l=a[u]||x,s=i.processField(u,e[u],n),l.isEqual(r.batchChanges[u],s)||(o[u]={value:s,oldValue:n.get(u)},r.batchChanges[u]=s,c=!0)}):(l=a[e]||x,l.isEqual(r.batchChanges[e],s)||(o[e]={value:s,oldValue:n.get(e)},r.batchChanges[e]=s,c=!0)),c&&(n.generation++,!t)){const u={action:"update",record:n,records:[n],changes:o};n.stores.forEach(d=>{d.trigger("batchedUpdate",{...u})}),n.forEachLinked((d,h)=>d.trigger("batchedUpdate",{...u,record:h,records:[h]}))}}inSet(e,s,t,n,r=!1,i=!1,a=!0){var o,l,c;const u=this,{data:d,meta:h,fieldMap:f,constructor:g}=u,{prototype:p,childrenField:m,relations:y}=g,D={},E=u.fieldToKeys(e,s),C=Object.keys(E).sort(g.fieldSorter);let v=!1;if(!t&&!u.triggerBeforeUpdate(E))return null;u.inSetting=!0;for(let S=0;S<C.length;S++){const b=C[S];if(b===m)continue;if(b.includes("[")){const[,Le,Te,Ne]=b.match(Td),Dt=u.fieldMap[Le];if(Dt!=null&&Dt.getAt){const Dr=Dt.getAt(u,Te);Dr.isModel?Dr.set(Ne,E[b]):x.setPath(Dr,Ne,E[b]);continue}}const P=b.includes(".");if(y&&P){const[,Le,Te]=b.match(xd);if(y[Le]){u[Le].set(Te,E[b]);continue}}const M=f[b],w=M||x,A=M==null?void 0:M.readOnly,T=(o=M==null?void 0:M.dataSource)!=null?o:b,k=!r&&!M&&b in p||(M==null?void 0:M.useProp),Z=k?u[T]:M!=null&&M.complexMapping||P?x.getPath(d,T):d[T],z=g.processField(b,E[b],u),re=E[b]={value:z},be=u.getRelationConfig(b);!A&&!w.isEqual(Z,z)&&(!i||z!==void 0)&&(u.generation++,re.oldValue=(c=(l=M==null?void 0:M.getOldValue)==null?void 0:l.call(M,u))!=null?c:Z,v=!0,b in h.modified&&w.isEqual(h.modified[b],z)?(Reflect.deleteProperty(h.modified,b),u.isReverting&&(u.data[T]=z)):u.ignoreBag||(b in h.modified||u.storeFieldChange(b,Z),re.oldValue===qt&&Reflect.deleteProperty(re,"oldValue")),D[b]=re,u.applyValue(k,T,z,r,M),be&&!n&&(u.initRelation(be),u.stores.forEach(Le=>Le.cacheRelatedRecord(u,z,be.relationName,re.oldValue))))}return v&&u.afterChange(E,D,t,n,r),u.inSetting=!1,v?D:null}applyValue(e,s,t,n,r){var i;const a=this;if(((r==null?void 0:r.name)||s)===a.constructor.parentIdField)(i=a.parent)!=null&&i.isRoot&&(t==null||!a.firstStore.getById(t))||(a.firstStore.getById(t)||a.firstStore.rootNode).insertChild(a,null,!1,{orderedParentIndex:{skip:!0}});else if(e)a[(r==null?void 0:r.name)||s]=t;else if(r!=null&&r.set)r.set(t,a.data,a);else{let o=r==null?void 0:r.complexMapping;if(!r&&s.includes(".")){const l=s.split(".")[0];r=a.constructor.fieldMap[l],o=(r==null?void 0:r.complexMapping)||(r==null?void 0:r.type)==="object"}o?x.setPath(a.data,s,t):a.data[s]=t}}afterChange(e,s,t,n,r){for(const i of this.stores)i.onModelChange(this,e,s,t,n,r);this.forEachLinked((i,a)=>i.onModelChange(a,e,s,t,n,r))}forEachLinked(e){for(const s of this.$links)for(const t of s.stores)e(t,s)}get isPersistable(){return!this.isBatchUpdating&&!this.isCreating}get isModified(){return!!(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!x.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&e in this.meta.modified}getFieldPersistentValue(e){const s=typeof e=="string"?this.getFieldDefinition(e):e,t=(s==null?void 0:s.name)||e;let n;return(!s||s.persist)&&(n=this.getValue(t),s!=null&&s.serialize&&(n=s.serialize(n,this))),n}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,s={};if(!e.isModified)return null;let t=!1;return Object.keys(e.meta.modified).forEach(n=>{const r=e.getFieldPersistentValue(n);r!==qt&&(s[n]=r,t=!0)}),t?s:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&x.setPath(e,this.constructor.idField,this.id),e}get rawModificationData(){const e=this,{fieldMap:s}=e.constructor,t={};if(!e.isModified)return null;let n=!1;return Object.keys(e.meta.modified).forEach(r=>{let i=s[r],a=i==null?void 0:i.dataSource;if(r.includes(".")){const o=r.match(xd)[1];i=s[o],a=r}if(i!=null&&i.persist){const o=e.getFieldPersistentValue(r);o!==qt&&(x.setPath(t,a,o),n=!0)}}),n?t:null}get modificationDataToWrite(){const e=this.constructor.alwaysWriteFields,s=this.modificationData;return e.forEach(t=>{s[this.getFieldDefinition(t).dataSource]=this.getFieldPersistentValue(t)}),s}get persistableData(){const e=this,s={};return e.fields.forEach(t=>{const n=e.getFieldPersistentValue(t);n!==qt&&(t!=null&&t.complexMapping?x.setPath(s,t.dataSource,n):s[t.dataSource]=n)}),s}get dataByFieldName(){const{data:e}=this;return this.fields.reduce((s,t)=>(x.hasPath(e,t.dataSource)&&(s[t.name]=e[t.dataSource]),s),{})}get isCommitting(){return!!this.meta.committing}clearChanges(e=!0,s=!0,t=null){const n=this,{meta:r}=n;if(t)for(const a in t)delete r.modified[a];else r.modified={};const i=x.isEmpty(r.modified);r.committing=!1,s&&n.stores.forEach(a=>{if(i&&a.modified.remove(n),a.added.remove(n),e){const o=a.collectDescendants(n).all;a.added.remove(o),i&&a.modified.remove(o)}})}storeFieldChange(e,s){this.meta.modified[e]=s}revertChanges(e=!1){this.isReverting=!0,this.set(this.meta.modified,qt,e),this.isReverting=!1}applyChangeset(e,s="$PhantomId",t=!0){var n;const r=this,i=r.constructor,{idField:a,fieldDataSourceMap:o}=i,l=x.pathifyKeys(e,o),c=x.pathifyKeys(r.modificationData),u={},d=s in e;for(const f in l){const g=o[f],p=(n=g==null?void 0:g.name)!=null?n:f;(t||((g==null?void 0:g.name)===a?d:l[f]===c[f]))&&(u[p]=l[f])}const h=r.set(u);return r.clearChanges(!1,!0,t?null:u),h?Object.entries(h).reduce((f,[g,p])=>(f[g]=p.value,f),{}):{}}get internalId(){return this._internalId}get isPhantom(){return this.id===""||this.id==null||this.hasGeneratedId}get isModel(){return!0}get hasGeneratedId(){return typeof this.id=="string"&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return`_generated${e}_${U.generateUUID()}`}generateId(){return this.constructor.generateId()}static asId(e){return e!=null&&e.isModel?e.id:x.isObject(e)?e[this.fieldMap.id.dataSource]:e}get json(){return U.safeJsonStringify(this)}toJSON(){const{children:e,unfilteredChildren:s}=this,t=this.persistableData;return(s||e)&&(t[this.constructor.childrenField]=(s||e).map(n=>n.toJSON())),t}toString(){const e=this,s=Pm.find(n=>n in e.constructor.fieldMap),t=s?{[e.constructor.idField]:e.id,[s]:e[s]}:e.data;return U.safeJsonStringify(t)}get isBatchUpdating(){return!!this.batching}hasBatchedChange(e){var s,t;return(t=(s=this.meta)==null?void 0:s.batchChanges)==null?void 0:t[e]}beginBatch(e=!1){const s=this;s.batching||(s.batching=0,s.meta.batchChanges={}),e&&(s.$silenceBatch=(s.$silenceBatch||0)+1),s.batching++}endBatch(e=!1,s=!1,t=!0){const n=this,{parentIdField:r}=n.constructor;if(n.batching&&(n.batching--,n.$silenceBatch&&n.$silenceBatch--,!(n.batching>0)&&!x.isEmpty(n.meta.batchChanges))){let{batchChanges:i}=n.meta;n.meta.batchChanges=null,i[r]&&(i={...i},n.parentId=i[r],delete i[r]),n.set(i,qt,e,!1,s,void 0,t)}}cancelBatch(){if(this.batching){const e=this,{batchChanges:s}=e.meta,t={};if(e.batching=null,e.meta.batchChanges=null,e.generation++,!e.$silenceBatch){Object.entries(s).forEach(([r,i])=>{t[r]={oldValue:i,value:e[r]}});const n={action:"update",record:e,records:[e],changes:t};e.stores.forEach(r=>{r.trigger("batchedUpdate",{...n})}),e.forEachLinked((r,i)=>{r.trigger("batchedUpdate",{...n,record:i,records:[i]})})}e.$silenceBatch&&e.$silenceBatch--}}triggerBeforeUpdate(e){var s;return!((s=this.stores)!=null&&s.some(t=>t.trigger("beforeUpdate",{record:this,changes:e})===!1))}copy(e=null,s){const t=this,n=x.clone(t.data),r=t.constructor.idField,i=x.isObject(s)?s.deep:s;let a;if(e&&typeof e=="object"?(a=e[r],Object.assign(n,e)):a=e,i&&t.children?n.children=t.children.map(l=>l.copy(void 0,s)):(delete n.children,delete n.expanded),t.$meta.fields.initable.length>0){const l=t.toJSON();for(const c of t.$meta.fields.initable)n[c.name]=l[c.name]}e!==!1&&(n[r]=a||t.generateId(t.firstStore));const o=new t.constructor(n,null,null,!1,!0);return o.originalInternalId=t.internalId,o}copyData(e,s,t){const n={};e.allFields.forEach(({name:r})=>{r!==e.constructor.idField&&(n[r]=s?e.get(r):e.getValue(r))}),this.set(n,null,t)}remove(e=!1){const s=this,{parent:t}=this;t?t.removeChild(s):s.stores.length&&!s.isSpecialRow&&s.stores.forEach(n=>n.remove(s,e,!1,!0))}beforeRemove(e,s){return super.beforeRemove(e,s)}get isValid(){return!0}get firstStore(){return this.stores.length>0&&this.stores[0]}joinStore(e){var s;const t=this,{stores:n}=t;if(!n.includes(e)){const{unjoinedStores:r}=t;super.joinStore(e),e.register(t),n.push(e),r.includes(e)&&r.splice(r.indexOf(e),1),t.isLoaded&&t.children.forEach(i=>i.joinStore(e)),t.initRelations(),e.tree&&!t.isRoot&&!((s=e.stm)!=null&&s.isRestoring)&&(t.instanceMeta(e.id).collapsed=!t.expanded)}}unjoinStore(e,s=!1){var t,n,r;const i=this,{stores:a,unjoinedStores:o}=i;a.includes(e)&&(e.isDestroying||(e.unregister(i),o.push(e)),(n=(t=i.unfilteredChildren||i.children)==null?void 0:t.forEach)==null||n.call(t,l=>l.unjoinStore(e,s)),a.splice(a.indexOf(e),1),(r=super.unjoinStore)==null||r.call(this,e,s),e.uncacheRelatedRecord(i))}isPartOfStore(e){return e?e.includes(this):this.stores.length>0}get isRemoved(){return!this.isPartOfStore()}instanceMeta(e){const{meta:s}=this,t=e.id||e;return s.map||(s.map={}),s.map[t]||(s.map[t]={})}get isGroupHeader(){return"groupRowFor"in this.meta}get isGroupFooter(){return"groupFooterFor"in this.meta}get isSpecialRow(){var e;return!!((e=this.meta)!=null&&e.specialRow)}get $original(){return this.isLinked?this.proxyMeta.originalRecord:this}static get nonPersistableFields(){const e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach(s=>{(!s.persist||s.calculated)&&(e._nonPersistableFields[s.name]=1)})),e._nonPersistableFields}static get alwaysWriteFields(){const e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=[],e.allFields.forEach(s=>{s.alwaysWrite&&e._alwaysWriteFields.push(s.name)})),e._alwaysWriteFields}get domId(){return typeof this.id=="string"?this.id.replace(/[ .]/g,"-"):this.id}static toJavaScriptValue(e){const{names:s}=this.$meta,t=s[s.length-2],n=s[s.length-3];return`class ${t} extends ${n} { static fields = ${U.toJavaScriptValue(this.fields,e)}; }`}getCurrentConfig(e){const{data:s,children:t}=this,{defaultValues:n,applyConfigs:r}=this.constructor,i=r?super.getCurrentConfig(e):{};if(i){for(const a of this.fields)if(a.persist){const o=x.getPath(s,a.dataSource);a.isEqual(o,n[a.name])||x.setPath(i,a.dataSource,$.processConfigValue(o,e))}if(t)if(Array.isArray(t)){i.children=[];for(const a of t)i.children.push(a.getCurrentConfig(e))}else i.children=t;this.hasGeneratedId&&delete i.id,delete i.parentId,delete i.parentIndex}return i}},H=Eo;F(H,"relations",null),H._idField="id",H._internalIdCounter=1,H._assignedIdField=!1,H.exposeProperties(),H._$name="Model";var ni=class extends O([xt,H],e=>{const s=e.prototype;class t extends e{get isEntity(){return!0}construct(r,...i){this.constructor.exposeProperties(),this.originalData=r=r||{},s.construct.call(this,r,...i);for(const a in this.originalData)this.$[a]&&!this.getFieldDefinition(a)&&(this[a]=r[a])}*userProvidedValue(){return yield X}copy(r=null,i=null){const a=s.copy.call(this,r,i),{creatingOccurrence:o}=i!=null?i:{};return(x.isObject(i)&&!i.skipFieldIdentifiers||!x.isObject(i))&&this.forEachFieldIdentifier((l,c,u)=>{var d;!u.lazy&&((d=this.getFieldDefinition(c))==null?void 0:d.type)!=="store"&&(!o||l instanceof ei||l instanceof Ns)&&(a[c]=this[c])}),a}applyValue(r,i,a,o,l){var c;this.$entity.getField((l==null?void 0:l.name)||i)&&(r=!0),o&&(r=!1),s.applyValue.call(this,r,r&&(c=l==null?void 0:l.name)!=null?c:i,a,o,l)}get isInActiveTransaction(){var r;const i=(r=this.graph)==null?void 0:r.activeTransaction;return!!(i!=null&&i.getLatestEntryFor(this.$$))}get data(){return this._data}set data(r){this._data=r;const{fields:i,$:a,graph:o,generation:l}=this;for(let c=0;c<i.length;c++){const{name:u,dataSource:d,complexMapping:h}=i[c],f=a[u];if(f){const g=h?x.getPath(r,d):r[d];(h||d in r)&&(l!=null||g!==void 0)&&f.writeToGraph(o,g)}}}get $entityName(){const r=this.constructor.name||this.$entity.name,i=this.id;return`${r}${i!=null?"-"+String(i):""}`}}return t}){},Ws=class extends O([],e=>{const s=e.prototype;class t extends e{async commitAsync(){return this.project.commitAsync()}set project(r){this.$project=r}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(r){return this.project=r}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const r=this.getProject();return r==null?void 0:r.assignmentStore}getDependencyStore(){const r=this.getProject();return r==null?void 0:r.dependencyStore}getEventStore(){const r=this.getProject();return r==null?void 0:r.eventStore}getResourceStore(){const r=this.getProject();return r==null?void 0:r.resourceStore}getCalendarManagerStore(){const r=this.getProject();return r==null?void 0:r.calendarManagerStore}}return t}){},bo=class extends O([Ws],e=>{const s=e.prototype;class t extends e{getGraph(){const r=this.getProject();return r==null?void 0:r.getGraph()}getEventById(r){var i;return(i=this.getEventStore())==null?void 0:i.getById(r)}getDependencyById(r){var i;return(i=this.getDependencyStore())==null?void 0:i.getById(r)}getResourceById(r){var i;return(i=this.getResourceStore())==null?void 0:i.getById(r)}getAssignmentById(r){var i;return(i=this.getAssignmentStore())==null?void 0:i.getById(r)}getCalendarById(r){var i;return(i=this.getCalendarManagerStore())==null?void 0:i.getById(r)}}return t}){};function xm(e,s){const t=x.getPropertyDescriptor(e,s);return t&&(t.get||t.set)?t:null}var ii=class extends $.mixin(Vt,gt){static get configurable(){return{clientListeners:null,disabled:!1,client:null,keyMap:null}}updateClient(e){this.owner||(this.owner=e)}updateKeyMap(e){const{client:s}=this;s.keyMap=s.mergeKeyMaps(s.keyMap,e,U.uncapitalize(this.constructor.$name))}static initPlugins(e,...s){const t=e.plugins||(e.plugins={});for(const n of s)t[n.$$name]=new n(e)}get enabled(){return!this.disabled}getFocusRevertTarget(){var e;return(e=this.client)==null?void 0:e.getFocusRevertTarget()}construct(...e){const s=this;let[t,n]=e,r;e.length===1?x.isObject(t)&&(n=t,t=n.client):(n=x.assign({},n),delete n.client),s.client=t,super.construct(n),s.applyPluginConfig(t),r=s.clientListeners,r&&(r=x.assign({},r),r.thisObj=s,t.ion(r))}applyPluginConfig(e){const s=this,t=s.pluginConfig||s.constructor.pluginConfig;if(t){const{assign:n,chain:r,after:i,before:a,override:o}=t;n&&s.applyAssign(e,n),(r||i)&&s.applyChain(e,r||i),a&&s.applyChain(e,a,!1),o&&s.applyOverride(e,o)}}applyAssign(e,s){s.forEach(t=>this.assign(e,t))}applyChain(e,s,t=!0){if(Array.isArray(s))for(const n of s)this.chain(e,n,n,t);else for(const n in s)this.chain(e,n,s[n],t)}applyOverride(e,s){const t=this;t.overridden||(t.overridden={}),s.forEach(n=>{if(!t[n])throw new Error(`Trying to chain fn ${e.$$name}#${n}, but plugin fn ${t.$$name}#${n} does not exist`);typeof e[n]=="function"&&(t.overridden[n]=e[n].bind(e)),e[n]=t[n].bind(t)})}assign(e,s){const t=this,n=xm(t,s);n?Object.defineProperty(e,s,{configurable:!0,enumerable:!0,get:n.get&&n.get.bind(t),set:n.set&&n.set.bind(t)}):e[s]=t[s].bind(t)}chain(e,s,t,n=!0){let r=0;typeof s=="object"&&(s=s.fn),typeof t=="object"&&(r=t.prio||0,t=t.fn);const i=this,a=e.pluginFunctionChain||(e.pluginFunctionChain={}),o=i[t]&&i[t].bind(i),l=i.functionChainRunner;if(!o)throw new Error(`Trying to chain fn ${e.$$name}#${t}, but plugin fn ${i.$$name}#${t} does not exist`);if(!a[s]){let c=e[s];c&&(c=c.bind(e),c.$this=e,c.$prio=0),a[s]=c?[c]:[],e[s]=(...u)=>l(a[s],u)}o.$this=i,o.$prio=r,a[s][n?"push":"unshift"](o),a[s].$sorted=!1}functionChainRunner(e,s){let t,n,r;for(e.$sorted||(e.sort((i,a)=>a.$prio-i.$prio),e.$sorted=!0),n=0;n<e.length&&(t=e[n],!(!t.$this.isDestroyed&&(r=t(...s),r===!1)));n++);return r}doDisable(e){var s,t,n,r;const i=this,{constructor:a}=i,o="featureClass"in a?a.featureClass:`b-${a.$$name.toLowerCase()}`,l=U.uncapitalize(a.$$name);o&&((t=(s=i.client)==null?void 0:s._element)==null||t.classList[e?"remove":"add"](o)),i.isConfiguring||(e?i.trigger("disable"):i.trigger("enable"),(r=(n=i.client).syncSplits)==null||r.call(n,c=>{const u=c.features[l];u&&(u.disabled=e)}))}updateDisabled(e){this.doDisable(e)}throwOverrideIsMissing(e){throw new Error(`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`)}get rootElement(){return this.client.rootElement}};F(ii,"$name","InstancePlugin"),ii._$name="InstancePlugin";var Tm=e=>class extends(e||$){static get $name(){return"Pluggable"}get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(t){t&&(Array.isArray(t)||(t=[t]),ii.initPlugins(this,...t)),this.initPlugins()}initPlugins(){}addPlugins(...t){ii.initPlugins(this,...t)}hasPlugin(t){return this.getPlugin(t)!=null}getPlugin(t){var n;return typeof t=="function"&&(t=t.$$name),(n=this.plugins)==null?void 0:n[t]}get widgetClass(){}},{defineProperty:Ro}=Reflect,ai;Oe.isBrowserEnv?ai=globalThis.performance:ai={now(){return new Date().getTime()}};var Y=null;if(Se.isTestEnv){const e=globalThis.bryntum||(globalThis.bryntum={});Y=e.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,idleCallbacks:new Map,isEmpty(s=!1){return Y.timeouts.size+Y.animationFrames.size+Y.idleCallbacks.size+(s?Y.intervals.size:0)===0},getFiltered({ignoreTimeouts:s=[],maxDelay:t=5e3,includeIntervals:n=!1}){const r=[],i=["timeouts","animationFrames","idleCallbacks"];n&&i.push("intervals");for(const a of i){const o=Y[a];for(const[,l]of o.entries())!s.includes(l.name)&&(!Number.isInteger(l.delay)||l.delay<t)&&r.push(l)}return r}}}var zs=(e,s,t,n)=>{const r=typeof s=="string",i=(n==null?void 0:n.appendArgs)||[],a=()=>{t.timerId=null,t.lastCallTime=ai.now();const o=t.args;t.args=null,r?e[s](...o,...i):s.call(e,...o,...i),t.called=!0,++t.calls};return n&&(e=n.thisObj||e),t.lastCallTime=-9e9,t.calls=0,t.invoker=a,a.wrapFn=t,a},oi=(e,s,t="clearTimeout")=>(s.cancel=()=>{s.isPending&&(e[t](s.timerId),s.args=s.timerId=null)},s.flush=()=>{s.isPending&&(e[t](s.timerId),s.timerId=null,s.invoker())},s.now=(...n)=>{s.cancel(),s.args=n,s.invoker()},s.resume=n=>{const r=s.suspended;s.suspended=n||r<1?0:r-1},s.suspend=()=>{++s.suspended},s.immediate=!1,s.suspended=0,s.timerId=null,Ro(s,"isPending",{get(){return s.timerId!==null}}),s),Ar=e=>class extends(e||$){static get $name(){return"Delayable"}static get declarable(){return["delayable"]}doDestroy(){const t=this;super.doDestroy(),t.timeoutIds&&(t.timeoutIds.forEach((n,r)=>{typeof n=="function"&&n(),clearTimeout(r),Y==null||Y.timeouts.delete(r)}),t.timeoutIds=null),t.timeoutMap&&(t.timeoutMap.forEach((n,r)=>clearTimeout(r)),t.timeoutMap=null),t.intervalIds&&(t.intervalIds.forEach(n=>{clearInterval(n),Y==null||Y.intervals.delete(n)}),t.intervalIds=null),t.animationFrameIds&&(t.animationFrameIds.forEach(n=>{cancelAnimationFrame(n),Y==null||Y.animationFrames.delete(n)}),t.animationFrameIds=null),t.idleCallbackIds&&(t.idleCallbackIds.forEach(n=>{cancelIdleCallback(n),Y==null||Y.idleCallbacks.delete(n)}),t.idleCallbackIds=null)}hasTimeout(t){var n;return!!((n=this.timeoutMap)!=null&&n.has(t))}setTimeout({fn:t,delay:n,name:r,runOnDestroy:i,cancelOutstanding:a,args:o}){(arguments.length>1||typeof arguments[0]=="function")&&([t,n,r,i]=arguments),typeof t=="string"?r=t:r||(r=t.name||t),a&&this.clearTimeout(r);const l=this,c=l.timeoutIds||(l.timeoutIds=new Map),u=l.timeoutMap||(l.timeoutMap=new Map),d=setTimeout(()=>{typeof t=="string"&&(t=l[r]),c==null||c.delete(d),u==null||u.delete(r),Y==null||Y.timeouts.delete(d),t.apply(l,o)},n);return c.set(d,i?t:!0),Y==null||Y.timeouts.set(d,{fn:t,delay:n,name:r}),r&&u.set(r,d),d}clearTimeout(t){var n;let r=t;if(typeof r=="string")if(this.timeoutMap)r=this.timeoutMap.get(t),this.timeoutMap.delete(t);else return;clearTimeout(r),(n=this.timeoutIds)==null||n.delete(r),Y==null||Y.timeouts.delete(r)}clearInterval(t){var n;clearInterval(t),(n=this.intervalIds)==null||n.delete(t),Y==null||Y.intervals.delete(t)}setInterval(t,n,r){const i=setInterval(t,n);return(this.intervalIds||(this.intervalIds=new Set)).add(i),Y==null||Y.intervals.set(i,{fn:t,delay:n,name:r}),i}requestAnimationFrame(t,n=[],r=this){const i=this.animationFrameIds||(this.animationFrameIds=new Set),a=requestAnimationFrame(()=>{Y==null||Y.animationFrames.delete(a),i.delete(a)&&t.apply(r,n)});return i.add(a),Y==null||Y.animationFrames.set(a,{fn:t,extraArgs:n,thisObj:r}),a}requestIdleCallback(t,n=[],r=this){const i=this.idleCallbackIds||(this.idleCallbackIds=new Set),a=requestIdleCallback(()=>{Y==null||Y.idleCallbacks.delete(a),i.delete(a)&&t.apply(r,n)});return i.add(a),Y==null||Y.idleCallbacks.set(a,{fn:t,extraArgs:n,thisObj:r}),a}createOnFrame(t,n=[],r=this,i){let a;const o=(...l)=>{a!=null&&i&&(this.cancelAnimationFrame(a),a=null),a==null&&(a=this.requestAnimationFrame(()=>{typeof t=="string"&&(t=r[t]),a=null,l.push(...n),t.apply(r,l)}))};return o.cancel=()=>this.cancelAnimationFrame(a),o}cancelAnimationFrame(t){var n;cancelAnimationFrame(t),(n=this.animationFrameIds)==null||n.delete(t),Y==null||Y.animationFrames.delete(t)}cancelIdleCallback(t){var n;cancelIdleCallback(t),(n=this.idleCallbackIds)==null||n.delete(t),Y==null||Y.idleCallbacks.delete(t)}async nextAnimationFrame(){return new Promise(t=>this.requestAnimationFrame(t))}buffer(t,n){let r=n;n&&typeof n!="number"?r=n.delay:n=null;const i=(...o)=>{if(i.suspended)return;const{delay:l}=i;i.cancel(),i.called=!1,i.args=o,i.immediate||!l?a():i.timerId=this.setTimeout(a,l)},a=zs(this,t,i,n);return i.delay=r,oi(this,i)}raf(t,n){let r=n;n&&typeof n!="boolean"?r=n.cancelOutstanding:n=null;const i=(...o)=>{i.suspended||(i.cancelOutstanding&&i.cancel(),i.called=!1,i.args=o,i.immediate?a():i.isPending||(i.timerId=this.requestAnimationFrame(a)))},a=zs(this,t,i,n);return i.cancelOutstanding=r,oi(this,i,"cancelAnimationFrame")}idle(t,n){let r=n;n&&typeof n!="boolean"?r=n.cancelOutstanding:n=null;const i=(...o)=>{i.suspended||(i.cancelOutstanding&&i.cancel(),i.called=!1,i.args=o,i.immediate?a():i.isPending||(i.timerId=this.requestIdleCallback(a)))},a=zs(this,t,i,n);return i.cancelOutstanding=r,this.setTimeout(()=>this.idleCallbackIds.delete(i.timerId)&&i.now(),100),oi(this,i,"cancelIdleCallback")}throttle(t,n){let r=n,i;n&&typeof n!="number"?(r=n.delay,i=n.throttled):n=null;const a=this,o=(...c)=>{if(o.suspended)return;const{delay:u}=o,d=ai.now()-o.lastCallTime;o.args=c,o.immediate||d>=u?(a.clearTimeout(o.timerId),l()):(o.isPending||(o.timerId=a.setTimeout(l,u-d),o.called=!1),i&&(i.wrapFn.args=c,i()))},l=zs(a,t,o,n);return o.delay=r,i&&(i=zs(a,i,()=>{},n)),oi(a,o)}static setupDelayable(t){t.setupDelayableMethods(t.delayable)}static setupDelayableMethods(t,n=null){const r=this,i=t.static,a=n||r.prototype;i&&delete t.static;for(const o in t){let l=t[o];const c=o+"Now",u=typeof l;a[c]||(a[c]=a[o]),u==="number"?l={type:"buffer",delay:l}:u==="string"&&(l={type:l}),Ro(a,o,{get(){const d=this[l.type]((...h)=>{this[c](...h)},l);return Ro(this,o,{value:d}),d}})}}get widgetClass(){}},qs=class{get data(){return Object.create(null)}get keys(){return[]}clear(){}getItem(e){return null}removeItem(e){}setItem(e,s){}};qs._$name="StateStorage";var Om=class extends qs{constructor(e){super(),this.prefix=e.prefix||""}get isLocal(){return!0}get data(){const e=Ad(),s=this.keys;for(const t of s)e[t]=this.getItem(t);return e}get keys(){return $d(this.prefix,this.prefix.length)}clear(){const e=$d(this.prefix);for(const s of e)localStorage.removeItem(s)}getItem(e){const s=localStorage.getItem(this.prefix+e);return s===null?s:JSON.parse(s)}removeItem(e){return localStorage.removeItem(this.prefix+e)}setItem(e,s){return localStorage.setItem(this.prefix+e,JSON.stringify(s))}},Am=class extends qs{constructor(){super(),this.clear()}get isMemory(){return!0}get data(){return x.clone(this._data)}get keys(){return Object.keys(this._data)}clear(){this._data=Ad()}getItem(e){return e in this._data?this._data[e]:null}removeItem(e){delete this._data[e]}setItem(e,s){this._data[e]=s}},Ad=()=>Object.create(null),$d=(e,s=0)=>{const t=[],n=localStorage.length;for(let r,i=0;i<n;++i)r=localStorage.key(i),r.startsWith(e)&&t.push(r.slice(s));return t},_d=new qs,wo={local:Om,memory:Am},Gs=class extends $.mixin(Ar,Vt){static get $name(){return"StateProvider"}static get configurable(){return{prefix:"bryntum-state:",storage:"local"}}static get delayable(){return{writeStatefuls:50}}static get instance(){return this._instance}static set instance(e){e==null?e=Fd:((typeof e=="string"||x.isClass(e)||e instanceof qs)&&(e={storage:e}),x.isObject(e)&&(e=new Gs(e))),this._instance=e}static setup(e){return this.instance=e,this.instance}doDestroy(){self.writeStatefuls.flush(),super.doDestroy()}get data(){return this.storage.data}set data(e){if(!e)this.clear();else for(const s in e)this.setValue(s,e[s])}clear(){return this.storage.clear(),this}changeStorage(e){if(e==null)e=_d;else{if(typeof e=="string"){if(!wo[e])throw new Error(`Invalid storage type "${e}" (expected one of: "${Object.keys(wo).join('", "')}")`);e=wo[e]}x.isClass(e)&&(e=new e(this))}return e}saveStateful(e,s){(this.pendingSaves||(this.pendingSaves=[])).push([e,s]),this.writeStatefuls()}writeStatefuls(){const e=this,{pendingSaves:s}=e,t=s==null?void 0:s.length,n=[],r=[];if(e.pendingSaves=null,t){for(let i,a,o,l=0;l<t;++l)[a,i]=s[l],!a.isDestroying&&a.isSaveStatePending&&(o=a.saveState({...i,immediate:!0}),o&&(n.push(o),r.push(a)));n.length&&e.trigger("save",{stateIds:n,saved:r})}}getValue(e){return this.writeStatefuls.flush(),this.storage.getItem(e)}setValue(e,s){const t=this,{storage:n}=t,r=t.getValue(e);return s!=null?(n.setItem(e,s),t.trigger("set",{key:e,value:s,was:r})):r!==null&&(n.removeItem(e),t.trigger("remove",{key:e,was:r})),t}},Fd=new Gs({storage:_d});Gs._instance=Fd,Gs._$name="StateProvider";var $m=/boolean|number|string/,_m=e=>{var s;return s=class extends(e||$){afterConstruct(){super.afterConstruct(),this.loadState()}finalizeInit(){this.loadState(),super.finalizeInit()}get isStateful(){return!0}get isStatefulActive(){return!this.statefulSuspended&&!this.isResponsivePending&&!this.isResponsiveUpdating}get state(){return this._state=this.getState()}set state(t){this._state=t,t&&this.applyState(t)}updateStatefulEvents(t){var n;const r=this,i={name:"statefulEvents",thisObj:r};if(r.detachListeners(i.name),t&&(typeof t=="string"?t=U.split(t):Array.isArray(t)||(t=x.getTruthyKeys(t)),t.length)){for(const a of t)i[a]="onStatefulEvent";(n=r.ion)==null||n.call(r,i)}}get statefulId(){const t=this,{responsiveState:n}=t;let r=t.stateId;return r==null&&t.hasGeneratedId===!1&&t.stateful!==!1&&(r=t.id),r&&n&&(r=`${r}[${n}]`),r}get statefulness(){const{stateful:t}=this;return Array.isArray(t)?x.createTruthyKeys(t):t}get stateProvider(){return this._stateProvider||Gs.instance}applyState(t){t=this.pruneState(t),t&&this.setConfig(t)}getState(){const t=this,{initialConfig:n,statefulness:r,isConstructing:i}=t,{configs:a}=t.$meta,o=i?Object.setPrototypeOf(n,t.$meta.config):t;let l=null,c,u;if(r){l={};for(c in r)if(r[c]){if(u=o[c],u!=null&&u.isStateful)u=u.state;else if(!i&&(x.isDate(u)&&(u=R.format(u,"YYYY-MM-DDTHH:mm:ssZ")),a[c].equal(u,n==null?void 0:n[c])||!$m.test(typeof u)))continue;l[c]=u}}return l}loadState(t,n){typeof t=="boolean"&&(n=t,t=null);const r=this,{statefulLoaded:i}=r;if(r.isStatefulActive&&(n||!i)){const a=r.loadStatefulData(t||(t=r.statefulId));!i&&t&&(r.defaultState=r.state,r.statefulLoaded=!0),a&&(r.state=a)}}loadStatefulData(t){var n;return t=this.isStatefulActive?t||this.statefulId:null,t&&((n=this.stateProvider)==null?void 0:n.getValue(t))}resetDefaultState(){this.defaultState&&(this.state=this.defaultState)}resumeStateful(t=!1){this.statefulSuspended=t?0:Math.max(this.statefulSuspended-1,0)}saveState(t){typeof t=="string"?t={id:t}:t=t||{};const n=this,{stateProvider:r}=n,i=t.id||n.isStatefulActive&&n.statefulId;if(i&&r)return t.immediate?(n.isSaveStatePending=!1,r.setValue(i,n.state)):n.isSaveStatePending||(n.isSaveStatePending=!0,r.saveStateful(n,t)),i}suspendStateful(){++this.statefulSuspended}onConfigChange({name:t,value:n,was:r,config:i}){if(super.onConfigChange({name:t,value:n,was:r,config:i}),!this.isConstructing&&this.isStatefulActive&&this.statefulId){const{stateful:a}=this;(Array.isArray(a)?a.includes(t):a!=null&&a[t])&&this.saveState()}}onStatefulEvent(){this.isConstructing||this.saveState()}pruneState(t){const{statefulness:n}=this;if(n){const r={};for(const i in t)n[i]&&(r[i]=t[i]);t=r}return t}get widgetClass(){}},F(s,"$name","State"),F(s,"configurable",{stateful:{value:null,$config:{merge:"classList"}},statefulEvents:{$config:{merge:"classList"},value:["stateChange"]},stateId:null,stateProvider:null}),F(s,"prototypeProperties",{statefulLoaded:!1,statefulSuspended:0}),s},jd=x.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),Fm={string:1,number:1},kd=e=>class extends(e||$){static get $name(){return"Identifiable"}static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(t,n){const{identifiable:r}=t;r.idMap=Object.create(null),Reflect.defineProperty(t,"identifiable",{get(){return r}})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(t){return(this.hasGeneratedId=!t)?this.generateAutoId():t}updateId(t,n){const r=this,i=r.constructor;n&&i.unregisterInstance(r,n),(!r.hasGeneratedId||i.identifiable.registerGeneratedId!==!1)&&i.registerInstance(r,t)}generateAutoId(){return this.constructor.generateId(`b-${this.$$name.toLowerCase()}-`)}static get all(){return Object.values(this.identifiable.idMap)}static generateId(t="generatedId"){return t+(jd[t]=(jd[t]||0)+1)}static registerInstance(t,n=t.id){const{idMap:r}=this.identifiable;if(n in r&&!this.disableThrow)throw new Error("Id "+n+" already in use");r[n]=t}static unregisterInstance(t,n=t.id){const{idMap:r}=this.identifiable;Fm[typeof t]?delete r[t]:r[n]===t&&delete r[n]}static getById(t){const n=this.identifiable.idMap;if(n)return n[t]}static get registeredInstances(){const t=this.identifiable.idMap;return t?Object.values(t):[]}},xe=class{constructor(e,s){typeof e=="number"||e===null?(this._magnitude=e,this._unit=s):(typeof e=="string"&&Object.assign(this,R.parseDuration(e)),typeof e=="object"&&Object.assign(this,e))}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude=typeof e=="number"&&e}get unit(){return this._unit}set unit(e){this._unit=R.parseTimeUnit(e)}get isValid(){return this._magnitude!=null&&!!R.normalizeUnit(this._unit)}get milliseconds(){return this.isValid?Math.round(R.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return!!e&&this._magnitude!=null&&e._magnitude!=null&&this.milliseconds===e.milliseconds}toString(e){const s=this,t=e?"getShortNameOfUnit":"getLocalizedNameOfUnit";return s.isValid?`${s._magnitude} ${R[t](s._unit,s._magnitude!==1)}`:""}toJSON(){return this.toString()}valueOf(){return this.milliseconds}diff(e){return new xe({unit:this.unit,magnitude:R.as(this.unit,this.milliseconds-e.milliseconds)})}};xe._$name="Duration";var jm=(e,s)=>e==null?void 0:e[s],km=/^is(this|next|last)(week|month|year)$/i,Lm=["isToday","isTomorrow","isYesterday","isThisWeek","isNextWeek","isLastWeek","isThisMonth","isNextMonth","isLastMonth","isThisYear","isNextYear","isLastYear","isYearToDate"],li=class extends $.mixin(kd){static get defaultConfig(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null,internal:null,disabled:!1}}static get configurable(){return{property:null}}construct(e){typeof e=="function"&&(e={filterBy:e}),e.type?e.type==="date"&&e.value!=null&&!Array.isArray(e.value)?e.value=new Date(e.value):e.type==="duration"&&e.value!=null&&!Array.isArray(e.value)&&(e.value=new xe(e.value)):R.isDate(e.value)||Array.isArray(e.value)&&e.value.every(R.isDate)?e.type="date":e.value instanceof xe&&(e.type="duration"),super.construct(e)}get id(){return this._id||(this.internal?this._id=li.generateId(`b-internal-${this.property}-filter-`):this._id=this.property||li.generateId("b-filter-")),this._id}set id(e){this._id=e}onChange(e){var s;const t=this;!t.isConfiguring&&((s=t.owner)!=null&&s.onFilterChanged)&&!t.owner.isConfiguring&&t.owner.onFilterChanged(t,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){const s=this;let t;return e.isModel?t=e.getValue(s.property):s._propertyItems.length>1?t=s._propertyItems.reduce(jm,e):t=e[s.property],s[s.operator](s.convert(t))}updateProperty(e){this._propertyItems=e.split("."),this.onChange("property")}set value(e){const s=this;s._value=e,Array.isArray(e)&&({date:1,duration:1}[s.type]||e.length>0&&typeof e[0]=="string")?s._filterValue=e.map(t=>s.convert(t)):!s.caseSensitive&&Array.isArray(e)&&e.length>0&&typeof e[0]=="string"?s._filterValue=e.map(t=>t==null?void 0:t.toLowerCase()):!s.caseSensitive&&typeof e=="string"?s._filterValue=e.toLowerCase():s._filterValue=s.convert(e),s.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){const e=this;return e._operator?e._operator:Array.isArray(e.filterValue)?"isIncludedIn":typeof e.filterValue=="string"?"*":"="}convert(e){var s;return this.operator!=="sameTime"&&!(typeof this.filterValue=="string"&&e instanceof Date)&&(this.operator==="sameDay"&&(e=R.clearTime(e)),e=(s=e==null?void 0:e.valueOf())!=null?s:e),e=!this.caseSensitive&&typeof e=="string"?e.toLowerCase():e,e}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}isIncludedIn(e){return this.filterValue.length===0||this.filterValue.includes(e)}isNotIncludedIn(e){return!this.isIncludedIn(e)}includes(e){return this.filterValue.length===0||String(e).includes(this.filterValue)}doesNotInclude(e){return!this.includes(e)}sameTime(e){return R.isSameTime(e,this.filterValue)}sameDay(e){return e===this.filterValue}"="(e){return x.isEqual(e,this.filterValue)}"!="(e){return!x.isEqual(e,this.filterValue)}">"(e){return x.isMoreThan(e,this.filterValue)}">="(e){return x.isMoreThan(e,this.filterValue)||x.isEqual(e,this.filterValue)}"<"(e){return x.isLessThan(e,this.filterValue)}"<="(e){return x.isLessThan(e,this.filterValue)||x.isEqual(e,this.filterValue)}"*"(e){return x.isPartial(e,this.filterValue)}between(e){const[s,t]=this._filterValue;return(x.isMoreThan(e,s)||x.isEqual(e,s))&&(x.isLessThan(e,t)||x.isEqual(e,t))}notBetween(e){return!this.between(e)}empty(e){return e==null||String(e).length===0}notEmpty(e){return!this.empty(e)}isToday(e){return this.between(e)}isTomorrow(e){return this.between(e)}isYesterday(e){return this.between(e)}isThisWeek(e){return this.between(e)}isNextWeek(e){return this.between(e)}isLastWeek(e){return this.between(e)}isThisMonth(e){return this.between(e)}isNextMonth(e){return this.between(e)}isLastMonth(e){return this.between(e)}isThisYear(e){return this.between(e)}isNextYear(e){return this.between(e)}isLastYear(e){return this.between(e)}isYearToDate(e){return this.between(e)}isTrue(e){return e===!0}isFalse(e){return e===!1}setRelativeDateValues(){this._filterValue=li.getRelativeDateRange(this._operator).map(e=>e.valueOf())}static getRelativeDateRange(e,s=new Date){let t,n,r,i,a,o,l;switch(e){case"isYearToDate":return[R.floor(s,"1 year"),s];case"isToday":return t=R.floor(s,"1 day"),[t,R.add(t,1,"day")];case"isYesterday":return t=R.floor(s,"1 day"),[R.add(t,-1,"day"),t];case"isTomorrow":return n=R.getStartOfNextDay(s),[n,R.add(n,1,"day")];case"isThisWeek":case"isNextWeek":case"isLastWeek":case"isThisMonth":case"isNextMonth":case"isLastMonth":case"isThisYear":case"isNextYear":case"isLastYear":if(r=e.toLowerCase().match(km),!r)throw new Error(`Unrecognized relative date expression: ${e}`);return[,o,l]=r,i=`1 ${l}`,a=R.floor(s,i),o==="next"?a=R.add(a,1,l):o==="last"&&(a=R.add(a,-1,l)),[a,R.add(a,1,l)]}}static generateFiltersFunction(e){if(!e||!e.length&&!e.count)return Et.returnTrue;for(const s of e)s.type==="date"&&Lm.includes(s._operator)&&s.setRelativeDateValues();return function(s){let t=!0;for(const n of e)if(n.disabled||(t=n.filter(s)),!t)break;return t}}},ke=li;F(ke,"$name","CollectionFilter"),ke._$name="CollectionFilter";var Ld=x.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),Io=class{static generateId(e="generatedId"){return e+(Ld[e]=(Ld[e]||0)+1)}};Io._$name="IdHelper";var Hs=class extends ${static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){typeof e=="function"&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||Io.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,s){const t=this,{convert:n,property:r,useLocaleSort:i}=t,a=t.direction.toLowerCase()==="desc"?-1:1;if(e=e[r],s=s[r],n&&(e=n(e),s=n(s)),i&&e!=null&&s!=null&&typeof e=="string"){if(i===!0)return String(e).localeCompare(s);if(typeof i=="string")return String(e).localeCompare(s,i);if(typeof i=="object")return String(e).localeCompare(s,i.locale,i)}return(e>s?1:e<s?-1:0)*a}static generateSortFunction(e,s){const t=e.isCollection?e.values:e,n=t.length;return(r,i)=>{let a,o;for(o=0;o<n;++o)if(a=t[o].sortFn(r,i),a)return a;return s?s(r,i):0}}};Hs._$name="CollectionSorter";var Nm=()=>0,Bm=(e,s)=>s-e,Po=Symbol("filteredIndicesProperty"),as=Object.freeze([]),Vm=Object.freeze({action:"sort",added:as,removed:as,replaced:as}),Um=Object.freeze({action:"filter",added:as,removed:as,replaced:as}),$r={string:1,number:1};function Nd(e,s,t){if(s.unique!==!1)s.set(t,e);else{let n=s.get(t);n||(n=new Set,s.set(t,n)),n.add(e)}}function Wm(e,s,t){s.unique!==!1?s.delete(t):s.has(t)&&(s.get(t).delete(e),s.get(t).size||s.delete(t))}function Bd(e,s,t,n){for(let r=0;r<e.length;r++){const i=e[r];for(let a=0;a<n;a++){const o=t[a],l=i[o],c=s[o];Nd(i,c,l)}}}var os=class extends $.mixin(Vt){constructor(){super(...arguments),F(this,"_sortFunction",null),F(this,"_addedValues",null)}static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,autoSort:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const s=this;s._values.length=0,s.isFiltered&&(s._filteredValues.length=0,s.filters.destroy()),(e=s._sorters)==null||e.destroy()}clear(){const e=this,s=e._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:s}))}equals(e,s){if(e.isCollection&&(e=e.values),e.length===this.count){let{values:t}=this;return s&&(e=e.map(s),t=t.map(s)),W.delta(e,t).inBoth.length===this.count}return!1}replaceValues({values:e,filteredValues:s,silent:t=!1,isNewDataset:n=!1}){const r=this;let i,a;r.isFiltered&&!n?(!!s?e&&(i=r._values,r._values=e.slice()):(s=e.slice(),e=null),a=r._filteredValues,r._filteredValues=s.slice()):(i=r._values,r._values=e.slice(),s=null,r.isFiltered&&n&&r.autoFilter?(r._filterFunction=null,r._filteredValues=r._values.filter(r.filterFunction)):r._filteredValues&&(r._filteredValues.length=0)),r._indicesInvalid=!0,r._addedValues=void 0,r.generation++,t||r.trigger("change",{action:"replaceValues",replacedValues:i,replacedFilteredValues:a,values:e,filteredValues:s})}set values(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}get filteredValues(){return this._filteredValues}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,s=!1){(this.isFiltered&&!s?this._filteredValues:this._values).forEach(e)}map(e,s=!1){return(this.isFiltered&&!s?this._filteredValues:this._values).map(e)}find(e,s=!1){return(this.isFiltered&&!s?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}get addedValues(){return this._addedValues}match(e,s=!0){const t=this,{_values:n}=t,r=[];return t.forEach(i=>{const a=e.get(i.id,!0);if(a){const o=t.indexOf(i,!0),l=n[o];n[o]=a,t.removeFromIndices(l),t.addToIndices(a)}else s&&r.push(i)}),r.length&&t.remove(r),t.isFiltered&&(t._filteredValues=t._values.filter(t.filterFunction)),r}add(...e){e.length===1?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){e.length===1?this.splice(0,...e):this.splice(0,e)}move(e,s){for(e=W.asArray(e);e.length&&e[0]===s;)e.shift();if(!e.length)return;const t=this,{_values:n}=t,r=t.indexOf(e[0],!0);if(e.length===1&&n[r+1]===s)return;t.suspendEvents(),t.remove(e),t.resumeEvents();const i=s?t.indexOf(s,!0):n.length;if(i===-1)throw new Error("Collection move beforeItem parameter must be present in Collection");return n.splice(i,0,...e),t._indicesInvalid=1,t.trigger("change",{action:"move",items:e,from:r,to:i}),i}splice(e=0,s,...t){const n=this,r=n.idProperty,i=n._values,a={},o=[],l=[],c=n.totalCount;let u,d;if(n.trigger("beforeSplice",{index:e,toRemove:s,toAdd:t})!==!1){if(t)if(t.length===1&&Array.isArray(t[0])&&(t=t[0]),c&&t.length){const h=n.indices[r];u=[];for(let f=0;f<t.length;f++){const g=t[f],p=g[r],m=h.get(p),y=m?i.indexOf(m):-1;a[p]=!0,y!==-1?i[y]!==g&&(l.push([i[y],g]),i[y]=g):u.push(g)}}else u=t;if(s){if(typeof s=="number"){s=Math.min(s,i.length-e);for(let h=e;s;--s){const f=i[h][r];a[f]?(e++,h++):(o.push(i[h]),i.splice(h,1),d=!0)}}else{let h=u.length===0,f;s=W.asArray(s);const g=s.reduce((p,m)=>{const y=typeof m=="number",D=y?m:n.indexOf(m,!0);return h&&(f!=null&&D!==f+1||y)&&(h=!1),D>=0&&D<c&&p.push(D),f=D,p},[]).sort(Bm);if(h)g.length&&(o.push.apply(o,s),i.splice(g[g.length-1],g.length),d=!0);else for(let p=0;p<g.length;p++){const m=g[p];if(m!==-1){const y=i[m][r];a[y]||(o.unshift(i[m]),i.splice(m,1),d=!0)}}}o.length&&!n._indicesInvalid&&o.forEach(n.removeFromIndices,n)}if(u.length){i.splice(Math.min(e,i.length),0,...u),d=!0,n._indicesInvalid||u.forEach(n.addToIndices,n),n._addedValues||(n._addedValues=new Set);for(const h of u)n._addedValues.add(h)}if(o.length&&n._addedValues)for(const h of o)n._addedValues.delete(h);l.length&&!n._indicesInvalid&&l.forEach(h=>{n.removeFromIndices(h[0]),n.addToIndices(h[1])}),d||l.length?(n.isSorted?n.onSortersChanged():n.isFiltered&&(n.autoFilter?n.onFiltersChanged({action:"splice",oldCount:1}):n._filteredValues.splice(Math.min(e,n._filteredValues.length),0,...u)),n.generation++,n.trigger("change",{action:"splice",removed:o,added:u,replaced:l,oldCount:c})):n.trigger("noChange",{index:e,toRemove:s,toAdd:t})}}changeId(e,s){const t=this,{idProperty:n}=t,r=$r[typeof e]?e:e[n],i=t.get(r);if(i){const a=t.get(s);if(a&&i!==a)throw new Error(`Attempt to set item ${r} to already existing member's id ${s}`);t.removeIndexEntry(e,n,r),t.addIndexEntry(e,n,s),i[n]=s}}get(e,s=!1){return this.getBy(this.idProperty,e,s)}getAt(e,s=!1){return this.isFiltered&&!s?this._filteredValues[e]:this._values[e]}getBy(e,s,t=!1){return this.findItem(e,s,this.isFiltered&&t)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new os({values:W.asArray(e),internalListeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const s=e instanceof Hs?e:new Hs(e);return this.sorters.add(s),s}get isSorted(){var e;return!!((e=this._sorters)!=null&&e.count)}onSortersChanged(){const e=this;e._sortFunction=null,e._addedValues=null,e._values.sort(e.sortFunction),e.trigger("change",Vm)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=Hs.generateSortFunction(this.sorters.values):this._sortFunction=Nm),this._sortFunction}get filters(){return this._filters||(this._filters=new os({internalListeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const s=e instanceof ke?e:new ke(e);return this.filters.add(s),s}removeFilter(e){const{filters:s}=this;e.isCollectionFilter||(e=s.get(e)),s.remove(e)}clearFilters(){this.filters.clear()}get isFiltered(){return!!(this._filters&&this._filters.count)}onFiltersChanged({action:e,removed:s,oldCount:t}){const n=this,r=t||e==="clear"&&s.length?n._filteredValues:n._values;n._filterFunction=null,n._filteredValues=n._values.filter(n.filterFunction),n._indicesInvalid=!0;const{toAdd:i,toRemove:a}=W.delta(n._filteredValues,r,!0);n.trigger("change",{...Um,added:i,removed:a})}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=ke.generateFiltersFunction(this.filters.values):this._filterFunction=Et.returnTrue),this._filterFunction}changeExtraKeys(e){return W.asArray(e).map(t=>typeof t=="string"?{property:t,unique:!0}:t)}updateExtraKeys(e){for(let s=0;s<e.length;s++)this.addIndex(e[s])}addIndex(e){const s=this;e&&((s._indices||(s._indices={}))[e.property]=new Map,Object.assign(s._indices[e.property],e),s.invalidateIndices(),e.dependentOn&&(s.hasCompositeIndex=!0))}findIndex(e,s,t=!1){const n=this.findItem(e,s,t);return n?(this.isFiltered&&!t?this._filteredValues:this._values).indexOf(n):-1}findItem(e,s,t=!1){var n;const r=this,{isFiltered:i}=r,a=i&&!t?r.indices[Po][e]:r.indices[e];if(a){const o=(n=a.get(s))!=null?n:typeof s=="string"&&s.length&&!isNaN(s)&&a.get(Number(s))||null;if(o!=null)return o}else{const o=i&&!t?r._filteredValues:r._values,l=o.length;for(let c=0;c<l;c++){const u=o[c];if(u[e]==s)return u}}return null}removeIndex(e){delete this._indices[e],this.hasCompositeIndex=Object.values(this.indices).some(s=>s.dependentOn)}indexOf(e,s=!1){return this.findIndex(this.idProperty,$r[typeof e]?e:e[this.idProperty],s)}includes(e,s=!1){return Array.isArray(e)?e.some(t=>this.includes(t)):!!this.findItem(this.idProperty,$r[typeof e]?e:e[this.idProperty],s)}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}invalidateIndices(){this._indicesInvalid=!0}rebuildIndices(){const e=this,s=e.isFiltered,t=e._indices||(e._indices={}),n=Object.keys(t),r=n.length,i=e._values;let a;s&&(a=t[Po]={});for(let o=0;o<r;o++){const l=t[n[o]];if(l.clear(),s){let c=a[n[o]];c?c.clear():(c=a[n[o]]=new Map,c.unique=l.unique)}}Bd(i,t,n,r),s&&Bd(e._filteredValues,a,n,r),e._indicesInvalid=!1}getIndices(e){const s=[this.indices[e]];return this.isFiltered&&s.push(this.indices[Po][e]),s}addToIndices(e){Object.keys(this.indices).forEach(s=>{this.addIndexEntry(e,s,e[s])})}removeFromIndices(e){Object.keys(this.indices).forEach(s=>{this.removeIndexEntry(e,s,e[s])})}removeIndexEntry(e,s,t){this.getIndices(s).forEach(n=>Wm(e,n,t))}addIndexEntry(e,s,t){this.getIndices(s).forEach(n=>Nd(e,n,t))}onItemMutation(e,s){const t=this;!t._indicesInvalid&&Object.keys(t.indices).length>1&&Object.keys(s).forEach(n=>{var r;if(t.indices[n]){const{value:a,oldValue:o}=s[n];t.removeIndexEntry(e,n,o),t.addIndexEntry(e,n,a)}if(t.hasCompositeIndex){const a=Object.values(t.indices).find(o=>{var l;return(l=o.dependentOn)==null?void 0:l[n]});if(a){const o={};for(const c in a.dependentOn)o[c]=((r=s[c])==null?void 0:r.oldValue)||e[c];const l=e.buildIndexKey(o);t.removeIndexEntry(e,a.property,l),t.addIndexEntry(e,a.property,e[a.property])}}})}};os._$name="Collection";var Vd=new WeakMap,Ys=e=>{if(e&&typeof e=="object"){let s=Vd.get(e);s===void 0&&(s=Symbol("bscik"),Vd.set(e,s)),e=s}return e},Ud=class{constructor(e){const s=this;s.generation=0,s.items=new Set,s.idMap={},s.idProperty="id",e&&(e.idProperty&&(s.idProperty=e.idProperty),e.values&&(s.values=e.values))}get(e){return this.idMap[Ys(e)]}get count(){return this.items.size}add(...e){e.length===1&&Array.isArray(e[0])&&(e=e[0]);const s=this,{items:t,idMap:n,idProperty:r}=s,i=e.length;for(let a=0;a<i;a++){const o=e[a],l=$r[typeof o]?o:Ys(o[r]),c=n[l];c==null?(n[l]=o,t.add(o),s.generation++):c!==o&&(n[l]=o,t.delete(c),t.add(o))}}at(e){let s,t;e<0&&(e+=this.count);for(s of this.items)if(!e--){t=s;break}return t}remove(e){e=W.asArray(e);const{items:s,idMap:t,idProperty:n}=this,r=e.length;for(let i=0;i<r;i++){const a=e[i],o=$r[typeof a]?a:Ys(a[n]),l=t[o];l!=null&&(s.delete(l),delete t[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}countOf(e){let s=0,t;for(t of this.items)e(t)&&++s;return s}changeId(e,s){const t=this,{idMap:n,idProperty:r}=t,i=$r[typeof e]?e:Ys(e[r]),a=t.get(i);if(a){const o=t.get(s);if(o&&a!==o)throw new Error(`Attempt to set item ${i} to already existing member's id ${s}`);a[r]=s,delete n[i],n[s]=a}}filter(e,s){const{items:t}=this,n=[];let r=0;return t.forEach(i=>{e.call(s,i,r++,t)&&n.push(i)}),n}includes(e){const s=$r[typeof e]?e:Ys(e[this.idProperty]);return!!this.idMap[s]}map(e,s){const{items:t}=this,n=new Array(t.size);let r=0;return t.forEach(i=>{n[r]=e.call(s,i,r++,t)}),n}forEach(e,s){return this.items.forEach(e,s)}find(e,s=0){let t,n;s<0&&(s+=this.countOf(e));for(t of this.items)if(e(t)&&!s--){n=t;break}return n}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e,s){let t=-1,n;for(n of this.items)if((!s||s(n))&&(++t,n===e))return t;return-1}get values(){return[...this.items]}set values(e){e=W.asArray(e),this.clear(),this.add.apply(this,e),this.generation++}sort(e){this.values=this.values.sort(e)}some(e,s){return this.values.some(e,s)}};Ud._$name="Bag";var ci=class extends Ud{add(...e){return e.length===1&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter(s=>s.isPersistable))}};ci._$name="StoreBag";var Wd=e=>class extends(e||$){static get $name(){return"StoreCRUD"}static get defaultConfig(){return{autoCommit:!1}}static get properties(){return{isRemoving:!1,suspendCount:0}}remove(t,n=!1){const r=this,{storage:i}=r;if(t=W.asArray(t).reduce((a,o)=>(o=r.getById(o),o&&a.push(o),a),[]),t.length===0)return t;if(!r.tree&&!n&&r.trigger("beforeRemove",{records:t})===!1)return[];if(r.isRemoving=!0,r.isGrouped){const a=i.count,o=[],l=new Set;for(const c of t){const{groupParent:u}=c.instanceMeta(r);u.meta.collapsed&&o.push(c),W.remove(u.groupChildren,c),W.remove(u.unfilteredGroupChildren,c),u.meta.childCount--,l.add(u)}for(const c of l)c.groupChildren.length>0&&r.onModelChange(c,{},{});o.length&&i.trigger("change",{action:"splice",removed:o,added:[],replaced:[],oldCount:a})}else if(r.tree){const a=[],o=t.length>1,l=t[0],c=o?void 0:i.indexOf(l),u=t.reduce((h,f)=>{const{parent:g}=f;return g&&(h[g.id]||(h[g.id]=[g,[]]),h[g.id][1].push(f)),h},{}),d=Array.from(Object.values(u));if(!n&&r.trigger("beforeRemove",{records:t,isMove:!1,parent:o?void 0:l.parent})===!1)return r.isRemoving=!1,[];d.sort((h,f)=>f[0].childLevel-h[0].childLevel);for(const[h,f]of d)a.push(...h.removeChild(f,!1,!0));return n||(r.trigger("remove",{parent:o?void 0:l.parent,index:c,isChild:!0,allRecords:a,isMove:!1,records:t}),r.trigger("change",{action:"remove",records:t})),r.isRemoving=!1,t}if(t.length===0)return r.isRemoving=!1,t;for(const a of t)a.beforeRemove(t);return n&&r.suspendEvents(),i.remove(t),n&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),r.isRemoving=!1,t}clear(t=!1){var n,r;const i=this,{storage:a}=i;if(i.storage.totalCount||(r=(n=i.rootNode)==null?void 0:n.unfilteredChildren)!=null&&r.length){if(!t&&i.trigger("beforeRemove",{records:a.allValues,removingAll:!0})===!1)return null;if(i.rootNode)i.isChained||i.rootNode.clearChildren(t);else if(t){const o=i.registeredRecords;for(let l=o.length-1,c;l>=0;l--)c=o[l],c&&!c.isDestroyed&&c.unjoinStore(i)}t&&(i.removed.clear(),a.suspendEvents()),a.clear(),t&&a.resumeEvents(),i.added.clear(),i.modified.clear()}}removeAll(t=!1){const n=this,r=n.storage;let i;if(n.isRemoving=!0,t){r.suspendEvents();const a=n.registeredRecords;for(let o=a.length-1,l;o>=0;o--)l=a[o],l&&!l.isDestroyed&&!l.isRoot&&l.unjoinStore(n)}return n.tree?i=n.rootNode.clear()!==!1:i=n.clear()!==null,t&&r.resumeEvents(),n.isRemoving=!1,i}add(t,n=!1,r={}){const i=this,{storage:a}=i;if(t=W.asArray(t),!(t!=null&&t.length))return;if(i.tree=i.tree||!!(i.autoTree&&t[0].children),i.tree){const l=new Map,c=i.modelClass.getFieldDataSource("parentIndex"),{parentIdField:u}=i.modelClass,d=[];return t.forEach(h=>{const f=h[u];l.has(f)||l.set(f,{append:[],insert:[]});const g=l.get(f);!h.isModel&&c in h?g.insert.push(h):g.append.push(h)}),l.forEach(({append:h,insert:f},g)=>{const p=g==null?i.rootNode:i.getById(g);if(!p)throw new Error(`Parent node with id ${g} not found, cannot add children.`);if(h.length&&d.push(...p.appendChild(h,n)),f.length)for(const m of f)d.push(p.insertChild(m,m[c],n,r))}),i.isFiltered&&i.reapplyFilterOnAdd&&i.filter({silent:!0}),i.reapplySortersOnAdd&&!i.isSyncingDataOnLoad&&i.sort(),d}if(!n&&i.trigger("beforeAdd",{records:t})===!1)return null;if(i.tree=i.tree||!!(i.autoTree&&t[0].children),i.tree)return i.rootNode.appendChild(t);const o=i.processRecords(t);return n&&i.suspendEvents(),a.add(o),n&&i.resumeEvents(),i.autoCommit&&i.doAutoCommit(),o}processRecords(t,n){return t.map(r=>{const i=this.processRecord(r.isModel?r:this.createRecord(r));return n==null||n.call(this,i),i})}insert(t,n,r=!1){var i;const a=this,o=a.storage,l=a.getAt(t),c=o.values,u=[];if(n=W.asArray(n),a.tree){const p=a.rootNode;return p.insertChild(n,(i=p.children)==null?void 0:i[t],r)}if(!r&&a.trigger("beforeAdd",{records:n})===!1)return null;let d,h,f;if(c[h=t]===n[0]||c[h=t-1]===n[0])for(d=!0,f=0;d&&f<n.length;f++)n[f]!==c[h+f]&&(d=!1);if(d)return null;const g=a.processRecords(n,p=>{const m=o.indexOf(p);p.children&&p.children.length&&a.autoTree&&(a.tree=!0),m>-1&&(m<t&&l&&t--,u.push(m)),p.meta.previousIndex=m});return a.suspendEvents(),a.storage.remove(u),a.resumeEvents(),r&&a.suspendEvents(),o.splice(t,0,...g),r&&a.resumeEvents(),a.autoCommit&&a.doAutoCommit(),g}move(t,n){this.isTree?n.parent.insertChild(t,n):this.storage.move(t,n)}setMultiple(t,n,r){const i=this,a=[],o=[];i.forEach(l=>{t(l)&&(o.push(l.set(n,r,!0)),a.push(l))}),i.trigger("updateMultiple",{records:a,all:i.records.length===a.length}),i.trigger("change",{action:"updatemultiple",records:a,all:i.records.length===a.length}),i.reapplyFilterOnUpdate&&i.isFiltered&&i.filter()}setAll(t,n){const r=this,i=[];r.forEach(a=>{i.push(a.set(t,n,!0))}),r.trigger("updateMultiple",{records:r.records,all:!0}),r.trigger("change",{action:"updatemultiple",records:r.records,all:!0}),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}acceptChanges(){const t=this;t.added.forEach(n=>n.clearChanges(!0,!1)),t.modified.forEach(n=>n.clearChanges(!0,!1)),t.added.clear(),t.modified.clear(),t.removed.clear()}commit(t=!1){const{changes:n}=this;return!t&&this.trigger("beforeCommit",{changes:n})===!1?!1:(this.acceptChanges(),t||this.trigger("commit",{changes:n}),n)}revertChanges(){const t=this,{changes:n}=t;if(n){const r={action:"clearchanges",changes:n};t.add(t.removed.values,!0),t.remove(t.added.values,!0),t.modified.forEach(i=>i.revertChanges(!0)),t.added.clear(),t.modified.clear(),t.removed.clear(),t.trigger("change",r),t.trigger("refresh",r)}}get changes(){const t=this,n=t.modified.values.filter(r=>r.rawModifications);return t.added.count||n.length||t.removed.count?{added:t.added.values.slice(),modified:n,removed:t.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(t){this._autoCommit=t,t&&this.changes&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(t=!0){this.suspendCount--,this.autoCommit&&t&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}},zd=e=>class extends(e||$){static get $name(){return"StoreChanges"}static get configurable(){return{applyChangesetFilterSortTarget:"changes"}}applyChangesFromStore(t){const n=this,{changes:r}=t;r&&(r.added&&n.add(r.added),r.removed&&n.remove(r.removed.map(i=>i.id)),r.modified&&r.modified.forEach(i=>{const a=n.getById(i.id);a==null||a.set(i.modifications)}))}applyChangeset(t,n=null,r="$PhantomId",i=!0,a=!1){var o,l,c,u;const d=this,{added:h,updated:f,modified:g,removed:p}=(o=n==null?void 0:n(t,d))!=null?o:t,m=(l=f!=null?f:g)!=null?l:[],y=d.modelClass.getFieldDataSource("id"),D=a?new Map:null,E=[],C=[];let v=!1,S=[];if(d._groupVisibleRecordIds=[],d.isGrouped&&d.forEach(b=>{d._groupVisibleRecordIds.push(b.id)}),(h==null?void 0:h.length)>0){const b=[],P=[];for(const w of h)d.getById((c=w[r])!=null?c:x.getPath(w,y))?b.push(w):P.push(w);m.unshift.apply(m,b);const M=(u=d.add(P,!1,{orderedParentIndex:{skip:!0}}))!=null?u:[];if(E.push(...M),d.tree)for(const w of M){const{parent:A}=w;if(A.isRoot){v=!0,S=[A];break}!A.isRoot&&S.every(T=>!T.contains(A))&&S.push(A)}for(const w of M)D==null||D.set(w.id,w.data),w.clearChanges()}if((m==null?void 0:m.length)>0)for(const b of m){const P=b[r],M=x.getPath(b,y),w=d.getById(P!=null?P:M);if(w){const A=w.applyChangeset(b,r,i);d.tree&&!v&&S.every(T=>!T.contains(w))&&(w.parent.isRoot?(v=!0,S=[w.parent]):S.push(w.parent)),D==null||D.set(M,A),C.push(w)}}if((p==null?void 0:p.length)>0&&d.applyRemovals(p),d.applyChangesetFilterSortTarget==="changes"){const b=d.filterChangeset(E,C);S.push(...b)}return d.afterChangesetApplied(S),d._groupVisibleRecordIds=null,D}afterChangesetApplied(t){t.forEach(n=>{n.traverse(r=>{r.sortOrderedChildren(!1,!1),r.children&&r.updateChildrenIndices(r.children,"parentIndex",!0),r.unfilteredChildren&&r.updateChildrenIndices(r.unfilteredChildren,"unfilteredIndex",!0)})})}applyRemovals(t){const n=this,{removed:r}=n,i=n.modelClass.idField,a=[];for(const o of t){const l=x.getPath(o,i);r.includes(l)?r.remove(l):a.push(l)}n.remove(a);for(const o of a)r.remove(o)}filterChangeset(t,n){const r=this,{isFiltered:i,tree:a,isGrouped:o,filtersFunction:l}=r,c=r.isSorted?r.createSorterFn(r.sorters):void 0,{allValues:u,addedValues:d,isSorted:h}=r.storage,f=c!=null||h?c!=null?c:r.storage.sortFunction:null,g=new Set;if(!i)return[];let p=!1,m;if(o&&(m=r.groupers,r.clearGroupers(!0)),a){const D=new Set(n.filter(l));for(const C of t.filter(l))D.add(C);D.forEach(C=>C.bubble(v=>D.add(v))),D.delete(r.rootNode);const E=W.groupBy(Array.from(D),"parentId");for(const C of Object.values(E)){const{parent:v}=C[0];v.unfilteredChildren&&(v.children.push(...C.filter(S=>!v.children.includes(S))),g.add(v))}}else if(f&&!o){const{filteredValues:D}=r.storage,E=d?D.findLastIndex(S=>!d.has(S))+1:D.length,C=D.slice(0,E),v=new Set(n.filter(l));for(const S of D)v.has(S)&&v.delete(S);for(const S of v)C.push(S);C.sort(f),D.splice(0,E,...C),p=!0}else{const D=n.filter(E=>l(E)&&!r.storage.includes(E));D.length>0&&(r.includeInSubset(u,r.storage.filteredValues,D),p=!0)}const y=new Set(t.filter(D=>!l(D)));if(y.size>0){if(a)for(const D of y)W.remove(D.parent.children,D),g.add(D.parent);else W.remove(r.storage.filteredValues,y);p=!0}return m&&(r.group(m[0],null,!1,!0,!0),p=!0),a&&g.size>0?r.storage.replaceValues({values:r.collectDescendants(r.rootNode).visible,silent:!0}):p&&(r._idMap=null,r.trigger("refresh")),[...g]}includeInSubset(t,n,r){const i=new Set(r);let a=0,o=0,l=i.size===0;for(;o<t.length&&!l;){const c=n[a];let u=t[o];for(;c!==u;)i.has(u)&&(n.splice(a,0,u),a++,i.delete(u),l=i.size===0),u=t[++o];i.has(c)&&i.delete(c),a<n.length&&a++}return n}},qd=e=>class extends(e||$){static get $name(){return"StoreFilter"}static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set reapplyFilterOnAdd(t){this.storage.autoFilter=t}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(t){const n=this,r=n.filters;if(r.clear(),n._filtersFunction=null,t){if(t.constructor.name==="Object")for(const i of Object.entries(t))i[0]==="filterBy"&&typeof i[1]=="function"?r.add(new ke({filterBy:i[1]})):r.add(new ke(i[1].constructor.name==="Object"?Object.assign({property:i[0]},i[1]):{property:i[0],value:i[1]}));else Array.isArray(t)?r.add(...t.map(i=>i instanceof ke?i:new ke(i))):t.isCollection?r.add(...t.values):r.add(new ke({filterBy:t}));r.forEach(i=>i.owner=n)}}get filters(){return this._filters||(this._filters=new os({extraKeys:["property"]}))}set filtersFunction(t){this._filtersFunction=t}get filtersFunction(){const t=this,{filters:n,isGrouped:r}=t;if(!t._filtersFunction)if(n.count){const i=ke.generateFiltersFunction(n);t._filtersFunction=a=>r&&a.isSpecialRow?a.groupChildren.some(i):i(a)}else t._filtersFunction=Et.returnTrue;return t._filtersFunction}get isFiltered(){return this.filters.values.some(t=>!t.disabled)}traverseFilter(t){const n=this,r=!t.isRoot&&n.filtersFunction(t),i=t.unfilteredChildren||t.children;return!i||!i.length?r:(t.unfilteredChildren||(t.unfilteredChildren=t.children.slice()),t.children=t.unfilteredChildren.filter(a=>n.traverseFilter(a)),t.updateChildrenIndices(t.unfilteredChildren,"unfilteredIndex",!0),t.updateChildrenIndices(t.children,"parentIndex",!0),r||!!t.children.length)}traverseClearFilter(t){const n=this;t.unfilteredChildren&&(t.children=t.orderedChildren.slice(),t.unfilteredChildren=null),t.children&&(t.children.forEach(r=>n.traverseClearFilter(r)),t.updateChildrenIndices(t.children,"parentIndex",!0))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(t,n=!1){const r=this;if(t=t instanceof ke?t:new ke(t),t.owner=r,r.filters.add(t),!n){if(r.remoteFilter)return r.filter().then(()=>t);r.filter()}return t}filter(t){const n=this;let r=!1,i;if(t){let o=typeof t;if(o==="object"&&("silent"in t||"replace"in t||t.filters)&&(r=t.silent,t.replace&&n.clearFilters(t.filters.length===0),i=t.internal,t=t.filters,o=typeof t),t){const l=n.isFiltered;if(n.isConfiguring=!0,Array.isArray(t))t.forEach(c=>n.addFilter(c,!0),n);else if(o==="function"){const c=new ke(t);c.internal=i,n.addFilter(c,!0)}else o==="string"?n.addFilter({property:t,value:arguments[1]},!0):n.addFilter(t,!0);if(n.isConfiguring=!1,!n.isFiltered&&!l)return null}}n.filtersFunction=null;const a=n.performFilter(r);return n._idMap=null,a}performFilter(t){const n=this,{storage:r,filters:i,rootNode:a}=n,o=n.count;n.trigger("beforeFilter",{filters:i});let l,c;if(n.tree){const u=r.values;n.isFiltered?n.traverseFilter(a):n.traverseClearFilter(a);const d=n.collectDescendants(a).visible;r.replaceValues({values:d,silent:!0});const h=W.delta(d,u,!0);l=h.toAdd,c=h.toRemove}else r.ion({change({removed:u,added:d}){c=u,l=d},once:!0}),n.isFiltered?(n.isGrouped&&n.includeCollapsed(),r.addFilter({id:"primary-filter",filterBy:n.filtersFunction}),n.isGrouped&&n.excludeCollapsed()):r.filters.clear();n.afterPerformFilter(t||n.isRemoteDataLoading?null:{action:"filter",filters:i,oldCount:o,added:l,removed:c,records:n.storage.values})}afterPerformFilter(t){this.resetRelationCache(),t&&this.triggerFilterEvent(t)}triggerFilterEvent(t){this.trigger("filter",t),this.remoteFilter||(this.trigger("refresh",t),this.trigger("change",t))}filterBy(t){return this.filter(t)}removeFilter(t,n=!1){const r=this,i=t instanceof ke?t:r.filters.get(t);if(i){if(r.filters.remove(i),r._filtersFunction=null,!n){if(r.remoteFilter)return r.filter().then(()=>i);r.filter()}return i}}clearFilters(t=!0){if(this.filters.remove(this.filters.values.filter(n=>!n.internal)),t)return this.filter()}convertFilterToString(t){const n=this.filters.getBy("property",t);return n&&!n.filterBy?String(n):""}doDestroy(){var t;(t=this._filters)==null||t.destroy(),super.doDestroy()}},zm={add:1,replace:1},Gd=e=>{var s;return s=class extends(e||$){static get properties(){return{collapsedGroups:new Set}}construct(t){super.construct(t),this.ion({change:"onDataChanged",thisObj:this})}updateGroupers(t){this.setGroupers(t)}setGroupers(t,n=null){const r=this,{storage:i}=r;let a;return t!=null&&t.length?r._groupers=t:r.groupers&&(delete r._groupers,r.includeCollapsed(),i.replaceValues({values:r.removeHeadersAndFooters(i._values),filteredValues:i.isFiltered?r.removeHeadersAndFooters(i._filteredValues):null,silent:!0}),a=r.group(null,null,null,!1,n==null?void 0:n.silent)),r._idMap=null,a}get groupRecords(){const t=[];if(this.isGrouped)for(const n of this)n.isSpecialRow&&t.push(n);return t}get unfilteredGroupRecords(){var t;const n=this;if(n.isGrouped){const{generation:r}=n.storage;((t=n._unfilteredGroupRecords)==null?void 0:t.generation)!==r&&(n._unfilteredGroupRecords=n.storage.allValues.filter(i=>i.isSpecialRow),n._unfilteredGroupRecords.generation=r)}return n._unfilteredGroupRecords||[]}getGroupHeaderForRecord(t,n=!1){if(this.isGrouped){let r;const i=n?this.storage._values:this.storage.values;for(const a of i)if(a.isGroupHeader){if(!t)r=a;else if(a===t||a.unfilteredGroupChildren.includes(t)){r=a;break}}return r}}includeCollapsed(){for(const t of this.collapsedGroups)this.expand(this.getById(t),!1)}excludeCollapsed(){for(const t of this.collapsedGroups)this.collapse(this.getById(t))}onDataChange({source:t,action:n,removed:r}){var i;const a=this,{groupers:o}=a;o&&(o.length?(n==="splice"&&(r!=null&&r.length)||n==="move")&&t.replaceValues({...a.prepareGroupRecords(),silent:!0}):t.replaceValues({values:a.removeHeadersAndFooters(t._values),filteredValues:t.isFiltered?a.removeHeadersAndFooters(t._filteredValues):null,silent:!0})),(i=super.onDataChange)==null||i.call(this,...arguments)}move(t,n){const r=this;if(r.isGrouped&&!r.tree){let i=n;if(n!=null&&n.isSpecialRow&&(i=r.getPrev(n,!1,!1),!i))return;const a=r.getGroupHeaderForRecord(i),o=r.groupers[0].field,l=a.meta.groupRowFor,{reapplyFilterOnUpdate:c}=r;if(r.reapplyFilterOnUpdate=!1,r.beginBatch(),t.forEach(u=>u.setValue(o,l)),r.endBatch(),r.reapplyFilterOnUpdate=c,r.isFiltered&&(n!=null&&n.isSpecialRow)){const{unfilteredGroupRecords:u}=r,d=u.indexOf(a);n=u[d+1]}}super.move(t,n)}collapse(t){return t&&!t.meta.collapsed?(this.excludeGroupRecords(t),t.meta.collapsed=!0,this.collapsedGroups.add(t.id),this.trigger("toggleGroup",{groupRecord:t,collapse:!0}),!0):!1}expand(t,n=!0){return t!=null&&t.meta.collapsed?(this.includeGroupRecords(t),t.meta.collapsed=!1,n&&this.collapsedGroups.delete(t.id),n&&this.trigger("toggleGroup",{groupRecord:t,collapse:!1}),!0):!1}removeHeadersAndFooters(t){return t.filter(n=>n.isSpecialRow?(this.unregister(n),!1):!0)}prepareGroupRecords(t){const n=this,{isFiltered:r,reapplyFilterOnUpdate:i,startGroupsCollapsed:a}=n,o=n.collapsedGroups,{allValues:l}=n.storage,c=[],u=n._groupVisibleRecordIds||[],d=C=>{const v=!r||n.filtersFunction(C);return i?v:v||u.includes(C.id)};for(const C of l)C.isGroupHeader&&(C.meta.collapsed||o.has(C.id))&&(o.add(C.id),c.push(C));for(const C of c)n.includeGroupRecords(C);const h=n.removeHeadersAndFooters(n.storage._values);t&&h.sort(t),r&&(n.filtersFunction=null);const f=[],g=n.groupers[0].field;let p=null,m=null,y=0;function D(){const C=m.meta.groupRowFor,v=`group-footer-${typeof C=="number"?C:U.createId(C)}`,S=n.getById(v)||new n.modelClass({id:v},n,{specialRow:!0,groupFooterFor:C,groupRecord:m});return S.stores=[n],n.register(S),S.groupChildren=m.groupChildren,m.meta.collapsed||f.push(S),n.allRecords.push(S),m.groupChildren.push(S),m.unfilteredGroupChildren.push(S),y++,S}h.forEach(C=>{var v;const S=C.getValue(g),b=S==null?"__novalue__":S,P=`group-header-${typeof b=="number"?b:U.createId(b)}`;if(((v=C.unfilteredGroupChildren)==null?void 0:v.length)===0){n.unregister(C);return}x.isEqual(b,p)||(m&&(n.useGroupFooters&&D(m),m.meta.childCount=y),m=n.getById(P),m||(m=new n.modelClass({id:P},n,{specialRow:!0,groupRowFor:b,groupField:g}),a&&(o.add(P),n.startGroupsCollapsed=!1)),m.meta.collapsed=o.has(P),m.stores=[n],n.register(m),m.groupChildren=[],m.unfilteredGroupChildren=[],f.push(m),n.allRecords.push(m),p=b,y=0),C.instanceMeta(n.id).groupParent=m,o.has(P)||f.push(C),d(C)&&(m.groupChildren.push(C),y++),m.unfilteredGroupChildren.push(C)}),m&&(n.useGroupFooters&&D(),m.meta.childCount=y),n._idMap=null;const E={values:f};return r&&(E.filteredValues=f.filter(d)),E}get isGrouped(){var t;return!!((t=this.groupers)!=null&&t.length)}group(t,n,r=!1,i=!0,a=!1){var o,l;const c=this;let u,d;if(t&&typeof t=="object"&&(n=t.ascending,d=t.fn,t=t.field),r?c.groupers.push(u={field:t,ascending:n,complexMapping:t.includes(".")}):t&&(n==null&&(n=((o=c.groupInfo)==null?void 0:o.field)===t&&((l=c.groupInfo)==null?void 0:l.fn)===d?!c.groupInfo.ascending:!0),c.groupInfo=u={field:t,ascending:n,fn:d,complexMapping:t.includes(".")},c.groupers=[c.groupInfo]),u){const{prototype:h}=c.modelClass;u.complexMapping&&!Object.prototype.hasOwnProperty.call(h,t)&&Object.defineProperty(h,t,{get(){return x.getPath(this,t)}})}if(i!==!1){if(c.remoteSort&&!c.isRemoteDataLoading)return c.sort(null,null,!1,!0).then(()=>c.onAfterGrouping(a));c.sort(null,null,!1,!0)}c.onAfterGrouping(a)}onAfterGrouping(t){if(t)return;const n=this,r=n.groupers||[];n.trigger("group",{isGrouped:n.isGrouped,groupers:r,records:n.storage.values}),n.trigger("refresh",{action:"group",isGrouped:n.isGrouped,groupers:r,records:n.storage.values})}addGrouper(t,n=!0){return this.group(t,n,!0)}removeGrouper(t){const n=this,{groupers:r}=n;if(!r)return;const i=r.findIndex(a=>a.field===t);if(i>-1)return r.splice(i,1),r.length?n.group():n.clearGroupers()}clearGroupers(t=!1){return this.setGroupers(null,{silent:t})}isRecordInGroup(t,n){var r;if(!this.isGrouped)return null;const i=(r=this.groupers[0])==null?void 0:r.field;return t.getValue(i)===n&&!t.isSpecialRow}isInCollapsedGroup(t){const n=t.instanceMeta(this).groupParent;return n==null?void 0:n.meta.collapsed}getGroupRecords(t){return this.isGrouped?this.storage.values.filter(n=>this.isRecordInGroup(n,t)):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0].field):null}onDataChanged({changes:t,action:n}){this.isGrouped&&(!t&&zm[n]||t&&this.groupers.some(r=>r.field in t))&&this.sort()}internalIncludeExcludeGroupRecords(t,n){const r=this,i=r.indexOf(t),a=r.allIndexOf(t),{id:o,storage:l}=r,{_filteredValues:c,_values:u}=l,{meta:d,groupChildren:h,unfilteredGroupChildren:f}=t;a===-1||d.collapsed&&!n||!d.collapsed&&n||(f.forEach(g=>g.instanceMeta(o).hiddenByCollapse=!n),n?(c&&c.splice(i+1,0,...h.filter(g=>!r.isAvailable(g))),l._values.splice(a+1,0,...f.filter(g=>!r.isAvailable(g)))):(c&&c.splice(i+1,h.length),u.splice(a+1,f.length)),l._indicesInvalid=!0,r._idMap=null)}excludeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!1)}includeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!0)}collectGroupRecords(t,n=!0){return(t?this.storage.allValues:this.storage.values).reduce((i,a)=>(a.isSpecialRow&&(n&&!a.isGroupFooter&&i.push(a),a.isGroupHeader&&i.push.apply(i,a.groupChildren)),i),[])}},F(s,"$name","StoreGroup"),F(s,"configurable",{groupers:null,useGroupFooters:!1,startGroupsCollapsed:null}),s},qm=e=>class extends(e||$){static get configurable(){return{objectify:null}}initProxy(){if(!globalThis.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(n,r){if(r in n)return n[r];if(r==="$store")return n;let i=n.getById(r);return!i&&!isNaN(parseInt(r))&&(i=n.getAt(parseInt(r))),i},set(n,r,i){return r in n||n.isDestroying?n[r]=i:n.add({[n.modelClass.idField]:r,...i}),!0},deleteProperty(n,r){return n.isDestroying?(delete n[r],!0):!!n.remove(r).length},has(n,r){if(r in n)return!0;if(r.startsWith("{")&&r.endsWith("}")){const i=U.safeJsonParse(r);r=i==null?void 0:i.id}return n.includes(r)}})}},Hd=e=>{var s;return s=class extends(e||$){initRelations(t){const n=this,r=n.modelClass.exposedRelations;t&&n.modelRelations&&n.modelRelations.forEach(i=>{var a;return(a=i.storeDetacher)==null?void 0:a.call(i)}),(!n.modelRelations||n.modelRelations.length===0||t)&&r&&(n.modelRelations=[],r==null||r.forEach(i=>{const a={...i},{foreignStore:o,relationName:l,relatedCollectionName:c}=a,u=typeof o=="string"?n[o]:o;if(a.dependentStore=n,n.modelRelations.push(a),u){a.foreignStoreProperty=a.foreignStore,a.foreignStore=u;const d=u.dependentStoreConfigs;if(d.has(n)){const h=d.get(n);if(t){const f=h.find(g=>g.relationName===l);f&&W.remove(h,f)}h.push(a)}else d.set(n,[a]);c&&u.initRelationCollection(a,n),u.count>0&&u.updateDependentStores("dataset",u.records)}}))}initRelationCollection(t,n){const r=this,i=t.relatedCollectionName,a=r.collectionStores||(r.collectionStores={});a[i]={store:n,config:t},r[i+"Store"]||(r[i+"Store"]=n),r.count>0&&r.initModelRelationCollection(i,r.records)}initModelRelationCollection(t,n){const r=this;n.forEach(i=>{i.traverse(a=>{const o=t in a?`$related${U.capitalize(t)}`:t;Object.defineProperty(a,o,{enumerable:!0,configurable:!0,get:function(){return r.getCollection(this,t)},set:function(l){return r.setCollection(this,t,l)}})})})}resetRelationCache(){this.relationCache={},this.forEach(t=>t.initRelations())}updateRecordRelationCache(t,n){n==null||n.forEach(r=>{const{config:i}=r,a=r.related?r.related.id:t.getValue(i.foreignKey);a!==void 0&&this.cacheRelatedRecord(t,a,i.relationName,a)})}getRelationCollection(t,n){var r;const i=H.asId(n);return((r=this.relationCache[t])==null?void 0:r[i])||[]}getCollection(t,n){var r;const{config:i,store:a}=this.collectionStores[n];return((r=a.relationCache[i.relationName])==null?void 0:r[t.id])||[]}setCollection(t,n,r){const{config:i,store:a}=this.collectionStores[n],o=a.relationCache[i.relationName]||(a.relationCache[i.relationName]={}),l=(o[t.id]||[]).slice(),c=[],u=[];a.suspendEvents(),l.forEach(d=>{r.includes(d)||(d[i.foreignKey]=null,a.remove(d),u.push(d))}),r.forEach(d=>{d.isModel instanceof H?d.stores.includes(a)||(a.add(d),c.push(d)):([d]=a.add(d),c.push(d)),d[i.foreignKey]=t.id}),a.resumeEvents(),u.length&&(a.trigger("remove",{records:u}),a.trigger("change",{action:"remove",records:u})),c.length&&(a.trigger("add",{records:c}),a.trigger("change",{action:"add",records:c}))}cacheRelatedRecord(t,n,r,i=null){const a=this,o=a.relationCache[r]||(a.relationCache[r]={});i!==null&&a.uncacheRelatedRecord(t,r,i),n!=null&&W.include(o[n]||(o[n]=[]),t)}uncacheRelatedRecord(t,n=null,r=null){const i=this;function a(o,l){const c=i.relationCache[o],u=c==null?void 0:c[l];if(u){const d=u.indexOf(t);d>=0&&u.splice(d,1),u.length===0&&delete c[l]}}r!=null?a(n,r):t.meta.relationCache&&Object.entries(t.meta.relationCache).forEach(([o,l])=>a(o,l==null?void 0:l.id))}updateDependentStores(t,n){this.dependentStoreConfigs.forEach(r=>{r.forEach(i=>{const{dependentStore:a,relatedCollectionName:o,relationName:l,foreignKey:c}=i,u=a.relationCache[l];if(t==="dataset"){o&&this.initModelRelationCollection(o,n),a.forEach(d=>{const h=d.initRelation(i);h&&a.cacheRelatedRecord(d,h.id,l,h.id)});return}if(t==="removeall"){a.forEach(d=>d.removeRelation(i)),delete a.relationCache[l];return}t==="add"&&o&&this.initModelRelationCollection(o,n),(t==="add"||t==="remove")&&n.forEach(d=>{const h=u==null?void 0:u[d.id];switch(t){case"remove":h&&h.forEach(f=>f.removeRelation(i));break;case"add":a.forEach(f=>{f.getValue(c)==d.id&&(f.initRelation(i),a.cacheRelatedRecord(f,d.id,l))});break}})})})}updateDependentRecordIds(t,n){var r;(r=this.dependentStoreConfigs)==null||r.forEach(i=>{i.forEach(a=>{var o;const{dependentStore:l,relationName:c,foreignKey:u}=a,d=l.relationCache[c],h=(o=d==null?void 0:d[t])==null?void 0:o.slice();h==null||h.forEach(f=>{l.cacheRelatedRecord(f,n,c,t),f.set(u,n,!1,!0)})})})}},F(s,"$name","StoreRelation"),s},Yd=e=>class extends(e||$){static get $name(){return"StoreSum"}sum(t,n=this.storage.values){return n?n.reduce((r,i)=>{if(i.isSpecialRow)return r;const a=Number(i.getValue(t));return isNaN(a)?r:r+a},0):0}min(t,n=this.storage.values){return n!=null&&n.length?n.reduce((r,i)=>{const a=i.getValue(t);return typeof(a==null?void 0:a.valueOf())==="number"&&a<r&&(r=a),r},n[0].getValue(t)):0}max(t,n=this.storage.values){return n!=null&&n.length?n.reduce((r,i)=>{const a=i.getValue(t);return typeof(a==null?void 0:a.valueOf())==="number"&&a>r&&(r=a),r},n[0].getValue(t)):0}average(t,n=this.storage.values){if(!(n!=null&&n.length))return 0;let r=0;const i=n.reduce((a,o)=>{if(o.isSpecialRow)return a;const l=parseFloat(o.getValue(t));return isNaN(l)?a:(r++,a+l)},0);return r>0?i/r:0}groupSum(t,n){return this.sum(n,this.getGroupRecords(t))}},Mo=(e,s)=>String(e).toLowerCase().includes(s),Kd={string:Mo,number:Mo,boolean:Mo,date:(e,s)=>e instanceof Date&&s instanceof Date?e-s===0:String(e.getMonth()+1).includes(s)||String(e.getDate()).includes(s)||String(e.getFullYear()).includes(s),object:(e,s)=>e===s,undefined:(e,s)=>e===s},Jd=e=>class extends(e||$){static get $name(){return"StoreSearch"}search(t,n=null,r,i){const a=this.isTree&&!i?this.rootNode.allChildren:this.getAllDataRecords(i),o=a.length,l=[];if(t==null)return[];typeof t=="string"&&(t=t.toLowerCase());let c,u,d,h,f,g;for(c=0;c<o;c++){d=a[c],u=0;for(const p of n||d.fieldNames){h=d.getValue(p),f=h instanceof Date?"date":typeof h;const m=r==null?void 0:r[u];m&&(h=m(h),f="string"),g=Kd[f],h&&(g!=null&&g(h,t))&&l.push({index:c,data:d,field:p,id:d.id}),u++}}return l}findByField(t,n,r=!1,i=!1){const a=this.getAllDataRecords(i),o=a.length,l=new Set,c=[];let u,d,h;for(n!=null&&(n=String(n).toLowerCase()),u=0;u<o;u++)if(d=a[u],h=d.getValue(t),!r||!l.has(h)){const f=h instanceof Date?"date":typeof h,g=Kd[f];(n==null&&h===n||n&&g(h,n))&&(c.push({id:d.id,index:u,data:d}),r&&l.add(h))}return c}find(t,n=!1){return this.getAllDataRecords(n).find(t)}findRecord(t,n,r=!1){const i=a=>x.isEqual(a[t],n);return this.isTree?this.query(i,r)[0]:this.getAllDataRecords(r).find(i)}query(t,n=!1){if(this.isTree){const r=[];return this.traverse(i=>{t(i)&&r.push(i)},void 0,void 0,n),r}return this.getAllDataRecords(n).filter(t)}some(t,n=!1){return this.getAllDataRecords(n).some(t)}},Qd=e=>class extends(e||$){static get $name(){return"StoreSort"}static get defaultConfig(){return{useLocaleSort:null}}static get configurable(){return{sorters:[],reapplySortersOnAdd:!1}}get isSorted(){return!!this.sorters.length||this.isGrouped}changeSorters(t){return t.map(n=>this.normalizeSorterConfig(n,!0))}updateReapplySortersOnAdd(t){this.storage.autoSort=t}sort(t,n,r=!1,i=!1){const a=this,o=a.allRecords,l=a.sorters?a.sorters.slice():[];let c=null,u;if(t)if(Array.isArray(t))a.sorters=t.map(d=>a.normalizeSorterConfig(d,typeof d=="string"?!0:n));else{const d=a.normalizeSorterConfig(t,n);r?(u=a.getCurrentSorterByField(d.field),u?(c=u.ascending,u.ascending=d.ascending):a.sorters.push(d)):a.sorters=[d]}return!i&&a.trigger("beforeSort",{sorters:a.sorters,records:o,currentSorters:l})===!1?(a.sorters=l,c!==null&&(u.ascending=c),null):a.performSort(i)}normalizeSorterConfig(t,n){var r,i,a;const o=this,l={ascending:n};if(typeof t=="object"?(x.assign(l,t),t.fn&&(delete l.fn,l.sortFn=t.fn),l.ascending=(r=t.ascending)!=null?r:n):typeof t=="function"?l.sortFn=t:l.field=t,l.ascending==null){const c=o.getCurrentSorterByField(l.field);l.ascending=c?!c.ascending:!0}if(l.sortFn==null){const c=(a=(i=o.modelClass)==null?void 0:i.$meta.fields.map[l.field])==null?void 0:a.compareItems;c&&(l.sortFn=c)}return l}getCurrentSorterByField(t){return typeof t=="string"&&this.sorters.find(n=>n.field===t)||null}addSorter(t,n=!0){return this.sort(t,n,!0)}removeSorter(t){const n=this.sorters.findIndex(r=>r.field===t||r.sortFn===t);if(n>-1)return this.sorters.splice(n,1),this.sort()}clearSorters(t=!1){if(this.sorters.length)return this.sorters.length=0,this.sort(void 0,void 0,void 0,t)}createSorterFn(t){const n=this.useLocaleSort;return(r,i)=>{for(let a=0;a<t.length;a++){const o=t[a],{field:l,ascending:c=!0,useLocaleSort:u=n}=o,d=o.fn||o.sortFn,h=c?1:-1;if(d){const p=d.call(o,r,i);if(p===0)continue;if(p!==null)return p*h}const f=r.isModel?r.getValue(l):r[l],g=i.isModel?i.getValue(l):i[l];if(f!==g){if(f==null)return-h;if(g==null)return h;if(u&&typeof f=="string"){if(u===!0)return String(f).localeCompare(g)*h;if(typeof u=="string")return String(f).localeCompare(g,u)*h;if(typeof u=="object")return String(f).localeCompare(g,u.locale,u)*h}if(f>g)return h;if(f<g)return-h}}return 0}}get sorterFn(){const t=this,{sorters:n}=t;return t.createSorterFn(t.remoteSort?[{field:"_remoteSortIndex"}]:t.isGrouped?t.groupers.concat(n):n)}performSort(t){const n=this,{rootNode:r,storage:i,sorterFn:a}=n;n.tree?(!n.isChained&&r.traverse(o=>{o.isLoaded&&o.isParent&&(o.children.sort(a),o.updateChildrenIndices(o.children,"parentIndex",!0))}),i.replaceValues({values:n.collectDescendants(r).visible,silent:!0})):n.isGrouped?i.replaceValues({...n.prepareGroupRecords(a),silent:!0}):i.replaceValues({values:i.values.sort(a),silent:!0}),n.afterPerformSort(t||n.isRemoteDataLoading)}afterPerformSort(t){if(t)return;const n=this;n._idMap=null;const r={action:"sort",sorters:n.sorters,records:n.allRecords};n.trigger("sort",r),n.trigger("refresh",r)}},Zd=()=>!0,Xd=e=>class extends(e||$){static get $name(){return"StoreChained"}static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],excludeCollapsedRecords:!0,chainSuspended:0}}static get properties(){return{chainedStores:null}}construct(t){super.construct(t);const n=this,{masterStore:r}=n,i=n.syncOrder?"sort":"";r&&(n.methodNamesToRelay.forEach(a=>n[a]=(...o)=>n.relayToMaster(a,o)),n.removeAll=(...a)=>{r.remove(n.getRange(),...a)},r.ion({changePreCommit:n.onMasterDataChangedPreCommit,change:n.onMasterDataChanged,[i]:n.onMasterDataChanged,prio:1,thisObj:n}),r.chainedStores||(r.chainedStores=[]),r.chainedStores.push(n),n.fillFromMaster())}get $master(){return this.masterStore||this}get isChained(){return!!this.masterStore}set chainedFilterFn(t){this._chainedFilterFn=this.thisObj?t.bind(this.thisObj):t}get chainedFilterFn(){return this._chainedFilterFn||Zd}get methodNamesToRelay(){const t=Array.isArray(this.doRelayToMaster),n=Array.isArray(this.dontRelayToMaster);return t&&this.doRelayToMaster.filter(r=>!n||!this.dontRelayToMaster.includes(r))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach(t=>t.fillFromMaster())}fillFromMaster(){const t=this,{masterStore:n,isTree:r}=t;let i=[];if(!t.isChained)throw new Error("fillFromMaster only allowed on chained store");if(!t.isChainSuspended){if(n.isGrouped&&n.isFiltered?n.forEach(a=>i.push(a),n,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0}):i=n.allRecords.filter(a=>!a.isSpecialRow&&t.chainedFilterFn(a)),r&&(t.idRegister={},t.internalIdRegister={},i.forEach(a=>{a.stores.includes(t)?t.register(a):a.joinStore(t)}),t.excludeCollapsedRecords)){const a=t.getChildren(t.rootNode);i=t.doIncludeExclude(a,!0)}t.isFillingFromMaster=!0,t.data=i,t.isFillingFromMaster=!1}}commitToMaster(){const t=this,n=t.masterStore;if(!t.isChained)throw new Error("commitToMaster only allowed on chained store");return n.beginBatch(),n.remove(t.removed.values),n.add(t.added.values),n.endBatch(),t.commit()}relayToMaster(t,n){return this.masterStore[t](...n)}onMasterDataChangedPreCommit(t){this.onMasterDataChanged(t),this.$masterEventhandled=!0}onMasterDataChanged({action:t,changes:n,$handled:r,isMove:i}){var a;if(this.$masterEventhandled){this.$masterEventhandled=!1;return}i&&t==="remove"||(t!=="update"||(a=this.chainedFields)!=null&&a.some(o=>o in n))&&this.fillFromMaster()}makeChained(t=Zd,n,r){return new((r==null?void 0:r.storeClass)||this.constructor)({...r||{},tree:!1,autoTree:!1,masterStore:this.$master,modelClass:this.modelClass,syncDataOnLoad:!1,chainedFilterFn:t,chainedFields:n})}chain(){return this.makeChained(...arguments)}doDestroy(){var t;(t=this.chainedStores)==null||t.forEach(n=>n.destroy()),super.doDestroy()}suspendChain(){this.chainSuspended++}resumeChain(t=!1){this.chainSuspended&&!--this.chainSuspended&&t&&this.fillFromMaster()}get isChainSuspended(){return this.chainSuspended>0}},eh=e=>class extends(e||$){static get $name(){return"StoreState"}getState(){const{sorters:t,groupers:n,filters:r}=this,i={};return t!=null&&t.length&&(i.sorters=t.map(a=>{const o=x.cleanupProperties(x.clone(a));return delete o.fn,delete o.sortFn,o})),n!=null&&n.length&&(i.groupers=n.map(a=>{const o=x.cleanupProperties(x.clone(a));return delete o.fn,o})),r!=null&&r.values.length&&(i.filters=r.values.map(a=>{const o=x.cleanupProperties(x.clone(a.config));return o.value=a.value,o.caseSensitive&&delete o.caseSensitive,o})),i}applyState(t){const n=this,{sorters:r=[],groupers:i=[],filters:a=[]}=t,{sortParamName:o,filterParamName:l}=n;n.sorters=r.filter(c=>c.field||c.sortFn&&!o),n.groupers=i.slice(),n.sort(),n.filters=a.filter(c=>c.property||c.filterBy&&!l),n.filter()}},Gm=e=>String(e).padStart(6,"0"),De=class{constructor(e){this.value=e,this._padded=null}set value(e){this._value=String(e!=null?e:"")}get value(){return this._value}static from(e){return e==null||e instanceof De?e:new De(e)}static pad(e){return e instanceof De?e.valueOf():De.split(e).map(Gm).join(".")}static split(e){let s,t;if(e||e===0)switch(typeof e){case"object":e=String(e);case"string":for(t=e.split("."),s=t.length;s-- >0;)t[s]=parseInt(t[s],10);break;case"number":t=[e];break}return t||[]}static compare(e,s){return e===s?0:!e||!s?e?1:s?-1:0:(e=De.pad(e),s=De.pad(s),e<s?-1:s<e?1:0)}append(e){const s=this.value;return De.from(s?`${s}.${e}`:e)}isEqual(e){return!De.compare(this,e)}match(e){let s=!1;if(e){const t=this.value,n=e[0]==="*",r=e.endsWith("*"),i=e.length;n===r?s=t.indexOf(n?e.substr(1,i-2):e)>-1:n?s=t.endsWith(e.substr(1)):s=t.startsWith(e.substr(0,i-1))}return s}toString(){return this.value}toJSON(){return this.toString()}valueOf(){var e;return(e=this._padded)!=null?e:this._padded=De.pad(this.value)}};De._$name="Wbs";var Hm=Object.freeze([]),Ks=Symbol("StopBranch"),th=e=>{var s;return s=class extends(e||$){get StopBranch(){return Ks}get isTree(){return this.tree||this.masterStore&&this.masterStore.tree}get leaves(){const t=this,n=[];return t.isTree?(t.traverse(r=>{r.isLeaf&&n.push(r)}),n):(t.allRecords.forEach(r=>{r.isLeaf&&n.push(r),r.traverse(i=>{i.isLeaf&&n.push(i)},!0)}),n)}async loadChildren(t){}onNodeAddChild(t,n,r,i,a=!1){var o;const l=this,c=t===l.rootNode&&t.isLoading,{storage:u}=l,{previousSibling:d}=n[0];let h;const{visible:f,all:g}=l.collectDescendants(n,void 0,void 0,{inCollapsedBranch:!(t.isExpanded(l)&&t.ancestorsExpanded(l)),applyFilter:l.isFiltered&&l.reapplyFilterOnAdd});if(!c&&g.length)for(const p of g)!l.modified.includes(p)&&!i[p.id]&&(l.removed.includes(p)?l.removed.remove(p):p.isLinked||l.added.add(p));if(c&&l.rootVisible&&(f.unshift(t),g.unshift(t)),f.length?(r===0||!d?h=u.indexOf(t):h=u.indexOf(d)+d.getDescendantCount(!0,l),u.suspendEvents(),l.storage.splice(++h,0,f),u.resumeEvents(),l._idMap=null):l._allRecords=null,l.updateDependentStores("add",n),c&&f.length){if(l.sorters.length&&l.sort(null,null,!1,!0),(o=l.afterLoadData)==null||o.call(l),!a){const p={action:"dataset",data:l._data,records:f};l.trigger("refresh",p),l.trigger("change",p)}}else if(!a){const p={action:"add",parent:t,isChild:!0,isMove:i,records:n,allRecords:g,index:h};if(l.trigger("add",p),l.trigger("change",p),Object.values(i).some(m=>m)){const m={newParent:t,records:n.filter(y=>i[y.id]),oldParents:n.map(y=>l.getById(y.meta.oldParentId))};l.trigger("move",m)}}}onNodeRemoveChild(t,n,r,i={isMove:!1,silent:!1,unfiltered:!1}){const a=this,{storage:o}=a,l=[],c=[],{isMove:u,silent:d,unfiltered:h}=i,f=h&&a.isFiltered,g=f&&t.unfilteredChildren?t.unfilteredChildren:n;if(a.collectDescendants(g,l,c,{inCollapsedBranch:!(t.isExpanded(a)&&t.ancestorsExpanded(a)),unfiltered:f}),!u){for(const p of n)p.unjoinStore(a);for(const p of c)p.stores.includes(a)&&p.unjoinStore(a),a.added.includes(p)?a.added.remove(p):p.isLinked||a.removed.add(p);a.modified.remove(c)}if(l.length?(r=o.indexOf(l[0]),r>-1&&(o.suspendEvents(),o.splice(r,l.length),o.resumeEvents(),a._idMap=null)):(r=-1,a._allRecords=null),!d&&(a.fireRemoveEventForMoveAction||!u)){const p={action:"remove",parent:t,isChild:!0,isMove:u,records:n,allRecords:c,index:r};a.trigger("remove",p),a.trigger("change",p)}return c}collectDescendants(t,n=[],r=[],i={}){var a;const o=this,{inCollapsedBranch:l=!1,unfiltered:c=!1,applyFilter:u=!1}=i,d=Array.isArray(t)?t:(a=o.getChildren(t,c))!=null?a:[];if(u)return{visible:d.flatMap(h=>this.collectVisibleNodeDescendantsFiltered(h)),all:d.flatMap(h=>h.allChildren)};for(let h=0,f=d.length,g;h<f;h++)g=d[h],l||n.push(g),r.push(g),o.collectDescendants(g,n,r,{inCollapsedBranch:l||!g.isExpanded(o),unfiltered:c});return{visible:n,all:r}}collectVisibleNodeDescendantsFiltered(t){const n=t.unfilteredChildren||t.children;if(!n||n.length===0||!t.isLeaf&&!t.isExpanded(this))return this.filtersFunction(t)?[t]:[];const r=n.flatMap(i=>this.collectVisibleNodeDescendantsFiltered(i));return r.length||this.filtersFunction(t)?[t,...r]:[]}getChildren(t,n=!1){const r=this,i=(n||r.isChained)&&t.unfilteredChildren||t.children;return i!=null&&i.length?r.isChained?i.filter(r.chainedFilterFn).sort(r.sorterFn):i:Hm}internalToggleTreeSubRecords(t,n){const r=this,{storage:i}=r,a=i.indexOf(t),o=r.doIncludeExclude(r.getChildren(t),n);if(r.isFiltered&&n&&t.unfilteredChildren&&r.updateChildrenHiddenState(t),o.length&&a!==!1){if(i.suspendEvents(),n){i.splice(a+1,0,...o);const l={action:"add",isExpand:!0,records:o,index:a+1};r.trigger("add",l),r.trigger("change",l)}else{i.splice(a+1,o.length);const l={action:"remove",isCollapse:!0,records:o,index:a+1};r.trigger("remove",l),r.trigger("change",l)}i.resumeEvents(),r._idMap=null}}updateChildrenHiddenState(t){var n;(n=t.unfilteredChildren)==null||n.forEach(r=>{r.instanceMeta(this.id).hidden=!1,r.isLeaf||this.updateChildrenHiddenState(r)})}doIncludeExclude(t,n,r=[]){const i=this,a=(t==null?void 0:t.length)||0;for(let o=0;o<a;o++){const l=t[o];if(!i.isChained||i.chainedFilterFn(l)){const c=l.instanceMeta(i.id);(n||!c.hidden)&&r.push(l),c.hidden=!n,l.isExpanded(i)&&i.doIncludeExclude(i.getChildren(l),n,r)}}return r}async toggleCollapse(t,n){const r=this,i=r.getById(t),a=i.instanceMeta(r);if(n===void 0&&(n=!a.collapsed),!a.isLoadingChildren&&!i.isLeaf&&i.isExpanded(r)===n){if(r.trigger("beforeToggleNode",{record:i,collapse:n}),a.collapsed=n,a.collapsed)return r.onNodeCollapse(i),!0;{r.onNodeExpand(i);let o=!0;if(!i.isLoaded){a.isLoadingChildren=!0;try{await r.loadChildren(i)}catch(l){a.collapsed=!0,o=!1,r.trigger("loadChildrenException",{record:i,exception:l})}finally{a.isLoadingChildren=!1}}return o}}}onNodeCollapse(t){if(t.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(t,!1)}onNodeExpand(t){if(t.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(t,!0)}transformToTree(t){const{parentIdField:n,idField:r,childrenField:i}=this.modelClass,a=new Map,o=new Set,l=[];for(const u of t){const d=u[r];d!=null&&a.set(d,u),u[n]!=null&&o.add(u[n])}const c=u=>{const d=Object.assign({},u);return d[i]=[],a.set(d.id,d),d};for(let u of t){o.has(u.id)&&!u[i]&&(u=c(u));const d=u[n];if(d!=null){let h=a.get(d);h&&(h[i]||(h=c(h)),h[i].push(u))}else u[i]?l.push(u):u[r]!=null?l.push(c(u)):l.push(u)}return l}treeify(t,n,r=!1){const{length:i}=t,a=[],o=[],l={};let c,u;for(c=0;c<i;c++){let h=t[c];h=h.field||h,t[c].call||(t[c]=f=>f[h],t[c].fieldName=h),a[c]=new Map}this.rootNode.traverse(h=>{if(u=null,h.isLeaf){for(c=0;c<i;c++){const f=(u==null?void 0:u.path)||"",g=a[c],p=t[c](h);if(p===Ks)break;const m=`${f+(p!=null&&p.isModel?p.id:p)}/`,y=U.makeValidDomId(`generated_${m}`,"_"),D=t[c].fieldName,E=g.get(y)||g.set(y,{id:y,key:p,path:m,expanded:!0,readOnly:!0,children:[],generatedParent:!0,field:D,firstGroupChild:h}).get(y);u&&!u.children.includes(E)&&u.children.push(E),u=E}u?u.children.push(h):o.push(h)}},!0),(n||r)&&a.forEach(h=>h.forEach((f,g,p)=>{n==null||n(f),r&&(f=this.createRecord(f),p.set(g,f))})),l.children=[...a[0].values(),...o];const d=h=>{h.children&&(h.children.sort((f,g)=>{if(f.isLeaf===g.isLeaf)if(f.isLeaf){let p;for(let m=0;!p&&m<i;m++){const y=t[m](f),D=t[m](g);if(y===Ks||D===Ks)return f.isLeaf<g.isLeaf?-1:f.isLeaf>g.isLeaf?1:0;p=y<D?-1:D>y?1:0}return p}else return typeof f.key=="string"&&typeof g.key=="string"?f.key.localeCompare(g.key,void 0,{numeric:!0}):f.key<g.key?-1:f.key>g.key?1:0;else return f.isLeaf<g.isLeaf?-1:f.isLeaf>g.isLeaf?1:0}),h.children.forEach(d))};return d(l),l}treeifyFlatData(t){const{childrenField:n,parentIdField:r}=this.modelClass;let i=!1,a=!0;for(const o of t){if(o.isModel||Array.isArray(o[n])){a=!1;break}o[r]!=null&&(i=!0)}return a&&i&&(t=this.transformToTree(t)),t}async indent(t){const n=this;if(t=Array.isArray(t)?t:[t],t=t.filter(r=>{let i=!!r.previousSibling;for(;i&&!r.isRoot;)i=!t.includes(r.parent),r=r.parent;return i}),t.length&&n.trigger("beforeIndent",{records:t})!==!1){t.sort((r,i)=>De.compare(r.wbsCode,i.wbsCode)),n.beginBatch();for(const r of t){const i=r.previousSibling;i.appendChild(r),n.toggleCollapse(i,!1)}n.endBatch(),n.trigger("indent",{records:t}),n.trigger("change",{action:"indent",records:t})}}async outdent(t){const n=this;if(t=Array.isArray(t)?t:[t],t=t.filter(r=>{const{parent:i}=r;let a=i&&!i.isRoot;for(;a&&!r.isRoot;)a=!t.includes(i),r=r.parent;return a}),t.length&&n.trigger("beforeOutdent",{records:t})!==!1){t.sort((r,i)=>De.compare(r.wbsCode,i.wbsCode)),n.beginBatch();for(const r of t){const{parent:i}=r,a=i.children.slice(i.children.indexOf(r)+1);i.parent.insertChild(r,i.nextSibling),r.appendChild(a),n.toggleCollapse(r,!1)}n.endBatch(),n.trigger("outdent",{records:t}),n.trigger("change",{action:"outdent",records:t})}}},F(s,"$name","StoreTree"),F(s,"StopBranch",Ks),F(s,"configurable",{transformFlatData:null,fireRemoveEventForMoveAction:Se.checkVersion("core","6.0","<")}),s},xo=class{static preWalk(e,s,t){const n=[e];let r,i;for(;n.length;)r=n.pop(),t(r),i=s(r),i&&n.push.apply(n,i.slice().reverse())}static preWalkWithParent(e,s,t){const n=[{node:e,parent:null}];for(;n.length;){const{parent:r,node:i}=n.pop();t(r,i);const a=s(i);Array.isArray(a)&&n.push(...a.slice().reverse().map(o=>({node:o,parent:i})))}}static preWalkUnordered(e,s,t){const n=[e];let r,i;for(;n.length;)r=n[n.length-1],t(r),i=s(r),i?n.splice(n.length-1,1,...i):n.length=n.length-1}static postWalk(e,s,t){const n=new Map,r=[e];let i,a;for(;r.length;)i=r[r.length-1],n.has(i)?(t(i),r.pop()):(a=s(i),a&&r.push(...a.slice().reverse()),n.set(i,i))}static prePostWalk(e,s,t,n){const r=new Map,i=[e];let a,o;for(;i.length;)a=i[i.length-1],r.has(a)?(n(a),i.pop()):(t(a),o=s(a),o&&i.push(...o.slice().reverse()),r.set(a,a))}};xo._$name="WalkHelper";var rh=e=>class extends(e||$){static get $name(){return"StoreSync"}static get configurable(){return{syncDataOnLoad:null,shouldSyncDataset:null,shouldSyncRecord:null}}syncDataset(t){var n;const r=this,{storage:i}=r,a=(n=r.shouldSyncDataset)==null?void 0:n.call(r,{data:t});if(a===!1)return;r.isSyncingDataOnLoad=!0;const{toAdd:o,toRemove:l,toMove:c,updated:u,ids:d}=r.tree?r.syncTreeDataset(t,a):r.syncFlatDataset(t,a);let{threshold:h}=r.syncDataOnLoad,f=!1;if(h&&(typeof h=="string"&&(h=parseInt(h,10)/100*r.count),f=o.length+l.length+c.length+u.length>h),r.tree){if(o.length&&r.add(o,f).forEach(m=>m.clearParentId()),c.length)for(const{parent:p,node:m,index:y}of c)r.getById(p.id).insertChild(m,y);r.remove(l,f)}else f&&r.suspendEvents(),r.remove(l),r.add(o),f&&r.resumeEvents();h&&!f&&u.forEach(({record:p,toSet:m,wasSet:y})=>r.onModelChange(p,m,y)),r.acceptChanges();const g={added:o,removed:l,updated:u,thresholdSurpassed:f};if(r.isFiltered&&!r.remoteFilter&&r.filter({silent:r.isRemoteDataLoading}),r.isGrouped)r.group(null,null,!1,!0,r.isRemoteDataLoading);else if(r.isSorted)r.remoteSort?i.replaceValues({values:i.values.sort(r.createSorterFn(r.sorters)),silent:!0}):r.sort();else if(!r.tree)i.values.some((p,m)=>p.id!==d[m])&&(i.replaceValues({values:i.values.sort((p,m)=>d.indexOf(p.id)-d.indexOf(m.id)),silent:!0}),!f&&r.afterPerformSort());else{let p=!1,m=0;xo.preWalk(r.rootNode,y=>Array.isArray(y.children)&&!p?y.children:null,y=>{y.id!==d[m++]&&(p=!0)}),p&&(r.sort((y,D)=>d.indexOf(y.id)-d.indexOf(D.id),void 0,void 0,!0),r.clearSorters(!0),!f&&r.afterPerformSort())}f&&r.trigger("refresh",{action:"batch",data:t,records:i.values,syncInfo:g}),r.isSyncingDataOnLoad=!1,r.trigger("loadSync",g)}syncFlatDataset(t,n){if(!t)return{toRemove:this.records};const r=this,{idField:i,allFields:a}=r.modelClass,o=[],l=[],c=[],u={},d=[],h=Array.isArray(n),{threshold:f,keepMissingValues:g}=r.syncDataOnLoad;let p=0;if(t.forEach(m=>{var y;m=m.isModel?m.data:m;const D=m[i],E=r.getById(D);if(!h||n.includes(D))if(E){if(((y=r.shouldSyncRecord)==null?void 0:y.call(r,{record:E,data:m}))!==!1){if(g===!1)for(const v of a)!(v.dataSource in m)&&v.dataSource in E.data&&(m[v.dataSource]=v.defaultValue);const C=E.set(m,null,!!f);C&&c.push({record:E,wasSet:C,toSet:m})}}else l.push(r.processRecord(r.createRecord(m)));E&&p++,u[D]=1,d.push(D)}),p<r.storage.totalCount)if(n)for(const m of n)u[m]||o.push(r.getById(m));else r.forEach(m=>{u[m.id]||o.push(m)});return{toAdd:l,toRemove:o,toMove:[],updated:c,ids:d}}syncTreeDataset(t){if(!t)return{toRemove:this.records};const n=this,{idField:r,parentIdField:i,childrenField:a,allFields:o}=n.modelClass,{keepMissingValues:l,threshold:c}=n.syncDataOnLoad,u=[],d=[],h=[],f=[],g=new Set,p=[];return n.transformFlatData&&(t=n.treeifyFlatData(t)),xo.preWalkWithParent({isRoot:!0,id:n.rootNode.id,children:t},m=>m.children,(m,y)=>{var D;if(m){const{id:E,node:C}=n.resolveSyncNode(y);if(C){if(((D=n.shouldSyncRecord)==null?void 0:D.call(n,{record:C,data:y}))!==!1){let v;const S=C.children;if(S!==!0&&y[a]===!0&&(C.clearChildren(),C.data[a]=C.children=!0,delete y[a],n.toggleCollapse(C,!0),v=!0),C.parent.id!==m[r]&&h.push({node:C,parent:m,index:m[a].indexOf(y)}),l===!1)for(const P of o)P.name!=="parentId"&&!(P.dataSource in y)&&P.dataSource in C.data&&(y[P.dataSource]=P.defaultValue);const b=C.set(y,null,!!c);b?f.push({record:C,wasSet:b,toSet:y}):v&&C.signalNodeChanged({[a]:{value:!0,oldValue:S}})}}else y[i]=m[r],d.push({...y,...Array.isArray(y[a])?{children:[]}:void 0});g.add(C),p.push(E)}}),g.length!==t.length&&n.traverse(m=>{g.has(m)||u.push(m)}),{toAdd:d,toRemove:u,toMove:h,updated:f,ids:p}}resolveSyncNode(t){const n=t[this.modelClass.idField],r=this.getById(n);return{id:n,node:r}}},sh=Symbol("STM_PROP"),nh=e=>class extends(e||$){static get $name(){return"StoreStm"}static get defaultConfig(){return{stm:null,ignoreRemoteChangesInSTM:!1}}get stm(){return this[sh]}set stm(t){var n;const r=this;r.stm!==t&&((n=r.stm)!=null&&n.hasStore(r)&&r.stm.removeStore(r),r[sh]=t,r.stm&&!r.stm.hasStore(r)&&r.stm.addStore(r))}add(t,n=!1,r={}){let i;const{stm:a}=this;return!this.tree&&(a!=null&&a.enabled)?(i=super.add(t,n),i!=null&&i.length&&a.onStoreModelAdd(this,i,n)):i=super.add(t,n,r),i}insert(t,n,r=!1){let i;const{stm:a}=this;if(!this.tree&&(a!=null&&a.enabled)){const o=(Array.isArray(n)?n:[n]).reduce((l,c)=>{const u=c instanceof H?this.indexOf(c):void 0;return u!==void 0&&u!==-1&&l.set(c,u),l},new Map);i=super.insert(t,n),i!=null&&i.length&&(t=this.indexOf(i[0]),a.onStoreModelInsert(this,t,i,o,r))}else i=super.insert(t,n,r);return i}remove(t,n=!1,r){let i;const{stm:a}=this;if(!this.tree&&(a!=null&&a.enabled)){const l=(Array.isArray(t)?t:[t]).map(c=>this.getById(c)).filter(c=>!!c).reduce((c,u)=>{const d=this.indexOf(u);return d!==void 0&&d!==-1&&c.set(u,d),c},new Map);i=super.remove(t,n,r),i!=null&&i.length&&a.onStoreModelRemove(this,i,l,n)}else i=super.remove(t,n,r);return i}removeAll(t){const{stm:n}=this;let r;if(n!=null&&n.enabled){const{tree:i,rootNode:a,allRecords:o}=this,l=o.length,c=i?a.children.slice():o.slice();r=super.removeAll(t),l&&this.count===0&&n.onStoreRemoveAll(this,c,t)}else r=super.removeAll(t);return r}beforeApplyChangeset(){const{stm:t,crudManager:n}=this;let r=!1,i=null;return!(n!=null&&n.applyingChangeset)&&(t!=null&&t.enabled)&&(r=!0,t.isRecording&&(i=t.stash()),this.ignoreRemoteChangesInSTM?t.disable():t.startTransaction()),{shouldResume:r,transactionId:i}}applyChangeset(t,n,r,i,a){const{shouldResume:o,transactionId:l}=this.beforeApplyChangeset(),c=super.applyChangeset(t,n,r,i,a);return this.afterApplyChangeset(o,l),c}afterApplyChangeset(t,n){if(t){const{stm:r}=this;this.ignoreRemoteChangesInSTM?r.enable():r.stopTransaction(),r.applyStash(n)}}},Ym={splice:1,clear:1},Km={includeFilteredOutRecords:!1,includeCollapsedGroupRecords:!1},To=(e,s)=>(s=s||!1,typeof s=="boolean"&&(s={includeFilteredOutRecords:s,includeCollapsedGroupRecords:!1}),s||Km),K=class extends $.mixin(Ar,kd,Vt,Tm,_m,qd,zd,Wd,Hd,Yd,Jd,Qd,Gd,Xd,eh,th,nh,rh,qm){static get $name(){return"Store"}static get properties(){return{relationCache:{},dependentStoreConfigs:new Map}}static get configurable(){return{id:!0,modelClass:H,verifyNoGeneratedIds:!0}}static get defaultConfig(){return{fields:null,autoTree:!0,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:!1,allowNoId:!0,preventSubClassingModel:null}}static get identifiable(){return{registerGeneratedId:!1}}constructor(...e){if(super(...e),this.objectify)return this.initProxy()}construct(e={}){const s=this;Object.assign(s,{added:new ci,removed:new ci,modified:new ci,idRegister:{},internalIdRegister:{},oldIdMap:{}}),e.storeId&&(e=x.assign({id:e.storeId},e)),super.construct(e),s.initRelations()}static from(e,s={},t=null){return e&&!e.isStore&&(typeof e=="string"?e=K.getStore(e):(Array.isArray(e)&&(t&&(e=e.map(n=>n.isModel?n:t(n))),e=x.assign({},s,{data:e})),e=new K(e))),e}doDestroy(){var e,s,t,n;const r=this,i=r.registeredRecords;(s=(e=r.stm)==null?void 0:e.removeStore)==null||s.call(e,r);for(let a=i.length-1,o;a>=0;a--)o=i[a],o!=null&&o.isDestroyed||o.unjoinStore(r);(t=r._storage)==null||t.destroy(),r.isChained||(n=r.rootNode)==null||n.destroy(),super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const s=this;e!=null&&e.isCollection?s._storage=e:s._storage=new os(e),s._storage.autoFilter=s.reapplyFilterOnAdd,s._storage.autoSort=s.reapplySortersOnAdd;for(const t of s._storage)t.joinStore(s);s._storage.ion({change:"onDataChange",thisObj:s})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){var e;const s=this;if(((e=s._allRecords)==null?void 0:e.generation)!==s.storage.generation){if(s.isTree){const t=s.collectDescendants(s.rootNode,void 0,void 0,{unfiltered:!0}).all;s.rootVisible&&t.unshift(s.rootNode),s._allRecords=t}else s._allRecords=s.isGrouped?s.collectGroupRecords():s.storage.allValues;s._allRecords.generation=s.storage.generation}return s._allRecords}getAllDataRecords(e){const s=this;return s.tree?e?s.allRecords:s.rootNode.allChildren:s.isGrouped?s.collectGroupRecords(e,!1):e?s.storage.allValues:s.storage.values}onIsCreatingToggle(e,s){const t=this,n=e.isPersistable&&!s;t.added[n?"add":"remove"](e),n&&(t.trigger("addConfirmed",{record:e}),t.autoCommit&&t.doAutoCommit())}joinRecordsToStore(e){const{allCount:s}=this;for(let t=0;t<e.length;t++){const n=e[t];n.setData("parentIndex",s+t-e.length),n.joinStore(this)}}onDataChange({source:e,action:s,added:t,removed:n,replaced:r,oldCount:i,items:a,from:o,to:l}){const c=this,u=Ym[s],d=u&&(t==null?void 0:t.length),h=u&&(n==null?void 0:n.length);let f,g;if(c._idMap=null,d&&c.joinRecordsToStore(t),r==null||r.forEach(([p,m])=>{p.unjoinStore(c,!0),m.joinStore(c)}),super.onDataChange(...arguments),!c.isTree){if(d){for(const p of t)c.removed.includes(p)?c.removed.remove(p):p.isLinked||c.added.add(p);f=!c.remoteFilter&&c.isFiltered&&c.reapplyFilterOnAdd,f&&c.filter({silent:!0}),g=!c.remoteSort&&c.isSorted&&c.reapplySortersOnAdd,g&&c.sort(null,null,!1,!0)}if(h){for(const p of n)p.cancelBatch(),p.unjoinStore(c),c.added.includes(p)?c.added.remove(p):!p._undoingInsertion&&!p.isCreating&&!p.isLinked&&c.removed.add(p);c.modified.remove(n),f=!c.remoteFilter&&c.isFiltered,f&&c.filter({silent:!0})}}switch(s){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(d){c.updateDependentStores("add",t);const p=t.reduce((D,E)=>{const{previousIndex:C}=E.meta;return C>-1&&C<D&&(D=C),D},t[0].meta.previousIndex),m=e.indexOf(t[0],!e.autoFilter),y={records:t,index:m};p>-1&&(y.oldIndex=p),c.trigger("add",y),c.trigger("change",Object.assign({action:"add"},y)),f&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:i,records:c.storage.allValues}),g&&c.trigger("sort",{action:"sort",sorters:c.sorters,records:c.storage.allValues})}n.length&&(c.updateDependentStores("remove",n),c.trigger("remove",{records:n}),c.trigger("change",{action:"remove",records:n})),r.length&&(c.trigger("replace",{records:r,all:c.records.length===r.length}),c.trigger("change",{action:"replace",replaced:r,all:c.records.length===r.length}));break;case"filter":(c.isGrouped||c.isSorted)&&c.performSort(!0);break;case"move":{const p=Math.min(o,l),m=Math.min(c.storage.allValues.length-1,Math.max(o,l));for(let y=c.storage.allValues,D=p;D<=m;D++)y[D].setData("parentIndex",D);c.trigger("move",{record:a[0],records:a,from:o,to:l}),c.isFiltered&&c.performFilter(),c.trigger("change",{action:s,record:a[0],records:a,from:o,to:l});break}}}onDataReplaced(e,s){var t;const n=this,{storage:r}=n,i=r.allValues,a=n.sorters.length>0;for(let l=0;l<i.length;l++)i[l].joinStore(n);if(!n.remoteFilter&&n.isFiltered&&n.filter({silent:!0}),n.remoteSort?n.isGrouped&&r.replaceValues({...n.prepareGroupRecords(),silent:!0}):(n.isGrouped&&n.group(null,null,!1,!a,!0),a&&n.sort(null,null,!1,!0)),!n.useRawData.disableDuplicateIdCheck){const{idMap:l}=n;if(Object.keys(l).length<r.values.length){const c=[];throw r.values.forEach(u=>l[u.id]?delete l[u.id]:c.push(u)),new Error(`Id collision on ${c.map(u=>u.id)}`)}}const o={action:e,data:s,records:r.values};n.updateDependentStores(e,o.records),(t=n.afterLoadData)==null||t.call(n),n.isRemoteDataLoading||n.trigger("refresh",o),n.trigger("change",o)}onModelChange(e,s,t,n,r){const i=this,a={record:e,records:[e],changes:t,batch:e.batching!=null,fromRelationUpdate:r},o=e.ignoreBag||e.isLinked?!1:i.updateModifiedBagForRecord(e);if(i.storage.onItemMutation(e,t),"id"in t){const{oldValue:l,value:c}=s.id;i.updateDependentRecordIds(l,c),i.onRecordIdChange({record:e,oldValue:l,value:c})}if(!n){if("id"in t){const{oldValue:l,value:c}=s.id;i.trigger("idChange",{store:i,record:e,oldValue:l,value:c})}i.onUpdateRecord(e,t),i.trigger("update",a),i.trigger("change",Object.assign({action:"update"},a))}i.autoCommit&&o&&i.doAutoCommit()}updateModifiedBagForRecord(e){const s=this;let t=!1;return e.isModified?!s.modified.includes(e)&&!s.added.includes(e)&&e.isPartOfStore(s)&&!e.isAutoRoot&&(e.isPhantom?s.added.add(e):s.modified.add(e),t=!0):s.modified.remove(e),t}get idMap(){const e=this,s=!e._idMap,t=e._idMap||(e._idMap={});if(s){const n=e.storage.values;for(let r,i=0,a=0;i<n.length;i++)r=n[i],t[r.id]={index:i,visibleIndex:a,record:r},r.isSpecialRow||a++;if(e.isFiltered)for(let r=0,i=e.storage._values.length;r<i;r++){const a=e.storage._values[r];a.id in t?t[a.id].unfilteredIndex=r:t[a.id]={index:-1,unfilteredIndex:r,record:a}}}return t}changeModelClass(e){const{fields:s}=this;this.originalModelClass=e;let t=e;if(s!=null&&s.length){class n extends e{static get fields(){return s}}t=n}else if(!this.preventSubClassingModel){class n extends e{}t=n}return t.initClass(),t}set storeId(e){this.id=e}get storeId(){return this.id}changeId(e,s){return super.changeId(e!==!0&&e,s)}updateId(e,s){const t=K.getById(e);t&&K.unregisterInstance(t),super.updateId(e,s)}generateAutoId(){return K.generateId("store-")}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}buildRootNode(){return{}}static getStore(e,s){if(e instanceof K)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let t;const n=e.map(r=>(r instanceof H?t=r.constructor:typeof r=="string"&&(r={text:r}),r));if(!t){class r extends H{}t=r}e={autoCreated:!0,data:n,modelClass:t,allowNoId:!0},s||(s=K)}if(s)return new s(e)}static get stores(){return K.registeredInstances}get rootNode(){return this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var s;const t=this,n=t._rootNode;e!==n&&(n&&t.clear(!0),e instanceof H?(e.instanceMeta(t).collapsed=!1,t._rootNode=e):t._rootNode=e=new t.modelClass(Object.assign({expanded:!0,[t.modelClass.idField]:`${t.id}-rootNode`},e),t,null,!0),t._tree=!0,e.isRoot=!0,e.joinStore(t),((s=e.children)!=null&&s.length||t.rootVisible)&&(e.isLoading=!0,t.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),t.trigger("rootChange",{oldRoot:n,rootNode:e}))}set data(e){this.setStoreData(e)}setStoreData(e){const s=this,{idField:t,childrenField:n}=s.modelClass;if(s.transformFlatData&&(e==null?void 0:e.length)>0&&!Object.isExtensible(e[0])&&(s.useRawData=s.useRawData||{disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1},e=x.clone(e)),s.getConfig("plugins"),s.processConfiguredListeners(),e&&!Array.isArray(e)&&(e=x.transformNamedObjectToArray(e,t)),s.tree=!s.isChained&&(s.tree||!!(s.autoTree&&(e!=null&&e.some(r=>r[n])))),e&&(s.remoteSort||s.remoteFilter))for(let r=0;r<e.length;r++)e[r]._remoteSortIndex=r;if(!s.syncDataOnLoad||!s._data){if(s._data=e,s.tree){s.transformFlatData&&(e=s.treeifyFlatData(e));const r=s.rootNode;if(r.isLoading=!0,s.clear(!0),r.appendChild(e),s.updateDependentStores("dataset",[r]),r.isLoading=!1,e.length===0){const i={action:"dataset",data:[],records:[]};s.trigger("refresh",i),s.trigger("change",i)}else s.isFiltered&&s.filter()}else s.loadData(e);s.added.clear(),s.removed.clear(),s.modified.clear()}else s.syncDataset(e)}loadData(e,s="dataset"){var t,n;const r=this,{storage:i,allowNoId:a}=r,o=r.modelClass.fieldMap.id.dataSource,l=r.find(u=>u.isCreating);l&&i.values.splice(r.records.indexOf(l),1);let c=r.verifyNoGeneratedIds;if(r.removeHeadersAndFooters(r.storage.values),r._idMap=null,r.oldIdMap={},e){if(!(e[0]instanceof H)){r.modelClass.exposeProperties(e[0]);const d=e.length,h=new Array(d);for(let f=0;f<d;f++){const g=e[f];if(!a&&g[o]==null)throw new Error(`Id required but not found on row ${f}`);c&&((n=(t=g[o])==null?void 0:t.startsWith)!=null&&n.call(t,"_generated"))&&(console.warn(`Generated id found in data: ${g[o]}. Generated ids are temporary and should be replaced with real ids by the backend`),c=!1),h[f]=r.processRecord(r.createRecord(g,!0),!0),h[f].setData("parentIndex",f)}r.clear(!0),i.replaceValues({values:h,isNewDataset:!0,silent:!0})}else r.clear(!0),i.replaceValues({values:e.slice(),isNewDataset:!0,silent:!0});l&&!i.values.includes(l)&&i.values.push(l),r._data=e,r.onDataReplaced(s,e)}else r.clear(!0),r._data=null;r.isSyncingDataOnLoad=!1}get data(){return this._data}getRange(e,s,t=!0){return(t?this.storage.allValues:this.storage.values).slice(e,s)}createRecord(e,s=!1,t=!1){return new this.modelClass(e,this,null,s,!1,t)}processRecord(e,s=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:s,value:t}){const n=this,r=n._idMap,{idRegister:i,oldIdMap:a}=n;if(n.storage._indicesInvalid=!0,a[s]=e,r&&!r[t]){const o=r[s];delete r[s],r[t]=o}n.added.changeId(s,t),n.removed.changeId(s,t),n.modified.changeId(s,t),delete i[s],i[t]=e,e.index=n.storage.indexOf(e)}onUpdateRecord(e,s){const t=this,{internalId:n}=s,{internalIdRegister:r}=t;n&&(this.storage._indicesInvalid=!0,delete r[n.oldValue],r[n.value]=e),t.reapplyFilterOnUpdate&&t.isFiltered&&t.filter()}get useRawData(){return this._useRawData}set useRawData(e){e===!0?this._useRawData={enabled:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0,disableDefaultValue:!1}:this._useRawData=e?Object.assign(e,{enabled:!0}):{enabled:!1}}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){var e;return this.storage.totalCount-(((e=this.groupRecords)==null?void 0:e.length)||0)}get count(){return this.storage.count}get allCount(){return this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,s=!1){return this.storage.getAt(e,s)}register(e){const s=this;if(!s.useRawData.disableDuplicateIdCheck){const t=s.isTree&&s.idRegister[e.id];if(t&&t!==e)throw new Error(`Id collision on ${e.id}`)}s.idRegister[e.id]=e,s.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){if(e!=null&&e.isModel){const s=e;return s.hasLinks&&!this.storage.allValues.includes(s)?s.$links.find(t=>this.storage.allValues.includes(t)):s}return this.idRegister[e]}isAvailable(e){const s=this.getById(e);return s&&this.storage.includes(s)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?this.idRegister[H.asId(e)]!=null:this.indexOf(e)>-1}indexOf(e,s=!1,t=!1){if(e!=null&&e.isModel&&!e.stores.includes(this.$store||this)){const i=e.$links.find(a=>this.storage.allValues.includes(a));return i?this.indexOf(i,s):-1}if(this.isTree)return(t?this.rootNode.allChildren:this.storage.values).indexOf(this.getById(e));const n=H.asId(e);if(n==null)return-1;const r=this.idMap[n];return r?r[s?"visibleIndex":"index"]:-1}allIndexOf(e){return this.isTree?this.allRecords.indexOf(this.getById(e)):this.storage.indexOf(e,!0)}getDistinctValues(e,s=!1){const t=this,n=[],r={};let i;return t.forEach(a=>{if(!a.isSpecialRow&&!a.isRoot){i=a.getValue(e);const o=i instanceof Date?i.getTime():i;r[o]||(n.push(i),r[o]=1)}},t,s),n}getValueCount(e,s){let t=0;return this.forEach(n=>{x.isEqual(n.getValue(e),s)&&t++}),t}set json(e){typeof e=="string"&&(e=U.safeJsonParse(e)),this.data=e}get json(){return U.safeJsonStringify(this)}get formattedJSON(){return U.safeJsonStringify(this,null,4)}toJSON(){return(this.isTree?this.rootNode.unfilteredChildren||this.rootNode.children||[]:this.allRecords).map(e=>e.toJSON())}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.project}getInlineData(e){var s;const t=[];return this.tree?(s=this.rootNode.children)==null||s.forEach(n=>t.push(n.getCurrentConfig(e))):this.forEach(n=>t.push(n.getCurrentConfig(e))),t}getCurrentConfig(e){var s;const t=super.getCurrentConfig(e),{state:n}=this;return t&&(t.data&&(t.data=this.getInlineData(e)),delete t.project,delete t.stm,delete t.asyncEvents,((s=t.modelClass)==null?void 0:s.$meta.hierarchy[t.modelClass.$meta.hierarchy.length-2])===this.constructor.defaultConfig.modelClass&&delete t.modelClass,this.tree||delete t.tree,n&&Object.assign(t,n)),t}forEach(e,s=this,t){const n=this,r=(i,a)=>{if(!i.isRoot&&!i.isSpecialRow)return e.call(s,i,a)};if(t=To(n,t),n.isTree)n.isChained&&(t={...t,sorterFn:n.sorterFn}),n.rootNode.traverseWhile(r,!1,t);else{const i=t.includeFilteredOutRecords?n.storage.allValues:n.storage.values;if(n.isGrouped&&t.includeCollapsedGroupRecords)for(let a=0;a<i.length;a++){const o=i[a],l=t.includeFilteredOutRecords?o.unfilteredGroupChildren:o.groupChildren;if(l&&o.meta.collapsed===!0)for(let c=0;c<l.length;c++){const u=l[c];if(r(u,c)===!1)return}else if(r(o,a)===!1)return}else for(let a=0;a<i.length;a++)if(r(i[a],a)===!1)return}}map(e,s=this){return this.storage.values.map(e,s)}flatMap(e,s=this){return this.storage.values.flatMap(e,s)}every(e,s=this,t){return this.storage[t?"allValues":"values"].every(e,s)}reduce(e,s=[],t=this){return t!==this&&(e=e.bind(t)),this.storage.values.reduce(e,s,t)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,s=this.rootNode,t=s===this.rootNode,n){const r=this;if(n=To(r,n),r.isTree){if(typeof s=="boolean"&&(t=s,s=r.rootNode),r.isChained){const i=e;e=a=>{r.chainedFilterFn(a)&&i(a)}}s.traverse(e,t,n)}else r.forEach(i=>i.traverse(e,!1,n),r,n)}traverseWhile(e,s=this.rootNode,t=s===this.rootNode,n){const r=this;if(n=To(r,n),r.isTree){if(typeof s=="boolean"&&(t=s,s=r.rootNode),r.isChained){const i=e;e=a=>{r.chainedFilterFn(a)&&i(a)}}s.traverseWhile(e,t,n)}else for(const i of r.storage)if(i.traverse(e,!1,n)===!1)break}getNext(e,s=!1,t=!1){const n=this,r=n.storage.values;let i=n.indexOf(e);if(i>=r.length-1)if(s)i=-1;else return null;const a=r[i+1];return t&&a&&a.isSpecialRow?n.getNext(r[i+1],s,!0):a}getPrev(e,s=!1,t=!1){const n=this,r=n.storage.values;let i=n.indexOf(e);if(i===0)if(s)i=r.length;else return null;const a=r[i-1];return t&&a&&a.isSpecialRow&&i>0?n.getPrev(r[i-1],s,!0):a}getAdjacent(e,s=!0,t=!1,n=!1){return s?this.getNext(e,t,n):this.getPrev(e,t,n)}getNextLeaf(e,s=!1){const t=this,n=t.leaves,r=t.getById(e);let i=n.indexOf(r);if(i>=n.length-1)if(s)i=-1;else return null;return n[i+1]}getPrevLeaf(e,s=!1){const t=this,n=t.leaves,r=t.getById(e);let i=n.indexOf(r);if(i===0)if(s)i=n.length;else return null;return n[i-1]}getAdjacentLeaf(e,s=!0,t=!1){return s?this.getNextLeaf(e,t):this.getPrevLeaf(e,t)}};K.initClass(),K._$name="Store";var ih=class extends O([K],e=>class extends e{}){},mt=class extends O([Ws,K],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}static get $name(){return"AbstractPartOfProjectStoreMixin"}construct(r={}){return r.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},s.construct.call(this,r)}trigger(r,i){const a=this,{asyncEvents:o,project:l}=a,c=o==null?void 0:o[r];return c&&(c===!0||c[i.action])?(s.trigger.call(a,`${r}PreCommit`,{...i}),!l||l.isEngineReady()&&!l.isWritingData?s.trigger.call(a,r,i):!a.eventsSuspended&&l&&(l.dataReadyDetacher||(l.queuedDataReadyEvents=[],l.dataReadyDetacher=l.ion({dataReady(){this.queuedDataReadyEvents.forEach(([d,h,f,g])=>{d.trigger.call(h,f,g)}),l.queuedDataReadyEvents=null,l.dataReadyDetacher(),l.dataReadyDetacher=null},once:!0})),l.queuedDataReadyEvents.push([s,a,r,i])),!0):s.trigger.call(a,r,i)}calculateProject(){return this.project}setStoreData(r){var i;this.project&&!(this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag)&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,s.setStoreData.call(this,r),this.isLoadingData=!1,(i=this.project)==null||i.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),s.doAutoCommit.call(this)}async addAsync(r,i){const a=this.add(r,i);return await this.project.commitAsync(),a}async insertAsync(r,i,a){const o=this.insert(r,i,a);return await this.project.commitAsync(),o}async loadDataAsync(r){this.data=r,await this.project.commitAsync()}performFilter(){var r;return this.project&&(this.isLoadingData||(r=this.rootNode)!=null&&r.isLoading)&&this.project.commitAsync().then(()=>this.filter()),super.performFilter(...arguments)}}return t}){},_r=class extends O([mt,bo,ih],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=0}setStoreData(r){var i;(i=this.project)==null||i.repopulateStore(this),s.setStoreData.call(this,r)}register(r){var i,a;s.register.call(this,r),!r.isRoot&&!((i=this.project)!=null&&i.graph)&&((a=this.project)==null||a.scheduleDelayedCalculation())}onModelChange(r,i,a,o,l,c){var u;!c&&!(this.syncDataOnLoad&&this.isLoadingData)&&Object.keys(a).some(d=>d!=="intervals"&&r.$entity.getField(d))&&!((u=this.project)!=null&&u.applyingSyncResponse)&&(o=!0),super.onModelChange(r,i,a,o,l,c)}}return t}){},ls=class extends O([Ws,H],e=>{const s=e.prototype;class t extends e{joinStore(r){let i=null;if(ze(r,mt)){const a=r.getProject();a&&!this.getProject()&&(this.setProject(a),i=a)}s.joinStore.call(this,r),i&&!i.isRepopulatingStores&&this.joinProject()}unjoinStore(r,i=!1){s.unjoinStore.call(this,r,i);const{project:a}=this,o=ze(r,mt)&&!r.isFillingFromMaster&&a===(r.isChained&&r.project?r.masterStore.project:r.project);a&&!a.isDestroying&&!a.isRepopulatingStores&&o&&(this.leaveProject(i),this.setProject(null)),o&&(this.graph=null)}joinProject(){}leaveProject(r=!1){}calculateProject(){const r=this.stores.find(i=>ze(i,mt)&&!!i.getProject());return r==null?void 0:r.getProject()}async setAsync(r,i,a){var o;const l=this.set(r,i,a);return await((o=this.project)==null?void 0:o.commitAsync()),l}async getAsync(r){var i;return await((i=this.project)==null?void 0:i.commitAsync()),this.get(r)}get isStmRestoring(){const r=this.getProject();return(r==null?void 0:r.isRestoringData)||(r==null?void 0:r.stm.isRestoring)||!1}}return t}){},cs=class extends O([ls,bo,ni],e=>{const s=e.prototype;class t extends e{joinProject(){var r;(r=this.project)!=null&&r.delayEnteringReplica||(this.graph&&this.graph!=this.getGraph()&&(this.graph=null),this.getGraph().addEntity(this))}leaveProject(r=!1){s.leaveProject.call(this,r);const i=this.getGraph();i==null||i.removeEntity(this),this.graph=null}getProject(){return s.getProject.call(this)}calculateProject(){const r=this.stores.find(i=>ze(i,_r)&&!!i.getProject());return r==null?void 0:r.getProject()}get graph(){var r;return(r=this.project)!=null&&r.delayEnteringReplica?null:this._graph}set graph(r){this._graph=r}}return t}){},ah=(e,s)=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()+s,e.getMilliseconds()),Oo=function(){"use strict";var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(s){"use strict";if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var i=r>=0?r:Math.max(n-Math.abs(r),0);i<n;i++)if(i in t&&t[i]===s)return i;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(s,t){s.sort(function(n,r){return+n-+r}),t&&s[0]===0&&s.push(s.shift())},e.array.next=function(s,t,n){for(var r,i=n[0]!==0,a=0,o=t.length-1;o>-1;--o){if(r=t[o],r===s)return r;if(r>s||r===0&&i&&n[1]>s){a=o;continue}break}return t[a]},e.array.nextInvalid=function(s,t,n){for(var r=n[0],i=n[1],a=t.length,o=t[a-1]===0&&r!==0?i:0,l=s,c=t.indexOf(s),u=l;l===(t[c]||o);)if(l++,l>i&&(l=r),c++,c===a&&(c=0),l===u)return;return l},e.array.prev=function(s,t,n){for(var r,i=t.length,a=n[0]!==0,o=i-1,l=0;l<i;l++){if(r=t[l],r===s)return r;if(r<s||r===0&&a&&n[1]<s){o=l;continue}break}return t[o]},e.array.prevInvalid=function(s,t,n){for(var r=n[0],i=n[1],a=t.length,o=t[a-1]===0&&r!==0?i:0,l=s,c=t.indexOf(s),u=l;l===(t[c]||o);)if(l--,l<r&&(l=i),c--,c===-1&&(c=a-1),l===u)return;return l},e.day=e.D={name:"day",range:86400,val:function(s){return s.D||(s.D=e.date.getDate.call(s))},isValid:function(s,t){return e.D.val(s)===(t||e.D.extent(s)[1])},extent:function(s){if(s.DExtent)return s.DExtent;var t=e.M.val(s),n=e.DAYS_IN_MONTH[t-1];return t===2&&e.dy.extent(s)[1]===366&&(n=n+1),s.DExtent=[1,n]},start:function(s){return s.DStart||(s.DStart=e.date.next(e.Y.val(s),e.M.val(s),e.D.val(s)))},end:function(s){return s.DEnd||(s.DEnd=e.date.prev(e.Y.val(s),e.M.val(s),e.D.val(s)))},next:function(s,t){t=t>e.D.extent(s)[1]?1:t;var n=e.date.nextRollover(s,t,e.D,e.M),r=e.D.extent(n)[1];return t=t>r?1:t||r,e.date.next(e.Y.val(n),e.M.val(n),t)},prev:function(s,t){var n=e.date.prevRollover(s,t,e.D,e.M),r=e.D.extent(n)[1];return e.date.prev(e.Y.val(n),e.M.val(n),t>r?r:t||r)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(s){return s.dc||(s.dc=Math.floor((e.D.val(s)-1)/7)+1)},isValid:function(s,t){return e.dc.val(s)===t||t===0&&e.D.val(s)>e.D.extent(s)[1]-7},extent:function(s){return s.dcExtent||(s.dcExtent=[1,Math.ceil(e.D.extent(s)[1]/7)])},start:function(s){return s.dcStart||(s.dcStart=e.date.next(e.Y.val(s),e.M.val(s),Math.max(1,(e.dc.val(s)-1)*7+1||1)))},end:function(s){return s.dcEnd||(s.dcEnd=e.date.prev(e.Y.val(s),e.M.val(s),Math.min(e.dc.val(s)*7,e.D.extent(s)[1])))},next:function(s,t){t=t>e.dc.extent(s)[1]?1:t;var n=e.date.nextRollover(s,t,e.dc,e.M),r=e.dc.extent(n)[1];t=t>r?1:t;var i=e.date.next(e.Y.val(n),e.M.val(n),t===0?e.D.extent(n)[1]-6:1+7*(t-1));return i.getTime()<=s.getTime()?(n=e.M.next(s,e.M.val(s)+1),e.date.next(e.Y.val(n),e.M.val(n),t===0?e.D.extent(n)[1]-6:1+7*(t-1))):i},prev:function(s,t){var n=e.date.prevRollover(s,t,e.dc,e.M),r=e.dc.extent(n)[1];return t=t>r?r:t||r,e.dc.end(e.date.prev(e.Y.val(n),e.M.val(n),1+7*(t-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(s){return s.dw||(s.dw=e.date.getDay.call(s)+1)},isValid:function(s,t){return e.dw.val(s)===(t||7)},extent:function(){return[1,7]},start:function(s){return e.D.start(s)},end:function(s){return e.D.end(s)},next:function(s,t){return t=t>7?1:t||7,e.date.next(e.Y.val(s),e.M.val(s),e.D.val(s)+(t-e.dw.val(s))+(t<=e.dw.val(s)?7:0))},prev:function(s,t){return t=t>7?7:t||7,e.date.prev(e.Y.val(s),e.M.val(s),e.D.val(s)+(t-e.dw.val(s))+(t>=e.dw.val(s)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(s){return s.dy||(s.dy=Math.ceil(1+(e.D.start(s).getTime()-e.Y.start(s).getTime())/e.DAY))},isValid:function(s,t){return e.dy.val(s)===(t||e.dy.extent(s)[1])},extent:function(s){var t=e.Y.val(s);return s.dyExtent||(s.dyExtent=[1,t%4?365:366])},start:function(s){return e.D.start(s)},end:function(s){return e.D.end(s)},next:function(s,t){t=t>e.dy.extent(s)[1]?1:t;var n=e.date.nextRollover(s,t,e.dy,e.Y),r=e.dy.extent(n)[1];return t=t>r?1:t||r,e.date.next(e.Y.val(n),e.M.val(n),t)},prev:function(s,t){var n=e.date.prevRollover(s,t,e.dy,e.Y),r=e.dy.extent(n)[1];return t=t>r?r:t||r,e.date.prev(e.Y.val(n),e.M.val(n),t)}},e.hour=e.h={name:"hour",range:3600,val:function(s){return s.h||(s.h=e.date.getHour.call(s))},isValid:function(s,t){return e.h.val(s)===t},extent:function(){return[0,23]},start:function(s){return s.hStart||(s.hStart=e.date.next(e.Y.val(s),e.M.val(s),e.D.val(s),e.h.val(s)))},end:function(s){return s.hEnd||(s.hEnd=e.date.prev(e.Y.val(s),e.M.val(s),e.D.val(s),e.h.val(s)))},next:function(s,t){t=t>23?0:t;var n=e.date.next(e.Y.val(s),e.M.val(s),e.D.val(s)+(t<=e.h.val(s)?1:0),t);return!e.date.isUTC&&n.getTime()<=s.getTime()&&(n=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n),t+1)),n},prev:function(s,t){return t=t>23?23:t,e.date.prev(e.Y.val(s),e.M.val(s),e.D.val(s)+(t>=e.h.val(s)?-1:0),t)}},e.minute=e.m={name:"minute",range:60,val:function(s){return s.m||(s.m=e.date.getMin.call(s))},isValid:function(s,t){return e.m.val(s)===t},extent:function(s){return[0,59]},start:function(s){return s.mStart||(s.mStart=e.date.next(e.Y.val(s),e.M.val(s),e.D.val(s),e.h.val(s),e.m.val(s)))},end:function(s){return s.mEnd||(s.mEnd=e.date.prev(e.Y.val(s),e.M.val(s),e.D.val(s),e.h.val(s),e.m.val(s)))},next:function(s,t){var n=e.m.val(s),r=e.s.val(s),i=t>59?60-n:t<=n?60-n+t:t-n,a=new Date(s.getTime()+i*e.MIN-r*e.SEC);return!e.date.isUTC&&a.getTime()<=s.getTime()&&(a=new Date(s.getTime()+(i+120)*e.MIN-r*e.SEC)),a},prev:function(s,t){return t=t>59?59:t,e.date.prev(e.Y.val(s),e.M.val(s),e.D.val(s),e.h.val(s)+(t>=e.m.val(s)?-1:0),t)}},e.month=e.M={name:"month",range:2629740,val:function(s){return s.M||(s.M=e.date.getMonth.call(s)+1)},isValid:function(s,t){return e.M.val(s)===(t||12)},extent:function(){return[1,12]},start:function(s){return s.MStart||(s.MStart=e.date.next(e.Y.val(s),e.M.val(s)))},end:function(s){return s.MEnd||(s.MEnd=e.date.prev(e.Y.val(s),e.M.val(s)))},next:function(s,t){return t=t>12?1:t||12,e.date.next(e.Y.val(s)+(t>e.M.val(s)?0:1),t)},prev:function(s,t){return t=t>12?12:t||12,e.date.prev(e.Y.val(s)-(t>=e.M.val(s)?1:0),t)}},e.second=e.s={name:"second",range:1,val:function(s){return s.s||(s.s=e.date.getSec.call(s))},isValid:function(s,t){return e.s.val(s)===t},extent:function(){return[0,59]},start:function(s){return s},end:function(s){return s},next:function(s,t){var n=e.s.val(s),r=t>59?60-n:t<=n?60-n+t:t-n,i=new Date(s.getTime()+r*e.SEC);return!e.date.isUTC&&i.getTime()<=s.getTime()&&(i=new Date(s.getTime()+(r+7200)*e.SEC)),i},prev:function(s,t,n){return t=t>59?59:t,e.date.prev(e.Y.val(s),e.M.val(s),e.D.val(s),e.h.val(s),e.m.val(s)+(t>=e.s.val(s)?-1:0),t)}},e.time=e.t={name:"time",range:1,val:function(s){return s.t||(s.t=e.h.val(s)*3600+e.m.val(s)*60+e.s.val(s))},isValid:function(s,t){return e.t.val(s)===t},extent:function(){return[0,86399]},start:function(s){return s},end:function(s){return s},next:function(s,t){t=t>86399?0:t;var n=e.date.next(e.Y.val(s),e.M.val(s),e.D.val(s)+(t<=e.t.val(s)?1:0),0,0,t);return!e.date.isUTC&&n.getTime()<s.getTime()&&(n=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n),e.h.val(n),e.m.val(n),t+7200)),n},prev:function(s,t){return t=t>86399?86399:t,e.date.next(e.Y.val(s),e.M.val(s),e.D.val(s)+(t>=e.t.val(s)?-1:0),0,0,t)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(s){return s.wm||(s.wm=(e.D.val(s)+(e.dw.val(e.M.start(s))-1)+(7-e.dw.val(s)))/7)},isValid:function(s,t){return e.wm.val(s)===(t||e.wm.extent(s)[1])},extent:function(s){return s.wmExtent||(s.wmExtent=[1,(e.D.extent(s)[1]+(e.dw.val(e.M.start(s))-1)+(7-e.dw.val(e.M.end(s))))/7])},start:function(s){return s.wmStart||(s.wmStart=e.date.next(e.Y.val(s),e.M.val(s),Math.max(e.D.val(s)-e.dw.val(s)+1,1)))},end:function(s){return s.wmEnd||(s.wmEnd=e.date.prev(e.Y.val(s),e.M.val(s),Math.min(e.D.val(s)+(7-e.dw.val(s)),e.D.extent(s)[1])))},next:function(s,t){t=t>e.wm.extent(s)[1]?1:t;var n=e.date.nextRollover(s,t,e.wm,e.M),r=e.wm.extent(n)[1];return t=t>r?1:t||r,e.date.next(e.Y.val(n),e.M.val(n),Math.max(1,(t-1)*7-(e.dw.val(n)-2)))},prev:function(s,t){var n=e.date.prevRollover(s,t,e.wm,e.M),r=e.wm.extent(n)[1];return t=t>r?r:t||r,e.wm.end(e.date.next(e.Y.val(n),e.M.val(n),Math.max(1,(t-1)*7-(e.dw.val(n)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(s){if(s.wy)return s.wy;var t=e.dw.next(e.wy.start(s),5),n=e.dw.next(e.Y.prev(t,e.Y.val(t)-1),5);return s.wy=1+Math.ceil((t.getTime()-n.getTime())/e.WEEK)},isValid:function(s,t){return e.wy.val(s)===(t||e.wy.extent(s)[1])},extent:function(s){if(s.wyExtent)return s.wyExtent;var t=e.dw.next(e.wy.start(s),5),n=e.dw.val(e.Y.start(t)),r=e.dw.val(e.Y.end(t));return s.wyExtent=[1,n===5||r===5?53:52]},start:function(s){return s.wyStart||(s.wyStart=e.date.next(e.Y.val(s),e.M.val(s),e.D.val(s)-(e.dw.val(s)>1?e.dw.val(s)-2:6)))},end:function(s){return s.wyEnd||(s.wyEnd=e.date.prev(e.Y.val(s),e.M.val(s),e.D.val(s)+(e.dw.val(s)>1?8-e.dw.val(s):0)))},next:function(s,t){t=t>e.wy.extent(s)[1]?1:t;var n=e.dw.next(e.wy.start(s),5),r=e.date.nextRollover(n,t,e.wy,e.Y);e.wy.val(r)!==1&&(r=e.dw.next(r,2));var i=e.wy.extent(r)[1],a=e.wy.start(r);return t=t>i?1:t||i,e.date.next(e.Y.val(a),e.M.val(a),e.D.val(a)+7*(t-1))},prev:function(s,t){var n=e.dw.next(e.wy.start(s),5),r=e.date.prevRollover(n,t,e.wy,e.Y);e.wy.val(r)!==1&&(r=e.dw.next(r,2));var i=e.wy.extent(r)[1],a=e.wy.end(r);return t=t>i?i:t||i,e.wy.end(e.date.next(e.Y.val(a),e.M.val(a),e.D.val(a)+7*(t-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(s){return s.Y||(s.Y=e.date.getYear.call(s))},isValid:function(s,t){return e.Y.val(s)===t},extent:function(){return[1970,2099]},start:function(s){return s.YStart||(s.YStart=e.date.next(e.Y.val(s)))},end:function(s){return s.YEnd||(s.YEnd=e.date.prev(e.Y.val(s)))},next:function(s,t){return t>e.Y.val(s)&&t<=e.Y.extent()[1]?e.date.next(t):e.NEVER},prev:function(s,t){return t<e.Y.val(s)&&t>=e.Y.extent()[0]?e.date.prev(t):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(s){return s.fd||(s.fd=s.getTime())},isValid:function(s,t){return e.fd.val(s)===t},extent:function(){return[0,3250368e7]},start:function(s){return s},end:function(s){return s},next:function(s,t){return e.fd.val(s)<t?new Date(t):e.NEVER},prev:function(s,t){return e.fd.val(s)>t?new Date(t):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(s,t){var n=t[0];return{name:"after "+s.name,range:(s.extent(new Date)[1]-n)*s.range,val:s.val,isValid:function(r,i){return this.val(r)>=n},extent:s.extent,start:s.start,end:s.end,next:function(r,i){return i!=n&&(i=s.extent(r)[0]),s.next(r,i)},prev:function(r,i){return i=i===n?s.extent(r)[1]:n-1,s.prev(r,i)}}},e.modifier.before=e.modifier.b=function(s,t){var n=t[t.length-1];return{name:"before "+s.name,range:s.range*(n-1),val:s.val,isValid:function(r,i){return this.val(r)<n},extent:s.extent,start:s.start,end:s.end,next:function(r,i){return i=i===n?s.extent(r)[0]:n,s.next(r,i)},prev:function(r,i){return i=i===n?n-1:s.extent(r)[1],s.prev(r,i)}}},e.compile=function(s){var t=[],n=0,r;for(var i in s){var a=i.split("_"),o=a[0],l=a[1],c=s[i],u=l?e.modifier[l](e[o],c):e[o];t.push({constraint:u,vals:c}),n++}t.sort(function(h,f){var g=h.constraint.range,p=f.constraint.range;return p<g?-1:p>g?1:0}),r=t[n-1].constraint;function d(h){return h==="next"?function(f,g){return f.getTime()>g.getTime()}:function(f,g){return g.getTime()>f.getTime()}}return{start:function(h,f){for(var g=f,p=e.array[h],m=1e3,y;m--&&!y&&g;){y=!0;for(var D=0;D<n;D++){var E=t[D].constraint,C=E.val(g),v=E.extent(g),S=p(C,t[D].vals,v);if(!E.isValid(g,S)){g=E[h](g,S),y=!1;break}}}return g!==e.NEVER&&(g=h==="next"?r.start(g):r.end(g)),g},end:function(h,f){for(var g,p=e.array[h+"Invalid"],m=d(h),y=n-1;y>=0;y--){var D=t[y].constraint,E=D.val(f),C=D.extent(f),v=p(E,t[y].vals,C),S;v!==void 0&&(S=D[h](f,v),S&&(!g||m(g,S))&&(g=S))}return g},tick:function(h,f){return new Date(h==="next"?r.end(f).getTime()+e.SEC:r.start(f).getTime()-e.SEC)},tickSafe:function(h,f){return h==="next"?ah(r.end(f),1):ah(r.start(f),-1)},tickStart:function(h){return r.start(h)}}},e.schedule=function(s){if(!s)throw new Error("Missing schedule definition.");if(!s.schedules)throw new Error("Definition must include at least one schedule.");for(var t=[],n=s.schedules.length,r=[],i=s.exceptions?s.exceptions.length:0,a=0;a<n;a++)t.push(e.compile(s.schedules[a]));for(var o=0;o<i;o++)r.push(e.compile(s.exceptions[o]));function l(v,S,b,P,M){var w=E(v),A=S,T=1e6,k=[],Z=[],z,re,be=[],Le=v==="next",Te,Ne=Le?0:1,Dt=Le?1:0;if(b=b?new Date(b):new Date,!b||!b.getTime())throw new Error("Invalid start date.");for(u(v,t,k,b),h(v,r,Z,b);T--&&A&&(z=C(k,w))&&!(P&&w(z,P));){if(i&&(f(v,r,Z,z),re=m(v,Z,z))){d(v,t,k,re);continue}if(M){var Dr=y(Z,w);re=D(v,t,k,z,Dr);var Es=Le?[new Date(Math.max(b,z)),re?new Date(P?Math.min(re,P):re):void 0]:[re?new Date(P?Math.max(P,re.getTime()+e.SEC):re.getTime()+e.SEC):void 0,new Date(Math.min(b,z.getTime()+e.SEC))];if(Te&&Es[Ne].getTime()===Te[Dt].getTime()?(Te[Dt]=Es[Dt],A++):(Te=Es,be.push(Te)),!re)break;d(v,t,k,re)}else be.push(Le?new Date(Math.max(b,z)):p(t,k,z,P)),g(v,t,k,z);A--}for(var jt=0,Tn=be.length;jt<Tn;jt++){var On=be[jt];be[jt]=Object.prototype.toString.call(On)==="[object Array]"?[c(On[0]),c(On[1])]:c(On)}return be.length===0?e.NEVER:S===1?be[0]:be}function c(v){if(v instanceof Date&&!isNaN(v.valueOf()))return new Date(v)}function u(v,S,b,P){for(var M=0,w=S.length;M<w;M++)b[M]=S[M].start(v,P)}function d(v,S,b,P){for(var M=E(v),w=0,A=S.length;w<A;w++)b[w]&&!M(b[w],P)&&(b[w]=S[w].start(v,P))}function h(v,S,b,P){for(var M=E(v),w=0,A=S.length;w<A;w++){var T=S[w].start(v,P);T?b[w]=[T,S[w].end(v,T)]:b[w]=e.NEVER}}function f(v,S,b,P){for(var M=E(v),w=0,A=S.length;w<A;w++)if(b[w]&&!M(b[w][0],P)){var T=S[w].start(v,P);T?b[w]=[T,S[w].end(v,T)]:b[w]=e.NEVER}}function g(v,S,b,P){for(var M=0,w=S.length;M<w;M++)if(b[M]&&b[M].getTime()===P.getTime()){const A=S[M].start(v,S[M].tick(v,P));A!==e.NEVER&&A.getTime()===b[M].getTime()?b[M]=S[M].start(v,S[M].tickSafe(v,P)):b[M]=A}}function p(v,S,b,P){for(var M,w=0,A=S.length;w<A;w++)if(S[w]&&S[w].getTime()===b.getTime()){var T=v[w].tickStart(b);if(P&&T<P)return P;(!M||T>M)&&(M=T)}return M}function m(v,S,b){for(var P=E(v),M,w=0,A=S.length;w<A;w++){var T=S[w];T&&!P(T[0],b)&&(!T[1]||P(T[1],b))&&(!M||P(T[1],M))&&(M=T[1])}return M}function y(v,S){for(var b,P=0,M=v.length;P<M;P++)v[P]&&(!b||S(b,v[P][0]))&&(b=v[P][0]);return b}function D(v,S,b,P,M){for(var w=E(v),A,T=0,k=S.length;T<k;T++){var Z=b[T];if(Z&&Z.getTime()===P.getTime()){var z=S[T].end(v,Z);if(M&&(!z||w(z,M)))return M;(!A||w(z,A))&&(A=z)}}return A}function E(v){return v==="next"?function(S,b){return!b||S.getTime()>b.getTime()}:function(S,b){return!S||b.getTime()>S.getTime()}}function C(v,S){for(var b=v[0],P=1,M=v.length;P<M;P++)v[P]&&S(b,v[P])&&(b=v[P]);return b}return{isValid:function(v){return l("next",1,v,v)!==e.NEVER},next:function(v,S,b){return l("next",v||1,S,b)},prev:function(v,S,b){return l("prev",v||1,S,b)},nextRange:function(v,S,b){return l("next",v||1,S,b,!0)},prevRange:function(v,S,b){return l("prev",v||1,S,b,!0)}}},e.setTimeout=function(s,t){var n=e.schedule(t),r;s&&i();function i(){var a=Date.now(),o=n.next(2,a);if(!o[0]){r=void 0;return}var l=o[0].getTime()-a;l<1e3&&(l=o[1]?o[1].getTime()-a:1e3),l<2147483647?r=setTimeout(s,l):r=setTimeout(i,2147483647)}return{isDone:function(){return!r},clear:function(){clearTimeout(r)}}},e.setInterval=function(s,t){if(!s)return;var n=e.setTimeout(i,t),r=n.isDone();function i(){r||(s(),n=e.setTimeout(i,t))}return{isDone:function(){return n.isDone()},clear:function(){r=!0,n.clear()}}},e.date={},e.date.timezone=function(s){e.date.build=s?function(r,i,a,o,l,c){return new Date(r,i,a,o,l,c)}:function(r,i,a,o,l,c){return new Date(Date.UTC(r,i,a,o,l,c))};var t=s?"get":"getUTC",n=Date.prototype;e.date.getYear=n[t+"FullYear"],e.date.getMonth=n[t+"Month"],e.date.getDate=n[t+"Date"],e.date.getDay=n[t+"Day"],e.date.getHour=n[t+"Hours"],e.date.getMin=n[t+"Minutes"],e.date.getSec=n[t+"Seconds"],e.date.isUTC=!s},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=e.SEC*60,e.HOUR=e.MIN*60,e.DAY=e.HOUR*24,e.WEEK=e.DAY*7,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(s,t,n,r,i,a){return e.date.build(s,t!==void 0?t-1:0,n!==void 0?n:1,r||0,i||0,a||0)},e.date.nextRollover=function(s,t,n,r){var i=n.val(s),a=n.extent(s)[1];return(t||a)<=i||t>a?new Date(r.end(s).getTime()+e.SEC):r.start(s)},e.date.prev=function(s,t,n,r,i,a){var o=arguments.length;return t=o<2?11:t-1,n=o<3?e.D.extent(e.date.next(s,t+1))[1]:n,r=o<4?23:r,i=o<5?59:i,a=o<6?59:a,e.date.build(s,t,n,r,i,a)},e.date.prevRollover=function(s,t,n,r){var i=n.val(s);return t>=i||!t?r.start(r.prev(s,r.val(s)-1)):r.start(s)},e.parse={},e.parse.cron=function(s,t){var n={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},r={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},i={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function a(D,E,C){return isNaN(D)?n[D]||null:Math.min(+D+(E||0),C||9999)}function o(D){var E={},C;for(C in D)C!=="dc"&&C!=="d"&&(E[C]=D[C].slice(0));return E}function l(D,E,C,v,S){var b=C;for(D[E]||(D[E]=[]);b<=v;)D[E].indexOf(b)<0&&D[E].push(b),b+=S||1;D[E].sort(function(P,M){return P-M})}function c(D,E,C,v){(E.d&&!E.dc||E.dc&&E.dc.indexOf(v)<0)&&(D.push(o(E)),E=D[D.length-1]),l(E,"d",C,C),l(E,"dc",v,v)}function u(D,E,C){var v={},S={};C===1?(l(E,"D",1,3),l(E,"d",n.MON,n.FRI),l(v,"D",2,2),l(v,"d",n.TUE,n.FRI),l(S,"D",3,3),l(S,"d",n.TUE,n.FRI)):(l(E,"D",C-1,C+1),l(E,"d",n.MON,n.FRI),l(v,"D",C-1,C-1),l(v,"d",n.MON,n.THU),l(S,"D",C+1,C+1),l(S,"d",n.TUE,n.FRI)),D.exceptions.push(v),D.exceptions.push(S)}function d(D,E,C,v,S,b){var P=D.split("/"),M=+P[1],w=P[0];if(w!=="*"&&w!=="0"){var A=w.split("-");v=a(A[0],b,S),S=a(A[1],b,S)||S}l(E,C,v,S,M)}function h(D,E,C,v,S,b){var P,M,w=E.schedules,A=w[w.length-1];D==="L"&&(D=v-1),(P=a(D,b,S))!==null?l(A,C,P,P):(P=a(D.replace("W",""),b,S))!==null?u(E,A,P):(P=a(D.replace("L",""),b,S))!==null?c(w,A,P,v-1):(M=D.split("#")).length===2?(P=a(M[0],b,S),c(w,A,P,a(M[1]))):d(D,A,C,v,S,b)}function f(D){return D.indexOf("#")>-1||D.indexOf("L")>0}function g(D,E){return f(D)&&!f(E)?1:D-E}function p(D){var E={schedules:[{}],exceptions:[]},C=D.replace(/(\s)+/g," ").split(" "),v,S,b,P;for(v in i)if(S=i[v],b=C[S[0]],b&&b!=="*"&&b!=="?"){P=b.split(",").sort(g);var M,w=P.length;for(M=0;M<w;M++)h(P[M],E,v,S[1],S[2],S[3])}return E}function m(D){var E=D.toUpperCase();return r[E]||E}var y=m(s);return p(t?y:"0 "+y)},e.parse.recur=function(){var s=[],t=[],n,r=s,i,a,o,l,c,u,d,h;function f(g,p,m){if(g=l?g+"_"+l:g,n||(r.push({}),n=r[0]),n[g]||(n[g]=[]),i=n[g],o){for(a=[],d=p;d<=m;d+=o)a.push(d);h={n:g,x:o,c:i.length,m}}a=c?[p]:u?[m]:a;var y=a.length;for(d=0;d<y;d+=1){var D=a[d];i.indexOf(D)<0&&i.push(D)}a=o=l=c=u=0}return{schedules:s,exceptions:t,on:function(){return a=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(g){return o=g||1,this},after:function(g){return l="a",a=[g],this},before:function(g){return l="b",a=[g],this},first:function(){return c=1,this},last:function(){return u=1,this},time:function(){for(var g=0,p=a.length;g<p;g++){var m=a[g].split(":");m.length<3&&m.push(0),a[g]=+m[0]*3600+ +m[1]*60+ +m[2]}return f("t"),this},second:function(){return f("s",0,59),this},minute:function(){return f("m",0,59),this},hour:function(){return f("h",0,23),this},dayOfMonth:function(){return f("D",1,u?0:31),this},dayOfWeek:function(){return f("d",1,7),this},onWeekend:function(){return a=[1,7],this.dayOfWeek()},onWeekday:function(){return a=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return f("dc",1,u?0:5),this},dayOfYear:function(){return f("dy",1,u?0:366),this},weekOfMonth:function(){return f("wm",1,u?0:5),this},weekOfYear:function(){return f("wy",1,u?0:53),this},month:function(){return f("M",1,12),this},year:function(){return f("Y",1970,2450),this},fullDate:function(){for(var g=0,p=a.length;g<p;g++)a[g]=a[g].getTime();return f("fd"),this},customModifier:function(g,p){var m=e.modifier[g];if(!m)throw new Error("Custom modifier "+g+" not recognized!");return l=g,a=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(g){var p=e[g];if(!p)throw new Error("Custom time period "+g+" not recognized!");return f(g,p.extent(new Date)[0],p.extent(new Date)[1]),this},startingOn:function(g){return this.between(g,h.m)},between:function(g,p){return n[h.n]=n[h.n].splice(0,h.c),o=h.x,f(h.n,g,p),this},and:function(){return n=r[r.push({})-1],this},except:function(){return r=t,n=null,this}}},e.parse.text=function(s){var t=e.parse.recur,n=0,r="",i,a={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},o={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(v,S,b,P){return{startPos:v,endPos:S,text:b,type:P}}function c(v){var S=v instanceof Array?v:[v],b=/\s+/,P,M,w,A,T,k;for(S.push(b),T=n;!P||P.type===b;){k=-1,M=r.substring(T),P=l(T,T,r.split(b)[0]);var Z,z=S.length;for(Z=0;Z<z;Z++)A=S[Z],w=A.exec(M),w&&w.index===0&&w[0].length>k&&(k=w[0].length,P=l(T,T+k,M.substring(0,k),A));P.type===b&&(T=P.endPos)}return P}function u(v){var S=c(v);return n=S.endPos,S}function d(v){for(var S=+E(v),b=y(a.through)?+E(v):S,P=[],M=S;M<=b;M++)P.push(M);return P}function h(v){for(var S=d(v);y(a.and);)S=S.concat(d(v));return S}function f(v){var S,b,P,M;y(a.weekend)?v.on(o.sun,o.sat).dayOfWeek():y(a.weekday)?v.on(o.mon,o.tue,o.wed,o.thu,o.fri).dayOfWeek():(S=E(a.rank),v.every(S),b=m(v),y(a.start)?(S=E(a.rank),v.startingOn(S),D(b.type)):y(a.between)&&(P=E(a.rank),y(a.and)&&(M=E(a.rank),v.between(P,M))))}function g(v){y(a.first)?v.first():y(a.last)?v.last():v.on(h(a.rank)),m(v)}function p(v){n=0,r=v,i=-1;for(var S=t();n<r.length&&i<0;){var b=D([a.every,a.after,a.before,a.onthe,a.on,a.of,a.in,a.at,a.and,a.except,a.also]);switch(b.type){case a.every:f(S);break;case a.after:c(a.time).type!==void 0?(S.after(E(a.time)),S.time()):c(a.fullDate).type!==void 0?(S.after(E(a.fullDate)),S.fullDate()):(S.after(E(a.rank)),m(S));break;case a.before:c(a.time).type!==void 0?(S.before(E(a.time)),S.time()):c(a.fullDate).type!==void 0?(S.before(E(a.fullDate)),S.fullDate()):(S.before(E(a.rank)),m(S));break;case a.onthe:g(S);break;case a.on:S.on(h(a.dayName)).dayOfWeek();break;case a.of:S.on(h(a.monthName)).month();break;case a.in:S.on(h(a.yearIndex)).year();break;case a.at:for(S.on(E(a.time)).time();y(a.and);)S.on(E(a.time)).time();break;case a.and:break;case a.also:S.and();break;case a.except:S.except();break;default:i=n}}return{schedules:S.schedules,exceptions:S.exceptions,error:i}}function m(v){var S=D([a.second,a.minute,a.hour,a.dayOfYear,a.dayOfWeek,a.dayInstance,a.day,a.month,a.year,a.weekOfMonth,a.weekOfYear]);switch(S.type){case a.second:v.second();break;case a.minute:v.minute();break;case a.hour:v.hour();break;case a.dayOfYear:v.dayOfYear();break;case a.dayOfWeek:v.dayOfWeek();break;case a.dayInstance:v.dayOfWeekCount();break;case a.day:v.dayOfMonth();break;case a.weekOfMonth:v.weekOfMonth();break;case a.weekOfYear:v.weekOfYear();break;case a.month:v.month();break;case a.year:v.year();break;default:i=n}return S}function y(v){var S=c(v).type===v;return S&&u(v),S}function D(v){var S=u(v);return S.type?S.text=C(S.text,v):i=n,S}function E(v){return D(v).text}function C(v,S){var b=v;switch(S){case a.time:var P=v.split(/(:|am|pm)/),M=P[3]==="pm"&&P[0]<12?parseInt(P[0],10)+12:P[0],w=P[2].trim();b=(M.length===1?"0":"")+M+":"+w;break;case a.rank:b=parseInt(/^\d+/.exec(v)[0],10);break;case a.monthName:case a.dayName:b=o[v.substring(0,3)];break;case a.fullDate:b=new Date(v.toUpperCase());break}return b}return p(s.toLowerCase())},e}();Oo.date.localTime();var Ye=Oo,Js=class extends O([ls],e=>{const s=e.prototype;class t extends e{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(this.priorityField!=null)return this.priorityField;let r=1e4+this.getCalendar().getDepth()*100,i=this.priority;return i==null&&(i=this.isRecurrent()?20:30),this.priorityField=r+i}isRecurrent(){return!!(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return!!(this.startDate&&this.endDate)}parseDateSchedule(r){let i=r;if(r&&r!==Object(r)&&(i=Ye.parse.text(r),i!==Object(i)||i.error>=0))try{i=JSON.parse(r)}catch(a){return null}return i}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const r=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=Ye.schedule(r)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if(this.recurrentEndDate==="EOD")return"EOD";const r=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=Ye.schedule(r)}}return t}){},Ao=class extends O([mt],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:Js}}}return t}){},At;(function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"})(At||(At={}));var Ve;(function(e){e[e.FullRangeIterated=0]="FullRangeIterated",e[e.StoppedByIterator=1]="StoppedByIterator",e[e.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",e[e.MaxRangeReached=3]="MaxRangeReached"})(Ve||(Ve={}));var $o=class{constructor(e){this.cacheFilledStartDate=ae,this.cacheFilledEndDate=he,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=V.Day,this.maxCacheExtendCycles=1e3,this.maxRange=5*365*24*60*60*1e3,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,s,t){e.ensureCacheFilledForInterval(s,t),this.intervalCache.includeWrappingRange(e.intervalCache,s,t)}ensureCacheFilledForInterval(e,s){const t=this.cacheFilledStartDate.getTime(),n=this.cacheFilledEndDate.getTime();if(t!==ae.getTime()){const r=e.getTime(),i=s.getTime();if(t<=r&&i<=n)return;if(i<=t)s=new Date(t-1);else if(r>=n)e=new Date(n);else if(t<=r&&r<=n)e=new Date(n+1);else if(t<=i&&i<=n)s=new Date(t-1);else{this.ensureCacheFilledForInterval(e,new Date(t-1)),this.ensureCacheFilledForInterval(new Date(n+1),s);return}}(t===ae.getTime()||e.getTime()<n)&&(this.cacheFilledStartDate=e),(n===he.getTime()||n<s.getTime())&&(this.cacheFilledEndDate=s),this.fillCache(e,s)}fillCache(e,s){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=ae,this.cacheFilledEndDate=he,this.intervalCache.clear()}forEachAvailabilityInterval(e,s,t){var n;t=t||this;const r=e.startDate,i=e.endDate,a=r&&r.getTime(),o=i&&i.getTime(),l=(n=e.maxRange)!=null?n:this.maxRange,c=e.isForward!==!1;if(c?!r:!i)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const u=this.intervalCache;let d=c?r:i,h=c?r:i;const f=h.getTime();for(let g=1;g<this.maxCacheExtendCycles;g++){c?this.ensureCacheFilledForInterval(d,i||R.add(d,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(r||R.add(d,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),d);let p=u.getIntervalOf(h,c?At.Left:At.Right);for(;p;){const m=p.startDate,y=p.endDate;if(c&&o&&m.getTime()>=o||!c&&a&&y.getTime()<=a)return Ve.FullRangeIterated;if(c&&m.getTime()-f>=l||!c&&f-y.getTime()>=l)return Ve.MaxRangeReached;if(c&&m.getTime()>=this.cacheFilledEndDate.getTime()||!c&&y.getTime()<=this.cacheFilledStartDate.getTime())break;h=c?y:m;const D=a&&m.getTime()<a?r:m,E=o&&y.getTime()>o?i:y;if(s.call(t,D,E,p.cacheInterval)===!1)return Ve.StoppedByIterator;p=c?u.getNextInterval(p):u.getPrevInterval(p)}if(c&&h.getTime()===ae.getTime()||!c&&h.getTime()===he.getTime())return Ve.FullRangeIterated;d=c?this.cacheFilledEndDate:this.cacheFilledStartDate}return Ve.MaxCacheExtendCyclesReached}},us=e=>Array.from(new Set(e)),ui=class{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(this.intervals.indexOf(e)==-1){const s=this.intervals.slice();return s.push(e),new ui({intervals:s,calendar:this.calendar})}else return this}combineWith(e){return new ui({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(this.isWorking!=null)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const s=us(e);return s.sort((t,n)=>n.getPriorityField()-t.getPriorityField()),s}},Qs=(e,s,t=(n,r)=>n-r)=>{let n=0,r=s.length;for(;n<r;){const i=(n+r)/2|0,a=t(e,s[i]);if(a===0)return{found:!0,index:i};a<0?r=i:n=i+1}return{found:!1,index:r}},Fr;(function(e){e[e.Exact=0]="Exact",e[e.Next=1]="Next"})(Fr||(Fr={}));var oh=class{constructor(e){this.keys=[],this.values=[],this.comparator=e||((s,t)=>s-t)}set(e,s){const t=Qs(e,this.keys,this.comparator);return t.found?this.values[t.index]=s:(this.keys.splice(t.index,0,e),this.values.splice(t.index,0,s)),t.index}insertAt(e,s,t){this.keys.splice(e,0,s),this.values.splice(e,0,t)}setValueAt(e,s){this.values[e]=s}get(e){const s=Qs(e,this.keys,this.comparator);return s.found?this.values[s.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const s=Qs(e,this.keys,this.comparator);s.found&&this.deleteAt(s.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const s=Qs(e,this.keys,this.comparator);return{found:s.found?Fr.Exact:Fr.Next,index:s.index}}map(e){const s=this.keys,t=this.values,n=[];for(let r=0;r<s.length;r++)n.push(e(t[r],s[r],r));return n}getAllEntries(){return this.map((e,s)=>({value:e,key:s}))}clear(){this.keys.length=0,this.values.length=0}},_o=class{constructor(e){if(this.points=new oh((s,t)=>s.getTime()-t.getTime()),this.leftInfinityKey=he,this.rightInfinityKey=ae,Object.assign(this,e),this.emptyInterval===void 0||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,s=At.Left){let{found:t,index:n}=this.indexOf(e),r;return s===At.Left?r=t===Fr.Exact?n:n-1:r=n-1,this.getIntervalWithStartDateIndex(r)}getPrevInterval(e){return e.startDateIndex===0?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,s,t){const n=this.points,{found:r,index:i}=n.indexOfKey(e);let a,o;if(r==Fr.Exact){const l=t(o=n.getValueAt(i));n.setValueAt(i,l),a=i+1}else{const l=t(o=n.getValueAt(i-1));n.insertAt(i,e,l),a=i+1}for(;a<n.size()&&!(n.getKeyAt(a).getTime()>=s.getTime());){const c=t(o=n.getValueAt(a));n.setValueAt(a,c),a++}a===n.size()?n.insertAt(n.size(),s,this.emptyInterval):n.getKeyAt(a).getTime()===s.getTime()||n.insertAt(a,s,o)}includeWrappingRange(e,s,t){let n=e.getIntervalOf(s);for(;n&&(this.addInterval(n.startDate,n.endDate,r=>this.combineIntervalsFn(r,n.cacheInterval)),!(n.endDate.getTime()>t.getTime()));)n=e.getNextInterval(n)}getSummary(){return this.points.map((e,s)=>({label:e,date:s}))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}},Jm=class extends Array{constructor(e,s){super(),this.timeZone=e,this.year=s}},Qm=class{constructor(e,s){this.asString=e,this.timeZone=s,this.asArray=Xm(e)}get asLocalDate(){return this._asLocalDate||(this._asLocalDate=new Date(...this.asArray)),this._asLocalDate}get asTicksUtc(){return this._asTicksUtc||(this._asTicksUtc=new Date(Date.UTC(...this.asArray)).getTime()),this._asTicksUtc}},lh=(e,s)=>{const t=e.toLocaleString("sv-SE",{timeZone:s});return new Qm(t,s)},Zm=(e,s)=>{const{asTicksUtc:t,asString:n}=lh(new Date(e),s);return{offset:(e-t)/6e4,tzTicksUtc:t,tzString:n}},Xm=e=>{const s=e.split(/[\s-:]/).map(t=>t*1);return s[1]-=1,s},ev=-6e4,tv=36e5,ch=-864e5,Zs=2592e6,uh=(e,s)=>{const t=dh.get(e,s);if(t)return t;const n=new Jm(e,s),r=new Date(Date.UTC(s,0,1)).getTime();let i=r,a=Zs,o=0,l=[],c=null,u,d,h,f;for(;!f;)({offset:h,tzTicksUtc:u,tzString:d}=Zm(i,e)),c==null?(c=h,n.push({offset:h})):a>0&&h!==c?a=a===Zs?ch:ev:a<0&&h===c&&(a===ch?a=tv:(n.length===1?(n.push(l),c=l.offset):(n[0].startTicks=l.startTicks,n[0].startDateString=l.startDateString,f=!0),a=Zs)),l={offset:h,startDateString:d,startTicks:u},a===Zs&&(i=r,i+=o*Zs,o+=1),i+=a,o>11&&(f=!0);return dh.set(n),n},dh={_cache:{},get(e,s){var t;return(t=this._cache[e])==null?void 0:t[s]},set(e){const{timeZone:s}=e,{_cache:t}=this;t[s]||(t[s]={}),t[s][e.year]=e}},vt=class{static get $name(){return"TimeZoneHelper"}static toTimeZone(e,s){if(typeof s=="number")return this.toUtcOffset(e,s);const t=lh(e,s);return t.asArray[3]!==t.asLocalDate.getHours()&&console.warn("Incorrect time zone conversion due to local DST-switch detected"),t.asLocalDate}static fromTimeZone(e,s){if(typeof s=="number")return this.fromUtcOffset(e,s);const t=this.dateAsArray(e),n=uh(s,e.getUTCFullYear());let r=n[0].offset;if(n.length===2){const i=Date.UTC(...t);i>=n[1].startTicks&&i<n[0].startTicks&&(r=n[1].offset)}return t[4]+=r,new Date(Date.UTC(...t))}static toUtcOffset(e,s){const t=e.getTimezoneOffset()+s;return new Date(e.getTime()+t*60*1e3)}static fromUtcOffset(e,s){const t=-e.getTimezoneOffset()-s;return new Date(e.getTime()+t*60*1e3)}static dateAsArray(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}};vt.findOffsetDates=uh,vt._$name="TimeZoneHelper";var hh=class extends $o{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new _o({emptyInterval:new ui({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(s,t)=>s.combineWith(t)})}fillCache(e,s){var t;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,s);const n=e.getTime(),r=s.getTime(),i=this.calendar.ignoreTimeZone?null:(t=this.calendar.project)==null?void 0:t.timeZone;if(n>r)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval(a=>{const o=a.getStartDateSchedule(),l=a.getEndDateSchedule();let c=o.prev(1,e),u;if(l==="EOD"){const f=o.next(1,s);f!==Ye.NEVER?u=R.getStartOfNextDay(f,!0):u=Ye.NEVER}else u=l.next(1,s);if(c!==Ye.NEVER&&c.getTime()===n){const f=o.prev(2,e);f!==Ye.NEVER&&f.length===2&&(c=f[1])}if(u!==Ye.NEVER&&u.getTime()===r){const f=l.next(2,s);f!==Ye.NEVER&&f.length===2&&(u=f[1])}const d=o.next(1/0,c!==Ye.NEVER?c:e,u!==Ye.NEVER?new Date(u.getTime()-1):s);if(d===Ye.NEVER)return;const h=l==="EOD"?d.map(f=>R.getStartOfNextDay(f,!0)):l.next(1/0,new Date(d[0].getTime()+1),u!==Ye.NEVER?u:s);h!==Ye.NEVER&&(h.length>d.length?h.length=d.length:h.length<d.length&&(d.length=h.length),d.forEach((f,g)=>{let p=f,m=h[g];i!=null&&(p=vt.toTimeZone(p,i),m=vt.toTimeZone(m,i)),this.intervalCache.addInterval(p,m,y=>y.includeInterval(a))}))})}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval(e=>{var s;const t=(s=this.calendar.project)==null?void 0:s.timeZone;let{startDate:n,endDate:r}=e;t!=null&&(n=vt.toTimeZone(n,t),r=vt.toTimeZone(r,t)),this.intervalCache.addInterval(n,r,i=>i.includeInterval(e))})}forEachStaticInterval(e){this.intervalStore.forEach(s=>{s.isStatic()&&e(s)})}forEachRecurrentInterval(e){this.intervalStore.forEach(s=>{s.isRecurrent()&&e(s)})}},fh=class extends O([Js],e=>{const s=e.prototype;class t extends e{getCalendar(){return this.calendar}getPriorityField(){return this.priorityField!=null?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}return t}){},Fo=class extends O([ls],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls"]}get intervalStoreClass(){return Ao}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(r){r.storeClass=this.intervalStoreClass,r.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,r.calendar=this}processIntervalsStoreData(r){this.bumpVersion()}isDefault(){const r=this.getProject();return r?this===r.defaultCalendar:!1}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(r,i,a){var o;const l=(o=this.getProject())==null?void 0:o.maxCalendarRange;return l&&(r=Object.assign({maxRange:l},r)),this.calendarCache.forEachAvailabilityInterval(r,i,a)}accumulateWorkingTime(r,i,a){var o,l;if(i===0)return{finalDate:new Date(r),remainingDurationInMs:0};if(isNaN(i))throw new Error("Invalid duration");let c=r;const u=(l=(o=this.getProject())==null?void 0:o.adjustDurationToDST)!=null?l:!1;return this.forEachAvailabilityInterval(a?{startDate:r,isForward:!0}:{endDate:r,isForward:!1},(d,h,f)=>{let g=!0;if(f.getIsWorking()){let p=h.getTime()-d.getTime();if(i<=p){if(u){const m=a?d.getTimezoneOffset()-new Date(d.getTime()+i).getTimezoneOffset():new Date(h.getTime()-i).getTimezoneOffset()-h.getTimezoneOffset();i-=m*60*1e3}c=a?new Date(d.getTime()+i):new Date(h.getTime()-i),i=0,g=!1}else{if(u){const m=d.getTimezoneOffset()-h.getTimezoneOffset();p+=m*60*1e3}c=a?h:d,i-=p}}return g}),{finalDate:new Date(c),remainingDurationInMs:i}}calculateDurationMs(r,i,a=!1){let o=0;const l=r.getTime()<=i.getTime()||!a?1:-1;l<0&&([r,i]=[i,r]);const c=this.getProject().adjustDurationToDST;return this.forEachAvailabilityInterval({startDate:r,endDate:i},(u,d,h)=>{if(h.getIsWorking()&&(o+=d.getTime()-u.getTime(),c)){const f=u.getTimezoneOffset()-d.getTimezoneOffset();o+=f*60*1e3}}),o*l}calculateEndDate(r,i){const a=i>=0,o=this.accumulateWorkingTime(r,Math.abs(i),a);return o.remainingDurationInMs===0?o.finalDate:null}calculateStartDate(r,i){const a=i<=0,o=this.accumulateWorkingTime(r,Math.abs(i),a);return o.remainingDurationInMs===0?o.finalDate:null}skipNonWorkingTime(r,i=!0){let a;const o=this.forEachAvailabilityInterval(i?{startDate:r,isForward:!0}:{endDate:r,isForward:!1},(l,c,u)=>{if(u.getIsWorking())return a=i?l:c,!1});return o===Ve.MaxRangeReached||o===Ve.FullRangeIterated?"empty_calendar":a?new Date(a):new Date(r)}addInterval(r){return this.addIntervals([r])}addIntervals(r){return this.bumpVersion(),this.intervalStore.add(r)}removeInterval(r){return this.removeIntervals([r])}removeIntervals(r){return this.bumpVersion(),this.intervalStore.remove(r)}clearIntervals(r){return r||this.bumpVersion(),this.intervalStore.removeAll(r)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(this.$calendarCache!==void 0)return this.$calendarCache;const r=new fh({isWorking:this.unspecifiedTimeIsWorking});return r.calendar=this,this.$calendarCache=new hh({calendar:this,unspecifiedTimeInterval:r,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse(r=>{r.intervalStore.forEach(i=>i.resetPriority())})}insertChild(r,i,a){let o=s.insertChild.call(this,...arguments);return Array.isArray(o)||(o=[o]),o.forEach(l=>{l.bumpVersion(),l.resetPriorityOfAllIntervals()}),o}joinProject(){s.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){s.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(r){const i=R.clearTime(r),a=R.getNext(r,V.Day);let o=!1;return this.forEachAvailabilityInterval({startDate:i,endDate:a,isForward:!0},(l,c,u)=>(o=u.getIsWorking(),!o)),!o}getDailyHolidaysRanges(r,i){const a=[];for(r=R.clearTime(r);r<i;)this.isDayHoliday(r)&&a.push({startDate:r,endDate:R.getStartOfNextDay(r,!0,!0)}),r=R.getNext(r,V.Day);return a}getWorkingTimeRanges(r,i){const a=[];return this.forEachAvailabilityInterval({startDate:r,endDate:i,isForward:!0},(o,l,c)=>{if(c.getIsWorking()){const u=c.intervals[0];a.push({name:u.name,startDate:o,endDate:l})}}),a}getNonWorkingTimeRanges(r,i){const a=[];return this.forEachAvailabilityInterval({startDate:r,endDate:i,isForward:!0},(o,l,c)=>{if(!c.getIsWorking()){const u=c.intervals[0];a.push({name:u.name,iconCls:u.iconCls,cls:u.cls,startDate:o,endDate:l})}}),a}isWorkingTime(r,i,a){if(a){let o;const l=this.forEachAvailabilityInterval({startDate:r,endDate:i,isForward:!0},(c,u,d)=>{if(d.getIsWorking()&&c<=r&&u>=i)return o=!0,!1});return l===Ve.MaxRangeReached||l===Ve.FullRangeIterated?!1:o}else{const o=this.skipNonWorkingTime(r);return o&&o!=="empty_calendar"?i?o<i:o.getTime()===r.getTime():!1}}}return t}){},Xs=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},jo=Symbol("EmptyCalendarSymbol"),ds=class extends O([Fo,cs],e=>{class s extends e{constructor(){super(...arguments),this.version=1}leaveProject(){this.project.clearCombinationsWith(this),super.leaveProject()}}return Xs([N({},{persistent:!1})],s.prototype,"version",void 0),Xs([N({type:"boolean",defaultValue:!0})],s.prototype,"unspecifiedTimeIsWorking",void 0),Xs([N()],s.prototype,"intervals",void 0),s}){},gh=class extends gt($){static get $name(){return"EmptyCalendarEffectDescription"}static getDescription(e){const s=e.getCalendar();return pt(this.L("L{descriptionTpl}"),s.name||s.id)}},en=class extends Vs{constructor(){super(...arguments),this.handler=jo}getResolutions(){const e=this.getCalendar();return this._resolutions||(this._resolutions=[ph.new({calendar:e}),mh.new({calendar:e})])}getCalendar(){const{calendars:e}=this;if((e==null?void 0:e.length)>1){for(const s of e)if(!(s.skipNonWorkingTime(this.date,this.isForward)instanceof Date))return s}return e[0]}};Xs([G("emptyCalendar")],en.prototype,"type",void 0),Xs([G(gh)],en.prototype,"_descriptionBuilderClass",void 0);var ko=class extends gt(Bs){static get $name(){return"BaseEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{intervals:[{isWorking:!0}]}}}getDescription(){const{calendar:e}=this;return pt(this.L("L{descriptionTpl}"),e.name||e.id)}fixCalendarData(e){var s;e.clearIntervals(!0),Object.assign(e,this.calendarData),(s=e.intervals)!=null&&s.length&&e.addIntervals(e.intervals)}resolve(){const{calendar:e}=this;this.fixCalendarData(e)}},ph=class extends ko{static get $name(){return"Use24hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"on Mon at 0:00",recurrentEndDate:"on Sat at 0:00",isWorking:!0}]}}}},mh=class extends ko{static get $name(){return"Use8hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"every weekday at 08:00",recurrentEndDate:"every weekday at 12:00",isWorking:!0},{recurrentStartDate:"every weekday at 13:00",recurrentEndDate:"every weekday at 17:00",isWorking:!0}]}}}},vh=class extends za{collectInfo(e,s,t){e(Fn(s))!=null&&this.addPreviousValueFlag(t),e(_c(s))&&this.addProposedValueFlag(t)}},Ke;(function(e){e.KeepDuration="KeepDuration",e.KeepStartDate="KeepStartDate",e.KeepEndDate="KeepEndDate"})(Ke||(Ke={}));var J=Symbol("StartDate"),Q=Symbol("EndDate"),te=Symbol("Duration"),Je=fe.new({output:J,inputs:new Set([te,Q])}),Qe=fe.new({output:Q,inputs:new Set([te,J])}),Ze=fe.new({output:te,inputs:new Set([J,Q])}),Lo=Xt.new({variables:new Set([J,Q,te]),formulas:new Set([Je,Qe,Ze])}),yh=Fe.new({description:Lo,defaultResolutionFormulas:new Set([Qe])}),Sh=Fe.new({description:Lo,defaultResolutionFormulas:new Set([Je])}),No=class extends vh{addInstruction(e){e===Ke.KeepStartDate&&this.addKeepIfPossibleFlag(J),e===Ke.KeepEndDate&&this.addKeepIfPossibleFlag(Q),e===Ke.KeepDuration&&this.addKeepIfPossibleFlag(te)}},Bo=class extends ut.mix(Mt){equality(e,s){const t=e.resolution,n=s.resolution;return t.get(J)===n.get(J)&&t.get(Q)===n.get(Q)&&t.get(te)===n.get(te)||t.get(J)===Be&&t.get(Q)===Be&&t.get(te)===Be}},Vo=class{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const s=this.intervalGroups.slice();return s.push([e.calendar,e]),new Vo({intervalGroups:s})}getIsWorkingForEvery(){if(this.isWorkingForEvery!=null)return this.isWorkingForEvery;for(let[e,s]of this.getGroups())if(!s[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(this.isWorkingForSome!=null)return this.isWorkingForSome;for(let[e,s]of this.getGroups())if(s[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[s,t]of this.getGroups())e.set(s,t[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[s,t]of this.getGroups())t[0].isWorking&&e.push(s);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[s,t]of this.getGroups())t[0].isWorking||e.push(s);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const e=this.calendars=[],s=new Map;return this.intervalGroups.forEach(([t,n])=>{let r=s.get(t);r||(e.push(t),r=[],s.set(t,r)),r.push.apply(r,n.intervals)}),s.forEach((t,n)=>{const r=us(t);r.sort((i,a)=>a.getPriorityField()-i.getPriorityField()),s.set(n,r)}),this.intervalsByCalendar=s}},Uo=class extends $o{constructor(e){super(e),this.calendarCaches=us(this.calendarCaches),this.intervalCache=new _o({emptyInterval:new Vo,combineIntervalsFn:(s,t)=>s.combineWith(t)})}fillCache(e,s){this.calendarCaches.forEach(t=>{t.fillCache(e,s),this.includeWrappingRangeFrom(t,e,s)})}},rv=new Map,sv=e=>{const s=us(e);if(s.length===0)throw new Error("No calendars to combine");s.sort((a,o)=>a.internalId<o.internalId?-1:1);const t=s.map(a=>a.internalId+"/").join(""),n=s.map(a=>a.version+"/").join("");let r=rv.get(t),i;return r&&r.versionsHash===n?i=r.cache:i=new Uo({calendarCaches:s.map(a=>a.calendarCache)}),i},di=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},hi=class extends O([cs],e=>{class s extends e{writeCalendar(n,r,i,a){const o=this.getCalendarManagerStore(),l=a;a&&o&&a instanceof ds&&!o.includes(l)&&o.add(a),n.constructor.prototype.write.call(this,n,r,i,a)}resolveCalendar(n){var r;return(r=this.getCalendarManagerStore())==null?void 0:r.getById(n)}*calculateEffectiveCalendar(){let n=yield this.$.calendar;return n||(n=yield this.getProject().$.effectiveCalendar),yield n.$.version,n}shouldRecordFieldChange(n,r,i){if(!super.shouldRecordFieldChange(n,r,i))return!1;const{project:a}=this;if(n==="calendar"&&a){const{calendarManagerStore:o}=a;return o.oldIdMap[r]!==o.getById(i)}return!0}}return di([q({equality:()=>!1})],s.prototype,"effectiveCalendar",void 0),di([qe({modelFieldConfig:{persist:!0,serialize:t=>t===void 0?void 0:(t==null?void 0:t.id)||null,isEqual:ar},resolver:function(t){return this.resolveCalendar(t)},sync:!0},Tr)],s.prototype,"calendar",void 0),di([dt("calendar")],s.prototype,"writeCalendar",null),di([j("effectiveCalendar")],s.prototype,"calculateEffectiveCalendar",null),ti(s),s}){},Dh=class extends O([],e=>{class s extends e{constructor(){super(...arguments),this.combinedCalendarsCache=new Map,this.combinationsByCalendar=new Map}combineCalendars(n){const r=us(n);if(r.length===0)throw new Error("No calendars to combine");r.sort((c,u)=>c.internalId<u.internalId?-1:1);const i=r.map(c=>c.internalId+"/").join(""),a=r.map(c=>c.version+"/").join(""),o=this.combinedCalendarsCache.get(i);let l;return o&&o.versionsHash===a?l=o.cache:(l=new Uo({calendarCaches:r.map(c=>c.calendarCache)}),this.combinedCalendarsCache.set(i,{versionsHash:a,cache:l}),r.forEach(c=>{let u=this.combinationsByCalendar.get(c);u||(u=new Set,this.combinationsByCalendar.set(c,u)),u.add(i)})),l}clearCombinationsWith(n){const r=this.combinationsByCalendar.get(n);r&&(r.forEach(i=>this.combinedCalendarsCache.delete(i)),this.combinationsByCalendar.delete(n))}}return s}){},ge=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},or=class extends O([hi],e=>{const s=e.prototype;class t extends e{*calculateDispatcher(r){const i=yield X,a=yield*this.prepareDispatcher(r),o=yield Er(this.$.startDate),l=o?o[0]?Ke.KeepDuration:Ke.KeepEndDate:void 0;l&&a.addInstruction(l);const c=yield Er(this.$.endDate),u=c?c[0]?Ke.KeepDuration:Ke.KeepStartDate:void 0;u&&a.addInstruction(u);const d=yield this.$.effectiveDirection,h=yield Er(this.$.duration);let f;if(h)switch(h[0]){case!0:f=Ke.KeepStartDate;break;case!1:f=Ke.KeepEndDate;break}return!f&&a.hasProposedValue(te)&&(f=d.direction===L.Forward||d.direction===L.None?Ke.KeepStartDate:Ke.KeepEndDate),f&&a.addInstruction(f),a}*prepareDispatcher(r){const a=this.dispatcherClass(r).new({context:this.cycleResolutionContext(r)});return a.collectInfo(r,this.$.startDate,J),a.collectInfo(r,this.$.endDate,Q),a.collectInfo(r,this.$.duration,te),a}cycleResolutionContext(r){const i=r(this.$.effectiveDirection);return i.direction===L.Forward||i.direction===L.None?yh:Sh}dispatcherClass(r){return No}buildProposedDispatcher(r,i,a){const o=this.dispatcherClass(a.onEffectSync).new({context:this.cycleResolutionContext(a.onEffectSync)});return o.addPreviousValueFlag(J),o.addPreviousValueFlag(Q),o.addPreviousValueFlag(te),o}*skipNonWorkingTime(r,i){const a=yield this.$.effectiveCalendar;if(!r)return null;const o=a.skipNonWorkingTime(r,i);if(o instanceof Date)return o;{const l=en.new({calendars:[a],event:this,date:r,isForward:i});if((yield l)===bt.Cancel)yield kt(l);else return null}}*skipWorkingTime(r,i,a,o){const l=yield this.$.durationUnit;return o&&o!==l&&(a=yield*this.getProject().$convertDuration(a,o,l)),yield*this.calculateProjectedXDateWithDuration(r,i,a)}setStartDate(r,i=!0){const{graph:a,project:o}=this;return a?(a.write(this.$.startDate,r,i),a.commitAsync()):(this.$.startDate.DATA=r,o==null?void 0:o.delayedCalculationPromise)}writeStartDate(r,i,a,o,l=!0){!i.baseRevision.hasIdentifier(r)&&o==null||(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,i,void 0,o==null),r.constructor.prototype.write.call(this,r,i,a,o,l))}*calculateStartDate(){const i=(yield this.$.dispatcher).resolution.get(J);if(i===Be)return yield*this.calculateStartDateProposed();if(i===Je.formulaId)return yield*this.calculateStartDatePure();throw new Error("Unknown formula for `startDate`")}*calculateStartDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.endDate,!1,yield this.$.duration)}*calculateStartDateProposed(){const r=this.getProject(),i=yield X;return!(yield this.$.manuallyScheduled)||r.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(i,!0):i}*calculateProjectedXDateWithDuration(r,i,a){const o=yield this.$.durationUnit,l=yield this.$.effectiveCalendar,c=this.getProject();return!r||hd(a)?null:(i=i===void 0?!0:i,i?l.calculateEndDate(r,yield*c.$convertDuration(a,o,V.Millisecond)):l.calculateStartDate(r,yield*c.$convertDuration(a,o,V.Millisecond)))}setEndDate(r,i=!1){const{graph:a,project:o}=this;return a?(a.write(this.$.endDate,r,i),a.commitAsync()):(this.$.endDate.DATA=r,o==null?void 0:o.delayedCalculationPromise)}writeEndDate(r,i,a,o,l=!1){!i.baseRevision.hasIdentifier(r)&&o==null||(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,i,void 0,o==null),r.constructor.prototype.write.call(this,r,i,a,o,l))}*calculateEndDate(){const i=(yield this.$.dispatcher).resolution.get(Q);if(i===Be)return yield*this.calculateEndDateProposed();if(i===Qe.formulaId)return yield*this.calculateEndDatePure();throw new Error("Unknown formula for `endDate`")}*calculateEndDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.startDate,!0,yield this.$.duration)}*calculateEndDateProposed(){const r=this.getProject(),i=yield X;return!(yield this.$.manuallyScheduled)||r.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(i,!1):i}getDuration(r){const i=this.duration;return r!==void 0?this.getProject().convertDuration(i,this.durationUnit,r):i}setDuration(r,i,a){const{graph:o,project:l}=this;if(o){if(r!==void 0)return o.write(this.$.duration,r,i,a),o.commitAsync()}else{const c={duration:r};return this.$.duration.DATA=r,i!=null&&(c.durationUnit=this.$.durationUnit.DATA=i),this.set(c),l==null?void 0:l.delayedCalculationPromise}}setDurationUnit(r){throw new Error("Use `setDuration` instead")}writeDuration(r,i,a,o,l,c=void 0){o<0&&(o=0),!(!i.baseRevision.hasIdentifier(r)&&o==null)&&(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,i,void 0,o==null),r.constructor.prototype.write.call(this,r,i,a,o,c),l!=null&&i.write(this.$.durationUnit,l))}*calculateDuration(){const i=(yield this.$.dispatcher).resolution.get(te);if(i===Be)return yield*this.calculateDurationProposed();if(i===Ze.formulaId)return yield*this.calculateDurationPure();throw new Error("Unknown formula for `duration`")}*calculateDurationPure(){const r=yield this.$.startDate,i=yield this.$.endDate;if(!r||!i)return null;if(r>i)yield Pc(this.$.duration,0,null);else return yield*this.calculateProjectedDuration(r,i)}*calculateDurationProposed(){return yield X}*calculateProjectedDuration(r,i,a){if(!r||!i)return null;a||(a=yield this.$.durationUnit);const o=yield this.$.effectiveCalendar;return yield*this.getProject().$convertDuration(o.calculateDurationMs(r,i),V.Millisecond,a)}*calculateEffectiveDuration(){const r=yield this.$.dispatcher;let i;const a=r.resolution.get(te);return a===Be?i=yield this.$.duration:a===Ze.formulaId&&(i=yield*this.calculateProjectedDuration(yield pe(this.$.startDate),yield pe(this.$.endDate))),i}*calculateEffectiveDirection(){return{kind:"own",direction:(yield this.$.direction)||L.Forward}}*calculateStartDateDirection(){return yield this.$.effectiveDirection}*calculateEndDateDirection(){return yield this.$.effectiveDirection}*calculateEffectiveCalendar(){const r=yield this.$.manuallyScheduled,i=this.getProject();return r&&!i.skipNonWorkingTimeInDurationWhenSchedulingManually?i.defaultCalendar:yield*super.calculateEffectiveCalendar()}}return ge([N({type:"date"},{converter:zt})],t.prototype,"startDate",void 0),ge([N({type:"date"},{converter:zt})],t.prototype,"endDate",void 0),ge([N({type:"number",allowNull:!0})],t.prototype,"duration",void 0),ge([N({type:"string",defaultValue:V.Day},{converter:n=>R.normalizeUnit(n)||V.Day})],t.prototype,"durationUnit",void 0),ge([N({type:"string"},{sync:!0})],t.prototype,"direction",void 0),ge([q({sync:!0,equality:$s})],t.prototype,"startDateDirection",void 0),ge([q({sync:!0,equality:$s})],t.prototype,"endDateDirection",void 0),ge([N({persist:!1,isEqual:$s},{sync:!0,equality:$s})],t.prototype,"effectiveDirection",void 0),ge([q({identifierCls:Bo})],t.prototype,"dispatcher",void 0),ge([N({type:"boolean",defaultValue:!1},{sync:!0})],t.prototype,"manuallyScheduled",void 0),ge([N({type:"boolean",defaultValue:!1})],t.prototype,"unscheduled",void 0),ge([j("dispatcher")],t.prototype,"calculateDispatcher",null),ge([su("dispatcher")],t.prototype,"buildProposedDispatcher",null),ge([dt("startDate")],t.prototype,"writeStartDate",null),ge([j("startDate")],t.prototype,"calculateStartDate",null),ge([dt("endDate")],t.prototype,"writeEndDate",null),ge([j("endDate")],t.prototype,"calculateEndDate",null),ge([dt("duration")],t.prototype,"writeDuration",null),ge([j("duration")],t.prototype,"calculateDuration",null),ge([j("effectiveDirection")],t.prototype,"calculateEffectiveDirection",null),ge([j("startDateDirection")],t.prototype,"calculateStartDateDirection",null),ge([j("endDateDirection")],t.prototype,"calculateEndDateDirection",null),t}){},Wo=class extends O([ls],e=>{const s=e.prototype;class t extends e{getAssignmentFor(r){var i;for(const a of(i=this.assigned)!=null?i:[])if(a.resource===r)return a;return null}isAssignedTo(r){return!!this.getAssignmentFor(r)}async assign(r){const i=this.project.assignmentStore.modelClass;return this.addAssignment(new i({event:this,resource:r})),this.commitAsync()}async unassign(r){const i=this.getAssignmentFor(r);return this.removeAssignment(i),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const r=this.getEventStore();this.assigned.forEach(i=>r.assignmentsForRemoval.add(i))}s.leaveProject.call(this,...arguments)}remove(){if(this.parent){const r=this.getEventStore();s.remove.call(this),r&&r.afterEventRemoval()}else return s.remove.call(this)}addAssignment(r){return this.getProject().assignmentStore.add(r),r}removeAssignment(r){return this.getProject().assignmentStore.remove(r),r}}return t}){},nv=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},zo=class extends O([or,Wo],e=>{const s=e.prototype;class t extends e{get assignments(){return this.assigned?[...this.assigned]:[]}}return nv([qe({},Or)],t.prototype,"assigned",void 0),t}){},Ch=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},qo=class extends O([or],e=>{const s=e.prototype;class t extends e{leaveProject(){var r,i;if(this.isInActiveTransaction){const a=this.graph.activeTransaction,o=this.getDependencyStore(),l=[];for(const c of(r=a.readCurrentOrProposedOrPrevious(this.$.outgoingDeps))!=null?r:[])o.includes(c)&&l.push(c);for(const c of(i=a.readCurrentOrProposedOrPrevious(this.$.incomingDeps))!=null?i:[])o.includes(c)&&l.push(c);this.project.dependencyStore.remove(l)}s.leaveProject.call(this)}}return Ch([qe({},Or)],t.prototype,"outgoingDeps",void 0),Ch([qe({},Or)],t.prototype,"incomingDeps",void 0),t}){},fi=class extends O([or,zo,qo],e=>{const s=e.prototype;class t extends e{}return t}){},iv={splice:1,clear:1},Go=class extends O([mt],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(r){var i;const a=iv[r.action];super.onDataChange(r),a&&((i=r.removed)!=null&&i.length)&&this.afterEventRemoval()}remove(r,i){const a=s.remove.call(this,r,i);return this.afterEventRemoval(),a}removeAll(r){const i=s.removeAll.call(this,r);return this.afterEventRemoval(),i}onNodeRemoveChild(r,i,a,o){const l=s.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),l}afterEventRemoval(){const{assignmentsForRemoval:r,dependenciesForRemoval:i}=this;if(!r)return;const a=this.getAssignmentStore();if(a&&!a.allAssignmentsForRemoval&&r.size){const l=[...r].filter(c=>!a.assignmentsForRemoval.has(c));l.length>0&&a.remove(l)}r.clear();const o=this.getDependencyStore();if(o&&!o.allDependenciesForRemoval&&i.size){const l=[...i].filter(c=>!o.dependenciesForRemoval.has(c));l.length>0&&o.remove(l)}i.clear()}processRecord(r,i=!1){var a;if(!((a=this.project)!=null&&a.isRepopulatingStores)){const o=this.getById(r.id);if(o&&o!==r&&o.assigned)for(const c of o.assigned)c.event=r}return r}}return t}){},tn=class extends O([Go,_r],e=>{class s extends e{constructor(){super(...arguments),this.removalOrder=400}static get defaultConfig(){return{modelClass:fi}}buildRootNode(){return this.getProject()||{}}set data(n){super.data=n,this.afterEventRemoval()}}return s}){},Ho=class extends O([tn],e=>{class s extends e{static get defaultConfig(){return{tree:!0}}}return s}){},av={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",RemoveDependencyCycleEffectResolution:{descriptionTpl:"Remove dependency"},DeactivateDependencyCycleEffectResolution:{descriptionTpl:"Deactivate dependency"},CycleEffectDescription:{descriptionTpl:"A cycle has been found, formed by: {0}"},EmptyCalendarEffectDescription:{descriptionTpl:'"{0}" calendar does not provide any working time intervals.'},Use24hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 24 hours calendar with non-working Saturdays and Sundays."},Use8hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 8 hours calendar (08:00-12:00, 13:00-17:00) with non-working Saturdays and Sundays."},ConflictEffectDescription:{descriptionTpl:"A scheduling conflict has been found: {0} is conflicting with {1}"},ConstraintIntervalDescription:{dateFormat:"LLL"},ProjectConstraintIntervalDescription:{startDateDescriptionTpl:"Project start date {0}",endDateDescriptionTpl:"Project end date {0}"},DependencyType:{long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},ManuallyScheduledParentConstraintIntervalDescription:{startDescriptionTpl:'Manually scheduled "{2}" forces its children to start no earlier than {0}',endDescriptionTpl:'Manually scheduled "{2}" forces its children to finish no later than {1}'},DisableManuallyScheduledConflictResolution:{descriptionTpl:'Disable manual scheduling for "{0}"'},DependencyConstraintIntervalDescription:{descriptionTpl:'Dependency ({2}) from "{3}" to "{4}"'},RemoveDependencyResolution:{descriptionTpl:'Remove dependency from "{1}" to "{2}"'},DeactivateDependencyResolution:{descriptionTpl:'Deactivate dependency from "{1}" to "{2}"'},DateConstraintIntervalDescription:{startDateDescriptionTpl:'Task "{2}" {3} {0} constraint',endDateDescriptionTpl:'Task "{2}" {3} {1} constraint',constraintTypeTpl:{startnoearlierthan:"Start-No-Earlier-Than",finishnoearlierthan:"Finish-No-Earlier-Than",muststarton:"Must-Start-On",mustfinishon:"Must-Finish-On",startnolaterthan:"Start-No-Later-Than",finishnolaterthan:"Finish-No-Later-Than"}},RemoveDateConstraintConflictResolution:{descriptionTpl:'Remove "{1}" constraint of task "{0}"'}},Jy=st.publishLocale(av),gi=class extends de{initialize(...e){super.initialize(...e),this.startDate||(this.startDate=he),this.endDate||(this.endDate=ae)}equalTo(e){return this.startDate.getTime()===e.startDate.getTime()&&this.endDate.getTime()===e.endDate.getTime()}isInfinite(){return this.startDate.getTime()===he.getTime()&&this.endDate.getTime()===ae.getTime()}startDateIsFinite(){return!this.isIntervalEmpty()&&this.startDate.getTime()!==he.getTime()}endDateIsFinite(){return!this.isIntervalEmpty()&&this.endDate.getTime()!==ae.getTime()}containsDate(e,s=At.Left){return s===At.Left&&e>=this.startDate&&e<this.endDate||s===At.Right&&e>this.startDate&&e<=this.endDate}isIntervalEmpty(){return this.startDate>this.endDate}intersect(e){const s=e.startDate,t=e.endDate,n=this.startDate,r=this.endDate;if(r<s||n>t)return Eh;const i=new Date(Math.max(n.getTime(),s.getTime())),a=new Date(Math.min(r.getTime(),t.getTime()));return this.constructor.new({startDate:i,endDate:a})}intersectMut(e,s=!1){var t;const n=e.startDate,r=e.endDate,i=this.startDate,a=this.endDate;if(s&&(this.intersectionOf||(this.intersectionOf=new Set),((t=e.intersectionOf)==null?void 0:t.size)>0?(e.intersectionOf.forEach(this.intersectionOf.add,this.intersectionOf),this.intersectedAsEmpty=e.intersectedAsEmpty):this.intersectionOf.add(e)),!this.isIntervalEmpty()){if(a<n||i>r)return this.startDate=ae,this.endDate=he,s&&(this.intersectedAsEmpty=e),this;this.startDate=new Date(Math.max(i.getTime(),n.getTime())),this.endDate=new Date(Math.min(a.getTime(),r.getTime()))}return this}getCopyProperties(e){return e}copyWith(e){const s=this.getCopyProperties(e);return this.constructor.new(s)}},Eh=gi.new({startDate:ae,endDate:he}),lr=(e,s=!1)=>e.reduce((t,n)=>t.intersectMut(n,s),gi.new()),Yo=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Ko=Symbol("ConflictSymbol"),bh=class extends gt($){static get $name(){return"ConflictEffectDescription"}static getDescription(e){return pt(this.L("L{descriptionTpl}"),e.intervals[0].getDescription(),e.intervals[1].getDescription())}},cr=class extends Vs{constructor(){super(...arguments),this.handler=Ko}initialize(e){super.initialize(e),this.intervals=this.filterConflictingIntervals(this.intervals)}getResolutions(){return this._resolutions||(this._resolutions=[].concat(...this.intervals.map(e=>e.getResolutions()))),this._resolutions}filterConflictingIntervals(e){const s=[],t=[...e].filter(r=>!r.isInfinite()),n=t.find(r=>r.isAffectedByTransaction());if(n){const r=t.sort((o,l)=>o===n?-1:0),a=lr(r,!0).intersectedAsEmpty;s.push(a,n)}else s.push(lr(t,!0).intersectedAsEmpty,lr(t.reverse(),!0).intersectedAsEmpty);return s}};Yo([G("schedulingConflict")],cr.prototype,"type",void 0),Yo([G(bh)],cr.prototype,"_descriptionBuilderClass",void 0);var pi=class extends Bs{resolve(){throw new Error("Abstract method")}},hs=class extends gt($){static get $name(){return"ConstraintIntervalDescription"}static getDescription(e){return pt(this.L("L{descriptionTpl}"),...this.getDescriptionParameters(e))}static getDescriptionParameters(e){return[R.format(e.startDate,this.L("L{dateFormat}")),R.format(e.endDate,this.L("L{dateFormat}"))]}},ur=class extends gi{constructor(){super(...arguments),this.owner=void 0,this.reflectionOf=void 0,this.side=void 0,this.resolutions=void 0}get isConstraintInterval(){return!0}getDescription(){return this.descriptionBuilderClass.getDescription(this)}getResolutions(){return[]}isAffectedByTransaction(e){return!1}getCopyProperties(e){const{owner:s,reflectionOf:t,side:n}=this;return Object.assign({owner:s,reflectionOf:t,side:n},e)}};Yo([G(hs)],ur.prototype,"descriptionBuilderClass",void 0);var Jo=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Qo=Symbol("CycleSymbol"),Zo=class extends Vn{constructor(){super(...arguments),this.failedResolutionReferences=new Map}},Rh=class extends La{constructor(){super(...arguments),this.candidateClass=Zo}initialize(e){var s;(s=e.graph.project)!=null&&s.delayCalculation&&(e.startProgressNotificationsAfterMs=0,e.emitProgressNotificationsEveryMs=100),super.initialize(e),this.candidate.failedResolutionReferences=new Map(this.baseRevision.failedResolutionReferences)}addIdentifier(e,s,...t){return this.candidate.failedResolutionReferences.size&&(this.candidate.failedResolutionReferences.forEach((n,r)=>{this.write(r,n)}),this.candidate.failedResolutionReferences.clear()),super.addIdentifier(e,s,...t)}},wh=class extends O([Na],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.baseRevision=Zo.new(),this.transactionClass=Rh,this.autoCommitMode="async",this.onComputationCycle="effect",this.cycleEffectClass=jr,this.silenceInitialCommit=!0,this.ignoreInitialCommitComputationCycles=!1}get dirty(){const r=this.activeTransaction;return r.entries.size>0&&(r.hasVariableEntry||r.hasEntryWithProposedValue)}onPropagationProgressNotification(r){var i,a;this.enableProgressNotifications&&this.project&&((a=(i=this.project).trigger)==null||a.call(i,"progress",r))}async commitAsync(r){if(!this.project||this.project.isDestroyed)return;this.project.trigger("beforeCommit"),this.isInitialCommit&&this.ignoreInitialCommitComputationCycles&&(this._onComputationCycle=this._onComputationCycle||this.onComputationCycle,this.onComputationCycle="ignore");const i=this.project.beforeCommitAsync();return i||s.commitAsync.call(this,r)}get isInitialCommit(){return this.project.isInitialCommit||super.isInitialCommit}set isInitialCommit(r){super.isInitialCommit=r}write(r,i,...a){var o,l,c;const u=(o=r.field)==null?void 0:o.name,d=r.self;if(u&&d){const h=(l=d.beforeChronoFieldSet)==null?void 0:l.call(d,u,i);s.write.call(this,r,i,...a),(c=d.afterChronoFieldSet)==null||c.call(d,u,i,h)}else s.write.call(this,r,i,...a)}async finalizeCommitAsync(r){const{project:i}=this;if(!i||i.isDestroyed)return;const{entries:a}=r,o=new Set;globalThis.DEBUG&&console.timeEnd("Time to visible");const{isInitialCommit:l,silenceInitialCommit:c}=this,u=l&&c;l&&(i.isInitialCommitPerformed=!0,this.ignoreInitialCommitComputationCycles&&(this.onComputationCycle=this._onComputationCycle)),i.isWritingData=!0,i.hasLoadedDataToCommit=!1,this.enableProgressNotifications&&i.trigger("progress",{total:r.entries.size,remaining:0,phase:"finalizing"}),r.transaction.rejectedWith&&i.trigger("commitRejected",{transactionResult:r,isInitialCommit:l,silenceCommit:u}),i.trigger("refresh",{isInitialCommit:l,isCalculated:!0}),await new Promise(h=>{setTimeout(()=>{var f,g;if(!i.isDestroyed){if(r.transaction.rejectedWith)i.isWritingData=!1;else{(f=i.suspendChangesTracking)==null||f.call(i),globalThis.DEBUG&&console.time("Finalize propagation");const p=new Set;for(const y of a.values()){const D=y.identifier,E=y.getValue(),{field:C}=D;if(y.isShadow()||!D[Xn]||E===ee||C instanceof Or)continue;const v=D.self,S=v.firstStore;p.has(v)||(v.beginBatch(!0),p.add(v)),S!=null&&S.autoCommit&&!o.has(S)&&(S.suspendAutoCommit(),o.add(S)),v.meta.batchChanges[C.name]=E}let m=!1;for(const y of p)if(!y.triggerBeforeUpdate({...y.meta.batchChanges})){m=!0;break}if(m){for(const y of p)y.cancelBatch();r.transaction.reject(),i.trigger("commitRejected",{transactionResult:r,isInitialCommit:l,silenceCommit:u}),i.trigger("refresh",{isInitialCommit:l,isCalculated:!0})}else for(const y of p)y.ignoreBag=u||i.ignoreRecordChanges,y.generation++,y.endBatch(u,!0,!0),y.ignoreBag=!1;i.ignoreRecordChanges=!1,globalThis.DEBUG&&console.timeEnd("Finalize propagation"),i.isWritingData=!1,m||i.trigger("dataReady",{records:p,isInitialCommit:l}),(g=i.resumeChangesTracking)==null||g.call(i,u),o.forEach(y=>y.resumeAutoCommit()),u&&(i.eventStore.acceptChanges(),i.dependencyStore.acceptChanges(),i.resourceStore.acceptChanges(),i.assignmentStore.acceptChanges(),i.calendarManagerStore.acceptChanges(),i.acceptChanges())}i.trigger("commitFinalized",{isInitialCommit:l,transactionResult:r})}h()},0)})}*onComputationCycleHandler(r){if(this.onComputationCycle==="effect"){const i=this.project.cycleEffectClass.new({cycle:r});(yield i)===bt.Cancel&&(yield kt(i))}else return yield*super.onComputationCycleHandler(r)}onComputationCycleHandlerSync(r,i){if(this.onComputationCycle==="effect")throw this.project.cycleEffectClass.new({cycle:r});return super.onComputationCycleHandlerSync(r,i)}async[Qo](r,i){return this.project.onCycleSchedulingIssue(r,i)}async[jo](r,i){return i.walkContext.startNewEpoch(),this.project.onEmptyCalendarSchedulingIssue(r,i)}async[Ko](r,i){return i.walkContext.startNewEpoch(),this.project.onConflictSchedulingIssue(r,i)}[ws](r,i){return super[ws](r,i)}}return t}){},Ih=class extends gt(Bs){static get $name(){return"RemoveDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.remove()}},Ph=class extends gt($){static get $name(){return"CycleEffectDescription"}static getDescription(e){return pt(this.L("L{descriptionTpl}"),this.getShortDescription(e))}static getShortDescription(e){const s=e.getEvents().slice();return s.push(s[0]),'"'+s.map(t=>t.name||"#"+t.id).join('" -> "')+'"'}},jr=class extends Vs{constructor(){super(...arguments),this.handler=Qo}getEvents(){if(!this._events){const e=new Set;this.cycle.cycle.forEach(({context:s})=>e.add(s)),this._events=[...e]}return this._events}matchDependencyBySourceAndTargetEvent(e,s,t){return e.fromEvent===s&&e.toEvent===t}getDependencyForSourceAndTargetEvents(e,s){return this.getEvents()[0].project.getDependencyStore().find(i=>this.matchDependencyBySourceAndTargetEvent(i,e,s))}getDependencies(){if(!this._dependencies){const e=new Set,s=this.getEvents(),t=s.length;let n=s[0],r;if(t===1)(r=this.getDependencyForSourceAndTargetEvents(n,n))&&e.add(r);else for(const i of s)for(const a of s)(r=this.getDependencyForSourceAndTargetEvents(i,a))&&e.add(r),(r=this.getDependencyForSourceAndTargetEvents(a,i))&&e.add(r);this._dependencies=[...e]}return this._dependencies}getResolutions(){return this._resolutions||(this._resolutions=[this.removeDependencyCycleEffectResolutionClass.new()]),this._resolutions}};Jo([G("cycle")],jr.prototype,"type",void 0),Jo([G(Ph)],jr.prototype,"_descriptionBuilderClass",void 0),Jo([G(Ih)],jr.prototype,"removeDependencyCycleEffectResolutionClass",void 0);var mi=class extends O([or],e=>{const s=e.prototype;class t extends e{static get $name(){return"HasSubEventsMixin"}*hasSubEvents(){throw new Error("Abstract method `hasSubEvents` has been called")}*subEventsIterable(){throw new Error("Abstract method `subEventsIterable` has been called")}*calculateStartDatePure(){const r=yield this.$.manuallyScheduled,i=yield*this.hasSubEvents();return!r&&i?yield*this.calculateMinChildrenStartDate():yield*s.calculateStartDatePure.call(this)}*calculateEndDatePure(){const r=yield this.$.manuallyScheduled,i=yield*this.hasSubEvents();return!r&&i?yield*this.calculateMaxChildrenEndDate():yield*s.calculateEndDatePure.call(this)}*calculateStartDateProposed(){const r=yield this.$.manuallyScheduled,i=yield*this.hasSubEvents();return!r&&i?yield*this.calculateStartDatePure():yield*s.calculateStartDateProposed.call(this)}*calculateEndDateProposed(){const r=yield this.$.manuallyScheduled,i=yield*this.hasSubEvents();return!r&&i?yield*this.calculateEndDatePure():yield*s.calculateEndDateProposed.call(this)}*calculateDurationProposed(){const r=yield this.$.manuallyScheduled,i=yield*this.hasSubEvents();return!r&&i?yield*this.calculateDurationPure():yield*s.calculateDurationProposed.call(this)}*shouldRollupChildStartDate(r){return!0}*calculateMinChildrenStartDate(){const r=yield*this.subEventsIterable();let i=ae.getTime();for(const a of r)if(yield*this.shouldRollupChildStartDate(a)){let o=yield a.$.startDate;if(o||(o=yield a.$.endDate),(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())){const l=yield*a.calculateMinChildrenStartDate();(!o||l&&l.getTime()<o.getTime())&&(o=l)}o&&o.getTime()<i&&(i=o.getTime())}return i===he.getTime()||i===ae.getTime()?null:new Date(i)}*shouldRollupChildEndDate(r){return!0}*calculateMaxChildrenEndDate(){const r=yield*this.subEventsIterable();let i=he.getTime();for(const a of r)if(yield*this.shouldRollupChildEndDate(a)){let o=yield a.$.endDate;if(o||(o=yield a.$.startDate),(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())){const l=yield*a.calculateMaxChildrenEndDate();(!o||l&&l.getTime()>o.getTime())&&(o=l)}o&&o.getTime()>i&&(i=o.getTime())}return i===he.getTime()||i===ae.getTime()?null:new Date(i)}}return t}){},Mh=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Gt=class extends O([mi],e=>{const s=e.prototype;class t extends e{*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}get parent(){return this._parent}set parent(r){this._parent=r,this.parentEvent=r}*calculateEffectiveDirection(){const r=yield this.$.direction;if(r)return{kind:"own",direction:r};const i=yield this.$.parentEvent;if(i){const a=yield i.$.effectiveDirection;return{kind:"inherited",direction:a.direction,inheritedFrom:a.kind==="own"?i:a.kind==="inherited"?a.inheritedFrom:i}}else return yield*super.calculateEffectiveDirection()}*calculateStartDateDirection(){const r=yield this.getProject().$.effectiveDirection;let i=null;if(!(yield this.$.manuallyScheduled)){const a=yield*this.subEventsIterable();for(const o of a){const l=yield o.$.startDateDirection;if(r.direction!==l.direction){i={kind:"enforced",direction:l.direction,enforcedBy:l.kind==="own"?o:l.kind==="enforced"?l.enforcedBy:l.inheritedFrom};break}}}return i!=null?i:yield*super.calculateStartDateDirection()}*calculateEndDateDirection(){const r=yield this.getProject().$.effectiveDirection;let i=null;if(!(yield this.$.manuallyScheduled)){const a=yield*this.subEventsIterable();for(const o of a){const l=yield o.$.startDateDirection;if(r.direction!==l.direction){i={kind:"enforced",direction:l.direction,enforcedBy:l.kind==="own"?o:l.kind==="enforced"?l.enforcedBy:l.inheritedFrom};break}}}return i!=null?i:yield*super.calculateStartDateDirection()}}return Mh([Xu({bucket:"childEvents"})],t.prototype,"parentEvent",void 0),Mh([rd()],t.prototype,"childEvents",void 0),t}){},xh=class extends de{constructor(){super(...arguments),this.entities=new Map}hasEntity(e){return this.entities.has(e)}getEntity(e){return this.entities.get(e)}addEntity(e){const s=e.name;if(!s)throw new Error("Entity must have a name");if(this.hasEntity(s))throw new Error(`Entity with name [${String(s)}] already exists`);return e.schema=this,this.entities.set(s,e),e}getEntityDecorator(){return e=>{const s=Xo(e);return this.addEntity(s),e}}},Xo=e=>{if(!e.name)throw new Error("Can't add entity - the target class has no name");return Ir(e.prototype)},ov=()=>e=>(Xo(e),e),Ce=()=>{throw new Error("Abstract method call!")},ie=()=>{throw new Error("Method cannot be called at this state!")},dr=class extends ${canUndo(e){Ce()}canRedo(e){Ce()}onUndo(e){Ce()}onRedo(e){Ce()}onStartTransaction(e){Ce()}onStopTransaction(e){Ce()}onStopTransactionDelayed(e){Ce()}onRejectTransaction(e){Ce()}onEnable(e){Ce()}onDisable(e){Ce()}onAutoRecordOn(e){Ce()}onAutoRecordOff(e){Ce()}onResetQueue(e){Ce()}onModelUpdate(e){Ce()}onStoreModelAdd(e){Ce()}onStoreModelInsert(e){Ce()}onStoreModelRemove(e){Ce()}onStoreModelRemoveAll(e){Ce()}onModelInsertChild(e){Ce()}onModelRemoveChild(e){Ce()}};dr._$name="StateBase";var ne=Symbol("STATE_PROP"),hr=Symbol("STORES_PROP"),Xe=Symbol("QUEUE_PROP"),Rt=Symbol("POS_PROP"),oe=Symbol("TRANSACTION_PROP"),yt=Symbol("TRANSACTION_TIMER_PROP"),wt=Symbol("AUTO_RECORD_PROP"),rn=Symbol("IS_APPLYING_STASH"),Qy=Object.freeze([ne,hr,Xe,Rt,oe,yt,wt,rn]),Th=new Map,lv=(e,s)=>{Th.set(e,s)},cv=e=>(typeof e=="string"&&(e=Th.get(e)),e),$t={registerStmState:lv,resolveStmState:cv},vi=(e,s)=>{const{undo:t,redo:n}=s;let r;return t&&!n?r={[Xe]:e[Xe].slice(e.position),[Rt]:0}:n&&!t?r={[Xe]:e[Xe].slice(0,e.position)}:r={[Xe]:[],[Rt]:0},[r,()=>{e.notifyStoresAboutQueueReset(s)}]},uv=class extends dr{canUndo(){return!1}canRedo(){return!1}onUndo(){ie()}onRedo(){ie()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){ie()}onAutoRecordOn(){return{[wt]:!0}}onAutoRecordOff(){return{[wt]:!1}}onStartTransaction(){ie()}onStopTransaction(){ie()}onStopTransactionDelayed(){ie()}onRejectTransaction(){ie()}onResetQueue(e,s){return vi(e,s)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},Oh=new uv,dv=Oh;$t.registerStmState("disabledstate",Oh);var fs=Symbol("ACTION_QUEUE_PROP"),yi=class extends ${get defaultConfig(){return{title:null}}construct(...e){this[fs]=[],super.construct(...e)}get queue(){return this[fs].slice(0)}get length(){return this[fs].length}addAction(e){this[fs].push(e)}undo(){const e=this[fs];for(let s=e.length-1;s>=0;--s)e[s].undo()}redo(){const e=this[fs];for(let s=0,t=e.length;s<t;++s)e[s].redo()}};yi._$name="Transaction";var Ah=class extends dr{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,s){let t=e.position;const n=e[Xe],r=Math.max(0,t-s),i=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];for(;t!==r;){const o=n[--t];o.undo(),a.push(o)}return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"undo",transactions:a})}]};return[{[ne]:"restoringstate",[Rt]:r},i]}onRedo(e,s){let t=e.position;const n=e[Xe],r=Math.min(n.length,t+s),i=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];do{const o=n[t++];o.redo(),a.push(o)}while(t!==r);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"redo",transactions:a})}]};return[{[ne]:"restoringstate",[Rt]:r},i]}onEnable(){ie()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[ne]:"autoreadystate",[wt]:!0}}onAutoRecordOff(){ie()}onStartTransaction(e,s){const t=new yi({title:s});return[{[ne]:"recordingstate",[oe]:t},()=>{e.notifyStoresAboutStateRecordingStart(t)}]}onStopTransaction(){ie()}onStopTransactionDelayed(){ie()}onRejectTransaction(){ie()}onResetQueue(e,s){return vi(e,s)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},$h=new Ah,Si=$h;$t.registerStmState("readystate",$h);var _h=class extends dr{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const s=e[oe];return e.notifyStoresAboutStateRecordingStop(s,{disabled:!0}),{[ne]:"disabledstate",[oe]:null}}onAutoRecordOn(e){return[{[ne]:"autorecordingstate",[wt]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){ie()}onStartTransaction(){ie()}onStopTransaction(e,s){const t=e[oe],n=e[Xe];let r=e[Rt];return t.length&&(!t.title&&!s&&e.getTransactionTitle?t.title=e.getTransactionTitle(t):s&&(t.title=s),n[r]=t,n.length=++r),[{[ne]:"readystate",[Rt]:r,[oe]:null},()=>{e.notifyStoresAboutStateRecordingStop(t,{stop:!0})}]}onRejectTransaction(e){const s=e[oe];return[{[ne]:"restoringstate",[oe]:null},()=>(s.length&&s.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(s,{rejected:!0})}])]}onStopTransactionDelayed(){ie()}onResetQueue(e,s){return vi(e,s)}onModelUpdate(e,s,t,n,r){e[oe].addAction(e.makeModelUpdateAction(s,t,n,r))}onModelInsertChild(e,s,t,n,r,i){e[oe].addAction(e.makeModelInsertChildAction(s,t,n,r,i))}onModelRemoveChild(e,s,t,n){e[oe].addAction(e.makeModelRemoveChildAction(s,t,n))}onStoreModelAdd(e,s,t,n){e[oe].addAction(e.makeStoreModelAddAction(s,t,n))}onStoreModelInsert(e,s,t,n,r,i){e[oe].addAction(e.makeStoreModelInsertAction(s,t,n,r,i))}onStoreModelRemove(e,s,t,n,r){e[oe].addAction(e.makeStoreModelRemoveAction(s,t,n,r))}onStoreRemoveAll(e,s,t,n){e[oe].addAction(e.makeStoreRemoveAllAction(s,t,n))}},Fh=new _h,hv=Fh;$t.registerStmState("recordingstate",Fh);var fv=class extends dr{static get $name(){return"RestoringStateClass"}canUndo(){return!1}canRedo(){return!1}onUndo(){ie()}onRedo(){ie()}onEnable(){ie()}onDisable(){ie()}onAutoRecordOn(){return{[wt]:!0}}onAutoRecordOff(){return{[wt]:!1}}onStartTransaction(){ie()}onStopTransaction(){ie()}onStopTransactionDelayed(){ie()}onRejectTransaction(){ie()}onQueueReset(){ie()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},jh=new fv,gv=jh;$t.registerStmState("restoringstate",jh);var pv=class extends Ah{onAutoRecordOn(){ie()}onAutoRecordOff(){return{[ne]:"readystate",[wt]:!1}}onStartTransaction(e,s){const t=new yi({title:s});return[{[ne]:"autorecordingstate",[oe]:t},()=>{e.notifyStoresAboutStateRecordingStart(t),e.stopTransactionDelayed()}]}onModelUpdate(e,s,t,n){e.startTransaction(),e.onModelUpdate(s,t,n)}onModelInsertChild(e,s,t,n,r){e.startTransaction(),e.onModelInsertChild(s,t,n,r)}onModelRemoveChild(e,s,t,n){e.startTransaction(),e.onModelRemoveChild(s,t,n)}onStoreModelAdd(e,s,t,n){e.startTransaction(),e.onStoreModelAdd(s,t,n)}onStoreModelInsert(e,s,t,n,r,i){e.startTransaction(),e.onStoreModelInsert(s,t,n,r,i)}onStoreModelRemove(e,s,t,n,r){e.startTransaction(),e.onStoreModelRemove(s,t,n,r)}onStoreRemoveAll(e,s,t,n){e.startTransaction(),e.onStoreRemoveAll(s,t,n)}},kh=new pv,el=kh;$t.registerStmState("autoreadystate",kh);var mv=class extends _h.mixin(Ar){onDisable(e){const s=e[oe],t=e[yt];return t&&this.clearTimeout(t),e.notifyStoresAboutStateRecordingStop(s,{disabled:!0}),{[ne]:"disabledstate",[oe]:null,[yt]:null}}onAutoRecordOn(e){ie()}onAutoRecordOff(e){const s=e[yt];return s&&this.clearTimeout(s),{[ne]:"recordingstate",[wt]:!1,[yt]:null}}onStopTransaction(e,s){const t=e[oe],n=e[yt],r=e[Xe];let i=e[Rt];return n&&this.clearTimeout(n),t.length&&(!t.title&&!s&&e.getTransactionTitle?t.title=e.getTransactionTitle(t):s&&(t.title=s),r[i]=t,r.length=++i),[{[ne]:"autoreadystate",[Rt]:i,[oe]:null,[yt]:null},()=>{e.notifyStoresAboutStateRecordingStop(t,{stop:!0})}]}onStopTransactionDelayed(e){let s=e[yt];return s&&this.clearTimeout(s),s=this.setTimeout(()=>{e.stopTransaction()},e.autoRecordTransactionStopTimeout),{[ne]:tl,[yt]:s}}onResetQueue(e,s){return vi(e,s)}onRejectTransaction(e){const s=e[oe],t=e[yt];return t&&this.clearTimeout(t),[{[ne]:"restoringstate",[oe]:null,[yt]:null},()=>(s.length&&s.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(s,{rejected:!0})}])]}onModelUpdate(e,...s){super.onModelUpdate(e,...s),e.stopTransactionDelayed()}onModelInsertChild(e,...s){super.onModelInsertChild(e,...s),e.stopTransactionDelayed()}onModelRemoveChild(e,...s){super.onModelRemoveChild(e,...s),e.stopTransactionDelayed()}onStoreModelAdd(e,...s){super.onStoreModelAdd(e,...s),e.stopTransactionDelayed()}onStoreModelInsert(e,...s){super.onStoreModelInsert(e,...s),e.stopTransactionDelayed()}onStoreModelRemove(e,...s){super.onStoreModelRemove(e,...s),e.stopTransactionDelayed()}onStoreRemoveAll(e,...s){super.onStoreRemoveAll(e,...s),e.stopTransactionDelayed()}},tl=new mv,vv=tl;$t.registerStmState("autorecordingstate",tl);var Lh=()=>{throw new Error("Abstract method call!")},Ht=class extends ${get type(){return this.constructor.name}undo(){Lh()}redo(){Lh()}};Ht._$name="ActionBase";var Nh=Symbol("MODEL_PROP"),Bh=Symbol("NEW_DATA_PROP"),Vh=Symbol("OLD_DATA_PROP"),Di=class extends Ht{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0,isInitialUserAction:!1}}get type(){return"UpdateAction"}get model(){return this[Nh]}set model(e){this[Nh]=e}get newData(){return this[Bh]}set newData(e){this[Bh]={...e}}get oldData(){return this[Vh]}set oldData(e){this[Vh]={...e}}undo(){const{model:e,oldData:s}=this;e.$&&Object.assign(e,s),e.set(s,null,null,null,!!e.$)}redo(){const{model:e,newData:s}=this;e.$&&Object.assign(e,s),e.set(s,null,null,null,!!e.$)}};Di._$name="UpdateAction";var Uh=Symbol("PARENT_MODEL_PROP"),Wh=Symbol("CHILD_MODELS_PROP"),zh=Symbol("INSERT_INDEX_PROP"),qh=Symbol("CONTEXT_PROP"),Gh=class extends Ht{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[Uh]}set parentModel(e){this[Uh]=e}get childModels(){return this[Wh]}set childModels(e){this[Wh]=e.slice(0)}get insertIndex(){return this[zh]}set insertIndex(e){this[zh]=e}get context(){return this[qh]}set context(e){this[qh]=e}undo(){const{parentModel:e,context:s,childModels:t}=this,n=new Map,r=new Set;for(const i of t){const a=s.get(i);if(!a)r.add(i);else{let o=n.get(a.parent);o||(o={moveRight:[],moveLeft:[],moveFromAnotherParent:[]},n.set(a.parent,o)),a.parent===e?a.index>i.parentIndex?o.moveRight.push({parent:a.parent,model:i,index:a.index+1}):o.moveLeft.push({parent:a.parent,model:i,index:a.index}):o.moveFromAnotherParent.push({parent:a.parent,model:i,index:a.index})}}for(const i of n.values()){const{moveRight:a,moveLeft:o}=i;o.sort((l,c)=>l.index-c.index),a.sort((l,c)=>c.index-l.index)}r.forEach(i=>i.parent.removeChild(i));for(const i of n.values()){const{moveRight:a,moveLeft:o,moveFromAnotherParent:l}=i;o.forEach(c=>{c.parent.insertChild(c.model,c.index)}),a.forEach(c=>{c.parent.insertChild(c.model,c.index)}),l.forEach(c=>{c.parent.insertChild(c.model,c.index)})}}redo(){var e;const{parentModel:s,insertIndex:t,childModels:n}=this,r=s.children[t];s.insertChild(n,r,!1,{orderedBeforeNode:(e=r==null?void 0:r.previousSibling)==null?void 0:e.nextOrderedSibling})}};Gh._$name="InsertChildAction";var Hh=Symbol("PARENT_MODEL_PROP"),Yh=Symbol("CHILD_MODELS_PROP"),Kh=Symbol("CONTEXT_PROP"),Jh=class extends Ht{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[Hh]}set parentModel(e){this[Hh]=e}get childModels(){return this[Yh]}set childModels(e){this[Yh]=e.slice(0)}get context(){return this[Kh]}set context(e){this[Kh]=e}undo(){const{parentModel:e,context:s,childModels:t}=this;t.sort((n,r)=>{const i=s.get(n),a=s.get(r);return i-a}),t.forEach(n=>{const r=s.get(n);e.insertChild(n,r.parentIndex,void 0,{orderedParentIndex:r.orderedParentIndex})})}redo(){this.parentModel.removeChild(this.childModels)}};Jh._$name="RemoveChildAction";var Qh=Symbol("STORE_PROP"),Zh=Symbol("MODEL_LIST_PROP"),Xh=class extends Ht{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[Qh]}set store(e){this[Qh]=e}get modelList(){return this[Zh]}set modelList(e){this[Zh]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}};Xh._$name="AddAction";var ef=Symbol("STORE_PROP"),tf=Symbol("MODEL_LIST_PROP"),rf=Symbol("INSERT_INDEX_PROP"),sf=Symbol("CONTEXT_PROP"),nf=class extends Ht{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[ef]}set store(e){this[ef]=e}get modelList(){return this[tf]}set modelList(e){this[tf]=e.slice(0)}get insertIndex(){return this[rf]}set insertIndex(e){this[rf]=e}get context(){return this[sf]}set context(e){this[sf]=e}undo(){const{store:e,modelList:s,context:t,silent:n}=this;s.sort((r,i)=>{const a=t.get(r),o=t.get(i);return a!==void 0&&o!==void 0?a-o:0}),s.forEach(r=>{const i=t.get(r);r._undoingInsertion=!0,i!==void 0?e.insert(i,r,n):e.remove(r,n),r._undoingInsertion=!1})}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}};nf._$name="InsertAction";var af=Symbol("STORE_PROP"),of=Symbol("MODEL_LIST_PROP"),lf=Symbol("CONTEXT_PROP"),cf=class extends Ht{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[af]}set store(e){this[af]=e}get modelList(){return this[of]}set modelList(e){this[of]=e.slice(0)}get context(){return this[lf]}set context(e){this[lf]=e}undo(){const{store:e,context:s,modelList:t,silent:n}=this;t.sort((r,i)=>{const a=s.get(r),o=s.get(i);return a-o}),t.forEach(r=>{const i=s.get(r);e.insert(i,r,n)})}redo(){this.store.remove(this.modelList,this.silent)}};cf._$name="RemoveAction";var uf=Symbol("STORE_PROP"),df=Symbol("ALL_RECORDS_PROP"),hf=class extends Ht{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[uf]}set store(e){this[uf]=e}get allRecords(){return this[df]}set allRecords(e){this[df]=e.slice(0)}undo(){const{store:e,allRecords:s,silent:t}=this;e.add(s,t)}redo(){this.store.removeAll(this.silent)}};hf._$name="RemoveAllAction";var yv=(e,s,t,n)=>new Di({model:e,newData:s,oldData:t,isInitialUserAction:n}),Sv=(e,s,t,n)=>new Gh({parentModel:e,childModels:t,insertIndex:s,context:n}),Dv=(e,s,t)=>new Jh({parentModel:e,childModels:s,context:t}),Cv=(e,s,t)=>new Xh({store:e,modelList:s,silent:t}),Ev=(e,s,t,n,r)=>new nf({store:e,insertIndex:s,modelList:t,context:n,silent:r}),bv=(e,s,t,n)=>new cf({store:e,modelList:s,context:t,silent:n}),Rv=(e,s,t)=>new hf({store:e,allRecords:s,silent:t}),we=(e,s,...t)=>{const n=e.state,r=s.call(e[ne],e,...t);if(typeof r=="string")e[ne]=$t.resolveStmState(r);else if(r instanceof dr)e[ne]=r;else if(Array.isArray(r)){const[i,a]=r;typeof i=="string"?e[ne]=$t.resolveStmState(i):i instanceof dr?e[ne]=i:i&&typeof i=="object"&&(e=Object.assign(e,i),e[ne]=$t.resolveStmState(e[ne])),typeof a=="function"&&we(e,a,...t)}else r&&typeof r=="object"&&(e=Object.assign(e,r),e[ne]=$t.resolveStmState(e[ne]));n!==Si&&n!==el&&r!==Si&&r!==el&&e.trigger("ready")},kr=class extends Vt($){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:yv,makeModelInsertChildAction:Sv,makeModelRemoveChildAction:Dv,makeStoreModelAddAction:Cv,makeStoreModelInsertAction:Ev,makeStoreModelRemoveAction:bv,makeStoreRemoveAllAction:Rv,getTransactionTitle:null}}construct(...e){Object.assign(this,{[ne]:Si,[hr]:[],[Xe]:[],[Rt]:0,[oe]:null,[yt]:null,[wt]:!1,[rn]:!1,stashedTransactions:{}}),super.construct(...e)}get state(){return this[ne]}get position(){return this[Rt]}get length(){return this[Xe].length}get stores(){return Array.from(this[hr])}hasStore(e){return this[hr].includes(e)}addStore(e){this.hasStore(e)||(this[hr].push(e),e.stm=this,e.forEach(s=>s.stm=this))}removeStore(e){this.hasStore(e)&&(this[hr]=this[hr].filter(s=>s!==e),e.stm=null,e.forEach(s=>s.stm=null))}forEachStore(e){this[hr].forEach(s=>e(s,s.id))}get disabled(){return this.state===dv}set disabled(e){const s=this;s.disabled!==e&&(e?we(s,s.state.onDisable,s):we(s,s.state.onEnable,s),s.trigger("stmDisabled",{disabled:e}),s.trigger("disabled",{disabled:e}))}get enabled(){return!this.disabled}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===Si||this.state===el}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===hv||this.state===vv}get isApplyingStash(){return this[rn]}get autoRecord(){return this[wt]}set autoRecord(e){const s=this;s.autoRecord!=e&&(e?we(s,s.state.onAutoRecordOn,s):we(s,s.state.onAutoRecordOff,s))}startTransaction(e=null){we(this,this.state.onStartTransaction,e)}stopTransaction(e=null){we(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){we(this,this.state.onStopTransactionDelayed)}rejectTransaction(){we(this,this.state.onRejectTransaction)}get transaction(){return this[oe]}get queue(){return this[Xe].map(e=>e.title)}get rawQueue(){return this[Xe]}get isRestoring(){return this.state===gv||this.isApplyingStash}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(e=1){this.isReady||await this.waitForReadiness(),we(this,this.state.onUndo,e)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(e=1){this.isReady||await this.waitForReadiness(),we(this,this.state.onRedo,e)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){we(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore(s=>{var t;return(t=s.onStmRecordingStart)==null?void 0:t.call(s,this,e)}),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,s){this.forEachStore(t=>{var n;return(n=t.onStmRecordingStop)==null?void 0:n.call(t,this,e,s)}),this.trigger("recordingStop",{stm:this,transaction:e,reason:s})}notifyStoresAboutStateRestoringStart(){this.forEachStore(e=>{var s;return(s=e.onStmRestoringStart)==null?void 0:s.call(e,this)}),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop({cause:e,transactions:s}){this.forEachStore(t=>{var n;return(n=t.onStmRestoringStop)==null?void 0:n.call(t,this)}),this.trigger("restoringStop",{stm:this,cause:e,transactions:s})}notifyStoresAboutQueueReset(e){this.forEachStore(s=>{var t;return(t=s.onStmQueueReset)==null?void 0:t.call(s,this,e)}),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,s,t,n){we(this,this.state.onModelUpdate,e,s,t,n)}onModelInsertChild(e,s,t,n){we(this,this.state.onModelInsertChild,e,s,t,n)}onModelRemoveChild(e,s,t){we(this,this.state.onModelRemoveChild,e,s,t)}onStoreModelAdd(e,s,t){we(this,this.state.onStoreModelAdd,e,s,t)}onStoreModelInsert(e,s,t,n,r){we(this,this.state.onStoreModelInsert,e,s,t,n,r)}onStoreModelRemove(e,s,t,n){we(this,this.state.onStoreModelRemove,e,s,t,n)}onStoreRemoveAll(e,s,t){we(this,this.state.onStoreRemoveAll,e,s,t)}onUndoKeyPress(e){const s=this;s.enabled&&(e.shiftKey?s.canRedo&&(e.preventDefault(),s.redo()):s.canUndo&&(e.preventDefault(),s.undo()))}stash(){const e=this;if(this.transaction){const s=Io.generateId("_stashedTransactionGeneratedId_");return e.stashedTransactions[s]=e.transaction,e.rejectTransaction(),s}}applyStash(e){const s=this,t=s.stashedTransactions[e];s[rn]=!0,t&&(s.startTransaction(t.title),t.redo(),delete s.stashedTransactions[e]),s[rn]=!1}};kr._$name="StateTrackingManager";var sn=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},ff=class extends O([ni],e=>{const s=e.prototype;class t extends e{*calculateUnitsInMs(){const r=yield this.$.hoursPerDay,i=yield this.$.daysPerWeek,a=yield this.$.daysPerMonth;return{millisecond:1,second:1e3,minute:60*1e3,hour:60*60*1e3,day:r*60*60*1e3,week:i*r*60*60*1e3,month:a*r*60*60*1e3,quarter:3*a*r*60*60*1e3,year:4*3*a*r*60*60*1e3}}convertDuration(r,i,a){let o=r;return i!==a&&(o=r*this.unitsInMs[i]/this.unitsInMs[a]),o}*$convertDuration(r,i,a){if(!i||!a)throw new Error("Conversion unit not provided");const o=yield this.$.unitsInMs;let l=r;return i!==a&&(l=r*o[i]/o[a]),l}}return sn([q()],t.prototype,"unitsInMs",void 0),sn([N({type:"number",defaultValue:24})],t.prototype,"hoursPerDay",void 0),sn([N({type:"number",defaultValue:7})],t.prototype,"daysPerWeek",void 0),sn([N({type:"number",defaultValue:30})],t.prototype,"daysPerMonth",void 0),sn([j("unitsInMs")],t.prototype,"calculateUnitsInMs",null),t}){},gf=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Ci=class extends O([cs],e=>{const s=e.prototype;class t extends e{}return gf([qe({bucket:"assigned",resolver:function(n){return this.getEventById(n)},modelFieldConfig:{serialize:n=>n==null?void 0:n.id,isEqual:ar,persist:!1}},Tr)],t.prototype,"event",void 0),gf([qe({bucket:"assigned",resolver:function(n){return this.getResourceById(n)},modelFieldConfig:{serialize:n=>n==null?void 0:n.id,isEqual:ar,persist:!1}},Tr)],t.prototype,"resource",void 0),ti(t),t}){},rl=class extends O([mt],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(r,i){this.assignmentsForRemoval=vo(r).toSet();const a=s.remove.call(this,r,i);return this.assignmentsForRemoval.clear(),a}removeAll(r){this.allAssignmentsForRemoval=!0;const i=s.removeAll.call(this,r);return this.allAssignmentsForRemoval=!1,i}}return t}){},sl=class extends O([rl,_r],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=100}static get defaultConfig(){return{modelClass:Ci}}set data(r){this.allAssignmentsForRemoval=!0,super.data=r,this.allAssignmentsForRemoval=!1}}return t}){},nl=class extends O([mt],e=>{const s=e.prototype;class t extends e{doDestroy(){var r;const i=[];(r=this.rootNode)!=null&&r.isDestroyed||this.traverse(a=>i.push(a)),super.doDestroy(),i.forEach(a=>a.destroy())}}return t}){},il=class extends O([nl,_r],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=500}static get defaultConfig(){return{tree:!0,modelClass:ds}}}return t}){},al=class extends O([mt],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(r,i){this.dependenciesForRemoval=vo(r).toSet();const a=s.remove.call(this,r,i);return this.dependenciesForRemoval.clear(),a}removeAll(r){this.allDependenciesForRemoval=!0;const i=s.removeAll.call(this,r);return this.allDependenciesForRemoval=!1,i}}return t}){},ol=class extends O([al,_r],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=200}set data(r){this.allDependenciesForRemoval=!0,super.data=r,this.allDependenciesForRemoval=!1}}return t}){},wv=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Ei=class extends O([hi,cs],e=>{const s=e.prototype;class t extends e{get assignments(){return[...this.assigned]}leaveProject(r=!1){if(!this.isStmRestoring&&this.assigned&&!r){const i=this.getResourceStore();this.assigned.forEach(a=>i.assignmentsForRemoval.add(a))}s.leaveProject.call(this)}static get fields(){return[{name:"parentId"},{name:"children",persist:!1}]}}return wv([qe({},Or)],t.prototype,"assigned",void 0),t}){},Iv={splice:1,clear:1},ll=class extends O([mt],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(r){var i;const a=Iv[r.action];super.onDataChange(r),a&&((i=r.removed)!=null&&i.length)&&this.afterResourceRemoval()}remove(r,i){const a=s.remove.call(this,r,i);return this.afterResourceRemoval(),a}removeAll(r){const i=s.removeAll.call(this,r);return this.afterResourceRemoval(),i}afterResourceRemoval(){const r=this.getAssignmentStore();if(r&&!r.allAssignmentsForRemoval){const i=[...this.assignmentsForRemoval].filter(a=>!r.assignmentsForRemoval.has(a));i.length>0&&r.remove(i)}this.assignmentsForRemoval.clear()}processRecord(r,i=!1){const a=this.getById(r.id);if(a&&a!==r)for(const l of a.assigned||[])l.resource=r;return r}}return t}){},cl=class extends O([ll,_r],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=300}static get defaultConfig(){return{modelClass:Ei}}}return t}){},Pv=class extends O([],Vt){},Mv=class extends O([],Ar){},pf=class extends O([Pv,Mv,H],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(r={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const i="silenceInitialCommit"in r?r.silenceInitialCommit:!0,a="adjustDurationToDST"in r?r.adjustDurationToDST:!1;this.maxCalendarRange="maxCalendarRange"in r?r.maxCalendarRange:15768e7,delete r.maxCalendarRange,delete r.silenceInitialCommit,delete r.adjustDurationToDST,s.construct.call(this,r),this.silenceInitialCommit=i,this.adjustDurationToDST=a}repopulateStore(r){}repopulateReplica(){}deferUntilRepopulationIfNeeded(r,i,a){i(...a)}attachStore(r){}detachStore(r){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}return t}){},mf=class extends O([ni,pf],e=>{const s=e.prototype;class t extends e{get isDelayingCalculation(){return!!(this.delayEnteringReplica||this.delayedCalculationPromise)}getGraph(){return this.replica}beforeCommitAsync(){return null}enterReplica(r){}acceptChanges(){}async commitAsync(){var r;return this.delayedCalculationPromise||((r=this.replica)==null?void 0:r.commitAsync())}getSchedulingIssueEventArguments(r,i,a,o){const l=[r.type,{continueWithResolutionResult:a,schedulingIssue:r}];return r instanceof cr&&(l[1].conflict=r),l}async onSchedulingIssueCall(r,i){return r.type&&this.hasListener(r.type)?new Promise((a,o)=>{this.trigger(...this.getSchedulingIssueEventArguments(r,i,a,o))}):bt.Cancel}async onCycleSchedulingIssue(r,i){return this.onSchedulingIssueCall(r,i)}async onEmptyCalendarSchedulingIssue(r,i){return this.onSchedulingIssueCall(r,i)}async onConflictSchedulingIssue(r,i){return this.onSchedulingIssueCall(r,i)}setModelCalculations(r,i){if(!i)return;const a={};for(const o in i)a[o]=r.prototype.$calculations[o];return Object.assign(r.prototype.$calculations,i),a}setRecordCalculations(r,i){const a=this.setModelCalculations(r.constructor,i),o=r.$entity.$skeleton;return Object.keys(i).forEach(l=>{o[l].prototype.calculation=r[i[l]]}),a}setStoreCalculations(r,i){if(!i)return;const a=r.first;return a?this.setRecordCalculations(a,i):this.setModelCalculations(r.modelClass,i)}async setCalculations(r){this.replica&&await this.commitAsync();const i={},a={tasks:this.eventStore,events:this.eventStore,dependencies:this.dependencyStore,resources:this.resourceStore,assignments:this.assignmentStore,calendars:this.calendarManagerStore};Object.keys(a).forEach(l=>{r[l]&&(i[l]=this.setStoreCalculations(a[l],r[l]))});let o=r.project;return o&&(i.project=this.setRecordCalculations(this,o)),this.replica&&this.repopulateReplica.now(),this.replica&&await this.commitAsync(),i}}return t}){},nn=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},ul=class extends O([cs],e=>{const s=e.prototype;class t extends e{get isValid(){const{$:r,graph:i}=this;return i&&(!i.hasIdentifier(r.fromEvent)||!i.hasIdentifier(r.toEvent))?!1:super.isValid}}return nn([qe({bucket:"outgoingDeps",resolver:function(n){return this.getEventById(n)},modelFieldConfig:{persist:!0,serialize:n=>n==null?void 0:n.id,isEqual:ar}},Tr)],t.prototype,"fromEvent",void 0),nn([qe({bucket:"incomingDeps",resolver:function(n){return this.getEventById(n)},modelFieldConfig:{persist:!0,serialize:n=>n==null?void 0:n.id,isEqual:ar}},Tr)],t.prototype,"toEvent",void 0),nn([N({type:"int",defaultValue:_e.EndToStart})],t.prototype,"type",void 0),nn([N({type:"string"})],t.prototype,"fromSide",void 0),nn([N({type:"string"})],t.prototype,"toSide",void 0),t}){},vf=class{constructor(){this.ongoing=Promise.resolve(),this.handleReject=()=>{}}queue(e,s=this.handleReject){const t=this.ongoing.then(e);return this.ongoing=t.catch(s),t}};vf._$name="Queue";var bi=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},yf=class extends $a([mf,or,mi,hi,ff,Dh],e=>{const s=e.prototype;class t extends e{construct(r={}){this.delayCalculation=r.delayCalculation!==!1,this.enableProgressNotifications=r.enableProgressNotifications||r.delayCalculation!==!1,this._queue=new vf,"expanded"in r||(r.expanded=!0),this.delayCalculation&&(this.delayEnteringReplica=!0),"skipNonWorkingTimeWhenSchedulingManually"in r||(r.skipNonWorkingTimeWhenSchedulingManually=!1),s.construct.call(this,r),this.repopulateStores=new Set,this.ignoreInitialCommitComputationCycles="ignoreInitialCommitComputationCycles"in r?r.ignoreInitialCommitComputationCycles:!1,this.ignoreInitialCommitComputationCycles&&console.warn('Project "ignoreInitialCommitComputationCycles" option is deprecated and will be dropped in the next major release'),this.eventModelClass||(this.eventModelClass=this.getDefaultEventModelClass()),this.eventStoreClass||(this.eventStoreClass=this.getDefaultEventStoreClass()),this.dependencyModelClass||(this.dependencyModelClass=this.getDefaultDependencyModelClass()),this.dependencyStoreClass||(this.dependencyStoreClass=this.getDefaultDependencyStoreClass()),this.resourceModelClass||(this.resourceModelClass=this.getDefaultResourceModelClass()),this.resourceStoreClass||(this.resourceStoreClass=this.getDefaultResourceStoreClass()),this.assignmentModelClass||(this.assignmentModelClass=this.getDefaultAssignmentModelClass()),this.assignmentStoreClass||(this.assignmentStoreClass=this.getDefaultAssignmentStoreClass()),this.calendarModelClass||(this.calendarModelClass=this.getDefaultCalendarModelClass()),this.calendarManagerStoreClass||(this.calendarManagerStoreClass=this.getDefaultCalendarManagerStoreClass()),this.cycleEffectClass||(this.cycleEffectClass=this.getDefaultCycleEffectClass()),this.initializeStm(),this.defaultCalendar=new this.calendarModelClass({unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this,this.delayEnteringReplica||this.enterReplica(!1),this.setCalendarManagerStore(this.calendarManagerStore),this.setEventStore(this.eventStore),this.setDependencyStore(this.dependencyStore),this.setResourceStore(this.resourceStore),this.setAssignmentStore(this.assignmentStore),!!(this.calendarsData||this.eventsData||this.dependenciesData||this.resourcesData||this.assignmentsData)?(this.loadInlineData({calendarsData:this.calendarsData,eventsData:this.eventsData,dependenciesData:this.dependenciesData,resourcesData:this.resourcesData,assignmentsData:this.assignmentsData}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData):this.delayCalculation&&this.hasDataInStores&&this.scheduleDelayedCalculation()}get hasDataInStores(){return[this.calendarManagerStore,this.eventStore,this.dependencyStore,this.resourceStore,this.assignmentStore].some(r=>r.allCount>0)}enterReplica(r){const i=this;i.replica||(i.replica=i.createReplica(),i.replica.addEntity(i),i.replica.addEntity(i.defaultCalendar),i.trigger("graphReady")),r&&!i.isRepopulatingStores&&(i.calendarManagerStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),i.eventStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),i.resourceStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),i.dependencyStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),i.assignmentStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}))}resetStmQueue(){const r=this.stm.disabled;this.stm.disable(),this.stm.resetQueue(),r||this.stm.enable()}doDestroy(){var r,i,a,o,l,c,u,d;const h=this;(r=h.eventStore)==null||r.destroy(),(i=h.dependencyStore)==null||i.destroy(),(a=h.assignmentStore)==null||a.destroy(),(o=h.resourceStore)==null||o.destroy(),(l=h.calendarManagerStore)==null||l.destroy(),(c=h.defaultCalendar)==null||c.destroy(),(u=h.replica)==null||u.clear(),(d=h.stm)==null||d.destroy(),s.doDestroy.call(this)}getReplicaConfig(){return{project:this,schema:xh.new(),enableProgressNotifications:this.enableProgressNotifications,silenceInitialCommit:this.silenceInitialCommit,ignoreInitialCommitComputationCycles:this.ignoreInitialCommitComputationCycles,cycleEffectClass:this.cycleEffectClass,onWriteDuringCommit:"ignore",readMode:Lt.CurrentOrProposedOrPrevious}}createReplica(){return wh.mix(Na).new(this.getReplicaConfig())}*hasSubEvents(){return this.getEventStore().count>0}*subEventsIterable(){return this.getEventStore().getRange()}getType(){return ts.SchedulerBasic}get enableProgressNotifications(){return this._enableProgressNotifications}set enableProgressNotifications(r){this._enableProgressNotifications=r,this.replica&&(this.replica.enableProgressNotifications=r)}getDefaultCycleEffectClass(){return jr}getDefaultEventModelClass(){return fi}getDefaultEventStoreClass(){return tn}getDefaultDependencyModelClass(){return ul}getDefaultDependencyStoreClass(){return ol}getDefaultResourceModelClass(){return Ei}getDefaultResourceStoreClass(){return cl}getDefaultAssignmentModelClass(){return Ci}getDefaultAssignmentStoreClass(){return sl}getDefaultCalendarModelClass(){return ds}getDefaultCalendarManagerStoreClass(){return il}usingSyncDataOnLoad(){return[this.eventStore,this.resourceStore,this.dependencyStore,this.assignmentStore].some(r=>r.syncDataOnLoad)}async loadInlineData(r){const{calendarManagerStore:i,eventStore:a,dependencyStore:o,assignmentStore:l,resourceStore:c,replica:u}=this;if(!this.isInitialCommitPerformed)u==null||u.unScheduleAutoCommit();else for(;this.replica.isCommitting;)await this.commitAsync();u!=null&&u.enableProgressNotifications&&!this.delayCalculation&&(await bs(0),await this.commitAsync(),u.onPropagationProgressNotification({total:0,remaining:0,phase:"storePopulation"}),await bs(50)),this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!0,globalThis.DEBUG&&(console.log("%cInitializing project","font-weight:bold;color:darkgreen;text-transform:uppercase;margin-top: 2em"),console.time("Time to visible"),console.time("Populating project")),this.delayCalculation&&!this.delayedCalculationPromise&&!this.usingSyncDataOnLoad()&&this.scheduleDelayedCalculation(),r.calendarsData&&(this.repopulateStore(i),i.data=r.calendarsData),(r.eventsData||r.tasksData)&&(this.repopulateStore(a),a.data=r.eventsData||r.tasksData),r.dependenciesData&&(this.repopulateStore(o),o.data=r.dependenciesData),r.resourcesData&&(this.repopulateStore(c),c.data=r.resourcesData),r.assignmentsData&&(this.repopulateStore(l),l.data=r.assignmentsData),r.project&&this.applyProjectResponse(r.project),globalThis.DEBUG&&console.timeEnd("Populating project");const d=await this.commitLoad();return this.isLoadingInlineData=!1,d}setupTemporaryIndices(){const{storage:r}=this.assignmentStore||{};r&&(r.addIndex({property:"event",unique:!1}),r.addIndex({property:"resource",unique:!1}))}removeTemporaryIndices(){const{storage:r}=this.assignmentStore;r.removeIndex("event"),r.removeIndex("resource")}async internalDelayCalculation(r){const i=this;if(i.delayEnteringReplica=!0,i.setupTemporaryIndices(),await bs(0),i.isDestroyed){r();return}if(i.trigger("delayCalculationStart"),i.trigger("refresh",{isCalculated:!1}),await bs(0),i.isDestroyed){r();return}i.delayEnteringReplica=!1,i.isRepopulatingStores?i.repopulateReplica.now():(i.trigger("recordsUnlinked"),i.enterReplica(!0));const a=await i.replica.commitAsync();if(i.isDestroyed){r();return}r(a),i.delayedCalculationPromise=null,i.trigger("delayCalculationEnd"),i.removeTemporaryIndices()}scheduleDelayedCalculation(){if(this.delayedCalculationPromise)return this.delayedCalculationPromise;if(this.delayCalculation!==!1)return this.delayedCalculationPromise=new Promise(r=>this.internalDelayCalculation(r).then())}async commitLoad(){const r=await this.commitAsync();return this.isDestroyed||this.trigger("load"),r}initializeStm(){const r=this.stmClass||kr;this.stm instanceof kr||this.setStm(r.new({disabled:!0},this.stm)),this.resetUndoRedoQueuesAfterLoad&&this.ion({load:this.resetStmQueue,thisObj:this}),this.ion({beforeCommit:this.onCommitInitialization,commitFinalized:this.onCommitFinalization,commitRejected:this.onCommitRejection,thisObj:this})}removeRejectedRecordsAdd({transactionResult:r,silenceCommit:i}){var a,o,l;const c=new Map;for(const d of r.entries.values()){const h=d.identifier,{field:f}=h;if(d.isShadow()||!h[Xn]||f instanceof Or)continue;const g=h.self,p=g.firstStore;p&&!d.previous&&!((a=r.transaction.getLatestStableEntryFor(g.$$))!=null&&a.previous)&&(c.has(p)?c.get(p).has(g)||c.get(p).add(g):c.set(p,new Set([g])))}(o=this.suspendChangesTracking)==null||o.call(this),Array.from(c.keys()).sort((d,h)=>d.removalOrder-h.removalOrder).forEach(d=>d.remove(c.get(d))),(l=this.resumeChangesTracking)==null||l.call(this,i),i&&(this.eventStore.acceptChanges(),this.dependencyStore.acceptChanges(),this.resourceStore.acceptChanges(),this.assignmentStore.acceptChanges(),this.calendarManagerStore.acceptChanges())}onCommitRejection(r){this._stmDisabled?(this.replica.isWritingPreviousData=!0,this.isRestoringData=!0,this.removeRejectedRecordsAdd(r),this.isRestoringData=!1,this.replica.isWritingPreviousData=!1):this.rejectStmTransaction()}onCommitInitialization(){const{stm:r}=this;this._stmDisabled=r.disabled,r.isRecording&&r.autoRecord&&(this._stmAutoRecord=!0,r.autoRecord=!1)}onCommitFinalization(){this._stmAutoRecord&&(this.stm.autoRecord=!0,this._stmAutoRecord=!1)}onSTMRestoringStart({source:r}){this.replica&&(this.replica.isWritingPreviousData=!0)}async onSTMRestoringStop({source:r}){this.replica&&(this.replica.isWritingPreviousData=!1);const i=r;i.disable(),await this.commitAsync(),this.isDestroyed||(i.enable(),this.trigger("stateRestoringDone"))}deferUntilRepopulationIfNeeded(r,i,a){this.isRepopulatingStores?(this.detachListeners(r),this.ion({name:r,repopulateReplica:{fn:async()=>{await this.commitAsync(),this.isDestroyed||i(...a)},once:!0}})):i(...a)}get isRepopulatingStores(){var r;return!!((r=this.repopulateStores)!=null&&r.size)}repopulateStore(r){var i;const a=this;a.repopulateOnDataset&&r.allCount&&!r.syncDataOnLoad&&((i=a.replica)==null||i.activeTransaction.stop(),a.repopulateStores||(a.repopulateStores=new Set),a.repopulateStores.add(r),a.repopulateReplica())}repopulateReplica(){const r=this;if(r.delayEnteringReplica)return;const{calendarManagerStore:i,eventStore:a,dependencyStore:o,assignmentStore:l,resourceStore:c,replica:u}=r;u?(r.unlinkStoreRecords(i,a,o,c,l),r.unlinkRecord(r),r.unlinkRecord(r.defaultCalendar),r.trigger("recordsUnlinked"),u.clear()):r.trigger("recordsUnlinked");const d=r.replica=r.createReplica();d.addEntity(r),d.addEntity(r.defaultCalendar),r.joinStoreRecords(i,!0),r.joinStoreRecords(a,!0),r.joinStoreRecords(o,!0),r.joinStoreRecords(c,!0),r.joinStoreRecords(l,!0),r.repopulateStores.clear(),r.trigger("repopulateReplica")}beforeCommitAsync(){return this.repopulateReplica.isPending&&!this.isDelayingCalculation?(this.repopulateReplica.now(),this.replica.commitAsync()):null}unlinkRecord(r){var i;if(r!=null&&r.graph){const{activeTransaction:a}=this.replica,{$:o}=r,l=Object.keys(o);for(let c=0;c<l.length;c++){const u=l[c],d=o[u],h=a.getLatestEntryFor(d);if(h){let f=h.getValue();f===void 0&&(f=h.proposedValue),f!==void 0&&(d.DATA=d.field instanceof Tr&&(i=f==null?void 0:f.id)!=null?i:f)}}r.graph=null}}unlinkStoreRecords(...r){r.forEach(i=>{(!this.repopulateStores.has(i)||i.syncDataOnLoad)&&i.traverse(a=>{this.unlinkRecord(a)},!1,!1,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})})}getGraph(){return this.replica}async addEvents(r){return this.eventStore.add(r),this.commitAsync()}async addEvent(r){return this.eventStore.add(r),this.commitAsync()}includeEvent(r){this.eventStore.add(r)}async removeEvents(r){return this.eventStore.remove(r),this.commitAsync()}excludeEvent(r){this.eventStore.remove(r)}async removeEvent(r){return this.eventStore.remove(r),this.commitAsync()}getStm(){return this.stm}setStm(r){this.stm=r,this.stm.ion({restoringStart:this.onSTMRestoringStart,restoringStop:this.onSTMRestoringStop,thisObj:this})}calculateProject(){return this}*calculateEffectiveCalendar(){let r=yield this.$.calendar;return r?yield r.$.version:r=this.defaultCalendar,r}joinStoreRecords(r,i=!1){const a=o=>{o.setProject(this),o.joinProject()};r.rootNode?r.rootNode.traverse(a,i,!0):r.forEach(a,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}unjoinStoreRecords(r){const i=a=>{a.leaveProject(),a.setProject(this)};r.rootNode?r.rootNode.traverse(a=>{a!==r.rootNode&&i(a)},!1,!0):r.forEach(i,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}setEventStore(r){const i=this.eventStore;if(i&&this.stm.hasStore(i)){this.stm.removeStore(i),this.unjoinStoreRecords(i),this.detachStore(i);const a=i.assignmentsForRemoval;a.forEach(o=>{const l=o.event;if(l){const c=r.getById(l.id);c&&(o.event=c,a.delete(o))}}),i.afterEventRemoval()}if(!r||!(r instanceof K)){const a=(r==null?void 0:r.storeClass)||this.eventStoreClass;this.eventStore=new a(x.assign({modelClass:this.eventModelClass,project:this,stm:this.stm},r||{}))}else this.eventStore=r,r.setProject(this),this.stm.addStore(r),r.tree&&r.rootNode!==this?(this.appendChild(r.rootNode.children||[]),r.rootNode=this):this.joinStoreRecords(r);this.attachStore(this.eventStore),this.trigger("eventStoreChange",{store:this.eventStore})}setDependencyStore(r){const i=this.dependencyStore;if(i&&this.stm.hasStore(i)&&(this.stm.removeStore(i),this.detachStore(i)),!r||!(r instanceof K)){const a=(r==null?void 0:r.storeClass)||this.dependencyStoreClass;this.dependencyStore=new a(x.assign({modelClass:this.dependencyModelClass,project:this,stm:this.stm},r||{}))}else this.dependencyStore=r,r.setProject(this),this.stm.addStore(r),this.joinStoreRecords(r);this.attachStore(this.dependencyStore),this.trigger("dependencyStoreChange",{store:this.dependencyStore})}setResourceStore(r){const i=this.resourceStore;if(i&&this.stm.hasStore(i)){this.stm.removeStore(i),this.unjoinStoreRecords(i),this.detachStore(i);const a=i.assignmentsForRemoval;a.forEach(o=>{const l=o.resource;if(l){const c=r.getById(l.id);c&&(o.resource=c,a.delete(o))}}),i.afterResourceRemoval()}if(!r||!(r instanceof K)){const a=(r==null?void 0:r.storeClass)||this.resourceStoreClass;this.resourceStore=new a(x.assign({modelClass:this.resourceModelClass,project:this,stm:this.stm},r||{}))}else this.resourceStore=r,r.setProject(this),this.stm.addStore(r),this.joinStoreRecords(r);this.attachStore(this.resourceStore),this.trigger("resourceStoreChange",{store:this.resourceStore})}setAssignmentStore(r){const i=this.assignmentStore;if(i&&this.stm.hasStore(i)&&(this.stm.removeStore(i),this.unjoinStoreRecords(i),this.detachStore(i)),!r||!(r instanceof K)){const a=(r==null?void 0:r.storeClass)||this.assignmentStoreClass;this.assignmentStore=new a(x.assign({modelClass:this.assignmentModelClass,project:this,stm:this.stm},r||{}))}else this.assignmentStore=r,r.setProject(this),this.stm.addStore(r),this.joinStoreRecords(r);this.isDelayingCalculation&&this.setupTemporaryIndices(),this.attachStore(this.assignmentStore),this.trigger("assignmentStoreChange",{store:this.assignmentStore})}setCalendarManagerStore(r){const i=this.calendarManagerStore;if(i&&this.stm.hasStore(i)&&(this.stm.removeStore(i),this.detachStore(i)),!r||!(r instanceof K)){const a=(r==null?void 0:r.storeClass)||this.calendarManagerStoreClass;this.calendarManagerStore=new a(x.assign({modelClass:this.calendarModelClass,project:this,stm:this.stm},r||{}))}else this.calendarManagerStore=r,r&&(r.setProject(this),this.stm.addStore(r),this.joinStoreRecords(r));this.attachStore(this.calendarManagerStore),this.trigger("calendarManagerStoreChange",{store:this.calendarManagerStore})}async isValidDependency(...r){return!0}rejectStmTransaction(r){r=r||this.stm,r.transaction&&(r.transaction.length?(r.forEachStore(i=>i.beginBatch()),r.rejectTransaction(),r.forEachStore(i=>i.endBatch())):r.stopTransaction())}async tryPropagateWithChanges(r){const i=this.stm,a=i.disabled,o=i.autoRecord;return this.queue(async()=>{a?i.enable():(o&&(i.autoRecord=!1),i.isRecording&&i.stopTransaction()),i.startTransaction(),r();let l=!0;try{l=!(await this.commitAsync()).rejectedWith}catch(c){if(!/cycle/i.test(c))throw c;l=!1}return l?(i.stopTransaction(),a&&i.resetQueue()):(this.replica.reject(),this.rejectStmTransaction(i)),i.disabled=a,i.autoRecord=o,l})}queue(r,i){return this._queue.queue(function(){return r()},i)}isEngineReady(){const{replica:r}=this;return this.delayEnteringReplica||!this.isRepopulatingStores&&(r?!(r.dirty&&(r.hasPendingAutoCommit()||r.isCommitting)):!0)}static get defaultConfig(){return{assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null,eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null,calendarManagerStore:null,eventModelClass:null,resourceModelClass:null,assignmentModelClass:null,dependencyModelClass:null,calendarModelClass:null,repopulateOnDataset:!0}}static get delayable(){return{repopulateReplica:10}}}return t.applyConfigs=!0,bi([N({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),bi([N({type:"boolean",defaultValue:!1})],t.prototype,"skipNonWorkingTimeWhenSchedulingManually",void 0),bi([N({type:"boolean",defaultValue:!0})],t.prototype,"skipNonWorkingTimeInDurationWhenSchedulingManually",void 0),bi([N({type:"string",defaultValue:L.Forward},{sync:!0})],t.prototype,"direction",void 0),t}){},le=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Sf=function*(e,s,t,n,r){if(t.isIntervalEmpty())return t;if(r&&t.intersectionOf){const o=new Set;for(const l of t.intersectionOf)if(l.isInfinite())o.add(l);else{const c=l.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.startDate,!1,n):l.startDate,u=l.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.endDate,!1,n):l.endDate,d=l;o.add(d.copyWith({reflectionOf:d,side:d.side===ce.Start?ce.End:ce.Start,startDate:c,endDate:u}))}t.intersectionOf=o}const i=t.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.startDate,!1,n):null,a=t.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.endDate,!1,n):null;return lr([s,ur.new({intersectionOf:t.intersectionOf,startDate:i,endDate:a})],r)},Df=function*(e,s,t,n,r){if(s.isIntervalEmpty())return s;if(r){const o=new Set;for(const l of s.intersectionOf)if(l.isInfinite())o.add(l);else{const c=l.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.startDate,!0,n):l.startDate,u=l.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.endDate,!0,n):l.endDate,d=l;o.add(d.copyWith({reflectionOf:d,side:d.side===ce.Start?ce.End:ce.Start,startDate:c,endDate:u}))}s.intersectionOf=o}const i=s.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(s.startDate,!0,n):null,a=s.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(s.endDate,!0,n):null;return lr([t,ur.new({reflectionOf:i||a?s:void 0,intersectionOf:i||a?s.intersectionOf:void 0,startDate:i,endDate:a})],r)},Ee=!0,Lr=class extends O([mi],e=>{const s=e.prototype;class t extends e{*maybeSkipNonWorkingTime(r,i=!0){if(yield*this.hasSubEvents())return r;let a=yield*this.calculateEffectiveDuration();return r&&a>0?yield*this.skipNonWorkingTime(r,i):r}*calculateEffectiveConstraintInterval(r,i,a,o=!1){const l=yield*this.calculateEffectiveDuration();return l==null?null:yield*(r?Sf:Df)(this,lr(i,o),lr(a,o),l,o)}*calculateStartDateConstraintIntervals(){return[]}*calculateEndDateConstraintIntervals(){return[]}*calculateEarlyStartDateConstraintIntervals(){return[]}*calculateEarlyEndDateConstraintIntervals(){return[]}*doCalculateEarlyEffectiveStartDateInterval(r=!1){const i=yield this.$.earlyStartDateConstraintIntervals,a=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!0,i.concat(yield this.$.startDateConstraintIntervals),a.concat(yield this.$.endDateConstraintIntervals),r)}*calculateEarlyEffectiveStartDateInterval(){return yield*this.doCalculateEarlyEffectiveStartDateInterval()}*doCalculateEarlyEffectiveEndDateInterval(r=!1){const i=yield this.$.earlyStartDateConstraintIntervals,a=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!1,i.concat(yield this.$.startDateConstraintIntervals),a.concat(yield this.$.endDateConstraintIntervals),r)}*calculateEarlyEffectiveEndDateInterval(){return yield*this.doCalculateEarlyEffectiveEndDateInterval()}*shouldRollupChildEarlyStartDate(r){return!0}*calculateMinChildrenEarlyStartDate(){let r=ae;const i=yield*this.subEventsIterable();for(let a of i){let o;(yield*this.shouldRollupChildEarlyStartDate(a))&&((yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.minChildrenEarlyStartDate),o=o||(yield a.$.earlyStartDate),o&&o<r&&(r=o))}return r.getTime()-ae.getTime()?r:null}*shouldRollupChildEarlyEndDate(r){return!0}*calculateMaxChildrenEarlyEndDate(){let r=he;const i=yield*this.subEventsIterable();for(let a of i){let o;(yield*this.shouldRollupChildEarlyEndDate(a))&&((yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.maxChildrenEarlyEndDate),o=o||(yield a.$.earlyEndDate),o&&o>r&&(r=o))}return r.getTime()-he.getTime()?r:null}*calculateEarlyStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Forward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenEarlyStartDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.startDate;let r=yield this.$.earlyEffectiveStartDateInterval;if(r===null)return null;if(r.isIntervalEmpty()){r=yield*this.doCalculateEarlyEffectiveStartDateInterval(!0);const i=cr.new({intervals:[...r.intersectionOf]});if((yield i)===bt.Cancel)yield kt(i);else return null}return Nt(r.startDate)?r.startDate:null}*calculateEarlyStartDate(){const r=yield this.$.earlyStartDateRaw;return yield*this.maybeSkipNonWorkingTime(r,!0)}*calculateEarlyEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Forward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenEarlyEndDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.endDate;let r=yield this.$.earlyEffectiveEndDateInterval;if(r===null)return null;if(r.isIntervalEmpty()){r=yield*this.doCalculateEarlyEffectiveEndDateInterval(!0);const i=cr.new({intervals:[...r.intersectionOf]});if((yield i)===bt.Cancel)yield kt(i);else return null}return Nt(r.startDate)?r.startDate:null}*calculateEarlyEndDate(){return yield this.$.earlyEndDateRaw}*isConstrainedEarly(){const r=yield this.$.startDateConstraintIntervals,i=yield this.$.endDateConstraintIntervals,a=yield this.$.earlyStartDateConstraintIntervals,o=yield this.$.earlyEndDateConstraintIntervals;return!!(r!=null&&r.length||i!=null&&i.length||a!=null&&a.length||o!=null&&o.length)}*calculateStartDatePure(){return(yield this.$.effectiveDirection).direction===L.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*s.calculateStartDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():(yield this.$.earlyStartDate)||(yield*s.calculateStartDatePure.call(this)):yield*s.calculateStartDatePure.call(this)}*calculateStartDateProposed(){switch((yield this.$.effectiveDirection).direction){case L.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*s.calculateStartDateProposed.call(this);if(yield*this.hasSubEvents())return yield*this.calculateMinChildrenStartDate();const i=yield this.$.earlyStartDate;if(i){if(Nt(i))return i;const a=yield*s.calculateStartDateProposed.call(this),o=yield this.$.earlyEffectiveStartDateInterval;return o.containsDate(a)?a:Nt(o.endDate)?o.endDate:a}else return yield*s.calculateStartDateProposed.call(this);default:return yield*s.calculateStartDateProposed.call(this)}}*calculateEndDatePure(){return(yield this.$.effectiveDirection).direction===L.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*s.calculateEndDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():(yield this.$.earlyEndDate)||(yield*s.calculateEndDatePure.call(this)):yield*s.calculateEndDatePure.call(this)}*calculateEndDateProposed(){switch((yield this.$.effectiveDirection).direction){case L.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*s.calculateEndDateProposed.call(this);if(yield*this.hasSubEvents())return yield*this.calculateMaxChildrenEndDate();const i=yield this.$.earlyEndDate;if(i){if(Nt(i))return i;const a=yield*s.calculateEndDateProposed.call(this),o=yield this.$.earlyEffectiveEndDateInterval;return o.containsDate(a)?a:Nt(o.endDate)?o.endDate:a}else return yield*s.calculateEndDateProposed.call(this);default:return yield*s.calculateEndDateProposed.call(this)}}}return le([q({lazy:Ee})],t.prototype,"minChildrenEarlyStartDate",void 0),le([q({lazy:Ee})],t.prototype,"earlyStartDateRaw",void 0),le([N({type:"date",persist:!1},{lazy:Ee,converter:zt,persistent:!1})],t.prototype,"earlyStartDate",void 0),le([q({lazy:Ee})],t.prototype,"maxChildrenEarlyEndDate",void 0),le([q({lazy:Ee})],t.prototype,"earlyEndDateRaw",void 0),le([N({type:"date",persist:!1},{lazy:Ee,converter:zt,persistent:!1})],t.prototype,"earlyEndDate",void 0),le([q()],t.prototype,"startDateConstraintIntervals",void 0),le([q()],t.prototype,"endDateConstraintIntervals",void 0),le([q({lazy:Ee})],t.prototype,"earlyStartDateConstraintIntervals",void 0),le([q({lazy:Ee})],t.prototype,"earlyEndDateConstraintIntervals",void 0),le([q()],t.prototype,"earlyEffectiveStartDateInterval",void 0),le([q()],t.prototype,"earlyEffectiveEndDateInterval",void 0),le([j("startDateConstraintIntervals")],t.prototype,"calculateStartDateConstraintIntervals",null),le([j("endDateConstraintIntervals")],t.prototype,"calculateEndDateConstraintIntervals",null),le([j("earlyStartDateConstraintIntervals")],t.prototype,"calculateEarlyStartDateConstraintIntervals",null),le([j("earlyEndDateConstraintIntervals")],t.prototype,"calculateEarlyEndDateConstraintIntervals",null),le([j("earlyEffectiveStartDateInterval")],t.prototype,"calculateEarlyEffectiveStartDateInterval",null),le([j("earlyEffectiveEndDateInterval")],t.prototype,"calculateEarlyEffectiveEndDateInterval",null),le([j("minChildrenEarlyStartDate")],t.prototype,"calculateMinChildrenEarlyStartDate",null),le([j("maxChildrenEarlyEndDate")],t.prototype,"calculateMaxChildrenEarlyEndDate",null),le([j("earlyStartDateRaw")],t.prototype,"calculateEarlyStartDateRaw",null),le([j("earlyStartDate")],t.prototype,"calculateEarlyStartDate",null),le([j("earlyEndDateRaw")],t.prototype,"calculateEarlyEndDateRaw",null),le([j("earlyEndDate")],t.prototype,"calculateEarlyEndDate",null),t}){},fr=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},dl=class extends O([Lr,Gt],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.ignorePinningConstraint=!1}writeStartDate(r,i,a,o,l=!0){const c=this.getProject();if(c!=null&&c.addConstraintOnDateSet&&i.graph.hasIdentifier(this.$.effectiveDirection)&&!(c!=null&&c.eventStore.isSyncingDataOnLoad)&&!this.isReverting&&!(c!=null&&c.getStm().isRestoring)){const u=this.getStartDatePinConstraintType();u&&(this.constraintDate=o,this.constraintType=u)}return s.writeStartDate.call(this,r,i,a,o,l)}writeEndDate(r,i,a,o,l=!1){const c=this.getProject();if(c!=null&&c.addConstraintOnDateSet&&i.graph.hasIdentifier(this.$.direction)&&l&&!(c!=null&&c.eventStore.isSyncingDataOnLoad)&&!(c!=null&&c.getStm().isRestoring)){const u=this.getEndDatePinConstraintType();u&&(this.constraintDate=o,this.constraintType=u)}return s.writeEndDate.call(this,r,i,a,o,l)}writeConstraintType(r,i,a,o,l=!1){const c=this.getProject();!l&&!r.isWritingUndefined&&c.includeAsapAlapAsConstraints&&(o!==B.AsSoonAsPossible&&o!==B.AsLateAsPossible?i.baseRevision.hasIdentifier(r)&&this.$.direction.write.call(this,this.$.direction,i,void 0,null,!0):(this.$.direction.write.call(this,this.$.direction,i,void 0,o===B.AsSoonAsPossible?L.Forward:L.Backward,!0),this.$.constraintDate.write.call(this,this.$.constraintDate,i,void 0,null))),r.constructor.prototype.write.call(this,r,i,a,o)}writeDirection(r,i,a,o,l=!1){const c=this.getProject();!l&&!r.isWritingUndefined&&c.includeAsapAlapAsConstraints&&(o||i.baseRevision.hasIdentifier(r))&&this.$.constraintType.write.call(this,this.$.constraintType,i,void 0,o===L.Forward?B.AsSoonAsPossible:o===L.Backward?B.AsLateAsPossible:null,!0),r.constructor.prototype.write.call(this,r,i,a,o)}*calculateConstraintType(){let r=yield X;return(yield*this.isConstraintTypeApplicable(r))||(r=null),r}*calculateConstraintDate(r){let i=yield X;const a=yield this.$.constraintType;return a?i||(i=this.getConstraintTypeDefaultDate(r,a)):i=null,i}getStartDatePinConstraintType(){const{effectiveDirection:r}=this.project;if(!this.isTaskPinnableWithConstraint())return null;switch(r.direction){case L.Forward:return B.StartNoEarlierThan;case L.Backward:return B.StartNoLaterThan}}getEndDatePinConstraintType(){const{effectiveDirection:r}=this.project;if(!this.isTaskPinnableWithConstraint())return null;switch(r.direction){case L.Forward:return B.FinishNoEarlierThan;case L.Backward:return B.FinishNoLaterThan}}isTaskPinnableWithConstraint(){const{manuallyScheduled:r,ignorePinningConstraint:i,constraintType:a}=this;let o=!1;if(!r&&!i)if(a)switch(a){case B.AsSoonAsPossible:case B.AsLateAsPossible:case B.StartNoEarlierThan:case B.StartNoLaterThan:case B.FinishNoEarlierThan:case B.FinishNoLaterThan:o=!0}else o=!0;return o}applyChangeset(r,i,a){this.ignorePinningConstraint=a;const o=super.applyChangeset(r,i,a);return this.ignorePinningConstraint=!1,o}getConstraintTypeDefaultDate(r,i){switch(i){case B.StartNoEarlierThan:case B.StartNoLaterThan:case B.MustStartOn:return r(pe(this.$.startDate));case B.FinishNoEarlierThan:case B.FinishNoLaterThan:case B.MustFinishOn:return r(pe(this.$.endDate))}return null}*isConstraintTypeApplicable(r){const i=yield*this.hasSubEvents();switch(r){case B.FinishNoEarlierThan:case B.StartNoLaterThan:case B.MustFinishOn:case B.MustStartOn:return!i}return!0}async setConstraint(r,i){return this.constraintType=r,i!==void 0&&(this.constraintDate=i),this.commitAsync()}*calculateEndDateConstraintIntervals(){const r=yield*s.calculateEndDateConstraintIntervals.call(this),i=yield this.$.manuallyScheduled,a=yield this.$.constraintType,o=yield this.$.constraintDate,l=this.project.dateConstraintIntervalClass;if(!i&&a&&o)switch(a){case B.MustFinishOn:r.unshift(l.new({owner:this,side:ce.End,startDate:o,endDate:o}));break;case B.FinishNoEarlierThan:r.unshift(l.new({owner:this,side:ce.End,startDate:o}));break;case B.FinishNoLaterThan:r.unshift(l.new({owner:this,side:ce.End,endDate:o}));break}return r}*calculateStartDateConstraintIntervals(){const r=yield*s.calculateStartDateConstraintIntervals.call(this),i=yield this.$.manuallyScheduled,a=yield this.$.constraintType,o=yield this.$.constraintDate,l=this.project.dateConstraintIntervalClass;if(!i&&a&&o)switch(a){case B.MustStartOn:r.unshift(l.new({owner:this,side:ce.Start,startDate:o,endDate:o}));break;case B.StartNoEarlierThan:r.unshift(l.new({owner:this,side:ce.Start,startDate:o}));break;case B.StartNoLaterThan:r.unshift(l.new({owner:this,side:ce.Start,endDate:o}));break}return r}}return fr([N({type:"string"},{sync:!0})],t.prototype,"constraintType",void 0),fr([N({type:"date"},{converter:zt,sync:!0})],t.prototype,"constraintDate",void 0),fr([dt("constraintType")],t.prototype,"writeConstraintType",null),fr([dt("direction")],t.prototype,"writeDirection",null),fr([j("constraintType")],t.prototype,"calculateConstraintType",null),fr([j("constraintDate")],t.prototype,"calculateConstraintDate",null),t}){},Cf=class extends gt(pi){static get $name(){return"RemoveDateConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return pt(this.L("L{descriptionTpl}"),e.name||e.id,this.interval.getConstraintName(e.constraintType))}resolve(){this.event.constraintType=null}},Ef=class extends hs{static get $name(){return"DateConstraintIntervalDescription"}static getDescription(e){let s;switch(e.owner.constraintType){case B.StartNoEarlierThan:case B.FinishNoEarlierThan:case B.MustStartOn:case B.MustFinishOn:s=this.L("L{startDateDescriptionTpl}");break;case B.StartNoLaterThan:case B.FinishNoLaterThan:s=this.L("L{endDateDescriptionTpl}");break}return pt(s,...this.getDescriptionParameters(e))}static getConstraintName(e){return this.L("L{constraintTypeTpl}")[e]}static getDescriptionParameters(e){const s=e.owner;return[R.format(e.startDate,this.L("L{dateFormat}")),R.format(e.endDate,this.L("L{dateFormat}")),s.name||s.id,this.getConstraintName(s.constraintType)]}},an=class extends ur{getConstraintName(e){return this.descriptionBuilderClass.getConstraintName(e||this.owner.constraintType)}getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const s=this.owner;e=e||s.graph.activeTransaction;const t=e.entries.get(s.$.constraintDate),n=e.entries.get(s.$.constraintType);return!e.baseRevision.hasIdentifier(s.$$)||t&&!t.isShadow()||n&&!n.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.removeDateConstraintConflictResolutionClass.new({interval:this})])}};fr([G(Cf)],an.prototype,"removeDateConstraintConflictResolutionClass",void 0),fr([G(Ef)],an.prototype,"descriptionBuilderClass",void 0);var Ri=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},hl=class extends O([Lr,qo,Gt,dl],e=>{const s=e.prototype;class t extends e{*shouldPredecessorAffectScheduling(r){const i=yield r.$.fromEvent;return i&&!Cr(i)&&(yield r.$.active)&&(!(yield i.$.inactive)||(yield this.$.inactive))}*calculateEarlyStartDateConstraintIntervals(){const r=yield*s.calculateEarlyStartDateConstraintIntervals.call(this),i=this.getProject(),a=i.dependencyConstraintIntervalClass;for(const o of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(o)))continue;const l=yield o.$.fromEvent,c=yield l.$.manuallyScheduled;let u;switch(yield o.$.type){case _e.EndToStart:u=c?yield l.$.endDate:yield l.$.earlyEndDateRaw;break;case _e.StartToStart:u=c?yield l.$.startDate:yield l.$.earlyStartDateRaw;break}if(u){const d=yield o.$.lag,h=yield o.$.lagUnit,f=yield o.$.calendar;yield f.$.version;const g=a.new({owner:o,startDate:f.calculateEndDate(u,yield*i.$convertDuration(d,h,V.Millisecond)),endDate:null});r.unshift(g)}}return r}*calculateEarlyEndDateConstraintIntervals(){const r=yield*s.calculateEarlyEndDateConstraintIntervals.call(this),i=this.getProject(),a=i.dependencyConstraintIntervalClass;for(const o of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(o)))continue;const l=yield o.$.fromEvent,c=yield l.$.manuallyScheduled;let u;switch(yield o.$.type){case _e.EndToEnd:u=c?yield l.$.endDate:yield l.$.earlyEndDateRaw;break;case _e.StartToEnd:u=c?yield l.$.startDate:yield l.$.earlyStartDateRaw;break}if(u){const d=yield o.$.lag,h=yield o.$.lagUnit,f=yield o.$.calendar;yield f.$.version;const g=a.new({owner:o,startDate:f.calculateEndDate(u,yield*i.$convertDuration(d,h,V.Millisecond)),endDate:null});r.unshift(g)}}return r}*calculateEffectiveDirection(){const r=yield this.getProject().$.effectiveDirection,i=yield this.$.constraintType;if(r.direction===L.Forward&&!(yield this.$.manuallyScheduled)&&!((i===B.MustStartOn||i===B.MustFinishOn)&&(yield this.$.constraintDate)))for(const a of yield this.$.incomingDeps){const o=yield a.$.fromEvent,l=o!=null&&!Cr(o),c=l?yield o.$.constraintType:void 0;if(!l||!(yield a.$.active)||(yield o.$.manuallyScheduled)||(c===B.MustStartOn||c===B.MustFinishOn)&&(yield o.$.constraintDate))continue;const u=yield a.$.type,d=u===_e.EndToEnd||u===_e.EndToStart?yield o.$.endDateDirection:yield o.$.startDateDirection;if(d.direction===L.Backward)return{kind:"enforced",direction:L.Backward,enforcedBy:d.kind==="enforced"?d.enforcedBy:d.kind==="own"?o:d.inheritedFrom}}return yield*super.calculateEffectiveDirection()}}return Ri([N({type:"boolean"})],t.prototype,"inactive",void 0),t}){},fl=class extends gt(pi){static get $name(){return"BaseDependencyResolution"}getDescription(){const{dependency:e}=this,{type:s,fromEvent:t,toEvent:n}=e;return pt(this.L("L{descriptionTpl}"),this.L("L{DependencyType.long}")[s],t.name||t.id,n.name||n.id)}},gl=class extends fl{static get $name(){return"RemoveDependencyResolution"}resolve(){this.dependency.remove()}},pl=class extends fl{static get $name(){return"DeactivateDependencyResolution"}resolve(){this.dependency.active=!1}},bf=class extends hs{static get $name(){return"DependencyConstraintIntervalDescription"}static getDescriptionParameters(e){const s=e.owner;return[R.format(e.startDate,this.L("L{dateFormat}")),R.format(e.endDate,this.L("L{dateFormat}")),this.L("L{DependencyType.long}")[s.type],s.fromEvent.name,s.toEvent.name]}},gs=class extends ur{isAffectedByTransaction(e){const s=this.owner;e=e||s.graph.activeTransaction;const{entries:t}=e,{fromEvent:n,toEvent:r,lag:i,lagUnit:a,type:o}=s.$,l=t.get(n),c=t.get(r),u=t.get(i),d=t.get(a),h=t.get(o);return!e.baseRevision.hasIdentifier(s.$$)||l&&!l.isShadow()||c&&!c.isShadow()||u&&!u.isShadow()||d&&!d.isShadow()||h&&!h.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.deactivateDependencyConflictResolutionClass.new({dependency:this.owner}),this.removeDependencyConflictResolutionClass.new({dependency:this.owner})])}};Ri([G(gl)],gs.prototype,"removeDependencyConflictResolutionClass",void 0),Ri([G(pl)],gs.prototype,"deactivateDependencyConflictResolutionClass",void 0),Ri([G(bf)],gs.prototype,"descriptionBuilderClass",void 0);var gr=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},wi=class extends O([Ci],e=>{const s=e.prototype;class t extends e{*calculateUnits(){const r=yield this.$.event;return r?yield*r.calculateAssignmentUnits(this):yield X}*calculateEffort(){const r=yield this.$.event;if(r){const i=yield r.$.startDate,a=yield r.$.endDate,o=yield r.$.effectiveCalendar;if(i&&a){const l=new Map;return l.set(o,[this]),yield*r.calculateProjectedEffort(i,a,l)}}return null}*calculateActualDate(){const r=yield this.$.event;if(r){const i=yield r.$.startDate,a=yield r.$.duration,o=yield r.$.percentDone;return yield*r.calculateProjectedXDateWithDuration(i,!0,a*.01*o)}return null}*calculateActualEffort(){const r=yield this.$.event;if(r){const i=yield r.$.startDate,a=yield r.$.effectiveCalendar,o=yield this.$.actualDate,l=new Map;return l.set(a,[this]),yield*r.calculateProjectedEffort(i,o,l)}return null}}return gr([N({type:"number",defaultValue:100})],t.prototype,"units",void 0),gr([j("units")],t.prototype,"calculateUnits",null),gr([q({lazy:!0})],t.prototype,"effort",void 0),gr([q({lazy:!0})],t.prototype,"actualDate",void 0),gr([q({lazy:!0})],t.prototype,"actualEffort",void 0),gr([j("effort")],t.prototype,"calculateEffort",null),gr([j("actualDate")],t.prototype,"calculateActualDate",null),gr([j("actualEffort")],t.prototype,"calculateActualEffort",null),t}){},ps=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},ml=class extends O([ul],e=>{const s=e.prototype;class t extends e{*calculateCalendar(){const r=this.getProject(),i=yield r.$.dependenciesCalendar;let a;switch(i){case Mr.Project:a=yield r.$.effectiveCalendar;break;case Mr.FromEvent:const o=yield this.$.fromEvent;a=o&&!Cr(o)?yield o.$.effectiveCalendar:null;break;case Mr.ToEvent:const l=yield this.$.toEvent;a=l&&!Cr(l)?yield l.$.effectiveCalendar:null;break}return a||(a=yield r.$.effectiveCalendar),a}async setLag(r,i){if(this.graph)return this.graph.write(this.$.lag,r,i),this.graph.commitAsync();this.$.lag.DATA=r,i!=null&&(this.$.lagUnit.DATA=i)}writeLag(r,i,a,o,l=void 0){r.constructor.prototype.write.call(this,r,i,a,o),l!=null&&i.write(this.$.lagUnit,l)}}return ps([N({type:"number",defaultValue:0})],t.prototype,"lag",void 0),ps([N({type:"string",defaultValue:V.Day},{converter:R.normalizeUnit})],t.prototype,"lagUnit",void 0),ps([q()],t.prototype,"calendar",void 0),ps([N({type:"boolean",defaultValue:!0,persist:!0})],t.prototype,"active",void 0),ps([j("calendar")],t.prototype,"calculateCalendar",null),ps([dt("lag")],t.prototype,"writeLag",null),t}){},Ii=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},vl=class extends O([Gt],e=>{const s=e.prototype;class t extends e{*calculatePercentDone(){const r=yield this.$.childEvents,a=yield this.getProject().$.autoCalculatePercentDoneForParentTasks;if(r.size&&a){const o=yield this.$.percentDoneSummaryData;return o.totalDuration>0?o.completedDuration/o.totalDuration:o.milestonesNum>0?o.milestonesTotalPercentDone/o.milestonesNum:null}else return yield X}*shouldRollupChildPercentDoneSummaryData(r){return!0}*calculatePercentDoneSummaryData(){const r=yield this.$.childEvents;if(r.size){let i={totalDuration:0,completedDuration:0,milestonesNum:0,milestonesTotalPercentDone:0};for(const a of r){if(!(yield*this.shouldRollupChildPercentDoneSummaryData(a)))continue;const o=yield a.$.percentDoneSummaryData;o&&(i.totalDuration+=o.totalDuration,i.completedDuration+=o.completedDuration,i.milestonesNum+=o.milestonesNum,i.milestonesTotalPercentDone+=o.milestonesTotalPercentDone)}return i}else{const i=yield this.$.duration;if(typeof i=="number"){const a=yield*this.getProject().$convertDuration(i,yield this.$.durationUnit,V.Millisecond),o=yield this.$.percentDone;return{totalDuration:a,completedDuration:a*o,milestonesNum:a===0?1:0,milestonesTotalPercentDone:a===0?o:0}}else return null}}}return Ii([N({type:"number",defaultValue:0})],t.prototype,"percentDone",void 0),Ii([q()],t.prototype,"percentDoneSummaryData",void 0),Ii([j("percentDone")],t.prototype,"calculatePercentDone",null),Ii([j("percentDoneSummaryData")],t.prototype,"calculatePercentDoneSummaryData",null),t}){},on=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Pi=class extends O([zo],e=>{const s=e.prototype;class t extends e{*hasProposedValueForUnits(){const r=yield this.$.assigned;for(const i of r)if((yield i.$.resource)&&(yield ct(i.$.units)))return!0;return!1}async assign(r,i=100){const a=this.getProject().assignmentStore.modelClass;return this.addAssignment(new a({event:this,resource:r,units:i})),this.commitAsync()}*forEachAvailabilityInterval(r,i){const a=yield this.$.effectiveCalendar,o=yield this.$.assignmentsByCalendar,l=yield this.$.effectiveCalendarsCombination,c=(yield this.$.ignoreResourceCalendar)||r.ignoreResourceCalendar||!o.size,u=this.getProject().maxCalendarRange;return u&&(r=Object.assign({maxRange:u},r)),l.forEachAvailabilityInterval(r,(d,h,f)=>{const g=f.getCalendarsWorkStatus(),p=f.getCalendarsWorking();if(g.get(a)&&(c||p.some(m=>o.has(m))))return i(d,h,f)})}*calculateEffectiveCalendarsCombination(){const r=yield this.$.manuallyScheduled,i=this.getProject(),a=[yield this.$.effectiveCalendar];if(!r||i.skipNonWorkingTimeInDurationWhenSchedulingManually){const o=yield this.$.assignmentsByCalendar;a.push(...o.keys())}return this.getProject().combineCalendars(a)}*calculateAssignmentsByCalendar(){const r=yield this.$.assigned,i=new Map;for(const a of r){const o=yield a.$.resource;if(o){const l=yield o.$.effectiveCalendar;let c=i.get(l);c||(c=[],i.set(l,c)),c.push(a)}}return i}*getBaseOptionsForDurationCalculations(){return{ignoreResourceCalendar:!1}}*useEventAvailabilityIterator(){return(yield this.$.assignmentsByCalendar).size>0}*skipNonWorkingTime(r,i=!0,a){if(!r)return null;const o=yield this.$.assignmentsByCalendar,l=yield this.$.ignoreResourceCalendar;if(yield*this.useEventAvailabilityIterator()){const c=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),i?{startDate:r,isForward:i}:{endDate:r,isForward:i},a);let u;const d=yield*this.forEachAvailabilityInterval(c,(h,f,g)=>(u=i?h:f,!1));if(d===Ve.MaxRangeReached||d===Ve.FullRangeIterated){const h=[yield this.$.effectiveCalendar];!c.ignoreResourceCalendar&&!l&&h.push(...o.keys());const f=en.new({event:this,calendars:h,date:r,isForward:i});if((yield f)===bt.Cancel)yield kt(f);else return null}return new Date(u)}else return yield*s.skipNonWorkingTime.call(this,r,i)}*calculateProjectedDuration(r,i,a,o){if(!r||!i)return null;if(yield*this.useEventAvailabilityIterator()){const l=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),{startDate:r,endDate:i,isForward:!0},o),c=this.getProject().adjustDurationToDST;let u=0;return yield*this.forEachAvailabilityInterval(l,(d,h)=>{if(u+=h.getTime()-d.getTime(),c){const f=d.getTimezoneOffset()-h.getTimezoneOffset();u+=f*60*1e3}}),a||(a=yield this.$.durationUnit),yield*this.getProject().$convertDuration(u,V.Millisecond,a)}else return yield*s.calculateProjectedDuration.call(this,r,i,a)}*calculateProjectedXDateWithDuration(r,i=!0,a,o,l){if(a==null||isNaN(a)||r==null)return null;if(a==0)return r;o=o||(yield this.$.durationUnit);const c=yield*this.getProject().$convertDuration(a,o,V.Millisecond);let u=r.getTime(),d=c;const h=yield this.$.effectiveCalendar;if(yield*this.useEventAvailabilityIterator()){const f=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),i?{startDate:r,isForward:i}:{endDate:r,isForward:i},l),g=this.getProject().adjustDurationToDST;return(yield*this.forEachAvailabilityInterval(f,(m,y,D)=>{const E=m.getTime(),C=y.getTime(),v=C-E;if(v>=d){if(g){const S=i?m.getTimezoneOffset()-new Date(E+d).getTimezoneOffset():new Date(C-d).getTimezoneOffset()-y.getTimezoneOffset();d-=S*60*1e3}return u=i?E+d:C-d,!1}else if(d-=v,g){const S=m.getTimezoneOffset()-y.getTimezoneOffset();d-=S*60*1e3}}))===Ve.StoppedByIterator?new Date(u):null}else return h.accumulateWorkingTime(r,c,i).finalDate}}return on([q()],t.prototype,"effectiveCalendarsCombination",void 0),on([q()],t.prototype,"assignmentsByCalendar",void 0),on([N({type:"boolean"})],t.prototype,"ignoreResourceCalendar",void 0),on([j("effectiveCalendarsCombination")],t.prototype,"calculateEffectiveCalendarsCombination",null),on([j("assignmentsByCalendar")],t.prototype,"calculateAssignmentsByCalendar",null),t}){},at=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},_t=Symbol("MasterStartDateVar"),ln=Symbol("MasterEndDateVar"),cn=Symbol("MasterDurationVar"),un=Symbol("MasterTotalDurationVar"),et=Symbol("StartOffsetVar"),ot=Symbol("EndOffsetVar"),Rf=fe.new({output:te,inputs:new Set([et,ot])}),wf=fe.new({output:J,inputs:new Set([et,_t])}),yl=fe.new({output:Q,inputs:new Set([ot,_t])}),If=fe.new({output:et,inputs:new Set([J,_t])}),Sl=fe.new({output:ot,inputs:new Set([Q,_t])}),Pf=fe.new({output:et,inputs:new Set([ot,te])}),Dl=fe.new({output:ot,inputs:new Set([et,te])}),Mf=fe.new({output:ot,inputs:new Set([et,un])}),xf=fe.new({output:ot,inputs:new Set([et,cn])}),Tf=fe.new({output:te,inputs:new Set([et,ln])}),xv=Xt.new({variables:new Set([J,Q,te,_t,ln,cn,un,et,ot]),formulas:new Set([Rf,wf,yl,Pf,If,Dl,Mf,xf,Sl,Tf])}),Tv=Fe.new({description:xv,defaultResolutionFormulas:new Set([yl,Sl,Dl])}),Ov=class extends ut.mix(Mt){equality(e,s){const t=e.resolution,n=s.resolution;return t.get(J)===n.get(J)&&t.get(Q)===n.get(Q)&&t.get(te)===n.get(te)&&t.get(_t)===n.get(_t)&&t.get(ln)===n.get(ln)&&t.get(cn)===n.get(cn)&&t.get(un)===n.get(un)&&t.get(et)===n.get(et)&&t.get(ot)===n.get(ot)}},Cl=class extends O([or],e=>{class s extends e{get isEventSegment(){return!0}get stm(){var n;return(n=this.event)==null?void 0:n.stm}set stm(n){}writeStartDate(n,r,i,a,o=!0){const l=this.event,c=this.getProject();if(l&&!this.previousSegment&&r.baseRevision.hasIdentifier(n)&&!(c&&c.getStm().isRestoring)?l.$.startDate.constructor.prototype.write.call(this,l.$.startDate,r,null,a,o):n.constructor.prototype.write.call(this,n,r,i,a,o),o&&this.nextSegment){const u=this.endOffset-this.nextSegment.startOffset;if(u>0){let d=this;for(;d=d.nextSegment;)d.startOffset+=u,d.endOffset+=u}}}shouldRecordFieldChange(n,r,i){return n==="startOffset"||n==="endOffset"||super.shouldRecordFieldChange(n,r,i)}*calculateStartOffset(){const r=(yield this.$.dispatcher).resolution.get(et);if(!this.event)return yield X;let i;if(r===Be)i=yield X;else if(r===Pf.formulaId)i=yield*this.calculateStartOffsetByEndOffsetAndDuration();else if(r===If.formulaId){const a=yield pe(this.event.$.startDate),o=yield pe(this.$.startDate);i=yield*this.event.calculateProjectedDuration(a,o,V.Millisecond,{ignoreSegments:!0})}return i}*calculateEndOffset(){const r=(yield this.$.dispatcher).resolution.get(ot);if(!this.event)return yield X;let i;if(r===Be)i=yield X;else if(r===Dl.formulaId)i=yield*this.calculateEndOffsetByStartOffsetAndDuration();else if(r===Sl.formulaId){const a=yield pe(this.event.$.startDate),o=yield pe(this.$.endDate);i=yield*this.event.calculateProjectedDuration(a,o,V.Millisecond,{ignoreSegments:!0})}else r===xf.formulaId?i=yield*this.calculateEndOffsetByMasterDurationAndStartOffset():r===Mf.formulaId&&(i=yield*this.calculateEndOffsetByMasterTotalDurationAndStartOffset());return i}*calculateStartDate(){const r=(yield this.$.dispatcher).resolution.get(J);if(!this.event)return yield X;let i;return r===wf.formulaId?i=yield*this.calculateStartDateByMasterStartAndStartOffset():i=yield*super.calculateStartDate(),i}*calculateEndDate(){const r=(yield this.$.dispatcher).resolution.get(Q);if(!this.event)return yield X;let i;return r===yl.formulaId?i=yield*this.calculateEndDateByMasterStartAndEndOffset():i=yield*super.calculateEndDate(),i}*calculateDuration(){const r=(yield this.$.dispatcher).resolution.get(te);if(!this.event)return yield X;let i;return r===Rf.formulaId?i=yield*this.calculateDurationByOffsets():r===Tf.formulaId?i=yield*this.calculateDurationByOffsets():i=yield*super.calculateDuration(),i}buildProposedDispatcher(n,r,i){const a=super.buildProposedDispatcher(n,r,i);return a.addPreviousValueFlag(_t),a.addPreviousValueFlag(et),a.addPreviousValueFlag(ot),a}*prepareDispatcher(n){const r=yield*super.prepareDispatcher(n);if(!this.event)return r;if(n(Fn(this.event.$.startDate))!=null&&r.addPreviousValueFlag(_t),n(ct(this.event.$.startDate))&&r.addProposedValueFlag(_t),!n(ct(this.event.$.segments))){if(r.collectInfo(n,this.event.$.duration,cn),n(ct(this.event.$.endDate))){const a=n(Er(this.event.$.endDate));a!=null&&a[0]||r.addProposedValueFlag(ln)}const i=n(this.event.$.dispatcher);i.resolution.get(J)===Be&&i.resolution.get(Q)===Be&&r.addProposedValueFlag(un)}return r.collectInfo(n,this.$.startOffset,et),r.collectInfo(n,this.$.endOffset,ot),r}cycleResolutionContext(n){return Tv}*calculateEndOffsetByMasterDurationAndStartOffset(){const n=yield pe(this.event.$.duration),r=yield this.event.$.durationUnit,i=yield this.$.startOffset,a=this.nextSegment;let o,l=yield*this.getProject().$convertDuration(n,r,V.Millisecond);const c=[];let u=this;for(;u=u.previousSegment;)c.push(u);for(let d=c.length-1;d>=0;d--){const h=c[d],f=yield pe(h.$.startOffset),p=(yield pe(h.$.endOffset))-f;l-=p}return l>0?a?o=i+Math.min(l,(yield pe(this.$.endOffset))-i):o=i+l:o=i,o}*calculateEndOffsetByMasterTotalDurationAndStartOffset(){const n=yield pe(this.event.$.startDate),r=yield pe(this.event.$.endDate),i=yield*this.event.calculateProjectedDuration(n,r,V.Millisecond,{ignoreSegments:!0}),a=yield pe(this.$.startOffset);let o=yield pe(this.$.endOffset),l=this.nextSegment;return a<=i?o<=i?!l||(yield pe(l.$.startOffset))>=i?i:o:i:yield this.$.startOffset}*calculateStartOffsetByEndOffsetAndDuration(){const n=yield this.$.duration,r=yield this.$.durationUnit;return(yield this.$.endOffset)-(yield*this.event.getProject().$convertDuration(n,r,V.Millisecond))}*calculateEndOffsetByStartOffsetAndDuration(){const n=yield this.$.duration,r=yield this.$.durationUnit;return(yield this.$.startOffset)+(yield*this.event.getProject().$convertDuration(n,r,V.Millisecond))}*calculateEndDateByMasterStartAndEndOffset(){const n=yield this.event.$.startDate,r=yield this.$.endOffset,i=yield*this.event.calculateProjectedXDateWithDuration(n,!0,r,V.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?i:yield*this.event.skipNonWorkingTime(i,!1)}*calculateStartDateByMasterStartAndStartOffset(){const n=yield this.event.$.startDate,r=yield this.$.startOffset,i=yield*this.event.calculateProjectedXDateWithDuration(n,!0,r,V.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?i:yield*this.event.skipNonWorkingTime(i)}*calculateDurationByOffsets(){const n=yield this.$.startOffset,r=yield this.$.endOffset,i=yield this.$.durationUnit;return yield*this.getProject().$convertDuration(r-n,V.Millisecond,i)}*calculatePercentDone(){let n=0;if(!this.event)return yield X;const r=yield this.event.$.segments;if(r){const i=yield this.event.$.percentDone,a=yield this.event.$.duration,o=yield this.event.$.durationUnit;let l=yield*this.getProject().$convertDuration(a,o,V.Millisecond),c=i*.01*l;for(const u of r){const d=u.startOffset,f=u.endOffset-d;if(u===this)return c>=f?100:c>0?100*c/f:0;c-=f}}return n}*calculateMinPercent(){const n=this.previousSegment;return this.event?n?yield n.$.endPercentDone:0:yield X}*calculateMaxPercent(){if(!this.event)return yield X;const n=yield this.event.$.duration,r=yield this.event.$.durationUnit;let i=yield*this.getProject().$convertDuration(n,r,V.Millisecond);const a=yield this.$.startOffset,o=yield this.$.endOffset;return(yield this.$.startPercentDone)+100*(o-a)/i}*calculateProjectedXDateWithDuration(n,r,i,a){return a||(a=yield this.$.durationUnit),yield*this.event.calculateProjectedXDateWithDuration(n,r,i,a,{ignoreSegments:!0})}*calculateProjectedDuration(n,r,i){return i||(i=yield this.$.durationUnit),yield*this.event.calculateProjectedDuration(n,r,i,{ignoreSegments:!0})}*calculateManuallyScheduled(){return this.event?yield this.event.$.manuallyScheduled:yield X}}return at([q({identifierCls:Ov})],s.prototype,"dispatcher",void 0),at([N({persist:!1})],s.prototype,"startOffset",void 0),at([N({persist:!1})],s.prototype,"endOffset",void 0),at([q()],s.prototype,"percentDone",void 0),at([q()],s.prototype,"startPercentDone",void 0),at([q()],s.prototype,"endPercentDone",void 0),at([dt("startDate")],s.prototype,"writeStartDate",null),at([j("startOffset")],s.prototype,"calculateStartOffset",null),at([j("endOffset")],s.prototype,"calculateEndOffset",null),at([j("percentDone")],s.prototype,"calculatePercentDone",null),at([j("startPercentDone")],s.prototype,"calculateMinPercent",null),at([j("endPercentDone")],s.prototype,"calculateMaxPercent",null),at([j("manuallyScheduled")],s.prototype,"calculateManuallyScheduled",null),s}){},Nr=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Br=Symbol("SegmentsVar"),Av=(e,s,t)=>t.processSegmentsValue(e),El=fe.new({output:J,inputs:new Set([Q,Br])}),bl=fe.new({output:Q,inputs:new Set([J,Br])}),Zy=fe.new({output:te,inputs:new Set([J,Q,Br])}),Of=Xt.new({variables:new Set([J,Q,te,Br]),formulas:new Set([bl,El,Je,Qe,Ze])}),$v=Fe.new({description:Of,defaultResolutionFormulas:new Set([Qe,bl])}),_v=Fe.new({description:Of,defaultResolutionFormulas:new Set([Je,El])}),Fv=class extends ut.mix(Mt){equality(e,s){const t=e.resolution,n=s.resolution;return t.get(J)===n.get(J)&&t.get(Q)===n.get(Q)&&t.get(te)===n.get(te)&&t.get(Br)===n.get(Br)}};function jv(e,s){return!e&&!s?!0:this._skipSegmentsIsEqual||!e&&s||e&&!s||e.length!==s.length?!1:e.every((t,n)=>kv(t,s[n]))}var kv=(e,s)=>{if(e===s)return!0;const n=(e.isModel?e:s).fieldMap,r=e.startDate instanceof Date?e.startDate.getTime():n.startDate.convert(e.startDate).getTime(),i=s.startDate instanceof Date?s.startDate.getTime():n.startDate.convert(s.startDate).getTime(),a=e.endDate instanceof Date?e.endDate.getTime():n.endDate.convert(e.endDate).getTime(),o=s.endDate instanceof Date?s.endDate.getTime():n.endDate.convert(s.endDate).getTime();return r===i&&a===o},Lv=class extends O([Pi,vl],e=>{class s extends e{constructor(){super(...arguments),this._segmentGeneration={}}static get $name(){return"SplitEventMixin"}construct(){this.segmentModelClass=this.getDefaultSegmentModelClass(),super.construct(...arguments)}get rawModifications(){let n=super.rawModifications;if(this.segments&&(!n||!("segments"in n))){for(const r of this.segments)if(r.rawModifications){n=n||{},n.segments=this.getFieldPersistentValue("segments");break}}return n}clearChanges(n,r,i){for(const a of this.segments||[])a.clearChanges(n,r,null);super.clearChanges(n,r,i)}getDefaultSegmentModelClass(){return Cl}*prepareDispatcher(n){const r=yield*super.prepareDispatcher(n);return(yield*this.hasSegmentChangesProposed())&&r.addProposedValueFlag(Br),r}cycleResolutionContext(n){const r=n(this.$.effectiveDirection);return r.direction===L.Forward||r.direction===L.None?$v:_v}*hasSegmentChangesProposed(){const n=yield Oc(this.$.segments);let r=!1;(yield ct(this.$.segments))&&(r=!!n);const i=yield pe(this.$.segments);if(!i)return!1;for(const a of i){const o=yield ct(a.$.startDate),l=yield ct(a.$.endDate),c=yield ct(a.$.duration);(o||l||c)&&(r=!0)}return r}writeSegments(n,r,i,a){var o;const l=(o=r.getLatestEntryFor(n))==null?void 0:o.getValue(),c=l!==ee?l!=null?l:[]:[],u=new Set(c),d=a!=null?a:[],h=new Set(d);this.project.ion({commitFinalized:()=>g.removeEntities(c.filter(p=>!h.has(p))),once:!0}),n.constructor.prototype.write.call(this,n,r,i,a),this.$.isSegmented.write.call(this,this.$.isSegmented,r,null,!!(a!=null&&a.length));const f=this.project,g=f.replica;for(const p of d)!u.has(p)&&p.graph!==g&&(p.setProject(f),g.addEntity(p))}*doWriteSegments(n,r){if(r=r||[],n.length<=1){const i=n.length?yield*this.getProject().$convertDuration(n[0].endOffset-n[0].startOffset,V.Millisecond,yield this.$.durationUnit):0;r.push({identifier:this.$.duration,proposedArgs:[i,null]}),n=null}r.push({identifier:this.$.segments,proposedArgs:[n]}),yield Mc(r)}*calculateSegments(){const n=yield this.$.dispatcher,{graph:r,project:i}=this,a=yield Fn(this.$.segments);let o=yield X;const l=[];let c=!1;if(o){const u=new Set;let d=null,h=!1;const{baseRevision:f}=r.$activeTransaction;for(const g of o){const p=yield g.$.startOffset,m=yield g.$.endOffset,y=f.hasIdentifier(g.$.startDate)&&(yield Er(g.$.startDate)),D=f.hasIdentifier(g.$.endDate)&&(yield Er(g.$.endDate));if(h=h||(y==null?void 0:y[0])||(D==null?void 0:D[0]),p===m)l.push(g);else if(d&&p<=d.endOffset){const E=d.endOffset;if(l.push(g),d.graph){l.push(d);const C=d.startOffset,v=h?m+E-p:Math.max(m,E),S=d.cls;d=this.segmentModelClass.new({event:this,cls:S,startOffset:C,endOffset:v})}else d.endOffset=h?m+d.endOffset-p:Math.max(m,d.endOffset)}else d&&u.add(d),d=g}d&&u.add(d),u.size===1&&l.push(...u),c=l.length>0,c&&(o=Array.from(u)),o.reduce((g,p,m)=>(g&&(g.nextSegment=p),p.previousSegment=g,p.segmentIndex=m,p),null),o.length&&(o[o.length-1].nextSegment=null)}else a&&l.push(...a);return l.length&&(l.forEach(u=>u.event=null),i.ion({commitFinalized:()=>r.removeEntities(l),once:!0})),c&&(yield*this.doWriteSegments(o)),o=(o==null?void 0:o.length)>1?o:null,o}*calculateAdjustedSegments(){const n=yield this.$.dispatcher;let r=yield this.$.segments;const i=yield this.$.startDate,a=yield this.$.endDate,o=yield this.$.duration;let l=yield X;if(r){const c=this.project,u=this.graph,d=[],h=[];let f=-1;for(let m=r.length-1;m>=0;m--){const y=r[m],D=yield y.$.startDate,E=yield y.$.endDate;if(D>a)d.push(y),f=m;else{if(E.getTime()!==a.getTime()){const C=y.endOffset+(a.getTime()-E.getTime())-y.startOffset,v=yield*c.$convertDuration(C,V.Millisecond,yield y.$.durationUnit);h.push({identifier:y.$.duration,proposedArgs:[v,null]},{identifier:y.$.endDate,proposedArgs:[a,!1]},{identifier:y.$.endOffset,proposedArgs:[y.endOffset+(a.getTime()-E.getTime())]})}break}}let g=!1;f>-1&&(g=!0,r.splice(f),r.length&&(r[r.length-1].nextSegment=null),c.ion({commitFinalized:()=>u.removeEntities(d),once:!0}));let p="";r&&(p=this.getSegmentsSnapshot(r)),p!==this._lastSegmentsSnapshot&&(g=!0,r=r&&r.slice(),this._lastSegmentsSnapshot=p),g&&(yield*this.doWriteSegments(r,h))}return l}getSegmentsSnapshot(n){return n=n||this.segments,n==null?void 0:n.map(r=>{var i,a;return""+r.startOffset+"-"+((i=r.startDate)==null?void 0:i.getTime())+"-"+r.endOffset+"-"+((a=r.endDate)==null?void 0:a.getTime())}).join(";")}processSegmentsValue(n){let r=n;if(n)for(let i=0;i<n.length;i++){const a=n[i],o=a.isModel?a:this.segmentModelClass.new(a);o.event||(o.event=this),n[i]=o}return r}*calculateStartDate(){const r=(yield this.$.dispatcher).resolution.get(J);let i;return r===El.formulaId?i=yield*this.calculateStartDateBySegments():i=yield*super.calculateStartDate(),i}*calculateStartDateBySegments(){const n=yield this.$.dispatcher,r=yield this.$.segments,i=yield this.$.endDate;let a;if(r){const l=yield r[r.length-1].$.endOffset,c=yield*this.calculateProjectedXDateWithDuration(i,!1,l,V.Millisecond,{ignoreSegments:!0});a=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?c:yield*this.skipNonWorkingTime(c,!0)}return a}*calculateEndDateBySegments(){const n=yield this.$.dispatcher,r=yield this.$.segments,i=yield this.$.startDate;let a;if(r){const l=yield r[r.length-1].$.endOffset,c=yield*this.calculateProjectedXDateWithDuration(i,!0,l,V.Millisecond,{ignoreSegments:!0});a=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?c:yield*this.skipNonWorkingTime(c,!1)}return a}*calculateEndDate(){const r=(yield this.$.dispatcher).resolution.get(Q);let i;return r===bl.formulaId?i=yield*this.calculateEndDateBySegments():i=yield*super.calculateEndDate(),i}*calculateDurationProposed(){let n;return(yield*this.hasSegmentChangesProposed())?n=yield*this.calculateDurationBySegments():n=yield*super.calculateDurationProposed(),n}*skipNonWorkingTime(n,r=!0,i){return n?(i=Object.assign({ignoreSegments:!0},i),yield*super.skipNonWorkingTime(n,r,i)):null}*calculateDurationBySegments(){let n;const r=yield this.$.dispatcher,i=yield this.$.durationUnit,a=yield this.$.segments;if(a){let o=0;for(const l of a)o+=l.endOffset-l.startOffset;n=yield*this.getProject().$convertDuration(o,V.Millisecond,i)}return n}*forEachAvailabilityInterval(n,r){const i=yield this.$.effectiveCalendar,a=yield this.$.assignmentsByCalendar,o=yield this.$.effectiveCalendarsCombination,l=n.isForward!==!1,c=(yield this.$.ignoreResourceCalendar)||n.ignoreResourceCalendar||!a.size,u=this.getProject().maxCalendarRange;let d=n.ignoreSegments,h=1,f,g,p,m,y;d||(m=yield this.$.segments,d=d||!m,d||(m=m.slice(),l?(f=m.shift(),g=0,h=1,y=f.nextSegment?f.endOffset:ae.getTime()):(f=m.pop(),g=f.endOffset,h=-1,y=f.endOffset),p=y-f.startOffset));const D=yield this.$.manuallyScheduled,E=this.getProject();return o.forEachAvailabilityInterval(Object.assign({maxRange:u},n),(C,v,S)=>{const b=S.getCalendarsWorkStatus(),P=S.getCalendarsWorking();if(b.get(i)&&(c||P.some(M=>a.has(M))||D&&!E.skipNonWorkingTimeInDurationWhenSchedulingManually)){if(d)return r(C,v,S);{const M=C.getTime();let w=v.getTime()-C.getTime();if(this.getProject().adjustDurationToDST){const k=C.getTimezoneOffset()-v.getTimezoneOffset();w+=k*60*1e3}let A,T;for(l?(A=g,T=g+w):(A=g-w,T=g);f&&A<=y&&T>f.startOffset;){const k=Math.max(A,f.startOffset),Z=Math.min(T,y),z=new Date(M+k-A),re=new Date(M+Z-A);if(r(z,re,S)===!1)return!1;if(p-=re.getTime()-z.getTime(),!p)f=l?m.shift():m.pop(),f&&(y=!l||f.nextSegment?f.endOffset:ae.getTime(),p=y-f.startOffset);else break}g+=h*w}}})}*useEventAvailabilityIterator(){return(yield this.$.isSegmented)?!0:!(yield this.$.manuallyScheduled)}getSegmentByDate(n,r){if(r=r||this.getSegments(),r){const i=this.getSegmentIndexByDate(n,r);return r[i]}}getSegmentIndexByDate(n,r){return r=r||this.getSegments(),r?r.findIndex(i=>n>=i.startDate&&n<i.endDate):-1}get firstSegment(){const n=this.getSegments();return n?n[0]:null}get lastSegment(){const n=this.getSegments();return n?n[n.length-1]:null}getSegment(n){const r=this.getSegments();return r==null?void 0:r[n]}async splitToSegments(n,r=1,i){var a;const o=this.getProject();await o.commitAsync();const l=this;if(!n||l.isHasSubEventsMixin&&((a=l.childEvents)!=null&&a.size))return;const c=l.duration,u=l.durationUnit,d=l.startDate,h=l.endDate;if(i=i?R.normalizeUnit(i):u,!d||!h||d>=n||n>=h||!c)return;const f=l.isSegmented;let g=l.segments||[],p,m;if(f&&(m=l.getSegmentIndexByDate(n,g),p=g[m],!p))return;const y=p||l,D=p?y.startDate:d,E=y.duration,C=y.durationUnit,v=l.run("calculateProjectedDuration",D,n,C,{ignoreSegments:!0}),S=E-v,b=o.run("$convertDuration",r,i,V.Millisecond),P=b+l.run("calculateProjectedDuration",d,n,V.Millisecond,{ignoreSegments:!0});if(p){p.duration=v;const M=this.segmentModelClass.new({duration:S,durationUnit:C,startOffset:P});g=g.slice(0),g.splice(m+1,0,M),l.segments=g,l.duration=c;for(let w=m+2,A=g.length;w<A;w++){const T=g[w];T&&(T.startOffset+=b,T.endOffset+=b)}}else{const M=this.segmentModelClass.new({duration:v,durationUnit:C,startOffset:0}),w=this.segmentModelClass.new({duration:c-v,durationUnit:C,startOffset:P});l.duration=c,l.segments=[M,w]}return o.commitAsync()}async mergeSegments(n,r){if(this.isSegmented){if(n=n||this.firstSegment,r=r||this.lastSegment,n.startOffset>r.startOffset){let i=r;r=n,n=i}return n.endDate=r.startDate,this.getProject().commitAsync()}}storeFieldChange(n,r){if(n==="segments"&&r){const i=[];for(const a of r){const o=a.toJSON();(!this._segmentGeneration[a.internalId]||a.generation>this._segmentGeneration[a.internalId])&&Object.assign(o,a.meta.modified),i.push(o),this._segmentGeneration[a.internalId]=a.generation}r=i}super.storeFieldChange(n,r)}leaveProject(){const n=this.segments;n&&this.graph.removeEntities(n),super.leaveProject()}endBatch(...n){this.fieldMap.segments._skipSegmentsIsEqual++,super.endBatch(...n),this.fieldMap.segments._skipSegmentsIsEqual--}copy(n=null,r=null){const i=super.copy(n,r);return i.data.segments=void 0,i.segments&&(i.segments=i.segments.map(a=>Object.assign(a.copy(),{event:i}))),i}}return Nr([q({identifierCls:Fv})],s.prototype,"dispatcher",void 0),Nr([N({type:"array",isEqual:jv,convert:Av,_skipSegmentsIsEqual:0})],s.prototype,"segments",void 0),Nr([q()],s.prototype,"adjustedSegments",void 0),Nr([q()],s.prototype,"isSegmented",void 0),Nr([dt("segments")],s.prototype,"writeSegments",null),Nr([j("segments")],s.prototype,"calculateSegments",null),Nr([j("adjustedSegments")],s.prototype,"calculateAdjustedSegments",null),s}){},Mi=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},xi=class extends O([Pi,Gt],e=>{const s=e.prototype;class t extends e{getEffort(r){const i=this.effort;return r?this.getProject().convertDuration(i,this.effortUnit,r):i}writeEffort(r,i,a,o,l){o<0&&(o=0),!(!i.baseRevision.hasIdentifier(r)&&o==null)&&(l!=null&&l!==this.effortUnit&&this.$.effortUnit.write.call(this,this.$.effortUnit,i,null,l),r.constructor.prototype.write(r,i,a,o))}setEffortUnit(r){throw new Error("Use `setEffort` instead")}*shouldRollupChildEffort(r){return!0}*calculateTotalChildrenEffort(){const r=yield this.$.childEvents,i=this.getProject();let a=0;for(const o of r){if(!(yield*this.shouldRollupChildEffort(o)))continue;const l=yield o.$.effortUnit;a+=yield*i.$convertDuration(yield o.$.effort,l,V.Millisecond)}return yield*i.$convertDuration(a,V.Millisecond,yield this.$.effortUnit)}*calculateEffort(){if((yield this.$.childEvents).size>0)return yield*this.calculateTotalChildrenEffort();{const i=yield X;return i!==void 0?i:yield*this.calculateEffortPure()}}*calculateEffortPure(){return(yield this.$.childEvents).size>0?yield*this.calculateTotalChildrenEffort():yield*this.calculateProjectedEffort(yield this.$.startDate,yield this.$.endDate)}*calculateEffortProposed(){return yield X}*calculateAssignmentUnits(r){return yield*this.calculateAssignmentUnitsProposed(r)}*calculateAssignmentUnitsPure(r){return yield*this.calculateUnitsByStartEndAndEffort(r)}*calculateAssignmentUnitsProposed(r){return yield X}*getBaseOptionsForEffortCalculations(){return{ignoreResourceCalendar:!1}}*calculateProjectedEffort(r,i,a){if(r==null||i==null||r>i)return null;a||(a=yield this.$.assignmentsByCalendar);const o=new Map;for(const[u,d]of a){let h=0;for(const f of d)h+=yield f.$.units;o.set(u,h)}let l=0;const c=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:r,endDate:i});return o.size===0&&(o.set(yield this.$.effectiveCalendar,100),c.ignoreResourceCalendar=!0),yield*this.forEachAvailabilityInterval(c,(u,d,h)=>{const f=h.getCalendarsWorking(),g=u.getTime(),p=d.getTime(),m=p-g;let y=0;for(const D of f)y+=o.get(D)||0;l+=y*m*.01}),yield*this.getProject().$convertDuration(l,V.Millisecond,yield this.$.effortUnit)}*calculateUnitsByStartEndAndEffort(r){const i=yield this.$.effort,a=yield this.$.effortUnit,o=yield*this.getProject().$convertDuration(i,a,V.Millisecond);let l=0;const c=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:yield this.$.startDate,endDate:yield this.$.endDate}),u=yield this.$.assignmentsByCalendar;return yield*this.forEachAvailabilityInterval(c,(d,h,f)=>{const g=f.getCalendarsWorking(),p=d.getTime(),m=h.getTime(),y=m-p;for(const D of g)l+=(u.has(D)?u.get(D).length:0)*y}),l?100*o/l:100}*calculateProjectedXDateByEffort(r,i=!0,a,o){a=a!==void 0?a:yield this.$.effort,o=o!==void 0?o:yield this.$.effortUnit;const l=yield*this.getProject().$convertDuration(a,o,V.Millisecond);if(r==null||a==null)return null;let c=r.getTime(),u=l;if(u===0)return new Date(c);const d=yield this.$.effectiveCalendar,h=yield this.$.assignmentsByCalendar,f=new Map;let g=!1;for(const[p,m]of h){let y=0;for(const D of m)y+=yield D.$.units;f.set(p,y),y>0&&(g=!0)}if(g&&(yield*this.useEventAvailabilityIterator())){const p=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),i?{startDate:r,isForward:i}:{endDate:r,isForward:i});return yield*this.forEachAvailabilityInterval(p,(m,y,D)=>{const E=D.getCalendarsWorking(),C=m.getTime(),v=y.getTime(),S=v-C;let b=0;for(const M of E)b+=f.get(M)||0;const P=b*S*.01;if(P>=u)return c=i?C+u/(.01*b):v-u/(.01*b),!1;u-=P}),new Date(c)}else return d.accumulateWorkingTime(r,l,i).finalDate}}return Mi([N({type:"number"})],t.prototype,"effort",void 0),Mi([N({type:"string",defaultValue:V.Hour},{converter:n=>R.normalizeUnit(n)||V.Hour})],t.prototype,"effortUnit",void 0),Mi([dt("effort")],t.prototype,"writeEffort",null),Mi([j("effort")],t.prototype,"calculateEffort",null),t}){},Ie=Symbol("EffortVar"),Pe=Symbol("UnitsVar"),Yt=fe.new({output:Ie,inputs:new Set([J,Q,Pe])}),pr=fe.new({output:Pe,inputs:new Set([J,Q,Ie])}),mr=fe.new({output:Q,inputs:new Set([J,Ie,Pe])}),vr=fe.new({output:J,inputs:new Set([Q,Ie,Pe])}),Af=class extends No{},$f=class extends Bo{equality(e,s){const t=e.resolution,n=s.resolution;return(e!==ee||s===ee)&&(e===ee||s!==ee)&&t.get(Ie)===n.get(Ie)&&t.get(Pe)===n.get(Pe)&&super.equality(e,s)}},Vr=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},dn=class extends O([xi],e=>{const s=e.prototype;class t extends e{*calculateSchedulingMode(){return(yield X)||me.Normal}*effectiveSchedulingMode(){return(yield this.$.assignmentsByCalendar).size>0?yield this.$.schedulingMode:me.Normal}effectiveSchedulingModeSync(r){return r(this.$.assignmentsByCalendar).size>0?r(this.$.schedulingMode):me.Normal}*prepareDispatcher(r){if((yield*this.effectiveSchedulingMode())!==me.Normal){const a=yield*s.prepareDispatcher.call(this,r);return a.collectInfo(r,this.$.effort,Ie),(yield*this.hasProposedValueForUnits())&&a.addProposedValueFlag(Pe),a.addPreviousValueFlag(Pe),a}else return yield*s.prepareDispatcher.call(this,r)}dispatcherClass(r){return this.effectiveSchedulingModeSync(r)!==me.Normal?Af:s.dispatcherClass.call(this,r)}buildProposedDispatcher(r,i,a){const o=s.buildProposedDispatcher.call(this,r,i,a);return o.addPreviousValueFlag(Ie),o.addPreviousValueFlag(Pe),o}*calculateAssignmentUnits(r){if((yield*this.effectiveSchedulingMode())!==me.Normal){const o=(yield this.$.dispatcher).resolution.get(Pe);if(o===Be)return yield*this.calculateAssignmentUnitsProposed(r);if(o===pr.formulaId)return yield*this.calculateAssignmentUnitsPure(r);throw new Error("Unknown formula for `units`")}else return yield*s.calculateAssignmentUnits.call(this,r)}*calculateEffort(){if((yield*this.effectiveSchedulingMode())!==me.Normal){const a=(yield this.$.dispatcher).resolution.get(Ie);if(a===Be)return yield*this.calculateEffortProposed();if(a===Yt.formulaId)return yield*this.calculateEffortPure();throw new Error("Unknown formula for `effort`")}else return yield*s.calculateEffort.call(this)}*calculateStartDate(){return(yield*this.effectiveSchedulingMode())!==me.Normal?(yield this.$.dispatcher).resolution.get(J)===vr.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.endDate,!1):yield*s.calculateStartDate.call(this):yield*s.calculateStartDate.call(this)}*calculateEndDate(){return(yield*this.effectiveSchedulingMode())!==me.Normal?(yield this.$.dispatcher).resolution.get(Q)===mr.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.startDate,!0):yield*s.calculateEndDate.call(this):yield*s.calculateEndDate.call(this)}*calculateEffectiveDuration(){const r=yield this.$.dispatcher,i=yield*this.effectiveSchedulingMode(),a=r.resolution.get(te),o=r.resolution.get(Ie);let l;if(a===Ze.formulaId&&i!=me.Normal){const c=yield pe(this.$.startDate),u=yield pe(this.$.endDate),d=r.resolution.get(J),h=r.resolution.get(Q),f=yield this.$.effortDriven;u&&d===vr.formulaId?l=yield*this.calculateProjectedDuration(yield*this.calculateProjectedXDateByEffort(u,!1),u):c&&h===mr.formulaId?l=yield*this.calculateProjectedDuration(c,yield*this.calculateProjectedXDateByEffort(c,!0)):(c&&u||!c&&!u)&&(l=yield*s.calculateEffectiveDuration.call(this))}else l=yield*s.calculateEffectiveDuration.call(this);return l}}return Vr([N({type:"boolean",defaultValue:!1})],t.prototype,"effortDriven",void 0),Vr([N({type:"string",defaultValue:me.Normal},{sync:!0})],t.prototype,"schedulingMode",void 0),Vr([q({identifierCls:$f})],t.prototype,"dispatcher",void 0),Vr([j("schedulingMode")],t.prototype,"calculateSchedulingMode",null),Vr([j("effort")],t.prototype,"calculateEffort",null),Vr([j("startDate")],t.prototype,"calculateStartDate",null),Vr([j("endDate")],t.prototype,"calculateEndDate",null),t}){},Rl=Xt.new({variables:new Set([J,Q,te,Ie,Pe]),formulas:new Set([Je,Qe,Ze,pr,Yt])}),wl=Xt.new({variables:new Set([J,Q,te,Ie,Pe]),formulas:new Set([Je,Qe,Ze,pr])}),_f=Fe.new({description:Rl,defaultResolutionFormulas:new Set([Qe,Yt])}),Ff=Fe.new({description:wl,defaultResolutionFormulas:new Set([Qe,pr])}),jf=Fe.new({description:Rl,defaultResolutionFormulas:new Set([Je,Yt])}),kf=Fe.new({description:wl,defaultResolutionFormulas:new Set([Je,pr])}),Lf=class extends O([dn],e=>{const s=e.prototype;class t extends e{*prepareDispatcher(r){if((yield*this.effectiveSchedulingMode())===me.FixedDuration){const a=yield*s.prepareDispatcher.call(this,r),o=yield this.$.effortDriven;return o&&a.addKeepIfPossibleFlag(Ie),(yield ct(this.$.assigned))&&(o?a.addProposedValueFlag(Ie):a.addProposedValueFlag(Pe)),a}else return yield*s.prepareDispatcher.call(this,r)}cycleResolutionContext(r){if(this.effectiveSchedulingModeSync(r)===me.FixedDuration){const a=r(this.$.effectiveDirection),o=r(this.$.effortDriven);return a.direction===L.Forward||a.direction===L.None?o?Ff:_f:o?kf:jf}else return s.cycleResolutionContext.call(this,r)}*getBaseOptionsForDurationCalculations(){return(yield*this.effectiveSchedulingMode())===me.FixedDuration?{ignoreResourceCalendar:!0}:yield*s.getBaseOptionsForDurationCalculations.call(this)}}return t}){},Ti=class extends O([fi,dl,vl,Pi,xi,dn,Lf,Lr,hl,Lv],e=>{class s extends e{static get fields(){return[{name:"name",type:"string"}]}}return s}){},hn=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Nf=class extends Js{static get fields(){return[{name:"isWorking",type:"boolean",defaultValue:!0}]}},Bf=class extends Ao{static get defaultConfig(){return{modelClass:Nf}}},Il=class extends ds{get intervalStoreClass(){return Bf}};hn([N({type:"boolean",defaultValue:!1})],Il.prototype,"unspecifiedTimeIsWorking",void 0);var Oi=class extends de{constructor(){super(...arguments),this.effort=0,this.units=0}},Vf=class extends Oi{constructor(){super(...arguments),this.inEventTimeSpan=!1}},Pl=class extends Oi{constructor(){super(...arguments),this.maxEffort=0,this.isOverallocated=!1,this.isUnderallocated=!1,this.inEventTimeSpan=!1,this.assignments=null,this.assignmentIntervals=null}},Ai=class extends xt.mix(de){getDefaultAllocationIntervalClass(){return Oi}initialize(e){e=Object.assign({includeInactiveEvents:!1,allocationIntervalClass:this.getDefaultAllocationIntervalClass()},e),super.initialize(e)}};hn([q()],Ai.prototype,"includeInactiveEvents",void 0),hn([q()],Ai.prototype,"allocation",void 0);var $i=class extends Ai{enterGraph(e){super.enterGraph(e)}leaveGraph(e){var s,t;this.eventRangesCalendar&&((s=this.resource)==null||s.getProject().clearCombinationsWith(this.eventRangesCalendar)),super.leaveGraph(e),(t=this.resource)==null||t.entities.delete(this)}getDefaultAllocationIntervalClass(){return Pl}*shouldIncludeAssignmentInAllocation(e){const s=yield e.$.event,t=yield this.$.includeInactiveEvents,n=s&&(yield s.$.inactive),r=s&&(yield s.$.startDate),i=s&&(yield s.$.endDate);return!!(s&&r&&i&&(t||!n))}*calculateAllocation(){var e;const s=[],t=yield this.ticks,n=yield this.$.resource,r=yield this.$.includeInactiveEvents,i=yield n.$.assigned,a=yield n.$.effectiveCalendar,o=new Map,l=[],c=new Map,u=new Map;let d=!1,h,f,g;for(const S of i){if(!(yield*this.shouldIncludeAssignmentInAllocation(S)))continue;yield S.$.units;const b=yield S.$.event,P=yield b.$.ignoreResourceCalendar,M=yield b.$.startDate,w=yield b.$.endDate,A=yield b.$.segments,T=yield b.$.effectiveCalendar;if(d=d||P,A)for(const Z of A){const z=yield Z.$.startDate,re=yield Z.$.endDate;l.push({startDate:z,endDate:re,assignment:S})}else l.push({startDate:M,endDate:w,assignment:S});let k=o.get(T);k||(k=[],o.set(T,k)),c.set(S,new Map),u.set(S,[]),k.push(S)}this.eventRangesCalendar&&((e=this.resource)==null||e.getProject().clearCombinationsWith(this.eventRangesCalendar));const p=this.eventRangesCalendar=new Il({intervals:l}),m=[t,p,...o.keys()],y=new Map;t.intervalStore.forEach(S=>{const b=Pl.new({tick:S,resource:n});y.set(S,b),s.push(b),c.forEach((P,M)=>{const w=Vf.new({tick:S,assignment:M});P.set(S,w),u.get(M).push(w)})});const D=s[0].tick.startDate,E=s[s.length-1].tick.endDate,C={startDate:D,endDate:E,calendars:m,includeNonWorkingIntervals:d},v=E.getTime()-D.getTime();if(v>n.getProject().maxCalendarRange&&(C.maxRange=v),yield*n.forEachAvailabilityInterval(C,(S,b,P)=>{const M=P.getCalendarsWorkStatus();if(M.get(t)){const w=P.intervalsByCalendar.get(t)[0],A=b.getTime()-S.getTime(),T=y.get(w),k=T.assignments||new Set,Z=T.assignmentIntervals||new Map;if(g&&g!==w){const Te=y.get(g);Te.isUnderallocated=Te.isUnderallocated||Te.effort&&Te.effort<Te.maxEffort}g=w,T.assignments||(h=0,f=0);let z=0,re=!1,be,Le=0;P.intervalsByCalendar.get(p).forEach(Te=>{const Ne=Te.assignment,Dt=Ne==null?void 0:Ne.event;if(Dt&&M.get(Dt.effectiveCalendar)&&(Dt.ignoreResourceCalendar||M.get(a))){const Dr=Math.max(S.getTime(),Ne.event.startDate.getTime()),Es=Math.min(b.getTime(),Ne.event.endDate.getTime());re=!0,be=Es-Dr;const jt=c.get(Ne).get(w),Tn=be*Ne.units/100;jt.effort+=Tn,jt.units=Ne.units,jt.inEventTimeSpan=!0,Le+=Tn,z+=Ne.units,k.add(Ne),Z.set(Ne,jt)}}),T.inEventTimeSpan=T.inEventTimeSpan||re,M.get(a)&&(T.maxEffort+=A),z&&(be?(h+=be*z,f+=be,T.units=h/f):h||(T.units=z)),re&&(T.effort+=Le,T.assignments=k,T.assignmentIntervals=Z,T.isOverallocated=T.isOverallocated||T.effort>T.maxEffort||T.units>100,T.isUnderallocated=T.isUnderallocated||Le<A||T.units<100)}}),g){const S=y.get(g);S.isUnderallocated=S.isUnderallocated||S.effort&&S.effort<S.maxEffort}return{owner:this,resource:n,total:s,byAssignments:u}}};hn([q()],$i.prototype,"resource",void 0),hn([j("allocation")],$i.prototype,"calculateAllocation",null);var _i=class extends O([Ei],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.observers=new Set,this.entities=new Set}addObserver(r){this.graph.addIdentifier(r),this.observers.add(r)}removeObserver(r){this.graph&&this.graph.removeIdentifier(r),this.observers.delete(r)}addEntity(r){this.graph.addEntity(r),this.entities.add(r)}removeEntity(r){this.graph&&this.graph.removeEntity(r),this.entities.delete(r)}leaveGraph(r){const{graph:i}=this;for(const a of this.observers)this.removeObserver(a);for(const a of this.entities)this.removeEntity(a);s.leaveGraph.call(this,r)}*forEachAvailabilityInterval(r,i){const a=this.getProject(),o=yield this.$.effectiveCalendar,l=a.combineCalendars([o].concat(r.calendars||[])),c=a.maxCalendarRange,u=r.includeNonWorkingIntervals;return c&&(r=Object.assign({maxRange:c},r)),l.forEachAvailabilityInterval(r,(d,h,f)=>{const g=f.getCalendarsWorkStatus();if(u||g.get(o))return i(d,h,f)})}}return t}){},ms=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Ml=class extends O([yf,Lr,Gt],e=>{const s=e.prototype;class t extends e{construct(r={}){var i;this.eventSegmentModelClass=r.eventSegmentModelClass||this.getDefaultEventSegmentModelClass(),s.construct.call(this,r),this.includeAsapAlapAsConstraints=(i=r.includeAsapAlapAsConstraints)!=null?i:!0,this.resourceAllocationInfoClass||(this.resourceAllocationInfoClass=this.getDefaultResourceAllocationInfoClass())}getDefaultEventStoreClass(){return tn}getDefaultEventSegmentModelClass(){return Cl}getDefaultResourceAllocationInfoClass(){return $i}afterConfigure(){s.afterConfigure.apply(this,arguments),this.dateConstraintIntervalClass=this.dateConstraintIntervalClass||an,this.dependencyConstraintIntervalClass=this.dependencyConstraintIntervalClass||gs}getType(){return ts.SchedulerPro}getDefaultCycleEffectClass(){return fn}getDefaultEventModelClass(){return Ti}getDefaultDependencyModelClass(){return ml}getDefaultAssignmentModelClass(){return wi}getDefaultResourceModelClass(){return _i}async validateDependency(r,i,a,o){let l;return o&&(l=Array.isArray(o)?o:[o]),Me(r.outgoingDeps).some(u=>u.toEvent===i&&!(l!=null&&l.includes(u)))?Pr.DuplicatingDependency:await this.isDependencyCyclic(r,i,a,l)?Pr.CyclicDependency:Pr.NoError}async isValidDependency(r,i,a,o){return await this.validateDependency(r,i,a,o)===Pr.NoError}getDependencyCycleDetectionIdentifiers(r,i){return[i.$.earlyStartDateConstraintIntervals,i.$.earlyEndDateConstraintIntervals]}async isDependencyCyclic(r,i,a,o){const l=this.getDependencyStore().modelClass,c=new l({fromEvent:r,toEvent:i,type:a}),u=this.replica.branch({autoCommit:!1,onComputationCycle:"throw"});o&&(Array.isArray(o)||(o=[o]),o.forEach(d=>u.removeEntity(d))),u.addEntity(c),c.project=this;try{return await Promise.all(this.getDependencyCycleDetectionIdentifiers(r,i).map(d=>u.readAsync(d))),!1}catch(d){if(/cycle/i.test(d))return!0;if(!/conflict/i.test(d))throw d}}async isValidDependencyModel(r,i){return this.isValidDependency(r.fromEvent,r.toEvent,r.type,i)}}return ms([N({type:"string",defaultValue:Mr.ToEvent})],t.prototype,"dependenciesCalendar",void 0),ms([N({type:"boolean",defaultValue:!0})],t.prototype,"autoCalculatePercentDoneForParentTasks",void 0),ms([N({type:"boolean",defaultValue:!0})],t.prototype,"addConstraintOnDateSet",void 0),t}){},Uf=class extends gt(Bs){static get $name(){return"DeactivateDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.active=!1}},fn=class extends jr{getInvalidDependencies(){if(!this._invalidDependencies){const e=this.getDependencies();this._invalidDependencies=e.filter(s=>s.fromEvent===s.toEvent||s.fromEvent.contains(s.toEvent)||s.toEvent.contains(s.fromEvent))}return this._invalidDependencies}buildInvalidDependencyResolutions(e){return[this.removeDependencyConflictResolutionClass.new(e),this.deactivateDependencyConflictResolutionClass.new(e)]}matchDependencyBySourceAndTargetEvent(e,s,t){return e.active&&super.matchDependencyBySourceAndTargetEvent(e,s,t)}getResolutions(){if(!this._resolutions){const e=this.getInvalidDependencies(),s=[];for(const t of e)s.push(...this.buildInvalidDependencyResolutions({dependency:t}));e.length||s.push(this.deactivateDependencyCycleEffectResolutionClass.new(),...super.getResolutions()),this._resolutions=s}return this._resolutions}};ms([G(Uf)],fn.prototype,"deactivateDependencyCycleEffectResolutionClass",void 0),ms([G(gl)],fn.prototype,"removeDependencyConflictResolutionClass",void 0),ms([G(pl)],fn.prototype,"deactivateDependencyConflictResolutionClass",void 0);var Wf=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},zf=class extends O([or,Gt,Lr],e=>{const s=e.prototype;class t extends e{*maybeSkipNonWorkingTime(r,i=!0){return(yield this.$.childEvents).size>0?r:yield*s.maybeSkipNonWorkingTime.call(this,r,i)}*calculateStartDateConstraintIntervals(){const r=yield*s.calculateStartDateConstraintIntervals.call(this),i=yield this.$.parentEvent;if(i!=null&&i.graph){const a=yield i.$.startDateConstraintIntervals;r.push.apply(r,a)}return r}*calculateEndDateConstraintIntervals(){const r=yield*s.calculateEndDateConstraintIntervals.call(this),i=yield this.$.parentEvent;if(i!=null&&i.graph){const a=yield i.$.endDateConstraintIntervals;r.push.apply(r,a)}return r}*calculateEarlyStartDateConstraintIntervals(){const r=yield*s.calculateEarlyStartDateConstraintIntervals.call(this),i=yield this.$.parentEvent;if(i!=null&&i.graph){const a=yield i.$.earlyStartDateConstraintIntervals;r.push.apply(r,a),(yield i.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Forward&&r.push(gn.new({owner:i,side:ce.Start,startDate:yield i.$.startDate}))}return r}*calculateEarlyEndDateConstraintIntervals(){const r=yield*s.calculateEarlyEndDateConstraintIntervals.call(this),i=yield this.$.parentEvent;if(i!=null&&i.graph){const a=yield i.$.earlyEndDateConstraintIntervals;r.push.apply(r,a)}return r}}return t}){},qf=class extends gt(pi){static get $name(){return"RemoveManuallyScheduledParentConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return pt(this.L("L{descriptionTpl}"),e.name||e.id)}resolve(){this.event.manuallyScheduled=!1}},Gf=class extends hs{static get $name(){return"ManuallyScheduledParentConstraintIntervalDescription"}static getDescription(e){let s;switch(e.side){case ce.Start:s=this.L("L{startDescriptionTpl}");break;case ce.End:s=this.L("L{endDescriptionTpl}");break}return pt(s,...this.getDescriptionParameters(e))}static getDescriptionParameters(e){const s=e.owner;return[R.format(e.startDate,this.L("L{dateFormat}")),R.format(e.endDate,this.L("L{dateFormat}")),s.name||s.id]}},gn=class extends ur{getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const s=this.owner;e=e||s.graph.activeTransaction;const t=e.entries.get(s.$.manuallyScheduled);return!e.baseRevision.hasIdentifier(s.$$)||t&&!t.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.resetManuallyScheduledConflictResolutionClass.new({interval:this})])}};Wf([G(qf)],gn.prototype,"resetManuallyScheduledConflictResolutionClass",void 0),Wf([G(Gf)],gn.prototype,"descriptionBuilderClass",void 0);var ve=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Fi=class extends O([Lr,Gt],e=>{const s=e.prototype;class t extends e{*calculateLateStartDateConstraintIntervals(){const r=[],i=yield this.$.parentEvent;if(i){const a=yield i.$.lateStartDateConstraintIntervals;r.push.apply(r,a)}return r}*calculateLateEndDateConstraintIntervals(){const r=[],i=yield this.$.parentEvent;if(i){const a=yield i.$.lateEndDateConstraintIntervals;r.push.apply(r,a),(yield i.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Backward&&r.push(gn.new({side:ce.End,endDate:yield i.$.endDate}))}return r}*shouldRollupChildLateStartDate(r){return!0}*calculateMinChildrenLateStartDate(){let r=ae;const i=yield*this.subEventsIterable();for(let a of i){if(!(yield*this.shouldRollupChildLateStartDate(a)))continue;let o;(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.minChildrenLateStartDate),o=o||(yield a.$.lateStartDate),o&&o<r&&(r=o)}return r.getTime()-ae.getTime()?r:null}*calculateLateStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Backward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenLateStartDate;if(!(yield*this.isConstrainedLate()))return yield this.$.startDate;const r=(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),i=(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals);let a=yield*this.calculateEffectiveConstraintInterval(!0,r,i);if(a===null)return null;if(a.isIntervalEmpty()){a=yield*this.calculateEffectiveConstraintInterval(!0,r,i,!0);const o=cr.new({intervals:[...a.intersectionOf]});if((yield o)===bt.Cancel)yield kt(o);else return null}return Nt(a.endDate)?a.endDate:null}*shouldRollupChildLateEndDate(r){return!0}*calculateMaxChildrenLateEndDate(){let r=he;const i=yield*this.subEventsIterable();for(let a of i){if(!(yield*this.shouldRollupChildLateEndDate(a)))continue;let o;(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.maxChildrenLateEndDate),o=o||(yield a.$.lateEndDate),o&&o>r&&(r=o)}return r.getTime()-he.getTime()?r:null}*calculateLateStartDate(){return yield this.$.lateStartDateRaw}*calculateLateEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===L.Backward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenLateEndDate;if(!(yield*this.isConstrainedLate()))return yield this.$.endDate;const r=yield this.$.lateStartDateConstraintIntervals,i=yield this.$.lateEndDateConstraintIntervals;let a=yield*this.calculateEffectiveConstraintInterval(!1,r.concat(yield this.$.startDateConstraintIntervals),i.concat(yield this.$.endDateConstraintIntervals));if(a===null)return null;if(a.isIntervalEmpty()){a=yield*this.calculateEffectiveConstraintInterval(!1,(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals),!0);const o=cr.new({intervals:[...a.intersectionOf]});if((yield o)===bt.Cancel)yield kt(o);else return null}return Nt(a.endDate)?a.endDate:null}*calculateLateEndDate(){const r=yield this.$.lateEndDateRaw;return yield*this.maybeSkipNonWorkingTime(r,!1)}*calculateTotalSlack(){const r=yield this.$.earlyStartDateRaw,i=yield this.$.lateStartDateRaw,a=yield this.$.earlyEndDateRaw,o=yield this.$.lateEndDateRaw,l=yield this.$.slackUnit;let c,u;return(r&&i||a&&o)&&(r&&i?(u=yield*this.calculateProjectedDuration(r,i,l),a&&o&&(c=yield*this.calculateProjectedDuration(a,o,l),c<u&&(u=c))):a&&o&&(u=yield*this.calculateProjectedDuration(a,o,l))),u}*calculateCritical(){return(yield this.$.totalSlack)<=0}*isConstrainedLate(){const r=yield this.$.startDateConstraintIntervals,i=yield this.$.endDateConstraintIntervals,a=yield this.$.lateStartDateConstraintIntervals,o=yield this.$.lateEndDateConstraintIntervals;return!!(r!=null&&r.length||i!=null&&i.length||a!=null&&a.length||o!=null&&o.length)}*calculateStartDatePure(){return(yield this.$.effectiveDirection).direction===L.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*s.calculateStartDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():yield this.$.lateStartDate:yield*s.calculateStartDatePure.call(this)}*calculateStartDateProposed(){switch((yield this.$.effectiveDirection).direction){case L.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*s.calculateStartDateProposed.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():(yield this.$.lateStartDate)||(yield*s.calculateStartDateProposed.call(this));default:return yield*s.calculateStartDateProposed.call(this)}}*calculateEndDatePure(){return(yield this.$.effectiveDirection).direction===L.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*s.calculateEndDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():yield this.$.lateEndDate:yield*s.calculateEndDatePure.call(this)}*calculateEndDateProposed(){switch((yield this.$.effectiveDirection).direction){case L.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*s.calculateEndDateProposed.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():(yield this.$.lateEndDate)||(yield*s.calculateEndDateProposed.call(this));default:return yield*s.calculateEndDateProposed.call(this)}}}return ve([q({lazy:Ee})],t.prototype,"minChildrenLateStartDate",void 0),ve([q({lazy:Ee})],t.prototype,"lateStartDateRaw",void 0),ve([N({type:"date",persist:!1},{lazy:Ee,converter:zt,persistent:!1})],t.prototype,"lateStartDate",void 0),ve([q({lazy:Ee})],t.prototype,"maxChildrenLateEndDate",void 0),ve([q({lazy:Ee})],t.prototype,"lateEndDateRaw",void 0),ve([N({type:"date",persist:!1},{lazy:Ee,converter:zt,persistent:!1})],t.prototype,"lateEndDate",void 0),ve([q({lazy:Ee})],t.prototype,"lateStartDateConstraintIntervals",void 0),ve([q({lazy:Ee})],t.prototype,"lateEndDateConstraintIntervals",void 0),ve([N({type:"number",persist:!1},{lazy:Ee,persistent:!1})],t.prototype,"totalSlack",void 0),ve([N({type:"string",defaultValue:V.Day,persist:!1},{lazy:Ee,converter:R.normalizeUnit,persistent:!1})],t.prototype,"slackUnit",void 0),ve([N({type:"boolean",defaultValue:!1,persist:!1},{persistent:!1,lazy:Ee})],t.prototype,"critical",void 0),ve([j("lateStartDateConstraintIntervals")],t.prototype,"calculateLateStartDateConstraintIntervals",null),ve([j("lateEndDateConstraintIntervals")],t.prototype,"calculateLateEndDateConstraintIntervals",null),ve([j("minChildrenLateStartDate")],t.prototype,"calculateMinChildrenLateStartDate",null),ve([j("lateStartDateRaw")],t.prototype,"calculateLateStartDateRaw",null),ve([j("maxChildrenLateEndDate")],t.prototype,"calculateMaxChildrenLateEndDate",null),ve([j("lateStartDate")],t.prototype,"calculateLateStartDate",null),ve([j("lateEndDateRaw")],t.prototype,"calculateLateEndDateRaw",null),ve([j("lateEndDate")],t.prototype,"calculateLateEndDate",null),ve([j("totalSlack")],t.prototype,"calculateTotalSlack",null),ve([j("critical")],t.prototype,"calculateCritical",null),t}){},Nv=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},xl=class extends O([hl,Fi],e=>{const s=e.prototype;class t extends e{*shouldSuccessorAffectScheduling(r){const i=yield r.$.toEvent;return i&&!Cr(i)&&(yield r.$.active)&&(!(yield i.$.inactive)||(yield this.$.inactive))}*calculateLateStartDateConstraintIntervals(){const r=yield*s.calculateLateStartDateConstraintIntervals.call(this),i=this.getProject(),a=i.dependencyConstraintIntervalClass;let o;for(o of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(o)))continue;const l=yield o.$.toEvent,c=yield l.$.manuallyScheduled;let u;switch(yield o.$.type){case _e.StartToStart:u=c?yield l.$.startDate:yield l.$.lateStartDateRaw;break;case _e.StartToEnd:u=c?yield l.$.endDate:yield l.$.lateEndDateRaw;break}if(u){const d=yield o.$.lag,h=yield o.$.lagUnit,f=yield*i.$convertDuration(d,h,V.Millisecond),g=yield o.$.calendar;yield g.$.version;let p=u;f&&(p=g.skipNonWorkingTime(g.calculateStartDate(u,f)));const m=a.new({owner:o,startDate:null,endDate:p});r.unshift(m)}}return r}*calculateLateEndDateConstraintIntervals(){const r=yield*s.calculateLateEndDateConstraintIntervals.call(this),i=this.getProject(),a=i.dependencyConstraintIntervalClass;let o;for(o of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(o)))continue;const l=yield o.$.toEvent,c=yield l.$.manuallyScheduled;let u;switch(yield o.$.type){case _e.EndToEnd:u=c?yield l.$.endDate:yield l.$.lateEndDateRaw;break;case _e.EndToStart:u=c?yield l.$.startDate:yield l.$.lateStartDateRaw;break}if(u){const d=yield o.$.lag,h=yield o.$.lagUnit,f=yield*i.$convertDuration(d,h,V.Millisecond),g=yield o.$.calendar;yield g.$.version;let p=u;f&&(p=g.skipNonWorkingTime(g.calculateStartDate(u,f)));const m=a.new({owner:o,startDate:null,endDate:p});r.unshift(m)}}return r}*calculateEffectiveDirection(){const r=yield this.getProject().$.effectiveDirection,i=yield this.$.constraintType;if(r.direction===L.Backward&&!(yield this.$.manuallyScheduled)&&!((i===B.MustStartOn||i===B.MustFinishOn)&&(yield this.$.constraintDate)))for(const a of yield this.$.outgoingDeps){const o=yield a.$.toEvent,l=o!=null&&!Cr(o),c=l?yield o.$.constraintType:void 0;if(!l||!(yield a.$.active)||(yield o.$.manuallyScheduled)||(c===B.MustStartOn||c===B.MustFinishOn)&&(yield o.$.constraintDate))continue;const u=yield a.$.type,d=u===_e.EndToEnd||u===_e.StartToEnd?yield o.$.endDateDirection:yield o.$.startDateDirection;if(d.direction===L.Forward)return{kind:"enforced",direction:L.Forward,enforcedBy:d.kind==="enforced"?d.enforcedBy:d.kind==="own"?o:d.inheritedFrom}}return yield*super.calculateEffectiveDirection()}}return Nv([j("lateStartDateIntervals")],t.prototype,"calculateLateStartDateConstraintIntervals",null),t}){},Tl=Xt.new({variables:new Set([J,Q,te,Ie,Pe]),formulas:new Set([mr,Ze,pr,Yt,vr,Je,Qe])}),Hf=Fe.new({description:Tl,defaultResolutionFormulas:new Set([mr,Ze])}),Yf=Fe.new({description:Tl,defaultResolutionFormulas:new Set([vr,Ze])}),Kf=class extends O([dn],e=>{const s=e.prototype;class t extends e{*prepareDispatcher(r){if((yield*this.effectiveSchedulingMode())===me.FixedEffort){const a=yield*s.prepareDispatcher.call(this,r);return(yield ct(this.$.assigned))&&a.addProposedValueFlag(Pe),a.addKeepIfPossibleFlag(Ie),a}else return yield*s.prepareDispatcher.call(this,r)}cycleResolutionContext(r){if(this.effectiveSchedulingModeSync(r)===me.FixedEffort){const a=r(this.$.effectiveDirection);return a.direction===L.Forward||a.direction===L.None?Hf:Yf}else return s.cycleResolutionContext.call(this,r)}}return t}){},pn=Xt.new({variables:new Set([J,Q,te,Ie,Pe]),formulas:new Set([mr,Ze,Yt,pr,vr,Je,Qe])}),Jf=Fe.new({description:pn,defaultResolutionFormulas:new Set([mr,Qe,Yt])}),Qf=Fe.new({description:pn,defaultResolutionFormulas:new Set([mr,Qe,Ze])}),Zf=Fe.new({description:pn,defaultResolutionFormulas:new Set([vr,Je,Yt])}),Xf=Fe.new({description:pn,defaultResolutionFormulas:new Set([vr,Je,Ze])}),eg=class extends O([dn],e=>{const s=e.prototype;class t extends e{*prepareDispatcher(r){if((yield*this.effectiveSchedulingMode())===me.FixedUnits){const a=yield*s.prepareDispatcher.call(this,r);return(yield ct(this.$.assigned))&&a.addProposedValueFlag(Pe),(yield this.$.effortDriven)&&a.addKeepIfPossibleFlag(Ie),a.addKeepIfPossibleFlag(Pe),a}else return yield*s.prepareDispatcher.call(this,r)}cycleResolutionContext(r){if(this.effectiveSchedulingModeSync(r)===me.FixedUnits){const a=r(this.$.effectiveDirection),o=r(this.$.effortDriven);return a.direction===L.Forward||a.direction===L.None?o?Qf:Jf:o?Xf:Zf}else return s.cycleResolutionContext.call(this,r)}}return t}){},tg=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},Bv=class extends O([xl],e=>{const s=e.prototype;class t extends e{writeInactive(r,i,a,o){var l;const c=!i.baseRevision.hasIdentifier(r);if(r.constructor.prototype.write.call(this,r,i,a,o),!c&&this.children&&!((l=this.stm)!=null&&l.isRestoring))for(const u of this.children)u.inactive=o}*calculateInactive(){const r=yield X;if(yield*this.hasSubEvents()){const i=yield*this.subEventsIterable();let a=0;for(const o of i)(yield o.$.inactive)||a++;return!a}return r}*shouldRollupChildEffort(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildPercentDoneSummaryData(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildStartDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEndDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyStartDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyEndDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateStartDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateEndDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}}return tg([dt("inactive")],t.prototype,"writeInactive",null),tg([j("inactive")],t.prototype,"calculateInactive",null),t}){},Ol=class extends $a([Ti,zf,Fi,xl,Kf,eg,Bv],e=>{class s extends e{}return s}){},rg=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},sg=class extends O([Gt],e=>{const s=e.prototype;class t extends e{*calculateCriticalPaths(){const r=[],i=[],a=yield this.$.childEvents,o=[...a],l=yield this.$.endDate;let c;for(;c=o.shift();){const d=yield c.$.childEvents,h=yield c.$.critical,f=!(yield c.$.inactive),g=yield c.$.endDate;f&&g&&g.getTime()-l.getTime()===0&&h&&i.push([{event:c}]),o.push(...d)}let u;for(;u=i.shift();){let d=u.length-1,h;for(;h=u[d];){const f=[];for(const g of yield h.event.$.incomingDeps){const p=yield g.$.fromEvent;p&&(yield g.$.active)&&!(yield p.$.inactive)&&(yield p.$.critical)&&f.push({event:p,dependency:g})}if(f.length){const g=u.slice();u.push(f[0]);for(let p=1;p<f.length;p++)i.push(g.concat(f[p]));d++}else d=-1}r.push(u.reverse())}return r}}return rg([q({lazy:!0})],t.prototype,"criticalPaths",void 0),rg([j("criticalPaths")],t.prototype,"calculateCriticalPaths",null),t}){},Al=function(e,s,t,n){var r=arguments.length,i=r<3?s:n===null?n=Object.getOwnPropertyDescriptor(s,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,s,t,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(s,t,i):a(s,t))||i);return r>3&&i&&Object.defineProperty(s,t,i),i},ng=class extends O([Ml,xi,Fi,sg],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.nonEqual=!1}*calculateNonEqual(){return!(yield X)}get isGanttProjectMixin(){return!0}afterConfigure(){s.afterConfigure.apply(this,arguments),this.projectConstraintIntervalClass=this.projectConstraintIntervalClass||ji}*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}*calculateStartDate(){const r=yield this.$.effectiveDirection;if(r.direction===L.Forward){let i=yield X;return i||(i=yield*this.unsafeCalculateInitialMinChildrenStartDateDeep(),i||(yield this.$.nonEqual)),i}else if(r.direction===L.Backward){const i=yield*this.calculateMinChildrenStartDate(),a=yield this.$.endDate;return i&&a>i?i:a}}*calculateEndDate(){const r=yield this.$.effectiveDirection;if(r.direction===L.Forward){const i=yield this.$.startDate,a=yield*this.calculateMaxChildrenEndDate();return a&&a>i?a:i}else if(r.direction===L.Backward){let i=yield X;return i||(i=yield*this.unsafeCalculateInitialMaxChildrenEndDateDeep(),i||(yield this.$.nonEqual)),i}}*shouldRollupChildStartDate(r){return!(yield r.$.inactive)}*shouldRollupChildEndDate(r){return!(yield r.$.inactive)}*calculateEarlyStartDateConstraintIntervals(){const r=yield*s.calculateEarlyStartDateConstraintIntervals.call(this),i=yield this.$.effectiveDirection;if(i.direction===L.Forward){const a=yield this.$.startDate;a&&r.push(this.projectConstraintIntervalClass.new({owner:this,side:ce.Start,startDate:a}))}else if(i.direction===L.Backward){const a=yield this.$.lateStartDate;a&&r.push(this.projectConstraintIntervalClass.new({owner:this,side:ce.Start,startDate:a}))}return r}*calculateLateEndDateConstraintIntervals(){const r=yield*s.calculateLateEndDateConstraintIntervals.call(this),i=yield this.$.effectiveDirection;if(i.direction===L.Forward){const a=yield this.$.earlyEndDate;a&&r.push(this.projectConstraintIntervalClass.new({owner:this,side:ce.End,endDate:a}))}else if(i.direction===L.Backward){const a=yield this.$.endDate;a&&r.push(this.projectConstraintIntervalClass.new({owner:this,side:ce.End,endDate:a}))}return r}getDefaultEventModelClass(){return Ol}getDefaultAssignmentModelClass(){return wi}getDefaultResourceModelClass(){return _i}getDefaultEventStoreClass(){return Ho}getType(){return ts.Gantt}*unsafeCalculateInitialMinChildrenStartDateDeep(){const r=yield this.$.childEvents;if(!r.size)return yield br(this.$.startDate);let i=ae,a;const o=[...r];for(;a=o.shift();){let l=yield br(a.$.startDate);l||(l=yield br(a.$.endDate)),l&&l<i&&(i=l),o.push(...yield a.$.childEvents)}return i.getTime()!==he.getTime()&&i.getTime()!==ae.getTime()?i:null}*unsafeCalculateInitialMaxChildrenEndDateDeep(){const r=yield this.$.childEvents;if(!r.size)return yield br(this.$.endDate);let i=he,a;const o=[...r];for(;a=o.shift();){let l=yield br(a.$.endDate);l||(l=yield br(a.$.startDate)),l&&l>i&&(i=l),o.push(...yield a.$.childEvents)}return i.getTime()!==he.getTime()&&i.getTime()!==ae.getTime()?i:null}getDependencyCycleDetectionIdentifiers(r,i){return[i.$.earlyStartDateConstraintIntervals,i.$.earlyEndDateConstraintIntervals,i.$.lateEndDateConstraintIntervals,i.$.lateStartDateConstraintIntervals]}}return Al([q({equality:()=>!1})],t.prototype,"nonEqual",void 0),Al([j("nonEqual")],t.prototype,"calculateNonEqual",null),t}){},ig=class extends hs{static get $name(){return"ProjectConstraintIntervalDescription"}static getDescription(e){return pt(e.startDate?this.L("L{startDateDescriptionTpl}"):this.L("L{endDateDescriptionTpl}"),...this.getDescriptionParameters(e))}},ji=class extends ur{isAffectedByTransaction(e){const s=this.owner;e=e||s.graph.activeTransaction;const t=e.entries.get(this.startDate?s.$.startDate:s.$.endDate);return t&&!t.isShadow()}};Al([G(ig)],ji.prototype,"descriptionBuilderClass",void 0);var ki=class extends O([Ws],e=>{const s=e.prototype;class t extends e{get eventStore(){var r;return(r=this.project)==null?void 0:r.eventStore}get resourceStore(){var r;return(r=this.project)==null?void 0:r.resourceStore}get assignmentStore(){var r;return(r=this.project)==null?void 0:r.assignmentStore}get dependencyStore(){var r;return(r=this.project)==null?void 0:r.dependencyStore}get calendarManagerStore(){var r;return(r=this.project)==null?void 0:r.calendarManagerStore}getEventById(r){var i;return(i=this.eventStore)==null?void 0:i.getById(r)}getDependencyById(r){var i;return(i=this.dependencyStore)==null?void 0:i.getById(r)}getResourceById(r){var i;return(i=this.resourceStore)==null?void 0:i.getById(r)}getAssignmentById(r){var i;return(i=this.assignmentStore)==null?void 0:i.getById(r)}getCalendarById(r){var i;return(i=this.calendarManagerStore)==null?void 0:i.getById(r)}}return t}){},vs=class extends O([ls,ki,H],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(r=!1){var i;s.leaveProject.call(this,r),(i=this.project)==null||i.bufferedCommitAsync()}invalidate(){var r;(r=this.project)==null||r.invalidate(this)}getCurrentOrProposed(r){var i;return r in this.$changed&&this.$changed[r]!==!0?this.$changed[r]:(i=this.get(r))!=null?i:null}hasCurrentOrProposed(r){return r in this.$changed&&this.$changed[r]!=!0||this.get(r)!=null}propose(r){var i;if(this.project||(i=this.recurringTimeSpan)!=null&&i.project){const a=Object.keys(r);for(let o=0;o<a.length;o++){const l=a[o];this.$changed[l]=r[l]}this.invalidate()}else this.set(r)}setChanged(r,i,a=!0,o=!1){const l=this;l.$changed[r]=i,o&&(r in l.$beforeChange||(l.$beforeChange[r]=l.get(r)),l.setData(r,i)),a&&l.invalidate()}calculateInvalidated(){}finalizeInvalidated(r=!1){const i=this;i.$isCalculating=!0,r?i.setData(i.$changed):(i.setData(i.$beforeChange),i.set(i.$changed)),i.$changed={},i.$beforeChange={},i.$isCalculating=!1}}return t}){},Kt=class extends O([vs],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var r,i;return(i=(r=this._startDate)!=null?r:this.get("startDate"))!=null?i:null}get endDate(){var r,i;return(i=(r=this._endDate)!=null?r:this.get("endDate"))!=null?i:null}get duration(){var r,i;return(i=(r=this._duration)!=null?r:this.get("duration"))!=null?i:null}set startDate(r){this.proposeStartDate(r)}set endDate(r){this.proposeEndDate(r)}set duration(r){this.proposeDuration(r)}inSet(r,i,a,o,l){const c=this;return c.project&&!c.project.isWritingData&&typeof r!="string"&&!l&&("startDate"in r&&!("startDate"in c.$changed)&&(c.$changed.startDate=!0,c.invalidate()),"endDate"in r&&!("endDate"in c.$changed)&&(c.$changed.endDate=!0,c.invalidate())),s.inSet.call(c,r,i,a,o,l)}getStartDate(){return this.startDate}proposeStartDate(r,i=!("endDate"in this.$changed)){var a;(this.inSetting||(r==null?void 0:r.getTime())!==((a=this.startDate)==null?void 0:a.getTime()))&&(this._startDate=r,this.propose({startDate:r,keepDuration:i}))}async setStartDate(r,i=!0){var a;return this.proposeStartDate(r,i),(a=this.project)==null?void 0:a.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(r,i=!1){var a;(this.inSetting||(r==null?void 0:r.getTime())!==((a=this.endDate)==null?void 0:a.getTime()))&&(this._endDate=r,this.propose({endDate:r,keepDuration:i}))}async setEndDate(r,i=!1){var a;return this.proposeEndDate(r,i),(a=this.project)==null?void 0:a.commitAsync()}getDuration(){return this.duration}proposeDuration(r,i,a=!0){this._duration=r,this.propose({duration:r,keepStart:a}),i&&this.propose({durationUnit:i})}async setDuration(r,i,a=!0){var o;return this.proposeDuration(r,i,a),(o=this.project)==null?void 0:o.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){var r,i;const a=this,o=a.$changed,l=a.getCurrentOrProposed("startDate"),c=a.getCurrentOrProposed("endDate"),u=a.getCurrentOrProposed("duration");if(l!=null&&(o.startDate=a._startDate=l),c!=null&&(o.endDate=a._endDate=c),u!=null&&(o.duration=a._duration=u),a.eventStore&&!a.eventStore.isLoadingData){const d=(r=a.assignmentStore)==null?void 0:r.storage.findItem("event",null);if(d){const h=(i=a.assignmentStore)==null?void 0:i.storage.findItem("eventId",a.id);if(h)for(const f of h)f.setChanged("event",a);else for(const f of d)f.getCurrentOrProposed("event")===a.id&&f.setChanged("event",a)}}s.joinProject.call(a)}applyValue(r,i,a,o,l){var c;if((this.project||(c=this.recurringTimeSpan)!=null&&c.project)&&l){const{name:u}=l;(u==="startDate"||u=="duration"||u==="endDate")&&(r=!0,this["_"+u]=a),o&&(r=!1)}s.applyValue.call(this,r,i,a,o,l)}afterChange(r,i,a,o,l){!this.$isCalculating&&!l&&this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),s.afterChange.call(this,r,i,a,o,l)}calculateInvalidated(){const r=this,i=r.$changed,a="startDate"in i,o="endDate"in i,l="duration"in i,{startDate:c,endDate:u,duration:d,keepDuration:h,keepStart:f}=i;let g=null;a&&!o&&!l?c===null?i.endDate=null:r.hasCurrentOrProposed("endDate")&&c>r.getCurrentOrProposed("endDate")&&!h?(i.endDate=c,i.duration=0):r.hasCurrentOrProposed("duration")&&(h||!r.hasCurrentOrProposed("endDate"))?g="endDate":r.hasCurrentOrProposed("endDate")&&(g="duration"):!a&&o&&!l?u===null?i.startDate=null:r.hasCurrentOrProposed("startDate")&&!h&&u!==!0&&u<r.getCurrentOrProposed("startDate")?(i.startDate=u,i.duration=0):r.hasCurrentOrProposed("duration")&&(h||!r.hasCurrentOrProposed("startDate"))?g="startDate":r.hasCurrentOrProposed("startDate")&&(g="duration"):!a&&!o&&l?d===null?i.endDate=null:r.hasCurrentOrProposed("startDate")&&(f||!r.hasCurrentOrProposed("endDate"))?(f&&i.duration<0&&(i.duration=0),g="endDate"):r.hasCurrentOrProposed("endDate")&&(g="startDate"):a&&o&&!l?c===null&&u===null?i.duration=null:g="duration":a&&!o&&l?g="endDate":!a&&o&&l?g="startDate":a&&o&&l&&(d==null?g="duration":c==null?g="startDate":g="endDate");const p=r.getCurrentOrProposed("startDate"),m=r.getCurrentOrProposed("endDate"),y=r.getCurrentOrProposed("duration"),D=r.getCurrentOrProposed("durationUnit");let E,C;switch(g){case"startDate":i.startDate=R.add(m,-y,D);break;case"endDate":E=R.as("hour",y,D),C=R.as(D,E,"h"),i.endDate=R.add(p,C,D);break;case"duration":E=R.diff(p,m,"h"),i.duration=R.as(D,E,"h");break}"startDate"in i&&i.startDate!==!0&&(this._startDate=i.startDate),"endDate"in i&&i.endDate!==!0&&(this._endDate=i.endDate),"duration"in i&&i.duration!==!0&&(this._duration=i.duration),i.startDate===!0&&delete i.startDate,i.endDate===!0&&delete i.endDate,delete i.keepDuration,delete i.keepStart}}return t}){},ys=class extends O([vs],e=>{const s=e.prototype;class t extends e{get assigned(){var r;return(r=this.project)==null?void 0:r.assignmentStore.getResourcesAssignments(this)}joinProject(){var r;this.resourceStore&&!this.resourceStore.isLoadingData&&((r=this.assignmentStore)==null||r.query(i=>i.get("resource")===this.id).forEach(i=>i.setChanged("resource",this))),s.joinProject.call(this)}leaveProject(r=!1){var i;if(this.assigned&&!r&&!((i=this.resourceStore)!=null&&i.isLoadingData)){const a=this.resourceStore;this.assigned.forEach(o=>a.assignmentsForRemoval.add(o))}s.leaveProject.call(this)}applyValue(r,i,a,o,l){(l==null?void 0:l.name)==="id"&&this.assigned.forEach(c=>{c.set("resourceId",a)}),s.applyValue.call(this,r,i,a,o,l)}}return t}){};function Li(e){return e!=null&&e.isModel?e.id:e}var Ni=class extends O([vs],e=>{const s=e.prototype;class t extends e{static get fields(){return[{name:"resource",isEqual:(r,i)=>r===i,persist:!1},{name:"event",isEqual:(r,i)=>r===i,persist:!1}]}setChanged(r,i,a){const{assignmentStore:o,eventStore:l,resourceStore:c,project:u}=this;let d=!1;if(r==="event"){const h=ze(i,Kt)?i:l==null?void 0:l.$master.getById(i);h&&(d=!0),i=h||i}if(r==="resource"){const h=ze(i,ys)?i:c==null?void 0:c.$master.getById(i);h&&(d=!0),i=h||i}s.setChanged.call(this,r,i,a,!0),o&&d&&!u.isPerformingCommit&&!o.isLoadingData&&!(c!=null&&c.isLoadingData)&&!o.skipInvalidateIndices&&o.invalidateIndices()}joinProject(){s.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){var r,i;let{event:a=this.event,resource:o=this.resource}=this.$changed;if(a!==null&&!ze(a,Kt)){const l=(r=this.eventStore)==null?void 0:r.getById(a);l&&this.setChanged("event",l,!1)}if(o!==null&&!ze(o,ys)){const l=(i=this.resourceStore)==null?void 0:i.getById(o);l&&this.setChanged("resource",l,!1)}}finalizeInvalidated(r){const i=this.$changed;"resource"in i&&(i.resourceId=Li(i.resource)),"event"in i&&(i.eventId=Li(i.event)),s.finalizeInvalidated.call(this,r)}set event(r){this.setChanged("event",r),this.setChanged("eventId",Li(r))}get event(){const r=this.get("event");return(r==null?void 0:r.id)!=null?r:null}set resource(r){this.setChanged("resource",r),this.setChanged("resourceId",Li(r))}get resource(){const r=this.get("resource");return(r==null?void 0:r.id)!=null?r:null}}return t}){},Ss=class extends O([mt,ki,K],e=>{const s=e.prototype;class t extends e{setProject(r){const i=s.setProject.call(this,r);return r&&this.joinProject(r),i}joinProject(r){}onCommitAsync(){}}return t}){},ag=new Set,$l=class extends O([rl,Ss],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:Ni,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(r){this.allAssignmentsForRemoval=!0,super.data=r,this.allAssignmentsForRemoval=!1}getEventsAssignments(r){return this.storage.findItem("event",r,!0)||ag}getResourcesAssignments(r){return this.storage.findItem("resource",r.$original,!0)||ag}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(r,i){r=r.masterStore||r;const a=this.count&&this.storage.findItem(i,null,!0);if(a){for(const o of a){const l=r.getById(o.getCurrentOrProposed(i));l&&o.setChanged(i,l)}this.invalidateIndices()}}unlinkAssignments(r){this.forEach(i=>{var a,o,l;return i.setChanged(r,(l=(o=(a=i[r])==null?void 0:a.id)!=null?o:i==null?void 0:i.getData(r))!=null?l:i[r+"Id"])}),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},_l=class extends O([Fo,vs],e=>{const s=e.prototype;class t extends e{}return t}){},og=class extends O([nl,Ss],e=>{const s=e.prototype;class t extends e{static get defaultConfig(){return{tree:!0,modelClass:_l}}}return t}){},Bi=class extends O([vs],e=>{const s=e.prototype;class t extends e{static get fields(){return[{name:"fromEvent",isEqual:(r,i)=>r===i,persist:!1},{name:"toEvent",isEqual:(r,i)=>r===i,persist:!1}]}setChanged(r,i,a){var o,l,c;let u=!1;if(r==="fromEvent"||r==="toEvent"){const d=ze(i,Kt)?i:(o=this.eventStore)==null?void 0:o.getById(i);d&&(u=!0),i=d||i}s.setChanged.call(this,r,i,a,!0),u&&!this.project.isPerformingCommit&&!((l=this.dependencyStore)!=null&&l.isLoadingData)&&((c=this.dependencyStore)==null||c.invalidateIndices())}joinProject(){s.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){var r,i;let{fromEvent:a,toEvent:o}=this.$changed;if(a!==null&&!ze(a,Kt)){const l=(r=this.eventStore)==null?void 0:r.getById(a);l&&(this.$changed.fromEvent=l)}if(o!==null&&!ze(o,Kt)){const l=(i=this.eventStore)==null?void 0:i.getById(o);l&&(this.$changed.toEvent=l)}}set fromEvent(r){this.setChanged("fromEvent",r)}get fromEvent(){const r=this.get("fromEvent");return(r==null?void 0:r.id)!=null?r:null}set toEvent(r){this.setChanged("toEvent",r)}get toEvent(){const r=this.get("toEvent");return(r==null?void 0:r.id)!=null?r:null}}return t}){},lg=new Set,Fl=class extends O([al,Ss],e=>{const s=e.prototype;class t extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:Bi,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(r){return this.storage.findItem("toEvent",r)||lg}getOutgoingDepsForEvent(r){return this.storage.findItem("fromEvent",r)||lg}set data(r){this.allDependenciesForRemoval=!0,super.data=r,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},cg=class extends O([Kt,Wo],e=>{const s=e.prototype;class t extends e{get assigned(){var r,i;return(i=(r=this.project)==null?void 0:r.assignmentStore.getEventsAssignments(this))!=null?i:this.$cachedAssignments}leaveProject(r=!1){this.$cachedAssignments=this.assigned,super.leaveProject(r)}applyValue(r,i,a,o,l){var c;i==="id"&&((c=this.assigned)==null||c.forEach(u=>u.set("eventId",a))),s.applyValue.call(this,r,i,a,o,l)}copy(r=null,i=null){const a=s.copy.call(this,r,i);return(x.isObject(i)&&!i.skipFieldIdentifiers||!x.isObject(i))&&(a.$cachedAssignments=this.assigned),a}}return t}){},ug=class extends O([Kt],e=>{const s=e.prototype;class t extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const r=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach(i=>r.dependenciesForRemoval.add(i)),this.incomingDeps&&this.incomingDeps.forEach(i=>r.dependenciesForRemoval.add(i)),s.leaveProject.call(this)}}return t}){},Vi=class extends O([Kt,cg,ug],e=>{const s=e.prototype;class t extends e{}return t}){},jl=class extends O([Go,Ss],e=>{const s=e.prototype;class t extends e{static get defaultConfig(){return{modelClass:Vi}}joinProject(){var r;(r=this.assignmentStore)==null||r.linkAssignments(this,"event")}afterLoadData(){var r;this.afterEventRemoval(),(r=this.assignmentStore)==null||r.linkAssignments(this,"event")}}return t}){},kl=class extends O([ll,Ss],e=>{const s=e.prototype;class t extends e{static get defaultConfig(){return{modelClass:ys}}joinProject(){var r;(r=this.assignmentStore)==null||r.linkAssignments(this,"resource")}afterLoadData(){var r;(r=this.assignmentStore)==null||r.linkAssignments(this,"resource")}clear(r){var i;s.clear.call(this,r),(i=this.assignmentStore)==null||i.unlinkAssignments("resource")}}return t}){},dg=class extends O([],Ar){},hg=class extends O([pf,ki,dg,H],e=>{const s=e.prototype;class t extends e{static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:Vi,assignmentModelClass:Ni,resourceModelClass:ys,dependencyModelClass:Bi,calendarModelClass:_l,eventStoreClass:jl,assignmentStoreClass:$l,resourceStoreClass:kl,dependencyStoreClass:Fl,calendarManagerStoreClass:og,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(r={}){var i;const a=this;if(a.$invalidated=new Set,a.isPerformingCommit=!1,a.silenceInitialCommit=!0,a.ongoing=Promise.resolve(),r.eventStore&&!r.assignmentStore){const f=r.eventStore.masterStore||r.eventStore,g=f.assignmentStore||((i=f.crudManager)==null?void 0:i.assignmentStore);g!=null&&g.isAssignmentStore&&(r.assignmentStore=g,a.isSharingAssignmentStore=!0)}s.construct.call(a,r),a.defaultCalendar=new a.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:a.unspecifiedTimeIsWorking}),a.defaultCalendar.project=a;const{calendarsData:o,eventsData:l,dependenciesData:c,resourcesData:u,assignmentsData:d}=a;!!(o||l||c||u||d)?(a.loadInlineData({calendarsData:o,eventsData:l,dependenciesData:c,resourcesData:u,assignmentsData:d}),delete a.calendarsData,delete a.eventsData,delete a.dependenciesData,delete a.resourcesData,delete a.assignmentsData):a.bufferedCommitAsync()}doDestroy(){var r,i,a,o,l,c;const u=this;(r=u.eventStore)==null||r.destroy(),(i=u.dependencyStore)==null||i.destroy(),(a=u.assignmentStore)==null||a.destroy(),(o=u.resourceStore)==null||o.destroy(),(l=u.calendarManagerStore)==null||l.destroy(),u.defaultCalendar.destroy(),(c=u.stm)==null||c.destroy(),s.doDestroy.call(this)}async loadInlineData(r){const i=this;i.isLoadingInlineData=!0,r.calendarsData&&(i.calendarManagerStore.data=r.calendarsData),r.resourcesData&&(i.resourceStore.data=r.resourcesData),r.assignmentsData&&(i.assignmentStore.data=r.assignmentsData),r.eventsData&&(i.eventStore.data=r.eventsData),r.tasksData&&(i.eventStore.data=r.tasksData),r.dependenciesData&&(i.dependencyStore.data=r.dependenciesData),await i.commitLoad(),i.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(r){const i=a=>{a.setProject(this),a.joinProject()};r.rootNode?r.rootNode.traverse(i):r.forEach(i)}unJoinStoreRecords(r){const i=a=>{a.leaveProject(),a.setProject(this)};r.rootNode?r.rootNode.traverse(a=>{a!==r.rootNode&&i(a)}):r.forEach(i)}resolveStoreAndModelClass(r,i){const a=(i==null?void 0:i.storeClass)||this[`${r}StoreClass`];let o=i==null?void 0:i.modelClass;return o||(this.getDefaultConfiguration()[`${r}ModelClass`]!==a.getDefaultConfiguration().modelClass?o=a.getDefaultConfiguration().modelClass:o=this[`${r}ModelClass`]),{storeClass:a,modelClass:o}}setEventStore(r){this.eventStore=r}changeEventStore(r,i){const a=this,{stm:o}=a;if(a.detachStore(i),r instanceof K)r.project=a,o.addStore(r),a.joinStoreRecords(r);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("event",r);r=new l(x.assign({modelClass:c,project:a,stm:o},r))}if(i&&o.hasStore(i)){o.removeStore(i),a.unJoinStoreRecords(i);const{assignmentsForRemoval:l}=i;l.forEach(c=>{const u=c.event;if(u){const d=r.getById(u.id);d&&(c.event=d,l.delete(c))}}),i.afterEventRemoval()}return r.setProject(a),r}updateEventStore(r,i){this.attachStore(r),this.trigger("eventStoreChange",{store:r})}setAssignmentStore(r){this.assignmentStore=r}changeAssignmentStore(r,i){const a=this,{stm:o}=a;if(a.detachStore(i),i&&o.hasStore(i)&&(o.removeStore(i),a.unJoinStoreRecords(i)),r instanceof K)r.project=a,o.addStore(r),a.joinStoreRecords(r);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("assignment",r);r=new l(x.assign({modelClass:c,project:a,stm:o},r))}return r.setProject(a),r}updateAssignmentStore(r,i){this.attachStore(r),this.trigger("assignmentStoreChange",{store:r})}setResourceStore(r){this.resourceStore=r}changeResourceStore(r,i){const a=this,{stm:o}=a;if(a.detachStore(i),r instanceof K)r.project=a,o.addStore(r),a.joinStoreRecords(r);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("resource",r);r=new l(x.assign({modelClass:c,project:a,stm:o},r))}if(i&&o.hasStore(i)){o.removeStore(i),a.unJoinStoreRecords(i);const{assignmentsForRemoval:l}=i;l.forEach(c=>{const u=c.resource;if(u){const d=r.getById(u.id);d&&(c.resource=d,l.delete(c))}}),i.afterResourceRemoval()}return r.setProject(a),r}updateResourceStore(r,i){this.attachStore(r),this.trigger("resourceStoreChange",{store:r})}setDependencyStore(r){this.dependencyStore=r}changeDependencyStore(r,i){const a=this;if(a.detachStore(i),r instanceof K)r.project=a,a.stm.addStore(r),a.joinStoreRecords(r);else{const{storeClass:o,modelClass:l}=a.resolveStoreAndModelClass("dependency",r);r=new o(x.assign({modelClass:l,project:a,stm:a.stm},r))}return r}updateDependencyStore(r,i){this.attachStore(r),this.trigger("dependencyStoreChange",{store:r})}setCalendarManagerStore(r){this.calendarManagerStore=r}changeCalendarManagerStore(r,i){const a=this;if(a.detachStore(i),r instanceof K)a.stm.addStore(r);else{const o=(r==null?void 0:r.storeClass)||a.calendarManagerStoreClass,l=(r==null?void 0:r.modelClass)||o.getDefaultConfiguration().modelClass||a.calendarModelClass;r=new o(x.assign({modelClass:l,project:a,stm:a.stm},r))}return r.setProject(a),r}updateCalendarManagerStore(r,i){this.attachStore(r),this.trigger("calendarManagerStoreChange",{store:r})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(r){this.$calendar=r}get effectiveCalendar(){return this.calendar}async addEvent(r){return this.eventStore.add(r),this.commitAsync()}async addAssignment(r){return this.assignmentStore.add(r),this.commitAsync()}async addResource(r){return this.resourceStore.add(r),this.commitAsync()}async addDependency(r){return this.dependencyStore.add(r),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const r=this;if(r.isPerformingCommit=!0,r.unScheduleAutoCommit(),await fd(0),!r.isDestroyed){for(const c of r.$invalidated)c.calculateInvalidated();const{isInitialCommit:i,silenceInitialCommit:a}=r,o=i&&a;r.assignmentStore.onCommitAsync(),r.dependencyStore.onCommitAsync(),r.isInitialCommitPerformed=!0,r.hasLoadedDataToCommit=!1,r.isPerformingCommit=!1;const l=[r.assignmentStore,r.dependencyStore,r.eventStore,r.resourceStore,r.calendarManagerStore];if(l.forEach(c=>{var u;return(u=c.suspendAutoCommit)==null?void 0:u.call(c)}),r.isWritingData=!0,r.trigger("refresh",{isInitialCommit:i,isCalculated:!0}),o)for(const c of r.$invalidated)c.finalizeInvalidated(!0);else{for(const c of r.$invalidated)c.beginBatch(!0),c.finalizeInvalidated();for(const c of r.$invalidated)c.endBatch(!1,!0)}return r.isWritingData=!1,r.$invalidated.clear(),r.trigger("dataReady"),l.forEach(c=>{var u;return(u=c.resumeAutoCommit)==null?void 0:u.call(c)}),r.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(r){this.$invalidated.add(r),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(r){r=this.$stm=new kr(x.assign({disabled:!0},r)),r.ion({restoringStop:async()=>{r.disable(),await this.commitAsync(),this.isDestroyed||(r.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return t.applyConfigs=!0,t}){},Ur=Symbol("value"),fg=Symbol("length"),Ue=class{static change(e,s,t,n="string"){t=Ue.normalize(t,"object");const r=Ue.normalize(e,"array").filter(i=>!t[i]);if(s){s=Ue.normalize(s,"array");for(let i=0;i<s.length;++i)r.includes(s[i])||r.push(s[i])}return Ue.normalize(r,n)}static from(e,s){return e&&(e.isDomClassList?s=s!=null?s:!0:(s=s!=null?s:_.isObject(e)&&!_.isEmpty(e),e=new Ue(e)),!e.value&&!s&&(e=null)),e||(s?new Ue:null)}static normalize(e,s="string"){e=e||"";const t=typeof e,n=s==="array",r=s==="object",i=!n&&!r;let a=t==="string",o,l,c;for(t==="object"&&(e.nodeType===Element.ELEMENT_NODE&&typeof e.getAttribute=="function"?(e=e.getAttribute("class")||"",a=!0):e!=null&&e.isDomClassList?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof Map?e=Array.from(e.keys()).filter(u=>e.get(u)):e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=_.getTruthyKeys(e))),a&&(e=[...new Set(U.split(e))]),l=e.length;l-- >0;)o=e[l],o.length?o.includes(" ")&&e.splice(l,1,...U.split(o)):e.splice(l,1);if(n)c=e;else if(i)c=e.join(" ");else for(c=Object.create(null),l=0;l<e.length;++l)c[e[l]]=!0;return c}constructor(...e){this.process(1,e)}clear(){for(const e in this)this[e]=!1;return this}set(...e){return this.clear().process(1,e)}get isDomClassList(){return!0}clone(){return new Ue(this)}contains(e){return typeof e=="string"&&e?!!this[e]:!1}toString(){return this.length?`${this.value} `:""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){const s=Ue.normalize(e,"array"),t=s.length;if(this.length===t){for(let n=0;n<t;n++)if(!this[s[n]])return!1;return!0}return!1}get value(){let e=this[Ur],s;return e==null&&(s=_.getTruthyKeys(this),this[fg]=s.length,this[Ur]=e=s.join(" ")),e}set value(e){const s=this,t=Object.keys(s),n=t.length;for(let r=0;r<n;r++)delete s[t[r]];e?s.process(1,[e]):delete s[Ur]}get values(){return _.getTruthyKeys(this)}get length(){return this.value?this[fg]:0}process(e,s){for(let t,n,r=0;r<s.length;r++)if(s[r])if(t=s[r],t.isDomClassList||_.isObject(t))for(n in t)this[n]=e?t[n]:!t[n];else for(t=Ue.normalize(s[r],"array"),n=0;n<t.length;++n)this[t[n]]=e;return delete this[Ur],this}assign(e){for(const s in e)!this[s]!=!e[s]&&(this[s]=e[s],delete this[Ur]);return this}assignTo(e){const s=e.nodeType===Element.ELEMENT_NODE?e.classList:e,t=Ue.from(s);t.add(this),s.value=t.value}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}toggle(e,s=!this[e]){if(s=!!s,!!this[e]!==s)return this[e]=s,delete this[Ur],!0}split(){return _.getTruthyKeys(this)}forEach(e){return _.getTruthyKeys(this).forEach(e)}};Ue.prototype[Ur]=null,Ue._$name="DomClassList";var Vv=(e,s)=>(Array.isArray(s[1])?s[1].forEach(t=>e.push(encodeURIComponent(s[0])+"="+encodeURIComponent(t))):e.push(encodeURIComponent(s[0])+"="+encodeURIComponent(s[1])),e),Ui=Promise.resolve(),mn=e=>String(e).padStart(2,"0"),Uv=e=>`${e.getFullYear()}-${mn(e.getMonth()+1)}-${mn(e.getDate())}T${mn(e.getHours())}:${mn(e.getMinutes())}:${mn(e.getSeconds())}.${e.getMilliseconds()}`,We=class extends K{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:null,writeAllFields:null,parentIdParamName:"id",responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",filterParamName:null,restfulFilter:!1,sortParamName:null,pageParamName:null,pageStartParamName:null,pageSizeParamName:"pageSize",pageSize:50,useRestfulMethods:null,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"}}}static get configurable(){return{params:null}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch(()=>{})}get isLoading(){return this._isLoading?2:this.loadTriggerPromise?1:!1}get isCommitting(){return!!this.commitPromise}set pageParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this._pageParamName=e}get pageParamName(){return this._pageParamName}set pageStartParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this._pageStartParamName=e}get pageStartParamName(){return this._pageStartParamName}get isPaged(){return this.pageParamName||this.pageStartParamName}get allCount(){return"remoteTotal"in this?this.remoteTotal:super.allCount}get lastPage(){if(this.isPaged)return Math.floor((this.allCount+this.pageSize-1)/this.pageSize)}buildQueryString(e,...s){const t=e.includes("?"),n=Object.entries(Object.assign({},...s)).reduce(Vv,[]).join("&");return n?(t?"&":"?")+n:""}async performSort(e){const s=this;if(s.remoteSort&&!s.isRemoteDataLoading){s.isRemoteDataLoading=!0;const t=await s.internalLoad({},"",n=>{s.data=n.data,s.afterPerformSort(e)});return s.isRemoteDataLoading=!1,t}else super.performSort(e)}async performFilter(e){var s;const t=this;if(t.remoteFilter){(s=t.loadingPromise)==null||s.abort(),t.isRemoteDataLoading=!0;const n=t.count,{filters:r}=t;t.currentPage=1;const i=await t.internalLoad({},"",a=>{t.data=a.data,a=e?null:{action:"filter",filters:r,oldCount:n,records:t.storage.values},t.afterPerformFilter(a),t.trigger("refresh",a)});return t.isRemoteDataLoading=!1,i}else super.performFilter(e)}encodeFilterParams(e){const s=[];for(const{property:t,operator:n,value:r,caseSensitive:i}of e)s.push({field:t,operator:n,value:r,caseSensitive:i});return JSON.stringify(s,function(t,n){return t===""?n:this[t]instanceof Date?Uv(this[t]):n})}encodeSorterParams(e){return JSON.stringify(e.filter(s=>!s.sortFn).map(s=>s))}buildReadUrl(){const{readUrl:e}=this;return this.restfulFilter&&this.filters.count?(e.endsWith("/")?e:e+"/")+this.filters.first.value:e}internalLoad(e,s,t,n=0){e=x.assign({},this.params,e);const r=this,i=r.buildReadUrl(),a={action:"read"+s,params:e,url:i};if(!i)throw new Error("No load url specified");if(r.trigger("beforeLoad"+s,a)===!1)throw!1;return r.loadArgs=[i,a,e,s,t],n===!1?new Promise((o,l)=>r.sendLoadRequest(o,l)):r.loadTriggerPromise||(r.loadTriggerPromise=new Promise((o,l)=>{r.setTimeout({delay:n,fn:"sendLoadRequest",args:[o,l],cancelOutstanding:!0})}))}async sendLoadRequest(e,s){const t=this,[n,r,i,a,o]=t.loadArgs;if(t.loadTriggerPromise=null,n){if(t._isLoading=!0,t.trigger(`load${a}Start`,r),t.trigger("beforeRequest",r),t.filterParamName&&t.isFiltered&&(i[t.filterParamName]=t.encodeFilterParams(t.filters.values)),t.remoteSort&&t.isSorted&&(i[t.sortParamName]=t.encodeSorterParams(t.groupers?t.groupers.concat(t.sorters):t.sorters)),t.isPaged){if(!(t.pageParamName in i||t.pageStartParamName in i)){const c=Math.min(t.currentPage||1,t.allCount?t.lastPage:1/0);t.pageParamName?i[t.pageParamName]=c:i[t.pageStartParamName]=(c-1)*t.pageSize}i[t.pageSizeParamName]=t.pageSize}const l={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(l.method=t.httpMethods.read,r.body&&(l.body=JSON.stringify(r.body)));try{const c=t.loadingPromise=tr.get(r.url+t.buildQueryString(r.url,i),x.assign(l,t.fetchOptions)),u=await c,d=u.parsedJson,h=Array.isArray(d),f=h||d&&x.getPath(d,t.responseSuccessProperty)!==!1,g=h?null:x.getPath(d,t.responseTotalProperty);if(t.isDestroyed)return;if(t.loadingPromise=null,t._isLoading=!1,r.response=u,r.json=d,f){if(g!=null&&(t.remoteTotal=parseInt(g,10)),t.isPaged)if(t.remoteTotal>=0){const p=t.pageParamName?i[t.pageParamName]:i[t.pageStartParamName]/t.pageSize+1;t.currentPage=Math.min(p,t.lastPage)}else throw new Error("A paged store must receive its responseTotalProperty in each data packet");r.data=h?d:x.getPath(d,t.responseDataProperty),await o(r),!t.isDestroyed&&t.trigger("load"+a,r),e(r)}else Object.assign(r,{exception:!0,exceptionType:"server",error:d==null?void 0:d.error}),!t.isDestroyed&&t.trigger("exception",r),s(r);!t.isDestroyed&&t.trigger("afterRequest",r)}catch(c){t._isLoading=!1,r.exception=!0,c instanceof Response?(r.exceptionType=c.ok?"server":"network",r.response=c,r.error=c.error):(r.exceptionType="server",r.error=c),!t.isDestroyed&&t.trigger("exception",r),s(r),!t.isDestroyed&&t.trigger("afterRequest",r)}}}async load(e){const s=this;return s.isPaged?s.loadPage(s.currentPage||1,e):s.internalLoad(e,"",t=>{s.data=t.data})}async loadChildren(e){return this.readUrl?this.internalLoad({[this.parentIdParamName]:e.id},"Children",s=>{s.parentRecord=e,e.children.length&&e.clearChildren(!0),e.data[e.constructor.childrenField]=s.data,e.processChildren(e.stores)},!1):this.immediatePromise}async loadPage(e,s){this.allCount&&(e=Math.min(e,this.lastPage));const t=this,n=t.pageParamName?{[t.pageParamName]:e}:{[t.pageStartParamName]:(e-1)*t.pageSize};return n[t.pageSizeParamName]=t.pageSize,t.internalLoad(x.assign(n,s),"Page",r=>{t.loadData(r.data,"pageLoad")})}async nextPage(e){const s=this;return s.isPaged&&s.currentPage!==s.lastPage?s.loadPage(s.currentPage+1,e):Ui}async previousPage(e){return this.isPaged&&this.currentPage!==1?this.loadPage(this.currentPage-1,e):Ui}async commit(){const e=this,{changes:s}=e,t=[];if(e.commitPromise)return!1;if(!s)return e.modified.count&&(e.modified.forEach(n=>n.clearChanges(!0,!1)),e.modified.clear()),Ui;if(e.trigger("beforeCommit",{changes:s})!==!1){[...s.added,...s.modified,...s.removed].forEach(i=>i.meta.committing=!0),e.trigger("commitStart",{changes:s});const n={action:"commit",exception:!1,changes:s};let r=e.commitRemoved(n);return r&&t.push(r),r=e.commitAdded(n),r&&t.push(r),r=e.commitModified(n),r&&t.push(r),t.length?(r=t.length===1?t[0]:Promise.all(t),e.commitPromise=new Promise((i,a)=>{r.then(()=>{e.commitPromise=null,n.exception?(e.trigger("exception",n),a(n)):(e.trigger("commit",{changes:s}),i(n))}).catch(()=>{e.commitPromise=null,a(n)})})):(e.modified.forEach(i=>i.clearChanges(!0,!1)),e.modified.clear(),e.added.forEach(i=>i.clearChanges(!0,!1)),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:s}),Ui)}}doAutoCommit(){this.suspendCount<=0&&this.commit().catch(e=>{const{response:s}=e;if(!(s&&(s.ok&&s.parsedJson||[500,404].includes(s.status))))throw e})}commitAdded(e){const s=this,t=s.added,n={action:"create",params:s.params};return t.count&&s.createUrl?new Promise(r=>{const i=t.values.map(c=>c.persistableData);e.create=n,n.body={data:i},s.trigger("beforeRequest",n);let a=n.body;if(s.sendAsFormData){const c=new FormData;c.append("data",JSON.stringify(i)),a=c}const o={headers:s.headers,parseJson:!0},l=s.createUrl+s.buildQueryString(s.createUrl,s.params);s.useRestfulMethods&&(o.method=s.httpMethods.create),tr.post(l,a,x.assign(o,s.fetchOptions)).then(c=>{const u=c.parsedJson,d=Array.isArray(u),h=d||u&&u.success!==!1;e.response=c,n.json=u,n.response=c,h?(s.processReturnedData(t.values,d?u:x.getPath(u,s.responseDataProperty)),t.clear(),s.trigger("commitAdded"),s.trigger("refresh",n),r(e)):(t.forEach(f=>f.meta.committing=!1),e.exception=n.exception=!0,e.exceptionType=n.exceptionType="server",s.trigger("exception",n),r(e)),s.trigger("afterRequest",n)}).catch(c=>{t.forEach(u=>u.meta.committing=!1),e.exception=n.exception=!0,c instanceof Response?(e.response=c,n.exceptionType=c.ok?"server":"network",n.response=c,n.error=c.error):(n.exceptionType="server",n.error=c),s.trigger("exception",n),r(e),s.trigger("afterRequest",n)})}):null}commitModified(e){const s=this,{modified:t}=s.changes,n={action:"update",params:s.params},r=t.length&&s.updateUrl?new Promise(i=>{const a=t.map(c=>s.writeAllFields?c.persistableData:c.modificationDataToWrite).filter(c=>!x.isEmpty(c));if(a.length===0){s.modified.clear(),t.forEach(c=>c.meta.committing=!1),i();return}e.update=n,n.body={data:a},s.trigger("beforeRequest",n);let o=n.body;if(s.sendAsFormData){const c=new FormData;c.append("data",JSON.stringify(a)),o=c}const l={headers:s.headers,parseJson:!0};s.useRestfulMethods&&(l.method=s.httpMethods.update),tr.post(s.updateUrl+s.buildQueryString(s.updateUrl,s.params),o,x.assign(l,s.fetchOptions)).then(c=>{const u=c.parsedJson,d=Array.isArray(u),h=d||u&&u.success!==!1;e.response=c,n.json=u,n.response=c,h?(s.processReturnedData(t,d?u:x.getPath(u,s.responseDataProperty),!0),s.modified.clear(),s.trigger("commitModified"),s.trigger("refresh",n),i(e)):(t.forEach(f=>f.meta.committing=!1),e.exception=n.exception=!0,n.exceptionType="server",s.trigger("exception",n),i(e)),s.trigger("afterRequest",n)}).catch(c=>{t.forEach(u=>u.meta.committing=!1),e.exception=n.exception=!0,c instanceof Response?(e.response=c,n.exceptionType=c.ok?"server":"network",n.response=c,n.error=c.error):(n.exceptionType="server",n.error=c),s.trigger("exception",n),i(e),s.trigger("afterRequest",n)})}):null;return!t.length&&s.modified.count&&s.modified.clear(),r}processReturnedData(e,s,t=!1){const n=this,r=n.modelClass,i=r.fieldMap.id.dataSource;s.forEach((a,o)=>{const l=e[o];l.clearChanges(!0,!1),l.syncId(a[i]),Object.assign(e[o].data,r.processData(a,t,n,l))})}commitRemoved(e){const s=this,t=s.removed,n={action:"delete",params:s.params};return t.count&&s.deleteUrl?new Promise(r=>{e.delete=n,n.body={ids:t.map(o=>o.id)},s.trigger("beforeRequest",n);let i=n.body;if(s.sendAsFormData){const o=new FormData;o.append("id",JSON.stringify(i.ids)),i=o}const a={headers:s.headers,parseJson:!0};s.useRestfulMethods&&(a.method=s.httpMethods.delete),tr.post(s.deleteUrl+s.buildQueryString(s.deleteUrl,s.params),i,x.assign(a,s.fetchOptions)).then(o=>{const l=o.parsedJson,c=Array.isArray(l),u=c||l&&l.success!==!1;e.response=o,n.json=l,n.response=o,u?(t.forEach(d=>d.meta.committing=!1),t.clear(),s.trigger("commitRemoved"),s.trigger("refresh",n),r(e)):(t.forEach(d=>d.meta.committing=!1),e.exception=n.exception=!0,n.exceptionType="server",s.trigger("exception",n),r(e)),s.trigger("afterRequest",n)}).catch(o=>{t.forEach(l=>l.meta.committing=!1),e.exception=n.exception=!0,o instanceof Response?(e.response=o,n.exceptionType=o.ok?"server":"network",n.response=o,n.error=o.error):(n.exceptionType="server",n.error=o),s.trigger("exception",n),r(e),s.trigger("afterRequest",n)})}):null}get remoteFilter(){return!!(this.filterParamName||this.restfulFilter)}get remoteSort(){return!!this.sortParamName}};F(We,"$name","AjaxStore"),We._$name="AjaxStore";var gg=class{static get(e,s){const t=e._domData||(e._domData={});return s!=null?t[s]:t}static remove(e,s){const{_domData:t}=e,n=t==null?void 0:t[s];return t==null||delete t[s],n}static set(e,s,t){arguments.length===3?(e._domData||(e._domData={}))[s]=t:e._domData=s}static assign(e,s){Object.assign(e._domData||(e._domData={}),s)}};gg._$name="DomDataStore";var pg=class{constructor({model:e,type:s}){var t,n,r;Object.assign(this,{id:(t=e.id)!=null?t:e.$entityName,type:(n=s==null?void 0:s.$$name)!=null?n:e.constructor.name,name:(r=e.name)!=null?r:e.$entityName}),new.target===pg&&Object.freeze(this)}},Ll=pg;F(Ll,"$name","ChangeLogEntity"),Ll._$name="ChangeLogEntity";var vn=class extends H{static get fields(){return[{name:"iconCls",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0}]}};vn.exposeProperties(),vn._$name="GridRowModel";var mg=e=>class extends e{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(t,n,r){const i=[],{storeId:a}=t,o=this.crudLoadValidationMandatoryStores,l={[a]:{}};return n?n.rows||(i.push(`- "${a}" store section should have a "rows" property with an array of the store records.`),l[a].rows=["..."]):o!=null&&o.includes(a)&&(i.push(`- No "${a}" store section found. It should contain the store data.`),l[a].rows=["..."]),i.length&&Object.assign(r,l),i}getLoadResponseWarnings(t){const n=[],r={};return this.skipSuccessProperty||(r.success=!0),this.forEachCrudStore((i,a,o)=>{n.push(...this.getStoreLoadResponseWarnings(o,t==null?void 0:t[a],r))}),n.length&&(n.push(`Please adjust your response to look like this:
`+JSON.stringify(r,null,4).replace(/"\.\.\."/g,"...")),n.push(this.disableValidationNote)),n}validateLoadResponse(t){const n=this.getLoadResponseWarnings(t);n.length&&console.warn(this.crudLoadValidationWarningPrefix+`
`+n.join(`
`))}getStoreSyncResponseWarnings(t,n,r,i){const a=[],o=[],l=[],{storeId:c}=t,u={[c]:{}},d=t.phantomIdField||this.phantomIdField,{modelClass:h}=t.store,{idField:f}=h,g=(r==null?void 0:r.rows)||[],p=(r==null?void 0:r.removed)||[];let m=!1;if(n!=null&&n.added&&(o.push(...n.added.filter(y=>!g.find(D=>D[d]==y[d])&&!p.find(D=>D[d]==y[d]||D[f]==y[d])).map(y=>({[d]:y[d],[f]:"..."}))),o.length)){const y=o.map(D=>"#"+D[d]).join(", ");a.push(`- "${c}" store "rows" section should mention added record(s) ${y} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!o.length&&r&&((typeof r!="object"||Array.isArray(r))&&(a.push(`- "${c}" store section should be an Object.`),u[c]["..."]="..."),r.rows&&!Array.isArray(r.rows)&&(a.push(`- "${c}" store "rows" section should be an array`),o.push("...")),r.removed&&!Array.isArray(r.removed)&&(a.push(`- "${c}" store "removed" section should be an array:`),l.push("...")));else{if(n!=null&&n.updated){const y=n.updated.filter(D=>!g.find(E=>E[f]==D[f])).map(D=>({[f]:D[f]}));if(o.push(...y),y.length){const D=y.map(E=>"#"+E[f]).join(", ");a.push(`- "${c}" store "rows" section should mention updated record(s) ${D} sent in the request. It should contain the updated record identifiers.`),m=!0}}if(o.length&&o.push("..."),n!=null&&n.removed&&(l.push(...n.removed.filter(y=>!g.find(D=>D[f]==y[f])).map(y=>({[f]:y[f]}))),l.length)){const y=l.map(D=>"#"+D[f]).join(", ");a.push(`- "${c}" store "removed" section should mention removed record(s) ${y} sent in the request. It should contain the removed record identifiers.`),u[c].removed=l,l.push("..."),m=!0}}return o.length&&(u[c].rows=o),a.length||delete u[c],Object.assign(i,u),{messages:a,showSupportShortSyncResponseNote:m}}getSyncResponseWarnings(t,n){const r=[],i={},a=n.pack;this.skipSuccessProperty||(i.success=!0);let o=!1;return this.forEachCrudStore((l,c,u)=>{const d=this.getStoreSyncResponseWarnings(u,a==null?void 0:a[c],t[c],i);o=o||d.showSupportShortSyncResponseNote,r.push(...d.messages)}),r.length&&(r.push(`Please adjust your response to look like this:
`+JSON.stringify(i,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),o&&r.push(this.supportShortSyncResponseNote),r.push(this.disableValidationNote)),r}validateSyncResponse(t,n){const r=this.getSyncResponseWarnings(t,n);r.length&&console.warn(this.crudSyncValidationWarningPrefix+`
`+r.join(`
`))}},Wv=class extends Error{},vg=class extends Wv{constructor(e={}){var s,t;super(e.message||e.request&&U.capitalize((s=e.request)==null?void 0:s.type)+" failed"||"Crud Manager request failed"),Object.assign(this,e),this.action=(t=this.request)==null?void 0:t.type}},yg=function(e,s,t){return e.store&&(e=e.store),s.store&&(s=s.store),e=e[t]||0,s=s[t]||0,e<s?-1:e>s?1:0},zv=function(e,s){return yg(e,s,"loadPriority")},qv=function(e,s){return yg(e,s,"syncPriority")},Nl=e=>{var s;e.$$meta=e.$meta;const t=[];return e.isEvents||t.push(Vt),e.isDelayable||t.push(Ar),t.push(mg),s=class extends(e||$).mixin(...t){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(n={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(n)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var n,r;return(r=(n=this.transport)==null?void 0:n.load)==null?void 0:r.url}updateLoadUrl(n){x.setPath(this,"transport.load.url",n)}get syncUrl(){var n,r;return(r=(n=this.transport)==null?void 0:n.sync)==null?void 0:r.url}updateSyncUrl(n){x.setPath(this,"transport.sync.url",n)}getStoreDescriptor(n){return n?n instanceof K?this.crudStores.find(r=>r.store===n):typeof n=="object"?this.crudStoresIndex[n.storeId]:this.crudStoresIndex[n]||this.getStoreDescriptor(K.getStore(n)):null}fillStoreDescriptor(n){const{store:r}=n,{storeIdProperty:i=this.storeIdProperty,modelClass:a}=r;return n.storeId||(n.storeId=r[i]||r.id),n.idField||(n.idField=a.idField),n.phantomIdField||(n.phantomIdField=a.phantomIdField),n.phantomParentIdField||(n.phantomParentIdField=a.phantomParentIdField),"writeAllFields"in n||(n.writeAllFields=r.writeAllFields),n}updateCrudStoreIndex(){const n=this.crudStoresIndex={};this.crudStores.forEach(r=>r.storeId&&(n[r.storeId]=r))}getCrudStore(n){const r=this.getStoreDescriptor(n);return r==null?void 0:r.store}forEachCrudStore(n,r=this){if(!n)throw new Error("Iterator function must be provided");this.crudStores.every(i=>n.call(r,i.store,i.storeId,i)!==!1)}set crudStores(n){this._crudStores=[],this.addCrudStore(n);for(const r of this._crudStores)r.loadPriority=r.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(n){return this._orderedCrudStores=n}set syncApplySequence(n){this._syncApplySequence=[],this.addStoreToApplySequence(n)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(n){const r=this;let i;return n instanceof K?i={store:n}:typeof n=="object"?(n.store||(n={storeId:n.id,store:new K(n)}),i=n):i={store:K.getStore(n)},r.fillStoreDescriptor(i),n=i.store,n.setCrudManager?n.setCrudManager(r):n.crudManager=r,n.pageSize=null,(r.loadUrl||r.syncUrl)&&(n.autoCommit=!1,n.autoLoad=!1,(n.createUrl||n.updateUrl||n.deleteUrl||n.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),r.bindCrudStoreListeners(n),i}addCrudStore(n,r,i){if(n=W.asArray(n),!(n!=null&&n.length))return;const a=this,o=n.map(a.internalAddCrudStore,a);typeof r=="undefined"?a.crudStores.push(...o):(i&&((i instanceof K||typeof i!="object")&&(i=a.getStoreDescriptor(i)),r+=a.crudStores.indexOf(i)),a.crudStores.splice(r,0,...o)),a.orderedCrudStores.push(...o),a.updateCrudStoreIndex()}addPrioritizedStore(n){const r=this;r.hasCrudStore(n)||r.addCrudStore(n,W.findInsertionIndex(n,r.crudStores,zv)),r.hasApplySequenceStore(n)||r.addStoreToApplySequence(n,W.findInsertionIndex(n,r.syncApplySequence,qv))}hasCrudStore(n){var r;return(r=this.crudStores)==null?void 0:r.some(i=>i===n||i.store===n||i.storeId===n)}removeCrudStore(n){const r=this,i=r.crudStores,a=i.find(o=>o===n||o.store===n||o.storeId===n);if(a)r.unbindCrudStoreListeners(a.store),delete r.crudStoresIndex[a.storeId],W.remove(i,a),r.syncApplySequence&&r.removeStoreFromApplySequence(n);else throw new Error("Store not found in stores collection")}bindCrudStoreListeners(n){n.ion({name:n.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(n){this.detachListeners(n.id)}addStoreToApplySequence(n,r,i){if(!n)return;n=W.asArray(n);const a=this,o=n.reduce((c,u)=>{const d=a.getStoreDescriptor(u);return d&&c.push(d),c},[]);if(typeof r=="undefined")a.syncApplySequence.push(...o);else{let c=r;i&&((i instanceof K||typeof i!="object")&&(i=a.getStoreDescriptor(i)),c+=a.syncApplySequence.indexOf(i)),a.syncApplySequence.splice(c,0,...o)}const l=a.syncApplySequence.map(({storeId:c})=>c);a.orderedCrudStores=[...a.syncApplySequence],a.crudStores.forEach(c=>{l.includes(c.storeId)||a.orderedCrudStores.push(c)})}removeStoreFromApplySequence(n){const r=this.syncApplySequence.findIndex(i=>i===n||i.store===n||i.storeId===n);r>-1&&(this.syncApplySequence.splice(r,1),this.orderedCrudStores.splice(r,1))}hasApplySequenceStore(n){return this.syncApplySequence.some(r=>r===n||r.store===n||r.storeId===n)}onCrudStoreDestroy({source:n}){this.removeCrudStore(n)}onCrudStoreChange(n){const r=this;r.crudIgnoreUpdates||(r.crudStoreHasChanges(n==null?void 0:n.source)?(r.trigger("hasChanges"),r.autoSync&&r.scheduleAutoSync()):r.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(n=!0){const r=this;r.autoSyncSuspendCounter--,r.autoSyncSuspendCounter<=0&&(r.autoSyncSuspendCounter=0,n&&r.autoSync&&r.crudStoreHasChanges()&&r.scheduleAutoSync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const n=this;!n.hasTimeout("autoSync")&&!n.isAutoSyncSuspended&&n.setTimeout({name:"autoSync",fn:()=>{n.sync().catch(r=>{})},delay:n.autoSyncTimeout})}async triggerFailedRequestEvents(n,r,i,a){const{options:o,type:l}=n;this.trigger("requestFail",{requestType:l,response:r,responseText:i,responseOptions:a}),this.trigger(l+"Fail",{response:r,responseOptions:a,responseText:i,options:o})}async internalOnResponse(n,r,i){const a=this,o=r?a.decode(r):null,{options:l,type:c}=n;if(r&&!o&&console.error("Failed to parse response: "+r),!o||(a.skipSuccessProperty?o.success===!1:!o.success))a.triggerFailedRequestEvents(n,o,r,i);else if(a.trigger("beforeResponseApply",{requestType:c,response:o})!==!1&&a.trigger(`before${U.capitalize(c)}Apply`,{response:o,options:l})!==!1){if(a.crudRevision=o.revision,await a.applyResponse(n,o,l),a.isDestroyed)return;a.trigger("requestDone",{requestType:c,response:o,responseOptions:i}),a.trigger(c,{response:o,responseOptions:i,options:l}),(c==="load"||!a.crudStoreHasChanges())&&(a.trigger("noChanges"),c==="load"&&a.emitCrudStoreEvents(n.pack.stores,"afterRequest"))}return o}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(n){this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&!n&&this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(n){return n?this.isCrudStoreDirty(this.getCrudStore(n)):this.crudStores.some(r=>this.isCrudStoreDirty(r.store))}isCrudStoreDirty(n){return!!n.changes}doAutoLoad(){return this.load().catch(n=>{})}emitCrudStoreEvents(n,r,i){const a={action:"read"+r,...i};for(const o of this.crudStores)n.includes(o.storeId)&&o.store.trigger(r,a)}getLoadPackage(n){const r={type:"load",requestId:this.requestId},i=this.crudStores,a=Object.assign({},n);return delete a.request,r.stores=i.map(o=>{var l;const c=a==null?void 0:a[o.storeId],u=o.pageSize||((l=o.store)==null?void 0:l.pageSize);if(c||u){const d=Object.assign({storeId:o.storeId,page:1},c);return u&&(d.pageSize=u),o.currentPage=d.page,c&&delete a[o.storeId],d}return o.storeId}),Object.assign(r,a),r}loadCrudStore(n,r,i){const a=r==null?void 0:r.rows;i!=null&&i.append||r!=null&&r.append?n.add(a):n.data=a,n.trigger("load",{data:a})}loadDataToCrudStore(n,r,i){const a=n.store,o=r==null?void 0:r.rows;a.__loading=!0,o&&this.loadCrudStore(a,r,i,n),a.__loading=!1}loadCrudManagerData(n,r={}){this.suspendChangesTracking(),this.crudStores.forEach(i=>{const a=i.storeId,o=n[a];o&&this.loadDataToCrudStore(i,o,r[a])}),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return!!(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return!!(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return!!(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(n){typeof n=="string"&&(n={request:{url:n}});const r=this,i=r.getLoadPackage(n);return r._autoLoadPromise=null,new Promise((a,o)=>{if(r.trigger("beforeLoad",{pack:i})!==!1){const{load:l}=r.activeRequests;l&&(r.cancelRequest(l.desc,l.reject),r.trigger("loadCanceled",{pack:i}));const c=_.assign({id:i.requestId,data:r.encode(i),type:"load",success:r.onCrudRequestSuccess,failure:r.onCrudRequestFailure,thisObj:r},n==null?void 0:n.request);r.activeRequests.load={type:"load",options:n,pack:i,resolve:a,reject(...u){c.success=c.failure=null,o(...u)},id:i.requestId,desc:r.sendRequest(c)},r.emitCrudStoreEvents(i.stores,"loadStart"),r.trigger("loadStart",{pack:i})}else r.trigger("loadCanceled",{pack:i}),o({cancelled:!0})})}getActiveCrudManagerRequest(n){let r=this.activeRequests[n];return!r&&this.trackResponseType&&(r=Object.values(this.activeRequests)[0]),r}prepareAddedRecordData(n,r){const i=this,{store:a}=r,{isTree:o}=a,l=r.phantomIdField||i.phantomIdField,c=r.phantomParentIdField||i.phantomParentIdField,u=a.modelClass.allFields.filter(f=>f.subStore),d=n.constructor,h=Object.assign(n.persistableData,{[l]:n.id});if(o){const{parent:f}=n;f&&!f.isRoot&&f.isPhantom&&(h[c]=f.id)}return i.resetIdsBeforeSync&&x.deletePath(h,d.idField),u.forEach(f=>{const g=n.get(f.name);g.allCount&&(h[f.dataSource]={added:g.getRange().map(p=>i.prepareAddedRecordData(p,{store:g}))})}),h}prepareAdded(n,r){return n.filter(i=>i.isValid).map(i=>this.prepareAddedRecordData(i,r))}prepareUpdated(n,r){const{store:i}=r,{isTree:a}=i,o=r.writeAllFields||r.writeAllFields!==!1&&this.writeAllFields,l=r.phantomParentIdField||this.phantomParentIdField,c=i.modelClass.allFields.filter(u=>u.subStore);if(r.store.tree){const u=r.store.rootNode;n=n.filter(d=>d!==u)}return n.filter(u=>u.isValid).reduce((u,d)=>{let h;if(o?h=d.persistableData:h=d.modificationDataToWrite,a){const{parent:f}=d;f&&!f.isRoot&&f.isPhantom&&(h[l]=f.id)}return c.forEach(f=>{const g=d.get(f.name);h[f.dataSource]=this.getCrudStoreChanges({store:g})}),x.isEmpty(h)||u.push(h),u},[])}prepareRemoved(n){return n.map(r=>{const i=r.constructor;return x.setPath({},i.idField,r.id)})}getCrudStoreChanges(n){const{store:r}=n;let{added:i=[],modified:a=[],removed:o=[]}=r.changes||{},l;return i.length&&(i=this.prepareAdded(i,n)),a.length&&(a=this.prepareUpdated(a,n)),o.length&&(o=this.prepareRemoved(o)),(i.length||a.length||o.length)&&(l={},i.length&&(l.added=i),a.length&&(l.updated=a),o.length&&(l.removed=o)),l}getChangesetPackage(){const{changes:n}=this;return n||this.forceSync?{type:"sync",requestId:this.requestId,revision:this.crudRevision,...n}:null}get changes(){const n={};return this.crudStores.forEach(r=>{const i=this.getCrudStoreChanges(r);i&&(n[r.storeId]=i)}),Object.keys(n).length>0?n:null}getRowsToApplyChangesTo({store:n,storeId:r},i,a){var o,l;const c=this,{modelClass:u}=n,d=u.idField,{updated:h,removed:f}=a||{};let g,p,m;if(i){m=!0;const y={};g=((o=i.rows)==null?void 0:o.slice())||[],p=((l=i.removed)==null?void 0:l.slice())||[],[...g,...p].forEach(D=>{const E=x.getPath(D,d);y[E]=!0}),c.supportShortSyncResponse&&(h==null||h.forEach(D=>{const E=x.getPath(D,d);y[E]||g.push({[d]:E})}),f==null||f.forEach(D=>{const E=x.getPath(D,d);y[E]||p.push({[d]:E})}))}else(h||f)&&(m=!1,g=h,p=f);return g=g!=null&&g.length?g:null,p=p!=null&&p.length?p:null,{rows:g,removed:p,remote:m}}applyChangesToStore(n,r,i){var a;const o=this,l=n.phantomIdField||o.phantomIdField,{store:c}=n,u=c.modelClass.getFieldDataSource("id"),d=c.modelClass.allFields.filter(E=>E.subStore),{rows:h,removed:f,remote:g}=o.getRowsToApplyChangesTo(n,r,i),p=[],m=[];if(h)for(const E of h)c.getById((a=E[l])!=null?a:E[u])?m.push(E):p.push(E);const y=[];m.length&&d.length&&m.forEach(E=>{var C,v,S;const b=c.getById((C=E[l])!=null?C:E[u]),P=((v=i.added)==null?void 0:v.find(w=>w[l]==E[l]))||((S=i.updated)==null?void 0:S.find(w=>w[u]==E[u])),M={};d.forEach(w=>{const A=b.get(w.name);o.applyChangesToStore({store:A},E[w.dataSource],P==null?void 0:P[w.dataSource]),M[w.dataSource]="foo",delete E[w.dataSource]}),y.push([b,M])});const D=c.applyChangeset({removed:f,added:p,updated:m},null,l,g,!0);return y.forEach(([E,C])=>Object.assign(D.get(E.id),C)),D}applySyncResponse(n,r){var i;const a=this,o=a.orderedCrudStores;a.applyingChangeset=a.applyingSyncResponse=!0,a.suspendChangesTracking();for(const l of o)a.applyChangesToStore(l,n[l.storeId],(i=r==null?void 0:r.pack)==null?void 0:i[l.storeId]);a.resumeChangesTracking(!0),a.applyingChangeset=a.applyingSyncResponse=!1}applyLoadResponse(n,r){this.applyingLoadResponse=!0,this.loadCrudManagerData(n,r),this.applyingLoadResponse=!1}async applyResponse(n,r,i){const a=this;switch(a.trackResponseType&&r.type||n.type){case"load":a.validateResponse&&a.validateLoadResponse(r),a.applyLoadResponse(r,i);break;case"sync":a.validateResponse&&a.validateSyncResponse(r,n),a.applySyncResponse(r,n);break}}applyChangeset(n,r=null,i,a=!1){const o=this,l=a?new Map:void 0;o.suspendAutoSync(),o.suspendChangesTracking();for(const{store:c,phantomIdField:u}of o.orderedCrudStores)if(n[c.id]){const d=c.applyChangeset(n[c.id],r,u||o.phantomIdField,!0,a);d&&l.set(c.id,d)}return o.resumeChangesTracking(!0),o.resumeAutoSync(!1),l}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const n=this;return n.clearTimeout("autoSync"),n.activeRequests.sync?(n.trigger("syncDelayed"),n.activeSyncPromise=n.activeSyncPromise.finally(()=>n.sync())):n.activeSyncPromise=new Promise((r,i)=>{const a=n.getChangesetPackage();if(!a){r(null);return}n.trigger("beforeSync",{pack:a})!==!1?(n.trigger("syncStart",{pack:a}),n.activeRequests.sync={type:"sync",pack:a,resolve:r,reject:i,id:a.requestId,desc:n.sendRequest({id:a.requestId,data:n.encode(a),type:"sync",success:n.onCrudRequestSuccess,failure:n.onCrudRequestFailure,thisObj:n})}):(n.trigger("syncCanceled",{pack:a}),i({cancelled:!0}))}).catch(r=>{if(r&&!r.cancelled)throw r;return r})}async onCrudRequestSuccess(n,r,i){const a=this,{type:o,id:l}=i;if(a.isDestroyed)return;let c="";i=a.activeRequests[o];try{c=await n.text()}catch(d){}if(a.isDestroyed)return;if((i==null?void 0:i.id)!==l)throw new Error(`Interleaved ${o} operation detected`);a.activeRequests[o]=null;const u=await a.internalOnResponse(i,c,r);if(!a.isDestroyed){if(!u||(a.skipSuccessProperty?(u==null?void 0:u.success)===!1:!(u!=null&&u.success))){const d={rawResponse:n,response:u,request:i};u!=null&&u.message&&(d.message=u.message),i.reject(new vg(d))}a["crud"+U.capitalize(i.type)+"ed"]=!0,i.resolve({response:u,rawResponse:n,responseText:c,request:i})}}async onCrudRequestFailure(n,r,i){var a;const o=this;if(o.isDestroyed)return;i=o.activeRequests[i.type];const l=(a=r==null?void 0:r.abortController)==null?void 0:a.signal;if(!!!(l!=null&&l.aborted)){let u,d="";try{d=await n.text(),u=o.decode(d)}catch(h){}if(o.isDestroyed||(o.triggerFailedRequestEvents(i,u,d,r),o.isDestroyed))return;i.reject(new vg({rawResponse:n,request:i}))}o.activeRequests[i.type]=null}acceptChanges(){this.crudStores.forEach(n=>n.store.acceptChanges())}revertChanges(){this.revertCrudStoreChanges()}revertCrudStoreChanges(){const{usesSingleAssignment:n}=this.eventStore;this.orderedCrudStores.forEach(({store:r})=>(!r.isAssignmentStore||!n)&&r.revertChanges())}doDestroy(){const n=this,{load:r,sync:i}=n.activeRequests;for(r&&n.cancelRequest(r.desc,r.reject),i&&n.cancelRequest(i.desc,i.reject);n.crudStores.length>0;)n.removeCrudStore(n.crudStores[0]);super.doDestroy&&super.doDestroy()}},F(s,"configurable",{loadUrl:null,syncUrl:null,forceSync:null}),F(s,"delayable",{doAutoLoad:"raf"}),s},Sg=class extends $.mixin(Nl){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}get json(){return U.safeJsonStringify(this)}set json(e){typeof e=="string"&&(e=U.safeJsonParse(e)),this.forEachCrudStore(s=>{const t=`${s.storeId}Data`;e[t]&&(s.data=e[t])})}static get defaultConfig(){return{stores:null}}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}toJSON(){const e={};return this.forEachCrudStore((s,t)=>e[`${t}Data`]=s.toJSON()),e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}};Sg._$name="AbstractCrudManager";var Dg=e=>class Ng extends(e||$){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(t,n){var r;(r=t.abort)==null||r.call(t),this.isDestroying||n({cancelled:!0})}shouldUseBodyForRequestData(t,n,r){return!(n==="HEAD"||n==="GET")&&!r}sendRequest(t){const n=this,{data:r}=t,i=n.transport[t.type]||{},a=_.assign({},i,i.requestConfig);t.url&&(a.url=t.url),a.method=a.method||Ng.defaultMethod[t.type],a.params=_.assign(a.params||{},t.params);let{paramName:o}=a;if(n.shouldUseBodyForRequestData(i,a.method,o)?(a.body=r,a.headers=a.headers||{},a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"):(o=o||"data",a.params[o]=r),!a.url)throw new Error("Trying to request without URL specified");delete a.requestConfig,delete a.paramName;let l,c;function u(){a.queryParams=a.params,delete a.params;let h=!1;const f=_.assign({},a,a.fetchOptions);return l=tr.fetch(a.url,f),l.catch(g=>{var p,m;l.done=!0,(p=n.trigger)==null||p.call(n,"responseReceived",{success:!1});const y=(m=f.abortController)==null?void 0:m.signal;return y&&(h=y.aborted,h||console.warn(g)),{error:g,cancelled:h}}).then(g=>{var p;l.done=!0,(p=n.trigger)==null||p.call(n,"responseReceived",{success:!!(g!=null&&g.ok)});const m=g!=null&&g.ok?t.success:t.failure;return m==null?void 0:m.call(t.thisObj||n,g,f,t)})}const d=n.trigger("beforeSend",{params:a.params,requestType:t.type,requestConfig:a,config:t});return _.isPromise(d)?c=d.then(u):c=u(),c.abort=()=>{var h;l.done||(h=l.abort)==null||h.call(l)},c}},Cg=e=>class extends(e||$){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(t){var n;return t=Object.assign({},(n=this.encoder)==null?void 0:n.requestData,t),U.safeJsonStringify(t)}decode(t){return U.safeJsonParse(t)}},Bl={startDate:1,endDate:1,constraintDate:1,deadlineDate:1},Eg=e=>{var s;return s=class extends(e||lt){get timeZone(){return this.getData("timeZone")}set timeZone(t){this.setData("timeZone",t)}setLocalDate(t,n){this.set(t,this.timeZone!=null?vt.toTimeZone(n,this.timeZone):n,!0),this.data[t]=this[t]}getLocalDate(t){return this.timeZone!=null&&this[t]?vt.fromTimeZone(this[t],this.timeZone):this[t]}applyChangeset(t){if(this.timeZone!=null)for(const n in Bl)t[n]&&(this.setLocalDate(n,new Date(t[n])),delete t[n]);return super.applyChangeset(...arguments)}getFieldPersistentValue(t){var n,r;if(this.timeZone!=null){const i=(r=(n=t==null?void 0:t.field)!=null?n:t==null?void 0:t.name)!=null?r:t;if(Bl[i])return this.getLocalDate(i)}return super.getFieldPersistentValue(t)}convertToTimeZone(t){const n=this,r={...n.meta.modified},i={...Bl};n.isTask&&!n.manuallyScheduled&&(delete i.startDate,delete i.endDate);for(const a in i)n[a]!=null?(i[a]=n[a],n.timeZone!=null&&(i[a]=n.getLocalDate(a),r[a]&&(r[a]=vt.fromTimeZone(r[a],n.timeZone)))):delete i[a];n.timeZone=t;for(const a in i)n.setLocalDate(a,i[a],!1),i[a]=1,n.timeZone!=null&&r[a]&&(r[a]=vt.toTimeZone(r[a],n.timeZone));n.clearChanges(!0,!0,i),x.isEmpty(r)||(n.meta.modified=r,n.stores.forEach(a=>a.modified.add(n)))}},F(s,"$name","TimeZonedDatesMixin"),F(s,"fields",[{name:"timeZone",persist:!1}]),s},lt=class extends H.mixin(Eg){static get $name(){return"TimeSpan"}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"},useProp:!0},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]}construct(e,...s){if(e!=null&&e.fullDuration){const{magnitude:t,unit:n}=e.fullDuration;e.duration=t,e.unit=n,delete e.fullDuration}super.construct(e,...s),this.normalize()}get eventStore(){var e;const s=this;return s.isOccurrence?s.recurringTimeSpan.eventStore:(s._eventStore||(s._eventStore=(e=s.stores)==null?void 0:e.find(t=>t.isEventStore)),s._eventStore)}normalize(){const e=this,{startDate:s,endDate:t,duration:n,durationUnit:r}=e,i=n!=null;s&&t&&!i?e.setData("duration",R.diff(s,t,r,!0)):s&&!t&&i?e.setData("endDate",R.add(s,n,r)):!s&&t&&i&&e.setData("startDate",R.add(t,-n,r))}updateInternalCls(e){this._cls?this._cls.value=e:this._cls=new Ue(e)}set internalCls(e){this.updateInternalCls(e),this.set("cls",this._cls.value)}get internalCls(){const{cls:e}=this;return e!=null&&e.isDomClassList?e:(this.internalCls=e,this._cls)}get cls(){return this._cls||(this._cls=new Ue(super.get("cls"))),this._cls}set cls(e){this.internalCls=e}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get endingDate(){const e=this,{endDate:s,startDate:t}=e;return s||R.add(t,e.duration,e.durationUnit)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,s=this.durationUnit){e=parseFloat(e),this.set({duration:e,durationUnit:s,...this.updateDatesFromDuration(e,s)})}updateDatesFromDuration(e,s,t=this.startDate,n=this.endDate){const r={};return t?r.endDate=R.add(t,e,s):n&&(r.startDate=R.add(n,-e,s)),r}getDurationInUnit(e,s){const t=this;return t.startDate&&t.endDate?R.getDurationInUnit(t.startDate,t.endDate,e,s):R.as(e,t.duration,t.durationUnit)}get fullDuration(){return new xe({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){typeof e=="string"&&(e=R.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,s=!0){const t=this,n={startDate:e};if(e){let r;if(s)r=t.duration!=null;else if(t.endDate){if(n.duration=R.diff(e,t.endDate,t.durationUnit,!0),n.duration<0)throw new Error("Negative duration")}else r=this.duration!=null;r&&(n.endDate=R.add(e,t.getDurationInUnit("h"),"h"))}else n.duration=null;t.set(n)}setEndDate(e,s=!1){const t=this,n={endDate:e};if(e){let r;if(s===!0)r=t.duration!=null;else if(t.startDate){if(n.duration=R.diff(t.startDate,e,t.durationUnit,!0),n.duration<0)throw new Error("Negative duration")}else r=this.duration!=null;r&&(n.startDate=R.add(e,-t.duration,t.durationUnit))}t.set(n)}setStartEndDate(e,s,t){this.set({startDate:e,endDate:s},null,t)}get dates(){const e=[],s=R.startOf(this.startDate,"day"),t=this.endDate;for(let n=s;n<t;n=R.add(n,1,"day"))e.push(n);return e}get startDateMS(){var e;return(e=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)==null?void 0:e.getTime()}get endDateMS(){var e;return(e=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)==null?void 0:e.getTime()}get durationMS(){const{endDateMS:e,startDateMS:s}=this;return e&&s?e-s:R.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return this.duration===0}inSetNormalize(e){if(typeof e!="string"){let{startDate:s,endDate:t,duration:n,durationUnit:r=this.durationUnit}=e;typeof s=="string"&&(s=this.getFieldDefinition("startDate").convert(s)),typeof t=="string"&&(t=this.getFieldDefinition("endDate").convert(t)),"duration"in e?(s&&!t&&(t=R.add(s,n,r,!0,!0)),!s&&t&&(s=R.add(t,-n,r,!0,!0))):s&&t&&(n=R.as(r,R.diff(s,t,"h",!0),"h"));const i=Object.isFrozen(e)?x.clone(e):e;return s&&(i.startDate=s),t&&(i.endDate=t),n!=null&&(i.duration=n),i}}fieldToKeys(e,s){var t,n;const r=super.fieldToKeys(e,s);if(r.fullDuration){const{magnitude:i,unit:a}=r.fullDuration;r.duration=i,r.durationUnit=a}return!this.isEventModel&&!this.isTaskModel&&("duration"in r||r.durationUnit)&&!(r.startDate&&r.endDate)&&Object.assign(r,this.updateDatesFromDuration((t=r.duration)!=null?t:this.duration,(n=r.durationUnit)!=null?n:this.durationUnit,r.startDate,r.endDate)),r}inSet(e,s,t,n,r,i){return r||(e=this.inSetNormalize(e)||e),super.inSet(e,s,t,n,r,i)}applyValue(e,s,t,n,r){s==="cls"&&this.updateInternalCls(t),super.applyValue(e,s,t,n,r)}forEachDate(e,s){return this.dates.forEach(e.bind(s))}get isScheduled(){const{startDateMS:e,endDateMS:s}=this;return s-e>=0}get isValid(){const{startDate:e,endDate:s}=this;return!e||!s||s-e>=0}shift(e,s=this.durationUnit){if(typeof e=="string"){const t=e;e=s,s=t}return this.setStartDate(R.add(this.startDate,e,s,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,s){const t=this.startDate,n=this.endDate;return t&&n&&R.intersectSpans(t,n,e,s)}split(e=.5){const s=this,t=s.copy(),{fullDuration:n,eventStore:r,assignmentStore:i}=s,a=new xe(n),o=new xe(n);let l,c;return typeof e=="string"?(l=new xe(e),l.unit===a.unit?o.magnitude-=l.magnitude:(o.magnitude=R.as(l.unit,a)-l.magnitude,o.unit=l.unit,c=!0)):(l=new xe(e>1?e:s.duration*e,s.durationUnit),o.magnitude-=l.magnitude),t.startDate=R.add(s.startDate,l.magnitude,l.unit),c?(t.fullDuration=o,s.fullDuration=l):(t.duration=o.magnitude,s.duration=l.magnitude),r&&(r.add(t),i&&!r.usesSingleAssignment&&i.add(s.assignments.map(u=>{const d=Object.assign({},u.data,{eventId:t.id,event:null,resource:null});return delete d.id,d}))),t}toICSString(e={}){if(!this.isScheduled)return"";const{startDate:s,endDate:t}=this,n=e.DTSTAMP||R.format(new Date,"uu");delete e.DTSTAMP;let r={};this.allDay?r={"DTSTART;VALUE=DATE":R.format(s,"u"),"DTEND;VALUE=DATE":R.format(t,"u")}:r={DTSTART:R.format(s,"uu"),DTEND:R.format(t,"uu")};const i=Se.scheduler&&Se.getVersion("scheduler")||Se.calendar&&Se.getVersion("calendar")||"",a={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${i} //EN`,END:"VCALENDAR"},o={BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:n,...r,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...e,END:"VEVENT"},l=Object.keys(a).map(u=>`${u}:${a[u]}`),c=Object.keys(o).map(u=>`${u}:${o[u]}`);return l.splice(l.length-1,0,...c),l.join(`
`)}exportToICS(e){if(this.isScheduled){const s=new Blob([this.toICSString(e)],{type:"text/calendar"});Oe.downloadBlob(s,(this.name||"Event")+".ics")}}isEditable(e){return this.getFieldDefinition(e)?!0:void 0}isFieldModified(e){return e==="fullDuration"?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(e)}};lt._$name="TimeSpan";var Gv=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,bg=["SU","MO","TU","WE","TH","FR","SA"],yn=class extends ${static decodeDay(e){let s,t;return(s=Gv.exec(e))&&(t=[bg.indexOf(s[2])],s[1]&&(s[1]=parseInt(s[1],10),t.push(s[1]))),t}static encodeDay(e){let s;return Array.isArray(e)&&([e,s]=e),(s?s.toString():"")+bg[e]}static decode(e){const s=[];let t;if(e)for(let n=0;n<e.length;n++)(t=this.decodeDay(e[n]))&&s.push(t);return s}static encode(e){const s=[];let t;if(e)for(let n=0;n<e.length;n++)(t=this.encodeDay(e[n]))&&s.push(t);return s}};yn._$name="RecurrenceDayRuleEncoder";var Hv=/ly$/i,Vl=e=>{const s=e.replace(Hv,"");return s==="DAI"?"DAY":s},Yv=(e,s,t,n)=>n.buildOccurrence(e,t),Kv=e=>Ul=e,Ul,yr=class extends ${static processIterationConfig(e){const{recurrence:s}=e,{frequency:t,interval:n,timeSpan:r,endDate:i,count:a}=s;if(!e.syncingStartDate&&!r.meta.isSyncedWithRule){const d=R.add(r.startDate,n,Vl(t)),h=R.min(d,e.endDate||d);this.forEachDate({syncingStartDate:!0,startDate:r.startDate,endDate:h,recurrence:s,fn:Yv})}const o=r.startDate;let{startDate:l=o,endDate:c=i}=e;l<o&&(l=o),i?(!c||c>i)&&(c=i):a&&l>o&&(this.forEachDate({recurrence:s,fn:Kv}),(!c||c>Ul)&&(c=new Date(Ul.getTime()+1)));const u=l;return e.startOnly||(l=new Date(R.max(R.add(l,-n,Vl(t)),o))),Object.assign({extraArgs:[],startOnly:!r.durationMS},e,{startDate:l,endDate:c,timeSpan:r,timeSpanStart:o,earliestVisibleDate:u,endDateMS:c==null?void 0:c.getTime(),timeSpanStartMS:o.getTime(),earliestVisibleDateMS:u.getTime(),durationMS:r.durationMS,spansStart:l<=o&&c>o})}static getOccurrenceIndex(e){if(e.isOccurrence)return R.diff(e.recurringTimeSpan.startDate,e.startDate,Vl(e.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(e,s,t,n){let r,i,a;if(n){n>0?(i=1,a=e):(i=-1,a=s);const o=t-a.getDay();i*o<0&&(n+=i),r=new Date(a),r.setDate(a.getDate()+(n-i)*7+o),(r<e||r>s)&&(r=null)}return r}static buildDate(e,s,t){const n=new Date(e,s,t);if(n.getFullYear()===e&&n.getMonth()===s&&n.getDate()===t)return n}static isValidPosition(e){return!!e}static forEachDateAtPositions(e,s,t,n){const r=e.length,i={};for(let a=0;a<s.length;a++){const o=s[a];if(this.isValidPosition(o)){const l=o>0?e[o-1]:e[r+o];if(l&&!i[l.getTime()]&&(i[l.getTime()]=!0,t.call(n,l)===!1))return!1}}}static isInView(e,s,t,n,r){return(e?s>=t:s.valueOf()+n>t)&&!r.hasException(s)}static isInViewMS(e,s,t,n,r,i){return(e?t>=n:t+r>n)&&!i.hasException(s)}};F(yr,"frequency","NONE"),F(yr,"MAX_OCCURRENCES_COUNT",1e6),yr._$name="AbstractRecurrenceIterator";var Wl=class extends yr{static forEachDate(e){const{startOnly:s,startDate:t,endDate:n,endDateMS:r,timeSpan:i,timeSpanStart:a,earliestVisibleDateMS:o,durationMS:l,spansStart:c,recurrence:u,fn:d,extraArgs:h,scope:f=this}=this.processIterationConfig(e),{interval:g}=u,p=t-a,m=g*864e5,y=Math.floor(p/m);let{count:D}=u,E=0,C=R.add(a,y*g,"day"),v=C.getTime();for(!n&&!D&&(D=this.MAX_OCCURRENCES_COUNT);!r||v<r;){const S=this.isInViewMS(s,C,v,o,l,i);if(E++,S&&(r&&v>r||d.apply(f,[C,E,E===1&&c,i,...h])===!1||D&&E>=D))break;C=R.add(C,g,"day"),v=C.getTime()}}};F(Wl,"frequency","DAILY"),Wl._$name="DailyRecurrenceIterator";var zl=class extends yr{static forEachDate(e){const{startOnly:s,startDate:t,endDateMS:n,timeSpan:r,timeSpanStart:i,timeSpanStartMS:a,earliestVisibleDateMS:o,durationMS:l,spansStart:c,recurrence:u,fn:d,extraArgs:h,scope:f=this}=this.processIterationConfig(e),{interval:g,days:p}=u,{weekStartDay:m}=R,y=i.getHours(),D=i.getMinutes(),E=i.getSeconds(),C=i.getMilliseconds();let v=0,{count:S}=u,b=yn.decode(p),P,M;if(b!=null&&b.length||(b=[[i.getDay()]]),m>0)for(let w=0;w<b.length;w++)m>b[w][0]?b[w][0]=7-m-b[w][0]:b[w][0]-=m;for(b.sort((w,A)=>w[0]-A[0]),P=R.getNext(S||g>1?i:t,"week",0),!n&&!S&&(S=this.MAX_OCCURRENCES_COUNT);!n||P.getTime()<n;){for(let w=0;w<b.length;w++){M=new Date(P.getFullYear(),P.getMonth(),P.getDate()+b[w][0],y,D,E,C);const A=M.getTime();if(A>=a){const T=this.isInViewMS(s,M,A,o,l,r);if(v++,T&&(n&&A>=n||d.apply(f,[M,v,v===1&&c,r,...h])===!1||S&&v>=S))return}}P=R.getNext(P,"week",g)}}};F(zl,"frequency","WEEKLY"),zl._$name="WeeklyRecurrenceIterator";var ql=class extends yr{static getNthDayOfMonth(e,s){const t=R.daysInMonth(e);let n=null;return s&&Math.abs(s)<=t&&(n=new Date(e.getFullYear(),e.getMonth(),s<0?t+s+1:s)),n}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const{startOnly:s,startDate:t,endDate:n,timeSpan:r,timeSpanStart:i,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:c,fn:u,extraArgs:d,scope:h=this}=this.processIterationConfig(e),{interval:f,days:g,count:p,positions:m}=c,y=yn.decode(g),D=m&&m.length,E={};let{monthDays:C}=c,v=0,S,b,P,M,w,A;for(b=R.startOf(p||f>1?i:t,"month"),P=new Date(R.getNext(b,"month",1)-1),!(C&&C.length)&&!(y&&y.length)&&(C=[i.getDate()]),y&&y.length&&y.forEach(T=>{T[1]&&(S=S||{},S[T[0]]=T[1])});(!n||n>b)&&(!p||v<p);){if(M=[],y&&y.length){if(y.forEach(T=>{const k=T[0];let Z=1,z=53;for(T[1]&&(Z=z=T[1]),A=Z;A<=z;A++)(w=this.getNthDayInPeriod(b,P,k,A))&&(w=R.copyTimeValues(w,i),E[w.getTime()]||(E[w.getTime()]=!0,M.push(w)))}),M.sort((T,k)=>T-k),!D){for(A=0;A<M.length;A++)if(w=M[A],w>=i){const T=this.isInView(s,w,a,o,r);if(v++,T&&(n&&w>=n||u.apply(h,[w,v,v===1&&l,r,...d])===!1||p&&v>=p))return!1}}}else{const T=[];for(A=0;A<C.length;A++)(w=this.getNthDayOfMonth(b,C[A]))&&!E[w.getTime()]&&(E[w.getTime()]=!0,T.push(w));for(T.sort((k,Z)=>k-Z),A=0;A<T.length;A++)if(w=R.copyTimeValues(T[A],i),D)M.push(w);else if(w>=i){const k=this.isInView(s,w,a,o,r);if(v++,k&&(n&&w>n||u.apply(h,[w,v,v===1&&l,r,...d])===!1||p&&v>=p))return}}D&&M.length&&this.forEachDateAtPositions(M,m,T=>{if(T>=i){const k=s?T>=a:T.valueOf()+o>a&&!r.hasException(T);if(v++,k&&(!n||T<=n)&&(u.apply(h,[T,v,v===1&&l,r,...d])===!1||p&&v>=p))return!1}}),b=R.getNext(b,"month",f),P=new Date(R.getNext(b,"month",1)-1)}}};F(ql,"frequency","MONTHLY"),ql._$name="MonthlyRecurrenceIterator";var Gl=class extends yr{static forEachDate(e){const{startOnly:s,startDate:t,endDate:n,timeSpan:r,timeSpanStart:i,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:c,fn:u,extraArgs:d,scope:h=this}=this.processIterationConfig(e),{interval:f,days:g,count:p,positions:m}=c,y=yn.decode(g),D=m&&m.length,E={};let{months:C}=c,v=0,S,b,P,M,w,A;for(M=R.startOf(p||f>1?i:t,"year"),w=new Date(R.getNext(M,"year",1)-1),C&&C.sort((T,k)=>T-k),!(C&&C.length)&&!(y&&y.length)&&(C=[i.getMonth()+1]),y&&y.length&&y.forEach(T=>{T[1]&&(A=A||{},A[T[0]]=T[1])});(!n||n>M)&&(!p||v<p);){if(P=[],y&&y.length){if(y.forEach(T=>{const k=T[0];let Z=1,z=53;for(T[1]&&(Z=z=T[1]),S=Z;S<=z;S++)(b=this.getNthDayInPeriod(M,w,k,S))&&(b=R.copyTimeValues(b,i),E[b.getTime()]||(E[b.getTime()]=!0,P.push(b)))}),P.sort((T,k)=>T-k),!D){for(S=0;S<P.length;S++)if(b=P[S],b>=i){const T=this.isInView(s,b,a,o,r);if(v++,T&&(n&&b>=n||u.apply(h,[b,v,v===1&&l,r,...d])===!1||p&&v>=p))return}}}else for(S=0;S<C.length;S++)if((b=this.buildDate(M.getFullYear(),C[S]-1,i.getDate()))&&(b=R.copyTimeValues(b,i),!E[b.getTime()])){if(E[b.getTime()]=!0,D)P.push(b);else if(b>=i){const T=s?b>=a:b.valueOf()+o>a&&!r.hasException(b);if(v++,T&&(n&&b>=n||u.apply(h,[b,v,v===1&&l,r,...d])===!1||p&&v>=p))return}}D&&P.length&&this.forEachDateAtPositions(P,m,T=>{if(T>=i){const k=s?T>=a:T.valueOf()+o>a&&!r.hasException(T);if(v++,k&&(!n||T<n)&&(u.apply(h,[T,v,v===1&&l,r,...d])===!1||p&&v>=p))return!1}}),M=R.getNext(M,"year",f),w=new Date(R.getNext(M,"year",1)-1)}}};F(Gl,"frequency","YEARLY"),Gl._$name="YearlyRecurrenceIterator";var Rg={};[Wl,zl,ql,Gl].forEach(e=>{Rg[e.frequency]=e});function Hl(e){return e?typeof e=="string"&&(e=e.split(",").map(s=>parseInt(s,10))):e=null,e}function Jv(e){return e?typeof e=="string"&&(e=e.split(",")):e=null,e}function Wi(e,s){return String(e)===String(s)}function wg(e){return this.defaultValue&&e===void 0?this.defaultValue:this.allowNull&&e==null?null:(e=parseInt(e),isNaN(e)?void 0:e)}var Yl=class extends H{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:wg},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:wg},{name:"days",convert:Jv,isEqual:Wi},{name:"monthDays",convert:Hl,isEqual:Wi},{name:"months",convert:Hl,isEqual:Wi},{name:"positions",convert:Hl,isEqual:Wi}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return Rg[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const e=this,s=[];return e.frequency&&(s.push(`FREQ=${e.frequency}`),e.interval>1&&s.push(`INTERVAL=${e.interval}`),e.days&&e.days.length&&s.push("BYDAY="+e.days.join(",")),e.monthDays&&e.monthDays.length&&s.push("BYMONTHDAY="+e.monthDays.join(",")),e.months&&e.months.length&&s.push("BYMONTH="+e.months.join(",")),e.count&&s.push(`COUNT=${e.count}`),e.endDate&&s.push("UNTIL="+R.format(e.endDate,e.dateFormat)),e.positions&&e.positions.length&&s.push("BYSETPOS="+e.positions.join(","))),s.join(";")}set rule(e){const s=this,t={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(s.beginBatch(),e){const n=e.split(";");for(let r=0,i=n.length;r<i;r++){const a=n[r].split("="),o=a[1];switch(a[0]){case"FREQ":t.frequency=o;break;case"INTERVAL":t.interval=o;break;case"COUNT":t.count=o,t.until=null;break;case"UNTIL":o?t.endDate=R.parse(o,s.dateFormat):t.endDate=null,t.count=null;break;case"BYDAY":t.days=o;break;case"BYMONTHDAY":t.monthDays=o;break;case"BYMONTH":t.months=o;break;case"BYSETPOS":t.positions=o;break}}}s.set(t),e&&s.sanitize(),s.endBatch()}construct(e={}){const s=this,{rule:t,timeSpan:n}=e;s._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),t&&(s.suspendTimeSpanNotifying(),s.rule=t,s.resumeTimeSpanNotifying()),s.timeSpan=n}forEachOccurrence(e,s,t){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:s,fn(n,r,i,a){return t(a.buildOccurrence(n,i),i,r,n)}})}sanitize(){var e,s;const t=this,n=(e=t.timeSpan)==null?void 0:e.startDate,r={};switch(t.isSanitizing=!0,t.frequency){case"DAILY":r.positions=null,r.days=null,r.monthDays=null,r.months=null;break;case"WEEKLY":{r.positions=null,r.monthDays=null,r.months=null;const{days:i}=t;n&&(i==null?void 0:i.length)===1&&i[0]===yn.encodeDay(n.getDay())&&(r.days=null);break}case"MONTHLY":{(s=t.monthDays)!=null&&s.length&&(r.positions=null,r.days=null),r.months=null;const{monthDays:i}=t;n&&(i==null?void 0:i.length)===1&&i[0]===n.getDate()&&(r.monthDays=null);break}case"YEARLY":{r.monthDays=null;const{months:i}=t;n&&(i==null?void 0:i.length)===1&&i[0]===n.getMonth()+1&&(r.months=null);break}}t.set(r),t.isSanitizing=!1}copy(...e){const s=super.copy(...e);return s.dateFormat=this.dateFormat,s.timeSpan=this.timeSpan,s}afterChange(e,s,t){const n=super.afterChange(e,s,t),{timeSpan:r}=this;return this.isSanitizing||this.sanitize(),r&&(r.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||r.onRecurrenceChanged()),n}set(e,s,...t){const n=typeof e=="object"?e:{[e]:s};n.count?n.endDate=null:n.endDate&&(n.count=null),super.set(n,void 0,...t)}get isTimeSpanNotifyingSuspended(){return!!this._suspendedTimeSpanNotifying}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}};Yl._$name="RecurrenceModel";function Qv(e){const s={},{dateFormat:t}=this;return e&&(e=typeof e=="string"?e.split(","):W.asArray(e),e.forEach(n=>{typeof n=="string"&&(n=R.parse(n,t)),isNaN(n)||(s[R.makeKey(n)]=1)})),s}function Zv(e){const s=[],{dateFormat:t}=this;for(const n in e)e[n]&&s.push(R.format(R.parseKey(n),t));return s}var Xv=[],zi=e=>class extends(e||lt){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:Qv,serialize:Zv,internal:!0}]}remove(){if(this.isOccurrence){const t=this,{recurringTimeSpan:n}=t;t.cancelBatch(),n.beginBatch(),t.detachFromRecurringEvent(),n.endBatch()}else return super.remove(...arguments)}get eventStore(){var t;let n=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!n&&((t=this.firstStore)!=null&&t.isRecurringTimeSpansMixin)&&(n=this.firstStore),n}get recurrenceModel(){return this._recurrenceModel||Yl}set recurrenceModel(t){this._recurrenceModel=t}setRecurrence(t,n,r){const i=this;let a;t&&(t.isRecurrenceModel||(typeof t=="string"&&(t={frequency:t},n&&(t.interval=n),r&&(r instanceof Date?t.endDate=r:t.count=r)),t=new i.recurrenceModel(t)),t.timeSpan=i,a=t.rule),i.recurrence=t,i.recurrenceRule=a}get recurrence(){const t=this,n=t.recurrenceRule;return!t._recurrence&&n&&(t._recurrence=new t.recurrenceModel({rule:n,timeSpan:t,id:`${t.id}-recurrence`})),t._recurrence}set recurrence(t){const n=this;n._recurrence=t,t?(t.timeSpan=n,n.recurrenceRule=t.rule):n.isOccurrence?n.setData("recurrenceRule",null):n.recurrenceRule=null}get isRecurring(){return!!(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return!!this.recurringTimeSpan}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(t){this._recurringTimeSpan=t}getOccurrencesForDateRange(t,n=t){return this.eventStore.getOccurrencesForTimeSpan(this,t,n)}get occurrences(){if(this.isRecurring){const t=[];return this.occurrenceMap.forEach(n=>{n!==this&&t.push(n)}),t}return Xv}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(t){var n;const r=t.isTimeSpan?t.occurrenceDate:t;(n=this.eventStore)==null||n.globalOccurrences.delete(this.createRecurrenceKey(r)),this.occurrenceMap.delete(R.makeKey(r))}removeOccurrencesFrom(t){this.occurrenceMap.forEach((n,r)=>{R.parseKey(r)>=t&&this.removeOccurrence(n)})}removeOccurrences(){[this,...this.occurrences].forEach(t=>this.removeOccurrence(t))}onRecurrenceChanged(){var t;this.recurrenceRule=((t=this.recurrence)==null?void 0:t.rule)||null}sanitizeRecurrenceData(t=this.recurrence){if(t.endDate){const n=R.clearTime(t.endDate),{exceptionDates:r}=this;if(this.removeOccurrencesFrom(n),r)for(const i in r)R.parseKey(i)>=n&&delete r[i]}}get occurrenceDate(){var t;return((t=this.meta.modified)==null?void 0:t.startDate)||this.startDate}get occurrenceIndex(){return yr.getOccurrenceIndex(this)}buildOccurrence(t,n){var r;const i=this,{occurrenceMap:a,recurrence:o,meta:l}=i,c=(r=i.eventStore)==null?void 0:r.globalOccurrences,u=R.makeKey(t),d=i.createRecurrenceKey(t,u),h=!(t-i.startDate),{fieldMap:f}=i.constructor;let g=c==null?void 0:c.get(d),{duration:p}=i;i.endDate&&(i.allDay||!p)&&(p=R.as(i.durationUnit,i.endDate.getTime()-i.startDate.getTime()));const m=p!==void 0?R.add(t,p,i.durationUnit):void 0;return g||(n||h?(g=i,h||(i.setStartEndDate(t,m,!0),o.suspendTimeSpanNotifying(),o.sanitize(),o.resumeTimeSpanNotifying()),l.isSyncedWithRule=!0):(g=i.copy({[f.id.dataSource]:d,[f.startDate.dataSource]:t,[f.endDate.dataSource]:m,[f.duration.dataSource]:p,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),g.recurringTimeSpan=i),c==null||c.set(d,g),a.set(u,g)),g}createRecurrenceKey(t=this.startDate,n=null){return`_generated:${this.id}:${n||R.makeKey(t)}`}convertToRealEvent(t,n){var r;if(!this.isOccurrence)return;const i=this,{recurringTimeSpan:a,resource:o,occurrenceIndex:l,recurrence:c}=i,u=c&&a.recurrence.count,d=((r=t==null?void 0:t.resourceRecords)==null?void 0:r.value)||i.data.newResource;a.beginBatch(),i.detachFromRecurringEvent(),i.clearChanges(),i.setData("id",i.generateId(a.eventStore)),d&&delete i.data.resourceId,a.eventStore.add(i,n),u&&(i.recurrence.count=u-l),(d||o)&&i.assign(d||o),d&&delete i.data.resourceRecords,t&&delete t.resourceRecords,a.endBatch()}afterChange(t,n,r,...i){const a=this,{eventStore:o}=a;return"recurrenceRule"in n&&(a._recurrence=null,o==null||o.recurringEvents[n.recurrenceRule.value?"add":"delete"](a)),a.isOccurrence?a.convertToRealEvent(n,r):"newExceptionDate"in n&&(a.meta.modified.exceptionDates=!0,delete a.meta.modified.newExceptionDate,a.removeOccurrence(n.newExceptionDate.value)),super.afterChange(t,n,r,...i)}detachFromRecurringEvent(){const t=this,{recurringTimeSpan:n,occurrenceDate:r,startDate:i}=t;t.recurringTimeSpan=null,n.addExceptionDate(r),t.recurrenceRule&&(n.recurrence.endDate=R.add(i,-1,"minute"))}set newExceptionDate(t){if(t){const n=this.exceptionDates||(this.exceptionDates={});n[R.makeKey(t)]=1}}addExceptionDate(t){return this.set({newExceptionDate:t})}hasException(t){var n;return(n=this.exceptionDates)==null?void 0:n[R.makeKey(t)]}},Sr=class extends lt.mixin(zi){get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}};F(Sr,"$name","ResourceTimeRangeModel"),F(Sr,"fields",["resourceId","timeRangeColor"]),F(Sr,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}}),F(Sr,"domIdPrefix","resourcetimerange"),Sr._$name="ResourceTimeRangeModel";var Ig=Object.freeze([]),Kl=e=>class extends(e||$){static get $name(){return"RecurringTimeSpansMixin"}construct(...t){const n=this;n.globalOccurrences=new Map,n.recurringEvents=new Set,super.construct(...t)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:t,added:n,removed:r,replaced:i}){this.refreshRecurringEventsCache(t,n,r,i),super.onDataChange(...arguments)}refreshRecurringEventsCache(t,n=Ig,r=Ig,i){const a=this,{recurringEvents:o}=a,l=i==null?void 0:i.length;switch(t){case"clear":o.clear();break;case"splice":{if(l){n=n.slice(),r=r.slice();for(let d=0;d<l;d++)r.push(i[d][0]),n.push(i[d][1])}const c=n.length,u=r.length;if(u&&o.size)for(let d=0;d<u;d++)o.delete(r[d]);if(c)for(let d=0;d<c;d++){const h=n[d];h.isRecurring&&o.add(h)}break}}}getById(t){let n=super.getById(t);return n||(n=this.globalOccurrences.get(this.modelClass.asId(t))),n}onModelChange(t,n,r,i,a){const o=!i&&this.isRecurrenceRelatedFieldChange(t,r);if(o&&t.removeOccurrences(),super.onModelChange(...arguments),o){const l={action:"batch",records:this.storage.values};this.trigger("refresh",l),this.trigger("change",l)}}isRecurrenceRelatedFieldChange(t,n){return t.isRecurring||"recurrenceRule"in n}getOccurrencesForTimeSpan(t,n,r){const i=[];return t.isRecurring&&t.recurrence.forEachOccurrence(n,r,a=>i.push(a)),i}set data(t){this.globalOccurrences.clear(),super.data=t}getRecurringTimeSpans(){return[...this.recurringEvents]}},qi=class extends We.mixin(Kl){static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:Sr,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}getRanges({resourceRecord:e,startDate:s,endDate:t}){return e.timeRanges.flatMap(r=>r.supportsRecurring?r.getOccurrencesForDateRange(s,t):r.intersectsRange(s,t)?r:[]).sort((r,i)=>r.startDate-i.startDate)}};F(qi,"$name","ResourceTimeRangeStore"),qi._$name="ResourceTimeRangeStore";var Jt=e=>class extends(e||$){static get $name(){return"PartOfProject"}},Jl=e=>class extends e{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(t,...n){t=t||{};const{fieldMap:r}=this,i=r.eventId.dataSource,a=r.resourceId.dataSource,o=r.event.dataSource,l=r.resource.dataSource,c=t[i],u=t[a],d=t[o],h=t[l];c!=null?t[o]=c:d!=null&&(t[i]=d.isModel?d.id:d),u!=null?t[l]=u:h!=null&&(t[a]=h.isModel?h.id:h),super.construct(t,...n)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(t,n){let r,i;return t?r=t.isModel?t.id:t:r=this.internalId,n?i=n.isModel?n.id:n:i=this.internalId,`${r}-${i}`}buildIndexKey({event:t,resource:n}){return this.buildEventResourceKey(t,n)}set(t,n,...r){var i,a;const o=this.fieldToKeys(t,n);return"resource"in o?((i=o.resource)==null?void 0:i.id)!==void 0&&(o.resourceId=o.resource.id):"resourceId"in o&&this.constructor.isProAssignmentModel&&(o.resource=o.resourceId),"event"in o?((a=o.event)==null?void 0:a.id)!==void 0&&(o.eventId=o.event.id):"eventId"in o&&this.constructor.isProAssignmentModel&&(o.event=o.eventId),super.set(o,null,...r)}afterChange(t,n,r,i,a){var o,l;const c=this;return!c.constructor.isProAssignmentModel&&(n!=null&&n.resourceId)&&((o=c.resource)==null?void 0:o.id)!==n.resourceId.value?c.resource=n.resourceId.value:c.constructor.isProAssignmentModel&&((l=c.project)!=null&&l.propagatingSyncChanges)&&(n!=null&&n.eventId)&&!(n!=null&&n.event)&&(t.event.value===n.eventId.value||t.event.value.id===n.eventId.value)&&(delete n.eventId,delete c.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(t){const{resource:n}=this;n!=null&&n.isModel&&n.id===t?this.set("resourceId",t):this.resource=t}get resourceId(){var t,n;return(n=(t=this.resource)==null?void 0:t.id)!=null?n:this.get("resourceId")}set eventId(t){const{event:n}=this;n!=null&&n.isModel&&n.id===t?this.set("eventId",t):this.event=t}get eventId(){var t,n;return(n=(t=this.event)==null?void 0:t.id)!=null?n:this.get("eventId")}get eventName(){var t;return(t=this.event)==null?void 0:t.name}get resourceName(){var t;return(t=this.resource)==null?void 0:t.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var t;const{event:n,resource:r,unjoinedStores:i,assignmentStore:a}=this,o=a==null?void 0:a.crudManager;let l;return a?l=this.isValid&&n.isPersistable&&(o||!n.hasGeneratedId&&!r.hasGeneratedId):l=!this.isPhantom&&!!i[0],l&&super.isPersistable&&!((t=this.event)!=null&&t.isCreating)}get isValid(){return this.resource!=null&&this.event!=null}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(t,n,r){var i,a;if(!super.shouldRecordFieldChange(t,n,r))return!1;if(t==="event"||t==="eventId"){const o=(i=this.project)==null?void 0:i.eventStore;if(o&&o.oldIdMap[n]===o.getById(r))return!1}if(t==="resource"||t==="resourceId"){const o=(a=this.project)==null?void 0:a.resourceStore;if(o&&o.oldIdMap[n]===o.getById(r))return!1}return!0}},ey=Ni,Sn=class extends Jl(Jt(ey.derive(H))){static get $name(){return"AssignmentModel"}};Sn.exposeProperties(),Sn._$name="AssignmentModel";var Ql=e=>class extends e{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(t,...n){var r;t=W.asArray(t);for(let i=0;i<t.length;i++){let a=t[i];if(a instanceof H||(t[i]=a=this.createRecord(a)),!this.isSyncingDataOnLoad&&this.storage.findIndex("eventResourceKey",a.eventResourceKey,!0)!==-1)throw new Error(`Duplicate assignment Event: ${a.eventId} to resource: ${a.resourceId}`);(r=a.event)!=null&&r.isCreating&&(a.isCreating=!0)}return super.add(t,...n)}includesAssignment(t,n){return this.storage.findIndex("eventResourceKey",`${t}-${n}`,!0)!==-1}setStoreData(t){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined EventStore data containing resourceId (single-assignment mode)");super.setStoreData(t)}set storage(t){super.storage=t,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(t,n){if(!t||!(n!=null&&n.isOccurrence))return t;const r=this;return{id:`${n.id}:a${t.id}`,event:n,resource:t.resource,eventId:n.id,resourceId:t.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(i){return r.occurrenceInstanceMeta(this,i)}}}occurrenceInstanceMeta(t,n){const r=this,i=n.id||n,{id:a}=t;let{occurrenceMeta:o}=r;return o||(o=r.occurrenceMeta={}),o[a]||(o[a]={}),o[a][i]||(o[a][i]={})}mapAssignmentsForEvent(t,n,r){t=this.eventStore.getById(t);const i=!!n,a=!!r;return i||a?t.assignments.reduce((o,l)=>{const c=i?n(l):l;return(!a||r(c))&&o.push(c),o},[]):t.assignments}mapAssignmentsForResource(t,n,r){t=this.resourceStore.getById(t);const i=!!n,a=!!r;return i||a?t.assignments.reduce((o,l)=>{const c=i?n(l):l;return(!a||r(c))&&o.push(c),o},[]):t.assignments}getAssignmentsForEvent(t){return t.assignments}removeAssignmentsForEvent(t){return this.remove(t.assignments)}getAssignmentsForResource(t){return t=this.resourceStore.getById(t),t.assignments}removeAssignmentsForResource(t){this.remove(this.getAssignmentsForResource(t))}getResourcesForEvent(t){return t.resources}getEventsForResource(t){return t=this.resourceStore.getById(t),t==null?void 0:t.events}assignEventToResource(t,n,r=null,i=!1){var a,o;const l=this,c=i?new Set(t.assignments):null;if(n=W.asArray(n).map(d=>{var h;return(h=d.$original)!=null?h:d}),(a=l.eventStore)!=null&&a.usesSingleAssignment){if((o=t.assignments)!=null&&o.length)return l.isEventAssignedToResource(t,n[0])||(t.resource=n[0]),[];t.resourceId=n[0].id}let u=[];return l.suspendAutoCommit(),n.forEach(d=>{var h;const f=l.getAssignmentForEventAndResource(t,d);if(f)i&&c.delete(f);else{const g={event:t,resource:d};u.push((h=r==null?void 0:r(g))!=null?h:g)}}),u=l.add(u),i&&l.remove(Array.from(c)),l.resumeAutoCommit(),u}unassignEventFromResource(t,n){const r=this,i=[];if(!n)return r.removeAssignmentsForEvent(t);n=W.asArray(n);for(let a=0;a<n.length;a++)r.isEventAssignedToResource(t,n[a])&&i.push(r.getAssignmentForEventAndResource(t,n[a]));return r.remove(i)}isEventAssignedToResource(t,n){return!!this.getAssignmentForEventAndResource(t,n)}getAssignmentForEventAndResource(t,n){let r;return!(t=this.eventStore.getById(t))||!(r=t.assignments)||!(n=this.resourceStore.$master.getById(n))?null:this.getOccurrence(r.find(i=>{var a;return((a=i.resource)==null?void 0:a.$original)===n.$original}),t)}},ty=Jt($l.derive(We)),Gi=class extends Ql(ty){static get defaultConfig(){return{modelClass:Sn}}};F(Gi,"$name","AssignmentStore"),Gi._$name="AssignmentStore";var Zl=e=>{var s;return s=class extends(e||$){static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(t){if(super.construct(t),this.autoTree=!0,this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}set filtersFunction(t){super.filtersFunction=t}get filtersFunction(){const t=super.filtersFunction;return t&&t!==Et.returnTrue?n=>n.isCreating||t(n):t}getEventCounts(t){const n=this,{filtersFunction:r,added:i}=n,a=n.getEvents({...t,storeFilterFn:n.isFiltered?n.reapplyFilterOnAdd?r:o=>i.includes(o)?n.indexOf(o)>-1:r(o):null,dateMap:t.dateMap||!0});return a.forEach((o,l)=>a.set(l,o.length)),a}forEachScheduledEvent(t,n=this){this.forEach(r=>{const{startDate:i,endDate:a}=r;if(i&&a)return t.call(n,r,i,a)})}getTotalTimeSpan(){let t=new Date(9999,0,1),n=new Date(0);return this.forEach(r=>{r.startDate&&(t=R.min(r.startDate,t)),r.endDate&&(n=R.max(r.endDate,n))}),t=t<new Date(9999,0,1)?t:null,n=n>new Date(0)?n:null,this.lastTotalTimeSpan={startDate:t||null,endDate:n||t||null}}isEventPersistable(t){return t.isPersistable}isDateRangeAvailable(t,n,r,i){if(i.data.generatedParent)return!1;const a=new Set(this.getEventsForResource(i));if(r!=null&&r.isAssignment&&r.event.resources.forEach(c=>{c.id!==r.resourceId&&this.getEventsForResource(c).forEach(u=>a.add(u))}),r){const o=r.isAssignment?r.event:r;a.delete(o)}return!Array.from(a).some(o=>o.isScheduled&&R.intersectSpans(t,n,o.startDate,o.endDate))}filterEventsForResource(t,n,r=this){return t.getEvents(this).filter(n.bind(r))}getResourcesForEvent(t){return t.isOccurrence&&(t=t.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(t)}getEventsForResource(t){return this.assignmentStore.getEventsForResource(t)}getAssignmentsForEvent(t){return this.assignmentStore.getAssignmentsForEvent(t)||[]}getAssignmentsForResource(t){return this.assignmentStore.getAssignmentsForResource(t)||[]}assignEventToResource(t,n,r=!1){return this.assignmentStore.assignEventToResource(t,n,void 0,r)}unassignEventFromResource(t,n){this.assignmentStore.unassignEventFromResource(t,n)}reassignEventFromResourceToResource(t,n,r){const i=this,a=H.asId(r),o=i.assignmentStore.getAssignmentForEventAndResource(t,n);o?o.resourceId=a:i.assignmentStore.assignEventToResource(t,r)}isEventAssignedToResource(t,n){return this.assignmentStore.isEventAssignedToResource(t,n)}removeAssignmentsForEvent(t){this.assignmentStore.removeAssignmentsForEvent(t)}removeAssignmentsForResource(t){this.assignmentStore.removeAssignmentsForResource(t)}append(t){return this.add(t)}get project(){return super.project}set project(t){var n;super.project=t,this.detachListeners("project"),t&&((n=t.assignmentStore)!=null&&n.isAssignmentStore&&this.attachToAssignmentStore(t.assignmentStore),t.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(t){this._usesSingleAssignment=t;const{assignmentStore:n}=this;n!=null&&n.isStore&&!n.hasGenerateIdOverride&&(n.modelClass.generateId=function(){return this.singleAssignmentIdCounter==null&&(this.singleAssignmentIdCounter=0),`a-${++this.singleAssignmentIdCounter}`},n.hasGenerateIdOverride=!0)}processRecords(t){var n;const{assignmentStore:r}=this,i=[];return r&&(r.skipInvalidateIndices=!0),t=super.processRecords(t,r&&!((n=this.stm)!=null&&n.isRestoring)&&(a=>{const o=a.get("resourceId");!a.reassignedFromReplace&&o!=null&&(r.includesAssignment(a.id,o)||i.push({id:r.modelClass.generateId(""),resourceId:o,eventId:a.id})),a.reassignedFromReplace=!1})||void 0),r&&(r.storage.invalidateIndices(),r.skipInvalidateIndices=!1,r.add(i)),t}joinRecordsToStore(t){const{assignmentStore:n}=this;n?(n.skipInvalidateIndices=!0,super.joinRecordsToStore(t),n.storage.invalidateIndices(),n.skipInvalidateIndices=!1):super.joinRecordsToStore(t)}processRecord(t,n=!1){var r,i,a;t=super.processRecord(t,n);const o=this,l=(i=o.assignmentStore)!=null?i:(r=o.crudManager)==null?void 0:r.assignmentStore,c=t.get("resourceId"),{resourceIds:u}=t;if(u!=null&&u.length&&t.meta.skipEnforcingSingleAssignment!==!1&&((a=o.modelClass.fieldMap)!=null&&a.resourceIds.persist))l?l.add(u.filter(d=>!l.some(h=>h.eventId===t.id&&h.resourceId===d)).map(d=>({resource:d,event:t}))):o.$processResourceIds=!0;else if(c!=null&&!t.meta.skipEnforcingSingleAssignment){const d=o.getById(t.id);if(d&&d!==t&&!n){const f=l.storage.findItem("eventId",t.id);if(f!=null&&f.size){const g=f.values().next().value;g.resource=c,t.reassignedFromReplace=!0}}else o.$processResourceIds=!0;o.usesSingleAssignment=!0}return t}processResourceIds(){var t,n,r;const i=this,a=(n=i.assignmentStore)!=null?n:(t=i.crudManager)==null?void 0:t.assignmentStore;if(i.$processResourceIds&&(a!=null&&a.isAssignmentStore)&&!((r=i.project)!=null&&r.isSharingAssignmentStore&&i.isChained)){const o=[];i.forEach(l=>{const{resourceId:c,resourceIds:u,id:d}=l;c!=null?o.push({id:a.modelClass.generateId(""),resourceId:c,eventId:d}):u!=null&&u.length&&u.forEach(h=>{o.push({id:a.modelClass.generateId(""),resourceId:h,eventId:d})})}),a.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},a.usesSingleAssignment=!1,a.verifyNoGeneratedIds=!1,a.data=o,a.usesSingleAssignment=!0,i.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:t}){var n;const r=this;if(r.removeUnassignedEvent&&!r.isRemoving&&!r.isSettingData&&!((n=r.stm)!=null&&n.isRestoring)&&!r.usesSingleAssignment&&!r.assignmentStore.isSyncingDataOnLoad&&!r.resourceStore.isSyncingDataOnLoad){const i=new Set;t.forEach(a=>{const{event:o}=a;o&&!o.isRemoved&&o.assignments.every(l=>t.includes(l))&&i.add(o)}),i.size&&r.remove([...i])}}onProjectAssignmentStoreChange({store:t}){this.attachToAssignmentStore(t)}attachToAssignmentStore(t){const n=this;n.detachListeners("assignmentStore"),t&&(n.processResourceIds(),t.ion({name:"assignmentStore",addPreCommit({records:r}){var i;!n.isSettingData&&!n.isAssigning&&(n.usesSingleAssignment?r.forEach(a=>{const{event:o}=a;o!=null&&o.isEvent&&o.resourceId!==a.resourceId&&(o.meta.isAssigning=!0,o.set("resourceId",a.resourceId),o.meta.isAssigning=!1)}):(i=n.modelClass.fieldMap)!=null&&i.resourceIds.persist&&r.forEach(a=>{var o;const{event:l}=a;if(l!=null&&l.isEvent){l.meta.isAssigning=!0;const c=(o=l.resourceIds)!=null?o:[];c.includes(a.resourceId)||(l.resourceIds=[...c,a.resourceId]),l.meta.isAssigning=!1}}))},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:r}){var i;!n.isSettingData&&!n.isAssigning&&(n.usesSingleAssignment?r.forEach(a=>{var o;(o=n.getById(a.eventId))==null||o.set("resourceId",null)}):(i=n.modelClass.fieldMap)!=null&&i.resourceIds.persist&&r.forEach(({event:a,resourceId:o})=>{const l=a.resourceIds.slice(),c=l==null?void 0:l.indexOf(o);c>=0&&(l.splice(c,1),a.resourceIds=l)}))},removeAllPreCommit(){var r;!n.isSettingData&&!n.isAssigning&&(n.usesSingleAssignment?n.allRecords.forEach(i=>i.set("resourceId",null)):(r=n.modelClass.fieldMap)!=null&&r.resourceIds.persist&&n.allRecords.forEach(i=>{i.resourceIds=[]}))},update({record:r,changes:i}){var a;if("resourceId"in i){const{event:o}=r;if(n.usesSingleAssignment)o.meta.isAssigning=!0,o.set("resourceId",i.resourceId.value),o.meta.isAssigning=!1;else if((a=n.modelClass.fieldMap)!=null&&a.resourceIds.persist){o.meta.isAssigning=!0;const l=o.resourceIds.slice(),c=l==null?void 0:l.indexOf(i.resourceId.oldValue);c>=0&&l.splice(c,1),l!=null&&l.includes(i.resourceId.value)||(l.push(i.resourceId.value),o.resourceIds=l),o.meta.isAssigning=!1}}},change({action:r,records:i}){var a;r==="dataset"&&((a=n.modelClass.fieldMap)!=null&&a.resourceIds.persist)&&i.forEach(({event:o,resourceId:l})=>{var c;const u=(c=o.resourceIds)!=null?c:[];u.includes(l)||(u.push(l),o.meta.isAssigning=!0,o.setData("resourceIds",u),o.meta.isAssigning=!1)})},thisObj:n}))}set data(t){this.isSettingData=!0,this.usesSingleAssignment&&!this.syncDataOnLoad&&!this.isChained&&this.assignmentStore.removeAll(!0),super.data=t,this.isSettingData=!1}trigger(t,n){var r;const{changes:i}=n||{};return i&&"resourceId"in i&&Object.keys(i).length===1&&!((r=this.stm)!=null&&r.isRestoring)&&(n.isAssign=!0),super.trigger(...arguments)}remove(t,...n){var r,i;const a=super.remove(t,...n);if(a.length&&this.usesSingleAssignment)for(const o of a)o.isOccurrence||(i=this.assignmentStore||((r=this.crudManager)==null?void 0:r.assignmentStore))==null||i.remove(o.assignments,!0);return a}},F(s,"$name","EventStoreMixin"),s},ry=()=>!0,sy=e=>!e.isRecurring,Hi=e=>{var s;return s=class extends e{getEvents({filter:t,date:n,startDate:r,endDate:i,startOnly:a,includeOccurrences:o,allowPartial:l,onlyAssigned:c=!1,dateMap:u=!1,dayTime:d=null,getDateIndex:h}){const f=this,g=arguments[0],{lastDateRange:p,added:m,filtersFunction:y}=f,D=t;if(c&&(g.filter=D?C=>D(C)&&C.resources.length:C=>C.resources.length),"startDate"in g||(r=g.startDate=n),"includeOccurrences"in g||(o=g.includeOccurrences=!0),"allowPartial"in g||(l=g.allowPartial=!a),g.storeFilterFn=f.isFiltered&&!g.ignoreFilters?f.reapplyFilterOnAdd?y:C=>m.includes(C)?f.indexOf(C)>-1:y(C):null,!i)if(r)i=g.endDate=R.clearTime(r),i.setDate(i.getDate()+1);else{if(o)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");g.dateFilter=ry}g.dateFilter||(a?g.dateFilter=C=>{const v=C.hasBatchedChange("startDate")?C.get("startDate"):C.startDate;return v&&!(R.clearTime(v)-r)}:l?g.dateFilter=C=>{const v=C.hasBatchedChange("startDate")?C.get("startDate"):C.startDate,S=C.hasBatchedChange("endDate")?C.get("endDate"):C.endDate||v,b=!(v-S);return v&&(b?R.betweenLesserEqual(v,r,i):R.intersectSpans(v,S,r,i))}:g.dateFilter=C=>{const v=C.hasBatchedChange("startDate")?C.get("startDate"):C.startDate,S=C.hasBatchedChange("endDate")?C.get("endDate"):C.endDate||v;return v&&v>=r&&S<=i});const E={startDate:r,endDate:i};return f.processConfiguredListeners(),f.trigger("loadDateRange",{old:p||{},new:_.clone(E),changed:!!(!p||p.startDate-E.startDate||p.endDate-E.endDate)}),f.lastDateRange=_.clone(E),u?f.getEventsAsMap(g):f.getEventsAsArray(g)}getEventsAsArray({filter:t,date:n,resourceRecord:r,startDate:i=n,endDate:a,startOnly:o,includeOccurrences:l=!0,dayTime:c=null,dateFilter:u,storeFilterFn:d,getDateIndex:h}){const f=this,g=[];if(d?f.count:f.allCount){let m=r?f.getEventsForResource(r):null;if(!r){const y=f.useDayIndex(c),D=new Set,E=o?"startDate":"date";f.recurringEvents.forEach(C=>{y.dayTime.startOfDay(C.startDate)<=i&&D.add(C)});for(const C=new Date(i);C<a;C.setDate(C.getDate()+1)){const v=y.get(h?h(C):E,C);v==null||v.forEach(S=>D.add(S))}m=[...D]}d&&(m=m.filter(d));for(let y=0,{length:D}=m;y<D;y++){const E=m[y];l&&E.isRecurring?g.push.apply(g,E.getOccurrencesForDateRange(i,a).filter(u)):u(E)&&g.push(E)}}return t?g.filter(t):g}getEventsAsMap({filter:t,date:n,resourceRecord:r,startDate:i=n,endDate:a,startOnly:o,includeOccurrences:l=!0,dateMap:c,dayTime:u=null,storeFilterFn:d,getDateIndex:h}){var f;const g=this;if(c!=null&&c.clear?c.clear():c=new Map,g.count){const p=g.useDayIndex(u),m=o?"startDate":"date",y=[],D=C=>(!t||t(C))&&(!d||d(C)),E=C=>sy(C)&&D(C);if(u=p.dayTime,r)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");(f=g.recurringEvents)==null||f.forEach(C=>{u.startOfDay(C.startDate)<a&&y.push(C)});for(const C=new Date(i);C<a;C.setDate(C.getDate()+1)){let[v,S]=p.get(h?h(C):m,C,!0);v!=null&&v.size&&(v=[...v].filter(E),v.length&&(c.get(S)||c.set(S,[]).get(S)).push(...v))}for(let C=0,{length:v}=y;C<v;C++){const S=y[C],b=(l?S.getOccurrencesForDateRange(i,a):[S]).filter(D),P=R.add(a,1,"day");for(let M,w=0,{length:A}=b;w<A;w++){const T=b[w],k=u.startOfDay(T.startDate),Z=h?h(k):o?"startDate":"date",z=Z==="startDate"||!T.durationMS?R.add(k,1,"day"):R.min(T.endDate||R.add(T.startDate,T.duration,T.durationUnit),P);for(;k<z;k.setDate(k.getDate()+1)){const re=u.dateKey(k);(M=c.get(re))||c.set(re,M=[]),M.push(T)}}}}return c}},F(s,"$name","GetEventsMixin"),s},Yi=60*1e3,Wr=60*Yi,Qt=24*Wr,ny=/(\d+)?:?(\d*)/,$e=class{static format(e){const s=Math.floor(e/Wr),t=Math.floor(e/Yi)%60;return`${s}:${t<10?"0":""}${t}`}static parse(e){const s=typeof e;if(s==="string"){const t=ny.exec(e);e=Number(t[1]||0)*Wr+Number(t[2]||0)*Yi}else s!=="number"?e=R.getTimeOfDay(e):e<=24&&(e*=Wr);return Math.min(Math.max(Math.floor(e),0),Qt)}constructor(e){let s=0,t,n;e!=null&&e.isDayView?(s=e.dayStartShift,t=e.dayStartTime,n=e.dayEndTime):typeof e=="number"?s=t=n=e:e&&(s=e.startShift,t=e.timeStart,n=e.timeEnd),this.startShift=s=$e.parse(s||0),this.timeEnd=(n==null?(s+Qt)%Qt:$e.parse(n))||Qt,this.timeStart=t==null?s:$e.parse(t)}get startHour(){return Math.floor(this.timeStart/Wr)}get endHour(){return Math.floor(this.timeEnd/Wr)}get startTimeOffsetMs(){const{startShift:e,timeStart:s}=this;return s<e?Qt-e+s:s-e}get today(){return this.startOfDay(new Date)}ceil(e){const s=this.startOfDay(e);return s<e&&s.setDate(s.getDate()+1),s}contains(e){return!this.outside(e)}dateKey(e){return e=this.shiftDate(e,-1),R.makeKey(e)}dayOfDate(e){return this.shiftDate(R.clearTime(e))}dayOfWeek(e){return e=this.shiftDate(e,-1),e.getDay()}delta(e,s="ms"){const{timeStart:t}=this,n=$e.parse(e),r=(this.startShift&&n<t?n+Qt:n)-t;return s==="ms"?r:R.as(s,r,"ms")}duration(e="ms"){const{timeStart:s,timeEnd:t}=this,n=s<t?t-s:Qt-s+t;return e==="ms"?n:R.as(e,n,"ms")}equals(e){return this.startShift===(e==null?void 0:e.startShift)&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}intersects(e,s){const t=this,{timeStart:n,timeEnd:r}=t,[i,a]=t._dateRangeArgs(e,s),[o,l]=t.timeRange(i,a);return n<r?o<l?o<r&&n<=l:o<r||n<=l:!(o<l)||o<r||n<=l}isIntraDay(e,s){const t=this,[n,r]=t._dateRangeArgs(e,s),i=t.startOfDay(n),a=Qt-R.diff(i,r,"ms");return a<0?!1:a>0||i<n}isInterDay(e){return e.allDay||!this.isIntraDay(...arguments)}outside(e){const{startShift:s,timeStart:t,timeEnd:n}=this,r=$e.parse(e);return t<n?r<t?r<s?1:-1:r<n?0:r<s?-1:1:r<n||r>=t?0:r<s?1:-1}parseKey(e){return this.dayOfDate(R.parseKey(e))}shiftDate(e,s=1){const{startShift:t}=this,n=typeof e;return e=n==="number"?new Date(e):n==="string"?R.parse(e):new Date(e.getTime()),s&&t&&e.setMilliseconds(s>0?t:-t),e}sortEvents(e,s){const t=this.startOfDay(e);return s==null?void 0:s.sort((n,r)=>{n=n.eventRecord||n,r=r.eventRecord||r;let{startDate:i}=n,{startDate:a}=r;return i?a?(i=i<t?t:i,a=a<t?t:a,i-a||r.endDate-a-(n.endDate-i)):1:-1})}startOfDay(e){return e=this.shiftDate(e,-1),e=R.clearTime(e),e=this.shiftDate(e),e}timeRange(e,s){const[t,n]=this._dateRangeArgs(e,s);return[R.getTimeOfDay(t),R.getTimeOfDay(n)]}toString(){const{startShift:e,timeEnd:s,timeStart:t}=this,n=e?`@${$e.format(e)}`:"",r=$e.format(t);return t===s?e?n:r:`${r}-${$e.format(s)}${n}`}_dateRangeArgs(e,s){return e.isModel?[e.startDate,e.endingDate]:[e,s]}};$e.MIDNIGHT=new $e({startShift:0,timeStart:0,timeEnd:24}),$e.MILLIS_PER_MINUTE=Yi,$e.MILLIS_PER_HOUR=Wr,$e.MILLIS_PER_DAY=Qt,$e._$name="DayTime";var Ki={date:"_dateIndex",startDate:"_startDateIndex"},Xl=Object.values(Ki),Pg=Object.freeze([]),{MILLIS_PER_DAY:Mg}=$e,ec=class{constructor(e,s){this.dayTime=s||$e.MIDNIGHT,this.store=e,this.users=[this.dayTime]}add(e,s,t){const n=this[Ki[e]],r=this.dayTime.dateKey(s);(n[r]||(n[r]=new Set)).add(t)}addEvent(e){var s,t,n;let r=(s=this.dayTime.startOfDay(e.startDate))==null?void 0:s.getTime(),i;if(r){i=(n=(t=e.endDate)==null?void 0:t.getTime())!=null?n:r,this.add("startDate",r,e);do this.add("date",r,e),r+=Mg;while(r<i)}}clear(){Xl.forEach(e=>this[e]=Object.create(null))}get(e,s,t){!this.initialized&&this.initialize();let n=this[Ki[e]],r;return s&&(r=this.dayTime.dateKey(s),n=t?[n[r],r]:n[r]),n}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,Xl.forEach(e=>this[e]=null)}matches(e){return this.dayTime.startShift===e.startShift}remove(e,s,t){const n=this[Ki[e]],r=this.dayTime.dateKey(s),i=n[r];i&&i.delete(t)}removeEvent(e,s,t){var n,r;let i=(n=this.dayTime.startOfDay(s))==null?void 0:n.getTime(),a;if(i){a=(r=t==null?void 0:t.getTime())!=null?r:i,this.remove("startDate",i,e);do this.remove("date",i,e),i+=Mg;while(i<a)}}sync(e,s,t,n,r){var i,a;s=s||Pg,t=t||Pg;const o=this,l=s.length,c=t.length,u=n==null?void 0:n.length;let d,h,f;if(o.initialized)switch(e){case"clear":o.clear();break;case"splice":if(u)for(s=s.slice(),t=t.slice(),d=0;d<u;d++)t.push(n[d][0]),s.push(n[d][1]);if(c)for(d=0;d<c;d++)f=t[d],o.removeEvent(f,f.startDate,f.endDate);if(l)for(d=0;d<l;d++)h=s[d],h.isScheduled&&!h.isParent&&o.addEvent(h);break;case"reschedule":f=s[0],o.removeEvent(f,((i=r.startDate)==null?void 0:i.oldValue)||f.startDate,((a=r.endDate)==null?void 0:a.oldValue)||f.endDate),o.sync("splice",s);break}}register(e){this.users.push(e)}unregister(e){const{users:s}=this,t=s.indexOf(e);return t>-1&&s.splice(t,1),!s.length}},xg=ec.prototype;Xl.forEach(e=>xg[e]=null),xg.initialized=!1,ec._$name="EventDayIndex";var{MIDNIGHT:Tg}=$e,tc=e=>{var s;return s=class extends e{construct(t){super.construct(t),this.dayIndices=null}afterLoadData(){var t;this.syncIndices("splice",this.storage.allValues),(t=super.afterLoadData)==null||t.call(this)}onDataChange({action:t,added:n,removed:r,replaced:i}){this.syncIndices(t,n,r,i),super.onDataChange(...arguments)}onDataReplaced(t,n){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(t,n)}onModelChange(t,n,r,i,a){("startDate"in r||"endDate"in r)&&this.syncIndices("reschedule",[t],null,null,r),super.onModelChange(...arguments)}invalidateDayIndices(){var t;(t=this.dayIndices)==null||t.forEach(n=>n.invalidate())}registerDayIndex(t){const n=this,r=n.dayIndices||(n.dayIndices=[]);let i,a;for(a=0;!i&&a<r.length;++a)r[a].matches(t)&&(i=r[a]).register(t);return!i&&r.push(i=new ec(n,t)),i}syncIndices(...t){var n;(n=this.dayIndices)==null||n.forEach(r=>r.sync(...t))}unregisterDayIndex(t){const n=this,{dayIndices:r}=n;for(let i=r==null?void 0:r.length;i-- >0;)if(r[i].matches(t)){r[i].unregister(t)&&r.splice(i,1);break}}useDayIndex(t){const n=this,{dayIndices:r}=n;t=t||Tg;for(let i=0;r&&i<r.length;++i)if(r[i].matches(t))return r[i];if(t.startShift)throw new Error(`No day index registered for ${t} on ${n.id}`);return n.registerDayIndex(Tg)}},F(s,"$name","DayIndexMixin"),s},rc=e=>class extends Kl(e||$){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(t){return super.isEventPersistable(t)&&(!t.supportsRecurring||!t.isOccurrence)}},iy=1e3*60*60*24,Ji=e=>class extends e{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resourceIds",type:"array",persist:!1,internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0,useProp:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach(t=>{t.eventId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentEventIds()}get resources(){return this.assignments.reduce((t,{resource:n})=>(n&&t.push(n.$original),t),[])}set resources(t){var n;t=W.asArray(t);const r=this,i=t.map(r.constructor.asId);if(r.usesSingleAssignment)r.set("resourceId",i[0]);else if((n=r.fieldMap)!=null&&n.resourceIds.persist)r.resourceIds=i;else{const a=r.assignments.map(c=>c.resource.id),{onlyInA:o,onlyInB:l}=W.delta(i,a);r.assignmentStore.add(o.map(c=>({resource:c,event:r}))),r.assignmentStore.remove(l.map(c=>r.assignments.find(u=>u.resource.id===c)))}}forEachResource(t,n=this){for(const r of this.resources)if(t.call(n,r)===!1)return}getResource(t){return t==null?this.resource:this.resourceStore?this.resourceStore.getById(t):null}get startDate(){var t;let n;return this.isOccurrence?n=this.get("startDate"):n=(t=this._startDate)!=null?t:super.startDate,this.allDay&&(n=this.constructor.getAllDayStartDate(n)),n}set startDate(t){this.batching?(this._startDate=t,this.set({startDate:t})):super.startDate=t}get endDate(){var t;let n;return this.isOccurrence?n=this.get("endDate"):n=(t=this._endDate)!=null?t:super.endDate,this.allDay&&(n=this.constructor.getAllDayEndDate(n)),n}set endDate(t){this.batching?(this._endDate=t,this.set({endDate:t})):super.endDate=t}get wrapStartDate(){return this.startDate}set wrapStartDate(t){}get wrapEndDate(){return this.endDate}set wrapEndDate(t){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(){const t=this,{isPersistable:n,meta:{batchChanges:r}}=t;if(r&&("endDate"in r&&(delete t._endDate,t.postamble&&(t.wrapEndDate=null)),"startDate"in r&&(delete t._startDate,t.preamble&&(t.wrapStartDate=null))),super.endBatch(...arguments),t.isPersistable&&!n&&!t.ignoreBag&&t.assigned)for(const i of t.assigned)i.stores.forEach(a=>a.updateModifiedBagForRecord(i))}get isCreating(){return super.isCreating}set isCreating(t){var n,r;super.isCreating=t,(n=this.assignmentStore)==null||n.suspendAutoCommit(),this.assignments.forEach(i=>i.isCreating=t),(r=this.assignmentStore)==null||r.resumeAutoCommit()}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...t){const n=super.copy(...t);return this.usesSingleAssignment||(n.resourceId=null),n}get persistableData(){const t=super.persistableData;return this.usesSingleAssignment||delete t.resourceId,t}get resource(){const{resources:t}=this;return t.length?t[0]:null}set resource(t){this.resourceId=this.constructor.asId(t)}get resourceId(){var t;return this.usesSingleAssignment?this.get("resourceId"):(t=this.resource)==null?void 0:t.id}set resourceId(t){this.applyResourceId(t)}get resourceIds(){var t,n,r;return(t=this.fieldMap)!=null&&t.resourceIds.persist?this.get("resourceIds"):(r=(n=this.resources)==null?void 0:n.map(i=>i.id))!=null?r:[]}set resourceIds(t){this.set("resourceIds",t)}get $linkedResources(){var t,n;return(n=(t=this.resources)==null?void 0:t.flatMap(r=>[r,...r.$links]))!=null?n:[]}applyResourceId(t,n=!1){var r,i;const a=this,{eventStore:o,assignments:l}=a;if(o){const c=o.assignmentStore||((r=o.crudManager)==null?void 0:r.assignmentStore);if(t!=null)if(a.meta.skipEnforcingSingleAssignment||(o.usesSingleAssignment=!0),l!=null&&l.length&&t!==l[0].resourceId){const u=!!o.eventsSuspended;u&&c.suspendEvents(),l[0].resource=t,u&&c.resumeEvents()}else c.assignEventToResource(a,t);else(a.usesSingleAssignment||(i=a.resourceIds)!=null&&i.length)&&c.remove(l)}else n||a.set({resourceId:t})}applyResourceIds(t,n=!1){var r;const i=this,{eventStore:a,assignments:o}=i;if(i.fieldMap.resourceIds.persist===!1)return!1;if(t=[...new Set(t)],a){const l=a.assignmentStore||((r=a.crudManager)==null?void 0:r.assignmentStore);if(t!=null&&t.length)if(o!=null&&o.length){const c=!!a.eventsSuspended;c&&l.suspendEvents(),o.forEach(h=>{const f=t.find(g=>!o.some(p=>p.resourceId===g));f&&(h.resource=f)});const{onlyInA:u,onlyInB:d}=W.delta(t,o.map(h=>h.resourceId));l.add(u.map(h=>({resource:h,event:i}))),l.remove(d.map(h=>o.find(f=>f.resource.id===h))),c&&l.resumeEvents()}else l.add(t.map(c=>({resource:c,event:i})));else l.remove(o)}else n||i.set({resourceIds:t})}applyValue(t,n,r,i,a){if(a&&!this.meta.isAssigning){const{eventStore:o}=this;switch(a.name){case"resourceId":o&&(o.isAssigning=!0),this.applyResourceId(r,!0);break;case"resourceIds":o&&(o.isAssigning=!0),this.applyResourceIds(r,!0);break}o&&(o.isAssigning=!1)}super.applyValue(t,n,r,i,a)}get assignments(){return[...this.assigned||[]]}assign(t,n=!1){const{eventStore:r}=this;r&&!r.usesSingleAssignment?r.assignEventToResource(this,t,n):(this.resourceId=this.constructor.asId(t),r||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(t,n=!1){var r;const i=this;t=i.constructor.asId(t),i.meta.removingResource=n,(r=i.eventStore)==null||r.unassignEventFromResource(i,t),i.meta.removingResource=null}reassign(t,n){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,t,n)}isAssignedTo(t){const n=this.constructor.asId(t);return this.assignments.some(r=>r.resourceId===n)}get predecessors(){var t;return[...(t=this.incomingDeps)!=null?t:[]]}get successors(){var t;return[...(t=this.outgoingDeps)!=null?t:[]]}get dependencies(){var t,n;return[...(t=this.incomingDeps)!=null?t:[],...(n=this.outgoingDeps)!=null?n:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:t}=this;if(t>=iy||!t&&this.allDay)return!0;const{endDate:n,startDate:r}=this,i=R.clearTime(r);if(r&&n)return i.setDate(i.getDate()+1),(n||R.add(r,t))>i}static getAllDayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),t&&(t=R.clearTime(t,!0)),t}static getAllDayEndDate(t){return t&&t.isEvent&&(t=t.get("endDate")),t&&(t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0||t.getMilliseconds()>0)&&(t=R.getNext(t,"d",1)),t}static getAllDayDisplayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),R.clearTime(t,!0)}static getAllDayDisplayEndDate(t,n){return t&&t.isEvent&&(n=t.get("endDate"),t=t.get("startDate")),n&&(t=this.constructor.getAllDayDisplayStartDate(t),R.clearTime(n,!0).valueOf()===n.valueOf()?n=R.add(n,R.DAY,-1):t.valueOf()!==n.valueOf()&&(n=R.clearTime(n,!0))),n}isEditable(t){switch(t){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(t)}},ay=Vi,Dn=class extends ay.derive(lt).mixin(zi,Jt,Ji){static get $name(){return"EventModel"}};Dn.exposeProperties(),Dn._$name="EventModel";var oy=Jt(jl.derive(We)),Qi=class extends oy.mixin(rc,Zl,tc,Hi){static get defaultConfig(){return{modelClass:Dn}}};F(Qi,"$name","EventStore"),Qi._$name="EventStore";var sc=e=>class extends(e||$){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(t){if(super.construct(t),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const t=super.removeAll(...arguments);return t&&this.assignmentStore.removeAll(),t}onRecordIdChange({record:t,oldValue:n,value:r}){super.onRecordIdChange({record:t,oldValue:n,value:r}),t.isFieldModified("id")&&(this.isChangingId=!0,t.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:t,endDate:n}){return this.query(r=>this.eventStore.isDateRangeAvailable(t,n,null,r))}},nc=e=>class extends e{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image",{name:"resourceMargin",type:"number"},{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach(t=>{t.resourceId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce((t,n)=>(n.event&&t.push(n.event),t),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(t){t.forEach(n=>{n.resource=this})}getEvents(){return Se.deprecate("scheduler","6.0.0","getEvents() is deprecated, use the events property instead"),this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:t=""}=this;if(!t)return"";const n=t.split(" "),r=n[0][0],i=n.length>1?n[n.length-1][0]:"";return r+i}isWorkingTime(t){var n,r;const i=this.effectiveCalendar||((n=this.project)==null?void 0:n.calendar);return!i||((r=i.isWorkingTime)==null?void 0:r.call(i,t))}},ly=ys,Ds=class extends nc(Jt(ly.derive(vn))){};F(Ds,"$name","ResourceModel"),Ds.exposeProperties(),Ds._$name="ResourceModel";var cy=Jt(kl.derive(We)),ic=class extends sc(cy){static get defaultConfig(){return{modelClass:Ds}}};ic._$name="ResourceStore";var uy=["SS","SF","FS","FF"],St=class extends H{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(e){const s=e[this.fieldMap.from.dataSource],t=e[this.fieldMap.to.dataSource];s!=null&&(e.fromEvent=s),t!=null&&(e.toEvent=t),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||((e=this.unjoinedStores[0])==null?void 0:e.eventStore)}set from(e){const{fromEvent:s}=this;s!=null&&s.isModel&&s.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:s}=this;s!=null&&s.isModel&&s.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let s;return e!==this.hardType&&(s=this.set({type:e,fromSide:null,toSide:null})),s}get lag(){return this.get("lag")}set lag(e){this.setLag(e)}setLag(e,s=this.lagUnit){if(arguments.length===1){typeof e=="number"?this.lag=e:(e=R.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}));return}e=parseFloat(e),this.set({lag:e,lagUnit:s})}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${R.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new xe({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){typeof e=="string"?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:s,unjoinedStores:t}=e,n=s[0];let r;if(n){const{fromEvent:i,toEvent:a}=e,o=n.crudManager;r=i&&(o||!i.hasGeneratedId)&&a&&(o||!a.hasGeneratedId)}else r=!!t[0];return r&&super.isPersistable}getDateRange(){const{fromEvent:e,toEvent:s}=this;if(e!=null&&e.isScheduled&&(s!=null&&s.isScheduled)){const t=St.Type;let n,r;switch(this.type){case t.StartToStart:n=e.startDateMS,r=s.startDateMS;break;case t.StartToEnd:n=e.startDateMS,r=s.endDateMS;break;case t.EndToEnd:n=e.endDateMS,r=s.endDateMS;break;case t.EndToStart:n=e.endDateMS,r=s.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(n,r),end:Math.max(n,r)}}return null}highlight(e){var s,t;const n=(t=(s=this.highlighted)==null?void 0:s.split(" "))!=null?t:[];n.includes(e)||(this.highlighted=n.concat(e).join(" "))}unhighlight(e){const{highlighted:s}=this;if(s){const t=s.split(" "),n=t.indexOf(e);n>=0&&(t.splice(n,1),this.highlighted=t.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const s=uy[this.type];return e?s:this.type===St.Type.EndToStart?"":s}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:e,toEvent:s,type:t}=this;return typeof t=="number"&&e&&s&&e!==s}get fromEventName(){var e;return((e=this.fromEvent)==null?void 0:e.name)||""}get toEventName(){var e;return((e=this.toEvent)==null?void 0:e.name)||""}shouldRecordFieldChange(e,s,t){var n;if(!super.shouldRecordFieldChange(e,s,t))return!1;if(e==="from"||e==="to"||e==="fromEvent"||e==="toEvent"){const r=(n=this.project)==null?void 0:n.eventStore;if(r&&r.oldIdMap[s]===r.getById(t))return!1}return!0}};St.exposeProperties(),St._$name="DependencyBaseModel";var dy=Bi,Cn=class extends Jt(dy.derive(St)){static get $name(){return"DependencyModel"}getTypeFromSides(e,s,t){const n=St.Type,r=t?"right":"left",i=t?"left":"right";return e===r?s===r?n.StartToStart:n.StartToEnd:s===i?n.EndToEnd:n.EndToStart}};Cn.exposeProperties(),Cn._$name="DependencyModel";var ac=e=>class extends e{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(t,n,r,i=!0,a){return a=a||(o=>this.getEventDependencies(o)),t=W.asArray(t),t.reduce((o,l)=>{l.children&&!i?l.traverse(c=>{o=a(c).reduce(n,o)}):o=a(l).reduce(n,o)},r),r}mapEventDependencies(t,n,r,i,a){return this.reduceEventDependencies(t,(o,l)=>(r(l)&&o.push(l),o),[],i,a)}mapEventPredecessors(t,n,r,i){return this.reduceEventPredecessors(t,(a,o)=>(r(o)&&a.push(o),a),[],i)}mapEventSuccessors(t,n,r,i){return this.reduceEventSuccessors(t,(a,o)=>(r(o)&&a.push(o),a),[],i)}getEventDependencies(t){return[].concat(t.predecessors||[],t.successors||[])}removeEventDependencies(t){this.remove(this.getEventDependencies(t))}removeEventPredecessors(t){this.remove(t.predecessors)}removeEventSuccessors(t,n){this.remove(t.successors)}getBySourceTargetId(t){return this.records.find(n=>t==this.constructor.makeDependencySourceTargetCompositeKey(n.from,n.to))}getDependencyForSourceAndTargetEvents(t,n){return t=H.asId(t),n=H.asId(n),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(t,n))}getEventsLinkingDependency(t,n){return this.getDependencyForSourceAndTargetEvents(t,n)||this.getDependencyForSourceAndTargetEvents(n,t)}async isValidDependency(t,n,r){let i=t,a=n;return t==null?!1:(t.isDependencyModel&&({fromEvent:i,toEvent:a}=t),i=this.eventStore.getById(i),a=this.eventStore.getById(a),i&&a?!i.project||!a.project?!1:this.project.isValidDependency(i,a,r):t!==n)}isValidDependencyToCreate(t,n,r){return this.isValidDependency(t,n,r)}getHighlightedDependencies(t){return this.records.reduce((n,r)=>(r.isHighlightedWith(t)&&n.push(r),n),[])}static makeDependencySourceTargetCompositeKey(t,n){return`source(${t})-target(${n})`}getTimeSpanDependencies(t){return this.getEventDependencies(t)}},hy=Jt(Fl.derive(We)),oc=class extends ac(hy.derive(We)){static get defaultConfig(){return{modelClass:Cn}}};oc._$name="DependencyStore";var Og=e=>class extends(e||$).mixin(Nl,Dg,Cg){static get defaultConfig(){return{project:null}}startConfigure(t){this.getConfig("project"),super.startConfigure(t),this._changesToClear=new Map}async doAutoLoad(){const{project:t}=this;return t&&await t.commitAsync(),super.doAutoLoad()}applyProjectResponse(t){const n=this,{project:r}=n;n.applyingProjectResponse=!0;const i=r.fieldMap.startDate,a=r.fieldMap.endDate,o=x.getPath(t,i.dataSource),l=x.getPath(t,a.dataSource);typeof o=="string"&&x.setPath(t,i.dataSource,i.convert(o)),typeof l=="string"&&x.setPath(t,a.dataSource,a.convert(l)),Object.assign(r,t),n._changesToClear.set(n,t),n.applyingProjectResponse=!1}loadCrudManagerData(t,n={}){const r=this,{project:i}=r;r.suspendChangesTracking(),super.loadCrudManagerData(...arguments),t!=null&&t.project&&(i.delayEnteringReplica?i.ion({recordsUnlinked:()=>{r.suspendChangesTracking(),r.applyProjectResponse(t.project),r.resumeChangesTracking()},once:!0}):r.applyProjectResponse(t.project)),r.resumeChangesTracking()}async sync(){const{project:t}=this;if(this.suspendAutoSync(),t&&await t.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(t,n,r){var i,a,o,l,c,u;const d=this;if(!(d.isDestroyed||(i=d.project)!=null&&i.isDestroyed)){if(d.trigger("beforeApplyResponse"),await super.applyResponse(t,n,r),(n!=null&&n.project||d.supportShortSyncResponse&&((a=t==null?void 0:t.pack)!=null&&a.project))&&d.applyProjectResponse(n.project||((o=t==null?void 0:t.pack)==null?void 0:o.project)),d.project){let h=t.type;d.trackResponseType&&(h=n.type||h);const f=`propagating${U.capitalize(h)}Changes`;d.suspendAutoSync(),d[f]=!0;const g=d.project.isInitialCommit&&!d.project.silenceInitialCommit;await d.project.commitAsync(),d[f]=!1,(l=d.resumeAutoSync)==null||l.call(d,g),(c=d.commitRespondedChanges)==null||c.call(d)}(u=d.trigger)==null||u.call(d,"applyResponse")}}applySyncResponse(...t){var n;const r=this,i=(n=r.project)==null?void 0:n.stm.disabled;i===!1&&r.ignoreRemoteChangesInSTM&&r.project.stm.disable(),super.applySyncResponse(...t),i===!1&&r.project.stm.enable()}shouldClearRecordFieldChange(t,n,r){const i=t.getValue(n);return n=t.getFieldDefinition(n),n!=null&&n.isEqual?n.isEqual(i,r):x.isEqual(i,r)}commitRespondedChanges(){this._changesToClear.forEach((t,n)=>{Object.entries(t).forEach(([r,i])=>{this.shouldClearRecordFieldChange(n,r,i)&&delete n.meta.modified[r]})}),this._changesToClear.clear()}applyChangesToStore(t,n,r,...i){const a=super.applyChangesToStore(t,n,r,...i);if(a.size&&this.project)for(const[o,l]of a){const c=t.store.getById(o);c&&this._changesToClear.set(c,l)}return a}},Ag=e=>{var s;return s=class extends(e||H){static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null}}get assignments(){return this.assignmentStore.allRecords}updateAssignments(t){this.assignmentStore.data=t}get dependencies(){return this.dependencyStore.allRecords}updateDependencies(t){this.dependencyStore.data=t}get resources(){return this.resourceStore.allRecords}updateResources(t){this.resourceStore.data=t}get timeRanges(){return this.timeRangeStore.allRecords}getTimeRanges(t,n){const r=this.timeRangeStore,i=[];for(const a of r)a.isRecurring?i.push(...a.getOccurrencesForDateRange(t,n)):a.startDate<n&&t<a.endDate&&i.push(a);return i}updateTimeRanges(t){this.timeRangeStore.data=t}getResourceTimeRanges(t,n){const r=this.resourceTimeRangeStore,i=[];for(const a of r)a.isRecurring?i.push(...a.getOccurrencesForDateRange(t,n)):a.startDate<n&&t<a.endDate&&i.push(a);return i}},F(s,"$name","ProjectModelCommon"),s},lc=e=>{var s;return s=class extends(e||H){get _storesWithDates(){return[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore].filter(t=>t)}overrideStoreProcessRecord(t){this._storesWithDates.includes(t)&&!t.$originalProcessRecord&&(t.$originalProcessRecord=Et.before(t,"processRecord",(n,r)=>{(r||t.isLoadingData)&&this.convertRecordToTimeZone(n)}))}attachStore(t){super.attachStore(t),t&&this.timeZone!=null&&this._storesWithDates.includes(t)&&(this.convertStoresToTimeZone([t]),this.overrideStoreProcessRecord())}detachStore(t){if(super.detachStore(t),t&&!t.isDestroyed){const{$originalProcessRecord:n}=t;n&&(n(),t.$originalProcessRecord=null,this.convertStoresToTimeZone([t],null))}}relayStoreChange({source:t,action:n,records:r,replaced:i}){const a=this;a.timeZone!=null&&a._storesWithDates.includes(t)&&["add","replace"].includes(n)&&(!(r!=null&&r.length)&&(i!=null&&i.length)&&(r=i),r.length&&r.forEach(o=>o.timeZone=a.timeZone))}convertStoresToTimeZone(t,n=this.timeZone){var r;const i=this,a=(r=i.stm)==null?void 0:r.autoRecord;a&&(i.stm.autoRecord=!1);for(const o of t)o==null||o.forEach(l=>i.convertRecordToTimeZone(l,n));a&&(i.stmAutoRecord=a)}convertRecordToTimeZone(t,n=this.timeZone){var r;if(t.timeZone!==n){if(t.$ignoreChange=!0,(r=t.baselines)!=null&&r.count)for(const i of t.baselines)t.timeZone!==i.timeZone&&(i.timeZone=t.timeZone),i.convertToTimeZone(n);t.convertToTimeZone(n),t.$ignoreChange=!1}}updateTimeZone(t,n){const r=this,i=r._isConfiguringTimeZone||r.isConfiguring;if(r.trigger("beforeTimeZoneChange",{timeZone:t,oldTimeZone:n,isConfiguring:i}),r.calendarManagerStore.forEach(a=>a.bumpVersion()),r.convertStoresToTimeZone(r._storesWithDates),r._storesWithDates.forEach(a=>r.overrideStoreProcessRecord(a)),r.startDate){const a=n!=null?vt.fromTimeZone(r.startDate,n):r.startDate;r.startDate=t!=null?vt.toTimeZone(a,t):a}r.ignoreRecordChanges=!0,r.commitAsync().then(()=>{r.isDestroyed||r.trigger("timeZoneChange",{timeZone:t,oldTimeZone:n,isConfiguring:i}),delete r._isConfiguringTimeZone})}},F(s,"$name","ProjectModelTimeZoneMixin"),F(s,"configurable",{timeZone:{$config:"lazy",value:null}}),s},cc=e=>{var s;return s=class extends(e||H).mixin(Ag,lc){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:lt,resourceTimeRangeModelClass:Sr,timeRangeStoreClass:K,resourceTimeRangeStoreClass:qi,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null}}get inlineData(){return U.safeJsonParse(super.json)}set inlineData(t){this.json=t}construct(t={}){super.construct(...arguments),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const t=this;!t.timeRangeStore.stm&&t.stm.addStore(t.timeRangeStore),!t.resourceTimeRangeStore.stm&&t.stm.addStore(t.resourceTimeRangeStore)}attachStore(t){t&&t.ion({name:t.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(t)}detachStore(t){t&&(this.detachListeners(t.$$name),super.detachStore(t))}relayStoreChange(t){return super.relayStoreChange(t),this.trigger("change",{store:t.source,...t,source:this})}updateTimeRangeStore(t,n){this.detachStore(n),this.attachStore(t)}setTimeRangeStore(t){this.timeRangeStore=t}changeTimeRangeStore(t){return t&&!t.isStore&&(t=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},t)),t}updateResourceTimeRangeStore(t,n){this.detachStore(n),this.attachStore(t)}changeResourceTimeRangeStore(t){return t&&!t.isStore&&(t=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},t)),t}setResourceTimeRangeStore(t){this.resourceTimeRangeStore=t}get events(){return this.eventStore.allRecords}updateEvents(t){this.eventStore.data=t}get resourceTimeRanges(){return this.resourceTimeRangeStore.allRecords}updateResourceTimeRanges(t){this.resourceTimeRangeStore.data=t}async loadInlineData(t){return this.isLoadingInlineData=!0,t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),super.loadInlineData(t)}toJSON(){const t=this,n={eventsData:t.eventStore.toJSON(),resourcesData:t.resourceStore.toJSON(),dependenciesData:t.dependencyStore.toJSON(),timeRangesData:t.timeRangeStore.toJSON(),resourceTimeRangesData:t.resourceTimeRangeStore.toJSON()};return t.eventStore.usesSingleAssignment||(n.assignmentsData=t.assignmentStore.toJSON()),n}get json(){return super.json}changeJson(t){return typeof t=="string"&&(t=U.safeJsonParse(t)),t}updateJson(t){t&&this.loadInlineData(t)}afterChange(t,n){super.afterChange(...arguments),n.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},F(s,"configurable",{json:null,timeRangeStore:{value:{id:"timeRanges",modelClass:lt},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),s},$g=e=>class extends e{getCurrentConfig(t){const n=this,r=super.getCurrentConfig(t);if(r){for(const i of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const a=n[i];if(a){a.count&&(r[a.id+"Data"]=a.getInlineData(t));const o=a.getCurrentConfig(t);o&&Object.keys(o).length>0?r[i]=Object.assign(r[i]||{},o):r[i]&&Object.keys(r[i]).length===0&&delete r[i]}}return r.timeRangeStore&&((n.timeRangeStore.originalModelClass===n.timeRangeModelClass||n.timeRangeStore.originalModelClass.$name==="TimeSpan")&&delete r.timeRangeStore.modelClass,r.timeRangeStore.storeId==="timeRanges"&&delete r.timeRangeStore.storeId,Object.keys(r.timeRangeStore).length===1&&delete r.timeRangeStore),n.taskStore.isTaskStore&&(delete r.eventModelClass,delete r.eventStoreClass,delete r.children),r}}},_g=class extends ${set eventStore(e){const s=this;s.eventStoreDetacher&&s.eventStoreDetacher(),s._eventStore=e,e&&e.autoCommit&&(s.eventStoreDetacher=e.ion({beforecommit:s.onEventStoreBeforeSync,thisObj:s,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const s=this;s.resourceStoreDetacher&&s.resourceStoreDetacher(),s._resourceStore=e,e&&e.autoCommit&&(s.resourceStoreDetacher=e.ion({beforecommit:s.onResourceStoreBeforeSync,thisObj:s,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const s=this;s.assignmentStoreDetacher&&s.assignmentStoreDetacher(),s._assignmentStore=e,e&&e.autoSync&&(s.assignmentStoreDetacher=e.ion({beforecommit:s.onAssignmentStoreBeforeSync,thisObj:s,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const s=this;s.dependencyStoreDetacher&&s.dependencyStoreDetacher(),s._dependencyStore=e,e&&e.autoSync&&(s.dependencyStoreDetacher=e.ion({beforecommit:s.onDependencyStoreBeforeSync,thisObj:s,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){const s=this;return s.removeNonPersistableRecordsToCreate(e),s.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){const s=this;return s.removeNonPersistableRecordsToCreate(e),s.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){const s=this;return s.removeNonPersistableRecordsToCreate(e),s.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){const s=this;return s.removeNonPersistableRecordsToCreate(e),s.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){const s=e.added||[];let t,n;for(n=s.length-1;n>=0;--n)t=s[n],t.isPersistable||s.splice(s.indexOf(t),1);s.length===0&&(e.added.length=0)}shallContinueSync(e){return!!(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}};_g._$name="ModelPersistencyManager";var fy=hg,Zi=class extends $g(cc(fy)){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:Dn,dependencyModelClass:Cn,resourceModelClass:Ds,assignmentModelClass:Sn,eventStoreClass:Qi,dependencyStoreClass:oc,resourceStoreClass:ic,assignmentStoreClass:Gi}}construct(...e){super.construct(...e),Se.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new _g({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}};Zi.applyConfigs=!0,Zi.initClass(),Zi._$name="ProjectModel";var En=(e,s)=>{if(e!==s)throw new Error("Store set is prohibited for Scheduler Pro entity!")},tt=e=>class extends(e||$){static get $name(){return"PartOfProject"}get taskStore(){return this.eventStore}set taskStore(t){this.eventStore=t}get eventStore(){var t;return(t=this.project)==null?void 0:t.eventStore}get leftProjectEventStore(){const t=this.leftProject;return(t==null?void 0:t.getEventStore())||null}set eventStore(t){En(this.eventStore,t)}get dependencyStore(){var t;return(t=this.project)==null?void 0:t.dependencyStore}set dependencyStore(t){En(this.dependencyStore,t)}get assignmentStore(){var t;return(t=this.project)==null?void 0:t.assignmentStore}set assignmentStore(t){En(this.assignmentStore,t)}get resourceStore(){var t;return(t=this.project)==null?void 0:t.resourceStore}set resourceStore(t){En(this.resourceStore,t)}get calendarManagerStore(){var t;return(t=this.project)==null?void 0:t.calendarManagerStore}set calendarManagerStore(t){En(this.calendarManagerStore,t)}},zr=class extends tt(Jl(wi.derive(H))){get event(){const{project:e}=this,s=super.event;return e!=null&&e.isDelayingCalculation?e.eventStore.getById(s):s}set event(e){super.event=e}get resource(){const{project:e}=this;let s=super.resource;return e!=null&&e.isDelayingCalculation&&(s=e.resourceStore.getById(s)),s==null?void 0:s.$original}set resource(e){super.resource=e}get eventResourceKey(){return this.isInActiveTransaction?this.buildEventResourceKey(this.event,this.resource):this.buildEventResourceKey(this.$.event.DATA,this.$.resource.DATA)}};F(zr,"$name","AssignmentModel"),F(zr,"isProAssignmentModel",!0),zr._$name="AssignmentModel";var bn=class extends tt(Ql(sl.derive(We))){static get defaultConfig(){return{modelClass:zr}}};F(bn,"$name","AssignmentStore"),bn._$name="AssignmentStore";var Xi=class extends tt(Js.derive(H)){static get $name(){return"CalendarIntervalModel"}};Xi._$name="CalendarIntervalModel";var Rn=class extends tt(ds.derive(H)){static get $name(){return"CalendarModel"}static get fields(){return[{name:"expanded",internal:!0,defaultValue:!0},"ignoreTimeZone"]}toString(){return this.name||""}static get defaultConfig(){return{calendarIntervalModelClass:Xi}}};Rn._$name="CalendarModel";var ea=class extends tt(il.derive(We)){static get defaultConfig(){return{tree:!0,modelClass:Rn,loadPriority:100,syncPriority:100,storeId:"calendars"}}};ea._$name="CalendarManagerStore";var wn=class extends tt(ml.derive(St)){static get $name(){return"DependencyModel"}static get isProDependencyModel(){return!0}get fromEvent(){var e;return(e=this.project)!=null&&e.isDelayingCalculation?this.project.eventStore.getById(super.fromEvent):super.fromEvent}set fromEvent(e){super.fromEvent=e}get toEvent(){var e;return(e=this.project)!=null&&e.isDelayingCalculation?this.project.eventStore.getById(super.toEvent):super.toEvent}set toEvent(e){super.toEvent=e}};wn._$name="DependencyModel";var ta=class extends tt(ac(ol.derive(We))){static get defaultConfig(){return{modelClass:wn}}};ta._$name="DependencyStore";var ra=e=>class extends e{static get $name(){return"PercentDoneMixin"}get isStarted(){return this.percentDone>0}get isCompleted(){return this.percentDone>=100}get isInProgress(){return this.isStarted&&!this.isCompleted}copy(){const t=super.copy(...arguments);return t.percentDone=0,t.clearChanges(),t}get renderedPercentDone(){const t=typeof this.percentDone=="number"&&!isNaN(this.percentDone)?this.percentDone:0;return this.getFormattedPercentDone(t)}getFormattedPercentDone(t=0){return t<=99?Math.round(t):Math.floor(t)}set renderedPercentDone(t){this.percentDone=t}},sa=class extends Cl.derive(lt).mixin(Ji,ra){static get $name(){return"EventSegmentModel"}get task(){return this.event}};sa._$name="EventSegmentModel";var In=class extends Ti.derive(lt).mixin(zi,tt,Ji,ra){static get $name(){return"EventModel"}static get fields(){return[{name:"showInTimeline",type:"boolean",defaultValue:!1},"note",{name:"preamble",convert:e=>e?new xe(e):null},{name:"postamble",convert:e=>e?new xe(e):null}]}getDefaultSegmentModelClass(){return sa}updateWrapDate(e,s,t=!0){return s=new xe(s),new Date(e.getTime()+(t?1:-1)*s.milliseconds)}get startDate(){var e;let s;return this.isOccurrence?s=this.get("startDate"):s=(e=this._startDate)!=null?e:super.startDate,this.allDay&&(s=this.constructor.getAllDayStartDate(s)),s}set startDate(e){const s=this;if(s.generation&&s.isParent&&!s.$ignoreChange){const t=R.diff(s.startDate,e);if(t)for(const n of this.children)n.startDate=R.add(n.startDate,t)}s.batching?(s._startDate=e,s.set({startDate:e})):(super.startDate=e,s.preamble&&(s.wrapStartDate=null,s.wrapEndDate=null))}get endDate(){var e;let s;return this.isOccurrence?s=this.get("endDate"):s=(e=this._endDate)!=null?e:super.endDate,this.allDay&&(s=this.constructor.getAllDayEndDate(s)),s}set endDate(e){const s=this;s.batching?(s._endDate=e,s.set({endDate:e})):(super.endDate=e,s.postamble&&(s.wrapStartDate=null,s.wrapEndDate=null))}get fullEffort(){return new xe({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get wrapStartDate(){const e=this,{preamble:s,startDate:t}=e,n=e._wrapStartDate;let r;return n?r=n:s?(r=e.updateWrapDate(t,s,!1),e._wrapStartDate=r):r=t,r}set wrapStartDate(e){this._wrapStartDate=e}get wrapEndDate(){const e=this,{postamble:s,endDate:t}=e,n=e._wrapEndDate;let r;return n?r=n:s?(r=e.updateWrapDate(t,s,!0),e._wrapEndDate=r):r=t,r}set wrapEndDate(e){this._wrapEndDate=e}set(e){const s=typeof e=="object";return(e==="preamble"||s&&"preamble"in e)&&(this.wrapStartDate=null),(e==="postamble"||s&&"postamble"in e)&&(this.wrapEndDate=null),super.set(...arguments)}get outerStartDate(){return this.wrapStartDate}get outerEndDate(){return this.wrapEndDate}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":return!1;case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}get stm(){var e,s;return(s=(e=this.recurringEvent)==null?void 0:e.stm)!=null?s:super.stm}set stm(e){super.stm=e}get assigned(){const{project:e}=this,s=super.assigned;return e!=null&&e.isDelayingCalculation&&!s?e.assignmentStore.storage.findItem("event",this):s}set assigned(e){super.assigned=e}getCurrentConfig(e){const{segments:s}=this,t=super.getCurrentConfig(e);return t&&s&&(t.segments=s.map(n=>n.getCurrentConfig(e))),t}};F(In,"isProEventModel",!0),In._$name="EventModel";var na=class extends tt(rc(Hi(tc(Zl(tn.derive(We)))))){static get defaultConfig(){return{modelClass:In}}};F(na,"$name","EventStore"),na._$name="EventStore";var Pn=class extends tt(nc(_i.derive(vn))){static get $name(){return"ResourceModel"}get assigned(){var e,s;const{project:t}=this;return(e=t==null?void 0:t.assignmentStore.storage._indices)!=null&&e.resource?(s=t.assignmentStore.storage.findItem("resource",this))!=null?s:new Set:super.assigned}set assigned(e){super.assigned=e}};Pn._$name="ResourceModel";var ia=class extends tt(sc(cl.derive(We))){static get defaultConfig(){return{modelClass:Pn}}};ia._$name="ResourceStore";var uc=e=>class extends(e||$).mixin(Og){static get configurable(){return{crudLoadValidationWarningPrefix:"Project load response error(s):",crudSyncValidationWarningPrefix:"Project sync response error(s):",trackProjectModelChanges:!1}}construct(...t){const n=this;super.construct(...t),n.addPrioritizedStore(n.calendarManagerStore),n.addPrioritizedStore(n.assignmentStore),n.addPrioritizedStore(n.dependencyStore),n.addPrioritizedStore(n.resourceStore),n.addPrioritizedStore(n.eventStore),n.timeRangeStore&&n.addPrioritizedStore(n.timeRangeStore),n.resourceTimeRangeStore&&n.addPrioritizedStore(n.resourceTimeRangeStore)}get project(){return this}set project(t){super.project=t}get crudLoadValidationMandatoryStores(){return[this.getStoreDescriptor(this.eventStore).storeId]}loadCrudManagerData(...t){this.delayCalculation&&!this.isDelayingCalculation&&!this.usingSyncDataOnLoad()&&this.scheduleDelayedCalculation(),super.loadCrudManagerData(...t)}acceptChanges(){super.acceptChanges(),this.clearChanges(!0,!1)}revertChanges(){this.revertCrudStoreChanges(),this.set(this.meta.modified,void 0,!0)}crudStoreHasChanges(t){const n=this.getCrudStore(t);let r;return n?r=super.crudStoreHasChanges(n):r=this.hasPersistableChanges||super.crudStoreHasChanges(),r}get changes(){let t=super.changes;if(this.trackProjectModelChanges){const n=this.modificationDataToWrite;n&&(t=t||{},t.project=n)}return t}shouldClearRecordFieldChange(t,n,r){return t.isCalendarModel&&n==="intervals"?!t.get("intervals").changes:super.shouldClearRecordFieldChange(...arguments)}},dc=(e,s,t)=>{const n=t.getFieldDefinition(e),{dataSource:r}=n,i=t.constructor.processField(e,s[r],t);return r in s&&!n.isEqual(i,t.getValue(e))},hc=e=>class extends(e||$){startConfigure(t){this.getConfig("project"),super.startConfigure(t)}beforeApplyProjectChanges(){const{stm:t}=this;let n=!1,r=null;return this.suspendChangesTracking(),t.enabled&&(n=!0,t.isRecording&&(r=t.stash()),this.ignoreRemoteChangesInSTM?t.disable():t.startTransaction()),{shouldResume:n,transactionId:r}}async applyProjectChanges(t){var n,r;const i=this,{shouldResume:a,transactionId:o}=i.beforeApplyProjectChanges();i.trigger("startApplyChangeset"),i.applyingChangeset=!0,t.project&&i.applyProjectResponse(t.project),i.applyChangeset(x.clone(t),(l,c)=>{if(c.id==="tasks"||c.id==="events"){const{modelClass:u}=c,d=u.getFieldDataSource("startDate"),h=u.getFieldDataSource("endDate");if(l.updated)for(const f of l.updated){const g=c.getById(f[u.idField]);dc("constraintType",f,g)||dc("constraintDate",f,g)||(delete f[d],delete f[h])}}}),await i.commitAsync(),i.commitRespondedChanges();for(const l in t){const c=i.getStoreDescriptor(l);if(c){const{store:u}=c,d=t[l],h=[...(n=d.updated)!=null?n:[],...(r=d.added)!=null?r:[]];if(u)for(const f of h){const g=u.getById(f[u.modelClass.idField]);if(g)for(const p in g.modifications)dc(p,f,g)||delete g.meta.modified[p]}}}i.afterApplyProjectChanges(a,o),i.applyingChangeset=!1,await i.commitAsync(),i.trigger("endApplyChangeset")}afterApplyProjectChanges(t,n){if(t){const{stm:r}=this;this.ignoreRemoteChangesInSTM?r.enable():r.stopTransaction(),r.applyStash(n)}this.resumeChangesTracking()}},Fg=class extends Di{get type(){return"EventUpdateAction"}construct(e){let{model:s,newData:t,oldData:n}=e;if(t.segments&&n.segments){n={...n},t={...t};const r=n.segments.slice(),i=t.segments.slice();let a=!1;n.segments.forEach((o,l)=>{const c=t.segments.indexOf(o);c>-1&&(r[l]=i[c]=o,a=!0)}),a&&(n.segments=r,t.segments=i)}return super.construct({model:s,newData:t,oldData:n})}};Fg._$name="EventUpdateAction";var gy=(e,s,t)=>e.isSplitEventMixin?new Fg({model:e,newData:s,oldData:t}):new Di({model:e,newData:s,oldData:t}),fc=class extends kr{static get defaultConfig(){return{makeModelUpdateAction:gy}}};fc._$name="StateTrackingManager";var jg=class extends hc(uc(cc(Ml))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{calendarModelClass:Rn,dependencyModelClass:wn,eventModelClass:In,assignmentModelClass:zr,resourceModelClass:Pn,calendarManagerStoreClass:ea,dependencyStoreClass:ta,eventStoreClass:na,assignmentStoreClass:bn,resourceStoreClass:ia,calendarsData:null,supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/schedulerpro/docs/api/SchedulerPro/model/ProjectModel#config-supportShortSyncResponse)',delayCalculation:!0,calendarManagerStore:{},stmClass:fc}}static get configurable(){return{calendars:null}}get taskStore(){return this.eventStore}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}};jg._$name="ProjectModel";var aa=class extends zr{static get fields(){return[{name:"event",persist:!0,serialize:e=>e==null?void 0:e.id,isEqual:ar},{name:"resource",persist:!0,serialize:e=>e==null?void 0:e.id,isEqual:ar},"eventId","resourceId"]}};aa._$name="AssignmentModel";var gc=class extends bn{static get defaultConfig(){return{modelClass:aa,loadPriority:500,syncPriority:400}}};gc._$name="AssignmentStore";var oa=class extends Rn{};oa._$name="CalendarModel";var pc=class extends ea{static get defaultConfig(){return{modelClass:oa}}};pc._$name="CalendarManagerStore";var la=class extends wn{constructor(...e){const[s]=e;s!=null&&s.fromTask&&(s.fromEvent=s.fromTask),s!=null&&s.toTask&&(s.toEvent=s.toTask),super(...e)}get from(){var e;return(e=this.fromEvent)==null?void 0:e.id}set from(e){super.from=e}get fromTask(){return this.fromEvent}set fromTask(e){this.fromEvent=e}get to(){var e;return(e=this.toEvent)==null?void 0:e.id}set to(e){super.to=e}get toTask(){return this.toEvent}set toTask(e){this.toEvent=e}get persistableData(){const e=super.persistableData,{fromTask:s,toTask:t}=e;return s&&(e.fromTask=s.id),t&&(e.toTask=t.id),e}shouldRecordFieldChange(e,s,t){return e==="from"||e==="to"?!1:super.shouldRecordFieldChange(e,s,t)}};la._$name="DependencyModel";var mc=class extends ta{static get defaultConfig(){return{modelClass:la,loadPriority:300,syncPriority:500}}};mc._$name="DependencyStore";var ca=class extends Pn{};ca._$name="ResourceModel";var vc=class extends ia{static get defaultConfig(){return{modelClass:ca,loadPriority:400,syncPriority:200}}};vc._$name="ResourceStore";var ua=class extends lt{constructor(){super(...arguments),F(this,"isBaseline",!0)}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:s}=this;if(e&&s)return s.getTime()===e.getTime()}return this.duration===0}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}normalize(){const e=this,{task:s,startDate:t,endDate:n,duration:r}=e,i=r!=null;s.graph?t&&n&&!i?e.setData("duration",s.run("calculateProjectedDuration",t,n)):t&&!n&&i?e.setData("endDate",s.run("calculateProjectedXDateWithDuration",t,!0,r)):!t&&n&&i&&e.setData("startDate",s.run("calculateProjectedXDateWithDuration",n,!1,r)):super.normalize()}get startVariance(){const{task:e}=this,s=R.getDurationInUnit(this.startDate,e.startDate,e.durationUnit);return new xe({magnitude:s,unit:e.durationUnit})}get endVariance(){const{task:e}=this,s=R.getDurationInUnit(this.endDate,e.endDate,e.durationUnit);return new xe({magnitude:s,unit:e.durationUnit})}get durationVariance(){return this.fullDuration&&this.task.fullDuration.diff(this.fullDuration)}};F(ua,"fields",[{name:"task",persist:!1}]),ua._$name="Baseline";var da=class extends it{static get type(){return"wbs"}convert(e){return De.from(e)}serialize(e){return String(e)}};da.prototype.compare=De.compare,da.initClass(),da._$name="WbsField";var yc=(e,s)=>{const{startDate:t,durationUnit:n,endDate:r}=e;return s?s.map(i=>{const a=+("startDate"in i)+("endDate"in i)+("duration"in i)>1,o={task:e,...i};return a||Object.assign(o,{startDate:t,endDate:r,durationUnit:n}),o}):[]},py=e=>e.field==="wbsValue"&&!e.ascending,my=e=>{for(let s,t,n=0,r=e.length;n<r;++n)if(t=e[n].wbsValue,t){if(s)return t<s;s=t}return!1},vy={deep:!0},yy={deep:!0,silent:!0},Cs=class extends Ol.derive(lt).mixin(tt,ra){constructor(){super(...arguments),F(this,"$manuallyScheduled",null)}static get fields(){return[{name:"cls",serialize:e=>e.isDomClassList?e.toString():e,persist:!0},{name:"fullEffort",persist:!1},{name:"baselines",type:"store",modelClass:ua,storeClass:K,lazy:!0},{name:"note",type:"string"},"parentId",{name:"children",persist:!1},{name:"showInTimeline",type:"boolean"},{name:"rollup",type:"boolean"},{name:"wbsValue",type:"wbs",persist:!1},{name:"deadlineDate",type:"date"},{name:"parentIndex",type:"number",persist:!0},"iconCls","taskIconCls",{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0},"eventColor"]}getDefaultSegmentModelClass(){return sa}endBatch(){const{isPersistable:e}=this;super.endBatch(...arguments),this.isPersistable&&!e&&this.assignments.forEach(s=>{s.stores.forEach(t=>{t.updateModifiedBagForRecord(s)})})}get isTask(){return!0}get isTaskModel(){return!0}get isEvent(){return!0}get wbsCode(){return String(this.wbsValue)}set wbsCode(e){this.wbsValue=De.from(e)}copy(...e){const s=super.copy(...e);return s.setData("wbsValue",null),s}processBaselinesStoreData(e){return yc(this,e)}set baselines(e){this.set({baselines:e})}get baselines(){const e=this;return e.$initializedBaselines||(e.fieldMap.baselines.init(e.data,e),e.assignInitables(),e.$initializedBaselines=!0),e.meta.baselinesStore}get hasBaselines(){var e,s;const t=this.fieldMap.baselines;return!!((s=(e=this.baselines)==null?void 0:e.count)!=null?s:this.originalData[t.dataSource])}setBaseline(e){if(e<=0)return;const{baselines:s}=this,t=e-s.count;t>0?s.add(yc(this,new Array(t).fill({}))):s.getAt(e-1).set(yc(this,[{}])[0])}get successors(){return Array.from(this.outgoingDeps||[])}set successors(e){this.outgoingDeps=e}setSuccessors(e){return this.replaceDependencies(e,!0)}replaceDependencies(e,s){const t=this,{dependencyStore:n}=t.project,r=new Set,i=new Set,a=[],o=s?t.outgoingDeps:t.incomingDeps,l=Array.from(o);return e.forEach(c=>{const u=l.find(s?d=>d.toEvent===c.toEvent:d=>d.fromEvent===c.fromEvent);u?(r.add(u),u.copyData(c)):i.add(c)}),o.forEach(c=>{r.has(c)||a.push(c)}),a.forEach(c=>n.remove(c)),i.forEach(c=>{s?c.fromEvent=t:c.toEvent=t,n.add(c)}),t.commitAsync()}get predecessors(){return Array.from(this.incomingDeps||[])}set predecessors(e){this.incomingDeps=e}setPredecessors(e){return this.replaceDependencies(e,!1)}get assignments(){return super.assignments}set assignments(e){const s=this,{assignmentStore:t}=s.project,n=[],r=s.assignments,i=r.filter(a=>!(e!=null&&e.find(o=>o.resource===a.resource)));e.forEach(a=>{const o=t.getAssignmentForEventAndResource(this,a.resource);o?o.copyData(a):(a.remove(),n.push(a))}),t.remove(i),t.add(n)}get assigned(){var e;const{project:s}=this;return s!=null&&s.isDelayingCalculation?(e=s.assignmentStore.storage.findItem("event",this))!=null?e:new Set:super.assigned}set assigned(e){super.assigned=e}get isDraggable(){return this.draggable}get isResizable(){return this.resizable&&!this.milestone&&this.isEditable("endDate")}get isMilestone(){return this.milestone}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":case"lateStartDate":case"lateEndDate":case"totalSlack":return!1;case"effort":case"fullEffort":case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}isFieldModified(e){return e==="fullEffort"?super.isFieldModified("effort")||super.isFieldModified("effortUnit"):super.isFieldModified(e)}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:s}=this;if(e&&s)return s.getTime()===e.getTime()}return this.duration===0}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}get allDependencies(){return this.dependencies}get dependencies(){var e;return(e=this.project)!=null&&e.isDelayingCalculation?[]:[...this.incomingDeps||[],...this.outgoingDeps||[]]}set dependencies(e){const s=this,t=[],n=[];e==null||e.forEach(r=>{r.fromEvent===s||r.fromEvent===s.id?n.push(r):(r.toEvent===s||r.toEvent===s.id)&&t.push(r)}),s.setPredecessors(t),s.setSuccessors(n)}get predecessorTasks(){return[...this.incomingDeps||[]].map(e=>e.fromEvent)}get successorTasks(){return[...this.outgoingDeps||[]].map(e=>e.toEvent)}get previousSiblingsTotalCount(){let e=this.previousSibling,s=this.parentIndex;for(;e;)s+=e.descendantCount,e=e.previousSibling;return s}get sequenceNumber(){if(this.taskStore)return this.taskStore.allIndexOf(this)+1;let e=0,s=this;for(;s.parent;)e+=s.previousSiblingsTotalCount+1,s=s.parent;return e}get isSubProject(){return!1}get subProject(){const e=this;let s=null;return e.isProject?s=e:e.bubbleWhile(t=>(t.isProject&&(s=t),!s)),s}get fullEffort(){return new xe({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get resources(){return this.assignments.reduce((e,s)=>(s.resource&&e.push(s.resource),e),[])}get $linkedResources(){var e,s;return(s=(e=this.resources)==null?void 0:e.flatMap(t=>[t,...t.$links]))!=null?s:[]}normalize(){}inSetNormalize(e){}joinStore(e){var s,t;const n=this,r=(n.firstStore||e).useOrderedTreeForWbs;!n.wbsValue&&!n.generatedParent&&((n.taskStore||e).isLoadingData||!((s=n.nextSibling)!=null&&s.wbsValue||(t=n.previousSibling)!=null&&t.wbsValue)?n.refreshWbs({useOrderedTree:r,...yy}):n.parent.refreshWbs(vy,-1)),super.joinStore(e)}refreshWbs(e,s){var t,n,r,i,a,o;const l=this,{parent:c}=l,u=l.firstStore||null,{useOrderedTree:d=(t=u==null?void 0:u.useOrderedTreeForWbs)!=null?t:!1}=e||{};if(c&&s!==-1&&l.fieldMap.wbsValue){d?s=l.orderedParentIndex:s=(n=s!=null?s:l.unfilteredIndex)!=null?n:l.parentIndex,s++;const h=c.isRoot?new De(s):c.wbsValue.append(s);e!=null&&e.silent?l.setData("wbsValue",h):l.set("wbsValue",h)}if((r=e==null?void 0:e.deep)==null||r)if(d)for(const h of(i=l.orderedChildren)!=null?i:[])h.refreshWbs(e);else{const h=(a=l.unfilteredChildren)!=null?a:l.children,f=(h==null?void 0:h.length)||0;if(f){const g=my(h)&&((o=u==null?void 0:u.sorters)==null?void 0:o.findIndex(py))===0;for(let p=0;p<f;++p)h[p].refreshWbs(e,g?f-p-1:p)}}}async tryInsertChild(){return this.getProject().tryPropagateWithChanges(()=>{this.insertChild(...arguments)})}updateDependencies(e,s){this.outgoingDeps.forEach(t=>{if(t.toEvent.isScheduled){const{type:n,calendar:r,toEvent:i}=t;e&&(n===St.Type.StartToStart?t.setLag(R.as("hour",r.calculateDurationMs(e,i.startDate,!0)),"hour"):n===St.Type.StartToEnd&&t.setLag(R.as("hour",r.calculateDurationMs(e,i.endDate,!0)),"hour")),s&&(n===St.Type.EndToStart?t.setLag(R.as("hour",r.calculateDurationMs(s,i.startDate,!0)),"hour"):n===St.Type.EndToEnd&&t.setLag(R.as("hour",r.calculateDurationMs(s,i.endDate,!0)),"hour"))}})}async moveTaskPinningSuccessors(e){const s=this;return s.startDate=e,s.bubble(t=>{if(!t.isRoot){const n=t.run("calculateStartDate"),r=t.run("calculateEndDate");t.updateDependencies(n,r)}}),s.project.commitAsync()}async setStartDatePinningSuccessors(e){const s=this,t=s.setStartDate(e,!1);return s.bubble(n=>{if(!n.isRoot){const r=n.run("calculateStartDate");n.updateDependencies(r,null)}}),t}async setEndDatePinningSuccessors(e){const s=this;return s.endDate=e,s.bubble(t=>{if(!t.isRoot){const n=t.run("calculateEndDate");t.updateDependencies(null,n)}}),s.project.commitAsync()}getCurrentConfig(e){const{segments:s}=this,t=super.getCurrentConfig(e);return t&&s&&(t.segments=s.map(n=>n.getCurrentConfig(e))),t}};Cs.convertEmptyParentToLeaf=!0,Cs._$name="TaskModel";var Mn={deep:!0},kg=Object.freeze({add:!0,remove:!0,sort:!0}),Sy=Object.freeze({add:!1,remove:!1,sort:!1}),Sc=(e,s)=>De.compare(e==null?void 0:e.wbsCode,s==null?void 0:s.wbsCode),xn=class extends Ho.derive(We).mixin(tt,tc,Hi){static get defaultConfig(){return{modelClass:Cs,loadPriority:200,syncPriority:300,storeId:"tasks",tree:!0}}static get configurable(){return{wbsMode:"manual",useOrderedTreeForWbs:!1,outdentIgnoringSiblings:!1,forceWbsOrderForChanges:!1}}changeWbsMode(e){return e==="auto"?kg:e&&typeof e=="object"?(x.values(e).every(s=>!s)&&(e=x.assign({},kg,e)),e):Sy}setBaseline(e){const s=this.storage.values;this.forEach(t=>t.setBaseline(e)),this.trigger("refresh",{action:"batch",records:s,data:s})}async indent(e){const s=this,{taskStore:t,project:n}=s;let r=!1;if(e=Array.isArray(e)?e.slice():[e],e=e.filter(i=>!i.isProjectModel),e=e.filter(i=>{let a;for(a=!!i.previousSibling;a&&!i.isRoot;)a=!e.includes(i.parent),i=i.parent;return a}),e.length&&t.trigger("beforeIndent",{records:e})!==!1){if(e.sort((i,a)=>De.compare(i.wbsCode,a.wbsCode)),t.beginBatch(),r=await n.tryPropagateWithChanges(()=>{for(const i of e){const a=i.previousSibling;a.appendChild(i),s.toggleCollapse(a,!1)}}),s.isDestroyed)return;t.endBatch(),r&&(s.refreshWbsForChildren({up:2,nodes:e}),s.trigger("indent",{records:e}),s.trigger("change",{action:"indent",records:e}))}return r}async outdent(e){const s=this,{taskStore:t,project:n}=s;let r=!1;if(e=Array.isArray(e)?e.slice():[e],e=e.filter(i=>!i.isProjectModel),e=e.filter(i=>{let a;for(a=i.parent&&!i.parent.isRoot;a&&!i.isRoot;)a=!e.includes(i.parent),i=i.parent;return a}),e.length&&t.trigger("beforeOutdent",{records:e})!==!1){if(e.sort((i,a)=>De.compare(a.wbsCode,i.wbsCode)),t.beginBatch(),r=await n.tryPropagateWithChanges(()=>{for(const i of e){const a=!this.outdentIgnoringSiblings&&i.parent.children.slice(i.parent.children.indexOf(i)+1);i.parent.parent.insertChild(i,i.parent.nextSibling,!1,{orderedBeforeNode:i.parent.nextOrderedSibling}),a.length&&i.appendChild(a),s.toggleCollapse(i,!1)}}),s.isDestroyed)return;t.endBatch(),r&&(s.refreshWbsForChildren({up:1,nodes:e}),s.trigger("outdent",{records:e}),s.trigger("change",{action:"outdent",records:e}))}return r}onNodeAddChild(e,s,t,n,r=!1){if(super.onNodeAddChild(e,s,t,n,r),!this.isLoadingData&&this.wbsMode.add){e.refreshWbs(Mn);const i=new Set;s.forEach(a=>{const o=this.getById(a.meta.oldParentId);o&&e!==o&&!i.has(o)&&(i.add(o),o.refreshWbs(Mn,-1))})}}onNodeRemoveChild(e,s,t,n={isMove:!1,silent:!1,unfiltered:!1}){const r=super.onNodeRemoveChild(e,s,t,n);return this.wbsMode.remove&&!n.isMove&&e.refreshWbs(Mn),r}applyChangeset(e,s=null,...t){var n,r,i;const a=this,{updated:o,modified:l}=(n=s==null?void 0:s(e,a))!=null?n:e,c=(r=o!=null?o:l)!=null?r:[],u=a.forceWbsOrderForChanges&&a.tree&&!a.isSorted&&!a.isGrouped?c.reduce((h,{id:f,parentId:g})=>{var p,m;if(g!==void 0){const y=a.getById(f),D=(p=y==null?void 0:y.parent)==null?void 0:p.parentId;g===D&&h.push({node:y,originalNodeAbove:(m=y.previousSibling)!=null?m:y.parent})}return h},[]):[],d=super.applyChangeset(e,s,...t);if(u.length>0)for(const{node:h,originalNodeAbove:f}of u){const{parent:g}=h,p=f.parent===g?f.parentIndex:((i=f.parent)==null?void 0:i.parent)===g?f.parent.parentIndex:void 0;p!==void 0&&g.children.includes(h)&&g.insertChild(h,p+1)}return d}afterChangesetApplied(e){super.afterChangesetApplied(e),e.forEach(s=>{s.refreshWbs({deep:!0,useOrderedTree:!0})})}afterPerformSort(e){this.wbsMode.sort&&this.rootNode.refreshWbs(Mn),super.afterPerformSort(e)}refreshWbsForChildren(e){const s=e.nodes,t={...Mn,...e},n=new Set,r=t.up||0;let i,a;s.forEach(o=>{for(a=o,i=r;a&&i;--i)a=a.parent;n.add(a)});for(a of n)a.refreshWbs(t)}getTotalTimeSpan(){return{startDate:this.getProject().startDate,endDate:this.getProject().endDate}}getEventsForResource(e){const s=this.resourceStore.getById(e),t=(s==null?void 0:s.assignments.filter(r=>r.isPartOfStore(this.assignmentStore)))||[],n=[];return t.forEach(({event:r})=>r&&n.push(r)),n}isDateRangeAvailable(e,s,t,n){const r=new Set(this.getEventsForResource(n));if(t!=null&&t.isAssignment&&t.event.resources.forEach(o=>{o.id!==t.resourceId&&this.getEventsForResource(o).forEach(l=>r.add(l))}),t){const i=t.isAssignment?t.event:t;r.delete(i)}return!Array.from(r).some(i=>i.isScheduled&&R.intersectSpans(e,s,i.startDate,i.endDate))}linkTasks(e){for(let s=1;s<e.length;s++){const t=e[s-1],n=e[s];this.dependencyStore.getEventsLinkingDependency(t,n)||this.dependencyStore.add({from:t,to:n})}}unlinkTasks(e){this.dependencyStore.remove(this.dependencyStore.query(({fromTask:s,toTask:t})=>e.includes(s)||e.includes(t)))}get changes(){const e=super.changes;return e&&this.forceWbsOrderForChanges&&(e.added.sort(Sc),e.modified.sort(Sc),e.removed.sort(Sc)),e}};F(xn,"$name","TaskStore"),xn._$name="TaskStore";var Lg=class extends Xi{};Lg._$name="CalendarIntervalModel";var ha=class extends ng.derive(H).mixin(hc,$g,uc,lc,Ag){static get defaults(){return{expanded:!0}}static get defaultConfig(){return{projectConstraintIntervalClass:ji,dateConstraintIntervalClass:an,dependencyConstraintIntervalClass:gs,taskModelClass:Cs,dependencyModelClass:la,resourceModelClass:ca,assignmentModelClass:aa,calendarModelClass:oa,taskStoreClass:xn,dependencyStoreClass:mc,resourceStoreClass:vc,assignmentStoreClass:gc,calendarManagerStoreClass:pc,tasksData:null,eventsData:null,dependenciesData:null,resourcesData:null,assignmentsData:null,calendarsData:null,timeRangeStore:{modelClass:lt,storeId:"timeRanges"},convertEmptyParentToLeaf:!1,supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/gantt/docs/api/Gantt/model/ProjectModel#config-supportShortSyncResponse)',delayCalculation:!0,eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},stmClass:fc}}static get configurable(){return{tasks:null,resources:null,assignments:null,dependencies:null,timeRanges:null,calendars:null,timeRangesData:null,syncDataOnLoad:null,ignoreRemoteChangesInSTM:!1}}construct(...e){const s=e[0]||{};e[0]=s,"tasksData"in s&&(s.eventsData=s.tasksData,delete s.tasksData),"taskStore"in s&&(s.eventStore=s.taskStore,delete s.taskStore),s.eventModelClass=s.taskModelClass||s.eventModelClass||this.getDefaultConfiguration().taskModelClass||this.defaultEventModelClass,s.eventStoreClass=s.taskStoreClass||s.eventStoreClass||this.getDefaultConfiguration().taskStoreClass||this.defaultEventStoreClass,super.construct(...e)}attachStore(e){this.syncDataOnLoad&&(e.syncDataOnLoad=this.syncDataOnLoad),e.ion({name:e.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(e)}detachStore(e){e&&this.detachListeners(e.$$name),super.detachStore(e)}relayStoreChange(e){return super.relayStoreChange(e),this.trigger("change",{store:e.source,...e,source:this})}get defaultEventModelClass(){return Cs}get defaultEventStoreClass(){return xn}set taskStore(e){this.eventStore=e}get taskStore(){return this.eventStore}get timeRangeStore(){return this._timeRangeStore}set timeRangeStore(e){const s=this;s.detachStore(s._timeRangeStore),s._timeRangeStore=K.getStore(e,K),s._timeRangeStore.storeId||(s._timeRangeStore.storeId="timeRanges"),s.attachStore(s._timeRangeStore)}async tryInsertChild(){return this.tryPropagateWithChanges(()=>{this.insertChild(...arguments)})}toJSON(){return{eventsData:this.eventStore.toJSON(),resourcesData:this.resourceStore.toJSON(),dependenciesData:this.dependencyStore.toJSON(),assignmentsData:this.assignmentStore.toJSON()}}get json(){return super.json}set json(e){typeof e=="string"&&(e=U.safeJsonParse(e)),this.loadInlineData(e)}get tasks(){return this.taskStore.allRecords}updateTasks(e){this.taskStore.data=e}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}updateTimeRangesData(e){this.timeRangeStore.data=e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}afterChange(e,s){super.afterChange(...arguments),s.calendar&&this.trigger("calendarChange")}refreshWbs(e){var s,t;const n=this,r=(s=n.unfilteredChildren)!=null?s:n.children;r!=null&&r.length&&((t=r[0].refreshWbs)==null||t.call(n,e,-1))}};F(ha,"$name","ProjectModel"),ha.applyConfigs=!0,ha._$name="ProjectModel";export{rl as AbstractAssignmentStoreMixin,nl as AbstractCalendarManagerStoreMixin,Fo as AbstractCalendarMixin,Sg as AbstractCrudManager,Nl as AbstractCrudManagerMixin,mg as AbstractCrudManagerValidation,al as AbstractDependencyStoreMixin,Go as AbstractEventStoreMixin,Wo as AbstractHasAssignmentsMixin,Ws as AbstractPartOfProjectGenericMixin,ls as AbstractPartOfProjectModelMixin,mt as AbstractPartOfProjectStoreMixin,ll as AbstractResourceStoreMixin,Ht as ActionBase,We as AjaxStore,Dg as AjaxTransport,Vf as AssignmentAllocationInterval,aa as AssignmentModel,Jl as AssignmentModelMixin,gc as AssignmentStore,Ql as AssignmentStoreMixin,$ as Base,Ai as BaseAllocationInfo,Oi as BaseAllocationInterval,Ci as BaseAssignmentMixin,ds as BaseCalendarMixin,ul as BaseDependencyMixin,fl as BaseDependencyResolution,ko as BaseEmptyCalendarEffectResolution,or as BaseEventMixin,zo as BaseHasAssignmentsMixin,Ei as BaseResourceMixin,ua as Baseline,Gr as BreakCurrentStackExecution,Me as CI,vo as CIFromSetOrArrayOrValue,Be as CalculateProposed,Mt as CalculatedValueGen,ka as CalculatedValueGenC,Xr as CalculatedValueSync,ja as CalculatedValueSyncC,Wc as CalculationGen,zc as CalculationSync,$o as CalendarCache,ui as CalendarCacheInterval,Vo as CalendarCacheIntervalMultiple,Uo as CalendarCacheMultiple,hh as CalendarCacheSingle,Js as CalendarIntervalMixin,Lg as CalendarIntervalModel,Ao as CalendarIntervalStore,Ve as CalendarIteratorResult,pc as CalendarManagerStore,oa as CalendarModel,Dh as CanCombineCalendarsMixin,Ll as ChangeLogEntity,mf as ChronoAbstractProjectMixin,sl as ChronoAssignmentStoreMixin,il as ChronoCalendarManagerStoreMixin,ol as ChronoDependencyStoreMixin,tn as ChronoEventStoreMixin,Ho as ChronoEventTreeStoreMixin,es as ChronoField,Zc as ChronoGraph,de as ChronoMixinBase,is as ChronoModelFieldIdentifier,ni as ChronoModelMixin,ei as ChronoModelReferenceBucketFieldIdentifier,Ns as ChronoModelReferenceFieldIdentifier,ad as ChronoModelReferenceFieldQuark,bo as ChronoPartOfProjectGenericMixin,cs as ChronoPartOfProjectModelMixin,_r as ChronoPartOfProjectStoreMixin,cl as ChronoResourceStoreMixin,ih as ChronoStoreMixin,La as ChronoTransaction,os as Collection,ke as CollectionFilter,Hs as CollectionSorter,Wn as CommitZero,Un as ComputationCycle,cr as ConflictEffect,bh as ConflictEffectDescription,pi as ConflictResolution,Ko as ConflictSymbol,zf as ConstrainedByParentMixin,Lr as ConstrainedEarlyEventMixin,Fi as ConstrainedLateEventMixin,ur as ConstraintInterval,hs as ConstraintIntervalDescription,ce as ConstraintIntervalSide,B as ConstraintType,gp as ContextGen,fp as ContextSync,Ni as CoreAssignmentMixin,$l as CoreAssignmentStoreMixin,og as CoreCalendarManagerStoreMixin,_l as CoreCalendarMixin,Bi as CoreDependencyMixin,Fl as CoreDependencyStoreMixin,Kt as CoreEventMixin,jl as CoreEventStoreMixin,cg as CoreHasAssignmentsMixin,ug as CoreHasDependenciesMixin,ki as CorePartOfProjectGenericMixin,vs as CorePartOfProjectModelMixin,Ss as CorePartOfProjectStoreMixin,ys as CoreResourceMixin,kl as CoreResourceStoreMixin,kr as CoreStateTrackingManager,Xt as CycleDescription,jr as CycleEffect,Ph as CycleEffectDescription,Fe as CycleResolution,za as CycleResolutionInput,vh as CycleResolutionInputChrono,Qo as CycleSymbol,it as DataField,an as DateConstraintInterval,Ef as DateConstraintIntervalDescription,gi as DateInterval,Uf as DeactivateDependencyCycleEffectResolution,pl as DeactivateDependencyResolution,Ar as Delayable,dg as DelayableWrapper,Mr as DependenciesCalendar,St as DependencyBaseModel,gs as DependencyConstraintInterval,bf as DependencyConstraintIntervalDescription,la as DependencyModel,mc as DependencyStore,ac as DependencyStoreMixin,_e as DependencyType,Pr as DependencyValidationResult,L as Direction,qf as DisableManuallyScheduledConflictResolution,Ue as DomClassList,gg as DomDataStore,xe as Duration,ff as DurationConverterMixin,te as DurationVar,Eh as EMPTY_INTERVAL,Ee as EarlyLateLazyness,At as EdgeInclusion,Jr as EdgeType,Os as EdgeTypeNormal,wr as EdgeTypePast,ye as Effect,bt as EffectResolutionResult,Ie as EffortVar,en as EmptyCalendarEffect,gh as EmptyCalendarEffectDescription,jo as EmptyCalendarSymbol,Q as EndDateVar,wh as EngineReplica,Zo as EngineRevision,Rh as EngineTransaction,xt as Entity,eu as EntityIdentifier,Xc as EntityMeta,In as EventModel,Ji as EventModelMixin,sa as EventSegmentModel,na as EventStore,Zl as EventStoreMixin,Vt as Events,ut as FieldIdentifier,Lf as FixedDurationMixin,Kf as FixedEffortMixin,eg as FixedUnitsMixin,fe as Formula,zn as FormulasCache,Ol as GanttEvent,ng as GanttProjectMixin,Hi as GetEventsMixin,tp as GetTransaction,vn as GridRowModel,hi as HasCalendarMixin,Gt as HasChildrenMixin,sg as HasCriticalPathsMixin,dl as HasDateConstraintMixin,qo as HasDependenciesMixin,xi as HasEffortMixin,vl as HasPercentDoneMixin,_c as HasProposedNotPreviousValue,$c as HasProposedNotPreviousValueEffect,Pa as HasProposedNotPreviousValueSymbol,ct as HasProposedValue,Ac as HasProposedValueEffect,Ia as HasProposedValueSymbol,dn as HasSchedulingModeMixin,mi as HasSubEventsMixin,rt as Identifier,vp as IdentifierC,Fr as IndexPosition,Ke as Instruction,_o as IntervalCache,Xn as IsChronoModelSymbol,Cg as JsonEncoder,Pt as Levels,Qc as Listener,ae as MAX_DATE,Ic as MI,he as MIN_DATE,gn as ManuallyScheduledParentConstraintInterval,Gf as ManuallyScheduledParentConstraintIntervalDescription,xs as Meta,ld as MinimalChronoModelFieldIdentifierGen,od as MinimalChronoModelFieldIdentifierSync,cd as MinimalChronoModelFieldVariable,tu as MinimalEntityIdentifier,Ba as MinimalFieldIdentifierGen,As as MinimalFieldIdentifierSync,Va as MinimalFieldVariable,id as MinimalReferenceBucketIdentifier,nd as MinimalReferenceBucketQuark,ed as MinimalReferenceIdentifier,H as Model,Or as ModelBucketField,Zn as ModelField,Dd as ModelLink,Tr as ModelReferenceField,vd as ModelStm,Kr as NOT_VISITED,It as OnCycleAction,sp as OwnIdentifier,Sa as OwnIdentifierSymbol,rp as OwnQuark,ya as OwnQuarkSymbol,tt as PartOfProject,ra as PercentDoneMixin,Fn as PreviousValueOf,xc as PreviousValueOfEffect,Ra as PreviousValueOfSymbol,hc as ProjectChangeHandlerMixin,ji as ProjectConstraintInterval,ig as ProjectConstraintIntervalDescription,uc as ProjectCrudManager,ha as ProjectModel,cc as ProjectModelMixin,lc as ProjectModelTimeZoneMixin,ts as ProjectType,Er as ProposedArgumentsOf,jc as ProposedArgumentsOfEffect,xa as ProposedArgumentsOfSymbol,X as ProposedOrPrevious,ma as ProposedOrPreviousSymbol,pe as ProposedOrPreviousValueOf,Fc as ProposedOrPreviousValueOfEffect,Ma as ProposedOrPreviousValueOfSymbol,Oc as ProposedValueOf,Tc as ProposedValueOfEffect,wa as ProposedValueOfSymbol,Bn as Quark,Yc as QuarkGen,Zr as QuarkSync,Lt as ReadMode,Yl as RecurrenceModel,rc as RecurringEventsMixin,zi as RecurringTimeSpan,Kl as RecurringTimeSpansMixin,po as ReferenceBucketField,mo as ReferenceBucketIdentifier,sd as ReferenceBucketQuark,fo as ReferenceField,go as ReferenceIdentifier,kt as Reject,Hr as RejectEffect,ws as RejectSymbol,Cf as RemoveDateConstraintConflictResolution,Ih as RemoveDependencyCycleEffectResolution,gl as RemoveDependencyResolution,Na as Replica,Il as ResourceAllocationEventRangeCalendar,Nf as ResourceAllocationEventRangeCalendarIntervalMixin,Bf as ResourceAllocationEventRangeCalendarIntervalStore,$i as ResourceAllocationInfo,Pl as ResourceAllocationInterval,ca as ResourceModel,nc as ResourceModelMixin,vc as ResourceStore,sc as ResourceStoreMixin,Sr as ResourceTimeRangeModel,qi as ResourceTimeRangeStore,Vn as Revision,Sh as SEDBackwardCycleResolutionContext,No as SEDDispatcher,Bo as SEDDispatcherIdentifier,yh as SEDForwardCycleResolutionContext,Lo as SEDGraphDescription,Af as SEDWUDispatcher,$f as SEDWUDispatcherIdentifier,hl as ScheduledByDependenciesEarlyEventMixin,xl as ScheduledByDependenciesLateEventMixin,Sn as SchedulerAssignmentModel,Gi as SchedulerAssignmentStore,fi as SchedulerBasicEvent,yf as SchedulerBasicProjectMixin,Vi as SchedulerCoreEvent,hg as SchedulerCoreProjectMixin,Cn as SchedulerDependencyModel,oc as SchedulerDependencyStore,Dn as SchedulerEventModel,Qi as SchedulerEventStore,Jt as SchedulerPartOfProject,wi as SchedulerProAssignmentMixin,zr as SchedulerProAssignmentModel,bn as SchedulerProAssignmentStore,Xi as SchedulerProCalendarIntervalModel,ea as SchedulerProCalendarManagerStore,Rn as SchedulerProCalendarModel,fn as SchedulerProCycleEffect,ml as SchedulerProDependencyMixin,wn as SchedulerProDependencyModel,ta as SchedulerProDependencyStore,Ti as SchedulerProEvent,Pi as SchedulerProHasAssignmentsMixin,Ml as SchedulerProProjectMixin,jg as SchedulerProProjectModel,_i as SchedulerProResourceMixin,Pn as SchedulerProResourceModel,ia as SchedulerProResourceStore,Og as SchedulerProjectCrudManager,Zi as SchedulerProjectModel,Ds as SchedulerResourceModel,ic as SchedulerResourceStore,Bs as SchedulingIssueEffectResolution,me as SchedulingMode,xh as Schema,oh as SortedMap,J as StartDateVar,dr as StateBase,kr as StateTrackingManager,K as Store,Wd as StoreCRUD,Xd as StoreChained,zd as StoreChanges,qd as StoreFilter,Gd as StoreGroup,Hd as StoreRelation,Jd as StoreSearch,Qd as StoreSort,eh as StoreState,nh as StoreStm,Yd as StoreSum,rh as StoreSync,th as StoreTree,Nn as SynchronousCalculationStarted,Cs as TaskModel,xn as TaskStore,lt as TimeSpan,V as TimeUnit,Eg as TimeZonedDatesMixin,ee as TombStone,yi as Transaction,Kc as TransactionCycleDetectionWalkContext,va as TransactionSymbol,Jc as TransactionWalkDepth,yd as TreeNode,Pe as UnitsVar,np as UnsafePreviousValueOf,Lc as UnsafePreviousValueOfEffect,Oa as UnsafePreviousValueOfSymbol,br as UnsafeProposedOrPreviousValueOf,kc as UnsafeProposedOrPreviousValueOfEffect,Ta as UnsafeProposedOrPreviousValueOfSymbol,fh as UnspecifiedTimeIntervalModel,ph as Use24hrsEmptyCalendarEffectResolution,mh as Use8hrsEmptyCalendarEffectResolution,Rr as VISITED_TOPOLOGICALLY,Ts as Variable,Fa as VariableC,Tt as VariableInputState,ou as VariableWalkContext,_a as WalkContext,Gc as WalkSource,qa as WalkState,De as Wbs,da as WbsField,Pc as Write,Ca as WriteEffect,Mc as WriteSeveral,ba as WriteSeveralEffect,Ea as WriteSeveralSymbol,Da as WriteSymbol,Qs as binarySearch,rd as bucket,su as build_proposed,j as calculate,Df as calculateEffectiveEndDateConstraintInterval,Sf as calculateEffectiveStartDateConstraintInterval,sv as combineCalendars,Ua as createEntityOnPrototype,Hc as cycleInfo,zt as dateConverter,fd as delay,Ze as durationFormula,Yt as effortFormula,mr as endDateByEffortFormula,Qe as endDateFormula,Ir as ensureEntityOnPrototype,ov as entity,Xo as entityDecoratorBody,q as field,wl as fixedDurationAndEffortSEDWUGraphDescription,kf as fixedDurationSEDWUBackwardEffortDriven,jf as fixedDurationSEDWUBackwardNonEffortDriven,Ff as fixedDurationSEDWUForwardEffortDriven,_f as fixedDurationSEDWUForwardNonEffortDriven,Rl as fixedDurationSEDWUGraphDescription,Yf as fixedEffortSEDWUBackward,Hf as fixedEffortSEDWUForward,Tl as fixedEffortSEDWUGraphDescription,Xf as fixedUnitsSEDWUBackwardEffortDriven,Zf as fixedUnitsSEDWUBackwardNonEffortDriven,Qf as fixedUnitsSEDWUForwardEffortDriven,Jf as fixedUnitsSEDWUForwardNonEffortDriven,pn as fixedUnitsSEDWUGraphDescription,pt as format,qe as generic_field,ud as getDecoratedModelFields,ti as injectStaticFieldsProperty,lr as intersectIntervals,Cr as isAtomicValue,Nt as isDateFinite,$s as isEqualEffectiveDirection,hd as isNotNumber,ar as isSerializableEqual,Oo as later,N as model_field,G as prototypeValue,Xu as reference,nu as required,Ms as runGeneratorAsyncWithEffect,qc as runGeneratorSyncWithEffect,vr as startDateByEffortFormula,Je as startDateFormula,us as stripDuplicates,Ct as throwUnknownIdentifier,pr as unitsFormula,iu as validateRequiredProperties,dt as write};
//# sourceMappingURL=gantt.node.min.mjs.map
