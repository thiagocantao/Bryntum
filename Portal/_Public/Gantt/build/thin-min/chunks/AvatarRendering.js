/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var Ie=Object.defineProperty;var xe=(i,e,t)=>e in i?Ie(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var I=(i,e,t)=>(xe(i,typeof e!="symbol"?e+"":e,t),t);import{Base as b,Delayable as q,Events as Le,IdHelper as we,Identifiable as $e,EventHelper as P,DomDataStore as x,DomHelper as N,Objects as ke,Factoryable as Ne,ObjectHelper as Ue,Combo as ze,Checkbox as Fe,Tooltip as Ke,StringHelper as je}from"./Editor.js";const G=()=>{throw new Error("Abstract method call!")};class T extends b{get type(){return this.constructor.name}undo(){G()}redo(){G()}}T._$name="ActionBase";const h=()=>{throw new Error("Abstract method call!")},c=()=>{throw new Error("Method cannot be called at this state!")};class A extends b{canUndo(e){h()}canRedo(e){h()}onUndo(e){h()}onRedo(e){h()}onStartTransaction(e){h()}onStopTransaction(e){h()}onStopTransactionDelayed(e){h()}onRejectTransaction(e){h()}onEnable(e){h()}onDisable(e){h()}onAutoRecordOn(e){h()}onAutoRecordOff(e){h()}onResetQueue(e){h()}onModelUpdate(e){h()}onStoreModelAdd(e){h()}onStoreModelInsert(e){h()}onStoreModelRemove(e){h()}onStoreModelRemoveAll(e){h()}onModelInsertChild(e){h()}onModelRemoveChild(e){h()}}A._$name="StateBase";const d=Symbol("STATE_PROP"),E=Symbol("STORES_PROP"),p=Symbol("QUEUE_PROP"),R=Symbol("POS_PROP"),g=Symbol("TRANSACTION_PROP"),S=Symbol("TRANSACTION_TIMER_PROP"),y=Symbol("AUTO_RECORD_PROP"),L=Symbol("IS_APPLYING_STASH");Object.freeze([d,E,p,R,g,S,y,L]);const W=new Map,Be=(i,e)=>{W.set(i,e)},Qe=i=>(typeof i=="string"&&(i=W.get(i)),i);var D={registerStmState:Be,resolveStmState:Qe};const U=(i,e)=>{const{undo:t,redo:o}=e;let n;return t&&!o?n={[p]:i[p].slice(i.position),[R]:0}:o&&!t?n={[p]:i[p].slice(0,i.position)}:n={[p]:[],[R]:0},[n,()=>{i.notifyStoresAboutQueueReset(e)}]};class Xe extends A{canUndo(){return!1}canRedo(){return!1}onUndo(){c()}onRedo(){c()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){c()}onAutoRecordOn(){return{[y]:!0}}onAutoRecordOff(){return{[y]:!1}}onStartTransaction(){c()}onStopTransaction(){c()}onStopTransactionDelayed(){c()}onRejectTransaction(){c()}onResetQueue(e,t){return U(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const Y=new Xe;D.registerStmState("disabledstate",Y);const M=Symbol("ACTION_QUEUE_PROP");class z extends b{get defaultConfig(){return{title:null}}construct(...e){this[M]=[],super.construct(...e)}get queue(){return this[M].slice(0)}get length(){return this[M].length}addAction(e){this[M].push(e)}undo(){const e=this[M];for(let t=e.length-1;t>=0;--t)e[t].undo()}redo(){const e=this[M];for(let t=0,o=e.length;t<o;++t)e[t].redo()}}z._$name="Transaction";class V extends A{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,t){let o=e.position;const n=e[p],r=Math.max(0,o-t),s=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];for(;o!==r;){const l=n[--o];l.undo(),a.push(l)}return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"undo",transactions:a})}]};return[{[d]:"restoringstate",[R]:r},s]}onRedo(e,t){let o=e.position;const n=e[p],r=Math.min(n.length,o+t),s=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];do{const l=n[o++];l.redo(),a.push(l)}while(o!==r);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"redo",transactions:a})}]};return[{[d]:"restoringstate",[R]:r},s]}onEnable(){c()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[d]:"autoreadystate",[y]:!0}}onAutoRecordOff(){c()}onStartTransaction(e,t){const o=new z({title:t});return[{[d]:"recordingstate",[g]:o},()=>{e.notifyStoresAboutStateRecordingStart(o)}]}onStopTransaction(){c()}onStopTransactionDelayed(){c()}onRejectTransaction(){c()}onResetQueue(e,t){return U(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const w=new V;D.registerStmState("readystate",w);class J extends A{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const t=e[g];return e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[d]:"disabledstate",[g]:null}}onAutoRecordOn(e){return[{[d]:"autorecordingstate",[y]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){c()}onStartTransaction(){c()}onStopTransaction(e,t){const o=e[g],n=e[p];let r=e[R];return o.length&&(!o.title&&!t&&e.getTransactionTitle?o.title=e.getTransactionTitle(o):t&&(o.title=t),n[r]=o,n.length=++r),[{[d]:"readystate",[R]:r,[g]:null},()=>{e.notifyStoresAboutStateRecordingStop(o,{stop:!0})}]}onRejectTransaction(e){const t=e[g];return[{[d]:"restoringstate",[g]:null},()=>(t.length&&t.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onStopTransactionDelayed(){c()}onResetQueue(e,t){return U(e,t)}onModelUpdate(e,t,o,n,r){e[g].addAction(e.makeModelUpdateAction(t,o,n,r))}onModelInsertChild(e,t,o,n,r,s){e[g].addAction(e.makeModelInsertChildAction(t,o,n,r,s))}onModelRemoveChild(e,t,o,n){e[g].addAction(e.makeModelRemoveChildAction(t,o,n))}onStoreModelAdd(e,t,o,n){e[g].addAction(e.makeStoreModelAddAction(t,o,n))}onStoreModelInsert(e,t,o,n,r,s){e[g].addAction(e.makeStoreModelInsertAction(t,o,n,r,s))}onStoreModelRemove(e,t,o,n,r){e[g].addAction(e.makeStoreModelRemoveAction(t,o,n,r))}onStoreRemoveAll(e,t,o,n){e[g].addAction(e.makeStoreRemoveAllAction(t,o,n))}}const Z=new J;D.registerStmState("recordingstate",Z);class He extends A{static get $name(){return"RestoringStateClass"}canUndo(){return!1}canRedo(){return!1}onUndo(){c()}onRedo(){c()}onEnable(){c()}onDisable(){c()}onAutoRecordOn(){return{[y]:!0}}onAutoRecordOff(){return{[y]:!1}}onStartTransaction(){c()}onStopTransaction(){c()}onStopTransactionDelayed(){c()}onRejectTransaction(){c()}onQueueReset(){c()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const ee=new He;D.registerStmState("restoringstate",ee);class qe extends V{onAutoRecordOn(){c()}onAutoRecordOff(){return{[d]:"readystate",[y]:!1}}onStartTransaction(e,t){const o=new z({title:t});return[{[d]:"autorecordingstate",[g]:o},()=>{e.notifyStoresAboutStateRecordingStart(o),e.stopTransactionDelayed()}]}onModelUpdate(e,t,o,n){e.startTransaction(),e.onModelUpdate(t,o,n)}onModelInsertChild(e,t,o,n,r){e.startTransaction(),e.onModelInsertChild(t,o,n,r)}onModelRemoveChild(e,t,o,n){e.startTransaction(),e.onModelRemoveChild(t,o,n)}onStoreModelAdd(e,t,o,n){e.startTransaction(),e.onStoreModelAdd(t,o,n)}onStoreModelInsert(e,t,o,n,r,s){e.startTransaction(),e.onStoreModelInsert(t,o,n,r,s)}onStoreModelRemove(e,t,o,n,r){e.startTransaction(),e.onStoreModelRemove(t,o,n,r)}onStoreRemoveAll(e,t,o,n){e.startTransaction(),e.onStoreRemoveAll(t,o,n)}}const F=new qe;D.registerStmState("autoreadystate",F);class Ge extends J.mixin(q){onDisable(e){const t=e[g],o=e[S];return o&&this.clearTimeout(o),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[d]:"disabledstate",[g]:null,[S]:null}}onAutoRecordOn(e){c()}onAutoRecordOff(e){const t=e[S];return t&&this.clearTimeout(t),{[d]:"recordingstate",[y]:!1,[S]:null}}onStopTransaction(e,t){const o=e[g],n=e[S],r=e[p];let s=e[R];return n&&this.clearTimeout(n),o.length&&(!o.title&&!t&&e.getTransactionTitle?o.title=e.getTransactionTitle(o):t&&(o.title=t),r[s]=o,r.length=++s),[{[d]:"autoreadystate",[R]:s,[g]:null,[S]:null},()=>{e.notifyStoresAboutStateRecordingStop(o,{stop:!0})}]}onStopTransactionDelayed(e){let t=e[S];return t&&this.clearTimeout(t),t=this.setTimeout(()=>{e.stopTransaction()},e.autoRecordTransactionStopTimeout),{[d]:j,[S]:t}}onResetQueue(e,t){return U(e,t)}onRejectTransaction(e){const t=e[g],o=e[S];return o&&this.clearTimeout(o),[{[d]:"restoringstate",[g]:null,[S]:null},()=>(t.length&&t.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onModelUpdate(e,...t){super.onModelUpdate(e,...t),e.stopTransactionDelayed()}onModelInsertChild(e,...t){super.onModelInsertChild(e,...t),e.stopTransactionDelayed()}onModelRemoveChild(e,...t){super.onModelRemoveChild(e,...t),e.stopTransactionDelayed()}onStoreModelAdd(e,...t){super.onStoreModelAdd(e,...t),e.stopTransactionDelayed()}onStoreModelInsert(e,...t){super.onStoreModelInsert(e,...t),e.stopTransactionDelayed()}onStoreModelRemove(e,...t){super.onStoreModelRemove(e,...t),e.stopTransactionDelayed()}onStoreRemoveAll(e,...t){super.onStoreRemoveAll(e,...t),e.stopTransactionDelayed()}}const j=new Ge;D.registerStmState("autorecordingstate",j);const te=Symbol("MODEL_PROP"),oe=Symbol("NEW_DATA_PROP"),ne=Symbol("OLD_DATA_PROP");class B extends T{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0,isInitialUserAction:!1}}get type(){return"UpdateAction"}get model(){return this[te]}set model(e){this[te]=e}get newData(){return this[oe]}set newData(e){this[oe]={...e}}get oldData(){return this[ne]}set oldData(e){this[ne]={...e}}undo(){const{model:e,oldData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,!!e.$)}redo(){const{model:e,newData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,!!e.$)}}B._$name="UpdateAction";const re=Symbol("PARENT_MODEL_PROP"),se=Symbol("CHILD_MODELS_PROP"),ie=Symbol("INSERT_INDEX_PROP"),ae=Symbol("CONTEXT_PROP");class le extends T{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[re]}set parentModel(e){this[re]=e}get childModels(){return this[se]}set childModels(e){this[se]=e.slice(0)}get insertIndex(){return this[ie]}set insertIndex(e){this[ie]=e}get context(){return this[ae]}set context(e){this[ae]=e}undo(){const{parentModel:e,context:t,childModels:o}=this,n=new Map,r=new Set;for(const s of o){const a=t.get(s);if(!a)r.add(s);else{let l=n.get(a.parent);l||(l={moveRight:[],moveLeft:[],moveFromAnotherParent:[]},n.set(a.parent,l)),a.parent===e?a.index>s.parentIndex?l.moveRight.push({parent:a.parent,model:s,index:a.index+1}):l.moveLeft.push({parent:a.parent,model:s,index:a.index}):l.moveFromAnotherParent.push({parent:a.parent,model:s,index:a.index})}}for(const s of n.values()){const{moveRight:a,moveLeft:l}=s;l.sort((m,u)=>m.index-u.index),a.sort((m,u)=>u.index-m.index)}r.forEach(s=>s.parent.removeChild(s));for(const s of n.values()){const{moveRight:a,moveLeft:l,moveFromAnotherParent:m}=s;l.forEach(u=>{u.parent.insertChild(u.model,u.index)}),a.forEach(u=>{u.parent.insertChild(u.model,u.index)}),m.forEach(u=>{u.parent.insertChild(u.model,u.index)})}}redo(){var e;const{parentModel:t,insertIndex:o,childModels:n}=this,r=t.children[o];t.insertChild(n,r,!1,{orderedBeforeNode:r==null||(e=r.previousSibling)===null||e===void 0?void 0:e.nextOrderedSibling})}}le._$name="InsertChildAction";const de=Symbol("PARENT_MODEL_PROP"),ce=Symbol("CHILD_MODELS_PROP"),ue=Symbol("CONTEXT_PROP");class ge extends T{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[de]}set parentModel(e){this[de]=e}get childModels(){return this[ce]}set childModels(e){this[ce]=e.slice(0)}get context(){return this[ue]}set context(e){this[ue]=e}undo(){const{parentModel:e,context:t,childModels:o}=this;o.sort((n,r)=>{const s=t.get(n),a=t.get(r);return s-a}),o.forEach(n=>{const r=t.get(n);e.insertChild(n,r.parentIndex,void 0,{orderedParentIndex:r.orderedParentIndex})})}redo(){this.parentModel.removeChild(this.childModels)}}ge._$name="RemoveChildAction";const he=Symbol("STORE_PROP"),fe=Symbol("MODEL_LIST_PROP");class me extends T{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[he]}set store(e){this[he]=e}get modelList(){return this[fe]}set modelList(e){this[fe]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}}me._$name="AddAction";const pe=Symbol("STORE_PROP"),Se=Symbol("MODEL_LIST_PROP"),ve=Symbol("INSERT_INDEX_PROP"),Re=Symbol("CONTEXT_PROP");class ye extends T{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[pe]}set store(e){this[pe]=e}get modelList(){return this[Se]}set modelList(e){this[Se]=e.slice(0)}get insertIndex(){return this[ve]}set insertIndex(e){this[ve]=e}get context(){return this[Re]}set context(e){this[Re]=e}undo(){const{store:e,modelList:t,context:o,silent:n}=this;t.sort((r,s)=>{const a=o.get(r),l=o.get(s);return a!==void 0&&l!==void 0?a-l:0}),t.forEach(r=>{const s=o.get(r);r._undoingInsertion=!0,s!==void 0?e.insert(s,r,n):e.remove(r,n),r._undoingInsertion=!1})}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}}ye._$name="InsertAction";const be=Symbol("STORE_PROP"),De=Symbol("MODEL_LIST_PROP"),Te=Symbol("CONTEXT_PROP");class Ae extends T{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[be]}set store(e){this[be]=e}get modelList(){return this[De]}set modelList(e){this[De]=e.slice(0)}get context(){return this[Te]}set context(e){this[Te]=e}undo(){const{store:e,context:t,modelList:o,silent:n}=this;o.sort((r,s)=>{const a=t.get(r),l=t.get(s);return a-l}),o.forEach(r=>{const s=t.get(r);e.insert(s,r,n)})}redo(){this.store.remove(this.modelList,this.silent)}}Ae._$name="RemoveAction";const Ee=Symbol("STORE_PROP"),Pe=Symbol("ALL_RECORDS_PROP");class Me extends T{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[Ee]}set store(e){this[Ee]=e}get allRecords(){return this[Pe]}set allRecords(e){this[Pe]=e.slice(0)}undo(){const{store:e,allRecords:t,silent:o}=this;e.add(t,o)}redo(){this.store.removeAll(this.silent)}}Me._$name="RemoveAllAction";const We=(i,e,t,o)=>new B({model:i,newData:e,oldData:t,isInitialUserAction:o}),Ye=(i,e,t,o)=>new le({parentModel:i,childModels:t,insertIndex:e,context:o}),Ve=(i,e,t)=>new ge({parentModel:i,childModels:e,context:t}),Je=(i,e,t)=>new me({store:i,modelList:e,silent:t}),Ze=(i,e,t,o,n)=>new ye({store:i,insertIndex:e,modelList:t,context:o,silent:n}),et=(i,e,t,o)=>new Ae({store:i,modelList:e,context:t,silent:o}),tt=(i,e,t)=>new Me({store:i,allRecords:e,silent:t}),f=(i,e,...t)=>{const o=i.state,n=e.call(i[d],i,...t);if(typeof n=="string")i[d]=D.resolveStmState(n);else if(n instanceof A)i[d]=n;else if(Array.isArray(n)){const[r,s]=n;typeof r=="string"?i[d]=D.resolveStmState(r):r instanceof A?i[d]=r:r&&typeof r=="object"&&(i=Object.assign(i,r),i[d]=D.resolveStmState(i[d])),typeof s=="function"&&f(i,s,...t)}else n&&typeof n=="object"&&(i=Object.assign(i,n),i[d]=D.resolveStmState(i[d]));o!==w&&o!==F&&n!==w&&n!==F&&i.trigger("ready")};class Oe extends Le(b){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:We,makeModelInsertChildAction:Ye,makeModelRemoveChildAction:Ve,makeStoreModelAddAction:Je,makeStoreModelInsertAction:Ze,makeStoreModelRemoveAction:et,makeStoreRemoveAllAction:tt,getTransactionTitle:null}}construct(...e){Object.assign(this,{[d]:w,[E]:[],[p]:[],[R]:0,[g]:null,[S]:null,[y]:!1,[L]:!1,stashedTransactions:{}}),super.construct(...e)}get state(){return this[d]}get position(){return this[R]}get length(){return this[p].length}get stores(){return Array.from(this[E])}hasStore(e){return this[E].includes(e)}addStore(e){this.hasStore(e)||(this[E].push(e),e.stm=this,e.forEach(t=>t.stm=this))}removeStore(e){this.hasStore(e)&&(this[E]=this[E].filter(t=>t!==e),e.stm=null,e.forEach(t=>t.stm=null))}forEachStore(e){this[E].forEach(t=>e(t,t.id))}get disabled(){return this.state===Y}set disabled(e){const t=this;t.disabled!==e&&(e?f(t,t.state.onDisable,t):f(t,t.state.onEnable,t),t.trigger("stmDisabled",{disabled:e}),t.trigger("disabled",{disabled:e}))}get enabled(){return!this.disabled}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===w||this.state===F}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===Z||this.state===j}get isApplyingStash(){return this[L]}get autoRecord(){return this[y]}set autoRecord(e){const t=this;t.autoRecord!=e&&(e?f(t,t.state.onAutoRecordOn,t):f(t,t.state.onAutoRecordOff,t))}startTransaction(e=null){f(this,this.state.onStartTransaction,e)}stopTransaction(e=null){f(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){f(this,this.state.onStopTransactionDelayed)}rejectTransaction(){f(this,this.state.onRejectTransaction)}get transaction(){return this[g]}get queue(){return this[p].map(e=>e.title)}get rawQueue(){return this[p]}get isRestoring(){return this.state===ee||this.isApplyingStash}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(e=1){this.isReady||await this.waitForReadiness(),f(this,this.state.onUndo,e)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(e=1){this.isReady||await this.waitForReadiness(),f(this,this.state.onRedo,e)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){f(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore(t=>{var o;return(o=t.onStmRecordingStart)===null||o===void 0?void 0:o.call(t,this,e)}),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,t){this.forEachStore(o=>{var n;return(n=o.onStmRecordingStop)===null||n===void 0?void 0:n.call(o,this,e,t)}),this.trigger("recordingStop",{stm:this,transaction:e,reason:t})}notifyStoresAboutStateRestoringStart(){this.forEachStore(e=>{var t;return(t=e.onStmRestoringStart)===null||t===void 0?void 0:t.call(e,this)}),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop({cause:e,transactions:t}){this.forEachStore(o=>{var n;return(n=o.onStmRestoringStop)===null||n===void 0?void 0:n.call(o,this)}),this.trigger("restoringStop",{stm:this,cause:e,transactions:t})}notifyStoresAboutQueueReset(e){this.forEachStore(t=>{var o;return(o=t.onStmQueueReset)===null||o===void 0?void 0:o.call(t,this,e)}),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,t,o,n){f(this,this.state.onModelUpdate,e,t,o,n)}onModelInsertChild(e,t,o,n){f(this,this.state.onModelInsertChild,e,t,o,n)}onModelRemoveChild(e,t,o){f(this,this.state.onModelRemoveChild,e,t,o)}onStoreModelAdd(e,t,o){f(this,this.state.onStoreModelAdd,e,t,o)}onStoreModelInsert(e,t,o,n,r){f(this,this.state.onStoreModelInsert,e,t,o,n,r)}onStoreModelRemove(e,t,o,n){f(this,this.state.onStoreModelRemove,e,t,o,n)}onStoreRemoveAll(e,t,o){f(this,this.state.onStoreRemoveAll,e,t,o)}onUndoKeyPress(e){const t=this;t.enabled&&(e.shiftKey?t.canRedo&&(e.preventDefault(),t.redo()):t.canUndo&&(e.preventDefault(),t.undo()))}stash(){const e=this;if(this.transaction){const t=we.generateId("_stashedTransactionGeneratedId_");return e.stashedTransactions[t]=e.transaction,e.rejectTransaction(),t}}applyStash(e){const t=this,o=t.stashedTransactions[e];t[L]=!0,o&&(t.startTransaction(o.title),o.redo(),delete t.stashedTransactions[e]),t[L]=!1}}Oe._$name="StateTrackingManager";var Ce=i=>class extends(i||b){static get $name(){return"Finalizable"}construct(...t){super.construct(...t),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}doFinalize(){this.destroy()}finalize(){const t=this;let o=t.finalizing;return!o&&!t.isFinalized&&(t.isFinalizing=!0,t.finalizing=o=t._awaitFinalizer()),o}async _awaitFinalizer(){const t=this;try{await t.finalizer}finally{t.finalizing=null,t.isFinalized=!0,t.doFinalize()}}};const Q=Symbol("dragAbort"),K=Symbol("dragInit"),_e=Symbol("dragDrag"),X=Symbol("dragDrop"),ot={x:"horizontal",y:"vertical"};class O extends b.mixin(Ce,q,$e){static get configurable(){return{itemElement:null,scrollManager:null,monitoringConfig:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300}}static get identifiable(){return{}}construct(...e){super.construct(...e);const t=this,{event:o}=t;Object.assign(t,{altKey:null,cleaners:[],ctrlKey:null,data:new Map,element:o.target,endEvent:null,lastMoveEvent:null,metaKey:null,previousTarget:null,scrollerAction:null,shiftKey:null,state:K,startEvent:o,touchStartTimer:null,_valid:!0}),"touches"in o&&t.touchStartDelay&&(t.touchStartTimer=t.setTimeout(()=>t.touchStartTimer=null,t.touchStartDelay,"touchStartDelay")),P.on({element:globalThis,blur:"onWindowBlur",thisObj:t})}doDestroy(){const e=this,{source:t,target:o}=e;e.cleanup(),(o==null?void 0:o.dropping)===e&&(o.dropping=null),(t==null?void 0:t.dragging)===e&&(t.dragging=null),super.doDestroy()}onWindowBlur(){this.started&&this.abort()}get aborted(){return this.state===Q}get completed(){return this.isDestroying||this.aborted||this.endEvent!==null}get pending(){return this.state===K}get started(){return this.state!==K&&!this.aborted}get valid(){return this.started&&this.targetElement!=null&&this._valid}set valid(e){this._valid=e}async get(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(!this.completed)throw new Error("Data is not available until drag completion");if(Array.isArray(e))return Promise.all(e.map(o=>this.get(o)));let t=this.data.get(e);return typeof t=="function"&&(t=await t(),this.data.set(e,t)),t}has(e){return this.data.has(e)}peek(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(e))return e.map(o=>this.peek(o));let t=this.data.get(e);return typeof t=="function"&&(t=!0),t}set(e,t){this.data.set(e,t)}changeTarget(e,t){if(e!==t){const o=this;o._target=e,o.previousTarget=t,t&&(t.dropping=null),e&&(e.dropping=o,e.dropping!==o&&(e=null,o.valid=!1)),o._target=t}return e}updateTarget(e,t){const o=this;t&&o.source.dragLeaveTarget(o,t),e&&(o.valid=!0,e.dragMove(o),o.source.dragEnterTarget(o))}updateTargetElement(e){let t,o,n,r,s;for(s=e;s;s=s.parentElement)if(o=x.get(s,"droppables"),o){for(r=0;r<o.length;++r)if(t=o[r],t.dropRootElement.contains(e)&&(n=t.droppableSelector,(!n||e.closest(`#${N.getId(t.dropRootElement)} ${n}`))&&(this.target=t,this.target===t)))return}}abort(){const e=this,{element:t,source:o}=e;t==null||t.getBoundingClientRect(),e.state!==X&&(e.state=Q,e.cleanup()),o==null||o.endDrag(e)}begin(){const e=this,{source:t}=e,o=t.beforeDrag(e);return o!==!1&&(t.dragging=e),o}cleanup(){let e;for(;e=this.cleaners.pop();)e()}end(e){const t=this,{lastMoveEvent:o,target:n}=t,{dragSwallowClickTime:r}=t.source;t.event=t.endEvent=e,t.syncFlags(),t.started&&(((o==null?void 0:o.clientX)!==e.clientX||(o==null?void 0:o.clientY)!==e.clientY||(o==null?void 0:o.target)!==e.target)&&t.track(),r&&P.on({element:document,capture:!0,expires:r,once:!0,click(s){s.stopPropagation()}}),t.state=X,n!==t.source&&(n==null||n.dragDrop(t)))}fakeKey(e,t){const o=this,{lastMoveEvent:n}=o;if(n&&o.element){let r;n.isKey=!0,e.key==="Alt"?o.altKey!==t&&(o.altKey=t,r=!0):e.key==="Control"&&o.ctrlKey!==t&&(o.ctrlKey=t,r=!0),r&&(o.event=n,o.track())}}keyDown(e){this.completed||(e.key==="Escape"?this.abort():this.isDragToggleKey(e.key)&&this.fakeKey(e,!0))}keyUp(e){!this.completed&&this.isDragToggleKey(e.key)&&this.fakeKey(e,!1)}getDistance(e){return P.getDistanceBetween(this.startEvent,e)}isDragToggleKey(e){return e==="Control"||e==="Alt"}move(e){const t=this,{target:o}=e,n=t.getDistance(e),r=n>=t.threshold;if(t.syncFlags(),t.touchStartTimer){r&&t.abort();return}if(o&&o.nodeType===Node.ELEMENT_NODE){if(r&&!t.started&&(t.event=e,t.start()===!1)){t.abort();return}t.started&&!t.completed&&(t.lastMoveEvent=t.event=e,e.type==="touchmove"&&(e.preventDefault(),e.stopImmediatePropagation()),t.track())}}start(){const e=this,{scrollManager:t,monitoringConfig:o,source:n}=e,{draggingBodyCls:r,dragLock:s}=n,a=n.dragRootElement;if(e.state=_e,t){const m=t.startMonitoring(ke.merge({scrollables:[{element:a}],direction:ot[s]||s||"both",callback(u){const{lastMoveEvent:v}=e;v&&e.element&&(v.isScroll=!0,e.event=v,e.scrollerAction=u,e.track(),e.scrollerAction=null)}},o));e.cleaners.push(m)}const l=n.dragRootElement.closest(".b-outer")||document.body;if(l.classList.add(r),e.cleaners.push(()=>l.classList.remove(r)),n.startDrag(e)===!1)return e.cleanup(),!1}syncFlags(){const e=this,{event:t}=e;e.altKey=t.altKey,e.ctrlKey=t.ctrlKey||t.metaKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey}track(){const e=this,{event:t,source:o,target:n}=e;let r=t.target,s;t.type==="touchmove"&&(s=t.changedTouches[0],r=N.elementFromPoint(s.clientX,s.clientY)),e.targetElement=r,n===e.target&&(n==null||n.dragMove(e)),o.trackDrag(e)}}I(O,"$name","DragContext"),O.prototype.STATE=O.STATE=Object.freeze({ABORTED:Q,INIT:K,DRAGGING:_e,DROPPED:X}),O._$name="DragContext";class _ extends b.mixin(Ne){static get type(){return"default"}static get configurable(){return{dragging:null}}static get factoryable(){return{defaultType:_}}updateDragging(e,t){t&&this.close(t),e&&this.open(e)}close(e){}open(e){}dragStart(e){this.dragging=e}dragMove(e){}dragEnd(e){this.dragging=null}}_.initClass(),_._$name="DragProxy";var nt=i=>class extends(i||b){static get $name(){return"Draggable"}static get configurable(){return{dragging:{$config:"nullify",value:null},draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragItemOverCls:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,ignoreSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,overItem:null,testConfig:{dragSwallowClickTime:50}}}static get properties(){return{draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started",draggableCls:"b-draggable"}}beforeDrag(t){const{dragRootElement:o,dragSelector:n,ignoreSelector:r}=this,s=n&&t.element.closest(n);return!n||!!(s&&s===o||o.contains(s)&&(!r||!t.element.matches(r)))}dragStart(t){}dragOver(t){}dragEnterTarget(t){}dragLeaveTarget(t,o){}dragDrop(t){}dragEnd(t){}get activeDrag(){const{dragging:t}=this;return t!=null&&t.started&&!t.completed?t:null}get dragEventer(){return this.trigger?this:null}get draggingClassElement(){const{draggingClsSelector:t,dragRootElement:o}=this;return t?o==null?void 0:o.closest(t):o}beginDrag(t){const{draggingCls:o,draggingClassElement:n}=this;o&&n&&(n.classList.add(o),t.cleaners.push(()=>n.classList.remove(o)))}async endDrag(t){const o=this,{dragEventer:n,dragProxy:r}=o;t.valid&&await o.dragDrop(t),!o.isDestroyed&&(t.pending?t.destroy():(o.dragEnd(t),r==null||r.dragEnd(t),n==null||n.trigger(t.valid?"drop":"dragCancel",{drag:t,event:t.event}),o.finalizeDrag(t)))}async finalizeDrag(t){var o;await((o=t.finalize)===null||o===void 0?void 0:o.call(t))}moveDrag(t){if(this.dragOver(t)!==!1){const{dragEventer:o,dragProxy:n}=this;n==null||n.dragMove(t),o==null||o.trigger("drag",{drag:t,event:t.event})}}setupDragContext(t){const o=this,{dragItemSelector:n,id:r}=o,{target:s}=t;return{event:t,id:r?`${r}-drag-${o._nextDragId=(o._nextDragId||0)+1}`:null,itemElement:n?s.closest(n):s,touchStartDelay:o.dragTouchStartDelay,source:o,threshold:o.dragThreshold}}startDrag(t){const{draggingStartedCls:o,draggingClassElement:n,draggingItemCls:r,dragEventer:s,dragProxy:a}=this,{itemElement:l}=t;if((s==null?void 0:s.trigger("beforeDragStart",{drag:t,event:t.event}))===!1)return!1;o&&n&&(n.classList.add(o),t.cleaners.push(()=>n.classList.remove(o))),r&&l&&(l.classList.add(r),t.cleaners.push(()=>l.classList.remove(r))),a==null||a.dragStart(t);const m=this.dragStart(t);return m!==!1&&(s==null||s.trigger("dragStart",{drag:t,event:t.event})),m}trackDrag(t){var o;const{dropTargetSelector:n}=this;t.valid=!(n&&!((o=t.targetElement)!==null&&o!==void 0&&o.closest(n))),this.moveDrag(t)}configureListeners(t){const o=this,n=Ue.assign({thisObj:o},o.dragDocumentListeners);return"touches"in t.startEvent?(delete n.mousemove,delete n.mouseup):(delete n.contextmenu,delete n.touchmove,delete n.touchend,delete n.pointerup),n}updateDragging(t,o){const n=this;if(t){const r=n.configureListeners(t);t.cleaners.push(P.on(r)),n.beginDrag(t)}else o&&o.destroy()}changeDragProxy(t,o){return _.reconfigure(o,t,{owner:this,defaults:{owner:this}})}updateDragRootElement(t,o){var n;const r=this,{draggableCls:s,dragItemSelector:a,onDragItemMouseMove:l}=r;if(o==null||o.classList.remove(s),(n=r._dragRootDetacher)===null||n===void 0||n.call(r),t){const m={thisObj:r,element:t,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart",pointerdown:u=>{var v,k;return u.pointerId&&((v=(k=u.target).releasePointerCapture)===null||v===void 0?void 0:v.call(k,u.pointerId))}};l&&(m.mousemove={delegate:a,handler:"onDragItemMouseMove"}),(r.dragItemOverCls||l||r.onDragItemMouseEnter||r.onDragItemMouseLeave)&&Object.assign(m,{mouseover:{delegate:a,handler:"onDragItemMouseOver"},mouseout:{delegate:a,handler:"onDragItemMouseOut"}}),t.classList.add(s),r._dragRootDetacher=P.on(m)}}onDragItemMouseOver(t){this.overItem=t}onDragItemMouseOut(t){this.dragging||(this.overItem=t)}changeOverItem(t){if(this.enterLeaveEvent=t,t.type==="mouseout"){var o;return((o=t.relatedTarget)===null||o===void 0?void 0:o.closest(this.dragItemSelector))||null}else return t.target.closest(this.dragItemSelector)}updateOverItem(t,o){const n=this,{dragItemOverCls:r}=n;if(o){var s;r&&o.classList.remove(r),(s=n.onDragItemMouseLeave)===null||s===void 0||s.call(n,n.enterLeaveEvent,o)}if(t){var a;r&&t.classList.add(r),(a=n.onDragItemMouseEnter)===null||a===void 0||a.call(n,n.enterLeaveEvent,t)}}onDragContextMenu(t){t.preventDefault()}onDragKeyDown(t){this.dragging.keyDown(t)}onDragKeyUp(t){this.dragging.keyUp(t)}onDragMouseDown(t){t.button===0&&this.onDragPointerDown(t)}onDragPointerDown(t){let{dragging:o}=this;o?o.isFinalizing||o.abort():(o=this.setupDragContext(t),o&&(o=new O(o),o.begin()===!1&&o.destroy()))}changeDragging(t,o){return o==null||o.destroy(),t}onDragPointerMove(t){const{dragging:o}=this;o&&!o.completed&&(o==null||o.move(t))}onDragPointerUp(t){const{dragging:o}=this;o&&!o.completed&&(o.end(t),this.endDrag(o))}onDragTouchStart(t){t.touches.length===1&&this.onDragPointerDown(t)}},rt=i=>class extends(i||b){static get $name(){return"Droppable"}static get configurable(){return{droppableSelector:null,dropping:null,dropRootElement:{$config:"nullify",value:null}}}get dropEventer(){return this.trigger?this:null}get droppableCls(){return"b-droppable"}dragEnter(t){var o;return(o=this.dropEventer)===null||o===void 0?void 0:o.trigger("dragEnter",{drag:t,event:t.event})}dragMove(t){var o;return(o=this.dropEventer)===null||o===void 0?void 0:o.trigger("dragMove",{drag:t,event:t.event})}dragDrop(t){var o;return(o=this.dropEventer)===null||o===void 0?void 0:o.trigger("drop",{drag:t,event:t.event})}dragLeave(t){var o;return(o=this.dropEventer)===null||o===void 0?void 0:o.trigger("dragLeave",{drag:t,event:t.event})}changeDropping(t,o){if(t!==o){const n=this;o&&(o.aborted||!o.completed)&&n.dragLeave(o),t&&(n._dropping=t,n.dragEnter(t)===!1&&(t=null),n._dropping=o)}return t}updateDropRootElement(t,o){const n=this,{droppableCls:r}=n;let s,a,l;o&&(s=x.get(o,"droppables"),l=!0,Array.isArray(s)&&(a=s.indexOf(n))>-1&&(s.length<2?x.remove(o,"droppables"):(s.splice(a,1),s.forEach(m=>{r===m.droppableCls&&(l=!1)}))),l&&o.classList.remove(r)),t&&(s=x.get(t,"droppables"),s?s.push(n):x.set(t,"droppables",[n]),t.classList.add(r))}};class C extends ze{configure(e){var o;const t=(o=e.picker)!=null?o:{};e.colors&&(t.colors=e.colors),"addNoColorItem"in e&&(t.addNoColorItem=e.addNoColorItem),e.picker=t,super.configure(e)}updatePicker(e){e&&(this.items=e.store.records)}updateColors(e){this.isConfiguring||(this.picker.colors=e)}updateAddNoColorItem(e){this.isConfiguring||(this.picker.addNoColorItem=e)}set value(e){this.store||(this.items=[],this.store=this.picker.store),e||(e=this.store.findRecord("color",null)),super.value=e}showPicker(){this.picker.refresh(),super.showPicker(...arguments)}get value(){return super.value}syncInputFieldValue(...e){var t;const o=this,{value:n}=o;let r=(t=o.picker)===null||t===void 0?void 0:t.getColorClassName(n);r||(o.colorBox.style.color=n),r="b-colorbox "+r,o.colorBox.className=r,o.showBoxForNoColor||o.element.classList.toggle("b-colorless",!n),super.syncInputFieldValue(...e)}get innerElements(){return[{reference:"colorBox",className:"b-colorbox"},...super.innerElements]}}I(C,"$name","ColorField"),I(C,"type","colorfield"),I(C,"configurable",{displayField:"text",valueField:"color",editable:!1,picker:{type:"colorpicker",align:{align:"t100-b100",matchSize:!1}},showBoxForNoColor:!0,colors:null,addNoColorItem:!0}),C.initClass(),C._$name="ColorField";class H extends Fe{static get $name(){return"SlideToggle"}static get type(){return"slidetoggle"}static get properties(){return{toggledCls:"b-slidetoggle-checked"}}construct(e){e!=null&&e.checked&&(e.cls=(e.cls||"")+" "+this.constructor.properties.toggledCls),super.construct(e)}get innerElements(){const e=super.innerElements;return e.splice(1,0,this.toggleElement),this.text?e[e.length-1].class="b-slidetoggle-label":e.pop(),e}get toggleElement(){return{class:"b-slidetoggle-toggle",reference:"slideToggle",children:[{class:"b-slidetoggle-thumb",reference:"slideThumb"}]}}internalOnChange(){super.internalOnChange(),this.element.classList[this.value?"add":"remove"](this.toggledCls)}}H.initClass(),H._$name="SlideToggle";class $ extends b{static get $name(){return"AvatarRendering"}static get configurable(){return{element:null,colorPrefix:"b-sch-",tooltip:null,size:null}}doDestroy(){var e;(e=this.tooltip)===null||e===void 0||e.destroy(),super.doDestroy()}updateElement(e){P.on({element:e,delegate:".b-resource-image",error:"onImageErrorEvent",thisObj:this,capture:!0})}changeTooltip(e){return Ke.new({forElement:this.element,forSelector:".b-resource-avatar",cls:"b-resource-avatar-tooltip"},e)}static get failedUrls(){return this._failedUrls||(this._failedUrls=new Set),this._failedUrls}getResourceAvatar(e){if(Array.isArray(e))return e.map(k=>this.getResourceAvatar(k));const{initials:t,color:o,iconCls:n,imageUrl:r,defaultImageUrl:s,dataset:a={},resourceRecord:l,alt:m=je.encodeHtml(l==null?void 0:l.name)}=e,u=this.getImageConfig(t,o,r,s,a,m)||this.getIconConfig(n,a)||this.getResourceInitialsConfig(t,o,a),{size:v}=this;return Object.assign(u.style,{...v?{height:v,width:v}:void 0}),u}getImageConfig(e,t,o,n,r,s){if(o=$.failedUrls.has(o)?n:o||n,o)return{tag:"img",draggable:"false",loading:"lazy",class:{"b-resource-avatar":1,"b-resource-image":1},style:{},alt:s,elementData:{defaultImageUrl:n,imageUrl:o,initials:e,color:t,dataset:r},src:o,dataset:r}}getIconConfig(e,t){if(e)return e&&{tag:"i",style:{},class:{"b-resource-avatar":1,"b-resource-icon":1,[e]:1},dataset:t}}getResourceInitialsConfig(e,t,o){const n=N.isNamedColor(t)&&t,r=!n&&t,{size:s}=this;return{tag:"div",class:{"b-resource-avatar":1,"b-resource-initials":1,[`${this.colorPrefix}${n}`]:n},style:{backgroundColor:r||null,...s?{height:s,width:s}:void 0},children:[e],dataset:o}}onImageErrorEvent({target:e}){if(!e.matches(".b-resource-avatar"))return;const{defaultImageUrl:t,initials:o,color:n,imageUrl:r,dataset:s}=e.elementData;if(t&&!e.src.endsWith(t.replace(/^[./]*/gm,"")))e.src=t;else{const a=N.createElement(this.getResourceInitialsConfig(o,n,s));a.elementData=e.elementData,e.parentElement.replaceChild(a,e)}$.failedUrls.add(r)}}$._$name="AvatarRendering";export{T as ActionBase,$ as AvatarRendering,C as ColorField,O as DragContext,_ as DragProxy,nt as Draggable,rt as Droppable,Ce as Finalizable,H as SlideToggle,A as StateBase,Oe as StateTrackingManager,z as Transaction,B as UpdateAction};
//# sourceMappingURL=AvatarRendering.js.map
