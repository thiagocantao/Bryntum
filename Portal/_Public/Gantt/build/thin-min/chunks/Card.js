/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var _=Object.defineProperty;var $=(c,e,t)=>e in c?_(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var o=(c,e,t)=>($(c,typeof e!="symbol"?e+"":e,t),t);import{Field as T,EventHelper as C,DateHelper as g,Widget as b,ObjectHelper as S,Layout as k}from"./Editor.js";import{TimeField as D}from"./MessageDialog.js";const E=new Date(2e3,0,1);class m extends T{doDestroy(){this.dateField.destroy(),this.timeField.destroy(),super.doDestroy()}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}changeTimeField(e){const t=this,a=D.new({revertOnEscape:t.revertOnEscape,syncInvalid(...i){const n=t.updatingInvalid;D.prototype.syncInvalid.apply(this,i),t.timeField&&!n&&t.syncInvalid()}},e);return C.on({element:a.element,keydown:"onTimeFieldKeyDown",thisObj:t}),t.readOnly&&(a.readOnly=!0),a}updateTimeField(e){const t=this;e.ion({change({userAction:a,value:i}){if(a&&!t.$settingValue){const n=t.dateField.value;t._isUserAction=!0,t.value=n?g.copyTimeValues(n,i||E):null,t._isUserAction=!1}},thisObj:t})}changeDateField(e){const t=this,a=(e==null?void 0:e.type)||"datefield",i=b.resolveType(e.type||"datefield"),n=b.create(S.assign({type:a,revertOnEscape:t.revertOnEscape,syncInvalid(...l){const h=t.updatingInvalid;i.prototype.syncInvalid.apply(this,l),t.dateField&&!h&&t.syncInvalid()}},e));return C.on({element:n.element,keydown:"onDateFieldKeyDown",thisObj:t}),t.readOnly&&(n.readOnly=!0),n.ion({keydown:({event:l})=>{var h;l.key==="Tab"&&!l.shiftKey&&(h=this.timeField)!==null&&h!==void 0&&h.isVisible&&(l.stopPropagation(),l.cancelBubble=!0)}}),n}get childItems(){return[this.dateField,this.timeField]}updateDateField(e){const t=this;e.ion({change({userAction:a,value:i}){a&&!t.$isInternalChange&&(t._isUserAction=!0,t.timeField.value?i&&g.copyTimeValues(i,t.timeField.value||E):t.timeField.value=i,t.value=i,t._isUserAction=!1)},thisObj:t})}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var a;var t;return typeof e=="number"?e:(a=(t=this.dateField)===null||t===void 0?void 0:t.weekStartDay)!=null?a:g.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0);const t=this,{dateField:a,timeField:i}=t,n=a.highlightExternalChange,l=i.highlightExternalChange;!e&&!t.highlightExternalChange&&(e=!0),t.$isInternalChange=!0,a.highlightExternalChange=!1,a.value=null,a.highlightExternalChange=n,e&&(i.highlightExternalChange=a.highlightExternalChange=!1),i.value=a.value=t.inputValue,a.highlightExternalChange=n,i.highlightExternalChange=l,t.$isInternalChange=!1,t.syncInvalid()}onTimeFieldKeyDown(e){const t=this;if(e.key==="Enter"||e.key==="Tab"){const a=t.dateField.value;t._isUserAction=!0,t.value=a?g.copyTimeValues(a,t.timeField.value||E):null,t._isUserAction=!1}}onDateFieldKeyDown(e){const t=this;e.key==="Tab"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),t.timeField.focus()):e.key==="Enter"&&(t.value=t.dateField.value)}updateRequired(e,t){this.timeField.required=this.dateField.required=e}updateReadOnly(e,t){super.updateReadOnly(e,t),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}focus(){this.dateField.focus()}hasChanged(e,t){return!g.isEqual(e,t)}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,t){[this.dateField,this.timeField].forEach(a=>a.setError(e,t))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,t){[this.dateField,this.timeField].forEach(a=>a.clearError(e,t))}updateInvalid(){this.updatingInvalid=!0,[this.dateField,this.timeField].forEach(e=>e.updateInvalid()),this.updatingInvalid=!1}}o(m,"configurable",{timeField:{},dateField:{keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>"",ariaElement:"element"}),o(m,"$name","DateTimeField"),o(m,"type","datetimefield"),o(m,"alias","datetime"),m.initClass(),m._$name="DateTimeField";const y=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"];class v extends k{onChildAdd(e){super.onChildAdd(e);const t=this,{activeItem:a,owner:i}=t,n=i.activeIndex!=null?i.activeIndex:t.activeIndex||0,l=i.items.indexOf(e),h=a!=null?e===a:l===n;e.ion({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:t}),h?(t._activeIndex=l,t._activeItem=e,e.show()):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}onChildRemove(e){super.onChildRemove(e);const t=this;t._activeItem===e&&t.activateSiblingOf(e),t._activeIndex=t.owner.items.indexOf(t._activeItem),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:t})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:t}=this,a=t.items.slice(),i=a.indexOf(e);a.splice(i,1),this.activeIndex=Math.min(i,a.length-1)}setActiveItem(e,t=this.activeIndex,a){const i=this,{owner:n}=i,{items:l}=n,h=e instanceof b,s=l[t],r=n.items[e=h?l.indexOf(e):parseInt(e,10)],A=(a==null?void 0:a.animation)!==!1,f=!(a!=null&&a.silent),d={prevActiveIndex:t,prevActiveItem:s};if(r&&!r.$isActivating&&r!==s){var F;const p=s&&s.element,I=r&&r.element;if(i.animateDetacher){const u=i.animateDetacher.event;if(u.activeItem===r)return u.promise;i.animateDetacher(),u.prevActiveItem.element.classList.remove(...y),u.activeItem.element.classList.remove(...y),i.animateDetacher=null}if(d.activeIndex=e,d.activeItem=r,f&&n.trigger("beforeActiveItemChange",d)===!1)return null;const w=i._activeIndex!==d.activeIndex;w&&(i._activeIndex=d.activeIndex),f&&((F=n.onBeginActiveItemChange)===null||F===void 0||F.call(n,d)),w&&(i._activeIndex=d.prevActiveIndex),A&&p&&n.isVisible&&i.animateCardChange?d.promise=i.cardChangeAnimation=new Promise((u,O)=>{const x=s.monitorResize;s.monitorResize=!1,i.contentElement.style.overflowX="hidden",s._hidden=!0,r.$isActivating=!0,r.show(),r.$isActivating=!1,p.classList.add(e>t?"b-slide-out-left":"b-slide-out-right"),I.classList.add(e<t?"b-slide-in-left":"b-slide-in-right"),n.isAnimating=!0,i.animateDetacher=C.onTransitionEnd({mode:"animation",element:I,thisObj:s,handler(){if(n.isAnimating=i.cardChangeAnimation=!1,!i.animateDetacher){i.setActiveItem(e,t,a);return}i.animateDetacher=null,I.classList.remove(...y),p&&(p.classList.remove(...y),s.$isDeactivating=!0,s._hidden=!1,s.hide(),s.monitorResize=x,s.$isDeactivating=!1),i.contentElement.style.overflowX="",i.onActiveItemChange(d,u,!f)}}),i.animateDetacher.reject=O,i.animateDetacher.event=d}):(r.$isActivating=!0,r.show(),r.focus(),r.$isActivating=!1,s&&(s.$isDeactivating=!0,s.hide(),s.$isDeactivating=!1),i.onActiveItemChange(d,null,!f))}return d}onActiveItemChange(e,t,a){const i=this;i._activeItem=e.activeItem,i._activeIndex=e.activeIndex,!a&&i.owner.trigger("activeItemChange",e),i.owner.containsFocus&&e.activeItem.focus(),t==null||t(e)}renderChildren(){const{owner:e}=this;e.contentElement.classList.toggle(this.hideChildHeaderCls,e.suppressChildHeaders),super.renderChildren()}changeActiveIndex(e){const{owner:t}=this;return t.isConfiguring&&!t._items?e:Math.min(e,t.items.length-1)}updateActiveIndex(e,t){this.owner.isConfiguring||this.setActiveItem(e,t)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}get isChangingCard(){return!!this.animateDetacher}}o(v,"$name","Card"),o(v,"type","card"),o(v,"configurable",{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null}),v.initClass(),v._$name="Card";export{m as DateTimeField};
//# sourceMappingURL=Card.js.map
