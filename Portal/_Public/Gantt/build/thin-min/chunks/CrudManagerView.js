/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var Bn=Object.defineProperty;var _n=(a,n,t)=>n in a?Bn(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t;var F=(a,n,t)=>(_n(a,typeof n!="symbol"?n+"":n,t),t);import{DateHelper as I,TimeZoneHelper as z,Store as N,Model as B,ObjectHelper as $,Events as Rt,Delayable as Ze,DomClassList as Et,Duration as ue,VersionHelper as ce,BrowserHelper as Vn,Base as V,AjaxStore as de,FunctionHelper as It,Objects as re,DayTime as Ke,ArrayHelper as _,StringHelper as G,AjaxHelper as Yn,LoadMaskable as Un,Mask as qn}from"./Editor.js";import{StateTrackingManager as Wn}from"./AvatarRendering.js";import{GridRowModel as zn}from"./GridRowModel.js";const xt=(a,n)=>new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds()+n,a.getMilliseconds()),L=function(){var a={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(n){if(this==null)throw new TypeError;var t=Object(this),r=t.length>>>0;if(r===0)return-1;var s=0;if(arguments.length>1&&(s=Number(arguments[1]),s!=s?s=0:s!=0&&s!=1/0&&s!=-1/0&&(s=(s>0||-1)*Math.floor(Math.abs(s)))),s>=r)return-1;for(var e=s>=0?s:Math.max(r-Math.abs(s),0);e<r;e++)if(e in t&&t[e]===n)return e;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),a.array={},a.array.sort=function(n,t){n.sort(function(r,s){return+r-+s}),t&&n[0]===0&&n.push(n.shift())},a.array.next=function(n,t,r){for(var s,e=r[0]!==0,i=0,o=t.length-1;o>-1;--o){if(s=t[o],s===n)return s;if(s>n||s===0&&e&&r[1]>n){i=o;continue}break}return t[i]},a.array.nextInvalid=function(n,t,r){for(var s=r[0],e=r[1],i=t.length,o=t[i-1]===0&&s!==0?e:0,l=n,u=t.indexOf(n),c=l;l===(t[u]||o);)if(l++,l>e&&(l=s),u++,u===i&&(u=0),l===c)return;return l},a.array.prev=function(n,t,r){for(var s,e=t.length,i=r[0]!==0,o=e-1,l=0;l<e;l++){if(s=t[l],s===n)return s;if(s<n||s===0&&i&&r[1]<n){o=l;continue}break}return t[o]},a.array.prevInvalid=function(n,t,r){for(var s=r[0],e=r[1],i=t.length,o=t[i-1]===0&&s!==0?e:0,l=n,u=t.indexOf(n),c=l;l===(t[u]||o);)if(l--,l<s&&(l=e),u--,u===-1&&(u=i-1),l===c)return;return l},a.day=a.D={name:"day",range:86400,val:function(n){return n.D||(n.D=a.date.getDate.call(n))},isValid:function(n,t){return a.D.val(n)===(t||a.D.extent(n)[1])},extent:function(n){if(n.DExtent)return n.DExtent;var t=a.M.val(n),r=a.DAYS_IN_MONTH[t-1];return t===2&&a.dy.extent(n)[1]===366&&(r=r+1),n.DExtent=[1,r]},start:function(n){return n.DStart||(n.DStart=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)))},end:function(n){return n.DEnd||(n.DEnd=a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n)))},next:function(n,t){t=t>a.D.extent(n)[1]?1:t;var r=a.date.nextRollover(n,t,a.D,a.M),s=a.D.extent(r)[1];return t=t>s?1:t||s,a.date.next(a.Y.val(r),a.M.val(r),t)},prev:function(n,t){var r=a.date.prevRollover(n,t,a.D,a.M),s=a.D.extent(r)[1];return a.date.prev(a.Y.val(r),a.M.val(r),t>s?s:t||s)}},a.dayOfWeekCount=a.dc={name:"day of week count",range:604800,val:function(n){return n.dc||(n.dc=Math.floor((a.D.val(n)-1)/7)+1)},isValid:function(n,t){return a.dc.val(n)===t||t===0&&a.D.val(n)>a.D.extent(n)[1]-7},extent:function(n){return n.dcExtent||(n.dcExtent=[1,Math.ceil(a.D.extent(n)[1]/7)])},start:function(n){return n.dcStart||(n.dcStart=a.date.next(a.Y.val(n),a.M.val(n),Math.max(1,(a.dc.val(n)-1)*7+1||1)))},end:function(n){return n.dcEnd||(n.dcEnd=a.date.prev(a.Y.val(n),a.M.val(n),Math.min(a.dc.val(n)*7,a.D.extent(n)[1])))},next:function(n,t){t=t>a.dc.extent(n)[1]?1:t;var r=a.date.nextRollover(n,t,a.dc,a.M),s=a.dc.extent(r)[1];t=t>s?1:t;var e=a.date.next(a.Y.val(r),a.M.val(r),t===0?a.D.extent(r)[1]-6:1+7*(t-1));return e.getTime()<=n.getTime()?(r=a.M.next(n,a.M.val(n)+1),a.date.next(a.Y.val(r),a.M.val(r),t===0?a.D.extent(r)[1]-6:1+7*(t-1))):e},prev:function(n,t){var r=a.date.prevRollover(n,t,a.dc,a.M),s=a.dc.extent(r)[1];return t=t>s?s:t||s,a.dc.end(a.date.prev(a.Y.val(r),a.M.val(r),1+7*(t-1)))}},a.dayOfWeek=a.dw=a.d={name:"day of week",range:86400,val:function(n){return n.dw||(n.dw=a.date.getDay.call(n)+1)},isValid:function(n,t){return a.dw.val(n)===(t||7)},extent:function(){return[1,7]},start:function(n){return a.D.start(n)},end:function(n){return a.D.end(n)},next:function(n,t){return t=t>7?1:t||7,a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)+(t-a.dw.val(n))+(t<=a.dw.val(n)?7:0))},prev:function(n,t){return t=t>7?7:t||7,a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n)+(t-a.dw.val(n))+(t>=a.dw.val(n)?-7:0))}},a.dayOfYear=a.dy={name:"day of year",range:86400,val:function(n){return n.dy||(n.dy=Math.ceil(1+(a.D.start(n).getTime()-a.Y.start(n).getTime())/a.DAY))},isValid:function(n,t){return a.dy.val(n)===(t||a.dy.extent(n)[1])},extent:function(n){var t=a.Y.val(n);return n.dyExtent||(n.dyExtent=[1,t%4?365:366])},start:function(n){return a.D.start(n)},end:function(n){return a.D.end(n)},next:function(n,t){t=t>a.dy.extent(n)[1]?1:t;var r=a.date.nextRollover(n,t,a.dy,a.Y),s=a.dy.extent(r)[1];return t=t>s?1:t||s,a.date.next(a.Y.val(r),a.M.val(r),t)},prev:function(n,t){var r=a.date.prevRollover(n,t,a.dy,a.Y),s=a.dy.extent(r)[1];return t=t>s?s:t||s,a.date.prev(a.Y.val(r),a.M.val(r),t)}},a.hour=a.h={name:"hour",range:3600,val:function(n){return n.h||(n.h=a.date.getHour.call(n))},isValid:function(n,t){return a.h.val(n)===t},extent:function(){return[0,23]},start:function(n){return n.hStart||(n.hStart=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n)))},end:function(n){return n.hEnd||(n.hEnd=a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n)))},next:function(n,t){t=t>23?0:t;var r=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)+(t<=a.h.val(n)?1:0),t);return!a.date.isUTC&&r.getTime()<=n.getTime()&&(r=a.date.next(a.Y.val(r),a.M.val(r),a.D.val(r),t+1)),r},prev:function(n,t){return t=t>23?23:t,a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n)+(t>=a.h.val(n)?-1:0),t)}},a.minute=a.m={name:"minute",range:60,val:function(n){return n.m||(n.m=a.date.getMin.call(n))},isValid:function(n,t){return a.m.val(n)===t},extent:function(n){return[0,59]},start:function(n){return n.mStart||(n.mStart=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n),a.m.val(n)))},end:function(n){return n.mEnd||(n.mEnd=a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n),a.m.val(n)))},next:function(n,t){var r=a.m.val(n),s=a.s.val(n),e=t>59?60-r:t<=r?60-r+t:t-r,i=new Date(n.getTime()+e*a.MIN-s*a.SEC);return!a.date.isUTC&&i.getTime()<=n.getTime()&&(i=new Date(n.getTime()+(e+120)*a.MIN-s*a.SEC)),i},prev:function(n,t){return t=t>59?59:t,a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n)+(t>=a.m.val(n)?-1:0),t)}},a.month=a.M={name:"month",range:2629740,val:function(n){return n.M||(n.M=a.date.getMonth.call(n)+1)},isValid:function(n,t){return a.M.val(n)===(t||12)},extent:function(){return[1,12]},start:function(n){return n.MStart||(n.MStart=a.date.next(a.Y.val(n),a.M.val(n)))},end:function(n){return n.MEnd||(n.MEnd=a.date.prev(a.Y.val(n),a.M.val(n)))},next:function(n,t){return t=t>12?1:t||12,a.date.next(a.Y.val(n)+(t>a.M.val(n)?0:1),t)},prev:function(n,t){return t=t>12?12:t||12,a.date.prev(a.Y.val(n)-(t>=a.M.val(n)?1:0),t)}},a.second=a.s={name:"second",range:1,val:function(n){return n.s||(n.s=a.date.getSec.call(n))},isValid:function(n,t){return a.s.val(n)===t},extent:function(){return[0,59]},start:function(n){return n},end:function(n){return n},next:function(n,t){var r=a.s.val(n),s=t>59?60-r:t<=r?60-r+t:t-r,e=new Date(n.getTime()+s*a.SEC);return!a.date.isUTC&&e.getTime()<=n.getTime()&&(e=new Date(n.getTime()+(s+7200)*a.SEC)),e},prev:function(n,t,r){return t=t>59?59:t,a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n),a.m.val(n)+(t>=a.s.val(n)?-1:0),t)}},a.time=a.t={name:"time",range:1,val:function(n){return n.t||(n.t=a.h.val(n)*3600+a.m.val(n)*60+a.s.val(n))},isValid:function(n,t){return a.t.val(n)===t},extent:function(){return[0,86399]},start:function(n){return n},end:function(n){return n},next:function(n,t){t=t>86399?0:t;var r=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)+(t<=a.t.val(n)?1:0),0,0,t);return!a.date.isUTC&&r.getTime()<n.getTime()&&(r=a.date.next(a.Y.val(r),a.M.val(r),a.D.val(r),a.h.val(r),a.m.val(r),t+7200)),r},prev:function(n,t){return t=t>86399?86399:t,a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)+(t>=a.t.val(n)?-1:0),0,0,t)}},a.weekOfMonth=a.wm={name:"week of month",range:604800,val:function(n){return n.wm||(n.wm=(a.D.val(n)+(a.dw.val(a.M.start(n))-1)+(7-a.dw.val(n)))/7)},isValid:function(n,t){return a.wm.val(n)===(t||a.wm.extent(n)[1])},extent:function(n){return n.wmExtent||(n.wmExtent=[1,(a.D.extent(n)[1]+(a.dw.val(a.M.start(n))-1)+(7-a.dw.val(a.M.end(n))))/7])},start:function(n){return n.wmStart||(n.wmStart=a.date.next(a.Y.val(n),a.M.val(n),Math.max(a.D.val(n)-a.dw.val(n)+1,1)))},end:function(n){return n.wmEnd||(n.wmEnd=a.date.prev(a.Y.val(n),a.M.val(n),Math.min(a.D.val(n)+(7-a.dw.val(n)),a.D.extent(n)[1])))},next:function(n,t){t=t>a.wm.extent(n)[1]?1:t;var r=a.date.nextRollover(n,t,a.wm,a.M),s=a.wm.extent(r)[1];return t=t>s?1:t||s,a.date.next(a.Y.val(r),a.M.val(r),Math.max(1,(t-1)*7-(a.dw.val(r)-2)))},prev:function(n,t){var r=a.date.prevRollover(n,t,a.wm,a.M),s=a.wm.extent(r)[1];return t=t>s?s:t||s,a.wm.end(a.date.next(a.Y.val(r),a.M.val(r),Math.max(1,(t-1)*7-(a.dw.val(r)-2))))}},a.weekOfYear=a.wy={name:"week of year (ISO)",range:604800,val:function(n){if(n.wy)return n.wy;var t=a.dw.next(a.wy.start(n),5),r=a.dw.next(a.Y.prev(t,a.Y.val(t)-1),5);return n.wy=1+Math.ceil((t.getTime()-r.getTime())/a.WEEK)},isValid:function(n,t){return a.wy.val(n)===(t||a.wy.extent(n)[1])},extent:function(n){if(n.wyExtent)return n.wyExtent;var t=a.dw.next(a.wy.start(n),5),r=a.dw.val(a.Y.start(t)),s=a.dw.val(a.Y.end(t));return n.wyExtent=[1,r===5||s===5?53:52]},start:function(n){return n.wyStart||(n.wyStart=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)-(a.dw.val(n)>1?a.dw.val(n)-2:6)))},end:function(n){return n.wyEnd||(n.wyEnd=a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n)+(a.dw.val(n)>1?8-a.dw.val(n):0)))},next:function(n,t){t=t>a.wy.extent(n)[1]?1:t;var r=a.dw.next(a.wy.start(n),5),s=a.date.nextRollover(r,t,a.wy,a.Y);a.wy.val(s)!==1&&(s=a.dw.next(s,2));var e=a.wy.extent(s)[1],i=a.wy.start(s);return t=t>e?1:t||e,a.date.next(a.Y.val(i),a.M.val(i),a.D.val(i)+7*(t-1))},prev:function(n,t){var r=a.dw.next(a.wy.start(n),5),s=a.date.prevRollover(r,t,a.wy,a.Y);a.wy.val(s)!==1&&(s=a.dw.next(s,2));var e=a.wy.extent(s)[1],i=a.wy.end(s);return t=t>e?e:t||e,a.wy.end(a.date.next(a.Y.val(i),a.M.val(i),a.D.val(i)+7*(t-1)))}},a.year=a.Y={name:"year",range:31556900,val:function(n){return n.Y||(n.Y=a.date.getYear.call(n))},isValid:function(n,t){return a.Y.val(n)===t},extent:function(){return[1970,2099]},start:function(n){return n.YStart||(n.YStart=a.date.next(a.Y.val(n)))},end:function(n){return n.YEnd||(n.YEnd=a.date.prev(a.Y.val(n)))},next:function(n,t){return t>a.Y.val(n)&&t<=a.Y.extent()[1]?a.date.next(t):a.NEVER},prev:function(n,t){return t<a.Y.val(n)&&t>=a.Y.extent()[0]?a.date.prev(t):a.NEVER}},a.fullDate=a.fd={name:"full date",range:1,val:function(n){return n.fd||(n.fd=n.getTime())},isValid:function(n,t){return a.fd.val(n)===t},extent:function(){return[0,3250368e7]},start:function(n){return n},end:function(n){return n},next:function(n,t){return a.fd.val(n)<t?new Date(t):a.NEVER},prev:function(n,t){return a.fd.val(n)>t?new Date(t):a.NEVER}},a.modifier={},a.modifier.after=a.modifier.a=function(n,t){var r=t[0];return{name:"after "+n.name,range:(n.extent(new Date)[1]-r)*n.range,val:n.val,isValid:function(s,e){return this.val(s)>=r},extent:n.extent,start:n.start,end:n.end,next:function(s,e){return e!=r&&(e=n.extent(s)[0]),n.next(s,e)},prev:function(s,e){return e=e===r?n.extent(s)[1]:r-1,n.prev(s,e)}}},a.modifier.before=a.modifier.b=function(n,t){var r=t[t.length-1];return{name:"before "+n.name,range:n.range*(r-1),val:n.val,isValid:function(s,e){return this.val(s)<r},extent:n.extent,start:n.start,end:n.end,next:function(s,e){return e=e===r?n.extent(s)[0]:r,n.next(s,e)},prev:function(s,e){return e=e===r?r-1:n.extent(s)[1],n.prev(s,e)}}},a.compile=function(n){var t=[],r=0,s;for(var e in n){var i=e.split("_"),o=i[0],l=i[1],u=n[e],c=l?a.modifier[l](a[o],u):a[o];t.push({constraint:c,vals:u}),r++}t.sort(function(g,p){var m=g.constraint.range,D=p.constraint.range;return D<m?-1:D>m?1:0}),s=t[r-1].constraint;function d(g){return g==="next"?function(p,m){return p.getTime()>m.getTime()}:function(p,m){return m.getTime()>p.getTime()}}return{start:function(g,p){for(var m=p,D=a.array[g],C=1e3,x;C--&&!x&&m;){x=!0;for(var S=0;S<r;S++){var R=t[S].constraint,M=R.val(m),h=R.extent(m),f=D(M,t[S].vals,h);if(!R.isValid(m,f)){m=R[g](m,f),x=!1;break}}}return m!==a.NEVER&&(m=g==="next"?s.start(m):s.end(m)),m},end:function(g,p){for(var m,D=a.array[g+"Invalid"],C=d(g),x=r-1;x>=0;x--){var S=t[x].constraint,R=S.val(p),M=S.extent(p),h=D(R,t[x].vals,M),f;h!==void 0&&(f=S[g](p,h),f&&(!m||C(m,f))&&(m=f))}return m},tick:function(g,p){return new Date(g==="next"?s.end(p).getTime()+a.SEC:s.start(p).getTime()-a.SEC)},tickSafe:function(g,p){return g==="next"?xt(s.end(p),1):xt(s.start(p),-1)},tickStart:function(g){return s.start(g)}}},a.schedule=function(n){if(!n)throw new Error("Missing schedule definition.");if(!n.schedules)throw new Error("Definition must include at least one schedule.");for(var t=[],r=n.schedules.length,s=[],e=n.exceptions?n.exceptions.length:0,i=0;i<r;i++)t.push(a.compile(n.schedules[i]));for(var o=0;o<e;o++)s.push(a.compile(n.exceptions[o]));function l(h,f,v,y,E){var T=R(h),A=f,w=1e6,b=[],j=[],O,k,W=[],le=h==="next",J,$n=le?0:1,ze=le?1:0;if(v=v?new Date(v):new Date,!v||!v.getTime())throw new Error("Invalid start date.");for(c(h,t,b,v),g(h,s,j,v);w--&&A&&(O=M(b,T))&&!(y&&T(O,y));){if(e&&(p(h,s,j,O),k=C(h,j,O))){d(h,t,b,k);continue}if(E){var Ln=x(j,T);k=S(h,t,b,O,Ln);var He=le?[new Date(Math.max(v,O)),k?new Date(y?Math.min(k,y):k):void 0]:[k?new Date(y?Math.max(y,k.getTime()+a.SEC):k.getTime()+a.SEC):void 0,new Date(Math.min(v,O.getTime()+a.SEC))];if(J&&He[$n].getTime()===J[ze].getTime()?(J[ze]=He[ze],A++):(J=He,W.push(J)),!k)break;d(h,t,b,k)}else W.push(le?new Date(Math.max(v,O)):D(t,b,O,y)),m(h,t,b,O);A--}for(var xe=0,Nn=W.length;xe<Nn;xe++){var Me=W[xe];W[xe]=Object.prototype.toString.call(Me)==="[object Array]"?[u(Me[0]),u(Me[1])]:u(Me)}return W.length===0?a.NEVER:f===1?W[0]:W}function u(h){if(h instanceof Date&&!isNaN(h.valueOf()))return new Date(h)}function c(h,f,v,y){for(var E=0,T=f.length;E<T;E++)v[E]=f[E].start(h,y)}function d(h,f,v,y){for(var E=R(h),T=0,A=f.length;T<A;T++)v[T]&&!E(v[T],y)&&(v[T]=f[T].start(h,y))}function g(h,f,v,y){for(var E=0,T=f.length;E<T;E++){var A=f[E].start(h,y);A?v[E]=[A,f[E].end(h,A)]:v[E]=a.NEVER}}function p(h,f,v,y){for(var E=R(h),T=0,A=f.length;T<A;T++)if(v[T]&&!E(v[T][0],y)){var w=f[T].start(h,y);w?v[T]=[w,f[T].end(h,w)]:v[T]=a.NEVER}}function m(h,f,v,y){for(var E=0,T=f.length;E<T;E++)if(v[E]&&v[E].getTime()===y.getTime()){const A=f[E].start(h,f[E].tick(h,y));A!==a.NEVER&&A.getTime()===v[E].getTime()?v[E]=f[E].start(h,f[E].tickSafe(h,y)):v[E]=A}}function D(h,f,v,y){for(var E,T=0,A=f.length;T<A;T++)if(f[T]&&f[T].getTime()===v.getTime()){var w=h[T].tickStart(v);if(y&&w<y)return y;(!E||w>E)&&(E=w)}return E}function C(h,f,v){for(var y=R(h),E,T=0,A=f.length;T<A;T++){var w=f[T];w&&!y(w[0],v)&&(!w[1]||y(w[1],v))&&(!E||y(w[1],E))&&(E=w[1])}return E}function x(h,f){for(var v,y=0,E=h.length;y<E;y++)h[y]&&(!v||f(v,h[y][0]))&&(v=h[y][0]);return v}function S(h,f,v,y,E){for(var T=R(h),A,w=0,b=f.length;w<b;w++){var j=v[w];if(j&&j.getTime()===y.getTime()){var O=f[w].end(h,j);if(E&&(!O||T(O,E)))return E;(!A||T(O,A))&&(A=O)}}return A}function R(h){return h==="next"?function(f,v){return!v||f.getTime()>v.getTime()}:function(f,v){return!f||v.getTime()>f.getTime()}}function M(h,f){for(var v=h[0],y=1,E=h.length;y<E;y++)h[y]&&f(v,h[y])&&(v=h[y]);return v}return{isValid:function(h){return l("next",1,h,h)!==a.NEVER},next:function(h,f,v){return l("next",h||1,f,v)},prev:function(h,f,v){return l("prev",h||1,f,v)},nextRange:function(h,f,v){return l("next",h||1,f,v,!0)},prevRange:function(h,f,v){return l("prev",h||1,f,v,!0)}}},a.setTimeout=function(n,t){var r=a.schedule(t),s;n&&e();function e(){var i=Date.now(),o=r.next(2,i);if(!o[0]){s=void 0;return}var l=o[0].getTime()-i;l<1e3&&(l=o[1]?o[1].getTime()-i:1e3),l<2147483647?s=setTimeout(n,l):s=setTimeout(e,2147483647)}return{isDone:function(){return!s},clear:function(){clearTimeout(s)}}},a.setInterval=function(n,t){if(!n)return;var r=a.setTimeout(e,t),s=r.isDone();function e(){s||(n(),r=a.setTimeout(e,t))}return{isDone:function(){return r.isDone()},clear:function(){s=!0,r.clear()}}},a.date={},a.date.timezone=function(n){a.date.build=n?function(s,e,i,o,l,u){return new Date(s,e,i,o,l,u)}:function(s,e,i,o,l,u){return new Date(Date.UTC(s,e,i,o,l,u))};var t=n?"get":"getUTC",r=Date.prototype;a.date.getYear=r[t+"FullYear"],a.date.getMonth=r[t+"Month"],a.date.getDate=r[t+"Date"],a.date.getDay=r[t+"Day"],a.date.getHour=r[t+"Hours"],a.date.getMin=r[t+"Minutes"],a.date.getSec=r[t+"Seconds"],a.date.isUTC=!n},a.date.UTC=function(){a.date.timezone(!1)},a.date.localTime=function(){a.date.timezone(!0)},a.date.UTC(),a.SEC=1e3,a.MIN=a.SEC*60,a.HOUR=a.MIN*60,a.DAY=a.HOUR*24,a.WEEK=a.DAY*7,a.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],a.NEVER=0,a.date.next=function(n,t,r,s,e,i){return a.date.build(n,t!==void 0?t-1:0,r!==void 0?r:1,s||0,e||0,i||0)},a.date.nextRollover=function(n,t,r,s){var e=r.val(n),i=r.extent(n)[1];return(t||i)<=e||t>i?new Date(s.end(n).getTime()+a.SEC):s.start(n)},a.date.prev=function(n,t,r,s,e,i){var o=arguments.length;return t=o<2?11:t-1,r=o<3?a.D.extent(a.date.next(n,t+1))[1]:r,s=o<4?23:s,e=o<5?59:e,i=o<6?59:i,a.date.build(n,t,r,s,e,i)},a.date.prevRollover=function(n,t,r,s){var e=r.val(n);return t>=e||!t?s.start(s.prev(n,s.val(n)-1)):s.start(n)},a.parse={},a.parse.cron=function(n,t){var r={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},s={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},e={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function i(S,R,M){return isNaN(S)?r[S]||null:Math.min(+S+(R||0),M||9999)}function o(S){var R={},M;for(M in S)M!=="dc"&&M!=="d"&&(R[M]=S[M].slice(0));return R}function l(S,R,M,h,f){var v=M;for(S[R]||(S[R]=[]);v<=h;)S[R].indexOf(v)<0&&S[R].push(v),v+=f||1;S[R].sort(function(y,E){return y-E})}function u(S,R,M,h){(R.d&&!R.dc||R.dc&&R.dc.indexOf(h)<0)&&(S.push(o(R)),R=S[S.length-1]),l(R,"d",M,M),l(R,"dc",h,h)}function c(S,R,M){var h={},f={};M===1?(l(R,"D",1,3),l(R,"d",r.MON,r.FRI),l(h,"D",2,2),l(h,"d",r.TUE,r.FRI),l(f,"D",3,3),l(f,"d",r.TUE,r.FRI)):(l(R,"D",M-1,M+1),l(R,"d",r.MON,r.FRI),l(h,"D",M-1,M-1),l(h,"d",r.MON,r.THU),l(f,"D",M+1,M+1),l(f,"d",r.TUE,r.FRI)),S.exceptions.push(h),S.exceptions.push(f)}function d(S,R,M,h,f,v){var y=S.split("/"),E=+y[1],T=y[0];if(T!=="*"&&T!=="0"){var A=T.split("-");h=i(A[0],v,f),f=i(A[1],v,f)||f}l(R,M,h,f,E)}function g(S,R,M,h,f,v){var y,E,T=R.schedules,A=T[T.length-1];S==="L"&&(S=h-1),(y=i(S,v,f))!==null?l(A,M,y,y):(y=i(S.replace("W",""),v,f))!==null?c(R,A,y):(y=i(S.replace("L",""),v,f))!==null?u(T,A,y,h-1):(E=S.split("#")).length===2?(y=i(E[0],v,f),u(T,A,y,i(E[1]))):d(S,A,M,h,f,v)}function p(S){return S.indexOf("#")>-1||S.indexOf("L")>0}function m(S,R){return p(S)&&!p(R)?1:S-R}function D(S){var R={schedules:[{}],exceptions:[]},M=S.replace(/(\s)+/g," ").split(" "),h,f,v,y;for(h in e)if(f=e[h],v=M[f[0]],v&&v!=="*"&&v!=="?"){y=v.split(",").sort(m);var E,T=y.length;for(E=0;E<T;E++)g(y[E],R,h,f[1],f[2],f[3])}return R}function C(S){var R=S.toUpperCase();return s[R]||R}var x=C(n);return D(t?x:"0 "+x)},a.parse.recur=function(){var n=[],t=[],r,s=n,e,i,o,l,u,c,d,g;function p(m,D,C){if(m=l?m+"_"+l:m,r||(s.push({}),r=s[0]),r[m]||(r[m]=[]),e=r[m],o){for(i=[],d=D;d<=C;d+=o)i.push(d);g={n:m,x:o,c:e.length,m:C}}i=u?[D]:c?[C]:i;var x=i.length;for(d=0;d<x;d+=1){var S=i[d];e.indexOf(S)<0&&e.push(S)}i=o=l=u=c=0}return{schedules:n,exceptions:t,on:function(){return i=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(m){return o=m||1,this},after:function(m){return l="a",i=[m],this},before:function(m){return l="b",i=[m],this},first:function(){return u=1,this},last:function(){return c=1,this},time:function(){for(var m=0,D=i.length;m<D;m++){var C=i[m].split(":");C.length<3&&C.push(0),i[m]=+C[0]*3600+ +C[1]*60+ +C[2]}return p("t"),this},second:function(){return p("s",0,59),this},minute:function(){return p("m",0,59),this},hour:function(){return p("h",0,23),this},dayOfMonth:function(){return p("D",1,c?0:31),this},dayOfWeek:function(){return p("d",1,7),this},onWeekend:function(){return i=[1,7],this.dayOfWeek()},onWeekday:function(){return i=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return p("dc",1,c?0:5),this},dayOfYear:function(){return p("dy",1,c?0:366),this},weekOfMonth:function(){return p("wm",1,c?0:5),this},weekOfYear:function(){return p("wy",1,c?0:53),this},month:function(){return p("M",1,12),this},year:function(){return p("Y",1970,2450),this},fullDate:function(){for(var m=0,D=i.length;m<D;m++)i[m]=i[m].getTime();return p("fd"),this},customModifier:function(m,D){var C=a.modifier[m];if(!C)throw new Error("Custom modifier "+m+" not recognized!");return l=m,i=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(m){var D=a[m];if(!D)throw new Error("Custom time period "+m+" not recognized!");return p(m,D.extent(new Date)[0],D.extent(new Date)[1]),this},startingOn:function(m){return this.between(m,g.m)},between:function(m,D){return r[g.n]=r[g.n].splice(0,g.c),o=g.x,p(g.n,m,D),this},and:function(){return r=s[s.push({})-1],this},except:function(){return s=t,r=null,this}}},a.parse.text=function(n){var t=a.parse.recur,r=0,s="",e,i={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},o={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(h,f,v,y){return{startPos:h,endPos:f,text:v,type:y}}function u(h){var f=h instanceof Array?h:[h],v=/\s+/,y,E,T,A,w,b;for(f.push(v),w=r;!y||y.type===v;){b=-1,E=s.substring(w),y=l(w,w,s.split(v)[0]);var j,O=f.length;for(j=0;j<O;j++)A=f[j],T=A.exec(E),T&&T.index===0&&T[0].length>b&&(b=T[0].length,y=l(w,w+b,E.substring(0,b),A));y.type===v&&(w=y.endPos)}return y}function c(h){var f=u(h);return r=f.endPos,f}function d(h){for(var f=+R(h),v=x(i.through)?+R(h):f,y=[],E=f;E<=v;E++)y.push(E);return y}function g(h){for(var f=d(h);x(i.and);)f=f.concat(d(h));return f}function p(h){var f,v,y,E;x(i.weekend)?h.on(o.sun,o.sat).dayOfWeek():x(i.weekday)?h.on(o.mon,o.tue,o.wed,o.thu,o.fri).dayOfWeek():(f=R(i.rank),h.every(f),v=C(h),x(i.start)?(f=R(i.rank),h.startingOn(f),S(v.type)):x(i.between)&&(y=R(i.rank),x(i.and)&&(E=R(i.rank),h.between(y,E))))}function m(h){x(i.first)?h.first():x(i.last)?h.last():h.on(g(i.rank)),C(h)}function D(h){r=0,s=h,e=-1;for(var f=t();r<s.length&&e<0;){var v=S([i.every,i.after,i.before,i.onthe,i.on,i.of,i.in,i.at,i.and,i.except,i.also]);switch(v.type){case i.every:p(f);break;case i.after:u(i.time).type!==void 0?(f.after(R(i.time)),f.time()):u(i.fullDate).type!==void 0?(f.after(R(i.fullDate)),f.fullDate()):(f.after(R(i.rank)),C(f));break;case i.before:u(i.time).type!==void 0?(f.before(R(i.time)),f.time()):u(i.fullDate).type!==void 0?(f.before(R(i.fullDate)),f.fullDate()):(f.before(R(i.rank)),C(f));break;case i.onthe:m(f);break;case i.on:f.on(g(i.dayName)).dayOfWeek();break;case i.of:f.on(g(i.monthName)).month();break;case i.in:f.on(g(i.yearIndex)).year();break;case i.at:for(f.on(R(i.time)).time();x(i.and);)f.on(R(i.time)).time();break;case i.and:break;case i.also:f.and();break;case i.except:f.except();break;default:e=r}}return{schedules:f.schedules,exceptions:f.exceptions,error:e}}function C(h){var f=S([i.second,i.minute,i.hour,i.dayOfYear,i.dayOfWeek,i.dayInstance,i.day,i.month,i.year,i.weekOfMonth,i.weekOfYear]);switch(f.type){case i.second:h.second();break;case i.minute:h.minute();break;case i.hour:h.hour();break;case i.dayOfYear:h.dayOfYear();break;case i.dayOfWeek:h.dayOfWeek();break;case i.dayInstance:h.dayOfWeekCount();break;case i.day:h.dayOfMonth();break;case i.weekOfMonth:h.weekOfMonth();break;case i.weekOfYear:h.weekOfYear();break;case i.month:h.month();break;case i.year:h.year();break;default:e=r}return f}function x(h){var f=u(h).type===h;return f&&c(h),f}function S(h){var f=c(h);return f.type?f.text=M(f.text,h):e=r,f}function R(h){return S(h).text}function M(h,f){var v=h;switch(f){case i.time:var y=h.split(/(:|am|pm)/),E=y[3]==="pm"&&y[0]<12?parseInt(y[0],10)+12:y[0],T=y[2].trim();v=(E.length===1?"0":"")+E+":"+T;break;case i.rank:v=parseInt(/^\d+/.exec(h)[0],10);break;case i.monthName:case i.dayName:v=o[h.substring(0,3)];break;case i.fullDate:v=new Date(h.toUpperCase());break}return v}return D(n.toLowerCase())},a}();L.date.localTime();function Mt(a){const n=[],t=[];let r;const s=function*(){for(r||(r=a[Symbol.iterator]());n.length&&(yield*n,n.length=0),!!r;){const{value:i,done:o}=r.next();if(o){r=null,a=null;break}t.push(i),yield i}},e=function*(){for(r||(r=a[Symbol.iterator]());t.length&&(yield*t,t.length=0),!!r;){const{value:i,done:o}=r.next();if(o){r=null,a=null;break}n.push(i),yield i}};return[s(),e()]}function*Hn(a,n){if(n<0)throw new Error("Batch size needs to a natural number");n=n|0;const t=[];for(const r of a)t.length===n&&(yield t,t.length=0),t.push(r);t.length>0&&(yield t)}function*Zn(a,n){let t=0;for(const r of a)n(r,t++)&&(yield r)}function*Kn(a,n){let t=0;for(const r of a)++t>n&&(yield r)}function Jn(a,n){let t=0;for(const r of a)if(!n(r,t++))return!1;return!0}function Gn(a,n){let t=0;for(const r of a)if(n(r,t++))return!0;return!1}function*Tt(a,n){let t=0;for(const r of a)yield n(r,t++)}function Xn(a,n,t){let r=0,s=t;for(const e of a)s=n(s,e,r++);return s}function*At(a){const n=new Set;for(const t of a)n.has(t)||(n.add(t),yield t)}function*Qn(a,n){const t=new Set;for(const r of a){const s=n(r);t.has(s)||(t.add(s),yield r)}}function*er(a,n){let t=0;for(const r of a)if(n(r,t++))yield r;else return}function*tr(...a){for(let n=0;n<a.length;n++)yield*a[n]}function*bt(a){for(const n of a)yield*n}class oe{constructor(n){if(this.iterable=void 0,!n)throw new Error("Require an iterable instance for chaining");this.iterable=n}derive(n){return this.iterable=void 0,new oe(n)}copy(){const[n,t]=Mt(this.iterable);return this.iterable=t,new oe(n)}split(){const[n,t]=Mt(this.iterable);return[new oe(n),this.derive(t)]}inBatchesBySize(n){return this.derive(Hn(this.iterable,n))}filter(n){return this.derive(Zn(this.iterable,n))}drop(n){return this.derive(Kn(this.iterable,n))}map(n){return this.derive(Tt(this.iterable,n))}reduce(n,t){return Xn(this,n,t)}concat(){return this.derive(bt(this.iterable))}uniqueOnly(){return this.derive(At(this.iterable))}uniqueOnlyBy(n){return this.derive(Qn(this.iterable,n))}every(n){return Jn(this,n)}some(n){return Gn(this,n)}takeWhile(n){return this.derive(er(this.iterable,n))}*[Symbol.iterator](){let n=this.iterable;if(!n)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*n,n=void 0}toArray(){return Array.from(this)}sort(n){return Array.from(this).sort(n)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const n of this);}memoize(){return new wt(this)}}const nr=a=>new oe(a),X=nr;class wt extends oe{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(n){this.$iterable=n}get iterable(){return this}derive(n){return new oe(n)}*[Symbol.iterator](){const n=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let t=this.$iterator,r=n.length;for(r>0&&(yield*n);;){if(n.length>r){for(let i=r;i<n.length;i++)yield n[i];r=n.length}if(!t)break;const{value:s,done:e}=t.next();e?(t=this.$iterator=null,this.$iterable=null):(n.push(s),r++,yield s)}}else yield*n}}const rr=a=>new wt(a),Pt=rr,Te=Symbol("MixinIdentity"),ye=Symbol("MixinStateProperty");class sr{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=Pt(this.linearizedByTopoLevels())}static new(n){const t=new this;return n&&Object.assign(t,n),t}get topoLevels(){return this.$topoLevels!==void 0?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort((n,t)=>n-t)}get elementsByTopoLevel(){return this.$elementsByTopoLevel!==void 0?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(n,t){let r=n.get(t);return r||(r=[],n.set(t,r)),r}buildElementsByTopoLevel(){let n=0;const t=this.baseEl?X(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,r=X(this.sourceEl.requirements).map(s=>s.walkDepthState.elementsByTopoLevel).concat().reduce((s,[e,i])=>(e>n&&(n=e),this.getOrCreateLevel(s,e).push(i),s),new Map);return this.getOrCreateLevel(r,n+1).push([this.sourceEl]),X(r).map(([s,e])=>[s,X(e).concat().uniqueOnly().filter(i=>!t.has(i)).sort((i,o)=>i.id-o.id)]).toMap()}*linearizedByTopoLevels(){yield*X(this.topoLevels).map(n=>this.elementsByTopoLevel.get(n)).concat()}}let jt=1;const ir=a=>class extends a{};class Ae{}class Je{constructor(){this.id=jt++,this.requirements=[],this.baseClass=Ae,this.identitySymbol=void 0,this.mixinLambda=ir,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(n){const t=new this;n&&Object.assign(t,n),t.walkDepthState=sr.new({sourceEl:t,baseEl:or(t.baseClass)});const r=t.mixinLambda,s=t.identitySymbol=Symbol(r.name),e=Object.assign(function(i){const o=r(i);return o.prototype[s]=!0,o},{[Te]:s,[ye]:t});return Object.defineProperty(e,Symbol.hasInstance,{value:Ft}),t.mixinLambda=e,t}get minimalClass(){return this.$minimalClass!==void 0?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(n){const t=this.constructor,r=t.baseClassesIds.get(n);if(r!==void 0)return r;const s=jt++;return t.baseClassesIds.set(n,s),s}buildMinimalClass(){const n=this.constructor;let t=this.baseClass;const r=this.walkDepthState.linearizedByTopoLevelsSource.reduce((e,i)=>{const{cls:o,hash:l}=e,u=l+String.fromCharCode(i.id);let c=n.minimalClassesByLinearHash.get(u);return c||(c=i.mixinLambda(o),i.name=c.name,n.minimalClassesByLinearHash.set(u,c)),e.cls=c,e.hash=u,e},{cls:t,hash:String.fromCharCode(this.getBaseClassMixinId(t))}).cls,s=Object.assign(r,{[Te]:this.identitySymbol,[ye]:this,mix:this.mixinLambda,derive:e=>P([s,e],i=>class extends i{}),$:this,toString:this.toString.bind(this)});return Object.defineProperty(s,Symbol.hasInstance,{value:Ft}),s}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce((n,t)=>`${t.name}(${n})`,this.baseClass.name)}}Je.minimalClassesByLinearHash=new Map,Je.baseClassesIds=new Map;const ar=a=>Object.getPrototypeOf(a.prototype).constructor.hasOwnProperty(ye),or=a=>Object.getPrototypeOf(a.prototype).constructor[ye],Ot=(a,n)=>{let t;if(a.length>0){const e=a[a.length-1];!ar(e)&&e!==Ae&&(t=e)}const r=[];return a.forEach((e,i)=>{const o=e[ye];if(o!==void 0){const l=o.baseClass;if(l!==Ae)if(t){if(t!==l){const u=l.prototype.isPrototypeOf(t.prototype),c=t.prototype.isPrototypeOf(l.prototype);if(!u&&!c)throw new Error("Base class mismatch");t=c?l:t}}else t=l;r.push(o)}else if(i!==a.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}),Je.new({requirements:r,mixinLambda:n,baseClass:t||Ae}).minimalClass},Ft=function(a){return!!(a&&a[this[Te]])},U=(a,n)=>!!(a&&a[n[Te]]),P=Ot,lr=Ot;var he;(function(a){a.Millisecond="millisecond",a.Second="second",a.Minute="minute",a.Hour="hour",a.Day="day",a.Week="week",a.Month="month",a.Quarter="quarter",a.Year="year"})(he||(he={}));var Ge;(function(a){a.MustStartOn="muststarton",a.MustFinishOn="mustfinishon",a.StartNoEarlierThan="startnoearlierthan",a.StartNoLaterThan="startnolaterthan",a.FinishNoEarlierThan="finishnoearlierthan",a.FinishNoLaterThan="finishnolaterthan",a.AsSoonAsPossible="assoonaspossible",a.AsLateAsPossible="aslateaspossible"})(Ge||(Ge={}));var Xe;(function(a){a.Normal="Normal",a.FixedDuration="FixedDuration",a.FixedEffort="FixedEffort",a.FixedUnits="FixedUnits"})(Xe||(Xe={}));var Qe;(function(a){a[a.NoError=0]="NoError",a[a.CyclicDependency=1]="CyclicDependency",a[a.DuplicatingDependency=2]="DuplicatingDependency"})(Qe||(Qe={}));var et;(function(a){a[a.StartToStart=0]="StartToStart",a[a.StartToEnd=1]="StartToEnd",a[a.EndToStart=2]="EndToStart",a[a.EndToEnd=3]="EndToEnd"})(et||(et={}));var tt;(function(a){a.Project="Project",a.FromEvent="FromEvent",a.ToEvent="ToEvent"})(tt||(tt={}));var nt;(function(a){a[a.SchedulerBasic=1]="SchedulerBasic",a[a.SchedulerPro=2]="SchedulerPro",a[a.Gantt=3]="Gantt"})(nt||(nt={}));var rt;(function(a){a.Forward="Forward",a.Backward="Backward",a.None="None"})(rt||(rt={}));const ur=(a,n)=>a&&!n||!a&&n?!1:!a&&!n?!0:a.direction===n.direction&&(a.kind==="own"&&n.kind==="own"||a.kind==="enforced"&&n.kind==="enforced"&&a.enforcedBy===n.enforcedBy||a.kind==="inherited"&&n.kind==="inherited"&&a.inheritedFrom===n.inheritedFrom);var st;(function(a){a.Start="Start",a.End="End"})(st||(st={}));const se=new Date(-864e13),Q=new Date(864e13),cr=a=>{if(!a)return!1;const n=a.getTime();return n!==se.getTime()&&n!==Q.getTime()};var ie;(function(a){a[a.Left=0]="Left",a[a.Right=1]="Right"})(ie||(ie={}));var Y;(function(a){a[a.FullRangeIterated=0]="FullRangeIterated",a[a.StoppedByIterator=1]="StoppedByIterator",a[a.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",a[a.MaxRangeReached=3]="MaxRangeReached"})(Y||(Y={}));class kt{constructor(n){this.cacheFilledStartDate=Q,this.cacheFilledEndDate=se,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=he.Day,this.maxCacheExtendCycles=1e3,this.maxRange=5*365*24*60*60*1e3,n&&Object.assign(this,n)}includeWrappingRangeFrom(n,t,r){n.ensureCacheFilledForInterval(t,r),this.intervalCache.includeWrappingRange(n.intervalCache,t,r)}ensureCacheFilledForInterval(n,t){const r=this.cacheFilledStartDate.getTime(),s=this.cacheFilledEndDate.getTime();if(r!==Q.getTime()){const e=n.getTime(),i=t.getTime();if(r<=e&&i<=s)return;if(i<=r)t=new Date(r-1);else if(e>=s)n=new Date(s);else if(r<=e&&e<=s)n=new Date(s+1);else if(r<=i&&i<=s)t=new Date(r-1);else{this.ensureCacheFilledForInterval(n,new Date(r-1)),this.ensureCacheFilledForInterval(new Date(s+1),t);return}}(r===Q.getTime()||n.getTime()<s)&&(this.cacheFilledStartDate=n),(s===se.getTime()||s<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(n,t)}fillCache(n,t){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=Q,this.cacheFilledEndDate=se,this.intervalCache.clear()}forEachAvailabilityInterval(n,t,r){var m;r=r||this;const s=n.startDate,e=n.endDate,i=s&&s.getTime(),o=e&&e.getTime(),l=(m=n.maxRange)!=null?m:this.maxRange,u=n.isForward!==!1;if(u?!s:!e)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const c=this.intervalCache;let d=u?s:e,g=u?s:e;const p=g.getTime();for(let D=1;D<this.maxCacheExtendCycles;D++){u?this.ensureCacheFilledForInterval(d,e||I.add(d,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(s||I.add(d,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),d);let C=c.getIntervalOf(g,u?ie.Left:ie.Right);for(;C;){const x=C.startDate,S=C.endDate;if(u&&o&&x.getTime()>=o||!u&&i&&S.getTime()<=i)return Y.FullRangeIterated;if(u&&x.getTime()-p>=l||!u&&p-S.getTime()>=l)return Y.MaxRangeReached;if(u&&x.getTime()>=this.cacheFilledEndDate.getTime()||!u&&S.getTime()<=this.cacheFilledStartDate.getTime())break;g=u?S:x;const R=i&&x.getTime()<i?s:x,M=o&&S.getTime()>o?e:S;if(t.call(r,R,M,C.cacheInterval)===!1)return Y.StoppedByIterator;C=u?c.getNextInterval(C):c.getPrevInterval(C)}if(u&&g.getTime()===Q.getTime()||!u&&g.getTime()===se.getTime())return Y.FullRangeIterated;d=u?this.cacheFilledEndDate:this.cacheFilledStartDate}return Y.MaxCacheExtendCyclesReached}}const $t=a=>Array.from(new Set(a));class Ie{constructor(n){if(this.intervals=[],n&&Object.assign(this,n),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(n){if(this.intervals.indexOf(n)==-1){const t=this.intervals.slice();return t.push(n),new Ie({intervals:t,calendar:this.calendar})}else return this}combineWith(n){return new Ie({intervals:this.intervals.concat(n.intervals),calendar:this.calendar})}getIsWorking(){if(this.isWorking!=null)return this.isWorking;const n=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=n[0].isWorking}normalizeIntervals(n){const t=$t(n);return t.sort((r,s)=>s.getPriorityField()-r.getPriorityField()),t}}const Se=(a,n,t=(r,s)=>r-s)=>{let r=0,s=n.length;for(;r<s;){const e=(r+s)/2|0,i=t(a,n[e]);if(i===0)return{found:!0,index:e};i<0?s=e:r=e+1}return{found:!1,index:s}};var ae;(function(a){a[a.Exact=0]="Exact",a[a.Next=1]="Next"})(ae||(ae={}));class Lt{constructor(n){this.keys=[],this.values=[],this.comparator=n||((t,r)=>t-r)}set(n,t){const r=Se(n,this.keys,this.comparator);return r.found?this.values[r.index]=t:(this.keys.splice(r.index,0,n),this.values.splice(r.index,0,t)),r.index}insertAt(n,t,r){this.keys.splice(n,0,t),this.values.splice(n,0,r)}setValueAt(n,t){this.values[n]=t}get(n){const t=Se(n,this.keys,this.comparator);return t.found?this.values[t.index]:void 0}getEntryAt(n){return n<this.keys.length?{key:this.keys[n],value:this.values[n]}:void 0}getKeyAt(n){return this.keys[n]}getValueAt(n){return this.values[n]}delete(n){const t=Se(n,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}size(){return this.keys.length}deleteAt(n){this.keys.splice(n,1),this.values.splice(n,1)}indexOfKey(n){const t=Se(n,this.keys,this.comparator);return{found:t.found?ae.Exact:ae.Next,index:t.index}}map(n){const t=this.keys,r=this.values,s=[];for(let e=0;e<t.length;e++)s.push(n(r[e],t[e],e));return s}getAllEntries(){return this.map((n,t)=>({value:n,key:t}))}clear(){this.keys.length=0,this.values.length=0}}class Nt{constructor(n){if(this.points=new Lt((t,r)=>t.getTime()-r.getTime()),this.leftInfinityKey=se,this.rightInfinityKey=Q,Object.assign(this,n),this.emptyInterval===void 0||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(n){return this.points.indexOfKey(n)}getDateAt(n){return this.points.getKeyAt(n)}getPointAt(n){return this.points.getValueAt(n)}getIntervalOf(n,t=ie.Left){let{found:r,index:s}=this.indexOf(n),e;return t===ie.Left?e=r===ae.Exact?s:s-1:e=s-1,this.getIntervalWithStartDateIndex(e)}getPrevInterval(n){return n.startDateIndex===0?null:this.getIntervalWithStartDateIndex(n.startDateIndex-1)}getNextInterval(n){return n.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(n.startDateIndex+1)}getIntervalWithStartDateIndex(n){return{startDateIndex:n,startDate:this.getDateAt(n),endDate:n+1<this.size()?this.getDateAt(n+1):this.rightInfinityKey,cacheInterval:this.getPointAt(n)}}addInterval(n,t,r){const s=this.points,{found:e,index:i}=s.indexOfKey(n);let o,l;if(e==ae.Exact){const u=r(l=s.getValueAt(i));s.setValueAt(i,u),o=i+1}else{const u=r(l=s.getValueAt(i-1));s.insertAt(i,n,u),o=i+1}for(;o<s.size()&&!(s.getKeyAt(o).getTime()>=t.getTime());){const c=r(l=s.getValueAt(o));s.setValueAt(o,c),o++}o===s.size()?s.insertAt(s.size(),t,this.emptyInterval):s.getKeyAt(o).getTime()===t.getTime()||s.insertAt(o,t,l)}includeWrappingRange(n,t,r){let s=n.getIntervalOf(t);for(;s&&(this.addInterval(s.startDate,s.endDate,e=>this.combineIntervalsFn(e,s.cacheInterval)),!(s.endDate.getTime()>r.getTime()));)s=n.getNextInterval(s)}getSummary(){return this.points.map((n,t)=>({label:n,date:t}))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}class Bt extends kt{constructor(n){if(super(n),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new Nt({emptyInterval:new Ie({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(t,r)=>t.combineWith(r)})}fillCache(n,t){var r;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,n,t);const s=n.getTime(),e=t.getTime(),i=this.calendar.ignoreTimeZone?null:(r=this.calendar.project)===null||r===void 0?void 0:r.timeZone;if(s>e)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval(o=>{const l=o.getStartDateSchedule(),u=o.getEndDateSchedule();let c=l.prev(1,n),d;if(u==="EOD"){const m=l.next(1,t);m!==L.NEVER?d=I.getStartOfNextDay(m,!0):d=L.NEVER}else d=u.next(1,t);if(c!==L.NEVER&&c.getTime()===s){const m=l.prev(2,n);m!==L.NEVER&&m.length===2&&(c=m[1])}if(d!==L.NEVER&&d.getTime()===e){const m=u.next(2,t);m!==L.NEVER&&m.length===2&&(d=m[1])}const g=l.next(1/0,c!==L.NEVER?c:n,d!==L.NEVER?new Date(d.getTime()-1):t);if(g===L.NEVER)return;const p=u==="EOD"?g.map(m=>I.getStartOfNextDay(m,!0)):u.next(1/0,new Date(g[0].getTime()+1),d!==L.NEVER?d:t);p!==L.NEVER&&(p.length>g.length?p.length=g.length:p.length<g.length&&(g.length=p.length),g.forEach((m,D)=>{let C=m,x=p[D];i!=null&&(C=z.toTimeZone(C,i),x=z.toTimeZone(x,i)),this.intervalCache.addInterval(C,x,S=>S.includeInterval(o))}))})}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval(n=>{var t;const r=(t=this.calendar.project)===null||t===void 0?void 0:t.timeZone;let{startDate:s,endDate:e}=n;r!=null&&(s=z.toTimeZone(s,r),e=z.toTimeZone(e,r)),this.intervalCache.addInterval(s,e,i=>i.includeInterval(n))})}forEachStaticInterval(n){this.intervalStore.forEach(t=>{t.isStatic()&&n(t)})}forEachRecurrentInterval(n){this.intervalStore.forEach(t=>{t.isRecurrent()&&n(t)})}}class be extends P([],n=>{n.prototype;class t extends n{async commitAsync(){return this.project.commitAsync()}set project(s){this.$project=s}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(s){return this.project=s}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const s=this.getProject();return s==null?void 0:s.assignmentStore}getDependencyStore(){const s=this.getProject();return s==null?void 0:s.dependencyStore}getEventStore(){const s=this.getProject();return s==null?void 0:s.eventStore}getResourceStore(){const s=this.getProject();return s==null?void 0:s.resourceStore}getCalendarManagerStore(){const s=this.getProject();return s==null?void 0:s.calendarManagerStore}}return t}){}class q extends P([be,N],n=>{const t=n.prototype;class r extends n{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}static get $name(){return"AbstractPartOfProjectStoreMixin"}construct(e={}){return e.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},t.construct.call(this,e)}trigger(e,i){const o=this,{asyncEvents:l,project:u}=o,c=l==null?void 0:l[e];return c&&(c===!0||c[i.action])?(t.trigger.call(o,`${e}PreCommit`,{...i}),!u||u.isEngineReady()&&!u.isWritingData?t.trigger.call(o,e,i):!o.eventsSuspended&&u&&(u.dataReadyDetacher||(u.queuedDataReadyEvents=[],u.dataReadyDetacher=u.ion({dataReady(){this.queuedDataReadyEvents.forEach(([g,p,m,D])=>{g.trigger.call(p,m,D)}),u.queuedDataReadyEvents=null,u.dataReadyDetacher(),u.dataReadyDetacher=null},once:!0})),u.queuedDataReadyEvents.push([t,o,e,i])),!0):t.trigger.call(o,e,i)}calculateProject(){return this.project}setStoreData(e){var i;this.project&&!(this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag)&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,t.setStoreData.call(this,e),this.isLoadingData=!1,(i=this.project)===null||i===void 0||i.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),t.doAutoCommit.call(this)}async addAsync(e,i){const o=this.add(e,i);return await this.project.commitAsync(),o}async insertAsync(e,i,o){const l=this.insert(e,i,o);return await this.project.commitAsync(),l}async loadDataAsync(e){this.data=e,await this.project.commitAsync()}performFilter(){var e;return this.project&&(this.isLoadingData||(e=this.rootNode)!==null&&e!==void 0&&e.isLoading)&&this.project.commitAsync().then(()=>this.filter()),super.performFilter(...arguments)}}return r}){}class De extends P([be,B],n=>{const t=n.prototype;class r extends n{joinStore(e){let i=null;if(U(e,q)){const o=e.getProject();o&&!this.getProject()&&(this.setProject(o),i=o)}t.joinStore.call(this,e),i&&!i.isRepopulatingStores&&this.joinProject()}unjoinStore(e,i=!1){t.unjoinStore.call(this,e,i);const{project:o}=this,l=U(e,q)&&!e.isFillingFromMaster&&o===(e.isChained&&e.project?e.masterStore.project:e.project);o&&!o.isDestroying&&!o.isRepopulatingStores&&l&&(this.leaveProject(i),this.setProject(null)),l&&(this.graph=null)}joinProject(){}leaveProject(e=!1){}calculateProject(){const e=this.stores.find(i=>U(i,q)&&!!i.getProject());return e==null?void 0:e.getProject()}async setAsync(e,i,o){var l;const u=this.set(e,i,o);return await((l=this.project)===null||l===void 0?void 0:l.commitAsync()),u}async getAsync(e){var i;return await((i=this.project)===null||i===void 0?void 0:i.commitAsync()),this.get(e)}get isStmRestoring(){const e=this.getProject();return(e==null?void 0:e.isRestoringData)||(e==null?void 0:e.stm.isRestoring)||!1}}return r}){}class it extends P([De],n=>{n.prototype;class t extends n{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(this.priorityField!=null)return this.priorityField;let s=1e4+this.getCalendar().getDepth()*100,e=this.priority;return e==null&&(e=this.isRecurrent()?20:30),this.priorityField=s+e}isRecurrent(){return!!(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return!!(this.startDate&&this.endDate)}parseDateSchedule(s){let e=s;if(s&&s!==Object(s)&&(e=L.parse.text(s),e!==Object(e)||e.error>=0))try{e=JSON.parse(s)}catch(i){return null}return e}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const s=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=L.schedule(s)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if(this.recurrentEndDate==="EOD")return"EOD";const s=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=L.schedule(s)}}return t}){}class _t extends P([q],n=>{n.prototype;class t extends n{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:it}}}return t}){}class Vt extends P([it],n=>{n.prototype;class t extends n{getCalendar(){return this.calendar}getPriorityField(){return this.priorityField!=null?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}return t}){}class we extends P([be],n=>{n.prototype;class t extends n{get eventStore(){var s;return(s=this.project)===null||s===void 0?void 0:s.eventStore}get resourceStore(){var s;return(s=this.project)===null||s===void 0?void 0:s.resourceStore}get assignmentStore(){var s;return(s=this.project)===null||s===void 0?void 0:s.assignmentStore}get dependencyStore(){var s;return(s=this.project)===null||s===void 0?void 0:s.dependencyStore}get calendarManagerStore(){var s;return(s=this.project)===null||s===void 0?void 0:s.calendarManagerStore}getEventById(s){var e;return(e=this.eventStore)===null||e===void 0?void 0:e.getById(s)}getDependencyById(s){var e;return(e=this.dependencyStore)===null||e===void 0?void 0:e.getById(s)}getResourceById(s){var e;return(e=this.resourceStore)===null||e===void 0?void 0:e.getById(s)}getAssignmentById(s){var e;return(e=this.assignmentStore)===null||e===void 0?void 0:e.getById(s)}getCalendarById(s){var e;return(e=this.calendarManagerStore)===null||e===void 0?void 0:e.getById(s)}}return t}){}class Yt extends P([De],n=>{const t=n.prototype;class r extends n{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls"]}get intervalStoreClass(){return _t}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(e){e.storeClass=this.intervalStoreClass,e.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,e.calendar=this}processIntervalsStoreData(e){this.bumpVersion()}isDefault(){const e=this.getProject();return e?this===e.defaultCalendar:!1}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(e,i,o){var l;const u=(l=this.getProject())===null||l===void 0?void 0:l.maxCalendarRange;return u&&(e=Object.assign({maxRange:u},e)),this.calendarCache.forEachAvailabilityInterval(e,i,o)}accumulateWorkingTime(e,i,o){var d;var l;if(i===0)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(i))throw new Error("Invalid duration");let u=e;const c=(d=(l=this.getProject())===null||l===void 0?void 0:l.adjustDurationToDST)!=null?d:!1;return this.forEachAvailabilityInterval(o?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},(g,p,m)=>{let D=!0;if(m.getIsWorking()){let C=p.getTime()-g.getTime();if(i<=C){if(c){const x=o?g.getTimezoneOffset()-new Date(g.getTime()+i).getTimezoneOffset():new Date(p.getTime()-i).getTimezoneOffset()-p.getTimezoneOffset();i-=x*60*1e3}u=o?new Date(g.getTime()+i):new Date(p.getTime()-i),i=0,D=!1}else{if(c){const x=g.getTimezoneOffset()-p.getTimezoneOffset();C+=x*60*1e3}u=o?p:g,i-=C}}return D}),{finalDate:new Date(u),remainingDurationInMs:i}}calculateDurationMs(e,i,o=!1){let l=0;const u=e.getTime()<=i.getTime()||!o?1:-1;u<0&&([e,i]=[i,e]);const c=this.getProject().adjustDurationToDST;return this.forEachAvailabilityInterval({startDate:e,endDate:i},(d,g,p)=>{if(p.getIsWorking()&&(l+=g.getTime()-d.getTime(),c)){const m=d.getTimezoneOffset()-g.getTimezoneOffset();l+=m*60*1e3}}),l*u}calculateEndDate(e,i){const o=i>=0,l=this.accumulateWorkingTime(e,Math.abs(i),o);return l.remainingDurationInMs===0?l.finalDate:null}calculateStartDate(e,i){const o=i<=0,l=this.accumulateWorkingTime(e,Math.abs(i),o);return l.remainingDurationInMs===0?l.finalDate:null}skipNonWorkingTime(e,i=!0){let o;const l=this.forEachAvailabilityInterval(i?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},(u,c,d)=>{if(d.getIsWorking())return o=i?u:c,!1});return l===Y.MaxRangeReached||l===Y.FullRangeIterated?"empty_calendar":o?new Date(o):new Date(e)}addInterval(e){return this.addIntervals([e])}addIntervals(e){return this.bumpVersion(),this.intervalStore.add(e)}removeInterval(e){return this.removeIntervals([e])}removeIntervals(e){return this.bumpVersion(),this.intervalStore.remove(e)}clearIntervals(e){return e||this.bumpVersion(),this.intervalStore.removeAll(e)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(this.$calendarCache!==void 0)return this.$calendarCache;const e=new Vt({isWorking:this.unspecifiedTimeIsWorking});return e.calendar=this,this.$calendarCache=new Bt({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse(e=>{e.intervalStore.forEach(i=>i.resetPriority())})}insertChild(e,i,o){let l=t.insertChild.call(this,...arguments);return Array.isArray(l)||(l=[l]),l.forEach(u=>{u.bumpVersion(),u.resetPriorityOfAllIntervals()}),l}joinProject(){t.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){t.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(e){const i=I.clearTime(e),o=I.getNext(e,he.Day);let l=!1;return this.forEachAvailabilityInterval({startDate:i,endDate:o,isForward:!0},(u,c,d)=>(l=d.getIsWorking(),!l)),!l}getDailyHolidaysRanges(e,i){const o=[];for(e=I.clearTime(e);e<i;)this.isDayHoliday(e)&&o.push({startDate:e,endDate:I.getStartOfNextDay(e,!0,!0)}),e=I.getNext(e,he.Day);return o}getWorkingTimeRanges(e,i){const o=[];return this.forEachAvailabilityInterval({startDate:e,endDate:i,isForward:!0},(l,u,c)=>{if(c.getIsWorking()){const d=c.intervals[0];o.push({name:d.name,startDate:l,endDate:u})}}),o}getNonWorkingTimeRanges(e,i){const o=[];return this.forEachAvailabilityInterval({startDate:e,endDate:i,isForward:!0},(l,u,c)=>{if(!c.getIsWorking()){const d=c.intervals[0];o.push({name:d.name,iconCls:d.iconCls,cls:d.cls,startDate:l,endDate:u})}}),o}isWorkingTime(e,i,o){if(o){let l;const u=this.forEachAvailabilityInterval({startDate:e,endDate:i,isForward:!0},(c,d,g)=>{if(g.getIsWorking()&&c<=e&&d>=i)return l=!0,!1});return u===Y.MaxRangeReached||u===Y.FullRangeIterated?!1:l}else{const l=this.skipNonWorkingTime(e);return l&&l!=="empty_calendar"?i?l<i:l.getTime()===e.getTime():!1}}}return r}){}class Ut extends P([De],n=>{const t=n.prototype;class r extends n{getAssignmentFor(e){var i;for(const o of(i=this.assigned)!=null?i:[])if(o.resource===e)return o;return null}isAssignedTo(e){return!!this.getAssignmentFor(e)}async assign(e){const i=this.project.assignmentStore.modelClass;return this.addAssignment(new i({event:this,resource:e})),this.commitAsync()}async unassign(e){const i=this.getAssignmentFor(e);return this.removeAssignment(i),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const e=this.getEventStore();this.assigned.forEach(i=>e.assignmentsForRemoval.add(i))}t.leaveProject.call(this,...arguments)}remove(){if(this.parent){const e=this.getEventStore();t.remove.call(this),e&&e.afterEventRemoval()}else return t.remove.call(this)}addAssignment(e){return this.getProject().assignmentStore.add(e),e}removeAssignment(e){return this.getProject().assignmentStore.remove(e),e}}return r}){}class ge extends P([De,we,B],n=>{const t=n.prototype;class r extends n{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(e=!1){var i;t.leaveProject.call(this,e),(i=this.project)===null||i===void 0||i.bufferedCommitAsync()}invalidate(){var e;(e=this.project)===null||e===void 0||e.invalidate(this)}getCurrentOrProposed(e){var i;return e in this.$changed&&this.$changed[e]!==!0?this.$changed[e]:(i=this.get(e))!=null?i:null}hasCurrentOrProposed(e){return e in this.$changed&&this.$changed[e]!=!0||this.get(e)!=null}propose(e){var i;if(this.project||(i=this.recurringTimeSpan)!==null&&i!==void 0&&i.project){const o=Object.keys(e);for(let l=0;l<o.length;l++){const u=o[l];this.$changed[u]=e[u]}this.invalidate()}else this.set(e)}setChanged(e,i,o=!0,l=!1){const u=this;u.$changed[e]=i,l&&(e in u.$beforeChange||(u.$beforeChange[e]=u.get(e)),u.setData(e,i)),o&&u.invalidate()}calculateInvalidated(){}finalizeInvalidated(e=!1){const i=this;i.$isCalculating=!0,e?i.setData(i.$changed):(i.setData(i.$beforeChange),i.set(i.$changed)),i.$changed={},i.$beforeChange={},i.$isCalculating=!1}}return r}){}const dr=a=>Number(a)!==a,at=a=>a instanceof Set||a instanceof Array?X(a):X([a]),qt=a=>new Promise(n=>setTimeout(n,a)),hr=(a,...n)=>a.replace(/{(\d+)}/g,(t,r)=>typeof n[r]!="undefined"?n[r]:t);class Wt extends P([q],n=>{const t=n.prototype;class r extends n{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(e,i){this.assignmentsForRemoval=at(e).toSet();const o=t.remove.call(this,e,i);return this.assignmentsForRemoval.clear(),o}removeAll(e){this.allAssignmentsForRemoval=!0;const i=t.removeAll.call(this,e);return this.allAssignmentsForRemoval=!1,i}}return r}){}class zt extends P([q],n=>{n.prototype;class t extends n{doDestroy(){var s;const e=[];(s=this.rootNode)!==null&&s!==void 0&&s.isDestroyed||this.traverse(i=>e.push(i)),super.doDestroy(),e.forEach(i=>i.destroy())}}return t}){}class Ht extends P([q],n=>{const t=n.prototype;class r extends n{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(e,i){this.dependenciesForRemoval=at(e).toSet();const o=t.remove.call(this,e,i);return this.dependenciesForRemoval.clear(),o}removeAll(e){this.allDependenciesForRemoval=!0;const i=t.removeAll.call(this,e);return this.allDependenciesForRemoval=!1,i}}return r}){}const gr={splice:1,clear:1};class Zt extends P([q],n=>{const t=n.prototype;class r extends n{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(e){var i;const o=gr[e.action];super.onDataChange(e),o&&(i=e.removed)!==null&&i!==void 0&&i.length&&this.afterEventRemoval()}remove(e,i){const o=t.remove.call(this,e,i);return this.afterEventRemoval(),o}removeAll(e){const i=t.removeAll.call(this,e);return this.afterEventRemoval(),i}onNodeRemoveChild(e,i,o,l){const u=t.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),u}afterEventRemoval(){const{assignmentsForRemoval:e,dependenciesForRemoval:i}=this;if(!e)return;const o=this.getAssignmentStore();if(o&&!o.allAssignmentsForRemoval&&e.size){const u=[...e].filter(c=>!o.assignmentsForRemoval.has(c));u.length>0&&o.remove(u)}e.clear();const l=this.getDependencyStore();if(l&&!l.allDependenciesForRemoval&&i.size){const u=[...i].filter(c=>!l.dependenciesForRemoval.has(c));u.length>0&&l.remove(u)}i.clear()}processRecord(e,i=!1){var o;if(!((o=this.project)!==null&&o!==void 0&&o.isRepopulatingStores)){const l=this.getById(e.id);if(l&&l!==e&&l.assigned)for(const c of l.assigned)c.event=e}return e}}return r}){}const fr={splice:1,clear:1};class Kt extends P([q],n=>{const t=n.prototype;class r extends n{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(e){var i;const o=fr[e.action];super.onDataChange(e),o&&(i=e.removed)!==null&&i!==void 0&&i.length&&this.afterResourceRemoval()}remove(e,i){const o=t.remove.call(this,e,i);return this.afterResourceRemoval(),o}removeAll(e){const i=t.removeAll.call(this,e);return this.afterResourceRemoval(),i}afterResourceRemoval(){const e=this.getAssignmentStore();if(e&&!e.allAssignmentsForRemoval){const i=[...this.assignmentsForRemoval].filter(o=>!e.assignmentsForRemoval.has(o));i.length>0&&e.remove(i)}this.assignmentsForRemoval.clear()}processRecord(e,i=!1){const o=this.getById(e.id);if(o&&o!==e)for(const u of o.assigned||[])u.resource=e;return e}}return r}){}class H extends P([ge],n=>{const t=n.prototype;class r extends n{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var e,i;return(i=(e=this._startDate)!=null?e:this.get("startDate"))!=null?i:null}get endDate(){var e,i;return(i=(e=this._endDate)!=null?e:this.get("endDate"))!=null?i:null}get duration(){var e,i;return(i=(e=this._duration)!=null?e:this.get("duration"))!=null?i:null}set startDate(e){this.proposeStartDate(e)}set endDate(e){this.proposeEndDate(e)}set duration(e){this.proposeDuration(e)}inSet(e,i,o,l,u){const c=this;return c.project&&!c.project.isWritingData&&typeof e!="string"&&!u&&("startDate"in e&&!("startDate"in c.$changed)&&(c.$changed.startDate=!0,c.invalidate()),"endDate"in e&&!("endDate"in c.$changed)&&(c.$changed.endDate=!0,c.invalidate())),t.inSet.call(c,e,i,o,l,u)}getStartDate(){return this.startDate}proposeStartDate(e,i=!("endDate"in this.$changed)){var o;(this.inSetting||(e==null?void 0:e.getTime())!==((o=this.startDate)===null||o===void 0?void 0:o.getTime()))&&(this._startDate=e,this.propose({startDate:e,keepDuration:i}))}async setStartDate(e,i=!0){var o;return this.proposeStartDate(e,i),(o=this.project)===null||o===void 0?void 0:o.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(e,i=!1){var o;(this.inSetting||(e==null?void 0:e.getTime())!==((o=this.endDate)===null||o===void 0?void 0:o.getTime()))&&(this._endDate=e,this.propose({endDate:e,keepDuration:i}))}async setEndDate(e,i=!1){var o;return this.proposeEndDate(e,i),(o=this.project)===null||o===void 0?void 0:o.commitAsync()}getDuration(){return this.duration}proposeDuration(e,i,o=!0){this._duration=e,this.propose({duration:e,keepStart:o}),i&&this.propose({durationUnit:i})}async setDuration(e,i,o=!0){var l;return this.proposeDuration(e,i,o),(l=this.project)===null||l===void 0?void 0:l.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){const e=this,i=e.$changed,o=e.getCurrentOrProposed("startDate"),l=e.getCurrentOrProposed("endDate"),u=e.getCurrentOrProposed("duration");if(o!=null&&(i.startDate=e._startDate=o),l!=null&&(i.endDate=e._endDate=l),u!=null&&(i.duration=e._duration=u),e.eventStore&&!e.eventStore.isLoadingData){var c;const g=(c=e.assignmentStore)===null||c===void 0?void 0:c.storage.findItem("event",null);if(g){var d;const p=(d=e.assignmentStore)===null||d===void 0?void 0:d.storage.findItem("eventId",e.id);if(p)for(const m of p)m.setChanged("event",e);else for(const m of g)m.getCurrentOrProposed("event")===e.id&&m.setChanged("event",e)}}t.joinProject.call(e)}applyValue(e,i,o,l,u){var c;if((this.project||(c=this.recurringTimeSpan)!==null&&c!==void 0&&c.project)&&u){const{name:d}=u;(d==="startDate"||d=="duration"||d==="endDate")&&(e=!0,this["_"+d]=o),l&&(e=!1)}t.applyValue.call(this,e,i,o,l,u)}afterChange(e,i,o,l,u){!this.$isCalculating&&!u&&this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),t.afterChange.call(this,e,i,o,l,u)}calculateInvalidated(){const e=this,i=e.$changed,o="startDate"in i,l="endDate"in i,u="duration"in i,{startDate:c,endDate:d,duration:g,keepDuration:p,keepStart:m}=i;let D=null;o&&!l&&!u?c===null?i.endDate=null:e.hasCurrentOrProposed("endDate")&&c>e.getCurrentOrProposed("endDate")&&!p?(i.endDate=c,i.duration=0):e.hasCurrentOrProposed("duration")&&(p||!e.hasCurrentOrProposed("endDate"))?D="endDate":e.hasCurrentOrProposed("endDate")&&(D="duration"):!o&&l&&!u?d===null?i.startDate=null:e.hasCurrentOrProposed("startDate")&&!p&&d!==!0&&d<e.getCurrentOrProposed("startDate")?(i.startDate=d,i.duration=0):e.hasCurrentOrProposed("duration")&&(p||!e.hasCurrentOrProposed("startDate"))?D="startDate":e.hasCurrentOrProposed("startDate")&&(D="duration"):!o&&!l&&u?g===null?i.endDate=null:e.hasCurrentOrProposed("startDate")&&(m||!e.hasCurrentOrProposed("endDate"))?(m&&i.duration<0&&(i.duration=0),D="endDate"):e.hasCurrentOrProposed("endDate")&&(D="startDate"):o&&l&&!u?c===null&&d===null?i.duration=null:D="duration":o&&!l&&u?D="endDate":!o&&l&&u?D="startDate":o&&l&&u&&(g==null?D="duration":c==null?D="startDate":D="endDate");const C=e.getCurrentOrProposed("startDate"),x=e.getCurrentOrProposed("endDate"),S=e.getCurrentOrProposed("duration"),R=e.getCurrentOrProposed("durationUnit");let M,h;switch(D){case"startDate":i.startDate=I.add(x,-S,R);break;case"endDate":M=I.as("hour",S,R),h=I.as(R,M,"h"),i.endDate=I.add(C,h,R);break;case"duration":M=I.diff(C,x,"h"),i.duration=I.as(R,M,"h");break}"startDate"in i&&i.startDate!==!0&&(this._startDate=i.startDate),"endDate"in i&&i.endDate!==!0&&(this._endDate=i.endDate),"duration"in i&&i.duration!==!0&&(this._duration=i.duration),i.startDate===!0&&delete i.startDate,i.endDate===!0&&delete i.endDate,delete i.keepDuration,delete i.keepStart}}return r}){}class fe extends P([ge],n=>{const t=n.prototype;class r extends n{get assigned(){var e;return(e=this.project)===null||e===void 0?void 0:e.assignmentStore.getResourcesAssignments(this)}joinProject(){if(this.resourceStore&&!this.resourceStore.isLoadingData){var e;(e=this.assignmentStore)===null||e===void 0||e.query(i=>i.get("resource")===this.id).forEach(i=>i.setChanged("resource",this))}t.joinProject.call(this)}leaveProject(e=!1){var i;if(this.assigned&&!e&&!((i=this.resourceStore)!==null&&i!==void 0&&i.isLoadingData)){const o=this.resourceStore;this.assigned.forEach(l=>o.assignmentsForRemoval.add(l))}t.leaveProject.call(this)}applyValue(e,i,o,l,u){(u==null?void 0:u.name)==="id"&&this.assigned.forEach(c=>{c.set("resourceId",o)}),t.applyValue.call(this,e,i,o,l,u)}}return r}){}function Pe(a){return a!=null&&a.isModel?a.id:a}class je extends P([ge],n=>{const t=n.prototype;class r extends n{static get fields(){return[{name:"resource",isEqual:(e,i)=>e===i,persist:!1},{name:"event",isEqual:(e,i)=>e===i,persist:!1}]}setChanged(e,i,o){const{assignmentStore:l,eventStore:u,resourceStore:c,project:d}=this;let g=!1;if(e==="event"){const p=U(i,H)?i:u==null?void 0:u.$master.getById(i);p&&(g=!0),i=p||i}if(e==="resource"){const p=U(i,fe)?i:c==null?void 0:c.$master.getById(i);p&&(g=!0),i=p||i}t.setChanged.call(this,e,i,o,!0),l&&g&&!d.isPerformingCommit&&!l.isLoadingData&&!(c!=null&&c.isLoadingData)&&!l.skipInvalidateIndices&&l.invalidateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){let{event:e=this.event,resource:i=this.resource}=this.$changed;if(e!==null&&!U(e,H)){var o;const u=(o=this.eventStore)===null||o===void 0?void 0:o.getById(e);u&&this.setChanged("event",u,!1)}if(i!==null&&!U(i,fe)){var l;const u=(l=this.resourceStore)===null||l===void 0?void 0:l.getById(i);u&&this.setChanged("resource",u,!1)}}finalizeInvalidated(e){const i=this.$changed;"resource"in i&&(i.resourceId=Pe(i.resource)),"event"in i&&(i.eventId=Pe(i.event)),t.finalizeInvalidated.call(this,e)}set event(e){this.setChanged("event",e),this.setChanged("eventId",Pe(e))}get event(){const e=this.get("event");return(e==null?void 0:e.id)!=null?e:null}set resource(e){this.setChanged("resource",e),this.setChanged("resourceId",Pe(e))}get resource(){const e=this.get("resource");return(e==null?void 0:e.id)!=null?e:null}}return r}){}class me extends P([q,we,N],n=>{const t=n.prototype;class r extends n{setProject(e){const i=t.setProject.call(this,e);return e&&this.joinProject(e),i}joinProject(e){}onCommitAsync(){}}return r}){}const Jt=new Set;class ot extends P([Wt,me],n=>{n.prototype;class t extends n{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:je,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(s){this.allAssignmentsForRemoval=!0,super.data=s,this.allAssignmentsForRemoval=!1}getEventsAssignments(s){return this.storage.findItem("event",s,!0)||Jt}getResourcesAssignments(s){return this.storage.findItem("resource",s.$original,!0)||Jt}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(s,e){s=s.masterStore||s;const i=this.count&&this.storage.findItem(e,null,!0);if(i){for(const o of i){const l=s.getById(o.getCurrentOrProposed(e));l&&o.setChanged(e,l)}this.invalidateIndices()}}unlinkAssignments(s){this.forEach(e=>{var o,l;var i;return e.setChanged(s,(l=(o=(i=e[s])===null||i===void 0?void 0:i.id)!=null?o:e==null?void 0:e.getData(s))!=null?l:e[s+"Id"])}),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){}class lt extends P([Yt,ge],n=>{n.prototype;class t extends n{}return t}){}class Gt extends P([zt,me],n=>{n.prototype;class t extends n{static get defaultConfig(){return{tree:!0,modelClass:lt}}}return t}){}class Oe extends P([ge],n=>{const t=n.prototype;class r extends n{static get fields(){return[{name:"fromEvent",isEqual:(e,i)=>e===i,persist:!1},{name:"toEvent",isEqual:(e,i)=>e===i,persist:!1}]}setChanged(e,i,o){var l;let u=!1;if(e==="fromEvent"||e==="toEvent"){var c;const g=U(i,H)?i:(c=this.eventStore)===null||c===void 0?void 0:c.getById(i);g&&(u=!0),i=g||i}if(t.setChanged.call(this,e,i,o,!0),u&&!this.project.isPerformingCommit&&!((l=this.dependencyStore)!==null&&l!==void 0&&l.isLoadingData)){var d;(d=this.dependencyStore)===null||d===void 0||d.invalidateIndices()}}joinProject(){t.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){let{fromEvent:e,toEvent:i}=this.$changed;if(e!==null&&!U(e,H)){var o;const u=(o=this.eventStore)===null||o===void 0?void 0:o.getById(e);u&&(this.$changed.fromEvent=u)}if(i!==null&&!U(i,H)){var l;const u=(l=this.eventStore)===null||l===void 0?void 0:l.getById(i);u&&(this.$changed.toEvent=u)}}set fromEvent(e){this.setChanged("fromEvent",e)}get fromEvent(){const e=this.get("fromEvent");return(e==null?void 0:e.id)!=null?e:null}set toEvent(e){this.setChanged("toEvent",e)}get toEvent(){const e=this.get("toEvent");return(e==null?void 0:e.id)!=null?e:null}}return r}){}const Xt=new Set;class ut extends P([Ht,me],n=>{n.prototype;class t extends n{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:Oe,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(s){return this.storage.findItem("toEvent",s)||Xt}getOutgoingDepsForEvent(s){return this.storage.findItem("fromEvent",s)||Xt}set data(s){this.allDependenciesForRemoval=!0,super.data=s,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){}class Qt extends P([H,Ut],n=>{const t=n.prototype;class r extends n{get assigned(){var i;var e;return(i=(e=this.project)===null||e===void 0?void 0:e.assignmentStore.getEventsAssignments(this))!=null?i:this.$cachedAssignments}leaveProject(e=!1){this.$cachedAssignments=this.assigned,super.leaveProject(e)}applyValue(e,i,o,l,u){if(i==="id"){var c;(c=this.assigned)===null||c===void 0||c.forEach(d=>d.set("eventId",o))}t.applyValue.call(this,e,i,o,l,u)}copy(e=null,i=null){const o=t.copy.call(this,e,i);return($.isObject(i)&&!i.skipFieldIdentifiers||!$.isObject(i))&&(o.$cachedAssignments=this.assigned),o}}return r}){}class en extends P([H],n=>{const t=n.prototype;class r extends n{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const e=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach(i=>e.dependenciesForRemoval.add(i)),this.incomingDeps&&this.incomingDeps.forEach(i=>e.dependenciesForRemoval.add(i)),t.leaveProject.call(this)}}return r}){}class Fe extends P([H,Qt,en],n=>{n.prototype;class t extends n{}return t}){}class ct extends P([Zt,me],n=>{n.prototype;class t extends n{static get defaultConfig(){return{modelClass:Fe}}joinProject(){var s;(s=this.assignmentStore)===null||s===void 0||s.linkAssignments(this,"event")}afterLoadData(){var s;this.afterEventRemoval(),(s=this.assignmentStore)===null||s===void 0||s.linkAssignments(this,"event")}}return t}){}class dt extends P([Kt,me],n=>{const t=n.prototype;class r extends n{static get defaultConfig(){return{modelClass:fe}}joinProject(){var e;(e=this.assignmentStore)===null||e===void 0||e.linkAssignments(this,"resource")}afterLoadData(){var e;(e=this.assignmentStore)===null||e===void 0||e.linkAssignments(this,"resource")}clear(e){var i;t.clear.call(this,e),(i=this.assignmentStore)===null||i===void 0||i.unlinkAssignments("resource")}}return r}){}class mr extends P([],Rt){}class pr extends P([],Ze){}class tn extends P([mr,pr,B],n=>{const t=n.prototype;class r extends n{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(e={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const i="silenceInitialCommit"in e?e.silenceInitialCommit:!0,o="adjustDurationToDST"in e?e.adjustDurationToDST:!1;this.maxCalendarRange="maxCalendarRange"in e?e.maxCalendarRange:15768e7,delete e.maxCalendarRange,delete e.silenceInitialCommit,delete e.adjustDurationToDST,t.construct.call(this,e),this.silenceInitialCommit=i,this.adjustDurationToDST=o}repopulateStore(e){}repopulateReplica(){}deferUntilRepopulationIfNeeded(e,i,o){i(...o)}attachStore(e){}detachStore(e){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}return r}){}class nn extends P([],Ze){}class rn extends P([tn,we,nn,B],n=>{const t=n.prototype;class r extends n{static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:Fe,assignmentModelClass:je,resourceModelClass:fe,dependencyModelClass:Oe,calendarModelClass:lt,eventStoreClass:ct,assignmentStoreClass:ot,resourceStoreClass:dt,dependencyStoreClass:ut,calendarManagerStoreClass:Gt,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(e={}){const i=this;if(i.$invalidated=new Set,i.isPerformingCommit=!1,i.silenceInitialCommit=!0,i.ongoing=Promise.resolve(),e.eventStore&&!e.assignmentStore){var o;const m=e.eventStore.masterStore||e.eventStore,D=m.assignmentStore||((o=m.crudManager)===null||o===void 0?void 0:o.assignmentStore);D!=null&&D.isAssignmentStore&&(e.assignmentStore=D,i.isSharingAssignmentStore=!0)}t.construct.call(i,e),i.defaultCalendar=new i.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:i.unspecifiedTimeIsWorking}),i.defaultCalendar.project=i;const{calendarsData:l,eventsData:u,dependenciesData:c,resourcesData:d,assignmentsData:g}=i;!!(l||u||c||d||g)?(i.loadInlineData({calendarsData:l,eventsData:u,dependenciesData:c,resourcesData:d,assignmentsData:g}),delete i.calendarsData,delete i.eventsData,delete i.dependenciesData,delete i.resourcesData,delete i.assignmentsData):i.bufferedCommitAsync()}doDestroy(){var e,i,o,l,u,c;const d=this;(e=d.eventStore)===null||e===void 0||e.destroy(),(i=d.dependencyStore)===null||i===void 0||i.destroy(),(o=d.assignmentStore)===null||o===void 0||o.destroy(),(l=d.resourceStore)===null||l===void 0||l.destroy(),(u=d.calendarManagerStore)===null||u===void 0||u.destroy(),d.defaultCalendar.destroy(),(c=d.stm)===null||c===void 0||c.destroy(),t.doDestroy.call(this)}async loadInlineData(e){const i=this;i.isLoadingInlineData=!0,e.calendarsData&&(i.calendarManagerStore.data=e.calendarsData),e.resourcesData&&(i.resourceStore.data=e.resourcesData),e.assignmentsData&&(i.assignmentStore.data=e.assignmentsData),e.eventsData&&(i.eventStore.data=e.eventsData),e.tasksData&&(i.eventStore.data=e.tasksData),e.dependenciesData&&(i.dependencyStore.data=e.dependenciesData),await i.commitLoad(),i.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(e){const i=o=>{o.setProject(this),o.joinProject()};e.rootNode?e.rootNode.traverse(i):e.forEach(i)}unJoinStoreRecords(e){const i=o=>{o.leaveProject(),o.setProject(this)};e.rootNode?e.rootNode.traverse(o=>{o!==e.rootNode&&i(o)}):e.forEach(i)}resolveStoreAndModelClass(e,i){const o=(i==null?void 0:i.storeClass)||this[`${e}StoreClass`];let l=i==null?void 0:i.modelClass;return l||(this.getDefaultConfiguration()[`${e}ModelClass`]!==o.getDefaultConfiguration().modelClass?l=o.getDefaultConfiguration().modelClass:l=this[`${e}ModelClass`]),{storeClass:o,modelClass:l}}setEventStore(e){this.eventStore=e}changeEventStore(e,i){const o=this,{stm:l}=o;if(o.detachStore(i),e instanceof N)e.project=o,l.addStore(e),o.joinStoreRecords(e);else{const{storeClass:u,modelClass:c}=o.resolveStoreAndModelClass("event",e);e=new u($.assign({modelClass:c,project:o,stm:l},e))}if(i&&l.hasStore(i)){l.removeStore(i),o.unJoinStoreRecords(i);const{assignmentsForRemoval:u}=i;u.forEach(c=>{const d=c.event;if(d){const g=e.getById(d.id);g&&(c.event=g,u.delete(c))}}),i.afterEventRemoval()}return e.setProject(o),e}updateEventStore(e,i){this.attachStore(e),this.trigger("eventStoreChange",{store:e})}setAssignmentStore(e){this.assignmentStore=e}changeAssignmentStore(e,i){const o=this,{stm:l}=o;if(o.detachStore(i),i&&l.hasStore(i)&&(l.removeStore(i),o.unJoinStoreRecords(i)),e instanceof N)e.project=o,l.addStore(e),o.joinStoreRecords(e);else{const{storeClass:u,modelClass:c}=o.resolveStoreAndModelClass("assignment",e);e=new u($.assign({modelClass:c,project:o,stm:l},e))}return e.setProject(o),e}updateAssignmentStore(e,i){this.attachStore(e),this.trigger("assignmentStoreChange",{store:e})}setResourceStore(e){this.resourceStore=e}changeResourceStore(e,i){const o=this,{stm:l}=o;if(o.detachStore(i),e instanceof N)e.project=o,l.addStore(e),o.joinStoreRecords(e);else{const{storeClass:u,modelClass:c}=o.resolveStoreAndModelClass("resource",e);e=new u($.assign({modelClass:c,project:o,stm:l},e))}if(i&&l.hasStore(i)){l.removeStore(i),o.unJoinStoreRecords(i);const{assignmentsForRemoval:u}=i;u.forEach(c=>{const d=c.resource;if(d){const g=e.getById(d.id);g&&(c.resource=g,u.delete(c))}}),i.afterResourceRemoval()}return e.setProject(o),e}updateResourceStore(e,i){this.attachStore(e),this.trigger("resourceStoreChange",{store:e})}setDependencyStore(e){this.dependencyStore=e}changeDependencyStore(e,i){const o=this;if(o.detachStore(i),e instanceof N)e.project=o,o.stm.addStore(e),o.joinStoreRecords(e);else{const{storeClass:l,modelClass:u}=o.resolveStoreAndModelClass("dependency",e);e=new l($.assign({modelClass:u,project:o,stm:o.stm},e))}return e}updateDependencyStore(e,i){this.attachStore(e),this.trigger("dependencyStoreChange",{store:e})}setCalendarManagerStore(e){this.calendarManagerStore=e}changeCalendarManagerStore(e,i){const o=this;if(o.detachStore(i),e instanceof N)o.stm.addStore(e);else{var l,u;const c=((l=e)===null||l===void 0?void 0:l.storeClass)||o.calendarManagerStoreClass,d=((u=e)===null||u===void 0?void 0:u.modelClass)||c.getDefaultConfiguration().modelClass||o.calendarModelClass;e=new c($.assign({modelClass:d,project:o,stm:o.stm},e))}return e.setProject(o),e}updateCalendarManagerStore(e,i){this.attachStore(e),this.trigger("calendarManagerStoreChange",{store:e})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(e){this.$calendar=e}get effectiveCalendar(){return this.calendar}async addEvent(e){return this.eventStore.add(e),this.commitAsync()}async addAssignment(e){return this.assignmentStore.add(e),this.commitAsync()}async addResource(e){return this.resourceStore.add(e),this.commitAsync()}async addDependency(e){return this.dependencyStore.add(e),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const e=this;if(e.isPerformingCommit=!0,e.unScheduleAutoCommit(),await qt(0),!e.isDestroyed){for(const c of e.$invalidated)c.calculateInvalidated();const{isInitialCommit:i,silenceInitialCommit:o}=e,l=i&&o;e.assignmentStore.onCommitAsync(),e.dependencyStore.onCommitAsync(),e.isInitialCommitPerformed=!0,e.hasLoadedDataToCommit=!1,e.isPerformingCommit=!1;const u=[e.assignmentStore,e.dependencyStore,e.eventStore,e.resourceStore,e.calendarManagerStore];if(u.forEach(c=>{var d;return(d=c.suspendAutoCommit)===null||d===void 0?void 0:d.call(c)}),e.isWritingData=!0,e.trigger("refresh",{isInitialCommit:i,isCalculated:!0}),l)for(const c of e.$invalidated)c.finalizeInvalidated(!0);else{for(const c of e.$invalidated)c.beginBatch(!0),c.finalizeInvalidated();for(const c of e.$invalidated)c.endBatch(!1,!0)}return e.isWritingData=!1,e.$invalidated.clear(),e.trigger("dataReady"),u.forEach(c=>{var d;return(d=c.resumeAutoCommit)===null||d===void 0?void 0:d.call(c)}),e.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(e){this.$invalidated.add(e),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(e){e=this.$stm=new Wn($.assign({disabled:!0},e)),e.ion({restoringStop:async()=>{e.disable(),await this.commitAsync(),this.isDestroyed||(e.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return r.applyConfigs=!0,r}){}const ht={startDate:1,endDate:1,constraintDate:1,deadlineDate:1};var sn=a=>{var n;return n=class extends(a||ee){get timeZone(){return this.getData("timeZone")}set timeZone(r){this.setData("timeZone",r)}setLocalDate(r,s){this.set(r,this.timeZone!=null?z.toTimeZone(s,this.timeZone):s,!0),this.data[r]=this[r]}getLocalDate(r){return this.timeZone!=null&&this[r]?z.fromTimeZone(this[r],this.timeZone):this[r]}applyChangeset(r){if(this.timeZone!=null)for(const s in ht)r[s]&&(this.setLocalDate(s,new Date(r[s])),delete r[s]);return super.applyChangeset(...arguments)}getFieldPersistentValue(r){var s,e;if(this.timeZone!=null){const i=(e=(s=r==null?void 0:r.field)!=null?s:r==null?void 0:r.name)!=null?e:r;if(ht[i])return this.getLocalDate(i)}return super.getFieldPersistentValue(r)}convertToTimeZone(r){const s=this,e={...s.meta.modified},i={...ht};s.isTask&&!s.manuallyScheduled&&(delete i.startDate,delete i.endDate);for(const o in i)s[o]!=null?(i[o]=s[o],s.timeZone!=null&&(i[o]=s.getLocalDate(o),e[o]&&(e[o]=z.fromTimeZone(e[o],s.timeZone)))):delete i[o];s.timeZone=r;for(const o in i)s.setLocalDate(o,i[o],!1),i[o]=1,s.timeZone!=null&&e[o]&&(e[o]=z.toTimeZone(e[o],s.timeZone));s.clearChanges(!0,!0,i),$.isEmpty(e)||(s.meta.modified=e,s.stores.forEach(o=>o.modified.add(s)))}},F(n,"$name","TimeZonedDatesMixin"),F(n,"fields",[{name:"timeZone",persist:!1}]),n};class ee extends B.mixin(sn){static get $name(){return"TimeSpan"}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"},useProp:!0},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]}construct(n,...t){if(n!=null&&n.fullDuration){const{magnitude:r,unit:s}=n.fullDuration;n.duration=r,n.unit=s,delete n.fullDuration}super.construct(n,...t),this.normalize()}get eventStore(){const n=this;if(n.isOccurrence)return n.recurringTimeSpan.eventStore;if(!n._eventStore){var t;n._eventStore=(t=n.stores)===null||t===void 0?void 0:t.find(r=>r.isEventStore)}return n._eventStore}normalize(){const n=this,{startDate:t,endDate:r,duration:s,durationUnit:e}=n,i=s!=null;t&&r&&!i?n.setData("duration",I.diff(t,r,e,!0)):t&&!r&&i?n.setData("endDate",I.add(t,s,e)):!t&&r&&i&&n.setData("startDate",I.add(r,-s,e))}updateInternalCls(n){this._cls?this._cls.value=n:this._cls=new Et(n)}set internalCls(n){this.updateInternalCls(n),this.set("cls",this._cls.value)}get internalCls(){const{cls:n}=this;return n!=null&&n.isDomClassList?n:(this.internalCls=n,this._cls)}get cls(){return this._cls||(this._cls=new Et(super.get("cls"))),this._cls}set cls(n){this.internalCls=n}get startDate(){return this.get("startDate")}set startDate(n){this.setStartDate(n)}get endDate(){return this.get("endDate")}set endDate(n){this.setEndDate(n)}get endingDate(){const n=this,{endDate:t,startDate:r}=n;return t||I.add(r,n.duration,n.durationUnit)}get duration(){return this.get("duration")}set duration(n){this.setDuration(n,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(n,t=this.durationUnit){n=parseFloat(n),this.set({duration:n,durationUnit:t,...this.updateDatesFromDuration(n,t)})}updateDatesFromDuration(n,t,r=this.startDate,s=this.endDate){const e={};return r?e.endDate=I.add(r,n,t):s&&(e.startDate=I.add(s,-n,t)),e}getDurationInUnit(n,t){const r=this;return r.startDate&&r.endDate?I.getDurationInUnit(r.startDate,r.endDate,n,t):I.as(n,r.duration,r.durationUnit)}get fullDuration(){return new ue({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(n){typeof n=="string"&&(n=I.parseDuration(n,!0,this.durationUnit)),this.setDuration(n.magnitude,n.unit)}setStartDate(n,t=!0){const r=this,s={startDate:n};if(n){let e;if(t)e=r.duration!=null;else if(r.endDate){if(s.duration=I.diff(n,r.endDate,r.durationUnit,!0),s.duration<0)throw new Error("Negative duration")}else e=this.duration!=null;e&&(s.endDate=I.add(n,r.getDurationInUnit("h"),"h"))}else s.duration=null;r.set(s)}setEndDate(n,t=!1){const r=this,s={endDate:n};if(n){let e;if(t===!0)e=r.duration!=null;else if(r.startDate){if(s.duration=I.diff(r.startDate,n,r.durationUnit,!0),s.duration<0)throw new Error("Negative duration")}else e=this.duration!=null;e&&(s.startDate=I.add(n,-r.duration,r.durationUnit))}r.set(s)}setStartEndDate(n,t,r){this.set({startDate:n,endDate:t},null,r)}get dates(){const n=[],t=I.startOf(this.startDate,"day"),r=this.endDate;for(let s=t;s<r;s=I.add(s,1,"day"))n.push(s);return n}get startDateMS(){var n;return(n=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)===null||n===void 0?void 0:n.getTime()}get endDateMS(){var n;return(n=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)===null||n===void 0?void 0:n.getTime()}get durationMS(){const{endDateMS:n,startDateMS:t}=this;return n&&t?n-t:I.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return this.duration===0}inSetNormalize(n){if(typeof n!="string"){let{startDate:t,endDate:r,duration:s,durationUnit:e=this.durationUnit}=n;typeof t=="string"&&(t=this.getFieldDefinition("startDate").convert(t)),typeof r=="string"&&(r=this.getFieldDefinition("endDate").convert(r)),"duration"in n?(t&&!r&&(r=I.add(t,s,e,!0,!0)),!t&&r&&(t=I.add(r,-s,e,!0,!0))):t&&r&&(s=I.as(e,I.diff(t,r,"h",!0),"h"));const i=Object.isFrozen(n)?$.clone(n):n;return t&&(i.startDate=t),r&&(i.endDate=r),s!=null&&(i.duration=s),i}}fieldToKeys(n,t){var s,e;const r=super.fieldToKeys(n,t);if(r.fullDuration){const{magnitude:i,unit:o}=r.fullDuration;r.duration=i,r.durationUnit=o}return!this.isEventModel&&!this.isTaskModel&&("duration"in r||r.durationUnit)&&!(r.startDate&&r.endDate)&&Object.assign(r,this.updateDatesFromDuration((s=r.duration)!=null?s:this.duration,(e=r.durationUnit)!=null?e:this.durationUnit,r.startDate,r.endDate)),r}inSet(n,t,r,s,e,i){return e||(n=this.inSetNormalize(n)||n),super.inSet(n,t,r,s,e,i)}applyValue(n,t,r,s,e){t==="cls"&&this.updateInternalCls(r),super.applyValue(n,t,r,s,e)}forEachDate(n,t){return this.dates.forEach(n.bind(t))}get isScheduled(){const{startDateMS:n,endDateMS:t}=this;return t-n>=0}get isValid(){const{startDate:n,endDate:t}=this;return!n||!t||t-n>=0}shift(n,t=this.durationUnit){if(typeof n=="string"){const r=n;n=t,t=r}return this.setStartDate(I.add(this.startDate,n,t,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(n){this._wbsCode=n}fullCopy(){return this.copy.apply(this,arguments)}intersects(n){return this.intersectsRange(n.startDate,n.endDate)}intersectsRange(n,t){const r=this.startDate,s=this.endDate;return r&&s&&I.intersectSpans(r,s,n,t)}split(n=.5){const t=this,r=t.copy(),{fullDuration:s,eventStore:e,assignmentStore:i}=t,o=new ue(s),l=new ue(s);let u,c;return typeof n=="string"?(u=new ue(n),u.unit===o.unit?l.magnitude-=u.magnitude:(l.magnitude=I.as(u.unit,o)-u.magnitude,l.unit=u.unit,c=!0)):(u=new ue(n>1?n:t.duration*n,t.durationUnit),l.magnitude-=u.magnitude),r.startDate=I.add(t.startDate,u.magnitude,u.unit),c?(r.fullDuration=l,t.fullDuration=u):(r.duration=l.magnitude,t.duration=u.magnitude),e&&(e.add(r),i&&!e.usesSingleAssignment&&i.add(t.assignments.map(d=>{const g=Object.assign({},d.data,{eventId:r.id,event:null,resource:null});return delete g.id,g}))),r}toICSString(n={}){if(!this.isScheduled)return"";const{startDate:t,endDate:r}=this,s=n.DTSTAMP||I.format(new Date,"uu");delete n.DTSTAMP;let e={};this.allDay?e={"DTSTART;VALUE=DATE":I.format(t,"u"),"DTEND;VALUE=DATE":I.format(r,"u")}:e={DTSTART:I.format(t,"uu"),DTEND:I.format(r,"uu")};const i=ce.scheduler&&ce.getVersion("scheduler")||ce.calendar&&ce.getVersion("calendar")||"",o={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${i} //EN`,END:"VCALENDAR"},l={BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:s,...e,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...n,END:"VEVENT"},u=Object.keys(o).map(d=>`${d}:${o[d]}`),c=Object.keys(l).map(d=>`${d}:${l[d]}`);return u.splice(u.length-1,0,...c),u.join(`
`)}exportToICS(n){if(this.isScheduled){const t=new Blob([this.toICSString(n)],{type:"text/calendar"});Vn.downloadBlob(t,(this.name||"Event")+".ics")}}isEditable(n){return this.getFieldDefinition(n)?!0:void 0}isFieldModified(n){return n==="fullDuration"?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(n)}}ee._$name="TimeSpan";var an=a=>class extends(a||V){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(t){if(super.construct(t),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const t=super.removeAll(...arguments);return t&&this.assignmentStore.removeAll(),t}onRecordIdChange({record:t,oldValue:r,value:s}){super.onRecordIdChange({record:t,oldValue:r,value:s}),t.isFieldModified("id")&&(this.isChangingId=!0,t.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:t,endDate:r}){return this.query(s=>this.eventStore.isDateRangeAvailable(t,r,null,s))}},Z=a=>class extends(a||V){static get $name(){return"PartOfProject"}},on=a=>class extends a{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image",{name:"resourceMargin",type:"number"},{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach(t=>{t.resourceId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce((t,r)=>(r.event&&t.push(r.event),t),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(t){t.forEach(r=>{r.resource=this})}getEvents(){return ce.deprecate("scheduler","6.0.0","getEvents() is deprecated, use the events property instead"),this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:t=""}=this;if(!t)return"";const r=t.split(" "),s=r[0][0],e=r.length>1?r[r.length-1][0]:"";return s+e}isWorkingTime(t){var r,s;const e=this.effectiveCalendar||((r=this.project)===null||r===void 0?void 0:r.calendar);return!e||((s=e.isWorkingTime)===null||s===void 0?void 0:s.call(e,t))}};const vr=fe;class pe extends on(Z(vr.derive(zn))){}F(pe,"$name","ResourceModel"),pe.exposeProperties(),pe._$name="ResourceModel";const yr=Z(dt.derive(de));class gt extends an(yr){static get defaultConfig(){return{modelClass:pe}}}gt._$name="ResourceStore";var ln=a=>{var n;return n=class extends(a||V){static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(r){if(super.construct(r),this.autoTree=!0,this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}set filtersFunction(r){super.filtersFunction=r}get filtersFunction(){const r=super.filtersFunction;return r&&r!==It.returnTrue?s=>s.isCreating||r(s):r}getEventCounts(r){const s=this,{filtersFunction:e,added:i}=s,o=s.getEvents({...r,storeFilterFn:s.isFiltered?s.reapplyFilterOnAdd?e:l=>i.includes(l)?s.indexOf(l)>-1:e(l):null,dateMap:r.dateMap||!0});return o.forEach((l,u)=>o.set(u,l.length)),o}forEachScheduledEvent(r,s=this){this.forEach(e=>{const{startDate:i,endDate:o}=e;if(i&&o)return r.call(s,e,i,o)})}getTotalTimeSpan(){let r=new Date(9999,0,1),s=new Date(0);return this.forEach(e=>{e.startDate&&(r=I.min(e.startDate,r)),e.endDate&&(s=I.max(e.endDate,s))}),r=r<new Date(9999,0,1)?r:null,s=s>new Date(0)?s:null,this.lastTotalTimeSpan={startDate:r||null,endDate:s||r||null}}isEventPersistable(r){return r.isPersistable}isDateRangeAvailable(r,s,e,i){if(i.data.generatedParent)return!1;const o=new Set(this.getEventsForResource(i));if(e!=null&&e.isAssignment&&e.event.resources.forEach(c=>{c.id!==e.resourceId&&this.getEventsForResource(c).forEach(d=>o.add(d))}),e){const l=e.isAssignment?e.event:e;o.delete(l)}return!Array.from(o).some(l=>l.isScheduled&&I.intersectSpans(r,s,l.startDate,l.endDate))}filterEventsForResource(r,s,e=this){return r.getEvents(this).filter(s.bind(e))}getResourcesForEvent(r){return r.isOccurrence&&(r=r.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(r)}getEventsForResource(r){return this.assignmentStore.getEventsForResource(r)}getAssignmentsForEvent(r){return this.assignmentStore.getAssignmentsForEvent(r)||[]}getAssignmentsForResource(r){return this.assignmentStore.getAssignmentsForResource(r)||[]}assignEventToResource(r,s,e=!1){return this.assignmentStore.assignEventToResource(r,s,void 0,e)}unassignEventFromResource(r,s){this.assignmentStore.unassignEventFromResource(r,s)}reassignEventFromResourceToResource(r,s,e){const i=this,o=B.asId(e),l=i.assignmentStore.getAssignmentForEventAndResource(r,s);l?l.resourceId=o:i.assignmentStore.assignEventToResource(r,e)}isEventAssignedToResource(r,s){return this.assignmentStore.isEventAssignedToResource(r,s)}removeAssignmentsForEvent(r){this.assignmentStore.removeAssignmentsForEvent(r)}removeAssignmentsForResource(r){this.assignmentStore.removeAssignmentsForResource(r)}append(r){return this.add(r)}get project(){return super.project}set project(r){if(super.project=r,this.detachListeners("project"),r){var s;(s=r.assignmentStore)!==null&&s!==void 0&&s.isAssignmentStore&&this.attachToAssignmentStore(r.assignmentStore),r.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200})}}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(r){this._usesSingleAssignment=r;const{assignmentStore:s}=this;s!=null&&s.isStore&&!s.hasGenerateIdOverride&&(s.modelClass.generateId=function(){return this.singleAssignmentIdCounter==null&&(this.singleAssignmentIdCounter=0),`a-${++this.singleAssignmentIdCounter}`},s.hasGenerateIdOverride=!0)}processRecords(r){var s;const{assignmentStore:e}=this,i=[];return e&&(e.skipInvalidateIndices=!0),r=super.processRecords(r,e&&!((s=this.stm)!==null&&s!==void 0&&s.isRestoring)&&(o=>{const l=o.get("resourceId");!o.reassignedFromReplace&&l!=null&&(e.includesAssignment(o.id,l)||i.push({id:e.modelClass.generateId(""),resourceId:l,eventId:o.id})),o.reassignedFromReplace=!1})||void 0),e&&(e.storage.invalidateIndices(),e.skipInvalidateIndices=!1,e.add(i)),r}joinRecordsToStore(r){const{assignmentStore:s}=this;s?(s.skipInvalidateIndices=!0,super.joinRecordsToStore(r),s.storage.invalidateIndices(),s.skipInvalidateIndices=!1):super.joinRecordsToStore(r)}processRecord(r,s=!1){var d;var e,i;r=super.processRecord(r,s);const o=this,l=(d=o.assignmentStore)!=null?d:(e=o.crudManager)===null||e===void 0?void 0:e.assignmentStore,u=r.get("resourceId"),{resourceIds:c}=r;if(c!=null&&c.length&&r.meta.skipEnforcingSingleAssignment!==!1&&(i=o.modelClass.fieldMap)!==null&&i!==void 0&&i.resourceIds.persist)l?l.add(c.filter(g=>!l.some(p=>p.eventId===r.id&&p.resourceId===g)).map(g=>({resource:g,event:r}))):o.$processResourceIds=!0;else if(u!=null&&!r.meta.skipEnforcingSingleAssignment){const g=o.getById(r.id);if(g&&g!==r&&!s){const m=l.storage.findItem("eventId",r.id);if(m!=null&&m.size){const D=m.values().next().value;D.resource=u,r.reassignedFromReplace=!0}}else o.$processResourceIds=!0;o.usesSingleAssignment=!0}return r}processResourceIds(){var o;var r,s;const e=this,i=(o=e.assignmentStore)!=null?o:(r=e.crudManager)===null||r===void 0?void 0:r.assignmentStore;if(e.$processResourceIds&&i!==null&&i!==void 0&&i.isAssignmentStore&&!((s=e.project)!==null&&s!==void 0&&s.isSharingAssignmentStore&&e.isChained)){const l=[];e.forEach(u=>{const{resourceId:c,resourceIds:d,id:g}=u;c!=null?l.push({id:i.modelClass.generateId(""),resourceId:c,eventId:g}):d!=null&&d.length&&d.forEach(p=>{l.push({id:i.modelClass.generateId(""),resourceId:p,eventId:g})})}),i.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},i.usesSingleAssignment=!1,i.verifyNoGeneratedIds=!1,i.data=l,i.usesSingleAssignment=!0,e.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:r}){var s;const e=this;if(e.removeUnassignedEvent&&!e.isRemoving&&!e.isSettingData&&!((s=e.stm)!==null&&s!==void 0&&s.isRestoring)&&!e.usesSingleAssignment&&!e.assignmentStore.isSyncingDataOnLoad&&!e.resourceStore.isSyncingDataOnLoad){const i=new Set;r.forEach(o=>{const{event:l}=o;l&&!l.isRemoved&&l.assignments.every(u=>r.includes(u))&&i.add(l)}),i.size&&e.remove([...i])}}onProjectAssignmentStoreChange({store:r}){this.attachToAssignmentStore(r)}attachToAssignmentStore(r){const s=this;s.detachListeners("assignmentStore"),r&&(s.processResourceIds(),r.ion({name:"assignmentStore",addPreCommit({records:e}){if(!s.isSettingData&&!s.isAssigning){var i;s.usesSingleAssignment?e.forEach(o=>{const{event:l}=o;l!=null&&l.isEvent&&l.resourceId!==o.resourceId&&(l.meta.isAssigning=!0,l.set("resourceId",o.resourceId),l.meta.isAssigning=!1)}):(i=s.modelClass.fieldMap)!==null&&i!==void 0&&i.resourceIds.persist&&e.forEach(o=>{var u;const{event:l}=o;if(l!=null&&l.isEvent){l.meta.isAssigning=!0;const c=(u=l.resourceIds)!=null?u:[];c.includes(o.resourceId)||(l.resourceIds=[...c,o.resourceId]),l.meta.isAssigning=!1}})}},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:e}){if(!s.isSettingData&&!s.isAssigning){var i;s.usesSingleAssignment?e.forEach(o=>{var l;(l=s.getById(o.eventId))===null||l===void 0||l.set("resourceId",null)}):(i=s.modelClass.fieldMap)!==null&&i!==void 0&&i.resourceIds.persist&&e.forEach(({event:o,resourceId:l})=>{const u=o.resourceIds.slice(),c=u==null?void 0:u.indexOf(l);c>=0&&(u.splice(c,1),o.resourceIds=u)})}},removeAllPreCommit(){if(!s.isSettingData&&!s.isAssigning){var e;s.usesSingleAssignment?s.allRecords.forEach(i=>i.set("resourceId",null)):(e=s.modelClass.fieldMap)!==null&&e!==void 0&&e.resourceIds.persist&&s.allRecords.forEach(i=>{i.resourceIds=[]})}},update({record:e,changes:i}){if("resourceId"in i){var o;const{event:l}=e;if(s.usesSingleAssignment)l.meta.isAssigning=!0,l.set("resourceId",i.resourceId.value),l.meta.isAssigning=!1;else if((o=s.modelClass.fieldMap)!==null&&o!==void 0&&o.resourceIds.persist){l.meta.isAssigning=!0;const u=l.resourceIds.slice(),c=u==null?void 0:u.indexOf(i.resourceId.oldValue);c>=0&&u.splice(c,1),u!=null&&u.includes(i.resourceId.value)||(u.push(i.resourceId.value),l.resourceIds=u),l.meta.isAssigning=!1}}},change({action:e,records:i}){var o;e==="dataset"&&(o=s.modelClass.fieldMap)!==null&&o!==void 0&&o.resourceIds.persist&&i.forEach(({event:l,resourceId:u})=>{var d;const c=(d=l.resourceIds)!=null?d:[];c.includes(u)||(c.push(u),l.meta.isAssigning=!0,l.setData("resourceIds",c),l.meta.isAssigning=!1)})},thisObj:s}))}set data(r){this.isSettingData=!0,this.usesSingleAssignment&&!this.syncDataOnLoad&&!this.isChained&&this.assignmentStore.removeAll(!0),super.data=r,this.isSettingData=!1}trigger(r,s){var e;const{changes:i}=s||{};return i&&"resourceId"in i&&Object.keys(i).length===1&&!((e=this.stm)!==null&&e!==void 0&&e.isRestoring)&&(s.isAssign=!0),super.trigger(...arguments)}remove(r,...s){const e=super.remove(r,...s);if(e.length&&this.usesSingleAssignment){for(const l of e)if(!l.isOccurrence){var i,o;(i=this.assignmentStore||((o=this.crudManager)===null||o===void 0?void 0:o.assignmentStore))===null||i===void 0||i.remove(l.assignments,!0)}}return e}},F(n,"$name","EventStoreMixin"),n};const Sr=()=>!0,Dr=a=>!a.isRecurring;var un=a=>{var n;return n=class extends a{getEvents({filter:r,date:s,startDate:e,endDate:i,startOnly:o,includeOccurrences:l,allowPartial:u,onlyAssigned:c=!1,dateMap:d=!1,dayTime:g=null,getDateIndex:p}){const m=this,D=arguments[0],{lastDateRange:C,added:x,filtersFunction:S}=m,R=r;if(c&&(D.filter=R?h=>R(h)&&h.resources.length:h=>h.resources.length),"startDate"in D||(e=D.startDate=s),"includeOccurrences"in D||(l=D.includeOccurrences=!0),"allowPartial"in D||(u=D.allowPartial=!o),D.storeFilterFn=m.isFiltered&&!D.ignoreFilters?m.reapplyFilterOnAdd?S:h=>x.includes(h)?m.indexOf(h)>-1:S(h):null,!i)if(e)i=D.endDate=I.clearTime(e),i.setDate(i.getDate()+1);else{if(l)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");D.dateFilter=Sr}D.dateFilter||(o?D.dateFilter=h=>{const f=h.hasBatchedChange("startDate")?h.get("startDate"):h.startDate;return f&&!(I.clearTime(f)-e)}:u?D.dateFilter=h=>{const f=h.hasBatchedChange("startDate")?h.get("startDate"):h.startDate,v=h.hasBatchedChange("endDate")?h.get("endDate"):h.endDate||f,y=!(f-v);return f&&(y?I.betweenLesserEqual(f,e,i):I.intersectSpans(f,v,e,i))}:D.dateFilter=h=>{const f=h.hasBatchedChange("startDate")?h.get("startDate"):h.startDate,v=h.hasBatchedChange("endDate")?h.get("endDate"):h.endDate||f;return f&&f>=e&&v<=i});const M={startDate:e,endDate:i};return m.processConfiguredListeners(),m.trigger("loadDateRange",{old:C||{},new:re.clone(M),changed:!!(!C||C.startDate-M.startDate||C.endDate-M.endDate)}),m.lastDateRange=re.clone(M),d?m.getEventsAsMap(D):m.getEventsAsArray(D)}getEventsAsArray({filter:r,date:s,resourceRecord:e,startDate:i=s,endDate:o,startOnly:l,includeOccurrences:u=!0,dayTime:c=null,dateFilter:d,storeFilterFn:g,getDateIndex:p}){const m=this,D=[];if(g?m.count:m.allCount){let x=e?m.getEventsForResource(e):null;if(!e){const S=m.useDayIndex(c),R=new Set,M=l?"startDate":"date";m.recurringEvents.forEach(h=>{S.dayTime.startOfDay(h.startDate)<=i&&R.add(h)});for(const h=new Date(i);h<o;h.setDate(h.getDate()+1)){const f=S.get(p?p(h):M,h);f==null||f.forEach(v=>R.add(v))}x=[...R]}g&&(x=x.filter(g));for(let S=0,{length:R}=x;S<R;S++){const M=x[S];u&&M.isRecurring?D.push.apply(D,M.getOccurrencesForDateRange(i,o).filter(d)):d(M)&&D.push(M)}}return r?D.filter(r):D}getEventsAsMap({filter:r,date:s,resourceRecord:e,startDate:i=s,endDate:o,startOnly:l,includeOccurrences:u=!0,dateMap:c,dayTime:d=null,storeFilterFn:g,getDateIndex:p}){var m;const D=this;if((m=c)!==null&&m!==void 0&&m.clear?c.clear():c=new Map,D.count){const S=D.useDayIndex(d),R=l?"startDate":"date",M=[],h=v=>(!r||r(v))&&(!g||g(v)),f=v=>Dr(v)&&h(v);if(d=S.dayTime,e)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");var C;(C=D.recurringEvents)===null||C===void 0||C.forEach(v=>{d.startOfDay(v.startDate)<o&&M.push(v)});for(const v=new Date(i);v<o;v.setDate(v.getDate()+1)){var x;let[y,E]=S.get(p?p(v):R,v,!0);(x=y)!==null&&x!==void 0&&x.size&&(y=[...y].filter(f),y.length&&(c.get(E)||c.set(E,[]).get(E)).push(...y))}for(let v=0,{length:y}=M;v<y;v++){const E=M[v],T=(u?E.getOccurrencesForDateRange(i,o):[E]).filter(h),A=I.add(o,1,"day");for(let w,b=0,{length:j}=T;b<j;b++){const O=T[b],k=d.startOfDay(O.startDate),W=p?p(k):l?"startDate":"date",le=W==="startDate"||!O.durationMS?I.add(k,1,"day"):I.min(O.endDate||I.add(O.startDate,O.duration,O.durationUnit),A);for(;k<le;k.setDate(k.getDate()+1)){const J=d.dateKey(k);(w=c.get(J))||c.set(J,w=[]),w.push(O)}}}}return c}},F(n,"$name","GetEventsMixin"),n};const ke={date:"_dateIndex",startDate:"_startDateIndex"},ft=Object.values(ke),cn=Object.freeze([]),{MILLIS_PER_DAY:dn}=Ke;class $e{constructor(n,t){this.dayTime=t||Ke.MIDNIGHT,this.store=n,this.users=[this.dayTime]}add(n,t,r){const s=this[ke[n]],e=this.dayTime.dateKey(t);(s[e]||(s[e]=new Set)).add(r)}addEvent(n){var i;var t;let r=(t=this.dayTime.startOfDay(n.startDate))===null||t===void 0?void 0:t.getTime(),s;if(r){var e;s=(i=(e=n.endDate)===null||e===void 0?void 0:e.getTime())!=null?i:r,this.add("startDate",r,n);do this.add("date",r,n),r+=dn;while(r<s)}}clear(){ft.forEach(n=>this[n]=Object.create(null))}get(n,t,r){!this.initialized&&this.initialize();let s=this[ke[n]],e;return t&&(e=this.dayTime.dateKey(t),s=r?[s[e],e]:s[e]),s}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,ft.forEach(n=>this[n]=null)}matches(n){return this.dayTime.startShift===n.startShift}remove(n,t,r){const s=this[ke[n]],e=this.dayTime.dateKey(t),i=s[e];i&&i.delete(r)}removeEvent(n,t,r){var o;var s;let e=(s=this.dayTime.startOfDay(t))===null||s===void 0?void 0:s.getTime(),i;if(e){i=(o=r==null?void 0:r.getTime())!=null?o:e,this.remove("startDate",e,n);do this.remove("date",e,n),e+=dn;while(e<i)}}sync(n,t,r,s,e){var i,o;t=t||cn,r=r||cn;const l=this,u=t.length,c=r.length,d=s==null?void 0:s.length;let g,p,m;if(l.initialized)switch(n){case"clear":l.clear();break;case"splice":if(d)for(t=t.slice(),r=r.slice(),g=0;g<d;g++)r.push(s[g][0]),t.push(s[g][1]);if(c)for(g=0;g<c;g++)m=r[g],l.removeEvent(m,m.startDate,m.endDate);if(u)for(g=0;g<u;g++)p=t[g],p.isScheduled&&!p.isParent&&l.addEvent(p);break;case"reschedule":m=t[0],l.removeEvent(m,((i=e.startDate)===null||i===void 0?void 0:i.oldValue)||m.startDate,((o=e.endDate)===null||o===void 0?void 0:o.oldValue)||m.endDate),l.sync("splice",t);break}}register(n){this.users.push(n)}unregister(n){const{users:t}=this,r=t.indexOf(n);return r>-1&&t.splice(r,1),!t.length}}const hn=$e.prototype;ft.forEach(a=>hn[a]=null),hn.initialized=!1,$e._$name="EventDayIndex";const{MIDNIGHT:gn}=Ke;var fn=a=>{var n;return n=class extends a{construct(r){super.construct(r),this.dayIndices=null}afterLoadData(){var r;this.syncIndices("splice",this.storage.allValues),(r=super.afterLoadData)===null||r===void 0||r.call(this)}onDataChange({action:r,added:s,removed:e,replaced:i}){this.syncIndices(r,s,e,i),super.onDataChange(...arguments)}onDataReplaced(r,s){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(r,s)}onModelChange(r,s,e,i,o){("startDate"in e||"endDate"in e)&&this.syncIndices("reschedule",[r],null,null,e),super.onModelChange(...arguments)}invalidateDayIndices(){var r;(r=this.dayIndices)===null||r===void 0||r.forEach(s=>s.invalidate())}registerDayIndex(r){const s=this,e=s.dayIndices||(s.dayIndices=[]);let i,o;for(o=0;!i&&o<e.length;++o)e[o].matches(r)&&(i=e[o]).register(r);return!i&&e.push(i=new $e(s,r)),i}syncIndices(...r){var s;(s=this.dayIndices)===null||s===void 0||s.forEach(e=>e.sync(...r))}unregisterDayIndex(r){const s=this,{dayIndices:e}=s;for(let i=e==null?void 0:e.length;i-- >0;)if(e[i].matches(r)){e[i].unregister(r)&&e.splice(i,1);break}}useDayIndex(r){const s=this,{dayIndices:e}=s;r=r||gn;for(let i=0;e&&i<e.length;++i)if(e[i].matches(r))return e[i];if(r.startShift)throw new Error(`No day index registered for ${r} on ${s.id}`);return s.registerDayIndex(gn)}},F(n,"$name","DayIndexMixin"),n};const mn=Object.freeze([]);var mt=a=>class extends(a||V){static get $name(){return"RecurringTimeSpansMixin"}construct(...t){const r=this;r.globalOccurrences=new Map,r.recurringEvents=new Set,super.construct(...t)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:t,added:r,removed:s,replaced:e}){this.refreshRecurringEventsCache(t,r,s,e),super.onDataChange(...arguments)}refreshRecurringEventsCache(t,r=mn,s=mn,e){const i=this,{recurringEvents:o}=i,l=e==null?void 0:e.length;switch(t){case"clear":o.clear();break;case"splice":{if(l){r=r.slice(),s=s.slice();for(let d=0;d<l;d++)s.push(e[d][0]),r.push(e[d][1])}const u=r.length,c=s.length;if(c&&o.size)for(let d=0;d<c;d++)o.delete(s[d]);if(u)for(let d=0;d<u;d++){const g=r[d];g.isRecurring&&o.add(g)}break}}}getById(t){let r=super.getById(t);return r||(r=this.globalOccurrences.get(this.modelClass.asId(t))),r}onModelChange(t,r,s,e,i){const o=!e&&this.isRecurrenceRelatedFieldChange(t,s);if(o&&t.removeOccurrences(),super.onModelChange(...arguments),o){const l={action:"batch",records:this.storage.values};this.trigger("refresh",l),this.trigger("change",l)}}isRecurrenceRelatedFieldChange(t,r){return t.isRecurring||"recurrenceRule"in r}getOccurrencesForTimeSpan(t,r,s){const e=[];return t.isRecurring&&t.recurrence.forEachOccurrence(r,s,i=>e.push(i)),e}set data(t){this.globalOccurrences.clear(),super.data=t}getRecurringTimeSpans(){return[...this.recurringEvents]}},pn=a=>class extends mt(a||V){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(t){return super.isEventPersistable(t)&&(!t.supportsRecurring||!t.isOccurrence)}};const Cr=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,vn=["SU","MO","TU","WE","TH","FR","SA"];class ve extends V{static decodeDay(n){let t,r;return(t=Cr.exec(n))&&(r=[vn.indexOf(t[2])],t[1]&&(t[1]=parseInt(t[1],10),r.push(t[1]))),r}static encodeDay(n){let t;return Array.isArray(n)&&([n,t]=n),(t?t.toString():"")+vn[n]}static decode(n){const t=[];let r;if(n)for(let s=0;s<n.length;s++)(r=this.decodeDay(n[s]))&&t.push(r);return t}static encode(n){const t=[];let r;if(n)for(let s=0;s<n.length;s++)(r=this.encodeDay(n[s]))&&t.push(r);return t}}ve._$name="RecurrenceDayRuleEncoder";const Rr=/ly$/i,pt=a=>{const n=a.replace(Rr,"");return n==="DAI"?"DAY":n},Er=(a,n,t,r)=>r.buildOccurrence(a,t),Ir=a=>vt=a;let vt;class K extends V{static processIterationConfig(n){var t;const{recurrence:r}=n,{frequency:s,interval:e,timeSpan:i,endDate:o,count:l}=r;if(!n.syncingStartDate&&!i.meta.isSyncedWithRule){const p=I.add(i.startDate,e,pt(s)),m=I.min(p,n.endDate||p);this.forEachDate({syncingStartDate:!0,startDate:i.startDate,endDate:m,recurrence:r,fn:Er})}const u=i.startDate;let{startDate:c=u,endDate:d=o}=n;c<u&&(c=u),o?(!d||d>o)&&(d=o):l&&c>u&&(this.forEachDate({recurrence:r,fn:Ir}),(!d||d>vt)&&(d=new Date(vt.getTime()+1)));const g=c;return n.startOnly||(c=new Date(I.max(I.add(c,-e,pt(s)),u))),Object.assign({extraArgs:[],startOnly:!i.durationMS},n,{startDate:c,endDate:d,timeSpan:i,timeSpanStart:u,earliestVisibleDate:g,endDateMS:(t=d)===null||t===void 0?void 0:t.getTime(),timeSpanStartMS:u.getTime(),earliestVisibleDateMS:g.getTime(),durationMS:i.durationMS,spansStart:c<=u&&d>u})}static getOccurrenceIndex(n){if(n.isOccurrence)return I.diff(n.recurringTimeSpan.startDate,n.startDate,pt(n.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(n,t,r,s){let e,i,o;if(s){s>0?(i=1,o=n):(i=-1,o=t);const l=r-o.getDay();i*l<0&&(s+=i),e=new Date(o),e.setDate(o.getDate()+(s-i)*7+l),(e<n||e>t)&&(e=null)}return e}static buildDate(n,t,r){const s=new Date(n,t,r);if(s.getFullYear()===n&&s.getMonth()===t&&s.getDate()===r)return s}static isValidPosition(n){return!!n}static forEachDateAtPositions(n,t,r,s){const e=n.length,i={};for(let o=0;o<t.length;o++){const l=t[o];if(this.isValidPosition(l)){const u=l>0?n[l-1]:n[e+l];if(u&&!i[u.getTime()]&&(i[u.getTime()]=!0,r.call(s,u)===!1))return!1}}}static isInView(n,t,r,s,e){return(n?t>=r:t.valueOf()+s>r)&&!e.hasException(t)}static isInViewMS(n,t,r,s,e,i){return(n?r>=s:r+e>s)&&!i.hasException(t)}}F(K,"frequency","NONE"),F(K,"MAX_OCCURRENCES_COUNT",1e6),K._$name="AbstractRecurrenceIterator";class Le extends K{static forEachDate(n){const{startOnly:t,startDate:r,endDate:s,endDateMS:e,timeSpan:i,timeSpanStart:o,earliestVisibleDateMS:l,durationMS:u,spansStart:c,recurrence:d,fn:g,extraArgs:p,scope:m=this}=this.processIterationConfig(n),{interval:D}=d,C=r-o,x=D*864e5,S=Math.floor(C/x);let{count:R}=d,M=0,h=I.add(o,S*D,"day"),f=h.getTime();for(!s&&!R&&(R=this.MAX_OCCURRENCES_COUNT);!e||f<e;){const v=this.isInViewMS(t,h,f,l,u,i);if(M++,v&&(e&&f>e||g.apply(m,[h,M,M===1&&c,i,...p])===!1||R&&M>=R))break;h=I.add(h,D,"day"),f=h.getTime()}}}F(Le,"frequency","DAILY"),Le._$name="DailyRecurrenceIterator";class Ne extends K{static forEachDate(n){var t;const{startOnly:r,startDate:s,endDateMS:e,timeSpan:i,timeSpanStart:o,timeSpanStartMS:l,earliestVisibleDateMS:u,durationMS:c,spansStart:d,recurrence:g,fn:p,extraArgs:m,scope:D=this}=this.processIterationConfig(n),{interval:C,days:x}=g,{weekStartDay:S}=I,R=o.getHours(),M=o.getMinutes(),h=o.getSeconds(),f=o.getMilliseconds();let v=0,{count:y}=g,E=ve.decode(x),T,A;if((t=E)!==null&&t!==void 0&&t.length||(E=[[o.getDay()]]),S>0)for(let w=0;w<E.length;w++)S>E[w][0]?E[w][0]=7-S-E[w][0]:E[w][0]-=S;for(E.sort((w,b)=>w[0]-b[0]),T=I.getNext(y||C>1?o:s,"week",0),!e&&!y&&(y=this.MAX_OCCURRENCES_COUNT);!e||T.getTime()<e;){for(let w=0;w<E.length;w++){A=new Date(T.getFullYear(),T.getMonth(),T.getDate()+E[w][0],R,M,h,f);const b=A.getTime();if(b>=l){const j=this.isInViewMS(r,A,b,u,c,i);if(v++,j&&(e&&b>=e||p.apply(D,[A,v,v===1&&d,i,...m])===!1||y&&v>=y))return}}T=I.getNext(T,"week",C)}}}F(Ne,"frequency","WEEKLY"),Ne._$name="WeeklyRecurrenceIterator";class Be extends K{static getNthDayOfMonth(n,t){const r=I.daysInMonth(n);let s=null;return t&&Math.abs(t)<=r&&(s=new Date(n.getFullYear(),n.getMonth(),t<0?r+t+1:t)),s}static isValidPosition(n){return n&&Math.abs(n)>0&&Math.abs(n)<=31}static forEachDate(n){const{startOnly:t,startDate:r,endDate:s,timeSpan:e,timeSpanStart:i,earliestVisibleDate:o,durationMS:l,spansStart:u,recurrence:c,fn:d,extraArgs:g,scope:p=this}=this.processIterationConfig(n),{interval:m,days:D,count:C,positions:x}=c,S=ve.decode(D),R=x&&x.length,M={};let{monthDays:h}=c,f=0,v,y,E,T,A,w;for(y=I.startOf(C||m>1?i:r,"month"),E=new Date(I.getNext(y,"month",1)-1),!(h&&h.length)&&!(S&&S.length)&&(h=[i.getDate()]),S&&S.length&&S.forEach(b=>{b[1]&&(v=v||{},v[b[0]]=b[1])});(!s||s>y)&&(!C||f<C);){if(T=[],S&&S.length){if(S.forEach(b=>{const j=b[0];let O=1,k=53;for(b[1]&&(O=k=b[1]),w=O;w<=k;w++)(A=this.getNthDayInPeriod(y,E,j,w))&&(A=I.copyTimeValues(A,i),M[A.getTime()]||(M[A.getTime()]=!0,T.push(A)))}),T.sort((b,j)=>b-j),!R){for(w=0;w<T.length;w++)if(A=T[w],A>=i){const b=this.isInView(t,A,o,l,e);if(f++,b&&(s&&A>=s||d.apply(p,[A,f,f===1&&u,e,...g])===!1||C&&f>=C))return!1}}}else{const b=[];for(w=0;w<h.length;w++)(A=this.getNthDayOfMonth(y,h[w]))&&!M[A.getTime()]&&(M[A.getTime()]=!0,b.push(A));for(b.sort((j,O)=>j-O),w=0;w<b.length;w++)if(A=I.copyTimeValues(b[w],i),R)T.push(A);else if(A>=i){const j=this.isInView(t,A,o,l,e);if(f++,j&&(s&&A>s||d.apply(p,[A,f,f===1&&u,e,...g])===!1||C&&f>=C))return}}R&&T.length&&this.forEachDateAtPositions(T,x,b=>{if(b>=i){const j=t?b>=o:b.valueOf()+l>o&&!e.hasException(b);if(f++,j&&(!s||b<=s)&&(d.apply(p,[b,f,f===1&&u,e,...g])===!1||C&&f>=C))return!1}}),y=I.getNext(y,"month",m),E=new Date(I.getNext(y,"month",1)-1)}}}F(Be,"frequency","MONTHLY"),Be._$name="MonthlyRecurrenceIterator";class _e extends K{static forEachDate(n){const{startOnly:t,startDate:r,endDate:s,timeSpan:e,timeSpanStart:i,earliestVisibleDate:o,durationMS:l,spansStart:u,recurrence:c,fn:d,extraArgs:g,scope:p=this}=this.processIterationConfig(n),{interval:m,days:D,count:C,positions:x}=c,S=ve.decode(D),R=x&&x.length,M={};let{months:h}=c,f=0,v,y,E,T,A,w;for(T=I.startOf(C||m>1?i:r,"year"),A=new Date(I.getNext(T,"year",1)-1),h&&h.sort((b,j)=>b-j),!(h&&h.length)&&!(S&&S.length)&&(h=[i.getMonth()+1]),S&&S.length&&S.forEach(b=>{b[1]&&(w=w||{},w[b[0]]=b[1])});(!s||s>T)&&(!C||f<C);){if(E=[],S&&S.length){if(S.forEach(b=>{const j=b[0];let O=1,k=53;for(b[1]&&(O=k=b[1]),v=O;v<=k;v++)(y=this.getNthDayInPeriod(T,A,j,v))&&(y=I.copyTimeValues(y,i),M[y.getTime()]||(M[y.getTime()]=!0,E.push(y)))}),E.sort((b,j)=>b-j),!R){for(v=0;v<E.length;v++)if(y=E[v],y>=i){const b=this.isInView(t,y,o,l,e);if(f++,b&&(s&&y>=s||d.apply(p,[y,f,f===1&&u,e,...g])===!1||C&&f>=C))return}}}else for(v=0;v<h.length;v++)if((y=this.buildDate(T.getFullYear(),h[v]-1,i.getDate()))&&(y=I.copyTimeValues(y,i),!M[y.getTime()])){if(M[y.getTime()]=!0,R)E.push(y);else if(y>=i){const b=t?y>=o:y.valueOf()+l>o&&!e.hasException(y);if(f++,b&&(s&&y>=s||d.apply(p,[y,f,f===1&&u,e,...g])===!1||C&&f>=C))return}}R&&E.length&&this.forEachDateAtPositions(E,x,b=>{if(b>=i){const j=t?b>=o:b.valueOf()+l>o&&!e.hasException(b);if(f++,j&&(!s||b<s)&&(d.apply(p,[b,f,f===1&&u,e,...g])===!1||C&&f>=C))return!1}}),T=I.getNext(T,"year",m),A=new Date(I.getNext(T,"year",1)-1)}}}F(_e,"frequency","YEARLY"),_e._$name="YearlyRecurrenceIterator";const yn={};[Le,Ne,Be,_e].forEach(a=>{yn[a.frequency]=a});function yt(a){return a?typeof a=="string"&&(a=a.split(",").map(n=>parseInt(n,10))):a=null,a}function xr(a){return a?typeof a=="string"&&(a=a.split(",")):a=null,a}function Ve(a,n){return String(a)===String(n)}function Sn(a){return this.defaultValue&&a===void 0?this.defaultValue:this.allowNull&&a==null?null:(a=parseInt(a),isNaN(a)?void 0:a)}class St extends B{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:Sn},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:Sn},{name:"days",convert:xr,isEqual:Ve},{name:"monthDays",convert:yt,isEqual:Ve},{name:"months",convert:yt,isEqual:Ve},{name:"positions",convert:yt,isEqual:Ve}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(n){this._dateFormat=n}get recurrenceIterator(){return yn[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(n){this._timeSpan=n}get rule(){const n=this,t=[];return n.frequency&&(t.push(`FREQ=${n.frequency}`),n.interval>1&&t.push(`INTERVAL=${n.interval}`),n.days&&n.days.length&&t.push("BYDAY="+n.days.join(",")),n.monthDays&&n.monthDays.length&&t.push("BYMONTHDAY="+n.monthDays.join(",")),n.months&&n.months.length&&t.push("BYMONTH="+n.months.join(",")),n.count&&t.push(`COUNT=${n.count}`),n.endDate&&t.push("UNTIL="+I.format(n.endDate,n.dateFormat)),n.positions&&n.positions.length&&t.push("BYSETPOS="+n.positions.join(","))),t.join(";")}set rule(n){const t=this,r={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(t.beginBatch(),n){const s=n.split(";");for(let e=0,i=s.length;e<i;e++){const o=s[e].split("="),l=o[1];switch(o[0]){case"FREQ":r.frequency=l;break;case"INTERVAL":r.interval=l;break;case"COUNT":r.count=l,r.until=null;break;case"UNTIL":l?r.endDate=I.parse(l,t.dateFormat):r.endDate=null,r.count=null;break;case"BYDAY":r.days=l;break;case"BYMONTHDAY":r.monthDays=l;break;case"BYMONTH":r.months=l;break;case"BYSETPOS":r.positions=l;break}}}t.set(r),n&&t.sanitize(),t.endBatch()}construct(n={}){const t=this,{rule:r,timeSpan:s}=n;t._suspendedTimeSpanNotifying=0,delete n.timeSpan,delete n.rule,super.construct(...arguments),r&&(t.suspendTimeSpanNotifying(),t.rule=r,t.resumeTimeSpanNotifying()),t.timeSpan=s}forEachOccurrence(n,t,r){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:n,endDate:t,fn(s,e,i,o){return r(o.buildOccurrence(s,i),i,e,s)}})}sanitize(){var n;const t=this,r=(n=t.timeSpan)===null||n===void 0?void 0:n.startDate,s={};switch(t.isSanitizing=!0,t.frequency){case"DAILY":s.positions=null,s.days=null,s.monthDays=null,s.months=null;break;case"WEEKLY":{s.positions=null,s.monthDays=null,s.months=null;const{days:i}=t;r&&(i==null?void 0:i.length)===1&&i[0]===ve.encodeDay(r.getDay())&&(s.days=null);break}case"MONTHLY":{var e;(e=t.monthDays)!==null&&e!==void 0&&e.length&&(s.positions=null,s.days=null),s.months=null;const{monthDays:i}=t;r&&(i==null?void 0:i.length)===1&&i[0]===r.getDate()&&(s.monthDays=null);break}case"YEARLY":{s.monthDays=null;const{months:i}=t;r&&(i==null?void 0:i.length)===1&&i[0]===r.getMonth()+1&&(s.months=null);break}}t.set(s),t.isSanitizing=!1}copy(...n){const t=super.copy(...n);return t.dateFormat=this.dateFormat,t.timeSpan=this.timeSpan,t}afterChange(n,t,r){const s=super.afterChange(n,t,r),{timeSpan:e}=this;return this.isSanitizing||this.sanitize(),e&&(e.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||e.onRecurrenceChanged()),s}set(n,t,...r){const s=typeof n=="object"?n:{[n]:t};s.count?s.endDate=null:s.endDate&&(s.count=null),super.set(s,void 0,...r)}get isTimeSpanNotifyingSuspended(){return!!this._suspendedTimeSpanNotifying}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}}St._$name="RecurrenceModel";function Mr(a){const n={},{dateFormat:t}=this;return a&&(a=typeof a=="string"?a.split(","):_.asArray(a),a.forEach(r=>{typeof r=="string"&&(r=I.parse(r,t)),isNaN(r)||(n[I.makeKey(r)]=1)})),n}function Tr(a){const n=[],{dateFormat:t}=this;for(const r in a)a[r]&&n.push(I.format(I.parseKey(r),t));return n}const Ar=[];var Dt=a=>class extends(a||ee){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:Mr,serialize:Tr,internal:!0}]}remove(){if(this.isOccurrence){const t=this,{recurringTimeSpan:r}=t;t.cancelBatch(),r.beginBatch(),t.detachFromRecurringEvent(),r.endBatch()}else return super.remove(...arguments)}get eventStore(){var t;let r=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!r&&(t=this.firstStore)!==null&&t!==void 0&&t.isRecurringTimeSpansMixin&&(r=this.firstStore),r}get recurrenceModel(){return this._recurrenceModel||St}set recurrenceModel(t){this._recurrenceModel=t}setRecurrence(t,r,s){const e=this;let i;t&&(t.isRecurrenceModel||(typeof t=="string"&&(t={frequency:t},r&&(t.interval=r),s&&(s instanceof Date?t.endDate=s:t.count=s)),t=new e.recurrenceModel(t)),t.timeSpan=e,i=t.rule),e.recurrence=t,e.recurrenceRule=i}get recurrence(){const t=this,r=t.recurrenceRule;return!t._recurrence&&r&&(t._recurrence=new t.recurrenceModel({rule:r,timeSpan:t,id:`${t.id}-recurrence`})),t._recurrence}set recurrence(t){const r=this;r._recurrence=t,t?(t.timeSpan=r,r.recurrenceRule=t.rule):r.isOccurrence?r.setData("recurrenceRule",null):r.recurrenceRule=null}get isRecurring(){return!!(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return!!this.recurringTimeSpan}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(t){this._recurringTimeSpan=t}getOccurrencesForDateRange(t,r=t){return this.eventStore.getOccurrencesForTimeSpan(this,t,r)}get occurrences(){if(this.isRecurring){const t=[];return this.occurrenceMap.forEach(r=>{r!==this&&t.push(r)}),t}return Ar}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(t){var r;const s=t.isTimeSpan?t.occurrenceDate:t;(r=this.eventStore)===null||r===void 0||r.globalOccurrences.delete(this.createRecurrenceKey(s)),this.occurrenceMap.delete(I.makeKey(s))}removeOccurrencesFrom(t){this.occurrenceMap.forEach((r,s)=>{I.parseKey(s)>=t&&this.removeOccurrence(r)})}removeOccurrences(){[this,...this.occurrences].forEach(t=>this.removeOccurrence(t))}onRecurrenceChanged(){var t;this.recurrenceRule=((t=this.recurrence)===null||t===void 0?void 0:t.rule)||null}sanitizeRecurrenceData(t=this.recurrence){if(t.endDate){const r=I.clearTime(t.endDate),{exceptionDates:s}=this;if(this.removeOccurrencesFrom(r),s)for(const e in s)I.parseKey(e)>=r&&delete s[e]}}get occurrenceDate(){var t;return((t=this.meta.modified)===null||t===void 0?void 0:t.startDate)||this.startDate}get occurrenceIndex(){return K.getOccurrenceIndex(this)}buildOccurrence(t,r){var s;const e=this,{occurrenceMap:i,recurrence:o,meta:l}=e,u=(s=e.eventStore)===null||s===void 0?void 0:s.globalOccurrences,c=I.makeKey(t),d=e.createRecurrenceKey(t,c),g=!(t-e.startDate),{fieldMap:p}=e.constructor;let m=u==null?void 0:u.get(d),{duration:D}=e;e.endDate&&(e.allDay||!D)&&(D=I.as(e.durationUnit,e.endDate.getTime()-e.startDate.getTime()));const C=D!==void 0?I.add(t,D,e.durationUnit):void 0;return m||(r||g?(m=e,g||(e.setStartEndDate(t,C,!0),o.suspendTimeSpanNotifying(),o.sanitize(),o.resumeTimeSpanNotifying()),l.isSyncedWithRule=!0):(m=e.copy({[p.id.dataSource]:d,[p.startDate.dataSource]:t,[p.endDate.dataSource]:C,[p.duration.dataSource]:D,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),m.recurringTimeSpan=e),u==null||u.set(d,m),i.set(c,m)),m}createRecurrenceKey(t=this.startDate,r=null){return`_generated:${this.id}:${r||I.makeKey(t)}`}convertToRealEvent(t,r){var s;if(!this.isOccurrence)return;const e=this,{recurringTimeSpan:i,resource:o,occurrenceIndex:l,recurrence:u}=e,c=u&&i.recurrence.count,d=(t==null||(s=t.resourceRecords)===null||s===void 0?void 0:s.value)||e.data.newResource;i.beginBatch(),e.detachFromRecurringEvent(),e.clearChanges(),e.setData("id",e.generateId(i.eventStore)),d&&delete e.data.resourceId,i.eventStore.add(e,r),c&&(e.recurrence.count=c-l),(d||o)&&e.assign(d||o),d&&delete e.data.resourceRecords,t&&delete t.resourceRecords,i.endBatch()}afterChange(t,r,s,...e){const i=this,{eventStore:o}=i;return"recurrenceRule"in r&&(i._recurrence=null,o==null||o.recurringEvents[r.recurrenceRule.value?"add":"delete"](i)),i.isOccurrence?i.convertToRealEvent(r,s):"newExceptionDate"in r&&(i.meta.modified.exceptionDates=!0,delete i.meta.modified.newExceptionDate,i.removeOccurrence(r.newExceptionDate.value)),super.afterChange(t,r,s,...e)}detachFromRecurringEvent(){const t=this,{recurringTimeSpan:r,occurrenceDate:s,startDate:e}=t;t.recurringTimeSpan=null,r.addExceptionDate(s),t.recurrenceRule&&(r.recurrence.endDate=I.add(e,-1,"minute"))}set newExceptionDate(t){if(t){const r=this.exceptionDates||(this.exceptionDates={});r[I.makeKey(t)]=1}}addExceptionDate(t){return this.set({newExceptionDate:t})}hasException(t){var r;return(r=this.exceptionDates)===null||r===void 0?void 0:r[I.makeKey(t)]}};const br=1e3*60*60*24;var Dn=a=>class extends a{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resourceIds",type:"array",persist:!1,internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0,useProp:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach(t=>{t.eventId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentEventIds()}get resources(){return this.assignments.reduce((t,{resource:r})=>(r&&t.push(r.$original),t),[])}set resources(t){var r;t=_.asArray(t);const s=this,e=t.map(s.constructor.asId);if(s.usesSingleAssignment)s.set("resourceId",e[0]);else if((r=s.fieldMap)!==null&&r!==void 0&&r.resourceIds.persist)s.resourceIds=e;else{const i=s.assignments.map(u=>u.resource.id),{onlyInA:o,onlyInB:l}=_.delta(e,i);s.assignmentStore.add(o.map(u=>({resource:u,event:s}))),s.assignmentStore.remove(l.map(u=>s.assignments.find(c=>c.resource.id===u)))}}forEachResource(t,r=this){for(const s of this.resources)if(t.call(r,s)===!1)return}getResource(t){return t==null?this.resource:this.resourceStore?this.resourceStore.getById(t):null}get startDate(){var r;let t;return this.isOccurrence?t=this.get("startDate"):t=(r=this._startDate)!=null?r:super.startDate,this.allDay&&(t=this.constructor.getAllDayStartDate(t)),t}set startDate(t){this.batching?(this._startDate=t,this.set({startDate:t})):super.startDate=t}get endDate(){var r;let t;return this.isOccurrence?t=this.get("endDate"):t=(r=this._endDate)!=null?r:super.endDate,this.allDay&&(t=this.constructor.getAllDayEndDate(t)),t}set endDate(t){this.batching?(this._endDate=t,this.set({endDate:t})):super.endDate=t}get wrapStartDate(){return this.startDate}set wrapStartDate(t){}get wrapEndDate(){return this.endDate}set wrapEndDate(t){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(){const t=this,{isPersistable:r,meta:{batchChanges:s}}=t;if(s&&("endDate"in s&&(delete t._endDate,t.postamble&&(t.wrapEndDate=null)),"startDate"in s&&(delete t._startDate,t.preamble&&(t.wrapStartDate=null))),super.endBatch(...arguments),t.isPersistable&&!r&&!t.ignoreBag&&t.assigned)for(const e of t.assigned)e.stores.forEach(i=>i.updateModifiedBagForRecord(e))}get isCreating(){return super.isCreating}set isCreating(t){var r,s;super.isCreating=t,(r=this.assignmentStore)===null||r===void 0||r.suspendAutoCommit(),this.assignments.forEach(e=>e.isCreating=t),(s=this.assignmentStore)===null||s===void 0||s.resumeAutoCommit()}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...t){const r=super.copy(...t);return this.usesSingleAssignment||(r.resourceId=null),r}get persistableData(){const t=super.persistableData;return this.usesSingleAssignment||delete t.resourceId,t}get resource(){const{resources:t}=this;return t.length?t[0]:null}set resource(t){this.resourceId=this.constructor.asId(t)}get resourceId(){var t;return this.usesSingleAssignment?this.get("resourceId"):(t=this.resource)===null||t===void 0?void 0:t.id}set resourceId(t){this.applyResourceId(t)}get resourceIds(){var s;var t;if((t=this.fieldMap)!==null&&t!==void 0&&t.resourceIds.persist)return this.get("resourceIds");var r;return(s=(r=this.resources)===null||r===void 0?void 0:r.map(e=>e.id))!=null?s:[]}set resourceIds(t){this.set("resourceIds",t)}get $linkedResources(){var r;var t;return(r=(t=this.resources)===null||t===void 0?void 0:t.flatMap(s=>[s,...s.$links]))!=null?r:[]}applyResourceId(t,r=!1){const s=this,{eventStore:e,assignments:i}=s;if(e){var o,l;const u=e.assignmentStore||((o=e.crudManager)===null||o===void 0?void 0:o.assignmentStore);if(t!=null)if(s.meta.skipEnforcingSingleAssignment||(e.usesSingleAssignment=!0),i!=null&&i.length&&t!==i[0].resourceId){const c=!!e.eventsSuspended;c&&u.suspendEvents(),i[0].resource=t,c&&u.resumeEvents()}else u.assignEventToResource(s,t);else(s.usesSingleAssignment||(l=s.resourceIds)!==null&&l!==void 0&&l.length)&&u.remove(i)}else r||s.set({resourceId:t})}applyResourceIds(t,r=!1){const s=this,{eventStore:e,assignments:i}=s;if(s.fieldMap.resourceIds.persist===!1)return!1;if(t=[...new Set(t)],e){var o,l;const u=e.assignmentStore||((o=e.crudManager)===null||o===void 0?void 0:o.assignmentStore);if((l=t)!==null&&l!==void 0&&l.length)if(i!=null&&i.length){const c=!!e.eventsSuspended;c&&u.suspendEvents(),i.forEach(p=>{const m=t.find(D=>!i.some(C=>C.resourceId===D));m&&(p.resource=m)});const{onlyInA:d,onlyInB:g}=_.delta(t,i.map(p=>p.resourceId));u.add(d.map(p=>({resource:p,event:s}))),u.remove(g.map(p=>i.find(m=>m.resource.id===p))),c&&u.resumeEvents()}else u.add(t.map(c=>({resource:c,event:s})));else u.remove(i)}else r||s.set({resourceIds:t})}applyValue(t,r,s,e,i){if(i&&!this.meta.isAssigning){const{eventStore:o}=this;switch(i.name){case"resourceId":o&&(o.isAssigning=!0),this.applyResourceId(s,!0);break;case"resourceIds":o&&(o.isAssigning=!0),this.applyResourceIds(s,!0);break}o&&(o.isAssigning=!1)}super.applyValue(t,r,s,e,i)}get assignments(){return[...this.assigned||[]]}assign(t,r=!1){const{eventStore:s}=this;s&&!s.usesSingleAssignment?s.assignEventToResource(this,t,r):(this.resourceId=this.constructor.asId(t),s||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(t,r=!1){var s;const e=this;t=e.constructor.asId(t),e.meta.removingResource=r,(s=e.eventStore)===null||s===void 0||s.unassignEventFromResource(e,t),e.meta.removingResource=null}reassign(t,r){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,t,r)}isAssignedTo(t){const r=this.constructor.asId(t);return this.assignments.some(s=>s.resourceId===r)}get predecessors(){var t;return[...(t=this.incomingDeps)!=null?t:[]]}get successors(){var t;return[...(t=this.outgoingDeps)!=null?t:[]]}get dependencies(){var t,r;return[...(t=this.incomingDeps)!=null?t:[],...(r=this.outgoingDeps)!=null?r:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:t}=this;if(t>=br||!t&&this.allDay)return!0;const{endDate:r,startDate:s}=this,e=I.clearTime(s);if(s&&r)return e.setDate(e.getDate()+1),(r||I.add(s,t))>e}static getAllDayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),t&&(t=I.clearTime(t,!0)),t}static getAllDayEndDate(t){return t&&t.isEvent&&(t=t.get("endDate")),t&&(t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0||t.getMilliseconds()>0)&&(t=I.getNext(t,"d",1)),t}static getAllDayDisplayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),I.clearTime(t,!0)}static getAllDayDisplayEndDate(t,r){return t&&t.isEvent&&(r=t.get("endDate"),t=t.get("startDate")),r&&(t=this.constructor.getAllDayDisplayStartDate(t),I.clearTime(r,!0).valueOf()===r.valueOf()?r=I.add(r,I.DAY,-1):t.valueOf()!==r.valueOf()&&(r=I.clearTime(r,!0))),r}isEditable(t){switch(t){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(t)}};const wr=Fe;class Ce extends wr.derive(ee).mixin(Dt,Z,Dn){static get $name(){return"EventModel"}}Ce.exposeProperties(),Ce._$name="EventModel";const Pr=Z(ct.derive(de));class Ye extends Pr.mixin(pn,ln,fn,un){static get defaultConfig(){return{modelClass:Ce}}}F(Ye,"$name","EventStore"),Ye._$name="EventStore";var Cn=a=>class extends a{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(t,...r){t=t||{};const{fieldMap:s}=this,e=s.eventId.dataSource,i=s.resourceId.dataSource,o=s.event.dataSource,l=s.resource.dataSource,u=t[e],c=t[i],d=t[o],g=t[l];u!=null?t[o]=u:d!=null&&(t[e]=d.isModel?d.id:d),c!=null?t[l]=c:g!=null&&(t[i]=g.isModel?g.id:g),super.construct(t,...r)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(t,r){let s,e;return t?s=t.isModel?t.id:t:s=this.internalId,r?e=r.isModel?r.id:r:e=this.internalId,`${s}-${e}`}buildIndexKey({event:t,resource:r}){return this.buildEventResourceKey(t,r)}set(t,r,...s){const e=this.fieldToKeys(t,r);if("resource"in e){var i;((i=e.resource)===null||i===void 0?void 0:i.id)!==void 0&&(e.resourceId=e.resource.id)}else"resourceId"in e&&this.constructor.isProAssignmentModel&&(e.resource=e.resourceId);if("event"in e){var o;((o=e.event)===null||o===void 0?void 0:o.id)!==void 0&&(e.eventId=e.event.id)}else"eventId"in e&&this.constructor.isProAssignmentModel&&(e.event=e.eventId);return super.set(e,null,...s)}afterChange(t,r,s,e,i){var o,l;const u=this;return!u.constructor.isProAssignmentModel&&r!==null&&r!==void 0&&r.resourceId&&((o=u.resource)===null||o===void 0?void 0:o.id)!==r.resourceId.value?u.resource=r.resourceId.value:u.constructor.isProAssignmentModel&&(l=u.project)!==null&&l!==void 0&&l.propagatingSyncChanges&&r!==null&&r!==void 0&&r.eventId&&!(r!=null&&r.event)&&(t.event.value===r.eventId.value||t.event.value.id===r.eventId.value)&&(delete r.eventId,delete u.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(t){const{resource:r}=this;r!=null&&r.isModel&&r.id===t?this.set("resourceId",t):this.resource=t}get resourceId(){var r;var t;return(r=(t=this.resource)===null||t===void 0?void 0:t.id)!=null?r:this.get("resourceId")}set eventId(t){const{event:r}=this;r!=null&&r.isModel&&r.id===t?this.set("eventId",t):this.event=t}get eventId(){var r;var t;return(r=(t=this.event)===null||t===void 0?void 0:t.id)!=null?r:this.get("eventId")}get eventName(){var t;return(t=this.event)===null||t===void 0?void 0:t.name}get resourceName(){var t;return(t=this.resource)===null||t===void 0?void 0:t.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var t;const{event:r,resource:s,unjoinedStores:e,assignmentStore:i}=this,o=i==null?void 0:i.crudManager;let l;return i?l=this.isValid&&r.isPersistable&&(o||!r.hasGeneratedId&&!s.hasGeneratedId):l=!this.isPhantom&&!!e[0],l&&super.isPersistable&&!((t=this.event)!==null&&t!==void 0&&t.isCreating)}get isValid(){return this.resource!=null&&this.event!=null}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(t,r,s){if(!super.shouldRecordFieldChange(t,r,s))return!1;if(t==="event"||t==="eventId"){var e;const o=(e=this.project)===null||e===void 0?void 0:e.eventStore;if(o&&o.oldIdMap[r]===o.getById(s))return!1}if(t==="resource"||t==="resourceId"){var i;const o=(i=this.project)===null||i===void 0?void 0:i.resourceStore;if(o&&o.oldIdMap[r]===o.getById(s))return!1}return!0}};const jr=je;class Re extends Cn(Z(jr.derive(B))){static get $name(){return"AssignmentModel"}}Re.exposeProperties(),Re._$name="AssignmentModel";var Rn=a=>class extends a{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(t,...r){t=_.asArray(t);for(let e=0;e<t.length;e++){var s;let i=t[e];if(i instanceof B||(t[e]=i=this.createRecord(i)),!this.isSyncingDataOnLoad&&this.storage.findIndex("eventResourceKey",i.eventResourceKey,!0)!==-1)throw new Error(`Duplicate assignment Event: ${i.eventId} to resource: ${i.resourceId}`);(s=i.event)!==null&&s!==void 0&&s.isCreating&&(i.isCreating=!0)}return super.add(t,...r)}includesAssignment(t,r){return this.storage.findIndex("eventResourceKey",`${t}-${r}`,!0)!==-1}setStoreData(t){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined EventStore data containing resourceId (single-assignment mode)");super.setStoreData(t)}set storage(t){super.storage=t,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(t,r){if(!t||!(r!=null&&r.isOccurrence))return t;const s=this;return{id:`${r.id}:a${t.id}`,event:r,resource:t.resource,eventId:r.id,resourceId:t.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(e){return s.occurrenceInstanceMeta(this,e)}}}occurrenceInstanceMeta(t,r){const s=this,e=r.id||r,{id:i}=t;let{occurrenceMeta:o}=s;return o||(o=s.occurrenceMeta={}),o[i]||(o[i]={}),o[i][e]||(o[i][e]={})}mapAssignmentsForEvent(t,r,s){t=this.eventStore.getById(t);const e=!!r,i=!!s;return e||i?t.assignments.reduce((o,l)=>{const u=e?r(l):l;return(!i||s(u))&&o.push(u),o},[]):t.assignments}mapAssignmentsForResource(t,r,s){t=this.resourceStore.getById(t);const e=!!r,i=!!s;return e||i?t.assignments.reduce((o,l)=>{const u=e?r(l):l;return(!i||s(u))&&o.push(u),o},[]):t.assignments}getAssignmentsForEvent(t){return t.assignments}removeAssignmentsForEvent(t){return this.remove(t.assignments)}getAssignmentsForResource(t){return t=this.resourceStore.getById(t),t.assignments}removeAssignmentsForResource(t){this.remove(this.getAssignmentsForResource(t))}getResourcesForEvent(t){return t.resources}getEventsForResource(t){var r;return t=this.resourceStore.getById(t),(r=t)===null||r===void 0?void 0:r.events}assignEventToResource(t,r,s=null,e=!1){var i;const o=this,l=e?new Set(t.assignments):null;if(r=_.asArray(r).map(d=>{var g;return(g=d.$original)!=null?g:d}),(i=o.eventStore)!==null&&i!==void 0&&i.usesSingleAssignment){var u;if((u=t.assignments)!==null&&u!==void 0&&u.length)return o.isEventAssignedToResource(t,r[0])||(t.resource=r[0]),[];t.resourceId=r[0].id}let c=[];return o.suspendAutoCommit(),r.forEach(d=>{var p;const g=o.getAssignmentForEventAndResource(t,d);if(g)e&&l.delete(g);else{const m={event:t,resource:d};c.push((p=s==null?void 0:s(m))!=null?p:m)}}),c=o.add(c),e&&o.remove(Array.from(l)),o.resumeAutoCommit(),c}unassignEventFromResource(t,r){const s=this,e=[];if(!r)return s.removeAssignmentsForEvent(t);r=_.asArray(r);for(let i=0;i<r.length;i++)s.isEventAssignedToResource(t,r[i])&&e.push(s.getAssignmentForEventAndResource(t,r[i]));return s.remove(e)}isEventAssignedToResource(t,r){return!!this.getAssignmentForEventAndResource(t,r)}getAssignmentForEventAndResource(t,r){let s;return!(t=this.eventStore.getById(t))||!(s=t.assignments)||!(r=this.resourceStore.$master.getById(r))?null:this.getOccurrence(s.find(e=>{var i;return((i=e.resource)===null||i===void 0?void 0:i.$original)===r.$original}),t)}};const Or=Z(ot.derive(de));class Ue extends Rn(Or){static get defaultConfig(){return{modelClass:Re}}}F(Ue,"$name","AssignmentStore"),Ue._$name="AssignmentStore";const Fr=["SS","SF","FS","FF"];class ne extends B{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(n){const t=n[this.fieldMap.from.dataSource],r=n[this.fieldMap.to.dataSource];t!=null&&(n.fromEvent=t),r!=null&&(n.toEvent=r),super.construct(...arguments)}get eventStore(){var n;return this.eventStore||((n=this.unjoinedStores[0])===null||n===void 0?void 0:n.eventStore)}set from(n){const{fromEvent:t}=this;t!=null&&t.isModel&&t.id===n?this.set("from",n):this.fromEvent=n}get from(){return this.get("from")}set to(n){const{toEvent:t}=this;t!=null&&t.isModel&&t.id===n?this.set("to",n):this.toEvent=n}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(n){this.setHardType(n)}getHardType(){return this.get("type")}setHardType(n){let t;return n!==this.hardType&&(t=this.set({type:n,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(n){this.setLag(n)}setLag(n,t=this.lagUnit){if(arguments.length===1){typeof n=="number"?this.lag=n:(n=I.parseDuration(n),this.set({lag:n.magnitude,lagUnit:n.unit}));return}n=parseFloat(n),this.set({lag:n,lagUnit:t})}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${I.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new ue({unit:this.lagUnit,magnitude:this.lag})}set fullLag(n){typeof n=="string"?this.setLag(n):this.setLag(n.magnitude,n.unit)}get isPersistable(){const n=this,{stores:t,unjoinedStores:r}=n,s=t[0];let e;if(s){const{fromEvent:i,toEvent:o}=n,l=s.crudManager;e=i&&(l||!i.hasGeneratedId)&&o&&(l||!o.hasGeneratedId)}else e=!!r[0];return e&&super.isPersistable}getDateRange(){const{fromEvent:n,toEvent:t}=this;if(n!=null&&n.isScheduled&&t!==null&&t!==void 0&&t.isScheduled){const r=ne.Type;let s,e;switch(this.type){case r.StartToStart:s=n.startDateMS,e=t.startDateMS;break;case r.StartToEnd:s=n.startDateMS,e=t.endDateMS;break;case r.EndToEnd:s=n.endDateMS,e=t.endDateMS;break;case r.EndToStart:s=n.endDateMS,e=t.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(s,e),end:Math.max(s,e)}}return null}highlight(n){var s;var t;const r=(s=(t=this.highlighted)===null||t===void 0?void 0:t.split(" "))!=null?s:[];r.includes(n)||(this.highlighted=r.concat(n).join(" "))}unhighlight(n){const{highlighted:t}=this;if(t){const r=t.split(" "),s=r.indexOf(n);s>=0&&(r.splice(s,1),this.highlighted=r.join(" "))}}isHighlightedWith(n){return this.highlighted&&this.highlighted.split(" ").includes(n)}getConnectorString(n){const t=Fr[this.type];return n?t:this.type===ne.Type.EndToStart?"":t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:n,toEvent:t,type:r}=this;return typeof r=="number"&&n&&t&&n!==t}get fromEventName(){var n;return((n=this.fromEvent)===null||n===void 0?void 0:n.name)||""}get toEventName(){var n;return((n=this.toEvent)===null||n===void 0?void 0:n.name)||""}shouldRecordFieldChange(n,t,r){if(!super.shouldRecordFieldChange(n,t,r))return!1;if(n==="from"||n==="to"||n==="fromEvent"||n==="toEvent"){var s;const e=(s=this.project)===null||s===void 0?void 0:s.eventStore;if(e&&e.oldIdMap[t]===e.getById(r))return!1}return!0}}ne.exposeProperties(),ne._$name="DependencyBaseModel";const kr=Oe;class Ee extends Z(kr.derive(ne)){static get $name(){return"DependencyModel"}getTypeFromSides(n,t,r){const s=ne.Type,e=r?"right":"left",i=r?"left":"right";return n===e?t===e?s.StartToStart:s.StartToEnd:t===i?s.EndToEnd:s.EndToStart}}Ee.exposeProperties(),Ee._$name="DependencyModel";var En=a=>class extends a{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(t,r,s,e=!0,i){return i=i||(o=>this.getEventDependencies(o)),t=_.asArray(t),t.reduce((o,l)=>{l.children&&!e?l.traverse(u=>{o=i(u).reduce(r,o)}):o=i(l).reduce(r,o)},s),s}mapEventDependencies(t,r,s,e,i){return this.reduceEventDependencies(t,(o,l)=>(s(l)&&o.push(l),o),[],e,i)}mapEventPredecessors(t,r,s,e){return this.reduceEventPredecessors(t,(i,o)=>(s(o)&&i.push(o),i),[],e)}mapEventSuccessors(t,r,s,e){return this.reduceEventSuccessors(t,(i,o)=>(s(o)&&i.push(o),i),[],e)}getEventDependencies(t){return[].concat(t.predecessors||[],t.successors||[])}removeEventDependencies(t){this.remove(this.getEventDependencies(t))}removeEventPredecessors(t){this.remove(t.predecessors)}removeEventSuccessors(t,r){this.remove(t.successors)}getBySourceTargetId(t){return this.records.find(r=>t==this.constructor.makeDependencySourceTargetCompositeKey(r.from,r.to))}getDependencyForSourceAndTargetEvents(t,r){return t=B.asId(t),r=B.asId(r),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(t,r))}getEventsLinkingDependency(t,r){return this.getDependencyForSourceAndTargetEvents(t,r)||this.getDependencyForSourceAndTargetEvents(r,t)}async isValidDependency(t,r,s){let e=t,i=r;return t==null?!1:(t.isDependencyModel&&({fromEvent:e,toEvent:i}=t),e=this.eventStore.getById(e),i=this.eventStore.getById(i),e&&i?!e.project||!i.project?!1:this.project.isValidDependency(e,i,s):t!==r)}isValidDependencyToCreate(t,r,s){return this.isValidDependency(t,r,s)}getHighlightedDependencies(t){return this.records.reduce((r,s)=>(s.isHighlightedWith(t)&&r.push(s),r),[])}static makeDependencySourceTargetCompositeKey(t,r){return`source(${t})-target(${r})`}getTimeSpanDependencies(t){return this.getEventDependencies(t)}};const $r=Z(ut.derive(de));class Ct extends En($r.derive(de)){static get defaultConfig(){return{modelClass:Ee}}}Ct._$name="DependencyStore";var In=a=>class extends a{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(t,r,s){const e=[],{storeId:i}=t,o=this.crudLoadValidationMandatoryStores,l={[i]:{}};return r?r.rows||(e.push(`- "${i}" store section should have a "rows" property with an array of the store records.`),l[i].rows=["..."]):o!=null&&o.includes(i)&&(e.push(`- No "${i}" store section found. It should contain the store data.`),l[i].rows=["..."]),e.length&&Object.assign(s,l),e}getLoadResponseWarnings(t){const r=[],s={};return this.skipSuccessProperty||(s.success=!0),this.forEachCrudStore((e,i,o)=>{r.push(...this.getStoreLoadResponseWarnings(o,t==null?void 0:t[i],s))}),r.length&&(r.push(`Please adjust your response to look like this:
`+JSON.stringify(s,null,4).replace(/"\.\.\."/g,"...")),r.push(this.disableValidationNote)),r}validateLoadResponse(t){const r=this.getLoadResponseWarnings(t);r.length&&console.warn(this.crudLoadValidationWarningPrefix+`
`+r.join(`
`))}getStoreSyncResponseWarnings(t,r,s,e){const i=[],o=[],l=[],{storeId:u}=t,c={[u]:{}},d=t.phantomIdField||this.phantomIdField,{modelClass:g}=t.store,{idField:p}=g,m=(s==null?void 0:s.rows)||[],D=(s==null?void 0:s.removed)||[];let C=!1;if(r!=null&&r.added&&(o.push(...r.added.filter(x=>!m.find(S=>S[d]==x[d])&&!D.find(S=>S[d]==x[d]||S[p]==x[d])).map(x=>({[d]:x[d],[p]:"..."}))),o.length)){const x=o.map(S=>"#"+S[d]).join(", ");i.push(`- "${u}" store "rows" section should mention added record(s) ${x} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!o.length&&s&&((typeof s!="object"||Array.isArray(s))&&(i.push(`- "${u}" store section should be an Object.`),c[u]["..."]="..."),s.rows&&!Array.isArray(s.rows)&&(i.push(`- "${u}" store "rows" section should be an array`),o.push("...")),s.removed&&!Array.isArray(s.removed)&&(i.push(`- "${u}" store "removed" section should be an array:`),l.push("...")));else{if(r!=null&&r.updated){const x=r.updated.filter(S=>!m.find(R=>R[p]==S[p])).map(S=>({[p]:S[p]}));if(o.push(...x),x.length){const S=x.map(R=>"#"+R[p]).join(", ");i.push(`- "${u}" store "rows" section should mention updated record(s) ${S} sent in the request. It should contain the updated record identifiers.`),C=!0}}if(o.length&&o.push("..."),r!=null&&r.removed&&(l.push(...r.removed.filter(x=>!m.find(S=>S[p]==x[p])).map(x=>({[p]:x[p]}))),l.length)){const x=l.map(S=>"#"+S[p]).join(", ");i.push(`- "${u}" store "removed" section should mention removed record(s) ${x} sent in the request. It should contain the removed record identifiers.`),c[u].removed=l,l.push("..."),C=!0}}return o.length&&(c[u].rows=o),i.length||delete c[u],Object.assign(e,c),{messages:i,showSupportShortSyncResponseNote:C}}getSyncResponseWarnings(t,r){const s=[],e={},i=r.pack;this.skipSuccessProperty||(e.success=!0);let o=!1;return this.forEachCrudStore((l,u,c)=>{const d=this.getStoreSyncResponseWarnings(c,i==null?void 0:i[u],t[u],e);o=o||d.showSupportShortSyncResponseNote,s.push(...d.messages)}),s.length&&(s.push(`Please adjust your response to look like this:
`+JSON.stringify(e,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),o&&s.push(this.supportShortSyncResponseNote),s.push(this.disableValidationNote)),s}validateSyncResponse(t,r){const s=this.getSyncResponseWarnings(t,r);s.length&&console.warn(this.crudSyncValidationWarningPrefix+`
`+s.join(`
`))}};class Lr extends Error{}class xn extends Lr{constructor(n={}){var t,r;super(n.message||n.request&&G.capitalize((t=n.request)===null||t===void 0?void 0:t.type)+" failed"||"Crud Manager request failed"),Object.assign(this,n),this.action=(r=this.request)===null||r===void 0?void 0:r.type}}const Mn=function(a,n,t){return a.store&&(a=a.store),n.store&&(n=n.store),a=a[t]||0,n=n[t]||0,a<n?-1:a>n?1:0},Nr=function(a,n){return Mn(a,n,"loadPriority")},Br=function(a,n){return Mn(a,n,"syncPriority")};var Tn=a=>{var t;a.$$meta=a.$meta;const n=[];return a.isEvents||n.push(Rt),a.isDelayable||n.push(Ze),n.push(In),t=class extends(a||V).mixin(...n){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(s={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(s)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var s,e;return(s=this.transport)===null||s===void 0||(e=s.load)===null||e===void 0?void 0:e.url}updateLoadUrl(s){$.setPath(this,"transport.load.url",s)}get syncUrl(){var s,e;return(s=this.transport)===null||s===void 0||(e=s.sync)===null||e===void 0?void 0:e.url}updateSyncUrl(s){$.setPath(this,"transport.sync.url",s)}getStoreDescriptor(s){return s?s instanceof N?this.crudStores.find(e=>e.store===s):typeof s=="object"?this.crudStoresIndex[s.storeId]:this.crudStoresIndex[s]||this.getStoreDescriptor(N.getStore(s)):null}fillStoreDescriptor(s){const{store:e}=s,{storeIdProperty:i=this.storeIdProperty,modelClass:o}=e;return s.storeId||(s.storeId=e[i]||e.id),s.idField||(s.idField=o.idField),s.phantomIdField||(s.phantomIdField=o.phantomIdField),s.phantomParentIdField||(s.phantomParentIdField=o.phantomParentIdField),"writeAllFields"in s||(s.writeAllFields=e.writeAllFields),s}updateCrudStoreIndex(){const s=this.crudStoresIndex={};this.crudStores.forEach(e=>e.storeId&&(s[e.storeId]=e))}getCrudStore(s){const e=this.getStoreDescriptor(s);return e==null?void 0:e.store}forEachCrudStore(s,e=this){if(!s)throw new Error("Iterator function must be provided");this.crudStores.every(i=>s.call(e,i.store,i.storeId,i)!==!1)}set crudStores(s){this._crudStores=[],this.addCrudStore(s);for(const e of this._crudStores)e.loadPriority=e.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(s){return this._orderedCrudStores=s}set syncApplySequence(s){this._syncApplySequence=[],this.addStoreToApplySequence(s)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(s){const e=this;let i;return s instanceof N?i={store:s}:typeof s=="object"?(s.store||(s={storeId:s.id,store:new N(s)}),i=s):i={store:N.getStore(s)},e.fillStoreDescriptor(i),s=i.store,s.setCrudManager?s.setCrudManager(e):s.crudManager=e,s.pageSize=null,(e.loadUrl||e.syncUrl)&&(s.autoCommit=!1,s.autoLoad=!1,(s.createUrl||s.updateUrl||s.deleteUrl||s.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),e.bindCrudStoreListeners(s),i}addCrudStore(s,e,i){var o;if(s=_.asArray(s),!((o=s)!==null&&o!==void 0&&o.length))return;const l=this,u=s.map(l.internalAddCrudStore,l);typeof e=="undefined"?l.crudStores.push(...u):(i&&((i instanceof N||typeof i!="object")&&(i=l.getStoreDescriptor(i)),e+=l.crudStores.indexOf(i)),l.crudStores.splice(e,0,...u)),l.orderedCrudStores.push(...u),l.updateCrudStoreIndex()}addPrioritizedStore(s){const e=this;e.hasCrudStore(s)||e.addCrudStore(s,_.findInsertionIndex(s,e.crudStores,Nr)),e.hasApplySequenceStore(s)||e.addStoreToApplySequence(s,_.findInsertionIndex(s,e.syncApplySequence,Br))}hasCrudStore(s){var e;return(e=this.crudStores)===null||e===void 0?void 0:e.some(i=>i===s||i.store===s||i.storeId===s)}removeCrudStore(s){const e=this,i=e.crudStores,o=i.find(l=>l===s||l.store===s||l.storeId===s);if(o)e.unbindCrudStoreListeners(o.store),delete e.crudStoresIndex[o.storeId],_.remove(i,o),e.syncApplySequence&&e.removeStoreFromApplySequence(s);else throw new Error("Store not found in stores collection")}bindCrudStoreListeners(s){s.ion({name:s.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(s){this.detachListeners(s.id)}addStoreToApplySequence(s,e,i){if(!s)return;s=_.asArray(s);const o=this,l=s.reduce((c,d)=>{const g=o.getStoreDescriptor(d);return g&&c.push(g),c},[]);if(typeof e=="undefined")o.syncApplySequence.push(...l);else{let c=e;i&&((i instanceof N||typeof i!="object")&&(i=o.getStoreDescriptor(i)),c+=o.syncApplySequence.indexOf(i)),o.syncApplySequence.splice(c,0,...l)}const u=o.syncApplySequence.map(({storeId:c})=>c);o.orderedCrudStores=[...o.syncApplySequence],o.crudStores.forEach(c=>{u.includes(c.storeId)||o.orderedCrudStores.push(c)})}removeStoreFromApplySequence(s){const e=this.syncApplySequence.findIndex(i=>i===s||i.store===s||i.storeId===s);e>-1&&(this.syncApplySequence.splice(e,1),this.orderedCrudStores.splice(e,1))}hasApplySequenceStore(s){return this.syncApplySequence.some(e=>e===s||e.store===s||e.storeId===s)}onCrudStoreDestroy({source:s}){this.removeCrudStore(s)}onCrudStoreChange(s){const e=this;e.crudIgnoreUpdates||(e.crudStoreHasChanges(s==null?void 0:s.source)?(e.trigger("hasChanges"),e.autoSync&&e.scheduleAutoSync()):e.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(s=!0){const e=this;e.autoSyncSuspendCounter--,e.autoSyncSuspendCounter<=0&&(e.autoSyncSuspendCounter=0,s&&e.autoSync&&e.crudStoreHasChanges()&&e.scheduleAutoSync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const s=this;!s.hasTimeout("autoSync")&&!s.isAutoSyncSuspended&&s.setTimeout({name:"autoSync",fn:()=>{s.sync().catch(e=>{})},delay:s.autoSyncTimeout})}async triggerFailedRequestEvents(s,e,i,o){const{options:l,type:u}=s;this.trigger("requestFail",{requestType:u,response:e,responseText:i,responseOptions:o}),this.trigger(u+"Fail",{response:e,responseOptions:o,responseText:i,options:l})}async internalOnResponse(s,e,i){const o=this,l=e?o.decode(e):null,{options:u,type:c}=s;if(e&&!l&&console.error("Failed to parse response: "+e),!l||(o.skipSuccessProperty?l.success===!1:!l.success))o.triggerFailedRequestEvents(s,l,e,i);else if(o.trigger("beforeResponseApply",{requestType:c,response:l})!==!1&&o.trigger(`before${G.capitalize(c)}Apply`,{response:l,options:u})!==!1){if(o.crudRevision=l.revision,await o.applyResponse(s,l,u),o.isDestroyed)return;o.trigger("requestDone",{requestType:c,response:l,responseOptions:i}),o.trigger(c,{response:l,responseOptions:i,options:u}),(c==="load"||!o.crudStoreHasChanges())&&(o.trigger("noChanges"),c==="load"&&o.emitCrudStoreEvents(s.pack.stores,"afterRequest"))}return l}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(s){this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&!s&&this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(s){return s?this.isCrudStoreDirty(this.getCrudStore(s)):this.crudStores.some(e=>this.isCrudStoreDirty(e.store))}isCrudStoreDirty(s){return!!s.changes}doAutoLoad(){return this.load().catch(s=>{})}emitCrudStoreEvents(s,e,i){const o={action:"read"+e,...i};for(const l of this.crudStores)s.includes(l.storeId)&&l.store.trigger(e,o)}getLoadPackage(s){const e={type:"load",requestId:this.requestId},i=this.crudStores,o=Object.assign({},s);return delete o.request,e.stores=i.map(l=>{var u;const c=o==null?void 0:o[l.storeId],d=l.pageSize||((u=l.store)===null||u===void 0?void 0:u.pageSize);if(c||d){const g=Object.assign({storeId:l.storeId,page:1},c);return d&&(g.pageSize=d),l.currentPage=g.page,c&&delete o[l.storeId],g}return l.storeId}),Object.assign(e,o),e}loadCrudStore(s,e,i){const o=e==null?void 0:e.rows;i!=null&&i.append||e!=null&&e.append?s.add(o):s.data=o,s.trigger("load",{data:o})}loadDataToCrudStore(s,e,i){const o=s.store,l=e==null?void 0:e.rows;o.__loading=!0,l&&this.loadCrudStore(o,e,i,s),o.__loading=!1}loadCrudManagerData(s,e={}){this.suspendChangesTracking(),this.crudStores.forEach(i=>{const o=i.storeId,l=s[o];l&&this.loadDataToCrudStore(i,l,e[o])}),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return!!(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return!!(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return!!(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(s){typeof s=="string"&&(s={request:{url:s}});const e=this,i=e.getLoadPackage(s);return e._autoLoadPromise=null,new Promise((o,l)=>{if(e.trigger("beforeLoad",{pack:i})!==!1){var u;const{load:c}=e.activeRequests;c&&(e.cancelRequest(c.desc,c.reject),e.trigger("loadCanceled",{pack:i}));const d=re.assign({id:i.requestId,data:e.encode(i),type:"load",success:e.onCrudRequestSuccess,failure:e.onCrudRequestFailure,thisObj:e},(u=s)===null||u===void 0?void 0:u.request);e.activeRequests.load={type:"load",options:s,pack:i,resolve:o,reject(...g){d.success=d.failure=null,l(...g)},id:i.requestId,desc:e.sendRequest(d)},e.emitCrudStoreEvents(i.stores,"loadStart"),e.trigger("loadStart",{pack:i})}else e.trigger("loadCanceled",{pack:i}),l({cancelled:!0})})}getActiveCrudManagerRequest(s){let e=this.activeRequests[s];return!e&&this.trackResponseType&&(e=Object.values(this.activeRequests)[0]),e}prepareAddedRecordData(s,e){const i=this,{store:o}=e,{isTree:l}=o,u=e.phantomIdField||i.phantomIdField,c=e.phantomParentIdField||i.phantomParentIdField,d=o.modelClass.allFields.filter(m=>m.subStore),g=s.constructor,p=Object.assign(s.persistableData,{[u]:s.id});if(l){const{parent:m}=s;m&&!m.isRoot&&m.isPhantom&&(p[c]=m.id)}return i.resetIdsBeforeSync&&$.deletePath(p,g.idField),d.forEach(m=>{const D=s.get(m.name);D.allCount&&(p[m.dataSource]={added:D.getRange().map(C=>i.prepareAddedRecordData(C,{store:D}))})}),p}prepareAdded(s,e){return s.filter(i=>i.isValid).map(i=>this.prepareAddedRecordData(i,e))}prepareUpdated(s,e){const{store:i}=e,{isTree:o}=i,l=e.writeAllFields||e.writeAllFields!==!1&&this.writeAllFields,u=e.phantomParentIdField||this.phantomParentIdField,c=i.modelClass.allFields.filter(d=>d.subStore);if(e.store.tree){const d=e.store.rootNode;s=s.filter(g=>g!==d)}return s.filter(d=>d.isValid).reduce((d,g)=>{let p;if(l?p=g.persistableData:p=g.modificationDataToWrite,o){const{parent:m}=g;m&&!m.isRoot&&m.isPhantom&&(p[u]=m.id)}return c.forEach(m=>{const D=g.get(m.name);p[m.dataSource]=this.getCrudStoreChanges({store:D})}),$.isEmpty(p)||d.push(p),d},[])}prepareRemoved(s){return s.map(e=>{const i=e.constructor;return $.setPath({},i.idField,e.id)})}getCrudStoreChanges(s){const{store:e}=s;let{added:i=[],modified:o=[],removed:l=[]}=e.changes||{},u;return i.length&&(i=this.prepareAdded(i,s)),o.length&&(o=this.prepareUpdated(o,s)),l.length&&(l=this.prepareRemoved(l)),(i.length||o.length||l.length)&&(u={},i.length&&(u.added=i),o.length&&(u.updated=o),l.length&&(u.removed=l)),u}getChangesetPackage(){const{changes:s}=this;return s||this.forceSync?{type:"sync",requestId:this.requestId,revision:this.crudRevision,...s}:null}get changes(){const s={};return this.crudStores.forEach(e=>{const i=this.getCrudStoreChanges(e);i&&(s[e.storeId]=i)}),Object.keys(s).length>0?s:null}getRowsToApplyChangesTo({store:s,storeId:e},i,o){var l,u;const c=this,{modelClass:d}=s,g=d.idField,{updated:p,removed:m}=o||{};let D,C,x;if(i){var S,R;x=!0;const M={};D=((S=i.rows)===null||S===void 0?void 0:S.slice())||[],C=((R=i.removed)===null||R===void 0?void 0:R.slice())||[],[...D,...C].forEach(h=>{const f=$.getPath(h,g);M[f]=!0}),c.supportShortSyncResponse&&(p==null||p.forEach(h=>{const f=$.getPath(h,g);M[f]||D.push({[g]:f})}),m==null||m.forEach(h=>{const f=$.getPath(h,g);M[f]||C.push({[g]:f})}))}else(p||m)&&(x=!1,D=p,C=m);return D=(l=D)!==null&&l!==void 0&&l.length?D:null,C=(u=C)!==null&&u!==void 0&&u.length?C:null,{rows:D,removed:C,remote:x}}applyChangesToStore(s,e,i){var R;const o=this,l=s.phantomIdField||o.phantomIdField,{store:u}=s,c=u.modelClass.getFieldDataSource("id"),d=u.modelClass.allFields.filter(M=>M.subStore),{rows:g,removed:p,remote:m}=o.getRowsToApplyChangesTo(s,e,i),D=[],C=[];if(g)for(const M of g)u.getById((R=M[l])!=null?R:M[c])?C.push(M):D.push(M);const x=[];C.length&&d.length&&C.forEach(M=>{var T;var h,f;const v=u.getById((T=M[l])!=null?T:M[c]),y=((h=i.added)===null||h===void 0?void 0:h.find(A=>A[l]==M[l]))||((f=i.updated)===null||f===void 0?void 0:f.find(A=>A[c]==M[c])),E={};d.forEach(A=>{const w=v.get(A.name);o.applyChangesToStore({store:w},M[A.dataSource],y==null?void 0:y[A.dataSource]),E[A.dataSource]="foo",delete M[A.dataSource]}),x.push([v,E])});const S=u.applyChangeset({removed:p,added:D,updated:C},null,l,m,!0);return x.forEach(([M,h])=>Object.assign(S.get(M.id),h)),S}applySyncResponse(s,e){const i=this,o=i.orderedCrudStores;i.applyingChangeset=i.applyingSyncResponse=!0,i.suspendChangesTracking();for(const u of o){var l;i.applyChangesToStore(u,s[u.storeId],e==null||(l=e.pack)===null||l===void 0?void 0:l[u.storeId])}i.resumeChangesTracking(!0),i.applyingChangeset=i.applyingSyncResponse=!1}applyLoadResponse(s,e){this.applyingLoadResponse=!0,this.loadCrudManagerData(s,e),this.applyingLoadResponse=!1}async applyResponse(s,e,i){const o=this;switch(o.trackResponseType&&e.type||s.type){case"load":o.validateResponse&&o.validateLoadResponse(e),o.applyLoadResponse(e,i);break;case"sync":o.validateResponse&&o.validateSyncResponse(e,s),o.applySyncResponse(e,s);break}}applyChangeset(s,e=null,i,o=!1){const l=this,u=o?new Map:void 0;l.suspendAutoSync(),l.suspendChangesTracking();for(const{store:c,phantomIdField:d}of l.orderedCrudStores)if(s[c.id]){const g=c.applyChangeset(s[c.id],e,d||l.phantomIdField,!0,o);g&&u.set(c.id,g)}return l.resumeChangesTracking(!0),l.resumeAutoSync(!1),u}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const s=this;return s.clearTimeout("autoSync"),s.activeRequests.sync?(s.trigger("syncDelayed"),s.activeSyncPromise=s.activeSyncPromise.finally(()=>s.sync())):s.activeSyncPromise=new Promise((e,i)=>{const o=s.getChangesetPackage();if(!o){e(null);return}s.trigger("beforeSync",{pack:o})!==!1?(s.trigger("syncStart",{pack:o}),s.activeRequests.sync={type:"sync",pack:o,resolve:e,reject:i,id:o.requestId,desc:s.sendRequest({id:o.requestId,data:s.encode(o),type:"sync",success:s.onCrudRequestSuccess,failure:s.onCrudRequestFailure,thisObj:s})}):(s.trigger("syncCanceled",{pack:o}),i({cancelled:!0}))}).catch(e=>{if(e&&!e.cancelled)throw e;return e})}async onCrudRequestSuccess(s,e,i){var o;const l=this,{type:u,id:c}=i;if(l.isDestroyed)return;let d="";i=l.activeRequests[u];try{d=await s.text()}catch(p){}if(l.isDestroyed)return;if(((o=i)===null||o===void 0?void 0:o.id)!==c)throw new Error(`Interleaved ${u} operation detected`);l.activeRequests[u]=null;const g=await l.internalOnResponse(i,d,e);if(!l.isDestroyed){if(!g||(l.skipSuccessProperty?(g==null?void 0:g.success)===!1:!(g!=null&&g.success))){const p={rawResponse:s,response:g,request:i};g!=null&&g.message&&(p.message=g.message),i.reject(new xn(p))}l["crud"+G.capitalize(i.type)+"ed"]=!0,i.resolve({response:g,rawResponse:s,responseText:d,request:i})}}async onCrudRequestFailure(s,e,i){var o;const l=this;if(l.isDestroyed)return;i=l.activeRequests[i.type];const u=e==null||(o=e.abortController)===null||o===void 0?void 0:o.signal;if(!!!(u!=null&&u.aborted)){let d,g="";try{g=await s.text(),d=l.decode(g)}catch(p){}if(l.isDestroyed||(l.triggerFailedRequestEvents(i,d,g,e),l.isDestroyed))return;i.reject(new xn({rawResponse:s,request:i}))}l.activeRequests[i.type]=null}acceptChanges(){this.crudStores.forEach(s=>s.store.acceptChanges())}revertChanges(){this.revertCrudStoreChanges()}revertCrudStoreChanges(){const{usesSingleAssignment:s}=this.eventStore;this.orderedCrudStores.forEach(({store:e})=>(!e.isAssignmentStore||!s)&&e.revertChanges())}doDestroy(){const s=this,{load:e,sync:i}=s.activeRequests;for(e&&s.cancelRequest(e.desc,e.reject),i&&s.cancelRequest(i.desc,i.reject);s.crudStores.length>0;)s.removeCrudStore(s.crudStores[0]);super.doDestroy&&super.doDestroy()}},F(t,"configurable",{loadUrl:null,syncUrl:null,forceSync:null}),F(t,"delayable",{doAutoLoad:"raf"}),t},An=a=>class kn extends(a||V){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(t,r){var s;(s=t.abort)===null||s===void 0||s.call(t),this.isDestroying||r({cancelled:!0})}shouldUseBodyForRequestData(t,r,s){return!(r==="HEAD"||r==="GET")&&!s}sendRequest(t){const r=this,{data:s}=t,e=r.transport[t.type]||{},i=re.assign({},e,e.requestConfig);t.url&&(i.url=t.url),i.method=i.method||kn.defaultMethod[t.type],i.params=re.assign(i.params||{},t.params);let{paramName:o}=i;if(r.shouldUseBodyForRequestData(e,i.method,o)?(i.body=s,i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json"):(o=o||"data",i.params[o]=s),!i.url)throw new Error("Trying to request without URL specified");delete i.requestConfig,delete i.paramName;let l,u;function c(){i.queryParams=i.params,delete i.params;let g=!1;const p=re.assign({},i,i.fetchOptions);return l=Yn.fetch(i.url,p),l.catch(m=>{var D,C;l.done=!0,(D=r.trigger)===null||D===void 0||D.call(r,"responseReceived",{success:!1});const x=(C=p.abortController)===null||C===void 0?void 0:C.signal;return x&&(g=x.aborted,g||console.warn(m)),{error:m,cancelled:g}}).then(m=>{var D;l.done=!0,(D=r.trigger)===null||D===void 0||D.call(r,"responseReceived",{success:!!(m!=null&&m.ok)});const C=m!=null&&m.ok?t.success:t.failure;return C==null?void 0:C.call(t.thisObj||r,m,p,t)})}const d=r.trigger("beforeSend",{params:i.params,requestType:t.type,requestConfig:i,config:t});return re.isPromise(d)?u=d.then(c):u=c(),u.abort=()=>{if(!l.done){var g,p;(g=(p=l).abort)===null||g===void 0||g.call(p)}},u}},bn=a=>class extends(a||V){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(t){var r;return t=Object.assign({},(r=this.encoder)===null||r===void 0?void 0:r.requestData,t),G.safeJsonStringify(t)}decode(t){return G.safeJsonParse(t)}},_r=a=>class extends(a||V).mixin(Tn,An,bn){static get defaultConfig(){return{project:null}}startConfigure(t){this.getConfig("project"),super.startConfigure(t),this._changesToClear=new Map}async doAutoLoad(){const{project:t}=this;return t&&await t.commitAsync(),super.doAutoLoad()}applyProjectResponse(t){const r=this,{project:s}=r;r.applyingProjectResponse=!0;const e=s.fieldMap.startDate,i=s.fieldMap.endDate,o=$.getPath(t,e.dataSource),l=$.getPath(t,i.dataSource);typeof o=="string"&&$.setPath(t,e.dataSource,e.convert(o)),typeof l=="string"&&$.setPath(t,i.dataSource,i.convert(l)),Object.assign(s,t),r._changesToClear.set(r,t),r.applyingProjectResponse=!1}loadCrudManagerData(t,r={}){const s=this,{project:e}=s;s.suspendChangesTracking(),super.loadCrudManagerData(...arguments),t!=null&&t.project&&(e.delayEnteringReplica?e.ion({recordsUnlinked:()=>{s.suspendChangesTracking(),s.applyProjectResponse(t.project),s.resumeChangesTracking()},once:!0}):s.applyProjectResponse(t.project)),s.resumeChangesTracking()}async sync(){const{project:t}=this;if(this.suspendAutoSync(),t&&await t.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(t,r,s){var e,i,o;const l=this;if(!(l.isDestroyed||(e=l.project)!==null&&e!==void 0&&e.isDestroyed)){if(l.trigger("beforeApplyResponse"),await super.applyResponse(t,r,s),r!=null&&r.project||l.supportShortSyncResponse&&t!==null&&t!==void 0&&(i=t.pack)!==null&&i!==void 0&&i.project){var u;l.applyProjectResponse(r.project||(t==null||(u=t.pack)===null||u===void 0?void 0:u.project))}if(l.project){var c,d;let g=t.type;l.trackResponseType&&(g=r.type||g);const p=`propagating${G.capitalize(g)}Changes`;l.suspendAutoSync(),l[p]=!0;const m=l.project.isInitialCommit&&!l.project.silenceInitialCommit;await l.project.commitAsync(),l[p]=!1,(c=l.resumeAutoSync)===null||c===void 0||c.call(l,m),(d=l.commitRespondedChanges)===null||d===void 0||d.call(l)}(o=l.trigger)===null||o===void 0||o.call(l,"applyResponse")}}applySyncResponse(...t){var r;const s=this,e=(r=s.project)===null||r===void 0?void 0:r.stm.disabled;e===!1&&s.ignoreRemoteChangesInSTM&&s.project.stm.disable(),super.applySyncResponse(...t),e===!1&&s.project.stm.enable()}shouldClearRecordFieldChange(t,r,s){var e;const i=t.getValue(r);return r=t.getFieldDefinition(r),(e=r)!==null&&e!==void 0&&e.isEqual?r.isEqual(i,s):$.isEqual(i,s)}commitRespondedChanges(){this._changesToClear.forEach((t,r)=>{Object.entries(t).forEach(([s,e])=>{this.shouldClearRecordFieldChange(r,s,e)&&delete r.meta.modified[s]})}),this._changesToClear.clear()}applyChangesToStore(t,r,s,...e){const i=super.applyChangesToStore(t,r,s,...e);if(i.size&&this.project)for(const[o,l]of i){const u=t.store.getById(o);u&&this._changesToClear.set(u,l)}return i}},wn=a=>{var n;return n=class extends(a||B){static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null}}get assignments(){return this.assignmentStore.allRecords}updateAssignments(r){this.assignmentStore.data=r}get dependencies(){return this.dependencyStore.allRecords}updateDependencies(r){this.dependencyStore.data=r}get resources(){return this.resourceStore.allRecords}updateResources(r){this.resourceStore.data=r}get timeRanges(){return this.timeRangeStore.allRecords}getTimeRanges(r,s){const e=this.timeRangeStore,i=[];for(const o of e)o.isRecurring?i.push(...o.getOccurrencesForDateRange(r,s)):o.startDate<s&&r<o.endDate&&i.push(o);return i}updateTimeRanges(r){this.timeRangeStore.data=r}getResourceTimeRanges(r,s){const e=this.resourceTimeRangeStore,i=[];for(const o of e)o.isRecurring?i.push(...o.getOccurrencesForDateRange(r,s)):o.startDate<s&&r<o.endDate&&i.push(o);return i}},F(n,"$name","ProjectModelCommon"),n};class te extends ee.mixin(Dt){get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}}F(te,"$name","ResourceTimeRangeModel"),F(te,"fields",["resourceId","timeRangeColor"]),F(te,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}}),F(te,"domIdPrefix","resourcetimerange"),te._$name="ResourceTimeRangeModel";class qe extends de.mixin(mt){static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:te,storeId:"resourceTimeRanges"}}set resourceStore(n){this._resourceStore=n,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(n){return[n.resource]}getRanges({resourceRecord:n,startDate:t,endDate:r}){return n.timeRanges.flatMap(e=>e.supportsRecurring?e.getOccurrencesForDateRange(t,r):e.intersectsRange(t,r)?e:[]).sort((e,i)=>e.startDate-i.startDate)}}F(qe,"$name","ResourceTimeRangeStore"),qe._$name="ResourceTimeRangeStore";var Pn=a=>{var n;return n=class extends(a||B){get _storesWithDates(){return[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore].filter(r=>r)}overrideStoreProcessRecord(r){this._storesWithDates.includes(r)&&!r.$originalProcessRecord&&(r.$originalProcessRecord=It.before(r,"processRecord",(s,e)=>{(e||r.isLoadingData)&&this.convertRecordToTimeZone(s)}))}attachStore(r){super.attachStore(r),r&&this.timeZone!=null&&this._storesWithDates.includes(r)&&(this.convertStoresToTimeZone([r]),this.overrideStoreProcessRecord())}detachStore(r){if(super.detachStore(r),r&&!r.isDestroyed){const{$originalProcessRecord:s}=r;s&&(s(),r.$originalProcessRecord=null,this.convertStoresToTimeZone([r],null))}}relayStoreChange({source:r,action:s,records:e,replaced:i}){const o=this;if(o.timeZone!=null&&o._storesWithDates.includes(r)&&["add","replace"].includes(s)){var l;!((l=e)!==null&&l!==void 0&&l.length)&&i!==null&&i!==void 0&&i.length&&(e=i),e.length&&e.forEach(u=>u.timeZone=o.timeZone)}}convertStoresToTimeZone(r,s=this.timeZone){var e;const i=this,o=(e=i.stm)===null||e===void 0?void 0:e.autoRecord;o&&(i.stm.autoRecord=!1);for(const l of r)l==null||l.forEach(u=>i.convertRecordToTimeZone(u,s));o&&(i.stmAutoRecord=o)}convertRecordToTimeZone(r,s=this.timeZone){if(r.timeZone!==s){var e;if(r.$ignoreChange=!0,(e=r.baselines)!==null&&e!==void 0&&e.count)for(const i of r.baselines)r.timeZone!==i.timeZone&&(i.timeZone=r.timeZone),i.convertToTimeZone(s);r.convertToTimeZone(s),r.$ignoreChange=!1}}updateTimeZone(r,s){const e=this,i=e._isConfiguringTimeZone||e.isConfiguring;if(e.trigger("beforeTimeZoneChange",{timeZone:r,oldTimeZone:s,isConfiguring:i}),e.calendarManagerStore.forEach(o=>o.bumpVersion()),e.convertStoresToTimeZone(e._storesWithDates),e._storesWithDates.forEach(o=>e.overrideStoreProcessRecord(o)),e.startDate){const o=s!=null?z.fromTimeZone(e.startDate,s):e.startDate;e.startDate=r!=null?z.toTimeZone(o,r):o}e.ignoreRecordChanges=!0,e.commitAsync().then(()=>{e.isDestroyed||e.trigger("timeZoneChange",{timeZone:r,oldTimeZone:s,isConfiguring:i}),delete e._isConfiguringTimeZone})}},F(n,"$name","ProjectModelTimeZoneMixin"),F(n,"configurable",{timeZone:{$config:"lazy",value:null}}),n},jn=a=>{var n;return n=class extends(a||B).mixin(wn,Pn){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:ee,resourceTimeRangeModelClass:te,timeRangeStoreClass:N,resourceTimeRangeStoreClass:qe,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null}}get inlineData(){return G.safeJsonParse(super.json)}set inlineData(r){this.json=r}construct(r={}){super.construct(...arguments),r.timeRangesData&&(this.timeRangeStore.data=r.timeRangesData),r.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=r.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const r=this;!r.timeRangeStore.stm&&r.stm.addStore(r.timeRangeStore),!r.resourceTimeRangeStore.stm&&r.stm.addStore(r.resourceTimeRangeStore)}attachStore(r){r&&r.ion({name:r.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(r)}detachStore(r){r&&(this.detachListeners(r.$$name),super.detachStore(r))}relayStoreChange(r){return super.relayStoreChange(r),this.trigger("change",{store:r.source,...r,source:this})}updateTimeRangeStore(r,s){this.detachStore(s),this.attachStore(r)}setTimeRangeStore(r){this.timeRangeStore=r}changeTimeRangeStore(r){return r&&!r.isStore&&(r=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},r)),r}updateResourceTimeRangeStore(r,s){this.detachStore(s),this.attachStore(r)}changeResourceTimeRangeStore(r){return r&&!r.isStore&&(r=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},r)),r}setResourceTimeRangeStore(r){this.resourceTimeRangeStore=r}get events(){return this.eventStore.allRecords}updateEvents(r){this.eventStore.data=r}get resourceTimeRanges(){return this.resourceTimeRangeStore.allRecords}updateResourceTimeRanges(r){this.resourceTimeRangeStore.data=r}async loadInlineData(r){return this.isLoadingInlineData=!0,r.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=r.resourceTimeRangesData),r.timeRangesData&&(this.timeRangeStore.data=r.timeRangesData),super.loadInlineData(r)}toJSON(){const r=this,s={eventsData:r.eventStore.toJSON(),resourcesData:r.resourceStore.toJSON(),dependenciesData:r.dependencyStore.toJSON(),timeRangesData:r.timeRangeStore.toJSON(),resourceTimeRangesData:r.resourceTimeRangeStore.toJSON()};return r.eventStore.usesSingleAssignment||(s.assignmentsData=r.assignmentStore.toJSON()),s}get json(){return super.json}changeJson(r){return typeof r=="string"&&(r=G.safeJsonParse(r)),r}updateJson(r){r&&this.loadInlineData(r)}afterChange(r,s){super.afterChange(...arguments),s.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},F(n,"configurable",{json:null,timeRangeStore:{value:{id:"timeRanges",modelClass:ee},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),n},On=a=>class extends a{getCurrentConfig(t){const r=this,s=super.getCurrentConfig(t);if(s){for(const e of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const i=r[e];if(i){i.count&&(s[i.id+"Data"]=i.getInlineData(t));const o=i.getCurrentConfig(t);o&&Object.keys(o).length>0?s[e]=Object.assign(s[e]||{},o):s[e]&&Object.keys(s[e]).length===0&&delete s[e]}}return s.timeRangeStore&&((r.timeRangeStore.originalModelClass===r.timeRangeModelClass||r.timeRangeStore.originalModelClass.$name==="TimeSpan")&&delete s.timeRangeStore.modelClass,s.timeRangeStore.storeId==="timeRanges"&&delete s.timeRangeStore.storeId,Object.keys(s.timeRangeStore).length===1&&delete s.timeRangeStore),r.taskStore.isTaskStore&&(delete s.eventModelClass,delete s.eventStoreClass,delete s.children),s}}};class Fn extends V{set eventStore(n){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=n,n&&n.autoCommit&&(t.eventStoreDetacher=n.ion({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(n){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=n,n&&n.autoCommit&&(t.resourceStoreDetacher=n.ion({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(n){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=n,n&&n.autoSync&&(t.assignmentStoreDetacher=n.ion({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(n){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=n,n&&n.autoSync&&(t.dependencyStoreDetacher=n.ion({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:n}){const t=this;return t.removeNonPersistableRecordsToCreate(n),t.shallContinueSync(n)}onResourceStoreBeforeSync({changes:n}){const t=this;return t.removeNonPersistableRecordsToCreate(n),t.shallContinueSync(n)}onAssignmentStoreBeforeSync({changes:n}){const t=this;return t.removeNonPersistableRecordsToCreate(n),t.shallContinueSync(n)}onDependencyStoreBeforeSync({changes:n}){const t=this;return t.removeNonPersistableRecordsToCreate(n),t.shallContinueSync(n)}removeNonPersistableRecordsToCreate(n){const t=n.added||[];let r,s;for(s=t.length-1;s>=0;--s)r=t[s],r.isPersistable||t.splice(t.indexOf(r),1);t.length===0&&(n.added.length=0)}shallContinueSync(n){return!!(n.added&&n.added.length>0||n.modified&&n.modified.length>0||n.removed&&n.removed.length>0)}}Fn._$name="ModelPersistencyManager";const Vr=rn;class We extends On(jn(Vr)){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:Ce,dependencyModelClass:Ee,resourceModelClass:pe,assignmentModelClass:Re,eventStoreClass:Ye,dependencyStoreClass:Ct,resourceStoreClass:gt,assignmentStoreClass:Ue}}construct(...n){super.construct(...n),ce.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new Fn({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}}We.applyConfigs=!0,We.initClass(),We._$name="ProjectModel";var Yr=a=>{var n;return n=class extends a.mixin(Un){static get $name(){return"CrudManagerView"}afterConstruct(){super.afterConstruct();const{crudManager:r,project:s}=this;this.loadMask&&(r||s).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:r}=this;r&&(this.masked=qn.mergeConfigs(this.loadMaskDefaults,r))}bindCrudManager(r){this.detachListeners("crudManager"),r==null||r.ion({name:"crudManager",loadStart:"onCrudManagerLoadStart",beforeSend:"onCrudManagerBeforeSend",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",beforeApplyResponse:"onCrudManagerBeforeApplyResponse",applyResponse:"onCrudManagerApplyResponse",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",responseReceived:"onAjaxTransportResponseReceived",thisObj:this})}onCrudManagerBeforeSend({params:r}){var s;(s=this.applyStartEndParameters)===null||s===void 0||s.call(this,r)}onCrudManagerLoadStart(){var r;this.applyLoadMask(),(r=this.toggleEmptyText)===null||r===void 0||r.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerBeforeApplyResponse(){var r;(r=this.suspendRefresh)===null||r===void 0||r.call(this)}onCrudManagerApplyResponse(){var r;(r=this.resumeRefresh)===null||r===void 0||r.call(this,!0)}onCrudManagerRequestFinalize(r=!0,s,e){const i=this;if(r){var o;(o=i.toggleEmptyText)===null||o===void 0||o.call(i)}else i.masked||i.applyLoadMask(),i.applyMaskError(`<div class="b-grid-load-failure">
                    <div class="b-grid-load-fail">${i.L(`L{GridBase.${s}FailedMessage}`)}</div>
                    ${e&&e.message?`<div class="b-grid-load-fail">${i.L("L{CrudManagerView.serverResponseLabel}")} ${e.message}</div>`:""}
                </div>`)}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerRequestFail({requestType:r,response:s}){this.onCrudManagerRequestFinalize(!1,r,s)}onAjaxTransportResponseReceived(){const r=this;r.clearMaskDelay!=null?r.setTimeout(()=>r.masked=null,r.clearMaskDelay):r.masked=null}get widgetClass(){}},F(n,"config",{clearMaskDelay:null,testConfig:{clearMaskDelay:0}}),n};export{Wt as AbstractAssignmentStoreMixin,zt as AbstractCalendarManagerStoreMixin,Yt as AbstractCalendarMixin,Tn as AbstractCrudManagerMixin,In as AbstractCrudManagerValidation,Ht as AbstractDependencyStoreMixin,Zt as AbstractEventStoreMixin,Ut as AbstractHasAssignmentsMixin,be as AbstractPartOfProjectGenericMixin,De as AbstractPartOfProjectModelMixin,q as AbstractPartOfProjectStoreMixin,tn as AbstractProjectMixin,K as AbstractRecurrenceIterator,Kt as AbstractResourceStoreMixin,An as AjaxTransport,Re as AssignmentModel,Cn as AssignmentModelMixin,Ue as AssignmentStore,Rn as AssignmentStoreMixin,X as CI,at as CIFromSetOrArrayOrValue,kt as CalendarCache,Ie as CalendarCacheInterval,Bt as CalendarCacheSingle,it as CalendarIntervalMixin,_t as CalendarIntervalStore,Y as CalendarIteratorResult,st as ConstraintIntervalSide,Ge as ConstraintType,je as CoreAssignmentMixin,ot as CoreAssignmentStoreMixin,Gt as CoreCalendarManagerStoreMixin,lt as CoreCalendarMixin,Oe as CoreDependencyMixin,ut as CoreDependencyStoreMixin,H as CoreEventMixin,ct as CoreEventStoreMixin,Qt as CoreHasAssignmentsMixin,en as CoreHasDependenciesMixin,we as CorePartOfProjectGenericMixin,ge as CorePartOfProjectModelMixin,me as CorePartOfProjectStoreMixin,fe as CoreResourceMixin,dt as CoreResourceStoreMixin,Yr as CrudManagerView,Le as DailyRecurrenceIterator,fn as DayIndexMixin,nn as DelayableWrapper,tt as DependenciesCalendar,ne as DependencyBaseModel,Ee as DependencyModel,Ct as DependencyStore,En as DependencyStoreMixin,et as DependencyType,Qe as DependencyValidationResult,rt as Direction,ie as EdgeInclusion,$e as EventDayIndex,Ce as EventModel,Dn as EventModelMixin,Ye as EventStore,ln as EventStoreMixin,un as GetEventsMixin,ae as IndexPosition,Nt as IntervalCache,bn as JsonEncoder,Q as MAX_DATE,Pt as MI,se as MIN_DATE,P as Mixin,lr as MixinAny,Be as MonthlyRecurrenceIterator,Z as PartOfProject,_r as ProjectCrudManager,On as ProjectCurrentConfig,We as ProjectModel,wn as ProjectModelCommon,jn as ProjectModelMixin,Pn as ProjectModelTimeZoneMixin,nt as ProjectType,ve as RecurrenceDayRuleEncoder,St as RecurrenceModel,pn as RecurringEventsMixin,Dt as RecurringTimeSpan,mt as RecurringTimeSpansMixin,pe as ResourceModel,on as ResourceModelMixin,gt as ResourceStore,an as ResourceStoreMixin,te as ResourceTimeRangeModel,qe as ResourceTimeRangeStore,Fe as SchedulerCoreEvent,rn as SchedulerCoreProjectMixin,Xe as SchedulingMode,Lt as SortedMap,ee as TimeSpan,he as TimeUnit,sn as TimeZonedDatesMixin,Vt as UnspecifiedTimeIntervalModel,Ne as WeeklyRecurrenceIterator,_e as YearlyRecurrenceIterator,Se as binarySearch,tr as concat,bt as concatIterable,qt as delay,hr as format,cr as isDateFinite,ur as isEqualEffectiveDirection,U as isInstanceOf,dr as isNotNumber,L as later,Tt as map,$t as stripDuplicates,At as uniqueOnly};
//# sourceMappingURL=CrudManagerView.js.map
