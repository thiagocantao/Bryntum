/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var Y=Object.defineProperty;var q=(m,i,t)=>i in m?Y(m,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[i]=t;var w=(m,i,t)=>(q(m,typeof i!="symbol"?i+"":i,t),t),j=(m,i,t)=>{if(!i.has(m))throw TypeError("Cannot "+t)};var N=(m,i,t)=>(j(m,i,"read from private field"),t?t.call(m):i.get(m)),W=(m,i,t)=>{if(i.has(m))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(m):i.set(m,t)},D=(m,i,t,e)=>(j(m,i,"write to private field"),e?e.call(m,t):i.set(m,t),t);var x;import{Menu as X,InstancePlugin as $,ObjectHelper as O,DomHelper as F,ArrayHelper as J,Rectangle as S,AsyncHelper as k,Base as K,DateHelper as Q}from"./Editor.js";import{ColumnStore as Z,Column as ee,GridFeatureManager as v}from"./GridBase.js";import{SummaryFormatter as te}from"./PdfExport.js";import{Splitter as V}from"./Splitter.js";class E extends ee{construct(){var i;super.construct(...arguments);const t=this,{grid:e}=t;t.menu=new X({owner:e,rootElement:e.rootElement,autoShow:!1,align:"t50-b50",anchor:!0,internalListeners:{hide(){t.picker.navigator.activeItem=null,delete t._editingRecord}},items:[Object.assign({type:t.colorEditorType,ref:"list",addNoColorItem:t.addNoColorItem,colorSelected({color:r}){var s;(s=t._editingRecord)===null||s===void 0||s.set(t.field,r),t.menu.hide()}},(i=t.colors)!==null&&i!==void 0&&i.length?{colors:t.colors}:{})]})}applyValue(i,t,e){if(!this.isConstructing){const{picker:r}=this;t==="colors"?r.colors=e:t==="addNoColorItem"&&(r.addNoColorItem=e)}super.applyValue(...arguments)}get picker(){return this.menu.widgetMap.list}renderer({value:i}){let t="b-empty",e=i;if(i){const r=this.picker.getColorClassName(i);r?(t=r,e=null):t=""}return{className:"b-color-cell-inner "+t,style:{backgroundColor:e},"data-btip":i}}onCellClick({grid:i,record:t,target:e}){if(e.classList.contains("b-color-cell-inner")&&!this.readOnly&&!i.readOnly&&!t.isSpecialRow&&!t.readOnly){const{picker:r,menu:s}=this,l=t.get(this.field);this._editingRecord=t,r.deselectAll(),r.select(l),r.refresh(),s.showBy(e)}}}w(E,"$name","ColorColumn"),w(E,"type","color"),w(E,"fields",[{name:"colorEditorType",defaultValue:"colorpicker"},"colors",{name:"addNoColorItem",defaultValue:!0}]),w(E,"defaults",{align:"center",editor:null}),Z.registerColumnType(E),E._$name="ColorColumn";class B extends te($){static get $name(){return"GroupSummary"}static get configurable(){return{collapseToHeader:null,target:"footer"}}construct(i,t){if(this.grid=i,super.construct(i,t),!i.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(i.store),i.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}bindStore(i){this.detachListeners("store"),i.ion({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}get store(){return this.grid.store}doDisable(i){this.updateTarget(this.target),super.doDisable(i)}changeTarget(i){return O.assertString(i,"target"),i}updateTarget(i){this.store.useGroupFooters=!this.disabled&&i==="footer",this.isConfiguring||this.store.group()}changeCollapseToHeader(i){return O.assertBoolean(i,"collapseToHeader"),i}updateCollapseToHeader(){this.isConfiguring||this.store.group()}static get pluginConfig(){return{chain:["bindStore"]}}onBeforeRenderRow({row:i,record:t}){i.isGroupFooter&&!("groupFooterFor"in t.meta)?(i.isGroupFooter=!1,i.forceInnerHTML=!0):i.isGroupHeader&&!t.meta.collapsed&&i.eachElement(this.removeSummaryElements)}removeSummaryElements(i){}renderCell({column:i,cellElement:t,row:e,record:r,size:s,isFirstColumn:l}){const o=this,{meta:n}=r,{rowHeight:a}=o.grid,d="groupRowFor"in n,p="groupFooterFor"in n,h=o.target==="header",c={"b-group-footer":0,"b-header-summary":0},u=d&&(h||o.collapseToHeader&&n.collapsed)&&!l||p&&!h;if((d||p)&&(s.height=d&&s.height||a),o.store.isGrouped&&u&&!o.disabled){i.clearCell(t);const g=d?r:n.groupRecord;e.isGroupFooter=p,e.isGroupHeader=d,p?c["b-group-footer"]=1:c["b-header-summary"]=1;const b=o.updateSummaryHtml(t,i,g),y=typeof b=="number"?b:b.count;y>1&&(s.height+=n.collapsed&&!h?0:y*a*.1),b.height&&(s.height+=b.height)}e.assignCls(c)}updateSummaryHtml(i,t,e){const r=e.groupChildren.slice();r[r.length-1].isGroupFooter&&r.pop();const s=this.generateHtml(t,r,"b-grid-group-summary",e,e.meta.groupField,e.meta.groupRowFor);return i.children.length?F.sync(s,i.firstElementChild):i.innerHTML=s,t.summaries?t.summaries.length:t.sum?1:0}onStoreUpdate({source:i,changes:t}){if(!this.disabled&&i.isGrouped){if(t&&i.groupers.find(r=>r.field in t))return;Object.keys(t).some(r=>{const s=this.grid.columns.get(r);return!!s&&(!!s.sum||!!s.summaries)})&&(this.grid.forceFullRefresh=!0)}}refresh(){this.grid.columns.visibleColumns.forEach(i=>{this.hasSummary(i)&&this.grid.refreshColumn(i)})}hasSummary(i){return i.sum||i.summaries}}B.featureClass="b-group-summary",B._$name="GroupSummary",v.registerFeature(B);const H=Object.freeze({animate:!1,block:"start"}),A=Object.freeze({animate:!1,block:"end"}),L=7,P={split:1,unsplit:1};class R extends ${constructor(){super(...arguments);W(this,x,!1);w(this,"restorers",[])}doDestroy(){this.unsplit(!0),super.doDestroy()}doDisable(t){const e=this;e.isConfiguring||(t?(e._disabledSplitOptions=e._splitOptions,e.unsplit()):e._disabledSplitOptions&&(e.split(e._disabledSplitOptions),e._disabledSplitOptions=null))}get isSplit(){var t;return!!(!((t=this.widgets)===null||t===void 0)&&t.length)}getClientConfig(t,e,r,s={}){const{client:l}=this,{subGrids:o,regions:n}=l,a=l.columns.records.slice(),d=O.assign({},l.subGridConfigs);if(l.eachSubGrid(c=>{const u=d[c.region];c.flex?u.flex=c.flex:u.width=c.element.style.width}),r.atColumn&&n.length>1&&e>0){const c=n.indexOf(r.atColumn.region);for(let u=0;u<c;u++){const g=o[n[u]];J.remove(a,...g.columns.records),delete d[n[u]]}}const p=O.assign({},l.initialConfig,{appendTo:t,insertFirst:null,insertBefore:null,splitFrom:l,owner:l.owner,tbar:l.initialConfig.tbar&&e===1?{height:l.tbar.height,items:[" "]}:null,store:l.store,selectedRecordCollection:l.selectedRecordCollection,subGridConfigs:d,columns:this.cloneColumns(a),minHeight:0,minWidth:0},s),h={};for(const c in l.listeners)if(!P[c]){const[u]=l.listeners[c];u.$internal||(h[c]=u)}return p.listeners=h,(r.direction==="horizontal"||r.direction==="both"&&e!==1)&&(p.hideHeaders=!0),delete p.data,p}cloneColumns(t){return t.flatMap(e=>{if(e.meta.isSelectionColumn||e.field==="expanderActionColumn")return[];const r={...e.data};return e.children&&(r.children=e.children.map(s=>({...s.data}))),delete r.headerRenderer,delete r.parentId,r})}cloneClient(t,e,r,s){const l=this.getClientConfig(t,e,r,s),o=new this.client.constructor(l);return o.element.classList.add("b-split-clone"),o}processOptions(t){var o;const{client:e}=this,{atRecord:r,atColumn:s,direction:l}=t;if(!l)r&&s?t.direction="both":s?t.direction="vertical":t.direction="horizontal";else{if(l!=="vertical"&&!r&&e.store.count){const n=e._bodyRectangle.height/2+e.scrollable.y,a=(o=e.rowManager.getRowAt(n,!0))!=null?o:e.rowManager.rows[Math.ceil(e.rowManager.rows.length/2)];t.atRecord=e.store.getById(a.id)}if(l!=="horizontal"&&!s){const n=S.from(e.element);let a=n.center.x-n.x,d=e.subGrids[e.regions[0]],p=0,h=null;for(;a>d.width;)a-=d.width,d=e.subGrids[e.regions[++p]];a+=d.scrollable.x;const{visibleColumns:c}=d.columns;let u=0,g=0;for(;u<a&&g<c.length;)h=c[g++],u+=h.element.offsetWidth;t.atColumn=h}}return t}createSplitContainer({direction:t}){const{client:e}=this,{element:r}=e;return this.splitContainer=F.createElement({parent:r.parentElement,className:{"b-split-container":1,[`b-split-${t}`]:1,"b-rtl":e.rtl},style:{width:r.style.width,height:r.style.height},children:[t!=="both"&&r,t==="both"&&{className:"b-split-top",children:[r]},t==="both"&&{className:"b-split-bottom"}]})}syncHeaderHeights(){let t=0;for(const e of this.subViews)e.eachSubGrid(r=>{r.header.height>t&&(t=r.header.height)});for(const e of this.subViews)e.eachSubGrid(r=>{r.header.height=t})}toggleOriginalSubGrids(t){const e=this,{client:r}=e,{regions:s}=r;if(t.atColumn&&s.length>1){const l=s.indexOf(t.atColumn.region),o=[r];t.direction==="both"&&o.push(e.subViews[2]);for(const n of o)if(l+1<s.length){const a=n===r,d=n.subGrids[s[l]];d.hideSplitter(),a&&e.restorers.push(()=>d.showSplitter()),d.flex||(r.inForEachOther=!0,d.flex=1,r.inForEachOther=!1,a&&e.restorers.push(()=>{d.flex=null,d.width=d._initialWidth}));for(let p=l+1;p<s.length;p++){const h=n.subGrids[s[p]];h.hide(),a&&e.restorers.push(()=>{h.show()})}s.length===2&&(n._initialWidth=n.element.style.width,n._initialFlex=n.flex,n.width=d._initialWidth,a&&e.restorers.push(()=>{n._initialFlex!==null?n.flex=n._initialFlex:n._initialWidth!==null&&(n.width=n._initialWidth)}))}}}async split(t={}){const e=this,{client:r}=e;if(r.splitFrom)return;e.isSplit&&await e.unsplit(!0);const{rtl:s}=r,{atRecord:l,atColumn:o,direction:n}=e.processOptions(t);let{splitX:a,remainingWidth:d}=t,p=null,h=null;if(l){await r.scrollRowIntoView(l);const f=r.getRowFor(l);if(!f)throw new Error(`Could not find row for record ${l.id}`);p=S.from(f.cells[0],r.element).bottom,h=S.from(r.element).height-p}if(o&&!a&&(a=S.from(o.element,r.element).getEnd(s),d=S.from(r.element).width-a-F.scrollBarWidth,s)){const f=a;a=d+F.scrollBarWidth,d=f-F.scrollBarWidth}const c=[],u=e.createSplitContainer(t),{visibleColumns:g}=r.columns,b=o?g[g.indexOf(o)+1]:null,y=l?r.store.getNext(l):null;if(r.eachSubGrid(f=>f._initialWidth=f.width),n!=="both"){const f={flex:`0 0 ${(p!=null?h:d)-L}px`,height:null},[,C]=e.widgets=[new V({appendTo:u}),e.cloneClient(u,n==="vertical"?1:0,t,f)];a!=null&&(r.renderRows(),t.atDate||(c.push(r.scrollColumnIntoView(o,A)),b&&c.push(C.scrollColumnIntoView(b,H)))),p!=null&&c.push(C.scrollRowIntoView(y,H)),r.element.classList.add("b-split-start"),C.element.classList.add("b-split-end"),r.scrollable.addPartner(C.scrollable,{x:n==="horizontal",y:n!=="horizontal"})}else{const f={flex:`0 0 ${d-L}px`};u.lastElementChild.style.flex=`0 0 ${h-L}px`,e.widgets=[new V({insertBefore:u.lastElementChild}),e.topSplitter=new V({appendTo:u.firstElementChild}),e.cloneClient(u.firstElementChild,1,t,f),e.cloneClient(u.lastElementChild,0,t),e.bottomSplitter=new V({appendTo:u.lastElementChild}),e.cloneClient(u.lastElementChild,2,t,f)];const C=r,I=e.widgets[2],G=e.widgets[3],_=e.widgets[5];C.element.classList.add("b-split-top-start"),I.element.classList.add("b-split-top-end"),G.element.classList.add("b-split-bottom-start"),_.element.classList.add("b-split-bottom-end"),a!=null&&(C.renderRows(),G.renderRows(),o&&!t.atDate&&(c.push(r.scrollColumnIntoView(o,A)),b&&c.push(I.scrollColumnIntoView(b,H)))),p!=null&&c.push(G.scrollRowIntoView(y,H),_.scrollRowIntoView(y,H)),C.scrollable.addPartner(I.scrollable,"y"),C.scrollable.addPartner(G.scrollable,"x"),I.scrollable.addPartner(_.scrollable,"x"),G.scrollable.addPartner(_.scrollable,"y"),e.topSplitter.ion({splitterMouseDown:"onSplitterMouseDown",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:e}),e.bottomSplitter.ion({splitterMouseDown:"onSplitterMouseDown",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:e})}e.subViews=[r,...e.widgets.filter(f=>f.isGridBase)],e.toggleOriginalSubGrids(t),e.syncHeaderHeights(),e._splitOptions=t,await Promise.all(c);const z=S.from(r.element);return r.onInternalResize(r.element,z.width,z.height),r.eachSubGrid(f=>{const C=S.from(f.element);f.onInternalResize(f.element,C.width,C.height)}),r.scrollable.x+=.5,r.scrollable.y+=.5,e.startSyncingColumns(),r.trigger("split",{subViews:e.subViews,options:t}),e.subViews}async unsplit(t=!1){const e=this,{client:r}=e,{element:s}=r;if(e.isSplit){var l;if(e.stopSyncingColumns(),(l=e.widgets)===null||l===void 0||l.forEach(o=>o.destroy()),e.widgets=null,r.eachSubGrid(o=>o.scrollable.x),r.scrollable.y,e.splitContainer.parentElement.appendChild(s),e.splitContainer.remove(),e.splitContainer=null,s.style.flexBasis=s.style.flexGrow="",s.classList.remove("b-split-top-start","b-split-start"),e.subViews.length=0,!e.isDestroying){r.renderRows(),e.unsplitCleanup();for(const o of e.restorers)o();if(e.restorers.length=0,await k.animationFrame(),await k.animationFrame(),e.isDestroyed)return;!t&&r.trigger("unsplit"),e._splitOptions=null}}}unsplitCleanup(){}populateCellMenu({record:t,column:e,items:r}){const s=this,{isSplit:l}=s,{splitFrom:o}=s.client;s.disabled||(r.splitGrid={text:"L{split}",localeClass:s,icon:"b-icon b-icon-split-vertical",weight:500,separator:!0,hidden:l||o,menu:{splitHorizontally:{text:"L{horizontally}",icon:"b-icon b-icon-split-horizontal",localeClass:s,weight:100,onItem(){s.split({atRecord:t})}},splitVertically:{text:"L{vertically}",icon:"b-icon b-icon-split-vertical",localeClass:s,weight:200,onItem(){s.split({atColumn:e})}},splitBoth:{text:"L{both}",icon:"b-icon b-icon-split-both",localeClass:s,weight:300,onItem(){s.split({atColumn:e,atRecord:t})}}}},r.unsplitGrid={text:"L{unsplit}",localeClass:s,icon:"b-icon b-icon-clear",hidden:!(l||o),weight:400,separator:!0,onItem(){(o||s).unsplit()}})}startSyncingColumns(){for(const t of this.subViews)t.columns.ion({name:"columns",change:"onColumnsChange",thisObj:this})}stopSyncingColumns(){this.detachListeners("columns")}onColumnsChange({source:t,isMove:e,action:r,parent:s,records:l,changes:o}){var a,d;const n=this;if(!N(n,x)){D(n,x,!0);for(const p of n.subViews){const{columns:h}=p;if(t!==h){if(r==="update"&&o.region&&Object.keys(o).length===1){if(h.getById(l[0].id))h.remove(l[0].id);else{const[c]=l,u=(a=h.getById(n.$before.parent.id))!=null?a:h.rootNode,g=n.$before.id!==null&&h.getById(n.$before.id);u.insertChild(c.data,g)}n.$before=null}else if(e!=null&&e[l[0].id]){if(r==="add"){const c=l[0],u=c.nextSibling,g=h.getById(c.id);if(!g){n.$before={id:u==null?void 0:u.id,parent:s},D(n,x,!1);return}if(c.meta.isSelectionColumn){D(n,x,!1);return}const b=(d=h.getById(s.id))!=null?d:h.rootNode,y=u&&h.getById(u.id);b.insertChild(g,y)}}else if(r==="add"){const c=l.filter(u=>p.getSubGridFromColumn(u));h.add(n.cloneColumns(c))}else h.applyChangesFromStore(t);h.commit()}}t.commit(),D(n,x,!1)}}getOtherSplitter(t){return t===this.topSplitter?this.bottomSplitter:this.topSplitter}onSplitterMouseDown({source:t,event:e}){e.handled||(e.handled=!0,this.getOtherSplitter(t).onMouseDown(e))}onSplitterDrag({source:t,event:e}){e.handled||(e.handled=!0,this.getOtherSplitter(t).onMouseMove(e))}onSplitterDrop({source:t,event:e}){e.handled||(e.handled=!0,this.getOtherSplitter(t).onMouseUp(e))}afterConfigChange({name:t,value:e}){this.isSplit&&this.relayProperties[t]&&this.syncSplits(r=>{r[t]=e})}afterAddListener(t,e){this.isSplit&&!e.$internal&&!P[t]&&this.syncSplits(r=>r.on(t,e))}afterRemoveListener(t,e){e.$internal||this.syncSplits(r=>r.un(t,e))}forEachOther(t){const e=this.client.splitFrom||this.client;if(e.features.split.enabled&&!e.inForEachOther){e.inForEachOther=!0;for(const r of e.subViews)r!==this.client&&t(r);e.inForEachOther=!1}}syncSplits(t){this.forEachOther(t)}}x=new WeakMap,w(R,"$name","Split"),w(R,"featureClass",""),w(R,"configurable",{subViews:[],relayProperties:{value:{readOnly:1,rowHeight:1},$config:{merge:"merge"}}}),w(R,"pluginConfig",{chain:["populateCellMenu","afterConfigChange","afterAddListener","afterRemoveListener"],assign:["split","unsplit","subViews","syncSplits"]}),R._$name="Split",v.registerFeature(R,!1);class T extends K{static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"\xA0\xA0\xA0\xA0"}}export(i={}){const t=this;return i=O.assign({},t.config,i),t.normalizeColumns(i),t.generateExportData(i)}generateExportData(i){const t=this,e=t.generateColumns(i);return{rows:t.generateRows(i),columns:e}}normalizeColumns(i){const t=i.columns||this.target.columns.visibleColumns.filter(e=>e.exportable!==!1);i.columns=t.map(e=>typeof e=="string"?this.target.columns.find(r=>r.field===e)||{field:e}:e)}generateColumns(i){return i.columns.map(t=>this.processColumn(t,i))}generateRows(i){const{columns:t,rows:e}=i;if(t.length===0||(e==null?void 0:e.length)===0)return[];const r=this,{target:s}=r;return(e||s.store).map(l=>r.processRecord(l,t,i)).filter(l=>l==null?void 0:l.length)}getColumnType(i,t=this.target.store){let e=i.exportedType||"object";if(i.exportedType===void 0&&i.field){const r=t.modelClass.getFieldDefinition(i.field);r&&r.type!=="auto"&&(e=r.type)}return e}processColumn(i,t){const e=this,{target:r}=e,{defaultColumnWidth:s}=t;let{field:l,text:o,width:n,minWidth:a}=i;if(l in r.store.modelClass.fieldMap||(l=""),!o||!n){const d=r.columns.find(p=>p.field===l);o||(o=d&&d.text||l),n==null&&(n=d&&d.width||s)}return n=Math.max(n||s,a||s),{field:l,value:o,width:n,type:e.getColumnType(i)}}processRecord(i,t,e){const{target:r}=this,{showGroupHeader:s,indent:l,indentationSymbol:o}=e;let n;return i?i.isSpecialRow?s&&i.meta.groupRowFor&&(n=t.map(a=>r.features.group.buildGroupHeader({cellElement:F.createElement(),grid:r,record:i,column:a}))):n=t.map(a=>{let d=i.getValue(a.field);const p=a.renderer||a.defaultRenderer;return p&&!(d&&a.isDateColumn&&e.exportDateAsInstance)&&(d=p.call(a,{value:d,record:i,column:a,grid:r,isExport:!0})),l&&a.tree&&(d=`${o.repeat(i.childLevel)}${d}`),d}):n=t.map(()=>""),n}}T._$name="TableExporter";class U{constructor(i){this._value=i}get value(){return this._value}toString(){return this.value?"\u2713":""}}U._$name="BooleanUnicodeSymbol";class M extends ${static get $name(){return"ExcelExporter"}static get defaultConfig(){return{filename:null,dateFormat:"YYYY-MM-DD",exporterClass:T,exporterConfig:null,zipcelx:null,convertEmptyValueToEmptyString:!0}}processValue(i){return i==null||Number.isNaN(i)||typeof i=="function"||typeof i=="object"&&String(i)==="[object Object]"?"":i}generateExportData(i){const t=this,{rows:e,columns:r}=t.exporter.export(i.exporterConfig);return{rows:e.map(s=>s.map((l,o)=>{var n;l instanceof Date?l=Q.format(l,i.dateFormat):typeof l=="boolean"&&(l=new U(l)),t.convertEmptyValueToEmptyString&&(l=t.processValue(l));const a=((n=r[o])===null||n===void 0?void 0:n.type)==="number"?"number":"string";return{value:l,type:a}})),columns:r.map(s=>{let{field:l,value:o,width:n,type:a}=s;return a="string",{field:l,value:o,width:n,type:a}})}}export(i={}){const t=this,e=t.zipcelx||globalThis.zipcelx;if(!e)throw new Error('ExcelExporter: "zipcelx" library is required');if(t.disabled)return;i=O.assign({},t.config,i),i.filename||(i.filename=t.client.$$name);const{filename:r}=i,{rows:s,columns:l}=t.generateExportData(i);return e({filename:r,sheet:{data:[l].concat(s),cols:l}})}construct(i,t){super.construct(i,t),this.zipcelx||typeof zipcelx!="undefined"&&(this.zipcelx=globalThis.zipcelx)}get exporter(){const i=this;return i._exporter||(i._exporter=i.exporterClass.new({target:i.client},i.exporterConfig))}}M._$name="ExcelExporter",v.registerFeature(M,!1,"Grid");export{E as ColorColumn,M as ExcelExporter,B as GroupSummary,R as Split,T as TableExporter};
//# sourceMappingURL=ExcelExporter.js.map
