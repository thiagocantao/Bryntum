/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var Ve=Object.defineProperty;var ze=(m,e,t)=>e in m?Ve(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var D=(m,e,t)=>(ze(m,typeof e!="symbol"?e+"":e,t),t);import{Base as j,DomHelper as d,GlobalEvents as ke,Rectangle as E,Delayable as Xe,EventHelper as k,Events as ie,ObjectHelper as _,BrowserHelper as re,Widget as L,Point as we,Mask as Be,Toast as Ue,StringHelper as ae,LocaleManagerSingleton as Se,ArrayHelper as V,DateHelper as u,DayTime as je,Container as ce,Rotatable as Ke,Panel as de,Tooltip as qe,TimeZoneHelper as Ge,TextField as Te,Combo as Ze,PickerField as Me,Field as Je,Duration as K,VersionHelper as Qe,DomClassList as he,Popup as et}from"./Editor.js";var tt=m=>class extends(m||j){static get $name(){return"DragHelperContainer"}initContainerDrag(){const t=this;if(t.mode||(t.mode="container"),t.mode==="container"&&!t.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(t){const i=this;if(!i.ignoreSelector||!t.target.closest(i.ignoreSelector)){const r=d.getAncestor(t.target,i.containers,i.outerElement);if(r){const a=r.getBoundingClientRect();i.context={element:r,valid:!0,action:"container",offsetX:t.pageX-a.left,offsetY:t.pageY-a.top,originalPosition:{parent:r.parentElement,prev:r.previousElementSibling,next:r.nextElementSibling}}}return!0}return!1}startContainerDrag(t){var i;const r=this,{context:a,floatRootOwner:n}=r,{element:s}=a,l=s.cloneNode(!0),o=n==null?void 0:n.element.closest(".b-outer");l.classList.add(r.dragProxyCls,r.draggingCls),((n==null?void 0:n.floatRoot)||d.getRootElement(s)).appendChild(l),a.dragProxy=l,a.dragging=s,s.classList.add(r.dropPlaceholderCls),o!=null&&(i=o.parentElement)!==null&&i!==void 0&&i.matches(".b-float-root")&&(l.style.zIndex=n.floatRootMaxZIndex+1)}onContainerDragStarted(t){const i=this,{context:r}=i,{element:a,dragProxy:n}=r,s=a.getBoundingClientRect();if(i.autoSizeClonedTarget)n.style.width=s.width+"px",n.style.height=s.height+"px",d.setTranslateXY(r.dragProxy,s.left,s.top);else{const l=n.getBoundingClientRect();Object.assign(r,{offsetX:l.width/2,offsetY:l.height/2}),d.setTranslateXY(n,t.clientX,t.clientY)}}updateContainerDrag(t){var i;const r=this,{context:a}=r;if(!a.started||!a.targetElement)return;const n=d.getAncestor(a.targetElement,r.containers,"b-gridbase"),s=(i=a.dragging)===null||i===void 0?void 0:i.contains(d.getActiveElement(a.dragging));n&&d.isDescendant(a.element,n)||(s&&ke.suspendFocusEvents(),n&&a.valid?r.moveNextTo(n,t):r.revertPosition(),s&&ke.resumeFocusEvents(),t.preventDefault())}finishContainerDrag(t){const i=this,{context:r}=i,{dragging:a,dragProxy:n,valid:s,draggedTo:l,insertBefore:o,originalPosition:c}=r;a&&(r.valid=!!(s&&(l||i.externalDropTargetSelector&&t.target.closest(i.externalDropTargetSelector))&&(a!==o||c.parent!==l)),r.finalize=(h=r.valid)=>{!h&&i.context&&i.revertPosition(),a.classList.remove(i.dropPlaceholderCls),n.remove(),i.reset()},r.async=!1,i.trigger("drop",{context:r,event:t}),r.async||r.finalize())}abortContainerDrag(t=!1,i=null,r=!1){const a=this,{context:n}=a;n.dragging&&(n.dragging.classList.remove(a.dropPlaceholderCls),n.dragProxy.remove(),a.revertPosition()),r||a.trigger(t?"drop":"abort",{context:n,event:i}),a.reset()}updateContainerProxy(t){const i=this,{context:r}=i,a=r.dragProxy;let n=t.pageX-r.offsetX,s=t.pageY-r.offsetY;typeof i.minX=="number"&&(n=Math.max(i.minX,n)),typeof i.maxX=="number"&&(n=Math.min(i.maxX-a.offsetWidth,n)),typeof i.minY=="number"&&(s=Math.max(i.minY,s)),typeof i.maxY=="number"&&(s=Math.min(i.maxY-a.offsetHeight,s)),i.lockX?d.setTranslateY(a,s):i.lockY?d.setTranslateX(a,n):d.setTranslateXY(a,n,s);let l;if(t.type==="touchmove"){const o=t.changedTouches[0];l=d.elementFromPoint(o.clientX,o.clientY)}else l=t.target;r.targetElement=l}moveNextTo(t,i){const{context:r}=this,a=r.dragging,n=t.parentElement;if(t!==a){const s=E.from(t).center.x;this.isRTL&&i.pageX>s||!this.isRTL&&i.pageX<s?(n.insertBefore(a,t),r.insertBefore=t):t.nextElementSibling?t.nextElementSibling!==a?(r.insertBefore=t.nextElementSibling,n.insertBefore(a,t.nextElementSibling)):!r.insertBefore&&a.parentElement.lastElementChild!==a&&(r.insertBefore=t.nextElementSibling):(n.appendChild(a),r.insertBefore=null),r.draggedTo=n}}revertPosition(){const{context:t}=this,{dragging:i}=t,{parent:r,next:a}=t.originalPosition;a?a.previousSibling===i||!a&&i===r.lastChild||r.insertBefore(i,a):r.appendChild(i),t.draggedTo=null}};const it={pageXOffset:0,pageYOffset:0};var rt=m=>class extends Xe(m||j){static get $name(){return"DragHelperTranslate"}static get configurable(){return{positioning:null,skipUpdatingElement:null}}initTranslateDrag(){const t=this;!t.isElementDraggable&&t.targetSelector&&(t.isElementDraggable=i=>i.closest(t.targetSelector))}grabTranslateDrag(t){const i=this.getTarget(t);return i?(this.context={valid:!0,element:i,startPageX:t.pageX,startPageY:t.pageY,startClientX:t.clientX,startClientY:t.clientY},!0):!1}getTarget(t){return t.target.closest(this.targetSelector)}getX(t){return this.positioning==="absolute"?parseFloat(t.style.left,10):d.getTranslateX(t)}getY(t){return this.positioning==="absolute"?parseFloat(t.style.top,10):d.getTranslateY(t)}getXY(t){return this.positioning==="absolute"?[t.offsetLeft,t.offsetTop]:d.getTranslateXY(t)}setXY(t,i,r){this.skipUpdatingElement||(this.positioning==="absolute"?(t.style.left=i+"px",t.style.top=r+"px"):d.setTranslateXY(t,i,r))}startTranslateDrag(t){const i=this,{context:r,outerElement:a,proxySelector:n}=i,s=i.dragWithin=i.dragWithin||i.cloneTarget&&document.body;let l=r.dragProxy||r.element;const o=l,c=l.parentElement;if(i.cloneTarget){const h=n?l.querySelector(n):l,{width:p,height:g,x:v,y:b}=E.from(h,s);l=i.createProxy(l);let y=v,T=b;if(i.autoSizeClonedTarget&&(l.style.width=`${p}px`,l.style.height=`${g}px`),l.classList.add(i.dragProxyCls,i.draggingCls),l.classList.remove("b-hover","b-selected","b-focused"),s.appendChild(l),!i.autoSizeClonedTarget||n){const x=l.getBoundingClientRect(),{x:M,y:w}=s.getBoundingClientRect(),O=t.clientX-M,C=t.clientY-w+(s!==document.body?document.body.getBoundingClientRect().y:0);y=O-x.width/2,T=C-x.height/2,r.startPageX=t.pageX,r.startPageY=t.pageY}i.setXY(l,y,T),o.classList.add("b-drag-original"),i.hideOriginalElement&&o.classList.add("b-hidden")}l.classList.add(i.draggingCls),Object.assign(r,{element:l,grabbed:o,grabbedParent:c,grabbedNextSibling:l.nextElementSibling,elementStartX:i.getX(l),elementStartY:i.getY(l),elementX:d.getOffsetX(l,s||a),elementY:d.getOffsetY(l,s||a),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!i.cloneTarget||s===a}),s&&(r.parentElement=l.parentElement,s!==l.parentElement&&s.appendChild(l),i.updateTranslateProxy(t))}onTranslateDragStarted(){var t;const i=this,{context:r}=i;let{relatedElements:a}=r;if(i.unifiedProxy&&r.element.classList.add("b-drag-main","b-drag-unified-proxy"),((t=a)===null||t===void 0?void 0:t.length)>0){r.relatedElStartPos=[],r.relatedElDragFromPos=[];const{proxySelector:n}=i;let[s,l]=[r.elementStartX,r.elementStartY];r.originalRelatedElements=a,a=r.relatedElements=a.map((o,c)=>{const h=n?o.querySelector(n):o,{x:p,y:g,width:v,height:b}=E.from(h,i.dragWithin),y=i.cloneTarget?i.createProxy(o):o;return y.classList.add(i.draggingCls),y.classList.remove("b-hover","b-selected","b-focused"),i.cloneTarget&&(i.setXY(y,p,g),i.dragWithin.appendChild(y),y.classList.add(i.dragProxyCls),i.autoSizeClonedTarget&&(y.style.width=`${v}px`,y.style.height=`${b}px`),i.hideOriginalElement&&o.classList.add("b-hidden"),o.classList.add("b-drag-original")),r.relatedElStartPos[c]=r.relatedElDragFromPos[c]=i.getXY(y),i.unifiedProxy&&(y.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),s+=i.unifiedOffset,l+=i.unifiedOffset,i.setXY(y,s,l),r.relatedElDragFromPos[c]=[s,l],y.style.zIndex=100-c),y}),i.unifiedProxy&&a&&a.length>0&&k.onTransitionEnd({element:a[0],property:"transform",handler(){a.forEach(o=>o.classList.remove("b-drag-unified-animation"))},thisObj:i,once:!0})}}applyConstraints(t,i,r){const a=this,{constrain:n,dragWithin:s}=a,{pageXOffset:l,pageYOffset:o}=s===document.body?globalThis:it;return s&&n&&(i<0&&(i=0),i+t.offsetWidth>s.scrollWidth&&(i=s.scrollWidth-t.offsetWidth),r<0&&(r=0),r+t.offsetHeight>s.scrollHeight&&(r=s.scrollHeight-t.offsetHeight)),typeof a.minX=="number"&&(i=Math.max(a.minX+l,i)),typeof a.maxX=="number"&&(i=Math.min(a.maxX+l,i)),typeof a.minY=="number"&&(r=Math.max(a.minY+o,r)),typeof a.maxY=="number"&&(r=Math.min(a.maxY+o,r)),{constrainedX:i,constrainedY:r}}updateTranslateProxy(t,i){const r=this,{lockX:a,lockY:n,context:s}=r,l=s.dragProxy||s.element,{relatedElements:o,relatedElDragFromPos:c}=s;s.scrollManagerElementContainsDragProxy&&i&&(s.scrollX=i.getRelativeLeftScroll(l),s.scrollY=i.getRelativeTopScroll(l)),s.pageX=t.pageX,s.pageY=t.pageY,s.clientX=t.clientX,s.clientY=t.clientY;let h=s.elementStartX+t.pageX-s.startPageX+s.scrollX,p=s.elementStartY+t.pageY-s.startPageY+s.scrollY;if(r.snapCoordinates){const b=r.snapCoordinates({element:l,newX:h,newY:p});h=b.x,p=b.y}const{constrainedX:g,constrainedY:v}=r.applyConstraints(l,h,p);if((s.started||g!==h||v!==p)&&r.setXY(l,a?void 0:g,n?void 0:v),o){const b=a?0:g-s.elementStartX,y=n?0:v-s.elementStartY;o.forEach((T,x)=>{const[M,w]=c[x];r.setXY(T,M+b,w+y)})}s.newX=g,s.newY=v}async finishTranslateDrag(t){const i=this,r=i.context,{target:a}=t,n=!i.lockX&&Math.round(r.newX)!==Math.round(r.elementStartX),s=!i.lockY&&Math.round(r.newY)!==Math.round(r.elementStartY),l=r.dragProxy||r.element,{relatedElements:o}=r;if(!i.ignoreSamePositionDrop||n||s)if(r.valid===!1)await i.abortTranslateDrag(!0,t);else{const c=!i.allowDropOutside&&E.from(i.dragWithin||i.outerElement);c&&(typeof i.minX!="number"&&i.minX!==!0&&t.pageX<c.left||typeof i.maxX!="number"&&i.maxX!==!0&&t.pageX>c.right||typeof i.minY!="number"&&i.minY!==!0&&t.pageY<c.top||typeof i.maxY!="number"&&i.maxY!==!0&&t.pageY>c.bottom)?await i.abortTranslateDrag(!0,t):(r.finalize=async(h=r.valid)=>{if(r.finalized){console.warn("DragHelper: Finalizing already finalized drag");return}r.finalized=!0,!h&&i.context&&await i.abortTranslateDrag(!0,null,!0),i.isDestroyed||(i.trigger("dropFinalized",{context:r,event:t,target:a}),i.reset()),!i.cloneTarget&&l.parentElement!==r.grabbedParent&&[l,...o||[]].forEach(p=>p.style.transform="")},r.async=!1,await i.trigger("drop",{context:r,event:t,target:a}),r.async||await r.finalize())}else i.abortTranslateDrag(!1,t)}async abortTranslateDrag(t=!1,i=null,r=!1){var a,n;const s=this,{cloneTarget:l,context:o,proxySelector:c,dragWithin:h,draggingCls:p}=s,{relatedElements:g,relatedElStartPos:v,grabbed:b}=o,y=o.dragProxy||o.element;if(o.valid=!1,(a=s.scrollManager)===null||a===void 0||a.stopMonitoring(),o.aborted){console.warn("DragHelper: Aborting already aborted drag");return}let{elementStartX:T,elementStartY:x}=o;const M=T!==s.getX(y)||x!==s.getY(y);if(y&&o.started){if(!l&&h&&h!==o.grabbedParent&&o.grabbedParent.insertBefore(y,o.grabbedNextSibling),l&&c){const w=b.querySelector(c)||b,{x:O,y:C}=E.from(w);T=O,x=C}y.classList.add("b-aborting"),s.setXY(y,T,x),g==null||g.forEach((w,O)=>{w.classList.remove(p),w.classList.add("b-aborting"),s.setXY(w,v[O][0],v[O][1])}),r||s.trigger(t?"drop":"abort",{context:o,event:i}),y.isConnected&&!s.isDestroying&&M&&await k.waitForTransitionEnd({element:y,property:d.getPropertyTransitionDuration(y,"transform")?"transform":"all",thisObj:s,once:!0,runOnDestroy:!0}),s.isDestroyed||s.trigger("abortFinalized",{context:o,event:i})}(n=s.context)!==null&&n!==void 0&&n.started&&s.reset()}cleanUp(){const t=this,{context:i,cloneTarget:r,draggingCls:a,dragProxyCls:n}=t,s=i.dragProxy||i.element,{relatedElements:l,originalRelatedElements:o,grabbed:c}=i,h=r&&(t.removeProxyAfterDrop||!i.valid),p=[a,"b-aborting",n,"b-drag-main","b-drag-unified-proxy"];s.classList.remove(...p),h&&s.remove(),l==null||l.forEach(g=>{h?g.remove():g.classList.remove(...p)}),c.classList.remove("b-drag-original","b-hidden"),o==null||o.forEach(g=>g.classList.remove("b-hidden","b-drag-original"))}};const G={move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class Ee extends j.mixin(ie,tt,rt){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,allowDropOutside:null,floatRootOwner:null,mouseMoveListenerElement:document,externalDropTargetSelector:null,testConfig:{transitionDuration:10,clickSwallowDuration:50,touchStartDelay:100},rtlSource:null,createProxy:null}}construct(e){const t=this;super.construct(e),t.initListeners(),t.isContainerDrag?t.initContainerDrag():t.initTranslateDrag(),t.onScrollManagerScrollCallback=t.onScrollManagerScrollCallback.bind(t)}doDestroy(){this.reset(!0),super.doDestroy()}initListeners(){const e=this,{outerElement:t}=e,i={element:t,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(t),k.on(i)}getMouseMoveListenerTarget(e){const t=e.getRootNode();let i=this.mouseMoveListenerElement;return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&t.mode==="closed"&&(i=e.closest(".b-outer")||i),i}get isRTL(){var e;return!!(!((e=this.rtlSource)===null||e===void 0)&&e.rtl)}onPointerDown(e){const t=this;if(e.button!==0||t.context||t.isElementDraggable&&!t.isElementDraggable(e.target,e))return;if(t.startEvent=e,t.isContainerDrag?t.grabContainerDrag(e):t.grabTranslateDrag(e)){t.blurDetacher=k.on({element:globalThis,blur:t.onWindowBlur,thisObj:t});const r={element:t.mouseMoveListenerElement,thisObj:t,capture:!0,keydown:G.keydown};if(e.pointerType==="touch"?(t.touchStartTimer=t.setTimeout(()=>t.touchStartTimer=null,t.touchStartDelay,"touchStartDelay"),r.touchmove={handler:G.touchmove,passive:!1},r.touchend=r.pointerup=G.touchend):(r.pointermove=G.move,r.pointerup=G.up),t.dragListenersDetacher=k.on(r),t.dragWithin&&t.dragWithin!==t.outerElement&&t.outerElement.contains(t.dragWithin)){const a=E.from(t.dragWithin,t.outerElement);t.minY=a.top,t.maxY=a.bottom,t.minX=a.left,t.maxX=a.right}}}async internalMove(e){var t;if(e.scrollInitiated)return;const i=this,{context:r}=i,a=k.getDistanceBetween(i.startEvent,e);if(i.touchStartTimer&&a>i.dragThreshold){i.abort(!0);return}if(!i.touchStartTimer&&r!==null&&r!==void 0&&r.element&&(r.started||a>=i.dragThreshold)&&((t=e.target)===null||t===void 0?void 0:t.nodeType)===Node.ELEMENT_NODE){if(!r.started){var s;if(i.trigger("beforeDragStart",{context:r,event:e})===!1)return i.abort();i.isContainerDrag?i.startContainerDrag(e):i.startTranslateDrag(e),r.started=!0,(s=i.scrollManager)===null||s===void 0||s.startMonitoring(_.merge({scrollables:[{element:i.dragWithin||i.outerElement}],callback:i.onScrollManagerScrollCallback},i.monitoringConfig)),r.outermostEl=d.getOutermostElement(e.target),r.outermostEl.classList.add("b-draghelper-active"),i.dropTargetSelector&&i.dropTargetCls&&d.getRootElement(i.outerElement).querySelectorAll(i.dropTargetSelector).forEach(o=>o.classList.add(i.dropTargetCls));const l=i.trigger("dragStart",{context:r,event:e});_.isPromise(l)&&await l,r.moveUnblocked=!0,i.isContainerDrag?i.onContainerDragStarted(e):i.onTranslateDragStarted(e),i.trigger("afterDragStart",{context:r,event:e})}r.moveUnblocked?i._cachedMouseEvent?(i.update(e),i.update(i._cachedMouseEvent),delete i._cachedMouseEvent):i.update(e):i._cachedMouseEvent=e,e.type==="touchmove"&&(e.preventDefault(),e.stopImmediatePropagation())}}onScrollManagerScrollCallback(e){var t;const{lastMouseMoveEvent:i}=this;(t=this.context)!==null&&t!==void 0&&t.element&&i&&(i.isScroll=!0,this.update(i,e))}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,t){const i=this,{context:r}=i,a=document.scrollingElement||document.body;let n=i.getMouseMoveEventTarget(e);if(e.type==="touchmove"){const o=e.changedTouches[0];n=d.elementFromPoint(o.clientX+a.scrollLeft,o.clientY+a.scrollTop)}r.target=n;let s=i.allowDropOutside||!i.dragWithin||i.dragWithin.contains(e.target);if(s&&i.dropTargetSelector){var l;s=s&&!!(!((l=n)===null||l===void 0)&&l.closest(i.dropTargetSelector))}i.isContainerDrag?i.updateContainerProxy(e,t):i.updateTranslateProxy(e,t),r.valid=s,i.trigger("drag",{context:r,event:e}),i.isContainerDrag&&i.updateContainerDrag(e,t),r.valid=r.valid&&s;for(const o of i.draggedElements)o.classList.toggle(i.invalidCls,!r.valid);e&&(i.lastMouseMoveEvent=e)}get draggedElements(){var t;const{context:e}=this;return[e.dragProxy||e.element,...(t=e.relatedElements)!=null?t:[]]}async abort(e=!1){var t,i;const r=this,{context:a}=r;(t=r.scrollManager)===null||t===void 0||(i=t.stopMonitoring)===null||i===void 0||i.call(t),r.removeListeners(),a!=null&&a.started&&!a.aborted?(a.element.getBoundingClientRect(),a.valid=!1,r.isContainerDrag?r.abortContainerDrag(void 0,void 0,e):r.abortTranslateDrag(void 0,void 0,e),a.aborted=!0):r.reset(!0)}removeListeners(){var e,t;(e=this.dragListenersDetacher)===null||e===void 0||e.call(this),(t=this.blurDetacher)===null||t===void 0||t.call(this)}reset(e){const t=this,{context:i}=t;if(i!=null&&i.started){for(const r of t.draggedElements)r.classList.remove(t.invalidCls);i.outermostEl.classList.remove("b-draghelper-active"),t.isContainerDrag?i.dragProxy.remove():t.cleanUp(),t.dropTargetSelector&&t.dropTargetCls&&d.getRootElement(t.outerElement).querySelectorAll(t.dropTargetSelector).forEach(r=>r.classList.remove(t.dropTargetCls))}t.removeListeners(),e||t.trigger("reset"),t.context=t.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,{context:i}=t;if(t.removeListeners(),i){var r;(r=t.scrollManager)===null||r===void 0||r.stopMonitoring(),i.started?i.moveUnblocked?(e.stopPropagation(),i.finalizing=!0,t.isContainerDrag?t.finishContainerDrag(e):t.finishTranslateDrag(e),k.on({element:document,thisObj:t,click:G.docclick,capture:!0,expires:t.clickSwallowDuration,once:!0})):t.ion({drag(){t.onMouseUp(e)},once:!0}):t.reset(!0)}}onKeyDown(e){var t;(t=this.context)!==null&&t!==void 0&&t.started&&e.key==="Escape"&&(e.stopImmediatePropagation(),this.abort())}onWindowBlur(){this.context&&!this.context.finalizing&&this.abort()}createProxy(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);const t=e.cloneNode(!0);return t.removeAttribute("id"),t}get isContainerDrag(){return this.mode==="container"}async animateProxyTo(e,t={align:"c-c"}){const{context:i,draggedElements:r}=this,{element:a}=i,n=e.isRectangle?e:E.from(e);r.forEach(s=>{s.classList.add("b-drag-final-transition"),d.alignTo(s,n,t)}),await k.waitForTransitionEnd({element:a,property:"all",thisObj:this,once:!0}),r.forEach(s=>s.classList.remove("b-drag-final-transition"))}get isDragging(){var e;return!!(!((e=this.context)===null||e===void 0)&&e.started)}getMouseMoveEventTarget(e){return e.isScroll?d.elementFromPoint(e.clientX,e.clientY):e.target}}Ee._$name="DragHelper";const W={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class ge extends ie(j){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,rtlSource:null}}construct(e){const t=this;super.construct(e),!t.handleSelector&&!re.isHoverableDevice&&(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}updateSkipUpdatingElement(e){e&&(this.skipTranslate=!0)}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=t=>t.closest(e.targetSelector)),e.grab){const{edge:t,element:i,event:r}=e.grab;e.startEvent=r;const a=e.getCursorOffsetToElementEdge(r,i,t);e.context={element:i,edge:t,valid:!0,async:!1,elementStartX:d.getTranslateX(i)||i.offsetLeft,elementStartY:d.getTranslateY(i)||i.offsetTop,newX:d.getTranslateX(i)||i.offsetLeft,newY:d.getTranslateY(i)||i.offsetTop,elementWidth:i.offsetWidth,elementHeight:i.offsetHeight,cursorOffset:a,startX:r.clientX+a.x+e.scrollLeft,startY:r.clientY+a.y+e.scrollTop,finalize:()=>{var n;return(n=e.reset)===null||n===void 0?void 0:n.call(e)}},i.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:W.down,touchstart:W.touchstart,thisObj:e};!e.handleSelector&&re.isHoverableDevice&&(t.mousemove={handler:W.move,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),k.on(t)}get isRTL(){var e;return!!(!((e=this.rtlSource)===null||e===void 0)&&e.rtl)}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const t={element:document,keydown:W.keydown,thisObj:this};e?(t.touchmove=W.touchmove,t.touchend=t.pointerup=W.touchend):(t.mousemove=W.move,t.mouseup=W.up),this.removeDragListeners=k.on(t)}removeDragListeners(){}reset(){var e;(e=this.removeDragListeners)===null||e===void 0||e.call(this),this.context=null,this.trigger("reset")}canResize(e,t){return!this.isElementResizable||this.isElementResizable(e,t)}onPointerDown(e,t){const i=this;i.startEvent=t,i.canResize(t.target,t)&&i.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),t.type==="touchstart"&&t.preventDefault(),i.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){e.button===0&&this.onPointerDown(!1,e)}internalMove(e,t){const i=this,{context:r,direction:a}=i;if(r!=null&&r.element&&(r.started||k.getDistanceBetween(i.startEvent,t)>=i.dragThreshold)){if(!r.started){var n;(n=i.scrollManager)===null||n===void 0||n.startMonitoring(_.merge({scrollables:[{element:i.dragWithin||i.outerElement,direction:a}],callback:s=>{var l;return((l=i.context)===null||l===void 0?void 0:l.element)&&i.lastMouseMoveEvent&&i.update(i.lastMouseMoveEvent,s)}},i.monitoringConfig)),i.trigger("resizeStart",{context:r,event:t}),r.started=!0}i.update(t)}else!e&&!i.handleSelector&&i.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,t){var i;const r=this,a=r.context;if((i=r.removeDragListeners)===null||i===void 0||i.call(r),a){var n;(n=r.scrollManager)===null||n===void 0||n.stopMonitoring(),a.started&&k.on({element:document,thisObj:r,click:W.docclick,expires:r.clickSwallowDuration,capture:!0,once:!0}),r.finishResize(t)}else{var s;(s=r.reset)===null||s===void 0||s.call(r)}}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){e.key==="Escape"&&this.abort()}update(e){const t=this,i=t.context,r=E.from(t.outerElement);i.currentX=Math.max(Math.min(e.clientX+i.cursorOffset.x,r.right),r.x)+t.scrollLeft,i.currentY=Math.max(Math.min(e.clientY+i.cursorOffset.y,r.bottom),r.y)+t.scrollTop,e&&(t.updateResize(e)&&(t.trigger("resizing",{context:i,event:e}),i.element.classList.toggle(t.invalidCls,i.valid===!1)),t.lastMouseMoveEvent=e)}abort(e=!1){var t,i;const r=this;(t=r.scrollManager)===null||t===void 0||(i=t.stopMonitoring)===null||i===void 0||i.call(t),r.context?r.abortResize(null,e):r.isDestroyed||r.reset()}grabResizeHandle(e,t){const i=this;if(i.allowResize&&!i.allowResize(t.target,t))return!1;const r=i.handleSelector,a=t.type==="touchstart"?t.changedTouches[0]:t,n=a.clientX,s=a.clientY,l=i.targetSelector?t.target.closest(i.targetSelector):t.target;if(l){let o;if(r)if(t.target.matches(r))i.direction==="horizontal"?t.pageX<d.getPageX(l)+l.offsetWidth/2?o=i.isRTL?"right":"left":o=i.isRTL?"left":"right":t.pageY<d.getPageY(l)+l.offsetHeight/2?o="top":o="bottom";else return!1;else if(i.direction==="horizontal"?i.overLeftHandle(t,l)?o=i.isRTL?"right":"left":i.overRightHandle(t,l)&&(o=i.isRTL?"left":"right"):i.overTopHandle(t,l)?o="top":i.overBottomHandle(t,l)&&(o="bottom"),!o)return i.context=null,!1;t.type==="touchstart"&&t.preventDefault();const c=i.getCursorOffsetToElementEdge(a,l,o);if(i.trigger("beforeResizeStart",{element:l,event:t})!==!1)return i.context={element:l,edge:o,isTouch:e,valid:!0,async:!1,direction:i.direction,elementStartX:d.getTranslateX(l)||l.offsetLeft,elementStartY:d.getTranslateY(l)||l.offsetTop,newX:d.getTranslateX(l)||l.offsetLeft,newY:d.getTranslateY(l)||l.offsetTop,elementWidth:l.offsetWidth,elementHeight:l.offsetHeight,cursorOffset:c,startX:n+c.x+i.scrollLeft,startY:s+c.y+i.scrollTop,finalize:()=>{var h;return(h=i.reset)===null||h===void 0?void 0:h.call(i)}},l.classList.add(i.resizingCls),!0}return!1}getCursorOffsetToElementEdge(e,t,i){const r=E.from(t);let a=0,n=0;switch(i){case"left":a=r.x-(this.isRTL?r.width:0)-e.clientX;break;case"right":a=r.x+(this.isRTL?0:r.width)-e.clientX;break;case"top":n=r.y-e.clientY;break;case"bottom":n=r.y+r.height-e.clientY;break}return{x:a,y:n}}checkResizeHandles(e){const t=this,i=t.targetSelector?e.target.closest(t.targetSelector):e.target;if(i&&(!t.allowResize||t.allowResize(e.target,e))){if(t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement){let r;t.direction==="horizontal"?r=t.overLeftHandle(e,i)||t.overRightHandle(e,i):r=t.overTopHandle(e,i)||t.overBottomHandle(e,i),r?t.highlightHandle():t.unHighlightHandle()}}else t.currentElement&&t.unHighlightHandle()}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const t=this,{context:i,allowEdgeSwitch:r,skipTranslate:a,skipUpdatingElement:n}=t;let s;r&&(t.direction==="horizontal"?i.edge=i.currentX>i.startX?"right":"left":i.edge=i.currentY>i.startY?"bottom":"top");const{element:l,elementStartX:o,elementStartY:c,elementWidth:h,elementHeight:p,edge:g}=i,{style:v}=l,b=i.currentX-i.startX,y=i.currentY-i.startY,T=d.getExtremalSizePX(l,"minWidth")||t.minWidth,x=d.getExtremalSizePX(l,"maxWidth")||t.maxWidth,M=d.getExtremalSizePX(l,"minHeight")||t.minHeight,w=d.getExtremalSizePX(l,"maxHeight")||t.maxHeight,O=g==="right"&&!t.isRTL||g==="bottom"?1:-1,C=h+b*O,Y=p+y*O;let S=Math.max(T,C),F=Math.max(M,Y);if(x>0&&(S=Math.min(S,x)),w>0&&(F=Math.min(F,w)),v.flex&&(v.flex=""),t.direction==="horizontal"&&h!==S){if(n||(v.width=Math.abs(S)+"px"),i.newWidth=S,g==="left"||S<0){const N=Math.max(Math.min(o+h-t.minWidth,o+b),0);a||d.setTranslateX(l,Math.round(N)),i.newX=N}else g==="right"&&r&&!a&&d.setTranslateX(l,o);s=!0}else t.direction==="vertical"&&p!==Y&&(n||(v.height=Math.abs(F)+"px"),i.newHeight=F,g==="top"||F<0?(i.newY=Math.max(Math.min(c+p-t.minHeight,c+y),0),a||d.setTranslateY(l,i.newY)):g==="bottom"&&r&&!a&&d.setTranslateY(l,c),s=!0);return s}finishResize(e){const t=this,i=t.context,r={context:i,event:e};if(i.element.classList.remove(t.resizingCls),i.started){let n=!1;t.direction==="horizontal"?n=i.newWidth&&i.newWidth!==i.elementWidth:n=i.newHeight&&i.newHeight!==i.elementHeight,t.trigger(n?"resize":"cancel",r),i.async||i.finalize()}else{var a;(a=t.reset)===null||a===void 0||a.call(t)}}abortResize(e=null,t=!1){const i=this,r=i.context;r.element.classList.remove(i.resizingCls),i.direction==="horizontal"?((r.edge==="left"||r.allowEdgeSwitch&&!r.skipTranslate)&&d.setTranslateX(r.element,r.elementStartX),r.element.style.width=r.elementWidth+"px"):(d.setTranslateY(r.element,r.elementStartY),r.element.style.height=r.elementHeight+"px"),!t&&i.trigger("cancel",{context:r,event:e}),i.isDestroyed||i.reset()}highlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return this.direction==="horizontal"?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return this.direction==="horizontal"?this.overRightHandle(e,t):this.overBottomHandle(e,t)}getDynamicHandleSize(e,t){const i=e?2:1,{handleSize:r}=this;return this.dynamicHandleSize&&r*i>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/i),0):r}overLeftHandle(e,t){const i=this,{offsetWidth:r}=t;if(i.leftHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const a=E.from(t);return a.width=i.getDynamicHandleSize(i.rightHandle,r),a.width>0&&a.contains(k.getPagePoint(e))}return!1}overRightHandle(e,t){const i=this,{offsetWidth:r}=t;if(i.rightHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const a=E.from(t);return a.x=a.right-i.getDynamicHandleSize(i.leftHandle,r),a.width>0&&a.contains(k.getPagePoint(e))}return!1}overTopHandle(e,t){const i=this,{offsetHeight:r}=t;if(i.topHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const a=E.from(t);return a.height=i.getDynamicHandleSize(i.bottomHandle,r),a.height>0&&a.contains(k.getPagePoint(e))}return!1}overBottomHandle(e,t){const i=this,{offsetHeight:r}=t;if(i.bottomHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const a=E.from(t);return a.y=a.bottom-i.getDynamicHandleSize(i.bottomHandle,r),a.height>0&&a.contains(k.getPagePoint(e))}return!1}}D(ge,"configurable",{skipUpdatingElement:null}),ge._$name="ResizeHelper";class Le{static getById(e){return L.getById(e)}static fromElement(e,t,i){return L.fromElement(e,t,i)}static createWidget(e={}){return e.isWidget?e:L.create(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||typeof t=="string")&&(t={appendTo:t}),t.insertFirst){const i=typeof t.insertFirst=="string"?document.getElementById(t.insertFirst):t.insertFirst;i.firstChild?t.insertBefore=i.firstChild:t.appendTo=i}return e.map(i=>L.create(_.assign({},t||{},i)))}static openPopup(e,t){return L.create(_.assign({forElement:e},typeof t=="string"?{html:t}:t),"popup")}static showContextMenu(e,t){const i=this;return i.currentContextMenu&&i.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:(t.forElement=document.body,Array.isArray(e)&&(e=new we(...e)),e instanceof we&&(t.align={position:e})),t.internalListeners={destroy:i.currentContextMenu=null},i.currentContextMenu=L.create(t,"menu")}static attachTooltip(e,t){return L.attachTooltip(e,t)}static hasTooltipAttached(e){return L.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return L.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={target:e,text:t}),Be.mask(e,e.target)}static unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}static toast(e){return Ue.show(e)}}Le._$name="WidgetHelper";const Oe=Object.prototype.hasOwnProperty;let fe=null;function at(m,e){return Object.defineProperty(m,"parser",{value:e}),e}class nt{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,t){return this.formatter.defaultParse(e,t)}resolvedOptions(){return null}}class ne{static get(e){if(e==null)return this.NULL;if(e instanceof this)return e;const t=typeof e=="string"?e:JSON.stringify(e),i=this.cache;let r=i.get(t);return r||(fe=t,r=new this(e),i.set(t,r)),r}static get cache(){return Oe.call(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return Oe.call(this,"_null")?this._null:this._null=new this(null)}constructor(e){const t=this;if(t.cacheKey=fe,fe=null,t.initialize(),e===null)t.formatter=new nt(t);else{t.configure(e);for(const[i,r]of Object.entries(t.resolvedOptions()))r!=null&&i in t.defaults&&(t[i]=r)}}get parser(){return at(this,new this.constructor.Parser(this))}defaultFormat(e){return e==null?e:String(e)}defaultParse(e){return e}format(e){return e==null?e:this.formatter.format(e)}parse(e,t){return e==null?e:this.parser.parse(e,t)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}}ne._$name="Formatter";const se=ae.escapeRegExp,Pe=/[\d+-]/g,le=(m,e)=>new Intl.NumberFormat(m||void 0,e),st=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/,lt="\u2212";class ot{constructor(e){const t=this,i=e.locale,r=le(i,{maximumFractionDigits:3}),a=e.is.currency?t._decodeStyle(i,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,n=e.is.percent?t._decodeStyle(i,{style:"percent"}):null,s=r.format(1.2).replace(Pe,"")[0],l=r.format(1e9).replace(Pe,"")[0]||"";Object.assign(t,{currency:a,decimal:s,formatter:e,grouper:l,percent:n}),t.decimal=s,t.decimalRe=se(s,"g"),t.grouper=l,t.stripRe=new RegExp(`(?:\\s+|${se(l)})`+(a?`|(?:${se(a.text)})`:"")+(n?`|(?:${se(n.text)})`:""),"g")}decimalPlaces(e){e=e.replace(this.stripRe,"");const t=e.indexOf(this.decimal)+1;return t&&e.length-t}parse(e,t){return typeof e=="string"&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,".").replace(lt,"-"),e=t?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,t){const i=le(e,t),r=le(e,Object.assign(i.resolvedOptions(),{style:"decimal"})),a=i.format(0),n=r.format(0);return{suffix:a.startsWith(n),text:a.replace(n,"").trim()}}}class A extends ne{static get $name(){return"NumberFormat"}initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits;return e==null?null:this.as({style:"decimal",maximumFractionDigits:Math.min(20,e+1)},"truncator")}configure(e){const t=this;typeof e!="string"?Object.assign(t,e):t.template=e;const i={},r=t.locale?Se.locales[t.locale]:Se.locale,a=r&&r.NumberFormat,n=t.template;if(a)for(const s in a)t[s]==null&&typeof a[s]!="function"&&(t[s]=a[s]);if(n){const s=st.exec(n),l=s[2],o=s[4];t.useGrouping=!!s[3],t.style=s[1]?"currency":s[6]?"percent":"decimal",l&&(t.integer=+l),o==="*"?t.fraction=[0,20]:o!=null&&(t.fraction=[s[5].length,o.length])}t._minMax("fraction",!0,!0),t._minMax("integer",!0,!1),t._minMax("significant",!1,!0);for(const s in t.defaults)t[s]!=null&&(i[s]=t[s]);t.is.from=t.from&&t.from.is,t.is[t.style]=!(t.is.null=!1),t.formatter=le(t.locale,i)}as(e,t=null){const i=this.resolvedOptions()||{template:"9.*"},r=this._as;let a=t&&r[t];return a||(typeof e=="string"?i.style=e:Object.assign(i,e),i.from=this,a=new A(i)),t&&(r[t]=a),a}defaultParse(e,t){return e==null?e:t?Number(e):parseFloat(e)}format(e){if(typeof e=="string"){const t=Number(e);e=isNaN(t)?this.parse(e):t}return super.format(e)}round(e){return this.parse(this.format(e))}truncate(e){const t=this,i=t.maximumFractionDigits,{truncator:r}=t;let a=t.parse(e),n;return r&&(a=r.format(a),n=a.indexOf(r.parser.decimal),n>-1&&a.length-n-1>i&&(a=a.substr(0,n+i+1)),a=r.parse(a)),a}resolvedOptions(){const e=super.resolvedOptions();for(const t in e)e[t]===void 0&&(e[t]=this[t]);return e}_minMax(e,t,i){const r=this,a=r[e];if(a!=null){const n=ae.capitalize(e),s=`maximum${n}Digits`,l=`minimum${n}Digits`;typeof a=="number"?(t&&(r[l]=a),i&&(r[s]=a)):(r[l]=a[0],r[s]=a[1])}}}A.Parser=ot,Object.assign(A.prototype,{defaults:{style:"decimal",currency:null,currencyDisplay:"symbol",locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,useGrouping:!0},fraction:null,from:null,integer:null,significant:null,template:null}),Object.assign(A.prototype,A.prototype.defaults),ne.number=(m,e)=>A.format(m,e),A._$name="NumberFormat";class ut extends j.mixin(ie){constructor(){super(...arguments);D(this,"hasNativeAccess",!0);D(this,"_content",null)}async writeText(t,i){const r=this,{_content:a}=r;if(i&&r.hasNativeAccess)try{await navigator.clipboard.writeText(t)}catch(n){r.hasNativeAccess=!1}a!==t&&(r._content=t,r.triggerContentChange(a,!1,!0))}async readText(t){const i=this,{_content:r}=i;if(t&&i.hasNativeAccess)try{const a=await navigator.clipboard.readText();return r!==a&&(i._content=a,i.triggerContentChange(r,!0)),a}catch(a){i.hasNativeAccess=!1}return r}triggerPaste(t){this.trigger("paste",{source:t,text:this._content})}triggerContentChange(t,i=!1,r=!1){this.trigger("contentChange",{fromRead:i,fromWrite:r,oldText:t,newText:this._content})}async clear(t){await this.writeText("",t)}}var ct=m=>{var e;return e=class extends(m||j){construct(...i){super.construct(...i),globalThis.bryntum.clipboard||(globalThis.bryntum.clipboard=new ut),globalThis.bryntum.clipboard.ion({paste:"onClipboardPaste",contentChange:"onClipboardContentChange",thisObj:this})}get clipboard(){return globalThis.bryntum.clipboard}onClipboardPaste({text:i,source:r}){const a=this,{clipboardText:n,isCut:s}=a,l=a.compareClipboardText(n,i);if(l&&s){var o;(o=a.handleCutData)===null||o===void 0||o.call(a,{text:i,source:r}),a.isCut=!1,a.cutData=null}else l||a.clearClipboard(!1)}onClipboardContentChange({newText:i}){this.compareClipboardText(this.clipboardText,i)||this.clearClipboard(!1)}set cutData(i){var r,a;const n=this;(r=n._cutData)===null||r===void 0||r.forEach(s=>n.setIsCut(s,!1)),n._cutData=V.asArray(i),(a=n._cutData)===null||a===void 0||a.forEach(s=>n.setIsCut(s,!0))}get cutData(){return this._cutData}setIsCut(){}async writeToClipboard(i,r,a={}){if(await this.beforeCopy({data:i,isCut:r,...a})===!1)return;const n=this,s=typeof i=="string",l=s?i:n.stringConverter?n.stringConverter(i):ae.safeJsonStringify(i);return n.clipboardText=l,await n.clipboard.writeText(l,n.useNativeClipboard),n.clipboardData=i,n.isCut=r,n.cutData=r&&!s?i:null,l}async readFromClipboard(i={},r=!1){var a;const n=this,{clipboard:s}=n,l=await s.readText(n.useNativeClipboard),{isOwn:o,data:c}=n.transformClipboardText(l),h=l&&o&&n.isCut;if(!(c==null||Array.isArray(c)&&c.length==0||await((a=n.beforePaste)===null||a===void 0?void 0:a.call(n,{data:c,text:l,...i,isCut:h}))===!1))return o||n.clearClipboard(!1),r||s.triggerPaste(n),c}async clearClipboard(i=!0){const r=this;r.clipboardData=r.clipboardText=r.cutData=null,r.isCut=!1,i&&await r.clipboard.clear(r.useNativeClipboard)}compareClipboardText(i,r){const a=/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/g;return(i==null?void 0:i.replace(a,`
`))===(r==null?void 0:r.replace(a,`
`))}transformClipboardText(i){const r=this,a=r.compareClipboardText(r.clipboardText,i),n=a?r.clipboardData:r.stringParser&&i?r.stringParser(i):i;return{isOwn:a,data:n}}hasClipboardData(){const{clipboard:i}=this,{_content:r}=i;if(!(this.useNativeClipboard&&i.hasNativeAccess))return!!(r&&this.transformClipboardText(r).data)}},D(e,"$name","Clipboardable"),D(e,"configurable",{useNativeClipboard:!1}),e};const De=class extends ie(j){static get configurable(){return{date:{$config:{equal:"date"},value:u.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}changeDate(e){if(!this.isConfiguring){if(e=typeof e=="string"?u.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,t){const i=this,{dayColumnIndex:r,weekCount:a}=i,n=u.getFirstDateOfMonth(e),s=u.getLastDateOfMonth(n),l=r[n.getDay()],o=r[s.getDay()],c=!t||e.getFullYear()!==t.getFullYear(),h=!t||e.getMonth()!==t.getMonth(),p=i.eventListeners&&(t?e.getDate()!==t.getDate()|(i.getWeekId(e)!==i.getWeekId(t))<<1|h<<2|c<<3:15);if(i._year=e.getFullYear(),i._month=e.getMonth(),i.startDayOfMonth=1-l,i.endDayOfMonth=s.getDate()+(6-o),i.sixWeeks&&(i.endDayOfMonth+=(6-i.weekCount)*7),(!i.weekBase||c)&&i.calculateWeekBase(),(h||c)&&i.generation++,p){const g={newDate:e,oldDate:t,changes:{d:!0,w:!!(p&2),m:!!(p&12),y:!!(p&8),r:i.weekCount!==a}};i.trigger("dateChange",g),p&2&&i.trigger("weekChange",g),p&12&&i.trigger("monthChange",g),p&8&&i.trigger("yearChange",g)}}calculateWeekBase(){const e=this,{dayColumnIndex:t}=e,i=new Date(e.year,0,1),r=new Date(e.year,11,31),a=e.month?e.getOtherMonth(i):e;e.dayColumnIndex[i.getDay()]>3?e.weekBase=a.startDate:e.weekBase=new Date(e.year,0,a.startDayOfMonth-7);const n=Math.floor(u.diff(e.weekBase,r,"day")/7);e.has53weeks=n===53&&t[r.getDay()]>2}getWeekStart(e){if(typeof e=="number")return u.add(this.weekBase,Math.max(e,1)*7,"day");const t=this,[i,r]=e;return i===t.year?t.getWeekStart(r):t.getOtherMonth(new Date(i,0,1)).getWeekStart(r)}getOtherMonth(e){const t=this,i=t===Ye?new De(null):Ye;return i.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:new Date(e.getFullYear(),0,1)}),i.date=e,i.updateDate(i.date,i.date),i}changeYear(e){const t=new Date(this.date);t.setFullYear(e),this.date=t}changeMonth(e){const t=new Date(this.date);t.setMonth(e),this.date=t}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:u.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||u.nonWorkingDays}changeNonWorkingDays(e){return _.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date,this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.endDayOfMonth)}eachDay(e){for(let t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}eachWeek(e){const t=this,{weekCount:i}=t;for(let r=t.startDayOfMonth,a=0;a<i;a++){const n=[],s=t.getWeekNumber(new Date(t.year,t.month,r));for(let l=0;l<7;l++,r++)n.push(new Date(t.year,t.month,r));e(s,n)}}getWeekNumber(e){const t=this;if(e=u.clearTime(e),e.getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let i=Math.floor(u.diff(t.weekBase,e,"day")/7),r=e.getFullYear();if(i)i===53&&!t.has53weeks?(i=1,r++):i>53&&(i=i%52);else return t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0));return[r,i]}getWeekId(e){const t=this.getWeekNumber(e);return t[0]*100+t[1]}getCellData(e,t,i=je.MIDNIGHT){const r=this,a=e.getDay(),n=r.visibleDayColumnIndex[a],s=r.nonWorkingDays[a],l=r.hideNonWorkingDays&&s;return(e<r.startDate||e>r.endDate)&&(r.month=e.getMonth()),{day:a,dayTime:i,visibleColumnIndex:n,isNonWorking:s,week:r.getOtherMonth(e).getWeekNumber(e),key:u.format(e,"YYYY-MM-DD"),columnIndex:r.dayColumnIndex[a],date:new Date(e),dayEnd:i.duration("s"),tomorrow:i.dayOfDate(u.add(e,1,"day")),isOtherMonth:Math.sign(e.getMonth()+e.getFullYear()*12-(t.month+t.year*12)),visible:!l&&e>=t.startDate&&e<u.add(t.endDate,1,"day"),isRowStart:n===0,isRowEnd:n===r.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:t,nonWorkingDays:i,hideNonWorkingDays:r}=e,a=e.dayColumnIndex=[],n=e.canonicalDayNumbers=[],s=e.visibleDayColumnIndex=[];let l=0;for(let o=0;o<7;o++){const c=(t+o)%7;n[o]=c,a[c]=o,(!r||!i[c])&&(s[c]=l++)}e.visibleColumnCount=l,e.weekLength=r?7-_.keys(i).length:7}};let z=De;D(z,"$name","Month");const Ye=new z(null);z._$name="Month";const Ce=class extends ce.mixin(Ke){onChildAdd(e){super.onChildAdd(e),e.ion({click:"resetValueCache",toggle:"onItemToggle",thisObj:this,prio:1e4})}onChildRemove(e){e.un({toggle:"resetValueCache",click:"resetValueCache",thisObj:this}),super.onChildRemove(e)}onItemToggle(e){const t=this;t.resetValueCache(),!t.isSettingValue&&(!t.toggleGroup||e.pressed)&&t.triggerFieldChange({value:t.value,userAction:!0,event:e})}resetValueCache(){this._value=null}createWidget(e){const t=this;return t.constructor.resolveType(e.type||"button").isButton&&(t.color&&!e.color&&(e.color=t.color),t.toggleGroup&&!e.toggleGroup&&(typeof t.toggleGroup=="boolean"&&(t.toggleGroup=Ce.generateId("toggleGroup")),e.toggleGroup=t.toggleGroup)),t.columns&&(e.width=`${100/t.columns}%`),e=super.createWidget(e),t.relayEvents(e,["click","action","toggle"]),e}updateRotate(e){this.eachWidget(t=>{t.rotate!==!1&&(t.rotate=e)})}get value(){if(!this._value){const e=[];this.items.forEach(t=>{t.pressed&&t.value!==void 0&&e.push(t.value)}),this._value=e.join(this.valueSeparator)}return this._value}set value(e){const t=this,i=t.value;Array.isArray(e)||(e==null?e=[]:typeof e=="string"?e=e.split(t.valueSeparator):e=[e]),t._value=e.join(t.valueSeparator),t.isSettingValue=!0,t.items.forEach(r=>{r.value!==void 0&&(r.pressed=e.includes(r.value))}),t.isSettingValue=!1,!t.isConfiguring&&i!==t.value&&t.triggerFieldChange({value:t.value,userAction:!1})}updateDisabled(e){this.items.forEach(t=>t.disabled=e||!t.ignoreParentReadOnly&&this.readOnly)}updateReadOnly(e){super.updateReadOnly(e),this.updateDisabled(this.disabled)}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}};let X=Ce;D(X,"$name","ButtonGroup"),D(X,"type","buttongroup"),D(X,"configurable",{defaultType:"button",cls:null,items:null,color:null,toggleGroup:null,valueSeparator:",",columns:null,hideWhenEmpty:!0,defaultBindProperty:"value"}),X.initClass(),X._$name="ButtonGroup";class Z extends de{static get $name(){return"CalendarPanel"}static get type(){return"calendarpanel"}static get configurable(){return{layout:"vbox",textContent:!1,date:{$config:{equal:"date"},value:null},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekNumber:null,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onPaint({firstPaint:e}){var t;(t=super.onPaint)===null||t===void 0||t.call(this,...arguments),e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var e;(e=this.tip)===null||e===void 0||e.destroy(),super.doDestroy()}changeMinRowHeight(e){const t=parseInt(d.getStyleValue(this.element,"--min-row-height"),10)||75;return isNaN(e)?e:Math.max(parseInt(e)||0,t)}updateMinRowHeight(e){this.weekElements.forEach(t=>d.setLength(t,"minHeight",e)),this.scrollable={overflowY:e?"auto":!1}}changeMinColumnWidth(e){const t=parseInt(d.getStyleValue(this.element,"--min-column-width"),10)||75;return e==null?e:Math.max(parseInt(e)||0,t)}updateMinColumnWidth(e){const t=this;t.weekdayCells.forEach(i=>d.setLength(i,"minWidth",e)),t.cellElements.forEach(i=>i.matches(`.${t.dayCellCls}`)&&d.setLength(i,"minWidth",e)),t.scrollable={overflowX:e?"auto":!1},t.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromDomEvent(e){const t=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest(`#${this.id} [data-date]`);if(t)return u.parseKey(t.dataset.date)}changeTip(e,t){const i=this;return qe.reconfigure(t,e,{owner:i,defaults:{type:"tooltip",owner:i,id:`${i.id}-cell-tip`,forElement:i.bodyElement,forSelector:`.${i.dayCellCls}`}})}updateTip(e){this.detachListeners("tip"),e==null||e.ion({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(e,t){const i=this;super.updateElement(e,t),i.updateHideNonWorkingDays(i.hideNonWorkingDays),i.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),i.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),i.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),i.cellElements=[];for(let r=0,{length:a}=i.weekDayElements;r<a;r++)i.cellElements.push(i.weekDayElements[r].previousSibling,...i.weekDayElements[r].children)}changeDate(e){if(e=typeof e=="string"?u.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return u.clearTime(e)}updateDate(e){this.month.date=e}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let t=4;t<11;t++)e.setDate(t),this.shortDayNames.push(u.format(e,this.dayNameFormat))}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:u.weekStartDay}updateWeekStartDay(e){const t=this;if(t._month){t.month.weekStartDay=e,t.dayNames=[];for(let i=0;i<7;i++)t.dayNames[i]=t.shortDayNames[t.canonicalDayNumbers[i]];t.refreshCount&&t.refresh()}}updateHideNonWorkingDays(e){var t;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,!!e),(t=this.scrollable)===null||t===void 0||t.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e),this.isConfiguring||this.refresh()}updateHideOtherMonthCells(e){var t;this.element.classList.toggle(this.hideOtherMonthCellsCls,!!e),(t=this.scrollable)===null||t===void 0||t.syncOverflowState()}updateDisableOtherMonthCells(e){var t;this.element.classList.toggle(this.disableOtherMonthCellsCls,!!e),(t=this.scrollable)===null||t===void 0||t.syncOverflowState()}get nonWorkingDays(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=u.nonWorkingDays)}get weekends(){return this._localeWeekends||(this._localeWeekends=u.weekends)}changeNonWorkingDays(e){return _.assign({},e)}updateNonWorkingDays(e){if(this._month){var t;this.month.nonWorkingDays=e,this.refresh(),(t=this.scrollable)===null||t===void 0||t.syncOverflowState()}}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return u.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return u.add(e,1,"day")}changeMonth(e,t){const i=this;if(!(e instanceof z)){if(typeof e=="number"){if(t){t.month=e;return}const r=i.date||u.clearTime(new Date);r.setMonth(e),e={date:r}}e=z.new({weekStartDay:i.weekStartDay,nonWorkingDays:i.nonWorkingDays,hideNonWorkingDays:i.hideNonWorkingDays,sixWeeks:i.sixWeeks},e)}return e.ion({dateChange:"onMonthDateChange",thisObj:i}),e}onMonthDateChange({source:e,newDate:t,oldDate:i,changes:r}){const a=this;if(a.year=e.year,!a.isConfiguring){if(!a.getCell(t)||r.m||r.y){const{isVisible:n}=a;a.refresh(),a.animateTimeShift&&n&&d.slideIn(a.contentElement,t>i?1:-1)}a.trigger("dateChange",{changes:r,value:t,oldValue:i})}}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-column"),t.floating&&(t.isAligning||t.realign())}updateSixWeeks(e){this.month&&(this.month.sixWeeks=e,this.refresh())}refresh(){this.doRefresh()}doRefresh(){var e;this.getConfig("element");const t=this,i=t.timeZone!=null?t.timeZone:(e=t.project)===null||e===void 0?void 0:e.timeZone,r=i!=null?Ge.toTimeZone(new Date,i):new Date,{weekElements:a,weekDayElements:n,date:s,month:l,dayCellCls:o,dayHeaderCls:c,disabledCls:h,otherMonthCls:p,weekendCls:g,todayCls:v,nonWorkingDayCls:b,nonWorkingDays:y,canonicalDayNumbers:T,sixWeeks:x}=t;if(r.setHours(0,0,0,0),!s){t.date=r;return}t.trigger("beforeRefresh"),t.getConfig("dayNameFormat");for(let C=0;C<7;C++){const Y=t.weekdayCells[C],S=t.canonicalDayNumbers[C],F={[c]:1,[g]:u.weekends[S],[b]:y[S]};t.headerRenderer?(Y.innerHTML="",t.callback(t.headerRenderer,t,[Y,C,S])):d.setInnerText(Y,t.shortDayNames[S]),d.syncClassList(Y,F),Y.dataset.columnIndex=C,Y.dataset.cellDay=S}let M=0,w=0,O=6;for(let C=6;C>=0;C--)if(!y[T[C]]){O=C;break}a[4].classList.toggle("b-hide-display",l.weekCount<5&&!x),a[5].classList.toggle("b-hide-display",l.weekCount<6&&!x),l.eachWeek((C,Y)=>{const S=n[M],F=[S.previousSibling,...S.children];a[M].dataset.week=`${C[0]},${C[1]}`,t.weekRenderer?t.callback(t.weekRenderer,t,[F[0],C]):F[0].innerText=C[1];for(let N=0;N<7;N++){const R=Y[N],ee=R.getDay(),xe=u.makeKey(R),$e=y[ee],I=F[N+1],He={[o]:1,[h]:t.isDisabledDate(R),[p]:R.getMonth()!==l.month,[g]:u.weekends[ee],[v]:R.getTime()===r.getTime(),[b]:$e,"b-last-working-day":N===O,"b-first-visible-cell":!(R-(t.firstVisibleDate||-1)),"b-last-visible-cell":!(R-(t.lastVisibleDate||-1)),[`b-day-of-week-${ee}`]:1};d.syncClassList(I,He),I.dataset.date=xe,I.dataset.cellIndex=w,I.dataset.columnIndex=N,I.lastDomConfig&&(delete I.lastDomConfig.class,delete I.lastDomConfig.className),t.cellRenderer?t.callback(t.cellRenderer,t,[{cell:I,date:R,day:ee,row:a[M],rowIndex:M,cellIndex:w,columnIndex:N,visibleColumnIndex:t.visibleDayColumnIndex[ee],week:C,key:xe}]):I.innerHTML=R.getDate(),w++}M++}),t.visibleWeekCount=M,t.floating&&(t.isAligning||t.realign()),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}isDisabledDate(e){const t=e.getDay(),{disabledDates:i,nonWorkingDays:r}=this;if(this.disableWeekends&&r[t])return!0;if(i)return Array.isArray(i)?(e=u.clearTime(e,!0),i.some(a=>!(u.clearTime(a,!0)-e))):this.callback(this.disabledDates,this,[e])}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...V.fill(7,{class:this.dayHeaderCls}),d.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:t}];for(let i=0;i<6;i++){const r={className:"b-calendar-row b-calendar-week",dataset:{rowIndex:i},children:[{className:"b-week-number-cell"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};t.push(r)}return e}get firstVisibleDate(){if(this.hideOtherMonthCells){const{year:e,month:t}=this.month;return new Date(e,t,1)}for(const e=this,t=e.month.startDate;;t.setDate(t.getDate()+1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[t.getDay()])return t}get lastVisibleDate(){const e=u.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return e;for(const t=this,i=e;;i.setDate(i.getDate()-1))if(!t.hideNonWorkingDays||!t.nonWorkingDays[i.getDay()])return i}getCell(e,t){typeof e!="string"&&(e=u.makeKey(e));const i=this.weeksElement.querySelector(`[data-date="${e}"]`);if(i&&(!t||!i.classList.contains(this.otherMonthCls)))return i}onTipOverCell({source:e,target:t}){e.date=u.parseKey(t.dataset.date)}updateLocalization(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}}Z.initClass(),Z._$name="CalendarPanel";class B extends de{construct(e){super.construct({year:new Date().getFullYear(),...e}),k.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}get focusElement(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}getYearButton(e){return this.contentElement.querySelector(`.b-yearpicker-year[data-year="${e}"]`)}get value(){return this.year}set value(e){this.year=e}onYearClick({target:e}){const t=Math.min(Math.max(parseInt(e.innerText),this.minYear||1),this.maxYear||9999);this.year===t?this.trigger("select",{oldValue:t,value:t}):this.year=t}handleTitleClick(e){this.trigger("titleClick",e)}previous(){this.startYear=this.startYear-this.yearButtonCount}next(){this.startYear=this.endYear+1}ingestYear(e){if(!isNaN(e))return _.isDate(e)?e.getFullYear():e}changeYear(e){if(e=this.ingestYear(e))return Math.min(Math.max(e,this.minYear||1),this.maxYear||9999)}updateYear(e,t){const i=this;!i.startYear||e>i.endYear?i.startYear=e:e<i.startYear&&(i.startYear=e-(i.yearButtonCount-1)),i.isConfiguring||i.trigger("select",{oldValue:t,value:e})}get endYear(){return this.startYear+this.yearButtonCount-1}changeStartYear(e){if(e=this.ingestYear(e))return e=this.minYear?Math.max(e,this.minYear):e,this.maxYear?Math.min(e,this.maxYear-(this.yearButtonCount-1)):e}async updateStartYear(e,t){this.isVisible&&d.slideIn(this.contentElement,Math.sign(e-t))}composeBody(){this.getConfig("year");const{startYear:e}=this,t=super.composeBody(),i=t.children[this.tbar?1:0].children=[];this.widgetMap.title.text=`${`000${e}`.slice(-4)} - ${`000${this.endYear}`.slice(-4)}`;for(let r=0,a=e;r<this.yearButtonCount;r++,a++)i.push({tag:"button",dataset:{year:a},class:{"b-yearpicker-year":1,"b-selected":a===this.year},text:`000${a}`.slice(-4)});return t}}D(B,"$name","YearPicker"),D(B,"type","yearpicker"),D(B,"configurable",{textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"b-icon b-icon-previous",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"b-icon b-icon-next",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null}),B.initClass(),B._$name="YearPicker";class me extends Te{static get $name(){return"DisplayField"}static get type(){return"displayfield"}static get alias(){return"display"}static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",id:`${this.id}-input`,reference:"displayElement",html:this.template?this.template(this.value):ae.encodeHtml(this.value)}}}me.initClass(),me._$name="DisplayField";const Fe=()=>u.getMonthNames().map((m,e)=>[e,m]),_e=(m,e)=>m.valueOf()-e.valueOf(),dt=Object.freeze([]);class ht extends Ze{static get $name(){return"ReadOnlyCombo"}static get type(){return"readonlycombo"}static get configurable(){return{editable:!1,inputAttributes:{tag:"div",tabIndex:-1},inputValueAttr:"innerHTML",highlightExternalChange:!1,monitorResize:!1,triggers:{expand:!1},picker:{align:{align:"t-b",axisLock:!0,matchSize:!1},cls:"b-readonly-combo-list",scrollable:{overflowX:!1}}}}}ht.initClass();class oe extends Z{static get $name(){return"DatePicker"}static get type(){return"datepicker"}static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{value:new Date,$config:{equal:"date"}},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"b-icon b-icon-first",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}"},prevMonth:{cls:"b-icon b-icon-previous",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}"},fields:{type:"container",cls:"b-datepicker-title",items:{monthField:{type:"readonlycombo",cls:"b-datepicker-monthfield",items:Fe(),internalListeners:{select:"up.onMonthPicked"}},yearButton:{type:"button",cls:"b-datepicker-yearbutton",internalListeners:{click:"up.onYearPickerRequested"}}}},nextMonth:{cls:"b-icon b-icon-next",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}"},nextYear:{cls:"b-icon b-icon-last",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}"}}},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{value:null,$config:{equal:"date"}},maxDate:{value:null,$config:{equal:"date"}},focusDisabledDates:null,multiSelect:!1,selection:{$config:{equal:(e,t)=>e&&e.equals(t)},value:null},editMonth:!0,dayNameFormat:"dd",trapFocus:!0,role:"grid",focusDescendant:!0,alwaysRefreshOnMonthChange:null}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}construct(e){const t=this;super.construct(e),t.externalCellRenderer=t.cellRenderer,t.cellRenderer=t.internalCellRenderer,t.element.setAttribute("aria-activedescendant",`${t.id}-active-day`),t.weeksElement.setAttribute("role","grid"),t.weekElements.forEach(i=>i.setAttribute("role","row")),t.element.setAttribute("ariaLabelledBy",t.widgetMap.fields.id),k.on({element:t.weeksElement,click:{handler:"onCellClick",delegate:`.${t.dayCellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`},mousedown:{handler:"onCellMousedown",delegate:`.${t.dayCellCls}`},thisObj:t}),t.widgetMap.monthField.readOnly=t.widgetMap.yearButton.disabled=!t.editMonth,t.refresh.flush()}afterHide(){var e;(e=this._yearPicker)===null||e===void 0||e.hide(),super.afterHide(...arguments)}doDestroy(){var e,t;(e=this.yearButton)===null||e===void 0||e.destroy(),(t=this.monthField)===null||t===void 0||t.destroy(),super.doDestroy()}get focusElement(){return this.weeksElement.querySelector(`.${this.dayCellCls}[tabIndex="0"]`)}doRefresh(){const e=this,t=e.focusElement,i=u.betweenLesser(e.activeDate,e.month.startDate,e.month.endDate)?e.activeDate:e._activeDate=e.date;super.doRefresh(...arguments);const r=u.parseKey(t==null?void 0:t.dataset.date);i-r&&e.syncActiveDate(i,r)}internalCellRenderer({cell:e,date:t}){const i=this,{activeCls:r,selectedCls:a,externalCellRenderer:n}=i,s=i.isSelectedDate(t),l={[r]:r&&i.isActiveDate(t),[a]:s,[i.outOfRangeCls]:i.minDate&&t<i.minDate||i.maxDate&&t>i.maxDate};if(s&&i.multiSelect){const o=!i.isSelectedDate(u.add(t,-1,"d")),c=!i.isSelectedDate(u.add(t,1,"d"));l["b-range-start"]=o,l["b-range-end"]=c,l["b-in-range"]=!o&&!c}d.updateClassList(e,l),e.innerHTML=`<div class="b-datepicker-cell-inner">${t.getDate()}</div>`,e.setAttribute("role","gridcell"),e.setAttribute("aria-label",u.format(t,"MMMM D, YYYY")),i.isActiveDate(t)?e.id=`${i.id}-active-day`:e.removeAttribute("id"),n&&(arguments[0].cell=e.firstChild,i.callback(n,this,arguments))}onCellMousedown(e){const t=e.target.closest("[data-date]");e.preventDefault(),t.focus(),this.activeDate=u.parseKey(t.dataset.date)}onCellClick(e){const t=e.target.closest("[data-date]");this.onUIDateSelect(u.parseKey(t.dataset.date),e)}onMonthDateChange({newDate:e,changes:t}){this.getConfig("tbar"),super.onMonthDateChange(...arguments),(t.m||t.y)&&(this.widgetMap.monthField.value=e.getMonth(),this.widgetMap.yearButton.text=e.getFullYear())}onUIDateSelect(e,t){const i=this,{lastClickedDate:r,multiSelect:a}=i;i.lastClickedDate=e,i.isDisabledDate(e)||(i.activatingEvent=t,a?i.handleMultiSelect(r,e,t):(i.selection=e,i.floating&&i.hide()),i.activatingEvent=null)}handleMultiSelect(e,t,i){const r=this,{multiSelect:a}=r,n=r._selection||(r._selection=new Q),s=n.dates,l=a==="range",{size:o,generation:c}=n,h=o&&{[u.makeKey(u.add(s[0],-1,"d"))]:1,[u.makeKey(s[0])]:1,[u.makeKey(s[s.length-1])]:1,[u.makeKey(u.add(s[s.length-1],1,"d"))]:1},p=n.has(t),g=p?"delete":"add",v=l&&(h==null?void 0:h[u.makeKey(t)]);if(i.ctrlKey)(a===!0||!o||v)&&(n[g](t),l&&!n.has(r.rangeStartDate)&&r.rangeStartDate.setDate(r.rangeStartDate.getDate()+(t<s[1]?1:-1)));else if(i.shiftKey&&o){const[y,T]=[new Date(l?r.rangeStartDate||(r.rangeStartDate=s[0]):e),t].sort(_e);l&&n.clear();for(const x=y;x<=T;x.setDate(x.getDate()+1))n.add(x)}else n.has(t)&&n.size===1||(n.clear(),n.add(t));const b=n.size;b===1?r.rangeStartDate=t:b||(r.rangeStartDate=null),n.generation!==c&&r.updateSelection(n)}changeSelection(e){const t=this;let i,r;if(e)if(e.forEach||(e=[e]),e.forEach((a,n)=>e[n]=t.changeDate(a)),r=e[0],e.sort(_e),t.multiSelect==="range"&&e.length===2){i=new Q;for(const a=new Date(e[0]);a<=e[1];a.setDate(a.getDate()+1))i.add(a)}else r=e[0],i=new Q(e);else i=new Q;return r&&(t.activeDate=t.rangeStartDate=u.clearTime(r)),i}updateMultiSelect(e){this.element.classList.toggle("b-multiselect",!!e),e||(this.selection=[...this.selection][0])}updateSelection(e){const t=this,{dates:i}=e,r=t.multiSelect==="range"?[i[0],i[i.length-1]]:i;i.length&&(t.date=i[0]),t.isConfiguring||(t.refresh.now(),t.trigger("selectionChange",{selection:r,userAction:!!t.activatingEvent}))}get selection(){const{_selection:e}=this,t=e?e.dates:dt;return this.multiSelect==="range"&&t.length?[t[0],t[t.length-1]]:t}onInternalKeyDown(e){const t=this,i=e.key.trim()||e.code,r=t.activeDate;let a=new Date(r);if(i==="Escape"&&t.floating)return t.hide();if(r&&t.weeksElement.contains(e.target)){do switch(i){case"ArrowLeft":e.preventDefault(),e.ctrlKey?a=t.gotoPrevMonth():a.setDate(a.getDate()-1);break;case"ArrowUp":e.preventDefault(),a.setDate(a.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?a=t.gotoNextMonth():a.setDate(a.getDate()+1);break;case"ArrowDown":e.preventDefault(),a.setDate(a.getDate()+7);break;case"Enter":return t.onUIDateSelect(r,e)}while(t.isDisabledDate(a)&&!t.focusDisabledDates);if(t.minDate&&a<t.minDate||t.maxDate&&a>t.maxDate)return;t.activeDate=a}}changeMinDate(e){return e&&Z.prototype.changeDate.apply(this,arguments)}updateMinDate(e){this._yearpicker&&(this._yearpicker.minYear=e==null?void 0:e.getFullYear()),this.refresh()}changeMaxDate(e){return e&&Z.prototype.changeDate.apply(this,arguments)}updateMaxDate(e){this._yearpicker&&(this._yearpicker.maxYear=e==null?void 0:e.getFullYear()),this.refresh()}changeDate(e){return u.clamp(super.changeDate(e),this.minDate,this.maxDate)}updateDate(e){const t=this;t.isConfiguring&&!t.initializingActiveDate&&(t.selection=e),(!t.month.date||e.getMonth()===t.month.month||!t.getCell(e)||t.alwaysRefreshOnMonthChange||t.isNavigating)&&super.updateDate(e)}changeActiveDate(e,t){if(this.trigger("beforeActiveDateChange",{activeDate:e,oldActiveDate:t})!==!1){if(e=e?this.changeDate(e):this.date||(this.date=u.clearTime(new Date)),isNaN(e))throw new Error("DatePicker date ingestion must be passed a Date, or a YYYY-MM-DD date string");return u.clamp(e,this.minDate,this.maxDate)}}updateActiveDate(e,t){const i=this,{isConfiguring:r}=i;(r||!i.getCell(e))&&(i.initializingActiveDate=r,i.date=e,i.initializingActiveDate=!1),!r&&!i.refresh.isPending&&i.syncActiveDate(e,t)}syncActiveDate(e,t){const i=this,{activeCls:r}=i,a=i.getCell(e),n=t&&i.getCell(t),s=d.getActiveElement(i.element);a.setAttribute("tabIndex",0),r&&a.classList.add(r),a.id=`${i.id}-active-day`,i.weeksElement.contains(s)&&a.focus(),n&&n!==a&&(n.removeAttribute("tabIndex"),r&&n.classList.remove(r),n.removeAttribute("id"))}set value(e){const t=this,{selection:i,duration:r}=t;if(e){if(e=t.changeDate(e,t.value),t.multiSelect==="range"&&(i==null?void 0:i.length)===2){u.betweenLesserEqual(e,...i)||(e<i[0]?t.selection=[e,u.add(e,r-1,"d")]:t.selection=[u.add(e,-(r-1),"d"),e]),t.date=t.activeDate=e;return}e!==void 0&&(t.selection=e)}else t.date=new Date,t.selection=null}get value(){return this.selection[this.selection.length-1]}get duration(){return this.multiSelect==="range"?u.diff(...this.selection,"d")+1:1}gotoPrevYear(){return this.goto(-1,"year")}gotoPrevMonth(){return this.goto(-1,"month")}gotoNextMonth(){return this.goto(1,"month")}gotoNextYear(){return this.goto(1,"year")}goto(e,t){const i=this,{activeDate:r}=i,a=r&&i.getCell(r);let n;t==="month"&&a&&(r==null?void 0:r.getMonth())===i.month.month+e?n=r:n=u.add(a?r:i.date,e,t);const s=new Date(n);s.setDate(1);const l=u.add(u.add(s,1,"month"),-1,"day");if(i.minDate&&e<0&&l<i.minDate||i.maxDate&&e>0&&s>i.maxDate)return;i.isNavigating=!0;const o=i.date=n;return a&&(i.activeDate=n),i.isNavigating=!1,o}isActiveDate(e){return!(e-this.activeDate)}isSelectedDate(e){var t;return(t=this._selection)===null||t===void 0?void 0:t.has(e)}onMonthPicked({record:e,userAction:t}){if(t){var i;this.activeDate=u.add(this.activeDate,e.value-this.activeDate.getMonth(),"month"),(i=this.focusElement)===null||i===void 0||i.focus()}}onYearPickerRequested(){const{yearPicker:e}=this;e.isVisible?e.hide():(e.year=e.startYear=this.activeDate.getFullYear(),e.show(),e.focus())}onYearPickerTitleClick(){this.yearPicker.hide()}onYearPicked({value:e,source:t}){const i=new Date(this.activeDate);i.setFullYear(e),this.activeDate=i,this.focusElement&&d.focusWithoutScrolling(this.focusElement),t.hide()}changeYearPicker(e,t){var i,r;return B.reconfigure(t,e?B.mergeConfigs({owner:this,appendTo:this.element,minYear:(i=this.minDate)===null||i===void 0?void 0:i.getFullYear(),maxYear:(r=this.maxDate)===null||r===void 0?void 0:r.getFullYear()},e):null,this)}get childItems(){const{_yearPicker:e}=this,t=super.childItems;return e&&t.push(e),t}updateLocalization(){const{monthField:e}=this.widgetMap,t=Fe();!this.isConfiguring&&!t.every((i,r)=>i[1]===e.store.getAt(r).text)&&(t[e.value].selected=!0,e.items=t),super.updateLocalization()}}class Q extends Set{add(e){return e=u.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.add(e)}delete(e){return e=u.makeKey(e),this.has(e)&&this.generation++,super.delete(e)}has(e){return super.has(u.makeKey(e))}clear(){return this.size&&this.generation++,super.clear()}equals(e){return Array.isArray(e)&&(e=new Q(e)),e.size===this.size&&[...this].every(t=>e.has(t))}get dates(){return[...this].sort().map(e=>u.parseKey(e))}}oe.initClass(),oe._$name="DatePicker";class pe extends Me{static get $name(){return"DateField"}static get type(){return"datefield"}static get alias(){return"date"}static get configurable(){return{format:"L",strictParsing:!1,fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:null,weekStartDay:null,picker:{type:"datepicker",role:"dialog",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null}}changePicker(e,t){const i=this,r={owner:i,forElement:i[i.pickerAlignElement],minDate:i.min,maxDate:i.max,weekStartDay:i._weekStartDay,align:{anchor:i.overlayAnchor,target:i[i.pickerAlignElement]},onSelectionChange:({selection:n,source:s})=>{s.isVisible&&(i._isUserAction=i._isPickerInput=!0,i.value=n[0],i._isPickerInput=i._isUserAction=!1,s.hide())}};i.calendarContainerCls&&(r.cls=i.calendarContainerCls),i.value?r.value=i.value:r.activeDate=new Date;const a=oe.reconfigure(t,e,{owner:i,defaults:r});return a==null||a.refresh.flush(),a}get backShiftDate(){return u.add(this.value,-1*this._step.magnitude,this._step.unit)}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const i=e.backShiftDate;(!t||t.getTime()<=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}get forwardShiftDate(){return u.add(this.value,this._step.magnitude,this._step.unit)}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const i=e.forwardShiftDate;(!t||t.getTime()>=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}showPicker(e){if(this.readOnly)return;const t=this,{_picker:i}=t;if(i){const r={minDate:t.min,maxDate:t.max};t.value?r.value=t.value:i.activeDate||(r.activeDate=new Date),i.setConfig(r)}super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){const{min:i,max:r,validateDateOnly:a}=e;if(a&&(t=u.clearTime(t,!1)),i&&t<i)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(r&&t>r)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e){const t=this;return e!=null&&(u.isDate(e)||(typeof e=="string"?e=u.parse(e,t.format,t.strictParsing)||u.parse(e,t.fallbackFormat,t.strictParsing):e=new Date(e)),u.isValidDate(e))?(!t.min||e-t.min>-u.MS_PER_DAY)&&(!t.max||e<=t.max)?t.transformTimeValue(e):e:null}transformTimeValue(e){const t=this,{keepTime:i}=t;if(e=u.clone(e),!i)u.clearTime(e,!1);else if(i!=="entered"){const r=u.parse(i,t.timeFormat);u.isValidDate(r)?u.copyTimeValues(e,r):u.isValidDate(t.value)&&u.copyTimeValues(e,t.value)}else t._isPickerInput&&u.isValidDate(t.value)&&u.copyTimeValues(e,t.value);return e}changeMin(e){return this.transformDateValue(e)}updateMin(e){const{input:t,_picker:i}=this;t&&(e==null?t.removeAttribute("min"):t.min=e),i&&(i.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e)}updateMax(e){const{input:t,_picker:i}=this;t&&(e==null?t.removeAttribute("max"):t.max=e),i&&(i.maxDate=e),this.syncInvalid()}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:u.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,t){const i=this,r=i.transformDateValue(e);if(e&&!r){i.setError("L{invalidDate}");return}if(i.clearError("L{invalidDate}"),i.hasChanged(t,r))return super.changeValue(r,t);i.inputting||i.syncInputFieldValue()}updateValue(e,t){const i=this._picker;i&&!this.inputting&&(i.value=i.activeDate=e),super.updateValue(e,t)}changeStep(e,t){const i=typeof e;if(!e)return null;if(i==="number"?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:i==="string"&&(e=u.parseDuration(e)),e&&e.unit&&e.magnitude)return e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,t){return e!=null&&e.getTime&&t!==null&&t!==void 0&&t.getTime&&this.keepTime!=="entered"?!u.isEqual(u.clearTime(e),u.clearTime(t)):super.hasChanged(e&&e.getTime(),t&&t.getTime())}get inputValue(){const e=this.value;return e?u.format(e,this.format):""}updateFormat(){this.isConfiguring||this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){super.internalOnKeyEvent(e),e.key==="Enter"&&this.isValid&&this.picker.hide()}}pe.initClass(),pe._$name="DateField";const gt=m=>m.ctrlKey&&m.preventDefault();class ye extends Je{static get $name(){return"NumberField"}static get type(){return"numberfield"}static get alias(){return"number"}static get configurable(){return{min:null,max:null,step:1,largeStep:0,value:null,format:"",decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const t=this;t.input.addEventListener("dblclick",()=>{t.select()}),typeof t.changeOnSpin=="number"&&(t.bufferedSpinChange=t.buffer(t.triggerChange,t.changeOnSpin))}acceptValue(e,t){let i=!isNaN(e);if(i&&!this.hasTextSelection){i=!1;const r=this.input.value,a=parseFloat(r);r!==t&&(i=!this.acceptValue(a,r))}return i}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if(e.type==="keydown"){const t=this,i=e.key;let r;if(i==="ArrowUp")t.doSpinUp(e.shiftKey),r=!0;else if(i==="ArrowDown")t.doSpinDown(e.shiftKey),r=!0;else if(!e.altKey&&!e.ctrlKey&&i&&i.length===1){const a=t.getAfterValue(i),n=t.formatter.parseStrict(a);r=!(n===t.value||a==="-"&&(isNaN(t.min)||t.min<0))&&!t.acceptValue(n,a)}i==="Enter"&&t._changedBySilentSpin&&(t.triggerChange(e,!0),t._changedBySilentSpin=!1),r&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const t=this;if(t.readOnly)return;let i=(t.value||0)+(e?t.largeStep:t.step);t.okMin(i)||(i=t.min),t.okMax(i)&&t.applySpinChange(i)}doSpinDown(e=!1){const t=this;if(t.readOnly)return;let i=(t.value||0)-(e?t.largeStep:t.step);t.okMax(i)||(i=t.max),t.okMin(i)&&t.applySpinChange(i)}applySpinChange(e){const t=this;t._isUserAction=!0,t.changeOnSpin!==!0&&(t._changedBySilentSpin=!0,t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){var t,i,r;super.onFocusOut(...arguments);const a=this,{input:n}=a,s=n.value,l=a.formatter.truncate(s),o=isNaN(l)?s:a.formatValue(l);(t=a.triggers)===null||t===void 0||(i=t.spin)===null||i===void 0||(r=i.clickRepeater)===null||r===void 0||r.cancel(),a.lastTouchmove=null,s!==o&&(n.value=o),a._changedBySilentSpin&&(a.triggerChange(e,!0),a._changedBySilentSpin=!1)}internalOnInput(e){const t=this,{formatter:i,input:r}=t,{parser:a}=i,n=r.value,s=a.decimalPlaces(n);if(i.truncator&&s){let l=n;const o=i.truncate(n);if(!isNaN(o)&&(l=t.formatValue(o),a.decimalPlaces(l)<s)){const c=n.length-t.caretPos;r.value=l,t.caretPos=l.length-c}}super.internalOnInput(e)}formatValue(e){return this.formatter.format(e)}changeFormat(e){const t=this;if(e===""){const{leadingZeroes:i,decimalPrecision:r}=t;e=i?`${i}>9`:null,r!=null?e=`${e||""}9.${"#".repeat(r)}`:e&&(e+=".*")}return e}get formatter(){const e=this,t=e.format;let i=e._formatter;return(!i||e._lastFormat!==t)&&(i=A.get(e._lastFormat=t),e._formatter=i),i}updateStep(e){const t=this;if(t.element.classList.toggle("b-hide-spinner",!e),t._step=e,e&&re.isMobile)t.touchMoveListener||(t.touchMoveListener=k.on({element:t.input,touchmove:"onInputSwipe",thisObj:t,throttled:{buffer:150,alt:gt}}));else{var i;(i=t.touchMoveListener)===null||i===void 0||i.call(t)}}onInputSwipe(e){const{lastTouchmove:t}=this;if(t){const i=e.screenX-t.screenX,r=t.screenY-e.screenY,a=Math.abs(i)>Math.abs(r)?i:r;this[`doSpin${a>0?"Up":"Down"}`]()}e.preventDefault(),this.lastTouchmove=e}changeLargeStep(e){return e||this.step*10}get validity(){const e=this.value,t={};return e!=null&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}changeValue(e,t){const i=this;if(e||e===0){let r;typeof e!="number"&&(e=typeof e=="string"?i.formatter.parse(e):Number(e),r=isNaN(e),r&&(e="")),!r&&i.format&&(e=i.formatter.round(e))}else e=void 0;return super.changeValue(e,t)}get inputValue(){let e=this.value;return e!=null&&this.format&&(e=this.formatValue(e)),e}}ye.initClass(),ye._$name="NumberField";class q extends de{construct(e){super.construct(e),this.refresh()}updateSeconds(e){this.widgetMap.second[e?"show":"hide"]()}onFieldChange(){!this.isConfiguring&&!this.isRefreshing&&(this.value=this.pickerToTime())}onAmPmButtonClick({source:e}){this._pm=e.ref==="pmButton",this._value&&(this.value=this.pickerToTime())}onInternalKeyDown(e){var t;const i=this;switch(e.key){case"Escape":i.triggerTimeChange(i._initialValue),i.hide(),e.preventDefault();return;case"Enter":i.value=i.pickerToTime(),i.hide(),e.preventDefault();return}(t=super.onInternalKeyDown)===null||t===void 0||t.call(this,e)}pickerToTime(){const e=this,t=e._pm,{hour:i,minute:r,second:a}=e.widgetMap;i.format=e._is24Hour?"2>9":null;let n=i.value,s=new Date(e.value);return e._is24Hour||(t&&n<12&&(n=n+12),!t&&n===12&&(n=0)),s.setHours(n),s.setMinutes(r.value),e.seconds&&s.setSeconds(a.value),e._min&&(s=u.max(e._min,s)),e._max&&(s=u.min(e._max,s)),s}triggerTimeChange(e){this.trigger("timeChange",{time:e})}updateInitialValue(e){this.value=e}changeValue(e){return e&&(e=typeof e=="string"?u.parse(e,this.format):e),this.isVisible||(this._initialValue=e),e!=null?e:u.getTime(0)}updateValue(e){this.isVisible&&this.triggerTimeChange(e),this.refresh()}updateFormat(e){this._is24Hour=u.is24HourFormat(e),this.refresh()}changeMin(e){return typeof e=="string"?u.parse(e,this.format):e}changeMax(e){return typeof e=="string"?u.parse(e,this.format):e}refresh(){const e=this;if(!e.isConfiguring&&e.value){e.isRefreshing=!0;const{hour:t,minute:i,second:r,amButton:a,pmButton:n}=e.widgetMap,s=e.value,l=e._is24Hour,o=s.getHours(),c=e._pm=o>=12;e.element.classList[l?"add":"remove"]("b-24h"),t.min=l?0:1,t.max=l?23:12,t.value=l?o:o%12||12,i.value=s.getMinutes(),r.value=s.getSeconds(),a.pressed=!c,n.pressed=c,a.hidden=n.hidden=l,e.isRefreshing=!1}}}D(q,"$name","TimePicker"),D(q,"type","timepicker"),D(q,"configurable",{floating:!0,layout:"hbox",items:{hour:{label:"L{TimePicker.hour}",type:"number",min:0,max:23,highlightExternalChange:!1,format:"2>9"},minute:{label:"L{TimePicker.minute}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},second:{hidden:!0,label:"L{TimePicker.second}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},amPm:{type:"buttongroup",items:{amButton:{type:"button",text:"AM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"},pmButton:{type:"button",text:"PM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"}}}},autoShow:!1,trapFocus:!0,seconds:null,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,initialValue:null}),q.initClass(),q._$name="TimePicker";class be extends Me{static get $name(){return"TimeField"}static get type(){return"timefield"}static get alias(){return"time"}static get configurable(){return{picker:{type:"timepicker",align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",compose:()=>({children:[{class:{"b-icon-clock-live":1}}]})},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:null,value:null,keepDate:!1}}changePicker(e,t){const i=this;return q.reconfigure(t,e,{owner:i,defaults:{value:i.value,forElement:i[i.pickerAlignElement],owner:i,align:{anchor:i.overlayAnchor,target:i[i.pickerAlignElement]},onTimeChange({time:r}){i._isUserAction=!0,i.value=r,i._isUserAction=!1}}})}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const i=u.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const i=u.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,t){return e!=null&&e.getTime&&t!==null&&t!==void 0&&t.getTime?e.getHours()!==t.getHours()||e.getMinutes()!==t.getMinutes()||e.getSeconds()!==t.getSeconds()||e.getMilliseconds()!==t.getMilliseconds():super.hasChanged(e,t)}showPicker(){const e=this,{picker:t,value:i}=e;e.readOnly||(t.value=i,t.format=e.format,t.maxTime=e.max,t.minTime=e.min,i||(e.value=t.value),super.showPicker(!0))}onPickerShow(){var e;super.onPickerShow(),this.pickerKeyDownRemover=(e=this.pickerKeyDownRemover)===null||e===void 0?void 0:e.call(this)}focusPicker(){this.picker.focus()}transformTimeValue(e){return e!=null&&(typeof e=="string"?(e=u.parse(e,this.format),this.keepDate&&(e=u.copyTimeValues(new Date(this.value),e))):e=new Date(e),u.isValidDate(e))?this.keepDate?e:u.getTime(e):null}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:t}=this;t&&(e==null?t.removeAttribute("min"):t.min=e),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:t}=this;t&&(e==null?t.removeAttribute("max"):t.max=e),this.syncInvalid()}changeValue(e,t){const i=this,r=i.transformTimeValue(e);if(e&&!r||i.isRequired&&e===""){i.setError("L{invalidTime}");return}if(i.clearError("L{invalidTime}"),i.hasChanged(t,r))return super.changeValue(r,t);i.inputting||i.syncInputFieldValue(!0)}updateValue(e,t){const{expand:i}=this.triggers;i&&e&&(i.element.firstElementChild.style.animationDelay=-((e.getHours()*60+e.getMinutes())/10)+"s"),super.updateValue(e,t)}changeStep(e,t){var i,r;const a=typeof e;if(!e)return null;if(a==="number"?e={magnitude:Math.abs(e),unit:t?t.unit:"hour"}:a==="string"&&(e=u.parseDuration(e)),(i=e)!==null&&i!==void 0&&i.unit&&(r=e)!==null&&r!==void 0&&r.magnitude)return e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}updateFormat(){this.syncInputFieldValue(!0)}get inputValue(){return u.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}}be.initClass(),be._$name="TimeField";class te extends Te{static get $name(){return"DurationField"}static get type(){return"durationfield"}static get alias(){return"duration"}static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null}}changeMin(e){return typeof e=="string"?new K(e):e}changeMax(e){return typeof e=="string"?new K(e):e}changeAllowedUnits(e){return typeof e=="string"&&(e=e.split(",")),e}updateAllowedUnits(e){this.allowedUnitsRe=new RegExp(`(${e.join("|")})`,"i")}get inputValue(){return this.value==null?"":this.calcValue(!0).toString(this.useAbbreviation)}set unit(e){this._unit=e,this.value=this.calcValue()}get unit(){return this._unit}get unitWithDefault(){return this._unit||te.defaultConfig.defaultUnit}set magnitude(e){this.clearError("L{invalidUnit}"),this._magnitude=e,super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&this.decimalPrecision!=null?_.round(e,this.decimalPrecision):e}get allowDecimals(){return this.decimalPrecision!==0}get isValid(){const e=this,t=e.value==null||e.value&&e.value.magnitude==null;return super.isValid&&(t&&!e.required||!t&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const t=this,i=t.value,r=t._lastValue;t.hasChanged(r,i)&&(t._lastValue=i,t.triggerFieldChange({value:i,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){var t,i,r;return this.syncInputFieldValue(!0),(t=this.triggers)===null||t===void 0||(i=t.spin)===null||i===void 0||(r=i.clickRepeater)===null||r===void 0||r.cancel(),super.onFocusOut(e)}set value(e){const t=this;let i,r;if(this.clearError("L{invalidUnit}"),typeof e=="number")i=e,r=t._unit;else if(typeof e=="string")if(/^\s*$/.test(e))i=null;else{const a=u.parseDuration(e,t.allowDecimals,t.unitWithDefault);a&&(!t.allowedUnitsRe||t.allowedUnitsRe.test(a.unit)?(r=a.unit,i=a.magnitude):t.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(r=e.unit,i=e.magnitude):(r=null,i=null);(t._magnitude!==i||t._unit!=r)&&(t._magnitude=i,r&&(t._unit=r),super.value=t.calcValue())}okMax(e){return typeof e=="number"&&(e=new K({unit:this.unitWithDefault,magnitude:e})),this.max==null||e<=this.max}okMin(e){return typeof e=="number"&&(e=new K({unit:this.unitWithDefault,magnitude:e})),this.min==null||e>=this.min}get validity(){const e=this.value,t={};return e!=null&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}get value(){return super.value}calcValue(e=!1){const t=this;return(!t._unit||t._magnitude==null)&&t.clearable?null:new K(e?this.roundMagnitude(t._magnitude):this._magnitude,t.unitWithDefault)}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&!e.isEqual(t)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){e.key==="ArrowUp"?this.doSpinUp():e.key==="ArrowDown"&&this.doSpinDown()}doSpinUp(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)+e.step;e._isUserAction=!0,e.okMin(t)||(t=e.min),e.okMax(t)&&(e.value=t),e._isUserAction=!1}doSpinDown(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)-e.step;e.okMax(t)||(t=e.max),e.okMin(t)&&(e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}te.initClass(),te._$name="DurationField";const Ne=["number","boolean","string","date","duration"],Ae=m=>{var e;return((e=m.column)===null||e===void 0?void 0:e.type)==="duration"},Re="",Ie="fieldfilterpicker",P=`b-${Ie}`,ft={between:!0,notBetween:!0,isIncludedIn:!0,isNotIncludedIn:!0},mt={textfield:!0,datefield:!0,numberfield:!0,durationfield:!0,combo:!0},f=class extends ce{static get $name(){return"FieldFilterPicker"}static get type(){return Ie}static get defaultValueFieldPlaceholders(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}"}}afterConstruct(){const e=this;if(!e._fields)throw new Error(`${f.name} requires 'fields' to be configured.`);if(!e._filter)throw new Error(`${f.name} requires 'filter' to be configured.`);super.afterConstruct();const{widgetMap:{propertyPicker:t,operatorPicker:i,caseSensitive:r}}=e;t.ion({select:"onPropertySelect",thisObj:e}),i.ion({select:"onOperatorSelect",thisObj:e}),r.ion({change:"onCaseSensitiveChange",thisObj:e}),e.propertyFieldConfig&&t.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&i.setConfig(e.operatorFieldConfig),t.cls=e.allPropertyPickerClasses,i.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}changeDateFormat(e){return this.L(e)}get allChildInputs(){const{propertyPicker:e,operatorPicker:t,caseSensitive:i}=this.widgetMap;return[e,t,...this.valueFields,i]}updateDisabled(e){this.allChildInputs.forEach(t=>t.disabled=e)}updateReadOnly(e){const{propertyPicker:t,operatorPicker:i}=this.widgetMap;this.allChildInputs.forEach(r=>r.readOnly=e),t.readOnly=t.readOnly||e,i.readOnly=i.readOnly||e}updatePropertyLocked(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}updateOperatorLocked(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}changeOperators(e){const t=e!=null?e:f.defaultOperators;return Object.keys(t).reduce((i,r)=>({...i,[r]:t[r].map(a=>({...a,text:this.L(a.text)}))}),{})}changeFields(e){let t=e;return Array.isArray(e)&&(Qe.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption> keyed by field name instead"),t=V.keyBy(t,"name")),t}get isMultiSelectValueField(){var e;return["isIncludedIn","isNotIncludedIn"].includes((e=this._filter)===null||e===void 0?void 0:e.operator)}get allPropertyPickerClasses(){var e;return new he(`${P}-property`,(e=this.propertyFieldConfig)===null||e===void 0?void 0:e.cls,{[`${P}-combo-locked`]:this.propertyLocked})}get allOperatorPickerClasses(){var e;return new he(`${P}-operator`,(e=this.operatorFieldConfig)===null||e===void 0?void 0:e.cls,{[`${P}-combo-locked`]:this.operatorLocked})}getValueFieldConfigs(){const e=this,{valueFieldCls:t,fieldType:i,_filter:{operator:r},onValueChange:a,filterValues:n,isMultiSelectValueField:s,operatorArgCount:l,getValueFieldConfig:o}=e,c=_.merge({},f.defaultValueFieldPlaceholders,e.valueFieldPlaceholders);if(!i||!r||l===0)return[];let h={type:"textfield",internalListeners:{change:a,input:a,thisObj:e},cls:t,dataset:{type:i},placeholder:e.L(c[s?"list":i])};return s?h={...h,type:"combo",multiSelect:!0,createOnUnmatched:!0,items:this.getUniqueDataValues(n),value:n!=null?n:[]}:["number","date","boolean"].includes(i)?h.type=`${i}field`:i==="duration"&&(h.type="durationfield"),o&&(h=e.callback(o,e,[e.filter,h])),s?[h]:V.populate(l,p=>[{type:"widget",tag:"div",cls:`${P}-value-separator`,content:e.L("L{FieldFilterPicker.and}")},{...h,value:n[p]}]).flat().slice(1)}getUniqueDataValues(e=[]){var t;const i=this,{fieldType:r}=i;if(!i.store||!((t=i._filter)!==null&&t!==void 0&&t.property))return[];const{relatedDisplayField:a}=i.selectedField;let n,s;if(i.fieldIsRelation){const{foreignStore:l}=i.currentPropertyRelationConfig;a?(n=l.allRecords.reduce((o,c)=>(c.id!=null&&o.push({text:c.getValue(a),value:c.id}),o),[]),s=n.sort((o,c)=>i.sortStrings(o.text,c.text))):n=l.allRecords.map(o=>o.id)}else n=i.store.allRecords.map(l=>l.getValue(i._filter.property));if(!s){n.push(...e);const l=V.unique(n.reduce((o,c)=>(c!=null&&String(c).trim()!==""&&(r==="date"?o.push(c.valueOf()):r==="duration"?o.push(c.toString()):o.push(c)),o),[]));r==="string"?s=l.sort(i.sortStrings):r==="duration"?s=l.map(o=>new K(o)).filter(o=>o.isValid).sort(i.sortDurations):s=l.sort(i.sortNumerics),r==="date"?s=s.map(o=>{const c=new Date(o);return{text:u.format(c,i.dateFormat),value:o}}):r==="duration"&&(s=s.map(o=>o.toString()))}return s}sortStrings(e,t){return(e!=null?e:Re).localeCompare(t!=null?t:Re)}sortNumerics(e,t){return e-t}sortDurations(e,t){return e.valueOf()-t.valueOf()}get fieldType(){var e;return(e=this.selectedField)===null||e===void 0?void 0:e.type}get selectedField(){var e,t;return(e=this.fields)===null||e===void 0?void 0:e[(t=this._filter)===null||t===void 0?void 0:t.property]}get propertyOptions(){var e;return Object.entries((e=this.fields)!=null?e:{}).filter(([,t])=>Ne.includes(t.type)||Ae(t)).map(([t,{title:i}])=>({value:t,text:i!=null?i:t})).sort((t,i)=>t.text.localeCompare(i.text))}get operatorOptions(){return this.operators[this.fieldIsRelation?"relation":this.fieldType]}get fieldIsRelation(){return!!this.currentPropertyRelationConfig}get currentPropertyRelationConfig(){var e,t;return(e=this.store)===null||e===void 0||(t=e.modelRelations)===null||t===void 0?void 0:t.find(({foreignKey:i})=>{var r;return i===((r=this._filter)===null||r===void 0?void 0:r.property)})}updateOperators(){delete this._operatorArgCountLookup}get operatorArgCountLookup(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=f.buildOperatorArgCountLookup(this.operators))}updateFilter(){this._filter&&this.onFilterChange()}updateStore(e){var t;(t=this._store)===null||t===void 0||t.un(this),e==null||e.ion({refresh:"onStoreRefresh",thisObj:this})}onStoreRefresh({action:e}){this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(e)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}refreshValueFields(){const e=this,{valueFields:t}=e.widgetMap,{fieldType:i,operatorArgCount:r,_filter:{property:a,operator:n}}=e,s=ft[n],l=i==="string";t.element.className=new he(t.cls,{[`${P}-values-multiple`]:s,[`${P}-values-string`]:l,"b-hidden":a==null||n==null||r===0}),t.removeAll(),t.add(e.getValueFieldConfigs()),delete e._valueFields,e.refreshCaseSensitive()}refreshCaseSensitive(){var e,t;const i=this,{fieldType:r,operatorArgCount:a,isMultiSelectValueField:n}=i,s=(e=i._filter)===null||e===void 0?void 0:e.operator,{caseSensitive:l}=i.widgetMap;l.hidden=r!=="string"||!s||n||a===0,l.checked=((t=i._filter)===null||t===void 0?void 0:t.caseSensitive)!==!1}onPropertySelect(e){var t;const i=this,{_filter:r}=i;r.property=((t=e.record)===null||t===void 0?void 0:t.data.value)||null,i.fieldType!==i._fieldType&&(r.operator=null,r.value=null),i._fieldType=r.type=i.fieldType,i.refreshOperatorPicker(),i.refreshValueFields(),i.triggerChange()}onCaseSensitiveChange({checked:e}){this._filter.caseSensitive=e,this.triggerChange()}onOperatorSelect(e){var t;const i=this,r=i.isMultiSelectValueField,a=this.operatorArgCount;i._filter.operator=((t=e.record)===null||t===void 0?void 0:t.data.value)||null,i.operatorArgCount!==a&&(i._filter.value=null),i.isMultiSelectValueField&&!r&&(i._filter.value=[]),i.refreshValueFields(),i.triggerChange()}triggerChange(){const{filter:e,isValid:t}=this;this.trigger("change",{filter:e,isValid:t})}onValueChange(){const e=this,{isMultiSelectValueField:t,fieldType:i,_filter:r}=e,a=this.valueFields.map(n=>n.value);t&&i==="date"?r.value=a[0].map(n=>new Date(n)):t&&i==="duration"?r.value=a[0].map(n=>new K(n)):(i==="date"&&r.operator==="between"&&u.isValidDate(a[1])&&a[1].setHours(23,59,59,999),r.value=a.length===1?a[0]:a),e.triggerChange()}refreshOperatorPicker(){const{operatorPicker:e}=this.widgetMap,{_filter:{operator:t,property:i},operatorOptions:r}=this;e.items=r,e.value=t,e.hidden=i===null}populateUIFromFilter(e=!1){const t=this,{filterValues:i,widgetMap:{propertyPicker:r,operatorPicker:a},_filter:{property:n,operator:s,disabled:l},propertyOptions:o,operatorOptions:c,isMultiSelectValueField:h}=t;r.items=o,a.items=c,a.hidden=n===null;let p=e;r.value!==n&&(r.value=n,t.refreshOperatorPicker(),p=!0),a.value!==s&&(s===null||!a.items.find(({value:g})=>g===s)?a.clear():a.value=s,p=!0),p&&t.refreshValueFields(),t.refreshCaseSensitive(),t.valueFields.forEach((g,v)=>{h&&(g.value.length>0||i.length>0)?t.fieldType==="date"?g.value=i.map(b=>b==null?void 0:b.valueOf()):t.fieldType==="duration"?g.value=i.map(b=>b==null?void 0:b.toString()):g.value=i:v>=i.length?g.clear():g.value=i[v]}),t.allChildInputs.forEach(g=>g.disabled=t.disabled||l)}get valueFields(){return this._valueFields||(this._valueFields=this.widgetMap.valueFields.queryAll(e=>mt[e.type]))}get filterValues(){var e;return((e=this._filter)===null||e===void 0?void 0:e.value)==null?[]:V.asArray(this._filter.value)}onFilterChange(){const e=this,t=e.fieldType,i=t!==e._fieldType;e._fieldType=e._filter.type=t,e.populateUIFromFilter(i)}get operatorArgCount(){const{fieldType:e,filter:{operator:t},operatorArgCountLookup:i}=this;return e&&t?i[e][t]:1}get isValid(){const e=this,{filter:t,fieldType:i,filterValues:r,isMultiSelectValueField:a,operatorArgCount:n}=e,{operator:s}=t,l=n>0&&(t==null?void 0:t.value)==null;return i&&s&&!l&&(a&&r.length>0||r.length===n)&&r.every(o=>o!=null&&(i!=="duration"||o.isValid))}};let $=f;D($,"operators",{empty:{value:"empty",text:"L{isEmpty}",argCount:0},notEmpty:{value:"notEmpty",text:"L{isNotEmpty}",argCount:0},"=":{value:"=",text:"L{equals}"},"!=":{value:"!=",text:"L{doesNotEqual}"},">":{value:">",text:"L{isGreaterThan}"},"<":{value:"<",text:"L{isLessThan}"},">=":{value:">=",text:"L{isGreaterThanOrEqualTo}"},"<=":{value:"<=",text:"L{isLessThanOrEqualTo}"},between:{value:"between",text:"L{isBetween}",argCount:2},notBetween:{value:"notBetween",text:"L{isNotBetween}",argCount:2},isIncludedIn:{value:"isIncludedIn",text:"L{isOneOf}"},isNotIncludedIn:{value:"isNotIncludedIn",text:"L{isNotOneOf}"}}),D($,"defaultOperators",{string:[f.operators.empty,f.operators.notEmpty,f.operators["="],f.operators["!="],{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},f.operators.isIncludedIn,f.operators.isNotIncludedIn],number:[f.operators.empty,f.operators.notEmpty,f.operators["="],f.operators["!="],f.operators[">"],f.operators["<"],f.operators[">="],f.operators["<="],f.operators.between,f.operators.notBetween,f.operators.isIncludedIn,f.operators.isNotIncludedIn],date:[f.operators.empty,f.operators.notEmpty,f.operators["="],f.operators["!="],{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},f.operators.between,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},f.operators.isIncludedIn,f.operators.isNotIncludedIn],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[f.operators.empty,f.operators.notEmpty,f.operators["="],f.operators["!="],f.operators[">"],f.operators["<"],f.operators[">="],f.operators["<="],f.operators.between,f.operators.notBetween,f.operators.isIncludedIn,f.operators.isNotIncludedIn],relation:[f.operators.isIncludedIn,f.operators.isNotIncludedIn]}),D($,"configurable",{fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,items:{inputs:{type:"container",layout:"hbox",cls:`${P}-inputs`,items:{propertyPicker:{type:"combo",items:{},cls:`${P}-property`,placeholder:"L{FieldFilterPicker.selectAProperty}"},operatorPicker:{type:"combo",editable:!1,items:{},cls:`${P}-operator`,placeholder:"L{FieldFilterPicker.selectAnOperator}"},valueFields:{type:"container",cls:`${P}-values`,items:{}}}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:`${P}-case-sensitive`}},operators:f.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null}),D($,"buildOperatorArgCountLookup",e=>V.keyBy(Object.entries(e),([t])=>t,([,t])=>V.keyBy(t,({value:i})=>i,({argCount:i})=>i===void 0?1:i))),$.initClass(),$._$name="FieldFilterPicker";class J extends L{compose(){const{text:e,html:t}=this;return{tag:"label",text:e,html:t}}}D(J,"$name","Label"),D(J,"type","label"),D(J,"configurable",{text:null,localizableProperties:["text"]}),J.initClass(),J._$name="Label";const H=class extends ce{static get $name(){return"FieldFilterPickerGroup"}static get type(){return"fieldfilterpickergroup"}afterConstruct(){const e=this;e.validateConfig();const{addFilterButton:t}=e.widgetMap;t.ion({click:"addFilter",thisObj:e}),t.text=e.L(t.text),e.store&&e.updateStore(e.store),super.afterConstruct()}changeDateFormat(e){return this.L(e)}validateConfig(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup requires either a 'fields' or 'store' config property.")}updateFields(e){this.widgetMap.pickers.childItems.forEach(t=>t.fields=e)}updateFilters(e,t){const i=this;t&&t.filter(r=>!e.find(a=>a.id===r.id)).forEach(r=>{var a;return(a=i.store)===null||a===void 0?void 0:a.removeFilter(r.id)}),e.forEach(r=>r.id=r.id||i.nextFilterId),i.widgetMap.pickers.items=(e==null?void 0:e.map(r=>i.getPickerRowConfig(r)))||[]}changeFilters(e){const{canManageFilter:t}=this;return e&&t?e.filter(i=>this.callback(t,this,[i])):e}updateStore(e){const t=this;t.detachListeners("store"),e&&(t.widgetMap.pickers.childItems.forEach(({widgetMap:{filterPicker:{filter:i,isValid:r}}})=>{e.removeFilter(i.id,!0),r&&e.addFilter(i,!0)}),e.filter(),t.appendFiltersFromStore(),e.ion({name:"store",filter:"onStoreFilter",thisObj:t})),t.widgetMap.pickers.childItems.forEach(i=>i.store=e)}updateShowAddFilterButton(e){this.widgetMap.addFilterButton.hidden=!e}updateAddFilterButtonText(e){this.widgetMap.addFilterButton.text=e!=null?e:H.addFilterButtonDefaultText}appendFiltersFromStore(){const e=this;e.store.filters.forEach(t=>{var i;const r=e.canManage(t),{property:a,operator:n,value:s,id:l,disabled:o=!1,caseSensitive:c}=t;r&&a&&n&&!((i=e.filters)!==null&&i!==void 0&&i.find(h=>h.id===l))&&e.appendFilter({id:l,property:a,operator:n,value:s,disabled:o,caseSensitive:c})})}canManage(e){const t=this;return!t.canManageFilter||t.callback(t.canManageFilter,t,[e])===!0}getFilterPickerConfig(e){const t=this,{fields:i,store:r,disabled:a,readOnly:n,valueFieldCls:s,operators:l,limitToProperty:o,dateFormat:c,getFieldFilterPickerConfig:h}=t;return{type:t.constructor.childPickerType,fields:i!=null?i:t.getFieldsFromStore(r),filter:e,store:r,disabled:a,readOnly:n,propertyLocked:!!o,valueFieldCls:s,operators:l,dateFormat:c,internalListeners:{change:"onFilterPickerChange",thisObj:t},flex:1,...h?t.callback(h,t,[e]):void 0}}getFieldsFromStore(e){var i;var t;return Object.fromEntries((i=(t=e.fields)===null||t===void 0?void 0:t.map(({name:r,type:a})=>[r,{type:a}]))!=null?i:[])}getPickerRowConfig(e){const t=this,{disabled:i,readOnly:r,canDeleteFilter:a}=t,n=!(a&&t.callback(a,t,[e])===!1);return{type:"container",layout:"box",cls:{[`b-${H.type}-row`]:!0,[`b-${H.type}-row-removable`]:n},dataset:{separatorText:t.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:i,readOnly:r,checked:!e.disabled,internalListeners:{change:"onFilterActiveChange",thisObj:t},cls:`b-${H.type}-filter-active`},filterPicker:t.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:i,readOnly:r,hidden:!n,cls:`b-transparent b-${H.type}-remove`,icon:"b-fa-trash",internalListeners:{click:"removeFilter",thisObj:t}}}}}get allInputs(){const e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll(t=>e.includes(t.type))}updateDisabled(e){this.allInputs.forEach(t=>t.disabled=e)}updateReadOnly(e){this.allInputs.forEach(t=>t.readOnly=e)}onFilterActiveChange({source:e,checked:t}){const i=this,r=i.getFilterIndex(e),a=i.filters[r],n=i.getFilterPicker(r);a.disabled=!t,n.onFilterChange(),i.store&&n.isValid&&i.store.addFilter(a,!0),i.updateStoreFilter(),i.triggerChange()}onFilterPickerChange({source:e,filter:t,isValid:i}){const r=this,{store:a}=r,n=r.getFilterIndex(e);a&&(a.removeFilter(t.id,!0),i&&a.addFilter(t,!0),r.updateStoreFilter()),Object.assign(r.filters[n],t),r.triggerChange()}getFilterIndex(e){return this.widgetMap.pickers.childItems.indexOf(e.containingWidget)}getPickerRow(e){return this.widgetMap.pickers.childItems[e]}getFilterPicker(e){return this.getPickerRow(e).widgetMap.filterPicker}get nextFilterId(){return this._nextId=(this._nextId||0)+1,`${this.id}-filter-${this._nextId}`}removeFilter({source:e}){const t=this,i=t.getFilterIndex(e),r=t.filters[i],a=t.getPickerRow(i),n=t.query(s=>s.isFocusable&&s.type!=="container"&&!a.contains(s));n&&n.focus(),t.removeFilterAt(i),t.store&&(t.store.removeFilter(r.id,!0),t.updateStoreFilter()),t.trigger("remove",{filter:r}),t.triggerChange()}addFilter({property:e=null,operator:t=null,value:i=null}={}){const r=this,{filters:a}=r,n={property:r.limitToProperty||e,operator:t,value:i,disabled:!1,id:r.nextFilterId,caseSensitive:!1};if(r.appendFilter(n),r.getFilterPicker(a.length-1).isValid){var s;(s=r.store)===null||s===void 0||s.addFilter(n,!0),r.store&&r.updateStoreFilter()}r.trigger("add",{filter:n}),r.triggerChange()}appendFilter(e){const t=this;(!t.limitToProperty||e.property===t.limitToProperty)&&(t.filters.push(e),t.widgetMap.pickers.add(t.getPickerRowConfig(e,t.filters.length-1)))}onStoreFilter(e){const t=this;if(t._isUpdatingStore)return;const{filters:i}=e,r=i.values.reduce((a,n)=>({...a,[n.id]:n}),{});for(let a=t.filters.length-1;a>=0;a--){const n=t.filters[a],s=r[n.id],l=t.getPickerRow(a);if(l){const{filterPicker:o,activeCheckbox:c}=l.widgetMap;if(!s&&o.isValid)t.removeFilterAt(a);else if(s!==void 0){const{operator:h,value:p,property:g,disabled:v,caseSensitive:b}=s;n!==s&&Object.assign(n,{operator:h,value:p,property:g,disabled:v,caseSensitive:b}),o.filter=n,o.onFilterChange(),c.checked=!v}}}t.appendFiltersFromStore(),t.triggerChange()}removeFilterAt(e){const{widgetMap:{pickers:t},filters:i}=this;t.remove(t.childItems[e]),i.splice(e,1),this.triggerChange()}updateStoreFilter(){var e;this._isUpdatingStore=!0,(e=this.store)===null||e===void 0||e.filter(),this._isUpdatingStore=!1}get value(){return this.filters}triggerChange(){const{filters:e}=this,t=e.filter((i,r)=>this.getPickerRow(r).widgetMap.filterPicker.isValid);this.trigger("change",{filters:e,validFilters:t})}activateAll(){this.setAllActiveStatus(!0)}deactivateAll(){this.setAllActiveStatus(!1)}setAllActiveStatus(e){const t=this,{_filters:i,store:r}=t;i.forEach((a,n)=>{if(e===a.disabled){const{filterPicker:s,activeCheckbox:l}=t.getPickerRow(n).widgetMap;a.disabled=!e,s.onFilterChange(),l.checked=e,e&&r&&s.isValid&&r.addFilter(a,!0)}}),t.updateStoreFilter()}};let U=H;D(U,"addFilterButtonDefaultText","L{FieldFilterPickerGroup.addFilter}"),D(U,"configurable",{filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:H.addFilterButtonDefaultText,cls:`b-${H.type}-add-button`,hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"}),D(U,"childPickerType","fieldfilterpicker"),U.initClass(),U._$name="FieldFilterPickerGroup";const We=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];re.isWindows&&We.reverse();class ue extends et{static get $name(){return"MessageDialog"}static get type(){return"messagedialog"}static get configurable(){return{centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:"\xA0",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:We}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}destroy(){}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const t=this.widgetMap.input;return L.reconfigure(t,e),t.value="",this.showDialog("prompt",...arguments)}showDialog(e,{message:t="",title:i="\xA0",cancelButton:r,okButton:a,rootElement:n=document.body}){const s=this;return s.rootElement=n,s.getConfig("lazyItems"),s.title=s.optionalL(i),s.widgetMap.message.html=s.optionalL(t),s.showClass=`b-messagedialog-${e}`,a&&(a=typeof a=="string"?{text:a}:a),r&&(r=typeof r=="string"?{text:r}:r),a=Object.assign({},s.widgetMap.okButton.initialConfig,a),r=Object.assign({},s.widgetMap.cancelButton.initialConfig,r),a.text=s.optionalL(a.text),r.text=s.optionalL(r.text),L.reconfigure(s.widgetMap.okButton,a),L.reconfigure(s.widgetMap.cancelButton,r),s.show(),s.promise=new Promise(l=>{s.resolve=l})}show(){const e=d.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:ue.fromElement(document.activeElement),super.show(...arguments)}updateShowClass(e,t){const{classList:i}=this.element;t&&i.remove(t),e&&i.add(e)}doResolve(e){const t=this,{resolve:i}=t;if(i){const r=t.showClass==="b-messagedialog-prompt";if(r&&e===t.okButton&&!t.widgetMap.input.isValid)return;t.resolve=t.reject=t.promise=null,i(r?{button:e,text:t.widgetMap.input.value}:e),t.hide()}}onInternalKeyDown(e){e.key==="Escape"&&(e.stopImmediatePropagation(),this.onCancelClick()),e.key==="Enter"&&(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve(ve.okButton)}onCancelClick(){this.doResolve(ve.cancelButton)}}ue.initClass();const ve=new Proxy({},{get(m,e){const t=m.instance||(m.instance=new ue({rootElement:document.body})),i=t[e];return typeof i=="function"?i.bind(t):i}});export{X as ButtonGroup,Z as CalendarPanel,ct as Clipboardable,pe as DateField,oe as DatePicker,me as DisplayField,Ee as DragHelper,te as DurationField,$ as FieldFilterPicker,U as FieldFilterPickerGroup,ne as Formatter,J as Label,ve as MessageDialog,z as Month,ye as NumberField,A as NumberFormat,ge as ResizeHelper,Ne as SUPPORTED_FIELD_DATA_TYPES,be as TimeField,q as TimePicker,Le as WidgetHelper,B as YearPicker,Ae as isSupportedDurationField};
//# sourceMappingURL=MessageDialog.js.map
