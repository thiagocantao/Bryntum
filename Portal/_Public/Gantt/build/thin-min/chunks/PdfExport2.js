/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var q=Object.defineProperty;var U=(f,t,r)=>t in f?q(f,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[t]=r;var _=(f,t,r)=>(U(f,typeof t!="symbol"?t+"":t,r),r);import{ColumnStore as X,Column as Y,GridFeatureManager as M}from"./GridBase.js";import{VersionHelper as J,StringHelper as k,InstancePlugin as K,Editor as O,EventHelper as Q,DateHelper as E,DomHelper as b,DomSync as C,Tooltip as Z,Rectangle as T,Combo as ee,Field as te,ObjectHelper as V}from"./Editor.js";import{AvatarRendering as re}from"./AvatarRendering.js";import{RowReorder as ae,Summary as se,MultiPageExporter as ie,MultiPageVerticalExporter as ne,ExportDialog as oe,SinglePageExporter as le,PdfExport as ce}from"./PdfExport.js";import{TransactionalFeature as de}from"./TimeAxisHeaderMenu.js";class P extends Y{static get $name(){return"ResourceInfoColumn"}static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showMeta","showImage","validNames","autoScaleThreshold","useNameAsImageName"]}static get defaults(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,validNames:null,autoScaleThreshold:40,useNameAsImageName:!0,field:"name",htmlEncode:!1,width:140,cellCls:"b-resourceinfo-cell",editor:J.isTestEnv?!1:"text"}}construct(...t){super.construct(...t),this.avatarRendering=new re({element:this.grid.element})}doDestroy(){super.doDestroy(),this.avatarRendering.destroy()}getImageURL(t){const r=this.grid.resourceImagePath||"",e=r.split("//"),a=e.length>1?e[1]:r,i=k.joinPaths([a||"",t||""]);return e.length>1?e[0]+"//"+i:i}template(t,r){const e=this,{showImage:a,showRole:i,showMeta:n,showEventCount:s,grid:o}=e,{timeAxis:l,resourceImageExtension:c="",defaultResourceImageName:d}=o,m=typeof i=="string"?i:"role",u=s&&t.eventStore.getEvents({includeOccurrences:o.enableRecurringEvents,resourceRecord:t,startDate:l.startDate,endDate:l.endDate}).length;let g;if(a&&t.image!==!1)if(t.imageUrl)g=t.imageUrl;else{const h=typeof a=="string"?a:t.image||r&&e.useNameAsImageName&&r.toLowerCase()+c||d||"";g=h&&e.getImageURL(h),g&&!h.includes(".")&&(!e.validNames||e.validNames.includes(h))&&(g+=c)}return{class:"b-resource-info",children:[a&&e.avatarRendering.getResourceAvatar({resourceRecord:t,initials:t.initials,color:t.eventColor,iconCls:t.iconCls,imageUrl:g,defaultImageUrl:d&&this.getImageURL(d)}),i||s||n?{tag:"dl",children:[{tag:"dt",text:r},i?{tag:"dd",class:"b-resource-role",text:t.getValue(m)}:null,s?{tag:"dd",class:"b-resource-events",html:e.L("L{eventCountText}",u)}:null,n?{tag:"dd",class:"b-resource-meta",html:e.showMeta(t)}:null]}:r]}}defaultRenderer({grid:t,record:r,cellElement:e,value:a,isExport:i}){let n;return r.isSpecialRow?n="":i?n=a:(this.autoScaleThreshold&&t.rowHeight<this.autoScaleThreshold?e.style.fontSize=t.rowHeight/40+"em":e.style.fontSize="",n=this.template(r,a)),n}}X.registerColumnType(P),P._$name="ResourceInfoColumn";const ue=["top","before","after","bottom"],me=(f,t)=>{switch(f){case"top":return"b-b";case"after":return t.rtl?"r-r":"l-l";case"right":return"l-l";case"bottom":return"t-t";case"before":return t.rtl?"l-l":"r-r";case"left":return"r-r"}},he={top:1,bottom:1},ge={estimate:1,measure:1},fe={before:1,after:1};class L extends K{static get $name(){return"Labels"}static get configurable(){return{labelCls:"b-sch-label",top:null,after:null,right:null,bottom:null,before:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(t,r){const e=this;if(t.isVertical)throw new Error("Labels feature is not supported in vertical mode");e.scheduler=t,super.construct(t,r),(e.top||e.bottom||e.before||e.after)&&e.updateHostClasslist()}updateHostClasslist(){const{top:t,bottom:r}=this,{classList:e}=this.scheduler.element;e.remove("b-labels-topbottom"),e.remove("b-labels-top"),e.remove("b-labels-bottom"),(t||r)&&(e.add("b-labels-topbottom"),t&&e.add("b-labels-top"),r&&e.add("b-labels-bottom"))}onLabelDblClick(t){const r=this,e=t.target;if(e&&!r.scheduler.readOnly){const{side:a}=e.dataset,i=r[a],{editor:n,field:s}=i;if(n){const o=this.scheduler.resolveEventRecord(t.target);return o.readOnly?void 0:(n instanceof O||(i.editor=new O({blurAction:r.blurAction,inputField:n,scrollAction:"realign"})),i.editor.render(r.scheduler.element),i.editor.startEdit({target:e,align:me(a,r.client),matchSize:!1,record:o,field:s}),t.stopImmediatePropagation(),!1)}}}changeTop(t){return this.processLabelSpec(t,"top")}updateTop(){this.updateHostClasslist()}changeAfter(t){return this.processLabelSpec(t,"after")}updateAfter(){this.updateHostClasslist()}changeRight(t){this[this.client.rtl?"before":"after"]=t}changeBottom(t){return this.processLabelSpec(t,"bottom")}updateBottom(){this.updateHostClasslist()}changeBefore(t){return this.processLabelSpec(t,"before")}updateBefore(){this.updateHostClasslist()}changeLeft(t){this[this.client.rtl?"after":"before"]=t}processLabelSpec(t,r){if(typeof t=="function")t={renderer:t};else if(typeof t=="string")t={field:t};else if(t)t=Object.setPrototypeOf({},t);else return null;const{scheduler:e}=this,{eventStore:a,resourceStore:i,taskStore:n,id:s}=e,{field:o,editor:l}=t;if(he[r]&&(e.milestoneWidth=null),a&&!n?t.recordType="event":t.recordType="task",o){let c;a&&!n&&(c=a.modelClass.fieldMap[o],c?(t.fieldDef=c,t.recordType="event"):Reflect.has(a.modelClass.prototype,o)&&(t.recordType="event")),!c&&n&&(c=n.modelClass.fieldMap[o],c?(t.fieldDef=c,t.recordType="task"):Reflect.has(i.modelClass.prototype,o)&&(t.recordType="task")),!c&&i&&(c=i.modelClass.fieldMap[o],c?(t.fieldDef=c,t.recordType="resource"):Reflect.has(i.modelClass.prototype,o)&&(t.recordType="resource")),l&&(typeof l=="boolean"?e.editor={type:"textfield"}:typeof l=="string"&&(e.editor={type:l}),Q.on({element:e.timeAxisSubGrid.element,delegate:".b-sch-label",dblclick:"onLabelDblClick",thisObj:this}))}return t}doDisable(t){super.doDisable(t),this.client.isPainted&&this.client.refresh()}generateLabelConfigs(t){const r=this,e=[];for(const a of ue)if(r[a]){const{field:i,fieldDef:n,recordType:s,renderer:o,thisObj:l}=r[a],c={tag:"label",className:{[r.labelCls]:1,[`${r.labelCls}-${a}`]:1},dataset:{side:a,taskFeature:`label-${a}`}};let d;const m=`${s}Record`,u=t[m];o?d=o.call(l||r.thisObj||r,{[m]:u,resourceRecord:t.resourceRecord,assignmentRecord:t.assignmentRecord,domConfig:c}):(d=u.getValue(i),(n==null?void 0:n.type)==="date"&&!o?d=E.format(d,r.client.displayDateFormat):d=k.encodeHtml(d)),c.html=d||"\xA0",e.push(c)}return e}measureLabels(t,r){const e=this,a=e.client.timeAxisViewModel.getSingleUnitInPixels("millisecond");for(const i of t)if(fe[i.dataset.side]){let{html:n}=i,s=0;if(e.labelLayoutMode==="estimate")n.includes("<")&&(n=b.stripTags(n)),s=n.length*e.labelCharWidth+18;else{const l=e.labelMeasureElement||(e.labelMeasureElement=b.createElement({className:"b-sch-event-wrap b-measure-label",parent:e.client.foregroundCanvas}));l.retainElement=!0,C.sync({targetElement:l,childrenOnly:!0,domConfig:{children:[i]}}),s=l.firstElementChild.offsetWidth}const o=s/a;switch(i.dataset.side){case"before":r.startMS-=o;break;case"after":r.endMS+=o;break}}}onEventDataGenerated(t){var r;if(!this.disabled&&!((r=t.eventRecord)!==null&&r!==void 0&&r.isResourceTimeRange)){const e=this.generateLabelConfigs(t);ge[this.labelLayoutMode]&&this.measureLabels(e,t),t.wrapperChildren.push(...e)}}updateLabelLayoutMode(){this.isConfiguring||this.client.refreshWithTransition()}updateLabelCharWidth(){this.isConfiguring||this.client.refreshWithTransition()}}L.featureClass="b-sch-labels",L._$name="Labels",M.registerFeature(L,!1,"Scheduler");class R extends de(ae){onDragStart(...t){if(super.onDragStart(...t),this.client.transactionalFeaturesEnabled)return this.startFeatureTransaction()}onDrop(...t){return this.rejectFeatureTransaction(),super.onDrop(...t)}onAbort(...t){return this.rejectFeatureTransaction(),super.onAbort(...t)}}_(R,"$name","RowReorder"),R._$name="RowReorder",M.registerFeature(R,!1,"Scheduler"),M.registerFeature(R,!0,"Gantt");class G extends se{static get $name(){return"TimelineSummary"}static get configurable(){return{showTooltip:!0}}static get pluginConfig(){return{chain:["renderRows","updateProject"]}}construct(t,r){const e=this;super.construct(t,r),e.summaries||(e.summaries=[{renderer:e.renderer}]),t.isTimelineBase&&(e.updateProject(t.project),t.ion({timeAxisViewModelUpdate:e.renderRows,thisObj:e}))}updateProject(t){this.detachListeners("summaryProject"),t.ion({name:"summaryProject",dataReady:"updateTimelineSummaries",thisObj:this})}renderRows(){this.client.isHorizontal&&this.client.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer").classList.add("b-sch-summarybar"),super.renderRows(),this.disabled||this.render()}get summaryBarElement(){return this.client.element.querySelector(".b-sch-summarybar")}render(){const t=this,{client:r}=t,e=r.isHorizontal?"width":"height",a=r.timeAxisViewModel.columnConfig,i=t.summaryBarElement;i&&(!t._tip&&t.showTooltip&&t.summaries.some(n=>n.label)&&(t._tip=new Z({id:`${r.id}-summary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:i,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:n})=>n._tipHtml})),i.innerHTML=a[a.length-1].map(n=>`<div class="b-timeaxis-tick" style="${e}: ${n.width}px"></div>`).join(""),t.updateTimelineSummaries())}refresh(){super.refresh(),this.updateTimelineSummaries()}doDisable(t){var r;const{isConfiguring:e}=this.client;super.doDisable(t),(r=this.summaryColumn)===null||r===void 0||r.toggle(!t),!e&&!t&&this.render()}doDestroy(){var t;(t=this._tip)===null||t===void 0||t.destroy(),super.doDestroy()}}G._$name="TimelineSummary";const y={completeview:"completeview",currentview:"currentview",daterange:"daterange"},pe=Promise.resolve();var A=f=>class extends f{async scrollRowIntoView(r,e){const{rowManager:a,scrollable:i}=r,n=i.y;return e<r.store.count&&(i.scrollTo(null,a.calculateTop(e)),i.y!==n)?new Promise(s=>{const o=r.ion({scroll({scrollTop:l}){l!=null&&a.getRow(e)&&(o(),s())}})}):pe}async scrollToDate(r,e){let a=!1;const i=[],n=r.timeAxisSubGrid.scrollable.ion({scrollStart({x:s}){s!=null&&(a=!0)}});i.push(r.scrollToDate(e,{block:"start"})),n(),a&&i.push(r.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(i)}cloneElement(r,e,a){super.cloneElement(r,e,a);const i=this.element.querySelector(".b-schedulerbase");i==null||i.classList.remove(...["fade-in","slide-from-left","slide-from-top","zoom-in"].map(n=>`b-initial-${n}`))}async prepareComponent(r){const e=this,{client:a}=r,{currentOrientation:i}=a,n=a.timeAxisSubGrid.width>0;switch(r.scheduleRange){case y.completeview:r.rangeStart=a.startDate,r.rangeEnd=a.endDate;break;case y.currentview:{const{startDate:d,endDate:m}=a.visibleDateRange;r.rangeStart=d,r.rangeEnd=m;break}}await a.waitForAnimations(),r.infiniteScroll=a.infiniteScroll,a.infiniteScroll=!1,n&&(a.setTimeSpan(r.rangeStart,r.rangeEnd),a.svgCanvas),e._oldEnableEventAnimations=a.enableEventAnimations,a.enableEventAnimations=!1,i.isHorizontalRendering&&(e._oldScrollBuffer=i.scrollBuffer,e._oldVerticalBuffer=i.verticalBufferSize,i.scrollBuffer=100,i.verticalBufferSize=-1),a.ignoreViewBox=!0,await super.prepareComponent(r);const{exportMeta:s,element:o}=e,l=o.querySelector(".b-sch-foreground-canvas"),c=o.querySelector(".b-horizontaltimeaxis");if(s.includeTimeline=n,n&&r.scheduleRange!==y.completeview){s.totalWidth-=s.subGrids.normal.width,s.totalWidth+=s.subGrids.normal.width=a.timeAxisViewModel.getDistanceBetweenDates(r.rangeStart,r.rangeEnd);const d=Math.ceil(s.totalWidth/s.pageWidth),m=d*s.verticalPages;s.horizontalPages=d,s.totalPages=m,s.subGrids.normal.scrollLeft=a.getCoordinateFromDate(r.rangeStart)}if(s.timeAxisHeaders=[],s.timeAxisPlaceholders=[],s.headersColleted=!1,b.forEachSelector(c,".b-sch-header-row",d=>{s.timeAxisPlaceholders.push(e.createPlaceholder(d)),s.timeAxisHeaders.push(new Map)}),s.subGrids.normal.eventsPlaceholder=e.createPlaceholder(l,!1),b.removeEachSelector(l,".b-sch-event-wrap,.b-sch-resourcetimerange"),b.removeEachSelector(e.element,".b-released"),s.eventsBoxes=new Map,s.client=a,a.hasActiveFeature("columnLines")){const d=o.querySelector(".b-column-lines-canvas");s.columnLinesPlaceholder=e.createPlaceholder(d),s.columnLines={lines:new Map,majorLines:new Map}}if(a.hasActiveFeature("timeRanges")){const d=o.querySelector(".b-sch-timeaxiscolumn .b-sch-timeranges-canvas"),m=o.querySelector(".b-sch-foreground-canvas .b-sch-timeranges-canvas");s.timeRanges={},d&&(s.timeRanges.header=r.enableDirectRendering?"":{},s.timeRangesHeaderPlaceholder=e.createPlaceholder(d)),s.timeRanges.body=r.enableDirectRendering?"":{},s.timeRangesBodyPlaceholder=e.createPlaceholder(m)}if(a.hasActiveFeature("dependencies")){a.features.dependencies.fillDrawingCache();const d=o.querySelector(`[id="${a.svgCanvas.getAttribute("id")}"]`);d&&(s.dependencyCanvasEl=d,s.dependenciesPlaceholder=e.createPlaceholder(d,!1,{ns:"http://www.w3.org/2000/svg",tag:"path"}),b.removeEachSelector(d,".b-sch-dependency"))}n&&!E.betweenLesser(r.rangeStart,a.startDate,a.endDate)&&await e.scrollToDate(a,r.rangeStart)}async restoreState(r){let e=!1;const{client:a}=r,i=[],n=a.timeAxisSubGrid.scrollable.ion({scrollStart({x:s}){this.element.scrollLeft!==s&&(e=!0)}});i.push(super.restoreState(r)),n(),e&&i.push(a.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(i)}async restoreComponent(r){const{client:e}=r,{currentOrientation:a}=e;e.ignoreViewBox=!1,e.infiniteScroll=r.infiniteScroll,e.enableEventAnimations=this._oldEnableEventAnimations,a.isHorizontalRendering&&(a.scrollBuffer=this._oldScrollBuffer,a.verticalBufferSize=this._oldVerticalBuffer),await super.restoreComponent(r)}async onRowsCollected(r,e){const a=this;if(await super.onRowsCollected(r,e),a.exportMeta.includeTimeline){const{client:i,enableDirectRendering:n}=e,{timeView:s}=i,{pageRangeStart:o,pageRangeEnd:l}=a.getCurrentPageDateRange(e);if(n)o&&l&&(a.renderHeaders(e,o,l),a.renderLines(e,o,l),a.renderRanges(e,o,l),a.renderEvents(e,r,o,l));else{if(o){let c=!1;for(await a.scrollToDate(i,o);!c;)if(a.collectLines(e),a.collectHeaders(e),a.collectRanges(e),a.collectEvents(r,e),E.timeSpanContains(s.startDate,s.endDate,o,l))c=!0;else if(s.endDate.getTime()>=l.getTime())c=!0;else{const d=s.endDate;if(await a.scrollToDate(i,s.endDate),d.getTime()===s.endDate.getTime())throw new Error("Could not scroll to date")}}await a.scrollToDate(i,e.rangeStart)}}}getCurrentPageDateRange({rangeStart:r,rangeEnd:e,enableDirectRendering:a,client:i}){const n=this,{exportMeta:s}=n,{horizontalPages:o,horizontalPosition:l,pageWidth:c,subGrids:d}=s;let m,u;if(o>1){const g=l*c,h=(l+1)*c,p=d.locked.width+d.locked.splitterWidth;if(h<=p)u=m=null;else{const{scrollLeft:x=0}=d.normal;m=i.getDateFromCoordinate(Math.max(g-p+x,0));const v=a?1:1.2;u=i.getDateFromCoordinate((h-p+x)*v)||e}}else m=r,u=e;return{pageRangeStart:m,pageRangeEnd:u}}prepareExportElement(){const{element:r,exportMeta:e}=this,{id:a,headerId:i,footerId:n,scrollLeft:s}=e.subGrids.normal,o=r.querySelector(`[id="${a}"]`);return[".b-sch-background-canvas",".b-sch-foreground-canvas"].forEach(l=>{const c=o.querySelector(l);c&&(e.lastExportedRowBottom?c.style.height=`${e.lastExportedRowBottom}px`:c.style.height="",s&&(c.style.marginLeft=`-${s}px`))}),s&&[i,n].forEach(l=>{const c=r.querySelector(`[id="${l}"] .b-widget-scroller`);c&&(c.style.marginLeft=`-${s}px`)}),super.prepareExportElement()}collectHeaders(r){const e=this,{client:a}=r,{exportMeta:i}=e;if(!i.headersCollected){const n=a.timeView.element,s=i.timeAxisHeaders;b.forEachSelector(n,".b-sch-header-row",(o,l,c)=>{const d=s[l];b.forEachSelector(o,".b-sch-header-timeaxis-cell",m=>{d.has(m.dataset.tickIndex)||d.set(m.dataset.tickIndex,m.outerHTML)}),l===c.length-1&&d.has(String(a.timeAxis.count-1))&&(i.headersCollected=!0)})}}collectRanges(r){const e=this,{client:a}=r,{exportMeta:i}=e,{timeRanges:n}=i;if(!i.headersCollected&&n){const{headerCanvas:s,bodyCanvas:o}=a.features.timeRanges;s&&b.forEachSelector(s,".b-sch-timerange",l=>{n.header[l.dataset.id]=l.outerHTML}),b.forEachSelector(o,".b-sch-timerange",l=>{n.body[l.dataset.id]=l.outerHTML})}}collectLines(r){const e=this,{client:a}=r,{exportMeta:i}=e,{columnLines:n}=i;if(!i.headersCollected&&n){const s=a.backgroundCanvas;b.forEachSelector(s,".b-column-line, .b-column-line-major",o=>{if(o.classList.contains("b-column-line")){const l=Number(o.dataset.line.replace(/line-/,""));n.lines.set(l,o.outerHTML)}else{const l=Number(o.dataset.line.replace(/major-/,""));n.majorLines.set(l,o.outerHTML)}})}}collectEvents(r,e){const a=this,i=r.length,{client:n}=e,s=a.exportMeta.subGrids.normal.rows;r.forEach((o,l)=>{var c,d;const m=s[s.length-i+l],u=n.store.getAt(o.dataIndex),g=m[3];(c=u.events)===null||c===void 0||c.forEach(h=>{if(h.isScheduled){let p=n.getElementFromEventRecord(h,u);p&&(p=p.parentElement)&&!g.has(h.id)&&g.set(h.id,[p.outerHTML,T.from(p,p.offsetParent)])}}),(d=u.timeRanges)===null||d===void 0||d.forEach(h=>{var p;const x=((p=n.features.resourceTimeRanges)===null||p===void 0?void 0:p.generateElementId(h))||"",v=n.foregroundCanvas.syncIdMap[x];v&&!g.has(x)&&g.set(x,[v.outerHTML,T.from(v,v.offsetParent)])})})}renderHeaders(r,e,a){const i=this,{exportMeta:n}=i,{client:s}=r,o=n.timeAxisHeaders,{timeAxisView:l}=s.timeAxisColumn,c=l.buildCells(e,a),d=document.createElement("div");C.sync({targetElement:d,domConfig:c}),b.forEachSelector(d,".b-sch-header-row",(m,u)=>{const g=o[u];b.forEachSelector(m,".b-sch-header-timeaxis-cell",h=>{g.has(h.dataset.tickIndex)||g.set(h.dataset.tickIndex,h.outerHTML)})})}renderEvents(r,e,a,i){const n=this,{client:s}=r,o=n.exportMeta.subGrids.normal.rows;e.forEach((l,c)=>{const d=o[c],m=d[3],u=s.store.getAt(l.dataIndex),g=s.currentOrientation.getResourceLayout(u),h=s.getCoordinateFromDate(a),p=s.getCoordinateFromDate(i),x=s.currentOrientation.getEventDOMConfigForCurrentView(g,l,h,p),v=document.createElement("div");x.forEach(w=>{const{eventId:D}=w.dataset,{left:S,top:N,width:z,height:W}=w.style;C.sync({targetElement:v,domConfig:w}),m.set(D,[v.outerHTML,new T(S,N,z,W)])})})}renderLines(r,e,a){const i=this,{client:n}=r,{exportMeta:s}=i,{columnLines:o}=s;if(o){const l=n.features.columnLines.getColumnLinesDOMConfig(e,a),c=document.createElement("div");C.sync({targetElement:c,domConfig:{children:l},onlyChildren:!0}),o.lines.set(0,c.innerHTML)}}renderRanges(r,e,a){const i=this,{client:n}=r,{exportMeta:s}=i,{timeRanges:o}=s;if(o){const l=n.features.timeRanges.getDOMConfig(e,a),c=document.createElement("div");l.forEach((d,m)=>{C.sync({targetElement:c,domConfig:{children:d,onlyChildren:!0}}),m===0?o.body=c.innerHTML:o.header=c.innerHTML})}}buildPageHtml(r){const e=this,{subGrids:a,timeAxisHeaders:i,timeAxisPlaceholders:n,columnLines:s,columnLinesPlaceholder:o,timeRanges:l,timeRangesHeaderPlaceholder:c,timeRangesBodyPlaceholder:d}=e.exportMeta,{enableDirectRendering:m}=r;let u=e.prepareExportElement();if(Object.values(a).forEach(({placeHolder:g,eventsPlaceholder:h,rows:p,mergedCellsHtml:x})=>{const v=g.outerHTML,{resources:w,events:D}=e.positionRows(p,r);let S=w.join("");x!=null&&x.length&&(S+=`<div class="b-grid-merged-cells-container">${x.join("")}</div>`),u=u.replace(v,S),h&&(u=u.replace(h.outerHTML,D.join("")))}),i.forEach((g,h)=>{u=u.replace(n[h].outerHTML,Array.from(g.values()).join(""))}),s){const g=Array.from(s.lines.values()).concat(Array.from(s.majorLines.values()));u=u.replace(o.outerHTML,g.join("")),m&&(e.exportMeta.columnLines.lines.clear(),e.exportMeta.columnLines.majorLines.clear())}return l&&(m?(u=u.replace(d.outerHTML,l.body),c&&(u=u.replace(c.outerHTML,l.header)),e.exportMeta.timeRanges={}):(u=u.replace(d.outerHTML,Object.values(l.body).join("")),c&&(u=u.replace(c.outerHTML,Object.values(l.body).join(""))))),u=e.buildDependenciesHtml(u),u}getEventBox(r){const e=this,{eventsBoxes:a,enableDirectRendering:i}=e.exportMeta,n=r&&a.get(String(r.id));return i&&n&&r.isMilestone&&n.translate(-n.width/2,0),n}renderDependencies(){const r=this,{client:e,eventsBoxes:a}=r.exportMeta,{dependencies:i}=e,n=e.features.dependencies,s=b.createElement();let o=!1;return i.forEach(l=>{if(!a.has(String(l.from))&&!a.has(String(l.to))||!n.isDependencyVisible(l))return;const c=r.getEventBox(l.fromEvent),d=r.getEventBox(l.toEvent);n.drawDependency(l,!0,{from:c==null?void 0:c.clone(),to:d==null?void 0:d.clone()}),o=!0}),o&&n.domSync(s),s.innerHTML}buildDependenciesHtml(r){const{dependenciesPlaceholder:e,includeTimeline:a}=this.exportMeta;if(e&&a){const i=e.outerHTML;r=r.replace(i,this.renderDependencies())}return r}};class H extends A(ie){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}async stateNextPage(t){await super.stateNextPage(t),this.exportMeta.eventsBoxes.clear()}positionRows(t){const r=[],e=[];return t.forEach(([a,i,n,s])=>{r.push(a),s&&Array.from(s.entries()).forEach(([o,[l,c,d=[]]])=>{e.push(l+d.join("")),this.exportMeta.eventsBoxes.set(String(o),c)})}),{resources:r,events:e}}}H._$name="MultiPageExporter";class $ extends A(ne){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}async stateNextPage(t){await super.stateNextPage(t),this.exportMeta.eventsBoxes.clear()}async prepareComponent(t){await super.prepareComponent(t),t.scheduleRange!==y.completeview&&this.estimateTotalPages(t)}positionRows(t){const r=[],e=[];return t.forEach(([a,,,i])=>{r.push(a),i&&Array.from(i.entries()).forEach(([n,[s,o,l=[]]])=>{e.push(s+l.join("")),this.exportMeta.eventsBoxes.set(String(n),o)})}),{resources:r,events:e}}}$._$name="MultiPageVerticalExporter";class F extends ee{static get $name(){return"ScheduleRangeCombo"}static get type(){return"schedulerangecombo"}static get defaultConfig(){return{editable:!1,localizeDisplayFields:!0,displayField:"text",buildItems(){return Object.entries(y).map(([t,r])=>({value:t,text:"L{"+r+"}"}))}}}}F.initClass(),F._$name="ScheduleRangeCombo";class B extends oe{static get $name(){return"SchedulerExportDialog"}static get type(){return"schedulerexportdialog"}static get configurable(){return{defaults:{localeClass:this},items:{scheduleRangeField:{type:"schedulerangecombo",label:"L{Schedule range}",value:"completeview",weight:150,onChange({value:t}){this.parent.widgetMap.rangesContainer.hidden=t!==y.daterange}},rangesContainer:{type:"container",flex:"1 0 100%",weight:151,hidden:!0,defaults:{localeClass:this},items:{filler:{weight:0,type:"widget",style:"margin-inline-end: -1em;"},rangeStartField:{type:"datefield",label:"L{Export from}",labelWidth:"3em",flex:"1 0 25%",weight:10,onChange({value:t}){this.parent.widgetMap.rangeEndField.min=E.add(t,1,"d")}},rangeEndField:{type:"datefield",label:"L{Export to}",labelWidth:"1em",flex:"1 0 25%",weight:30,onChange({value:t}){this.parent.widgetMap.rangeStartField.max=E.add(t,-1,"d")}}}}}}}onLocaleChange(){const t=this.L("labelWidth");this.width=this.L("L{width}"),this.items.forEach(r=>{r instanceof te?r.labelWidth=t:r.ref==="rangesContainer"&&(r.items[0].width=t)})}applyInitialValues(t){super.applyInitialValues(t);const r=this,{client:e,scheduleRange:a}=t,i=t.items=t.items||{},n=i.scheduleRangeField=i.scheduleRangeField||{},s=i.rangesContainer=i.rangesContainer||{},o=s.items=s.items||{},l=o.filler=o.filler||{},c=o.rangeStartField=o.rangeStartField||{},d=o.rangeEndField=o.rangeEndField||{};l.width=r.L("labelWidth"),n.value=n.value||a,n.value===y.daterange&&(s.hidden=!1);const m=c.value=c.value||e.startDate;c.max=E.max(e.startDate,E.add(e.endDate,-1,"d"));let u=d.value||e.endDate;u<=m&&(u=E.add(m,1,"d")),d.value=u,d.min=E.min(e.endDate,E.add(e.startDate,1,"d"))}}B._$name="SchedulerExportDialog";class I extends A(le){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}collectDependencies(){}positionRows(t,r){const e=[],a=[],i=/translate\((\d+.?\d*)px, (\d+.?\d*)px\)/,n=/top:.+?px/;if(r.enableDirectRendering)t.forEach(([s,,,o])=>{e.push(s),o&&Array.from(o.entries()).forEach(([l,[c,d,m=[]]])=>{this.exportMeta.eventsBoxes.set(String(l),d),a.push(c+m.join(""))})});else{let s=0;t.forEach(([o,l,c,d])=>{e.push(o.replace(i,`translate($1px, ${s}px)`));const m=s-l;d&&Array.from(d.entries()).forEach(([u,[g,h]])=>{h.translate(0,m),this.exportMeta.eventsBoxes.set(String(u),h),a.push(g.replace(n,`top: ${h.y}px`))}),s+=c})}return{resources:e,events:a}}}I._$name="SinglePageExporter";class j extends ce{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[I,H,$],dialogClass:B,scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){return V.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"])}buildExportConfig(t){t=super.buildExportConfig(t);const{scheduleRange:r,rangeStart:e,rangeEnd:a}=this;return t.columns&&!t.columns.find(i=>i.type==="timeAxis")&&t.columns.push(t.client.timeAxisColumn.id),V.assign({scheduleRange:r,rangeStart:e,rangeEnd:a},t)}}j._$name="PdfExport",M.registerFeature(j,!1,"Scheduler");export{L as Labels,H as MultiPageExporter,$ as MultiPageVerticalExporter,j as PdfExport,P as ResourceInfoColumn,R as RowReorder,y as ScheduleRange,F as ScheduleRangeCombo,B as SchedulerExportDialog,I as SinglePageExporter,G as TimelineSummary};
//# sourceMappingURL=PdfExport2.js.map
