/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var j=Object.defineProperty;var I=(f,e,t)=>e in f?j(f,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[e]=t;var T=(f,e,t)=>(I(f,typeof e!="symbol"?e+"":e,t),t);import{Widget as A,Tooltip as F,Objects as P,StringHelper as D,DomSync as O}from"./Editor.js";const $="http://www.w3.org/2000/svg",H={bar:1,outline:2,text:3},W=(f,e)=>parseInt(f.order,10)-parseInt(e.order,10),G=(f,e)=>parseInt(f.dataset.order,10)-parseInt(e.dataset.order,10),N=f=>f.field,Z=()=>!1,q=/\s+/;class S extends A{static get configurable(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:$,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:$,tag:"g",reference:"scaledSvgGroup"},{ns:$,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:!1,singleTextForAllBars:!0,monitorResize:!0,getRectClass(e,t,s,a){return""},getOutlineClass(e,t){return""},getBarTip(e,t,s,a){},getBarText(e,t,s){return""},getRectConfig:null,getBarTextRenderData(e,t,s,a){return e},getBarTextTip(e,t,s,a){}}}construct(e){const t=this;super.construct(e),t.scheduleRefresh=t.createOnFrame(t.refresh,[],t,!0),t.refresh()}set tip(e){var t;const s=this;(t=s.tip)===null||t===void 0||t.destroy(),e?s._tip=F.new({owner:s,forElement:s.svgElement,forSelector:"rect",internalListeners:{beforeShow:"up.onBeforeTipShow"}},e):s._tip=null}onElementResize(){super.onElementResize(...arguments);const e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform",`scale(${e.width} ${e.height})`)}onBeforeTipShow({source:e}){const t=parseInt(e.activeTarget.dataset.index);e.html=e.contentTemplate({histogram:this,index:t})}updateSeries(e){const t=this,s=t._series={};let a=0,n=0;for(const l in e)if(e[l]!==!1){const r=s[l]=P.merge({},e[l]);r.field||(r.field=l),r.type||(r.type="bar"),"order"in r||(r.order=H[r.type]*10+a),"index"in r||(r.index=a),r.type==="bar"&&(r.index=n++),r.id=l,a++}!t.topValue&&t._data&&(t.topValue=t.getDataTopValue(t._data)),t.refreshSuspended||t.scheduleRefresh()}getDataTopValue(e,t){const s=Object.values(t||this.series).map(N);let a=0,n;for(let l=0,{length:r}=e;l<r;l++){n=e[l];for(let i=0,{length:d}=s;i<d;i++)a=Math.max(a,n[s[i]])}return a}updateData(e){const t=this;t._data=e,!t.topValue&&t._data&&t._series&&(t.topValue=t.getDataTopValue(e)),t.refreshSuspended||t.scheduleRefresh()}updateTopValue(e){const t=this;t._topValue=e,!e&&t._data&&(t._topValue=t.getDataTopValue(t._data)),t.refreshSuspended||t.scheduleRefresh()}scheduleRefresh(){}suspendRefresh(){this.refreshSuspended++}resumeRefresh(){this.refreshSuspended&&this.refreshSuspended--}refresh(e){const t=this,{series:s,_tip:a,topValue:n,singleTextForAllBars:l}=t,r=(e==null?void 0:e.args)||[],i=[],d=[];if(s){for(const o of Object.values(s).sort(W)){const u=t[`draw${D.capitalize(o.type)}`](o,...r);Array.isArray(u)?i.push.apply(i,u):i.push(u),!l&&o.type==="bar"&&d.push(...t.drawText(o,...r))}i.sort(G),l?d.push(...t.drawText(null,...r)):d.sort(G),O.sync({domConfig:{width:"100%",height:"100%",preserveAspectRatio:"none",dataset:{topValue:n},children:[{ns:$,tag:"g",reference:"scaledSvgGroup",children:i},{ns:$,tag:"g",reference:"unscaledSvgGroup",children:d}]},configEquality:Z,targetElement:t.svgElement}),a&&a.isVisible&&t.onBeforeTipShow({source:a})}}drawBar(e,...t){const s=this,{topValue:a,data:n,omitZeroHeightBars:l,barStyle:r}=s,{field:i,order:d,stretch:o}=e,{length:u}=n,x=1/u,h=[],g=D.createId(e.id),c=e.index,m=o?1:void 0;let w;for(let b=0,B=0,{length:L}=n;b<L;b++,B+=w){const v=n[b];let p=v.rectConfig={ns:$,tag:"rect",dataset:{}};const y=v[i],E=y?m||v.height||(y>a?a:y)/a:0,M=1-E,_=s.callback("getBarTip",s,[e,p,v,b,...t]);w=v.width||x,r?p.style=r:delete p.style,Object.assign(p.dataset,{index:b,order:d,series:g});const V={[`b-series-${g}`]:1,[`b-series-index-${c}`]:1},z=s.callback("getRectClass",s,[e,p,v,b,...t]);z&&z.split(q).forEach(k=>V[k]=1),Object.assign(p,{x:B,y:M,width:w,height:E,class:V}),_?p.dataset.btip=_:delete p.dataset.btip,s.getRectConfig&&(p=s.getRectConfig(p,v,b,e,...t)),p&&(p.height||!l)&&h.push(p)}return h}changeGetRectConfig(e){return e?this.bindCallback(e):null}drawOutline(e,...t){const s=this,{topValue:a,data:n}=s,{field:l,order:r,id:i}=e,d=1/n.length,o=["M 0,1"],u={ns:$,tag:"path",dataset:{order:r,id:i}};let x,h="M",g="L";for(let c=0,m=0,{length:w}=n;c<w;c++){const b=1-n[c][l]/a;x=n[c].width||d,o.push(`${h} ${m},${b} ${g} ${m+=x},${b}`),h=g=""}return u.class=`b-series-${e.id} b-series-index-${e.index} `+s.callback("getOutlineClass",s,[e,n,...t]),u.d=o.join(" "),u}drawText(e,...t){const s=this,{data:a}=s,n=1/a.length,l="100%",r=[];for(let i=0,d,o=0,{length:u}=a;i<u;i++,o+=d){d=a[i].width||n;const x=s.callback("getBarText",s,[a[i],i,e,...t]);if(x){const h=s.callback("getBarTextRenderData",s,[{ns:$,tag:"text",className:"b-bar-legend",html:x,left:o,width:d,x:`${(o+d/2)*100}%`,y:a[i].y!==void 0?a[i].y:l,dataset:{index:i,series:e}},a[i],i,e,...t]),g=s.callback("getBarTextTip",s,[h,a[i],i,e,...t]);g?h.dataset.btip=g:delete h.dataset.btip,r.push(h)}}return r}}T(S,"type","histogram"),T(S,"$name","Histogram"),T(S,"properties",{refreshSuspended:0}),S.initClass(),S._$name="Histogram";const R="http://www.w3.org/2000/svg";class C extends A{static get type(){return"scale"}static get $name(){return"Scale"}static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:R,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:R,tag:"g",reference:"scaledSvgGroup",children:[{ns:R,tag:"path",reference:"pathElement"}]},{ns:R,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(e){return e||(e=this.horizontal?"bottom":"right"),e}updateAlign(e,t){this.element.classList.remove(`b-align-${t}`),this.element.classList.add(`b-align-${e}`)}updateHorizontal(e,t){this.element.classList.remove(`b-scale-${t?"horizontal":"vertical"}`),this.element.classList.add(`b-scale-${e?"horizontal":"vertical"}`)}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){var e;if(!this.scalePoints)return;const t=this,{horizontal:s,width:a,height:n,align:l,scalePoints:r,scaleMaxPadding:i}=t,d=(e=r[r.length-1])===null||e===void 0?void 0:e.value,o=[],u=[],x=1/(d+i*d);t.scaledSvgGroup.setAttribute("transform",`scale(${s?a:1} ${s?1:n})`);for(const h of r){const g=!!h.text,c=x*h.value;if(g){const m={ns:R,tag:"text",className:"b-scale-tick-label",html:h.text,dataset:{tick:h.value}};s?(m.x=`${c*100}%`,m.y=l==="top"?"1.6em":n-12):(m.x=l==="left"?"12":`${a-12}`,m.y=`${(1-c)*100}%`),u.push(m)}s?l==="top"?o.push(`M${c},0 L${c},${g?10:5}`):o.push(`M${c},${n} L${c},${n-(g?10:5)}`):l==="left"?o.push(`M0,${1-c} L${g?10:5},${1-c}`):o.push(`M${a},${1-c} L${a-(g?10:5)},${1-c}`)}t.pathElement.setAttribute("d",o.join("")),O.syncChildren({domConfig:{children:u}},t.unscaledSvgGroup)}}C.initClass(),C._$name="Scale";export{S as Histogram,C as Scale};
//# sourceMappingURL=Scale.js.map
