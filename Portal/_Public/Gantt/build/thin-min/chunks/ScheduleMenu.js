/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var kt=Object.defineProperty;var Pt=(f,n,e)=>n in f?kt(f,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):f[n]=e;var D=(f,n,e)=>(Pt(f,typeof n!="symbol"?n+"":n,e),e),Oe=(f,n,e)=>{if(!n.has(f))throw TypeError("Cannot "+e)};var He=(f,n,e)=>(Oe(f,n,"read from private field"),e?e.call(f):n.get(f)),je=(f,n,e)=>{if(n.has(f))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(f):n.set(f,e)},ue=(f,n,e,t)=>(Oe(f,n,"write to private field"),t?t.call(f,e):n.set(f,e),e);import{Model as We,StringHelper as k,IdHelper as Ve,DateHelper as g,LocaleHelper as It,Localizable as Lt,Store as J,unitMagnitudes as de,ObjectHelper as x,Events as Be,Base as R,EventHelper as L,BrowserHelper as z,DomHelper as A,GlobalEvents as Q,DomDataStore as zt,Popup as Ot,Rectangle as P,Scroller as Ht,ResizeMonitor as jt,Collection as he,FunctionHelper as Wt,VersionHelper as me,DomClassList as O,TimeZoneHelper as _e,ArrayHelper as Y,Delayable as $e,Navigator as Vt,DomSync as G,Widget as Ue,ColorPicker as Bt,ContextMenuBase as _t,Combo as ee,Panel as $t,Objects as Ne}from"./Editor.js";import{TimeSpan as Ut,AbstractCrudManagerMixin as Nt,ProjectCrudManager as Yt,AjaxTransport as Gt,JsonEncoder as qt,ProjectModel as Ye,ResourceStore as Zt,EventStore as Kt,AssignmentStore as Xt,DependencyStore as Jt,CrudManagerView as Qt,RecurrenceDayRuleEncoder as te}from"./CrudManagerView.js";import{AvatarRendering as ei,ColorField as ti}from"./AvatarRendering.js";import{ButtonGroup as ge}from"./MessageDialog.js";import{Header as ii,SubGrid as ni,GridBase as ri,Location as si,ColumnStore as Ge,WidgetColumn as ai,Column as oi,GridFeatureManager as fe}from"./GridBase.js";class I extends We{static get fields(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(){super.construct(...arguments),this.normalizeUnits()}generateId(n){const e=this,{headers:t}=e,i=[];let r=Object.getPrototypeOf(e.data).id;if(!r){for(let{length:s}=t,a=s-1;a>=0;a--){const{unit:o,increment:l}=t[a],c=l>1;i.push(`${c?l:""}${a?o:k.capitalize(o)}${c?"s":""}`)}r=i.join("And")}return n.count&&n.includes(r)&&(r+=`-${e.tickWidth}by${e.tickHeight||e.tickWidth}`,n.includes(r)&&(r+=`-${e.bottomHeader.increment}`,n.includes(r)&&(r=Ve.generateId(`${r}-`)))),r}normalizeUnits(){const n=this,{timeResolution:e,headers:t,shiftUnit:i}=n;if(t)for(let r=0,{length:s}=t;r<s;r++){const a=t[r];a.unit=g.normalizeUnit(a.unit),a.splitUnit&&(a.splitUnit=g.normalizeUnit(a.splitUnit)),"increment"in a||(t[r]=Object.assign({increment:1},a))}e&&(e.unit=g.normalizeUnit(e.unit)),i&&(n.shiftUnit=g.normalizeUnit(i))}static normalizeHeaderConfig(n){const{headerConfig:e,columnLinesFor:t,mainHeaderLevel:i}=n,r=n.headers=[];if(e.top&&(t==="top"&&(n.columnLinesFor=0),i==="top"&&(n.mainHeaderLevel=0),r[0]=e.top),e.middle)t==="middle"&&(n.columnLinesFor=r.length),i==="middle"&&(n.mainHeaderLevel=r.length),r.push(e.middle);else throw new Error("ViewPreset.headerConfig must be configured with a middle");e.bottom&&(n.mainHeaderLevel=r.length-1,t==null?n.columnLinesFor=r.length-1:t==="bottom"&&(n.columnLinesFor=r.length),i==null&&(n.mainHeaderLevel=r.length-1),i==="bottom"&&(n.mainHeaderLevel=r.length),r.push(e.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const n={},{headers:e}=this,{length:t}=e;switch(t){case 1:n.middle=e[0];break;case 2:this.mainHeaderLevel===0?(n.middle=e[0],n.bottom=e[1]):(n.top=e[0],n.middle=e[1]);break;case 3:n.top=e[0],n.middle=e[1],n.bottom=e[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return n}set mainHeaderLevel(n){this.data.mainHeaderLevel=n}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:this.data.headers.length===3?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get topHeader(){return this.headers[0]}get topUnit(){return this.topHeader.unit}get topIncrement(){return this.topHeader.increment}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:n}=this;return Math.round(g.asMilliseconds(n.increment||1,n.unit)/this.tickWidth)}get isValid(){const n=this;let e=!0;for(const t of n.headers)e=e&&!!g.normalizeUnit(t.unit);return n.timeResolution&&(e=e&&g.normalizeUnit(n.timeResolution.unit)),n.shiftUnit&&(e=e&&g.normalizeUnit(n.shiftUnit)),e}}D(I,"$name","ViewPreset"),I._$name="ViewPreset";const li={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{newEvent:"New event"},ResourceInfoColumn:{eventCountText:f=>f+" event"+(f!==1?"s":"")},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-Finish",EndToStart:"Finish-to-Start",EndToEnd:"Finish-to-Finish",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit event",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event",color:"Color"},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventCopyPaste:{copyEvent:"Copy event",cutEvent:"Cut event",pasteEvent:"Paste event"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS",name:"Seconds"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST",name:"Day"},day:{name:"Day/hours"},week:{name:"Week/hours"},dayAndWeek:{displayDateFormat:"ll LST",name:"Week/days"},dayAndMonth:{name:"Month"},weekAndDay:{displayDateFormat:"ll LST",name:"Week"},weekAndMonth:{name:"Weeks"},weekAndDayLetter:{name:"Weeks/weekdays"},weekDateAndMonth:{name:"Months/weeks"},monthAndYear:{name:"Months"},year:{name:"Years"},manyYears:{name:"Multiple years"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:f})=>`Weekly on ${f}`,"Monthly on {1}":({days:f})=>`Monthly on ${f}`,"Yearly on {1} of {2}":({days:f,months:n})=>`Yearly on ${f} of ${n}`,"Every {0} days":({interval:f})=>`Every ${f} days`,"Every {0} weeks on {1}":({interval:f,days:n})=>`Every ${f} weeks on ${n}`,"Every {0} months on {1}":({interval:f,days:n})=>`Every ${f} months on ${n}`,"Every {0} years on {1} of {2}":({interval:f,days:n,months:e})=>`Every ${f} years on ${n} of ${e}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:f,days:n})=>`${f} ${n}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each","On the":"On the","End repeat":"End repeat","time(s)":"time(s)"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{None:"No repeat",Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":f=>`Summary for ${f}`},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"},DurationColumn:{Duration:"Duration"}};It.publishLocale(li);class ie extends Lt(J){static get $name(){return"PresetStore"}static get defaultConfig(){return{useRawData:!0,modelClass:I,zoomOrder:1}}set storage(n){super.storage=n,this.storage.addSorter((e,t)=>{const i=e.bottomHeader,r=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||de[i.unit]-de[r.unit]||i.increment-r.increment)*this.zoomOrder})}get storage(){return super.storage}getById(n){return super.getById(n)||!this.isPresetManager&&W.getById(n)}createRecord(n,...e){let t;if(n.isViewPreset)return n;if(typeof n=="string")t=this.getById(n);else if(typeof n=="number")t=this.getAt(n);else return n.base&&(n=this.copyBaseValues(n)),super.createRecord(n,...e);if(!t)throw new Error(`ViewPreset ${n} does not exist`);return t}updateLocalization(){super.updateLocalization();const n=this;let e=n.allRecords;n.isPresetManager&&(e=new Set(e.concat(Object.values(n.basePresets)))),e.forEach(t=>{let i=n.optionalL(`L{PresetManager.${t.id}}`,null,!0);typeof i=="string"&&t.baseId&&(i=n.optionalL(`L{PresetManager.${t.baseId}}`,null,!0)),i&&typeof i=="object"&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),t.mainHeaderLevel===0&&i.topDateFormat&&(i.middleDateFormat=i.middleDateFormat||i.topDateFormat),t.setData("displayDateFormat",i.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach(r=>{const s=t.headerConfig[r],a=i[r+"DateFormat"];s&&(s.originalDateFormat||(s.originalDateFormat=s.dateFormat),a&&s.renderer&&(s.renderer=null),s.dateFormat=a||s.originalDateFormat)}),i.name?(t.unlocalizedName||(t.unlocalizedName=t.name),t.setData("name",i.name)):t.unlocalizedName&&t.unlocalizedName!==t.name&&(t.name=t.unlocalizedName,t.unlocalizedName=null))})}getCurrentConfig(n){return super.getCurrentConfig(n).data}copyBaseValues(n){let e=this.getById(n.base);if(!e)throw new Error(`ViewPreset base '${n.base}' does not exist.`);return e=x.clone(e.data),delete e.id,n.name&&delete e.name,x.merge(e,n)}add(n){return n=Array.isArray(n)?n:[n],n.forEach(e=>{e.isViewPreset&&e.base&&(e.data=this.copyBaseValues(e.originalData))}),super.add(...arguments)}}ie._$name="PresetStore";class ci extends ie{static get $name(){return"PresetManager"}static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"lll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:15},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer(n){return`
                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${g.format(n,"HH")}</span>
                                    <span class="b-sch-calendarcolumn-minutes">${g.format(n,"mm")}</span></div>
                                `}}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer(n){return`
                                    <div class="sch-calendarcolumn-ct">
                                    <span class="sch-calendarcolumn-hours">${g.format(n,"HH")}</span>
                                    <span class="sch-calendarcolumn-minutes">${g.format(n,"mm")}</span>
                                    </div>
                                `}}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer(n){return g.getShortNameOfUnit("week")+"."+g.format(n,"WW MMM YYYY")}},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer(n,e,t){return g.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(n.getMonth()/3)+1)}}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(n,e)=>n.getFullYear()+" - "+e.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:60,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}set basePresets(n){const e=this._basePresets={};for(const t in n)n[t].id=t,e[t]=this.createRecord(n[t])}get basePresets(){return this._basePresets}set defaultPresets(n){for(let e=0,{length:t}=n;e<t;e++){const i=n[e],r=typeof i=="string",s=r?i:i.base;let a;if(r)a=this.basePresets[s];else{const o=Object.setPrototypeOf(x.clone(this.basePresets[s].data),{id:s}),{timeResolution:l}=o,c=o.headers[o.headers.length-1];o.id=void 0,"width"in i&&(o.tickWidth=i.width),"height"in i&&(o.tickHeight=i.height),"increment"in i&&(c.increment=i.increment),"resolution"in i&&(l.increment=i.resolution),"resolutionUnit"in i&&(l.unit=g.getUnitByName(i.resolutionUnit)),a=this.createRecord(o),a.baseId=s}this.add(a)}}getById(n){return super.getById(n)||this.basePresets[n]}registerPreset(n,e){const t=this.createRecord(Object.assign({id:n},e)),i=this.find(r=>r.equals(t));if(i)return i;if(t.isValid)this.add(t);else throw new Error("Invalid preset, please check your configuration");return t}getPreset(n){return typeof n=="number"&&(n=this.getAt(n)),typeof n=="string"?n=this.getById(n):n instanceof I||(n=this.createRecord(n)),n}normalizePreset(n){const e=this;if(!(n instanceof I)){if(typeof n=="string"){if(n=e.getPreset(n),!n)throw new Error("You must define a valid view preset. See PresetManager for reference")}else if(typeof n=="object"){if(n.base){const t=this.getById(n.base);if(!t)throw new Error(`ViewPreset base '${n.base}' does not exist`);n=x.merge(x.clone(t.data),n)}n.id?n=e.createRecord(n):(n=e.createRecord(x.assign({},n)),n.id=n.generateId(n))}}return n}deletePreset(n){typeof n=="string"?n=this.getById(n):typeof n=="number"&&(n=this.getAt(n)),n&&(this.remove(n),delete this.basePresets[n.id])}}const W=new ci;class ui extends Ut{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}}class ve extends J{static get defaultConfig(){return{modelClass:ui,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,maxTraverseTries:100,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0}}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(n){const e=this;if(super.construct(n),e.originalContinuous=e.continuous,e.ion({change:({action:t})=>{t!=="filter"&&e.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>e.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:t=>e.trigger("reconfigure",t)}),e.startDate)e.internalOnReconfigure(),e.trigger("reconfigure");else if(e.viewPreset){const t=e.getAdjustedDates(new Date);e.startDate=t.startDate,e.endDate=t.endDate}}get isTimeAxis(){return!0}reconfigure(n,e=!1,t=!1){const i=this,r=i.getAdjustedDates(n.startDate,n.endDate),s={};if(i.trigger("beforeReconfigure",{startDate:r.startDate,endDate:r.endDate,config:n})!==!1){i.trigger("beginReconfigure"),i._configuredStartDate=n.startDate,i._configuredEndDate=n.endDate;for(const o in n)s[o]=i[o];const a=n.viewPreset&&n.viewPreset!==i.viewPreset;if(a&&(t=i.isFiltered,i.filters.forEach(o=>o.disabled=!1)),Object.assign(i,n),i.internalOnReconfigure(t,a)===!1)return!1;i.trigger("endReconfigure",{suppressRefresh:e,config:n,oldConfig:s})}}internalOnReconfigure(n=!1,e){const t=this;t.isConfigured=!0;const i=t.getAdjustedDates(t.startDate,t.endDate,!0),r=t.getAdjustedDates(t.startDate,t.endDate),s=r.startDate,a=r.endDate;if(s>=a)throw new Error(`Invalid start/end dates. Start date must be less than end date. Start date: ${s}. End date: ${a}.`);const{unit:o,increment:l=1}=t,c=t.generateTicks(s,a,o,l);t.suspendEvents(),t.maintainFilter=n,t.data=c,t.maintainFilter=!1;const{count:u}=t;if(u===0){if(n)return e&&t.disableFilters(),t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.endDate=t.last.endDate,t.resumeEvents(),t.isContinuous?(t.adjustedStart=i.startDate,t.adjustedEnd=g.getNext(u>1?c[u-1].startDate:i.startDate,o,l,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=t.endDate),t.updateVisibleTickBoundaries(),t.updateTickCache(!0)}updateVisibleTickBoundaries(){const n=this,{count:e,unit:t,startDate:i,endDate:r,weekStartDay:s,increment:a=1}=n,o=g.getNormalizedUnitDuration(i,t)*a,l=g.getNormalizedUnitDuration(r,t)*a;do n.visibleTickStart=(i-n.adjustedStart)/o,n.autoAdjust&&(n.visibleTickStart=Math.floor(n.visibleTickStart)),n.visibleTickStart>=1&&(n.adjustedStart=g.getNext(n.adjustedStart,t,a,s));while(n.visibleTickStart>=1);do n.visibleTickEnd=e-(n.adjustedEnd-r)/l,e-n.visibleTickEnd>=1&&(n.adjustedEnd=g.getNext(n.adjustedEnd,t,-1,s));while(e-n.visibleTickEnd>=1);n.fullTicks=!n.visibleTickStart&&n.visibleTickEnd===e}get viewPreset(){return this._viewPreset}set viewPreset(n){const e=this;if(n=W.getPreset(n),!(n instanceof I))throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");e._viewPreset=n,Object.assign(e,{unit:n.bottomHeader.unit,increment:n.bottomHeader.increment||1,resolutionUnit:n.timeResolution.unit,resolutionIncrement:n.timeResolution.increment,mainUnit:n.mainHeader.unit,shiftUnit:n.shiftUnit||n.mainHeader.unit,shiftIncrement:n.shiftIncrement||1,defaultSpan:n.defaultSpan||1,presetName:n.id,headers:n.headers})}get weekStartDay(){var n;return(n=this._weekStartDay)!=null?n:g.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(n){this.resolutionUnit=n.unit,this.resolutionIncrement=n.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(n,e,t=!1){e&&n-e===0&&(e=null);const i=this,{startDate:r,endDate:s}=i.getAdjustedDates(n,e);if(i.startDate-r!==0||i.endDate-s!==0)return i.reconfigure({startDate:r,endDate:s},!1,t)}shift(n,e=this.shiftUnit){const t=this;let{startDate:i,endDate:r}=t;t.isFiltered&&(i=t.allRecords[0].startDate,r=t.allRecords[t.allCount-1].endDate);let s=0;do i=g.add(i,n,e),r=g.add(r,n,e);while(s++<t.maxTraverseTries&&t.setTimeSpan(i,r,{preventThrow:!0})===!1)}shiftNext(n=this.shiftIncrement){this.shift(n)}shiftPrevious(n=this.shiftIncrement){this.shift(-n)}filterBy(n,e=this){this.filters.clear(),super.filterBy((i,r)=>n.call(e,i.data,r))}filter(){const n=this,e=super.filter(...arguments);return!n.maintainFilter&&n.count===0&&(n.resumeEvents(),n.trigger("invalidFilter"),n.disableFilters()),e}disableFilters(){this.filters.forEach(n=>n.disabled=!0),this.filter()}triggerFilterEvent(n){const e=this;n.filters.count?e.continuous=!1:e.continuous=e.originalContinuous,e.updateTickCache(),super.triggerFilterEvent(n)}get isContinuous(){return this.continuous!==!1&&!this.isFiltered}getAdjustedDates(n,e,t=!1){const i=this;return e&&n-e===0&&(e=null),n=n||i.startDate,e=e||g.add(n,i.defaultSpan,i.mainUnit),i.autoAdjust||t?{startDate:i.floorDate(n,!1,i.autoAdjust?i.mainUnit:i.unit,1),endDate:i.ceilDate(e,!1,i.autoAdjust?i.mainUnit:i.unit,1)}:{startDate:n,endDate:e}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(n){this._start=g.parse(n)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(n){n&&(this._end=g.parse(n))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(n,e,t,i){e=e!==!1;const r=this,s=e?g.clone(r.startDate):null,a=i||r.resolutionIncrement,o=t||(e?r.resolutionUnit:r.mainUnit),l=(u,d)=>Math.floor(u/d)*d;if(e){const u=l(g.diff(s,n,o),a);return g.add(s,u,o,!1)}const c=g.clone(n);if(o==="week"){const u=c.getDay()||7,d=r.weekStartDay||7;g.add(g.startOf(c,"day",!1),u>=d?d-u:-(7-d+u),"day",!1),c.getDay()!==d&&c.getHours()===23&&g.add(c,1,"hour",!1)}else{g.startOf(c,o,!1);const u=["day","year"].includes(o)?1:0,d=o==="day"?"date":o,h=l(g.get(c,d)-u,a)+u;g.set(c,d,h)}return c}roundDate(n,e,t=this.resolutionUnit,i=this.resolutionIncrement||1){const r=this,s=g.clone(n);switch(e=g.clone(e||r.startDate),t){case"week":{g.startOf(s,"day",!1);let a=s.getDay()-r.weekStartDay,o;return a<0&&(a=7+a),Math.round(a/7)===1?o=7-a:o=-a,g.add(s,o,"day",!1)}case"month":{const a=g.diff(e,s,"month")+g.as("month",s.getDay()/g.daysInMonth(s)),o=Math.round(a/i)*i;return g.add(e,o,"month",!1)}case"quarter":return g.startOf(s,"month",!1),g.add(s,3-s.getMonth()%3,"month",!1);default:{const a=g.as(t,g.diff(e,s)),o=g.as(t,e.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),l=Math.round((a+o)/i)*i;return g.add(e,l-o,t,!1)}}}ceilDate(n,e,t,i){const r=this;e=e!==!1,i=i||(e?r.resolutionIncrement:1);const s=t||(e?r.resolutionUnit:r.mainUnit),a=g.clone(n);let o=!1;switch(s){case"minute":o=!g.isStartOf(a,"minute");break;case"hour":o=!g.isStartOf(a,"hour");break;case"day":case"date":o=!g.isStartOf(a,"day");break;case"week":g.startOf(a,"day",!1),o=a.getDay()!==r.weekStartDay||!g.isEqual(a,n);break;case"month":g.startOf(a,"day",!1),o=a.getDate()!==1||!g.isEqual(a,n);break;case"quarter":g.startOf(a,"day",!1),o=a.getMonth()%3!==0||a.getDate()!==1||!g.isEqual(a,n);break;case"year":g.startOf(a,"day",!1),o=a.getMonth()!==0||a.getDate()!==1||!g.isEqual(a,n);break}return o?g.getNext(a,s,i,r.weekStartDay):a}get include(){return this._include}set include(n){const e=this;e._include=n,e.continuous=!n,e.isConfiguring||(e.startDate=e._configuredStartDate,e.endDate=e._configuredEndDate,e.internalOnReconfigure(),e.trigger("includeChange"))}processExclusion(n,e,t){const{include:i}=this;return i?Object.entries(i).some(([r,s])=>{if(!s)return!1;const{from:a,to:o}=s;if(g.compareUnits("day",t)>=0&&g.getLargerUnit(r)===t&&(a&&g.set(n,r,a),o)){let l=t;t==="day"&&(l="date"),g.set(e,{[l]:g.get(e,l)-1,[r]:o})}if(g.compareUnits(r,t)>=0){const l=r==="day"?n.getDay():g.get(n,r);if(a&&l<a||o&&l>=o)return!0}}):!1}initExclusion(){Object.entries(this.include).forEach(([n,e])=>{if(e){const{from:t,to:i}=e;e.lengthFactor=g.getUnitToBaseUnitRatio(n,g.getLargerUnit(n))/(i-t),e.lengthFactorExcl=g.getUnitToBaseUnitRatio(n,g.getLargerUnit(n))/(i-t-1),e.center=t+t/(e.lengthFactor-1)}})}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(n,e,t=this.unit,i=this.increment){const r=this,s=[],a=!!r.include;let o,l,c,u=0,{startDate:d,endDate:h}=r.getAdjustedDates(n,e);for(r.tickCache={},a&&r.initExclusion();d<h;){if(o=g.getNext(d,t,i,r.weekStartDay),!r.autoAdjust&&o>h&&(o=h),t==="hour"&&i>1&&s.length>0&&u===0){const m=s[s.length-1];u=(m.startDate.getHours()+i)%24-m.endDate.getHours(),u!==0&&(o=g.add(o,u,"hour"))}c=!1,a?(l=new Date(o.getTime()),c=r.processExclusion(d,o,t)):l=o,c||(s.push({id:s.length+1,startDate:d,endDate:o}),r.tickCache[d.getTime()]=s.length-1),d=l}return s}get visibleTickTimeSpan(){const n=this;return n.isContinuous?n.visibleTickEnd-n.visibleTickStart:n.count}getTickFromDate(n){var d;var e;const t=this,i=t.records,r=(d=(e=n.getTime)===null||e===void 0?void 0:e.call(n))!=null?d:n;let s=0,a=i.length-1,o,l,c,u;if(!i.length||r<i[0].startDateMS||r>i[a].endDateMS)return-1;if(t.isContinuous){for(;s<a;)o=s+a+1>>1,r>i[o].endDateMS?s=o+1:r<i[o].startDateMS?a=o-1:s=o;return l=i[s],c=l.startDateMS,r>c&&(u=l.endDateMS,s+=(r-c)/(u-c)),Math.min(Math.max(s,t.visibleTickStart),t.visibleTickEnd)}else for(let h=0;h<=a;h++)if(u=i[h].endDateMS,r<=u)return c=i[h].startDateMS,l=h+(r>c?(r-c)/(u-c):0),l}getSnappedTickFromDate(n){const e=Math.floor(this.getTickFromDate(n));return this.getAt(e)}getDateFromTick(n,e){const t=this;if(n===t.visibleTickEnd)return t.endDate;const i=Math.floor(n),r=n-i,s=t.getAt(i);if(!s)return null;const a=i===0&&t.isContinuous?t.adjustedStart:s.startDate,o=i===t.count-1&&t.isContinuous?t.adjustedEnd:s.endDate;let l=g.add(a,r*(o-a),"millisecond");return e&&(l=t[e+"Date"](l)),l}get ticks(){return this.records}updateTickCache(n=!1){const e=this;e.count?(e._start=e.first.startDate,e._end=e.last.endDate,e._startMS=e.startDate.getTime(),e._endMS=e.endDate.getTime()):e._start=e._end=e._startMs=e._endMS=null,n||(e.tickCache={},e.forEach((t,i)=>e.tickCache[t.startDate.getTime()]=i))}dateInAxis(n,e=!1){const t=this,i=t.startDate,r=t.endDate;if(t.isContinuous)return e?g.betweenLesserEqual(n,i,r):g.betweenLesser(n,i,r);{const s=t.getCount();let a,o,l;for(let c=0;c<s;c++)if(l=t.getAt(c),a=l.startDate,o=l.endDate,e&&n<=o||!e&&n<o)return n>=a}return!1}timeSpanInAxis(n,e){const t=this;return!e||e.getTime()===n.getTime()?this.dateInAxis(n,!0):t.isContinuous?g.intersectSpans(n,e,t.startDate,t.endDate):n<t.startDate&&e>t.endDate||t.getTickFromDate(n)!==t.getTickFromDate(e)}isTimeSpanInAxis(n){var l;const e=this,{startMS:t,endMS:i}=e,{startDateMS:r}=n,s=(l=n.endDateMS)!=null?l:n.meta.endDateCached;if(!r||!s)return!1;if(s===r)return e.dateInAxis(n.startDate,!0);if(e.isContinuous)return s>t&&r<i;const a=e.getTickFromDate(n.startDate),o=e.getTickFromDate(n.endDate);return a===e.count&&g.isEqual(n.startDate,e.last.endDate)||o===0&&g.isEqual(n.endDate,e.first.startDate)?!1:r<t&&s>i||a!==o}forEachAuxInterval(n,e=1,t,i=this){const r=this.endDate;let s=this.startDate,a=0,o;if(s>r)throw new Error("Invalid time axis configuration");for(;s<r;)o=g.min(g.getNext(s,n,e,this.weekStartDay),r),t.call(i,s,o,a,o>=r),s=o,a++}}ve._$name="TimeAxis";class pe extends Be(){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(n){const e=this;e.unitToPixelsCache={},super.construct(n);const t=e.timeAxis.viewPreset||e.viewPreset;if(t)if(t instanceof I)e.consumeViewPreset(t);else{const i=W.getPreset(t);i&&e.consumeViewPreset(i)}e.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:e}),e.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}calculateInfiniteScrollingDateRange(n,e,t=this.viewPreset){const{timeAxis:i,availableSpace:r}=this,{bufferCoef:s}=this.owner,{leafUnit:a,leafIncrement:o,topUnit:l,topIncrement:c,tickSize:u}=t,d=a===l&&Math.round(c)===c&&Math.round(o)===o,h=d?c:o,m=d?l:a;if(e){const v=Math.ceil((r*s+r/2)/u);return{startDate:i.floorDate(g.add(n,-v*o,a),!1,m,h),endDate:i.ceilDate(g.add(n,v*o,a),!1,m,h)}}else{const v=Math.ceil(r*s/u);return{startDate:i.floorDate(g.add(n,-v*o,a),!1,m,h),endDate:i.ceilDate(g.add(n,Math.ceil((r/u+v)*o),a),!1,m,h)}}}get columnConfig(){return this._columnConfig}set columnConfig(n){this._columnConfig=n}get headers(){return this._headers}set headers(n){if(n&&n.length&&n[n.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=n}get isTimeAxisViewModel(){return!0}get isHorizontal(){return this.mode!=="vertical"}get isVertical(){return this.mode==="vertical"}set forceFit(n){n!==this._forceFit&&(this._forceFit=n,this.update())}reconfigure(n){this.headers=null,this.setConfig(n),this.trigger("reconfigure")}onTimeAxisReconfigure({source:n,suppressRefresh:e}){this.viewPreset!==n.viewPreset&&this.consumeViewPreset(n.viewPreset),!e&&n.count>0&&this.update()}update(n,e=!1,t=!1){const i=this,{timeAxis:r,headers:s}=i,a=n!==0;if(i.isConfiguring||a&&i._availableSpace===n){t&&i.trigger("update");return}if(i._availableSpace=Math.max(n||i.availableSpace||0,0),typeof i.availableSpace!="number")throw new Error("Invalid available space provided to TimeAxisModel");i.columnConfig=[];const o=i._tickSize=i.calculateTickSize(i.originalTickSize);if(typeof o!="number"||o<=0)throw new Error("Invalid timeAxis tick size");i.unitToPixelsCache={},i._totalSize=null;for(let l=0,{length:c}=s;l<c;l++){const u=s[l];if(u.cellGenerator){const d=u.cellGenerator.call(i,r.startDate,r.endDate);i.columnConfig[l]=i.createHeaderRow(l,u,d)}else i.columnConfig[l]=i.createHeaderRow(l,u)}e||i.trigger("update")}getDistanceBetweenDates(n,e){return this.getPositionFromDate(e)-this.getPositionFromDate(n)}getDistanceForDuration(n){return this.getSingleUnitInPixels("millisecond")*n}getPositionFromDate(n,e={}){const t=this.getScaledTick(n,e);return t===-1?-1:this.tickSize*(t-this.timeAxis.visibleTickStart)}getScaledTick(n,{respectExclusion:e,snapToNextIncluded:t,isEnd:i,min:r,max:s}){const{timeAxis:a}=this,{include:o,unit:l}=a;let c=a.getTickFromDate(n);if(c!==-1&&e&&o){let u=!1;if(o.hour&&g.compareUnits(l,"hour")>0&&l!=="day"){const{from:d,to:h,lengthFactor:m,center:v}=o.hour,p=n.getHours(),S=Math.min(Math.max(p,d),h);if(!t&&S!==p)return-1;const y=S+n.getMinutes()/60,C=v-y,b=v-C*m;n=g.add(n,b-p,"h"),u=!0}if(o.day&&g.compareUnits(l,"day")>0){const{from:d,to:h,lengthFactor:m,center:v}=o.day;let p=n.getDay();i&&n.getHours()===0&&n.getMinutes()===0&&n.getSeconds()===0&&n.getMilliseconds()===0&&--p<0&&(p=6);let S=0;if(p<d||p>=h)if(t){if(i?S=(h-p-8)%7:S=(d-p+7)%7,n=g.add(n,S,"d"),n=g.startOf(n,"d",!1),s&&n.getTime()>=s||r&&n.getTime()<=r)return-1}else return-1;const{weekStartDay:y}=a,C=n.getDay()===0?0:v,b=n.getDay()+n.getHours()/24,w=C-b,M=C-w*m;n=g.add(n,M-b+y,"d"),u=!0}u&&(n=g.constrain(n,a.startDate,a.endDate),c=a.getTickFromDate(n))}return c}getDateFromPosition(n,e,t=!1){const i=this,{timeAxis:r}=i,s=i.getScaledPosition(n)/i.tickSize+r.visibleTickStart;if(s<0||s>r.count){if(t){let a;return s<0?a=g.add(r.startDate,s,r.unit):a=g.add(r.endDate,s-r.count,r.unit),e&&(a=r[e+"Date"](a)),a}return null}return r.getDateFromTick(s,e)}getScaledPosition(n){const{include:e,unit:t,weekStartDay:i}=this.timeAxis;if(e){const r=this.getSingleUnitInPixels("day");if(e.day&&g.compareUnits(t,"day")>0){const{from:s,lengthFactor:a}=e.day,o=n%(r*7),l=n-o;n=o/a+(s-i)*r+l}if(e.hour&&g.compareUnits(t,"hour")>0&&t!=="day"){const{from:s,lengthFactorExcl:a}=e.hour,o=this.getSingleUnitInPixels("hour"),l=n%r,c=n-l;n=l/a+s*o+c}}return n}getSingleUnitInPixels(n){const e=this;return e.unitToPixelsCache[n]||(e.unitToPixelsCache[n]=g.getUnitToBaseUnitRatio(e.timeAxis.unit,n,!0)*e.tickSize/e.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:n}=this.timeAxis;return(n.increment||1)*this.getSingleUnitInPixels(n.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(n){this.setTickSize(n,!1)}setTickSize(n,e){this._tickSize=this.originalTickSize=n,this.update(void 0,e)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(n){const e=this,{forceFit:t,timeAxis:i,suppressFit:r}=e,s=i.unit;let a=0,o=1;if(e.snap){const l=i.resolution;o=g.getUnitToBaseUnitRatio(s,l.unit)*l.increment}if(r)a=n;else{const l=e.availableSpace/i.visibleTickTimeSpan;a=t||n<l?l:n,o>0&&(!t||o<1)&&(a=Math.max(1,o*a)/o)}return a}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(n){const e=this;if(e._availableSpace=Math.max(0,n),e._availableSpace>0){const t=e.calculateTickSize(e.originalTickSize);t>0&&t!==e.tickSize&&e.update()}}getDates(n=this.columnLinesFor,e=!1,t=!1){const i=this,r=[],s=e?i.lowestHeader:n,a=i.majorHeaderLevel,o=i.headers&&i.headers[n].unit,l=a!=null&&i.headers&&i.headers[a].unit,c=a!=null&&g.doesUnitsAlign(l,o);if(!!(i.headers&&i.headers[s].cellGenerator)){const d=i.columnConfig[s];for(let h=1,m=d.length;h<m;h++)r.push({date:d[h].startDate})}else i.forEachInterval(s,(d,h)=>{r.push({date:t?h:d,isMajor:a!==n&&c&&i.isMajorTick(t?h:d)})});return r}get forceFit(){return this._forceFit}fitToAvailableSpace(n){const e=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(e,n)}get snap(){return this._snap}set snap(n){n!==this._snap&&(this._snap=n,this.configured&&this.update())}createHeaderRow(n,e,t){const i=this,r=[],{align:s,headerCellCls:a=""}=e,o=g.clearTime(new Date),{timeAxis:l}=i,c=i.headers.length-1,u=(h,m,v,p,S)=>{let y=g.format(h,e.dateFormat);const C=v>0&&!p,b={align:s,start:h,end:m,value:S?S.header:y,headerCellCls:a,width:c===n&&i.owner&&(l.fullTicks||C)?i.owner.tickSize:i.getDistanceBetweenDates(h,m),index:v};b.width!==0&&(b.coord=d-1,d+=b.width,i.headersDatesCache[n][h.getTime()]=1,e.renderer&&(y=e.renderer.call(e.thisObj||i,h,m,b,v),b.value=y==null?"":y),e.unit==="day"&&(!e.increment||e.increment===1)&&(b.headerCellCls+=" b-sch-dayheadercell-"+h.getDay(),g.clearTime(h,!0)-o===0&&(b.headerCellCls+=" b-sch-dayheadercell-today")),r.push(b))};let d=0;return i.headersDatesCache[n]={},t?t.forEach((h,m)=>u(h.start,h.end,m,m===t.length-1,h)):i.forEachInterval(n,u),r}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:n}=this;return n?Math.max(n.length-2,0):null}isMajorTick(n){const e=this.majorHeaderLevel;return e!=null&&this.headersDatesCache[e]&&this.headersDatesCache[e][n.getTime()]||!1}forEachInterval(n,e,t=this){const{headers:i,timeAxis:r}=this;if(i)if(n===i.length-1)r.forEach((s,a)=>e.call(t,s.startDate,s.endDate,a,a===r.count-1));else{const s=i[n];r.forEachAuxInterval(s.unit,s.increment,e,t)}}forEachMainInterval(n,e){this.forEachInterval(this.mainHeaderLevel,n,e)}consumeViewPreset(n){const e=this;e.headers=null,e.getConfig("tickSize"),e.viewPreset=n,Object.assign(e,{headers:n.headers,columnLinesFor:n.columnLinesFor,mainHeaderLevel:n.mainHeaderLevel,_tickSize:e.isHorizontal?n.tickWidth:n.tickHeight}),e.originalTickSize=e.tickSize}}pe._$name="TimeAxisViewModel";const qe=new Date;var Ze=f=>{var n;return n=class extends(f||R){getRtlX(t){return this.rtl&&this.isHorizontal&&(t=this.timeAxisViewModel.totalSize-t),t}getDateFromCoordinate(t,i,r=!0,s=!1,a=!1){return r||(t=this.currentOrientation.translateToScheduleCoordinate(t)),a||(t=this.getRtlX(t)),this.timeAxisViewModel.getDateFromPosition(t,i,s)}getDateFromCoord(t){return this.getDateFromCoordinate(t.coord,t.roundingMethod,t.local,t.allowOutOfRange,t.ignoreRTL)}getDateFromXY(t,i,r=!0,s=!1){return this.currentOrientation.getDateFromXY(t,i,r,s)}getDateFromDomEvent(t,i,r=!1){return this.getDateFromXY([t.pageX,t.pageY],i,!1,r)}getStartEndDatesFromRectangle(t,i,r,s=!1){const a=this,{isHorizontal:o}=a,l=o?t.x:t.top,c=o?t.right:t.bottom;let u,d;return l>=0&&c<a.timeAxisViewModel.totalSize?(u=a.getDateFromCoordinate(l,i,!0),d=a.getDateFromCoordinate(c,i,!0)):l<0?(d=a.getDateFromCoordinate(c,i,!0,s),u=d&&g.add(d,-r,"ms")):(u=a.getDateFromCoordinate(l,i,!0,s),d=u&&g.add(u,r,"ms")),{start:u,end:d}}getDisplayEndDate(t,i){return t.getHours()===0&&t.getMinutes()===0&&(!i||!(t.getYear()===i.getYear()&&t.getMonth()===i.getMonth()&&t.getDate()===i.getDate()))&&!g.formatContainsHourInfo(this.displayDateFormat)&&(t=g.add(t,-1,"day")),t}getFormattedEndDate(t,i){return this.getFormattedDate(this.getDisplayEndDate(t,i))}getCoordinateFromDate(t,i=!0){var r;const s=this,{timeAxisViewModel:a}=s,{isContinuous:o,startMS:l,endMS:c,startDate:u,endDate:d,unit:h}=s.timeAxis,m=t.valueOf();i===!0?i={local:!0}:i?"local"in i||(i.local=!0):i={local:!1};let v;if(t instanceof Date||(qe.setTime(t),t=qe),o&&t.getTimezoneOffset()===u.getTimezoneOffset()&&u.getTimezoneOffset()===d.getTimezoneOffset()&&g.getUnitToBaseUnitRatio(h,"day")!==-1){if(m<l||m>c)return-1;v=(m-l)/(c-l)*a.totalSize}else v=a.getPositionFromDate(t,i);return s.rtl&&s.isHorizontal&&!((r=i)!==null&&r!==void 0&&r.ignoreRTL)&&(v=a.totalSize-v),i.local||(v=s.currentOrientation.translateToPageCoordinate(v)),v}getTimeSpanDistance(t,i){return this.timeAxisViewModel.getDistanceBetweenDates(t,i)}get viewportCenterDate(){const{timeAxis:t,timelineScroller:i}=this;if(t.isContinuous){const r=(i.position+i.clientSize/2)/i.scrollSize;return new Date(t.startMS+(t.endMS-t.startMS)*r)}return this.getDateFromCoordinate(i.position+i.clientSize/2)}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(t){this.timeAxis.resolution=typeof t=="number"?{increment:t,unit:this.timeAxis.resolution.unit}:t}get snap(){var i;var t;return(i=(t=this._timeAxisViewModel)===null||t===void 0?void 0:t.snap)!=null?i:this._snap}updateSnap(t){this.isConfiguring||(this.timeAxisViewModel.snap=t,this.timeAxis.forceFullTicks=t&&this.fillTicks)}onSchedulerHorizontalScroll({subGrid:t,scrollLeft:i,scrollX:r}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}},D(n,"$name","TimelineDateMapper"),D(n,"configurable",{snap:!1}),n};const{eventNameMap:di}=L;var Ke=f=>{var n;return n=class extends(f||R){constructor(){super(...arguments);D(this,"hoveredEvents",new Set)}initDomEvents(){const i=this,{schedulerEvents:r}=i;r.element=i.timeAxisSubGridElement,r.thisObj=i,L.on(r),L.on({element:i.timeAxisSubGridElement,mouseleave:"handleScheduleLeaveEvent",capture:!0,thisObj:i}),i.updateTimelineContextOnScroll&&z.supportsPointerEventConstructor&&L.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:i})}getTimeSpanMouseEventParams(i,r){throw new Error("Implement in subclass")}getScheduleMouseEventParams(i,r){throw new Error("Implement in subclass")}handleScheduleEvent(i){const r=this;if(r.ignoreDomEventsWhileScrolling&&(r.scrolling||r.timeAxisSubGrid.scrolling))return;const s=r.getTimelineEventContext(i);r.lastPointerEvent=i,s&&r.trigger(`${s.eventElement?r.scheduledEventName:"schedule"}${di[i.type]||k.capitalize(i.type)}`,s),r.timelineContext=s}handleScheduleLeaveEvent(i){i.target===this.timeAxisSubGridElement&&this.handleScheduleEvent(i)}onScheduleScroll({target:i}){var l,c;var r;const s=this;if(i&&s.updateTimelineContextOnScroll&&!((r=s.features.pan)!==null&&r!==void 0&&r.isActive)&&!s.partners.some(u=>{var d;return(d=u.features.pan)===null||d===void 0?void 0:d.isActive})&&(i.contains(s.element)||s.bodyElement.contains(i))){const{timelineContext:u,lastPointerEvent:d}=s;if(u){var a,o;const h=A.elementFromPoint(u.domEvent.clientX,u.domEvent.clientY),m=new z.PointerEventConstructor("pointermove",d),v=new MouseEvent("mousemove",d);Object.defineProperty(m,"pointerId",{value:(c=(l=(a=Q.currentPointerDown)===null||a===void 0?void 0:a.pointerId)!=null?l:(o=Q.currentTouch)===null||o===void 0?void 0:o.identifier)!=null?c:1}),m.scrollInitiated=v.scrollInitiated=!0,h==null||h.dispatchEvent(m),h==null||h.dispatchEvent(v)}}}updateTimelineContext(i,r){this.trigger("timelineContextChange",{oldContext:r,context:i}),i&&!r?this.trigger("scheduleMouseEnter",i):i||this.trigger("scheduleMouseLeave",{event:r.event})}getTimelineEventContext(i){const r=this,s=i.target.closest(r.eventInnerSelector),a=r.getCellElementFromDomEvent(i);if(a){const o=r.getDateFromDomEvent(i,"floor");if(!o)return;const l=zt.get(a),c=s?r.getTimeSpanMouseEventParams(s,i):r.getScheduleMouseEventParams(l,i);if(!c)return;const u=r.isVertical?r.resourceStore.indexOf(c.resourceRecord):l.row.dataIndex,d=r.timeAxis.getTickFromDate(o),h=r.timeAxis.getAt(Math.floor(d));if(h)return{isTimelineContext:!0,domEvent:i,eventElement:s,cellElement:a,index:u,tick:h,tickIndex:d,date:o,tickStartDate:h.startDate,tickEndDate:h.endDate,tickParentIndex:h.parentIndex,row:l.row,event:i,...c}}}getCellElementFromDomEvent({target:i,clientY:r,type:s}){const a=this,{isVertical:o,foregroundCanvas:l}=a,c=i.closest(a.eventSelector);if(c)return a.getCell({[o?"row":"record"]:o?0:a.resolveRowRecord(c),column:a.timeAxisColumn});if(l.contains(i)){if(i===l||s==="mousemove"){var u;return(u=a.rowManager.getRowAt(r,!1))===null||u===void 0?void 0:u.getCell(a.timeAxisColumn.id)}}else return i.matches(".b-grid-row")?i.firstElementChild:i.closest(a.timeCellSelector)}matchScheduleCell(i){return i.closest(this.timeCellSelector)}onElementMouseButtonEvent(i){const r=i.target.closest(".b-sch-header-timeaxis-cell");if(r){const s=this,a=r.parentElement.dataset.headerPosition,o=s.timeAxisViewModel.columnConfig[a],l=s.timeAxis.isFiltered?o.findIndex(d=>d.index==r.dataset.tickIndex):r.dataset.tickIndex,c=o[l],u=s.features.contextMenu;(!u||i.type!==u.triggerEvent)&&this.trigger(`timeAxisHeader${k.capitalize(i.type)}`,{startDate:c.start,endDate:c.end,event:i})}}onElementMouseDown(i){this.onElementMouseButtonEvent(i),super.onElementMouseDown(i)}onElementClick(i){this.onElementMouseButtonEvent(i),super.onElementClick(i)}onElementDblClick(i){this.onElementMouseButtonEvent(i),super.onElementDblClick(i)}onElementContextMenu(i){this.onElementMouseButtonEvent(i),super.onElementContextMenu(i)}onElementMouseOver(i){var r;const s=this;if(s.ignoreDomEventsWhileScrolling&&(s.scrolling||s.timeAxisSubGrid.scrolling))return;super.onElementMouseOver(i);const{target:a}=i,{hoveredEvents:o}=s;if(a.closest(s.eventInnerSelector)&&!((r=s.features.eventDrag)!==null&&r!==void 0&&r.isDragging)){const l=a.closest(s.eventSelector);if(!o.has(l)&&!s.preventOverCls){o.add(l),l.classList.add(s.overScheduledEventClass);const c=s.getTimeSpanMouseEventParams(l,i);c&&s.trigger(`${s.scheduledEventName}MouseEnter`,c)}}else o.size&&s.unhoverAll(i)}onElementMouseOut(i){var r;super.onElementMouseOut(i);const s=this,{target:a,relatedTarget:o}=i,l=a.closest(s.eventInnerSelector),c=a.closest(s.eventSelector),u=s.resolveTimeSpanRecord(a);if(l&&u&&s.hoveredEvents.has(c)&&!((r=s.features.eventDrag)!==null&&r!==void 0&&r.isDragging)){if(o&&A.isDescendant(l,o))return;s.unhover(c,i)}}unhover(i,r){const s=this;i.classList.remove(s.overScheduledEventClass),s.trigger(`${s.scheduledEventName}MouseLeave`,s.getTimeSpanMouseEventParams(i,r)),s.hoveredEvents.delete(i)}unhoverAll(i){for(const r of this.hoveredEvents)!r.isReleased&&!r.classList.contains("b-released")&&this.unhover(r,i);this.hoveredEvents.clear()}get widgetClass(){}},D(n,"$name","TimelineDomEvents"),D(n,"configurable",{timelineContext:{$config:{equal(i,r){return(i==null?void 0:i.index)===(r==null?void 0:r.index)&&(i==null?void 0:i.tickParentIndex)===(r==null?void 0:r.tickParentIndex)&&!(((i==null?void 0:i.tickStartDate)||0)-((r==null?void 0:r.tickStartDate)||0))}}},updateTimelineContextOnScroll:!0,ignoreDomEventsWhileScrolling:null}),D(n,"properties",{schedulerEvents:{pointermove:"handleScheduleEvent",mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"}}),D(n,"delayable",{onScheduleScroll:"raf"}),n};const q=(f=0,n=0)=>n-f;var Xe=f=>class extends(f||R){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(e){const t={owner:this};let i=[];if(e===!0)i=W.allRecords;else if(Array.isArray(e))for(const s of e)if(typeof s=="string"){const a=W.getById(s);a&&i.push(a)}else i.push(s);else x.assign(t,e);const r=new ie(t);return r.add(i),r}changeViewPreset(e,t){const i=this,{presets:r}=i;e?(e=r.createRecord(e),r.includes(e)||r.add(e)):e=r.first;const s=i.lastViewPresetOptions||{},a=e.options||(e.options={}),o=a.event={startDate:a.startDate,endDate:a.endDate,from:t,to:e,preset:e},l=!i._viewPreset||!i._viewPreset.equals(e),c=q(a.startDate,s.startDate)||q(a.endDate,s.endDate)||q(a.centerDate,s.centerDate)||a.startDate&&q(a.startDate,i.startDate)||a.endDate&&q(a.endDate,i.endDate);if((l||c)&&(l||(i._viewPreset=null),i.isConfiguring||i.trigger("beforePresetChange",o)!==!1))return e}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateDisplayDateFormat(e){this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return g.format(e,this.displayDateFormat)}updateViewPreset(e){var t;const i=this,{options:r}=e,{event:s,startDate:a,endDate:o}=r,{isHorizontal:l,_timeAxis:c,_timeAxisViewModel:u}=i,d=l&&i.rtl;let{centerDate:h,zoomDate:m,zoomPosition:v}=r,p=!1;if((t=i.syncSplits)===null||t===void 0||t.call(i,S=>S.viewPreset=e),delete e.options,i._viewPresetChanging=!0,c&&!i.isConfiguring){const{timelineScroller:S}=i;if(i.lastViewPresetOptions=r,c.isConfigured){i.suspendRefresh();const y=x.copyProperties({},i,["weekStartDay","startTime","endTime"]);i.infiniteScroll?Object.assign(y,u.calculateInfiniteScrollingDateRange(h||new Date((a.getTime()+o.getTime())/2),!0,e)):a?(y.startDate=a,y.endDate=o,!h&&o&&(h=new Date((a.getTime()+o.getTime())/2))):(y.startDate=c.startDate,y.endDate=o||c.endDate,h||(h=i.viewportCenterDate)),c.isConfigured=!1,y.viewPreset=e,c.reconfigure(y,!0),u.reconfigure({viewPreset:e,headers:e.headers,columnLinesFor:e.columnLinesFor!=null?e.columnLinesFor:e.headers.length-1,tickSize:l?e.tickWidth:e.tickHeight||e.tickWidth||60}),i.resumeRefresh(!1)}if(i.refresh(),!r.notScroll&&i.isPainted)if(r.visibleDate)i.visibleDate=r.visibleDate;else if(m&&v){const y=de[c.resolutionUnit],C=y>3?"hour":"minute",b=g.asMilliseconds(C==="minute"?15:1,C),w=new Date(Math.round(m/b)*b);s.zoomDate=m,s.zoomPosition=v,s.zoomLevel=r.zoomLevel,d?S.position=S.scrollWidth-(i.getCoordinateFromDate(w)+v):S.position=i.getCoordinateFromDate(w)-v}else if(h){i.cachedCenterDate=h,s.centerDate=h;const y=i.timelineScroller.clientSize,C=d?i.timeAxisViewModel.totalSize-i.getCoordinateFromDate(h,!0):i.getCoordinateFromDate(h,!0),b=Math.max(C-y/2,0);i.scrollingToCenter=!0,b===(i.isHorizontal?i.scrollLeft:i.scrollTop)?p=!0:i.isHorizontal?i.scrollHorizontallyTo(b,!1):i.scrollVerticallyTo(b,!1),i.setTimeout(()=>{i.scrollingToCenter=!1},100)}else(i.isHorizontal?i.scrollLeft:i.scrollTop)===0?p=!0:i.timelineScroller.scrollTo(0)}i.dataset.presetId=e.id,i.trigger("presetChange",s),i._viewPresetChanging=!1,p&&(i.isHorizontal?i.currentOrientation.updateFromHorizontalScroll(i.scrollLeft,!0):i.currentOrientation.updateFromVerticalScroll(i.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.viewPreset&&t.viewPreset.name&&!t.viewPreset.base&&delete t.viewPreset.name,t}get widgetClass(){}},Je=f=>{var n;return n=class extends(f||R){constructor(){super(...arguments);D(this,"lastWheelTime",-1);D(this,"lastZoomPosition",-1)}construct(i){const r=this;super.construct(i),r.zoomOnMouseWheel&&L.on({element:r.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:s=>s.ctrlKey&&s.preventDefault()},thisObj:r,capture:!0,passive:!1}),r.zoomOnTimeAxisDoubleClick&&r.ion({timeaxisheaderdblclick:({startDate:s,endDate:a})=>{r.forceFit||r.zoomToSpan({startDate:s,endDate:a})}})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(i){if(typeof i!="number"&&(i=this.presets.count-1),i<0||i>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=i}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(i){if(typeof i!="number"&&(i=0),i<0||i>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=i}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(i){this.zoomToLevel(i)}getMilliSecondsPerPixelForZoomLevel(i,r){const{bottomHeader:s}=i,a=this.isHorizontal?i.tickWidth:i.tickHeight;return Math.round((g.add(new Date(1,0,1),s.increment||1,s.unit)-new Date(1,0,1))/(r?a:i.actualWidth||a))}zoomTo(i){const r=this;typeof i=="object"?i.preset?r.zoomToLevel(i.preset,i):i.level!=null?r.zoomToLevel(i.level,i):r.zoomToSpan(i):r.zoomToLevel(i)}zoomToLevel(i,r={}){if(this.forceFit){console.warn("Warning: The forceFit setting and zooming cannot be combined");return}typeof i=="number"&&(i=Math.min(Math.max(i,this.minZoomLevel),this.maxZoomLevel));const s=this,{presets:a}=s,o=s.isVertical?"tickHeight":"tickWidth",l=a.createRecord(i),c=l[o],u=r.startDate?new Date(r.startDate):null,d=r.endDate?new Date(r.endDate):null;a.add(l);let h=u&&d?{startDate:u,endDate:d}:null;const m=r.centerDate?new Date(r.centerDate):h?new Date((u.getTime()+d.getTime())/2):s.viewportCenterDateCached;let v=s.isVertical?s.scrollable.clientHeight:s.timeAxisSubGrid.width;if(v===0){const{_beforeCollapseState:p}=s.timeAxisSubGrid;if(s.isHorizontal&&s.timeAxisSubGrid.collapsed&&p!==null&&p!==void 0&&p.width)v=p.width;else return null}return h||(h=s.calculateOptimalDateRange(m,v,l)),"width"in r&&l.setData(o,r.width),s.isZooming=!0,l.options={...r,startDate:h.startDate||s.startDate,endDate:h.endDate||s.endDate,centerDate:m},s.viewPreset=l,l.actualWidth=s.timeAxisViewModel.tickSize,s.isZooming=!1,l.setData(o,c),s.zoomLevel}zoomToFit(i){const r=this.eventStore,s=r.getTotalTimeSpan();i={leftMargin:0,rightMargin:0,...i,...s},i.startDate&&i.endDate&&(i.endDate>i.startDate?this.zoomToSpan(i):this.scrollToDate(i.startDate))}zoomToSpan(i={}){if((i.leftMargin||i.rightMargin)&&(i.adjustStart=0,i.adjustEnd=0),i.leftMargin||(i.leftMargin=0),i.rightMargin||(i.rightMargin=0),!i.startDate||!i.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const r=this,{timeAxis:s}=r,a=i.adjustStart>=0||i.adjustEnd>=0;let{startDate:o,endDate:l}=i;if(a&&(o=g.add(o,-i.adjustStart,s.mainUnit),l=g.add(l,i.adjustEnd,s.mainUnit)),o<=l){const{availableSpace:c}=r.timeAxisViewModel,u=r.presets.allRecords,d=l-o||1;let h=r.zoomLevel,m,v;h===-1&&(h=0);let p=r.getMilliSecondsPerPixelForZoomLevel(u[h],!0),S=h+(m=d/p+i.leftMargin+i.rightMargin>c?-1:1),y,C=null;for(;S>=0&&S<=u.length-1;){y=u[S],p=r.getMilliSecondsPerPixelForZoomLevel(y,!0);const E=d/p+i.leftMargin+i.rightMargin;if(m===-1){if(E<=c){C=S;break}}else if(E<=c)h!==S-m&&(C=S);else break;S+=m}C=C!=null?C:S-m,y=u[C];const b=y.bottomHeader.unit;p=r.getMilliSecondsPerPixelForZoomLevel(y,!0),(i.leftMargin||i.rightMargin)&&(o=new Date(o.getTime()-p*i.leftMargin),l=new Date(l.getTime()+p*i.rightMargin));const w=g.getDurationInUnit(o,l,b,!0)/y.bottomHeader.increment;if(w===0)return null;const M=Math.floor(c/w),T=i.centerDate||new Date((o.getTime()+l.getTime())/2);a?v={startDate:o,endDate:l}:v=r.calculateOptimalDateRange(T,c,y);let F=r.zoomLevel;return r.zoomLevel===C?s.reconfigure(v):F=r.zoomToLevel(C,Object.assign(v,{width:M,centerDate:T})),r.infiniteScroll&&r.scrollToDate(o,{block:"start"}),F}return null}zoomIn(i=1,r){typeof i=="object"&&(r=i,i=1);const s=this.zoomLevel;return s>=this.maxZoomLevel?null:this.zoomToLevel(s+i,r)}zoomOut(i=1,r){typeof i=="object"&&(r=i,i=1);const s=this.zoomLevel;return s<=this.minZoomLevel?null:this.zoomToLevel(s-i,r)}zoomInFull(i){return this.zoomToLevel(this.maxZoomLevel,i)}zoomOutFull(i){return this.zoomToLevel(this.minZoomLevel,i)}calculateOptimalDateRange(i,r,s,a){if(a)return a;const o=this,{timeAxis:l}=o,{bottomHeader:c}=s,u=o.isHorizontal?s.tickWidth:s.tickHeight;if(o.zoomKeepsOriginalTimespan)return{startDate:l.startDate,endDate:l.endDate};const d=c.unit,h=Math.ceil(r/u*c.increment*o.visibleZoomFactor/2),m=g.add(i,-h,d),v=g.add(i,h,d);return o.infiniteScroll?o.timeAxisViewModel.calculateInfiniteScrollingDateRange(i,!0):{startDate:l.floorDate(m,!1,d,c.increment),endDate:l.ceilDate(v,!1,d,c.increment)}}onElementMouseMove(i){const{isHorizontal:r,zoomContext:s}=this;super.onElementMouseMove(i),i.isTrusted&&s&&Math.abs(i[`client${r?"X":"Y"}`]-s.coordinate)>10&&(this.zoomContext=null)}async onWheel(i){if(i.ctrlKey&&!this.forceFit){i.preventDefault();const r=this,{zoomContext:s,isHorizontal:a,timelineScroller:o,zoomLevel:l}=r,c=performance.now(),u=i[`client${a?"X":"Y"}`];let d=u-o.viewport[`${a?"x":"y"}`];a&&r.rtl&&(d=o.viewport.width+o.viewport.x-u),c-r.lastWheelTime>200||!s||Math.abs(u-r.zoomContext.coordinate)>20?r.zoomContext={zoomLevel:l,coordinate:u,zoomPosition:d,zoomDate:r.getDateFromDomEvent(i)}:(l>s.zoomLevel&&(s.zoomDate=r.getDateFromDomEvent(i),s.zoomLevel=l),s.zoomPosition=d),r.lastWheelTime=c,r[`zoom${i.deltaY>0?"Out":"In"}`](void 0,r.zoomContext)}}setTimeSpan(i,r){this.timeAxis.setTimeSpan(i,r)}shift(i,r){this.timeAxis.shift(i,r)}shiftNext(i){this.timeAxis.shiftNext(i)}shiftPrevious(i){this.timeAxis.shiftPrevious(i)}get widgetClass(){}},D(n,"$name","TimelineZoomable"),D(n,"defaultConfig",{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}),n};class Se extends Ot{static get $name(){return"RecurrenceConfirmationPopup"}static get type(){return"recurrenceconfirmation"}static get defaultConfig(){return{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:this},items:{changeSingleButton:{weight:100,cls:"b-raised",color:"b-blue",text:"L{update-only-this-btn-text}",onClick:"up.onChangeSingleButtonClick"},changeMultipleButton:{weight:200,color:"b-green",text:"L{Object.Yes}",onClick:"up.onChangeMultipleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}onRecurrenceClose(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}confirm(n={}){const e=this;return["actionType","eventRecord","title","html","changerFn","cancelFn","finalizerFn","thisObj"].forEach(t=>{t in n&&(e[t]=n[t])}),e.updatePopupContent(),super.show(n)}updatePopupContent(){const n=this,{changeMultipleButton:e,changeSingleButton:t,cancelButton:i}=n.widgetMap,{eventRecord:r,actionType:s="update"}=n;(r==null?void 0:r.isRecurring)?(e.text=n.L("L{Object.Yes}"),n.html=n.L(`${s}-all-message`)):(e.text=n.L(`${s}-further-btn-text`),n.html=n.L(`${s}-further-message`)),t.text=n.L(`${s}-only-this-btn-text`),i.text=n.L("L{Object.Cancel}"),n.width=n.L("L{width}"),n.title=n.L(`${s}-title`)}processMultipleRecords(){const{eventRecord:n,changerFn:e,thisObj:t,finalizerFn:i}=this;n.beginBatch(),e&&this.callback(e,t,[n]),n.endBatch(),i&&this.callback(i,t,[n])}processSingleRecord(){var n;const{eventRecord:e,changerFn:t,thisObj:i,finalizerFn:r}=this;e.beginBatch();let s;e!=null&&e.isRecurring&&e.recurrence.forEachOccurrence(e.startDate,null,(a,o,l)=>{if(l>1)return s=a,!1}),(n=s)===null||n===void 0||n.convertToRealEvent(),e.recurrence=null,t&&this.callback(t,i,[e]),e.recurrenceRule=null,e.endBatch(),r&&this.callback(r,i,[e])}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}}Se.initClass(),Se._$name="RecurrenceConfirmationPopup";var Qe=f=>{var n;return n=class extends(f||R){construct(t){super.construct(t),this.ion({beforeEventDropFinalize:"onRecurrableBeforeEventDropFinalize",beforeEventResizeFinalize:"onRecurrableBeforeEventResizeFinalize",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete"})}changeRecurrenceConfirmationPopup(t,i){const r=this.constructor.reconfigure(i,t,"recurrenceconfirmation");return r.owner=this,r}findRecurringEventToConfirmDelete(t){return t.find(i=>i.supportsRecurring&&(i.isRecurring||i.isOccurrence))}onRecurrableAssignmentBeforeDelete({assignmentRecords:t,context:i}){const r=t.map(a=>a.event),s=this.findRecurringEventToConfirmDelete(r);if(this.enableRecurringEvents&&s)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:s,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}}),!1}onRecurrableBeforeEventDropFinalize({context:t}){if(this.enableRecurringEvents){const{eventRecords:i}=t,r=i.filter(s=>s.supportsRecurring&&(s.isRecurring||s.isOccurrence));r.length&&(t.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:r[0],changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}))}}onRecurrableBeforeEventResizeFinalize({context:t}){if(this.enableRecurringEvents){const{eventRecord:i}=t;i.supportsRecurring&&(i.isRecurring||i.isOccurrence)&&(t.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:i,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}))}}onAssignmentChange({action:t,records:i}){if(t!=="dataset"&&Array.isArray(i))for(const s of i){var r;(r=s.event)!==null&&r!==void 0&&r.isRecurring&&!s.event.isBatchUpdating&&s.event.removeOccurrences()}}getOccurrencesFor(t){return this.eventStore.getOccurrencesForTimeSpan(t,this.timeAxis.startDate,this.timeAxis.endDate)}async removeEvents(t,i=null,r=this){const s=this;if(!s.readOnly&&t.length){const a={finalize(l=!0){i&&i(l),l!==!1&&(t.some(c=>{var u;return c.isOccurrence||((u=c.event)===null||u===void 0?void 0:u.isOccurrence)})?t.forEach(c=>c.isOccurrenceAssignment?c.event.remove():c.remove()):(t[0].isAssignment?s.assignmentStore:s.eventStore).remove(t))}};let o;if(t[0].isAssignment?o=s.trigger("beforeAssignmentDelete",{assignmentRecords:t,context:a}):o=await s.trigger("beforeEventDelete",{eventRecords:t,context:a}),o!==!1){const l=t.find(c=>c.isRecurring||c.isOccurrence);return l?(s.recurrenceConfirmationPopup.owner=r,s.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:l,changerFn(){a.finalize(!0)},cancelFn(){a.finalize(!1)}})):a.finalize(!0),!0}}return!1}get widgetClass(){}},D(n,"$name","RecurringEvents"),D(n,"configurable",{enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}}),n},et=f=>{var n;return n=class extends(f||R){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed"}}updateFillTicks(t){this.isConfiguring||(this.timeAxis.forceFullTicks=t&&this.snap,this.refreshWithTransition(),this.trigger("stateChange"))}changeBarMargin(t){return x.assertNumber(t,"barMargin"),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),t):t}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return this._resourceMargin==null?this.barMargin:this._resourceMargin}changeResourceMargin(t){return x.assertNumber(t,"resourceMargin"),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),t):t}updateResourceMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition())}changeTickSize(t){return x.assertNumber(t,"tickSize"),t}updateTickSize(t){this.timeAxisViewModel.tickSize=t}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","magenta","violet","indigo","blue","cyan","teal","green","gantt-green","lime","yellow","orange","deep-orange","gray","light-gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}updateEventStyle(t){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}updateEventColor(t){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}get widgetClass(){}},D(n,"configurable",{barMargin:10,fillTicks:!1,resourceMargin:null,eventColor:"green",eventStyle:"plain",tickSize:null}),n};const hi={maintainVisibleStart:!0},mi={block:"nearest"};var tt=f=>class extends(f||R){static get $name(){return"TimelineScroll"}static get configurable(){return{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}}initScroll(){const e=this,{isHorizontal:t,visibleDate:i}=e;super.initScroll();const{scrollable:r}=t?e.timeAxisSubGrid:e;if(r.ion({scroll:"onTimelineScroll",thisObj:e}),e.infiniteScroll){const s=i?{...i,visibleDate:i.date}:{visibleDate:e.viewportCenterDate,block:"center"},{startDate:a,endDate:o}=e.timeAxisViewModel.calculateInfiniteScrollingDateRange(s.visibleDate,s.block==="center");e.setTimeSpan(a,o,s)}}get timelineScroller(){const e=this;return e.scrollInitialized||e.initScroll(),e._timelineScroller||(e._timelineScroller=new gi({widget:e,scrollable:e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable,isHorizontal:e.isHorizontal}))}doDestroy(){var e;(e=this._timelineScroller)===null||e===void 0||e.destroy(),super.doDestroy()}onTimelineScroll({source:e}){this.infiniteScroll&&this.checkTimeAxisScroll(e[this.isHorizontal?"x":"y"])}checkTimeAxisScroll(e){const t=this,i=t.timelineScroller,{clientSize:r}=i,s=r*t.bufferCoef,a=s*t.bufferThreshold,o=i.maxPosition,{style:l}=t.timeAxisSubGrid.virtualScrollerElement;(o-e<a||e<a)&&(l.overflow="hidden",l.pointerEvents="none",l.paddingBottom=`${A.scrollBarWidth}px`,t.setTimeout(()=>{l.overflow="",l.paddingBottom="",l.pointerEvents=""},100),t.shiftToDate(t.getDateFromCoordinate(e,null,!0,!1,!0)))}shiftToDate(e,t){const i=this.timeAxisViewModel.calculateInfiniteScrollingDateRange(e,t);this.setTimeSpan(i.startDate,i.endDate,hi)}updateInfiniteScroll(e){!this.isConfiguring&&e&&this.checkTimeAxisScroll(this.timelineScroller.position)}async scrollToDate(e,t={}){const i=this,{timeAxis:r,visibleDateRange:s,infiniteScroll:a}=i,{unit:o,increment:l}=r,c=t.edgeOffset||0,u=g.ceil(s.endDate,l+" "+o)-g.floor(s.startDate,l+" "+o),d=e>i.viewportCenterDate?1:-1,h=(a?u*i.bufferCoef*i.bufferThreshold:t.block==="center"?u/2:c?i.getMilliSecondsPerPixelForZoomLevel(i.viewPreset)*c:0)*d,m=new Date(e.getTime()+h);(m>r.endDate?1:m<r.startDate?-1:0)&&i.infiniteScroll&&(i.shiftToDate(new Date(e-h),null,!0),await i.nextAnimationFrame());const p=i.timelineScroller.viewport,S=i.getCoordinateFromDate(e,!0),y=Math.min(i.timeAxisViewModel.tickSize,i.timeAxisViewModel.availableSpace),C=i.isHorizontal?new P(i.getCoordinateFromDate(e,!1)-(i.rtl?y:0),p.y,y,p.height):new P(p.x,i.getCoordinateFromDate(e,!1),p.width,i.timeAxisViewModel.tickSize);await i.scrollToCoordinate(S,C,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}async scrollToCoordinate(e,t,i,r={}){const s=this;if(e<0){const a=s.endDate-s.startDate,{unit:o,increment:l}=s.timeAxis,c=g.floor(new Date(i.getTime()-a/2),l+" "+o),u=g.add(c,a);return c-s.startDate!==0&&u-s.endDate!==0?(s.setTimeSpan(c,u),s.scrollToDate(i,r)):void 0}return await s.timelineScroller.scrollIntoView(t,r),!s.isDestroyed&&s.nextAnimationFrame()}set scrollLeft(e){this.timeAxisSubGrid.scrollable.element.scrollLeft=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(e){this.timeAxisSubGrid.scrollable.x=e}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(e){this.scrollable.y=e}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){return this.scrollable.scrollTo(null,e,t)}scrollTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}};class gi extends Ht{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(n){super.onScroll(n),this._position=null}syncPartners(n){this.scrollable.syncPartners(n)}updatePosition(n){this.scrollable[this.isHorizontal?"x":"y"]=n}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable[`client${this.isHorizontal?"Width":"Height"}`]}get scrollSize(){return this.scrollable[`scroll${this.isHorizontal?"Width":"Height"}`]}get maxPosition(){return this.scrollable[`max${this.isHorizontal?"X":"Y"}`]}scrollTo(n,e){return this.isHorizontal?this.scrollable.scrollTo(n,null,e):this.scrollable.scrollTo(null,n,e)}scrollBy(n=0,e=0,t=mi){return this.isHorizontal?this.scrollable.scrollBy(n||e,0,t):this.scrollable.scrollBy(0,e||n,t)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(n){this.position=n}changeY(n){this.position=n}get x(){return this.position}set x(n){this.scrollable[this.isHorizontal?"x":"y"]=n}get y(){return this.position}set y(n){this.scroller[this.isHorizontal?"x":"y"]=n}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}}const it=["barMargin"];var nt=f=>class extends(f||R){static get $name(){return"TimelineState"}getState(){const e=this,t=x.copyProperties(super.getState(),e,it);return t.zoomLevel=e.zoomLevel,t.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,centerDate:!e.infiniteScroll||e.timeAxisViewModel.availableSpace?e.viewportCenterDate:void 0,width:e.tickSize},t}applyState(e){const t=this;if(t.suspendRefresh(),x.copyProperties(t,e,it),super.applyState(e),e.zoomLevel!=null){if(t.infiniteScroll){var i;e!=null&&(i=e.scroll)!==null&&i!==void 0&&i.scrollLeft&&(e.scroll.scrollLeft={})}t.isPainted?t.zoomToLevel(e.zoomLevel,e.zoomLevelOptions):t._zoomAfterPaint={zoomLevel:e.zoomLevel,zoomLevelOptions:e.zoomLevelOptions}}t.resumeRefresh(!0)}onPaint(...e){if(super.onPaint(...e),this._zoomAfterPaint){const{zoomLevel:t,zoomLevelOptions:i}=this._zoomAfterPaint;this.zoomToLevel(t,i),delete this._zoomAfterPaint}}get widgetClass(){}};class rt extends ii{static get $name(){return"SchedulerHeader"}refreshContent(){var n;(n=this.headersElement)!==null&&n!==void 0&&n.querySelector(".b-sch-timeaxiscolumn")||super.refreshContent()}}rt._$name="Header";class ye extends ni{static get $name(){return"TimeAxisSubGrid"}static get type(){return"timeaxissubgrid"}static get configurable(){return{sealedColumns:!0,headerClass:rt}}startConfigure(n){const{grid:e}=n;e.timeAxisSubGrid=this,super.startConfigure(n),e.isHorizontal&&(n.header={cls:{"b-sticky-headers":e.stickyHeaders}},delete n.headerClass),"flex"in n||"width"in n||(n.flex=1)}changeScrollable(){const n=this,e=super.changeScrollable(...arguments);return e&&Object.defineProperty(e,"scrollWidth",{get(){var i;var t;return(i=(t=this.element)===null||t===void 0?void 0:t.scrollWidth)!=null?i:0},set(){n.grid.updateCanvasSize()}}),e}handleHorizontalScroll(n=!0){this.grid._viewPresetChanging||super.handleHorizontalScroll(n)}onInternalResize(n,e,t,i,r){const s=this;if(s.isPainted&&e!==i){const a=s.grid,o=a._bodyRectangle.height;A.scrollBarWidth&&e<i&&(s.monitorResize=!1),a.onSchedulerViewportResize(e,o,i,o),s.monitorResize||s.requestAnimationFrame(()=>s.monitorResize=!0)}super.onInternalResize(...arguments)}clearWidthCache(){super.clearWidthCache(),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}async expand(){const{owner:n}=this;await super.expand(),n.isPainted&&n.timeAxisViewModel.update(this.width,!1,!0)}}ye.initClass(),ye._$name="TimeAxisSubGrid";const st={fn:"exitTransition",delay:0,cancelOutstanding:!0},at=(f,n,e)=>n==null?e==null||f<e:e==null?f>=n:n<e?n<=f&&f<e:f<e||n<=f,fi=(f,n)=>at(f.getDay(),n.fromDay,n.toDay)&&at(f.getHours(),n.fromHour,n.toHour),Ce={};class Z extends ri.mixin(Ze,Ke,et,tt,nt,Xe,Je,Qe){constructor(){super(...arguments);D(this,"timeCellSelector",null)}static get $name(){return"TimelineBase"}static get type(){return"timelinebase"}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,useBackgroundCanvas:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit"}}updateTimeZone(e){this.project&&(this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=e)}get timeZone(){var e;return(e=this.project)===null||e===void 0?void 0:e.timeZone}populateEventMenu(){}populateScheduleMenu(){}onVisibleDateRangeChange(e){if(!this.handlingVisibleDateRangeChange){const t=this,{_visibleDateRange:i}=t;(!i||i.startDate-e.startDate||i.endDate-e.endDate)&&(t.timeView.range=e,t.handlingVisibleDateRangeChange=!0,t.trigger("visibleDateRangeChange",{old:i,new:e}),t.handlingVisibleDateRangeChange=!1,t._visibleDateRange=e)}}onVisibleResourceRangeChange(){}construct(e={}){const t=this;super.construct(e),t.$firstVerticalOverflow=!0,t.initDomEvents(),t.currentOrientation.init(),t.rowManager.ion({refresh:()=>{t.forceLayout=!1}})}createSubGrid(e,t={}){const i=this,{stickyHeaders:r}=i;return e===(i.schedulerRegion||"normal")?t.type="timeaxissubgrid":e==="locked"&&r&&i.isVertical&&(t.scrollable={overflowX:"visible",overflowY:"visible"},i.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(e,t)}doDestroy(){const e=this,{partneredWith:t,currentOrientation:i}=e;i==null||i.destroy(),t?(t.forEach(r=>{e.removePartner(r)}),t.destroy()):(e.timeAxisViewModel.destroy(),e.timeAxis.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),jt.addResizeListener(this.bodyContainer,this.onBodyResize.bind(this)),this.getConfig("partner")}changeStartDate(e){return typeof e=="string"&&(e=g.parse(e)),e}onPaint({firstPaint:e}){if(e){const r=this,s=r.isHorizontal?r.timeAxisSubGrid.scrollable:r.scrollable,a=s.element.getBoundingClientRect()[r.isHorizontal?"width":"height"];if(r.timeAxisViewModel.update(a,r.infiniteScroll,!0),r.infiniteScroll){var t,i;(t=(i=r.currentOrientation).doUpdateTimeView)===null||t===void 0||t.call(i)}}super.onPaint(...arguments)}onSchedulerHorizontalScroll(e,t,i){this.currentOrientation.updateFromHorizontalScroll(i),super.onSchedulerHorizontalScroll(e,t,i)}initScroll(){const e=this;let t=0;super.initScroll(),e.ion({horizontalScroll:({subGrid:i,scrollLeft:r,scrollX:s})=>{e.isPainted&&i===e.timeAxisSubGrid&&!e.isDestroying&&!e.refreshSuspended&&e.onSchedulerHorizontalScroll(i,r,s),t++}}),e.testPerformance==="horizontal"&&e.setTimeout(()=>{const i=performance.now();let r=5,s=1;const a=e.setInterval(()=>{if(r=r+5,e.scrollX+=(10+Math.floor(r))*s,s===1&&e.scrollX>5500&&(s=-1,r=5),s===-1&&e.scrollX<=0){const c=(performance.now()-i)/t,u=Math.round(1e3/c*10)/10;clearInterval(a),console.log(e.eventPositionMode,e.eventScrollMode,u+"fps")}},0)},500)}preserveViewCenter(e,t=this,...i){const r=this,s=r.viewportCenterDate,a=e.apply(t,i),o=r.timelineScroller,{clientSize:l}=o,c=Math.max(Math.floor(r.getCoordinateFromDate(s,!0)-l/2),0);return r.scrollingToCenter=!0,o.scrollTo(c,!1).then(()=>r.scrollingToCenter=!1),a}setTimeSpan(e,t,i=Ce){const r=this,{timeAxis:s}=r,{preventThrow:a=!1,maintainVisibleStart:o=!1,visibleDate:l}=i,{startDate:c,endDate:u}=s.getAdjustedDates(e,t),d=s.startDate-c!==0,h=s.endDate-u!==0;if(d||h){if(o){const{timeAxisViewModel:v}=r,{totalSize:p}=v,S=v.tickSize,y=r.timelineScroller,C=y.position,b=v.getDateFromPosition(C);b>=c&&b<u&&v.ion({update(){const w=v.tickSize!==S;r.updateCanvasSize(),d&&!h&&!w?y.position+=v.totalSize-p:!d&&!w?y.position=C:y.position=v.getPositionFromDate(b),y.syncPartners(!0)},prio:1e4,once:!0})}const m=s.reconfigure({startDate:c,endDate:u},!1,a);return l?r.scrollToDate(l,i).then(()=>m):m}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some(e=>this.timeAxis.isTimeSpanInAxis(e))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=k.capitalize(this.scheduledEventName)),this._capitalizedEventName}set partner(e){this._partner=e,this.addPartner(e)}addPartner(e){const t=this;if(!t.isPartneredWith(e)){(t.partneredWith||(t.partneredWith=new he)).add(e),(e.partneredWith||(e.partneredWith=new he)).add(t),t.getConfig("viewPreset"),e.ion({presetchange:"onPartnerPresetChange",thisObj:t}),e.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:t});const r=t.partnerSharedConfigs.reduce((s,a)=>(s[a]=e[a],s),{});t.setConfig(r),t.ion({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:e}),t.isPainted?(t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()):t.initScroll=Wt.createSequence(t.initScroll,()=>{t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()},t)}}removePartner(e){const t=this,{partneredWith:i}=t;t.isPartneredWith(e)&&(i.remove(e),t.scrollable.removePartner(e.scrollable),t.un({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.un({overflowChange:"onPartnerOverflowChange",thisObj:e}),e.removePartner(t))}isPartneredWith(e){var t;return!!(!((t=this.partneredWith)===null||t===void 0)&&t.includes(e))}onPartnerOverflowChange({source:e,y:t}){const{scrollable:i}=this,r=i.hasOverflow("y");r!==t?r?e.overflowY="scroll":(e.overflowY=!0,i.overflowY="scroll",this.refreshVirtualScrollbars()):i.overflowY=!0}onPartnerPresetChange({preset:e,startDate:t,endDate:i,centerDate:r,zoomDate:s,zoomPosition:a,zoomLevel:o}){!this._viewPresetChanging&&this.viewPreset!==e&&(e.options={startDate:t,endDate:i,centerDate:r,zoomDate:s,zoomPosition:a,zoomLevel:o},this.viewPreset=e)}get partner(){return this._partner}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.allValues),e}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}changeColumns(e,t){const i=this;let r,s;if(e){const a=Array.isArray(e);let o=e;a||(o=e.data),r=o&&o.length,o.some((l,c)=>l.type==="timeAxis"?(r=c,s=x.assign(l,i.timeAxisColumn),!0):!1),i.isVertical?(o=[x.assign({type:"verticalTimeAxis"},i.verticalTimeAxisColumn),o[r]],r=1):o=o.slice(),o[r]=this._timeAxisColumn||{type:"timeAxis",cellCls:i.timeCellCls,mode:i.mode,...s},a||e.isStore&&e.owner!==this?e=o:e.data=o}return super.changeColumns(e,t)}updateColumns(e,t){if(super.updateColumns(e,t),e){const i=this,r=i._timeAxisColumn=i.columns.find(s=>s.isTimeAxisColumn);i.isVertical&&(i.verticalTimeAxisColumn=i.columns.find(s=>s.isVerticalTimeAxisColumn),i.verticalTimeAxisColumn.relayAll(i)),r.relayAll(i)}}onColumnsChanged({action:e,changes:t,record:i,records:r}){var s;const{timeAxisColumn:a,columns:o}=this;(e==="dataset"||e==="batch")&&!o.includes(a)?o.add(a,!0):i===a&&"width"in t&&this.updateCanvasSize(),i&&((s=this.partneredWith)===null||s===void 0||s.forEach(l=>{const c=l.columns.getAt(i.allIndex);if(c!=null&&c.shouldSync(i)){const u={};for(const d in t)u[d]=t[d].value;c.set(u)}})),super.onColumnsChanged(...arguments)}get timeView(){var e,t;const i=this;return i.columns&&i.isVertical?(e=i.verticalTimeAxisColumn)===null||e===void 0?void 0:e.view:(t=i.timeAxisColumn)===null||t===void 0?void 0:t.timeAxisView}updateEventCls(e){const t=this;t.eventSelector||(t.unreleasedEventSelector=t.eventSelector=`.${e}-wrap`),t.eventInnerSelector||(t.eventInnerSelector=`.${e}`)}set timeAxisViewModel(e){var t;const i=this,r=i._timeAxisViewModel,s={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:i};i.partner&&!e||r&&r===e||((r==null?void 0:r.owner)===i&&r.destroy(),i.detachListeners("timeAxisViewModel"),(t=e)!==null&&t!==void 0&&t.isTimeAxisViewModel?e.ion(s):e=pe.new({mode:i._mode,snap:i.snap,forceFit:i.forceFit,timeAxis:i.timeAxis,suppressFit:i.suppressFit,internalListeners:s,owner:i},e),i.isConfiguring||(i.isHorizontal?i.timeAxisColumn.timeAxisViewModel=e:i.verticalTimeAxisColumn.view.model=e),i._timeAxisViewModel=e,i.relayEvents(e,["update"],"timeAxisViewModel"),r&&e&&i.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var t;var e;return(t=(e=this._timeAxisViewModel)===null||e===void 0?void 0:e.suppressFit)!=null?t:this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){var t;const i=this,r=i._timeAxis,s={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:i};i.partner&&!e||r&&r===e||(r&&r.owner===i&&r.destroy(),i.detachListeners("timeAxis"),(t=e)!==null&&t!==void 0&&t.isTimeAxis||(e=x.assign({owner:i,viewPreset:i.viewPreset,autoAdjust:i.autoAdjustTimeAxis,weekStartDay:i.weekStartDay,forceFullTicks:i.fillTicks&&i.snap},e),i.startDate&&(e.startDate=i.startDate),i.endDate&&(e.endDate=i.endDate),i.workingTime&&i.applyWorkingTime(e),e=new ve(e)),e.ion(s),i._timeAxis=e)}onTimeAxisReconfigure({config:e,oldConfig:t}){e&&(!t||t.startDate-e.startDate||t.endDate-e.endDate)&&this.trigger("dateRangeChange",{old:{startDate:t.startDate,endDate:t.endDate},new:{startDate:e.startDate,endDate:e.endDate}}),this.trigger("timeAxisChange",{config:e})}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(e){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=e)}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,i=t._workingTime;if(i){let s=null;i.fromHour>=0&&i.fromHour<24&&i.toHour>i.fromHour&&i.toHour<=24&&i.toHour-i.fromHour<24&&(s={from:i.fromHour,to:i.toHour});let a=null;i.fromDay>=0&&i.fromDay<7&&i.toDay>i.fromDay&&i.toDay<=7&&i.toDay-i.fromDay<7&&(a={from:i.fromDay,to:i.toDay}),s||a?e.include={hour:s,day:a}:e.include=null}else e.include=null;if(t.isPainted){var r;t.timeAxisColumn.refreshHeader(),(r=t.features.columnLines)===null||r===void 0||r.refresh(),t.refreshWithTransition()}}updateStartDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const i=this,r=i._timeAxis,{startDate:s,endDate:a,mainUnit:o}=r||Ce;if(typeof e=="string"&&(e=g.parse(e)),r&&a){if(e){let l=a;if(t&&s){const c=g.diff(s,a,o,!0);l=g.add(e,c,o)}i.setTimeSpan(e,l)}}else i._tempStartDate=e}get startDate(){var e;let t=((e=this._timeAxis)===null||e===void 0?void 0:e.startDate)||this._tempStartDate;if(!t){t=new Date;const{workingTime:i}=this;if(i)for(;!fi(t,i);)t.setHours(t.getHours()+1);this._tempStartDate=t}return t}changeEndDate(e){typeof e=="string"&&(e=g.parse(e)),this.setEndDate(e)}setEndDate(e,t=!1){const i=this,r=i._timeAxis,{startDate:s,endDate:a,mainUnit:o}=r||Ce;if(typeof e=="string"&&(e=g.parse(e)),r&&s){if(e){let l=s;if(t&&a){const c=g.diff(s,a,o,!0);l=g.add(e,-c,o)}i.setTimeSpan(l,e)}}else i._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||g.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}changeVisibleDate(e){if(e instanceof Date)return{date:e,block:"nearest"};if(e instanceof Object)return{date:e.date,...e}}updateVisibleDate(e){const t=this;t.infiniteScroll&&t.isConfiguring||(t.isPainted?t.scrollToDate(e.date,e):t.ion({paint:()=>t.scrollToDate(e.date,e),once:!0}))}get features(){return super.features}set features(e){e=e===!0?{}:e,"regionResize"in e||(e.regionResize=!0),super.features=e}onLocaleChange(){super.onLocaleChange();const e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}onBodyResize(e,t,{width:i,height:r}){this.isVertical&&t&&i!==t.width&&delete this.timeAxisSubGrid._width;const s=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&t&&r!==t.height&&this.onSchedulerViewportResize(s,r,s,t.height)}onSchedulerViewportResize(e,t,i,r){if(this.isPainted){const s=this,{isHorizontal:a,partneredWith:o}=s;s.currentOrientation.onViewportResize(e,t,i,r),s.updateViewModelAvailableSpace(a?e:Math.floor(t)),o&&!s.isSyncingFromPartner&&s.syncPartnerSubGrids(),s.trigger("timelineViewportResize",{width:e,height:t,oldWidth:i,oldHeight:r})}}updateViewModelAvailableSpace(e){this.timeAxisViewModel.availableSpace=e}onTimeAxisViewModelUpdate(){!this._viewPresetChanging&&!this.timeAxisSubGrid.collapsed&&(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach(e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,this.eachSubGrid(t=>{const i=e.subGrids[t.region];i.width!==t.width&&(t.collapsed?i.collapse():(i.collapsed&&i.expand(),t.flex?t.flex!==i.flex&&(i.flex=t.flex):i.width=t.width))}),e.isSyncingFromPartner=!1)})}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",Ve.generateId("svg")),t.retainElement=!0,e.foregroundCanvas.appendChild(t),e.trigger("svgCanvasCreated",{svg:t})}return e._svgCanvas}get timeAxisSubGridElement(){if(!this._timeAxisSubGridElement){var e;this.getConfig("regions"),this._timeAxisSubGridElement=(e=this.timeAxisColumn)===null||e===void 0?void 0:e.subGridElement}return this._timeAxisSubGridElement}updateCanvasSize(){const e=this,{totalSize:t}=e.timeAxisViewModel,i=e.isHorizontal?t:e.timeAxisColumn.width;let r=!1;return e.isVertical&&(e.isPainted&&e.refreshTotalHeight(t+e._rowBorderHeight,!0),e.suppressFit&&A.setLength(e.foregroundCanvas,"height",t),r=!0),i!==e.$canvasWidth&&e.foregroundCanvas&&(e.backgroundCanvas&&A.setLength(e.backgroundCanvas,"width",i),A.setLength(e.foregroundCanvas,"width",i),e.$canvasWidth=i,r=!0),r}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}async onStoreDataChange({action:e}){const t=this;if(t.isVisible){var i;e==="dataset"&&(i=t.project)!==null&&i!==void 0&&i.isRepopulatingStores&&await t.project.await("refresh",!1),super.onStoreDataChange(...arguments)}else t.whenVisible("refresh",t,[!0])}refresh(e=!0){const t=this;t.isPainted&&!t.refreshSuspended&&(t.isVertical||t.hasVisibleEvents||t.timeAxisSubGridElement.querySelector(t.eventSelector)?!t.project||t.isEngineReady?t.refreshRows(!1,e):(t.refreshAfterProjectRefresh=!0,t.currentOrientation.refreshAllWhenReady=!0):t.rowManager.trigger("refresh"))}render(){const e=this,t=e.timeAxisSubGridElement;e.useBackgroundCanvas&&(e._backgroundCanvas=A.createElement({className:"b-sch-background-canvas",parent:t,nextSibling:t.firstElementChild}));const i=e._foregroundCanvas=A.createElement({className:"b-sch-foreground-canvas",style:`font-size:${e.rowHeight-e.resourceMargin*2}px`,parent:t});e.timeAxisSubGrid.insertRowsBefore=i,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments)}refreshRows(e=!1,t=!0){const i=this;i.isConfiguring||(i.currentOrientation.refreshRows(t),super.refreshRows(e))}updateHideHeaders(e){const t=this,i=t.isPainted?t.scrollLeft:0;super.updateHideHeaders(e),t.isPainted&&(e||t.timeAxisColumn.refreshHeader(null,!0),t.nextAnimationFrame().then(()=>t.scrollLeft=i))}getCellDataFromEvent(e,t){return t&&(t=!e.target.closest(".b-sch-foreground-canvas")),super.getCellDataFromEvent(e,t)}onCellNavigate(e,t,i){var r,s;(r=i.cell)!==null&&r!==void 0&&r.classList.contains("b-timeaxis-cell")&&!((s=Q.currentMouseDown)!==null&&s!==void 0&&s.target.classList.contains("b-grid-cell"))&&(this.preventDragSelect=!0),super.onCellNavigate(...arguments)}runWithTransition(e,t){const i=this;i.isVisible&&((t==null||t===!0)&&(t=i.transitionDuration),t&&i.enableEventAnimations&&(i.hasTimeout("exitTransition")||(i.isAnimating=!0),st.delay=t,i.setTimeout(st))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForAnimations(){!this.isEngineReady&&this.project&&await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(e,t){const i=this;!i.refreshSuspended&&i.isPainted&&(i.rowManager.topRow?i.runWithTransition(()=>i.refresh(e),t):i.rowManager.reinitialize())}get visibleDateRange(){return this.currentOrientation.visibleDateRange}isRowNumberSelecting(...e){return super.isRowNumberSelecting(...e)||e.some(t=>{var i;return t.column?t.column.isTimeAxisColumn:(i=t.cell)===null||i===void 0?void 0:i.closest(".b-timeaxis-cell")})}formatDuration(e,t=this.durationDisplayPrecision){const i=Math.pow(10,t);return Math.round(e*i)/i}beginListeningForBatchedUpdates(){var e;this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1,(e=this.syncSplits)===null||e===void 0||e.call(this,t=>t.beginListeningForBatchedUpdates())}endListeningForBatchedUpdates(){var e;this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1),(e=this.syncSplits)===null||e===void 0||e.call(this,t=>t.endListeningForBatchedUpdates())}onConnectedCallback(e,t){e&&!t&&(this.timeAxisSubGrid.scrollable.x+=.5)}updateRtl(e){const t=this,{isConfiguring:i}=t;let r;i||(r=t.visibleDateRange),super.updateRtl(e),i||(t.currentOrientation.clearAll(),t.infiniteScroll?(t.shiftToDate(r.startDate),t.scrollToDate(r.startDate,{block:"start"})):t.timelineScroller.position+=.5)}applyStartEndParameters(e){const t=this,i=t.eventStore.modelClass.fieldMap.startDate;t.passStartEndParameters&&(e[t.startParamName]=i.print(t.startDate),e[t.endParamName]=i.print(t.endDate))}}D(Z,"configurable",{partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null}),Z.initClass(),me.setVersion("scheduler","5.5.0"),Z._$name="TimelineBase";class De extends R.mixin(Nt){get revision(){return this.crudRevision}set revision(n){this.crudRevision=n}get json(){return k.safeJsonStringify(this)}set json(n){typeof n=="string"&&(n=k.safeJsonParse(n)),this.forEachCrudStore(e=>{const t=`${e.storeId}Data`;n[t]&&(e.data=n[t])})}static get defaultConfig(){return{stores:null}}construct(n={}){n.stores&&(n.crudStores=n.stores,delete n.stores),super.construct(n)}toJSON(){const n={};return this.forEachCrudStore((e,t)=>n[`${t}Data`]=e.toJSON()),n}get inlineData(){return this.toJSON()}set inlineData(n){this.json=n}set stores(n){n!==this.crudStores&&(this.crudStores=n)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...n){return this.addCrudStore(...n)}removeStore(...n){return this.removeCrudStore(...n)}getStore(...n){return this.getCrudStore(...n)}hasChanges(...n){return this.crudStoreHasChanges(...n)}loadData(...n){return this.loadCrudManagerData(...n)}}De._$name="AbstractCrudManager";class ne extends De.mixin(Yt,Gt,qt){static get defaultConfig(){return{projectClass:Ye,resourceStoreClass:Zt,eventStoreClass:Kt,assignmentStoreClass:Xt,dependencyStoreClass:Jt,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null}}buildProject(){return new this.projectClass(this.buildProjectConfig())}buildProjectConfig(){return x.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}set project(n){const e=this;n!==e._project&&(e.detachListeners("beforeDataReady"),e.detachListeners("afterDataReady"),e._project=n,n&&(e.eventStore=n.eventStore,e.resourceStore=n.resourceStore,e.assignmentStore=n.assignmentStore,e.dependencyStore=n.dependencyStore,e.timeRangeStore=n.timeRangeStore,e.resourceTimeRangeStore=n.resourceTimeRangeStore,n.ion({name:"beforeDataReady",dataReady:()=>e.suspendChangesTracking(),prio:100,thisObj:e}),n.ion({name:"afterDataReady",dataReady:()=>e.resumeChangesTracking(),prio:-100,thisObj:e})),e.eventStore||(e.eventStore={}),e.resourceStore||(e.resourceStore={}),e.assignmentStore||(e.assignmentStore={}),e.dependencyStore||(e.dependencyStore={}))}get project(){return this._project}get timeRangeStore(){var n;return(n=this._timeRangeStore)===null||n===void 0?void 0:n.store}set timeRangeStore(n){var e;this.setFeaturedStore("_timeRangeStore",n,(e=this.project)===null||e===void 0?void 0:e.timeRangeStoreClass)}get resourceTimeRangeStore(){var n;return(n=this._resourceTimeRangeStore)===null||n===void 0?void 0:n.store}set resourceTimeRangeStore(n){var e;this.setFeaturedStore("_resourceTimeRangeStore",n,(e=this.project)===null||e===void 0?void 0:e.resourceTimeRangeStoreClass)}get resourceStore(){var n;return(n=this._resourceStore)===null||n===void 0?void 0:n.store}set resourceStore(n){const e=this;e.setFeaturedStore("_resourceStore",n,e.resourceStoreClass)}get eventStore(){var n;return(n=this._eventStore)===null||n===void 0?void 0:n.store}set eventStore(n){const e=this;e.setFeaturedStore("_eventStore",n,e.eventStoreClass)}get assignmentStore(){var n;return(n=this._assignmentStore)===null||n===void 0?void 0:n.store}set assignmentStore(n){this.setFeaturedStore("_assignmentStore",n,this.assignmentStoreClass)}get dependencyStore(){var n;return(n=this._dependencyStore)===null||n===void 0?void 0:n.store}set dependencyStore(n){this.setFeaturedStore("_dependencyStore",n,this.dependencyStoreClass)}setFeaturedStore(n,e,t){var i;const r=this,s=(i=r[n])===null||i===void 0?void 0:i.store;if(s!==e){var a;e=J.getStore(e,((a=e)===null||a===void 0?void 0:a.storeClass)||t),s&&r.removeStore(s),r[n]=e&&{store:e}||null,r.addPrioritizedStore(r[n])}return r[n]}getChangesetPackage(){var n,e;const t=super.getChangesetPackage();return t&&(this.eventStore.usesSingleAssignment||(n=this.eventStore.modelClass.fieldMap)!==null&&n!==void 0&&(e=n.resourceIds)!==null&&e!==void 0&&e.persist)&&(delete t[this.assignmentStore.storeId],!this.crudStores.some(i=>t[i.storeId]))?null:t}get crudLoadValidationMandatoryStores(){return[this._eventStore.storeId,this._resourceStore.storeId]}}D(ne,"$name","CrudManager"),ne._$name="CrudManager";const vi=["eventStore","taskStore","assignmentStore","resourceStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"],pi=["events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges"];var ot=f=>class extends f{static get $name(){return"CurrentConfig"}preProcessCurrentConfigs(e){for(const t of pi)delete e[t];super.preProcessCurrentConfigs(e)}getCurrentConfig(e){const t=this.project.getCurrentConfig(e),i=super.getCurrentConfig(e);if(t){i.project=t;const{crudManager:r}=i;if(r)for(const s of vi)r[s]&&(t[s]=r[s]);Object.keys(t).length===0&&delete i.project}return delete i.data,delete i.crudManager,i}get widgetClass(){}};const lt=f=>!f||Array.isArray(f)?f:[f],ct=(f,n,e)=>f&&f[n]!==!0?f[n]:e;var ut=f=>{var n;return n=class extends(f||R){get dateBounds(){return[this.date]}get description(){const t=this,{descriptionRenderer:i}=t;return i?t.callback(i,t,[t]):t.formattedDescription}get formattedDescription(){var c;const t=this,{dateBounds:i,dateFormat:r}=t,s=(c=t.descriptionFormat)!=null?c:lt(t.defaultDescriptionFormat),a=ct(s,0,r),o=i.length>1&&(s==null?void 0:s.length)>1&&g.format(i[0],a)!==g.format(i[1],a);let l=g.format(i[0],a);return o&&(l=g.formatRange(i,ct(s,1,`S${r}${t.dateSeparator}E${r}`))),l}changeDescriptionFormat(t){return lt(t)}get widgetClass(){}},D(n,"$name","Describable"),D(n,"configurable",{dateFormat:"MMMM d, YYYY",dateSeparator:" - ",descriptionFormat:null,descriptionRenderer:null}),n},dt=f=>class extends(f||R){static get $name(){return"SchedulerDom"}getElementFromAssignmentRecord(e,t=!1){if(this.isPainted&&e){var i,r,s;let o=(i=this.foregroundCanvas.syncIdMap)===null||i===void 0?void 0:i[e.id];if(!o&&e.resource.hasLinks)for(const l of e.resource.$links){var a;if(o=(a=this.foregroundCanvas.syncIdMap)===null||a===void 0?void 0:a[`${e.id}_${l.id}`],o)break}return t?o:(r=o)===null||r===void 0||(s=r.syncIdMap)===null||s===void 0?void 0:s.event}return null}getElementFromEventRecord(e,t=(()=>{var r;return(r=e.resources)===null||r===void 0?void 0:r[0]})(),i=!1){if(e.isResourceTimeRange){var r;const a=(r=this.foregroundCanvas.syncIdMap)===null||r===void 0?void 0:r[e.domId];return i?a:a==null?void 0:a.syncIdMap.event}const s=this.assignmentStore.getAssignmentForEventAndResource(e,t);return this.getElementFromAssignmentRecord(s,i)}getElementsFromEventRecord(e,t,i=!1){return t?[this.getElementFromEventRecord(e,t,i)]:e.resources.reduce((r,s)=>{const a=this.getElementFromEventRecord(e,s,i);return a&&r.push(a),r},[])}resolveResourceRecord(e,t){return this.currentOrientation.resolveRowRecord(e,t)}resolveRowRecord(e){return this.resolveResourceRecord(e)}resolveEventRecord(e){var t;e instanceof Event&&(e=e.target);const i=(t=e)===null||t===void 0?void 0:t.closest(this.eventSelector);if(i){if(i.dataset.eventId)return this.eventStore.getById(i.dataset.eventId);if(i.dataset.assignmentId)return this.assignmentStore.getById(i.dataset.assignmentId).event}return null}resolveTimeSpanRecord(e){return this.resolveEventRecord(e)}resolveAssignmentRecord(e){const t=e.closest(this.eventSelector),i=t&&this.assignmentStore.getById(t.dataset.assignmentId),r=t&&this.eventStore.getById(t.dataset.eventId);return this.assignmentStore.getOccurrence(i,r)}isRowVisible(e){return this.store.indexOf(e)>=0}get widgetClass(){}},ht=f=>class extends(f||R){static get $name(){return"SchedulerDomEvents"}getTimeSpanMouseEventParams(e,t){const i=this.resolveEventRecord(e);return i&&{eventRecord:i,resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:t}}getScheduleMouseEventParams(e,t){return{resourceRecord:this.isVertical?this.resolveResourceRecord(t):this.store.getById(e.id)}}onElementKeyDown(e){const t=super.onElementKeyDown(e),i=this;return i.selectedEvents.length&&i.trigger(i.scheduledEventName+"KeyDown",{eventRecords:i.selectedEvents,assignmentRecords:i.selectedAssignments,event:e,eventRecord:i.selectedEvents,assignmentRecord:i.selectedAssignments}),t}onElementKeyUp(e){super.onElementKeyUp(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyUp",{eventRecords:t.selectedEvents,assignmentRecords:t.selectedAssignments,event:e,eventRecord:t.selectedEvents,assignmentRecord:t.selectedAssignments})}get widgetClass(){}};class be extends R{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(n){n?delete this.nbrOfBandsByResource[n.id]:this.nbrOfBandsByResource={}}applyLayout(n,e){return this.nbrOfBandsByResource[e.id]=this.layoutEventsInBands(n,e)}layoutEventsInBands(n,e){throw new Error("Implement in subclass")}}be._$name="HorizontalLayout";class we extends be{static get $name(){return"HorizontalLayoutStack"}static get configurable(){return{type:"stack"}}layoutEventsInBands(n,e,t=!1){let i=0;do{let r=0,s=n[0];for(;s;)t||(s.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,i,s.eventRecord,s.resourceRecord)),n.splice(r,1),r=this.findClosestSuccessor(s,n),s=n[r];i++}while(n.length>0);return i}findClosestSuccessor(n,e){const{endMS:t,group:i}=n,r=n.eventRecord&&n.eventRecord.duration===0;let s=1/0,a,o,l;for(let c=0,u=e.length;c<u;c++)if(l=e[c],o=l.startMS-t,o>=0&&o<s&&(o>0||l.endMS-l.startMS>0||!r)){if(this.grouped&&i!==l.group)break;a=c,s=o}return a}}we._$name="HorizontalLayoutStack";var Ee=f=>class extends(f||R){static get $name(){return"PackMixin"}static get defaultConfig(){return{coordProp:"top",sizeProp:"height",inBandCoordProp:"inBandTop",inBandSizeProp:"inBandHeight"}}isSameGroup(e,t){return this.grouped?e.group===t.group:!0}packEventsInBands(e,t){const i=this,{coordProp:r,sizeProp:s}=i;let a,o,l,c;for(let u=0,d=e.length;u<d;u++){if(o=e[u],a=i.findStartSlot(e,o),l=i.getCluster(e,u),l.length>1){for(o[r]=a.start,o[s]=a.end-a.start,c=1;c<l.length-1&&l[c+1].start-o.start===0;)c++;const v=i.findStartSlot(e,l[c]);v&&v.start<.8&&(l.length=c)}const h=l.length,m=(a.end-a.start)/h;for(c=0;c<h;c++)t(l[c],c,a,m);u+=h-1}return 1}findStartSlot(e,t){const{inBandSizeProp:i,inBandCoordProp:r,coordProp:s,sizeProp:a}=this,o=this.getPriorOverlappingEvents(e,t);let l;if(o.length===0)return{start:0,end:1};for(l=0;l<o.length;l++){const c=o[l],u=r in c?r:s,d=i in c?i:a;if(l===0&&c[u]>0)return{start:0,end:c[u]};if(c[u]+c[d]<(l<o.length-1?o[l+1][u]:1))return{start:c[u]+c[d],end:l<o.length-1?o[l+1][u]:1}}return!1}getPriorOverlappingEvents(e,t){const i=t.start,r=t.end,s=[];for(let a=0,o=e.indexOf(t);a<o;a++){const l=e[a];this.isSameGroup(l,t)&&g.intersectSpans(i,r,l.start,l.end)&&s.push(l)}return s.sort(this.sortOverlappers.bind(this)),s}sortOverlappers(e,t){const{coordProp:i}=this;return e[i]-t[i]}getCluster(e,t){const i=e[t],r=[i];if(t>=e.length-1)return r;let{start:s,end:a}=i;for(let o=t+1,l=e.length;o<l;o++){const c=e[o];if(!this.isSameGroup(c,i)||!g.intersectSpans(s,a,c.start,c.end))break;r.push(c),s=g.max(s,c.start),a=g.min(c.end,a)}return r}};class xe extends be.mixin(Ee){static get $name(){return"HorizontalLayoutPack"}static get configurable(){return{type:"pack"}}layoutEventsInBands(n){const e=this.packEventsInBands(n,(t,i,r,s)=>{t.height=s,t.top=r.start+i*s});return n.forEach(t=>{Object.assign(t,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,t.top,t.height,t.eventRecord,t.resourceRecord))}),e}}xe._$name="HorizontalLayoutPack";var mt=f=>{var n;return n=class extends(f||R){get resourceColumns(){var t;return((t=this.timeAxisColumn)===null||t===void 0?void 0:t.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){var t;return((t=this.resourceColumns)===null||t===void 0?void 0:t.columnWidth)||null}getResourceMargin(t){var i;return(i=t==null?void 0:t.resourceMargin)!=null?i:this.resourceMargin}getBarMargin(t){var i;return(i=t==null?void 0:t.barMargin)!=null?i:this.barMargin}getResourceHeight(t){var i;return(i=t.rowHeight)!=null?i:this.isHorizontal?this.rowHeight:this.getResourceWidth(t)}getResourceWidth(t){var i;return(i=t.columnWidth)!=null?i:this.resourceColumnWidth}getAppliedResourceHeight(t){var r;const i=this.getRowById(t);return(r=i==null?void 0:i.maxRequestedHeight)!=null?r:this.getResourceHeight(t)}getResourceLayoutSettings(t,i=null){const r=this.getResourceMargin(t,i),s=this.getAppliedResourceHeight(t,i);return{barMargin:this.getBarMargin(t,i),contentHeight:Math.max(s-r*2,1),rowHeight:s,resourceMargin:r}}get widgetClass(){}},D(n,"$name","SchedulerResourceRendering"),D(n,"configurable",{resourceMargin:null,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg"}),n},gt=f=>class extends mt(f||R){static get $name(){return"SchedulerEventRendering"}static get configurable(){return{milestoneTextPosition:"outside",milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",eventLayout:"stack",overlappingEventSorter:null,horizontalEventSorterFn:null,resourceMargin:null,useInitialAnimation:!0,eventRenderer:null,eventRendererThisObj:null,eventBarTextField:"name",eventBodyTemplate:null,horizontalLayoutPackClass:xe,horizontalLayoutStackClass:we,isFirstRender:!0,initialAnimationDuration:2e3,narrowEventWidth:10,internalEventLayout:null,eventPositionMode:"translate",eventScrollMode:"move"}}changeEventLayout(e){return this.internalEventLayout=e,this.internalEventLayout.type}changeInternalEventLayout(e){return this.getEventLayout(e)}updateInternalEventLayout(e,t){const i=this;t&&i.element.classList.remove(`b-eventlayout-${t.type}`),i.element.classList.add(`b-eventlayout-${e.type}`),i.isConfiguring||(i.refreshWithTransition(),i.trigger("stateChange"))}changeHorizontalEventSorterFn(e){me.deprecate("Scheduler","6.0.0","Replaced by overlappingEventSorter()"),this.overlappingEventSorter=e}updateOverlappingEventSorter(e){this.isConfiguring||this.refreshWithTransition()}getEventLayout(e){var t;return(t=e)!==null&&t!==void 0&&t.isModel&&(e=e.eventLayout||this.internalEventLayout),typeof e=="string"&&(e={type:e}),e}getEventLayoutHandler(e){const t=this;if(!t.isHorizontal)return null;const{timeAxisViewModel:i,horizontal:r}=t,{type:s}=e;switch(t.layouts||(t.layouts={}),s){case"stack":return t.layouts.horizontalStack||(t.layouts.horizontalStack=new t.horizontalLayoutStackClass(x.assign({scheduler:t,timeAxisViewModel:i,bandIndexToPxConvertFn:r.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:r},e))),t.layouts.horizontalStack;case"pack":return t.layouts.horizontalPack||(t.layouts.horizontalPack=new t.horizontalLayoutPackClass(x.assign({scheduler:t,timeAxisViewModel:i,bandIndexToPxConvertFn:r.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:r},e))),t.layouts.horizontalPack;default:return null}}getEventsToRender(e,t){return t}repaintEventsForResource(e){this.currentOrientation.repaintEventsForResource(e)}repaintEvent(e){this.eventStore.getResourcesForEvent(e).forEach(i=>this.repaintEventsForResource(i))}getEventStyle(e,t){return e.eventStyle||t.eventStyle||this.eventStyle}getEventColor(e,t){var i,r;return e.eventColor||((i=e.event)===null||i===void 0?void 0:i.eventColor)||((r=e.parent)===null||r===void 0?void 0:r.eventColor)||t.eventColor||this.eventColor}generateRenderData(e,t,i={viewport:!0}){const r=this,s=r.currentOrientation.getTimeSpanRenderData(e,t,i),{isEvent:a}=e,{eventResize:o}=r.features,l=!e.meta.isDragCreating&&e.isMilestone,c=a&&e.assignments.find(m=>m.resourceId===t.$originalId),u={className:"b-sch-event-content",role:"presentation",dataset:{taskBarFeature:"content"}};if(s){var d;s.tabIndex="0";let m=e.isResizable;o&&m&&(s.startsOutsideView&&(m===!0?m="end":m==="start"&&(m=!1)),s.endsOutsideView&&(m===!0?m="start":m==="end"&&(m=!1)),m&&(r.isHorizontal?!r.rtl&&!o.leftHandle||r.rtl&&!o.rightHandle?m=m==="start"?!1:"end":(!r.rtl&&!o.rightHandle||r.rtl&&!o.leftHandle)&&(m=m==="end"?!1:"start"):o.topHandle?o.bottomHandle||(m=m==="end"?!1:"start"):m=m==="start"?!1:"end"));const v=!!(e.hasPersistableChanges||c!=null&&c.hasPersistableChanges),p={[t.cls]:t.cls,[r.generatedIdCls]:!e.isOccurrence&&e.hasGeneratedId,[r.dirtyCls]:v,[r.committingCls]:e.isCommitting,[r.endsOutsideViewCls]:s.endsOutsideView,[r.startsOutsideViewCls]:s.startsOutsideView,"b-clipped-start":s.clippedStart,"b-clipped-end":s.clippedEnd,"b-iscreating":e.isCreating,"b-rtl":r.rtl},S={[`${r.eventCls}-parent`]:t.isParent,"b-readonly":e.readOnly||(c==null?void 0:c.readOnly),"b-linked-resource":t.isLinked,"b-original-resource":t.hasLinks},y=e.isResourceTimeRange?new O:e.internalCls.clone(),C=e.isResourceTimeRange?e.internalCls.clone():new O;if(s.wrapperStyle="",s.isWrap=!0,a){const T=c&&r.isAssignmentSelected(c);x.assign(p,{[r.eventCls]:1,"b-milestone":l,"b-sch-event-narrow":!l&&s.width<r.narrowEventWidth,[r.fixedEventCls]:e.isDraggable===!1,[`b-sch-event-resizable-${m}`]:!!(o&&!e.readOnly),[r.eventSelectedCls]:T,[r.eventAssignHighlightCls]:r.eventAssignHighlightCls&&!T&&r.isEventSelected(e),"b-recurring":e.isRecurring,"b-occurrence":e.isOccurrence,"b-inactive":e.inactive}),s.eventId=e.id;const F=r.getEventStyle(e,t),E=r.getEventColor(e,t),j=r.isFirstRender&&r.useInitialAnimation&&globalThis.bryntum.noAnimations!==!0;if(x.assign(S,{[`${r.eventCls}-wrap`]:1,"b-milestone-wrap":l}),j){const Ft=s.row?s.row.index:(s.top-r.scrollTop)/r.tickSize,ze=Ft/20*1e3;s.wrapperStyle=`animation-delay: ${ze}ms;`,r.maxDelay=Math.max(r.maxDelay||0,ze),r.initialAnimationDetacher||(r.initialAnimationDetacher=L.on({element:r.foregroundCanvas,delegate:r.eventSelector,once:!0,animationend:()=>r.setTimeout({fn:"stopInitialAnimation",delay:r.maxDelay,cancelOutstanding:!0}),expires:{alt:"stopInitialAnimation",delay:r.initialAnimationDuration+r.maxDelay},thisObj:r}))}s.eventColor=E,s.eventStyle=F,s.assignmentRecord=s.assignment=c}if(s.wrapperCls=x.assign(C,S),s.cls=x.assign(y,p),s.iconCls=new O(e.getValue(r.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(s.style="",s.wrapperStyle+=e.style||""):s.style=e.style||"",s.resource=s.resourceRecord=t,s.resourceId=s.rowId,a){let T=null,F=null,E;if(r.eventRenderer){const j=r.eventRenderer.call(r.eventRendererThisObj||r,{eventRecord:e,resourceRecord:t,assignmentRecord:s.assignmentRecord,renderData:s});typeof s.cls=="string"&&(s.cls=new O(s.cls)),typeof s.wrapperCls=="string"&&(s.wrapperCls=new O(s.wrapperCls)),typeof s.iconCls=="string"&&(s.iconCls=new O(s.iconCls)),r.eventBodyTemplate?E=r.eventBodyTemplate(j):E=j}else r.eventBodyTemplate?E=r.eventBodyTemplate(e):r.eventBarTextField&&(E=k.encodeHtml(e.getValue(r.eventBarTextField)||""));if(!r.eventBodyTemplate||Array.isArray(E)){var h;u.children=[],l&&(r.milestoneLayoutMode==="default"||r.milestoneTextPosition==="always-outside")&&E!=null&&E!==""&&u.children.unshift(F={tag:"label",children:[]}),(h=s.iconCls)!==null&&h!==void 0&&h.length&&u.children.unshift({tag:"i",className:s.iconCls}),Array.isArray(E)?(F||u).children.push(...E):k.isHtml(E)?u.children.length?T={tag:"span",class:"b-event-text-wrap",html:E}:(u.children=null,u.html=E):typeof E=="string"||typeof E=="object"?T=E:E!=null&&(T=String(E)),T!=null&&((F||u).children.push(T),s.cls.add("b-has-content")),(u.html!=null||u.children.length)&&s.children.push(u)}else u.html=E,s.children.push(u)}const{eventStyle:b,eventColor:w,wrapperCls:M}=s;if(M[`b-sch-style-${b||"none"}`]=1,A.isNamedColor(w))M[`b-sch-color-${w}`]=w;else if(w){const T=b?"color":"background-color",F=`${T}:${w};`;s.style=F+s.style,M["b-sch-custom-color"]=1,s._customColorStyle=F}else M["b-sch-color-none"]=1;s.style&&l&&u&&(u.style=s.style,delete s.style),s.cls["b-sch-event-withicon"]=(d=s.iconCls)===null||d===void 0?void 0:d.length,s.eventContent=u,s.wrapperChildren=[],r.onEventDataGenerated(s)}return s}onEventDataGenerated(e){}changeUseInitialAnimation(e){return e===!0?"fade-in":e}updateUseInitialAnimation(e,t){const{classList:i}=this.element;t&&i.remove(`b-initial-${t}`),e&&(i.add(`b-initial-${e}`),z.isFirefox&&i.add("b-prevent-event-transitions"))}restartInitialAnimation(e){var t;const i=this;(t=i.initialAnimationDetacher)===null||t===void 0||t.call(i),i.initialAnimationDetacher=null,i.useInitialAnimation=e,i.isFirstRender=!0,i.refresh()}stopInitialAnimation(){const e=this;e.initialAnimationDetacher(),e.isFirstRender=!1,e.useInitialAnimation=!1,z.isFirefox&&e.setTimeout(()=>e.element.classList.remove("b-prevent-event-transitions"),100)}getMilestoneLabelWidth(e,t){const i=this,r=i.milestoneLayoutMode,s=i.getResourceLayoutSettings(t).contentHeight;if(r==="measure"){const a=k.encodeHtml(e.name),o=i.getEventColor(e,t),l=i.getEventStyle(e,t),c=i.milestoneMeasureElement||(i.milestoneMeasureElement=A.createElement({className:{"b-sch-event-wrap":1,"b-milestone-wrap":1,"b-measure":1,[`b-sch-color-${o}`]:o,[`b-sch-style-${l}`]:l},children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content",children:[{tag:"label"}]}]}],parent:i.foregroundCanvas}));if(c.retainElement=!0,c.style.fontSize=`${s}px`,i.milestoneTextPosition==="always-outside"){const u=c.firstElementChild.firstElementChild.firstElementChild;u.innerHTML=a;const d=P.from(u,u.parentElement);return d.left+d.width+2}else return c.firstElementChild.firstElementChild.innerHTML=`<label></label>${a}`,c.firstElementChild.offsetWidth}return r==="estimate"?e.name.length*i.milestoneCharWidth+(i.milestoneTextPosition==="always-outside"?s:0):r==="data"?e.milestoneWidth:0}updateMilestoneLayoutMode(e){const t=this,i=t.milestoneTextPosition==="always-outside";t.element.classList.toggle("b-sch-layout-milestones",e!=="default"&&!i),t.element.classList.toggle("b-sch-layout-milestone-labels",e!=="default"&&i),t.isConfiguring||t.refreshWithTransition()}updateMilestoneTextPosition(e){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside",e==="inside"),this.updateMilestoneLayoutMode(this.milestoneLayoutMode)}updateMilestoneAlign(){this.isConfiguring||this.refreshWithTransition()}updateMilestoneCharWidth(){this.isConfiguring||this.refreshWithTransition()}get widgetClass(){}};const ft=["assignmentStore","dependencyStore","eventStore","resourceStore"];var vt=f=>{var n,e;return e=class extends(f||R){constructor(){super(...arguments);je(this,n,void 0)}static get $name(){return"ProjectConsumer"}static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:Ye,project:{},destroyStores:null,projectSubscribers:[]}}startConfigure(r){this.getConfig("project"),super.startConfigure(r)}changeProject(r,s){const a=this,{projectStoreNames:o,projectDataNames:l}=a.constructor;if(a.projectCallbacks=new Set,r){if(a.buildingProjectConfig=!0,!r.isModel){if(a.isConfiguring){a._project=r;const{crudManager:d}=a;if(d){const{isCrudManager:h}=d;for(const m of o)d[m]&&(a[m]=d[m],h||delete d[m])}a.getConfig("projectStores");for(const h of l)a.getConfig(h)}const{eventStore:c}=r;let{_sharedProject:u}=a;if(c&&!c.isEventStoreMixin&&c.autoLoad&&!c.count&&(c.autoLoad=!1,a.delayAutoLoad=!0),u&&ft.some(d=>r[d]&&r[d]!==u[d])){for(const d of ft)r[d]&&r[d]===u[d]&&(r[d]=r[d].chain());u=null}r=u||new a.projectModelClass(r),delete a._project}a.buildingProjectConfig=!1}return r}updateProject(r,s){const a=this,{projectListeners:o,crudManager:l}=a;if(a.detachListeners("projectConsumer"),delete a._crudManager,r){var c;o.thisObj=a,r.ion(o),r.isCrudManager?a.crudManager=r:l&&(l.project=r,a.crudManager=l),a.projectSubscribers.forEach(u=>{u.detachFromProject(s),u.attachToProject(r)});for(const u of a.constructor.projectStoreNames)a[u]=r[u];a.delayAutoLoad&&(r.eventStore.autoLoad=!0,r.eventStore.load()),(c=r.stm)===null||c===void 0||c.ion({name:"projectConsumer",restoringStart:"onProjectRestoringStart",restoringStop:"onProjectRestoringStop",thisObj:a})}a.trigger("projectChange",{project:r})}changeCrudManager(r){if(this.buildingProjectConfig)this._crudManager=r.isCrudManager?r:Object.assign({},r);else return super.changeCrudManager(r)}onProjectDataReady(){const r=this;r.whenVisible(()=>{r.projectCallbacks.size&&(r.projectCallbacks.forEach(s=>s()),r.projectCallbacks.clear())},null,null,"onProjectDataReady")}onProjectRestoringStart({stm:r}){const{rawQueue:s}=r;s.length&&s[s.length-1].length>1&&(ue(this,n,!0),this.suspendRefresh())}onProjectRestoringStop(){He(this,n)&&(ue(this,n,!1),this.resumeRefresh(!0))}onBeforeTimeZoneChange(){}onTimeZoneChange({timeZone:r,oldTimeZone:s}){const a=this;if(a.startDate&&a.timeAxis.timeZone!==r){const o=s!=null?_e.fromTimeZone(a.startDate,s):a.startDate;a.startDate=r!=null?_e.toTimeZone(o,r):o,a.timeAxis.timeZone=r}}onStartApplyChangeset(){this.suspendRefresh()}onEndApplyChangeset(){this.resumeRefresh(!0)}whenProjectReady(r){this.isEngineReady?r():this.projectCallbacks.add(r)}get isEngineReady(){var r,s;return!!(!((r=(s=this.project).isEngineReady)===null||r===void 0)&&r.call(s))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:r}=this.constructor;return r.map(s=>this[s])}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce((r,s)=>{const{dataName:a}=this.projectStores[s];return a&&r.push(a),r},[])}static setupProjectStores(r,s){const{projectStores:a}=r;if(a){const o={name:"projectConsumer",dataReady:"onProjectDataReady",change:"relayProjectDataChange",beforeTimeZoneChange:"onBeforeTimeZoneChange",timeZoneChange:"onTimeZoneChange",startApplyChangeset:"onStartApplyChangeset",endApplyChangeset:"onEndApplyChangeset"},l={projectListeners:o};let c;for(const u in a){const{dataName:d}=a[u];l[u]=l[d]=null,d&&(Object.defineProperty(s.class.prototype,d,{configurable:!0,get(){var h;return(h=this.project[u])===null||h===void 0?void 0:h.records}}),this.createDataUpdater(u,d,c,s)),this.createStoreDescriptor(s,u,a[u],o),c=d}this.setupConfigs(s,l)}}static createDataUpdater(r,s,a,o){o.class.prototype[`update${k.capitalize(s)}`]=function(l){const{project:c}=this;a&&this.getConfig(a),this.buildingProjectConfig?c[`${s}Data`]=l:c[r].data=l}}static createStoreDescriptor(r,s,{listeners:a},o){const{prototype:l}=r.class,c=k.capitalize(s);o[`${s}Change`]=function({store:u}){this[s]=u},l[`change${c}`]=function(u,d){var h;const m=this,{project:v}=m,p=(h=u)===null||h===void 0?void 0:h.project;if(m.buildingProjectConfig){p!=null&&p.isProjectModel&&(m._sharedProject=p),v[s]=u;return}return m.initializingProject||v[s]!==u&&(v[`set${c}`](u),u=v[s]),u!==d&&(a&&(a.thisObj=m,a.name=`${s}Listeners`,m.detachListeners(a.name),u.ion(a)),m[`_${s}`]=u,m.projectSubscribers.forEach(S=>{var y;(y=S[`attachTo${c}`])===null||y===void 0||y.call(S,u)}),m[`_${s}`]=null),u}}relayProjectDataChange(r){if(!((r.isExpand||r.isCollapse)&&!r.records[0].fieldMap.expanded.persist))return this.trigger("dataChange",{project:r.source,...r,source:this})}get widgetClass(){}},n=new WeakMap,e},pt=f=>class extends vt(f||R){static get $name(){return"SchedulerStores"}static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"onBeforeLoad"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}static get configurable(){return{store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:me.checkVersion("core","6.0",">="),crudManagerClass:null,crudManager:null}}updateProject(e,t){super.updateProject(e,t),this.detachListeners("schedulerStores"),e.ion({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({isInitialCommit:e}){const t=this;t.isVisible?(e&&t.isVertical&&(t.refreshAfterProjectRefresh=!1,t.refreshWithTransition()),t.navigateToAfterRefresh&&(t.navigateTo(t.navigateToAfterRefresh),t.navigateToAfterRefresh=null),t.refreshAfterProjectRefresh&&(t.refreshWithTransition(!1,!e),t.refreshAfterProjectRefresh=!1)):t.whenVisible("refresh",t,[!0])}changeCrudManager(e){const t=this;e&&!e.isCrudManager&&(e=t.crudManagerClass.new({scheduler:t},e)),t._crudManager=e,t.bindCrudManager(e)}get store(){return!this._store&&this.isVertical&&(this._store=new J({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}]})),super.store}set store(e){super.store=e}refreshFromRowOnStoreAdd(e,{isExpand:t,records:i}){const r=arguments;this.runWithTransition(()=>{this.currentOrientation.suspended=!t&&!i.some(s=>s.isLinked),super.refreshFromRowOnStoreAdd(e,...r),this.currentOrientation.suspended=!1},!t)}onStoreAdd(e){super.onStoreAdd(e),this.isPainted&&this.calculateRowHeights(e.records)}onStoreUpdateRecord({source:e,record:t,changes:i}){let r=0;"assigned"in i&&r++,"calendar"in i&&r++,r!==Object.keys(i).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(e){e&&this.isHorizontal&&(e.metaMapId=this.id,this.store=e)}get usesDisplayStore(){return this.store!==this.resourceStore}onEventIdChange(e){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(e)}onEventStoreBatchedUpdate(e){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(e)}onInternalEventStoreChange(e){!this.isPainted||!this._mode||e.isAssign||this.assignmentStore.isRemovingAssignment||(this.isVisible?this.currentOrientation.onEventStoreChange(e):this.whenVisible(this.onInternalEventStoreChange,this,[e]))}onEventCommit({changes:e}){let t=[...e.added,...e.modified].map(i=>this.eventStore.getResourcesForEvent(i));t=Array.prototype.concat.apply([],t),new Set(t).forEach(i=>this.repaintEventsForResource(i))}onEventCommitStart({changes:e}){const{currentOrientation:t,committingCls:i}=this;[...e.added,...e.modified].forEach(r=>r.assignments.forEach(s=>t.toggleCls(s,i,!0)))}onEventException({action:e}){if(e==="commit"){const{changes:t}=this.eventStore;[...t.added,...t.modified,...t.removed].forEach(i=>this.repaintEvent(i))}}onAssignmentCommit({changes:e}){this.repaintEventsForAssignmentChanges(e)}onAssignmentCommitStart({changes:e}){const{currentOrientation:t,committingCls:i}=this;[...e.added,...e.modified].forEach(r=>{t.toggleCls(r,i,!0)})}onAssignmentException({action:e}){e==="commit"&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}repaintEventsForAssignmentChanges(e){const t=[...e.added,...e.modified,...e.removed].map(i=>i.getResource());new Set(t).forEach(i=>this.repaintEventsForResource(i))}onAssignmentBeforeRemove({records:e,removingAll:t}){if(t)return;const i=this;let r;if(!i.isConfiguring&&(i.navigateToAfterRefresh||i.activeAssignment&&e.includes(i.activeAssignment))){if(e.includes(i.navigateToAfterRefresh)&&(i.navigateToAfterRefresh=null),Q.lastInteractionType==="key")for(let s=0,a=e.length;s<a&&!r;s++){const o=e[s];if(o.resource&&o.resource.isModel){let l=i.getNext(o);(!l||e.includes(l))&&(l=i.getPrevious(o)),l&&!e.includes(l)&&(r=l)}}r?(i.navigateTo(r),i.navigateToAfterRefresh=r):A.focusWithoutScrolling(i.focusElement)}}set timeRanges(e){this.project.timeRanges=e}get timeRanges(){return this.project.timeRanges}set resourceTimeRanges(e){this.project.resourceTimeRanges=e}get resourceTimeRanges(){return this.project.resourceTimeRanges}onBeforeLoad({params:e}){this.applyStartEndParameters(e)}getResourcesEventsPerTick(e,t){const{timeAxis:i,resourceStore:r}=this,s=[];return e=e||r.records,e.forEach(a=>{a.events.forEach(o=>{if(!i.isTimeSpanInAxis(o)||t&&!t.call(this,{resource:a,event:o}))return;let l=Math.floor(i.getTickFromDate(o.startDate)),c=Math.ceil(i.getTickFromDate(o.endDate));l==-1&&(l=0),c===-1&&(c=i.ticks.length);do s[l]?s[l].push(o):s[l]=[o];while(++l<c)})}),s}get widgetClass(){}};const re={block:"nearest",edgeOffset:20},Si={highlight:!1,focus:!1};var St=f=>class extends(f||R){static get $name(){return"SchedulerScroll"}async scrollEventIntoView(e,t=re){const i=this,r=e.resources||[e];if(r.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");r.length||console.warn("You have asked to scroll to an event which is not assigned to a resource"),await i.scrollResourceEventIntoView(r[0],e,t)}scrollAssignmentIntoView(e,...t){return this.scrollResourceEventIntoView(e.resource,e.event,...t)}async scrollResourceEventIntoView(e,t,i=re){const r=this,s=t.startDate,a=t.endDate,o=t.isScheduled&&s<r.timeAxis.startDate|(a>r.timeAxis.endDate)<<1;arguments.length>3&&(i=arguments[3]);let l;if(i.edgeOffset==null&&(i.edgeOffset=20),o&&i.extendTimeAxis!==!1){const u=r.timeAxis.endDate-r.timeAxis.startDate;if(o===3)await r.setTimeSpan(new Date(s.valueOf()-u/2),new Date(a.valueOf()+u/2));else if(r.infiniteScroll){const{visibleDateRange:d}=r,h=d.endMS-d.startMS,m=o&1?1:-1;await r.setTimeSpan(new Date(s.valueOf()-u/2),new Date(s.valueOf()+u/2),{visibleDate:new Date(a.valueOf()+m*h)})}else o&1?await r.setTimeSpan(new Date(s),new Date(s.valueOf()+u)):await r.setTimeSpan(new Date(a.valueOf()-u),new Date(a))}if(r.store.tree){var c;await((c=r.expandTo)===null||c===void 0?void 0:c.call(r,e))}t.parent&&!t.parent.isRoot&&await this.scrollEventIntoView(t.parent),l=r.getElementFromEventRecord(t,e),l?(A.isFocusable(l)||(l=l.parentNode),await r.timeAxisSubGrid.scrollable.scrollIntoView(l,i)):o===3&&i.extendTimeAxis===!1?console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"):!t.isOccurrence&&!r.eventStore.isAvailable(t)?console.warn("You have asked to scroll to an event which is not available"):t.isScheduled?await r.scrollUnrenderedEventIntoView(e,t,i):await r.scrollResourceIntoView(e,i)}scrollUnrenderedEventIntoView(e,t,i=re){return new Promise(r=>{const s=this,a=Object.assign({edgeOffset:20},i,Si),o=s.timeAxisSubGrid.scrollable,l=s.getResourceEventBox(t,e),c=o.viewport;if(!c||!l){r();return}l.x=Math.ceil(l.x),l.y=Math.ceil(l.y),s.rtl&&l.translate(-s.timeAxisViewModel.totalSize+c.width,0),l.translate(c.x-o.scrollLeft,c.y-o.y);const u=async({eventRecord:m,element:v,targetElement:p})=>{if(m===t){const S=v||p;d(),await h,i.highlight&&A.highlight(S),i.focus&&S.focus(),r()}},d=s.ion({renderEvent:u}),h=o.scrollIntoView(l,a);h.then(()=>{h.cancelled&&r()})})}scrollResourceIntoView(e,t=re){return this.isVertical?this.currentOrientation.scrollResourceIntoView(e,t):this.scrollRowIntoView(e,t)}get widgetClass(){}},yt=f=>class extends(f||R){static get $name(){return"SchedulerRegions"}getScheduleRegion(e,t,i=!0,r){return this.currentOrientation.getScheduleRegion(...arguments)}getResourceRegion(e,t,i){return this.currentOrientation.getRowRegion(...arguments)}getAssignmentEventBox(e,t){return this.getResourceEventBox(e.event,e.resource,t)}getResourceEventBox(e,t,i=!1,r=!1){return this.currentOrientation.getResourceEventBox(...arguments)}getItemBox(e,t=!1){return e.resources.map(i=>this.getResourceEventBox(e,i,t))}get widgetClass(){}};const Ct=["eventLayout","mode","eventColor","eventStyle","tickSize","fillTicks"];var Dt=f=>class extends(f||R){static get $name(){return"SchedulerState"}getState(){return x.copyProperties(super.getState(),this,Ct)}applyState(e){var t;this.suspendRefresh();let i=Ct.slice();(e==null?void 0:e.eventLayout)==="layoutFn"&&(delete e.eventLayout,i.splice(i.indexOf("eventLayout"),1)),e!=null&&(t=e.zoomLevelOptions)!==null&&t!==void 0&&t.width&&(i=i.filter(r=>r!=="tickSize")),x.copyProperties(this,e,i),super.applyState(e),this.resumeRefresh(!0)}get widgetClass(){}},bt=f=>class extends(f||R){static get $name(){return"EventSelection"}static get configurable(){return{highlightPredecessors:!1,highlightSuccessors:!1,deselectOnClick:!1,deselectAllOnScheduleClick:!0,selectedCollection:{}}}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected"}}afterConstruct(){var e;super.afterConstruct(),(e=this.navigator)===null||e===void 0||e.ion({navigate:"onEventNavigate",thisObj:this})}changeSelectedCollection(e){return e.isCollection||(e=new he(e)),e}updateSelectedCollection(e){const t=this;e.owner||(e.owner=t),e.ion({change:(...i)=>t.project.deferUntilRepopulationIfNeeded("onSelectedCollectionChange",(...r)=>!t.isDestroying&&t.onSelectedCollectionChange(...r),i),beforeSplice:"onBeforeSelectedCollectionSplice",thisObj:t})}get selectedCollection(){return this._selectedCollection}getActionType(e,t,i){return e.length>0?t.length>0&&i.length>0?"update":t.length>0?"select":"deselect":"clear"}getEventsFromAssignments(e){return Y.unique(e.map(t=>t.event))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(e){var t;const i=[];e=Y.asArray(e),(t=e)===null||t===void 0||t.forEach(r=>{this.isEventSelectable(r)!==!1&&(r.isOccurrence?r.assignments.forEach(s=>{i.push(this.assignmentStore.getOccurrence(s,r))}):i.push(...r.assignments))}),this.selectedCollection.splice(0,this.selectedCollection.count,i)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}isEventSelected(e){const{selectedCollection:t}=this;return!!(t.count&&t.includes(e.assignments))}isEventSelectable(e){}isAssignmentSelected(e){return this.selectedCollection.includes(e)}select(e,t=!1){e.isAssignment?this.selectAssignment(e,t):this.selectEvent(e,t)}selectEvent(e,t=!1){this.isEventSelected(e)||this.selectEvents([e],t)}selectAssignment(e,t=!1,i){this.isAssignmentSelected(e)||(t?this.selectedCollection.add(e):this.selectedAssignments=e)}deselect(e){e.isAssignment?this.deselectAssignment(e):this.deselectEvent(e)}deselectEvent(e){this.isEventSelected(e)&&this.selectedCollection.remove(...e.assignments)}deselectAssignment(e){this.isAssignmentSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e,t=!1){if(t){const i=e.reduce((r,s)=>(this.isEventSelectable(s)!==!1&&r.push(...s.assignments),r),[]);this.selectedCollection.add(i)}else this.selectedEvents=e}deselectEvents(e){this.selectedCollection.remove(e.reduce((t,i)=>(t.push(...i.assignments),t),[]))}selectAssignments(e){this.selectedCollection.add(e)}deselectAssignments(e){this.selectedCollection.remove(e)}clearEventSelection(){this.selectedAssignments=[]}onBeforeSelectedCollectionSplice({toAdd:e,toRemove:t,index:i}){const r=this,s=r._selectedCollection.values,a=e,o=t>0?a.slice(i,t+i):[],l=r.getActionType(s,a,o);if(r.trigger("beforeEventSelectionChange",{action:l,selection:r.getEventsFromAssignments(s)||[],selected:r.getEventsFromAssignments(a)||[],deselected:r.getEventsFromAssignments(o)||[]})===!1||r.trigger("beforeAssignmentSelectionChange",{action:l,selection:s,selected:a,deselected:o})===!1)return!1}onSelectedCollectionChange({added:e,removed:t}){const i=this,r=i.selectedAssignments,s=e||[],a=t||[];function o(l,c){const u=l.event;if(u){const{eventAssignHighlightCls:d}=i,h=i.getElementFromAssignmentRecord(l);i.currentOrientation.toggleCls(l,i.eventSelectedCls,c),d&&i.getElementsFromEventRecord(u).forEach(m=>{if(m!==h){const v=i.resolveAssignmentRecord(m);i.currentOrientation.toggleCls(v,d,c),c&&(m.style.animation="none",m.offsetHeight,m.style.animation=""),m.classList.toggle(d,c)}})}}if(a.forEach(l=>o(l,!1)),s.forEach(l=>o(l,!0)),(i.highlightSuccessors||i.highlightPredecessors)&&i.highlightLinkedEvents(i.selectedEvents),i.$selectedAssignments=r.map(l=>({eventId:l.eventId,resourceId:l.resourceId})),!i.silent){const l=this.getActionType(r,s,a);i.trigger("assignmentSelectionChange",{action:l,selection:r,selected:s,deselected:a}),i.trigger("eventSelectionChange",{action:l,selection:i.selectedEvents,selected:i.getEventsFromAssignments(s),deselected:i.getEventsFromAssignments(a)})}}onAssignmentChange(e){super.onAssignmentChange(e);const t=this,{action:i,records:r}=e;if(t.silent=!t.triggerSelectionChangeOnRemove,i==="remove")t.deselectAssignments(r);else if(i==="removeall"&&!t.eventStore.isSettingData)t.clearEventSelection();else if(i==="dataset"&&t.$selectedAssignments)if(!t.maintainSelectionOnDatasetChange)t.clearEventSelection();else{const s=t.$selectedAssignments.map(a=>r.find(o=>o.eventId===a.eventId&&o.resourceId===a.resourceId));t.selectedAssignments=Y.clean(s)}t.silent=!1}onInternalEventStoreChange({source:e,action:t,records:i}){!e.isResourceTimeRangeStore&&t==="dataset"&&!i.length&&this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(e,t){const i=this;i.isAssignmentSelected(t)?(i.deselectOnClick||e.ctrlKey)&&i.deselectAssignment(t,i.multiEventSelect,e):this.isEventSelectable(t.event)!==!1&&i.selectAssignment(t,e.ctrlKey&&i.multiEventSelect,e)}onEventNavigate({event:e,item:t}){if(!this.eventSelectionDisabled){const i=t&&(t.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(t):t);i?this.onAssignmentSelectionClick(e,i):this.deselectAllOnScheduleClick&&this.clearEventSelection()}}changeHighlightSuccessors(e){return this.changeLinkedEvents(e)}changeHighlightPredecessors(e){return this.changeLinkedEvents(e)}changeLinkedEvents(e){const t=this;return e?(t.highlighted=t.highlighted||new Set,t.highlightLinkedEvents(t.selectedEvents)):t.highlighted&&t.highlightLinkedEvents(),e}highlightLinkedEvents(e=[]){const t=this,{highlighted:i,eventStore:r}=t,s=t.features.dependencies;i.forEach(a=>{e.includes(a)||(a.meta.highlight=!1,i.delete(a),r.includes(a)&&a.dependencies.forEach(o=>s.unhighlight(o,"b-highlight")))}),e.forEach(a=>{const o=[a];for(;o.length;){const l=o.pop();i.add(l),t.highlightSuccessors&&l.outgoingDeps.forEach(c=>{s.highlight(c,"b-highlight"),!i.has(c.toEvent)&&o.push(c.toEvent)}),t.highlightPredecessors&&l.incomingDeps.forEach(c=>{s.highlight(c,"b-highlight"),!i.has(c.fromEvent)&&o.push(c.fromEvent)})}i.forEach(l=>l.meta.highlight=!0)}),t.element.classList.toggle("b-highlighting",e.length>0),t.refreshWithTransition()}onEventDataGenerated(e){(this.highlightSuccessors||this.highlightPredecessors)&&(e.cls["b-highlight"]=e.eventRecord.meta.highlight),super.onEventDataGenerated(e)}updateProject(e,t){this.clearEventSelection(),super.updateProject(e,t)}doDestroy(){var e;((e=this._selectedCollection)===null||e===void 0?void 0:e.owner)===this&&this._selectedCollection.destroy(),super.doDestroy()}get widgetClass(){}};const wt=f=>f.preventDefault(),yi={ArrowRight:1,ArrowLeft:1,ArrowUp:1,ArrowDown:1},Ci={animate:100},Di=Object.freeze({});var Et=f=>class extends $e(f||R){static get $name(){return"EventNavigation"}static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey",ArrowUp:"onArrowUpKey",ArrowDown:"onArrowDownKey",Escape:"onEscapeKey",Tab:"onTab","SHIFT+Tab":"onShiftTab"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:1,ArrowRight:1}}}static get defaultConfig(){return{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}}construct(e){const t=this;t.isInTimeAxis=t.isInTimeAxis.bind(t),t.onDeleteKey=t.throttle(t.onDeleteKey,t.onDeleteKeyBuffer,t),super.construct(e)}changeNavigator(e){const t=this;return t.getConfig("subGridConfigs"),new Vt(t.constructor.mergeConfigs({ownerCmp:t,target:t.timeAxisSubGridElement,processEvent:t.processEvent,itemSelector:`.${t.eventCls}-wrap`,focusCls:t.focusCls,navigatePrevious:t.throttle(t.navigatePrevious,{delay:t.navigatePreviousBuffer,throttled:wt}),navigateNext:t.throttle(t.navigateNext,{delay:t.navigateNextBuffer,throttled:wt})},e))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}onElementKeyDown(e){var t,i;const r=this,{navigator:s}=r;if(((t=r.focusedCell)===null||t===void 0?void 0:t.rowIndex)!==-1&&((i=r.focusedCell)===null||i===void 0?void 0:i.column)===r.timeAxisColumn&&!e.target.closest(s.itemSelector)&&e.key==="Enter"){const o=r.getFirstVisibleAssignment();if(o)return r.navigateTo(o,{uiEvent:e}),!1}else{var a;(a=super.onElementKeyDown)===null||a===void 0||a.call(this,e)}}getFirstVisibleAssignment(e=this.focusedCell){const t=this,{currentOrientation:i,rowManager:r,eventStore:s}=t;if(t.isHorizontal){var a;let d=i.rowMap.get(r.getRow(e.rowIndex));if((a=d)!==null&&a!==void 0&&a.length){var o;return(o=d[0])===null||o===void 0?void 0:o.elementData.assignmentRecord}else{var l,c;if(d=(l=i.resourceMap.get(e.id))===null||l===void 0?void 0:l.eventsData,(c=d)!==null&&c!==void 0&&c.length){var u;return(u=d.filter(h=>s.isAvailable(h.eventRecord))[0])===null||u===void 0?void 0:u.assignmentRecord}}}else{const d=[...i.resourceMap.values()][0],h=d&&Object.values(d);if(h!=null&&h.length)return h.filter(m=>s.isAvailable(m.renderData.eventRecord))[0].renderData.assignmentRecord}}onGridBodyFocusIn(e){const t=e.target.closest(this.focusableSelector);if(this.timeAxisSubGridElement.contains(e.target)){const r=this,{navigationEvent:s}=r,{target:a}=e,o=a.closest(r.navigator.itemSelector),l=o?r.normalizeCellContext({rowIndex:r.isVertical?0:r.resourceStore.indexOf(r.resolveResourceRecord(a)),column:r.timeAxisColumn,target:a}):new si(a);if(o){var i;const{_focusedCell:c}=r;r._focusedCell=l,(i=r.onCellNavigate)===null||i===void 0||i.call(r,r,c,l,s,!0);return}if(t&&(!s||yi[s.key])){const c=r.getFirstVisibleAssignment(l);if(c){r.navigateTo(c,{scrollIntoView:!!(s&&s.type!=="mousedown"),uiEvent:s||e});return}}}t&&super.onGridBodyFocusIn(e)}accessibleFocusCell(e,t){const i=this;if(e=i.normalizeCellContext(e),e.columnId!==i.timeAxisColumn.id)return super.focusCell(e,t)}normalizeTarget(e){return e.assignmentRecord}getPrevious(e,t){const i=this,{resourceStore:r}=i,{eventSorter:s}=i.currentOrientation,{startDate:a,endDate:o}=i.timeAxis,l=e.event,c=i.eventStore.getEvents({resourceRecord:e.resource,startDate:a,endDate:o}).filter(this.isInTimeAxis).sort(s);let u=e.resource,d=c[c.indexOf(l)-1];if(!d)for(let h=r.indexOf(u)-1;(!d||t&&d===l)&&h>=0;h--){u=r.getAt(h);const m=i.eventStore.getEvents({resourceRecord:u,startDate:a,endDate:o}).filter(i.isInTimeAxis).sort(s);d=m.length&&m[m.length-1]}return i.assignmentStore.getAssignmentForEventAndResource(d,u)}navigatePrevious(e){const t=this,i=t.getPrevious(t.normalizeTarget(e));return e.preventDefault(),i?(e.ctrlKey||t.clearEventSelection(),t.navigateTo(i,{uiEvent:e})):t.doGridNavigation(e)}getNext(e,t){const i=this,{resourceStore:r}=i,{eventSorter:s}=i.currentOrientation,{startDate:a,endDate:o}=i.timeAxis,l=e.event,c=i.eventStore.getEvents({resourceRecord:e.resource,startDate:a,endDate:o}).filter(this.isInTimeAxis).sort(s);let u=e.resource,d=c[c.indexOf(l)+1];if(!d)for(let h=r.indexOf(u)+1;(!d||t&&d===l)&&h<r.count;h++)u=r.getAt(h),d=i.eventStore.getEvents({resourceRecord:u,startDate:a,endDate:o}).filter(i.isInTimeAxis).sort(s)[0];return i.assignmentStore.getAssignmentForEventAndResource(d,u)}navigateNext(e){const t=this,i=t.getNext(t.normalizeTarget(e));return e.preventDefault(),i?(e.ctrlKey||t.clearEventSelection(),t.navigateTo(i,{uiEvent:e})):t.doGridNavigation(e)}doGridNavigation(e){!e.handled&&e.key.indexOf("Arrow")===0&&this[`navigate${e.key.substring(5)}ByKey`](e)}async navigateTo(e,{scrollIntoView:t=!0,uiEvent:i={}}=Di){const r=this,{navigator:s}=r,{skipScrollIntoView:a}=s;e&&(t?(s.disabled=!0,await r.scrollAssignmentIntoView(e,Ci),s.disabled=!1):s.skipScrollIntoView=!0,!r.isDestroyed&&this.getElementFromAssignmentRecord(e)&&(r.activeAssignment=e,s.skipScrollIntoView=a,s.trigger("navigate",{event:i,item:r.getElementFromAssignmentRecord(e).closest(s.itemSelector)})))}set activeAssignment(e){const t=this.getElementFromAssignmentRecord(e,!0);t&&(this.navigator.activeItem=t)}get activeAssignment(){const{activeItem:e}=this.navigator;if(e)return this.resolveAssignmentRecord(e)}get previousActiveEvent(){const{previousActiveItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}processEvent(e){const t=this,i=e.target.closest(t.eventSelector);return!t.navigator.disabled&&i&&(e.assignmentRecord=t.resolveAssignmentRecord(i),e.eventRecord=t.resolveEventRecord(i),e.resourceRecord=t.resolveResourceRecord(i)),e}onDeleteKey(e){const t=this;if(!t.readOnly&&t.enableDeleteKey){const i=t.eventStore.usesSingleAssignment?t.selectedEvents:t.selectedAssignments;t.removeEvents(i.filter(r=>!r.readOnly))}}onArrowUpKey(e){this.focusCell({rowIndex:this.focusedCell.rowIndex-1,column:this.timeAxisColumn}),e.handled=!0}onArrowDownKey(e){this.focusedCell.rowIndex<this.resourceStore.count-1&&(this.focusCell({rowIndex:this.focusedCell.rowIndex+1,column:this.timeAxisColumn}),e.handled=!0)}onEscapeKey(e){e.target.closest(".b-dragging")||(this.focusCell({rowIndex:this.focusedCell.rowIndex,column:this.timeAxisColumn}),e.handled=!0)}onEventSpaceKey(e){}onEventEnterKey(e){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}},xt=f=>{var n;return n=class extends f{static get $name(){return"TransactionalFeatureMixin"}get widgetClass(){}get transactionalFeaturesEnabled(){var t;return this.enableTransactionalFeatures&&((t=this.project)===null||t===void 0?void 0:t.queue)}},D(n,"configurable",{enableTransactionalFeatures:!1,testConfig:{enableTransactionalFeatures:!1}}),n},Re=f=>class extends f{static get $name(){return"AttachToProjectMixin"}async afterConstruct(){var e;super.afterConstruct();const t=this,i=t.client||t.grid,{project:r}=i;(e=i.projectSubscribers)===null||e===void 0||e.push(t),r&&(t.attachToProject(r),t.attachToResourceStore(r.resourceStore),t.attachToEventStore(r.eventStore),t.attachToAssignmentStore(r.assignmentStore),t.attachToDependencyStore(r.dependencyStore),t.attachToCalendarManagerStore(r.calendarManagerStore))}attachToProject(e){var t;this.detachListeners("project"),this._project=e,(t=super.attachToProject)===null||t===void 0||t.call(this,e)}detachFromProject(e){var t;(t=super.detachFromProject)===null||t===void 0||t.call(this,e)}attachToEventStore(e){var t;this.detachListeners("eventStore"),(t=super.attachToEventStore)===null||t===void 0||t.call(this,e)}attachToResourceStore(e){var t;this.detachListeners("resourceStore"),(t=super.attachToResourceStore)===null||t===void 0||t.call(this,e)}attachToAssignmentStore(e){var t;this.detachListeners("assignmentStore"),(t=super.attachToAssignmentStore)===null||t===void 0||t.call(this,e)}attachToDependencyStore(e){var t;this.detachListeners("dependencyStore"),(t=super.attachToDependencyStore)===null||t===void 0||t.call(this,e)}attachToCalendarManagerStore(e){var t;this.detachListeners("calendarManagerStore"),(t=super.attachToCalendarManagerStore)===null||t===void 0||t.call(this,e)}get project(){return this._project}get calendarManagerStore(){return this.project.calendarManagerStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}get eventStore(){return this.project.eventStore}get dependencyStore(){return this.project.dependencyStore}};const bi={releaseElement:1,reuseElement:1},wi={newElement:1,reuseOwnElement:1,reuseElement:1},Ae=9999999,Ei=({startDateMS:f},{startDateMS:n})=>f-n,xi={startDate:1,endDate:1,duration:1};function Rt(f,n,e,t,i){var r,s;const{timeAxis:a}=f,o=n.isBatchUpdating&&!i?n.get(t):n[t],l=(r=n.hasBatchedChange)===null||r===void 0?void 0:r.call(n,t);if(f.fillTicks&&(!((s=n.meta)!==null&&s!==void 0&&s.isResizing)||!l)){let u=a.getTickFromDate(o);if(u>=0){e&&u===Math.round(u)&&u>0&&u--;const d=Math.floor(u);return a.getAt(d)[t].getTime()}}return o==null?void 0:o.getTime()}class se extends R.mixin(Re){static get configurable(){return{bufferSize:150,verticalBufferSize:150}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],isFirstRefresh:!0,toDrawOnProjectRefresh:new Set,toDrawOnDataReady:new Set}}construct(n){const e=this;e.client=e.scheduler=n,e.eventSorter=e.eventSorter.bind(n),e.scrollBuffer=n.scrollBuffer,n.scrollable.ion({scroll:"onEarlyScroll",prio:1,thisObj:e}),n.rowManager.ion({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",offsetRows:"onOffsetRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:e}),super.construct({})}init(){}updateVerticalBufferSize(){const{rowManager:n}=this.scheduler;this.scheduler.isPainted&&n.renderRows(n.rows)}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(n,e,t,i=!1){const{scheduler:r}=this;let s=n[0];return t||(s=this.translateToScheduleCoordinate(s)),s=r.getRtlX(s),r.timeAxisViewModel.getDateFromPosition(s,e,i)}translateToScheduleCoordinate(n){const{scheduler:e}=this,{scrollable:t}=e.timeAxisSubGrid;let i=n-e.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return e.rtl?i+=t.maxX-Math.abs(e.scrollLeft):i+=e.scrollLeft,i}translateToPageCoordinate(n){const{scheduler:e}=this,{scrollable:t}=e.timeAxisSubGrid;let i=n+e.timeAxisSubGridElement.getBoundingClientRect().left;return e.rtl?i-=t.maxX-Math.abs(e.scrollLeft):i-=e.scrollLeft,i}getScheduleRegion(n,e,t=!0,i,r=!1){var s,a;const o=this,{scheduler:l}=o,{timeAxisSubGridElement:c,timeAxis:u}=l,d=(!r||n)&&l.getResourceMargin(n)||0;let h;if(n){const y=e&&l.getElementsFromEventRecord(e,n)[0];if(h=P.from(l.getRowById(n.id).getElement("normal"),c),y){const C=P.from(y,c);h.y=C.y,h.bottom=C.bottom}else h.y=h.y+d,h.bottom=h.bottom-d}else h=P.from(c).moveTo(null,0),h.width=c.scrollWidth,h.y=h.y+d,h.bottom=h.bottom-d;const m=u.startDate,v=u.endDate;i=((s=i)===null||s===void 0?void 0:s.start)&&i||((a=l.getDateConstraints)===null||a===void 0?void 0:a.call(l,n,e))||{start:m,end:v};let p=l.getCoordinateFromDate(i.start?g.max(m,i.start):m),S=l.getCoordinateFromDate(i.end?g.min(v,i.end):v);return t||(p=o.translateToPageCoordinate(p),S=o.translateToPageCoordinate(S)),h.left=Math.min(p,S),h.right=Math.max(p,S),h}getRowRegion(n,e,t){const{scheduler:i}=this,{timeAxis:r}=i,s=i.getRowById(n.id);if(!s)return null;const a=r.startDate,o=r.endDate,l=e?g.max(a,e):a,c=t?g.min(o,t):o,u=i.getCoordinateFromDate(l),d=i.getCoordinateFromDate(c,!0,!0),h=s.top,m=Math.min(u,d),v=h+s.offsetHeight;return new P(m,h,Math.max(u,d)-m,v-h)}getResourceEventBox(n,e,t,i=!1){const r=this.resourceMap.get(e.id);let s=null,a=!1;if(r&&(s=r.eventsData.find(o=>o.eventRecord===n)),s||(s=this.getTimeSpanRenderData(n,e,{viewport:!0,timeAxis:t}),a=!0),s){const o=this.scheduler.rowManager.getRecordCoords(e,!0,i),l=s.top+o.top,c=new P(s.left,l,s.width,s.height);return c.layout=!a,c.rowTop=o.top,c.rowBottom=o.bottom,c.resourceId=e.id,c}return null}resolveRowRecord(n){const e=this,{scheduler:t}=e,i=n.nodeType?n:n.target,r=i.nodeType===Element.TEXT_NODE?i.parentElement:i,s=r.closest(t.eventSelector);return s?e.resourceStore.getById(s.dataset.resourceId):!r.closest(".b-grid-row")&&r.dataset.resourceId?e.resourceStore.getById(r.dataset.resourceId):t.getRecordFromElement(r)}attachToProject(n){super.attachToProject(n),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),n==null||n.ion({name:"project",refresh:"onProjectRefresh",commitFinalized:"onProjectCommitFinalized",thisObj:this})}onProjectCommitFinalized(){const{scheduler:n,toDrawOnDataReady:e,project:t}=this;n.isVisible?n.isPainted&&!n.refreshSuspended&&(!e.size&&t.timeZone!=null&&t.ignoreRecordChanges&&t.resourceStore.forEach(i=>e.add(i.id)),e.size&&(this.clearResources(e),this.refreshResources(e)),e.clear()):n.whenVisible("refreshRows")}onProjectRefresh({isCalculated:n,isInitialCommit:e}){const t=this,{scheduler:i,toDrawOnProjectRefresh:r}=t;if(i.isVisible){if(i.isPainted&&!i.isConfiguring&&!i.refreshSuspended){if(t.refreshAllWhenReady||e&&n){i.calculateAllRowHeights(!0);const{rowManager:s}=i;s.topRow?(t.clearAll(),i.refreshAfterProjectRefresh||(s.topRow.dataIndex>=i.store.count?i.renderRows(!1):i.refreshWithTransition(!1,!t.isFirstRefresh&&n&&!e)),t.isFirstRefresh=!1):s.reinitialize(),t.refreshAllWhenReady=!1}else r.size&&t.refreshResources(r);r.clear()}}else i.whenVisible("refresh",i,[!0])}attachToAssignmentStore(n){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(n),n&&n.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({source:n,action:e,records:t=[],replaced:i,changes:r}){const s=this,{scheduler:a}=s,o=new Set(t.flatMap(l=>{var d;var c,u;return[l.resourceId,...(d=(c=l.resource)===null||c===void 0||(u=c.$links)===null||u===void 0?void 0:u.map(h=>h.id))!=null?d:[]]}));if(!(s.resourceStore.isRemoving||s.resourceStore.isChangingId))switch(e){case"dataset":{s.eventStore.usesSingleAssignment||(o.size?s.refreshResourcesWhenReady(o):(s.clearAll(),a.refreshWithTransition()));return}case"add":case"remove":case"updateMultiple":s.refreshResourcesWhenReady(o);return;case"removeall":s.refreshAllWhenReady=!0;return;case"replace":i.forEach(([l,c])=>{o.add(l.resourceId),o.add(c.resourceId)}),s.refreshResourcesWhenReady(o);return;case"filter":s.clearAll(),a.calculateAllRowHeights(!0),a.refreshWithTransition();return;case"update":{("eventId"in r||"resourceId"in r||"id"in r)&&("resourceId"in r&&o.add(r.resourceId.oldValue),n===a.project.assignmentStore?s.refreshResourcesOnDataReady(o):s.refreshResources(o));break}case"clearchanges":{const{added:l,modified:c,removed:u}=r;c.length?a.refreshWithTransition():(l.forEach(d=>o.add(d.resourceId)),u.forEach(d=>o.add(d.resourceId)),s.refreshResourcesOnDataReady(o))}}}onAssignmentStoreRefresh({action:n,records:e}){n==="batch"&&(this.clearAll(),this.scheduler.refreshWithTransition())}attachToEventStore(n){this.refreshAllWhenReady=!0,super.attachToEventStore(n),n&&n.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:n}){for(const e of this.client.getElementsFromEventRecord(n))e.classList.remove("b-iscreating")}onEventStoreRefresh({action:n}){if(n==="batch"){const{scheduler:e}=this;e.isEngineReady&&e.isPainted&&(this.clearAll(),e.refreshWithTransition())}}onEventStoreChange({action:n,records:e=[],record:t,replaced:i,changes:r,source:s}){const a=this,{scheduler:o}=a,l=s.isResourceTimeRangeStore,c=new Set;if(o.isPainted)if(e.forEach(h=>{var m;const v=(m=h.$linkedResources)===null||m===void 0?void 0:m.filter(p=>a.resourceStore.includes(p));v==null||v.forEach(p=>c.add(p.id))}),l){switch(n){case"removeall":case"dataset":a.clearAll(),o.refreshWithTransition();return}a.refreshResources(c)}else{switch(n){case"batch":case"sort":case"group":case"move":return;case"remove":return;case"clearchanges":a.clearAll(),o.refreshWithTransition();return;case"dataset":{a.clearAll(),o.isEngineReady?o.refreshWithTransition():a.refreshAllWhenReady=!0;return}case"add":case"updateMultiple":break;case"replace":i.forEach(([,h])=>{h.resources.map(m=>c.add(m.id))});break;case"removeall":case"filter":if(!o.isEngineReady){a.refreshAllWhenReady=!0;return}a.clearAll(),o.calculateAllRowHeights(!0),o.refreshWithTransition();return;case"update":{const h=t.$entity?!Object.keys(r).some(v=>!t.$entity.getField(v)):!Object.keys(r).some(v=>!xi[v]);let m=0;if("startDate"in r&&m++,"endDate"in r&&m++,"duration"in r&&m++,"resourceId"in r&&c.add(r.resourceId.oldValue),c.size&&(!h||m&&!("duration"in r&&m===1)||"percentDone"in r||"inactive"in r||"constraintDate"in r||"constraintType"in r||"segments"in r)){var u,d;(u=a.project)!==null&&u!==void 0&&u.propagatingLoadChanges||(d=a.project)!==null&&d!==void 0&&d.isWritingData?a.refreshResourcesOnDataReady(c):a.refreshResources(c)}return}}a.refreshResourcesWhenReady(c)}}attachToResourceStore(n){this.refreshAllWhenReady=!0,super.attachToResourceStore(n),n&&(this.clearAll({clearLayoutCache:!0}),n.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}get resourceStore(){return this.client.store}onResourceStoreChange({action:n,isExpand:e,records:t,changes:i}){const r=this,s=t==null?void 0:t.flatMap(a=>a.isLinked?[a.id,a.$originalId]:[a.id]);if(r.scheduler.isPainted){switch(n){case"add":e||(t.every(a=>a.isLinked)?r.refreshResources(s):r.refreshResourcesWhenReady(s));return;case"update":{!r.project.isBatchingChanges&&!i.isLeaf&&r.refreshResources(s);return}case"filter":return;case"removeall":r.clearAll({clearLayoutCache:!0});return;case"dataset":return}s&&r.clearResources(s)}}onTranslateRow({row:n}){n.id!=null&&this.refreshEventsForResource(n,!1)}onOffsetRows(){this.clearAll(),this.doUpdateTimeView()}calculateRowHeight(n){var e;const{scheduler:t}=this,i=t.getResourceHeight(n),r=t.getEventLayout(n);if(r.type==="stack"&&t.isEngineReady&&!n.isSpecialRow&&((e=n.assigned)===null||e===void 0?void 0:e.size)>1){const{assignmentStore:a,eventStore:o,timeAxis:l}=t,{barMargin:c,resourceMargin:u,contentHeight:d}=t.getResourceLayoutSettings(n),h=(o.isFiltered||a.isFiltered)&&(S=>S.assignments.some(y=>y.resource===n.$original&&a.includes(y))),m=o.getEvents({resourceRecord:n,includeOccurrences:t.enableRecurringEvents,startDate:l.startDate,endDate:l.endDate,filter:h}).sort(Ei).map(S=>{const y=S.isBatchUpdating?S.get("startDate"):S.startDate,C=S.isBatchUpdating?S.get("endDate"):S.endDate||y;return{eventRecord:S,resourceRecord:n,startMS:y.getTime(),endMS:C.getTime()}}),v=t.getEventLayoutHandler(r),p=v.layoutEventsInBands(m,n,!0);return v.type==="layoutFn"?p:p*d+(p-1)*c+u*2}return i}doUpdateTimeView(){const{scrollable:n}=this.scheduler.timeAxisSubGrid;this.updateFromHorizontalScroll(n.x,!0)}onTimeAxisViewModelUpdate(){const n=this,{scheduler:e}=n;n.clearAll(),e.refreshSuspended&&(n.detachListeners("renderingSuspend"),e.ion({name:"renderingSuspend",resumeRefresh({trigger:t}){e.isEngineReady&&t&&n.doUpdateTimeView()},thisObj:n,once:!0})),n.doUpdateTimeView()}getConnectorStartSide(n){return"start"}getConnectorEndSide(n){return"end"}refreshRows(n){n&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(n,e,t,i){e>i&&this.onRenderDone()}onDragAbort({context:n,dragData:e}){this.resourceStore.indexOf(e.record.resource)<this.scheduler.topRow.dataIndex&&n.element.remove()}toggleCls(n,e,t=!0,i=!1){const r=this.client.getElementFromAssignmentRecord(n,i),s=this.resourceMap.get(n.isModel?n.get("resourceId"):n.resourceId),a=s==null?void 0:s.eventsData.find(o=>o.eventId===n.eventId);a&&(a[i?"wrapperCls":"cls"][e]=t),r&&(r.classList[t?"add":"remove"](e),r.lastDomConfig.className[e]=t)}onRemoveRows({rows:n}){n.forEach(e=>this.rowMap.delete(e)),this.onRenderDone()}onEarlyScroll(){this.rendererCalled=!1}updateFromVerticalScroll(){this.fromScroll=!0,this.rendererCalled||this.onRenderDone()}updateFromHorizontalScroll(n,e){var t,i;const r=this,{scheduler:s,scrollBuffer:a}=r,o=a===-1,{timeAxisSubGrid:l,timeAxis:c,rtl:u}=s,{width:d}=l,{totalSize:h}=s.timeAxisViewModel,m=n,v=l.scrollable.maxX!==0&&Math.abs(l.scrollable.maxX)<=Math.round(m)+5,p=o?c.startDate:s.getDateFromCoord({coord:Math.max(0,m-a),ignoreRTL:!0}),S=v||o?c.endDate:s.getDateFromCoord({coord:m+d+a,ignoreRTL:!0})||c.endDate;if(p&&!s._viewPresetChanging&&(!o||e||p-(((t=r._visibleDateRange)===null||t===void 0?void 0:t.startDate)||0)||S-(((i=r._visibleDateRange)===null||i===void 0?void 0:i.endDate)||0))){r._visibleDateRange={startDate:p,endDate:S,startMS:p.getTime(),endMS:S.getTime()},r.viewportCoords=o?{left:0,right:h}:u?{left:h-n-d+a,right:h-n-a}:{left:n-a,right:n+d+a};const y=s.timeView.range={startDate:p,endDate:S};if(s.onVisibleDateRangeChange(y),!s.refreshSuspended&&s.rowManager.rows.length){if(s.rowManager.rows[0].id===null)return;r.fromScroll=!0,s.rowManager.rows.forEach(C=>r.refreshEventsForResource(C,!1,!1)),r.onRenderDone()}}}repaintEventsForResource(n){this.refreshResources([n.id])}onBeforeRowHeightChange(){this.clearAll()}refreshResourcesOnDataReady(n){n.forEach(e=>this.toDrawOnDataReady.add(e))}refreshResourcesWhenReady(n){this.clearResources(n),n.forEach(e=>this.toDrawOnProjectRefresh.add(e))}refreshResources(n,e=!0){const t=this,{scheduler:i}=t,r=[],s=[];t.clearResources(n),i.refreshSuspended||(n.forEach(a=>{const o=i.getRowById(a);o?r.push(o):s.push(o)}),i.runWithTransition(()=>{i.calculateRowHeights(s.map(a=>this.resourceStore.getById(a)),!0),i.rowManager.renderRows(r)},e))}layoutEventVerticallyStack(n,e,t){const{barMargin:i,resourceMargin:r,contentHeight:s}=this.scheduler.getResourceLayoutSettings(t,e.parent);return n===0?r:r+n*s+n*i}layoutEventVerticallyPack(n,e,t,i){const{barMargin:r,resourceMargin:s,contentHeight:a}=this.scheduler.getResourceLayoutSettings(i,t.parent),o=1/e,l=n*o,c=(a-(o-1)*r)*e;return{top:s+l*c+l*r,height:c}}addTemporaryDragElement(n,e=n.resource){const{scheduler:t}=this,i=t.generateRenderData(n,e,{timeAxis:!0,viewport:!0});i.absoluteTop=i.row?i.top+i.row.top:t.getResourceEventBox(n,e,!0).top;const r=this.renderEvent(i),{dataset:s}=r;delete r.tabIndex,delete s.eventId,delete s.resourceId,delete s.assignmentId,delete s.syncId,s.transient=!0,r.parent=this.scheduler.foregroundCanvas,r.retainElement=!0;const a=A.createElement(r);return a.innerElement=a.firstChild,n.instanceMeta(t).hasTemporaryDragElement=!0,a}eventSorter(n,e){if(this.overlappingEventSorter)return this.overlappingEventSorter(n.eventRecord||n,e.eventRecord||e);const t=n.isModel?n.startDateMS:n.dataStartMS||n.startMS,i=n.isModel?n.endDateMS:n.dataEndMS||n.endMS,r=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,s=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,a=n.isModel?n.name:n.eventRecord.name,o=e.isModel?e.name:e.eventRecord.name;return t-r||s-i||(a<o?-1:a==o?0:1)}calculateMS(n,e,t,i,r){const s=this,{scheduler:a}=s,{timeAxisViewModel:o}=a;let l=Rt(a,n,!1,e,i),c=Rt(a,n,!0,t,i),u=c-l;if(a.milestoneLayoutMode!=="default"&&u===0){const d=o.getSingleUnitInPixels("minute");if(u=a.getMilestoneLabelWidth(n,r)*(1/d)*60*1e3,a.milestoneTextPosition==="always-outside"){const v=a.getResourceLayoutSettings(r,n.parent).contentHeight,p=v*(1/d)*60*1e3;l-=p/2,c=l+u}else switch(a.milestoneAlign){case"start":case"left":c=l+u;break;case"end":case"right":c=l,l=c-u;break;default:c=l+u/2,l=c-u;break}}return{startMS:l,endMS:c,durationMS:u}}setupRenderData(n,e){var t;const i=this,{scheduler:r}=i,{timeAxis:s,timeAxisViewModel:a}=r,{preamble:o,postamble:l}=n,c=i.isProHorizontalRendering&&((t=r.features.eventBuffer)===null||t===void 0?void 0:t.enabled)&&(o||l)&&!n.isMilestone,u=a.getSingleUnitInPixels("minute"),{isBatchUpdating:d}=n,h=c?"wrapStartDate":"startDate",m=c?"wrapEndDate":"endDate",v=d&&!c?n.get(h):n[h],p=d&&!c?n.get(m):n[m]||v,S=s.startMS,y=s.endMS,{startMS:C,endMS:b,durationMS:w}=i.calculateMS(n,h,m,c,e),M=C<S|(C>y)<<1,T=b>y|(b<=S)<<1,F=w/(1e3*60),E=T?u*F:null,j=r.getRowById(e);return{eventRecord:n,taskRecord:n,start:v,end:p,rowId:e.id,children:[],startMS:C,endMS:b,durationMS:w,startsOutsideView:M,endsOutsideView:T,width:E,row:j,useEventBuffer:c}}fillTimeSpanHorizontalPosition(n){const{startMS:e,endMS:t,durationMS:i}=n,r=e!=null&&t!=null&&this.calculateHorizontalPosition(n,e,t,i);return r?(Object.assign(n,r),!0):!1}calculateHorizontalPosition(n,e,t,i){const{scheduler:r}=this,{timeAxis:s,timeAxisViewModel:a}=r,{startsOutsideView:o,endsOutsideView:l,eventRecord:c}=n,u=s.startMS,d=a.getSingleUnitInPixels("minute"),h=i/(1e3*60),m=l?d*h:null;let v=r.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0}),p,S=!1,y=!1;return o?(p=(e-u)/(1e3*60)*d,r.rtl&&(p=r.timeAxisSubGrid.scrollable.scrollWidth-p)):(p=r.getCoordinateFromDate(e,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:v!==-1}),S=p===-1),l?z.isSafari&&r.features.stickyEvents&&s.endMS||v===-1&&!s.continuous?v=r.getCoordinateFromDate(s.endMS):v=p+m*(r.rtl?-1:1):y=v===-1,y&&!S&&(v=r.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),m>Ae&&(o===1?l===1?(p=-100,v=r.timeAxisColumn.width+100):p=v-Ae:l===1&&(v=p+Ae)),S&&y&&(p=r.getCoordinateFromDate(e,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:t}),v=r.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:e}),p===v)?(c.instanceMeta(r).excluded=!0,null):{left:Math.min(p,v),width:Math.abs(v-p)||(c.isMilestone&&!c.meta.isDragCreating?0:6),clippedStart:S,clippedEnd:y}}fillTimeSpanVerticalPosition(n,e){const{scheduler:t}=this,{start:i,end:r}=n,{resourceMargin:s,contentHeight:a}=t.getResourceLayoutSettings(e);t.fillTicks&&(n.dataStartMS=i.getTime(),n.dataEndMS=r.getTime()),n.top=Math.max(0,s),t.managedEventSizing&&(n.height=a)}getTimeSpanRenderData(n,e,t=!1){const i=this,{scheduler:r}=i,{timeAxis:s}=r,a=t===!0||t.timeAxis,o=t===!0||t.viewport;if((a||s.isTimeSpanInAxis(n))&&(r.getRowById(e)||o)){const c=i.setupRenderData(n,e);return i.fillTimeSpanHorizontalPosition(c)?(i.fillTimeSpanVerticalPosition(c,e),c):null}}layoutEvents(n,e,t=!1,i,r){const s=this,{scheduler:a}=s,{timeAxis:o}=a,l=e.reduce((m,v)=>{if(t||o.isTimeSpanInAxis(v)){const p=a.generateRenderData(v,n,!1);p&&m.push(p)}return m},[]);l.sort(r!=null?r:s.eventSorter);let c=a.getAppliedResourceHeight(n,i);const u=l.filter(({eventRecord:m})=>m.isEvent&&!m.meta.excludeFromLayout),d=a.getEventLayout(n,i),h=a.getEventLayoutHandler(d);if(h){const{barMargin:m,resourceMargin:v,contentHeight:p}=a.getResourceLayoutSettings(n,i),S=h.applyLayout(u,n)||1;h.type==="layoutFn"?c=S:c=S*p+(S-1)*m+v*2}else if(u.length>0)for(let m=0;m<u.length;m++){const v=u[m];v.wrapperStyle+=`;z-index:${m+5}`}return{rowHeight:c,eventsData:l}}layoutResourceEvents(n,e=!1){const t=this,{scheduler:i}=t,{eventStore:r,assignmentStore:s,timeAxis:a}=i,o=r.getEvents({includeOccurrences:i.enableRecurringEvents,resourceRecord:n,startDate:a.startDate,endDate:a.endDate,filter:(s.isFiltered||r.isFiltered)&&(c=>c.assignments.some(u=>u.resource===n.$original&&s.includes(u)))}),l=i.getEventsToRender(n,o)||[];return t.layoutEvents(n,l,e)}renderEvent(n,e){const{scheduler:t}=this,{resourceRecord:i,assignmentRecord:r,eventRecord:s}=n,{milestoneLayoutMode:a,milestoneTextPosition:o}=t,l=r?this.assignmentStore.getOccurrence(r,s).id:n.eventId,c={className:n.cls,style:n.style||"",children:n.children,role:"presentation",dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},u={className:n.wrapperCls,tabIndex:"tabIndex"in n?n.tabIndex:-1,children:[c,...n.wrapperChildren],style:{top:n.absoluteTop,left:n.left,height:n.fillSize?e:n.height,width:s.isMilestone&&!s.meta.isDragCreating&&(a==="default"&&(o==="outside"||o==="inside"&&!n.width)||o==="always-outside")?n.height:n.width,style:n.wrapperStyle,fontSize:n.height+"px"},dataset:{resourceId:i.id,eventId:n.eventId,syncId:i.isLinked?`${l}_${i.id}`:l},elementData:n,retainElement:(r==null?void 0:r.instanceMeta(t).retainElement)||s.instanceMeta(t).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return n.fillSize&&(n.height=e),n.zIndex&&(u.zIndex=n.zIndex),r&&(u.dataset.assignmentId=r.id),n.elementConfig=u,t.afterRenderEvent({renderData:n,rowHeight:e,domConfig:u}),u}refreshEventsForResource(n,e=!0,t=!0){const i=this,r=i.scheduler.store.getById(n.isRow?n.id:n),s=i.scheduler.rowManager.getRowFor(r);e&&i.clearResources([r]),s&&r&&(i.renderer({row:s,record:r}),e&&t&&i.onRenderDone())}getResourceLayout(n){const e=this;let t=e.resourceMap.get(n.id);if(!t||t.invalid){if(e.suspended)return;t=e.layoutResourceEvents(n,!1),e.resourceMap.set(n.id,t)}return t}getEventDOMConfigForCurrentView(n,e,t,i){const r=this,{bufferSize:s,scheduler:a}=r,{labels:o,eventBuffer:l}=a.features,c=(l==null?void 0:l.enabled)||(o==null?void 0:o.enabled)&&(o.left||o.right||o.before||o.after),{eventsData:u}=n,d=r.fromScroll?r.rowMap.get(e):null,h=[];let m,v;for(let p=0;p<u.length;p++){const S=u[p];if(m=t,v=i,(c||S.width===0)&&(m-=s,v+=s),S.left+S.width>=m&&S.left<=v){S.absoluteTop=S.top+e.top;const y=d==null?void 0:d.find(C=>C.elementData.eventId===S.eventId&&C.elementData.resourceId===S.resourceId);h.push(y!=null?y:r.renderEvent(S,n.rowHeight))}}return h}renderer({row:n,record:e,size:t={}}){const i=this;if(e.isSpecialRow){i.rowMap.delete(n);return}const{left:r,right:s}=i.viewportCoords,a=i.getResourceLayout(e);if(!a)return;t.height=a.rowHeight,t.transient=!0;const o=i.getEventDOMConfigForCurrentView(a,n,r,s);i.rowMap.set(n,o),i.rendererCalled=!0}onRenderDone(){var c;const{scheduler:n,rowMap:e,verticalBufferSize:t}=this,i=[],r=(c=n._scrollTop)!=null?c:0,s=r-t,a=r+n._bodyRectangle.height+t,o=t<0,l=!n.managedEventSizing;e.forEach((u,d)=>{if(o||d.bottom>s&&d.top<a)for(let h=0;h<u.length;h++){const m=u[h],v=m.elementData,{absoluteTop:p,eventRecord:S}=v;(o||l||S.meta.isDragCreating||S.meta.isResizing||p+v.height>s&&p<a)&&i.push(m)}for(let h=0;h<u.length;h++)u[h]={...u[h]}}),this.fromScroll=!1,this.visibleEventDOMConfigs=i,G.sync({domConfig:{onlyChildren:!0,children:i},targetElement:n.foregroundCanvas,syncIdField:"syncId",callback({action:u,domConfig:d,lastDomConfig:h,targetElement:m,jsx:v}){var p,S;const{reactComponent:y}=n,C=bi[u],b=wi[u];if(!C&&((p=n.processEventContent)===null||p===void 0||p.call(n,{jsx:v,action:u,domConfig:d,targetElement:m,isRelease:C,reactComponent:y})),!(u==="none"||!(d!=null&&(S=d.elementData)!==null&&S!==void 0&&S.isWrap))){if(C&&h!==null&&h!==void 0&&h.elementData){var w;const{eventRecord:M,resourceRecord:T,assignmentRecord:F}=h.elementData,E={renderData:h.elementData,element:m,eventRecord:M,resourceRecord:T,assignmentRecord:F};(w=n.processEventContent)===null||w===void 0||w.call(n,{isRelease:C,targetElement:m,reactComponent:y,assignmentRecord:F}),m===A.getActiveElement(m)&&n.focusElement.focus(),n.trigger("releaseEvent",E)}if(b){const{eventRecord:M,resourceRecord:T,assignmentRecord:F}=d.elementData,E={renderData:d.elementData,element:m,isReusingElement:u==="reuseElement",isRepaint:u==="reuseOwnElement",eventRecord:M,resourceRecord:T,assignmentRecord:F};u==="reuseElement"&&n.isAnimating&&A.addTemporaryClass(m,"b-reusing-own",50,n),n.trigger("renderEvent",E)}}}})}clearResources(n){n=Y.asArray(n),n.map(We.asId).forEach(t=>{const i=this.resourceMap.get(t);i&&(i.invalid=!0);const r=this.scheduler.getRowById(t);r&&this.rowMap.delete(r)})}clearAll({clearDom:n=!1,clearLayoutCache:e=!1}={}){const t=this,{layouts:i,foregroundCanvas:r}=t.scheduler;if(e&&i)for(const s in i)i[s].clearCache();if(r&&n){r.syncIdMap=r.lastDomConfig=null;for(const s of r.children)s.lastDomConfig=s.elementData=null}t.resourceMap.clear(),t.rowMap.clear()}}D(se,"$name","HorizontalRendering"),se._$name="HorizontalRendering";class At extends Ee(){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(n,e,t,i,r,s){const a=this,o=s.type;return a.packEventsInBands(n,(l,c,u,d)=>{if(o==="none")l.width=e-t*2,l.left+=t;else{l.widthFactor=d;const h=l.leftFactor=u.start+c*d,m=Math.round(1/d),v=h/d,p=e-t*2-i*(m-1);o==="mixed"&&m===2?(l.left+=h*e/5+i,l.width=e-h*e/5-i*2,l.zIndex=5+v):(l.width=d*p,l.left+=h*p+t+i*v)}l.cls["b-sch-event-narrow"]=l.width<a.scheduler.narrowEventWidth})}}At._$name="VerticalLayout";const Ri={releaseElement:1,reuseElement:1},Ai={newElement:1,reuseOwnElement:1,reuseElement:1},Ti={startDate:1,endDate:1,duration:1},Mi=Object.freeze({});class Te extends R.mixin($e,Re){static get properties(){return{eventMap:new Map,resourceMap:new Map,releasedElements:{},toDrawOnProjectRefresh:new Set,resourceBufferSize:1}}construct(n){this.client=this.scheduler=n,this.verticalLayout=new At({scheduler:n}),super.construct({})}init(){const n=this,{scheduler:e,resourceColumns:t}=n;t.resourceStore=n.resourceStore,t.ion({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:n}),n.initialized=!0,e.isPainted&&n.renderer(),t.availableWidth=e.timeAxisSubGridElement.offsetWidth}resolveRowRecord(n,e){const t=this,{scheduler:i}=t,r=n.nodeType?null:n,s=r?r.target:n,a=r?[r.borderOffsetX,r.borderOffsetY]:e,o=s.nodeType===Element.TEXT_NODE?s.parentElement:s,l=o.closest(i.eventSelector);if(l)return i.resourceStore.getById(l.dataset.resourceId);if(!s.closest(".b-sch-timeaxis-cell"))return null;if(!a)throw new Error(`Vertical mode needs coordinates to resolve this element. Can also be called with a browser
                event instead of element to extract element and coordinates from`);if(i.variableColumnWidths||i.resourceStore.isGrouped){let u=0;for(const d of t.resourceStore)if(d.isSpecialRow||(u+=d.columnWidth||t.resourceColumns.columnWidth),u>=a[0])return d;return null}const c=Math.floor(a[0]/t.resourceColumns.columnWidth);return t.allResourceRecords[c]}toggleCls(n,e,t=!0,i=!1){var r;const s=(r=this.eventMap.get(n.eventId))===null||r===void 0?void 0:r[n.resourceId];if(s){s.renderData[i?"wrapperCls":"cls"][e]=t;const a=this.client.getElementFromAssignmentRecord(n,i);a&&a.classList[t?"add":"remove"](e)}}getDateFromXY(n,e,t,i=!1){let r=n[1];return t||(r=this.translateToScheduleCoordinate(r)),this.scheduler.timeAxisViewModel.getDateFromPosition(r,e,i)}translateToScheduleCoordinate(n){return n-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top-globalThis.scrollY}translateToPageCoordinate(n){return n+this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top+globalThis.scrollY}getResourceEventBox(n,e){var t;const i=n.id,r=e.id;let{renderData:s}=((t=this.eventMap.get(i))===null||t===void 0?void 0:t[r])||Mi;if(!s){var a,o;this.layoutResourceEvents(this.scheduler.resourceStore.getById(r)),s=(a=this.eventMap.get(i))===null||a===void 0||(o=a[r])===null||o===void 0?void 0:o.renderData}return s?new P(s.left,s.top,s.width,s.bottom-s.top):null}getScheduleRegion(n,e,t){var i;const r=this,{scheduler:s}=r,a=P.from(s.timeAxisSubGridElement,s.timeAxisSubGridElement);n&&(a.left=r.allResourceRecords.indexOf(n)*s.resourceColumnWidth,a.right=a.left+s.resourceColumnWidth);const o=s.timeAxis.startDate,l=s.timeAxis.endDate,c=((i=s.getDateConstraints)===null||i===void 0?void 0:i.call(s,n,e))||{start:o,end:l},u=s.getCoordinateFromDate(g.max(o,c.start)),d=s.getCoordinateFromDate(g.min(l,c.end));return t?(a.top=u,a.bottom=d):(a.top=r.translateToPageCoordinate(u),a.bottom=r.translateToPageCoordinate(d)),a}getRowRegion(n,e,t){const i=this,{scheduler:r}=i,s=i.allResourceRecords.indexOf(n)*r.resourceColumnWidth,a=r.timeAxis.startDate,o=r.timeAxis.endDate,l=e?g.max(a,e):a,c=t?g.min(o,t):o,u=r.getCoordinateFromDate(l),d=r.getCoordinateFromDate(c,!0,!0),h=Math.min(u,d),m=Math.abs(u-d);return new P(s,h,r.resourceColumnWidth,m)}get visibleDateRange(){const n=this.scheduler,e=n.scrollable.y,t=n.scrollable.clientHeight,i=n.getDateFromCoordinate(e)||n.timeAxis.startDate,r=n.getDateFromCoordinate(e+t)||n.timeAxis.endDate;return{startDate:i,endDate:r,startMS:i.getTime(),endMS:r.getTime()}}onResourceColumnWidthChange({width:n,oldWidth:e}){const t=this,{scheduler:i}=t;t.resourceColumns.width=i.timeAxisColumn.width=t.allResourceRecords.length*n,t.clearAll(),t.refresh(Math.abs(n-e)>30)}attachToProject(n){super.attachToProject(n),n&&n.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const n=this,{scheduler:e,toDrawOnProjectRefresh:t}=n;e.isVisible?e.rendered&&!e.refreshSuspended&&(n.refreshAllWhenReady?(n.clearAll(),n.refresh(),n.refreshAllWhenReady=!1):t.size&&n.refresh(),t.clear()):e.whenVisible("refresh",e,[!0])}attachToEventStore(n){super.attachToEventStore(n),this.refreshAllWhenReady=!0,n&&n.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:n}){for(const e of this.client.getElementsFromEventRecord(n))e.classList.remove("b-iscreating")}onEventStoreRefresh({action:n}){n==="batch"&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:n,records:e=[],record:t,replaced:i,changes:r,isAssign:s}){const a=this,o=new Set;switch(e.forEach(l=>{var c;const u=(c=l.$linkedResources)===null||c===void 0?void 0:c.filter(d=>a.resourceStore.includes(d));u==null||u.forEach(d=>o.add(d.id))}),n){case"sort":case"group":case"move":case"remove":return;case"dataset":a.refreshAllResourcesWhenReady();return;case"add":case"updateMultiple":break;case"replace":i.forEach(([,l])=>{l.resources.map(c=>o.add(c.id))}),a.clearResources(o);break;case"removeall":case"filter":a.clearAll(),a.refresh();return;case"update":{const l=t.$entity?!Object.keys(r).some(u=>!t.$entity.getField(u)):!Object.keys(r).some(u=>!Ti[u]);let c=0;"startDate"in r&&c++,"endDate"in r&&c++,"duration"in r&&c++,(!l||c||"percentDone"in r||"inactive"in r||"segments"in r)&&(a.shouldWaitForInitializeAndEngineReady?a.refreshResourcesWhenReady(o):(a.clearResources(o),a.refresh()));return}}a.refreshResourcesWhenReady(o)}attachToResourceStore(n){const e=this;super.attachToResourceStore(n),e.refreshAllWhenReady=!0,e.resourceColumns&&(e.resourceColumns.resourceStore=n),n.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>e.scheduler.unmaskBody(),thisObj:e,prio:1}),e.initialized&&e.scheduler.isPainted&&(e.firstResource=e.lastResource=null,e.clearAll(),e.renderer())}onResourceStoreChange({source:n,action:e,records:t=[],record:i,replaced:r,changes:s}){const a=this,o=r?r.map(u=>u[1]):t,l=new Set(o.map(u=>u.id));a.firstResource=a.lastResource=null,n._allResourceRecords=null;const{allResourceRecords:c}=n;if(a.scheduler.isEngineReady){switch(e){case"update":s!=null&&s.id?a.clearResources([s.id.oldValue,s.id.value]):a.clearResources([i.id]);break;case"filter":a.clearAll();break}s&&"columnWidth"in s&&a.clearAll(),a.refresh(!0)}else{switch(e){case"dataset":case"remove":case"removeall":a.refreshAllResourcesWhenReady();return;case"replace":case"add":if(!n.isGrouped){const u=o.reduce((d,h)=>Math.min(d,c.indexOf(h)),c.length);for(let d=u;d<c.length;d++)l.add(c[d].id)}}a.refreshResourcesWhenReady(l)}}onResourceStoreRefresh({action:n}){const e=this;(n==="sort"||n==="group")&&(e.firstResource=e.lastResource=e.resourceStore._allResourceRecords=null,e.clearAll(),e.refresh())}attachToAssignmentStore(n){super.attachToAssignmentStore(n),this.refreshAllWhenReady=!0,n&&n.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:n,records:e=[],replaced:t,changes:i}){const r=this,s=new Set(e.map(a=>a.resourceId));if(r.scheduler.isEngineReady){switch(n){case"remove":r.clearResources(s);break;case"filter":r.clearAll();break;case"update":{if("resourceId"in i&&s.add(i.resourceId.oldValue),!Object.keys(i).filter(a=>a!=="resource"&&a!=="event").length)return;r.clearResources(s)}}r.refresh(!0)}else{switch(i&&"resourceId"in i&&s.add(i.resourceId.oldValue),n){case"removeall":r.refreshAllResourcesWhenReady();return;case"replace":t.forEach(([a,o])=>{s.add(a.resourceId),s.add(o.resourceId)})}r.refreshResourcesWhenReady(s)}}onAssignmentStoreRefresh({action:n,records:e}){n==="batch"&&(this.clearAll(),this.refreshAllResourcesWhenReady())}refreshRows(n){n&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(n){this.renderResource(n)}updateFromHorizontalScroll(n){n!==this.prevScrollX&&(this.renderer(),this.prevScrollX=n)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(n,e){const{scheduler:t}=this,i=this.allResourceRecords.indexOf(n)*t.resourceColumnWidth;return t.scrollHorizontallyTo(i,e)}get allResourceRecords(){return this.scheduler.resourceStore.allResourceRecords}onViewportResize(n){this.resourceColumns.availableWidth=n,this.renderer()}get resourceColumns(){var n;return(n=this.scheduler.timeAxisColumn)===null||n===void 0?void 0:n.resourceColumns}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}getConnectorStartSide(n){return"top"}getConnectorEndSide(n){return"bottom"}refreshResourcesWhenReady(n){this.clearResources(n),n.forEach(e=>this.toDrawOnProjectRefresh.add(e))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){return this.getResourceRange(!0)}get visibleResources(){const{first:n,last:e}=this.getResourceRange();return{first:this.allResourceRecords[n],last:this.allResourceRecords[e]}}getResourceRange(n){const{scheduler:e,resourceStore:t}=this,{resourceColumnWidth:i,scrollX:r}=e,{scrollWidth:s}=e.timeAxisSubGrid.scrollable,a=n?this.resourceBufferSize:0,o=r-a,l=r+s+a;if(!(t!=null&&t.count))return{first:-1,last:-1};if(e.variableColumnWidths){let c,u=0,d,h=0;return this.allResourceRecords.forEach((m,v)=>{if(m.instanceMeta(e).insetStart=d=h,h=d+m.columnWidth,d>l)return!1;h>o&&c==null?c=v:d<l&&(u=v)}),{first:c,last:u}}else return{first:Math.max(Math.floor(r/i)-a,0),last:Math.min(Math.floor((r+e.timeAxisSubGrid.width)/i)+a,this.allResourceRecords.length-1)}}get dateRange(){const{scheduler:n}=this;let e=n.getDateFromCoordinate(Math.min(n.scrollTop+n.bodyHeight+n.tickSize-1,(n.virtualScrollHeight||n.scrollable.scrollHeight)-1));e||(e=n.timeAxis.last.endDate);let t=n.getDateFromCoordinate(Math.max(n.scrollTop-n.tickSize,0));return t||(t=n.timeAxis.first.startDate,e=n.getDateFromCoordinate(n.bodyHeight+n.tickSize-1)),{topDate:t,bottomDate:e}}getTimeSpanRenderData(n,e,t=!1){var i;const r=this,{scheduler:s}=r,{preamble:a,postamble:o}=n,{variableColumnWidths:l}=s,c=((i=s.features.eventBuffer)===null||i===void 0?void 0:i.enabled)&&r.isProVerticalRendering&&(a||o)&&!n.isMilestone,u=c?"wrapStartDate":"startDate",d=c?"wrapEndDate":"endDate",h=n.isBatchUpdating&&n.hasBatchedChange(u)&&!c?n.get(u):n[u],m=n.isBatchUpdating&&n.hasBatchedChange(d)&&!c?n.get(d):n[d],v=s.getResourceMargin(e),p=s.getCoordinateFromDate(h),S=e.instanceMeta(s),y=l?S.insetStart:r.allResourceRecords.indexOf(e)*s.resourceColumnWidth,C=s.getResourceWidth(e),b=C-v*2,w=h.getTime(),M=m.getTime();let T=s.getCoordinateFromDate(m),F=T-p;return T===-1&&(F=Math.round((M-w)*s.timeAxisViewModel.getSingleUnitInPixels("millisecond")),T=p+F),{eventRecord:n,resourceRecord:e,left:y,top:p,bottom:T,resourceWidth:C,width:b,height:F,startDate:h,endDate:m,startDateMS:w,endDateMS:M,useEventBuffer:c,children:[],start:h,end:m,startMS:w,endMS:M}}eventSorter(n,e){const t=n.dataStartMs||n.startDateMS,i=n.dataEndMs||n.endDateMS,r=e.dataStartMs||e.startDateMS,s=e.dataEndMs||e.endDateMS,a=n.isModel?n.name:n.eventRecord.name,o=e.isModel?e.name:e.eventRecord.name;return t-r||s-i||(a<o?-1:a==o?0:1)}layoutEvents(n,e,t=!1,i,r){const s=this,{scheduler:a}=s,{variableColumnWidths:o}=a,{id:l}=n,c=n.instanceMeta(a),u=i?`${l}-${i.id}`:l,d=s.resourceMap.set(u,{}).get(u),h=s.allResourceRecords.indexOf(n),{barMargin:m,resourceMargin:v}=a.getResourceLayoutSettings(n,i),p=e.reduce((S,y)=>{if(y.isScheduled){const C=a.generateRenderData(y,n,!1),b={renderData:C},w=x.getMapPath(s.eventMap,C.eventId,{});w[l]=b,d[C.eventId]=b,C.fillSize?(C.left=o?c.insetStart:h*a.resourceColumnWidth,C.width=a.getResourceWidth(n)):S.push(C)}return S},[]);return p.sort(r!=null?r:s.eventSorter),s.verticalLayout.applyLayout(p,a.getResourceWidth(n,i),v,m,h,a.getEventLayout(n,i)),d}layoutResourceEvents(n){const e=this,{scheduler:t}=e,{assignmentStore:i,eventStore:r,timeAxis:s}=t;let a=r.getEvents({includeOccurrences:t.enableRecurringEvents,resourceRecord:n,startDate:s.startDate,endDate:s.endDate,filter:(i.isFiltered||r.isFiltered)&&(o=>o.assignments.some(l=>l.resource===n&&i.includes(l)))});return a=t.getEventsToRender(n,a),e.layoutEvents(n,a)}addTemporaryDragElement(n){const{scheduler:e}=this,t=e.generateRenderData(n,n.resource,{timeAxis:!0,viewport:!0});t.top=t.row?t.top+t.row.top:e.getResourceEventBox(n,n.resource,!0).top;const i=this.renderEvent({renderData:t}),{dataset:r}=i;delete i.tabIndex,delete r.eventId,delete r.resourceId,delete r.assignmentId,delete r.syncId,r.transient=!0,i.parent=this.scheduler.foregroundCanvas,i.retainElement=!0;const s=A.createElement(i);return s.innerElement=s.firstChild,n.instanceMeta(e).hasTemporaryDragElement=!0,s}renderEvent(n){const{scheduler:e}=this,t=n.renderData,{resourceRecord:i,assignmentRecord:r,eventRecord:s}=t,a={className:t.wrapperCls,tabIndex:-1,children:[{role:"presentation",className:t.cls,style:(t.internalStyle||"")+(t.style||""),children:t.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...t.wrapperChildren],style:{top:t.top,[e.rtl?"right":"left"]:t.left,height:s.isMilestone?"1em":t.height,width:t.width,style:t.wrapperStyle||"",fontSize:s.isMilestone?Math.min(t.width,40):null},dataset:{resourceId:i.id,eventId:t.eventId,syncId:r?this.assignmentStore.getOccurrence(r,s).id:t.eventId},elementData:n,retainElement:(r||s).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return a.className["b-sch-vertical"]=1,t.zIndex&&(a.zIndex=t.zIndex),r&&(a.dataset.assignmentId=r.id),t.elementConfig=n.elementConfig=a,e.afterRenderEvent({renderData:t,domConfig:a}),a}renderResource(n){const e=this,{topDateMS:t,bottomDateMS:i}=e,r=[];let s=e.resourceMap.get(n.id);s||(s=e.layoutResourceEvents(n));for(const o in s){const l=s[o],{endDateMS:c,startDateMS:u,eventRecord:d}=l.renderData;if(c>=t&&u<=i&&!d.instanceMeta(e.scheduler).hasTemporaryDragElement){var a;const h=((a=l.elementConfig)===null||a===void 0?void 0:a.className)!=="b-released"&&l.elementConfig||e.renderEvent(l);r.push(h)}}return r}isEventElement(n){const e=n&&n.className;return e&&e[this.scheduler.eventCls+"-wrap"]}get shouldWaitForInitializeAndEngineReady(){return!this.initialized||!this.scheduler.isEngineReady&&!this.scheduler.isCreating}renderer(){const n=this,{scheduler:e}=n,{first:t,last:i}=n.resourceRange,{topDate:r,bottomDate:s}=n.dateRange,a=[],o=[];if(!n.shouldWaitForInitializeAndEngineReady){if(!g.isEqual(r,n.topDate)||!g.isEqual(s,n.bottomDate)){n.topDate=r,n.bottomDate=s,n.topDateMS=r.getTime(),n.bottomDateMS=s.getTime();const l=n.timeView.range={startDate:r,endDate:s};e.onVisibleDateRangeChange(l)}if(t!==-1&&i!==-1)for(let l=t;l<=i;l++)a.push.apply(a,n.renderResource(n.allResourceRecords[l]));if(e.getForegroundDomConfigs(o),a.push.apply(a,o),G.sync({domConfig:{onlyChildren:!0,children:a},targetElement:e.foregroundCanvas,syncIdField:"syncId",callback({action:l,domConfig:c,lastDomConfig:u,targetElement:d,jsx:h}){var m;const{reactComponent:v}=e;if(n.isEventElement(c)||h||c!=null&&(m=c.elementData)!==null&&m!==void 0&&m.jsx){var p;const y=Ri[l],C=Ai[l];if((p=e.processEventContent)!==null&&p!==void 0&&p.call(e,{action:l,domConfig:c,isRelease:!1,targetElement:d,reactComponent:v,jsx:h}))return;if(y&&n.isEventElement(u)&&!u.isReleased){var S;const b=u.elementData.renderData,w={renderData:b,assignmentRecord:b.assignmentRecord,eventRecord:b.eventRecord,resourceRecord:b.resourceRecord,element:d};(S=e.processEventContent)===null||S===void 0||S.call(e,{isRelease:y,targetElement:d,reactComponent:v,assignmentRecord:b.assignmentRecord}),d===A.getActiveElement(d)&&e.focusElement.focus(),e.trigger("releaseEvent",w)}if(C){const b=c.elementData.renderData,w={renderData:b,assignmentRecord:b.assignmentRecord,eventRecord:b.eventRecord,resourceRecord:b.resourceRecord,element:d,isReusingElement:l==="reuseElement",isRepaint:l==="reuseOwnElement"};w.reusingElement=l==="reuseElement",e.trigger("renderEvent",w)}}}}),n.firstResource!==t||n.lastResource!==i){const l=n.resourceColumns.visibleResources={firstResource:t,lastResource:i};n.firstResource=t,n.lastResource=i,e.onVisibleResourceRangeChange(l),e.trigger("resourceRangeChange",l)}}}refresh(n){this.scheduler.runWithTransition(()=>this.renderer(),n)}refreshResources(n){this.clearResources(n),this.refresh()}refreshEventsForResource(n,e=!0,t=!0){this.refreshResources([n.id])}onRenderDone(){}get timeView(){return this.scheduler.timeView}clearResources(n){const{resourceMap:e,eventMap:t}=this;n.forEach(i=>{e.has(i)&&(Object.values(e.get(i)).forEach(({renderData:{eventId:r}})=>{delete t.get(r)[i]}),e.delete(i))})}clearAll(){this.resourceMap.clear(),this.eventMap.clear()}}Te._$name="VerticalRendering";function Fi(f,n){return f===n.length-1}function ki(f,n){return n===f.cells[f.cells.length-1]}class K extends Ue{constructor(){super(...arguments);D(this,"startDate",null);D(this,"endDate",null);D(this,"levels",[]);D(this,"size",null)}set range({startDate:e,endDate:t}){const i=this;if(i.startDate-e||i.endDate-t){var r;const{client:s}=i;if(i.startDate=e,i.endDate=t,i.sizeProperty==="width"&&s!==null&&s!==void 0&&s.hideHeaders||i.sizeProperty==="height"&&s!==null&&s!==void 0&&(r=s.verticalTimeAxisColumn)!==null&&r!==void 0&&r.hidden)return;i.refresh()}}buildCells(e=this.startDate,t=this.endDate){var i;const r=this,{sizeProperty:s}=r,{stickyHeaders:a,isVertical:o}=r.client||{},l=[],{length:c}=r.levels,u=r.levels.map((d,h)=>{var m;const v=a&&(o||h<c-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${d.position}`]:1,"b-sch-header-row-main":h===r.model.viewPreset.mainHeaderLevel,"b-lowest":Fi(h,r.levels),"b-sticky-header":v},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${h}`,headerPosition:d.position},children:(m=d.cells)===null||m===void 0?void 0:m.filter(p=>p.start<t&&p.end>e).map((p,S)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[p.headerCellCls]:p.headerCellCls,[`b-align-${p.align}`]:p.align,"b-last":ki(d,p)},dataset:{tickIndex:p.index,...globalThis.DEBUG&&{date:p.start.getTime()}},style:{[r.positionProperty]:p.coord,[s]:p.width,[`min-${s}`]:p.width},children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":v},html:p.value}]}))}});return(i=r.client)===null||i===void 0||i.getHeaderDomConfigs(l),u.push(...l),{className:r.widgetClassList,syncOptions:{releaseThreshold:0},children:u}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const t=this,{columnConfig:i}=t.model,{levels:r}=t,s=r.length;if(e){r.length=0,i.forEach((o,l)=>r[l]={position:l,cells:o}),t.size=r[0].cells.reduce((o,l)=>o+l.width,0);const{parentElement:a}=t.element;a&&(r.length!==s||e)&&(a.classList.remove(`b-sch-timeaxiscolumn-levels-${s}`),a.classList.add(`b-sch-timeaxiscolumn-levels-${r.length}`))}!t.startDate||!t.endDate||(G.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}}D(K,"$name","TimeAxisBase"),D(K,"configurable",{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}),K._$name="TimeAxisBase";class V extends K{get positionProperty(){var n;return(n=this.owner)!==null&&n!==void 0&&n.rtl?"right":"left"}get width(){return this.size}onModelUpdate(){var n;!((n=this.owner)!==null&&n!==void 0&&n.hideHeaders)&&this.model.availableSpace>0&&this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(n){this.detachListeners("tavm"),n==null||n.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}}D(V,"$name","HorizontalTimeAxis"),D(V,"type","horizontaltimeaxis"),D(V,"configurable",{model:null,sizeProperty:"width"}),V._$name="HorizontalTimeAxis";class B extends Ue{constructor(){super(...arguments);D(this,"firstResource",-1);D(this,"lastResource",-1)}construct(e){const t=this;e.scheduler._resourceColumns=t,super.construct(e),t.imagePath!=null&&t.element.classList.add("b-has-images"),L.on({element:t.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:t})}changeShowAvatars(e){var t;return(t=this.avatarRendering)===null||t===void 0||t.destroy(),e&&(this.avatarRendering=new ei({element:this.element})),e}updateShowAvatars(){this.isConfiguring||this.refresh()}updateResourceStore(e){const t=this;t.detachListeners("resourceStore"),e&&(e.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}onResourceStoreDataChange({action:e}){const t=this;t.getConfig("fillWidth"),t.getConfig("fitWidth"),t.updateWidthCache();const{element:i}=t,r=t.totalWidth;t.scheduler.variableColumnWidths?t._fillWidth=t._fitWidth=!1:(t._fillWidth=t.configuredFillWidth,t._fitWidth=t.configuredFitWidth),r!==t.width&&(A.setLength(i,"width",r),t.column.set("width",r,t.column.grid.isConfiguring)),e==="removeall"&&(i.innerHTML=""),(e==="remove"||e==="add"||e==="filter"||t.fitWidth||t.fillWidth)&&t.refreshWidths(),t.column.grid.toggleEmptyText()}get totalWidth(){return this.updateWidthCache()}updateWidthCache(){let e=0;const{scheduler:t}=this;return t.variableColumnWidths=!1,t.resourceStore.forEach(i=>{i.instanceMeta(t).insetStart=e,i.instanceMeta(t).insetEnd=e+(i.columnWidth||t.resourceColumnWidth),i.columnWidth==null?e+=t.resourceColumnWidth:(e+=i.columnWidth,t.variableColumnWidths=!0)}),e}changeColumnWidth(e){return this.refreshingWidths||(this.configuredColumnWidth=e),e}updateColumnWidth(e,t){const i=this;i.refreshingWidths||i.refreshWidths(),i.isConfiguring||(i.resourceStore.isGrouped&&i.updateWidthCache(),i.refresh(),i.trigger("columnWidthChange",{width:e,oldWidth:t}))}changeFillWidth(e){return this.configuredFillWidth=e}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(e){return this.configuredFitWidth=e}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(e){return k.joinPaths([this.imagePath||"",e||""])}updateImagePath(){this.isConfiguring||this.refresh()}updateAvailableWidth(e){this.refreshWidths()}refreshWidths(){var e;const t=this,{availableWidth:i,configuredColumnWidth:r}=t,s=(e=t.resourceStore)===null||e===void 0?void 0:e.count;if(!i||!s||t.scheduler.variableColumnWidths)return;t.refreshingWidths=!0;const a=t.fitWidth||t.fillWidth&&r*s<i,o=a?Math.floor(i/s):r,l=t.column.grid.enableEventAnimations&&Math.abs(t._columnWidth-o)>30;A.addTemporaryClass(t.element,"b-animating",l?300:0,t),t.columnWidth=o,t.refreshingWidths=!1}set visibleResources({firstResource:e,lastResource:t}){this.firstResource=e,this.lastResource=t,this.updateWidthCache(),this.refresh()}refresh(){const e=this,{firstResource:t,scheduler:i,resourceStore:r,lastResource:s}=e,{variableColumnWidths:a}=i,o=r.isGrouped&&r.groupers[0].field,l=[];if(e.element.classList.toggle("b-grouped",!!o),!e.column.grid.isConfiguring&&t>-1&&s>-1&&s<r.count){let d;for(let h=t;h<=s;h++){var c;const m=r.allResourceRecords[h],v=m.instanceMeta(r).groupParent,p=v==null?void 0:v.groupChildren;if(o&&v.id!==((c=d)===null||c===void 0?void 0:c.dataset.resourceId)){const w=p[0].instanceMeta(i).insetStart,M=p[p.length-1].instanceMeta(i).insetEnd-w;d={className:"b-resourceheader-group-cell",dataset:{resourceId:v.id},style:{left:w,width:M},children:[{tag:"span",html:k.encodeHtml(p[0][o])},{className:"b-resourceheader-group-children",children:[]}]},l.push(d)}const S=m.instanceMeta(i),y=m.columnWidth||e.columnWidth,C=o?S.insetStart-d.style.left:a?S.insetStart:h*e.columnWidth,b={className:new O({"b-resourceheader-cell":1}),dataset:{resourceId:m.id},style:{[i.rtl?"right":"left"]:C,width:y},children:[]};if(e.headerRenderer){const w=e.headerRenderer({elementConfig:b,resourceRecord:m});w!=null&&(b.html=w)}else{let w;if(m.imageUrl)w=m.imageUrl;else if(e.imagePath!=null&&m.image!==!1){var u;const M=m.image||((u=m.name)===null||u===void 0?void 0:u.toLowerCase())+e.imageExtension;w=e.getImageURL(M)}b.children.push(e.showAvatars&&e.avatarRendering.getResourceAvatar({resourceRecord:m,initials:m.initials,color:m.eventColor,iconCls:m.iconCls,defaultImageUrl:e.defaultImageName&&e.getImageURL(e.defaultImageName),imageUrl:w}),{tag:"span",className:"b-resource-name",html:k.encodeHtml(m.name)})}o?d.children[1].children.push(b):l.push(b)}}G.sync({domConfig:{onlyChildren:!0,children:l},targetElement:e.element,syncIdField:"resourceId"})}onResourceMouseEvent(e){const t=e.target.closest(".b-resourceheader-cell"),i=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+k.capitalize(e.type),{resourceRecord:i,event:e})}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.resourceStore,delete t.column,delete t.type,t}}D(B,"$name","ResourceHeader"),D(B,"type","resourceheader"),D(B,"configurable",{resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null}),B._$name="ResourceHeader";class ae extends Be(ai){static get fields(){return[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1,htmlEncode:!1}}static get type(){return"timeAxis"}construct(n){const e=this;super.construct(...arguments),e.thisObj=e,e.timeAxisViewModel=e.grid.timeAxisViewModel,e.mode=e.mode,e.grid.ion({paint:"onTimelinePaint",thisObj:e,once:!0})}static get autoExposeFields(){return!0}doDestroy(){var n,e;(n=this.resourceColumns)===null||n===void 0||n.destroy(),(e=this.timeAxisView)===null||e===void 0||e.destroy(),super.doDestroy()}set mode(n){const e=this,{grid:t}=e;e.set("mode",n),n==="horizontal"?e.timeAxisView=new V({model:e.timeAxisViewModel,compactCellWidthThreshold:e.compactCellWidthThreshold,owner:t,client:t}):n==="vertical"&&(e.resourceColumns=B.new({column:e,scheduler:t,resourceStore:t.resourceStore,imagePath:t.resourceImagePath,imageExtension:t.resourceImageExtension,defaultImageName:t.defaultResourceImageName},t.resourceColumns||{}),e.relayEvents(e.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:n}){const e=this;e.grid.timeAxisSubGrid.collapsed||(e.mode==="horizontal"?(e.refreshHeader(!0),e.width=n.totalSize,e.grid.refresh(),e.subGrid.refreshFakeScroll()):e.mode==="vertical"&&e.grid.refreshRows())}onTimelinePaint({firstPaint:n}){const e=this;if(e.subGrid.insertRowsBefore&&n&&(e.subGridElement.classList.add("b-timeline-subgrid"),e.mode==="vertical")){var t;e.refreshHeader(),(t=e.grid)===null||t===void 0||t.onHeightChange()}}refreshHeader(n){const e=this,{element:t}=e;t&&(e.mode==="horizontal"?(!n&&e.timeAxisViewModel.update(void 0,void 0,!0),e.timeAxisView.rendered?e.timeAxisView.refresh(!0):(t.innerHTML="",e.timeAxisView.render(t))):e.mode==="vertical"&&(e.resourceColumns.currentElement?e.resourceColumns.refresh():(t.innerHTML="",e.resourceColumns.render(t))))}internalRenderer(n){const{grid:e}=this;return e.project.isInitialCommitPerformed||e.project.isDelayingCalculation?(e.currentOrientation.renderer(n),super.internalRenderer(n)):""}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(n){const e=this;e.detachListeners("tavm"),n==null||n.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:e}),e._timeAxisViewModel=n,e.timeAxisView&&(e.timeAxisView.model=n)}getState(){const n=super.getState();return delete n.width,delete n.flex,n}}D(ae,"$name","TimeAxisColumn"),Ge.registerColumnType(ae),ae._$name="TimeAxisColumn";class Tt extends K{static get $name(){return"VerticalTimeAxis"}static get configurable(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}buildHorizontalCells(){const n=this,{client:e}=n,t=e==null?void 0:e.stickyHeaders,i=[],r=n.levels.reduce((s,a,o)=>{if(a.cells){var l;s.push(...(l=a.cells)===null||l===void 0?void 0:l.filter(c=>c.start<n.endDate&&c.end>n.startDate).map((c,u,d)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[c.headerCellCls]:c.headerCellCls,[`b-align-${c.align}`]:c.align,"b-last":u===d.length-1,"b-lowest":o===n.levels.length-1},dataset:{tickIndex:c.index,cellId:`${o}-${c.index}`,headerPosition:o,...globalThis.DEBUG&&{date:c.start.getTime()}},style:{top:c.coord,height:c.width,minHeight:c.width},children:[{role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":t},html:c.value}]})))}return s},[]);return e==null||e.getHeaderDomConfigs(i),r.push(...i),{className:n.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:r}}get height(){return this.size}}Tt._$name="VerticalTimeAxis";class oe extends oi{static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,minWidth:0,resizable:!1,cellCls:"b-verticaltimeaxiscolumn",locked:!0,flex:1,alwaysClearCell:!1}}get isFocusable(){return!1}construct(n){super.construct(...arguments),this.view=new Tt({model:this.grid.timeAxisViewModel,client:this.grid})}renderer({cellElement:n,size:e}){this.view.render(n),e.height=this.view.height}getCurrentConfig(n){const e=super.getCurrentConfig(n);return delete e.id,delete e.region,delete e.type,delete e.field,delete e.ariaLabel,delete e.cellAriaLabel,e}}D(oe,"$name","VerticalTimeAxisColumn"),Ge.registerColumnType(oe),oe._$name="VerticalTimeAxisColumn";const Pi={month:"MMMM, YYYY",week:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"],day:"MMMM D, YYYY"};class H extends Z.mixin(Qt,ut,dt,ht,pt,St,Dt,gt,yt,bt,Et,ot,xt){constructor(){super(...arguments);D(this,"timeCellSelector",".b-sch-timeaxis-cell");D(this,"resourceTimeRangeSelector",".b-sch-resourcetimerange")}static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:ne,testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}afterConstruct(){const e=this;super.afterConstruct(),e.ion({scroll:"onVerticalScroll",thisObj:e}),e.createEventOnDblClick&&e.ion({scheduledblclick:e.onTimeAxisCellDblClick})}onPaintOverride(){}get store(){return super.store}set store(e){super.store=e}get visibleResources(){var e,t;const i=this;return i.isVertical?i.currentOrientation.visibleResources:{first:i.store.getById((e=i.firstVisibleRow)===null||e===void 0?void 0:e.id),last:i.store.getById((t=i.lastVisibleRow)===null||t===void 0?void 0:t.id)}}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onTimeAxisCellDblClick({date:e,resourceRecord:t,row:i}){this.createEvent(e,t,i)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}onEventCreated(e){}get isHorizontal(){return this.mode==="horizontal"}get isVertical(){return this.mode==="vertical"}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||(t.element.classList.add(`b-sch-${e}`),e==="horizontal"?(t.horizontal=new se(t),t.isPainted&&t.horizontal.init()):e==="vertical"&&(t.vertical=new Te(t),t.rendered&&t.vertical.init()))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){return super.onElementKeyDown(e)}onElementKeyUp(e){return super.onElementKeyUp(e)}onElementMouseOver(e){return super.onElementMouseOver(e)}onElementMouseOut(e){return super.onElementMouseOut(e)}processEventDrop(){}processCrossSchedulerEventDrop(){}beforeEventDragStart(){}afterEventDragStart(){}afterEventDragAbortFinalized(){}checkEventDragValidity(){}afterEventResizeStart(){}afterRenderEvent(){}get hasEventEditor(){return!!this.eventEditingFeature}get eventEditingFeature(){const{eventEdit:e,taskEdit:t,simpleEventEdit:i}=this.features;return e!=null&&e.enabled?e:t!=null&&t.enabled?t:i!=null&&i.enabled?i:null}editEvent(e,t,i){const r=this,{eventStore:s,assignmentStore:a}=r;if(!r.hasEventEditor)return!1;if(e.eventStore!==s){const{enableEventAnimations:o}=r,l=[];e.isCreating=!0;let c=[];if(t&&(l.push(t),c=a.assignEventToResource(e,t)),r.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:l,assignmentRecords:c})===!1)return a==null||a.remove(c),!1;r.enableEventAnimations=!1,s.add(e),r.project.commitAsync().then(()=>r.enableEventAnimations=o),r.refreshRows()}}async createEvent(e,t){var i;const r=this,{enableEventAnimations:s,eventStore:a,assignmentStore:o,hasEventEditor:l}=r,c=[t],u=r.createEventOnDblClick.useEventModelDefaults,d=u?a.modelClass.defaultValues.duration:1,h=u?a.modelClass.defaultValues.durationUnit:r.timeAxis.unit,m=a.createRecord({startDate:e,endDate:g.add(e,d,h),duration:d,durationUnit:h,name:r.L("L{Object.newEvent}")});if(r.readOnly||t.isSpecialRow||t.readOnly||!r.allowOverlap&&!r.isDateRangeAvailable(m.startDate,m.endDate,null,t))return;(i=r.eventEditingFeature)===null||i===void 0||i.captureStm(!0),m.isCreating=l,r.onEventCreated(m);const v=o==null?void 0:o.assignEventToResource(m,t);if(r.trigger("beforeEventAdd",{eventRecord:m,resourceRecords:c,assignmentRecords:v})===!1){var p;o==null||o.remove(v),(p=r.eventEditingFeature)===null||p===void 0||p.freeStm(!1);return}r.enableEventAnimations=!1,a.add(m),r.project.commitAsync().then(()=>r.enableEventAnimations=s),r.isCreating=!0,r.refreshRows(),r.isCreating=!1,await r.scrollEventIntoView(m),r.trigger("eventAutoCreated",{eventRecord:m,resourceRecord:t}),l&&r.editEvent(m,t,r.getEventElement(m))}isDateRangeAvailable(e,t,i,r){return this.eventStore.isDateRangeAvailable(e,t,i,r)}async resumeRefresh(e){super.resumeRefresh(!1);const t=this;if(!t.refreshSuspended&&e){if(!t.isEngineReady)return t.currentOrientation.refreshAllWhenReady=!0,t.project.commitAsync();t.isDestroyed||t.refreshWithTransition()}}toggleEmptyText(){const e=this;if(e.bodyContainer){var t;A.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.resourceStore.count>0||(t=e.crudManager)!==null&&t!==void 0&&t.isLoading))}}getRowHeight(e){if(this.isHorizontal){const t=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,t),t}}calculateRowHeights(e,t=!1){e.forEach(i=>i&&this.getRowHeight(i)),t||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:t,rowManager:i}=this,r=Math.min(t.count,this.preCalculateHeightLimit);if(r){i.clearKnownHeights();for(let s=0;s<r;s++)this.getRowHeight(t.getAt(s));e||i.estimateTotalHeight(!0)}}get dateBounds(){const e=this,t=[e.startDate];return e.range==="week"&&t.push(e.lastDate),t}get defaultDescriptionFormat(){return Pi[this.range]}get lastDate(){const e=this.endDate;return e&&g.add(e,-1,"day")}getEventRecord(e){return e=A.getEventElement(e),this.resolveEventRecord(e)}getEventElement(e){return this.getElementFromEventRecord(e)}changeRange(e){return g.normalizeUnit(e)}updateRange(e){if(!this.isConfiguring){const t=this.date,i=this.date=g.startOf(t,e);t.getTime()===i.getTime()&&this.updateDate(i)}}changeStepUnit(e){return g.normalizeUnit(e)}updateDate(e){const t=this,i=g.startOf(e,t.range);t.setTimeSpan(i,g.add(i,1,t.range)),t.visibleDate={date:g.max(e,t.timeAxis.startDate),block:"start",animate:!0},t.trigger("descriptionChange")}updateScrollBuffer(e){this.isConfiguring||(this.currentOrientation.scrollBuffer=e)}previous(){this.date=g.add(this.date,-1,this.stepUnit)}next(){this.date=g.add(this.date,1,this.stepUnit)}async scheduleEvent({startDate:e,eventRecord:t,resourceRecord:i,element:r}){const s=this;if(s.eventStore.includes(t)||([t]=s.eventStore.add(t)),t.startDate=e,t.assign(i),r){const a=P.from(r,s.foregroundCanvas);A.setTranslateXY(r,0,0),A.setTopLeft(r,a.y,a.x),G.addChild(s.foregroundCanvas,r,t.assignments[0].id)}await s.project.commitAsync()}}D(H,"$name","SchedulerBase"),D(H,"type","schedulerbase"),D(H,"configurable",{date:{value:null,$config:{equal:"date"}},stepUnit:"week",range:"week",getDateConstraints:null,verticalTimeAxisColumn:{},createEventOnDblClick:!0,scrollBuffer:0,schedulableAreaSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",sortFeatureStore:"resourceStore",showEventColorPickers:null}),H.initClass(),H._$name="SchedulerBase";class _ extends Bt{colorSelected({color:n}){this.record&&(this.record.eventColor=n)}}D(_,"$name","EventColorPicker"),D(_,"type","eventcolorpicker"),D(_,"configurable",{colorClasses:H.eventColors,colorClassPrefix:"b-sch-",colors:null,record:null}),_.initClass(),_._$name="EventColorPicker";class Mt extends R{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(n){return`<div class="b-sch-clockwrap b-sch-clock-${n.mode||this.mode} ${n.cls||""}">
                    <div class="b-sch-clock">
                        <div class="b-sch-hour-indicator">${g.format(n.date,"MMM")}</div>
                        <div class="b-sch-minute-indicator">${g.format(n.date,"D")}</div>
                        <div class="b-sch-clock-dot"></div>
                    </div>
                    <span class="b-sch-clock-text">${k.encodeHtml(n.text)}</span>
                </div>`}}}generateContent(n){return this.div.innerHTML=this.template(n)}updateDateIndicator(n,e){const t=n==null?void 0:n.querySelector(".b-sch-hour-indicator"),i=n==null?void 0:n.querySelector(".b-sch-minute-indicator");e&&t&&i&&z.isBrowserEnv&&(this.mode==="hour"?(t.style.transform=`rotate(${e.getHours()%12*30}deg)`,i.style.transform=`rotate(${e.getMinutes()*6}deg)`):(t.style.transform="none",i.style.transform="none"))}set mode(n){this._mode=n}get mode(){if(this._mode)return this._mode;const n=g.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,e=g.formatContainsHourInfo(this.scheduler.displayDateFormat);return n&&e?"hour":"day"}set template(n){this._template=n}get template(){return this._template}}Mt._$name="ClockTemplate";var Ii=f=>class extends(f||R){static get $name(){return"TaskEditStm"}getStmCapture(){return{stmInitiallyAutoRecord:this.stmInitiallyAutoRecord,stmInitiallyDisabled:this.stmInitiallyDisabled,transferred:!1}}applyStmCapture(e){this.stmInitiallyAutoRecord=e.stmInitiallyAutoRecord,this.stmInitiallyDisabled=e.stmInitiallyDisabled}captureStm(e=!1){const t=this,i=t.project,r=i.getStm();t.hasStmCapture||(t.hasStmCapture=!0,t.stmInitiallyDisabled=r.disabled,t.stmInitiallyAutoRecord=r.autoRecord,t.stmInitiallyDisabled?(r.enable(),r.autoRecord=!1):(t.stmInitiallyAutoRecord&&(r.autoRecord=!1),r.isRecording&&r.stopTransaction()),e&&this.startStmTransaction())}startStmTransaction(){this.project.getStm().startTransaction()}commitStmTransaction(){const e=this,t=e.project.getStm();if(!e.hasStmCapture)throw new Error("Does not have STM capture, no transaction to commit");t.enabled&&(t.stopTransaction(),e.stmInitiallyDisabled&&t.resetQueue())}async rejectStmTransaction(){const e=this.project.getStm(),{client:t}=this;if(!this.hasStmCapture)throw new Error("Does not have STM capture, no transaction to reject");if(e.enabled){var i;(i=e.transaction)!==null&&i!==void 0&&i.length?(t.suspendRefresh(),e.rejectTransaction(),await t.resumeRefresh(!0)):e.stopTransaction()}}enableStm(){this.project.getStm().enable()}disableStm(){this.project.getStm().disable()}async freeStm(e=null){const t=this,i=t.project.getStm(),{stmInitiallyDisabled:r,stmInitiallyAutoRecord:s}=t;if(!t.hasStmCapture)return;let a;t.rejectingStmTransaction=!0,e===!0?a=t.commitStmTransaction():e===!1&&(a=t.rejectStmTransaction()),await a,i.isDestroying||(i.disabled=r,i.autoRecord=s),t.isDestroying||(t.rejectingStmTransaction=!0,t.hasStmCapture=!1)}};class le extends _t{}le._$name="TimeSpanMenuBase";class $ extends ee{buildItems(){return[...this.addNone?[{text:"L{None}",value:"NONE"}]:[],{value:"DAILY",text:"L{Daily}"},{value:"WEEKLY",text:"L{Weekly}"},{value:"MONTHLY",text:"L{Monthly}"},{value:"YEARLY",text:"L{Yearly}"}]}}D($,"$name","RecurrenceFrequencyCombo"),D($,"type","recurrencefrequencycombo"),D($,"configurable",{editable:!1,displayField:"text",valueField:"value",localizeDisplayFields:!0,addNone:!1}),$.initClass(),$._$name="RecurrenceFrequencyCombo";class Me extends ee{static get $name(){return"RecurrenceDaysCombo"}static get type(){return"recurrencedayscombo"}static get defaultConfig(){const n=["SU","MO","TU","WE","TH","FR","SA"],e=n.join(",");return{allDaysValue:e,editable:!1,defaultValue:e,workingDaysValue:n.filter((t,i)=>!g.nonWorkingDays[i]).join(","),nonWorkingDaysValue:n.filter((t,i)=>g.nonWorkingDays[i]).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildItems(){const n=this;return n._weekDays=null,n.weekDays.concat([{value:n.allDaysValue,text:n.L("L{day}"),cls:n.splitCls},{value:n.workingDaysValue,text:n.L("L{weekday}")},{value:n.nonWorkingDaysValue,text:n.L("L{weekend day}")}])}get weekDays(){const n=this;if(!n._weekDays){const e=g.weekStartDay,t=g.getDayNames().map((i,r)=>({text:i,value:te.encodeDay(r)}));n._weekDays=t.slice(e).concat(t.slice(0,e))}return n._weekDays}set value(n){const e=this;n&&Array.isArray(n)&&(n=n.join(",")),(!n||!e.store.findRecord("value",n))&&(n=e.defaultValue),super.value=n}get value(){let n=super.value;return n&&Array.isArray(n)&&(n=n.join(",")),n}}Me.initClass(),Me._$name="RecurrenceDaysCombo";class Fe extends ge{static get $name(){return"RecurrenceDaysButtonGroup"}static get type(){return"recurrencedaysbuttongroup"}static get defaultConfig(){return{defaults:{cls:"b-raised",toggleable:!0}}}construct(n={}){const e=this;n.columns=7,n.items=e.buildItems(),super.construct(n)}updateItemText(n){const e=te.decodeDay(n.value)[0];n.text=g.getDayName(e).substring(0,3)}buildItems(){const n=this;if(!n.__items){const e=g.weekStartDay,t=g.getDayNames().map((i,r)=>({text:i.substring(0,3),value:te.encodeDay(r)}));n.__items=t.slice(e).concat(t.slice(0,e))}return n.__items}set value(n){n&&Array.isArray(n)&&(n=n.join(",")),super.value=n}get value(){let n=super.value;return n&&Array.isArray(n)&&(n=n.join(",")),n}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const n=super.widgetClassList;return n.push("b-field"),n}}Fe.initClass(),Fe._$name="RecurrenceDaysButtonGroup";class ke extends ge{static get $name(){return"RecurrenceMonthDaysButtonGroup"}static get type(){return"recurrencemonthdaysbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}get minValue(){return 1}get maxValue(){return 31}construct(n={}){const e=this;n.columns=7,n.items=e.buildItems(),super.construct(n)}buildItems(){const n=this,e=[];for(let t=n.minValue;t<=n.maxValue;t++)e.push({text:t+"",value:t});return e}get widgetClassList(){const n=super.widgetClassList;return n.push("b-field"),n}}ke.initClass(),ke._$name="RecurrenceMonthDaysButtonGroup";class Pe extends ge{static get $name(){return"RecurrenceMonthsButtonGroup"}static get type(){return"recurrencemonthsbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}construct(n={}){const e=this;n.columns=4,n.items=e.buildItems(),super.construct(n)}buildItems(){return g.getMonthNames().map((n,e)=>({text:n.substring(0,3),value:e+1}))}updateItemText(n){n.text=g.getMonthName(n.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const n=super.widgetClassList;return n.push("b-field"),n}}Pe.initClass(),Pe._$name="RecurrenceMonthsButtonGroup";class Ie extends ee{static get $name(){return"RecurrenceStopConditionCombo"}static get type(){return"recurrencestopconditioncombo"}static get defaultConfig(){return{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}}buildItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(n){n=n||"never",super.value=n}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(n){let e=null;n.endDate?e="date":n.count&&(e="count"),this._recurrence=n,this.value=e}}Ie.initClass(),Ie._$name="RecurrenceStopConditionCombo";class Le extends ee{static get $name(){return"RecurrencePositionsCombo"}static get type(){return"recurrencepositionscombo"}static get defaultConfig(){return{editable:!1,splitCls:"b-sch-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildItems(){return this.buildDayNumbers().concat([{value:"-1",text:this.L("L{position-1}"),cls:this.splitCls}])}buildDayNumbers(){return Y.populate(this.maxPosition,n=>({value:n+1,text:this.L(`position${n+1}`)}))}set value(n){const e=this;n&&Array.isArray(n)&&(n=n.join(",")),(!n||!e.store.findRecord("value",n))&&(n=e.defaultValue),super.value=n}get value(){const n=super.value;return n?`${n}`.split(",").map(e=>parseInt(e,10)):[]}}Le.initClass(),Le._$name="RecurrencePositionsCombo";class U extends $t{setupWidgetConfig(n){return z.isMobile&&!("editable"in n)&&(n.editable=!1),super.setupWidgetConfig(...arguments)}updateRecord(n){super.updateRecord(n);const e=this,{frequencyField:t,daysButtonField:i,monthDaysButtonField:r,monthsButtonField:s,monthDaysRadioField:a,positionAndDayRadioField:o,stopRecurrenceField:l}=e.widgetMap;if(n){const c=n.timeSpan,u=c==null?void 0:c.startDate;u&&((!n.days||!n.days.length)&&(i.value=[te.encodeDay(u.getDay())]),(!n.monthDays||!n.monthDays.length)&&(r.value=u.getDate()),(!n.months||!n.months.length)&&(s.value=u.getMonth()+1)),n.days&&n.positions?(o.check(),e.isPainted||a.uncheck()):(a.check(),e.isPainted||o.uncheck()),l.recurrence=n}else t.value="NONE"}syncEventRecord(n){const e=this.getValues(t=>t.name in n&&!t.disabled);"endDate"in e||(e.endDate=null),"count"in e||(e.count=null),n.set(e)}toggleStopFields(){const n=this,{countField:e,endDateField:t}=n.widgetMap;switch(n.widgetMap.stopRecurrenceField.value){case"count":e.show(),e.enable(),t.hide(),t.disable();break;case"date":e.hide(),e.disable(),t.show(),t.enable();break;default:e.hide(),t.hide(),e.disable(),t.disable()}}onMonthDaysRadioFieldChange({checked:n}){const{monthDaysButtonField:e}=this.widgetMap;e.disabled=!n||!this.isWidgetAvailableForFrequency(e)}onPositionAndDayRadioFieldChange({checked:n}){const{daysCombo:e,positionsCombo:t}=this.widgetMap;e.disabled=t.disabled=!n||!this.isWidgetAvailableForFrequency(e)}onStopRecurrenceFieldChange(){this.toggleStopFields()}isWidgetAvailableForFrequency(n,e=this.widgetMap.frequencyField.value){return!n.forFrequency||n.forFrequency.includes(e)}onFrequencyFieldChange({value:n,oldValue:e,valid:t}){const i=this,r=i.queryAll(o=>"forFrequency"in o),{intervalField:s,stopRecurrenceField:a}=i.widgetMap;if(t&&n){for(let o=0;o<r.length;o++){const l=r[o];i.isWidgetAvailableForFrequency(l,n)?(l.show(),l.enable()):(l.hide(),l.disable())}s.hidden=a.hidden=n==="NONE",n!=="NONE"&&(s.hint=i.L(`L{RecurrenceEditor.${n}intervalUnit}`)),e==="NONE"&&s.value==null&&(s.value=1),i.toggleFieldsState()}}toggleFieldsState(){const n=this,{widgetMap:e}=n;n.onMonthDaysRadioFieldChange({checked:e.monthDaysRadioField.checked}),n.onPositionAndDayRadioFieldChange({checked:e.positionAndDayRadioField.checked}),n.onStopRecurrenceFieldChange()}updateLocalization(){const{countField:n,intervalField:e,frequencyField:t}=this.widgetMap;n.hint=this.L("L{RecurrenceEditor.time(s)}"),t.value&&t.value!=="NONE"&&(e.hint=this.L(`L{RecurrenceEditor.${t.value}intervalUnit}`)),super.updateLocalization()}}D(U,"$name","RecurrenceEditorPanel"),D(U,"type","recurrenceeditorpanel"),D(U,"configurable",{cls:"b-recurrenceeditor",record:!1,addNone:!1,items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{RecurrenceEditor.Frequency}",weight:10,onChange:"up.onFrequencyFieldChange",addNone:"up.addNone"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{RecurrenceEditor.Every}",min:1,required:!0},daysButtonField:{type:"recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY"},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",forFrequency:"MONTHLY",label:"L{RecurrenceEditor.Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:50,name:"months",forFrequency:"YEARLY"},positionAndDayRadioField:{type:"checkbox",weight:60,toggleGroup:"radio",forFrequency:"MONTHLY|YEARLY",label:"L{RecurrenceEditor.On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY"},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",flex:1},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{RecurrenceEditor.End repeat}",onChange:"up.onStopRecurrenceFieldChange"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" "},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0}}}),U.initClass(),U._$name="RecurrenceEditorPanel";class N extends ti{}D(N,"$name","EventColorField"),D(N,"type","eventcolorfield"),D(N,"configurable",{picker:{type:"eventcolorpicker"},name:"eventColor"}),N.initClass(),N._$name="EventColorField";class X extends le{static get $name(){return"EventMenu"}static get configurable(){return{processItems:null,type:"event"}}static get pluginConfig(){const n=super.pluginConfig;return n.chain.push("populateEventMenu"),n}get resourceStore(){return this.client.isHorizontal?this.client.store:this.client.resourceStore}getDataFromEvent(n){var e;const t=super.getDataFromEvent(n),i=t.targetElement,{client:r}=this,s=r.resolveEventRecord(i),a=s&&((e=r.resolveResourceRecord(i)||this.resourceStore.last)===null||e===void 0?void 0:e.$original),o=s&&r.resolveAssignmentRecord(i);return Object.assign(t,{eventElement:i,eventRecord:s,resourceRecord:a,assignmentRecord:o})}getTargetElementFromEvent({target:n}){return n.closest(this.client.eventSelector)||n}shouldShowMenu(n){return n.eventRecord}showContextMenuFor(n,{targetElement:e,event:t}={}){this.disabled||!e&&(e=this.getElementFromRecord(n),!e)||A.triggerMouseEvent(e,this.tiggerEvent)}getElementFromRecord(n){return this.client.getElementsFromEventRecord(n)[0]}populateEventMenu({items:n,eventRecord:e,assignmentRecord:t}){const{client:i}=this;n.deleteEvent={disabled:e.readOnly||(t==null?void 0:t.readOnly),hidden:i.readOnly},n.unassignEvent={disabled:e.readOnly||(t==null?void 0:t.readOnly),hidden:i.readOnly||i.eventStore.usesSingleAssignment},i.showEventColorPickers||i.showTaskColorPickers?n.eventColor={disabled:e.readOnly,hidden:i.readOnly}:n.eventColor={hidden:!0}}populateItemsWithData({items:n,eventRecord:e}){var t;super.populateItemsWithData(...arguments);const{client:i}=this;(i.showEventColorPickers||i.isSchedulerPro&&i.showTaskColorPickers)&&(t=n.eventColor)!==null&&t!==void 0&&t.menu&&Ne.merge(n.eventColor.menu.colorMenu,{value:e.eventColor,record:e})}changeItems(n){const{client:e}=this;return Ne.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",weight:200,onItem({menu:t,eventRecord:i}){var r;const s=(r=t.focusInEvent)===null||r===void 0?void 0:r.relatedTarget;s&&(s.focus(),e.navigator.activeItem=s),e.removeEvents(e.isEventSelected(i)?e.selectedEvents:[i])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,onItem({menu:t,eventRecord:i,resourceRecord:r}){var s;const a=(s=t.focusInEvent)===null||s===void 0?void 0:s.relatedTarget;a&&(a.focus(),e.navigator.activeItem=a),e.isEventSelected(i)?e.assignmentStore.remove(e.selectedAssignments):i.unassign(r)}},eventColor:{text:"L{SchedulerBase.color}",icon:"b-icon b-icon-palette",separator:!0,menu:{colorMenu:{type:"eventcolorpicker"}}}},n)}}X.featureClass="",X._$name="EventMenu",fe.registerFeature(X,!0,"Scheduler"),fe.registerFeature(X,!1,"ResourceHistogram");class ce extends le{static get $name(){return"ScheduleMenu"}static get defaultConfig(){return{type:"schedule",items:null,processItems:null}}static get pluginConfig(){const n=super.pluginConfig;return n.chain.push("populateScheduleMenu"),n}shouldShowMenu(n){const{client:e}=this,{targetElement:t,resourceRecord:i}=n,r=e.timeAxisSubGridElement.contains(t);return!t.closest(e.eventSelector)&&r&&!(i&&i.isSpecialRow)}getDataFromEvent(n){if(A.isDOMEvent(n)){var e,t;const{client:i}=this,r=(e=i.getCellDataFromEvent)===null||e===void 0?void 0:e.call(i,n),s=(t=i.getDateFromDomEvent)===null||t===void 0?void 0:t.call(i,n,"floor"),a=i.resolveResourceRecord(n)||i.isVertical&&i.resourceStore.last;return x.assign(super.getDataFromEvent(n),r,{date:s,resourceRecord:a})}return n}populateScheduleMenu({items:n,resourceRecord:e,date:t}){const{client:i}=this;!i.readOnly&&i.eventStore&&(n.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:!e||e.readOnly||!e.isWorkingTime(t),weight:100,onItem(){i.createEvent(t,e,i.getRowFor(e))}})}}ce.featureClass="",ce._$name="ScheduleMenu",fe.registerFeature(ce,!0,"Scheduler");export{De as AbstractCrudManager,Re as AttachToProjectMixin,Mt as ClockTemplate,ne as CrudManager,ot as CurrentConfig,ut as Describable,N as EventColorField,_ as EventColorPicker,X as EventMenu,xe as HorizontalLayoutPack,we as HorizontalLayoutStack,se as HorizontalRendering,V as HorizontalTimeAxis,Ee as PackMixin,ie as PresetStore,vt as ProjectConsumer,Se as RecurrenceConfirmationPopup,Fe as RecurrenceDaysButtonGroup,Me as RecurrenceDaysCombo,U as RecurrenceEditorPanel,$ as RecurrenceFrequencyCombo,ke as RecurrenceMonthDaysButtonGroup,Pe as RecurrenceMonthsButtonGroup,Le as RecurrencePositionsCombo,Ie as RecurrenceStopConditionCombo,Qe as RecurringEvents,B as ResourceHeader,ce as ScheduleMenu,H as SchedulerBase,dt as SchedulerDom,ht as SchedulerDomEvents,Et as SchedulerEventNavigation,gt as SchedulerEventRendering,bt as SchedulerEventSelection,yt as SchedulerRegions,mt as SchedulerResourceRendering,St as SchedulerScroll,Dt as SchedulerState,pt as SchedulerStores,Ii as TaskEditStm,ve as TimeAxis,ae as TimeAxisColumn,ye as TimeAxisSubGrid,pe as TimeAxisViewModel,le as TimeSpanMenuBase,Z as TimelineBase,Ze as TimelineDateMapper,Ke as TimelineDomEvents,et as TimelineEventRendering,tt as TimelineScroll,nt as TimelineState,Xe as TimelineViewPresets,Je as TimelineZoomable,xt as TransactionalFeatureMixin,Te as VerticalRendering,oe as VerticalTimeAxisColumn,I as ViewPreset,W as pm};
//# sourceMappingURL=ScheduleMenu.js.map
