/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var xo=Object.defineProperty;var Fo=(l,e,t)=>e in l?xo(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var M=(l,e,t)=>(Fo(l,typeof e!="symbol"?e+"":e,t),t);import{Mixin as v,CI as Ae,map as $i,uniqueOnly as ko,concatIterable as Bo,MixinAny as Tr,concat as $r,isInstanceOf as On,MAX_DATE as le,MIN_DATE as De,EdgeInclusion as Ii,format as Ve,AbstractPartOfProjectGenericMixin as Lo,AbstractPartOfProjectStoreMixin as Vo,AbstractPartOfProjectModelMixin as _o,AbstractCalendarMixin as No,AbstractAssignmentStoreMixin as Wo,AbstractCalendarManagerStoreMixin as zo,AbstractDependencyStoreMixin as Uo,stripDuplicates as Go,TimeUnit as R,isEqualEffectiveDirection as jn,Direction as k,isNotNumber as Ho,AbstractHasAssignmentsMixin as qo,AbstractEventStoreMixin as Ko,AbstractResourceStoreMixin as Qo,DependencyType as Qe,AbstractProjectMixin as Xo,ProjectType as qt,ConstraintIntervalSide as ce,isDateFinite as pt,ConstraintType as b,DependenciesCalendar as An,CalendarIteratorResult as Mi,SchedulingMode as W,CalendarIntervalMixin as Ir,CalendarIntervalStore as Jo,DependencyValidationResult as gt,AssignmentModelMixin as Zo,AssignmentStoreMixin as Yo,DependencyBaseModel as el,DependencyStoreMixin as tl,TimeSpan as nl,EventModelMixin as il,ResourceModelMixin as sl,ResourceStoreMixin as rl,ProjectCrudManager as al}from"./CrudManagerView.js";import{DateHelper as O,Model as mt,ObjectHelper as H,LocaleHelper as Mr,Base as de,Localizable as ge,Store as _e,Combo as Kt,AjaxStore as xn,ArrayHelper as yt,DomSync as Se,InstancePlugin as Fn,DomHelper as vt,Editor as ol,DomClassList as ll,Rectangle as Qt,EventHelper as cl,Events as dl,Popup as Or,Toast as ul,Widget as Oi,Container as jr,LocaleManagerSingleton as hl,StringHelper as Xt,Delayable as fl,WalkHelper as pl,Promissory as gl}from"./Editor.js";import{Base as q,CalendarCacheMultiple as ml,TransactionalFeature as kn,Dependencies as yl,EventResize as vl,TaskEditTransactional as Cl}from"./TimeAxisHeaderMenu.js";import{StateTrackingManager as ji,UpdateAction as Ar}from"./AvatarRendering.js";import{GridFeatureManager as ue,CellEdit as Dl}from"./GridBase.js";import{DragHelper as Sl,DateField as xr,DurationField as El,MessageDialog as Ai}from"./MessageDialog.js";import{TaskEditStm as bl,AttachToProjectMixin as wl}from"./ScheduleMenu.js";import"./Grid.js";import"./Tree.js";import"./TextAreaField.js";import{WebSocketManager as Pl,RadioGroup as Rl}from"./TabPanel.js";import"./Card.js";import{GridRowModel as Tl}from"./GridRowModel.js";const $l=-Math.pow(2,30),Ne=Math.pow(2,30)-1,xi=l=>l.slice(0,1).toUpperCase()+l.slice(1),Jt=l=>Object(l)!==l,Fi=(l,e,t)=>(Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0}),t),w=l=>function(e,t){e[t]=l},Il=(l,e)=>{for(const t of l)e.add(t);return e},Zt=l=>new Promise(e=>setTimeout(e,l));let ki=null;const Bi=function(l){return ki===null&&(ki=typeof regeneratorRuntime!="undefined"),ki===!0?regeneratorRuntime.isGeneratorFunction(l):l.constructor.name==="GeneratorFunction"},Bn=function(l){return l&&typeof l.then=="function"},Ml=(...l)=>{},Fr=l=>Ml,kr=Fr(),Ol=Fr();var Ee;(function(l){l.Cancel="Cancel",l.Resume="Resume"})(Ee||(Ee={}));const Br=Symbol("WalkSource"),Ct=-1,Xe=-2;class Li extends q{constructor(){super(...arguments),this.visited=new Map,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e.map(t=>({node:t,from:Br,label:void 0}))),this.walkDepth()}onNode(e,t){}onTopologicalNode(e){}onCycle(e,t){return Ee.Cancel}forEachNext(e,t){throw new Error("Abstract method called")}collectNext(e,t,s){throw new Error("Abstract method called")}getVisitedInfo(e){return this.visited.get(e)}setVisitedInfo(e,t,s){return s?(s.visitedAt=t,s.visitEpoch=this.currentEpoch):(s={visitedAt:t,visitEpoch:this.currentEpoch},this.visited.set(e,s)),s}walkDepth(){this.visited;const e=this.toVisit;let t;for(;t=e.length;){const s=e[t-1].node,i=this.getVisitedInfo(s);if(i&&i.visitedAt===Xe&&i.visitEpoch===this.currentEpoch){e.pop();continue}if(i&&i.visitEpoch===this.currentEpoch&&i.visitedAt!==Ct){if(i.visitedAt<t){if(this.onCycle(s,e)!==Ee.Resume)break}else i.visitedAt=Xe,this.onTopologicalNode(s);e.pop()}else{if(this.onNode(s,e[t-1])===!1)break;const n=this.setVisitedInfo(s,t,i),r=e.length;this.collectNext(s,e,n),e.length===r&&(n.visitedAt=Xe,this.onTopologicalNode(s),e.pop())}}}}function Lr(l){const e=l.length;if(e===0)return[];const t=l[e-1].node,s=[t];let i=e-1,n=i;for(;i>=0&&l[i].from!==t;){for(;i>=0&&l[i].from===l[n].from;)i--;i>=0&&(s.push(l[i].node),n=i)}return i<0?[]:(s.push(t),s.reverse())}var jl=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};let Vr=0;const Y=Vr++;class V extends q{constructor(){super(...arguments),this.formulaId=Vr++,this.inputs=new Set}}class _r extends Li{collectNext(e,t){if(e instanceof V)t.push({node:e.output,from:e,label:void 0});else{const s=this.cache.formulasByInput.get(e);s&&s.forEach(i=>t.push({node:i,from:e,label:void 0}))}}}class Ln extends v([q],e=>class extends e{constructor(){super(...arguments),this.variables=new Set,this.formulas=new Set,this.$formulasByInput=void 0,this.$formulasByOutput=void 0}get formulasByInput(){return this.$formulasByInput!==void 0?this.$formulasByInput:(this.fillCache(),this.$formulasByInput)}get formulasByOutput(){return this.$formulasByOutput!==void 0?this.$formulasByOutput:(this.fillCache(),this.$formulasByOutput)}add(s){this.$formulasByInput=void 0,this.$formulasByOutput=void 0,this.formulas.add(s)}has(s){return this.formulas.has(s)}fillCache(){this.$formulasByInput=new Map,this.$formulasByOutput=new Map,this.formulas.forEach(s=>{let i=this.$formulasByOutput.get(s.output);i||(i=new Set,this.$formulasByOutput.set(s.output,i)),i.add(s),s.inputs.forEach(n=>{let r=this.$formulasByInput.get(n);r||(r=new Set,this.$formulasByInput.set(n,r)),r.add(s)})})}allInputVariables(){return ko(Bo($i(this.formulas,s=>s.inputs.values())))}isCyclic(){let s=!1;return _r.new({cache:this,onCycle:()=>(s=!0,Ee.Cancel)}).startFrom(Array.from(this.allInputVariables())),s}}){}class Dt extends Ln{}class be extends q{constructor(){super(...arguments),this.description=void 0,this.defaultResolutionFormulas=new Set,this.resolutionsByInputHash=new Map}clear(){this.resolutionsByInputHash.clear()}resolve(e){const t=this.resolutionsByInputHash.get(e.hash);if(t!==void 0)return t;const s=this.buildResolution(e);return this.resolutionsByInputHash.set(e.hash,s),s}buildResolution(e){const t=Ri.new({context:this,input:e}),s=Array.from(t.next()).map(i=>({resolution:i.asResolution(),nbrOfDefaultFormulas:Array.from(i.activatedFormulas.formulas).reduce((n,r)=>i.formulaIsDefault(r)?n+1:n,0),unCoveredInputWeight:i.unCoveredInputWeight()}));if(s.sort((i,n)=>i.unCoveredInputWeight<n.unCoveredInputWeight?-1:i.unCoveredInputWeight>n.unCoveredInputWeight?1:n.nbrOfDefaultFormulas-i.nbrOfDefaultFormulas),s.length>0)return s[0].resolution;debugger}}var we;(function(l){l[l.NoInput=0]="NoInput",l[l.HasPreviousValue=1]="HasPreviousValue",l[l.HasProposedValue=2]="HasProposedValue",l[l.KeepIfPossible=4]="KeepIfPossible"})(we||(we={}));class Vi extends q{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.$hash=""}get hash(){return this.$hash!==""?this.$hash:this.$hash=this.buildHash()}get description(){return this.context.description}get resolution(){return this.context.resolve(this)}initialize(...e){super.initialize(...e),this.input=new Map(Ae(this.description.variables).map(t=>[t,we.NoInput]))}buildHash(){return String.fromCharCode(...Ae(this.description.variables).inBatchesBySize(5).map(e=>this.batchToCharCode(e)))}batchToCharCode(e){return e.reduceRight((t,s,i)=>t|this.input.get(s)<<i*3,0)}addProposedValueFlag(e){const t=this.input.get(e);this.input.set(e,t|we.HasProposedValue)}hasProposedValue(e){return!!(this.input.get(e)&we.HasProposedValue)}hasProposedValueVars(){return Ae(this.description.variables).filter(e=>this.hasProposedValue(e))}addPreviousValueFlag(e){const t=this.input.get(e);this.input.set(e,t|we.HasPreviousValue)}hasPreviousValue(e){return!!(this.input.get(e)&we.HasPreviousValue)}hasPreviousValueVars(){return Ae(this.description.variables).filter(e=>this.hasPreviousValue(e))}addKeepIfPossibleFlag(e){const t=this.input.get(e);this.input.set(e,t|we.KeepIfPossible)}keepIfPossible(e){return!!(this.input.get(e)&we.KeepIfPossible)}keepIfPossibleVars(){return Ae(this.description.variables).filter(e=>this.keepIfPossible(e))}}jl([kr],Vi.prototype,"context",void 0);class Ri extends q{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.previous=void 0,this.activatedFormula=void 0,this.$activatedFormulas=void 0}get activatedFormulas(){if(this.$activatedFormulas!==void 0)return this.$activatedFormulas;const e=Ln.new({variables:this.description.variables,formulas:Ae(this.thisAndPreviousStates()).map(t=>t.activatedFormula).toSet()});return this.$activatedFormulas=e}get description(){return this.context.description}*thisAndPreviousStates(){let e=this;for(;e&&e.activatedFormula;)yield e,e=e.previous}formulaHasProposedValueInInput(e){return Array.from(e.inputs).some(t=>this.input.hasProposedValue(t))}unCoveredInputWeight(){const e=$i(this.input.hasProposedValueVars(),i=>({variable:i,isProposed:!0})),t=$i(this.input.keepIfPossibleVars(),i=>({variable:i,isProposed:!1}));return Ae([e,t]).concat().uniqueOnlyBy(i=>i.variable).reduce((i,{variable:n,isProposed:r})=>{let a=0;const o=this.activatedFormulas.formulasByOutput.get(n);if(o){const d=o.size===1?Array.from(o)[0]:null;d&&this.formulaIsDefault(d)&&this.formulaHasProposedValueInInput(d)?r?a+=1e6:a+=1e4:r?a+=1e7:a+=1e5}const c=this.activatedFormulas.formulasByInput.get(n);return c&&c.size>0||(r?a+=1e3:a+=100),i+a},0)}preferFormula(e,t){const s=this.formulaAllInputsHasProposed(e),i=this.formulaAllInputsHasProposed(t);if(s&&!i)return-1;if(i&&!s)return 1;const n=this.formulaCountInputsWithProposedOrKeep(e),r=this.formulaCountInputsWithProposedOrKeep(t);return n>r?-1:n<r?1:this.formulaIsDefault(e)&&!this.formulaIsDefault(t)?-1:this.formulaIsDefault(t)&&!this.formulaIsDefault(e)?1:0}formulaIsDefault(e){return this.context.defaultResolutionFormulas.has(e)}formulaCountInputsWithProposedOrKeep(e){let t=0;return Array.from(e.inputs).forEach(s=>{(this.input.hasProposedValue(s)||this.input.keepIfPossible(s))&&t++}),t}formulaAllInputsHasProposedOrKeep(e){return Array.from(e.inputs).every(t=>this.input.hasProposedValue(t)||this.input.keepIfPossible(t))}formulaAllInputsHasProposed(e){return Array.from(e.inputs).every(t=>this.input.hasProposedValue(t))}formulaIsApplicable(e){const t=Array.from(e.inputs).every(i=>this.input.hasProposedValue(i)||this.input.hasPreviousValue(i)||this.activatedFormulas.formulasByOutput.has(i)),s=Ln.new({formulas:new Set(this.activatedFormulas.formulas)});return s.add(e),t&&!s.isCyclic()}formulaIsInsignificant(e){const t=this.activatedFormulas.formulasByOutput.has(e.output),s=this.input.hasPreviousValue(e.output);return t||s&&Array.from(e.inputs).some(i=>!this.input.hasPreviousValue(i)&&!this.input.hasProposedValue(i)&&!this.activatedFormulas.formulasByOutput.has(i))}unvisitedFormulas(){return Array.from(this.description.formulas).filter(e=>!this.activatedFormulas.has(e))}*next(){const e=this.unvisitedFormulas();e.sort(this.preferFormula.bind(this));let t=!0;for(const s of e){if(!this.formulaIsApplicable(s)||this.formulaIsInsignificant(s))continue;yield*Ri.new({previous:this,context:this.context,input:this.input,activatedFormula:s}).next(),t=!1}t&&(yield this)}asResolution(){return new Map(Ae(this.description.variables).map(e=>{const t=this.activatedFormulas.formulasByOutput.get(e);if(t)for(const s of t)return[e,s.formulaId];return[e,Y]}))}}var Yt=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const St=Symbol("BreakCurrentStackExecution");class z extends q{}Yt([w(!0)],z.prototype,"sync",void 0),Yt([w(!0)],z.prototype,"pure",void 0);const _i=Symbol("ProposedOrPreviousSymbol"),x=z.new({handler:_i}),en=Symbol("RejectSymbol");class Et extends z{constructor(){super(...arguments),this.handler=en}}Yt([w(!1)],Et.prototype,"pure",void 0);const Je=l=>Et.new({reason:l}),Ni=Symbol("TransactionSymbol"),Al=z.new({handler:Ni}),Wi=Symbol("OwnQuarkSymbol"),xl=z.new({handler:Wi}),zi=Symbol("OwnIdentifierSymbol"),Fl=z.new({handler:zi}),Ui=Symbol("WriteSymbol");class Gi extends z{constructor(){super(...arguments),this.handler=Ui}}Yt([w(!1)],Gi.prototype,"pure",void 0);const Nr=(l,e,...t)=>Gi.new({identifier:l,proposedArgs:[e,...t]}),Hi=Symbol("WriteSeveralSymbol");class qi extends z{constructor(){super(...arguments),this.handler=Hi}}Yt([w(!1)],qi.prototype,"pure",void 0);const Wr=l=>qi.new({writes:l}),Ki=Symbol("PreviousValueOfSymbol");class zr extends z{constructor(){super(...arguments),this.handler=Ki}}const Vn=l=>zr.new({identifier:l}),Qi=Symbol("ProposedValueOfSymbol");class Ur extends z{constructor(){super(...arguments),this.handler=Qi}}const Gr=l=>Ur.new({identifier:l}),Xi=Symbol("HasProposedValueSymbol");class Hr extends z{constructor(){super(...arguments),this.handler=Xi}}const Pe=l=>Hr.new({identifier:l}),Ji=Symbol("HasProposedNotPreviousValueSymbol");class qr extends z{constructor(){super(...arguments),this.handler=Ji}}const Kr=l=>qr.new({identifier:l}),Zi=Symbol("ProposedOrPreviousValueOfSymbol");class Qr extends z{constructor(){super(...arguments),this.handler=Zi}}const N=l=>Qr.new({identifier:l}),Yi=Symbol("ProposedArgumentsOfSymbol");class Xr extends z{constructor(){super(...arguments),this.handler=Yi}}const Ze=l=>Xr.new({identifier:l}),es=Symbol("UnsafeProposedOrPreviousValueOfSymbol");class Jr extends z{constructor(){super(...arguments),this.handler=es}}const kl=l=>Jr.new({identifier:l}),ts=Symbol("UnsafePreviousValueOfSymbol");class Zr extends z{constructor(){super(...arguments),this.handler=ts}}const Bl=l=>Zr.new({identifier:l});class Yr extends Vi{collectInfo(e,t,s){e(Vn(t))!=null&&this.addPreviousValueFlag(s),e(Kr(t))&&this.addProposedValueFlag(s)}}const Ll=Symbol("ContextSync"),Vl=Symbol("ContextGen");class ea extends v([],e=>class extends e{constructor(){super(...arguments),this.iterator=void 0,this.iterationResult=void 0}isCalculationStarted(){return!!(this.iterator||this.iterationResult)}isCalculationCompleted(){return!!(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(s,...i){const n=this.iterator=this.calculation.call(this.context||this,s,...i);return this.iterationResult=n.next()}continueCalculation(s){return this.iterationResult=this.iterator.next(s)}cleanupCalculation(){this.iterationResult=void 0,this.iterator=void 0}*calculation(s,...i){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(s,...i){for(this.startCalculation(s,...i);!this.isCalculationCompleted();)this.continueCalculation(s(this.iterationResult.value));return this.iterator=void 0,this.result}async runAsyncWithEffect(s,...i){for(this.startCalculation(s,...i);!this.isCalculationCompleted();)this.continueCalculation(await s(this.iterationResult.value));return this.iterator=void 0,this.result}}){}const _n=Symbol("SynchronousCalculationStarted"),_l={value:_n};class ta extends v([],e=>class extends e{constructor(){super(...arguments),this.iterationResult=void 0}isCalculationStarted(){return!!this.iterationResult}isCalculationCompleted(){return!!(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(s,...i){return this.iterationResult=_l,this.iterationResult={done:!0,value:this.calculation.call(this.context||this,s,...i)}}continueCalculation(s){throw new Error("Can not continue synchronous calculation")}cleanupCalculation(){this.iterationResult=void 0}calculation(s,...i){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(s,...i){return this.startCalculation(s,...i),this.result}async runAsyncWithEffect(s,...i){throw new Error("Can not run synchronous calculation asynchronously")}}){}function na(l,e,t,s){const i=e.apply(s||null,t);let n=i.next();for(;!n.done;)n=i.next(l(n.value));return n.value}async function tn(l,e,t,s){const i=e.apply(s||null,t);let n=i.next();for(;!n.done;){let r,a=!1;do{a=!1;try{r=l(n.value)}catch(o){if(o instanceof z)if(await l(o)==="Cancel"){l(Je(o));return}else a=!0}}while(a);Bn(r)?n=i.next(await r):n=i.next(r)}return n.value}var bt;(function(l){l[l.Normal=1]="Normal",l[l.Past=2]="Past"})(bt||(bt={}));let Nl=0;class Nn extends Tr([Map],e=>class extends e{constructor(){super(...arguments),this.createdAt=void 0,this.identifier=void 0,this.value=void 0,this.proposedValue=void 0,this.proposedIsPrevious=!1,this.proposedArguments=void 0,this.usedProposedOrPrevious=!1,this.previous=void 0,this.origin=void 0,this.originId=$l,this.needToBuildProposedValue=!1,this.edgesFlow=0,this.visitedAt=Ct,this.visitEpoch=0,this.promise=void 0,this.$outgoingPast=void 0}static new(s){const i=new this;return s&&Object.assign(i,s),i}get level(){return this.identifier.level}get calculation(){return this.identifier.calculation}get context(){return this.identifier.context||this.identifier}forceCalculation(){this.edgesFlow=Ne}cleanup(){this.cleanupCalculation()}isShadow(){return!!(this.origin&&this.origin!==this)}resetToEpoch(s){this.visitEpoch=s,this.visitedAt=Ct,this.edgesFlow<0&&(this.edgesFlow=0),this.usedProposedOrPrevious=!1,this.cleanupCalculation(),this.clearOutgoing(),this.promise=void 0,this.origin&&this.origin===this?(this.proposedArguments=void 0,this.value!==void 0&&(this.proposedValue=this.value),this.value=void 0):(this.origin=void 0,this.value=void 0),this.identifier.proposedValueIsBuilt&&this.proposedValue!==A&&(this.needToBuildProposedValue=!0,this.proposedValue=void 0)}copyFrom(s){this.value=s.value,this.proposedValue=s.proposedValue,this.proposedArguments=s.proposedArguments,this.usedProposedOrPrevious=s.usedProposedOrPrevious}clearProperties(){this.value=void 0,this.proposedValue=void 0,this.proposedArguments=void 0}mergePreviousOrigin(s){const i=this.origin;if(i!==this.previous)throw new Error("Invalid state");this.copyFrom(i);const n=this.getOutgoing();for(const[r,a]of i.getOutgoing())if(!n.get(r)){const c=s.get(r);(!c||c.originId===a.originId)&&n.set(r,c||a)}if(i.$outgoingPast!==void 0){const r=this.getOutgoingPast();for(const[a,o]of i.getOutgoingPast())if(!r.get(a)){const d=s.get(a);(!d||d.originId===o.originId)&&r.set(a,d||o)}}this.origin=this,i.clearProperties(),i.clear()}setOrigin(s){this.origin=s,this.originId=s.originId}getOrigin(){return this.origin?this.origin:this.startOrigin()}startOrigin(){return this.originId=Nl++,this.origin=this}getOutgoing(){return this}getOutgoingPast(){return this.$outgoingPast!==void 0?this.$outgoingPast:this.$outgoingPast=new Map}addOutgoingTo(s,i){(i===bt.Normal?this:this.getOutgoingPast()).set(s.identifier,s)}clearOutgoing(){this.clear(),this.$outgoingPast!==void 0&&this.$outgoingPast.clear()}getValue(){const s=this.origin;return s===this?this.value:s?s.getValue():void 0}setValue(s){if(this.origin&&this.origin!==this)throw new Error("Can not set value to the shadow entry");this.getOrigin().value=s}hasValue(){return this.getValue()!==void 0}hasProposedValue(){return this.isShadow()?!1:this.hasProposedValueInner()}hasProposedValueInner(){return this.proposedValue!==void 0}getProposedValue(s){return this.needToBuildProposedValue&&(this.proposedValue=this.identifier.buildProposedValue.call(this.identifier.context||this.identifier,this.identifier,this,s),this.needToBuildProposedValue=!1),this.proposedValue}outgoingInTheFutureCb(s,i){let n=this;for(;n;){for(const r of n.getOutgoing().values())r.originId===s.getLatestEntryFor(r.identifier).originId&&i(r);n.isShadow()?n=n.previous:n=null}}outgoingInTheFutureAndPastCb(s,i){let n=this;for(;n;){for(const r of n.getOutgoing().values()){const a=s.getLatestEntryFor(r.identifier);a&&r.originId===a.originId&&i(r)}if(n.$outgoingPast!==void 0)for(const r of n.$outgoingPast.values()){const a=s.getLatestEntryFor(r.identifier);a&&r.originId===a.originId&&i(r)}n.isShadow()?n=n.previous:n=null}}outgoingInTheFutureAndPastTransactionCb(s,i){let n=this;for(;n;){for(const r of n.getOutgoing().values()){const a=s.getLatestStableEntryFor(r.identifier);a&&r.originId===a.originId&&i(r)}if(n.$outgoingPast!==void 0)for(const r of n.$outgoingPast.values()){const a=s.getLatestStableEntryFor(r.identifier);a&&r.originId===a.originId&&i(r)}n.isShadow()?n=n.previous:n=null}}outgoingInTheFutureTransactionCb(s,i){let n=this;for(;n;){for(const r of n.getOutgoing().values()){const a=s.getLatestEntryFor(r.identifier);a&&r.originId===a.originId&&i(r)}n.isShadow()?n=n.previous:n=null}}}){}const A=Symbol("Tombstone");var wt=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n},Re;(function(l){l[l.UserInput=0]="UserInput",l[l.DependsOnlyOnUserInput=1]="DependsOnlyOnUserInput",l[l.DependsOnlyOnDependsOnlyOnUserInput=2]="DependsOnlyOnDependsOnlyOnUserInput",l[l.DependsOnSelfKind=3]="DependsOnSelfKind"})(Re||(Re={}));class nn extends q{constructor(){super(...arguments),this.name=void 0,this.lazy=!1,this.total=!0,this.pure=!0,this.proposedValueIsBuilt=!1}calculation(e){throw new Error("Abstract method `calculation` called")}equality(e,t){return e===t}}wt([w(Re.DependsOnSelfKind)],nn.prototype,"level",void 0),wt([w(!0)],nn.prototype,"sync",void 0);class re extends nn{constructor(){super(...arguments),this.context=void 0,this.isWritingUndefined=!1}newQuark(e){const t=this.quarkClass.new();return t.createdAt=e,t.identifier=this,t.needToBuildProposedValue=this.proposedValueIsBuilt,t}write(e,t,s,i,...n){s=s||t.getWriteTarget(e),s.proposedValue=i,s.proposedArguments=n.length>0?n:void 0,s.proposedIsPrevious=t.graph.isWritingPreviousData}writeToTransaction(e,t,...s){e.write(this,t,...s)}writeToGraph(e,t,...s){e.write(this,t,...s)}readFromGraphAsync(e){return e.readAsync(this)}readFromGraph(e){return e.read(this)}readFromTransaction(e){return e.read(this)}readFromTransactionAsync(e){return e.readAsync(this)}buildProposedValue(e,t,s){}enterGraph(e){}leaveGraph(e){}}const Wl=l=>re.new(l),Pt=Nn.mix(ta.mix(Map)),ia=Nn.mix(ea.mix(Map));class sn extends re{calculation(e){throw new Error("The 'calculation' method of the variables should never be called. Instead, the value will be set directly to quark")}write(e,t,s,i,...n){s=s||t.getWriteTarget(e),s.value=i,s.proposedArguments=n.length>0?n:void 0}}wt([w(Re.UserInput)],sn.prototype,"level",void 0),wt([w(Pt)],sn.prototype,"quarkClass",void 0);function ns(...l){return sn.new(...l)}class Rt extends re{calculation(e){return e(x)}}wt([w(Pt)],Rt.prototype,"quarkClass",void 0);function is(...l){return Rt.new(...l)}class Te extends re{*calculation(e){return yield x}}wt([w(ia)],Te.prototype,"quarkClass",void 0);function ss(...l){return Te.new(...l)}const me=l=>{throw new Error(`Unknown identifier ${l}`)};let zl=0;class Wn extends q{constructor(){super(...arguments),this.createdAt=zl++,this.name="revision-"+this.createdAt,this.previous=void 0,this.scope=new Map,this.reachableCount=0,this.referenceCount=0,this.selfDependent=new Set}getLatestEntryFor(e){let t=this;for(;t;){const s=t.scope.get(e);if(s)return s;t=t.previous}return null}hasIdentifier(e){const t=this.getLatestEntryFor(e);return!!(t&&t.getValue()!==A)}*previousAxis(){let e=this;for(;e;)yield e,e=e.previous}}class Ul{constructor(){this.length=0,this.levels=[],this.lowestLevel=Ne}getLowestLevel(){for(let e=this.lowestLevel!==Ne?this.lowestLevel:0;e<this.levels.length;e++)if(this.levels[e])return this.lowestLevel=e;return this.lowestLevel=Ne}takeLowestLevel(){for(let e=this.lowestLevel!==Ne?this.lowestLevel:0;e<this.levels.length;e++){const t=this.levels[e];if(t)return this.length-=t.length,this.levels[e]=null,this.lowestLevel=e+1,t}}pop(){for(let e=this.lowestLevel!==Ne?this.lowestLevel:0;e<this.levels.length;e++){const t=this.levels[e];if(this.lowestLevel=e,t&&t.length>0)return this.length--,t.pop()}this.lowestLevel=Ne}push(e){const t=e.level;let s=this.levels[t];if(!s){for(let i=this.levels.length;i<t;i++)this.levels[i]=null;s=this.levels[t]=[]}s.push(e),this.length++,t<this.lowestLevel&&(this.lowestLevel=t)}*[Symbol.iterator](){for(let e=0;e<this.levels.length;e++){const t=this.levels[e];t&&(yield*t)}}}class zn extends q{toString(){const e=[],t=[];return this.cycle.forEach(({name:s,context:i})=>{e.push(s),t[t.length-1]!==i&&t.push(i)}),`events: 
`+t.map(s=>"#"+s.id).join(" => ")+`

identifiers: 
`+e.join(`
`)}}class sa extends Li{constructor(){super(...arguments),this.transaction=void 0}onCycle(e,t){return Ee.Cancel}doCollectNext(e,t,s){let i=this.visited.get(t);i||(i={visitedAt:Ct,visitEpoch:this.currentEpoch},this.visited.set(t,i)),s.push({node:t,from:e,label:void 0})}collectNext(e,t){const s=this.transaction.getLatestEntryFor(e);s&&s.outgoingInTheFutureTransactionCb(this.transaction,i=>{this.doCollectNext(e,i.identifier,t)})}}class ra extends q{constructor(){super(...arguments),this.visited=new Map,this.transaction=void 0,this.baseRevision=void 0,this.pushTo=void 0,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e),this.walkDepth()}startNewEpoch(){if(this.toVisit.length)throw new Error("Can not start new walk epoch in the middle of the walk");this.currentEpoch++}onTopologicalNode(e,t){!e.lazy&&e.level!==Re.UserInput&&this.pushTo.push(t)}onCycle(e,t){return Ee.Resume}doCollectNext(e,t,s){let i=this.visited.get(t);i||(i=t.newQuark(this.baseRevision),i.visitEpoch=this.currentEpoch,this.visited.set(t,i)),s.push(t)}collectNext(e,t,s){const i=this.baseRevision.getLatestEntryFor(e);i&&(s.previous=i,i.outgoingInTheFutureAndPastTransactionCb(this.transaction,n=>{this.doCollectNext(e,n.identifier,t)}));for(const n of s.getOutgoing().keys())this.doCollectNext(e,n,t);if(s.$outgoingPast!==void 0)for(const n of s.getOutgoingPast().keys())this.doCollectNext(e,n,t)}walkDepth(){const e=this.visited,t=this.toVisit;let s;for(;s=t.length;){const i=t[s-1];let n=e.get(i);if(n&&n.visitedAt===Xe&&n.visitEpoch===this.currentEpoch){n.edgesFlow++,t.pop();continue}if(n&&n.visitEpoch===this.currentEpoch&&n.visitedAt!==Ct){if(n.visitedAt<s){if(this.onCycle(i,t)!==Ee.Resume)break;n.edgesFlow++}else n.visitedAt=Xe,this.onTopologicalNode(i,n);t.pop()}else{const r=t.length;n||(n=i.newQuark(this.baseRevision),n.visitEpoch=this.currentEpoch,e.set(i,n)),this.collectNext(i,t,n),n.visitEpoch<this.currentEpoch&&n.resetToEpoch(this.currentEpoch),n.visitedAt=s,n.edgesFlow++,t.length===r&&(n.visitedAt=Xe,this.onTopologicalNode(i,n),t.pop())}}}}const rn=bt.Normal,Ye=bt.Past;class rs extends q{constructor(){super(...arguments),this.baseRevision=void 0,this.candidateClass=Wn,this.candidate=void 0,this.graph=void 0,this.isClosed=!1,this.walkContext=void 0,this.entries=new Map,this.stackGen=new Ul,this.activeStack=[],this.onEffectSync=void 0,this.onEffectAsync=void 0,this.propagationStartDate=0,this.lastProgressNotificationDate=0,this.startProgressNotificationsAfterMs=500,this.emitProgressNotificationsEveryMs=200,this.emitProgressNotificationsEveryCalculations=100,this.plannedTotalIdentifiersToCalculate=0,this.ongoing=Promise.resolve(),this.selfDependedMarked=!1,this.rejectedWith=void 0,this.stopped=!1,this.hasEntryWithProposedValue=!1,this.hasVariableEntry=!1}initialize(...e){super.initialize(...e),this.walkContext=ra.new({visited:this.entries,transaction:this,baseRevision:this.baseRevision,pushTo:this.stackGen}),this.candidate||(this.candidate=this.candidateClass.new({previous:this.baseRevision})),this.onEffectSync=this.read.bind(this),this.onEffectAsync=this.readAsync.bind(this)}get dirty(){return this.entries.size>0}markSelfDependent(){if(!this.selfDependedMarked){this.selfDependedMarked=!0;for(const e of this.baseRevision.selfDependent){const t=this.entries.get(e);t&&t.getValue()===A||this.touch(e)}}}getActiveEntry(){return this.activeStack[this.activeStack.length-1]}yieldAsync(e){return Bn(e)?e:this.graph[e.handler](e,this)}yieldSync(e){if(Bn(e))throw new Error("Can not yield a promise in the synchronous context");return this.graph[e.handler](e,this)}readAsync(e){if(!(e instanceof re))return this.yieldAsync(e);let t;const s=this.getActiveEntry();if(s)t=this.addEdge(e,s,rn);else if(t=this.entries.get(e),!t){const i=this.baseRevision.getLatestEntryFor(e);i||me(e),t=i.hasValue()?i:this.touch(e)}return t.hasValue()?t.getValue():t.promise?t.promise:((!t.previous||!t.previous.hasValue())&&t.forceCalculation(),this.ongoing=t.promise=this.ongoing.then(()=>(async()=>{for(;this.stackGen.lowestLevel<e.level;)await tn(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,this.stackGen.takeLowestLevel()],this);if(this.markSelfDependent(),t.getValue()===void 0)return tn(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[t]],this)})()).then(()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);if(!t.hasValue())throw new Error("Computation cycle. Sync");return t.getValue()}))}get(e){if(!(e instanceof re))return this.yieldSync(e);let t;const s=this.getActiveEntry();if(s)t=this.addEdge(e,s,rn);else if(t=this.entries.get(e),!t){const n=this.baseRevision.getLatestEntryFor(e);n||me(e),t=n.hasValue()?n:this.touch(e)}const i=t.getValue();if(i===A&&me(e),i!==void 0&&t.hasValue())return i;if(t.promise)return t.promise;for((!t.previous||!t.previous.hasValue())&&t.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());if(this.markSelfDependent(),e.sync){this.calculateTransitionsStackSync(this.onEffectSync,[t]);const n=t.getValue();if(n===void 0)throw new Error("Cycle during synchronous computation");return n===A&&me(e),n}else return this.ongoing=t.promise=this.ongoing.then(()=>{if(t.getValue()===void 0)return tn(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[t]],this)}).then(()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);const r=t.getValue();if(r===void 0)throw new Error("Computation cycle. Async get");return r===A&&me(e),r})}read(e){if(!(e instanceof re))return this.yieldSync(e);let t;const s=this.getActiveEntry();if(s)t=this.addEdge(e,s,rn);else if(t=this.entries.get(e),!t){const r=this.baseRevision.getLatestEntryFor(e);r||me(e),t=r.hasValue()?r:this.touch(e)}const i=t.getValue();if(i===A&&me(e),i!==void 0)return i;for((!t.previous||!t.previous.hasValue())&&t.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());this.markSelfDependent(),this.calculateTransitionsStackSync(this.onEffectSync,[t]);const n=t.getValue();if(n===void 0)throw new Error("Cycle during synchronous computation");return n===A&&me(e),n}readCurrentOrProposedOrPrevious(e){const t=this.entries.get(e);if(t){const s=t.getValue();if(s!==void 0)return s;if(t.proposedValue!==void 0)return t.proposedValue}return this.readPrevious(e)}readCurrentOrProposedOrPreviousAsync(e){const t=this.entries.get(e);if(t){const s=t.getValue();if(s!==void 0)return s;if(t.proposedValue!==void 0)return t.proposedValue}return this.readPreviousAsync(e)}readPrevious(e){const t=this.baseRevision.getLatestEntryFor(e);if(!t)return;const s=t.getValue();return s!==A?s===void 0&&e.lazy?this.read(e):s:void 0}readPreviousAsync(e){const t=this.baseRevision.getLatestEntryFor(e);if(!t)return;const s=t.getValue();return s!==A?s!==void 0?s:this.readAsync(e):void 0}readProposedOrPrevious(e){const t=this.entries.get(e);return t&&t.proposedValue!==void 0?t.proposedValue:this.readPrevious(e)}readProposedOrPreviousAsync(e){const t=this.entries.get(e);return t&&t.proposedValue!==void 0?t.proposedValue:this.readPreviousAsync(e)}write(e,t,...s){t===void 0&&(t=null),e.write.call(e.context||e,e,this,null,t,...s);const i=this.entries.get(e);this.hasVariableEntry=this.hasVariableEntry||!i.isShadow()&&e.level===Re.UserInput,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||i.hasProposedValue()}getWriteTarget(e){return this.touch(e).startOrigin()}acquireQuarkIfExists(e){const t=this.entries.get(e);return t&&t.origin===t?t.origin:void 0}touch(e){const t=this.entries.get(e);(!t||t.visitEpoch<this.walkContext.currentEpoch)&&this.walkContext.continueFrom([e]);const s=t||this.entries.get(e);return s.forceCalculation(),s}hasIdentifier(e){const t=this.entries.get(e);return t&&t.getValue()===A?!1:!!(t||this.baseRevision.getLatestEntryFor(e))}addIdentifier(e,t,...s){let i=this.entries.get(e);const n=!!i,r=e.level===Re.UserInput;return i||(i=e.newQuark(this.baseRevision),i.previous=this.baseRevision.getLatestEntryFor(e),i.forceCalculation(),this.entries.set(e,i),!e.lazy&&!r&&this.stackGen.push(i),this.hasVariableEntry=this.hasVariableEntry||!i.isShadow()&&r,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||i.hasProposedValue()),(t!==void 0||r)&&(i.startOrigin(),(!(n&&(i.proposedValue!==void 0||i.value!==void 0))||i.proposedValue===A||i.value===A)&&(e.isWritingUndefined=t===void 0,e.write.call(e.context||e,e,this,i,t===void 0&&r?null:t,...s),e.isWritingUndefined=!1)),i.getValue()===A&&(i.value=void 0),i.proposedValue===A&&(i.proposedValue=void 0),e.enterGraph(this.graph),i}removeIdentifier(e){e.leaveGraph(this.graph),this.touch(e).startOrigin().setValue(A),this.candidate.selfDependent.delete(e)}populateCandidateScopeFromTransitions(e,t){if(e.scope.size===0)e.scope=t;else for(const[s,i]of t)if(i.isShadow()){const n=e.getLatestEntryFor(s);i.getOutgoing().forEach((r,a)=>n.getOutgoing().set(a,r))}else e.scope.set(s,i)}preCommit(e){if(this.isClosed)throw new Error("Can not propagate closed revision");this.markSelfDependent(),this.isClosed=!0,this.propagationStartDate=Date.now(),this.plannedTotalIdentifiersToCalculate=this.stackGen.length}postCommit(){this.populateCandidateScopeFromTransitions(this.candidate,this.entries);const e=this.entries;return this.walkContext=void 0,{revision:this.candidate,entries:e,transaction:this}}commit(e){return this.preCommit(e),this.calculateTransitionsSync(this.onEffectSync),this.postCommit()}reject(e=Et.new()){this.rejectedWith=e,this.walkContext=void 0}stop(){this.stopped=!0}clearRejected(){for(const e of this.entries.values())e.cleanup();this.entries.clear()}async commitAsync(e){return this.preCommit(e),this.ongoing=this.ongoing.then(()=>tn(this.onEffectAsync,this.calculateTransitions,[this.onEffectAsync],this)).then(()=>this.postCommit())}getLatestEntryFor(e){let t=this.entries.get(e)||this.baseRevision.getLatestEntryFor(e);if(!(t&&t.getValue()===A))return t}getLatestStableEntryFor(e){let t=this.entries.get(e);if(t){const s=t.getValue();return s===A?void 0:s===void 0?this.baseRevision.getLatestEntryFor(e):t}else return this.baseRevision.getLatestEntryFor(e)}addEdge(e,t,s){if(t.identifier.level<e.level)throw new Error("Identifier can not read from higher level identifier");let n=this.entries.get(e);if(!n){const r=this.baseRevision.getLatestEntryFor(e);r||me(e),n=e.newQuark(this.baseRevision),n.setOrigin(r),n.previous=r,this.entries.set(e,n)}return n.addOutgoingTo(t,s),n}onQuarkCalculationCompleted(e,t){e.cleanup();const s=e.identifier,i=e.previous,n=!!(i&&i.hasValue()&&s.equality(t,i.getValue()));n?(i.outgoingInTheFutureAndPastTransactionCb(this,a=>{const o=this.entries.get(a.identifier);o&&o.edgesFlow--}),e.edgesFlow=Ne,e.setOrigin(i.origin),e.value=t):(e.startOrigin(),e.setValue(t));let r=!1;e.usedProposedOrPrevious&&(e.proposedValue!==void 0?s.equality(t,e.proposedValue)&&(r=!0):(n||!i&&t===null)&&(r=!0),r||this.candidate.selfDependent.add(s))}onReadIdentifier(e,t,s){const i=this.addEdge(e,t,rn);if(i.hasValue()||i.value!==void 0){const n=i.getValue();return n===A&&me(e),t.continueCalculation(n)}else if(i.isShadow()){i.startOrigin(),i.forceCalculation(),s.push(i);return}else if(i.isCalculationStarted()){let n;return sa.new({transaction:this,onCycle(a,o){return n=zn.new({cycle:Lr(o),requestedEntry:i,activeEntry:t}),Ee.Cancel}}).startFrom([i.identifier]),n}else{s.push(i),(!i.previous||!i.previous.hasValue())&&i.forceCalculation();return}}*calculateTransitions(e){const t=this.stackGen;for(;t.length;)yield*this.calculateTransitionsStackGen(e,t.takeLowestLevel())}calculateTransitionsSync(e){const t=this.stackGen;for(;t.length;)this.calculateTransitionsStackSync(e,t.takeLowestLevel())}*calculateTransitionsStackGen(e,t){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const s=this.entries,i=this.propagationStartDate,n=this.graph?this.graph.enableProgressNotifications:!1;let r=0;const a=this.activeStack;for(this.activeStack=t;t.length&&!this.rejectedWith&&!this.stopped;){if(n&&!(r++%this.emitProgressNotificationsEveryCalculations)){const f=Date.now();if(f-i>this.startProgressNotificationsAfterMs){const g=this.lastProgressNotificationDate;(!g||f-g>this.emitProgressNotificationsEveryMs)&&(this.lastProgressNotificationDate=f,this.graph.onPropagationProgressNotification({total:this.plannedTotalIdentifiersToCalculate,remaining:this.stackGen.length+t.length,phase:"propagating"}),this.activeStack=a,yield Zt(0),this.activeStack=t)}}if(this.rejectedWith||this.stopped)break;const o=t[t.length-1],c=o.identifier;if(s.get(c)!==o){o.cleanup(),t.pop();continue}if(o.edgesFlow==0){o.edgesFlow--;const f=o.previous;f&&f.outgoingInTheFutureAndPastTransactionCb(this,p=>{const g=s.get(p.identifier);g&&g.edgesFlow--})}if(o.edgesFlow<0&&o.previous&&o.previous.origin){o.setOrigin(o.previous.origin),o.size===0&&s.delete(c),o.cleanup(),t.pop();continue}if(o.hasValue()||o.proposedValue===A){o.cleanup(),t.pop();continue}const u=o.visitEpoch;let h=o.isCalculationStarted()?o.iterationResult:o.startCalculation(this.onEffectSync);for(;h&&!this.rejectedWith&&!this.stopped;){const f=h.value===void 0?null:h.value;if(o.isCalculationCompleted()){o.visitEpoch==u&&this.onQuarkCalculationCompleted(o,f),t.pop();break}else if(f instanceof re){const p=this.onReadIdentifier(f,o,t);p instanceof zn?(this.walkContext.startNewEpoch(),yield*this.graph.onComputationCycleHandler(p),o.cleanupCalculation(),h=void 0):h=p}else if(f===_n){t.pop();break}else{const p=yield f;if(p===St)break;if(o.visitEpoch===u)h=o.continueCalculation(p);else{t.pop();break}}}}this.activeStack=a}calculateTransitionsStackSync(e,t){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const s=this.entries,i=this.activeStack;for(this.activeStack=t;t.length&&!this.rejectedWith&&!this.stopped;){const n=t[t.length-1],r=n.identifier;if(s.get(r)!==n){n.cleanup(),t.pop();continue}if(n.edgesFlow==0){n.edgesFlow--;const d=n.previous;d&&d.outgoingInTheFutureAndPastTransactionCb(this,u=>{const h=s.get(u.identifier);h&&h.edgesFlow--})}if(n.edgesFlow<0&&n.previous&&n.previous.origin){n.setOrigin(n.previous.origin),n.size===0&&s.delete(r),n.cleanup(),t.pop();continue}if(n.hasValue()||n.proposedValue===A){n.cleanup(),t.pop();continue}const o=n.visitEpoch;let c=n.isCalculationStarted()?n.iterationResult:n.startCalculation(this.onEffectSync);for(;c&&!this.rejectedWith&&!this.stopped;){const d=c.value===void 0?null:c.value;if(n.isCalculationCompleted()){n.visitEpoch==o&&this.onQuarkCalculationCompleted(n,d),t.pop();break}else if(d instanceof re){const u=this.onReadIdentifier(d,n,t);u instanceof zn?(this.walkContext.startNewEpoch(),this.graph.onComputationCycleHandlerSync(u,this),n.cleanupCalculation(),c=void 0):c=u}else if(d===_n){t.pop();break}else{const u=e(d);if(Bn(u))throw new Error("Effect resolved to promise in the synchronous context, check that you marked the asynchronous calculations accordingly");if(u===St)break;if(n.visitEpoch===o)c=n.continueCalculation(u);else{t.pop();break}}}}this.activeStack=i}}const Un={rejectedWith:null};class aa extends q{constructor(){super(...arguments),this.handlers=[]}trigger(e){for(let t=0;t<this.handlers.length;t++)this.handlers[t](e)}}class oa extends q{constructor(){super(...arguments),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.baseRevision=Wn.new(),this.topRevision=void 0,this.historyLimit=0,this.listeners=new Map,this.isWritingPreviousData=!1,this.$activeTransaction=void 0,this.isCommitting=!1,this.enableProgressNotifications=!1,this.ongoing=Promise.resolve(),this._isInitialCommit=!0,this.autoCommitTimeoutId=null,this.autoCommit=!1,this.autoCommitMode="sync",this.autoCommitHandler=null,this.onWriteDuringCommit="throw",this.onComputationCycle="throw",this.transactionClass=rs,this.isJustCleared=!1,this.$followingRevision=void 0}initialize(...e){super.initialize(...e),this.topRevision||(this.topRevision=this.baseRevision),this.autoCommit&&(this.autoCommitHandler=this.autoCommitMode==="sync"?t=>this.commit(t):async t=>this.commitAsync(t)),this.markAndSweep()}hasPendingAutoCommit(){return this.autoCommitTimeoutId!==null}get dirty(){return this.activeTransaction.dirty}clear(){this.reject(),this.unScheduleAutoCommit(),this.baseRevision.scope&&this.baseRevision.scope.clear(),this.baseRevision.previous=null,this.listeners.clear(),this.topRevision=this.baseRevision,this.$followingRevision=void 0,this.$activeTransaction=void 0,this.markAndSweep(),this.isJustCleared=!0}*eachReachableRevision(){let e=!0,t=0;for(const s of this.topRevision.previousAxis())yield[s,e||t<this.historyLimit],s===this.baseRevision?e=!1:e||t++}get isInitialCommit(){return this._isInitialCommit}set isInitialCommit(e){this._isInitialCommit=e}markAndSweep(){let e;const t=[];for(const[s,i]of this.eachReachableRevision())i?(s.reachableCount++,e=s):t.push(s),s.referenceCount++;t.unshift(e);for(let s=t.length-1;s>=1&&t[s].reachableCount===0;s--)this.compactRevisions(t[s-1],t[s])}compactRevisions(e,t){if(t.reachableCount>0||e.previous!==t)throw new Error("Invalid compact operation");if(t.referenceCount<=1){for(const[s,i]of e.scope)if(i.getValue()===A)t.scope.delete(s);else{const n=t.scope.get(s);i.origin===i?n&&(n.clear(),n.clearProperties()):n&&i.origin===n?i.mergePreviousOrigin(e.scope):s.lazy&&!i.origin&&n&&n.origin&&(i.startOrigin().proposedValue=n.origin.value!==void 0?n.origin.value:n.origin.proposedValue),i.previous=void 0,t.scope.set(s,i)}Il(e.selfDependent,t.selfDependent),e.scope=t.scope,t.scope=null}else e.scope=new Map($r(t.scope,e.scope)),e.selfDependent=new Set($r(t.selfDependent,e.selfDependent)),t.referenceCount--;e.previous=null}get followingRevision(){if(this.$followingRevision!==void 0)return this.$followingRevision;const e=Array.from(this.topRevision.previousAxis()),t=[];for(let s=e.length-1;s>0;s--)t.push([e[s],e[s-1]]);return this.$followingRevision=new Map(t)}get activeTransaction(){return this.$activeTransaction?this.$activeTransaction:this.$activeTransaction=this.transactionClass.new({baseRevision:this.baseRevisionTentative||this.baseRevision,graph:this})}branch(e){return this.constructor.new(Object.assign({},e,{baseRevision:this.baseRevision}))}propagate(e){return this.commit(e)}reject(e){this.activeTransaction.reject(Et.new({reason:e})),this.ongoing=Promise.resolve(),this.$activeTransaction=void 0,this.baseRevisionTentative=void 0,this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable,this.baseRevisionStable=void 0)}commit(e){this.isJustCleared=!1,this.unScheduleAutoCommit(),this.baseRevisionStable=this.baseRevision;const s=this.activeTransaction.commit(e);this.$activeTransaction=void 0;const i=this.finalizeCommit(s);return this.baseRevisionStable=void 0,this.isInitialCommit=!1,i}async propagateAsync(e){return this.commitAsync(e)}async commitAsync(e){return this.isCommitting?this.ongoing:(this.isJustCleared=!1,this.isCommitting=!0,this.baseRevisionStable=this.baseRevision,this.ongoing=this.ongoing.then(()=>this.doCommitAsync(e)).then(t=>t).finally(()=>{this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.isInitialCommit=!1,this.isCommitting=!1}))}async doCommitAsync(e){this.unScheduleAutoCommit();const t=this.activeTransaction,s=await t.commitAsync(e),i=!!t.rejectedWith,n=this.baseRevisionTentative;if(i||(this.baseRevisionTentative=t.candidate),this.$activeTransaction=void 0,await this.finalizeCommitAsync(s),this.isJustCleared)return{rejectedWith:Et.new({reason:"Graph cleared"})};t.rejectedWith&&!i&&(this.baseRevisionTentative=n,this.$activeTransaction=void 0);const r=this.finalizeCommit(s);return t.rejectedWith&&t.clearRejected(),this.dirty&&!t.rejectedWith&&await this.doCommitAsync(e),r}finalizeCommit(e){const{revision:t,entries:s,transaction:i}=e;if(i.rejectedWith)this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0;else{if(t.previous!==this.baseRevision)throw new Error("Invalid revisions chain");for(const[n,r]of this.eachReachableRevision())r&&n.reachableCount--,n.referenceCount--;this.baseRevision=this.topRevision=t;for(const[n,r]of s){if(r.cleanup(),r.isShadow()||!r.hasValue())continue;const a=this.listeners.get(n);a&&a.trigger(r.getValue())}this.$followingRevision=void 0,this.markAndSweep()}return{rejectedWith:i.rejectedWith}}async finalizeCommitAsync(e){}*onComputationCycleHandler(e){const t=new Error(`Computation cycle:
`+e);switch(t.cycle=e,this.onComputationCycle){case"ignore":console.log(t.message);const{requestedEntry:s,activeEntry:i}=e;return i.continueCalculation(s.proposedValue!==void 0?s.proposedValue:s.value);case"throw":throw t;case"reject":this.reject(t);break}}onComputationCycleHandlerSync(e,t){const s=new Error(`Computation cycle:
`+e);switch(s.cycle=e,this.onComputationCycle){case"ignore":console.log(s.message);const{requestedEntry:i,activeEntry:n}=e;return n.continueCalculation(i.proposedValue!==void 0?i.proposedValue:i.value);case"throw":throw s;case"reject":this.reject(s);break}}scheduleAutoCommit(){this.autoCommitTimeoutId===null&&!this.isCommitting&&(this.autoCommitTimeoutId=setTimeout(this.autoCommitHandler,10))}unScheduleAutoCommit(){this.autoCommitTimeoutId!==null&&(clearTimeout(this.autoCommitTimeoutId),this.autoCommitTimeoutId=null)}variable(e){const t=ns();return this.addIdentifier(t,e===void 0?null:e)}variableNamed(e,t){const s=ns({name:e});return this.addIdentifier(s,t===void 0?null:t)}identifier(e,t){const s=Bi(e)?ss({calculation:e,context:t}):is({calculation:e,context:t});return this.addIdentifier(s)}identifierNamed(e,t,s){const i=t.constructor.name==="GeneratorFunction"?ss({name:e,calculation:t,context:s}):is({name:e,calculation:t,context:s});return this.addIdentifier(i)}addIdentifier(e,t,...s){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Adding identifier during commit");this.onWriteDuringCommit}return this.activeTransaction.addIdentifier(e,t,...s),this.autoCommit&&this.scheduleAutoCommit(),e}removeIdentifier(e){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Removing identifier during commit");this.onWriteDuringCommit}this.activeTransaction.removeIdentifier(e),this.listeners.delete(e),this.autoCommit&&this.scheduleAutoCommit()}hasIdentifier(e){return this.activeTransaction.hasIdentifier(e)}write(e,t,...s){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Write during commit");this.onWriteDuringCommit}this.activeTransaction.write(e,t,...s),this.autoCommit&&this.scheduleAutoCommit()}readPrevious(e){return this.activeTransaction.readPrevious(e)}readPreviousAsync(e){return this.activeTransaction.readPreviousAsync(e)}read(e){return this.activeTransaction.read(e)}readAsync(e){return this.activeTransaction.readAsync(e)}get(e){return this.activeTransaction.get(e)}observe(e,t){const s=this.addIdentifier(Te.new({lazy:!1,calculation:e}));return this.addListener(s,t),s}observeContext(e,t,s){const i=this.addIdentifier(Te.new({lazy:!1,calculation:e,context:t}));return this.addListener(i,s),i}addListener(e,t){let s=this.listeners.get(e);s||(s=aa.new(),this.listeners.set(e,s)),s.handlers.push(t)}undo(){const t=this.baseRevision.previous;return t?(this.baseRevision=t,this.$activeTransaction=void 0,!0):!1}redo(){const e=this.baseRevision;if(e===this.topRevision)return!1;const t=this.followingRevision.get(e);return this.baseRevision=t,this.$activeTransaction=void 0,!0}onPropagationProgressNotification(e){}[_i](e,t){const s=t.getActiveEntry();s.usedProposedOrPrevious=!0;const i=s.getProposedValue(t);return i!==void 0?i:s.previous?s.identifier.lazy?s.previous.hasValue()?s.previous.getValue():s.previous.hasProposedValue()?s.previous.getProposedValue(t):null:t.readPrevious(s.identifier):void 0}[en](e,t){return this.reject(e.reason),St}[Ni](e,t){return t}[Wi](e,t){return t.getActiveEntry()}[zi](e,t){return t.getActiveEntry().identifier}[Ui](e,t){const s=t.getActiveEntry();if(s.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");const i=e.identifier.level>s.identifier.level;return i||t.walkContext.startNewEpoch(),t.write(e.identifier,...e.proposedArgs),i?void 0:St}[Hi](e,t){const s=t.getActiveEntry();if(s.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");let i=!0;return e.writes.forEach(n=>{n.identifier.level<=s.identifier.level&&i&&(t.walkContext.startNewEpoch(),i=!1),t.write(n.identifier,...n.proposedArgs)}),i?void 0:St}[Ki](e,t){const s=t.getActiveEntry(),i=e.identifier;return t.addEdge(i,s,Ye),t.readPrevious(i)}[Qi](e,t){const s=t.getActiveEntry(),i=e.identifier;t.addEdge(i,s,Ye);const n=t.entries.get(i);return n&&!n.isShadow()?n.getProposedValue(t):void 0}[Xi](e,t){const s=t.getActiveEntry(),i=e.identifier;t.addEdge(i,s,Ye);const n=t.entries.get(i);return n?n.hasProposedValue():!1}[Ji](e,t){const s=t.getActiveEntry(),i=e.identifier;t.addEdge(i,s,Ye);const n=t.entries.get(i);return n?n.hasProposedValue()&&!n.proposedIsPrevious:!1}[Zi](e,t){const s=t.getActiveEntry(),i=e.identifier;return t.addEdge(i,s,Ye),t.readProposedOrPrevious(i)}[es](e,t){return t.readProposedOrPrevious(e.identifier)}[ts](e,t){return t.readPrevious(e.identifier)}[Yi](e,t){const s=t.getActiveEntry(),i=e.identifier;t.addEdge(i,s,Ye);const n=t.entries.get(i);return n&&!n.isShadow()?n.proposedArguments:void 0}}class la extends q{constructor(){super(...arguments),this.name=void 0,this.ownFields=new Map,this.schema=void 0,this.$skeleton={},this.$allFields=void 0}hasField(e){return this.getField(e)!==void 0}getField(e){return this.allFields.get(e)}addField(e){const t=e.name;if(!t)throw new Error("Field must have a name");if(this.ownFields.has(t))throw new Error(`Field with name [${t}] already exists`);return e.entity=this,this.ownFields.set(t,e),e}forEachParent(e){let t=this;for(;t;)e(t),t=t.parentEntity}get allFields(){if(this.$allFields!==void 0)return this.$allFields;const e=new Map,t=new Set;return this.forEachParent(s=>{s.ownFields.forEach((i,n)=>{t.has(n)||(t.add(n),e.set(n,i))})}),this.$allFields=e}forEachField(e){this.allFields.forEach(e)}}var xe;(function(l){l[l.Current=0]="Current",l[l.Previous=1]="Previous",l[l.ProposedOrPrevious=2]="ProposedOrPrevious",l[l.CurrentOrProposedOrPrevious=3]="CurrentOrProposedOrPrevious"})(xe||(xe={}));class as extends v([oa],e=>class extends e{constructor(){super(...arguments),this.autoCommit=!0,this.readMode=xe.Current}addEntity(s){s.enterGraph(this)}addEntities(s){s.forEach(i=>this.addEntity(i))}removeEntity(s){s.leaveGraph(this)}removeEntities(s){s.forEach(i=>this.removeEntity(i))}}){}class he extends v([re],e=>class extends e{constructor(){super(...arguments),this.field=void 0,this.self=void 0,this.DATA=void 0}getFromGraph(s){return s?s.readMode===xe.Current?s.get(this):s.readMode===xe.Previous?s.activeTransaction.readPrevious(this):(s.readMode===xe.ProposedOrPrevious&&s.activeTransaction.readProposedOrPrevious(this),s.activeTransaction.readCurrentOrProposedOrPrevious(this)):this.DATA}readFromGraph(s){return s?s.read(this):this.DATA}writeToGraph(s,i,...n){s?s.write(this,i,...n):this.DATA=i}leaveGraph(s){const i=s.activeTransaction.getLatestStableEntryFor(this);i&&(this.DATA=i.getValue()),super.leaveGraph(s)}toString(){return this.name}}){}class an extends he.mix(Rt){}class os extends he.mix(Te){}class ls extends he.mix(sn){}class ca extends v([re],e=>class extends e{constructor(){super(...arguments),this.entity=void 0,this.self=void 0}equality(){return!1}toString(){return`Entity identifier [${this.self}]`}}){}class da extends ca.mix(Te){}class Tt extends nn{constructor(){super(...arguments),this.persistent=!0}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?Bi(e)?os:an:ls}}const ua=Symbol("isEntity");class $e extends v([],e=>{class t extends e{[ua](){}get $entity(){return cs(this.constructor.prototype)}get $(){const i={};return this.$entity.forEachField((n,r)=>{i[r]=this.createFieldIdentifier(n)}),Fi(this,"$",i)}get $$(){return Fi(this,"$$",da.new({name:this.$entityName,entity:this.$entity,calculation:this.calculateSelf,context:this,self:this}))}get $entityName(){return this.constructor.name||this.$entity.name}*calculateSelf(){return this}createFieldIdentifier(i){const n=i.name,r=this.$entity,a=this.constructor,o=r.$skeleton;o[n]||(o[n]=a.getIdentifierTemplateClass(this,i));const c=new o[n];return c.context=this,c.self=this,c.name=`${this.$$.name}.$.${i.name}`,c}forEachFieldIdentifier(i){this.$entity.forEachField((n,r)=>i(this.$[r],r,n))}enterGraph(i){if(this.graph)throw new Error("Already entered replica");this.graph=i,i.addIdentifier(this.$$),this.$entity.forEachField((n,r)=>{const a=this.$[r];i.addIdentifier(a,a.DATA),a.DATA=void 0})}leaveGraph(i){const n=this.graph,r=i||n;r&&(this.$entity.forEachField((a,o)=>r.removeIdentifier(this.$[o])),r.removeIdentifier(this.$$),r===n&&(this.graph=void 0))}propagate(i){return this.commit(i)}commit(i){const n=this.graph;return n?n.commit(i):Un}async propagateAsync(){return this.commitAsync()}async commitAsync(i){const n=this.graph;return n?n.commitAsync(i):Promise.resolve(Un)}static get $entity(){return et(this.prototype)}static getIdentifierTemplateClass(i,n){const r=n.name,a={name:`${i.$$.name}.$.${r}`,field:n};n.hasOwnProperty("sync")&&(a.sync=n.sync),n.hasOwnProperty("lazy")&&(a.lazy=n.lazy),n.hasOwnProperty("equality")&&(a.equality=n.equality);const o=i.$calculations&&i[i.$calculations[r]];o&&(a.calculation=o);const c=i.$writes&&i[i.$writes[r]];c&&(a.write=c);const d=i.$buildProposed&&i[i.$buildProposed[r]];d&&(a.buildProposedValue=d,a.proposedValueIsBuilt=!0);const u=n.getIdentifierClass(o).new(a),h=function(){};return h.prototype=u,h}run(i,...n){const r=d=>{if(d instanceof re)return this.graph.read(d);throw new Error("Helper methods can not yield effects during computation")},a=this.graph.activeTransaction,o=a.activeStack;a.activeStack=[];const c=na(r,this[i],n,this);return a.activeStack=o,c}static createPropertyAccessorsFor(i){const n=i,r=this.prototype;Object.defineProperty(r,n,{get:function(){return this.$[n].getFromGraph(this.graph)},set:function(a){this.$[n].writeToGraph(this.graph,a)}})}static createMethodAccessorsFor(i){const n=i,r=this.prototype,a=`get${xi(n)}`,o=`set${xi(n)}`,c=`put${xi(n)}`;a in r||(r[a]=function(){return this.$[n].getFromGraph(this.graph)}),o in r||(r[o]=function(d,...u){return this.$[n].writeToGraph(this.graph,d,...u),this.graph?this.graph.autoCommitMode==="sync"?this.graph.commit():this.graph.commitAsync():Promise.resolve(Un)}),c in r||(r[c]=function(d,...u){this.$[n].writeToGraph(this.graph,d,...u)})}}return t}){}const cs=l=>{let e=Object.getPrototypeOf(l);return Fi(l,"$entity",la.new({parentEntity:e.hasOwnProperty(ua)?null:e.$entity,name:l.constructor.name}))},et=l=>(l.hasOwnProperty("$entity")||cs(l),l.$entity),te=(l,e=Tt)=>function(t,s){et(t).addField(e.new(Object.assign(l||{},{name:s})));const n=t.constructor;n.createPropertyAccessorsFor(s),n.createMethodAccessorsFor(s)},T=te,D=function(l){return function(e,t,s){et(e);let i;e.$calculations?e.hasOwnProperty("$calculations")?i=e.$calculations:i=e.$calculations=Object.create(e.$calculations):i=e.$calculations={},i[l]=t}},ye=function(l){return function(e,t,s){et(e);let i;e.$writes?e.hasOwnProperty("$writes")?i=e.$writes:i=e.$writes=Object.create(e.$writes):i=e.$writes={},i[l]=t}},ha=function(l){return function(e,t,s){et(e);let i;e.$buildProposed?e.hasOwnProperty("$buildProposed")?i=e.$buildProposed:i=e.$buildProposed=Object.create(e.$buildProposed):i=e.$buildProposed={},i[l]=t}};var fa=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class ds extends v([Tt],e=>class extends e{constructor(){super(...arguments),this.identifierCls=ga}}){}const pa=(l,e=ds)=>te(l,e);class us extends v([he],e=>{class t extends e{constructor(){super(...arguments),this.field=void 0,this.proposedValueIsBuilt=!0}hasBucket(){return!!this.field.bucket}getBucket(i){return i.$[this.field.bucket]}buildProposedValue(i,n,r){const a=n.proposedValue;if(a===null)return null;const o=On(a,$e)?a:i.resolve(a);return o&&i.hasBucket()&&i.getBucket(o).addToBucket(r,i.self),o}resolve(i){const n=this.field.resolver;return n?n.call(this.self,i):null}enterGraph(i){if(this.hasBucket()){const n=i.activeTransaction.readProposedOrPrevious(this);n instanceof $e&&this.getBucket(n).addToBucket(i.activeTransaction,this.self)}super.enterGraph(i)}leaveGraph(i){if(this.hasBucket()){const n=i.activeTransaction.readProposedOrPrevious(this);n instanceof $e&&this.getBucket(n).removeFromBucket(i.activeTransaction,this.self)}super.leaveGraph(i)}write(i,n,r,a,...o){const c=r||n.acquireQuarkIfExists(i);if(i.hasBucket()){if(c){const d=c.getValue();d instanceof $e&&i.getBucket(d).removeFromBucket(n,i.self)}else if(n.baseRevision.hasIdentifier(i)){const d=n.readPrevious(i);d instanceof $e&&i.getBucket(d).removeFromBucket(n,i.self)}}super.write(i,n,r,a)}}return fa([w(Re.DependsOnlyOnUserInput)],t.prototype,"level",void 0),fa([w(Pt)],t.prototype,"quarkClass",void 0),t}){}class ga extends us.mix(he.mix(Rt)){}var ma=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class hs extends v([Tt],e=>class extends e{constructor(){super(...arguments),this.persistent=!1,this.identifierCls=Da}}){}const ya=(l,e=hs)=>te(l,e);var $t;(function(l){l.Add="Add",l.Remove="Remove"})($t||($t={}));class va extends v([Nn],e=>class extends e{constructor(){super(...arguments),this.mutations=[],this.previousValue=void 0}hasProposedValueInner(){return this.mutations.length>0}}){}const Ca=va.mix(Pt);class fs extends v([he],e=>{class t extends e{constructor(){super(...arguments),this.proposedValueIsBuilt=!0}addToBucket(i,n){const r=i.getWriteTarget(this);r.mutations.push({type:$t.Add,entity:n});const a=i.baseRevision;!r.previousValue&&a.hasIdentifier(this)&&(r.previousValue=i.readPrevious(this))}removeFromBucket(i,n){const r=i.entries.get(this);if(r&&r.getValue()===A)return;const a=i.getWriteTarget(this);a.mutations.push({type:$t.Remove,entity:n});const o=i.baseRevision;!a.previousValue&&o.hasIdentifier(this)&&(a.previousValue=i.readPrevious(this))}buildProposedValue(i,n,r){const a=n,o=new Set(a.previousValue);for(let c=0;c<a.mutations.length;c++){const{type:d,entity:u}=a.mutations[c];d===$t.Remove?o.delete(u):d===$t.Add&&o.add(u)}return o}leaveGraph(i){super.leaveGraph(i),this.DATA=void 0}}return ma([w(Re.DependsOnlyOnDependsOnlyOnUserInput)],t.prototype,"level",void 0),ma([w(Ca)],t.prototype,"quarkClass",void 0),t}){}class Da extends fs.mix(he.mix(Rt)){}class Sa extends q{constructor(){super(...arguments),this.entities=new Map}hasEntity(e){return this.entities.has(e)}getEntity(e){return this.entities.get(e)}addEntity(e){const t=e.name;if(!t)throw new Error("Entity must have a name");if(this.hasEntity(t))throw new Error(`Entity with name [${String(t)}] already exists`);return e.schema=this,this.entities.set(t,e),e}getEntityDecorator(){return e=>{const t=ps(e);return this.addEntity(t),e}}}const ps=l=>{if(!l.name)throw new Error("Can't add entity - the target class has no name");return et(l.prototype)},Gl=()=>l=>(ps(l),l);var Gn=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const It=function(l,e){return l===e||(e!=null&&e.isBase?this.serialize(e):e)===(l!=null&&l.isBase?this.serialize(l):l)};class Hn extends Tt{constructor(){super(...arguments),this.modelFieldConfig={}}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?Bi(e)?wa:ba:Pa}}class tt extends ds.mix(Hn){constructor(){super(...arguments),this.identifierCls=on}}class nt extends hs.mix(Tt){constructor(){super(...arguments),this.identifierCls=Kn}}const qn=Symbol("IsChronoModelSymbol");class Mt extends v([he],e=>{const t=e.prototype;class s extends e{[qn](){}getFromGraph(n){var a;if(n){if(n.readMode===xe.CurrentOrProposedOrPrevious){var r;const o=n.isCommitting&&this.level>((a=(r=n.activeTransaction.getActiveEntry())===null||r===void 0?void 0:r.level)!=null?a:Number.MAX_SAFE_INTEGER);return this.sync&&!this.context.project.isDelayingCalculation&&!o?n.get(this):n.activeTransaction.readCurrentOrProposedOrPrevious(this)}return t.getFromGraph.call(this,n)}else return this.DATA}writeToGraph(n,r,...a){n?t.writeToGraph.call(this,n,r,...a):(this.DATA=r,!this.self.inSetting&&!this.self.isConstructing&&this.self.set(this.field.name,r,!1,!1,!0))}write(n,r,a,o,...c){o=n.convert(o),t.write.call(this,n,r,a,o,...c)}convert(n){const r=this.field,a=this.self.getFieldDefinition(r.name);return a!=null&&a.convert?n=a.convert(n,this.context.data,this.context):r.converter&&(n=r.converter(n,r)),n}equality(n,r){return n instanceof Date&&r instanceof Date?n.getTime()===r.getTime():n===r}}return Gn([w(!1)],s.prototype,"sync",void 0),s}){}class Ea extends v([Pt],e=>{const t=e.prototype;class s extends e{setValue(n){t.setValue.call(this,n),n!==A&&(this.identifier.DATA=n)}}return s}){}class on extends us.mix(Mt.mix(an)){buildProposedValue(e,t,s){const i=t,n=i.proposedValue;if(n==null)return s.candidate.failedResolutionReferences.delete(i.identifier),null;if(On(n,$e)&&n.graph)return e.hasBucket()&&e.getBucket(n).addToBucket(s,e.self),s.candidate.failedResolutionReferences.delete(i.identifier),n;const r=e.resolve(n);return On(r,$e)&&r.graph?(e.hasBucket()&&e.getBucket(r).addToBucket(s,e.self),s.candidate.failedResolutionReferences.delete(i.identifier),r):(s.candidate.failedResolutionReferences.set(i.identifier,n),null)}}Gn([w(!0)],on.prototype,"sync",void 0),Gn([w(Ea)],on.prototype,"quarkClass",void 0);class Kn extends fs.mix(Mt.mix(an)){}Gn([w(!0)],Kn.prototype,"sync",void 0);class ba extends Mt.mix(an){}class wa extends Mt.mix(os){}class Pa extends Mt.mix(ls){}const E=function(l={},e={},t=Hn){return function(s,i){te({modelFieldConfig:l,...e},t)(s,i),Qn(s.constructor)}},Qn=l=>{l.hasOwnProperty("fields")||Object.defineProperty(l,"fields",{get:function(){return Ra(this)}})},Ra=l=>{const e=l.prototype,t=[];return e.hasOwnProperty("$entity")&&e.$entity.ownFields.forEach(s=>{if(s instanceof Hn){const i=s.modelFieldConfig||{};!i.convert&&s.converter&&s.converter!==it&&(i.convert=s.converter),t.push(Object.assign(i,{$chrono:s,name:s.name}))}}),t},it=(l,e)=>{if(l===null)return null;if(!(l instanceof Date)){var t,s;l=O.parse(l,((t=e.modelFieldConfig)===null||t===void 0?void 0:t.format)||((s=e.modelFieldConfig)===null||s===void 0?void 0:s.dateFormat)||O.defaultParseFormat)}return l||void 0};class Xn extends v([$e,mt],e=>{const t=e.prototype;class s extends e{get isEntity(){return!0}construct(n,...r){this.constructor.exposeProperties(),this.originalData=n=n||{},t.construct.call(this,n,...r);for(const a in this.originalData)this.$[a]&&!this.getFieldDefinition(a)&&(this[a]=n[a])}*userProvidedValue(){return yield x}copy(n=null,r=null){const a=t.copy.call(this,n,r),{creatingOccurrence:o}=r!=null?r:{};return(H.isObject(r)&&!r.skipFieldIdentifiers||!H.isObject(r))&&this.forEachFieldIdentifier((c,d,u)=>{var h;!u.lazy&&((h=this.getFieldDefinition(d))===null||h===void 0?void 0:h.type)!=="store"&&(!o||c instanceof Kn||c instanceof on)&&(a[d]=this[d])}),a}applyValue(n,r,a,o,c){var u;this.$entity.getField((c==null?void 0:c.name)||r)&&(n=!0),o&&(n=!1),t.applyValue.call(this,n,n&&(u=c==null?void 0:c.name)!=null?u:r,a,o,c)}get isInActiveTransaction(){var n;const r=(n=this.graph)===null||n===void 0?void 0:n.activeTransaction;return!!(r!=null&&r.getLatestEntryFor(this.$$))}get data(){return this._data}set data(n){this._data=n;const{fields:r,$:a,graph:o,generation:c}=this;for(let d=0;d<r.length;d++){const{name:u,dataSource:h,complexMapping:f}=r[d],p=a[u];if(p){const g=f?H.getPath(n,h):n[h];(f||h in n)&&(c!=null||g!==void 0)&&p.writeToGraph(o,g)}}}get $entityName(){const n=this.constructor.name||this.$entity.name,r=this.id;return`${n}${r!=null?"-"+String(r):""}`}}return s}){}const Hl={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",RemoveDependencyCycleEffectResolution:{descriptionTpl:"Remove dependency"},DeactivateDependencyCycleEffectResolution:{descriptionTpl:"Deactivate dependency"},CycleEffectDescription:{descriptionTpl:"A cycle has been found, formed by: {0}"},EmptyCalendarEffectDescription:{descriptionTpl:'"{0}" calendar does not provide any working time intervals.'},Use24hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 24 hours calendar with non-working Saturdays and Sundays."},Use8hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 8 hours calendar (08:00-12:00, 13:00-17:00) with non-working Saturdays and Sundays."},ConflictEffectDescription:{descriptionTpl:"A scheduling conflict has been found: {0} is conflicting with {1}"},ConstraintIntervalDescription:{dateFormat:"LLL"},ProjectConstraintIntervalDescription:{startDateDescriptionTpl:"Project start date {0}",endDateDescriptionTpl:"Project end date {0}"},DependencyType:{long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},ManuallyScheduledParentConstraintIntervalDescription:{startDescriptionTpl:'Manually scheduled "{2}" forces its children to start no earlier than {0}',endDescriptionTpl:'Manually scheduled "{2}" forces its children to finish no later than {1}'},DisableManuallyScheduledConflictResolution:{descriptionTpl:'Disable manual scheduling for "{0}"'},DependencyConstraintIntervalDescription:{descriptionTpl:'Dependency ({2}) from "{3}" to "{4}"'},RemoveDependencyResolution:{descriptionTpl:'Remove dependency from "{1}" to "{2}"'},DeactivateDependencyResolution:{descriptionTpl:'Deactivate dependency from "{1}" to "{2}"'},DateConstraintIntervalDescription:{startDateDescriptionTpl:'Task "{2}" {3} {0} constraint',endDateDescriptionTpl:'Task "{2}" {3} {1} constraint',constraintTypeTpl:{startnoearlierthan:"Start-No-Earlier-Than",finishnoearlierthan:"Finish-No-Earlier-Than",muststarton:"Must-Start-On",mustfinishon:"Must-Finish-On",startnolaterthan:"Start-No-Later-Than",finishnolaterthan:"Finish-No-Later-Than"}},RemoveDateConstraintConflictResolution:{descriptionTpl:'Remove "{1}" constraint of task "{0}"'}};Mr.publishLocale(Hl);class Jn extends q{initialize(...e){super.initialize(...e),this.startDate||(this.startDate=De),this.endDate||(this.endDate=le)}equalTo(e){return this.startDate.getTime()===e.startDate.getTime()&&this.endDate.getTime()===e.endDate.getTime()}isInfinite(){return this.startDate.getTime()===De.getTime()&&this.endDate.getTime()===le.getTime()}startDateIsFinite(){return!this.isIntervalEmpty()&&this.startDate.getTime()!==De.getTime()}endDateIsFinite(){return!this.isIntervalEmpty()&&this.endDate.getTime()!==le.getTime()}containsDate(e,t=Ii.Left){return t===Ii.Left&&e>=this.startDate&&e<this.endDate||t===Ii.Right&&e>this.startDate&&e<=this.endDate}isIntervalEmpty(){return this.startDate>this.endDate}intersect(e){const t=e.startDate,s=e.endDate,i=this.startDate,n=this.endDate;if(n<t||i>s)return Ta;const r=new Date(Math.max(i.getTime(),t.getTime())),a=new Date(Math.min(n.getTime(),s.getTime()));return this.constructor.new({startDate:r,endDate:a})}intersectMut(e,t=!1){const s=e.startDate,i=e.endDate,n=this.startDate,r=this.endDate;if(t){var a;this.intersectionOf||(this.intersectionOf=new Set),((a=e.intersectionOf)===null||a===void 0?void 0:a.size)>0?(e.intersectionOf.forEach(this.intersectionOf.add,this.intersectionOf),this.intersectedAsEmpty=e.intersectedAsEmpty):this.intersectionOf.add(e)}if(!this.isIntervalEmpty()){if(r<s||n>i)return this.startDate=le,this.endDate=De,t&&(this.intersectedAsEmpty=e),this;this.startDate=new Date(Math.max(n.getTime(),s.getTime())),this.endDate=new Date(Math.min(r.getTime(),i.getTime()))}return this}getCopyProperties(e){return e}copyWith(e){const t=this.getCopyProperties(e);return this.constructor.new(t)}}const Ta=Jn.new({startDate:le,endDate:De}),We=(l,e=!1)=>l.reduce((t,s)=>t.intersectMut(s,e),Jn.new());var $a=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n},ve;(function(l){l.Cancel="Cancel",l.Resume="Resume"})(ve||(ve={}));class ln extends de{getDescription(){throw new Error("Abstract method")}resolve(...e){throw new Error("Abstract method")}}class cn extends z{getResolutions(){return this._resolutions}getDescriptionBuilderClass(){return this._descriptionBuilderClass}setDescriptionBuilderClass(e){this._descriptionBuilderClass=e}getDescription(){return this.getDescriptionBuilderClass().getDescription(this)}}$a([w("schedulingIssueEffect")],cn.prototype,"type",void 0),$a([w(!1)],cn.prototype,"sync",void 0);var gs=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const ms=Symbol("ConflictSymbol");class Ia extends ge(de){static get $name(){return"ConflictEffectDescription"}static getDescription(e){return Ve(this.L("L{descriptionTpl}"),e.intervals[0].getDescription(),e.intervals[1].getDescription())}}class Ot extends cn{constructor(){super(...arguments),this.handler=ms}initialize(e){super.initialize(e),this.intervals=this.filterConflictingIntervals(this.intervals)}getResolutions(){return this._resolutions||(this._resolutions=[].concat(...this.intervals.map(e=>e.getResolutions()))),this._resolutions}filterConflictingIntervals(e){const t=[],s=[...e].filter(n=>!n.isInfinite()),i=s.find(n=>n.isAffectedByTransaction());if(i){const n=s.sort((o,c)=>o===i?-1:0),a=We(n,!0).intersectedAsEmpty;t.push(a,i)}else t.push(We(s,!0).intersectedAsEmpty,We(s.reverse(),!0).intersectedAsEmpty);return t}}gs([w("schedulingConflict")],Ot.prototype,"type",void 0),gs([w(Ia)],Ot.prototype,"_descriptionBuilderClass",void 0);class ys extends ln{resolve(){throw new Error("Abstract method")}}class Zn extends ge(de){static get $name(){return"ConstraintIntervalDescription"}static getDescription(e){return Ve(this.L("L{descriptionTpl}"),...this.getDescriptionParameters(e))}static getDescriptionParameters(e){return[O.format(e.startDate,this.L("L{dateFormat}")),O.format(e.endDate,this.L("L{dateFormat}"))]}}class jt extends Jn{constructor(){super(...arguments),this.owner=void 0,this.reflectionOf=void 0,this.side=void 0,this.resolutions=void 0}get isConstraintInterval(){return!0}getDescription(){return this.descriptionBuilderClass.getDescription(this)}getResolutions(){return[]}isAffectedByTransaction(e){return!1}getCopyProperties(e){const{owner:t,reflectionOf:s,side:i}=this;return Object.assign({owner:t,reflectionOf:s,side:i},e)}}gs([w(Zn)],jt.prototype,"descriptionBuilderClass",void 0);class vs extends v([Lo],e=>{e.prototype;class t extends e{getGraph(){const i=this.getProject();return i==null?void 0:i.getGraph()}getEventById(i){var n;return(n=this.getEventStore())===null||n===void 0?void 0:n.getById(i)}getDependencyById(i){var n;return(n=this.getDependencyStore())===null||n===void 0?void 0:n.getById(i)}getResourceById(i){var n;return(n=this.getResourceStore())===null||n===void 0?void 0:n.getById(i)}getAssignmentById(i){var n;return(n=this.getAssignmentStore())===null||n===void 0?void 0:n.getById(i)}getCalendarById(i){var n;return(n=this.getCalendarManagerStore())===null||n===void 0?void 0:n.getById(i)}}return t}){}class Ma extends v([_e],e=>class extends e{}){}class st extends v([Vo,vs,Ma],e=>{const t=e.prototype;class s extends e{constructor(){super(...arguments),this.removalOrder=0}setStoreData(n){var r;(r=this.project)===null||r===void 0||r.repopulateStore(this),t.setStoreData.call(this,n)}register(n){var r,a;t.register.call(this,n),!n.isRoot&&!((r=this.project)!==null&&r!==void 0&&r.graph)&&((a=this.project)===null||a===void 0||a.scheduleDelayedCalculation())}onModelChange(n,r,a,o,c,d){var u;!d&&!(this.syncDataOnLoad&&this.isLoadingData)&&Object.keys(a).some(h=>h!=="intervals"&&n.$entity.getField(h))&&!((u=this.project)!==null&&u!==void 0&&u.applyingSyncResponse)&&(o=!0),super.onModelChange(n,r,a,o,c,d)}}return s}){}class At extends v([_o,vs,Xn],e=>{const t=e.prototype;class s extends e{joinProject(){var n;(n=this.project)!==null&&n!==void 0&&n.delayEnteringReplica||(this.graph&&this.graph!=this.getGraph()&&(this.graph=null),this.getGraph().addEntity(this))}leaveProject(n=!1){t.leaveProject.call(this,n);const r=this.getGraph();r==null||r.removeEntity(this),this.graph=null}getProject(){return t.getProject.call(this)}calculateProject(){const n=this.stores.find(r=>On(r,st)&&!!r.getProject());return n==null?void 0:n.getProject()}get graph(){var n;return(n=this.project)!==null&&n!==void 0&&n.delayEnteringReplica?null:this._graph}set graph(n){this._graph=n}}return s}){}var dn=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const Cs=Symbol("EmptyCalendarSymbol");class xt extends v([No,At],e=>{class t extends e{constructor(){super(...arguments),this.version=1}leaveProject(){this.project.clearCombinationsWith(this),super.leaveProject()}}return dn([E({},{persistent:!1})],t.prototype,"version",void 0),dn([E({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),dn([E()],t.prototype,"intervals",void 0),t}){}class Oa extends ge(de){static get $name(){return"EmptyCalendarEffectDescription"}static getDescription(e){const t=e.getCalendar();return Ve(this.L("L{descriptionTpl}"),t.name||t.id)}}class un extends cn{constructor(){super(...arguments),this.handler=Cs}getResolutions(){const e=this.getCalendar();return this._resolutions||(this._resolutions=[ja.new({calendar:e}),Aa.new({calendar:e})])}getCalendar(){const{calendars:e}=this;if((e==null?void 0:e.length)>1){for(const t of e)if(!(t.skipNonWorkingTime(this.date,this.isForward)instanceof Date))return t}return e[0]}}dn([w("emptyCalendar")],un.prototype,"type",void 0),dn([w(Oa)],un.prototype,"_descriptionBuilderClass",void 0);class Ds extends ge(ln){static get $name(){return"BaseEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{intervals:[{isWorking:!0}]}}}getDescription(){const{calendar:e}=this;return Ve(this.L("L{descriptionTpl}"),e.name||e.id)}fixCalendarData(e){var t;e.clearIntervals(!0),Object.assign(e,this.calendarData),(t=e.intervals)!==null&&t!==void 0&&t.length&&e.addIntervals(e.intervals)}resolve(){const{calendar:e}=this;this.fixCalendarData(e)}}class ja extends Ds{static get $name(){return"Use24hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"on Mon at 0:00",recurrentEndDate:"on Sat at 0:00",isWorking:!0}]}}}}class Aa extends Ds{static get $name(){return"Use8hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"every weekday at 08:00",recurrentEndDate:"every weekday at 12:00",isWorking:!0},{recurrentStartDate:"every weekday at 13:00",recurrentEndDate:"every weekday at 17:00",isWorking:!0}]}}}}var Ss=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const Es=Symbol("CycleSymbol");class bs extends Wn{constructor(){super(...arguments),this.failedResolutionReferences=new Map}}class xa extends rs{constructor(){super(...arguments),this.candidateClass=bs}initialize(e){var t;(t=e.graph.project)!==null&&t!==void 0&&t.delayCalculation&&(e.startProgressNotificationsAfterMs=0,e.emitProgressNotificationsEveryMs=100),super.initialize(e),this.candidate.failedResolutionReferences=new Map(this.baseRevision.failedResolutionReferences)}addIdentifier(e,t,...s){return this.candidate.failedResolutionReferences.size&&(this.candidate.failedResolutionReferences.forEach((i,n)=>{this.write(n,i)}),this.candidate.failedResolutionReferences.clear()),super.addIdentifier(e,t,...s)}}class Fa extends v([as],e=>{const t=e.prototype;class s extends e{constructor(){super(...arguments),this.baseRevision=bs.new(),this.transactionClass=xa,this.autoCommitMode="async",this.onComputationCycle="effect",this.cycleEffectClass=rt,this.silenceInitialCommit=!0,this.ignoreInitialCommitComputationCycles=!1}get dirty(){const n=this.activeTransaction;return n.entries.size>0&&(n.hasVariableEntry||n.hasEntryWithProposedValue)}onPropagationProgressNotification(n){var r,a;this.enableProgressNotifications&&this.project&&((r=(a=this.project).trigger)===null||r===void 0||r.call(a,"progress",n))}async commitAsync(n){if(!this.project||this.project.isDestroyed)return;this.project.trigger("beforeCommit"),this.isInitialCommit&&this.ignoreInitialCommitComputationCycles&&(this._onComputationCycle=this._onComputationCycle||this.onComputationCycle,this.onComputationCycle="ignore");const r=this.project.beforeCommitAsync();return r||t.commitAsync.call(this,n)}get isInitialCommit(){return this.project.isInitialCommit||super.isInitialCommit}set isInitialCommit(n){super.isInitialCommit=n}write(n,r,...a){var o;const c=(o=n.field)===null||o===void 0?void 0:o.name,d=n.self;if(c&&d){var u,h;const f=(u=d.beforeChronoFieldSet)===null||u===void 0?void 0:u.call(d,c,r);t.write.call(this,n,r,...a),(h=d.afterChronoFieldSet)===null||h===void 0||h.call(d,c,r,f)}else t.write.call(this,n,r,...a)}async finalizeCommitAsync(n){const{project:r}=this;if(!r||r.isDestroyed)return;const{entries:a}=n,o=new Set;globalThis.DEBUG&&console.timeEnd("Time to visible");const{isInitialCommit:c,silenceInitialCommit:d}=this,u=c&&d;c&&(r.isInitialCommitPerformed=!0,this.ignoreInitialCommitComputationCycles&&(this.onComputationCycle=this._onComputationCycle)),r.isWritingData=!0,r.hasLoadedDataToCommit=!1,this.enableProgressNotifications&&r.trigger("progress",{total:n.entries.size,remaining:0,phase:"finalizing"}),n.transaction.rejectedWith&&r.trigger("commitRejected",{transactionResult:n,isInitialCommit:c,silenceCommit:u}),r.trigger("refresh",{isInitialCommit:c,isCalculated:!0}),await new Promise(f=>{setTimeout(()=>{if(!r.isDestroyed){if(n.transaction.rejectedWith)r.isWritingData=!1;else{var p,g;(p=r.suspendChangesTracking)===null||p===void 0||p.call(r),globalThis.DEBUG&&console.time("Finalize propagation");const m=new Set;for(const C of a.values()){const U=C.identifier,G=C.getValue(),{field:B}=U;if(C.isShadow()||!U[qn]||G===A||B instanceof nt)continue;const S=U.self,P=S.firstStore;m.has(S)||(S.beginBatch(!0),m.add(S)),P!=null&&P.autoCommit&&!o.has(P)&&(P.suspendAutoCommit(),o.add(P)),S.meta.batchChanges[B.name]=G}let y=!1;for(const C of m)if(!C.triggerBeforeUpdate({...C.meta.batchChanges})){y=!0;break}if(y){for(const C of m)C.cancelBatch();n.transaction.reject(),r.trigger("commitRejected",{transactionResult:n,isInitialCommit:c,silenceCommit:u}),r.trigger("refresh",{isInitialCommit:c,isCalculated:!0})}else for(const C of m)C.ignoreBag=u||r.ignoreRecordChanges,C.generation++,C.endBatch(u,!0,!0),C.ignoreBag=!1;r.ignoreRecordChanges=!1,globalThis.DEBUG&&console.timeEnd("Finalize propagation"),r.isWritingData=!1,y||r.trigger("dataReady",{records:m,isInitialCommit:c}),(g=r.resumeChangesTracking)===null||g===void 0||g.call(r,u),o.forEach(C=>C.resumeAutoCommit()),u&&(r.eventStore.acceptChanges(),r.dependencyStore.acceptChanges(),r.resourceStore.acceptChanges(),r.assignmentStore.acceptChanges(),r.calendarManagerStore.acceptChanges(),r.acceptChanges())}r.trigger("commitFinalized",{isInitialCommit:c,transactionResult:n})}f()},0)})}*onComputationCycleHandler(n){if(this.onComputationCycle==="effect"){const r=this.project.cycleEffectClass.new({cycle:n});(yield r)===ve.Cancel&&(yield Je(r))}else return yield*super.onComputationCycleHandler(n)}onComputationCycleHandlerSync(n,r){if(this.onComputationCycle==="effect")throw this.project.cycleEffectClass.new({cycle:n});return super.onComputationCycleHandlerSync(n,r)}async[Es](n,r){return this.project.onCycleSchedulingIssue(n,r)}async[Cs](n,r){return r.walkContext.startNewEpoch(),this.project.onEmptyCalendarSchedulingIssue(n,r)}async[ms](n,r){return r.walkContext.startNewEpoch(),this.project.onConflictSchedulingIssue(n,r)}[en](n,r){return super[en](n,r)}}return s}){}class ka extends ge(ln){static get $name(){return"RemoveDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.remove()}}class Ba extends ge(de){static get $name(){return"CycleEffectDescription"}static getDescription(e){return Ve(this.L("L{descriptionTpl}"),this.getShortDescription(e))}static getShortDescription(e){const t=e.getEvents().slice();return t.push(t[0]),'"'+t.map(s=>s.name||"#"+s.id).join('" -> "')+'"'}}class rt extends cn{constructor(){super(...arguments),this.handler=Es}getEvents(){if(!this._events){const e=new Set;this.cycle.cycle.forEach(({context:t})=>e.add(t)),this._events=[...e]}return this._events}matchDependencyBySourceAndTargetEvent(e,t,s){return e.fromEvent===t&&e.toEvent===s}getDependencyForSourceAndTargetEvents(e,t){return this.getEvents()[0].project.getDependencyStore().find(r=>this.matchDependencyBySourceAndTargetEvent(r,e,t))}getDependencies(){if(!this._dependencies){const e=new Set,t=this.getEvents(),s=t.length;let i=t[0],n;if(s===1)(n=this.getDependencyForSourceAndTargetEvents(i,i))&&e.add(n);else for(const r of t)for(const a of t)(n=this.getDependencyForSourceAndTargetEvents(r,a))&&e.add(n),(n=this.getDependencyForSourceAndTargetEvents(a,r))&&e.add(n);this._dependencies=[...e]}return this._dependencies}getResolutions(){return this._resolutions||(this._resolutions=[this.removeDependencyCycleEffectResolutionClass.new()]),this._resolutions}}Ss([w("cycle")],rt.prototype,"type",void 0),Ss([w(Ba)],rt.prototype,"_descriptionBuilderClass",void 0),Ss([w(ka)],rt.prototype,"removeDependencyCycleEffectResolutionClass",void 0);var La=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class Yn extends v([At],e=>{e.prototype;class t extends e{}return La([te({bucket:"assigned",resolver:function(s){return this.getEventById(s)},modelFieldConfig:{serialize:s=>s==null?void 0:s.id,isEqual:It,persist:!1}},tt)],t.prototype,"event",void 0),La([te({bucket:"assigned",resolver:function(s){return this.getResourceById(s)},modelFieldConfig:{serialize:s=>s==null?void 0:s.id,isEqual:It,persist:!1}},tt)],t.prototype,"resource",void 0),Qn(t),t}){}class ws extends v([Wo,st],e=>{e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=100}static get defaultConfig(){return{modelClass:Yn}}set data(i){this.allAssignmentsForRemoval=!0,super.data=i,this.allAssignmentsForRemoval=!1}}return t}){}class Ps extends v([zo,st],e=>{e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=500}static get defaultConfig(){return{tree:!0,modelClass:xt}}}return t}){}class Rs extends v([Uo,st],e=>{e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=200}set data(i){this.allDependenciesForRemoval=!0,super.data=i,this.allDependenciesForRemoval=!1}}return t}){}var ne;(function(l){l.KeepDuration="KeepDuration",l.KeepStartDate="KeepStartDate",l.KeepEndDate="KeepEndDate"})(ne||(ne={}));const $=Symbol("StartDate"),I=Symbol("EndDate"),F=Symbol("Duration"),Ie=V.new({output:$,inputs:new Set([F,I])}),Me=V.new({output:I,inputs:new Set([F,$])}),ze=V.new({output:F,inputs:new Set([$,I])}),Ts=Dt.new({variables:new Set([$,I,F]),formulas:new Set([Ie,Me,ze])}),Va=be.new({description:Ts,defaultResolutionFormulas:new Set([Me])}),_a=be.new({description:Ts,defaultResolutionFormulas:new Set([Ie])});class $s extends Yr{addInstruction(e){e===ne.KeepStartDate&&this.addKeepIfPossibleFlag($),e===ne.KeepEndDate&&this.addKeepIfPossibleFlag(I),e===ne.KeepDuration&&this.addKeepIfPossibleFlag(F)}}class Is extends he.mix(Te){equality(e,t){const s=e.resolution,i=t.resolution;return s.get($)===i.get($)&&s.get(I)===i.get(I)&&s.get(F)===i.get(F)||s.get($)===Y&&s.get(I)===Y&&s.get(F)===Y}}var ei=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class ti extends v([At],e=>{class t extends e{writeCalendar(i,n,r,a){const o=this.getCalendarManagerStore(),c=a;a&&o&&a instanceof xt&&!o.includes(c)&&o.add(a),i.constructor.prototype.write.call(this,i,n,r,a)}resolveCalendar(i){var n;return(n=this.getCalendarManagerStore())===null||n===void 0?void 0:n.getById(i)}*calculateEffectiveCalendar(){let i=yield this.$.calendar;return i||(i=yield this.getProject().$.effectiveCalendar),yield i.$.version,i}shouldRecordFieldChange(i,n,r){if(!super.shouldRecordFieldChange(i,n,r))return!1;const{project:a}=this;if(i==="calendar"&&a){const{calendarManagerStore:o}=a;return o.oldIdMap[n]!==o.getById(r)}return!0}}return ei([T({equality:()=>!1})],t.prototype,"effectiveCalendar",void 0),ei([te({modelFieldConfig:{persist:!0,serialize:s=>s===void 0?void 0:(s==null?void 0:s.id)||null,isEqual:It},resolver:function(s){return this.resolveCalendar(s)},sync:!0},tt)],t.prototype,"calendar",void 0),ei([ye("calendar")],t.prototype,"writeCalendar",null),ei([D("effectiveCalendar")],t.prototype,"calculateEffectiveCalendar",null),Qn(t),t}){}class Na extends v([],e=>{class t extends e{constructor(){super(...arguments),this.combinedCalendarsCache=new Map,this.combinationsByCalendar=new Map}combineCalendars(i){const n=Go(i);if(n.length===0)throw new Error("No calendars to combine");n.sort((d,u)=>d.internalId<u.internalId?-1:1);const r=n.map(d=>d.internalId+"/").join(""),a=n.map(d=>d.version+"/").join(""),o=this.combinedCalendarsCache.get(r);let c;return o&&o.versionsHash===a?c=o.cache:(c=new ml({calendarCaches:n.map(d=>d.calendarCache)}),this.combinedCalendarsCache.set(r,{versionsHash:a,cache:c}),n.forEach(d=>{let u=this.combinationsByCalendar.get(d);u||(u=new Set,this.combinationsByCalendar.set(d,u)),u.add(r)})),c}clearCombinationsWith(i){const n=this.combinationsByCalendar.get(i);n&&(n.forEach(r=>this.combinedCalendarsCache.delete(r)),this.combinationsByCalendar.delete(i))}}return t}){}var _=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class at extends v([ti],e=>{e.prototype;class t extends e{*calculateDispatcher(i){yield x;const n=yield*this.prepareDispatcher(i),r=yield Ze(this.$.startDate),a=r?r[0]?ne.KeepDuration:ne.KeepEndDate:void 0;a&&n.addInstruction(a);const o=yield Ze(this.$.endDate),c=o?o[0]?ne.KeepDuration:ne.KeepStartDate:void 0;c&&n.addInstruction(c);const d=yield this.$.effectiveDirection,u=yield Ze(this.$.duration);let h;if(u)switch(u[0]){case!0:h=ne.KeepStartDate;break;case!1:h=ne.KeepEndDate;break}return!h&&n.hasProposedValue(F)&&(h=d.direction===k.Forward||d.direction===k.None?ne.KeepStartDate:ne.KeepEndDate),h&&n.addInstruction(h),n}*prepareDispatcher(i){const r=this.dispatcherClass(i).new({context:this.cycleResolutionContext(i)});return r.collectInfo(i,this.$.startDate,$),r.collectInfo(i,this.$.endDate,I),r.collectInfo(i,this.$.duration,F),r}cycleResolutionContext(i){const n=i(this.$.effectiveDirection);return n.direction===k.Forward||n.direction===k.None?Va:_a}dispatcherClass(i){return $s}buildProposedDispatcher(i,n,r){const a=this.dispatcherClass(r.onEffectSync).new({context:this.cycleResolutionContext(r.onEffectSync)});return a.addPreviousValueFlag($),a.addPreviousValueFlag(I),a.addPreviousValueFlag(F),a}*skipNonWorkingTime(i,n){const r=yield this.$.effectiveCalendar;if(!i)return null;const a=r.skipNonWorkingTime(i,n);if(a instanceof Date)return a;{const o=un.new({calendars:[r],event:this,date:i,isForward:n});if((yield o)===ve.Cancel)yield Je(o);else return null}}*skipWorkingTime(i,n,r,a){const o=yield this.$.durationUnit;return a&&a!==o&&(r=yield*this.getProject().$convertDuration(r,a,o)),yield*this.calculateProjectedXDateWithDuration(i,n,r)}setStartDate(i,n=!0){const{graph:r,project:a}=this;return r?(r.write(this.$.startDate,i,n),r.commitAsync()):(this.$.startDate.DATA=i,a==null?void 0:a.delayedCalculationPromise)}writeStartDate(i,n,r,a,o=!0){!n.baseRevision.hasIdentifier(i)&&a==null||(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,n,void 0,a==null),i.constructor.prototype.write.call(this,i,n,r,a,o))}*calculateStartDate(){const n=(yield this.$.dispatcher).resolution.get($);if(n===Y)return yield*this.calculateStartDateProposed();if(n===Ie.formulaId)return yield*this.calculateStartDatePure();throw new Error("Unknown formula for `startDate`")}*calculateStartDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.endDate,!1,yield this.$.duration)}*calculateStartDateProposed(){const i=this.getProject(),n=yield x;return!(yield this.$.manuallyScheduled)||i.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(n,!0):n}*calculateProjectedXDateWithDuration(i,n,r){const a=yield this.$.durationUnit,o=yield this.$.effectiveCalendar,c=this.getProject();return!i||Ho(r)?null:(n=n===void 0?!0:n,n?o.calculateEndDate(i,yield*c.$convertDuration(r,a,R.Millisecond)):o.calculateStartDate(i,yield*c.$convertDuration(r,a,R.Millisecond)))}setEndDate(i,n=!1){const{graph:r,project:a}=this;return r?(r.write(this.$.endDate,i,n),r.commitAsync()):(this.$.endDate.DATA=i,a==null?void 0:a.delayedCalculationPromise)}writeEndDate(i,n,r,a,o=!1){!n.baseRevision.hasIdentifier(i)&&a==null||(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,n,void 0,a==null),i.constructor.prototype.write.call(this,i,n,r,a,o))}*calculateEndDate(){const n=(yield this.$.dispatcher).resolution.get(I);if(n===Y)return yield*this.calculateEndDateProposed();if(n===Me.formulaId)return yield*this.calculateEndDatePure();throw new Error("Unknown formula for `endDate`")}*calculateEndDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.startDate,!0,yield this.$.duration)}*calculateEndDateProposed(){const i=this.getProject(),n=yield x;return!(yield this.$.manuallyScheduled)||i.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(n,!1):n}getDuration(i){const n=this.duration;return i!==void 0?this.getProject().convertDuration(n,this.durationUnit,i):n}setDuration(i,n,r){const{graph:a,project:o}=this;if(a){if(i!==void 0)return a.write(this.$.duration,i,n,r),a.commitAsync()}else{const c={duration:i};return this.$.duration.DATA=i,n!=null&&(c.durationUnit=this.$.durationUnit.DATA=n),this.set(c),o==null?void 0:o.delayedCalculationPromise}}setDurationUnit(i){throw new Error("Use `setDuration` instead")}writeDuration(i,n,r,a,o,c=void 0){a<0&&(a=0),!(!n.baseRevision.hasIdentifier(i)&&a==null)&&(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,n,void 0,a==null),i.constructor.prototype.write.call(this,i,n,r,a,c),o!=null&&n.write(this.$.durationUnit,o))}*calculateDuration(){const n=(yield this.$.dispatcher).resolution.get(F);if(n===Y)return yield*this.calculateDurationProposed();if(n===ze.formulaId)return yield*this.calculateDurationPure();throw new Error("Unknown formula for `duration`")}*calculateDurationPure(){const i=yield this.$.startDate,n=yield this.$.endDate;if(!i||!n)return null;if(i>n)yield Nr(this.$.duration,0,null);else return yield*this.calculateProjectedDuration(i,n)}*calculateDurationProposed(){return yield x}*calculateProjectedDuration(i,n,r){if(!i||!n)return null;r||(r=yield this.$.durationUnit);const a=yield this.$.effectiveCalendar;return yield*this.getProject().$convertDuration(a.calculateDurationMs(i,n),R.Millisecond,r)}*calculateEffectiveDuration(){const i=yield this.$.dispatcher;let n;const r=i.resolution.get(F);return r===Y?n=yield this.$.duration:r===ze.formulaId&&(n=yield*this.calculateProjectedDuration(yield N(this.$.startDate),yield N(this.$.endDate))),n}*calculateEffectiveDirection(){return{kind:"own",direction:(yield this.$.direction)||k.Forward}}*calculateStartDateDirection(){return yield this.$.effectiveDirection}*calculateEndDateDirection(){return yield this.$.effectiveDirection}*calculateEffectiveCalendar(){const i=yield this.$.manuallyScheduled,n=this.getProject();return i&&!n.skipNonWorkingTimeInDurationWhenSchedulingManually?n.defaultCalendar:yield*super.calculateEffectiveCalendar()}}return _([E({type:"date"},{converter:it})],t.prototype,"startDate",void 0),_([E({type:"date"},{converter:it})],t.prototype,"endDate",void 0),_([E({type:"number",allowNull:!0})],t.prototype,"duration",void 0),_([E({type:"string",defaultValue:R.Day},{converter:s=>O.normalizeUnit(s)||R.Day})],t.prototype,"durationUnit",void 0),_([E({type:"string"},{sync:!0})],t.prototype,"direction",void 0),_([T({sync:!0,equality:jn})],t.prototype,"startDateDirection",void 0),_([T({sync:!0,equality:jn})],t.prototype,"endDateDirection",void 0),_([E({persist:!1,isEqual:jn},{sync:!0,equality:jn})],t.prototype,"effectiveDirection",void 0),_([T({identifierCls:Is})],t.prototype,"dispatcher",void 0),_([E({type:"boolean",defaultValue:!1},{sync:!0})],t.prototype,"manuallyScheduled",void 0),_([E({type:"boolean",defaultValue:!1})],t.prototype,"unscheduled",void 0),_([D("dispatcher")],t.prototype,"calculateDispatcher",null),_([ha("dispatcher")],t.prototype,"buildProposedDispatcher",null),_([ye("startDate")],t.prototype,"writeStartDate",null),_([D("startDate")],t.prototype,"calculateStartDate",null),_([ye("endDate")],t.prototype,"writeEndDate",null),_([D("endDate")],t.prototype,"calculateEndDate",null),_([ye("duration")],t.prototype,"writeDuration",null),_([D("duration")],t.prototype,"calculateDuration",null),_([D("effectiveDirection")],t.prototype,"calculateEffectiveDirection",null),_([D("startDateDirection")],t.prototype,"calculateStartDateDirection",null),_([D("endDateDirection")],t.prototype,"calculateEndDateDirection",null),t}){}var ql=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class Ms extends v([at,qo],e=>{e.prototype;class t extends e{get assignments(){return this.assigned?[...this.assigned]:[]}}return ql([te({},nt)],t.prototype,"assigned",void 0),t}){}var Wa=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class Os extends v([at],e=>{const t=e.prototype;class s extends e{leaveProject(){var n,r;if(this.isInActiveTransaction){const a=this.graph.activeTransaction,o=this.getDependencyStore(),c=[];for(const d of(n=a.readCurrentOrProposedOrPrevious(this.$.outgoingDeps))!=null?n:[])o.includes(d)&&c.push(d);for(const d of(r=a.readCurrentOrProposedOrPrevious(this.$.incomingDeps))!=null?r:[])o.includes(d)&&c.push(d);this.project.dependencyStore.remove(c)}t.leaveProject.call(this)}}return Wa([te({},nt)],s.prototype,"outgoingDeps",void 0),Wa([te({},nt)],s.prototype,"incomingDeps",void 0),s}){}class ni extends v([at,Ms,Os],e=>{e.prototype;class t extends e{}return t}){}class ii extends v([Ko,st],e=>{class t extends e{constructor(){super(...arguments),this.removalOrder=400}static get defaultConfig(){return{modelClass:ni}}buildRootNode(){return this.getProject()||{}}set data(i){super.data=i,this.afterEventRemoval()}}return t}){}class Kl extends v([ii],e=>{class t extends e{static get defaultConfig(){return{tree:!0}}}return t}){}var Ql=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class si extends v([ti,At],e=>{const t=e.prototype;class s extends e{get assignments(){return[...this.assigned]}leaveProject(n=!1){if(!this.isStmRestoring&&this.assigned&&!n){const r=this.getResourceStore();this.assigned.forEach(a=>r.assignmentsForRemoval.add(a))}t.leaveProject.call(this)}static get fields(){return[{name:"parentId"},{name:"children",persist:!1}]}}return Ql([te({},nt)],s.prototype,"assigned",void 0),s}){}class js extends v([Qo,st],e=>{e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=300}static get defaultConfig(){return{modelClass:si}}}return t}){}var hn=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class za extends v([Xn],e=>{e.prototype;class t extends e{*calculateUnitsInMs(){const i=yield this.$.hoursPerDay,n=yield this.$.daysPerWeek,r=yield this.$.daysPerMonth;return{millisecond:1,second:1e3,minute:60*1e3,hour:60*60*1e3,day:i*60*60*1e3,week:n*i*60*60*1e3,month:r*i*60*60*1e3,quarter:3*r*i*60*60*1e3,year:4*3*r*i*60*60*1e3}}convertDuration(i,n,r){let a=i;return n!==r&&(a=i*this.unitsInMs[n]/this.unitsInMs[r]),a}*$convertDuration(i,n,r){if(!n||!r)throw new Error("Conversion unit not provided");const a=yield this.$.unitsInMs;let o=i;return n!==r&&(o=i*a[n]/a[r]),o}}return hn([T()],t.prototype,"unitsInMs",void 0),hn([E({type:"number",defaultValue:24})],t.prototype,"hoursPerDay",void 0),hn([E({type:"number",defaultValue:7})],t.prototype,"daysPerWeek",void 0),hn([E({type:"number",defaultValue:30})],t.prototype,"daysPerMonth",void 0),hn([D("unitsInMs")],t.prototype,"calculateUnitsInMs",null),t}){}var fn=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class As extends v([At],e=>{e.prototype;class t extends e{get isValid(){const{$:i,graph:n}=this;return n&&(!n.hasIdentifier(i.fromEvent)||!n.hasIdentifier(i.toEvent))?!1:super.isValid}}return fn([te({bucket:"outgoingDeps",resolver:function(s){return this.getEventById(s)},modelFieldConfig:{persist:!0,serialize:s=>s==null?void 0:s.id,isEqual:It}},tt)],t.prototype,"fromEvent",void 0),fn([te({bucket:"incomingDeps",resolver:function(s){return this.getEventById(s)},modelFieldConfig:{persist:!0,serialize:s=>s==null?void 0:s.id,isEqual:It}},tt)],t.prototype,"toEvent",void 0),fn([E({type:"int",defaultValue:Qe.EndToStart})],t.prototype,"type",void 0),fn([E({type:"string"})],t.prototype,"fromSide",void 0),fn([E({type:"string"})],t.prototype,"toSide",void 0),t}){}class Ua extends v([Xn,Xo],e=>{e.prototype;class t extends e{get isDelayingCalculation(){return!!(this.delayEnteringReplica||this.delayedCalculationPromise)}getGraph(){return this.replica}beforeCommitAsync(){return null}enterReplica(i){}acceptChanges(){}async commitAsync(){var i;return this.delayedCalculationPromise||((i=this.replica)===null||i===void 0?void 0:i.commitAsync())}getSchedulingIssueEventArguments(i,n,r,a){const o=[i.type,{continueWithResolutionResult:r,schedulingIssue:i}];return i instanceof Ot&&(o[1].conflict=i),o}async onSchedulingIssueCall(i,n){return i.type&&this.hasListener(i.type)?new Promise((r,a)=>{this.trigger(...this.getSchedulingIssueEventArguments(i,n,r,a))}):ve.Cancel}async onCycleSchedulingIssue(i,n){return this.onSchedulingIssueCall(i,n)}async onEmptyCalendarSchedulingIssue(i,n){return this.onSchedulingIssueCall(i,n)}async onConflictSchedulingIssue(i,n){return this.onSchedulingIssueCall(i,n)}setModelCalculations(i,n){if(!n)return;const r={};for(const a in n)r[a]=i.prototype.$calculations[a];return Object.assign(i.prototype.$calculations,n),r}setRecordCalculations(i,n){const r=this.setModelCalculations(i.constructor,n),a=i.$entity.$skeleton;return Object.keys(n).forEach(o=>{a[o].prototype.calculation=i[n[o]]}),r}setStoreCalculations(i,n){if(!n)return;const r=i.first;return r?this.setRecordCalculations(r,n):this.setModelCalculations(i.modelClass,n)}async setCalculations(i){this.replica&&await this.commitAsync();const n={},r={tasks:this.eventStore,events:this.eventStore,dependencies:this.dependencyStore,resources:this.resourceStore,assignments:this.assignmentStore,calendars:this.calendarManagerStore};Object.keys(r).forEach(o=>{i[o]&&(n[o]=this.setStoreCalculations(r[o],i[o]))});let a=i.project;return a&&(n.project=this.setRecordCalculations(this,a)),this.replica&&this.repopulateReplica.now(),this.replica&&await this.commitAsync(),n}}return t}){}class ri extends v([at],e=>{const t=e.prototype;class s extends e{static get $name(){return"HasSubEventsMixin"}*hasSubEvents(){throw new Error("Abstract method `hasSubEvents` has been called")}*subEventsIterable(){throw new Error("Abstract method `subEventsIterable` has been called")}*calculateStartDatePure(){const n=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!n&&r?yield*this.calculateMinChildrenStartDate():yield*t.calculateStartDatePure.call(this)}*calculateEndDatePure(){const n=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!n&&r?yield*this.calculateMaxChildrenEndDate():yield*t.calculateEndDatePure.call(this)}*calculateStartDateProposed(){const n=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!n&&r?yield*this.calculateStartDatePure():yield*t.calculateStartDateProposed.call(this)}*calculateEndDateProposed(){const n=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!n&&r?yield*this.calculateEndDatePure():yield*t.calculateEndDateProposed.call(this)}*calculateDurationProposed(){const n=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!n&&r?yield*this.calculateDurationPure():yield*t.calculateDurationProposed.call(this)}*shouldRollupChildStartDate(n){return!0}*calculateMinChildrenStartDate(){const n=yield*this.subEventsIterable();let r=le.getTime();for(const a of n)if(yield*this.shouldRollupChildStartDate(a)){let o=yield a.$.startDate;if(o||(o=yield a.$.endDate),(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())){const c=yield*a.calculateMinChildrenStartDate();(!o||c&&c.getTime()<o.getTime())&&(o=c)}o&&o.getTime()<r&&(r=o.getTime())}return r===De.getTime()||r===le.getTime()?null:new Date(r)}*shouldRollupChildEndDate(n){return!0}*calculateMaxChildrenEndDate(){const n=yield*this.subEventsIterable();let r=De.getTime();for(const a of n)if(yield*this.shouldRollupChildEndDate(a)){let o=yield a.$.endDate;if(o||(o=yield a.$.startDate),(yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())){const c=yield*a.calculateMaxChildrenEndDate();(!o||c&&c.getTime()>o.getTime())&&(o=c)}o&&o.getTime()>r&&(r=o.getTime())}return r===De.getTime()||r===le.getTime()?null:new Date(r)}}return s}){}var Ga=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class Ft extends v([ri],e=>{e.prototype;class t extends e{*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}get parent(){return this._parent}set parent(i){this._parent=i,this.parentEvent=i}*calculateEffectiveDirection(){const i=yield this.$.direction;if(i)return{kind:"own",direction:i};const n=yield this.$.parentEvent;if(n){const r=yield n.$.effectiveDirection;return{kind:"inherited",direction:r.direction,inheritedFrom:r.kind==="own"?n:r.kind==="inherited"?r.inheritedFrom:n}}else return yield*super.calculateEffectiveDirection()}*calculateStartDateDirection(){const i=yield this.getProject().$.effectiveDirection;let n=null;if(!(yield this.$.manuallyScheduled)){const r=yield*this.subEventsIterable();for(const a of r){const o=yield a.$.startDateDirection;if(i.direction!==o.direction){n={kind:"enforced",direction:o.direction,enforcedBy:o.kind==="own"?a:o.kind==="enforced"?o.enforcedBy:o.inheritedFrom};break}}}return n!=null?n:yield*super.calculateStartDateDirection()}*calculateEndDateDirection(){const i=yield this.getProject().$.effectiveDirection;let n=null;if(!(yield this.$.manuallyScheduled)){const r=yield*this.subEventsIterable();for(const a of r){const o=yield a.$.startDateDirection;if(i.direction!==o.direction){n={kind:"enforced",direction:o.direction,enforcedBy:o.kind==="own"?a:o.kind==="enforced"?o.enforcedBy:o.inheritedFrom};break}}}return n!=null?n:yield*super.calculateStartDateDirection()}}return Ga([pa({bucket:"childEvents"})],t.prototype,"parentEvent",void 0),Ga([ya()],t.prototype,"childEvents",void 0),t}){}class Ha{constructor(){this.ongoing=Promise.resolve(),this.handleReject=()=>{}}queue(e,t=this.handleReject){const s=this.ongoing.then(e);return this.ongoing=s.catch(t),s}}Ha._$name="Queue";var ai=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class qa extends Tr([Ua,at,ri,ti,za,Na],e=>{const t=e.prototype;class s extends e{construct(n={}){this.delayCalculation=n.delayCalculation!==!1,this.enableProgressNotifications=n.enableProgressNotifications||n.delayCalculation!==!1,this._queue=new Ha,"expanded"in n||(n.expanded=!0),this.delayCalculation&&(this.delayEnteringReplica=!0),"skipNonWorkingTimeWhenSchedulingManually"in n||(n.skipNonWorkingTimeWhenSchedulingManually=!1),t.construct.call(this,n),this.repopulateStores=new Set,this.ignoreInitialCommitComputationCycles="ignoreInitialCommitComputationCycles"in n?n.ignoreInitialCommitComputationCycles:!1,this.ignoreInitialCommitComputationCycles&&console.warn('Project "ignoreInitialCommitComputationCycles" option is deprecated and will be dropped in the next major release'),this.eventModelClass||(this.eventModelClass=this.getDefaultEventModelClass()),this.eventStoreClass||(this.eventStoreClass=this.getDefaultEventStoreClass()),this.dependencyModelClass||(this.dependencyModelClass=this.getDefaultDependencyModelClass()),this.dependencyStoreClass||(this.dependencyStoreClass=this.getDefaultDependencyStoreClass()),this.resourceModelClass||(this.resourceModelClass=this.getDefaultResourceModelClass()),this.resourceStoreClass||(this.resourceStoreClass=this.getDefaultResourceStoreClass()),this.assignmentModelClass||(this.assignmentModelClass=this.getDefaultAssignmentModelClass()),this.assignmentStoreClass||(this.assignmentStoreClass=this.getDefaultAssignmentStoreClass()),this.calendarModelClass||(this.calendarModelClass=this.getDefaultCalendarModelClass()),this.calendarManagerStoreClass||(this.calendarManagerStoreClass=this.getDefaultCalendarManagerStoreClass()),this.cycleEffectClass||(this.cycleEffectClass=this.getDefaultCycleEffectClass()),this.initializeStm(),this.defaultCalendar=new this.calendarModelClass({unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this,this.delayEnteringReplica||this.enterReplica(!1),this.setCalendarManagerStore(this.calendarManagerStore),this.setEventStore(this.eventStore),this.setDependencyStore(this.dependencyStore),this.setResourceStore(this.resourceStore),this.setAssignmentStore(this.assignmentStore),!!(this.calendarsData||this.eventsData||this.dependenciesData||this.resourcesData||this.assignmentsData)?(this.loadInlineData({calendarsData:this.calendarsData,eventsData:this.eventsData,dependenciesData:this.dependenciesData,resourcesData:this.resourcesData,assignmentsData:this.assignmentsData}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData):this.delayCalculation&&this.hasDataInStores&&this.scheduleDelayedCalculation()}get hasDataInStores(){return[this.calendarManagerStore,this.eventStore,this.dependencyStore,this.resourceStore,this.assignmentStore].some(n=>n.allCount>0)}enterReplica(n){const r=this;r.replica||(r.replica=r.createReplica(),r.replica.addEntity(r),r.replica.addEntity(r.defaultCalendar),r.trigger("graphReady")),n&&!r.isRepopulatingStores&&(r.calendarManagerStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),r.eventStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),r.resourceStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),r.dependencyStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),r.assignmentStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}))}resetStmQueue(){const n=this.stm.disabled;this.stm.disable(),this.stm.resetQueue(),n||this.stm.enable()}doDestroy(){var n,r,a,o,c,d,u,h;const f=this;(n=f.eventStore)===null||n===void 0||n.destroy(),(r=f.dependencyStore)===null||r===void 0||r.destroy(),(a=f.assignmentStore)===null||a===void 0||a.destroy(),(o=f.resourceStore)===null||o===void 0||o.destroy(),(c=f.calendarManagerStore)===null||c===void 0||c.destroy(),(d=f.defaultCalendar)===null||d===void 0||d.destroy(),(u=f.replica)===null||u===void 0||u.clear(),(h=f.stm)===null||h===void 0||h.destroy(),t.doDestroy.call(this)}getReplicaConfig(){return{project:this,schema:Sa.new(),enableProgressNotifications:this.enableProgressNotifications,silenceInitialCommit:this.silenceInitialCommit,ignoreInitialCommitComputationCycles:this.ignoreInitialCommitComputationCycles,cycleEffectClass:this.cycleEffectClass,onWriteDuringCommit:"ignore",readMode:xe.CurrentOrProposedOrPrevious}}createReplica(){return Fa.mix(as).new(this.getReplicaConfig())}*hasSubEvents(){return this.getEventStore().count>0}*subEventsIterable(){return this.getEventStore().getRange()}getType(){return qt.SchedulerBasic}get enableProgressNotifications(){return this._enableProgressNotifications}set enableProgressNotifications(n){this._enableProgressNotifications=n,this.replica&&(this.replica.enableProgressNotifications=n)}getDefaultCycleEffectClass(){return rt}getDefaultEventModelClass(){return ni}getDefaultEventStoreClass(){return ii}getDefaultDependencyModelClass(){return As}getDefaultDependencyStoreClass(){return Rs}getDefaultResourceModelClass(){return si}getDefaultResourceStoreClass(){return js}getDefaultAssignmentModelClass(){return Yn}getDefaultAssignmentStoreClass(){return ws}getDefaultCalendarModelClass(){return xt}getDefaultCalendarManagerStoreClass(){return Ps}usingSyncDataOnLoad(){return[this.eventStore,this.resourceStore,this.dependencyStore,this.assignmentStore].some(n=>n.syncDataOnLoad)}async loadInlineData(n){const{calendarManagerStore:r,eventStore:a,dependencyStore:o,assignmentStore:c,resourceStore:d,replica:u}=this;if(!this.isInitialCommitPerformed)u==null||u.unScheduleAutoCommit();else for(;this.replica.isCommitting;)await this.commitAsync();u!=null&&u.enableProgressNotifications&&!this.delayCalculation&&(await Zt(0),await this.commitAsync(),u.onPropagationProgressNotification({total:0,remaining:0,phase:"storePopulation"}),await Zt(50)),this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!0,globalThis.DEBUG&&(console.log("%cInitializing project","font-weight:bold;color:darkgreen;text-transform:uppercase;margin-top: 2em"),console.time("Time to visible"),console.time("Populating project")),this.delayCalculation&&!this.delayedCalculationPromise&&!this.usingSyncDataOnLoad()&&this.scheduleDelayedCalculation(),n.calendarsData&&(this.repopulateStore(r),r.data=n.calendarsData),(n.eventsData||n.tasksData)&&(this.repopulateStore(a),a.data=n.eventsData||n.tasksData),n.dependenciesData&&(this.repopulateStore(o),o.data=n.dependenciesData),n.resourcesData&&(this.repopulateStore(d),d.data=n.resourcesData),n.assignmentsData&&(this.repopulateStore(c),c.data=n.assignmentsData),n.project&&this.applyProjectResponse(n.project),globalThis.DEBUG&&console.timeEnd("Populating project");const h=await this.commitLoad();return this.isLoadingInlineData=!1,h}setupTemporaryIndices(){const{storage:n}=this.assignmentStore||{};n&&(n.addIndex({property:"event",unique:!1}),n.addIndex({property:"resource",unique:!1}))}removeTemporaryIndices(){const{storage:n}=this.assignmentStore;n.removeIndex("event"),n.removeIndex("resource")}async internalDelayCalculation(n){const r=this;if(r.delayEnteringReplica=!0,r.setupTemporaryIndices(),await Zt(0),r.isDestroyed){n();return}if(r.trigger("delayCalculationStart"),r.trigger("refresh",{isCalculated:!1}),await Zt(0),r.isDestroyed){n();return}r.delayEnteringReplica=!1,r.isRepopulatingStores?r.repopulateReplica.now():(r.trigger("recordsUnlinked"),r.enterReplica(!0));const a=await r.replica.commitAsync();if(r.isDestroyed){n();return}n(a),r.delayedCalculationPromise=null,r.trigger("delayCalculationEnd"),r.removeTemporaryIndices()}scheduleDelayedCalculation(){if(this.delayedCalculationPromise)return this.delayedCalculationPromise;if(this.delayCalculation!==!1)return this.delayedCalculationPromise=new Promise(n=>this.internalDelayCalculation(n).then())}async commitLoad(){const n=await this.commitAsync();return this.isDestroyed||this.trigger("load"),n}initializeStm(){const n=this.stmClass||ji;this.stm instanceof ji||this.setStm(n.new({disabled:!0},this.stm)),this.resetUndoRedoQueuesAfterLoad&&this.ion({load:this.resetStmQueue,thisObj:this}),this.ion({beforeCommit:this.onCommitInitialization,commitFinalized:this.onCommitFinalization,commitRejected:this.onCommitRejection,thisObj:this})}removeRejectedRecordsAdd({transactionResult:n,silenceCommit:r}){var a,o;const c=new Map;for(const h of n.entries.values()){var d;const f=h.identifier,{field:p}=f;if(h.isShadow()||!f[qn]||p instanceof nt)continue;const g=f.self,m=g.firstStore;m&&!h.previous&&!((d=n.transaction.getLatestStableEntryFor(g.$$))!==null&&d!==void 0&&d.previous)&&(c.has(m)?c.get(m).has(g)||c.get(m).add(g):c.set(m,new Set([g])))}(a=this.suspendChangesTracking)===null||a===void 0||a.call(this),Array.from(c.keys()).sort((h,f)=>h.removalOrder-f.removalOrder).forEach(h=>h.remove(c.get(h))),(o=this.resumeChangesTracking)===null||o===void 0||o.call(this,r),r&&(this.eventStore.acceptChanges(),this.dependencyStore.acceptChanges(),this.resourceStore.acceptChanges(),this.assignmentStore.acceptChanges(),this.calendarManagerStore.acceptChanges())}onCommitRejection(n){this._stmDisabled?(this.replica.isWritingPreviousData=!0,this.isRestoringData=!0,this.removeRejectedRecordsAdd(n),this.isRestoringData=!1,this.replica.isWritingPreviousData=!1):this.rejectStmTransaction()}onCommitInitialization(){const{stm:n}=this;this._stmDisabled=n.disabled,n.isRecording&&n.autoRecord&&(this._stmAutoRecord=!0,n.autoRecord=!1)}onCommitFinalization(){this._stmAutoRecord&&(this.stm.autoRecord=!0,this._stmAutoRecord=!1)}onSTMRestoringStart({source:n}){this.replica&&(this.replica.isWritingPreviousData=!0)}async onSTMRestoringStop({source:n}){this.replica&&(this.replica.isWritingPreviousData=!1);const r=n;r.disable(),await this.commitAsync(),this.isDestroyed||(r.enable(),this.trigger("stateRestoringDone"))}deferUntilRepopulationIfNeeded(n,r,a){this.isRepopulatingStores?(this.detachListeners(n),this.ion({name:n,repopulateReplica:{fn:async()=>{await this.commitAsync(),this.isDestroyed||r(...a)},once:!0}})):r(...a)}get isRepopulatingStores(){var n;return!!(!((n=this.repopulateStores)===null||n===void 0)&&n.size)}repopulateStore(n){const r=this;if(r.repopulateOnDataset&&n.allCount&&!n.syncDataOnLoad){var a;(a=r.replica)===null||a===void 0||a.activeTransaction.stop(),r.repopulateStores||(r.repopulateStores=new Set),r.repopulateStores.add(n),r.repopulateReplica()}}repopulateReplica(){const n=this;if(n.delayEnteringReplica)return;const{calendarManagerStore:r,eventStore:a,dependencyStore:o,assignmentStore:c,resourceStore:d,replica:u}=n;u?(n.unlinkStoreRecords(r,a,o,d,c),n.unlinkRecord(n),n.unlinkRecord(n.defaultCalendar),n.trigger("recordsUnlinked"),u.clear()):n.trigger("recordsUnlinked");const h=n.replica=n.createReplica();h.addEntity(n),h.addEntity(n.defaultCalendar),n.joinStoreRecords(r,!0),n.joinStoreRecords(a,!0),n.joinStoreRecords(o,!0),n.joinStoreRecords(d,!0),n.joinStoreRecords(c,!0),n.repopulateStores.clear(),n.trigger("repopulateReplica")}beforeCommitAsync(){return this.repopulateReplica.isPending&&!this.isDelayingCalculation?(this.repopulateReplica.now(),this.replica.commitAsync()):null}unlinkRecord(n){var a;if(n!=null&&n.graph){const{activeTransaction:o}=this.replica,{$:c}=n,d=Object.keys(c);for(let u=0;u<d.length;u++){const h=d[u],f=c[h],p=o.getLatestEntryFor(f);if(p){let g=p.getValue();if(g===void 0&&(g=p.proposedValue),g!==void 0){var r;f.DATA=f.field instanceof tt&&(a=(r=g)===null||r===void 0?void 0:r.id)!=null?a:g}}}n.graph=null}}unlinkStoreRecords(...n){n.forEach(r=>{(!this.repopulateStores.has(r)||r.syncDataOnLoad)&&r.traverse(a=>{this.unlinkRecord(a)},!1,!1,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})})}getGraph(){return this.replica}async addEvents(n){return this.eventStore.add(n),this.commitAsync()}async addEvent(n){return this.eventStore.add(n),this.commitAsync()}includeEvent(n){this.eventStore.add(n)}async removeEvents(n){return this.eventStore.remove(n),this.commitAsync()}excludeEvent(n){this.eventStore.remove(n)}async removeEvent(n){return this.eventStore.remove(n),this.commitAsync()}getStm(){return this.stm}setStm(n){this.stm=n,this.stm.ion({restoringStart:this.onSTMRestoringStart,restoringStop:this.onSTMRestoringStop,thisObj:this})}calculateProject(){return this}*calculateEffectiveCalendar(){let n=yield this.$.calendar;return n?yield n.$.version:n=this.defaultCalendar,n}joinStoreRecords(n,r=!1){const a=o=>{o.setProject(this),o.joinProject()};n.rootNode?n.rootNode.traverse(a,r,!0):n.forEach(a,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}unjoinStoreRecords(n){const r=a=>{a.leaveProject(),a.setProject(this)};n.rootNode?n.rootNode.traverse(a=>{a!==n.rootNode&&r(a)},!1,!0):n.forEach(r,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}setEventStore(n){const r=this.eventStore;if(r&&this.stm.hasStore(r)){this.stm.removeStore(r),this.unjoinStoreRecords(r),this.detachStore(r);const a=r.assignmentsForRemoval;a.forEach(o=>{const c=o.event;if(c){const d=n.getById(c.id);d&&(o.event=d,a.delete(o))}}),r.afterEventRemoval()}if(!n||!(n instanceof _e)){const a=(n==null?void 0:n.storeClass)||this.eventStoreClass;this.eventStore=new a(H.assign({modelClass:this.eventModelClass,project:this,stm:this.stm},n||{}))}else this.eventStore=n,n.setProject(this),this.stm.addStore(n),n.tree&&n.rootNode!==this?(this.appendChild(n.rootNode.children||[]),n.rootNode=this):this.joinStoreRecords(n);this.attachStore(this.eventStore),this.trigger("eventStoreChange",{store:this.eventStore})}setDependencyStore(n){const r=this.dependencyStore;if(r&&this.stm.hasStore(r)&&(this.stm.removeStore(r),this.detachStore(r)),!n||!(n instanceof _e)){const a=(n==null?void 0:n.storeClass)||this.dependencyStoreClass;this.dependencyStore=new a(H.assign({modelClass:this.dependencyModelClass,project:this,stm:this.stm},n||{}))}else this.dependencyStore=n,n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n);this.attachStore(this.dependencyStore),this.trigger("dependencyStoreChange",{store:this.dependencyStore})}setResourceStore(n){const r=this.resourceStore;if(r&&this.stm.hasStore(r)){this.stm.removeStore(r),this.unjoinStoreRecords(r),this.detachStore(r);const a=r.assignmentsForRemoval;a.forEach(o=>{const c=o.resource;if(c){const d=n.getById(c.id);d&&(o.resource=d,a.delete(o))}}),r.afterResourceRemoval()}if(!n||!(n instanceof _e)){const a=(n==null?void 0:n.storeClass)||this.resourceStoreClass;this.resourceStore=new a(H.assign({modelClass:this.resourceModelClass,project:this,stm:this.stm},n||{}))}else this.resourceStore=n,n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n);this.attachStore(this.resourceStore),this.trigger("resourceStoreChange",{store:this.resourceStore})}setAssignmentStore(n){const r=this.assignmentStore;if(r&&this.stm.hasStore(r)&&(this.stm.removeStore(r),this.unjoinStoreRecords(r),this.detachStore(r)),!n||!(n instanceof _e)){const a=(n==null?void 0:n.storeClass)||this.assignmentStoreClass;this.assignmentStore=new a(H.assign({modelClass:this.assignmentModelClass,project:this,stm:this.stm},n||{}))}else this.assignmentStore=n,n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n);this.isDelayingCalculation&&this.setupTemporaryIndices(),this.attachStore(this.assignmentStore),this.trigger("assignmentStoreChange",{store:this.assignmentStore})}setCalendarManagerStore(n){const r=this.calendarManagerStore;if(r&&this.stm.hasStore(r)&&(this.stm.removeStore(r),this.detachStore(r)),!n||!(n instanceof _e)){const a=(n==null?void 0:n.storeClass)||this.calendarManagerStoreClass;this.calendarManagerStore=new a(H.assign({modelClass:this.calendarModelClass,project:this,stm:this.stm},n||{}))}else this.calendarManagerStore=n,n&&(n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n));this.attachStore(this.calendarManagerStore),this.trigger("calendarManagerStoreChange",{store:this.calendarManagerStore})}async isValidDependency(...n){return!0}rejectStmTransaction(n){n=n||this.stm,n.transaction&&(n.transaction.length?(n.forEachStore(r=>r.beginBatch()),n.rejectTransaction(),n.forEachStore(r=>r.endBatch())):n.stopTransaction())}async tryPropagateWithChanges(n){const r=this.stm,a=r.disabled,o=r.autoRecord;return this.queue(async()=>{a?r.enable():(o&&(r.autoRecord=!1),r.isRecording&&r.stopTransaction()),r.startTransaction(),n();let c=!0;try{c=!(await this.commitAsync()).rejectedWith}catch(d){if(!/cycle/i.test(d))throw d;c=!1}return c?(r.stopTransaction(),a&&r.resetQueue()):(this.replica.reject(),this.rejectStmTransaction(r)),r.disabled=a,r.autoRecord=o,c})}queue(n,r){return this._queue.queue(function(){return n()},r)}isEngineReady(){const{replica:n}=this;return this.delayEnteringReplica||!this.isRepopulatingStores&&(n?!(n.dirty&&(n.hasPendingAutoCommit()||n.isCommitting)):!0)}static get defaultConfig(){return{assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null,eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null,calendarManagerStore:null,eventModelClass:null,resourceModelClass:null,assignmentModelClass:null,dependencyModelClass:null,calendarModelClass:null,repopulateOnDataset:!0}}static get delayable(){return{repopulateReplica:10}}}return s.applyConfigs=!0,ai([E({type:"boolean",defaultValue:!0})],s.prototype,"unspecifiedTimeIsWorking",void 0),ai([E({type:"boolean",defaultValue:!1})],s.prototype,"skipNonWorkingTimeWhenSchedulingManually",void 0),ai([E({type:"boolean",defaultValue:!0})],s.prototype,"skipNonWorkingTimeInDurationWhenSchedulingManually",void 0),ai([E({type:"string",defaultValue:k.Forward},{sync:!0})],s.prototype,"direction",void 0),s}){}var L=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const Ka=function*(l,e,t,s,i){if(t.isIntervalEmpty())return t;if(i&&t.intersectionOf){const a=new Set;for(const o of t.intersectionOf)if(o.isInfinite())a.add(o);else{const c=o.startDateIsFinite()?yield*l.calculateProjectedXDateWithDuration(o.startDate,!1,s):o.startDate,d=o.endDateIsFinite()?yield*l.calculateProjectedXDateWithDuration(o.endDate,!1,s):o.endDate,u=o;a.add(u.copyWith({reflectionOf:u,side:u.side===ce.Start?ce.End:ce.Start,startDate:c,endDate:d}))}t.intersectionOf=a}const n=t.startDateIsFinite()?yield*l.calculateProjectedXDateWithDuration(t.startDate,!1,s):null,r=t.endDateIsFinite()?yield*l.calculateProjectedXDateWithDuration(t.endDate,!1,s):null;return We([e,jt.new({intersectionOf:t.intersectionOf,startDate:n,endDate:r})],i)},Qa=function*(l,e,t,s,i){if(e.isIntervalEmpty())return e;if(i){const a=new Set;for(const o of e.intersectionOf)if(o.isInfinite())a.add(o);else{const c=o.startDateIsFinite()?yield*l.calculateProjectedXDateWithDuration(o.startDate,!0,s):o.startDate,d=o.endDateIsFinite()?yield*l.calculateProjectedXDateWithDuration(o.endDate,!0,s):o.endDate,u=o;a.add(u.copyWith({reflectionOf:u,side:u.side===ce.Start?ce.End:ce.Start,startDate:c,endDate:d}))}e.intersectionOf=a}const n=e.startDateIsFinite()?yield*l.calculateProjectedXDateWithDuration(e.startDate,!0,s):null,r=e.endDateIsFinite()?yield*l.calculateProjectedXDateWithDuration(e.endDate,!0,s):null;return We([t,jt.new({reflectionOf:n||r?e:void 0,intersectionOf:n||r?e.intersectionOf:void 0,startDate:n,endDate:r})],i)},Fe=!0;class pn extends v([ri],e=>{const t=e.prototype;class s extends e{*maybeSkipNonWorkingTime(n,r=!0){if(yield*this.hasSubEvents())return n;let a=yield*this.calculateEffectiveDuration();return n&&a>0?yield*this.skipNonWorkingTime(n,r):n}*calculateEffectiveConstraintInterval(n,r,a,o=!1){const c=yield*this.calculateEffectiveDuration();return c==null?null:yield*(n?Ka:Qa)(this,We(r,o),We(a,o),c,o)}*calculateStartDateConstraintIntervals(){return[]}*calculateEndDateConstraintIntervals(){return[]}*calculateEarlyStartDateConstraintIntervals(){return[]}*calculateEarlyEndDateConstraintIntervals(){return[]}*doCalculateEarlyEffectiveStartDateInterval(n=!1){const r=yield this.$.earlyStartDateConstraintIntervals,a=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!0,r.concat(yield this.$.startDateConstraintIntervals),a.concat(yield this.$.endDateConstraintIntervals),n)}*calculateEarlyEffectiveStartDateInterval(){return yield*this.doCalculateEarlyEffectiveStartDateInterval()}*doCalculateEarlyEffectiveEndDateInterval(n=!1){const r=yield this.$.earlyStartDateConstraintIntervals,a=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!1,r.concat(yield this.$.startDateConstraintIntervals),a.concat(yield this.$.endDateConstraintIntervals),n)}*calculateEarlyEffectiveEndDateInterval(){return yield*this.doCalculateEarlyEffectiveEndDateInterval()}*shouldRollupChildEarlyStartDate(n){return!0}*calculateMinChildrenEarlyStartDate(){let n=le;const r=yield*this.subEventsIterable();for(let a of r){let o;(yield*this.shouldRollupChildEarlyStartDate(a))&&((yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.minChildrenEarlyStartDate),o=o||(yield a.$.earlyStartDate),o&&o<n&&(n=o))}return n.getTime()-le.getTime()?n:null}*shouldRollupChildEarlyEndDate(n){return!0}*calculateMaxChildrenEarlyEndDate(){let n=De;const r=yield*this.subEventsIterable();for(let a of r){let o;(yield*this.shouldRollupChildEarlyEndDate(a))&&((yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.maxChildrenEarlyEndDate),o=o||(yield a.$.earlyEndDate),o&&o>n&&(n=o))}return n.getTime()-De.getTime()?n:null}*calculateEarlyStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===k.Forward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenEarlyStartDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.startDate;let n=yield this.$.earlyEffectiveStartDateInterval;if(n===null)return null;if(n.isIntervalEmpty()){n=yield*this.doCalculateEarlyEffectiveStartDateInterval(!0);const r=Ot.new({intervals:[...n.intersectionOf]});if((yield r)===ve.Cancel)yield Je(r);else return null}return pt(n.startDate)?n.startDate:null}*calculateEarlyStartDate(){const n=yield this.$.earlyStartDateRaw;return yield*this.maybeSkipNonWorkingTime(n,!0)}*calculateEarlyEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===k.Forward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenEarlyEndDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.endDate;let n=yield this.$.earlyEffectiveEndDateInterval;if(n===null)return null;if(n.isIntervalEmpty()){n=yield*this.doCalculateEarlyEffectiveEndDateInterval(!0);const r=Ot.new({intervals:[...n.intersectionOf]});if((yield r)===ve.Cancel)yield Je(r);else return null}return pt(n.startDate)?n.startDate:null}*calculateEarlyEndDate(){return yield this.$.earlyEndDateRaw}*isConstrainedEarly(){const n=yield this.$.startDateConstraintIntervals,r=yield this.$.endDateConstraintIntervals,a=yield this.$.earlyStartDateConstraintIntervals,o=yield this.$.earlyEndDateConstraintIntervals;return!!(n!=null&&n.length||r!=null&&r.length||a!=null&&a.length||o!=null&&o.length)}*calculateStartDatePure(){return(yield this.$.effectiveDirection).direction===k.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*t.calculateStartDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():(yield this.$.earlyStartDate)||(yield*t.calculateStartDatePure.call(this)):yield*t.calculateStartDatePure.call(this)}*calculateStartDateProposed(){switch((yield this.$.effectiveDirection).direction){case k.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*t.calculateStartDateProposed.call(this);if(yield*this.hasSubEvents())return yield*this.calculateMinChildrenStartDate();const r=yield this.$.earlyStartDate;if(r){if(pt(r))return r;const a=yield*t.calculateStartDateProposed.call(this),o=yield this.$.earlyEffectiveStartDateInterval;return o.containsDate(a)?a:pt(o.endDate)?o.endDate:a}else return yield*t.calculateStartDateProposed.call(this);default:return yield*t.calculateStartDateProposed.call(this)}}*calculateEndDatePure(){return(yield this.$.effectiveDirection).direction===k.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*t.calculateEndDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():(yield this.$.earlyEndDate)||(yield*t.calculateEndDatePure.call(this)):yield*t.calculateEndDatePure.call(this)}*calculateEndDateProposed(){switch((yield this.$.effectiveDirection).direction){case k.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*t.calculateEndDateProposed.call(this);if(yield*this.hasSubEvents())return yield*this.calculateMaxChildrenEndDate();const r=yield this.$.earlyEndDate;if(r){if(pt(r))return r;const a=yield*t.calculateEndDateProposed.call(this),o=yield this.$.earlyEffectiveEndDateInterval;return o.containsDate(a)?a:pt(o.endDate)?o.endDate:a}else return yield*t.calculateEndDateProposed.call(this);default:return yield*t.calculateEndDateProposed.call(this)}}}return L([T({lazy:Fe})],s.prototype,"minChildrenEarlyStartDate",void 0),L([T({lazy:Fe})],s.prototype,"earlyStartDateRaw",void 0),L([E({type:"date",persist:!1},{lazy:Fe,converter:it,persistent:!1})],s.prototype,"earlyStartDate",void 0),L([T({lazy:Fe})],s.prototype,"maxChildrenEarlyEndDate",void 0),L([T({lazy:Fe})],s.prototype,"earlyEndDateRaw",void 0),L([E({type:"date",persist:!1},{lazy:Fe,converter:it,persistent:!1})],s.prototype,"earlyEndDate",void 0),L([T()],s.prototype,"startDateConstraintIntervals",void 0),L([T()],s.prototype,"endDateConstraintIntervals",void 0),L([T({lazy:Fe})],s.prototype,"earlyStartDateConstraintIntervals",void 0),L([T({lazy:Fe})],s.prototype,"earlyEndDateConstraintIntervals",void 0),L([T()],s.prototype,"earlyEffectiveStartDateInterval",void 0),L([T()],s.prototype,"earlyEffectiveEndDateInterval",void 0),L([D("startDateConstraintIntervals")],s.prototype,"calculateStartDateConstraintIntervals",null),L([D("endDateConstraintIntervals")],s.prototype,"calculateEndDateConstraintIntervals",null),L([D("earlyStartDateConstraintIntervals")],s.prototype,"calculateEarlyStartDateConstraintIntervals",null),L([D("earlyEndDateConstraintIntervals")],s.prototype,"calculateEarlyEndDateConstraintIntervals",null),L([D("earlyEffectiveStartDateInterval")],s.prototype,"calculateEarlyEffectiveStartDateInterval",null),L([D("earlyEffectiveEndDateInterval")],s.prototype,"calculateEarlyEffectiveEndDateInterval",null),L([D("minChildrenEarlyStartDate")],s.prototype,"calculateMinChildrenEarlyStartDate",null),L([D("maxChildrenEarlyEndDate")],s.prototype,"calculateMaxChildrenEarlyEndDate",null),L([D("earlyStartDateRaw")],s.prototype,"calculateEarlyStartDateRaw",null),L([D("earlyStartDate")],s.prototype,"calculateEarlyStartDate",null),L([D("earlyEndDateRaw")],s.prototype,"calculateEarlyEndDateRaw",null),L([D("earlyEndDate")],s.prototype,"calculateEarlyEndDate",null),s}){}var Ue=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class xs extends v([pn,Ft],e=>{const t=e.prototype;class s extends e{constructor(){super(...arguments),this.ignorePinningConstraint=!1}writeStartDate(n,r,a,o,c=!0){const d=this.getProject();if(d!=null&&d.addConstraintOnDateSet&&r.graph.hasIdentifier(this.$.effectiveDirection)&&!(d!=null&&d.eventStore.isSyncingDataOnLoad)&&!this.isReverting&&!(d!=null&&d.getStm().isRestoring)){const u=this.getStartDatePinConstraintType();u&&(this.constraintDate=o,this.constraintType=u)}return t.writeStartDate.call(this,n,r,a,o,c)}writeEndDate(n,r,a,o,c=!1){const d=this.getProject();if(d!=null&&d.addConstraintOnDateSet&&r.graph.hasIdentifier(this.$.direction)&&c&&!(d!=null&&d.eventStore.isSyncingDataOnLoad)&&!(d!=null&&d.getStm().isRestoring)){const u=this.getEndDatePinConstraintType();u&&(this.constraintDate=o,this.constraintType=u)}return t.writeEndDate.call(this,n,r,a,o,c)}writeConstraintType(n,r,a,o,c=!1){const d=this.getProject();!c&&!n.isWritingUndefined&&d.includeAsapAlapAsConstraints&&(o!==b.AsSoonAsPossible&&o!==b.AsLateAsPossible?r.baseRevision.hasIdentifier(n)&&this.$.direction.write.call(this,this.$.direction,r,void 0,null,!0):(this.$.direction.write.call(this,this.$.direction,r,void 0,o===b.AsSoonAsPossible?k.Forward:k.Backward,!0),this.$.constraintDate.write.call(this,this.$.constraintDate,r,void 0,null))),n.constructor.prototype.write.call(this,n,r,a,o)}writeDirection(n,r,a,o,c=!1){const d=this.getProject();!c&&!n.isWritingUndefined&&d.includeAsapAlapAsConstraints&&(o||r.baseRevision.hasIdentifier(n))&&this.$.constraintType.write.call(this,this.$.constraintType,r,void 0,o===k.Forward?b.AsSoonAsPossible:o===k.Backward?b.AsLateAsPossible:null,!0),n.constructor.prototype.write.call(this,n,r,a,o)}*calculateConstraintType(){let n=yield x;return(yield*this.isConstraintTypeApplicable(n))||(n=null),n}*calculateConstraintDate(n){let r=yield x;const a=yield this.$.constraintType;return a?r||(r=this.getConstraintTypeDefaultDate(n,a)):r=null,r}getStartDatePinConstraintType(){const{effectiveDirection:n}=this.project;if(!this.isTaskPinnableWithConstraint())return null;switch(n.direction){case k.Forward:return b.StartNoEarlierThan;case k.Backward:return b.StartNoLaterThan}}getEndDatePinConstraintType(){const{effectiveDirection:n}=this.project;if(!this.isTaskPinnableWithConstraint())return null;switch(n.direction){case k.Forward:return b.FinishNoEarlierThan;case k.Backward:return b.FinishNoLaterThan}}isTaskPinnableWithConstraint(){const{manuallyScheduled:n,ignorePinningConstraint:r,constraintType:a}=this;let o=!1;if(!n&&!r)if(a)switch(a){case b.AsSoonAsPossible:case b.AsLateAsPossible:case b.StartNoEarlierThan:case b.StartNoLaterThan:case b.FinishNoEarlierThan:case b.FinishNoLaterThan:o=!0}else o=!0;return o}applyChangeset(n,r,a){this.ignorePinningConstraint=a;const o=super.applyChangeset(n,r,a);return this.ignorePinningConstraint=!1,o}getConstraintTypeDefaultDate(n,r){switch(r){case b.StartNoEarlierThan:case b.StartNoLaterThan:case b.MustStartOn:return n(N(this.$.startDate));case b.FinishNoEarlierThan:case b.FinishNoLaterThan:case b.MustFinishOn:return n(N(this.$.endDate))}return null}*isConstraintTypeApplicable(n){const r=yield*this.hasSubEvents();switch(n){case b.FinishNoEarlierThan:case b.StartNoLaterThan:case b.MustFinishOn:case b.MustStartOn:return!r}return!0}async setConstraint(n,r){return this.constraintType=n,r!==void 0&&(this.constraintDate=r),this.commitAsync()}*calculateEndDateConstraintIntervals(){const n=yield*t.calculateEndDateConstraintIntervals.call(this),r=yield this.$.manuallyScheduled,a=yield this.$.constraintType,o=yield this.$.constraintDate,c=this.project.dateConstraintIntervalClass;if(!r&&a&&o)switch(a){case b.MustFinishOn:n.unshift(c.new({owner:this,side:ce.End,startDate:o,endDate:o}));break;case b.FinishNoEarlierThan:n.unshift(c.new({owner:this,side:ce.End,startDate:o}));break;case b.FinishNoLaterThan:n.unshift(c.new({owner:this,side:ce.End,endDate:o}));break}return n}*calculateStartDateConstraintIntervals(){const n=yield*t.calculateStartDateConstraintIntervals.call(this),r=yield this.$.manuallyScheduled,a=yield this.$.constraintType,o=yield this.$.constraintDate,c=this.project.dateConstraintIntervalClass;if(!r&&a&&o)switch(a){case b.MustStartOn:n.unshift(c.new({owner:this,side:ce.Start,startDate:o,endDate:o}));break;case b.StartNoEarlierThan:n.unshift(c.new({owner:this,side:ce.Start,startDate:o}));break;case b.StartNoLaterThan:n.unshift(c.new({owner:this,side:ce.Start,endDate:o}));break}return n}}return Ue([E({type:"string"},{sync:!0})],s.prototype,"constraintType",void 0),Ue([E({type:"date"},{converter:it,sync:!0})],s.prototype,"constraintDate",void 0),Ue([ye("constraintType")],s.prototype,"writeConstraintType",null),Ue([ye("direction")],s.prototype,"writeDirection",null),Ue([D("constraintType")],s.prototype,"calculateConstraintType",null),Ue([D("constraintDate")],s.prototype,"calculateConstraintDate",null),s}){}class Xa extends ge(ys){static get $name(){return"RemoveDateConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return Ve(this.L("L{descriptionTpl}"),e.name||e.id,this.interval.getConstraintName(e.constraintType))}resolve(){this.event.constraintType=null}}class Ja extends Zn{static get $name(){return"DateConstraintIntervalDescription"}static getDescription(e){let t;switch(e.owner.constraintType){case b.StartNoEarlierThan:case b.FinishNoEarlierThan:case b.MustStartOn:case b.MustFinishOn:t=this.L("L{startDateDescriptionTpl}");break;case b.StartNoLaterThan:case b.FinishNoLaterThan:t=this.L("L{endDateDescriptionTpl}");break}return Ve(t,...this.getDescriptionParameters(e))}static getConstraintName(e){return this.L("L{constraintTypeTpl}")[e]}static getDescriptionParameters(e){const t=e.owner;return[O.format(e.startDate,this.L("L{dateFormat}")),O.format(e.endDate,this.L("L{dateFormat}")),t.name||t.id,this.getConstraintName(t.constraintType)]}}class oi extends jt{getConstraintName(e){return this.descriptionBuilderClass.getConstraintName(e||this.owner.constraintType)}getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const t=this.owner;e=e||t.graph.activeTransaction;const s=e.entries.get(t.$.constraintDate),i=e.entries.get(t.$.constraintType);return!e.baseRevision.hasIdentifier(t.$$)||s&&!s.isShadow()||i&&!i.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.removeDateConstraintConflictResolutionClass.new({interval:this})])}}Ue([w(Xa)],oi.prototype,"removeDateConstraintConflictResolutionClass",void 0),Ue([w(Ja)],oi.prototype,"descriptionBuilderClass",void 0);var li=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class Za extends v([pn,Os,Ft,xs],e=>{const t=e.prototype;class s extends e{*shouldPredecessorAffectScheduling(n){const r=yield n.$.fromEvent;return r&&!Jt(r)&&(yield n.$.active)&&(!(yield r.$.inactive)||(yield this.$.inactive))}*calculateEarlyStartDateConstraintIntervals(){const n=yield*t.calculateEarlyStartDateConstraintIntervals.call(this),r=this.getProject(),a=r.dependencyConstraintIntervalClass;for(const o of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(o)))continue;const c=yield o.$.fromEvent,d=yield c.$.manuallyScheduled;let u;switch(yield o.$.type){case Qe.EndToStart:u=d?yield c.$.endDate:yield c.$.earlyEndDateRaw;break;case Qe.StartToStart:u=d?yield c.$.startDate:yield c.$.earlyStartDateRaw;break}if(u){const h=yield o.$.lag,f=yield o.$.lagUnit,p=yield o.$.calendar;yield p.$.version;const g=a.new({owner:o,startDate:p.calculateEndDate(u,yield*r.$convertDuration(h,f,R.Millisecond)),endDate:null});n.unshift(g)}}return n}*calculateEarlyEndDateConstraintIntervals(){const n=yield*t.calculateEarlyEndDateConstraintIntervals.call(this),r=this.getProject(),a=r.dependencyConstraintIntervalClass;for(const o of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(o)))continue;const c=yield o.$.fromEvent,d=yield c.$.manuallyScheduled;let u;switch(yield o.$.type){case Qe.EndToEnd:u=d?yield c.$.endDate:yield c.$.earlyEndDateRaw;break;case Qe.StartToEnd:u=d?yield c.$.startDate:yield c.$.earlyStartDateRaw;break}if(u){const h=yield o.$.lag,f=yield o.$.lagUnit,p=yield o.$.calendar;yield p.$.version;const g=a.new({owner:o,startDate:p.calculateEndDate(u,yield*r.$convertDuration(h,f,R.Millisecond)),endDate:null});n.unshift(g)}}return n}*calculateEffectiveDirection(){const n=yield this.getProject().$.effectiveDirection,r=yield this.$.constraintType;if(n.direction===k.Forward&&!(yield this.$.manuallyScheduled)&&!((r===b.MustStartOn||r===b.MustFinishOn)&&(yield this.$.constraintDate)))for(const a of yield this.$.incomingDeps){const o=yield a.$.fromEvent,c=o!=null&&!Jt(o),d=c?yield o.$.constraintType:void 0;if(!c||!(yield a.$.active)||(yield o.$.manuallyScheduled)||(d===b.MustStartOn||d===b.MustFinishOn)&&(yield o.$.constraintDate))continue;const u=yield a.$.type,h=u===Qe.EndToEnd||u===Qe.EndToStart?yield o.$.endDateDirection:yield o.$.startDateDirection;if(h.direction===k.Backward)return{kind:"enforced",direction:k.Backward,enforcedBy:h.kind==="enforced"?h.enforcedBy:h.kind==="own"?o:h.inheritedFrom}}return yield*super.calculateEffectiveDirection()}}return li([E({type:"boolean"})],s.prototype,"inactive",void 0),s}){}class Fs extends ge(ys){static get $name(){return"BaseDependencyResolution"}getDescription(){const{dependency:e}=this,{type:t,fromEvent:s,toEvent:i}=e;return Ve(this.L("L{descriptionTpl}"),this.L("L{DependencyType.long}")[t],s.name||s.id,i.name||i.id)}}class ks extends Fs{static get $name(){return"RemoveDependencyResolution"}resolve(){this.dependency.remove()}}class Bs extends Fs{static get $name(){return"DeactivateDependencyResolution"}resolve(){this.dependency.active=!1}}class Ya extends Zn{static get $name(){return"DependencyConstraintIntervalDescription"}static getDescriptionParameters(e){const t=e.owner;return[O.format(e.startDate,this.L("L{dateFormat}")),O.format(e.endDate,this.L("L{dateFormat}")),this.L("L{DependencyType.long}")[t.type],t.fromEvent.name,t.toEvent.name]}}class gn extends jt{isAffectedByTransaction(e){const t=this.owner;e=e||t.graph.activeTransaction;const{entries:s}=e,{fromEvent:i,toEvent:n,lag:r,lagUnit:a,type:o}=t.$,c=s.get(i),d=s.get(n),u=s.get(r),h=s.get(a),f=s.get(o);return!e.baseRevision.hasIdentifier(t.$$)||c&&!c.isShadow()||d&&!d.isShadow()||u&&!u.isShadow()||h&&!h.isShadow()||f&&!f.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.deactivateDependencyConflictResolutionClass.new({dependency:this.owner}),this.removeDependencyConflictResolutionClass.new({dependency:this.owner})])}}li([w(ks)],gn.prototype,"removeDependencyConflictResolutionClass",void 0),li([w(Bs)],gn.prototype,"deactivateDependencyConflictResolutionClass",void 0),li([w(Ya)],gn.prototype,"descriptionBuilderClass",void 0);var Ge=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class Ls extends v([Yn],e=>{e.prototype;class t extends e{*calculateUnits(){const i=yield this.$.event;return i?yield*i.calculateAssignmentUnits(this):yield x}*calculateEffort(){const i=yield this.$.event;if(i){const n=yield i.$.startDate,r=yield i.$.endDate,a=yield i.$.effectiveCalendar;if(n&&r){const o=new Map;return o.set(a,[this]),yield*i.calculateProjectedEffort(n,r,o)}}return null}*calculateActualDate(){const i=yield this.$.event;if(i){const n=yield i.$.startDate,r=yield i.$.duration,a=yield i.$.percentDone;return yield*i.calculateProjectedXDateWithDuration(n,!0,r*.01*a)}return null}*calculateActualEffort(){const i=yield this.$.event;if(i){const n=yield i.$.startDate,r=yield i.$.effectiveCalendar,a=yield this.$.actualDate,o=new Map;return o.set(r,[this]),yield*i.calculateProjectedEffort(n,a,o)}return null}}return Ge([E({type:"number",defaultValue:100})],t.prototype,"units",void 0),Ge([D("units")],t.prototype,"calculateUnits",null),Ge([T({lazy:!0})],t.prototype,"effort",void 0),Ge([T({lazy:!0})],t.prototype,"actualDate",void 0),Ge([T({lazy:!0})],t.prototype,"actualEffort",void 0),Ge([D("effort")],t.prototype,"calculateEffort",null),Ge([D("actualDate")],t.prototype,"calculateActualDate",null),Ge([D("actualEffort")],t.prototype,"calculateActualEffort",null),t}){}var kt=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class Vs extends v([As],e=>{e.prototype;class t extends e{*calculateCalendar(){const i=this.getProject(),n=yield i.$.dependenciesCalendar;let r;switch(n){case An.Project:r=yield i.$.effectiveCalendar;break;case An.FromEvent:const a=yield this.$.fromEvent;r=a&&!Jt(a)?yield a.$.effectiveCalendar:null;break;case An.ToEvent:const o=yield this.$.toEvent;r=o&&!Jt(o)?yield o.$.effectiveCalendar:null;break}return r||(r=yield i.$.effectiveCalendar),r}async setLag(i,n){if(this.graph)return this.graph.write(this.$.lag,i,n),this.graph.commitAsync();this.$.lag.DATA=i,n!=null&&(this.$.lagUnit.DATA=n)}writeLag(i,n,r,a,o=void 0){i.constructor.prototype.write.call(this,i,n,r,a),o!=null&&n.write(this.$.lagUnit,o)}}return kt([E({type:"number",defaultValue:0})],t.prototype,"lag",void 0),kt([E({type:"string",defaultValue:R.Day},{converter:O.normalizeUnit})],t.prototype,"lagUnit",void 0),kt([T()],t.prototype,"calendar",void 0),kt([E({type:"boolean",defaultValue:!0,persist:!0})],t.prototype,"active",void 0),kt([D("calendar")],t.prototype,"calculateCalendar",null),kt([ye("lag")],t.prototype,"writeLag",null),t}){}var ci=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class _s extends v([Ft],e=>{e.prototype;class t extends e{*calculatePercentDone(){const i=yield this.$.childEvents,r=yield this.getProject().$.autoCalculatePercentDoneForParentTasks;if(i.size&&r){const a=yield this.$.percentDoneSummaryData;return a.totalDuration>0?a.completedDuration/a.totalDuration:a.milestonesNum>0?a.milestonesTotalPercentDone/a.milestonesNum:null}else return yield x}*shouldRollupChildPercentDoneSummaryData(i){return!0}*calculatePercentDoneSummaryData(){const i=yield this.$.childEvents;if(i.size){let n={totalDuration:0,completedDuration:0,milestonesNum:0,milestonesTotalPercentDone:0};for(const r of i){if(!(yield*this.shouldRollupChildPercentDoneSummaryData(r)))continue;const a=yield r.$.percentDoneSummaryData;a&&(n.totalDuration+=a.totalDuration,n.completedDuration+=a.completedDuration,n.milestonesNum+=a.milestonesNum,n.milestonesTotalPercentDone+=a.milestonesTotalPercentDone)}return n}else{const n=yield this.$.duration;if(typeof n=="number"){const r=yield*this.getProject().$convertDuration(n,yield this.$.durationUnit,R.Millisecond),a=yield this.$.percentDone;return{totalDuration:r,completedDuration:r*a,milestonesNum:r===0?1:0,milestonesTotalPercentDone:r===0?a:0}}else return null}}}return ci([E({type:"number",defaultValue:0})],t.prototype,"percentDone",void 0),ci([T()],t.prototype,"percentDoneSummaryData",void 0),ci([D("percentDone")],t.prototype,"calculatePercentDone",null),ci([D("percentDoneSummaryData")],t.prototype,"calculatePercentDoneSummaryData",null),t}){}var mn=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class di extends v([Ms],e=>{const t=e.prototype;class s extends e{*hasProposedValueForUnits(){const n=yield this.$.assigned;for(const r of n)if((yield r.$.resource)&&(yield Pe(r.$.units)))return!0;return!1}async assign(n,r=100){const a=this.getProject().assignmentStore.modelClass;return this.addAssignment(new a({event:this,resource:n,units:r})),this.commitAsync()}*forEachAvailabilityInterval(n,r){const a=yield this.$.effectiveCalendar,o=yield this.$.assignmentsByCalendar,c=yield this.$.effectiveCalendarsCombination,d=(yield this.$.ignoreResourceCalendar)||n.ignoreResourceCalendar||!o.size,u=this.getProject().maxCalendarRange;return u&&(n=Object.assign({maxRange:u},n)),c.forEachAvailabilityInterval(n,(h,f,p)=>{const g=p.getCalendarsWorkStatus(),m=p.getCalendarsWorking();if(g.get(a)&&(d||m.some(y=>o.has(y))))return r(h,f,p)})}*calculateEffectiveCalendarsCombination(){const n=yield this.$.manuallyScheduled,r=this.getProject(),a=[yield this.$.effectiveCalendar];if(!n||r.skipNonWorkingTimeInDurationWhenSchedulingManually){const o=yield this.$.assignmentsByCalendar;a.push(...o.keys())}return this.getProject().combineCalendars(a)}*calculateAssignmentsByCalendar(){const n=yield this.$.assigned,r=new Map;for(const a of n){const o=yield a.$.resource;if(o){const c=yield o.$.effectiveCalendar;let d=r.get(c);d||(d=[],r.set(c,d)),d.push(a)}}return r}*getBaseOptionsForDurationCalculations(){return{ignoreResourceCalendar:!1}}*useEventAvailabilityIterator(){return(yield this.$.assignmentsByCalendar).size>0}*skipNonWorkingTime(n,r=!0,a){if(!n)return null;const o=yield this.$.assignmentsByCalendar,c=yield this.$.ignoreResourceCalendar;if(yield*this.useEventAvailabilityIterator()){const d=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),r?{startDate:n,isForward:r}:{endDate:n,isForward:r},a);let u;const h=yield*this.forEachAvailabilityInterval(d,(f,p,g)=>(u=r?f:p,!1));if(h===Mi.MaxRangeReached||h===Mi.FullRangeIterated){const f=[yield this.$.effectiveCalendar];!d.ignoreResourceCalendar&&!c&&f.push(...o.keys());const p=un.new({event:this,calendars:f,date:n,isForward:r});if((yield p)===ve.Cancel)yield Je(p);else return null}return new Date(u)}else return yield*t.skipNonWorkingTime.call(this,n,r)}*calculateProjectedDuration(n,r,a,o){if(!n||!r)return null;if(yield*this.useEventAvailabilityIterator()){const c=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),{startDate:n,endDate:r,isForward:!0},o),d=this.getProject().adjustDurationToDST;let u=0;return yield*this.forEachAvailabilityInterval(c,(h,f)=>{if(u+=f.getTime()-h.getTime(),d){const p=h.getTimezoneOffset()-f.getTimezoneOffset();u+=p*60*1e3}}),a||(a=yield this.$.durationUnit),yield*this.getProject().$convertDuration(u,R.Millisecond,a)}else return yield*t.calculateProjectedDuration.call(this,n,r,a)}*calculateProjectedXDateWithDuration(n,r=!0,a,o,c){if(a==null||isNaN(a)||n==null)return null;if(a==0)return n;o=o||(yield this.$.durationUnit);const d=yield*this.getProject().$convertDuration(a,o,R.Millisecond);let u=n.getTime(),h=d;const f=yield this.$.effectiveCalendar;if(yield*this.useEventAvailabilityIterator()){const p=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),r?{startDate:n,isForward:r}:{endDate:n,isForward:r},c),g=this.getProject().adjustDurationToDST;return(yield*this.forEachAvailabilityInterval(p,(y,C,U)=>{const G=y.getTime(),B=C.getTime(),S=B-G;if(S>=h){if(g){const P=r?y.getTimezoneOffset()-new Date(G+h).getTimezoneOffset():new Date(B-h).getTimezoneOffset()-C.getTimezoneOffset();h-=P*60*1e3}return u=r?G+h:B-h,!1}else if(h-=S,g){const P=y.getTimezoneOffset()-C.getTimezoneOffset();h-=P*60*1e3}}))===Mi.StoppedByIterator?new Date(u):null}else return f.accumulateWorkingTime(n,d,r).finalDate}}return mn([T()],s.prototype,"effectiveCalendarsCombination",void 0),mn([T()],s.prototype,"assignmentsByCalendar",void 0),mn([E({type:"boolean"})],s.prototype,"ignoreResourceCalendar",void 0),mn([D("effectiveCalendarsCombination")],s.prototype,"calculateEffectiveCalendarsCombination",null),mn([D("assignmentsByCalendar")],s.prototype,"calculateAssignmentsByCalendar",null),s}){}var ae=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const Oe=Symbol("MasterStartDateVar"),yn=Symbol("MasterEndDateVar"),vn=Symbol("MasterDurationVar"),Cn=Symbol("MasterTotalDurationVar"),ie=Symbol("StartOffsetVar"),oe=Symbol("EndOffsetVar"),eo=V.new({output:F,inputs:new Set([ie,oe])}),to=V.new({output:$,inputs:new Set([ie,Oe])}),Ns=V.new({output:I,inputs:new Set([oe,Oe])}),no=V.new({output:ie,inputs:new Set([$,Oe])}),Ws=V.new({output:oe,inputs:new Set([I,Oe])}),io=V.new({output:ie,inputs:new Set([oe,F])}),zs=V.new({output:oe,inputs:new Set([ie,F])}),so=V.new({output:oe,inputs:new Set([ie,Cn])}),ro=V.new({output:oe,inputs:new Set([ie,vn])}),ao=V.new({output:F,inputs:new Set([ie,yn])}),Xl=Dt.new({variables:new Set([$,I,F,Oe,yn,vn,Cn,ie,oe]),formulas:new Set([eo,to,Ns,io,no,zs,so,ro,Ws,ao])}),Jl=be.new({description:Xl,defaultResolutionFormulas:new Set([Ns,Ws,zs])});class Zl extends he.mix(Te){equality(e,t){const s=e.resolution,i=t.resolution;return s.get($)===i.get($)&&s.get(I)===i.get(I)&&s.get(F)===i.get(F)&&s.get(Oe)===i.get(Oe)&&s.get(yn)===i.get(yn)&&s.get(vn)===i.get(vn)&&s.get(Cn)===i.get(Cn)&&s.get(ie)===i.get(ie)&&s.get(oe)===i.get(oe)}}class Us extends v([at],e=>{class t extends e{get isEventSegment(){return!0}get stm(){var i;return(i=this.event)===null||i===void 0?void 0:i.stm}set stm(i){}writeStartDate(i,n,r,a,o=!0){const c=this.event,d=this.getProject();if(c&&!this.previousSegment&&n.baseRevision.hasIdentifier(i)&&!(d&&d.getStm().isRestoring)?c.$.startDate.constructor.prototype.write.call(this,c.$.startDate,n,null,a,o):i.constructor.prototype.write.call(this,i,n,r,a,o),o&&this.nextSegment){const u=this.endOffset-this.nextSegment.startOffset;if(u>0){let h=this;for(;h=h.nextSegment;)h.startOffset+=u,h.endOffset+=u}}}shouldRecordFieldChange(i,n,r){return i==="startOffset"||i==="endOffset"||super.shouldRecordFieldChange(i,n,r)}*calculateStartOffset(){const n=(yield this.$.dispatcher).resolution.get(ie);if(!this.event)return yield x;let r;if(n===Y)r=yield x;else if(n===io.formulaId)r=yield*this.calculateStartOffsetByEndOffsetAndDuration();else if(n===no.formulaId){const a=yield N(this.event.$.startDate),o=yield N(this.$.startDate);r=yield*this.event.calculateProjectedDuration(a,o,R.Millisecond,{ignoreSegments:!0})}return r}*calculateEndOffset(){const n=(yield this.$.dispatcher).resolution.get(oe);if(!this.event)return yield x;let r;if(n===Y)r=yield x;else if(n===zs.formulaId)r=yield*this.calculateEndOffsetByStartOffsetAndDuration();else if(n===Ws.formulaId){const a=yield N(this.event.$.startDate),o=yield N(this.$.endDate);r=yield*this.event.calculateProjectedDuration(a,o,R.Millisecond,{ignoreSegments:!0})}else n===ro.formulaId?r=yield*this.calculateEndOffsetByMasterDurationAndStartOffset():n===so.formulaId&&(r=yield*this.calculateEndOffsetByMasterTotalDurationAndStartOffset());return r}*calculateStartDate(){const n=(yield this.$.dispatcher).resolution.get($);if(!this.event)return yield x;let r;return n===to.formulaId?r=yield*this.calculateStartDateByMasterStartAndStartOffset():r=yield*super.calculateStartDate(),r}*calculateEndDate(){const n=(yield this.$.dispatcher).resolution.get(I);if(!this.event)return yield x;let r;return n===Ns.formulaId?r=yield*this.calculateEndDateByMasterStartAndEndOffset():r=yield*super.calculateEndDate(),r}*calculateDuration(){const n=(yield this.$.dispatcher).resolution.get(F);if(!this.event)return yield x;let r;return n===eo.formulaId?r=yield*this.calculateDurationByOffsets():n===ao.formulaId?r=yield*this.calculateDurationByOffsets():r=yield*super.calculateDuration(),r}buildProposedDispatcher(i,n,r){const a=super.buildProposedDispatcher(i,n,r);return a.addPreviousValueFlag(Oe),a.addPreviousValueFlag(ie),a.addPreviousValueFlag(oe),a}*prepareDispatcher(i){const n=yield*super.prepareDispatcher(i);if(!this.event)return n;if(i(Vn(this.event.$.startDate))!=null&&n.addPreviousValueFlag(Oe),i(Pe(this.event.$.startDate))&&n.addProposedValueFlag(Oe),!i(Pe(this.event.$.segments))){if(n.collectInfo(i,this.event.$.duration,vn),i(Pe(this.event.$.endDate))){const a=i(Ze(this.event.$.endDate));a!=null&&a[0]||n.addProposedValueFlag(yn)}const r=i(this.event.$.dispatcher);r.resolution.get($)===Y&&r.resolution.get(I)===Y&&n.addProposedValueFlag(Cn)}return n.collectInfo(i,this.$.startOffset,ie),n.collectInfo(i,this.$.endOffset,oe),n}cycleResolutionContext(i){return Jl}*calculateEndOffsetByMasterDurationAndStartOffset(){const i=yield N(this.event.$.duration),n=yield this.event.$.durationUnit,r=yield this.$.startOffset,a=this.nextSegment;let o,c=yield*this.getProject().$convertDuration(i,n,R.Millisecond);const d=[];let u=this;for(;u=u.previousSegment;)d.push(u);for(let h=d.length-1;h>=0;h--){const f=d[h],p=yield N(f.$.startOffset),m=(yield N(f.$.endOffset))-p;c-=m}return c>0?a?o=r+Math.min(c,(yield N(this.$.endOffset))-r):o=r+c:o=r,o}*calculateEndOffsetByMasterTotalDurationAndStartOffset(){const i=yield N(this.event.$.startDate),n=yield N(this.event.$.endDate),r=yield*this.event.calculateProjectedDuration(i,n,R.Millisecond,{ignoreSegments:!0}),a=yield N(this.$.startOffset);let o=yield N(this.$.endOffset),c=this.nextSegment;return a<=r?o<=r?!c||(yield N(c.$.startOffset))>=r?r:o:r:yield this.$.startOffset}*calculateStartOffsetByEndOffsetAndDuration(){const i=yield this.$.duration,n=yield this.$.durationUnit;return(yield this.$.endOffset)-(yield*this.event.getProject().$convertDuration(i,n,R.Millisecond))}*calculateEndOffsetByStartOffsetAndDuration(){const i=yield this.$.duration,n=yield this.$.durationUnit;return(yield this.$.startOffset)+(yield*this.event.getProject().$convertDuration(i,n,R.Millisecond))}*calculateEndDateByMasterStartAndEndOffset(){const i=yield this.event.$.startDate,n=yield this.$.endOffset,r=yield*this.event.calculateProjectedXDateWithDuration(i,!0,n,R.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?r:yield*this.event.skipNonWorkingTime(r,!1)}*calculateStartDateByMasterStartAndStartOffset(){const i=yield this.event.$.startDate,n=yield this.$.startOffset,r=yield*this.event.calculateProjectedXDateWithDuration(i,!0,n,R.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?r:yield*this.event.skipNonWorkingTime(r)}*calculateDurationByOffsets(){const i=yield this.$.startOffset,n=yield this.$.endOffset,r=yield this.$.durationUnit;return yield*this.getProject().$convertDuration(n-i,R.Millisecond,r)}*calculatePercentDone(){let i=0;if(!this.event)return yield x;const n=yield this.event.$.segments;if(n){const r=yield this.event.$.percentDone,a=yield this.event.$.duration,o=yield this.event.$.durationUnit;let c=yield*this.getProject().$convertDuration(a,o,R.Millisecond),d=r*.01*c;for(const u of n){const h=u.startOffset,p=u.endOffset-h;if(u===this)return d>=p?100:d>0?100*d/p:0;d-=p}}return i}*calculateMinPercent(){const i=this.previousSegment;return this.event?i?yield i.$.endPercentDone:0:yield x}*calculateMaxPercent(){if(!this.event)return yield x;const i=yield this.event.$.duration,n=yield this.event.$.durationUnit;let r=yield*this.getProject().$convertDuration(i,n,R.Millisecond);const a=yield this.$.startOffset,o=yield this.$.endOffset;return(yield this.$.startPercentDone)+100*(o-a)/r}*calculateProjectedXDateWithDuration(i,n,r,a){return a||(a=yield this.$.durationUnit),yield*this.event.calculateProjectedXDateWithDuration(i,n,r,a,{ignoreSegments:!0})}*calculateProjectedDuration(i,n,r){return r||(r=yield this.$.durationUnit),yield*this.event.calculateProjectedDuration(i,n,r,{ignoreSegments:!0})}*calculateManuallyScheduled(){return this.event?yield this.event.$.manuallyScheduled:yield x}}return ae([T({identifierCls:Zl})],t.prototype,"dispatcher",void 0),ae([E({persist:!1})],t.prototype,"startOffset",void 0),ae([E({persist:!1})],t.prototype,"endOffset",void 0),ae([T()],t.prototype,"percentDone",void 0),ae([T()],t.prototype,"startPercentDone",void 0),ae([T()],t.prototype,"endPercentDone",void 0),ae([ye("startDate")],t.prototype,"writeStartDate",null),ae([D("startOffset")],t.prototype,"calculateStartOffset",null),ae([D("endOffset")],t.prototype,"calculateEndOffset",null),ae([D("percentDone")],t.prototype,"calculatePercentDone",null),ae([D("startPercentDone")],t.prototype,"calculateMinPercent",null),ae([D("endPercentDone")],t.prototype,"calculateMaxPercent",null),ae([D("manuallyScheduled")],t.prototype,"calculateManuallyScheduled",null),t}){}var ot=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const lt=Symbol("SegmentsVar"),Yl=(l,e,t)=>t.processSegmentsValue(l),Gs=V.new({output:$,inputs:new Set([I,lt])}),Hs=V.new({output:I,inputs:new Set([$,lt])});V.new({output:F,inputs:new Set([$,I,lt])});const oo=Dt.new({variables:new Set([$,I,F,lt]),formulas:new Set([Hs,Gs,Ie,Me,ze])}),ec=be.new({description:oo,defaultResolutionFormulas:new Set([Me,Hs])}),tc=be.new({description:oo,defaultResolutionFormulas:new Set([Ie,Gs])});class nc extends he.mix(Te){equality(e,t){const s=e.resolution,i=t.resolution;return s.get($)===i.get($)&&s.get(I)===i.get(I)&&s.get(F)===i.get(F)&&s.get(lt)===i.get(lt)}}function ic(l,e){return!l&&!e?!0:this._skipSegmentsIsEqual||!l&&e||l&&!e||l.length!==e.length?!1:l.every((t,s)=>sc(t,e[s]))}const sc=(l,e)=>{if(l===e)return!0;const s=(l.isModel?l:e).fieldMap,i=l.startDate instanceof Date?l.startDate.getTime():s.startDate.convert(l.startDate).getTime(),n=e.startDate instanceof Date?e.startDate.getTime():s.startDate.convert(e.startDate).getTime(),r=l.endDate instanceof Date?l.endDate.getTime():s.endDate.convert(l.endDate).getTime(),a=e.endDate instanceof Date?e.endDate.getTime():s.endDate.convert(e.endDate).getTime();return i===n&&r===a};class rc extends v([di,_s],e=>{class t extends e{constructor(){super(...arguments),this._segmentGeneration={}}static get $name(){return"SplitEventMixin"}construct(){this.segmentModelClass=this.getDefaultSegmentModelClass(),super.construct(...arguments)}get rawModifications(){let i=super.rawModifications;if(this.segments&&(!i||!("segments"in i))){for(const n of this.segments)if(n.rawModifications){i=i||{},i.segments=this.getFieldPersistentValue("segments");break}}return i}clearChanges(i,n,r){for(const a of this.segments||[])a.clearChanges(i,n,null);super.clearChanges(i,n,r)}getDefaultSegmentModelClass(){return Us}*prepareDispatcher(i){const n=yield*super.prepareDispatcher(i);return(yield*this.hasSegmentChangesProposed())&&n.addProposedValueFlag(lt),n}cycleResolutionContext(i){const n=i(this.$.effectiveDirection);return n.direction===k.Forward||n.direction===k.None?ec:tc}*hasSegmentChangesProposed(){const i=yield Gr(this.$.segments);let n=!1;(yield Pe(this.$.segments))&&(n=!!i);const r=yield N(this.$.segments);if(!r)return!1;for(const a of r){const o=yield Pe(a.$.startDate),c=yield Pe(a.$.endDate),d=yield Pe(a.$.duration);(o||c||d)&&(n=!0)}return n}writeSegments(i,n,r,a){var o;const c=(o=n.getLatestEntryFor(i))===null||o===void 0?void 0:o.getValue(),d=c!==A?c!=null?c:[]:[],u=new Set(d),h=a!=null?a:[],f=new Set(h);this.project.ion({commitFinalized:()=>g.removeEntities(d.filter(m=>!f.has(m))),once:!0}),i.constructor.prototype.write.call(this,i,n,r,a),this.$.isSegmented.write.call(this,this.$.isSegmented,n,null,!!(a!=null&&a.length));const p=this.project,g=p.replica;for(const m of h)!u.has(m)&&m.graph!==g&&(m.setProject(p),g.addEntity(m))}*doWriteSegments(i,n){if(n=n||[],i.length<=1){const r=i.length?yield*this.getProject().$convertDuration(i[0].endOffset-i[0].startOffset,R.Millisecond,yield this.$.durationUnit):0;n.push({identifier:this.$.duration,proposedArgs:[r,null]}),i=null}n.push({identifier:this.$.segments,proposedArgs:[i]}),yield Wr(n)}*calculateSegments(){var i;yield this.$.dispatcher;const{graph:n,project:r}=this,a=yield Vn(this.$.segments);let o=yield x;const c=[];let d=!1;if(o){const u=new Set;let h=null,f=!1;const{baseRevision:p}=n.$activeTransaction;for(const g of o){const m=yield g.$.startOffset,y=yield g.$.endOffset,C=p.hasIdentifier(g.$.startDate)&&(yield Ze(g.$.startDate)),U=p.hasIdentifier(g.$.endDate)&&(yield Ze(g.$.endDate));if(f=f||(C==null?void 0:C[0])||(U==null?void 0:U[0]),m===y)c.push(g);else if(h&&m<=h.endOffset){const G=h.endOffset;if(c.push(g),h.graph){c.push(h);const B=h.startOffset,S=f?y+G-m:Math.max(y,G),P=h.cls;h=this.segmentModelClass.new({event:this,cls:P,startOffset:B,endOffset:S})}else h.endOffset=f?y+h.endOffset-m:Math.max(y,h.endOffset)}else h&&u.add(h),h=g}h&&u.add(h),u.size===1&&c.push(...u),d=c.length>0,d&&(o=Array.from(u)),o.reduce((g,m,y)=>(g&&(g.nextSegment=m),m.previousSegment=g,m.segmentIndex=y,m),null),o.length&&(o[o.length-1].nextSegment=null)}else a&&c.push(...a);return c.length&&(c.forEach(u=>u.event=null),r.ion({commitFinalized:()=>n.removeEntities(c),once:!0})),d&&(yield*this.doWriteSegments(o)),o=((i=o)===null||i===void 0?void 0:i.length)>1?o:null,o}*calculateAdjustedSegments(){yield this.$.dispatcher;let i=yield this.$.segments;yield this.$.startDate;const n=yield this.$.endDate;yield this.$.duration;let r=yield x;if(i){const a=this.project,o=this.graph,c=[],d=[];let u=-1;for(let p=i.length-1;p>=0;p--){const g=i[p],m=yield g.$.startDate,y=yield g.$.endDate;if(m>n)c.push(g),u=p;else{if(y.getTime()!==n.getTime()){const C=g.endOffset+(n.getTime()-y.getTime())-g.startOffset,U=yield*a.$convertDuration(C,R.Millisecond,yield g.$.durationUnit);d.push({identifier:g.$.duration,proposedArgs:[U,null]},{identifier:g.$.endDate,proposedArgs:[n,!1]},{identifier:g.$.endOffset,proposedArgs:[g.endOffset+(n.getTime()-y.getTime())]})}break}}let h=!1;u>-1&&(h=!0,i.splice(u),i.length&&(i[i.length-1].nextSegment=null),a.ion({commitFinalized:()=>o.removeEntities(c),once:!0}));let f="";i&&(f=this.getSegmentsSnapshot(i)),f!==this._lastSegmentsSnapshot&&(h=!0,i=i&&i.slice(),this._lastSegmentsSnapshot=f),h&&(yield*this.doWriteSegments(i,d))}return r}getSegmentsSnapshot(i){var n;return i=i||this.segments,(n=i)===null||n===void 0?void 0:n.map(r=>{var a,o;return""+r.startOffset+"-"+((a=r.startDate)===null||a===void 0?void 0:a.getTime())+"-"+r.endOffset+"-"+((o=r.endDate)===null||o===void 0?void 0:o.getTime())}).join(";")}processSegmentsValue(i){let n=i;if(i)for(let r=0;r<i.length;r++){const a=i[r],o=a.isModel?a:this.segmentModelClass.new(a);o.event||(o.event=this),i[r]=o}return n}*calculateStartDate(){const n=(yield this.$.dispatcher).resolution.get($);let r;return n===Gs.formulaId?r=yield*this.calculateStartDateBySegments():r=yield*super.calculateStartDate(),r}*calculateStartDateBySegments(){yield this.$.dispatcher;const i=yield this.$.segments,n=yield this.$.endDate;let r;if(i){const o=yield i[i.length-1].$.endOffset,c=yield*this.calculateProjectedXDateWithDuration(n,!1,o,R.Millisecond,{ignoreSegments:!0});r=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?c:yield*this.skipNonWorkingTime(c,!0)}return r}*calculateEndDateBySegments(){yield this.$.dispatcher;const i=yield this.$.segments,n=yield this.$.startDate;let r;if(i){const o=yield i[i.length-1].$.endOffset,c=yield*this.calculateProjectedXDateWithDuration(n,!0,o,R.Millisecond,{ignoreSegments:!0});r=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?c:yield*this.skipNonWorkingTime(c,!1)}return r}*calculateEndDate(){const n=(yield this.$.dispatcher).resolution.get(I);let r;return n===Hs.formulaId?r=yield*this.calculateEndDateBySegments():r=yield*super.calculateEndDate(),r}*calculateDurationProposed(){let i;return(yield*this.hasSegmentChangesProposed())?i=yield*this.calculateDurationBySegments():i=yield*super.calculateDurationProposed(),i}*skipNonWorkingTime(i,n=!0,r){return i?(r=Object.assign({ignoreSegments:!0},r),yield*super.skipNonWorkingTime(i,n,r)):null}*calculateDurationBySegments(){let i;yield this.$.dispatcher;const n=yield this.$.durationUnit,r=yield this.$.segments;if(r){let a=0;for(const o of r)a+=o.endOffset-o.startOffset;i=yield*this.getProject().$convertDuration(a,R.Millisecond,n)}return i}*forEachAvailabilityInterval(i,n){const r=yield this.$.effectiveCalendar,a=yield this.$.assignmentsByCalendar,o=yield this.$.effectiveCalendarsCombination,c=i.isForward!==!1,d=(yield this.$.ignoreResourceCalendar)||i.ignoreResourceCalendar||!a.size,u=this.getProject().maxCalendarRange;let h=i.ignoreSegments,f=1,p,g,m,y,C;h||(y=yield this.$.segments,h=h||!y,h||(y=y.slice(),c?(p=y.shift(),g=0,f=1,C=p.nextSegment?p.endOffset:le.getTime()):(p=y.pop(),g=p.endOffset,f=-1,C=p.endOffset),m=C-p.startOffset));const U=yield this.$.manuallyScheduled,G=this.getProject();return o.forEachAvailabilityInterval(Object.assign({maxRange:u},i),(B,S,P)=>{const Q=P.getCalendarsWorkStatus(),X=P.getCalendarsWorking();if(Q.get(r)&&(d||X.some(K=>a.has(K))||U&&!G.skipNonWorkingTimeInDurationWhenSchedulingManually)){if(h)return n(B,S,P);{const K=B.getTime();let J=S.getTime()-B.getTime();if(this.getProject().adjustDurationToDST){const je=B.getTimezoneOffset()-S.getTimezoneOffset();J+=je*60*1e3}let j,Z;for(c?(j=g,Z=g+J):(j=g-J,Z=g);p&&j<=C&&Z>p.startOffset;){const je=Math.max(j,p.startOffset),ke=Math.min(Z,C),Be=new Date(K+je-j),Le=new Date(K+ke-j);if(n(Be,Le,P)===!1)return!1;if(m-=Le.getTime()-Be.getTime(),!m)p=c?y.shift():y.pop(),p&&(C=!c||p.nextSegment?p.endOffset:le.getTime(),m=C-p.startOffset);else break}g+=f*J}}})}*useEventAvailabilityIterator(){return(yield this.$.isSegmented)?!0:!(yield this.$.manuallyScheduled)}getSegmentByDate(i,n){if(n=n||this.getSegments(),n){const r=this.getSegmentIndexByDate(i,n);return n[r]}}getSegmentIndexByDate(i,n){return n=n||this.getSegments(),n?n.findIndex(r=>i>=r.startDate&&i<r.endDate):-1}get firstSegment(){const i=this.getSegments();return i?i[0]:null}get lastSegment(){const i=this.getSegments();return i?i[i.length-1]:null}getSegment(i){const n=this.getSegments();return n==null?void 0:n[i]}async splitToSegments(i,n=1,r){var a;const o=this.getProject();await o.commitAsync();const c=this;if(!i||c.isHasSubEventsMixin&&(a=c.childEvents)!==null&&a!==void 0&&a.size)return;const d=c.duration,u=c.durationUnit,h=c.startDate,f=c.endDate;if(r=r?O.normalizeUnit(r):u,!h||!f||h>=i||i>=f||!d)return;const p=c.isSegmented;let g=c.segments||[],m,y;if(p&&(y=c.getSegmentIndexByDate(i,g),m=g[y],!m))return;const C=m||c,U=m?C.startDate:h,G=C.duration,B=C.durationUnit,S=c.run("calculateProjectedDuration",U,i,B,{ignoreSegments:!0}),P=G-S,Q=o.run("$convertDuration",n,r,R.Millisecond),X=Q+c.run("calculateProjectedDuration",h,i,R.Millisecond,{ignoreSegments:!0});if(m){m.duration=S;const K=this.segmentModelClass.new({duration:P,durationUnit:B,startOffset:X});g=g.slice(0),g.splice(y+1,0,K),c.segments=g,c.duration=d;for(let J=y+2,j=g.length;J<j;J++){const Z=g[J];Z&&(Z.startOffset+=Q,Z.endOffset+=Q)}}else{const K=this.segmentModelClass.new({duration:S,durationUnit:B,startOffset:0}),J=this.segmentModelClass.new({duration:d-S,durationUnit:B,startOffset:X});c.duration=d,c.segments=[K,J]}return o.commitAsync()}async mergeSegments(i,n){if(this.isSegmented){if(i=i||this.firstSegment,n=n||this.lastSegment,i.startOffset>n.startOffset){let r=n;n=i,i=r}return i.endDate=n.startDate,this.getProject().commitAsync()}}storeFieldChange(i,n){if(i==="segments"&&n){const r=[];for(const a of n){const o=a.toJSON();(!this._segmentGeneration[a.internalId]||a.generation>this._segmentGeneration[a.internalId])&&Object.assign(o,a.meta.modified),r.push(o),this._segmentGeneration[a.internalId]=a.generation}n=r}super.storeFieldChange(i,n)}leaveProject(){const i=this.segments;i&&this.graph.removeEntities(i),super.leaveProject()}endBatch(...i){this.fieldMap.segments._skipSegmentsIsEqual++,super.endBatch(...i),this.fieldMap.segments._skipSegmentsIsEqual--}copy(i=null,n=null){const r=super.copy(i,n);return r.data.segments=void 0,r.segments&&(r.segments=r.segments.map(a=>Object.assign(a.copy(),{event:r}))),r}}return ot([T({identifierCls:nc})],t.prototype,"dispatcher",void 0),ot([E({type:"array",isEqual:ic,convert:Yl,_skipSegmentsIsEqual:0})],t.prototype,"segments",void 0),ot([T()],t.prototype,"adjustedSegments",void 0),ot([T()],t.prototype,"isSegmented",void 0),ot([ye("segments")],t.prototype,"writeSegments",null),ot([D("segments")],t.prototype,"calculateSegments",null),ot([D("adjustedSegments")],t.prototype,"calculateAdjustedSegments",null),t}){}var ui=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class qs extends v([di,Ft],e=>{e.prototype;class t extends e{getEffort(i){const n=this.effort;return i?this.getProject().convertDuration(n,this.effortUnit,i):n}writeEffort(i,n,r,a,o){a<0&&(a=0),!(!n.baseRevision.hasIdentifier(i)&&a==null)&&(o!=null&&o!==this.effortUnit&&this.$.effortUnit.write.call(this,this.$.effortUnit,n,null,o),i.constructor.prototype.write(i,n,r,a))}setEffortUnit(i){throw new Error("Use `setEffort` instead")}*shouldRollupChildEffort(i){return!0}*calculateTotalChildrenEffort(){const i=yield this.$.childEvents,n=this.getProject();let r=0;for(const a of i){if(!(yield*this.shouldRollupChildEffort(a)))continue;const o=yield a.$.effortUnit;r+=yield*n.$convertDuration(yield a.$.effort,o,R.Millisecond)}return yield*n.$convertDuration(r,R.Millisecond,yield this.$.effortUnit)}*calculateEffort(){if((yield this.$.childEvents).size>0)return yield*this.calculateTotalChildrenEffort();{const n=yield x;return n!==void 0?n:yield*this.calculateEffortPure()}}*calculateEffortPure(){return(yield this.$.childEvents).size>0?yield*this.calculateTotalChildrenEffort():yield*this.calculateProjectedEffort(yield this.$.startDate,yield this.$.endDate)}*calculateEffortProposed(){return yield x}*calculateAssignmentUnits(i){return yield*this.calculateAssignmentUnitsProposed(i)}*calculateAssignmentUnitsPure(i){return yield*this.calculateUnitsByStartEndAndEffort(i)}*calculateAssignmentUnitsProposed(i){return yield x}*getBaseOptionsForEffortCalculations(){return{ignoreResourceCalendar:!1}}*calculateProjectedEffort(i,n,r){if(i==null||n==null||i>n)return null;r||(r=yield this.$.assignmentsByCalendar);const a=new Map;for(const[d,u]of r){let h=0;for(const f of u)h+=yield f.$.units;a.set(d,h)}let o=0;const c=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:i,endDate:n});return a.size===0&&(a.set(yield this.$.effectiveCalendar,100),c.ignoreResourceCalendar=!0),yield*this.forEachAvailabilityInterval(c,(d,u,h)=>{const f=h.getCalendarsWorking(),p=d.getTime(),g=u.getTime(),m=g-p;let y=0;for(const C of f)y+=a.get(C)||0;o+=y*m*.01}),yield*this.getProject().$convertDuration(o,R.Millisecond,yield this.$.effortUnit)}*calculateUnitsByStartEndAndEffort(i){const n=yield this.$.effort,r=yield this.$.effortUnit,a=yield*this.getProject().$convertDuration(n,r,R.Millisecond);let o=0;const c=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:yield this.$.startDate,endDate:yield this.$.endDate}),d=yield this.$.assignmentsByCalendar;return yield*this.forEachAvailabilityInterval(c,(u,h,f)=>{const p=f.getCalendarsWorking(),g=u.getTime(),m=h.getTime(),y=m-g;for(const C of p)o+=(d.has(C)?d.get(C).length:0)*y}),o?100*a/o:100}*calculateProjectedXDateByEffort(i,n=!0,r,a){r=r!==void 0?r:yield this.$.effort,a=a!==void 0?a:yield this.$.effortUnit;const o=yield*this.getProject().$convertDuration(r,a,R.Millisecond);if(i==null||r==null)return null;let c=i.getTime(),d=o;if(d===0)return new Date(c);const u=yield this.$.effectiveCalendar,h=yield this.$.assignmentsByCalendar,f=new Map;let p=!1;for(const[g,m]of h){let y=0;for(const C of m)y+=yield C.$.units;f.set(g,y),y>0&&(p=!0)}if(p&&(yield*this.useEventAvailabilityIterator())){const g=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),n?{startDate:i,isForward:n}:{endDate:i,isForward:n});return yield*this.forEachAvailabilityInterval(g,(m,y,C)=>{const U=C.getCalendarsWorking(),G=m.getTime(),B=y.getTime(),S=B-G;let P=0;for(const X of U)P+=f.get(X)||0;const Q=P*S*.01;if(Q>=d)return c=n?G+d/(.01*P):B-d/(.01*P),!1;d-=Q}),new Date(c)}else return u.accumulateWorkingTime(i,o,n).finalDate}}return ui([E({type:"number"})],t.prototype,"effort",void 0),ui([E({type:"string",defaultValue:R.Hour},{converter:s=>O.normalizeUnit(s)||R.Hour})],t.prototype,"effortUnit",void 0),ui([ye("effort")],t.prototype,"writeEffort",null),ui([D("effort")],t.prototype,"calculateEffort",null),t}){}const ee=Symbol("EffortVar"),se=Symbol("UnitsVar"),Dn=V.new({output:ee,inputs:new Set([$,I,se])}),Bt=V.new({output:se,inputs:new Set([$,I,ee])}),Ks=V.new({output:I,inputs:new Set([$,ee,se])}),Qs=V.new({output:$,inputs:new Set([I,ee,se])});class lo extends $s{}class co extends Is{equality(e,t){const s=e.resolution,i=t.resolution;return(e!==A||t===A)&&(e===A||t!==A)&&s.get(ee)===i.get(ee)&&s.get(se)===i.get(se)&&super.equality(e,t)}}var ct=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class Xs extends v([qs],e=>{const t=e.prototype;class s extends e{*calculateSchedulingMode(){return(yield x)||W.Normal}*effectiveSchedulingMode(){return(yield this.$.assignmentsByCalendar).size>0?yield this.$.schedulingMode:W.Normal}effectiveSchedulingModeSync(n){return n(this.$.assignmentsByCalendar).size>0?n(this.$.schedulingMode):W.Normal}*prepareDispatcher(n){if((yield*this.effectiveSchedulingMode())!==W.Normal){const a=yield*t.prepareDispatcher.call(this,n);return a.collectInfo(n,this.$.effort,ee),(yield*this.hasProposedValueForUnits())&&a.addProposedValueFlag(se),a.addPreviousValueFlag(se),a}else return yield*t.prepareDispatcher.call(this,n)}dispatcherClass(n){return this.effectiveSchedulingModeSync(n)!==W.Normal?lo:t.dispatcherClass.call(this,n)}buildProposedDispatcher(n,r,a){const o=t.buildProposedDispatcher.call(this,n,r,a);return o.addPreviousValueFlag(ee),o.addPreviousValueFlag(se),o}*calculateAssignmentUnits(n){if((yield*this.effectiveSchedulingMode())!==W.Normal){const o=(yield this.$.dispatcher).resolution.get(se);if(o===Y)return yield*this.calculateAssignmentUnitsProposed(n);if(o===Bt.formulaId)return yield*this.calculateAssignmentUnitsPure(n);throw new Error("Unknown formula for `units`")}else return yield*t.calculateAssignmentUnits.call(this,n)}*calculateEffort(){if((yield*this.effectiveSchedulingMode())!==W.Normal){const a=(yield this.$.dispatcher).resolution.get(ee);if(a===Y)return yield*this.calculateEffortProposed();if(a===Dn.formulaId)return yield*this.calculateEffortPure();throw new Error("Unknown formula for `effort`")}else return yield*t.calculateEffort.call(this)}*calculateStartDate(){return(yield*this.effectiveSchedulingMode())!==W.Normal?(yield this.$.dispatcher).resolution.get($)===Qs.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.endDate,!1):yield*t.calculateStartDate.call(this):yield*t.calculateStartDate.call(this)}*calculateEndDate(){return(yield*this.effectiveSchedulingMode())!==W.Normal?(yield this.$.dispatcher).resolution.get(I)===Ks.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.startDate,!0):yield*t.calculateEndDate.call(this):yield*t.calculateEndDate.call(this)}*calculateEffectiveDuration(){const n=yield this.$.dispatcher,r=yield*this.effectiveSchedulingMode(),a=n.resolution.get(F);n.resolution.get(ee);let o;if(a===ze.formulaId&&r!=W.Normal){const c=yield N(this.$.startDate),d=yield N(this.$.endDate),u=n.resolution.get($),h=n.resolution.get(I);yield this.$.effortDriven,d&&u===Qs.formulaId?o=yield*this.calculateProjectedDuration(yield*this.calculateProjectedXDateByEffort(d,!1),d):c&&h===Ks.formulaId?o=yield*this.calculateProjectedDuration(c,yield*this.calculateProjectedXDateByEffort(c,!0)):(c&&d||!c&&!d)&&(o=yield*t.calculateEffectiveDuration.call(this))}else o=yield*t.calculateEffectiveDuration.call(this);return o}}return ct([E({type:"boolean",defaultValue:!1})],s.prototype,"effortDriven",void 0),ct([E({type:"string",defaultValue:W.Normal},{sync:!0})],s.prototype,"schedulingMode",void 0),ct([T({identifierCls:co})],s.prototype,"dispatcher",void 0),ct([D("schedulingMode")],s.prototype,"calculateSchedulingMode",null),ct([D("effort")],s.prototype,"calculateEffort",null),ct([D("startDate")],s.prototype,"calculateStartDate",null),ct([D("endDate")],s.prototype,"calculateEndDate",null),s}){}const Js=Dt.new({variables:new Set([$,I,F,ee,se]),formulas:new Set([Ie,Me,ze,Bt,Dn])}),Zs=Dt.new({variables:new Set([$,I,F,ee,se]),formulas:new Set([Ie,Me,ze,Bt])}),uo=be.new({description:Js,defaultResolutionFormulas:new Set([Me,Dn])}),ho=be.new({description:Zs,defaultResolutionFormulas:new Set([Me,Bt])}),fo=be.new({description:Js,defaultResolutionFormulas:new Set([Ie,Dn])}),po=be.new({description:Zs,defaultResolutionFormulas:new Set([Ie,Bt])});class go extends v([Xs],e=>{const t=e.prototype;class s extends e{*prepareDispatcher(n){if((yield*this.effectiveSchedulingMode())===W.FixedDuration){const a=yield*t.prepareDispatcher.call(this,n),o=yield this.$.effortDriven;return o&&a.addKeepIfPossibleFlag(ee),(yield Pe(this.$.assigned))&&(o?a.addProposedValueFlag(ee):a.addProposedValueFlag(se)),a}else return yield*t.prepareDispatcher.call(this,n)}cycleResolutionContext(n){if(this.effectiveSchedulingModeSync(n)===W.FixedDuration){const a=n(this.$.effectiveDirection),o=n(this.$.effortDriven);return a.direction===k.Forward||a.direction===k.None?o?ho:uo:o?po:fo}else return t.cycleResolutionContext.call(this,n)}*getBaseOptionsForDurationCalculations(){return(yield*this.effectiveSchedulingMode())===W.FixedDuration?{ignoreResourceCalendar:!0}:yield*t.getBaseOptionsForDurationCalculations.call(this)}}return s}){}class mo extends v([ni,xs,_s,di,qs,Xs,go,pn,Za,rc],e=>{class t extends e{static get fields(){return[{name:"name",type:"string"}]}}return t}){}var Sn=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class yo extends Ir{static get fields(){return[{name:"isWorking",type:"boolean",defaultValue:!0}]}}class vo extends Jo{static get defaultConfig(){return{modelClass:yo}}}class Ys extends xt{get intervalStoreClass(){return vo}}Sn([E({type:"boolean",defaultValue:!1})],Ys.prototype,"unspecifiedTimeIsWorking",void 0);class hi extends q{constructor(){super(...arguments),this.effort=0,this.units=0}}class Co extends hi{constructor(){super(...arguments),this.inEventTimeSpan=!1}}class er extends hi{constructor(){super(...arguments),this.maxEffort=0,this.isOverallocated=!1,this.isUnderallocated=!1,this.inEventTimeSpan=!1,this.assignments=null,this.assignmentIntervals=null}}class fi extends $e.mix(q){getDefaultAllocationIntervalClass(){return hi}initialize(e){e=Object.assign({includeInactiveEvents:!1,allocationIntervalClass:this.getDefaultAllocationIntervalClass()},e),super.initialize(e)}}Sn([T()],fi.prototype,"includeInactiveEvents",void 0),Sn([T()],fi.prototype,"allocation",void 0);class pi extends fi{enterGraph(e){super.enterGraph(e)}leaveGraph(e){var t;if(this.eventRangesCalendar){var s;(s=this.resource)===null||s===void 0||s.getProject().clearCombinationsWith(this.eventRangesCalendar)}super.leaveGraph(e),(t=this.resource)===null||t===void 0||t.entities.delete(this)}getDefaultAllocationIntervalClass(){return er}*shouldIncludeAssignmentInAllocation(e){const t=yield e.$.event,s=yield this.$.includeInactiveEvents,i=t&&(yield t.$.inactive),n=t&&(yield t.$.startDate),r=t&&(yield t.$.endDate);return!!(t&&n&&r&&(s||!i))}*calculateAllocation(){const e=[],t=yield this.ticks,s=yield this.$.resource;yield this.$.includeInactiveEvents;const i=yield s.$.assigned,n=yield s.$.effectiveCalendar,r=new Map,a=[],o=new Map,c=new Map;let d=!1,u,h,f;for(const S of i){if(!(yield*this.shouldIncludeAssignmentInAllocation(S)))continue;yield S.$.units;const P=yield S.$.event,Q=yield P.$.ignoreResourceCalendar,X=yield P.$.startDate,K=yield P.$.endDate,J=yield P.$.segments,j=yield P.$.effectiveCalendar;if(d=d||Q,J)for(const je of J){const ke=yield je.$.startDate,Be=yield je.$.endDate;a.push({startDate:ke,endDate:Be,assignment:S})}else a.push({startDate:X,endDate:K,assignment:S});let Z=r.get(j);Z||(Z=[],r.set(j,Z)),o.set(S,new Map),c.set(S,[]),Z.push(S)}if(this.eventRangesCalendar){var p;(p=this.resource)===null||p===void 0||p.getProject().clearCombinationsWith(this.eventRangesCalendar)}const g=this.eventRangesCalendar=new Ys({intervals:a}),m=[t,g,...r.keys()],y=new Map;t.intervalStore.forEach(S=>{const P=er.new({tick:S,resource:s});y.set(S,P),e.push(P),o.forEach((Q,X)=>{const K=Co.new({tick:S,assignment:X});Q.set(S,K),c.get(X).push(K)})});const C=e[0].tick.startDate,U=e[e.length-1].tick.endDate,G={startDate:C,endDate:U,calendars:m,includeNonWorkingIntervals:d},B=U.getTime()-C.getTime();if(B>s.getProject().maxCalendarRange&&(G.maxRange=B),yield*s.forEachAvailabilityInterval(G,(S,P,Q)=>{const X=Q.getCalendarsWorkStatus();if(X.get(t)){const K=Q.intervalsByCalendar.get(t)[0],J=P.getTime()-S.getTime(),j=y.get(K),Z=j.assignments||new Set,je=j.assignmentIntervals||new Map;if(f&&f!==K){const Ke=y.get(f);Ke.isUnderallocated=Ke.isUnderallocated||Ke.effort&&Ke.effort<Ke.maxEffort}f=K,j.assignments||(u=0,h=0);let ke=0,Be=!1,Le,In=0;Q.intervalsByCalendar.get(g).forEach(Ke=>{const pe=Ke.assignment,Ti=pe==null?void 0:pe.event;if(Ti&&X.get(Ti.effectiveCalendar)&&(Ti.ignoreResourceCalendar||X.get(n))){const jo=Math.max(S.getTime(),pe.event.startDate.getTime()),Ao=Math.min(P.getTime(),pe.event.endDate.getTime());Be=!0,Le=Ao-jo;const Mn=o.get(pe).get(K),Rr=Le*pe.units/100;Mn.effort+=Rr,Mn.units=pe.units,Mn.inEventTimeSpan=!0,In+=Rr,ke+=pe.units,Z.add(pe),je.set(pe,Mn)}}),j.inEventTimeSpan=j.inEventTimeSpan||Be,X.get(n)&&(j.maxEffort+=J),ke&&(Le?(u+=Le*ke,h+=Le,j.units=u/h):u||(j.units=ke)),Be&&(j.effort+=In,j.assignments=Z,j.assignmentIntervals=je,j.isOverallocated=j.isOverallocated||j.effort>j.maxEffort||j.units>100,j.isUnderallocated=j.isUnderallocated||In<J||j.units<100)}}),f){const S=y.get(f);S.isUnderallocated=S.isUnderallocated||S.effort&&S.effort<S.maxEffort}return{owner:this,resource:s,total:e,byAssignments:c}}}Sn([T()],pi.prototype,"resource",void 0),Sn([D("allocation")],pi.prototype,"calculateAllocation",null);class tr extends v([si],e=>{const t=e.prototype;class s extends e{constructor(){super(...arguments),this.observers=new Set,this.entities=new Set}addObserver(n){this.graph.addIdentifier(n),this.observers.add(n)}removeObserver(n){this.graph&&this.graph.removeIdentifier(n),this.observers.delete(n)}addEntity(n){this.graph.addEntity(n),this.entities.add(n)}removeEntity(n){this.graph&&this.graph.removeEntity(n),this.entities.delete(n)}leaveGraph(n){for(const r of this.observers)this.removeObserver(r);for(const r of this.entities)this.removeEntity(r);t.leaveGraph.call(this,n)}*forEachAvailabilityInterval(n,r){const a=this.getProject(),o=yield this.$.effectiveCalendar,c=a.combineCalendars([o].concat(n.calendars||[])),d=a.maxCalendarRange,u=n.includeNonWorkingIntervals;return d&&(n=Object.assign({maxRange:d},n)),c.forEachAvailabilityInterval(n,(h,f,p)=>{const g=p.getCalendarsWorkStatus();if(u||g.get(o))return r(h,f,p)})}}return s}){}var Lt=function(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};class ac extends v([qa,pn,Ft],e=>{const t=e.prototype;class s extends e{construct(n={}){var r;this.eventSegmentModelClass=n.eventSegmentModelClass||this.getDefaultEventSegmentModelClass(),t.construct.call(this,n),this.includeAsapAlapAsConstraints=(r=n.includeAsapAlapAsConstraints)!=null?r:!0,this.resourceAllocationInfoClass||(this.resourceAllocationInfoClass=this.getDefaultResourceAllocationInfoClass())}getDefaultEventStoreClass(){return ii}getDefaultEventSegmentModelClass(){return Us}getDefaultResourceAllocationInfoClass(){return pi}afterConfigure(){t.afterConfigure.apply(this,arguments),this.dateConstraintIntervalClass=this.dateConstraintIntervalClass||oi,this.dependencyConstraintIntervalClass=this.dependencyConstraintIntervalClass||gn}getType(){return qt.SchedulerPro}getDefaultCycleEffectClass(){return En}getDefaultEventModelClass(){return mo}getDefaultDependencyModelClass(){return Vs}getDefaultAssignmentModelClass(){return Ls}getDefaultResourceModelClass(){return tr}async validateDependency(n,r,a,o){let c;return o&&(c=Array.isArray(o)?o:[o]),Ae(n.outgoingDeps).some(u=>{var h;return u.toEvent===r&&!((h=c)!==null&&h!==void 0&&h.includes(u))})?gt.DuplicatingDependency:await this.isDependencyCyclic(n,r,a,c)?gt.CyclicDependency:gt.NoError}async isValidDependency(n,r,a,o){return await this.validateDependency(n,r,a,o)===gt.NoError}getDependencyCycleDetectionIdentifiers(n,r){return[r.$.earlyStartDateConstraintIntervals,r.$.earlyEndDateConstraintIntervals]}async isDependencyCyclic(n,r,a,o){const c=this.getDependencyStore().modelClass,d=new c({fromEvent:n,toEvent:r,type:a}),u=this.replica.branch({autoCommit:!1,onComputationCycle:"throw"});o&&(Array.isArray(o)||(o=[o]),o.forEach(h=>u.removeEntity(h))),u.addEntity(d),d.project=this;try{return await Promise.all(this.getDependencyCycleDetectionIdentifiers(n,r).map(h=>u.readAsync(h))),!1}catch(h){if(/cycle/i.test(h))return!0;if(!/conflict/i.test(h))throw h}}async isValidDependencyModel(n,r){return this.isValidDependency(n.fromEvent,n.toEvent,n.type,r)}}return Lt([E({type:"string",defaultValue:An.ToEvent})],s.prototype,"dependenciesCalendar",void 0),Lt([E({type:"boolean",defaultValue:!0})],s.prototype,"autoCalculatePercentDoneForParentTasks",void 0),Lt([E({type:"boolean",defaultValue:!0})],s.prototype,"addConstraintOnDateSet",void 0),s}){}class Do extends ge(ln){static get $name(){return"DeactivateDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.active=!1}}class En extends rt{getInvalidDependencies(){if(!this._invalidDependencies){const e=this.getDependencies();this._invalidDependencies=e.filter(t=>t.fromEvent===t.toEvent||t.fromEvent.contains(t.toEvent)||t.toEvent.contains(t.fromEvent))}return this._invalidDependencies}buildInvalidDependencyResolutions(e){return[this.removeDependencyConflictResolutionClass.new(e),this.deactivateDependencyConflictResolutionClass.new(e)]}matchDependencyBySourceAndTargetEvent(e,t,s){return e.active&&super.matchDependencyBySourceAndTargetEvent(e,t,s)}getResolutions(){if(!this._resolutions){const e=this.getInvalidDependencies(),t=[];for(const s of e)t.push(...this.buildInvalidDependencyResolutions({dependency:s}));e.length||t.push(this.deactivateDependencyCycleEffectResolutionClass.new(),...super.getResolutions()),this._resolutions=t}return this._resolutions}}Lt([w(Do)],En.prototype,"deactivateDependencyCycleEffectResolutionClass",void 0),Lt([w(ks)],En.prototype,"removeDependencyConflictResolutionClass",void 0),Lt([w(Bs)],En.prototype,"deactivateDependencyConflictResolutionClass",void 0);class gi extends Kt{static get $name(){return"ModelCombo"}static get type(){return"modelcombo"}get value(){const e=super.value;return this.store.getById(e)||e}set value(e){super.value=e}}gi.initClass(),gi._$name="ModelCombo";class nr extends gi{static get $name(){return"CalendarField"}static get type(){return"calendarfield"}static get defaultConfig(){return{valueField:"id",displayField:"name",editable:!1,store:null,listItemTpl:e=>e.name||this.L("L{Default calendar}"),displayValueRenderer:(e,t)=>{var s,i,n;return e=e||((s=t.store)===null||s===void 0||(i=s.project)===null||i===void 0?void 0:i.effectiveCalendar),((n=e)===null||n===void 0?void 0:n.name)||this.L("L{Default calendar}")}}}get value(){return super.value}set value(e){e&&e.isDefault&&e.isDefault()&&(e=null),super.value=e}}nr.initClass(),nr._$name="CalendarField";const bn=(l,e)=>{if(l!==e)throw new Error("Store set is prohibited for Scheduler Pro entity!")};var fe=l=>class extends(l||de){static get $name(){return"PartOfProject"}get taskStore(){return this.eventStore}set taskStore(t){this.eventStore=t}get eventStore(){var t;return(t=this.project)===null||t===void 0?void 0:t.eventStore}get leftProjectEventStore(){const t=this.leftProject;return(t==null?void 0:t.getEventStore())||null}set eventStore(t){bn(this.eventStore,t)}get dependencyStore(){var t;return(t=this.project)===null||t===void 0?void 0:t.dependencyStore}set dependencyStore(t){bn(this.dependencyStore,t)}get assignmentStore(){var t;return(t=this.project)===null||t===void 0?void 0:t.assignmentStore}set assignmentStore(t){bn(this.assignmentStore,t)}get resourceStore(){var t;return(t=this.project)===null||t===void 0?void 0:t.resourceStore}set resourceStore(t){bn(this.resourceStore,t)}get calendarManagerStore(){var t;return(t=this.project)===null||t===void 0?void 0:t.calendarManagerStore}set calendarManagerStore(t){bn(this.calendarManagerStore,t)}};class dt extends fe(Zo(Ls.derive(mt))){get event(){const{project:e}=this,t=super.event;return e!=null&&e.isDelayingCalculation?e.eventStore.getById(t):t}set event(e){super.event=e}get resource(){var e;const{project:t}=this;let s=super.resource;return t!=null&&t.isDelayingCalculation&&(s=t.resourceStore.getById(s)),(e=s)===null||e===void 0?void 0:e.$original}set resource(e){super.resource=e}get eventResourceKey(){return this.isInActiveTransaction?this.buildEventResourceKey(this.event,this.resource):this.buildEventResourceKey(this.$.event.DATA,this.$.resource.DATA)}}M(dt,"$name","AssignmentModel"),M(dt,"isProAssignmentModel",!0),dt._$name="AssignmentModel";class ir extends fe(Yo(ws.derive(xn))){static get defaultConfig(){return{modelClass:dt}}}M(ir,"$name","AssignmentStore"),ir._$name="AssignmentStore";class sr extends fe(Ir.derive(mt)){static get $name(){return"CalendarIntervalModel"}}sr._$name="CalendarIntervalModel";class rr extends fe(xt.derive(mt)){static get $name(){return"CalendarModel"}static get fields(){return[{name:"expanded",internal:!0,defaultValue:!0},"ignoreTimeZone"]}toString(){return this.name||""}static get defaultConfig(){return{calendarIntervalModelClass:sr}}}rr._$name="CalendarModel";class So extends fe(Ps.derive(xn)){static get defaultConfig(){return{tree:!0,modelClass:rr,loadPriority:100,syncPriority:100,storeId:"calendars"}}}So._$name="CalendarManagerStore";class wn extends fe(Vs.derive(el)){static get $name(){return"DependencyModel"}static get isProDependencyModel(){return!0}get fromEvent(){var e;return(e=this.project)!==null&&e!==void 0&&e.isDelayingCalculation?this.project.eventStore.getById(super.fromEvent):super.fromEvent}set fromEvent(e){super.fromEvent=e}get toEvent(){var e;return(e=this.project)!==null&&e!==void 0&&e.isDelayingCalculation?this.project.eventStore.getById(super.toEvent):super.toEvent}set toEvent(e){super.toEvent=e}}wn._$name="DependencyModel";class Eo extends fe(tl(Rs.derive(xn))){static get defaultConfig(){return{modelClass:wn}}}Eo._$name="DependencyStore";var bo=l=>class extends l{static get $name(){return"PercentDoneMixin"}get isStarted(){return this.percentDone>0}get isCompleted(){return this.percentDone>=100}get isInProgress(){return this.isStarted&&!this.isCompleted}copy(){const t=super.copy(...arguments);return t.percentDone=0,t.clearChanges(),t}get renderedPercentDone(){const t=typeof this.percentDone=="number"&&!isNaN(this.percentDone)?this.percentDone:0;return this.getFormattedPercentDone(t)}getFormattedPercentDone(t=0){return t<=99?Math.round(t):Math.floor(t)}set renderedPercentDone(t){this.percentDone=t}};class wo extends Us.derive(nl).mixin(il,bo){static get $name(){return"EventSegmentModel"}get task(){return this.event}}wo._$name="EventSegmentModel";class ar extends Ar{get type(){return"EventUpdateAction"}construct(e){let{model:t,newData:s,oldData:i}=e;if(s.segments&&i.segments){i={...i},s={...s};const n=i.segments.slice(),r=s.segments.slice();let a=!1;i.segments.forEach((o,c)=>{const d=s.segments.indexOf(o);d>-1&&(n[c]=r[d]=o,a=!0)}),a&&(i.segments=n,s.segments=r)}return super.construct({model:t,newData:s,oldData:i})}}ar._$name="EventUpdateAction";class mi extends fe(sl(tr.derive(Tl))){static get $name(){return"ResourceModel"}get assigned(){var s;var e;const{project:t}=this;return t!=null&&(e=t.assignmentStore.storage._indices)!==null&&e!==void 0&&e.resource?(s=t.assignmentStore.storage.findItem("resource",this))!=null?s:new Set:super.assigned}set assigned(e){super.assigned=e}}mi._$name="ResourceModel";class Po extends fe(rl(js.derive(xn))){static get defaultConfig(){return{modelClass:mi}}}Po._$name="ResourceStore";const oc=(l,e,t)=>l.isSplitEventMixin?new ar({model:l,newData:e,oldData:t}):new Ar({model:l,newData:e,oldData:t});class Ro extends ji{static get defaultConfig(){return{makeModelUpdateAction:oc}}}Ro._$name="StateTrackingManager";class Vt extends ge(mt){static get $name(){return"VersionModel"}onBeforeSave(){}get description(){var e;return(e=this.name)!=null?e:this.defaultDescription}get defaultDescription(){return`${this.isAutosave?"Auto-saved":"Saved"} at ${O.format(this.savedAt,this.L("L{Versions.versionDateFormat}"))}`}}M(Vt,"fields",[{name:"name",type:"string"},{name:"isAutosave",type:"boolean"},{name:"content",type:"object"},{name:"savedAt",type:"date"}]),Vt.exposeProperties(),Vt._$name="VersionModel";class _t extends _e.mixin(fe){}M(_t,"$name","VersionStore"),M(_t,"configurable",{modelClass:Vt,storeId:"versions"}),_t._$name="VersionStore";class ut extends ge(mt){get description(){var e;return(e=this.get("description"))!=null?e:this.defaultDescription}get actions(){var e;return(e=this.get("actions"))!=null?e:[]}get defaultDescription(){var d,u;if(this.actions.length===0)return this.L("L{Versions.noChanges}");const e=this,t=yt.unique(e.actions.map(({actionType:h})=>h.startsWith("add")?"add":h.startsWith("remove")?"remove":h.startsWith("update")?"update":h)),s=yt.unique(e.actions.map(({entity:h})=>h.type)),i=yt.unique(e.actions.map(({entity:h})=>`${h.type}.${h.id}`)).length,n=e.L("L{Versions.transactionDescriptions}"),r=e.L("L{Versions.entityNames}"),a=e.L("L{Versions.entityNamesPlural}"),o=s[0],c=s.length>1;return n[t.length>1?"mixed":t[0]].replace("{n}",i).replace("{entities}",i>1?(d=a[c?"other":o])!=null?d:a.other:(u=r[o])!=null?u:r.other)}}M(ut,"$name","ChangeLogTransactionModel"),M(ut,"fields",[{name:"versionId"},{name:"actions",type:"array"},{name:"occurredAt",type:"date"},{name:"description",type:"string"}]),ut.exposeProperties(),ut._$name="ChangeLogTransactionModel";class Nt extends _e.mixin(fe){}M(Nt,"$name","ChangeLogStore"),M(Nt,"configurable",{modelClass:ut,storeId:"changelogs"}),Nt._$name="ChangeLogStore";var lc=l=>class extends(l||de).mixin(al){static get configurable(){return{crudLoadValidationWarningPrefix:"Project load response error(s):",crudSyncValidationWarningPrefix:"Project sync response error(s):",trackProjectModelChanges:!1}}construct(...t){const s=this;super.construct(...t),s.addPrioritizedStore(s.calendarManagerStore),s.addPrioritizedStore(s.assignmentStore),s.addPrioritizedStore(s.dependencyStore),s.addPrioritizedStore(s.resourceStore),s.addPrioritizedStore(s.eventStore),s.timeRangeStore&&s.addPrioritizedStore(s.timeRangeStore),s.resourceTimeRangeStore&&s.addPrioritizedStore(s.resourceTimeRangeStore)}get project(){return this}set project(t){super.project=t}get crudLoadValidationMandatoryStores(){return[this.getStoreDescriptor(this.eventStore).storeId]}loadCrudManagerData(...t){this.delayCalculation&&!this.isDelayingCalculation&&!this.usingSyncDataOnLoad()&&this.scheduleDelayedCalculation(),super.loadCrudManagerData(...t)}acceptChanges(){super.acceptChanges(),this.clearChanges(!0,!1)}revertChanges(){this.revertCrudStoreChanges(),this.set(this.meta.modified,void 0,!0)}crudStoreHasChanges(t){const s=this.getCrudStore(t);let i;return s?i=super.crudStoreHasChanges(s):i=this.hasPersistableChanges||super.crudStoreHasChanges(),i}get changes(){let t=super.changes;if(this.trackProjectModelChanges){const s=this.modificationDataToWrite;s&&(t=t||{},t.project=s)}return t}shouldClearRecordFieldChange(t,s,i){return t.isCalendarModel&&s==="intervals"?!t.get("intervals").changes:super.shouldClearRecordFieldChange(...arguments)}};class or extends kn(Dl){static get $name(){return"CellEdit"}async startEditing(e={}){const t=await super.startEditing(e);return t&&await this.startFeatureTransaction(),t}async finishEditing(){const e=await super.finishEditing();if(e){var t;await((t=this.finishFeatureTransaction)===null||t===void 0?void 0:t.call(this))}return e}cancelEditing(e=!1,t){this.rejectFeatureTransaction(),super.cancelEditing(e,t)}}or._$name="CellEdit",ue.registerFeature(or,!0,"SchedulerPro");class yi extends kn(yl){onRequestDragCreate(e){const t=super.onRequestDragCreate(e);return t!==!1&&this.startFeatureTransaction().then(),t}doAfterDependencyDrop(e){const{dependency:t}=e,{taskStore:s,dependencyStore:i}=this.client;t?this.finishFeatureTransaction(()=>{(!s.includes(t.fromEvent)||!s.includes(t.toEvent))&&i.remove(t)}):this.rejectFeatureTransaction(),super.doAfterDependencyDrop(e)}}M(yi,"$name","Dependencies"),yi._$name="Dependencies",ue.registerFeature(yi,!0,"SchedulerPro");class vi extends vl{static get $name(){return"EventResize"}render(){const e=this,{client:t}=e;super.render(...arguments),e.dragSelector=e.dragItemSelector=t.eventSelector+":not(.b-sch-event-segment)"}}vi._$name="EventResize",ue.registerFeature(vi,!0,"SchedulerPro");class Pn extends vi{static get pluginConfig(){return{chain:[...super.pluginConfig.chain,"isEventSegmentElementDraggable"]}}render(){super.render(...arguments),this.dragSelector=this.dragItemSelector=".b-sch-event-segment"}isEventSegmentElementDraggable(e,t,s,i){return this.isEventElementDraggable(...arguments)}isEventElementDraggable(e,t,s,i){const n=this,r=t==null?void 0:t.resizable;if(n.disabled||!r||t.isMilestone)return!0;if(t.segments){const a=n.client.scheduledEventName;return t.segments.every((o,c)=>{const d=o.resizable,u=Se.getChild(e,`${a}.segments.${c}`);return!d||(d!==!0&&d!=="start"||!n.isOverStartHandle(i,u))&&(d!==!0&&d!=="end"||!n.isOverEndHandle(i,u))})}return super.isEventElementDraggable(...arguments)}get tipId(){return`${this.client.id}-event-segment-resize-tip`}dragStart(e){return this._segmentsSlices=null,this._segmentsSlicesIndex=0,super.dragStart(...arguments)}beginEventRecordBatch(e){super.beginEventRecordBatch(e),e.isEventSegment&&e.event.beginBatch()}triggerBeforeResize(e){const{client:t}=this,s=t.scheduledEventName,i=t.resolveTimeSpanRecord(e.itemElement);return t.trigger(`before${t.capitalizedEventName}SegmentResize`,{[s+"Record"]:i,event:e.event,...this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})})}triggerEventResizeStart(e,t){const{client:s}=this;s.trigger(`${s.scheduledEventName}SegmentResizeStart`,t)}triggerEventResizeEnd(e,t){const{client:s}=this;s.trigger(`${s.scheduledEventName}SegmentResizeEnd`,t)}triggerEventPartialResize(e,t){const{client:s}=this;s.trigger(`${s.scheduledEventName}SegmentPartialResize`,t)}triggerBeforeEventResizeFinalize(e,t){const{client:s}=this;s.trigger(`before${s.capitalizedEventName}SegmentResizeFinalize`,t)}applyDateConstraints(e,t,s){var i,n;let r=(i=s.dateConstraints)===null||i===void 0?void 0:i.start,a=(n=s.dateConstraints)===null||n===void 0?void 0:n.end;if(t.isEventSegment){const{previousSegment:o,nextSegment:c}=t;o&&(r=r?O.max(o.endDate,r):o.endDate),c&&(a=a?O.min(c.startDate,a):c.startDate)}return(r||a)&&(e=O.constrain(e,r,a),s.snappedDate=O.constrain(s.snappedDate,r,a)),e}resizeEventPartiallyInternal(e,t){const{toSet:s}=t;if(super.resizeEventPartiallyInternal(...arguments),e.isEventSegment){const{event:i}=e;if(!e.nextSegment&&s==="endDate")i.set("endDate",t[s]);else if(!e.previousSegment&&s==="startDate")i.set("startDate",t[s]);else{const n=i.fieldMap.segments;n._skipSegmentsIsEqual++,i.set("segments",i.get("segments")),n._skipSegmentsIsEqual--}}}cancelEventRecordBatch(e){super.cancelEventRecordBatch(e),e.isEventSegment&&e.event.cancelBatch()}highlightHandle(){const{overItem:e}=this;e.classList.add("b-resize-handle","b-over-resize-handle")}unHighlightHandle(e=this.overItem){e==null||e.classList.remove("b-resize-handle",this.resizingItemInnerCls,"b-over-resize-handle",this.draggingItemCls)}}M(Pn,"$name","EventSegmentResize"),Pn._$name="EventSegmentResize",ue.registerFeature(Pn,!0,"SchedulerPro"),ue.registerFeature(Pn,!1,"ResourceHistogram");class ht extends Fn{onElementMouseOut(e){const t=this,{client:s}=t,{target:i,relatedTarget:n}=e,r=i.closest(s.eventSelector),a=s.resolveTimeSpanRecord(i);a!=null&&a.isEventSegment&&r&&s.hoveredEvents.has(r)&&n&&vt.isDescendant(r,n)||this.overridden.onElementMouseOut(...arguments)}getElementsFromEventRecord(e,t){if(e!=null&&e.isEventSegment){const s=this.overridden.getElementsFromEventRecord(e.event,t)[0];return[Se.getChild(s,"segments."+e.segmentIndex)]}return this.overridden.getElementsFromEventRecord(...arguments)}resolveEventRecord(e){var t;const s=e instanceof Event?e.target:e,i=s==null?void 0:s.closest(".b-sch-event-segment");let n=this.overridden.resolveEventRecord(e);return(t=n)!==null&&t!==void 0&&t.segments&&i&&(n=n.segments[i.dataset.segment]),n}resolveTaskRecord(e){var t;const s=e==null?void 0:e.closest(".b-sch-event-segment");let i=this.overridden.resolveTaskRecord(e);return(t=i)!==null&&t!==void 0&&t.segments&&s&&(i=i.segments[s.dataset.segment]),i}populateTaskMenu(e){e.eventRecord=e.taskRecord,e.targetElement.closest(e.feature.client.eventSelector)&&this.populateEventMenu(e)}populateEventMenu({eventRecord:e,taskRecord:t,items:s,domEvent:i}){const n=this;if(!n.client.readOnly&&!e.isParent&&!e.milestone){s[`split${t?"Task":"Event"}`]={localeClass:n,text:`L{split${t?"Task":"Event"}}`,icon:"b-icon b-icon-cut",disabled:e.readOnly,weight:650,separator:!0,onItem(a){n.splitEvent(a)}};const r=i.target.closest(".b-sch-event-segment");if(r){const a=n.client.resolveEventRecord(r);s.renameSegment={localeClass:n,text:"L{renameSegment}",icon:"b-icon b-icon-rename",disabled:e.readOnly||a.readOnly,weight:660,onItem(){n.rename(a,r)}}}}}getSplitDate(e){const{eventRecord:t,date:s,timeAxis:i}=e;return i.roundDate(s,t.startDate)}getSplitDuration(e){const{splitDuration:t,minSplitDuration:s,maxSplitDuration:i}=this;if(t!=null&&t.magnitude)return t.magnitude;const{eventRecord:n,tick:r}=e;if(r){const a=this.getSplitDurationUnit(e),{project:o}=n;let c=r.endDate-r.startDate;if(i){const d=o.run("$convertDuration",i.magnitude,i.unit||a,"millisecond");c=Math.min(c,d)}if(s){const d=o.run("$convertDuration",s.magnitude,s.unit||a,"millisecond");c=Math.max(c,d)}return o.run("$convertDuration",c,"millisecond",a)}}getSplitDurationUnit(e){const{splitDuration:t}=this;return(t==null?void 0:t.unit)||e.eventRecord.durationUnit}splitEvent(e){const{client:t}=e.feature,{timeAxis:s}=t;e.date=t.getDateFromXY(e.point,void 0,!1),e.tick=s.getSnappedTickFromDate(e.date),e.timeAxis=s,e.eventRecord.splitToSegments(this.getSplitDate(e),this.getSplitDuration(e),this.getSplitDurationUnit(e))}rename(e,t){const{client:s}=this;new ol({owner:s,appendTo:s.timeAxisSubGridElement,scrollAction:"realign",align:{align:"c-c"},cls:"b-event-segment-renamer",internalListeners:{complete(){s.refresh()},thisObj:this}}).startEdit({target:t,record:e,field:"name"})}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}generateSegmentRenderData(e,t){const{client:s}=this;let i,n;if(s.isGantt){const a=s.currentOrientation,o=a.getTaskBox(e),c={taskRecord:e,task:e,row:t.row,children:[]};o&&Object.assign(c,{isTask:!0,top:o.top,left:o.left,width:o.width,height:o.height}),a.internalPopulateTaskRenderData(c,e),n=c}else n=s.generateRenderData(e,t.resourceRecord,!0);if(n){var r;const a=n.eventColor||t.eventColor,o=vt.isNamedColor(a);i={segmentRecord:e,eventContent:n.eventContent||n.taskContent,cls:n.cls||((r=e.cls)===null||r===void 0?void 0:r.clone())||new ll,top:t.top,left:n.left-t.left,width:n.width,height:t.height,style:""},a&&!o&&(i.style={"background-color":a},t.eventColor&&t._customColorStyle&&(t.style=t.style.replace(t._customColorStyle,""))),Object.assign(i.cls,{[`b-sch-color-${a}`]:o,"b-sch-color-none":!a,"b-sch-event-segment":!0,"b-first":!e.previousSegment,"b-last":!e.nextSegment},n.cls),vt.isNamedColor(a)?i.cls[`b-sch-color-${a}`]=a:a?(i.style=`background-color:${a};`+i.style,i.cls["b-sch-custom-color"]=1):t.wrapperCls["b-sch-color-none"]=1}return i}appendDOMConfig(e){const t=e.eventRecord||e.taskRecord;if(t.segments&&!this.disabled){const s=e.eventContent||e.taskContent,i=e.children.indexOf(s);i>-1&&e.children.splice(i,1),delete e.eventContent,delete e.taskContent,e.cls["b-segmented"]=!0,e.segments=t.segments.map(n=>this.generateSegmentRenderData(n,e)),e.segmentsDOMConfig=e.segments.map(this.getSegmentDOMConfig.bind(this)),e.children.unshift({syncOptions:{syncIdField:"segment",releaseThreshold:0},className:"b-sch-event-segments",dataset:{taskBarFeature:"segments"},children:e.segmentsDOMConfig})}}getSegmentDOMConfig(e,t){return{className:e.cls,style:{style:e.style,left:e.left,height:e.height,width:e.width,...e.style},dataset:{segment:t},syncOptions:{syncIdField:"taskBarFeature"},children:[e.eventContent]}}onEventDataGenerated(e){this.appendDOMConfig(e)}onTaskDataGenerated(e){this.appendDOMConfig(e)}get featureClass(){}}M(ht,"$name","EventSegments"),M(ht,"configurable",{splitDuration:0,maxSplitDuration:{magnitude:1,unit:"day"},minSplitDuration:0}),M(ht,"pluginConfig",{override:["getElementsFromEventRecord","resolveEventRecord","resolveTaskRecord","onElementMouseOut"],chain:["populateTaskMenu","populateEventMenu","onTaskDataGenerated","onEventDataGenerated"]}),ht._$name="EventSegments",ue.registerFeature(ht,!0,"SchedulerPro"),ue.registerFeature(ht,!0,"Gantt");function ft(l){return`b-task-percent-bar${l[0]?`-${l[0]}`:""}`}class Ci extends kn(Fn){static get $name(){return"PercentBar"}static get configurable(){return{allowResize:!0,showPercentage:!0,instantUpdate:!0,valueField:"percentDone",displayField:"renderedPercentDone"}}static get pluginConfig(){return{chain:["onPaint",{fn:"onTaskDataGenerated",prio:-1e4},{fn:"onEventDataGenerated",prio:-1e4}]}}onPaint({firstPaint:e}){if(e){const t=this,{client:s}=t;t.drag=new Sl({name:"percentBarHandle",lockX:s.isVertical,lockY:s.isHorizontal,targetSelector:`${s.eventSelector} .b-task-percent-bar-handle`,dragThreshold:1,outerElement:s.timeAxisSubGridElement,internalListeners:{beforeDragStart:"onBeforeDragStart",dragStart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",thisObj:t}}),t.detachListeners("view"),t.client.ion({name:"view",[`${s.scheduledEventName}mouseenter`]:"onTimeSpanMouseEnter",[`${s.scheduledEventName}mouseleave`]:"onTimeSpanMouseLeave",thisObj:t})}}get sizeProp(){return this.client.isVertical?"height":"width"}get offsetSizeProp(){return this.client.isVertical?"offsetHeight":"offsetWidth"}get positionProp(){return this.client.isVertical?"top":this.client.rtl?"right":"left"}get offsetPositionProp(){return this.client.isVertical?"offsetTop":this.client.rtl?"offsetRight":"offsetLeft"}updateAllowResize(e){this.client.element.classList.toggle(ft`drag-disabled`,!e)}updateShowPercentage(e){this.client.element.classList.toggle(ft`show-percentage`,!!e)}doDestroy(){var e;(e=this.drag)===null||e===void 0||e.destroy(),super.doDestroy()}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}reset(e){const t=this,{client:s}=t,{project:i}=s;if(s.element.classList.remove(ft`resizing-task`),t.isMouseInsideEvent||(t.handle.remove(),t.handle=null),s.transactionalFeaturesEnabled)e.valid?t.finishFeatureTransaction():t.rejectFeatureTransaction();else if(t.instantUpdate){const{stm:n}=i;n.disabled||(t._stmTransactionStarted&&(e.valid?n.stopTransaction():n.rejectTransaction()),n.autoRecord=t.oldStmAutoRecord,t._stmTransactionStarted=!1)}t.instantUpdate&&(i.resumeAutoSync(),s.eventStore.resumeAutoCommit())}getPercentBarDOMConfig(e){return{className:ft`outer`,dataset:{taskBarFeature:"percentBar"},children:[{className:ft``,dataset:{percent:e.getValue(this.displayField)},style:{[this.sizeProp]:e.getValue(this.valueField)+"%"}}]}}appendDOMConfig(e,t,s){if((e.isEvent||e.isTask)&&!e.isMilestone&&!this.disabled){const{eventSegments:i}=this.client.features;e.isSegmented&&i!==null&&i!==void 0&&i.enabled?e.segments.forEach((n,r)=>{s.segmentsDOMConfig[r].children.unshift(this.getPercentBarDOMConfig(n))}):t.unshift(this.getPercentBarDOMConfig(e))}}onEventDataGenerated(e){this.appendDOMConfig(e.eventRecord,e.children,e)}onTaskDataGenerated(e){this.appendDOMConfig(e.taskRecord,e.children,e)}getHoverSegment(e){const t=(e.toElement||e.target).closest(".b-sch-event-segment");if(t){const s=Qt.from(t);if(s!=null&&s.contains(cl.getPagePoint(e)))return t}}isOverSegment(e){return!!this.getHoverSegment(e)}onTimeSpanMouseEnter(e){const t=this,{client:s,sizeProp:i}=t,n=e[`${s.scheduledEventName}Record`];if(!(n.isMilestone||n.readOnly||t.disabled||n.isParent||!n.isEditable(t.valueField)))if(t.drag.context)n===t.drag.context.taskRecord&&(t.isMouseInsideEvent=!0);else{const r=e[`${s.scheduledEventName}Element`],a=Se.getChild(r,s.scheduledEventName);if(!t.handle){const o={percent:n.getValue(t.valueField)};let c=n.getValue(t.valueField)+"%";const{eventSegments:d}=s.features;if(n.isSegmented&&d!==null&&d!==void 0&&d.enabled){o.segment=0;const u=Qt.from(a);let h,f;n.segments.some((p,g)=>{if(!p[t.valueField]&&h!==100)return!0;h=p[t.valueField],o.segment=g;const m=Se.getChild(a,`segments.${g}.percentBar`).firstChild;f=Qt.from(m)}),s.isVertical?c=f?f.top+f[i]-u.top:0:s.rtl?c=f?f.right+f[i]-u.right:0:c=f?f.left+f[i]-u.left:0}t.handle=vt.createElement({parent:a,className:ft`handle`,style:{[t.positionProp]:c},dataset:o})}t.isMouseInsideEvent=!0}}onTimeSpanMouseLeave(e){const t=this;!t.drag.context&&t.handle&&e.event.toElement!==t.handle&&(t.handle.remove(),t.handle=null),t.isMouseInsideEvent=!1}onBeforeDragStart({source:e,context:t,event:s}){const{client:i,offsetPositionProp:n,offsetSizeProp:r}=this,{eventSegments:a}=i.features,{element:o}=t,c=i.resolveEventRecord(o);let d,u,h,f;if(c.isSegmented&&a!==null&&a!==void 0&&a.enabled){const p=o.dataset.segment;d=Se.getChild(o.parentElement,`segments.${p}.percentBar`),u=d.firstElementChild,f=o.parentElement[r],h=Se.getChild(o.parentElement,`segments.${p}`)[n]+u[r]}else d=Se.getChild(o.parentElement,"percentBar"),u=d.firstElementChild,f=d[r],h=u[r];i.isVertical?(e.minY=-h,e.maxY=f-h):i.rtl?(e.maxX=h,e.minX=-(f-h)):(e.minX=-h,e.maxX=f-h),Object.assign(t,{percentBar:u,initialPos:h,size:f,taskRecord:c,initialValue:c.getValue(this.valueField),domEvent:s})}async onDragStart({context:e,event:t}){const s=this,{client:i}=s,{project:n}=i;i.element.classList.add(ft`resizing-task`),e.element.retainElement=!0,e.domEvent=t,i.trigger("percentBarDragStart",e),i.transactionalFeaturesEnabled?await s.startFeatureTransaction():n.stm.disabled||(this.oldStmAutoRecord=n.stm.autoRecord,n.stm.autoRecord=!1),s.instantUpdate&&(n.suspendAutoSync(),i.eventStore.suspendAutoCommit())}onDrag({context:e,event:t}){const s=this,{sizeProp:i,offsetSizeProp:n,client:r}=s,a=r.isHorizontal?Math.round((e.initialPos+e.newX*(r.rtl?-1:1))/e.size*100):Math.round((e.initialPos+e.newY)/e.size*100),{eventSegments:o}=r.features;if(s.instantUpdate){if(!r.transactionalFeaturesEnabled){const{stm:c}=r.project;!c.disabled&&!c.transaction&&(c.startTransaction(),s._stmTransactionStarted=!0)}e.taskRecord.set(s.valueField,a)}e.domEvent=t,e.percent=e.element.dataset.percent=a,e.taskRecord.isSegmented&&o!==null&&o!==void 0&&o.enabled&&e.taskRecord.segments.forEach((c,d)=>{const u=Se.getChild(e.element.parentElement,`segments.${d}.percentBar`).firstChild,h=Se.getChild(e.element.parentElement,`segments.${d}`);if(e.percent>=c.endPercentDone)u.style[i]=h[n]+"px";else if(e.percent<=c.startPercentDone)u.style[i]="0";else if(e.percent>=c.startPercentDone&&e.percent<=c.endPercentDone){const f=c.endPercentDone-c.startPercentDone;u.style[i]=(a-c.startPercentDone)*h[n]/f+"px"}}),r.trigger("percentBarDrag",e)}onDragAbort({context:e,event:t}){e.taskRecord.isSegmented&&(e.percentBar.style[this.sizeProp]=e.taskRecord.segments[e.element.dataset.segment][this.valueField]+"%"),e.taskRecord.set(this.valueField,e.initialValue),e.domEvent=t,this.reset(e),this.client.trigger("percentBarDragAbort",e)}onDrop({context:e}){const t=this,{taskRecord:s}=e,{eventSegments:i}=t.client.features;s.set(t.valueField,e.percent),s.isSegmented&&i!==null&&i!==void 0&&i.enabled?s.segments.some((n,r)=>{if(e.percent>=n.startPercentDone&&e.percent<=n.endPercentDone){const a=n.endPercentDone-n.startPercentDone,o=Se.getChild(e.element.parentElement,`segments.${r}`),c=parseInt(o.style[t.sizeProp])+(e.percent-n.startPercentDone)*o[t.offsetSizeProp]/a;return e.element.style.cssText=`${t.positionProp}: ${c}px`,e.element.dataset.segment=r,!0}}):e.element.style.cssText=`${t.positionProp}: ${t.client.rtl?100-e.percent:e.percent}%`,t.reset(e),t.client.trigger("percentBarDrop",e)}get featureClass(){}}Ci._$name="PercentBar",ue.registerFeature(Ci,!1,"SchedulerPro"),ue.registerFeature(Ci,!0,"Gantt");var lr=l=>class extends(l||dl(de)){get isReadyStatePropagator(){return!0}get canSave(){return!0}requestReadyStateChange(){this.trigger("readystatechange",{canSave:this.canSave})}get widgetClass(){}};const cc={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",ConstraintTypePicker:{none:"None",assoonaspossible:"As soon as possible",aslateaspossible:"As late as possible",muststarton:"Must start on",mustfinishon:"Must finish on",startnoearlierthan:"Start no earlier than",startnolaterthan:"Start no later than",finishnoearlierthan:"Finish no earlier than",finishnolaterthan:"Finish no later than"},SchedulingDirectionPicker:{Forward:"Forward",Backward:"Backward",inheritedFrom:"Inherited from",enforcedBy:"Enforced by"},CalendarField:{"Default calendar":"Default calendar"},TaskEditorBase:{Information:"Information",Save:"Save",Cancel:"Cancel",Delete:"Delete",calculateMask:"Calculating...",saveError:"Can't save, please correct errors first",repeatingInfo:"Viewing a repeating event",editRepeating:"Edit"},TaskEdit:{"Edit task":"Edit task",ConfirmDeletionTitle:"Confirm deletion",ConfirmDeletionMessage:"Are you sure you want to delete the event?"},GanttTaskEditor:{editorWidth:"44em"},SchedulerTaskEditor:{editorWidth:"34em"},SchedulerGeneralTab:{labelWidth:"6em",General:"General",Name:"Name",Resources:"Resources","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Preamble:"Preamble",Postamble:"Postamble"},GeneralTab:{labelWidth:"6.5em",General:"General",Name:"Name","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Dates:"Dates"},SchedulerAdvancedTab:{labelWidth:"13em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Inactive:"Inactive","Ignore resource calendar":"Ignore resource calendar"},AdvancedTab:{labelWidth:"11.5em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Constraint:"Constraint",Rollup:"Rollup",Inactive:"Inactive","Ignore resource calendar":"Ignore resource calendar","Scheduling direction":"Scheduling direction"},DependencyTab:{Predecessors:"Predecessors",Successors:"Successors",ID:"ID",Name:"Name",Type:"Type",Lag:"Lag",cyclicDependency:"Cyclic dependency",invalidDependency:"Invalid dependency"},NotesTab:{Notes:"Notes"},ResourcesTab:{unitsTpl:({value:l})=>`${l}%`,Resources:"Resources",Resource:"Resource",Units:"Units"},RecurrenceTab:{title:"Repeat"},SchedulingModePicker:{Normal:"Normal","Fixed Duration":"Fixed Duration","Fixed Units":"Fixed Units","Fixed Effort":"Fixed Effort"},ResourceHistogram:{barTipInRange:'<b>{resource}</b> {startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated',barTipOnDate:'<b>{resource}</b> on {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated',groupBarTipAssignment:'<b>{resource}</b> - <span class="{cls}">{allocated} of {available}</span>',groupBarTipInRange:'{startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',groupBarTipOnDate:'On {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',plusMore:"+{value} more"},ResourceUtilization:{barTipInRange:'<b>{event}</b> {startDate} - {endDate}<br><span class="{cls}">{allocated}</span> allocated',barTipOnDate:'<b>{event}</b> on {startDate}<br><span class="{cls}">{allocated}</span> allocated',groupBarTipAssignment:'<b>{event}</b> - <span class="{cls}">{allocated}</span>',groupBarTipInRange:'{startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',groupBarTipOnDate:'On {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',plusMore:"+{value} more",nameColumnText:"Resource / Event"},SchedulingIssueResolutionPopup:{"Cancel changes":"Cancel the change and do nothing",schedulingConflict:"Scheduling conflict",emptyCalendar:"Calendar configuration error",cycle:"Scheduling cycle",Apply:"Apply"},CycleResolutionPopup:{dependencyLabel:"Please select a dependency:",invalidDependencyLabel:"There are invalid dependencies involved that need to be addressed:"},DependencyEdit:{Active:"Active"},SchedulerProBase:{propagating:"Calculating project",storePopulation:"Loading data",finalizing:"Finalizing results"},EventSegments:{splitEvent:"Split event",renameSegment:"Rename"},NestedEvents:{deNestingNotAllowed:"De-nesting not allowed",nestingNotAllowed:"Nesting not allowed"},VersionGrid:{compare:"Compare",description:"Description",occurredAt:"Occurred At",rename:"Rename",restore:"Restore",stopComparing:"Stop Comparing"},Versions:{entityNames:{TaskModel:"task",AssignmentModel:"assignment",DependencyModel:"link",ProjectModel:"project",ResourceModel:"resource",other:"object"},entityNamesPlural:{TaskModel:"tasks",AssignmentModel:"assignments",DependencyModel:"links",ProjectModel:"projects",ResourceModel:"resources",other:"objects"},transactionDescriptions:{update:"Changed {n} {entities}",add:"Added {n} {entities}",remove:"Removed {n} {entities}",move:"Moved {n} {entities}",mixed:"Changed {n} {entities}"},addEntity:"Added {type} **{name}**",removeEntity:"Removed {type} **{name}**",updateEntity:"Changed {type} **{name}**",moveEntity:"Moved {type} **{name}** from {from} to {to}",addDependency:"Added link from **{from}** to **{to}**",removeDependency:"Removed link from **{from}** to **{to}**",updateDependency:"Edited link from **{from}** to **{to}**",addAssignment:"Assigned **{resource}** to **{event}**",removeAssignment:"Removed assignment of **{resource}** from **{event}**",updateAssignment:"Edited assignment of **{resource}** to **{event}**",noChanges:"No changes",nullValue:"none",versionDateFormat:"M/D/YYYY h:mm a",undid:"Undid changes",redid:"Redid changes",editedTask:"Edited task properties",deletedTask:"Deleted a task",movedTask:"Moved a task",movedTasks:"Moved tasks"}};Mr.publishLocale(cc);class Rn extends Or.mixin(lr){static get $name(){return"TaskEditorBase"}static get type(){return"taskeditorbase"}static get configurable(){return{localizableProperties:["width"],title:"L{Information}",cls:"b-schedulerpro-taskeditor",closable:!0,layout:"fit",draggable:{handleSelector:":not(button,.b-field-inner)"},items:null,bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{text:"L{Save}",color:"b-blue",cls:"b-raised",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}},strips:{occurrenceInfoToolbar:{cls:"occurrence-info-toolbar",hidden:!0,ignoreParentReadOnly:!0,items:[{type:"widget",tag:"i",cls:"b-icon b-icon-locked"},{ref:"occurrenceInfoText",type:"label",localeClass:this,text:"L{repeatingInfo}"},"->",{ref:"editOccurrenceButton",localeClass:this,text:"L{editRepeating}",onClick:"up.onEditOccurrenceClick"}]}},width:{$config:{localeKey:"L{editorWidth}"}},maximizeOnMobile:!0,includeAsapAlapAsConstraints:!0}}static get defaultConfig(){return{axisLock:"flexible",autoClose:!0,onChange:null,onCancel:null,onSave:null,autoShow:!1,blurAction:"cancel",scrollAction:"realign",durationDisplayPrecision:1,tabPanelItems:null,defaultTabs:null,calculateMask:null,calculateMaskDelay:100,localizableProperties:["calculateMask"],project:null,dependencyIdField:null}}processWidgetConfig(e){var t;if((t=e.type)!==null&&t!==void 0&&t.includes("date")&&e.weekStartDay==null&&(e.weekStartDay=this.weekStartDay),e.ref==="tabs"&&this.extraItems){const s={};for(const i in this.extraItems){const n=i.replace("tab","Tab");s[n]={items:Array.isArray(this.extraItems[i])?H.transformArrayToNamedObject(this.extraItems[i]):this.extraItems[i]}}H.merge(e.items,s)}return e}changeItems(e){var t;const{tabPanelItems:s={}}=this,i=H.clone(e),n=((t=i.find)===null||t===void 0?void 0:t.call(i,r=>r.ref==="tabs"))||i.tabs;return this.cleanItemsConfig(s),H.merge(n.items,s),super.changeItems(i)}cleanItemsConfig(e){for(const t in e){const s=e[t];s===!0?delete e[t]:s!=null&&s.items&&this.cleanItemsConfig(s.items)}}afterConfigure(){var e;const t=this,{widgetMap:s}=t,{tabs:i}=s,{cancelButton:n,deleteButton:r,saveButton:a}=((e=t.bbar)===null||e===void 0?void 0:e.widgetMap)||{};a==null||a.ion({click:"onSaveClick",thisObj:t}),n==null||n.ion({click:"onCancelClick",thisObj:t}),r==null||r.ion({click:"onDeleteClick",thisObj:t}),Object.values(s).forEach(o=>{o.isDurationField?o.decimalPrecision=this.durationDisplayPrecision:o.ref==="startDate"||o.ref==="endDate"?o.project=this.project:(o.ref==="predecessorsTab"||o.ref==="successorsTab")&&(o.grid.durationDisplayPrecision=this.durationDisplayPrecision,o.dependencyIdField=o.dependencyIdField||t.dependencyIdField),o.isReadyStatePropagator&&o.ion({readyStateChange:"onReadyStateChange",thisObj:t})}),i.onFieldChange=({source:o})=>{const{name:c,isValid:d,value:u}=o;t.loadedRecord&&c&&d&&!t.isLoadingEvent&&!o.up("recurrenceeditorpanel")&&t.loadedRecord.setValue(c,u)}}get canSave(){let e=!0;return Object.values(this.widgetMap).forEach(t=>{t.isReadyStatePropagator&&(e=e&&t.canSave)}),e}async hide(){const e=this;e.detachListeners("project"),e.detachListeners("eventStore"),e._delayedAction=null;const t=await super.hide(this.element.matches(":focus-within"));return e.isDestroyed||e.trigger(e.blurAction),t}toggleFieldsDisabled(e){this.eachWidget(t=>{t.isField&&t.name&&!t.up("recurrenceeditorpanel")&&e.isEditable(t.name)!==void 0&&(t.disabled=!e.isEditable(t.name))})}loadEvent(e,t=!1){var n;const s=this,i=(n=s.project)!=null?n:e.project;s.isLoadingEvent=!0,s.includeAsapAlapAsConstraints=i.includeAsapAlapAsConstraints,s.widgetMap.occurrenceInfoToolbar.hidden=!e.isOccurrence&&!e.isRecurring||s.editingRecurring,s.toggleFieldsDisabled(e),s.callWidgetHook("loadEvent",e,t),s.detachListeners("project"),s.loadedRecord=e,i.ion({name:"project",beforeCommit:"onProjectBeforeCommit",dataReady:"onProjectDataReady",thisObj:s}),s.detachListeners("eventStore"),i.eventStore.ion({name:"eventStore",remove:"onTaskRemove",thisObj:s}),s.isLoadingEvent=!1,s.trigger("loadEvent")}callWidgetHook(e,...t){this.eachWidget(s=>{typeof s[e]=="function"&&s[e](...t)})}onDocumentMouseDown(e){const t=this,s=Object.values(t.widgetMap).some(n=>n._activeCellEdit);let i=null;if(s){const{event:n}=e,{saveButton:r,cancelButton:a,deleteButton:o}=t.widgetMap,c=n.target.closest("button");if(c)switch(c){case(r==null?void 0:r.element):i=t.onSaveClick;break;case(a==null?void 0:a.element):i=t.onCancelClick;break;case(o==null?void 0:o.element):i=t.onDeleteClick;break}}t._delayedAction=i,super.onDocumentMouseDown(e)}onSaveClick(){const e=this;e._delayedAction=null,e.canSave?e.trigger("save"):ul.show({rootElement:e.rootElement,html:e.L("L{saveError}")})}onCancelClick(){this.close()}onDeleteClick(){this._delayedAction=null,this.trigger("delete")}onPropagationRequested(){this.trigger("requestPropagation")}onReadyStateChange({source:e,canSave:t}){this.requestReadyStateChange(),e.couldSaveTitle||(e.couldSaveTitle=e.title),e.parent===this.widgetMap.tabs&&(t?(e.tab.element.classList.remove("b-invalid"),e.tab.icon=null,e.title=e.couldSaveTitle,e.couldSaveTitle=null):(e.tab.element.classList.add("b-invalid"),e.tab.icon="b-icon-warning",e.title=e.couldSaveTitle))}onTaskRemove(){this.afterDelete()}onProjectBeforeCommit(){this.calculateMask&&this.mask({text:this.calculateMask,showDelay:this.calculateMaskDelay})}onProjectDataReady({records:e}){var t;const s=this;s.calculateMask&&s.unmask(),e.has(s.loadedRecord)&&s.callWidgetHook("afterProjectChange"),(t=s._delayedAction)===null||t===void 0||t.call(s)}beforeSave(){this.callWidgetHook("beforeSave")}afterSave(){this.loadedRecord=void 0,this.callWidgetHook("afterSave")}beforeCancel(){this.callWidgetHook("beforeCancel")}afterCancel(){this.loadedRecord=void 0,this.callWidgetHook("afterCancel")}beforeDelete(){this.callWidgetHook("beforeDelete")}afterDelete(){this.loadedRecord=void 0,this.callWidgetHook("afterDelete")}onInternalKeyDown(e){if(!e.handled&&e.key==="Enter"&&this.saveAndCloseOnEnter&&e.target.tagName.toLowerCase()==="input"){if(e.target.matches("input")){const t=Oi.fromElement(e.target);t!=null&&t.internalOnChange&&!t.isCheckbox&&!t.isSlider&&t.internalOnChange()}e.preventDefault(),this.onSaveClick()}super.onInternalKeyDown(e)}onEditOccurrenceClick(){const e=this;Oi.create({type:"recurrenceconfirmation",owner:e}).confirm({actionType:"update",eventRecord:e.loadedRecord,changerFn:s=>{var n;const i=(n=s.recurringTimeSpan)!=null?n:s;e.resetRecurrenceData={recurringTimeSpan:i,originalExceptionDates:{...i.exceptionDates}},s.isRecurring||(s.convertToRealEvent({startDate:s.startDate}),s.constraintDate=null)},finalizerFn:s=>{s.isRecurring&&(e.editingRecurring=!0,e.readOnly=!1),e.loadEvent(s)}})}updateReadOnly(e){const{deleteButton:t,saveButton:s,cancelButton:i,tabs:n}=this.widgetMap,{items:r}=n;super.updateReadOnly(e),t&&(t.hidden=e),s&&(s.hidden=e),i&&(i.hidden=e);for(let a=0,{length:o}=r;a<o;a++)r[a].readOnly=e}updateIncludeAsapAlapAsConstraints(){this.eachWidget(e=>{e.includeAsapAlapAsConstraints=this.includeAsapAlapAsConstraints})}}Rn.initClass(),Rn._$name="TaskEditorBase";var To=l=>class extends(l||jr){get project(){var i;var t,s;return(i=(t=this.up(n=>n.isTaskEditorBase))===null||t===void 0?void 0:t.project)!=null?i:(s=this.record)===null||s===void 0?void 0:s.project}loadEvent(t,s){this.setRecord(t,s)}resetData(){this.record=null}beforeSave(){}afterSave(){this.resetData()}beforeCancel(){}afterCancel(){this.resetData()}beforeDelete(){}afterDelete(){this.resetData()}get widgetClass(){}};class Wt extends jr.mixin(To,lr){static get $name(){return"EditorTab"}static get type(){return"editortab"}static get configurable(){return{title:null,strictRecordMapping:!0}}}Wt._$name="EditorTab";class He extends Wt{static get $name(){return"FormTab"}static get type(){return"formtab"}static get defaultConfig(){return{layoutStyle:{flexFlow:"row wrap",alignItems:"flex-start",alignContent:"flex-start"},autoUpdateRecord:!0}}onFieldChange({source:e,valid:t,userAction:s}){s&&(t=t!==void 0?t:typeof e.isValid=="function"?e.isValid():e.isValid,t&&super.onFieldChange(...arguments))}}He.initClass(),He._$name="FormTab";const dc=new Date(2300,0,1);class cr extends xr{static get $name(){return"StartDateField"}static get type(){return"startdatefield"}static get alias(){return"startdate"}static get defaultConfig(){return{project:null,eventRecord:null,strictParsing:!0,minDateDelta:"-10 years",maxDateDelta:"200 years"}}get calendarProvider(){var t;var e;return((t=(e=this.eventRecord)===null||e===void 0?void 0:e.recurringEvent)!=null?t:this.eventRecord)||this.project}get backShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit)}get forwardShiftDate(){const e=this;let t=e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit);return t=t&&e.calendarProvider.run("skipNonWorkingTime",t,!0),t}transformTimeValue(e){const{calendarProvider:t,keepTime:s}=this;if(t&&s!=="entered"){const i=O.clearTime(e),n=t.run("skipNonWorkingTime",i);if(O.isValidDate(n)&&O.isEqual(n,i,"day"))return O.copyTimeValues(i,n)}return super.transformTimeValue(e)}get min(){var e;return super.min||(e=this.project)!==null&&e!==void 0&&e.startDate?O.add(this.project.startDate,this.minDateDelta):null}set min(e){super.min=e}get max(){var e;return super.max||(e=this.project)!==null&&e!==void 0&&e.startDate?O.add(this.project.startDate,this.maxDateDelta):dc}set max(e){super.max=e}}cr.initClass(),cr._$name="StartDateField";const uc=new Date(2300,0,1);class dr extends xr{static get $name(){return"EndDateField"}static get type(){return"enddatefield"}static get alias(){return"enddate"}static get defaultConfig(){return{project:null,eventRecord:null,strictParsing:!0}}get min(){var e;let t=this._min;const s=(e=this.eventRecord)===null||e===void 0?void 0:e.startDate;return s&&(t=O.max(t||s,s)),t}set min(e){super.min=e}get max(){var e;return super.max||(e=this.project)!==null&&e!==void 0&&e.startDate?O.add(this.project.startDate,200,"year"):uc}set max(e){super.max=e}get calendarProvider(){var t;var e;return((t=(e=this.eventRecord)===null||e===void 0?void 0:e.recurringEvent)!=null?t:this.eventRecord)||this.project}get backShiftDate(){const e=this;let t=e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit);return t=t&&e.calendarProvider.run("skipNonWorkingTime",t,!1),t}get forwardShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit)}transformTimeValue(e){const{calendarProvider:t,keepTime:s}=this;if(t&&s!=="entered"){const i=O.clearTime(e),n=O.add(i,1,"day"),r=t.run("skipNonWorkingTime",n,!1);if(O.isValidDate(r)&&O.isEqual(r,i,"day"))return O.copyTimeValues(i,r)}return!s&&e&&this.min&&O.clearTime(e,!1)<this.min?this.min:super.transformTimeValue(e)}}dr.initClass(),dr._$name="EndDateField";class zt extends El{}M(zt,"$name","EffortField"),M(zt,"type","effort"),M(zt,"alias","effortfield"),zt.initClass(),zt._$name="EffortField";class ur extends He{static get $name(){return"GeneralTab"}static get type(){return"generaltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this},items:{name:{type:"text",weight:100,required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name"},percentDone:{type:"number",weight:200,label:"L{% complete}",name:"renderedPercentDone",cls:"b-percent-done b-half-width",min:0,max:100},effort:{type:"effort",weight:300,label:"L{Effort}",name:"fullEffort",cls:"b-half-width"},divider:{html:"",weight:400,dataset:{text:this.L("L{Dates}")},cls:"b-divider",flex:"1 0 100%"},startDate:{type:"startdate",weight:500,label:"L{Start}",name:"startDate",cls:"b-start-date b-half-width"},endDate:{type:"enddate",weight:600,label:"L{Finish}",name:"endDate",cls:"b-end-date b-half-width"},duration:{type:"durationfield",weight:700,label:"L{Duration}",name:"fullDuration",cls:"b-half-width"},colorField:{type:"eventcolorfield",weight:800,label:"L{SchedulerBase.color}",name:"eventColor",cls:"b-half-width"}}}}loadEvent(e){const t={unit:e.durationUnit,magnitude:1},{startDate:s,endDate:i,effort:n}=this.widgetMap;s&&(s.step=t,s.eventRecord=e),i&&(i.step=t,i.eventRecord=e),n&&(n.unit=e.effortUnit),super.loadEvent(e)}}ur.initClass(),ur._$name="GeneralTab";const $o=l=>l.map((e,t)=>[t,e]);class hr extends Kt{static get $name(){return"DependencyTypePicker"}static get type(){return"dependencytypepicker"}construct(e){super.construct(e),hl.ion({locale:()=>{this.items=$o(this.L("L{DependencyType.long}"))},thisObj:this})}get store(){return this._items||(this.items=this._items=$o(this.L("L{DependencyType.long}"))),super.store}set store(e){super.store=e}}hr.initClass(),hr._$name="DependencyTypePicker";const hc=(l,e)=>{l.instanceMeta(e).valid=!0},Io=(l,e)=>{l.instanceMeta(e).valid=!1},fr=(l,e)=>l.instanceMeta(e).valid!==!1;class Di extends Wt{static get $name(){return"DependencyTab"}static get type(){return"dependencytab"}static get configurable(){return{dependencyIdField:null,layoutStyle:{flexFlow:"column nowrap"},sortField:null,taskComboSortField:"name",items:{grid:{type:"grid",weight:100,flex:"1 1 auto",emptyText:"",asyncEventSuffix:"PreCommit",disableGridRowModelWarning:!0,features:{group:!1},columns:{data:{id:{localeClass:this,text:"L{ID}",flex:1,editor:!1,htmlEncode:!1,hidden:!0,sortable(e,t){var s,i;const{dependencyIdField:n,direction:r}=this.grid.parent,a=(s=e[r])===null||s===void 0?void 0:s[n],o=(i=t[r])===null||i===void 0?void 0:i[n];return a===o?0:a<o?-1:1},renderer:({record:e,row:t,grid:s,column:i})=>{let n;const{direction:r}=s.parent,a=e[r];if(a&&fr(e,s)){const o=s.parent.dependencyIdField,c=a[o];o==="id"?n=!a||a.hasGeneratedId?"*":a.id:n=c}else t.addCls("b-invalid"),n='<div class="b-icon b-icon-warning"></div>';return n}},name:{localeClass:this,text:"L{Name}",flex:5,renderer:({value:e,grid:t,cellElement:s})=>{if(e){s.classList.toggle("b-inactive",e.inactive);const i=e[t.parent.dependencyIdField];return e.name+(i!=null&&!e.hasGeneratedId?` (${i})`:"")}return""},finalizeCellEdit:"up.finalizeLinkedTaskCellEdit",editor:{type:"modelcombo",displayField:"name",valueField:"id",filterOperator:"*",allowInvalid:!0,listItemTpl(e){const t=this,s=t._dependencyTab||(t._dependencyTab=t.up("dependencytab",!0)),{dependencyIdField:i}=s,n=e.hasGeneratedId&&i==="id"?null:e[i];return Xt.xss`${e.name}${n!=null?` (${n})`:""}`}}},type:{localeClass:this,text:"L{Type}",field:"type",flex:3,sortable:!1,editor:"dependencytypepicker",renderer({value:e}){return this.L("L{DependencyType.long}")[e]}},lag:{localeClass:this,text:"L{Lag}",type:"duration",field:"fullLag",flex:2,editor:{allowNegative:!0}}}}},toolbar:{type:"toolbar",dock:"bottom",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"b-icon b-icon-add",onAction:"up.onAddClick"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0,onAction:"up.onRemoveClick"}}}}}}async finalizeLinkedTaskCellEdit({grid:e,value:t,record:s}){const{project:i}=e.store.masterStore,n=this.direction==="toEvent",r=n?s.fromEvent:t,a=n?t:s.toEvent;switch(await i.validateDependency(r,a,s.type,s)){case gt.NoError:return!0;case gt.CyclicDependency:return"L{DependencyTab.cyclicDependency}"}return"L{DependencyTab.invalidDependency}"}afterConstruct(){super.afterConstruct(),(this.grid=this.widgetMap.grid).ion({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:this})}get taskCombo(){const{grid:e}=this,t=e==null?void 0:e.columns.get(this.direction);return t==null?void 0:t.editor}loadEvent(e){const t=this,{grid:s,taskCombo:i,record:n}=t;super.loadEvent(e);const{dependencyStore:r,eventStore:a}=t.project,o=s.store.masterStore!==r,c=!o&&e!==n;if(o){t.depStoreGeneration=r.storage.generation,t.eventStoreGeneration=a.storage.generation,t.detachListeners("taskCombo"),s.store=r.chain(u=>u[t.negDirection]===t.record,null);const d=i.store=a.chain(u=>u!==t.record,null,{doRelayToMaster:[],excludeCollapsedRecords:!1});d.sort(t.taskComboSortField),d.filterBy(u=>!s.store.find(h=>{const f=h[t.direction],p=t._activeCellEdit,g=p&&f===p.record[t.direction];return f===u&&!g})),i.ion({name:"taskCombo",change:"onGridCellEditChange",thisObj:t})}else s.store.resumeChain(),c||r.storage.generation!==t.depStoreGeneration?(s.store.fillFromMaster(),t.depStoreGeneration=r.storage.generation):s.refreshRows(),(c||a.storage.generation!==t.eventStoreGeneration)&&(i.store.fillFromMaster(),t.eventStoreGeneration=a.storage.generation);c&&s.store.sort(t.sortField),t.requestReadyStateChange()}async insertNewDependency(){const e=this,{grid:t}=e,{cellEdit:s}=t.features;s.isEditing&&!s.editor.isValid&&s.cancelEditing();const[i]=t.store.insert(0,{[e.negDirection]:e.record});return e.depStoreGeneration=e.project.dependencyStore.storage.generation,await t.features.cellEdit.startEditing({field:e.direction,id:i.id}),Io(i,t),i}beforeSave(){this.grid.store.suspendChain()}onAddClick(){this.insertNewDependency()}onRemoveClick(){const e=this,{grid:t}=e,s=t.selectedRecords;t.features.cellEdit.cancelEditing(!0),e.project.dependencyStore.remove(s),t.selectedRecord=t.store.getNext(s[0]),e.taskCombo.store.fillFromMaster()}onGridSelectionChange({selection:e}){const t=this.widgetMap.remove,s=!!(!(e!=null&&e.length)||this.up(i=>i.readOnly));t.containsFocus&&s&&this.grid.focusCell({rowIndex:-1,columnIndex:0}),t.disabled=s}clearActiveEditorErrors(){const e=this._activeCellEdit;e&&e.column.field===this.direction&&e.editor.inputField.clearError()}onGridCellEditChange(){this.clearActiveEditorErrors()}onGridStartCellEdit({editorContext:e}){const t=this,s=t._editingDependency=e.record,{grid:i,direction:n}=t;t._activeCellEdit=e,e.column.field===n&&(fr(s,i)?t.clearActiveEditorErrors():s[n]?e.editor.inputField.setError("L{DependencyTab.cyclicDependency}"):e.editor.inputField.setError("L{DependencyTab.invalidDependency}"))}async onGridFinishCellEdit({editorContext:e}){const t=this,{record:s,column:i}=e,{grid:n,direction:r}=t;i.field===r?(hc(s,n),t.taskCombo.store.fillFromMaster()):t.redrawDependencyRow(s),t._activeCellEdit=t._editingDependency=null,t.requestReadyStateChange()}afterCancel(){this._activeCellEdit&&this.grid.features.cellEdit.cancelEditing(!0)}onGridCancelCellEdit(){const e=this,t=e._editingDependency;t&&(t[e.direction]||(Io(t,e.grid),e.redrawDependencyRow(t)),e._activeCellEdit=e._editingDependency=null),e.requestReadyStateChange()}redrawDependencyRow(e){const{grid:t}=this,s=t.rowManager.getRowById(e);s&&t.store.indexOf(e)>=0&&s.render(t.store.indexOf(e),e)}get canSave(){const{grid:e}=this;return e.store.every(t=>fr(t,e))}updateReadOnly(e){const{add:t,remove:s}=this.widgetMap;super.updateReadOnly(...arguments),t.hidden=s.hidden=e}}Di._$name="DependencyTab";class pr extends Di{static get $name(){return"SuccessorsTab"}static get type(){return"successorstab"}static get configurable(){return{cls:"b-successors-tab",direction:"toEvent",negDirection:"fromEvent",title:"L{DependencyTab.Successors}",sortField:"toEventName",items:{grid:{columns:{data:{name:{field:"toEvent"}}}}}}}}pr.initClass(),pr._$name="SuccessorsTab";class gr extends Di{static get $name(){return"PredecessorsTab"}static get type(){return"predecessorstab"}static get configurable(){return{cls:"b-predecessors-tab",direction:"fromEvent",negDirection:"toEvent",title:"L{DependencyTab.Predecessors}",sortField:"fromEventName",items:{grid:{columns:{data:{name:{field:"fromEvent"}}}}}}}}gr.initClass(),gr._$name="PredecessorsTab";class mr extends Wt{static get $name(){return"ResourcesTab"}static get type(){return"resourcestab"}static get configurable(){return{title:"L{Resources}",cls:"b-resources-tab",layoutStyle:{flexFlow:"column nowrap"},showUnits:null,items:{grid:{type:"grid",weight:100,flex:"1 1 auto",columns:{data:{resource:{localeClass:this,text:"L{Resource}",field:"resource",flex:7,renderer:({value:e})=>(e==null?void 0:e.name)||"",editor:{type:"modelcombo",displayField:"name",valueField:"id"}},units:{type:"number",localeClass:this,text:"L{Units}",field:"units",flex:3,renderer:e=>this.L("L{unitsTpl}",e),min:0,max:100,step:10}}},disableGridRowModelWarning:!0,asyncEventSuffix:"PreCommit"},toolbar:{type:"toolbar",dock:"bottom",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"b-icon b-icon-add"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0}}}}}}afterConstruct(){super.afterConstruct();const e=this,t=e.addButton=e.widgetMap.add,s=e.removeButton=e.widgetMap.remove,i=e.grid=e.widgetMap.grid;t==null||t.ion({click:"onAddClick",thisObj:e}),s==null||s.ion({click:"onRemoveClick",thisObj:e}),i.ion({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:e})}updateReadOnly(e){const{add:t,remove:s}=this.widgetMap;super.updateReadOnly(...arguments),t.hidden=s.hidden=e}get resourceCombo(){var e;const t=(e=this.grid)===null||e===void 0?void 0:e.columns.get("resource");return t==null?void 0:t.editor}updateShowUnits(e){const t=this.widgetMap.grid.columns.get("units");t&&(t.hidden=!e)}loadEvent(e){const t=this,{resourceCombo:s,grid:i,record:n}=t;super.loadEvent(e);const{assignmentStore:r,resourceStore:a}=t.project,o=i.store.masterStore!==r,c=!o&&e!==n;typeof this.showUnits!="boolean"&&(i.columns.get("units").hidden=!e.isTask),o?(t.assignmentStoreGeneration=r.storage.generation,t.resourceStoreGeneration=a.storage.generation,i.store=r.chain(d=>t.record&&d.event===t.record,null),s.store=a.chain(d=>!d.isSpecialRow&&t.record&&!t.record.isAssignedTo(d)||!t.activeAssignment||t.activeAssignment.resource===d,null,{groupers:a.groupers})):(i.store.resumeChain(),(c||r.storage.generation!==t.assignmentStoreGeneration)&&i.store.fillFromMaster(),(c||a.storage.generation!==t.resourceStoreGeneration)&&s.store.fillFromMaster())}get activeAssignment(){return this.grid.features.cellEdit.activeRecord}async insertNewAssignment(){const e=this,{project:t,grid:s}=e,i=t.assignmentStore,[n]=i.insert(0,{event:e.record,resource:null,units:100});return e.assignmentStoreGeneration=i.storage.generation,await s.features.cellEdit.startEditing({field:"resource",id:n.id}),n}beforeSave(){this.pruneInvalidAssignments(),this.grid.store.suspendChain()}onAddClick(){this.insertNewAssignment()}onRemoveClick(){const e=this,{grid:t}=e;t.store.remove(t.selectedRecords),t.selectedRecords=null,e.removeButton.disable()}onGridSelectionChange({selection:e}){const{removeButton:t}=this,s=!(e!=null&&e.length)||this.up(i=>i.readOnly);t.containsFocus&&s&&this.grid.focus(),t.disabled=s}onGridStartCellEdit({editorContext:e}){e.column.field==="resource"&&(this.resourceCombo.store.fillFromMaster(),this._editingAssignment=e.record,this._activeCellEdit=e)}onGridFinishCellEdit(){this._activeCellEdit=this._editingAssignment=null}onGridCancelCellEdit(){this._activeCellEdit=this._editingAssignment=null}pruneInvalidAssignments(){const{store:e}=this.grid;e.remove(e.query(t=>!t.isValid))}}mr.initClass(),mr._$name="ResourcesTab";const fc={assoonaspossible:1,aslateaspossible:1};class Gt extends Kt{static get $name(){return"ConstraintTypePicker"}static get type(){return"constrainttypepicker"}static get configurable(){return{valueField:"id",store:{data:[{id:"none"},{id:"assoonaspossible"},{id:"aslateaspossible"},{id:"muststarton"},{id:"mustfinishon"},{id:"startnoearlierthan"},{id:"startnolaterthan"},{id:"finishnoearlierthan"},{id:"finishnolaterthan"}]},primaryFilter(e){return Gt.localize(e.id).toLowerCase().startsWith(this.value.toLowerCase())},includeAsapAlapAsConstraints:!0,nullValue:"none"}}loadEvent(e){this.taskRecord=e,this.store.filter()}set value(e){super.value=e}get value(){const e=super.value;return e==="none"?null:e}get inputValue(){var e;return this.L(((e=this.selected)===null||e===void 0?void 0:e.id)||this.nullValue)}listItemTpl(e){return Gt.localize(e.id)}changeStore(e){return super.changeStore({...e,filters:{filterBy:t=>{var s,i;return fc[t.id]?this._includeAsapAlapAsConstraints:(s=((i=this.taskRecord)===null||i===void 0?void 0:i.recurringEvent)||this.taskRecord)===null||s===void 0?void 0:s.run("isConstraintTypeApplicable",t.id)}}})}updateIncludeAsapAlapAsConstraints(){this.store.filter()}}Gt.initClass(),Gt._$name="ConstraintTypePicker";class Ht extends Kt{static get $name(){return"SchedulingDirectionPicker"}static get type(){return"schedulingdirectionpicker"}static get configurable(){return{store:{data:[{id:"Forward"},{id:"Backward"}]},primaryFilter(e){return Ht.localize(e.id).toLowerCase().startsWith(this.value.toLowerCase())},hasEnforcedBadge:!1,clearable:!1,nullValue:"Forward"}}get inputValue(){return this.L(this.value||"")}listItemTpl(e){return Ht.localize(e.id)}changeHasEnforcedBadge(e){this.element.classList.toggle("b-enforced-sch-direction",!!e)}getEnforcedName(e){return e.name||(e.isRoot?"Project":`Task #${e.id}`)}assignFieldValue(e){const t=this,s=e==null?void 0:e.effectiveDirection;t.taskRecord=e,s?(t.value=s.direction,s.kind==="enforced"?(t.hasEnforcedBadge=!0,t.tooltip=t.L("L{enforcedBy}")+` "${this.getEnforcedName(s.enforcedBy)}"`,t.disable()):s.kind==="inherited"?(t.hasEnforcedBadge=!0,t.tooltip=t.L("L{inheritedFrom}")+` "${this.getEnforcedName(s.inheritedFrom)}"`,t.enable()):(t.hasEnforcedBadge=!1,t.tooltip=void 0,t.enable())):(t.clear(),t.disable())}}Ht.initClass(),Ht._$name="SchedulingDirectionPicker";class yr extends Kt{static get $name(){return"SchedulingModePicker"}static get type(){return"schedulingmodecombo"}static get configurable(){return{allowedModes:null,store:{data:this.defaultStoreData}}}static get defaultStoreData(){return[{id:W.Normal,text:this.L("L{Normal}")},{id:W.FixedDuration,text:this.L("L{Fixed Duration}")},{id:W.FixedUnits,text:this.L("L{Fixed Units}")},{id:W.FixedEffort,text:this.L("L{Fixed Effort}")}]}changeAllowedModes(e){return typeof e=="string"?e.split(","):e}updateAllowedModes(e){this._allowedModes=e,e?this.store.addFilter({id:"allowed-mode-filter",filterBy:t=>this._allowedModes.includes(t.id)}):this.store.removeFilter("allowed-mode-filter")}updateLocalization(){super.updateLocalization(),this.store.data=this.constructor.defaultStoreData}}yr.initClass(),yr._$name="SchedulingModePicker";class vr extends He{static get $name(){return"AdvancedTab"}static get type(){return"advancedtab"}static get defaultConfig(){const e={flex:"0 0 calc(64% - var(--autocontainer-gap) / 2)",labelWidth:"30%"},t={flex:"0 0 calc(34% - var(--autocontainer-gap) / 2)",labelWidth:"80%"};return{localeClass:this,title:"L{Advanced}",cls:"b-advanced-tab",defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",weight:100,ref:"",name:"calendar",label:"L{Calendar}",...e},ignoreResourceCalendarField:{type:"checkbox",weight:100,name:"ignoreResourceCalendar",label:"L{Ignore resource calendar}",cls:"b-ignore-resource-calendar",...t},schedulingModeField:{type:"schedulingmodecombo",weight:300,name:"schedulingMode",label:"L{Scheduling mode}",...e},effortDrivenField:{type:"checkbox",weight:400,name:"effortDriven",label:"L{Effort driven}",...t},divider:{weight:500,html:"",dataset:{text:this.L("L{Constraint}")},cls:"b-divider",flex:"1 0 100%"},constraintTypeField:{type:"constrainttypepicker",weight:600,name:"constraintType",label:"L{Constraint type}",clearable:!0,...e},rollupField:{type:"checkbox",weight:700,name:"rollup",label:"L{Rollup}",...t},constraintDateField:{type:"date",weight:800,name:"constraintDate",label:"L{Constraint date}",keepTime:"entered",...e},schedulingDirectionField:{type:"schedulingdirectionpicker",weight:850,name:"direction",label:"L{Scheduling direction}",...e},inactiveField:{type:"checkbox",weight:900,name:"inactive",label:"L{Inactive}",...t},manuallyScheduledField:{type:"checkbox",weight:1e3,name:"manuallyScheduled",label:"L{Manually scheduled}",cls:"b-last-row",style:"margin-left:auto",...t}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get effortDrivenField(){return this.widgetMap.effortDrivenField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}get rollupField(){return this.widgetMap.rollupField}get schedulingModeField(){return this.widgetMap.schedulingModeField}get schedulingDirectionField(){return this.widgetMap.schedulingDirectionField}loadEvent(e){const t=this,{calendarField:s,constraintTypeField:i,includeAsapAlapAsConstraints:n,schedulingDirectionField:r}=t,{calendarManagerStore:a}=e.project,o=(s==null?void 0:s.store)!==a;s&&(o?s.store=a.chain(void 0,void 0,{excludeCollapsedRecords:!1}):s.store.resumeChain()),i&&(i.taskRecord=e,i.includeAsapAlapAsConstraints=n),r&&(r.hidden=n),super.loadEvent(e)}beforeSave(){const{calendarField:e}=this.widgetMap;e&&e.store.suspendChain()}}vr.initClass(),vr._$name="AdvancedTab";class Cr extends He{static get $name(){return"NotesTab"}static get type(){return"notestab"}static get configurable(){return{cls:"b-notes-tab",title:this.L("L{Notes}"),tab:{icon:"b-icon-note",titleProperty:"tooltip"},layoutConfig:{alignItems:"flex-start",alignContent:"stretch"},items:{noteField:{weight:100,type:"textfield",inputAttributes:{tag:"textarea"},cls:"b-taskeditor-notes-field",name:"note"}}}}}Cr.initClass(),Cr._$name="NotesTab";class Si extends Rn{static get type(){return"gantttaskeditor"}static get $name(){return"GanttTaskEditor"}}M(Si,"configurable",{items:{tabs:{type:"tabpanel",defaultType:"formtab",flex:"1 0 100%",autoHeight:!0,layoutConfig:{alignItems:"stretch",alignContent:"stretch"},items:{generalTab:{type:"generaltab",weight:100},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},resourcesTab:{type:"resourcestab",weight:400},advancedTab:{type:"advancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}}}),Si.initClass(),Si._$name="GanttTaskEditor";class Dr extends He{static get $name(){return"SchedulerGeneralTab"}static get type(){return"schedulergeneraltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this,weight:10},items:{nameField:{type:"text",required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name",weight:100},resourcesField:{type:"combo",label:"L{Resources}",name:"resources",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,cls:"b-resources",weight:200},startDateField:{type:"datetime",label:"L{Start}",name:"startDate",cls:"b-start-date",flex:"1 0 100%",weight:300,dateField:{type:"startdatefield"}},endDateField:{type:"datetime",label:"L{Finish}",name:"endDate",cls:"b-end-date",flex:"1 0 100%",weight:400,dateField:{type:"enddatefield"}},durationField:{type:"durationfield",label:"L{Duration}",name:"fullDuration",cls:"b-half-width",min:0,weight:500},percentDoneField:{type:"number",label:"L{% complete}",name:"renderedPercentDone",cls:"b-half-width",min:0,max:100,weight:600},effortField:{type:"durationfield",label:"L{Effort}",name:"fullEffort",weight:620},preambleField:{type:"durationfield",hidden:!0,useAbbreviation:!0,weight:650,label:"L{SchedulerGeneralTab.Preamble}",name:"preamble",cls:"b-half-width"},postambleField:{type:"durationfield",hidden:!0,useAbbreviation:!0,weight:660,label:"L{SchedulerGeneralTab.Postamble}",name:"postamble",cls:"b-half-width"},colorField:{type:"eventcolorfield",weight:700,label:"L{SchedulerBase.color}",name:"eventColor"}}}}loadEvent(e){var h;const t=this,{project:s}=t,i={unit:e.durationUnit,magnitude:1},{isParent:n}=e,{durationField:r,percentDoneField:a,startDateField:o,endDateField:c,resourcesField:d}=t.widgetMap,u=(d==null?void 0:d.store.masterStore)!==s.resourceStore;r&&(r.disabled=n),a&&(a.disabled=n),o&&(o.dateField.eventRecord=e,O.compareUnits(i.unit,"hour")>0?o.dateField.step=i:o.timeField.step=i),c&&(c.dateField.eventRecord=e,O.compareUnits(i.unit,"hour")>0?c.dateField.step=i:c.timeField.step=i,c.disabled=n),d&&(d.multiSelect=(h=d.config.multiSelect)!=null?h:!s.eventStore.usesSingleAssignment,u?d.store=s.resourceStore.chain(f=>!f.isSpecialRow):d.store.resumeChain()),super.loadEvent(...arguments)}onFieldChange({source:e,valid:t,userAction:s,value:i}){if(s&&t){const{eventStore:n}=this.record,r=e.name==="resources"&&i.length===0&&this.autoUpdateRecord&&n.removeUnassignedEvent;r&&(n.removeUnassignedEvent=!1),super.onFieldChange(...arguments),r&&(n.removeUnassignedEvent=!0)}}beforeSave(){var e;this.record.resources.length===0&&this.record.eventStore.removeUnassignedEvent&&this.record.remove(),(e=this.widgetMap.resourcesField)===null||e===void 0||e.store.suspendChain(),super.beforeSave()}}Dr.initClass(),Dr._$name="SchedulerGeneralTab";class Ut extends Wt{get recurrenceEditor(){return this.widgetMap.recurrenceEditor}loadEvent(e){var t;this.recurrenceEditor&&(this.loadingRecord=!0,this.recurrenceEditor.record=(t=e.recurrence)!=null?t:null,this.loadingRecord=!1),super.loadEvent(e)}onFieldChange({source:e,value:t}){const s=this;if(!s.isConfiguring&&!s.recurrenceEditor.assigningValues&&!s.loadingRecord){const{record:i}=s;i.recurrence?e===s.recurrenceEditor.widgetMap.frequencyField&&t==="NONE"?i.recurrence=null:s.recurrenceEditor.syncEventRecord(i.recurrence):i.recurrence=new i.recurrenceModel({}),s.up(n=>n.isTaskEditorBase).editingRecurring=!0}}}M(Ut,"$name","RecurrenceTab"),M(Ut,"type","recurrencetab"),M(Ut,"configurable",{title:"L{title}",cls:"b-recurrence-tab",scrollable:!0,items:{recurrenceEditor:{type:"recurrenceeditorpanel",addNone:!0}}}),Ut.initClass(),Ut._$name="RecurrenceTab";class Sr extends He{static get $name(){return"SchedulerAdvancedTab"}static get type(){return"scheduleradvancedtab"}static get configurable(){return{cls:"b-advanced-tab",tab:{icon:"b-icon-advanced",tooltip:"L{SchedulerAdvancedTab.Advanced}"},defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",name:"calendar",label:"L{Calendar}",weight:100},constraintTypeField:{type:"constrainttypepicker",name:"constraintType",label:"L{Constraint type}",clearable:!0,weight:200,includeAsapAlapAsConstraints:!1},constraintDateField:{type:"date",name:"constraintDate",label:"L{Constraint date}",keepTime:"entered",weight:300},manuallyScheduledField:{type:"checkbox",name:"manuallyScheduled",label:"L{Manually scheduled}",weight:400},schedulingModeField:{type:"schedulingmodecombo",name:"schedulingMode",label:"L{Scheduling mode}",hidden:!0,weight:450,allowedModes:`${W.Normal},${W.FixedDuration}`},effortDrivenField:{type:"checkbox",weight:460,name:"effortDriven",label:"L{Effort driven}",hidden:!0,cls:"b-half-width"},inactiveField:{type:"checkbox",weight:500,name:"inactive",label:"L{Inactive}"},ignoreResourceCalendarField:{type:"checkbox",weight:600,name:"ignoreResourceCalendar",label:"L{Ignore resource calendar}",cls:"b-half-width"}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get effortDrivenField(){return this.widgetMap.effortDrivenField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}get schedulingModeField(){return this.widgetMap.schedulingModeField}loadEvent(e){const t=this,{project:s}=t;t.record;const{calendarField:i,constraintTypeField:n}=t;n&&(n.taskRecord=e),i&&(i.store=s.calendarManagerStore,i.hidden=!s.calendarManagerStore.count),super.loadEvent(...arguments)}}Sr.initClass(),Sr._$name="SchedulerAdvancedTab";const pc=/(pre|post)amble/;class Er extends Rn{static get type(){return"schedulertaskeditor"}static get $name(){return"SchedulerTaskEditor"}static get defaultConfig(){return{enableEventSpanBuffer:!1,items:[{type:"tabpanel",defaultType:"formtab",ref:"tabs",flex:"1 0 100%",autoHeight:!0,layoutConfig:{alignItems:"stretch",alignContent:"stretch"},defaults:{scrollable:{overflowY:!0}},items:{generalTab:{type:"schedulergeneraltab",weight:100},recurrenceTab:{type:"recurrencetab",weight:150},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},advancedTab:{type:"scheduleradvancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}]}}processWidgetConfig(e){var t;if((t=e.ref)!==null&&t!==void 0&&t.match(pc)&&(e.hidden=!this.enableEventSpanBuffer),e.ref==="recurrenceTab"){var s;e.hidden=!((s=this.owner)!==null&&s!==void 0&&s.enableRecurringEvents)}return super.processWidgetConfig(e)}onFocusOut({relatedTarget:e}){var t;const s=e==null||(t=e.closest(".b-sch-event-wrap"))===null||t===void 0?void 0:t.elementData.eventRecord;if(s&&s===this.loadedRecord)this.setTimeout(()=>this.focus(),100);else return super.onFocusOut(...arguments)}}Er.initClass(),Er._$name="SchedulerTaskEditor";class Ei extends Fn.mixin(fl,bl,kn,Cl){static get $name(){return"TaskEdit"}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey"],assign:["editEvent"]}}static get defaultConfig(){return{triggerEvent:"eventdblclick",editorClassMap:{[qt.SchedulerBasic]:"schedulertaskeditor",[qt.SchedulerPro]:"schedulertaskeditor",[qt.Gantt]:"gantttaskeditor"},editorClass:null,editorConfig:null,confirmDelete:!0,saveAndCloseOnEnter:!0,blurAction:"cancel",weekStartDay:null,scrollIntoView:!0}}static get configurable(){return{items:null,suspendHasChangesEvent:!1}}construct(e,t){var s;e.taskEdit=this,super.construct(e,H.assign({weekStartDay:e.weekStartDay,enableEventSpanBuffer:(s=e.features.eventBuffer)===null||s===void 0?void 0:s.enabled},t)),e.ion({[this.triggerEvent]:"onActivateEditor",readOnly:"onClientReadOnlyToggle",dragCreateEnd:"onDragCreateEnd",afterEventDrop:"onEventDropped",eventResizeEnd:"onEventResized",thisObj:this})}doDestroy(){var e;this.cleanupProjectListener(),(e=this.editor)===null||e===void 0||e.destroy(),this.deleteConfirmationPromise&&Ai.hide(),super.doDestroy()}onClientReadOnlyToggle({readOnly:e}){this.editor&&(this.editor.readOnly=e)}get scheduler(){return this.client}getElementFromTaskRecord(e,t){return this.client.getElementFromEventRecord(e,t)}scrollEventIntoView(e,t){this.client.scrollResourceEventIntoView(t,e)}get isValid(){return this.editor.eachWidget(e=>e.isValid===!0||e.hidden||e.disabled||e.isField&&!e.name?!0:e.isValid!==!1,!0)}get project(){return this.scheduler.project}setupProjectListener(){this.cleanupProjectListener(),this.project.ion({name:"project",loadstart:()=>this.save(),dataReady:"onDataReady",thisObj:this})}cleanupProjectListener(){this.detachListeners("project")}onDataReady(){const{record:e}=this;e!=null&&e.project&&this.scheduler.taskStore.includes(e)?this.load(e,!0):this.editor.close()}get isEditing(){return!!this._editing}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:s}){e===this.record&&this.isEditing||this.editEvent(e,t,s)}async editEvent(e,t=null,s=null,i=null){var n;const r=this,{scheduler:a,suspendHasChangesEvent:o}=r,{project:c}=a,d=async()=>{c.resumeAutoSync(),await r.freeStm(!0),!r.isDestroyed&&(o&&!c.isDestroying&&c.resumeChangesTracking(),r._editing=!1)};e=e.isEventSegment?e.event:e;const u=!r.disabled&&!e.readOnly&&!c.isDelayingCalculation&&(e.project||!a.usesDisplayStore);if(u&&i&&(i.transferred=!0),r.isEditing&&await r.cancel(),(n=a.features.cellEdit)!==null&&n!==void 0&&n.isEditing&&a.cancelEditing(),await Promise.all([r._cancelling,r._hiding]).catch(()=>{}),!a.isGanttBase&&!t){var h;t=e.resource||((h=e.resources)===null||h===void 0?void 0:h[0])}if(u){const{taskStore:f}=a;if(r._editing=!0,i?(r.applyStmCapture(i),r.hasStmCapture=!0,r.stmCapture=i):r.hasStmCapture||await r.captureStm(!0),c.suspendAutoSync(),typeof e=="function"&&(e=e()),e=e.$original,!e.isOccurrence&&!f.includes(e)&&!e.isCreating&&(e.isCreating=!0,f.add(e),t&&a.assignmentStore.assignEventToResource(e,t),await c.commitAsync(),r.isDestroyed)||r.scrollIntoView&&!a.timeAxisSubGrid.collapsed&&!s&&f.includes(e)&&(t||a.isGantt)&&(await r.scrollEventIntoView(e,t),r.isDestroyed))return;const p=s||vt.down(r.getElementFromTaskRecord(e,t),a.eventInnerSelector),g=r.getEditor(e);if(await r.triggerOnClient("beforeTaskEdit",{taskEdit:r,taskRecord:e,taskElement:p})!==!1){if(r.suspendHasChangesEvent&&a.project.suspendChangesTracking(),a.element.classList.add("b-taskeditor-editing"),await c.commitAsync(),!e.isOccurrence)if(a.eventStore.includes(e))e=a.eventStore.getById(e.id);else{await d();return}if(r.isDestroyed)return;r.load(e),r.triggerOnClient("beforeTaskEditShow",{taskEdit:r,taskRecord:e,taskElement:p,editor:g});const{widgetMap:m}=g,y=e.parent&&!e.parent.isRoot;m.deleteButton&&(m.deleteButton.hidden=a.readOnly||e.isCreating||g.readOnly),a.features.nestedEvents&&(m.predecessorsTab&&(m.predecessorsTab.disabled=y),m.successorsTab&&(m.successorsTab.disabled=y),m.resourcesField&&(m.resourcesField.disabled=y)),r.setupProjectListener(),g.centered?await g.show():!a.timeAxisSubGrid.collapsed&&p&&(!a.isGanttBase||r.scrollIntoView||Qt.from(p).intersect(Qt.from(a.timeAxisSubGridElement)))?await g.showBy({target:p,anchor:!0,offset:-5}):await g.showBy({target:a.element,anchor:!1,align:"c-c",clippedBy:null})}else await d()}}prepareEditorConfig(e){return e}getEditor(e=this.record){const t=this,{client:s}=t;let{editor:i}=t;if(!i){var n,r;const a=t.prepareEditorConfig(H.merge({clippedBy:[s.timeAxisSubGridElement,s.bodyContainer],eventEditFeature:t,weekStartDay:t.weekStartDay,enableEventSpanBuffer:t.enableEventSpanBuffer,saveAndCloseOnEnter:t.saveAndCloseOnEnter,blurAction:t.blurAction,owner:s,dependencyIdField:((n=t.editorConfig)===null||n===void 0?void 0:n.dependencyIdField)||s.dependencyIdField,project:t.project,durationDisplayPrecision:s.durationDisplayPrecision,tabPanelItems:t.items,internalListeners:{beforeHide:{fn:"onBeforeHide",prio:-1e3},cancel:"onCancel",delete:"onDelete",save:"onSave",thisObj:t},tabsConfig:t.tabsConfig},t.editorConfig));if(!s.showTaskColorPickers&&((r=a.tabPanelItems)===null||r===void 0?void 0:r.generalTab)!==!1&&(a.tabPanelItems=H.merge(a.tabPanelItems||{},{generalTab:{items:{colorField:!1}}})),t.editorClass&&!a.type)i=t.editor=t.editorClass.new(a);else{const o=(e==null?void 0:e.project)||t.project,c=o.getType();i=t.editor=Oi.create(Object.assign({type:t.editorClassMap[c]||"schedulertaskeditor"},a))}}return i.readOnly=(s.readOnly||(e==null?void 0:e.isOccurrence)||(e==null?void 0:e.isRecurring))&&!i.editingRecurring,i.project=t.project,i}load(e,t){const s=this,i=s.getEditor(e);s._loading=!0,e.isEventSegment&&(e=e.event),s.record=e,i.loadEvent(e,t),s._loading=!1}async save(){const e=this,{scheduler:t,record:s}=e;if(e.isEditing){const i=e.getEditor();if(!e.isValid||await e.triggerOnClient("beforeTaskSave",{taskRecord:s,editor:i})===!1)return;e.cleanupProjectListener(),i.beforeSave(),s.isCreating=!1,i.resetRecurrenceData=i.editingRecurring=null;let n=!0;const r=e.freeStm(!0);if(H.isPromise(r)&&r.then(()=>n=!1),e._editing=!1,await i.close(),H.isPromise(r)&&(await r,e.isDestroying))return;t.project.resumeAutoSync(!0),t.element.classList.remove("b-taskeditor-editing"),e.triggerOnClient("afterTaskSave",{taskRecord:s,editor:i}),i.afterSave(),e.suspendHasChangesEvent&&t.project.resumeChangesTracking(n),e.triggerOnClient("afterTaskEdit",{taskRecord:s,editor:i})}}async doCancel(){const e=this,{scheduler:t,record:s}=e;if(e.isEditing){e._editing=!1,e.cleanupProjectListener();const{project:o}=e,c=e.getEditor();if(c.editingRecurring=null,c.beforeCancel(),e.isDestroyed){var i;(i=o.resumeAutoSync)===null||i===void 0||i.call(o,!1);return}if(await e.rejectStmTransaction(),s!=null&&s.isCreating&&s.remove(),e.isDestroyed){var n;(n=o.resumeAutoSync)===null||n===void 0||n.call(o,!1);return}if(await o.commitAsync(),e.isDestroyed){var r;(r=o.resumeAutoSync)===null||r===void 0||r.call(o,!1);return}if(e.isDestroyed){var a;(a=o.resumeAutoSync)===null||a===void 0||a.call(o,!1);return}e.freeStm(),c.afterCancel(),o.resumeAutoSync(!1),t.element.classList.remove("b-taskeditor-editing"),e.trigger("afterTaskEdit"),e.triggerOnClient("taskEditCanceled",{taskRecord:s,editor:c}),e.suspendHasChangesEvent&&o.resumeChangesTracking(),e.triggerOnClient("afterTaskEdit",{taskRecord:s,editor:c})}}async cancel(){const e=this,{editor:t}=e,{resetRecurrenceData:s}=t;return s&&(s.recurringTimeSpan.exceptionDates=s.originalExceptionDates,t.resetRecurrenceData=null),e._cancelling||(e._cancelling=e.doCancel().finally(()=>e._cancelling=void 0))}async delete(){const e=this,{editor:t,scheduler:s,record:i,project:n}=e;if(!(!i.isCreating&&await e.triggerOnClient("beforeTaskDelete",{taskRecord:i,editor:t})===!1)){if(e.cleanupProjectListener(),t.beforeDelete(),i.remove(),await e.commitStmTransaction(),e.isDestroyed){var r;(r=n.resumeAutoSync)===null||r===void 0||r.call(n,!1);return}e.freeStm(),await n.commitAsync(),!e.isDestroyed&&(n.resumeAutoSync(!i.isCreating),e._editing=!1,t.close(),t.afterDelete(),s.element.classList.remove("b-taskeditor-editing"),e.suspendHasChangesEvent&&s.project.resumeChangesTracking(),e.triggerOnClient("afterTaskEdit",{editor:t,taskRecord:i}))}}onSave(){this.requestAnimationFrame(()=>this.save())}onCancel(){this.cancel().then()}async onDelete(){const e=this;if(e.confirmDelete){const{editor:t}=e,s=t.autoClose;t.autoClose=!1,e.deleteConfirmationPromise=Ai.confirm({title:"L{TaskEdit.ConfirmDeletionTitle}",message:"L{TaskEdit.ConfirmDeletionMessage}",okButton:"L{TaskEditorBase.Delete}",rootElement:e.rootElement});const i=await e.deleteConfirmationPromise;t.autoClose=s,e.deleteConfirmationPromise=null,i===Ai.yesButton&&e.delete()}else e.requestAnimationFrame(()=>e.delete())}onBeforeHide({source:e,animate:t}){e.hideAnimation&&t!==!1&&(this._hiding=new Promise(s=>{e.ion({hideAnimationEnd:s})}).finally(()=>this._hiding=void 0))}onDragCreateEnd({eventRecord:e,resourceRecord:t,proxyElement:s,stmCapture:i}){!this.isDestroyed&&!this.disabled&&e.isCreating&&this.editEvent(e,t,null,i)}populateEventMenu({eventRecord:e,resourceRecord:t,items:s}){this.scheduler.readOnly||(s.editEvent={text:"L{Edit task}",localeClass:this,icon:"b-icon b-icon-edit",weight:-200,disabled:this.disabled||e.readOnly,onItem:()=>this.editEvent(e,t)})}onEventEnterKey({assignmentRecord:e,eventRecord:t}){e?this.editEvent(t,e.resource):t&&this.editEvent(t,t.resource)}async triggerOnClient(e,t){const s=e.replace(/task/,"event").replace(/Task/,"Event"),i=await this.scheduler.trigger(...arguments);t.eventRecord=t.taskRecord,t.eventRecords=[t.taskRecord];const n=await this.scheduler.trigger(s,t);return i&&n}onEventDropped({eventRecords:e}){var t;const s=((t=this.editor)===null||t===void 0?void 0:t.loadedRecord)&&e.find(i=>i===this.editor.loadedRecord);s&&this.onEventResized({eventRecord:s})}onEventResized({eventRecord:e}){const{editor:t}=this;t!=null&&t.isVisible&&e===t.loadedRecord&&t.realign()}}Ei._$name="TaskEdit",ue.registerFeature(Ei,!0,"SchedulerPro"),ue.registerFeature(Ei,!1,"ResourceHistogram");const wr=class{constructor({model:e,type:t}){var s,i,n;Object.assign(this,{id:(s=e.id)!=null?s:e.$entityName,type:(i=t==null?void 0:t.$$name)!=null?i:e.constructor.name,name:(n=e.name)!=null?n:e.$entityName}),new.target===wr&&Object.freeze(this)}};let qe=wr;M(qe,"$name","ChangeLogEntity"),qe._$name="ChangeLogEntity";class bi extends qe{constructor({model:e,fromTask:t,toTask:s}){super({model:e,type:wn}),Object.assign(this,{fromTask:t,toTask:s}),Object.freeze(this)}}M(bi,"$name","ChangeLogDependencyEntity"),bi._$name="ChangeLogDependencyEntity";class wi extends qe{constructor({model:e,event:t,resource:s}){super({model:e,type:dt}),Object.assign(this,{event:t,resource:s}),Object.freeze(this)}}M(wi,"$name","ChangeLogAssignmentEntity"),wi._$name="ChangeLogAssignmentEntity";const Pr=class{constructor({entity:e,actionType:t}){Object.assign(this,{entity:e,actionType:t}),this.constructor===Pr&&Object.freeze(this)}};let Ce=Pr;M(Ce,"$name","ChangeLogAction"),Ce._$name="ChangeLogAction";class Mo extends Ce{static get $name(){return"ChangeLogMoveAction"}constructor({entity:e,from:t,to:s}){super({entity:e,actionType:"move"}),Object.assign(this,{from:t,to:s}),Object.freeze(this)}}Mo._$name="ChangeLogMoveAction";class Oo extends Ce{static get $name(){return"ChangeLogUpdateAction"}constructor({entity:e,propertyUpdates:t,isInitialUserAction:s}){super({entity:e,actionType:"update"}),Object.assign(this,{propertyUpdates:t,isUser:s}),Object.freeze(this)}}Oo._$name="ChangeLogUpdateAction";class Tn extends Fn.mixin(wl){constructor(){super(...arguments);M(this,"_remoteActionRanges",[]);M(this,"_comparingVersionId")}construct(t,s){super.construct(t,s);const i=this;i.versionStore=new _t({modelClass:i.versionModelClass,internalListeners:{change:i.onStoreChangeExternal,thisObj:i},id:_t.configurable.storeId}),i.changeStore=new Nt({modelClass:i.transactionModelClass,internalListeners:{change:i.onStoreChangeExternal,thisObj:i},id:Nt.configurable.storeId}),i._currentChanges=[],i.client.ion({beforeTaskDelete:i.onBeforeTaskDelete,beforeTaskSave:i.onBeforeTaskSave,gridRowBeforeDropFinalize:i.onGridRowBeforeDropFinalize,thisObj:i})}attachToProject(t){const s=this;super.attachToProject(t),t.addCrudStore([s.versionStore,s.changeStore]),t.ion({name:"project",load:s.onProjectLoad,once:!0,thisObj:s}),s.detachProjectListeners(),s.attachProjectListeners(t)}onBeforeTaskDelete(){this.transactionDescription=this.L("L{Versions.deletedTask}")}onBeforeTaskSave(){this.transactionDescription=this.L("L{Versions.editedTask}")}onGridRowBeforeDropFinalize({context:{valid:t,records:s}}){t&&(this.transactionDescription=s.length===1?this.L("L{Versions.movedTask}"):this.L("L{Versions.movedTasks}"))}attachProjectListeners(t){var s;const i=this;t==null||(s=t.stm)===null||s===void 0||s.ion({recordingStart:i.onStmRecordingStart,recordingStop:i.handleTransactionStop,restoringStop:i.onStmRestoringStop,thisObj:i,name:"stmListeners"}),t==null||t.ion({wsBeforeReceiveChanges:i.onBeforeApplyRemoteChanges,wsReceiveChanges:i.onAfterApplyRemoteChanges,thisObj:i,name:"stmListeners"})}detachProjectListeners(){this.detachListeners("stmListeners")}updateVersionModelClass(t){if(!t.isVersionModel)throw new Error("versionModelClass config must be a subclass of SchedulerPro.model.VersionModel.")}updateTransactionModelClass(t){if(!t.isChangeLogTransactionModel)throw new Error("transactionModelClass config must be a subclass of SchedulerPro.model.changelog.ChangeLogTransactionModel.")}onStoreChangeExternal(){this.triggerVersionChange()}tryAutoSave(){const t=this,{project:s}=t.client;t.changeStore.find(({versionId:i})=>!i)&&(s!=null&&s.wsSend?(s.wsSend("requestVersionAutoSave",{project:s.wsProjectId}),t.detachListeners("autoSave"),s.ion({name:"autoSave",wsVersionAutoSaveOK:t.autoSave,thisObj:t,once:!0})):t.saveVersionWithConfig({isAutosave:!0}))}autoSave(){this.saveVersionWithConfig({isAutosave:!0})}autoSaveHourly(){new Date().getMinutes()===0&&this.tryAutoSave()}updateAutoSaveInterval(t){const s=this,{client:i}=s;s._autoSaveInterval&&i.clearInterval(s._autosaveInterval),t==="hourly"?s._autoSaveInterval=i.setInterval(s.autoSaveHourly.bind(s),10*1e3):t&&(s._autoSaveInterval=i.setInterval(s.tryAutoSave.bind(s),t*60*1e3))}saveVersion(t=null){return this.saveVersionWithConfig({name:t})}saveVersionWithConfig(t){const s=this,i=s.captureVersionContent(),n=new s.versionModelClass({savedAt:new Date,content:i,...t});return n.onBeforeSave(),s.versionStore.add(n),s.changeStore.query(r=>r.versionId==null).forEach(r=>r.versionId=n.id),s.triggerVersionChange(),s.triggerTransactionChange(),n}async loadVersionContent(t){const s=this,{client:i}=s,{project:n}=i,r={version:t,content:null};if(await s.trigger("beforeLoadVersionContent",{context:r})){if(n!=null&&n.wsSend){n.wsSend("loadVersionContent",{project:n.wsProjectId,versionId:t.id});const a=await new Promise((o,c)=>{const d=Date.now();n.ion({name:"loadVersionContent",loadVersionContent({project:u,versionId:h,content:f}){if(u===n.wsProjectId&&h===t.id)return n.detachListeners("loadVersionContent"),o(f)},thisObj:s,expires:{delay:s.versionContentLoadTimeout-(Date.now()-d),alt:()=>c(`Failed to receive version content within ${this.versionContentLoadTimeout} ms`)}})});return a&&s._versionContentCache.set(t.id,a),a}}else if(r.content)return r.content}async getVersionContent(t){var s;return(s=t.content)!=null?s:await this.loadVersionContent(t)}triggerTransactionChange(){this.client.trigger("transactionChange",{hasUnattachedTransactions:this.hasUnattachedTransactions})}triggerVersionChange(){this.client.trigger("versionChange",{versions:this.versionStore.records})}captureVersionContent(){return this.client.project.toJSON()}async restoreVersion(t){var s,i,n;const r=await this.getVersionContent(t),{project:a}=this.client,o=(s=a.stm)===null||s===void 0?void 0:s.enabled;if((i=a.stm)===null||i===void 0||i.disable(),a.json=r,await a.commitAsync(),o){var c;(c=a.stm)===null||c===void 0||c.enable()}(n=a.stm)===null||n===void 0||n.resetQueue()}async compareVersion(t){var s,i;const n=await this.getVersionContent(t),r={},{project:a}=this.client,o=(s=a.stm)===null||s===void 0?void 0:s.enabled;(i=a.stm)===null||i===void 0||i.disable();for(const d of n.eventsData)pl.preWalk(d,u=>u.children,({id:u,startDate:h,endDate:f})=>{r[u]={startDate:h,endDate:f}});if(a.taskStore.traverse(d=>{r[d.id]&&(d.baselines.removeAll(),d.baselines.loadData([{task:d,...r[d.id]}]))}),o){var c;(c=a.stm)===null||c===void 0||c.enable()}this._comparingVersionId=t.id}stopComparing(){var t,s;if(!this._comparingVersionId)return;const{project:i}=this.client,n=(t=i.stm)===null||t===void 0?void 0:t.enabled;if((s=i.stm)===null||s===void 0||s.disable(),i.taskStore.traverse(a=>{a.baselines.removeAll()}),n){var r;(r=i.stm)===null||r===void 0||r.enable()}this._comparingVersionId=null}doDisable(t){super.doDisable(t),t?this.detachProjectListeners():this.attachProjectListeners(this.client.project),this.client.refresh()}getEntityDescriptor(t){var i;const s=(i=this.knownBaseTypes.find(n=>t instanceof n))!=null?i:t.constructor;return t.isDependencyModel?new bi({model:t,fromTask:this.getEntityDescriptor(t.fromTask),toTask:this.getEntityDescriptor(t.toTask)}):t.isAssignmentModel?new wi({model:t,event:this.getEntityDescriptor(t.event),resource:this.getEntityDescriptor(t.resource)}):new qe({model:t,type:s})}getUpdateAction(t){const s=t[0].model,i=t.flatMap(({newData:o,oldData:c})=>Object.entries(o).map(([d,u])=>({property:d,value:u,oldValue:c[d]})).filter(({property:d,value:u,oldValue:h})=>{var f;return!H.isEqual(u,h)&&((f=s.getFieldDefinition(d))===null||f===void 0?void 0:f.persist)})),n=yt.groupBy(i,"property"),r=Object.entries(n).map(([o,c])=>({property:o,before:c[0].oldValue,after:c[c.length-1].value})),a=t.some(({isInitialUserAction:o})=>o);return new Oo({actionType:"update",entity:this.getEntityDescriptor(s),propertyUpdates:r,isInitialUserAction:a})}onProjectLoad(){this._currentStmTransaction=null,this.stopTransaction()}onStmRecordingStart({transaction:t}){this._transactionStart=new Date,this._currentStmTransaction=t,this.triggerTransactionChange()}stopTransaction(){var t;if((t=this.client.project)!==null&&t!==void 0&&t.stm.isRecording){var s;(s=this.client.project)===null||s===void 0||s.stm.stopTransaction()}this.handleTransactionStop()}async onStmRestoringStop({cause:t,transactions:s}){const i=this;t==="undo"?i.transactionDescription=i.L("L{undid}"):t==="redo"&&(i.transactionDescription=i.L("L{redid}")),await i.client.project.commitAsync(),i._transactionStart=new Date,i.finalizeTransaction({queue:s.flatMap(n=>n.queue)})}onBeforeApplyRemoteChanges(){var s;if(this._remoteChangesStartPos==null){var t;this._remoteChangesStartPos=(s=(t=this._currentStmTransaction)===null||t===void 0?void 0:t.queue.length)!=null?s:0}}async onAfterApplyRemoteChanges(){this.endCurrentRemoteActionRange(),await this.client.project.commitAsync()}endCurrentRemoteActionRange(){var i;const t=this;if(t._remoteChangesStartPos!=null){var s;const n=(i=(s=t._currentStmTransaction)===null||s===void 0?void 0:s.queue.length)!=null?i:0;n!==t._remoteChangesStartPos&&t._remoteActionRanges.push({start:t._remoteChangesStartPos,end:n}),t._remoteChangesStartPos=null}}handleTransactionStop(){const t=this;t.hasChanges&&t.finalizeTransaction(t._currentStmTransaction),t._currentTransactionDescription=null,t._currentStmTransaction=null,t._remoteActionRanges=[],t.triggerTransactionChange()}excludeRanges(t,s){let i=[],n=0;for(const{start:r,end:a}of s)i=i.concat(t.slice(n,r)),n=a;return i.concat(t.slice(n))}finalizeTransaction(t){const s=this;s.endCurrentRemoteActionRange();const i=s.excludeRanges(t.queue,s._remoteActionRanges);if(i.length===0)return;const n=({model:c})=>c.$entityName,r=yt.groupBy(i,"type"),a=[];for(const c of["UpdateAction","EventUpdateAction"]){const d=yt.groupBy(r[c]||[],n);for(const u of Object.values(d))a.push(s.getUpdateAction(u))}for(const{modelList:c,isInitialUserAction:d}of r.RemoveAction||[])for(const u of c)a.push(new Ce({actionType:"remove",entity:s.getEntityDescriptor(u),isInitialUserAction:d}));for(const{childModels:c}of r.RemoveChildAction||[])for(const d of c)a.push(new Ce({actionType:"remove",entity:s.getEntityDescriptor(d)}));for(const{modelList:c}of r.AddAction||[])for(const d of c)a.push(new Ce({actionType:"add",entity:s.getEntityDescriptor(d)}));for(const{childModels:c,parentModel:d,context:u,insertIndex:h}of r.InsertChildAction||[])for(const f of c){const p=u.get(f);p!=null?a.push(new Mo({actionType:"move",entity:s.getEntityDescriptor(f),from:{parent:s.getEntityDescriptor(p.parent),index:p.index},to:{parent:s.getEntityDescriptor(d),index:h}})):a.push(new Ce({actionType:"add",entity:s.getEntityDescriptor(f)}))}const o=new s.transactionModelClass({description:s._currentTransactionDescription,actions:a,occurredAt:s._transactionStart});s.changeStore.add(o)}set transactionDescription(t){this._currentTransactionDescription=t}get hasChanges(){var t,s;return((t=this._currentStmTransaction)===null||t===void 0||(s=t.queue)===null||s===void 0?void 0:s.length)>0}get hasUnattachedTransactions(){return this.changeStore.find(t=>t.versionId==null)}get isComparing(){return this._comparingVersionId!=null}}M(Tn,"$name","Versions"),M(Tn,"configurable",{versionModelClass:Vt,transactionModelClass:ut,autoSaveInterval:"hourly",knownBaseTypes:[dt,wn,mi],versionContentLoadTimeout:6e4}),Tn._$name="Versions",ue.registerFeature(Tn,!1,"SchedulerPro");const br=(l,e,t)=>{const s=t.getFieldDefinition(l),{dataSource:i}=s,n=t.constructor.processField(l,e[i],t);return i in e&&!s.isEqual(n,t.getValue(l))};var gc=l=>class extends(l||de){startConfigure(t){this.getConfig("project"),super.startConfigure(t)}beforeApplyProjectChanges(){const{stm:t}=this;let s=!1,i=null;return this.suspendChangesTracking(),t.enabled&&(s=!0,t.isRecording&&(i=t.stash()),this.ignoreRemoteChangesInSTM?t.disable():t.startTransaction()),{shouldResume:s,transactionId:i}}async applyProjectChanges(t){var r,a;const s=this,{shouldResume:i,transactionId:n}=s.beforeApplyProjectChanges();s.trigger("startApplyChangeset"),s.applyingChangeset=!0,t.project&&s.applyProjectResponse(t.project),s.applyChangeset(H.clone(t),(o,c)=>{if(c.id==="tasks"||c.id==="events"){const{modelClass:d}=c,u=d.getFieldDataSource("startDate"),h=d.getFieldDataSource("endDate");if(o.updated)for(const f of o.updated){const p=c.getById(f[d.idField]);br("constraintType",f,p)||br("constraintDate",f,p)||(delete f[u],delete f[h])}}}),await s.commitAsync(),s.commitRespondedChanges();for(const o in t){const c=s.getStoreDescriptor(o);if(c){const{store:d}=c,u=t[o],h=[...(r=u.updated)!=null?r:[],...(a=u.added)!=null?a:[]];if(d)for(const f of h){const p=d.getById(f[d.modelClass.idField]);if(p)for(const g in p.modifications)br(g,f,p)||delete p.meta.modified[g]}}}s.afterApplyProjectChanges(i,n),s.applyingChangeset=!1,await s.commitAsync(),s.trigger("endApplyChangeset")}afterApplyProjectChanges(t,s){if(t){const{stm:i}=this;this.ignoreRemoteChangesInSTM?i.enable():i.stopTransaction(),i.applyStash(s)}this.resumeChangesTracking()}},mc=l=>{var e;return e=class extends(l||de){doDestroy(){var s;(s=this.websocketManager)===null||s===void 0||s.destroy(),super.doDestroy()}updateWsAddress(s){var i;const n=this;(i=n.websocketManager)===null||i===void 0||i.destroy(),s&&(n.websocketManager=new Pl({address:s,userName:n.wsUserName,internalListeners:{message:"handleWebsocketMessage",close:"handleWebsocketClose",error:"handleWebsocketError",thisObj:n}}),n.wsAutoLoad&&n.wsLoad()),n.toggleAutoSyncListener()}toggleAutoSyncListener(){const s=this;s.detachListeners("websocketlisteners"),s._wsAutoSync&&s._wsAddress&&s.ion({name:"websocketlisteners",hasChanges:"scheduleWebsocketMessage"})}updateWsAutoSync(){this.toggleAutoSyncListener()}updateWsProjectId(s){s!=null&&this.wsAutoLoad&&this.wsLoad()}scheduleWebsocketMessage(){const s=this;!s.hasTimeout("wsAutoSync")&&!s.isAutoSyncSuspended&&s.setTimeout({name:"wsAutoSync",fn:()=>{s.wsSync()},delay:s.autoSyncTimeout})}resumeAutoSync(s=!0){super.resumeAutoSync(s),this.websocketManager&&!this.isAutoSyncSuspended&&this.changes&&this.wsSync()}async wsSend(s,i,n=!1){return await this.wsOpen()?(this.websocketManager.send(s,i),n||this.trigger("wsSendMessage",{command:s,data:i}),!0):!1}wsReceive(s){}handleWebsocketClose(){this.trigger("wsClose")}handleWebsocketError({error:s}){this.trigger("wsError",{error:s})}async handleWebsocketMessage({data:s}){const i=this,{wsProjectId:n}=i,{project:r}=s;if(i.trigger("wsMessage",{data:s}),r===n&&s.command==="projectChange")i.trigger("wsBeforeReceiveChanges"),await i.queue(()=>i.applyProjectChanges(s.changes)),i.trigger("wsReceiveChanges");else if(r===n&&s.command==="dataset")await i.loadInlineData(s.dataset),i.trigger("wsReceiveDataset");else if(r===n&&s.command==="versionAutoSaveOK")i.trigger("wsVersionAutoSaveOK");else if(r===n&&s.command==="loadVersionContent"){const{versionId:a,project:o,content:c}=s;i.trigger("loadVersionContent",{versionId:a,project:o,content:c})}else i.wsReceive(s)}async wsOpen(){const{websocketManager:s}=this;return s?(!s.isOpened&&await s.open()&&this.trigger("wsOpen"),s.isOpened):!1}async wsLoad(){const s=this;s.wsProjectId!=null&&(await s.wsSend("dataset",{project:s.wsProjectId}),await new Promise(i=>{const n=s.ion({wsReceiveDataset(){n(),i(!0)},expires:{delay:s.wsConnectionTimeout,alt:()=>{n(),i(!1)}}})}),await s.commitAsync(),s.trigger("wsLoad"))}async wsSync(){const s=this,{wsProjectId:i}=s;if(i==null)return;await this.commitAsync();const{changes:n}=this;n&&s.wsAutoSync&&!s.autoSyncSuspendCounter&&(s.acceptChanges(),await s.wsSend("projectChange",{project:i,changes:n})&&s.trigger("wsSendChanges"))}wsClose(){var s;(s=this.websocketManager)===null||s===void 0||s.close()}},M(e,"configurable",{wsAddress:null,wsUserName:"",wsAutoLoad:!0,wsAutoSync:!0,wsConnectionTimeout:6e4,wsProjectId:null}),e},yc=l=>{var e;return e=class extends(l||de){static get $name(){return"ProjectProgressMixin"}updateProject(s,i){super.updateProject(s,i),this.setupProgressListener(),this.detachListeners("delayedCalculation"),s!=null&&s.delayCalculation&&s.ion({name:"delayedCalculation",delayCalculationStart:"internalOnProjectDelayCalculationStart",delayCalculationEnd:"internalOnProjectDelayCalculationEnd",thisObj:this})}setupProgressListener(){const s=this;if(s.detachListeners("projectProgress"),s.projectProgressReporting){var i;(i=s.project)===null||i===void 0||i.ion({name:"projectProgress",progress:"onProjectProgress",thisObj:s})}}updateProjectProgressReporting(){this.isConfiguring||this.setupProgressListener()}onProjectProgress({total:s,remaining:i,phase:n="propagating"}){const r=this;if(!r.isPainted||s<r.projectProgressThreshold)return;let a=r.projectProgressReporting;if(a==="auto"&&(a=r.project.delayCalculation?"progressbar":"mask"),a==="progressbar"){let o=r.calculationProgressElement;o||(o=r.calculationProgressElement=vt.createElement({parent:r.timeAxisSubGrid.header.element,retainElement:!0,className:"b-calculation-progress-wrap",children:[{className:"b-calculation-progress"}]})),o.firstElementChild.style.width=`${(s-i)/s*100}%`,s>0&&i===0?r.calculationProgressTimeout=r.setTimeout(()=>{var c;(c=o)===null||c===void 0||c.remove(),r.calculationProgressElement=null},50):r.clearTimeout(r.calculationProgressTimeout)}else{const o=r.L(`L{SchedulerProBase.${n}}`),c=s?`${o} ${Math.round(100*(s-i)/s)}%`:o;r.masked||r.mask({maxProgress:s,useTransition:!1,text:c}),r.masked.text=c,s&&(r.masked.maxProgress=s,r.masked.progress=s-i),s>0&&i===0&&r.unmask()}}internalOnProjectDelayCalculationStart(){this.readOnly||(this.$delayCalculationReadOnly=this.readOnly=!0)}internalOnProjectDelayCalculationEnd(){this.$delayCalculationReadOnly&&(this.$delayCalculationReadOnly=this.readOnly=!1)}get widgetClass(){}},M(e,"configurable",{projectProgressReporting:"auto",projectProgressThreshold:5e3}),e};class $n extends Or{static get $name(){return"SchedulingIssueResolutionPopup"}static get type(){return"schedulingissueresolutionpopup"}static get configurable(){return{localizableProperties:[],schedulingIssue:null,align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onCloseButtonClick",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!1,closable:!0,floating:!0,cls:"b-schedulerpro-issueresolutionpopup",layout:"vbox",resolutionsGroup:{type:"radiogroup",name:"resolutions"},items:{description:{type:"widget",cls:"b-error-description",weight:-100}},bbar:{defaults:{localeClass:this},items:{applyButton:{weight:100,color:"b-raised b-blue",text:"L{Apply}",onClick:"up.onApplyButtonClick",disabled:!0},cancelButton:{weight:200,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get selectedResolutions(){var e,t;const s=new Set,i=(e=this.resolutionsGroup)===null||e===void 0||(t=e.selected)===null||t===void 0?void 0:t.resolution;return i&&s.add(i),s}changeResolutionsGroup(e,t){return Rl.reconfigure(t,e,this)}updateResolutionsGroup(e){e&&this.add(e)}getResolutionParameters(e){return[]}onApplyButtonClick(){const e=this,{selectedResolutions:t}=e;t.size?(t.forEach(s=>s.resolve(...e.getResolutionParameters(s))),e.continueWithResolutionResult(ve.Resume),e.doResolve(t)):e.onCancelButtonClick()}onCancelButtonClick(){this.continueWithResolutionResult(ve.Cancel),this.doResolve()}onCloseButtonClick(){this.canCancel&&this.onCancelButtonClick()}get isResolving(){return!!this.resolving}async resolve({source:e,schedulingIssue:t,continueWithResolutionResult:s}){const i=this;return i.project=e,i.schedulingIssue=t,i.continueWithResolutionResult=s,i.updatePopupContent(t,s),i.onResolutionChange({}),i.show(),i.resolving=new gl,i.resolving.promise}doResolve(e){const t=this,{resolving:s}=t;s&&(t.resolving.resolve(e),t.resolving=null,t.schedulingIssue=null,t.hide())}getResolutionWidgetConfig(e){return{text:Xt.encodeHtml(e.getDescription()),cls:"b-resolution",checkedValue:e.$$name,localeClass:this,name:"resolutions",internalListeners:{change:"up.onResolutionChange"},resolution:e}}getResolutions(){var e;return(e=this.schedulingIssue)===null||e===void 0?void 0:e.getResolutions()}updatePopupContent(e,t){var s,i;const n=this,{resolutionsGroup:r}=n;t&&(n.continueWithResolutionResult=t),e?n.schedulingIssue=e:e=n.schedulingIssue,n.title=(s=e)!==null&&s!==void 0&&s.type?n.optionalL(e.type):"Unknown error",n.widgetMap.description.content=e&&Xt.encodeHtml(e.getDescription());const a=n.getResolutions(),o=(a==null?void 0:a.map(d=>n.getResolutionWidgetConfig(d)))||[],c=((i=o[0])===null||i===void 0?void 0:i.name)||"resolutions";r.removeAll(),r.name=c,r.add(...o,{ref:"cancelResolution",text:"L{Cancel changes}",name:c,checkedValue:"cancel",localeClass:this,cls:"b-resolution",internalListeners:{change:"up.onResolutionChange"}}),n.toggleControlsState()}get canApply(){return this.resolutionsGroup.value!=null}get canCancel(){var e;return!((e=this.project)!==null&&e!==void 0&&e.isInitialCommit)}get cancelResolution(){return this.resolutionsGroup.widgetMap.cancelResolution}onResolutionChange(){this.toggleControlsState()}toggleControlsState(){const e=this,{applyButton:t,cancelButton:s}=e.widgetMap;t.disabled=!e.canApply,e.cancelResolution.hidden=s.hidden=!e.canCancel}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}}$n.initClass(),$n._$name="SchedulingIssueResolutionPopup";class Pi extends $n{static get $name(){return"CycleResolutionPopup"}static get type(){return"cycleresolutionpopup"}getDependencyTitle(e){return`"${Xt.encodeHtml(e.fromEvent.name)}" -> "${Xt.encodeHtml(e.toEvent.name)}"`}getResolutionWidgetConfig(e){const{dependency:t}=e,s=this.schedulingIssue.getInvalidDependencies(),i=super.getResolutionWidgetConfig(e);return s.includes(t)&&Object.assign(i,{name:"dependency-resolution",checked:!this._dependencyResolutionsChecked++}),i}getResolutions(){const{schedulingIssue:e}=this,t=e==null?void 0:e.getInvalidDependencies();let s=e==null?void 0:e.getResolutions();return s&&t.length&&(s=s.filter(i=>i.dependency&&t.includes(i.dependency))),s}updatePopupContent(e,t){const s=this,{invalidDependenciesDescription:i,dependencyField:n}=s.widgetMap;if(s._dependencyResolutionsChecked=0,super.updatePopupContent(...arguments),i==null||i.hide(),n==null||n.hide(),e=s.schedulingIssue,e){const r=e.getDependencies(),a=e.getInvalidDependencies(),o=r.filter(c=>!a.includes(c));if(a.length)i?i.show():s.add({type:"widget",ref:"invalidDependenciesDescription",weight:-50,width:"100%",cls:"b-invalid-dependencies-description",html:s.L("L{invalidDependencyLabel}")});else{const c=o==null?void 0:o.map(d=>({value:d.id,text:s.getDependencyTitle(d)}));n?(n.value=null,n.items=c,n.show()):s.add({type:"combo",ref:"dependencyField",weight:50,width:"100%",name:"dependency",label:s.L("L{dependencyLabel}"),labelPosition:"above",cls:"b-dependency-field",items:c,internalListeners:{change:"up.onDependencyChange"}})}}}get canApply(){const{widgetMap:e}=this;return super.canApply&&(e.cancelResolution.checked||!e.dependencyField||e.dependencyField.value)}onDependencyChange(){this.toggleControlsState()}getResolutionParameters(e){if(e.isRemoveDependencyCycleEffectResolution||e.isDeactivateDependencyCycleEffectResolution){const t=this.widgetMap.dependencyField.value;return[this.project.dependencyStore.getById(t)]}return super.getResolutionParameters(e)}}Pi.initClass(),Pi._$name="CycleResolutionPopup";var vc=l=>class extends(l||de){static get $name(){return"SchedulingIssueResolution"}static get configurable(){return{schedulingIssueResolutionPopupClass:$n,cycleResolutionPopupClass:Pi,displaySchedulingIssueResolutionPopup:!0}}updateProject(t,s){super.updateProject(t,s),this.unbindSchedulingIssueResolutionFromProject(s),this.displaySchedulingIssueResolutionPopup&&t&&this.bindSchedulingIssueResolutionToProject(t)}bindSchedulingIssueResolutionToProject(t){t.ion({name:"schedulingIssueResolution",schedulingConflict:"onProjectSchedulingIssueEvent",emptyCalendar:"onProjectSchedulingIssueEvent",cycle:"onProjectSchedulingIssueEvent",thisObj:this})}get isResolving(){var t;return(t=this._lastSchedulingIssueResolutionPopup)===null||t===void 0?void 0:t.isResolving}get activeSchedulingIssueResolutionPopup(){return this.isResolving&&this._lastSchedulingIssueResolutionPopup}unbindSchedulingIssueResolutionFromProject(t){this.detachListeners("schedulingIssueResolution")}getSchedulingIssueResolutionPopup(t){return t.type==="cycle"?this._cycleResolutionPopup||(this._cycleResolutionPopup=new this.cycleResolutionPopupClass({rootElement:this.rootElement})):this._schedulingIssueResolutionPopup||(this._schedulingIssueResolutionPopup=new this.schedulingIssueResolutionPopupClass({rootElement:this.rootElement}))}onProjectSchedulingIssueEvent({schedulingIssue:t}){const s=this.getSchedulingIssueResolutionPopup(t);this._lastSchedulingIssueResolutionPopup=s,s.resolve(...arguments)}get widgetClass(){}};export{vr as AdvancedTab,Co as AssignmentAllocationInterval,dt as AssignmentModel,ir as AssignmentStore,fi as BaseAllocationInfo,hi as BaseAllocationInterval,Yn as BaseAssignmentMixin,xt as BaseCalendarMixin,As as BaseDependencyMixin,Fs as BaseDependencyResolution,Ds as BaseEmptyCalendarEffectResolution,at as BaseEventMixin,Ms as BaseHasAssignmentsMixin,si as BaseResourceMixin,St as BreakCurrentStackExecution,Y as CalculateProposed,Te as CalculatedValueGen,ss as CalculatedValueGenC,Rt as CalculatedValueSync,is as CalculatedValueSyncC,ea as CalculationGen,ta as CalculationSync,nr as CalendarField,sr as CalendarIntervalModel,So as CalendarManagerStore,rr as CalendarModel,Na as CanCombineCalendarsMixin,or as CellEdit,Ce as ChangeLogAction,wi as ChangeLogAssignmentEntity,bi as ChangeLogDependencyEntity,qe as ChangeLogEntity,Nt as ChangeLogStore,ut as ChangeLogTransactionModel,Ua as ChronoAbstractProjectMixin,ws as ChronoAssignmentStoreMixin,Ps as ChronoCalendarManagerStoreMixin,Rs as ChronoDependencyStoreMixin,ii as ChronoEventStoreMixin,Kl as ChronoEventTreeStoreMixin,oa as ChronoGraph,Mt as ChronoModelFieldIdentifier,Xn as ChronoModelMixin,Kn as ChronoModelReferenceBucketFieldIdentifier,on as ChronoModelReferenceFieldIdentifier,Ea as ChronoModelReferenceFieldQuark,vs as ChronoPartOfProjectGenericMixin,At as ChronoPartOfProjectModelMixin,st as ChronoPartOfProjectStoreMixin,js as ChronoResourceStoreMixin,Ma as ChronoStoreMixin,Un as CommitZero,zn as ComputationCycle,Ot as ConflictEffect,Ia as ConflictEffectDescription,ys as ConflictResolution,ms as ConflictSymbol,pn as ConstrainedEarlyEventMixin,jt as ConstraintInterval,Zn as ConstraintIntervalDescription,Gt as ConstraintTypePicker,Vl as ContextGen,Ll as ContextSync,Dt as CycleDescription,rt as CycleEffect,Ba as CycleEffectDescription,be as CycleResolution,Vi as CycleResolutionInput,Yr as CycleResolutionInputChrono,Pi as CycleResolutionPopup,Es as CycleSymbol,oi as DateConstraintInterval,Ja as DateConstraintIntervalDescription,Jn as DateInterval,Do as DeactivateDependencyCycleEffectResolution,Bs as DeactivateDependencyResolution,yi as Dependencies,gn as DependencyConstraintInterval,Ya as DependencyConstraintIntervalDescription,wn as DependencyModel,Eo as DependencyStore,Di as DependencyTab,hr as DependencyTypePicker,za as DurationConverterMixin,F as DurationVar,Ta as EMPTY_INTERVAL,Fe as EarlyLateLazyness,bt as EdgeType,rn as EdgeTypeNormal,Ye as EdgeTypePast,Wt as EditorTab,z as Effect,ve as EffectResolutionResult,zt as EffortField,ee as EffortVar,un as EmptyCalendarEffect,Oa as EmptyCalendarEffectDescription,Cs as EmptyCalendarSymbol,dr as EndDateField,I as EndDateVar,Fa as EngineReplica,bs as EngineRevision,xa as EngineTransaction,$e as Entity,ca as EntityIdentifier,la as EntityMeta,To as EventLoader,vi as EventResize,wo as EventSegmentModel,Pn as EventSegmentResize,ht as EventSegments,ar as EventUpdateAction,Tt as Field,he as FieldIdentifier,go as FixedDurationMixin,He as FormTab,V as Formula,Ln as FormulasCache,Si as GanttTaskEditor,ur as GeneralTab,Al as GetTransaction,ti as HasCalendarMixin,Ft as HasChildrenMixin,xs as HasDateConstraintMixin,Os as HasDependenciesMixin,qs as HasEffortMixin,_s as HasPercentDoneMixin,Kr as HasProposedNotPreviousValue,qr as HasProposedNotPreviousValueEffect,Ji as HasProposedNotPreviousValueSymbol,Pe as HasProposedValue,Hr as HasProposedValueEffect,Xi as HasProposedValueSymbol,Xs as HasSchedulingModeMixin,ri as HasSubEventsMixin,re as Identifier,Wl as IdentifierC,ne as Instruction,qn as IsChronoModelSymbol,Re as Levels,aa as Listener,nn as Meta,wa as MinimalChronoModelFieldIdentifierGen,ba as MinimalChronoModelFieldIdentifierSync,Pa as MinimalChronoModelFieldVariable,da as MinimalEntityIdentifier,os as MinimalFieldIdentifierGen,an as MinimalFieldIdentifierSync,ls as MinimalFieldVariable,Da as MinimalReferenceBucketIdentifier,Ca as MinimalReferenceBucketQuark,ga as MinimalReferenceIdentifier,nt as ModelBucketField,gi as ModelCombo,Hn as ModelField,tt as ModelReferenceField,Ct as NOT_VISITED,Cr as NotesTab,Ee as OnCycleAction,Fl as OwnIdentifier,zi as OwnIdentifierSymbol,xl as OwnQuark,Wi as OwnQuarkSymbol,fe as PartOfProject,Ci as PercentBar,bo as PercentDoneMixin,gr as PredecessorsTab,Vn as PreviousValueOf,zr as PreviousValueOfEffect,Ki as PreviousValueOfSymbol,gc as ProjectChangeHandlerMixin,lc as ProjectCrudManager,yc as ProjectProgressMixin,mc as ProjectWebSocketHandlerMixin,Ze as ProposedArgumentsOf,Xr as ProposedArgumentsOfEffect,Yi as ProposedArgumentsOfSymbol,x as ProposedOrPrevious,_i as ProposedOrPreviousSymbol,N as ProposedOrPreviousValueOf,Qr as ProposedOrPreviousValueOfEffect,Zi as ProposedOrPreviousValueOfSymbol,Gr as ProposedValueOf,Ur as ProposedValueOfEffect,Qi as ProposedValueOfSymbol,Nn as Quark,ia as QuarkGen,Pt as QuarkSync,xe as ReadMode,lr as ReadyStatePropagator,Ut as RecurrenceTab,hs as ReferenceBucketField,fs as ReferenceBucketIdentifier,va as ReferenceBucketQuark,ds as ReferenceField,us as ReferenceIdentifier,Je as Reject,Et as RejectEffect,en as RejectSymbol,Xa as RemoveDateConstraintConflictResolution,ka as RemoveDependencyCycleEffectResolution,ks as RemoveDependencyResolution,as as Replica,Ys as ResourceAllocationEventRangeCalendar,yo as ResourceAllocationEventRangeCalendarIntervalMixin,vo as ResourceAllocationEventRangeCalendarIntervalStore,pi as ResourceAllocationInfo,er as ResourceAllocationInterval,mi as ResourceModel,Po as ResourceStore,mr as ResourcesTab,Wn as Revision,_a as SEDBackwardCycleResolutionContext,$s as SEDDispatcher,Is as SEDDispatcherIdentifier,Va as SEDForwardCycleResolutionContext,Ts as SEDGraphDescription,lo as SEDWUDispatcher,co as SEDWUDispatcherIdentifier,Za as ScheduledByDependenciesEarlyEventMixin,Sr as SchedulerAdvancedTab,ni as SchedulerBasicEvent,qa as SchedulerBasicProjectMixin,Dr as SchedulerGeneralTab,Ls as SchedulerProAssignmentMixin,En as SchedulerProCycleEffect,Vs as SchedulerProDependencyMixin,mo as SchedulerProEvent,di as SchedulerProHasAssignmentsMixin,ac as SchedulerProProjectMixin,tr as SchedulerProResourceMixin,Er as SchedulerTaskEditor,Ht as SchedulingDirectionPicker,ln as SchedulingIssueEffectResolution,vc as SchedulingIssueResolution,$n as SchedulingIssueResolutionPopup,yr as SchedulingModePicker,Sa as Schema,cr as StartDateField,$ as StartDateVar,Ro as StateTrackingManager,pr as SuccessorsTab,_n as SynchronousCalculationStarted,Ei as TaskEdit,Rn as TaskEditorBase,A as TombStone,rs as Transaction,sa as TransactionCycleDetectionWalkContext,Ni as TransactionSymbol,ra as TransactionWalkDepth,se as UnitsVar,Bl as UnsafePreviousValueOf,Zr as UnsafePreviousValueOfEffect,ts as UnsafePreviousValueOfSymbol,kl as UnsafeProposedOrPreviousValueOf,Jr as UnsafeProposedOrPreviousValueOfEffect,es as UnsafeProposedOrPreviousValueOfSymbol,ja as Use24hrsEmptyCalendarEffectResolution,Aa as Use8hrsEmptyCalendarEffectResolution,Xe as VISITED_TOPOLOGICALLY,sn as Variable,ns as VariableC,we as VariableInputState,_r as VariableWalkContext,Vt as VersionModel,_t as VersionStore,Tn as Versions,Li as WalkContext,Br as WalkSource,Ri as WalkState,Nr as Write,Gi as WriteEffect,Wr as WriteSeveral,qi as WriteSeveralEffect,Hi as WriteSeveralSymbol,Ui as WriteSymbol,ya as bucket,ha as build_proposed,D as calculate,Qa as calculateEffectiveEndDateConstraintInterval,Ka as calculateEffectiveStartDateConstraintInterval,cs as createEntityOnPrototype,Lr as cycleInfo,it as dateConverter,ze as durationFormula,Dn as effortFormula,Ks as endDateByEffortFormula,Me as endDateFormula,et as ensureEntityOnPrototype,Gl as entity,ps as entityDecoratorBody,T as field,Zs as fixedDurationAndEffortSEDWUGraphDescription,po as fixedDurationSEDWUBackwardEffortDriven,fo as fixedDurationSEDWUBackwardNonEffortDriven,ho as fixedDurationSEDWUForwardEffortDriven,uo as fixedDurationSEDWUForwardNonEffortDriven,Js as fixedDurationSEDWUGraphDescription,te as generic_field,Ra as getDecoratedModelFields,Qn as injectStaticFieldsProperty,We as intersectIntervals,Jt as isAtomicValue,It as isSerializableEqual,E as model_field,w as prototypeValue,pa as reference,kr as required,tn as runGeneratorAsyncWithEffect,na as runGeneratorSyncWithEffect,Qs as startDateByEffortFormula,Ie as startDateFormula,me as throwUnknownIdentifier,Bt as unitsFormula,Ol as validateRequiredProperties,ye as write};
//# sourceMappingURL=SchedulingIssueResolution.js.map
