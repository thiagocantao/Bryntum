/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{Widget as m,BrowserHelper as x,DomHelper as p,EventHelper as w}from"./Editor.js";const b=["b-horizontal","b-vertical"],v=g=>p.getStyleValue(g.parentElement,"display")==="flex"&&(parseInt(p.getStyleValue(g,"flex-basis"),10)||parseInt(p.getStyleValue(g,"flex-grow"),10)),y={horizontal:!1,vertical:!0};class f extends m{static get $name(){return"Splitter"}static get type(){return"splitter"}static get configurable(){return{orientation:"auto",vertical:null,containerElement:{$config:"nullify",value:null},nextNeighbor:{$config:"nullify",value:null},previousNeighbor:{$config:"nullify",value:null}}}static get delayable(){return{syncState:"raf"}}doDestroy(){var t;(t=this.mouseDetacher)===null||t===void 0||t.call(this),super.doDestroy()}compose(){return{class:{"b-splitter":1},listeners:{pointerdown:"onMouseDown",mouseenter:"syncState",...!x.supportsPointerEvents&&{mousedown:"onMouseDown",touchstart:"onMouseDown"}}}}get currentOrientation(){return this.vertical?"vertical":"horizontal"}getSibling(t=!0){let{element:i}=this,e;for(;!e&&(i=i[`${t?"next":"previous"}ElementSibling`]);)(!i.isConnected||p.isVisible(i))&&(e=i);return e}get nextWidget(){let{element:t}=this,i;for(;!i&&(t=t.nextElementSibling);)i=m.fromElement(t,this.element.parentElement);return i}get previousWidget(){let{element:t}=this,i;for(;!i&&(t=t.previousElementSibling);)i=m.fromElement(t,this.element.parentElement);return i}updateContainerElement(t){var i;const e=this;e.stateDetector=(i=e.stateDetector)===null||i===void 0?void 0:i.disconnect(),t&&(e.stateDetector=new MutationObserver(()=>e.syncState()),e.stateDetector.observe(t,{attributes:!0,childList:!0}))}updateNextNeighbor(t){this.watchNeighbor(t,"next")}updatePreviousNeighbor(t){this.watchNeighbor(t,"previous")}watchNeighbor(t,i){this.detachListeners(i),t==null||t.ion({name:i,thisObj:this,collapse:"syncState",expand:"syncState",hide:"syncState",show:"syncState"})}updateOrientation(){this.syncState.now()}updateVertical(t){var i;const e=(i=this.element)===null||i===void 0?void 0:i.classList;e==null||e.add(b[t?1:0]),e==null||e.remove(b[t?0:1])}syncState(){var u;const t=this,{element:i,nextWidget:e,previousWidget:s}=t;let o=(u=y[t.orientation])!=null?u:null;if(t.nextNeighbor=e,t.previousNeighbor=s,t.disabled=e&&(e.collapsible&&e.collapsed||e.hidden)||s&&(s.collapsible&&s.collapsed||s.hidden),o!==null&&e&&s)t.containerElement=null;else if(t.containerElement=i.parentElement,t.rendered&&i.offsetParent){const r=p.getStyleValue(i.parentElement,"flex-direction");if(r)o=!r.startsWith("column");else{const a=i.previousElementSibling,c=i.nextElementSibling;if(!a||!c)return;const n=a.getBoundingClientRect(),l=c.getBoundingClientRect(),h=n.top<l.top?n:l,d=h===l?n:l;o=h.top===d.top}}t.vertical=o}onMouseDown(t){var i;t.preventDefault(),t.touches&&(t=t.touches[0]);const e=this,{element:s,nextNeighbor:o,previousNeighbor:u}=e,r=u?u.element:e.getSibling(!1),a=o?o.element:e.getSibling(),c=v(r),n=v(a),l=[];(i=e.mouseDetacher)===null||i===void 0||i.call(e);for(const d of s.parentElement.children)v(d)&&d!==s&&l.push({element:d,width:d.offsetWidth,height:d.offsetHeight});e.context={startX:t.pageX,startY:t.pageY,prevWidth:r.offsetWidth,prevHeight:r.offsetHeight,nextWidth:a.offsetWidth,nextHeight:a.offsetHeight,prevHasFlex:c,nextHasFlex:n,flexed:l,prev:r,next:a};const h={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:e};x.supportsPointerEvents||(h.mousemove=h.touchmove="onMouseMove",h.mouseup=h.touchend="onMouseUp"),s.classList.add("b-moving"),e.mouseDetacher=w.on(h),e.trigger("splitterMouseDown",{event:t})}onMouseMove(t){const i=this,{context:e,nextWidget:s,previousWidget:o}=i,u=e.prev.style,r=e.next.style,a=(t.pageX-e.startX)*(i.rtl?-1:1),c=t.pageY-e.startY;if(t.preventDefault(),Object.assign(e,{deltaX:a,deltaY:c}),e.started||(e.started=!0,i.trigger("dragStart",{context:e,event:t}),e.flexed.forEach(n=>{n.element.style.flexGrow=i.vertical?n.width:n.height,n.element.style.flexBasis="0"})),i.vertical){const n=e.prevWidth+a,l=e.nextWidth-a;e.prevHasFlex?u.flexGrow=n:o?o.width=n:u.width=`${n}px`,e.nextHasFlex?r.flexGrow=l:s?s.width=l:r.width=`${l}px`}else{const n=e.prevHeight+c,l=e.nextHeight-c;e.prevHasFlex?u.flexGrow=n:o?o.height=n:u.height=`${n}px`,e.nextHasFlex?r.flexGrow=l:s?s.height=l:r.height=`${l}px`}i.trigger("drag",{context:e,event:t})}onMouseUp(t){var i;const e=this;(i=e.mouseDetacher)===null||i===void 0||i.call(e),e.mouseDetacher=null,e.element.classList.remove("b-moving"),e.context.started&&e.trigger("drop",{context:e.context,event:t}),e.context=null}render(){super.render(...arguments),this.syncState.now(),this.vertical===null&&this.syncState()}}f.initClass(),f._$name="Splitter";export{f as Splitter};
//# sourceMappingURL=Splitter.js.map
