{
  "version": 3,
  "sources": ["../../../../Core/lib/Core/widget/base/UndoRedoBase.js"],
  "sourcesContent": ["import Container from '../Container.js';\nimport '../Combo.js';\n\n/**\n * @module Core/widget/base/UndoRedoBase\n */\n\n/**\n * Abstract base class used by UndoRedo widgets in Scheduler and TaskBoard.\n *\n * @extends Core/widget/Container\n * @abstract\n */\nexport default class UndoRedoBase extends Container {\n    static get $name() {\n        return 'UndoRedoBase';\n    }\n\n    static get type() {\n        return 'undoredobase';\n    }\n\n    static get configurable() {\n        return {\n            // Documented on subclasses\n            project : null,\n\n            stm : null,\n\n            /**\n             * Configure as `true` to show \"Undo\" and \"Redo\" as button texts. The buttons always have a tooltip\n             * as a hint to the user as to their purpose.\n             * @config {Boolean}\n             */\n            text : null,\n\n            /**\n             * Button color for the undo and redo buttons. See {@link Core.widget.Button#config-color}.\n             * @config {String}\n             */\n            color : null,\n\n            /**\n             * Configure as `true` to show \"0\" badge on the undo and redo buttons when they have no actions\n             * left to perform. By default when there are no actions, no badge is displayed.\n             * @config {Boolean}\n             */\n            showZeroActionBadge : null,\n\n            cls : 'b-undo-controls b-toolbar',\n\n            layoutStyle : {\n                alignItems : 'stretch',\n                flexFlow   : 'row nowrap',\n                overflow   : 'visible'\n            },\n\n            items : {\n                undoBtn : {\n                    type     : 'button',\n                    icon     : 'b-icon-undo',\n                    tooltip  : 'L{UndoRedo.UndoLastAction}',\n                    onAction : 'up.onUndo'     // 'up.' means method is on a parent Widget.\n                },\n                transactionsCombo : {\n                    type                 : 'combo',\n                    valueField           : 'idx',\n                    editable             : false,\n                    store                : {},\n                    emptyText            : 'L{UndoRedo.NoActions}',\n                    onAction             : 'up.onTransactionSelected',\n                    displayValueRenderer : 'up.transactionsDisplayValueRenderer'\n                },\n                redoBtn : {\n                    type     : 'button',\n                    icon     : 'b-icon-redo',\n                    tooltip  : 'L{UndoRedo.RedoLastAction}',\n                    onAction : 'up.onRedo'\n                }\n            },\n\n            // This is treated as atomic by the Toolbar's menu overflow processing.\n            overflowable : true\n        };\n    }\n\n    afterConstruct() {\n        this.updateUndoRedoControls();\n    }\n\n    updateStm(stm) {\n        this.detachListeners('undoredo');\n\n        stm?.ion({\n            name          : 'undoredo',\n            recordingstop : 'updateUndoRedoControls',\n            restoringstop : 'updateUndoRedoControls',\n            queueReset    : 'updateUndoRedoControls',\n            disabled      : 'updateUndoRedoControls',\n            thisObj       : this\n        });\n    }\n\n    changeItems(items) {\n        const { undoBtn, redoBtn } = items;\n\n        if (this.color) {\n            undoBtn && (undoBtn.color = this.color);\n            redoBtn && (redoBtn.color = this.color);\n        }\n        if (this.text) {\n            undoBtn && (undoBtn.text = 'L{UndoRedo.Undo}');\n            redoBtn && (redoBtn.text = 'L{UndoRedo.Redo}');\n        }\n\n        return super.changeItems(items);\n    }\n\n    updateProject(project) {\n        this.stm = project.stm;\n    }\n\n    fillUndoRedoCombo() {\n        const { transactionsCombo } = this.widgetMap;\n\n        // The transactionsCombo may be configured away if only undo and redo buttons are wanted\n        transactionsCombo && (transactionsCombo.items =\n            [[0, 'Original data'], ...this.stm.queue.map((title, idx) => [idx + 1, title || `Transaction ${idx + 1}`])]\n        );\n    }\n\n    updateUndoRedoControls() {\n        const\n            {\n                stm,\n                showZeroActionBadge\n            } = this,\n            {\n                undoBtn,\n                redoBtn,\n                transactionsCombo\n            } = this.widgetMap;\n\n        undoBtn.badge = stm.position || (showZeroActionBadge ? '0' : '');\n        redoBtn.badge = (stm.length - stm.position) || (showZeroActionBadge ? '0' : '');\n\n        undoBtn.disabled = !stm.canUndo;\n        redoBtn.disabled = !stm.canRedo;\n\n        this.fillUndoRedoCombo();\n\n        if (transactionsCombo) {\n            transactionsCombo.disabled = transactionsCombo.store.count <= 1;\n        }\n    }\n\n    transactionsDisplayValueRenderer(record, combo) {\n        const stmPos = this.stm?.position || 0;\n\n        return `${stmPos} undo actions / ${combo.store.count - stmPos - 1} redo actions`;\n    }\n\n    onUndo() {\n        this.stm.canUndo && this.stm.undo();\n    }\n\n    onRedo() {\n        this.stm.canRedo && this.stm.redo();\n    }\n\n    onTransactionSelected(combo) {\n        const\n            { stm } = this,\n            delta = stm.position - combo.value;\n\n        if (delta > 0) {\n            stm.canUndo && stm.undo(delta);\n        }\n        else if (delta < 0) {\n            stm.canRedo && stm.redo(-delta);\n        }\n    }\n}\n\nUndoRedoBase.initClass();\n"],
  "mappings": "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",
  "names": ["UndoRedoBase", "Container", "$name", "type", "configurable", "project", "stm", "text", "color", "showZeroActionBadge", "cls", "layoutStyle", "alignItems", "flexFlow", "overflow", "items", "undoBtn", "icon", "tooltip", "onAction", "transactionsCombo", "valueField", "editable", "store", "emptyText", "displayValueRenderer", "redoBtn", "overflowable", "afterConstruct", "updateUndoRedoControls", "updateStm", "detachListeners", "ion", "name", "recordingstop", "restoringstop", "queueReset", "disabled", "thisObj", "changeItems", "updateProject", "fillUndoRedoCombo", "widgetMap", "queue", "map", "title", "idx", "badge", "position", "length", "canUndo", "canRedo", "count", "transactionsDisplayValueRenderer", "record", "combo", "_this$stm", "stmPos", "onUndo", "undo", "onRedo", "redo", "onTransactionSelected", "delta", "value", "initClass", "_$name"]
}
