/*!
 *
 * Bryntum Gantt 5.5.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var Qr=Object.defineProperty;var Zr=(l,t,e)=>t in l?Qr(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var v=(l,t,e)=>(Zr(l,typeof t!="symbol"?t+"":t,e),e);import{prototypeValue as Wt,ConflictResolution as es,ConstraintIntervalDescription as jn,ConstraintInterval as On,BaseEventMixin as ts,HasChildrenMixin as zt,ConstrainedEarlyEventMixin as Bn,field as V,EarlyLateLazyness as L,model_field as Se,dateConverter as Vn,calculate as x,ConflictEffect as Gn,EffectResolutionResult as _n,Reject as Nn,ScheduledByDependenciesEarlyEventMixin as ns,isAtomicValue as Un,CycleDescription as Wn,StartDateVar as zn,EndDateVar as Hn,DurationVar as qn,EffortVar as Ge,UnitsVar as be,endDateByEffortFormula as Ee,durationFormula as ue,unitsFormula as Kn,effortFormula as _e,startDateByEffortFormula as Te,startDateFormula as Ne,endDateFormula as Ue,CycleResolution as ge,HasSchedulingModeMixin as Xn,HasProposedValue as Jn,write as rs,ProposedOrPrevious as We,SchedulerProEvent as ss,SchedulerProProjectMixin as as,HasEffortMixin as is,SchedulerProAssignmentMixin as os,SchedulerProResourceMixin as ls,ChronoEventTreeStoreMixin as Yn,UnsafeProposedOrPreviousValueOf as he,ConstraintTypePicker as ds,EffortField as cs,AssignmentStore as Qn,AssignmentModel as us,isSerializableEqual as Zn,SchedulingDirectionPicker as gs,SchedulingModePicker as er,CalendarModel as hs,CalendarManagerStore as ms,DependencyModel as fs,DependencyStore as ps,ResourceModel as vs,ResourceStore as Ds,PartOfProject as tr,PercentDoneMixin as ys,EventSegmentModel as Cs,CellEdit as Ss,Dependencies as bs,GanttTaskEditor as Es,TaskEdit as Ts,EventResize as ws,EventSegmentResize as ks,Versions as nr,CalendarIntervalModel as xs,ProjectChangeHandlerMixin as $s,ProjectCrudManager as Ms,DateConstraintInterval as Is,DependencyConstraintInterval as Rs,StateTrackingManager as Ps,ProjectWebSocketHandlerMixin as Ls,ProjectProgressMixin as As,SchedulingIssueResolution as Fs}from"./chunks/SchedulingIssueResolution.js";import{Mixin as G,format as Ht,ConstraintIntervalSide as _,Direction as E,TimeUnit as qt,MAX_DATE as we,isDateFinite as rr,MIN_DATE as ke,DependencyType as j,ConstraintType as ze,SchedulingMode as He,MixinAny as js,ProjectType as Os,TimeSpan as Kt,DependencyBaseModel as qe,DayIndexMixin as Bs,GetEventsMixin as Vs,ProjectCurrentConfig as Gs,ProjectModelTimeZoneMixin as _s,ProjectModelCommon as Ns,CrudManagerView as Us}from"./chunks/CrudManagerView.js";import{Localizable as Ws,DateHelper as y,Combo as Ke,Store as xe,Collection as sr,LocaleManagerSingleton as zs,TextField as ar,Objects as H,List as Hs,Rectangle as I,StringHelper as $,Delayable as Xe,LocaleHelper as qs,PickerField as Ks,ObjectHelper as A,ChipView as Xs,DomHelper as q,FunctionHelper as Js,Duration as Je,Wbs as K,DataField as Ys,AjaxStore as Qs,InstancePlugin as $e,VersionHelper as ir,DomClassList as X,ArrayHelper as or,EventHelper as Xt,Tooltip as Zs,WalkHelper as ea,DomSync as Ye,Model as lr,AsyncHelper as ta,BrowserHelper as na,Base as N,DomDataStore as ra,Toast as dr}from"./chunks/Editor.js";import{ColumnStore as C,Column as P,CheckColumn as J,GridFeatureManager as b}from"./chunks/GridBase.js";import{DateColumn as sa}from"./chunks/DateColumn.js";import{DurationColumn as Y,Dependencies as aa,TooltipBase as Qe,AbstractTimeRanges as ia,TransactionalFeature as Jt,DragBase as oa,DragCreateBase as la}from"./chunks/TimeAxisHeaderMenu.js";import{TreeColumn as da,NumberColumn as cr}from"./chunks/Tree.js";import{RandomGenerator as ca,Parser as ua,XMLHelper as ga}from"./chunks/TextAreaPickerField.js";import{DragHelper as ha}from"./chunks/MessageDialog.js";import{Grid as ma,RowCopyPaste as fa}from"./chunks/Grid.js";import{ResourceInfoColumn as pa,Labels as va,TimelineSummary as Da,MultiPageExporter as ya,MultiPageVerticalExporter as Ca,SinglePageExporter as Sa,PdfExport as ba}from"./chunks/PdfExport2.js";import{AvatarRendering as Ea,Draggable as Ta}from"./chunks/AvatarRendering.js";import{TimeAxisColumn as wa,AttachToProjectMixin as Yt,EventMenu as ka,ProjectConsumer as xa,TimelineBase as $a,SchedulerEventNavigation as Ma,TransactionalFeatureMixin as Ia,CurrentConfig as Ra}from"./chunks/ScheduleMenu.js";import{TreeGroup as Pa}from"./chunks/TreeGroup.js";import"./chunks/PdfExport.js";import"./chunks/TextAreaField.js";import"./chunks/TabPanel.js";import"./chunks/Card.js";import"./chunks/GridRowModel.js";import"./chunks/Slider.js";import"./chunks/Exporter.js";var ur=function(l,t,e,n){var r=arguments.length,s=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(l,t,e,n);else for(var i=l.length-1;i>=0;i--)(a=l[i])&&(s=(r<3?a(s):r>3?a(t,e,s):a(t,e))||s);return r>3&&s&&Object.defineProperty(t,e,s),s};class gr extends G([ts,zt,Bn],t=>{const e=t.prototype;class n extends t{*maybeSkipNonWorkingTime(s,a=!0){return(yield this.$.childEvents).size>0?s:yield*e.maybeSkipNonWorkingTime.call(this,s,a)}*calculateStartDateConstraintIntervals(){const s=yield*e.calculateStartDateConstraintIntervals.call(this),a=yield this.$.parentEvent;if(a!=null&&a.graph){const i=yield a.$.startDateConstraintIntervals;s.push.apply(s,i)}return s}*calculateEndDateConstraintIntervals(){const s=yield*e.calculateEndDateConstraintIntervals.call(this),a=yield this.$.parentEvent;if(a!=null&&a.graph){const i=yield a.$.endDateConstraintIntervals;s.push.apply(s,i)}return s}*calculateEarlyStartDateConstraintIntervals(){const s=yield*e.calculateEarlyStartDateConstraintIntervals.call(this),a=yield this.$.parentEvent;if(a!=null&&a.graph){const i=yield a.$.earlyStartDateConstraintIntervals;s.push.apply(s,i),(yield a.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===E.Forward&&s.push(Me.new({owner:a,side:_.Start,startDate:yield a.$.startDate}))}return s}*calculateEarlyEndDateConstraintIntervals(){const s=yield*e.calculateEarlyEndDateConstraintIntervals.call(this),a=yield this.$.parentEvent;if(a!=null&&a.graph){const i=yield a.$.earlyEndDateConstraintIntervals;s.push.apply(s,i)}return s}}return n}){}class hr extends Ws(es){static get $name(){return"RemoveManuallyScheduledParentConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:t}=this;return Ht(this.L("L{descriptionTpl}"),t.name||t.id)}resolve(){this.event.manuallyScheduled=!1}}class mr extends jn{static get $name(){return"ManuallyScheduledParentConstraintIntervalDescription"}static getDescription(t){let e;switch(t.side){case _.Start:e=this.L("L{startDescriptionTpl}");break;case _.End:e=this.L("L{endDescriptionTpl}");break}return Ht(e,...this.getDescriptionParameters(t))}static getDescriptionParameters(t){const e=t.owner;return[y.format(t.startDate,this.L("L{dateFormat}")),y.format(t.endDate,this.L("L{dateFormat}")),e.name||e.id]}}class Me extends On{getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(t){const e=this.owner;t=t||e.graph.activeTransaction;const n=t.entries.get(e.$.manuallyScheduled);return!t.baseRevision.hasIdentifier(e.$$)||n&&!n.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.resetManuallyScheduledConflictResolutionClass.new({interval:this})])}}ur([Wt(hr)],Me.prototype,"resetManuallyScheduledConflictResolutionClass",void 0),ur([Wt(mr)],Me.prototype,"descriptionBuilderClass",void 0);var T=function(l,t,e,n){var r=arguments.length,s=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(l,t,e,n);else for(var i=l.length-1;i>=0;i--)(a=l[i])&&(s=(r<3?a(s):r>3?a(t,e,s):a(t,e))||s);return r>3&&s&&Object.defineProperty(t,e,s),s};class Ze extends G([Bn,zt],t=>{const e=t.prototype;class n extends t{*calculateLateStartDateConstraintIntervals(){const s=[],a=yield this.$.parentEvent;if(a){const i=yield a.$.lateStartDateConstraintIntervals;s.push.apply(s,i)}return s}*calculateLateEndDateConstraintIntervals(){const s=[],a=yield this.$.parentEvent;if(a){const i=yield a.$.lateEndDateConstraintIntervals;s.push.apply(s,i),(yield a.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===E.Backward&&s.push(Me.new({side:_.End,endDate:yield a.$.endDate}))}return s}*shouldRollupChildLateStartDate(s){return!0}*calculateMinChildrenLateStartDate(){let s=we;const a=yield*this.subEventsIterable();for(let i of a){if(!(yield*this.shouldRollupChildLateStartDate(i)))continue;let o;(yield i.$.manuallyScheduled)&&(yield*i.hasSubEvents())&&(o=yield i.$.minChildrenLateStartDate),o=o||(yield i.$.lateStartDate),o&&o<s&&(s=o)}return s.getTime()-we.getTime()?s:null}*calculateLateStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===E.Backward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenLateStartDate;if(!(yield*this.isConstrainedLate()))return yield this.$.startDate;const s=(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),a=(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals);let i=yield*this.calculateEffectiveConstraintInterval(!0,s,a);if(i===null)return null;if(i.isIntervalEmpty()){i=yield*this.calculateEffectiveConstraintInterval(!0,s,a,!0);const o=Gn.new({intervals:[...i.intersectionOf]});if((yield o)===_n.Cancel)yield Nn(o);else return null}return rr(i.endDate)?i.endDate:null}*shouldRollupChildLateEndDate(s){return!0}*calculateMaxChildrenLateEndDate(){let s=ke;const a=yield*this.subEventsIterable();for(let i of a){if(!(yield*this.shouldRollupChildLateEndDate(i)))continue;let o;(yield i.$.manuallyScheduled)&&(yield*i.hasSubEvents())&&(o=yield i.$.maxChildrenLateEndDate),o=o||(yield i.$.lateEndDate),o&&o>s&&(s=o)}return s.getTime()-ke.getTime()?s:null}*calculateLateStartDate(){return yield this.$.lateStartDateRaw}*calculateLateEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.effectiveDirection).direction===E.Backward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenLateEndDate;if(!(yield*this.isConstrainedLate()))return yield this.$.endDate;const s=yield this.$.lateStartDateConstraintIntervals,a=yield this.$.lateEndDateConstraintIntervals;let i=yield*this.calculateEffectiveConstraintInterval(!1,s.concat(yield this.$.startDateConstraintIntervals),a.concat(yield this.$.endDateConstraintIntervals));if(i===null)return null;if(i.isIntervalEmpty()){i=yield*this.calculateEffectiveConstraintInterval(!1,(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals),!0);const o=Gn.new({intervals:[...i.intersectionOf]});if((yield o)===_n.Cancel)yield Nn(o);else return null}return rr(i.endDate)?i.endDate:null}*calculateLateEndDate(){const s=yield this.$.lateEndDateRaw;return yield*this.maybeSkipNonWorkingTime(s,!1)}*calculateTotalSlack(){const s=yield this.$.earlyStartDateRaw,a=yield this.$.lateStartDateRaw,i=yield this.$.earlyEndDateRaw,o=yield this.$.lateEndDateRaw,d=yield this.$.slackUnit;let c,u;return(s&&a||i&&o)&&(s&&a?(u=yield*this.calculateProjectedDuration(s,a,d),i&&o&&(c=yield*this.calculateProjectedDuration(i,o,d),c<u&&(u=c))):i&&o&&(u=yield*this.calculateProjectedDuration(i,o,d))),u}*calculateCritical(){return(yield this.$.totalSlack)<=0}*isConstrainedLate(){const s=yield this.$.startDateConstraintIntervals,a=yield this.$.endDateConstraintIntervals,i=yield this.$.lateStartDateConstraintIntervals,o=yield this.$.lateEndDateConstraintIntervals;return!!(s!=null&&s.length||a!=null&&a.length||i!=null&&i.length||o!=null&&o.length)}*calculateStartDatePure(){return(yield this.$.effectiveDirection).direction===E.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*e.calculateStartDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():yield this.$.lateStartDate:yield*e.calculateStartDatePure.call(this)}*calculateStartDateProposed(){switch((yield this.$.effectiveDirection).direction){case E.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*e.calculateStartDateProposed.call(this):(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():(yield this.$.lateStartDate)||(yield*e.calculateStartDateProposed.call(this));default:return yield*e.calculateStartDateProposed.call(this)}}*calculateEndDatePure(){return(yield this.$.effectiveDirection).direction===E.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*e.calculateEndDatePure.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():yield this.$.lateEndDate:yield*e.calculateEndDatePure.call(this)}*calculateEndDateProposed(){switch((yield this.$.effectiveDirection).direction){case E.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*e.calculateEndDateProposed.call(this):(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():(yield this.$.lateEndDate)||(yield*e.calculateEndDateProposed.call(this));default:return yield*e.calculateEndDateProposed.call(this)}}}return T([V({lazy:L})],n.prototype,"minChildrenLateStartDate",void 0),T([V({lazy:L})],n.prototype,"lateStartDateRaw",void 0),T([Se({type:"date",persist:!1},{lazy:L,converter:Vn,persistent:!1})],n.prototype,"lateStartDate",void 0),T([V({lazy:L})],n.prototype,"maxChildrenLateEndDate",void 0),T([V({lazy:L})],n.prototype,"lateEndDateRaw",void 0),T([Se({type:"date",persist:!1},{lazy:L,converter:Vn,persistent:!1})],n.prototype,"lateEndDate",void 0),T([V({lazy:L})],n.prototype,"lateStartDateConstraintIntervals",void 0),T([V({lazy:L})],n.prototype,"lateEndDateConstraintIntervals",void 0),T([Se({type:"number",persist:!1},{lazy:L,persistent:!1})],n.prototype,"totalSlack",void 0),T([Se({type:"string",defaultValue:qt.Day,persist:!1},{lazy:L,converter:y.normalizeUnit,persistent:!1})],n.prototype,"slackUnit",void 0),T([Se({type:"boolean",defaultValue:!1,persist:!1},{persistent:!1,lazy:L})],n.prototype,"critical",void 0),T([x("lateStartDateConstraintIntervals")],n.prototype,"calculateLateStartDateConstraintIntervals",null),T([x("lateEndDateConstraintIntervals")],n.prototype,"calculateLateEndDateConstraintIntervals",null),T([x("minChildrenLateStartDate")],n.prototype,"calculateMinChildrenLateStartDate",null),T([x("lateStartDateRaw")],n.prototype,"calculateLateStartDateRaw",null),T([x("maxChildrenLateEndDate")],n.prototype,"calculateMaxChildrenLateEndDate",null),T([x("lateStartDate")],n.prototype,"calculateLateStartDate",null),T([x("lateEndDateRaw")],n.prototype,"calculateLateEndDateRaw",null),T([x("lateEndDate")],n.prototype,"calculateLateEndDate",null),T([x("totalSlack")],n.prototype,"calculateTotalSlack",null),T([x("critical")],n.prototype,"calculateCritical",null),n}){}var La=function(l,t,e,n){var r=arguments.length,s=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(l,t,e,n);else for(var i=l.length-1;i>=0;i--)(a=l[i])&&(s=(r<3?a(s):r>3?a(t,e,s):a(t,e))||s);return r>3&&s&&Object.defineProperty(t,e,s),s};class Qt extends G([ns,Ze],t=>{const e=t.prototype;class n extends t{*shouldSuccessorAffectScheduling(s){const a=yield s.$.toEvent;return a&&!Un(a)&&(yield s.$.active)&&(!(yield a.$.inactive)||(yield this.$.inactive))}*calculateLateStartDateConstraintIntervals(){const s=yield*e.calculateLateStartDateConstraintIntervals.call(this),a=this.getProject(),i=a.dependencyConstraintIntervalClass;let o;for(o of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(o)))continue;const d=yield o.$.toEvent,c=yield d.$.manuallyScheduled;let u;switch(yield o.$.type){case j.StartToStart:u=c?yield d.$.startDate:yield d.$.lateStartDateRaw;break;case j.StartToEnd:u=c?yield d.$.endDate:yield d.$.lateEndDateRaw;break}if(u){const g=yield o.$.lag,m=yield o.$.lagUnit,h=yield*a.$convertDuration(g,m,qt.Millisecond),p=yield o.$.calendar;yield p.$.version;let D=u;h&&(D=p.skipNonWorkingTime(p.calculateStartDate(u,h)));const f=i.new({owner:o,startDate:null,endDate:D});s.unshift(f)}}return s}*calculateLateEndDateConstraintIntervals(){const s=yield*e.calculateLateEndDateConstraintIntervals.call(this),a=this.getProject(),i=a.dependencyConstraintIntervalClass;let o;for(o of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(o)))continue;const d=yield o.$.toEvent,c=yield d.$.manuallyScheduled;let u;switch(yield o.$.type){case j.EndToEnd:u=c?yield d.$.endDate:yield d.$.lateEndDateRaw;break;case j.EndToStart:u=c?yield d.$.startDate:yield d.$.lateStartDateRaw;break}if(u){const g=yield o.$.lag,m=yield o.$.lagUnit,h=yield*a.$convertDuration(g,m,qt.Millisecond),p=yield o.$.calendar;yield p.$.version;let D=u;h&&(D=p.skipNonWorkingTime(p.calculateStartDate(u,h)));const f=i.new({owner:o,startDate:null,endDate:D});s.unshift(f)}}return s}*calculateEffectiveDirection(){const s=yield this.getProject().$.effectiveDirection,a=yield this.$.constraintType;if(s.direction===E.Backward&&!(yield this.$.manuallyScheduled)&&!((a===ze.MustStartOn||a===ze.MustFinishOn)&&(yield this.$.constraintDate)))for(const i of yield this.$.outgoingDeps){const o=yield i.$.toEvent,d=o!=null&&!Un(o),c=d?yield o.$.constraintType:void 0;if(!d||!(yield i.$.active)||(yield o.$.manuallyScheduled)||(c===ze.MustStartOn||c===ze.MustFinishOn)&&(yield o.$.constraintDate))continue;const u=yield i.$.type,g=u===j.EndToEnd||u===j.StartToEnd?yield o.$.endDateDirection:yield o.$.startDateDirection;if(g.direction===E.Forward)return{kind:"enforced",direction:E.Forward,enforcedBy:g.kind==="enforced"?g.enforcedBy:g.kind==="own"?o:g.inheritedFrom}}return yield*super.calculateEffectiveDirection()}}return La([x("lateStartDateIntervals")],n.prototype,"calculateLateStartDateConstraintIntervals",null),n}){}const Zt=Wn.new({variables:new Set([zn,Hn,qn,Ge,be]),formulas:new Set([Ee,ue,Kn,_e,Te,Ne,Ue])}),fr=ge.new({description:Zt,defaultResolutionFormulas:new Set([Ee,ue])}),pr=ge.new({description:Zt,defaultResolutionFormulas:new Set([Te,ue])});class vr extends G([Xn],t=>{const e=t.prototype;class n extends t{*prepareDispatcher(s){if((yield*this.effectiveSchedulingMode())===He.FixedEffort){const i=yield*e.prepareDispatcher.call(this,s);return(yield Jn(this.$.assigned))&&i.addProposedValueFlag(be),i.addKeepIfPossibleFlag(Ge),i}else return yield*e.prepareDispatcher.call(this,s)}cycleResolutionContext(s){if(this.effectiveSchedulingModeSync(s)===He.FixedEffort){const i=s(this.$.effectiveDirection);return i.direction===E.Forward||i.direction===E.None?fr:pr}else return e.cycleResolutionContext.call(this,s)}}return n}){}const Ie=Wn.new({variables:new Set([zn,Hn,qn,Ge,be]),formulas:new Set([Ee,ue,_e,Kn,Te,Ne,Ue])}),Dr=ge.new({description:Ie,defaultResolutionFormulas:new Set([Ee,Ue,_e])}),yr=ge.new({description:Ie,defaultResolutionFormulas:new Set([Ee,Ue,ue])}),Cr=ge.new({description:Ie,defaultResolutionFormulas:new Set([Te,Ne,_e])}),Sr=ge.new({description:Ie,defaultResolutionFormulas:new Set([Te,Ne,ue])});class br extends G([Xn],t=>{const e=t.prototype;class n extends t{*prepareDispatcher(s){if((yield*this.effectiveSchedulingMode())===He.FixedUnits){const i=yield*e.prepareDispatcher.call(this,s);return(yield Jn(this.$.assigned))&&i.addProposedValueFlag(be),(yield this.$.effortDriven)&&i.addKeepIfPossibleFlag(Ge),i.addKeepIfPossibleFlag(be),i}else return yield*e.prepareDispatcher.call(this,s)}cycleResolutionContext(s){if(this.effectiveSchedulingModeSync(s)===He.FixedUnits){const i=s(this.$.effectiveDirection),o=s(this.$.effortDriven);return i.direction===E.Forward||i.direction===E.None?o?yr:Dr:o?Sr:Cr}else return e.cycleResolutionContext.call(this,s)}}return n}){}var Er=function(l,t,e,n){var r=arguments.length,s=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(l,t,e,n);else for(var i=l.length-1;i>=0;i--)(a=l[i])&&(s=(r<3?a(s):r>3?a(t,e,s):a(t,e))||s);return r>3&&s&&Object.defineProperty(t,e,s),s};class Aa extends G([Qt],t=>{t.prototype;class e extends t{writeInactive(r,s,a,i){var o;const d=!s.baseRevision.hasIdentifier(r);if(r.constructor.prototype.write.call(this,r,s,a,i),!d&&this.children&&!((o=this.stm)!==null&&o!==void 0&&o.isRestoring))for(const c of this.children)c.inactive=i}*calculateInactive(){const r=yield We;if(yield*this.hasSubEvents()){const s=yield*this.subEventsIterable();let a=0;for(const i of s)(yield i.$.inactive)||a++;return!a}return r}*shouldRollupChildEffort(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildPercentDoneSummaryData(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildStartDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEndDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyStartDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyEndDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateStartDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateEndDate(r){return!(yield r.$.inactive)||(yield this.$.inactive)}}return Er([rs("inactive")],e.prototype,"writeInactive",null),Er([x("inactive")],e.prototype,"calculateInactive",null),e}){}class en extends js([ss,gr,Ze,Qt,vr,br,Aa],t=>{class e extends t{}return e}){}var Tr=function(l,t,e,n){var r=arguments.length,s=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(l,t,e,n);else for(var i=l.length-1;i>=0;i--)(a=l[i])&&(s=(r<3?a(s):r>3?a(t,e,s):a(t,e))||s);return r>3&&s&&Object.defineProperty(t,e,s),s};class wr extends G([zt],t=>{t.prototype;class e extends t{*calculateCriticalPaths(){const r=[],s=[],a=yield this.$.childEvents,i=[...a],o=yield this.$.endDate;let d;for(;d=i.shift();){const u=yield d.$.childEvents,g=yield d.$.critical,m=!(yield d.$.inactive),h=yield d.$.endDate;m&&h&&h.getTime()-o.getTime()===0&&g&&s.push([{event:d}]),i.push(...u)}let c;for(;c=s.shift();){let u=c.length-1,g;for(;g=c[u];){const m=[];for(const h of yield g.event.$.incomingDeps){const p=yield h.$.fromEvent;p&&(yield h.$.active)&&!(yield p.$.inactive)&&(yield p.$.critical)&&m.push({event:p,dependency:h})}if(m.length){const h=c.slice();c.push(m[0]);for(let p=1;p<m.length;p++)s.push(h.concat(m[p]));u++}else u=-1}r.push(c.reverse())}return r}}return Tr([V({lazy:!0})],e.prototype,"criticalPaths",void 0),Tr([x("criticalPaths")],e.prototype,"calculateCriticalPaths",null),e}){}var tn=function(l,t,e,n){var r=arguments.length,s=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(l,t,e,n);else for(var i=l.length-1;i>=0;i--)(a=l[i])&&(s=(r<3?a(s):r>3?a(t,e,s):a(t,e))||s);return r>3&&s&&Object.defineProperty(t,e,s),s};class kr extends G([as,is,Ze,wr],t=>{const e=t.prototype;class n extends t{constructor(){super(...arguments),this.nonEqual=!1}*calculateNonEqual(){return!(yield We)}get isGanttProjectMixin(){return!0}afterConfigure(){e.afterConfigure.apply(this,arguments),this.projectConstraintIntervalClass=this.projectConstraintIntervalClass||et}*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}*calculateStartDate(){const s=yield this.$.effectiveDirection;if(s.direction===E.Forward){let a=yield We;return a||(a=yield*this.unsafeCalculateInitialMinChildrenStartDateDeep(),a||(yield this.$.nonEqual)),a}else if(s.direction===E.Backward){const a=yield*this.calculateMinChildrenStartDate(),i=yield this.$.endDate;return a&&i>a?a:i}}*calculateEndDate(){const s=yield this.$.effectiveDirection;if(s.direction===E.Forward){const a=yield this.$.startDate,i=yield*this.calculateMaxChildrenEndDate();return i&&i>a?i:a}else if(s.direction===E.Backward){let a=yield We;return a||(a=yield*this.unsafeCalculateInitialMaxChildrenEndDateDeep(),a||(yield this.$.nonEqual)),a}}*shouldRollupChildStartDate(s){return!(yield s.$.inactive)}*shouldRollupChildEndDate(s){return!(yield s.$.inactive)}*calculateEarlyStartDateConstraintIntervals(){const s=yield*e.calculateEarlyStartDateConstraintIntervals.call(this),a=yield this.$.effectiveDirection;if(a.direction===E.Forward){const i=yield this.$.startDate;i&&s.push(this.projectConstraintIntervalClass.new({owner:this,side:_.Start,startDate:i}))}else if(a.direction===E.Backward){const i=yield this.$.lateStartDate;i&&s.push(this.projectConstraintIntervalClass.new({owner:this,side:_.Start,startDate:i}))}return s}*calculateLateEndDateConstraintIntervals(){const s=yield*e.calculateLateEndDateConstraintIntervals.call(this),a=yield this.$.effectiveDirection;if(a.direction===E.Forward){const i=yield this.$.earlyEndDate;i&&s.push(this.projectConstraintIntervalClass.new({owner:this,side:_.End,endDate:i}))}else if(a.direction===E.Backward){const i=yield this.$.endDate;i&&s.push(this.projectConstraintIntervalClass.new({owner:this,side:_.End,endDate:i}))}return s}getDefaultEventModelClass(){return en}getDefaultAssignmentModelClass(){return os}getDefaultResourceModelClass(){return ls}getDefaultEventStoreClass(){return Yn}getType(){return Os.Gantt}*unsafeCalculateInitialMinChildrenStartDateDeep(){const s=yield this.$.childEvents;if(!s.size)return yield he(this.$.startDate);let a=we,i;const o=[...s];for(;i=o.shift();){let d=yield he(i.$.startDate);d||(d=yield he(i.$.endDate)),d&&d<a&&(a=d),o.push(...yield i.$.childEvents)}return a.getTime()!==ke.getTime()&&a.getTime()!==we.getTime()?a:null}*unsafeCalculateInitialMaxChildrenEndDateDeep(){const s=yield this.$.childEvents;if(!s.size)return yield he(this.$.endDate);let a=ke,i;const o=[...s];for(;i=o.shift();){let d=yield he(i.$.endDate);d||(d=yield he(i.$.startDate)),d&&d>a&&(a=d),o.push(...yield i.$.childEvents)}return a.getTime()!==ke.getTime()&&a.getTime()!==we.getTime()?a:null}getDependencyCycleDetectionIdentifiers(s,a){return[a.$.earlyStartDateConstraintIntervals,a.$.earlyEndDateConstraintIntervals,a.$.lateEndDateConstraintIntervals,a.$.lateStartDateConstraintIntervals]}}return tn([V({equality:()=>!1})],n.prototype,"nonEqual",void 0),tn([x("nonEqual")],n.prototype,"calculateNonEqual",null),n}){}class xr extends jn{static get $name(){return"ProjectConstraintIntervalDescription"}static getDescription(t){return Ht(t.startDate?this.L("L{startDateDescriptionTpl}"):this.L("L{endDateDescriptionTpl}"),...this.getDescriptionParameters(t))}}class et extends On{isAffectedByTransaction(t){const e=this.owner;t=t||e.graph.activeTransaction;const n=t.entries.get(this.startDate?e.$.startDate:e.$.endDate);return n&&!n.isShadow()}}tn([Wt(xr)],et.prototype,"descriptionBuilderClass",void 0);class tt extends P{static get $name(){return"AddNewColumn"}static get type(){return"addnew"}static get defaults(){return{text:"L{New Column}",cls:"b-new-column-column",draggable:!1,sortable:!1,exportable:!1,field:null,editor:null}}doDestroy(){var t;(t=this._combo)===null||t===void 0||t.destroy(),super.doDestroy()}get combo(){const t=this,e=t.grid.columns;return t._combo||(t._combo=new Ke({owner:t.grid,cls:"b-new-column-combo",placeholder:t.L("L{New Column}"),triggers:!1,autoExpand:!0,store:t.ganttColumnStore,displayField:"text",monitorResize:!1,picker:{align:{align:"t0-b0",axisLock:!0},minWidth:200,onItem({record:n}){const r=new n.value({region:t.region},e);e.insert(e.indexOf(t),r),r.element.focus()},onBeforeShow(){this.forElement=t.element}},syncInputFieldValue(){this.input.value=""},internalListeners:{keydown({event:n}){n.stopImmediatePropagation()}}}))}get ganttColumnStore(){return new xe({data:Object.values(C.columnTypes).reduce((t,e)=>(e.$meta.fields.exposedData||e.exposeProperties({}),e.isGanttColumn&&e.text&&t.push({id:e.type,text:e.optionalL(e.text),value:e}),t),[]),filters:[t=>!this.grid.columns.some(e=>e.constructor===t.value)],sorters:[{field:"text"}]})}headerRenderer({column:t,headerElement:e}){t.combo.render(e)}onKeyDown(t){t.key==="Enter"&&this.combo.focus()}updateLocalization(){this._combo&&(this._combo.destroy(),this._combo=null),super.updateLocalization()}}C.registerColumnType(tt),tt._$name="AddNewColumn";class M extends sa{static get defaults(){return{instantUpdate:!0,width:130,step:null,format:"ll"}}construct(t,e){const n=this;n.gantt=e.grid,super.construct(t,e),n.format?n.explicitFormat=!0:n.gantt.ion({displayDateFormatChange({format:r}){n.explicitFormat||n.set("format",r)}})}set format(t){this.explicitFormat=!0,this.set("format",t)}get format(){return this.explicitFormat&&this.data.format||this.gantt.displayDateFormat}set editor(t){super.editor=t}get editor(){const t=super.editor;return t&&(t.project=this.gantt.project),t}}v(M,"$name","GanttDateColumn"),v(M,"isGanttColumn",!0),M._$name="GanttDateColumn";class Q extends M{}v(Q,"$name","BaselineStartDateColumn"),v(Q,"type","baselinestartdate"),v(Q,"defaults",{text:"L{baselineStart}",field:"baselines[0].startDate"}),C.registerColumnType(Q),Q._$name="BaselineStartDateColumn";class Z extends M{}v(Z,"$name","BaselineEndDateColumn"),v(Z,"type","baselineenddate"),v(Z,"defaults",{text:"L{baselineEnd}",field:"baselines[0].endDate"}),C.registerColumnType(Z),Z._$name="BaselineEndDateColumn";class ee extends Y{}v(ee,"$name","BaselineDurationColumn"),v(ee,"type","baselineduration"),v(ee,"defaults",{text:"L{baselineDuration}",field:"baselines[0].fullDuration"}),C.registerColumnType(ee),ee._$name="BaselineDurationColumn";class te extends Y{}v(te,"$name","BaselineDurationVarianceColumn"),v(te,"type","baselinedurationvariance"),v(te,"defaults",{editor:!1,text:"L{durationVariance}",field:"baselines[0].durationVariance"}),C.registerColumnType(te),te._$name="BaselineDurationVarianceColumn";class ne extends Y{}v(ne,"$name","BaselineStartVarianceColumn"),v(ne,"type","baselinestartvariance"),v(ne,"defaults",{editor:!1,text:"L{startVariance}",field:"baselines[0].startVariance"}),C.registerColumnType(ne),ne._$name="BaselineStartVarianceColumn";class re extends Y{}v(re,"$name","BaselineEndVarianceColumn"),v(re,"type","baselineendvariance"),v(re,"defaults",{editor:!1,text:"L{endVariance}",field:"baselines[0].endVariance"}),C.registerColumnType(re),re._$name="BaselineEndVarianceColumn";class nt extends Ke{static get $name(){return"CalendarPicker"}static get type(){return"calendarpicker"}refreshCalendars(t){this.store.data=t.map(e=>({id:e.id,text:e.name}))}get store(){return this._store||(this.store=new xe),this._store}set store(t){super.store=t}get value(){return super.value}set value(t){t&&(t.isDefault&&t.isDefault()?t=null:t.id&&(t=t.id)),super.value=t}}nt.initClass(),nt._$name="CalendarPicker";class rt extends P{static get $name(){return"CalendarColumn"}static get type(){return"calendar"}static get isGanttColumn(){return!0}static get defaults(){return{field:"calendar",text:"L{Calendar}",editor:{type:nt.type,clearable:!0,allowInvalid:!1}}}afterConstruct(){super.afterConstruct();const t=this,e=t.grid.project;t.defaultCalendar=e.defaultCalendar,t.refreshCalendars(),e.calendarManagerStore.ion({changePreCommit:t.refreshCalendars,refresh:t.refreshCalendars,thisObj:t})}refreshCalendars(){if(this.editor){const t=this.grid.project;this.editor.refreshCalendars(t.calendarManagerStore.allRecords)}}renderer({value:t}){var e;if(t!==this.defaultCalendar&&(t==null?void 0:t.id)!=null){const n=this.grid.project.calendarManagerStore.getById(t.id);return(e=n==null?void 0:n.name)!=null?e:""}return""}}C.registerColumnType(rt),rt._$name="CalendarColumn";class st extends M{static get $name(){return"ConstraintDateColumn"}static get type(){return"constraintdate"}static get defaults(){return{field:"constraintDate",text:"L{Constraint Date}",width:146}}}C.registerColumnType(st),st._$name="ConstraintDateColumn";const Fa={Forward:"assoonaspossible",Backward:"aslateaspossible"};class at extends P{static get $name(){return"ConstraintTypeColumn"}static get type(){return"constrainttype"}static get isGanttColumn(){return!0}static get defaults(){return{field:"constraintType",text:"L{Constraint Type}",width:146,editor:{type:"constrainttypepicker",clearable:!0,allowInvalid:!1},filterable:{filterField:{type:"constrainttypepicker"}}}}get editor(){const t=super.editor;return t.includeAsapAlapAsConstraints=this.grid.project.includeAsapAlapAsConstraints,t}renderer({record:t,value:e}){return ds.localize(this.grid.project.includeAsapAlapAsConstraints&&Fa[t.direction]||e)||""}}C.registerColumnType(at),at._$name="ConstraintTypeColumn";class it extends M{static get $name(){return"DeadlineDateColumn"}static get type(){return"deadlinedate"}static get defaults(){return{field:"deadlineDate",text:"L{Deadline}",width:146}}}C.registerColumnType(it),it._$name="DeadlineDateColumn";class ot extends M{static get $name(){return"EarlyEndDateColumn"}static get type(){return"earlyenddate"}static get defaults(){return{field:"earlyEndDate",text:"L{Early End}"}}}C.registerColumnType(ot),ot._$name="EarlyEndDateColumn";class lt extends M{static get $name(){return"EarlyStartDateColumn"}static get type(){return"earlystartdate"}static get defaults(){return{field:"earlyStartDate",text:"L{Early Start}"}}}C.registerColumnType(lt),lt._$name="EarlyStartDateColumn";class dt extends Y{static get $name(){return"EffortColumn"}static get type(){return"effort"}static get defaults(){return{field:"fullEffort",text:"L{Effort}"}}get defaultEditor(){return{type:cs.type,name:this.field}}}C.registerColumnType(dt),dt._$name="EffortColumn";class ct extends M{static get $name(){return"EndDateColumn"}static get type(){return"enddate"}static get defaults(){return{field:"endDate",text:"L{Finish}"}}get defaultEditor(){const t=super.defaultEditor;return t.type="enddate",t}}C.registerColumnType(ct),ct._$name="EndDateColumn";class se extends J{static get defaults(){return{field:"ignoreResourceCalendar",text:"L{Ignore resource calendar}"}}}v(se,"$name","IgnoreResourceCalendarColumn"),v(se,"type","ignoreresourcecalendar"),v(se,"isGanttColumn",!0),C.registerColumnType(se),se._$name="IgnoreResourceCalendarColumn";class ut extends J{static get $name(){return"InactiveColumn"}static get type(){return"inactive"}static get isGanttColumn(){return!0}static get defaults(){return{field:"inactive",text:"L{Inactive}"}}}C.registerColumnType(ut),ut._$name="InactiveColumn";class gt extends M{static get $name(){return"LateEndDateColumn"}static get type(){return"lateenddate"}static get defaults(){return{field:"lateEndDate",text:"L{Late End}"}}}C.registerColumnType(gt),gt._$name="LateEndDateColumn";class ht extends M{static get $name(){return"LateStartDateColumn"}static get type(){return"latestartdate"}static get defaults(){return{field:"lateStartDate",text:"L{Late Start}"}}}C.registerColumnType(ht),ht._$name="LateStartDateColumn";class mt extends J{static get $name(){return"ManuallyScheduledColumn"}static get type(){return"manuallyscheduled"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",text:"L{Manually scheduled}"}}}C.registerColumnType(mt),mt._$name="ManuallyScheduledColumn";class Re extends J{static get $name(){return"MilestoneColumn"}static get type(){return"milestone"}static get isGanttColumn(){return!0}static get defaults(){return{field:"milestone",text:"L{Milestone}"}}}v(Re,"suppressNoModelFieldWarning",!0),C.registerColumnType(Re),Re._$name="MilestoneColumn";class me extends da{static get $name(){return"NameColumn"}static get type(){return"name"}static get isGanttColumn(){return!0}static get defaults(){return{width:200,field:"name",text:"L{Name}"}}}C.registerColumnType(me),me._$name="NameColumn";class ft extends P{static get $name(){return"NoteColumn"}static get type(){return"note"}static get isGanttColumn(){return!0}static get defaults(){return{field:"note",text:"L{Note}",width:150,editor:{type:"textareapickerfield"}}}renderer({value:t}){return(t||"").trim()}}C.registerColumnType(ft),ft._$name="NoteColumn";class pt extends cr{constructor(){super(...arguments);v(this,"circleHeightPercentage",.75)}static get $name(){return"PercentDoneColumn"}static get type(){return"percentdone"}static get isGanttColumn(){return!0}static get fields(){return["showCircle"]}static get defaults(){return{field:"percentDone",text:"L{% Done}",unit:"%",step:1,min:0,max:100,width:90}}construct(e){super.construct(...arguments),this.showCircle&&(this.htmlEncode=!1)}defaultRenderer({record:e,isExport:n,value:r}){return r=e.getFormattedPercentDone(r),n?r:this.showCircle?{className:{"b-percentdone-circle":1,"b-full":r===100,"b-empty":r===0},style:{height:this.circleHeightPercentage*this.grid.rowHeight+"px",width:this.circleHeightPercentage*this.grid.rowHeight+"px","--gantt-percentdone-angle":`${r/100}turn`},dataset:{value:r}}:r+this.unit}}C.registerColumnType(pt),pt._$name="PercentDoneColumn";const ja={from:[2,3,0,1],to:[1,0,3,2]},$r=()=>new RegExp(`(${nn.join("|")})?((?:[+-])\\d+[a-z]*)?`,"i");let nn=["SS","SF","FS","FF"],Mr=$r();const An=class extends Ke{construct(t){const e=this,{ourSide:n,otherSide:r}=t;e.dependencies=new sr({extraKeys:r}),e.startCollection=new sr({extraKeys:r}),super.construct(t),e.delimiterRegEx=new RegExp(`\\s*${e.delimiter}\\s*`);const s=()=>{nn=e.L("L{DependencyType.short}"),Mr=$r(),e.syncInputFieldValue()};zs.ion({locale:s,thisObj:e}),s()}internalOnInput(){this.clearError(void 0,!0),this.isValid&&ar.prototype.internalOnInput.call(this)}get invalidValueError(){return"L{invalidDependencyFormat}"}onInternalKeyDown(t){const{key:e}=t;if(e==="Enter")this.syncInvalid();else{var n;(n=super.onInternalKeyDown)===null||n===void 0||n.call(this,t)}this.pickerVisible&&e==="ArrowDown"&&this.filterField.focus()}onTriggerClick(){this.pickerVisible?super.onTriggerClick(...arguments):this.doFilter(this.filterInput?this.filterInput.value:null)}changeStore(t){return t=t.chain(e=>!this.eventRecord||e.id!==this.eventRecord.id,null,{excludeCollapsedRecords:!1,sorters:this.sorters}),super.changeStore(t)}changePicker(t,e){const n=this,r=n.filterField||(n.filterField=new ar({cls:"b-dependency-list-filter",clearable:!0,placeholder:"Filter",triggers:{filter:{cls:"b-icon b-icon-filter",align:"start"}},internalListeners:{input({event:i}){n.filterOnInput(i)},clear({event:i}){Object.defineProperty(i,"target",{configurable:!0,value:s}),n.filterOnInput.now(i)}}})),s=n.filterInput=r.input,a=An.reconfigure(e,t?H.merge({owner:n,store:n.store,cls:`b-dependency-list ${n.listCls}`,itemTpl:n.listItemTpl,forElement:n[n.pickerAlignElement],align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement],minHeight:n.inlinePicker?null:Math.min(3,n.store.count)*40},navigator:{keyEventTarget:s,processEvent:i=>{if(i.key==="Escape")n.hidePicker();else return i}},onItem:n.onPredecessorClick.bind(n),getItemClasses:function(i){const o=Hs.prototype.getItemClasses.call(this,i),d=n.dependencies.getBy(n.otherSide+"Event",i),c=d?` b-selected b-${d.getConnectorString(1).toLowerCase()}`:"";return o+c}},t):null,n);return a?(a.ion({show(){Object.defineProperty(a.scrollable,"viewport",{get(){return I.client(this.element).deflate(r.height,0,0,0)}})},once:!0,thisObj:n}),r.owner=a,r.render(a.contentElement)):n.destroyProperties("filterField"),a}updateEventRecord(){this.store.fillFromMaster()}onPickerShow({source:t}){const e=this,{element:n}=e.filterField,{contentElement:r}=t;t.minWidth=e[e.pickerAlignElement].offsetWidth,r.firstChild!==n&&r.insertBefore(n,r.firstChild),super.onPickerShow(...arguments)}listItemTpl(t){const e=$.encodeHtml(t.name),{dependencyIdField:n}=this.owner,r=n&&n!==t.constructor.idField?n:t.constructor.idField,s=t.isPhantom?"":String(t[r]);return`<div class="b-predecessor-item-text">${e} ${s.length?`(${s})`:""}</div>
            <div class="b-sch-box b-from" data-side="from"></div>
            <div class="b-sch-box b-to" data-side="to"></div>`}get isValid(){return!!(!this.task||this.parseDependencies(this.input.value))&&super.isValid}set value(t){const e=this,n=e.dependencies;if(typeof t=="string"){if(e.input.value=t,t=e.parseDependencies(t),!t){e.syncInvalid();return}t=t.map(r=>new e.dependencyStore.modelClass(r))}else e.startCollection.clear(),t!==null&&(e.startCollection.values=t);n.clear(),t!==null&&(n.values=t),e.inputting||e.syncInputFieldValue()}get value(){return this.dependencies.values}get inputValue(){const t=this,{value:e}=t;return e==null?"":t.constructor.dependenciesToString(e,t.otherSide,t.delimiter,t.dependencyIdField)}onPredecessorClick({source:t,item:e,record:n,event:r}){const s=this,{dependencies:a}=s,i=r.target.closest(".b-sch-box"),o=i==null?void 0:i.dataset.side;let d=a.getBy(s.otherSide+"Event",n);if(e.dataset.noselect=!0,s.trigger("change",{value:s.value,event:r,userAction:!0}),d&&!i)a.remove(d);else if(d){const{id:c,type:u}=d;d=d.copy({id:c,type:ja[o][u]},{skipFieldIdentifiers:!0}),d[`${s.otherSide}Event`]=n,d[`${s.ourSide}Event`]=s.task,a.add(d)}else a.add(s.dependencyStore.createRecord({[`${s.otherSide}Event`]:n,[`${s.ourSide}Event`]:s.task},!0));s.syncInputFieldValue(),t.refresh()}static dependenciesToString(t,e,n=";",r="id"){const s=`${e}Event`,a=i=>{const o=i[s];return o!=null&&o.isModel?o[r]:o||""};return t!=null&&t.length?t.sort((o,d)=>a(o)-a(d)).map(o=>`${a(o)}${aa.getLocalizedDependencyType(o.getConnectorString())}${o.getLag()}`).join(n):""}get task(){var t;return(t=this.owner)===null||t===void 0?void 0:t.record}parseDependencies(t){const e=this,{store:n,task:r,dependencyStore:s}=e,a=t.split(e.delimiterRegEx),i=s.modelClass,o=[];for(let d=0;d<a.length;d++){const c=a[d];if(c){let u=c.length+1,g=null,m;for(;u&&!g;u--)m=c.substr(0,u),g=n.find(D=>String(D[e.dependencyIdField])===m,!0);if(!g)return null;const h=c.substr(u+1),p={[`${e.otherSide}Event`]:g,[`${e.ourSide}Event`]:r,type:i.Type.EndToStart};if(h.length){const D=Mr.exec(h);if(D&&(D[1]||D[2])){if(D[1]&&(p.type=nn.indexOf(D[1].toUpperCase())),D[2]){const f=y.parseDuration(D[2],!0,r.durationUnit);p.lag=f.magnitude,p.lagUnit=f.unit}}else return null}o.push(p)}}return o}get needsInputSync(){return super.needsInputSync||!this.isValid&&this.inputValue!==this.input.value}doDestroy(){this.dependencies.destroy(),this.startCollection.destroy(),super.doDestroy()}};let O=An;v(O,"$name","DependencyField"),v(O,"type","dependencyfield"),v(O,"configurable",{listCls:"b-predecessor-list",displayField:"name",valueField:"name",validateFilter:!1,minChars:0,clearTextOnPickerHide:!1,picker:{floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,minHeight:161,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},delimiter:";",dependencyStore:null,otherSide:null,ourSide:null,multiSelect:!0,chipView:null,validateOnInput:!1,dependencyIdField:null,eventRecord:null,sorters:[{field:"name"}]}),O.initClass(),O._$name="DependencyField";const Oa=l=>!l.project,Ba=l=>l;class Pe extends Xe(P){static get $name(){return"DependencyColumn"}static get type(){return"dependency"}static get fields(){return[{name:"delimiter",defaultValue:";"},{name:"dependencyIdField",defaultValue:null}]}static get defaults(){return{htmlEncode:!1,width:120,renderer({record:t,grid:e}){const n=this.dependencyIdField||e.dependencyIdField;return O.dependenciesToString(t[this.field],this.field==="predecessors"?"from":"to",this.delimiter,n)},filterable({value:t,record:e,column:n}){const r=n.dependencyIdField||n.grid.dependencyIdField;return t=t.toLowerCase(),e[`${n.field==="predecessors"?"predecessorTasks":"successorTasks"}`].some(s=>{var a;return s&&t.includes((a=s[r])===null||a===void 0?void 0:a.toString().toLowerCase())})}}}afterConstruct(){super.afterConstruct()}getFilterableValue(t){return this.renderer({record:t,grid:this.grid})}async finalizeCellEdit({grid:t,record:e,inputField:n,value:r,oldValue:s,editorContext:a}){if(n.clearError(),e&&r){const i=r.filter(Oa),o=t.dependencyStore.getProject(),d=e[this.field];return await o.commitAsync(),o.isDestroyed?void 0:(await Promise.all(i.map(g=>o.isValidDependencyModel(g,d)))).every(Ba)?!0:a.column.L("L{Invalid dependency}")}}get defaultEditor(){const t=this,{grid:e}=t,n=t.field==="predecessors";return{type:"dependencyfield",grid:e,name:t.field,delimiter:t.delimiter,dependencyIdField:t.dependencyIdField||e.dependencyIdField,ourSide:n?"to":"from",otherSide:n?"from":"to",store:e.eventStore||e.taskStore,dependencyStore:e.dependencyStore}}}C.registerColumnType(Pe),Pe._$name="DependencyColumn";class vt extends Pe{constructor(){super(...arguments);v(this,"canFillValue",()=>!1)}static get $name(){return"PredecessorColumn"}static get type(){return"predecessor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Predecessors}",field:"predecessors"}}}C.registerColumnType(vt),vt._$name="PredecessorColumn";class ae extends Qn{static get defaultConfig(){return{storage:{extraKeys:["resource"]},callOnFunctions:!0,projectEvent:null,floatAssignedResources:!0,liveFloatAssignedResources:!1}}afterConfigure(){const t=this;super.afterConfigure(),t.addSorter({fn:t.defaultSort.bind(t)})}get projectEvent(){return this._projectEvent}set projectEvent(t){var e;const n=this;if(t!=n._projectEvent||t&&t.generation!==n._projectEventGeneration||(t==null||(e=t.getProject())===null||e===void 0?void 0:e.assignmentStore.storage.generation)!==n._assignmentStoreGeneration){var r;n._projectEvent=t,n._projectEventGeneration=t==null?void 0:t.generation,n._assignmentStoreGeneration=t==null||(r=t.getProject())===null||r===void 0?void 0:r.assignmentStore.storage.generation,t?(n.fillFromMaster(),n.sort()):n.removeAll()}}get floatAssignedResources(){return this._floatAssignedResources}set floatAssignedResources(t){const e=this;t!==e.floatAssignedResources&&(e._floatAssignedResources=t,e.sort())}fillFromMaster(){const t=this,{projectEvent:e}=t;if(e){const{assignmentStore:n,resourceStore:r}=e,s=n.modelClass.getFieldDefinition("resource").dataSource,a=n.modelClass.getFieldDefinition("event").dataSource,i=[];r.forEach(o=>{const d=n.getAssignmentForEventAndResource(e,o),c=Object.assign({units:0},d==null?void 0:d.data);delete c.id,delete c.eventId,delete c.resourceId,delete c[s],delete c[a],Object.assign(c,{resource:o,event:e}),i.push(c)},this,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0}),t.data=i}}toValue(){return this.query(t=>t.units>0)}toValueString(){return this.toValue().join(", ")}defaultSort(t,e){let n=0;return this.floatAssignedResources?!e.units&&t.units?n=-1:!t.units&&e.units?n=1:n=t.resourceName.localeCompare(e.resourceName):n=t.resourceName.localeCompare(e.resourceName),n}onUpdate({changes:t}){const e=this;e.isConfiguring||Object.hasOwnProperty.call(t,"event")&&e.floatAssignedResources&&e.liveFloatAssignedResources&&e.sort()}}ae._$name="AssignmentsManipulationStore";class fe extends us{static get fields(){return[{name:"event",persist:!0,serialize:t=>t==null?void 0:t.id,isEqual:Zn},{name:"resource",persist:!0,serialize:t=>t==null?void 0:t.id,isEqual:Zn},"eventId","resourceId"]}}fe._$name="AssignmentModel";const Va={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{Save:"Save"},IgnoreResourceCalendarColumn:{"Ignore resource calendar":"Ignore resource calendar"},InactiveColumn:{Inactive:"Inactive"},AddNewColumn:{"New Column":"New Column"},BaselineStartDateColumn:{baselineStart:"Baseline Start"},BaselineEndDateColumn:{baselineEnd:"Baseline Finish"},BaselineDurationColumn:{baselineDuration:"Baseline Duration"},BaselineStartVarianceColumn:{startVariance:"Start Variance"},BaselineEndVarianceColumn:{endVariance:"Finish Variance"},BaselineDurationVarianceColumn:{durationVariance:"Duration Variance"},CalendarColumn:{Calendar:"Calendar"},EarlyStartDateColumn:{"Early Start":"Early Start"},EarlyEndDateColumn:{"Early End":"Early End"},LateStartDateColumn:{"Late Start":"Late Start"},LateEndDateColumn:{"Late End":"Late End"},TotalSlackColumn:{"Total Slack":"Total Slack"},ConstraintDateColumn:{"Constraint Date":"Constraint Date"},ConstraintTypeColumn:{"Constraint Type":"Constraint Type"},DeadlineDateColumn:{Deadline:"Deadline"},DependencyColumn:{"Invalid dependency":"Invalid dependency"},DurationColumn:{Duration:"Duration"},EffortColumn:{Effort:"Effort"},EndDateColumn:{Finish:"Finish"},EventModeColumn:{"Event mode":"Event mode",Manual:"Manual",Auto:"Auto"},ManuallyScheduledColumn:{"Manually scheduled":"Manually scheduled"},MilestoneColumn:{Milestone:"Milestone"},NameColumn:{Name:"Name"},NoteColumn:{Note:"Note"},PercentDoneColumn:{"% Done":"% Done"},PredecessorColumn:{Predecessors:"Predecessors"},ResourceAssignmentColumn:{"Assigned Resources":"Assigned Resources","more resources":"more resources"},RollupColumn:{Rollup:"Rollup"},SchedulingModeColumn:{"Scheduling Mode":"Scheduling Mode"},SchedulingDirectionColumn:{schedulingDirection:"Scheduling direction",inheritedFrom:"Inherited from",enforcedBy:"Enforced by"},SequenceColumn:{Sequence:"Sequence"},ShowInTimelineColumn:{"Show in timeline":"Show in timeline"},StartDateColumn:{Start:"Start"},SuccessorColumn:{Successors:"Successors"},TaskCopyPaste:{copyTask:"Copy",cutTask:"Cut",pasteTask:"Paste"},WBSColumn:{WBS:"WBS",renumber:"Renumber"},DependencyField:{invalidDependencyFormat:"Invalid dependency format"},ProjectLines:{"Project Start":"Project start","Project End":"Project end"},TaskTooltip:{Start:"Start",End:"End",Duration:"Duration",Complete:"Complete"},AssignmentGrid:{Name:"Resource name",Units:"Units",unitsTpl:({value:l})=>l?l+"%":""},Gantt:{Edit:"Edit",Indent:"Indent",Outdent:"Outdent","Convert to milestone":"Convert to milestone",Add:"Add...","New task":"New task","New milestone":"New milestone","Task above":"Task above","Task below":"Task below","Delete task":"Delete",Milestone:"Milestone","Sub-task":"Subtask",Successor:"Successor",Predecessor:"Predecessor",changeRejected:"Scheduling engine rejected the changes",linkTasks:"Add dependencies",unlinkTasks:"Remove dependencies",color:"Color"},EventSegments:{splitTask:"Split task"},Indicators:{earlyDates:"Early start/end",lateDates:"Late start/end",Start:"Start",End:"End",deadlineDate:"Deadline"},Versions:{indented:"Indented",outdented:"Outdented",cut:"Cut",pasted:"Pasted",deletedTasks:"Deleted tasks"}};qs.publishLocale(Va);class rn extends pa{static get $name(){return"ResourceAssignmentGridResourceColumn"}static get type(){return"assignmentResource"}static get defaults(){return{showEventCount:!1,cls:"b-assignmentgrid-resource-column",field:"resourceName",flex:1,editor:null,useNameAsImageName:!1,filterable:{filterField:{placeholder:"L{AssignmentGrid.Name}",triggers:{filter:{align:"start",cls:"b-icon b-icon-filter"}}}}}}defaultRenderer({grid:t,record:e,cellElement:n,value:r,isExport:s}){return e.isSpecialRow||(e=e.resource),super.defaultRenderer({grid:t,record:e,cellElement:n,value:r,isExport:s})}}C.registerColumnType(rn),rn._$name="ResourceAssignmentGridResourceColumn";class Dt extends ma{static get $name(){return"AssignmentGrid"}static get type(){return"assignmentgrid"}static get configurable(){return{resourceImageExtension:".jpg",minHeight:200,resourceColumn:{type:"assignmentResource"},unitsColumn:{field:"units",type:cr.type,text:"L{Units}",localeClass:this,width:70,min:0,max:100,step:10,unit:"%",renderer:({value:t})=>this.L("L{unitsTpl}",{value:Math.round(t)}),filterable:!1}}}static get defaultConfig(){return{selectionMode:{checkboxOnly:!0,multiSelect:!0,showCheckAll:!0},features:{group:!1,filterBar:!0,contextMenu:!1},disableGridRowModelWarning:!0,projectEvent:null}}construct(){super.construct(...arguments),this.ion({selectionChange:({selected:t,deselected:e})=>{t.forEach(n=>n.units=n.units||n.getFieldDefinition("units").defaultValue),e.forEach(n=>{this.store.includes(n)&&(n.units=0)})}})}get projectEvent(){const t=this,e=t.store;let n=t._projectEvent;return e&&n!==e.projectEvent&&(n=t._projectEvent=e.projectEvent),n}set projectEvent(t){const e=this;e._projectEvent=t,e.store.projectEvent=t,t&&(e.selectedRecords=e.store.query(n=>t.assignments.find(r=>r.resource===n.resource)))}get store(){return super.store}set store(t){const e=this,n=e.store;if(t&&n!==t){var r;if(!(t instanceof ae)){var s;t=ae.new({modelClass:((s=e._projectEvent)===null||s===void 0?void 0:s.assignmentStore.modelClass)||fe,projectEvent:e._projectEvent},t)}super.store=t,(r=e.storeDetacher)===null||r===void 0||r.call(e),e.storeDetacher=t.ion({update:"onAssignmentUpdate",thisObj:e})}}set columns(t){t&&t.unshift(H.clone(this.resourceColumn),H.clone(this.unitsColumn)),super.columns=t}get columns(){return super.columns}onAssignmentUpdate({record:t,changes:e}){const{units:n}=e;n&&(n.value?n.oldValue===0&&this.selectRow({record:t,scrollIntoView:!1,addToSelection:!0}):this.deselectRow(t))}}Dt.initClass(),Dt._$name="AssignmentGrid";class yt extends Dt{static get $name(){return"AssignmentPicker"}static get type(){return"assignmentpicker"}static get defaultConfig(){return{trapFocus:!0,height:"20em",minWidth:"25em",bbar:[{type:"button",text:this.L("L{Object.Save}"),localeClass:this,ref:"saveBtn",color:"b-green"},{type:"button",text:this.L("L{Object.Cancel}"),localeClass:this,ref:"cancelBtn",color:"b-gray"}],projectEvent:null,store:null}}configure(t){t.selectedRecordCollection=t.assignments,super.configure(t)}show(){return this.originalSelected=this.selectedRecords.map(t=>t.copy()),super.show(...arguments)}afterConfigure(){var t,e;const n=this;super.afterConfigure(),(t=n.bbar.widgetMap.saveBtn)===null||t===void 0||t.ion({click:"onSaveClick",thisObj:n}),(e=n.bbar.widgetMap.cancelBtn)===null||e===void 0||e.ion({click:"onCancelClick",thisObj:n})}onSaveClick(){this.hide()}onCancelClick(){this.hide()}}yt.initClass(),yt._$name="AssignmentPicker";class Ct extends Ke{static get $name(){return"AssignmentField"}static get type(){return"assignmentfield"}static get configurable(){return{editingRecords:!0,chipView:{cls:"b-assignment-chipview",itemTpl(t){return $.xss`${t.resourceName} ${Math.round(t.units)}%`},scrollable:{overflowX:"hidden-scroll"}},triggers:{expand:{cls:"b-icon-down",handler:"onTriggerClick"}},multiSelect:!0,clearable:!1,editable:!1,value:null,picker:{type:yt.type,floating:!0,scrollAction:"realign"},pickerWidth:null,projectEvent:null,store:{},tooltipTemplate(){return $.encodeHtml(this.store.toValueString())}}}onChipClose(t){this.showPicker(),this.picker.deselectRows(t)}syncInputFieldValue(){super.syncInputFieldValue();const{store:t}=this;t&&this.tooltipTemplate&&(this.tooltip=this.tooltipTemplate({taskRecord:t.projectEvent,assignmentRecords:t.toValue()}))}onTriggerClick(t){this.pickerVisible?this.hidePicker():Ks.prototype.showPicker.call(this,t&&"key"in t)}focusPicker(){this.picker.focus()}changePicker(t,e){const n=this;return super.changePicker(t&&A.assign({projectEvent:n.projectEvent,store:n.store,readOnly:n.readOnly,resourceImagePath:n.resourceImageFolderPath,assignments:n.valueCollection,onCancelClick(){n.value=this.originalSelected,this.hide()},align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},internalListeners:{hide:()=>{n.isDestroying||n.store.clearFilters(n.containsFocus)}}},t)||null,e)}changeProjectEvent(t){const{picker:e,store:n}=this;return this._projectEvent=t,n&&(n.projectEvent=t),e&&(e.projectEvent=t),t}changeStore(t){return t&&!(t instanceof ae)&&(t=new ae(t)),t}updateStore(t){const e=this;if(e.detachListeners("storeMutation"),t instanceof ae){const{projectEvent:n}=t;n?e.projectEvent=n:t.projectEvent=e.projectEvent}t.ion({name:"storeMutation",change:"syncInputFieldValue",thisObj:e})}get value(){return super.value}set value(t){var e;t=(e=t)===null||e===void 0?void 0:e.map(n=>{const r=this.store.find(s=>s.resource===n.resource,!0);return r==null||r.copyData(n),r}),super.value=t}hasChanged(t,e){return!A.isEqual(t,e)}onPickerKeyDown(t){const e=this.picker;t.key==="ArrowDown"&&t.target.compareDocumentPosition(e.bodyContainer)===document.DOCUMENT_POSITION_FOLLOWING?e.element.focus():t.key==="Escape"&&!e.focusedCell.isActionable&&this.hidePicker()}cacheCurrentValue(t){return Array.isArray(t)?this._value=t.map(e=>e.copy(e.id)):super.cacheCurrentValue(t)}}Ct.initClass(),Ct._$name="AssignmentField";const Ga=l=>l.resourceName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");class St extends P{constructor(){super(...arguments);v(this,"internalCellCls","b-resourceassignment-cell")}static get $name(){return"ResourceAssignmentColumn"}static get type(){return"resourceassignment"}static get isGanttColumn(){return!0}static get fields(){return["showAvatars","sideMargin",{name:"itemTpl",defaultValue:(e,n,r=!0)=>r?$.encodeHtml(e.toString()):e.toString()},"avatarTooltipTemplate",{name:"showAllNames",type:"boolean",defaultValue:!0},{name:"enableResourceDragging"},"avatarTooltip",{name:"avatarMaxSize",defaultValue:50}]}static get defaults(){return{field:"assignments",instantUpdate:!1,text:"L{Assigned Resources}",width:250,showAvatars:!1,sideMargin:20,sortable(e,n){const r=e.assignments.join(""),s=n.assignments.join("");return r===s?0:r<s?-1:1},filterable({value:e,record:n}){if(Array.isArray(e)){if(!e.length)return!n.assignments.length;e=e.map(Ga).join("|")}const r=new RegExp(e,"gi");return n.assignments.some(s=>r.test(s.resourceName))},alwaysClearCell:!1}}construct(){super.construct(...arguments);const e=this,{grid:n}=e;e.showAvatars&&Object.assign(e,{repaintOnResize:!0,htmlEncode:!1,renderer:e.rendererWithAvatars,avatarRendering:new Ea({element:n.element,tooltip:A.assign({forSelector:".b-resourceassignment-cell .b-resource-avatar",internalListeners:{beforeShow({source:r}){var s;const{taskRecord:a,resourceRecord:i,assignmentRecord:o,overflowCount:d,overflowAssignments:c}=r.activeTarget.elementData,u=(s=e.avatarTooltipTemplate)===null||s===void 0?void 0:s.call(e,{taskRecord:a,resourceRecord:i,assignmentRecord:o,overflowCount:d,tooltip:r,overflowAssignments:c});if(r.items.length===0){const g=e.showAllNames?`${$.encodeHtml(o)}<br />${c.join("<br />")}`:$.xss`${o}${d?` (+${d} ${e.L("L{more resources}")})`:""}`;r.html=u!=null?u:g}}}},e.avatarTooltip)})}),e.enableResourceDragging&&e.grid.ion({paint:e.setupDragging,thisObj:e,once:!0}),n.ion({beforeCellEditStart:e.onBeforeCellEditStart,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),e.showAvatars&&(n.ion({beforeRenderRows:e.calculateAvatarSize,once:!0,thisObj:e}),n.rowManager.ion({beforeRowHeight:e.calculateAvatarSize,thisObj:e})),n.resourceStore.ion({name:"resourceStore",update:e.onResourceUpdate,thisObj:e})}calculateAvatarSize({height:e}){const{grid:n}=this,r=e||n.rowHeight,{cellElement:s}=n.beginGridMeasuring();s.classList.add(this.internalCellCls);const a=globalThis.getComputedStyle(s),i=parseInt(a.paddingTop,10);this.avatarRendering.size=Math.min(this.avatarMaxSize,r-2*i),s.classList.remove(this.internalCellCls),n.endGridMeasuring()}doDestroy(){var e,n;super.doDestroy(),(e=this.avatarRendering)===null||e===void 0||e.destroy(),(n=this.dragHelper)===null||n===void 0||n.destroy()}get defaultEditor(){return{type:Ct.type,store:{modelClass:this.grid.project.assignmentStore.modelClass}}}onBeforeCellEditStart({editorContext:{record:e,column:n}}){const r=this;if(n===r){const{editor:s}=r;s.resourceImageFolderPath=r.grid.resourceImageFolderPath,s.projectEvent=e,r.detachListeners("editorStore"),s.store.ion({name:"editorStore",changesApplied:r.onEditorChangesApplied,thisObj:r})}}onDoneCellEdit(){this.detachListeners("editorStore")}onEditorChangesApplied(){const e=this,n=e.grid.getCell({id:e.editor.projectEvent.id,columnId:e.id});n&&e.renderer({value:e.editor.projectEvent.assignments,cellElement:n})}onResourceUpdate({source:e}){var n;(n=e.project)!==null&&n!==void 0&&n.propagatingLoadChanges||this.grid.refreshColumn(this)}get chipView(){const e=this;return e._chipView||(e._chipView=new Xs({parent:e,cls:"b-assignment-chipview",navigator:null,itemsFocusable:!1,closable:!1,itemTpl:e.itemTpl,store:{},scrollable:{overflowX:"hidden-scroll"}}),Object.defineProperty(e.chipView,"isVisible",{get(){return!0}}),e.chipView.triggerPaint()),e._chipView}renderer({cellElement:e,value:n,isExport:r}){if(n=n.filter(s=>s.resource).sort((s,a)=>s.resourceName.localeCompare(a.resourceName)),r)return n.map((s,a)=>this.itemTpl(s,a,!1)).join(",");{const{chipView:s}=this,a=e.querySelector(".b-assignment-chipview-wrap")||q.createElement({parent:e,className:"b-assignment-chipview-wrap"});s.store.storage.replaceValues({values:n,silent:!0}),s.refresh();const i=s.element.cloneNode(!0);i.removeAttribute("id"),a.innerHTML="",a.appendChild(i)}}rendererWithAvatars({record:e,value:n,isExport:r}){n=n.filter(c=>c.resource).sort((c,u)=>c.resourceName.localeCompare(u.resourceName));const s=this,{size:a}=s.avatarRendering,i=Math.floor((s.width-s.sideMargin)/(a+2)),o=n.length>i?n.length-i:0,d=n.length>i?n.filter(c=>n.indexOf(c)>=i):[];return r?n.map((c,u)=>this.itemTpl(c,u,!1)).join(","):{className:"b-resource-avatar-container",children:n.map((c,u)=>{const{resource:g}=c;if(u<i){const m=o>0&&u===i-1,h=s.renderAvatar({taskRecord:e,resourceRecord:g,assignmentRecord:c,overflowCount:m?o:0,overflowAssignments:m?d:[]});return m?{className:"b-overflow-img",style:{height:a+"px",width:a+"px"},children:[h,{tag:"span",className:"b-overflow-count",html:`+${o}`}]}:h}})}}renderAvatar({taskRecord:e,resourceRecord:n,assignmentRecord:r,overflowCount:s,overflowAssignments:a}){const{resourceImageFolderPath:i}=this.grid,o=n.imageUrl||n.image&&i&&i+n.image,d=this.avatarRendering.getResourceAvatar({resourceRecord:n,initials:n.initials,color:n.eventColor,iconCls:n.iconCls,defaultImageUrl:this.defaultAvatar,imageUrl:o});return d.elementData||(d.elementData={}),Object.assign(d.elementData,{taskRecord:e,resourceRecord:n,assignmentRecord:r,overflowCount:s,overflowAssignments:a}),d}get defaultAvatar(){const{grid:e}=this;return e.defaultResourceImageName?e.resourceImageFolderPath+e.defaultResourceImageName:""}toClipboardString({record:e}){return $.safeJsonStringify(e[this.field])}fromClipboardString({string:e,record:n}){const r=$.safeJsonParse(e),s=[];if(r!=null&&r.length)for(const a of r)delete a.id,delete a.event,delete a.resource,a.eventId=n.id,s.push(new fe(a));return s}canFillValue({range:e}){return e.every(n=>n.column===this)}calculateFillValue({record:e,value:n}){const r=JSON.stringify(n);return this.fromClipboardString({string:r,record:e})}setupDragging(){const e=this,{grid:n}=e;n.features.rowReorder&&(n.features.rowReorder.dragHelper.targetSelector+=" .b-grid-cell:not(.b-resourceassignment-cell)"),e.subGrid.element.classList.add("b-draggable-resource-avatars"),e.dragHelper=new ha({callOnFunctions:!0,cloneTarget:!0,targetSelector:".b-resource-avatar-container > .b-resource-avatar",onDragStart({context:r}){const{grabbed:s}=r;r.resourceRecord=s.elementData.resourceRecord,n.enableScrollingCloseToEdges()},onDrag({context:r,event:s}){const a=r.targetTask=n.resolveTaskRecord(s.target);r.valid=!!(a&&!a.resources.includes(r.resourceRecord))},async onDrop({context:r,event:s}){const{targetTask:a,resourceRecord:i,valid:o,grabbed:d,element:c}=r,{assignmentRecord:u,taskRecord:g}=d.elementData,m=s.target.closest(".b-resourceassignment-cell");if(o&&(d.style.display="none"),!m)c.style.display="none",g.unassign(i);else if(o){const h=n.getCell({column:e,record:a}),p=h==null?void 0:h.querySelector(".b-resource-avatar-container");p&&await this.animateProxyTo(p,{align:"l0-r0"}),a.resources.includes(i)||(u.event=a)}n.disableScrollingCloseToEdges()}})}}C.registerColumnType(St),St._$name="ResourceAssignmentColumn";class bt extends J{static get $name(){return"RollupColumn"}static get type(){return"rollup"}static get isGanttColumn(){return!0}static get defaults(){return{field:"rollup",text:"L{Rollup}"}}}C.registerColumnType(bt),bt._$name="RollupColumn";class ie extends P{static get defaults(){return{field:"direction",text:"L{schedulingDirection}",width:146,editor:{type:"schedulingdirectionpicker",allowInvalid:!1},filterable:{filterField:{type:"schedulingdirectionpicker"}}}}getEnforcedName(t){return t.name||(t.isRoot?"Project":`Task #${t.id}`)}get tooltipRenderer(){return this._tooltipRenderer!==void 0?this._tooltipRenderer:this._tooltipRenderer=({record:t})=>{const{effectiveDirection:e}=t;return e?e.kind==="enforced"?this.L("L{enforcedBy}")+` "${this.getEnforcedName(e.enforcedBy)}"`:e.kind==="inherited"?this.L("L{inheritedFrom}")+` "${this.getEnforcedName(e.inheritedFrom)}"`:void 0:!1}}renderer({record:t}){const{effectiveDirection:e}=t;if(!e)return"";let n;return e.kind==="enforced"||e.kind==="inherited"?n=e.direction:n=t.direction,gs.localize(n)||""}}v(ie,"$name","SchedulingDirectionColumn"),v(ie,"type","schedulingdirection"),v(ie,"isGanttColumn",!0),C.registerColumnType(ie),ie._$name="SchedulingDirectionColumn";class Et extends P{static get $name(){return"SchedulingModeColumn"}static get type(){return"schedulingmodecolumn"}static get isGanttColumn(){return!0}static get defaults(){return{field:"schedulingMode",text:"L{Scheduling Mode}",editor:{type:er.type,allowInvalid:!1,picker:{minWidth:"8.5em"}}}}afterConstruct(){const t=this;super.afterConstruct();let e;t.editor?(Js.createSequence(t.editor.updateLocalization,t.onEditorLocaleChange,t),e=t.editor.store):e=new er().store,this.store=e}renderer({value:t}){const e=this.store.getById(t);return e&&e.text||""}onEditorLocaleChange(){this.grid.refreshColumn(this)}canFillValue({range:t}){return t.every(e=>e.column===this)}}C.registerColumnType(Et),Et._$name="SchedulingModeColumn";class Tt extends P{static get $name(){return"SequenceColumn"}static get type(){return"sequence"}static get isGanttColumn(){return!0}static get defaults(){return{field:"sequenceNumber",text:"L{Sequence}",sortable:!1,groupable:!1,filterable:!1,width:70,editor:null}}}C.registerColumnType(Tt),Tt._$name="SequenceColumn";class wt extends J{static get $name(){return"ShowInTimelineColumn"}static get type(){return"showintimeline"}static get isGanttColumn(){return!0}static get defaults(){return{field:"showInTimeline",text:"L{Show in timeline}"}}}C.registerColumnType(wt),wt._$name="ShowInTimelineColumn";class kt extends M{static get $name(){return"StartDateColumn"}static get type(){return"startdate"}static get defaults(){return{field:"startDate",text:"L{Start}"}}get defaultEditor(){const t=super.defaultEditor;return t.type="startdate",t}}C.registerColumnType(kt),kt._$name="StartDateColumn";class xt extends Pe{constructor(){super(...arguments);v(this,"canFillValue",()=>!1)}static get $name(){return"SuccessorColumn"}static get type(){return"successor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Successors}",field:"successors"}}}C.registerColumnType(xt),xt._$name="SuccessorColumn";class $t extends Y{static get $name(){return"TotalSlackColumn"}static get type(){return"totalslack"}static get isGanttColumn(){return!0}get durationUnitField(){return"slackUnit"}static get defaults(){return{field:"totalSlack",text:"L{Total Slack}",filterable({value:t,record:e,operator:n,column:r}){const s=y.asMilliseconds(r.roundValue(e.totalSlack),e.slackUnit),a=t.milliseconds;switch(n){case"=":return s===a;case"<":return s<a;case"<=":return s<=a;case">":return s>a;case">=":return s>=a;default:throw new Error("Invalid operator "+n)}}}}getFilterableValue(t){return new Je({magnitude:t.totalSlack,unit:t.slackUnit})}}C.registerColumnType($t),$t._$name="TotalSlackColumn";class Mt extends P{constructor(){super(...arguments);v(this,"canFillValue",()=>!1)}static get $name(){return"WBSColumn"}static get type(){return"wbs"}static get isGanttColumn(){return!0}static get defaults(){return{field:"wbsValue",text:"L{WBS}",width:70,editor:null,filterable({value:e,record:n}){return n.wbsValue.match(String(e))},headerMenuItems:{renumber:{text:"L{WBSColumn.renumber}",icon:"b-icon-renumber",onItem({source:e}){e.taskStore.rootNode.refreshWbs()}}},renderer({value:e}){return String(e)}}}}C.registerColumnType(Mt),Mt._$name="WBSColumn";var _a={AddNewColumn:tt,BaselineStartDateColumn:Q,BaselineEndDateColumn:Z,BaselineDurationColumn:ee,BaselineStartVarianceColumn:ne,BaselineEndVarianceColumn:re,BaselineDurationVarianceColumn:te,CalendarColumn:rt,ConstraintDateColumn:st,ConstraintTypeColumn:at,DeadlineDateColumn:it,DurationColumn:Y,EarlyEndDateColumn:ot,EarlyStartDateColumn:lt,EffortColumn:dt,EndDateColumn:ct,IgnoreResourceCalendarColumn:se,InactiveColumn:ut,LateEndDateColumn:gt,LateStartDateColumn:ht,ManuallyScheduledColumn:mt,MilestoneColumn:Re,NameColumn:me,NoteColumn:ft,PercentDoneColumn:pt,PredecessorColumn:vt,ResourceAssignmentColumn:St,RollupColumn:bt,SchedulingDirectionColumn:ie,SchedulingModeColumn:Et,SequenceColumn:Tt,ShowInTimelineColumn:wt,StartDateColumn:kt,SuccessorColumn:xt,TotalSlackColumn:$t,WBSColumn:Mt};class sn extends J{static get $name(){return"EventModeColumn"}static get type(){return"eventmode"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",align:"left",text:"L{Event mode}"}}internalRenderer({value:t,cellElement:e,column:n,isExport:r}){if(super.internalRenderer(...arguments),r)return this.renderText(t);e.widget&&(e.widget.text=this.renderText(t))}onCheckboxChange({source:t,checked:e}){super.onCheckboxChange(...arguments),t.text=this.renderText(e)}renderText(t){return t?this.L("L{Manual}"):this.L("L{Auto}")}}C.registerColumnType(sn),sn._$name="EventModeColumn";class an extends wa{static get defaults(){return{enableCellContextMenu:!0}}}C.registerColumnType(an),an._$name="TimeAxisColumn";class on extends Qn{static get defaultConfig(){return{modelClass:fe,loadPriority:500,syncPriority:400}}}on._$name="AssignmentStore";class It extends hs{}It._$name="CalendarModel";class ln extends ms{static get defaultConfig(){return{modelClass:It}}}ln._$name="CalendarManagerStore";class Rt extends fs{constructor(...t){const[e]=t;e!=null&&e.fromTask&&(e.fromEvent=e.fromTask),e!=null&&e.toTask&&(e.toEvent=e.toTask),super(...t)}get from(){var t;return(t=this.fromEvent)===null||t===void 0?void 0:t.id}set from(t){super.from=t}get fromTask(){return this.fromEvent}set fromTask(t){this.fromEvent=t}get to(){var t;return(t=this.toEvent)===null||t===void 0?void 0:t.id}set to(t){super.to=t}get toTask(){return this.toEvent}set toTask(t){this.toEvent=t}get persistableData(){const t=super.persistableData,{fromTask:e,toTask:n}=t;return e&&(t.fromTask=e.id),n&&(t.toTask=n.id),t}shouldRecordFieldChange(t,e,n){return t==="from"||t==="to"?!1:super.shouldRecordFieldChange(t,e,n)}}Rt._$name="DependencyModel";class dn extends ps{static get defaultConfig(){return{modelClass:Rt,loadPriority:300,syncPriority:500}}}dn._$name="DependencyStore";class Pt extends vs{}Pt._$name="ResourceModel";class cn extends Ds{static get defaultConfig(){return{modelClass:Pt,loadPriority:400,syncPriority:200}}}cn._$name="ResourceStore";class Lt extends Kt{constructor(){super(...arguments);v(this,"isBaseline",!0)}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:n}=this;if(e&&n)return n.getTime()===e.getTime()}return this.duration===0}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}normalize(){const e=this,{task:n,startDate:r,endDate:s,duration:a}=e,i=a!=null;n.graph?r&&s&&!i?e.setData("duration",n.run("calculateProjectedDuration",r,s)):r&&!s&&i?e.setData("endDate",n.run("calculateProjectedXDateWithDuration",r,!0,a)):!r&&s&&i&&e.setData("startDate",n.run("calculateProjectedXDateWithDuration",s,!1,a)):super.normalize()}get startVariance(){const{task:e}=this,n=y.getDurationInUnit(this.startDate,e.startDate,e.durationUnit);return new Je({magnitude:n,unit:e.durationUnit})}get endVariance(){const{task:e}=this,n=y.getDurationInUnit(this.endDate,e.endDate,e.durationUnit);return new Je({magnitude:n,unit:e.durationUnit})}get durationVariance(){return this.fullDuration&&this.task.fullDuration.diff(this.fullDuration)}}v(Lt,"fields",[{name:"task",persist:!1}]),Lt._$name="Baseline";class At extends Ys{static get type(){return"wbs"}convert(t){return K.from(t)}serialize(t){return String(t)}}At.prototype.compare=K.compare,At.initClass(),At._$name="WbsField";const un=(l,t)=>{const{startDate:e,durationUnit:n,endDate:r}=l;return t?t.map(s=>{const a=+("startDate"in s)+("endDate"in s)+("duration"in s)>1,i={task:l,...s};return a||Object.assign(i,{startDate:e,endDate:r,durationUnit:n}),i}):[]},Na=l=>l.field==="wbsValue"&&!l.ascending,Ua=l=>{for(let t,e,n=0,r=l.length;n<r;++n)if(e=l[n].wbsValue,e){if(t)return e<t;t=e}return!1},Wa={deep:!0},za={deep:!0,silent:!0};class oe extends en.derive(Kt).mixin(tr,ys){constructor(){super(...arguments);v(this,"$manuallyScheduled",null)}static get fields(){return[{name:"cls",serialize:e=>e.isDomClassList?e.toString():e,persist:!0},{name:"fullEffort",persist:!1},{name:"baselines",type:"store",modelClass:Lt,storeClass:xe,lazy:!0},{name:"note",type:"string"},"parentId",{name:"children",persist:!1},{name:"showInTimeline",type:"boolean"},{name:"rollup",type:"boolean"},{name:"wbsValue",type:"wbs",persist:!1},{name:"deadlineDate",type:"date"},{name:"parentIndex",type:"number",persist:!0},"iconCls","taskIconCls",{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0},"eventColor"]}getDefaultSegmentModelClass(){return Cs}endBatch(){const{isPersistable:e}=this;super.endBatch(...arguments),this.isPersistable&&!e&&this.assignments.forEach(n=>{n.stores.forEach(r=>{r.updateModifiedBagForRecord(n)})})}get isTask(){return!0}get isTaskModel(){return!0}get isEvent(){return!0}get wbsCode(){return String(this.wbsValue)}set wbsCode(e){this.wbsValue=K.from(e)}copy(...e){const n=super.copy(...e);return n.setData("wbsValue",null),n}processBaselinesStoreData(e){return un(this,e)}set baselines(e){this.set({baselines:e})}get baselines(){const e=this;return e.$initializedBaselines||(e.fieldMap.baselines.init(e.data,e),e.assignInitables(),e.$initializedBaselines=!0),e.meta.baselinesStore}get hasBaselines(){var r;var e;const n=this.fieldMap.baselines;return!!((r=(e=this.baselines)===null||e===void 0?void 0:e.count)!=null?r:this.originalData[n.dataSource])}setBaseline(e){if(e<=0)return;const{baselines:n}=this,r=e-n.count;r>0?n.add(un(this,new Array(r).fill({}))):n.getAt(e-1).set(un(this,[{}])[0])}get successors(){return Array.from(this.outgoingDeps||[])}set successors(e){this.outgoingDeps=e}setSuccessors(e){return this.replaceDependencies(e,!0)}replaceDependencies(e,n){const r=this,{dependencyStore:s}=r.project,a=new Set,i=new Set,o=[],d=n?r.outgoingDeps:r.incomingDeps,c=Array.from(d);return e.forEach(u=>{const g=c.find(n?m=>m.toEvent===u.toEvent:m=>m.fromEvent===u.fromEvent);g?(a.add(g),g.copyData(u)):i.add(u)}),d.forEach(u=>{a.has(u)||o.push(u)}),o.forEach(u=>s.remove(u)),i.forEach(u=>{n?u.fromEvent=r:u.toEvent=r,s.add(u)}),r.commitAsync()}get predecessors(){return Array.from(this.incomingDeps||[])}set predecessors(e){this.incomingDeps=e}setPredecessors(e){return this.replaceDependencies(e,!1)}get assignments(){return super.assignments}set assignments(e){const n=this,{assignmentStore:r}=n.project,s=[],a=n.assignments,i=a.filter(o=>!(e!=null&&e.find(d=>d.resource===o.resource)));e.forEach(o=>{const d=r.getAssignmentForEventAndResource(this,o.resource);d?d.copyData(o):(o.remove(),s.push(o))}),r.remove(i),r.add(s)}get assigned(){var n;const{project:e}=this;return e!=null&&e.isDelayingCalculation?(n=e.assignmentStore.storage.findItem("event",this))!=null?n:new Set:super.assigned}set assigned(e){super.assigned=e}get isDraggable(){return this.draggable}get isResizable(){return this.resizable&&!this.milestone&&this.isEditable("endDate")}get isMilestone(){return this.milestone}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":case"lateStartDate":case"lateEndDate":case"totalSlack":return!1;case"effort":case"fullEffort":case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}isFieldModified(e){return e==="fullEffort"?super.isFieldModified("effort")||super.isFieldModified("effortUnit"):super.isFieldModified(e)}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:n}=this;if(e&&n)return n.getTime()===e.getTime()}return this.duration===0}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}get allDependencies(){return this.dependencies}get dependencies(){var e;return(e=this.project)!==null&&e!==void 0&&e.isDelayingCalculation?[]:[...this.incomingDeps||[],...this.outgoingDeps||[]]}set dependencies(e){const n=this,r=[],s=[];e==null||e.forEach(a=>{a.fromEvent===n||a.fromEvent===n.id?s.push(a):(a.toEvent===n||a.toEvent===n.id)&&r.push(a)}),n.setPredecessors(r),n.setSuccessors(s)}get predecessorTasks(){return[...this.incomingDeps||[]].map(e=>e.fromEvent)}get successorTasks(){return[...this.outgoingDeps||[]].map(e=>e.toEvent)}get previousSiblingsTotalCount(){let e=this.previousSibling,n=this.parentIndex;for(;e;)n+=e.descendantCount,e=e.previousSibling;return n}get sequenceNumber(){if(this.taskStore)return this.taskStore.allIndexOf(this)+1;let e=0,n=this;for(;n.parent;)e+=n.previousSiblingsTotalCount+1,n=n.parent;return e}get isSubProject(){return!1}get subProject(){const e=this;let n=null;return e.isProject?n=e:e.bubbleWhile(r=>(r.isProject&&(n=r),!n)),n}get fullEffort(){return new Je({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get resources(){return this.assignments.reduce((e,n)=>(n.resource&&e.push(n.resource),e),[])}get $linkedResources(){var n;var e;return(n=(e=this.resources)===null||e===void 0?void 0:e.flatMap(r=>[r,...r.$links]))!=null?n:[]}normalize(){}inSetNormalize(e){}joinStore(e){const n=this,r=(n.firstStore||e).useOrderedTreeForWbs;if(!n.wbsValue&&!n.generatedParent){var s,a;(n.taskStore||e).isLoadingData||!((s=n.nextSibling)!==null&&s!==void 0&&s.wbsValue||(a=n.previousSibling)!==null&&a!==void 0&&a.wbsValue)?n.refreshWbs({useOrderedTree:r,...za}):n.parent.refreshWbs(Wa,-1)}super.joinStore(e)}refreshWbs(e,n){var d,c,u,g,m;const r=this,{parent:s}=r,a=r.firstStore||null,{useOrderedTree:i=(d=a==null?void 0:a.useOrderedTreeForWbs)!=null?d:!1}=e||{};if(s&&n!==-1&&r.fieldMap.wbsValue){i?n=r.orderedParentIndex:n=(c=n!=null?n:r.unfilteredIndex)!=null?c:r.parentIndex,n++;const h=s.isRoot?new K(n):s.wbsValue.append(n);e!=null&&e.silent?r.setData("wbsValue",h):r.set("wbsValue",h)}if((u=e==null?void 0:e.deep)==null||u)if(i)for(const h of(g=r.orderedChildren)!=null?g:[])h.refreshWbs(e);else{const h=(m=r.unfilteredChildren)!=null?m:r.children,p=(h==null?void 0:h.length)||0;if(p){var o;const D=Ua(h)&&(a==null||(o=a.sorters)===null||o===void 0?void 0:o.findIndex(Na))===0;for(let f=0;f<p;++f)h[f].refreshWbs(e,D?p-f-1:f)}}}async tryInsertChild(){return this.getProject().tryPropagateWithChanges(()=>{this.insertChild(...arguments)})}updateDependencies(e,n){this.outgoingDeps.forEach(r=>{if(r.toEvent.isScheduled){const{type:s,calendar:a,toEvent:i}=r;e&&(s===qe.Type.StartToStart?r.setLag(y.as("hour",a.calculateDurationMs(e,i.startDate,!0)),"hour"):s===qe.Type.StartToEnd&&r.setLag(y.as("hour",a.calculateDurationMs(e,i.endDate,!0)),"hour")),n&&(s===qe.Type.EndToStart?r.setLag(y.as("hour",a.calculateDurationMs(n,i.startDate,!0)),"hour"):s===qe.Type.EndToEnd&&r.setLag(y.as("hour",a.calculateDurationMs(n,i.endDate,!0)),"hour"))}})}async moveTaskPinningSuccessors(e){const n=this;return n.startDate=e,n.bubble(r=>{if(!r.isRoot){const s=r.run("calculateStartDate"),a=r.run("calculateEndDate");r.updateDependencies(s,a)}}),n.project.commitAsync()}async setStartDatePinningSuccessors(e){const n=this,r=n.setStartDate(e,!1);return n.bubble(s=>{if(!s.isRoot){const a=s.run("calculateStartDate");s.updateDependencies(a,null)}}),r}async setEndDatePinningSuccessors(e){const n=this;return n.endDate=e,n.bubble(r=>{if(!r.isRoot){const s=r.run("calculateEndDate");r.updateDependencies(null,s)}}),n.project.commitAsync()}getCurrentConfig(e){const{segments:n}=this,r=super.getCurrentConfig(e);return r&&n&&(r.segments=n.map(s=>s.getCurrentConfig(e))),r}}oe.convertEmptyParentToLeaf=!0,oe._$name="TaskModel";const Le={deep:!0},Ir=Object.freeze({add:!0,remove:!0,sort:!0}),Ha=Object.freeze({add:!1,remove:!1,sort:!1}),gn=(l,t)=>K.compare(l==null?void 0:l.wbsCode,t==null?void 0:t.wbsCode);class Ae extends Yn.derive(Qs).mixin(tr,Bs,Vs){static get defaultConfig(){return{modelClass:oe,loadPriority:200,syncPriority:300,storeId:"tasks",tree:!0}}static get configurable(){return{wbsMode:"manual",useOrderedTreeForWbs:!1,outdentIgnoringSiblings:!1,forceWbsOrderForChanges:!1}}changeWbsMode(t){return t==="auto"?Ir:t&&typeof t=="object"?(A.values(t).every(e=>!e)&&(t=A.assign({},Ir,t)),t):Ha}setBaseline(t){const e=this.storage.values;this.forEach(n=>n.setBaseline(t)),this.trigger("refresh",{action:"batch",records:e,data:e})}async indent(t){const e=this,{taskStore:n,project:r}=e;let s=!1;if(t=Array.isArray(t)?t.slice():[t],t=t.filter(a=>!a.isProjectModel),t=t.filter(a=>{let i;for(i=!!a.previousSibling;i&&!a.isRoot;)i=!t.includes(a.parent),a=a.parent;return i}),t.length&&n.trigger("beforeIndent",{records:t})!==!1){if(t.sort((a,i)=>K.compare(a.wbsCode,i.wbsCode)),n.beginBatch(),s=await r.tryPropagateWithChanges(()=>{for(const a of t){const i=a.previousSibling;i.appendChild(a),e.toggleCollapse(i,!1)}}),e.isDestroyed)return;n.endBatch(),s&&(e.refreshWbsForChildren({up:2,nodes:t}),e.trigger("indent",{records:t}),e.trigger("change",{action:"indent",records:t}))}return s}async outdent(t){const e=this,{taskStore:n,project:r}=e;let s=!1;if(t=Array.isArray(t)?t.slice():[t],t=t.filter(a=>!a.isProjectModel),t=t.filter(a=>{let i;for(i=a.parent&&!a.parent.isRoot;i&&!a.isRoot;)i=!t.includes(a.parent),a=a.parent;return i}),t.length&&n.trigger("beforeOutdent",{records:t})!==!1){if(t.sort((a,i)=>K.compare(i.wbsCode,a.wbsCode)),n.beginBatch(),s=await r.tryPropagateWithChanges(()=>{for(const a of t){const i=!this.outdentIgnoringSiblings&&a.parent.children.slice(a.parent.children.indexOf(a)+1);a.parent.parent.insertChild(a,a.parent.nextSibling,!1,{orderedBeforeNode:a.parent.nextOrderedSibling}),i.length&&a.appendChild(i),e.toggleCollapse(a,!1)}}),e.isDestroyed)return;n.endBatch(),s&&(e.refreshWbsForChildren({up:1,nodes:t}),e.trigger("outdent",{records:t}),e.trigger("change",{action:"outdent",records:t}))}return s}onNodeAddChild(t,e,n,r,s=!1){if(super.onNodeAddChild(t,e,n,r,s),!this.isLoadingData&&this.wbsMode.add){t.refreshWbs(Le);const a=new Set;e.forEach(i=>{const o=this.getById(i.meta.oldParentId);o&&t!==o&&!a.has(o)&&(a.add(o),o.refreshWbs(Le,-1))})}}onNodeRemoveChild(t,e,n,r={isMove:!1,silent:!1,unfiltered:!1}){const s=super.onNodeRemoveChild(t,e,n,r);return this.wbsMode.remove&&!r.isMove&&t.refreshWbs(Le),s}applyChangeset(t,e=null,...n){var u,g;const r=this,{updated:s,modified:a}=(u=e==null?void 0:e(t,r))!=null?u:t,i=(g=s!=null?s:a)!=null?g:[],o=r.forceWbsOrderForChanges&&r.tree&&!r.isSorted&&!r.isGrouped?i.reduce((m,{id:h,parentId:p})=>{var f;if(p!==void 0){var D;const S=r.getById(h),k=S==null||(D=S.parent)===null||D===void 0?void 0:D.parentId;p===k&&m.push({node:S,originalNodeAbove:(f=S.previousSibling)!=null?f:S.parent})}return m},[]):[],d=super.applyChangeset(t,e,...n);if(o.length>0)for(const{node:m,originalNodeAbove:h}of o){var c;const{parent:p}=m,D=h.parent===p?h.parentIndex:((c=h.parent)===null||c===void 0?void 0:c.parent)===p?h.parent.parentIndex:void 0;D!==void 0&&p.children.includes(m)&&p.insertChild(m,D+1)}return d}afterChangesetApplied(t){super.afterChangesetApplied(t),t.forEach(e=>{e.refreshWbs({deep:!0,useOrderedTree:!0})})}afterPerformSort(t){this.wbsMode.sort&&this.rootNode.refreshWbs(Le),super.afterPerformSort(t)}refreshWbsForChildren(t){const e=t.nodes,n={...Le,...t},r=new Set,s=n.up||0;let a,i;e.forEach(o=>{for(i=o,a=s;i&&a;--a)i=i.parent;r.add(i)});for(i of r)i.refreshWbs(n)}getTotalTimeSpan(){return{startDate:this.getProject().startDate,endDate:this.getProject().endDate}}getEventsForResource(t){const e=this.resourceStore.getById(t),n=(e==null?void 0:e.assignments.filter(s=>s.isPartOfStore(this.assignmentStore)))||[],r=[];return n.forEach(({event:s})=>s&&r.push(s)),r}isDateRangeAvailable(t,e,n,r){const s=new Set(this.getEventsForResource(r));if(n!=null&&n.isAssignment&&n.event.resources.forEach(o=>{o.id!==n.resourceId&&this.getEventsForResource(o).forEach(d=>s.add(d))}),n){const a=n.isAssignment?n.event:n;s.delete(a)}return!Array.from(s).some(a=>a.isScheduled&&y.intersectSpans(t,e,a.startDate,a.endDate))}linkTasks(t){for(let e=1;e<t.length;e++){const n=t[e-1],r=t[e];this.dependencyStore.getEventsLinkingDependency(n,r)||this.dependencyStore.add({from:n,to:r})}}unlinkTasks(t){this.dependencyStore.remove(this.dependencyStore.query(({fromTask:e,toTask:n})=>t.includes(e)||t.includes(n)))}get changes(){const t=super.changes;return t&&this.forceWbsOrderForChanges&&(t.added.sort(gn),t.modified.sort(gn),t.removed.sort(gn)),t}}v(Ae,"$name","TaskStore"),Ae._$name="TaskStore";const Rr=".b-task-baseline";class Ft extends Qe{static get $name(){return"Baselines"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:Rr,recordType:"baseline"}}static get pluginConfig(){return{chain:["onTaskDataGenerated","onPaint"]}}updateRenderer(){this.gantt.refresh()}construct(t,e){this.tipId=`${t.id}-baselines-tip`,this.gantt=t,super.construct(t,e)}doDisable(t){this.client.refreshWithTransition(),super.doDisable(t)}resolveTimeSpanRecord(t){const e=t.closest(Rr);return e==null?void 0:e.elementData.baseline}template(t){const e=this,{baseline:n}=t,{task:r}=n,s=e.client.formatDuration(n.duration);return`
            <div class="b-gantt-task-title">${$.encodeHtml(r.name)} (baseline ${n.parentIndex+1})</div>
            <table>
            <tr><td>${e.L("L{TaskTooltip.Start}")}:</td><td>${t.startClockHtml}</td></tr>
            ${n.milestone?"":`
                <tr><td>${e.L("L{TaskTooltip.End}")}:</td><td>${t.endClockHtml}</td></tr>
                <tr><td>${e.L("L{TaskTooltip.Duration}")}:</td><td class="b-right">${s+" "+y.getLocalizedNameOfUnit(n.durationUnit,n.duration!==1)}</td></tr>
            `}
            </table>
            `}getTaskDOMConfig(t,e){const n=this,r=t.baselines.allRecords,{rtl:s}=n.client,a=s?"right":"left";return{className:{"b-baseline-wrap":!0},style:{transform:`translateY(${e}px)`},dataset:{taskId:`baselinesFor${t.id}`},children:r.map((i,o)=>{const d=n.gantt.taskRendering.getTaskBox(i),c=d?s?n.client.timeAxisSubGrid.totalFixedWidth-d.left:d.left:0;if(d){const u={className:{[i.cls]:i.cls,"b-task-baseline":1,"b-task-baseline-milestone":i.milestone},style:{width:d.width,[a]:c,style:i.style},dataset:{index:o},elementData:{baseline:i}},g=n.renderer?n.renderer({baselineRecord:i,taskRecord:t,renderData:u}):"";return typeof g=="string"?u.html=g:u.children=[g].flat(),u}else return null}),syncOptions:{syncIdField:"index"}}}onTaskDataGenerated({taskRecord:t,top:e,extraConfigs:n,wrapperCls:r}){!this.disabled&&t.hasBaselines&&(r["b-has-baselines"]=1,n.push(this.getTaskDOMConfig(t,e)))}}v(Ft,"configurable",{renderer:null}),Ft._$name="Baselines",b.registerFeature(Ft,!1,"Gantt");class hn extends Ss{static get $name(){return"CellEdit"}static get defaultConfig(){return{addNewAtEnd:{duration:1}}}static get pluginConfig(){const t=super.pluginConfig;return t.chain=[...t.chain,"onProjectChange"],t}onProjectChange(){this.cancelEditing(!0)}getEditorForCell({record:t}){var e;const n=super.getEditorForCell(...arguments),{inputField:r}=n;return r.project=t.project,r.eventRecord=t,(e=r.loadEvent)===null||e===void 0||e.call(r,t,!1),n}doAddNewAtEnd(){const t=this,e=t.grid,{addNewAtEnd:n,addToCurrentParent:r}=t,{project:s,newTaskDefaults:a}=e;return s.queue(async()=>{if(await(!s.isDestroying&&s.commitAsync()),e.isDestroyed||e.store!==e.taskStore)return null;const i=A.assign({name:t.L("L{Gantt.New task}"),startDate:s.startDate},n,a);let o;return r?o=e.addTaskBelow(e.taskStore.last,{data:i}):o=e.taskStore.rootNode.appendChild(i),await s.commitAsync(),e.isDestroyed?null:(e.rowManager.getRowFor(o)||e.rowManager.displayRecordAtBottom(),o)})}onCellEditStart(){this.client.project.suspendAutoSync()}afterCellEdit(){this.client.project.resumeAutoSync()}}hn._$name="CellEdit",b.registerFeature(hn,!0,"Gantt");class mn extends Xe($e){static get $name(){return"CriticalPaths"}static get defaultConfig(){return{cls:"b-gantt-critical-paths",criticalDependencyCls:"b-critical",disabled:!0}}static get pluginConfig(){return{chain:["onTaskDataGenerated"]}}doDisable(t){const e=this;t?e.unhighlightCriticalPaths():e.client.project.graph?e.highlightCriticalPaths():e.client.project.ion({graphReady(){e.highlightCriticalPaths()},thisObj:e,once:!0}),super.doDisable(t)}getDependenciesFeature(){return this.client.foregroundCanvas&&this.client.features.dependencies}setupObserver(){const t=this,{project:e}=t.client;let n;t.destroyObserver(),t.criticalPathObserver=e.getGraph().observe(function*(){return yield e.$.criticalPaths},r=>{if(!t.disabled){if(t.removeCriticalCls(),n=n||t.getDependenciesFeature())for(const s of r)for(const a of s)a.dependency&&n.highlight(a.dependency,t.criticalDependencyCls);t.client.trigger("criticalPathsHighlighted")}})}destroyObserver(){if(this.criticalPathObserver){var t,e;(t=this.client.project)===null||t===void 0||(e=t.getGraph)===null||e===void 0||e.call(t).removeIdentifier(this.criticalPathObserver),this.criticalPathObserver=null}}doDestroy(){this.destroyObserver(),super.doDestroy()}highlightCriticalPaths(){const t=this,{element:e}=t.client;e.classList.contains(t.cls)&&t.unhighlightCriticalPaths(),t.setupObserver(),e.classList.add(t.cls)}removeCriticalCls(){const t=this.client.project,e=this.getDependenciesFeature();e&&t.dependencyStore.forEach(n=>e.unhighlight(n,this.criticalDependencyCls))}unhighlightCriticalPaths(){const t=this,e=t.client;t.destroyObserver(),t.removeCriticalCls(),e.element.classList.remove(t.cls),e.trigger("criticalPathsUnhighlighted")}onTaskDataGenerated(t){this.disabled||(t.cls["b-critical"]=t.taskRecord.critical)}}mn._$name="CriticalPaths",b.registerFeature(mn,!0,"Gantt");const qa=["start","start","end","end"],Ka=["start","end","start","end"],Xa=({fromTask:l},{fromTask:t})=>(l==null?void 0:l.critical)===(t==null?void 0:t.critical)?0:l!=null&&l.critical?1:-1,fn=l=>Math.round(l*2)/2;class Fe extends bs{construct(t,e={}){t.isGantt&&(this.gantt=t),super.construct(t,e)}createMarkers(){super.createMarkers();const t=this.endMarker.cloneNode(!0);t.setAttribute("id","arrowEndCritical"),t.retainElement=!0,this.client.svgCanvas.appendChild(t)}get rowStore(){return this.client.store}attachToResourceStore(...t){this.gantt||super.attachToResourceStore(...t)}getDependencyKey(t,...e){return this.gantt||super.getDependencyKey(t,...e),t.id}getAssignmentElement(t){return this.gantt?this.client.getElementFromTaskRecord(t):super.getAssignmentElement(t)}getAssignmentBounds(t){if(!this.gantt)return super.getAssignmentBounds(t);const{client:e}=this,n=e.getElementFromTaskRecord(t);return n&&!e.isExporting?I.from(n,this.relativeTo):e.isEngineReady&&e.getTaskBox(t,!0,!0)}isDependencyVisible(t){var e,n;return this.gantt?((e=t.fromEvent)===null||e===void 0?void 0:e.isScheduled)&&((n=t.toEvent)===null||n===void 0?void 0:n.isScheduled):super.isDependencyVisible(t)}drawDependency(t,e=!1,n=null){if(!this.gantt)return super.drawDependency(t,e,n);const r=this,{domConfigs:s,client:a}=r,{store:i}=a,o=a.firstVisibleRow.dataIndex,d=a.lastVisibleRow.dataIndex,{startMS:c,endMS:u}=a.visibleDateRange,{fromEvent:g,toEvent:m}=t;if(i.isAvailable(g)&&i.isAvailable(m)){const h=i.indexOf(g),p=i.indexOf(m),D=Math.min(g.startDateMS,m.startDateMS),f=Math.max(g.endDateMS,m.endDateMS);if(a.isExporting||h!=null&&p!=null&&!(h<o&&p<o||h>d&&p>d||D<c&&f<c||D>u&&f>u)){const S=r.getDomConfigs(t,g,m,n);S?s.set(t.id,S):s.delete(t.id)}r.afterDrawDependency(t,h,p,D,f)}e||r.domSync()}getDependenciesToConsider(t,e,n,r){var s;const a=(s=super.getDependenciesToConsider)===null||s===void 0?void 0:s.call(this,t,e,n,r),i=this.client.features.criticalPaths;return a&&i!==null&&i!==void 0&&i.enabled?Array.from(a).sort(Xa):a}adjustLineDef(t,e){const n=this;if(!n.gantt)return e;const{rtl:r}=n.gantt,{startBox:s,endBox:a}=e,i=n.pathFinder.startArrowMargin,o=n.client.getRecordCoords(t.fromEvent,!0),d=n.client.getRecordCoords(t.toEvent,!0),c=fn(s.getEnd(r)),u=fn(a.getStart(r)),g=fn(a.getEnd(r)),m=r?u<=c&&g<=c+i:u>=c&&g>=c+i;return t.type===j.EndToStart&&s.bottom<a.y&&m&&(e.endSide="top",t.toEvent.milestone||(r?a.x=a.right-i*2:a.width=i*2)),{...e,startBox:a,endBox:s,endSide:e.startSide,startSide:e.endSide,boxesReversed:!0,otherBoxes:[{start:s.x,end:s.right,top:o.y,bottom:o.bottom},{start:a.x,end:a.right,top:d.y,bottom:d.bottom}]}}drawForTask(){ir.deprecate("Gantt","6.0.0","Dependencies.drawForTask() is no longer needed"),this.refresh()}getHoverTipHtml({activeTarget:t}){const e=this.resolveDependencyRecord(t);return this.tooltipTemplate(e)}async createDependency(t){const e=this,{source:n,target:r,fromSide:s,toSide:a}=t,i=(s==="start"?0:2)+(a==="end"?1:0),o=e.dependencyStore.add({fromEvent:n,toEvent:r,type:i})[0];return await e.dependencyStore.project.commitAsync(),o}}v(Fe,"$name","Dependencies"),v(Fe,"configurable",{terminalSides:["left","right"],highlightDependenciesOnEventHover:!0,tooltipTemplate(t){if(!t)return null;const e=this,{dependencyIdField:n}=e.client,{fromEvent:r,toEvent:s}=t;return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:e.L("L{from}")},{text:`${r.name} ${r[n]}`},{className:`b-sch-box b-${t.fromSide||qa[t.type]}`},{tag:"label",text:e.L("L{to}")},{text:`${s.name} ${s[n]}`},{className:`b-sch-box b-${t.toSide||Ka[t.type]}`},t.lag?{tag:"label",text:e.L("L{DependencyEdit.Lag}")}:null,t.lag?{text:t.fullLag}:null]}]}},pathFinderConfig:{otherHorizontalMargin:0,otherVerticalMargin:0}}),Fe._$name="Dependencies",b.registerFeature(Fe,!0,"Gantt");class pn extends Qe{static get $name(){return"Indicators"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",forSelector:".b-indicator",recordType:"indicator",hoverDelay:500,layoutStyle:{flexDirection:"column"},defaultIndicators:{earlyDates:t=>t.earlyStartDate&&!t.isMilestone?{startDate:t.earlyStartDate,endDate:t.earlyEndDate,cls:"b-bottom b-early-dates",name:this.L("L{earlyDates}")}:null,lateDates:t=>t.lateStartDate&&!t.isMilestone?{startDate:t.lateStartDate,endDate:t.lateEndDate,cls:"b-bottom b-late-dates",name:this.L("L{lateDates}")}:null,constraintDate:t=>t.constraintDate?{startDate:t.constraintDate,cls:`b-bottom b-constraint-date b-constraint-type-${t.constraintType}`,name:this.L(`L{ConstraintTypePicker.${t.constraintType}}`)}:null,deadlineDate:t=>t.deadlineDate?{startDate:t.deadlineDate,cls:"b-bottom b-deadline-date",name:this.L("L{deadlineDate}")}:null},items:null,tooltipTemplate:t=>{const{indicator:e}=t,n=$.encodeHtml(e.name);return t.endDate?`
                        ${e.name?`<div class="b-gantt-task-title">${n}</div>`:""}
                        <table>
                            <tr><td>${this.L("L{Start}")}:</td><td>${t.startClockHtml}</td></tr>
                            <tr><td>${this.L("L{End}")}:</td><td>${t.endClockHtml}</td></tr>
                        </table>
                    `:`
                    ${e.name?`<div class="b-gantt-task-title">${n}</div>`:""}
                    ${t.startText}
                `}}}static get pluginConfig(){return{chain:["onTaskDataGenerated","onPaint"]}}construct(t,e={}){this.tipId=`${t.id}-indicators-tip`,e=Object.assign({},e);const{items:n}=e;super.construct(t,e),this.items=n}template(...t){return this.tooltipTemplate(...t)}set items(t){const e=this;e._indicators=A.assign({},e.defaultIndicators,t),e._indicatorAccessors={},e._indicatorStatus={};for(const n in e._indicators)e._indicatorStatus[n]=!!e._indicators[n],typeof e._indicators[n]!="function"&&(e._indicators[n]=e.defaultIndicators[n]),Object.defineProperty(e._indicatorAccessors,n,{enumerable:!0,get(){return e._indicatorStatus[n]?e._indicators[n]:!1},set(r){e._indicatorStatus[n]=r,e.client.refresh()}})}get items(){return this._indicatorAccessors}createIndicatorDOMConfig(t,e){const{gantt:n,renderData:r}=this,{taskRecord:s}=r,{cls:a,iconCls:i}=t,{rtl:o,timeAxis:d,timeAxisViewModel:c}=n;let{startDate:u,endDate:g}=t;g&&(g=Math.min(g,c.endDate)),n.fillTicks&&(u=d.getSnappedTickFromDate(u).startDate,g&&(g=d.getSnappedTickFromDate(g).endDate));const m=c.getPositionFromDate(u),h=g?Math.abs(c.getPositionFromDate(g-m)):null,p=a!=null&&a.isDomClassList?a:new X(a),D=r.top||n.store.indexOf(s)*n.rowManager.rowOffsetHeight+n.resourceMargin,f=r.height||n.rowHeight-n.resourceMargin*2;return t.taskRecord=s,{className:Object.assign(p,{"b-indicator":1,"b-has-icon":t.iconCls}),style:{[o?"right":"left"]:m,top:D,height:f,width:h,style:t.style},dataset:{taskId:`${r.taskId}-indicator-${e}`,taskRecordId:r.taskId},children:[i?{tag:"i",className:i}:null],elementData:t}}onTaskDataGenerated(t){if(this.disabled)return;const{items:e}=this,n=[];for(const r in e){const s=e[r];if(this._indicatorStatus[r]&&typeof s=="function"){const a=s(t.taskRecord);a&&this.client.timeAxis.timeSpanInAxis(a.startDate,a.endDate)&&n.push(a)}}t.extraConfigs.push(...n.map(this.createIndicatorDOMConfig,{gantt:this.client,renderData:t}))}resolveTimeSpanRecord(t){return t.lastDomConfig.elementData}}pn._$name="Indicators",b.registerFeature(pn,!1);class vn extends va{static get $name(){return"Labels"}static get pluginConfig(){return{chain:["onTaskDataGenerated"]}}onTaskDataGenerated(t){this.onEventDataGenerated(t)}}vn._$name="Labels",b.registerFeature(vn,!1,"Gantt");class je extends $e{constructor(){super(...arguments);v(this,"highlighted",new Map)}highlightParent(e){const{highlighted:n}=this;if(e&&!e.isProjectModel&&!n.has(e)){const{client:r}=this,{rowOffsetHeight:s}=r.rowManager,a=e.visibleDescendantCount,i=r.getTaskBox(e);if(!i)return;const o={className:{"b-parent-area":1},style:{top:i.top,height:(a+1)*s-i.top%s,left:i.left,width:i.width},dataset:{taskId:`parent-area-${e.id}`}};n.set(e,o),this.highlightParent(e.parent)}}onBeforeTaskSync(e){if(!this.disabled){const{highlighted:n,client:r}=this;n.clear();for(const s of r.rowManager){const a=r.store.getById(s.id);a&&this.highlightParent(a.parent)}e.push(...n.values())}}doDisable(e){super.doDisable(e),this.client.refresh()}}v(je,"$name","ParentArea"),v(je,"pluginConfig",{chain:["onBeforeTaskSync"]}),je._$name="ParentArea",b.registerFeature(je,!1,"Gantt");class Dn extends Xe($e){static get $name(){return"ProgressLine"}static get defaultConfig(){return{statusDate:new Date,drawLineOnlyWhenStatusDateVisible:!1,lineCls:"b-gantt-progress-line",containerCls:"b-progress-line-canvas"}}static get pluginConfig(){return{chain:["onPaint"]}}construct(t,e={}){const n=this;n.scheduleDraw=n.createOnFrame("draw",[],n,!0),super.construct(t,e),this.lineSegments=[]}doDisable(t){const e=this;e.attachToClient(t?null:e.client),e.client.rendered&&e.draw(),super.doDisable(t)}get statusDate(){return this._statusDate}set statusDate(t){t instanceof Date&&(this._statusDate=t,this.disabled||this.scheduleDraw())}getSVGCanvas(){const t=this,{client:e}=t;if(!t._svgCanvas){const n=t._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");n.retainElement=!0,n.classList.add(t.containerCls),e.foregroundCanvas.appendChild(n)}return t._svgCanvas}attachToProject(t){this.detachListeners("project"),t==null||t.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}attachToRowManager(t){this.detachListeners("rowManager"),t==null||t.ion({name:"rowManager",translaterow:"onTranslateRow",refresh:"scheduleDraw",rerender:"scheduleDraw",changetotalheight:"scheduleDraw",thisObj:this})}attachToClient(t){const e=this;e.detachListeners("client"),t==null||t.ion({name:"client",horizontalscroll:"scheduleDraw",togglenode:"scheduleDraw",taskdrag:"onTaskDrag",taskdragabortfinalized:"scheduleDraw",aftertaskdrop:"scheduleDraw",timelineviewportresize:"scheduleDraw",thisObj:e}),e.attachToProject(t==null?void 0:t.project),e.attachToRowManager(t==null?void 0:t.rowManager)}onPaint(){this.attachToProject(this.disabled?null:this.client.project)}onProjectRefresh(){this.scheduleDraw()}onTranslateRow({row:t}){t.lastTop>=0&&t.top!==t.lastTop&&this.scheduleDraw()}onTaskDrag({taskRecords:t,dragData:e}){t.forEach(n=>{this.updateLineForTask(n,{[n.id]:y.add(n.startDate,e.timeDiff)})})}shouldDrawProgressLine(){const t=this;return!t.client.timeAxisSubGrid.collapsed&&!t.disabled&&(!t.drawLineOnlyWhenStatusDateVisible||t.client.timeAxis.dateInAxis(t.statusDate))}getStatusDateX(){let{statusDate:t}=this;const{client:e}=this;return e.timeAxis.dateInAxis(t)||(t=t<e.timeAxis.startDate?e.timeAxis.startDate:e.timeAxis.endDate),e.getCoordinateFromDate(t)}getRenderData(){const t=this.getStatusDateX(),e=this.client.timeAxisSubGridElement.getBoundingClientRect(),n=[this.client.scrollLeft-e.left,-e.top];return{statusDateX:t,viewXY:n}}draw(){const t=this,{client:e}=t;if(t.lineSegments.forEach(s=>s.remove()),t.lineSegments=[],!t.shouldDrawProgressLine())return;if(e.isAnimating){e.ion({transitionend(){t.scheduleDraw()},once:!0});return}const n=t.getRenderData(),r=[];e.rowManager.forEach(s=>r.push(...t.getLineSegmentRenderData(s,n))),r.forEach(s=>t.drawLineSegment(s)),e.trigger("progressLineDrawn")}segmentBelongsToTask(t,e){return t.getAttribute("data-task-id")==e.id}updateLineForTask(t,e){const n=this;if(n.disabled)return;const r=n.client.getRowFor(t);if(r){const s=[];n.lineSegments.forEach(a=>{n.segmentBelongsToTask(a,t)&&(s.push(a),a.remove())}),or.remove(n.lineSegments,...s),n.getLineSegmentRenderData(r,n.getRenderData(),e).forEach(a=>n.drawLineSegment(a))}}getLineSegmentRenderData(t,e,n={}){const r=this,{statusDateX:s,viewXY:a}=e,i=r.client.getRecordFromElement(t.elements.normal),o=i.id,d=[];let c;return r.isStatusLineTask(i,n[i.id])&&(c=r.calculateCoordinateForTask(i,a),c&&d.push({dataset:{taskId:o},x1:s,y1:t.top,x2:c.x,y2:c.y},{dataset:{taskId:o},x1:c.x,y1:c.y,x2:s,y2:t.bottom})),c||d.push({dataset:{taskId:o},x1:s,y1:t.top,x2:s,y2:t.bottom}),d}drawLineSegment(t){const e=this;e.lineSegments.push(q.createElement(Object.assign({tag:"line",ns:"http://www.w3.org/2000/svg",class:e.lineCls,parent:e.getSVGCanvas()},t)))}isStatusLineTask(t,e){const n=this.statusDate;return e=e||t.startDate,(t==null?void 0:t.project)&&!t.inactive&&this.client.timeAxis.isTimeSpanInAxis(t)&&(t.isInProgress||!t.isStarted&&e<n||t.isCompleted&&e>n)}calculateCoordinateForTask(t,e){const{client:n}=this,r=n.getElementFromTaskRecord(t),s=t.milestone,a=s?r:r==null?void 0:r.querySelector(".b-task-percent-bar");if(a){const i=a.getBoundingClientRect(),o=n.timeAxisViewModel.totalSize;return{x:Math.min((s?i.left:i.right)+e[0],o),y:i.top+i.height/2+e[1]}}}}Dn._$name="ProgressLine",b.registerFeature(Dn);class yn extends ia.mixin(Yt){static get $name(){return"ProjectLines"}static get defaultConfig(){return{showHeaderElements:!0,cls:"b-gantt-project-line"}}attachToProject(t){super.attachToProject(t),t.ion({name:"project",refresh:this.onProjectRefresh,thisObj:this})}startConfigure(){}updateLocalization(){this.renderRanges()}onProjectRefresh(){this.renderRanges()}shouldRenderRange(t){const{client:e}=this;return e.timeAxis.dateInAxis(t.startDate)}get timeRanges(){const{startDate:t,endDate:e}=this.client.project;return t&&e?[{name:this.L("L{Project Start}"),startDate:t},{name:this.L("L{Project End}"),startDate:e}]:[]}}yn._$name="ProjectLines",b.registerFeature(yn,!0,"Gantt");const Oe="b-task-rollup",Ja=`.${Oe}`;class Cn extends Qe{static get $name(){return"Rollups"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:Ja}}static get pluginConfig(){return{chain:["onTaskDataGenerated","onPaint"]}}construct(t,e){this.tipId=`${t.id}-rollups-tip`,super.construct(t,e)}attachToTaskStore(t){this.detachListeners("taskStore"),t==null||t.ion({name:"taskStore",update:"onStoreUpdateRecord",thisObj:this})}doDestroy(){this.attachToTaskStore(null),super.doDestroy()}doDisable(t){const e=this;e.tooltip&&(e.tooltip.disabled=t),e.attachToTaskStore(t?null:e.client.taskStore),e.client.refresh(),super.doDisable(t)}getTipHtml({activeTarget:t,event:e}){const{client:n}=this,r=n.resolveTaskRecord(t),s=document.elementsFromPoint(e.pageX+globalThis.pageXOffset,e.pageY+globalThis.pageYOffset),a=s.filter(o=>o.classList.contains(Oe)).sort((o,d)=>parseInt(o.dataset.index,10)-parseInt(d.dataset.index,10)),i=a.map(o=>r.children[parseInt(o.dataset.index,10)]);return this.template({task:r,children:i})}template({children:t}){const e=this,{client:n}=e,r=[];return t.map((s,a)=>{const{startDate:i,endDate:o}=s,d=n.getFormattedDate(i),c=n.getDisplayEndDate(o,i),u=n.getFormattedDate(c);r.push(`<div class="b-gantt-task-title ${a?"b-follow-on":""}">${$.encodeHtml(s.name)}</div><table>`,`<tr><td>${e.L("L{TaskTooltip.Start}")}:</td><td>${e.clockTemplate.template({date:i,text:d,cls:"b-sch-tooltip-startdate"})}</td></tr>`,`<tr><td>${e.L("L{TaskTooltip.End}")}:</td><td>${s.isMilestone?"":e.clockTemplate.template({date:c,text:u,cls:"b-sch-tooltip-enddate"})}</td></tr></table>`)}),r.join("")}onStoreUpdateRecord({record:t,changes:e}){this.client.project.propagatingLoadChanges||t.parent&&(e.rollup||e.startDate||e.endDate)&&this.client.taskRendering.redraw(t.parent)}onTaskDataGenerated({taskRecord:t,left:e,wrapperChildren:n,style:r}){if(!this.disabled&&Array.isArray(t.children)){const s=t.children.slice().sort((a,i)=>i.durationMS-a.durationMS);n.push({className:`${Oe}-wrap`,dataset:{taskFeature:"rollups"},children:s.map(a=>{if(a.rollup&&a.isScheduled&&(!a.inactive||t.inactive)){const i=this.client.getSizeAndPosition(a);if(!i)return null;const{position:o,width:d}=i;return{dataset:{index:a.parentIndex,rollupTaskId:a.id},className:{[Oe]:Oe,[a.cls]:a.cls,"b-milestone":a.isMilestone,"b-inactive":a.inactive},style:{style:r,width:a.isMilestone?null:d,left:o-e}}}return null}),syncOptions:{syncIdField:"rollupTaskId"}})}}}Cn._$name="Rollups",b.registerFeature(Cn,!1,"Gantt");class Sn extends Da{static get $name(){return"Summary"}static get configurable(){return{summaries:null,renderer:null}}static get pluginConfig(){const t=super.pluginConfig;return t.chain.push("updateTaskStore","bindStore"),t}construct(t,e){super.construct(t,e),t.isGanttBase&&this.updateTaskStore(t.taskStore)}bindStore(){this.updateTimelineSummaries()}updateTaskStore(t){this.detachListeners("summaryTaskStore"),t.ion({name:"summaryTaskStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const t=this,{client:e,summaries:n}=t,{timeAxis:r}=e,s=t.summaryBarElement;s&&e.isEngineReady&&Array.from(s.children).forEach((a,i)=>{const o=r.getAt(i);let d="",c=`<header>${t.L("L{Summary for}",e.getFormattedDate(o.startDate))}</header>`;n.forEach(u=>{const g=u.renderer({startDate:o.startDate,endDate:o.endDate,taskStore:e.taskStore,store:e.store,resourceStore:e.resourceStore,gantt:e,element:a}),m=`<div class="b-timeaxis-summary-value">${g!=null?g:"&nbsp;"}</div>`;(n.length>1||g!=="")&&(d+=m),c+=`<label>${u.label||""}</label>`+m}),a.innerHTML=d,a._tipHtml=c})}}Sn._$name="Summary",b.registerFeature(Sn,!1,"Gantt");class pe extends Jt(fa){constructor(){super(...arguments);v(this,"entityName","task")}construct(e,n){super.construct(e,n),e.ion({beforeRenderTask:"onBeforeRenderTask",thisObj:this})}populateCellMenu({record:e,items:n}){super.populateCellMenu(...arguments),this.client.usesDisplayStore&&(n.cut&&(n.cut.disabled=!0),n.copy&&(n.copy.disabled=!0),n.paste&&(n.paste.disabled=!0))}isActionAvailable({key:e,action:n,event:r}){return!this.client.usesDisplayStore&&super.isActionAvailable({key:e,action:n,event:r})}setIsCut(e){super.setIsCut(...arguments),this.client.taskRendering.redraw(e)}onBeforeRenderTask({renderData:e}){e.cls["b-cut-row"]=e.row.cls["b-cut-row"]}extractParents(e,n,r=!0){const s=super.extractParents(e,n,r);return this.isCut||(this.depsToCopy=this.extractDependencies(e,n)),s}async insertCopiedRecords(e,n){const r=this;await r.startFeatureTransaction();const s=await super.insertCopiedRecords(e,n);return e.forEach(a=>a.refreshWbs({deep:!0,useOrderedTree:!0})),r.client.dependencyStore.add(r.depsToCopy),delete r.depsToCopy,await r.finishFeatureTransaction(),s}extractDependencies(e,n){const r={};return e.reduce((s,a)=>(a.predecessors.forEach(i=>{const o=i.id;!(o in r)&&e.includes(i.fromEvent)&&(r[o]=!0,s.push(Object.assign({},i.data,{id:void 0,to:void 0,toEvent:n[a.id].id,toTask:void 0,from:void 0,fromEvent:n[i.fromEvent.id].id,fromTask:void 0})))}),a.successors.forEach(i=>{const o=i.id;!(o in r)&&e.includes(i.toEvent)&&(r[o]=!0,s.push(Object.assign({},i.data,{id:void 0,to:void 0,toEvent:n[i.toEvent.id].id,toTask:void 0,from:void 0,fromEvent:n[a.id].id,fromTask:void 0})))}),s),[])}}v(pe,"$name","TaskCopyPaste"),v(pe,"type","taskCopyPaste"),v(pe,"configurable",{copyRecordText:"L{copyTask}",cutRecordText:"L{cutTask}",pasteRecordText:"L{pasteTask}"}),pe._$name="TaskCopyPaste",b.registerFeature(pe,!0,"Gantt");class jt extends Jt(oa){static get $name(){return"TaskDrag"}static get configurable(){return{validatorFn:(t,e,n,r)=>!0,validatorFnThisObj:null,pinSuccessors:!1,tooltipCls:"b-gantt-taskdrag-tooltip",capitalizedEventName:null}}afterConstruct(){this.capitalizedEventName=this.capitalizedEventName||this.client.capitalizedEventName,super.afterConstruct(...arguments)}changePinSuccessors(t){return Xt.toSpecialKey(t)}construct(t,e){this.gantt=t,super.construct(t,e)}get store(){return this.gantt.store}getDraggableElement(t){return t==null?void 0:t.closest(this.drag.targetSelector)}resolveEventRecord(t,e=this.client){return e.resolveTaskRecord(t)}isElementDraggable(t,e){var n;const r=this,{client:s}=r,a=r.getDraggableElement(t);if(!a||r.disabled||s.readOnly||t.matches('[class$="-handle"]'))return!1;const i=r.resolveEventRecord(a,s);return!i||!i.isDraggable||i.readOnly||!i.project?!1:!(((n=s[`is${r.capitalizedEventName}ElementDraggable`])===null||n===void 0?void 0:n.call(s,a,i,t,e))===!1)}triggerBeforeEventDrag(t,e){return this.client.trigger(t,e)}triggerEventDrag(t,e){this.client.trigger("taskDrag",{taskRecords:t.draggedEntities,startDate:t.startDate,endDate:t.endDate,dragData:t,changed:t.startDate-e!==0})}triggerDragStart(t){return this.client.trigger("taskDragStart",{taskRecords:t.draggedEntities,dragData:t}),this.startFeatureTransaction()}triggerDragAbort(t){this.client.trigger("taskDragAbort",{taskRecords:t.draggedEntities,context:t})}triggerDragAbortFinalized(t){this.rejectFeatureTransaction(),this.client.trigger("taskDragAbortFinalized",{taskRecords:t.draggedEntities,context:t})}triggerAfterDrop(t,e){this.finishFeatureTransaction(),this.currentOverClient.trigger("afterTaskDrop",{taskRecords:t.draggedEntities,context:t,valid:e})}getProductDragContext(t){return{valid:!0}}getMinimalDragData(t){const e=this.getElementFromContext(t);return{taskRecord:this.client.resolveTaskRecord(e)}}getTaskScheduleRegion(t,e){return this.client.getScheduleRegion(t,!0,e)}getDateConstraints(t){var e,n;return(e=(n=this.client).getDateConstraints)===null||e===void 0?void 0:e.call(n,t)}setupProductDragData(t){const e=this,{client:n}=e,r=t.element,s=n.resolveTaskRecord(r),a=I.from(r),i=e.getRelatedRecords(s)||[],o=e.getDateConstraints(s),d=[r],c=e.getTaskScheduleRegion(s,o);e.setupConstraints(c,a,n.timeAxisViewModel.snapPixelAmount,!!o),i.forEach(g=>{or.include(d,n.getElementFromTaskRecord(g,!1))});const u=[s,...i];return{record:s,dateConstraints:o,eventBarEls:d,draggedEntities:u,taskRecords:u}}getCoordinate(t,e,n){return n[0]}checkDragValidity(t,e){return this.validatorFn.call(this.validatorFnThisObj||this,t.draggedEntities,t.startDate,t.duration,e)}isValidDrop(t){return!0}async updateRecords(t){const{startDate:e,browserEvent:n,draggedEntities:[r]}=t,s=r.startDate;this.pinSuccessors&&n[this.pinSuccessors]?await r.moveTaskPinningSuccessors(e):await r.setStartDate(e,!0),r.startDate-s?this.client.trigger("taskDrop",{taskRecords:t.draggedEntities}):this.dragData.valid=!1}getRecordElement(t){return this.client.getElementFromTaskRecord(t,!0)}get tipId(){return`${this.client.id}-task-drag-tip`}}jt._$name="TaskDrag",b.registerFeature(jt,!0,"Gantt");class bn extends la{static get $name(){return"TaskDragCreate"}static get configurable(){return{preventMultiple:!0}}construct(t,e){this.gantt=t,super.construct(t,e)}get store(){return this.gantt.store}setupDragContext(t){var e,n;const{client:r}=this;if((e=(n=t.target).closest)!==null&&e!==void 0&&e.call(n,`.${r.timeAxisColumn.cellCls}`)){const s=r.getRecordFromElement(t.target);if(s){const a=Ta().prototype.setupDragContext.call(this,t);return a.scrollManager=r.scrollManager,a.taskRecord=a.rowRecord=s,a}}}startDrag(t){const e=this.draggingEnd=t.event.pageX>t.startEvent.pageX,{client:n}=this,{timeAxis:r}=n,{mousedownDate:s,taskRecord:a,date:i}=t;return n.beginListeningForBatchedUpdates(),a.beginBatch(),a.set("startDate",y.floor(e?s:i,r.resolution,void 0,n.weekStartDay)),a.set("endDate",y.ceil(e?i:s,r.resolution,void 0,n.weekStartDay)),this.handleBeforeDragCreate(t,a,t.event)===!1?(this.onAborted(t),!1):(t.itemElement=t.element=n.getElementFromTaskRecord(t.taskRecord),super.startDrag.call(this,t))}handleBeforeDragCreate(t,e,n){var r,s;const a=this,i=a.gantt.trigger("beforeDragCreate",{taskRecord:e,date:t.mousedownDate,event:n});return a.dateConstraints=(r=(s=a.gantt).getDateConstraints)===null||r===void 0?void 0:r.call(s,e),i}checkValidity(t,e){const n=this;return t.taskRecord=n.dragging.taskRecord,n.createValidatorFn.call(n.validatorFnThisObj||n,t,e)}isRowEmpty(t){return!t.startDate||!t.endDate}onAborted({taskRecord:t}){t.cancelBatch(),this.client.endListeningForBatchedUpdates()}}bn._$name="TaskDragCreate",b.registerFeature(bn,!0,"Gantt");class Ot extends Es{static get type(){return"taskeditor"}static get $name(){return"TaskEditor"}static get defaultConfig(){return{cls:"b-gantt-taskeditor b-schedulerpro-taskeditor"}}}Ot.initClass(),Ot._$name="TaskEditor";class Bt extends Ts{static get $name(){return"TaskEdit"}static get pluginConfig(){return{chain:["populateTaskMenu","onTaskEnterKey"],assign:["editTask"]}}editTask(t,e){return this.editEvent(t,null,e)}onActivateEditor({taskRecord:t,taskElement:e}){this.editTask(t,e)}getElementFromTaskRecord(t){return this.client.getElementFromTaskRecord(t)}onTaskEnterKey({taskRecord:t}){this.editTask(t)}populateTaskMenu({taskRecord:t,selection:e,items:n}){!this.client.readOnly&&e.length<=1&&t.project&&(n.editTask={text:"L{Gantt.Edit}",localeClass:this.client,cls:"b-separator",icon:"b-icon b-icon-edit",weight:100,disabled:this.disabled||t.readOnly,onItem:()=>this.editTask(t)})}onEventEnterKey({taskRecord:t,target:e}){this.editTask(t)}scrollTaskIntoView(t){return this.scrollEventIntoView(t)}scrollEventIntoView(t){return this.client.scrollTaskIntoView(t)}}v(Bt,"configurable",{triggerEvent:"taskdblclick",saveAndCloseOnEnter:!0,editorClass:Ot}),Bt._$name="TaskEdit",b.registerFeature(Bt,!0,"Gantt");class Vt extends ka{static get $name(){return"TaskMenu"}static get defaultConfig(){return{type:"task",processItems:null}}static get pluginConfig(){const t=super.pluginConfig;return t.chain.push("populateTaskMenu"),t}construct(t,e={}){super.construct(...arguments),this.gantt=t,t.features.cellMenu&&(console.warn("`CellMenu` feature is ignored, when `TaskMenu` feature is enabled. If you need cell specific menu items, please configure `TaskMenu` feature items instead."),t.features.cellMenu.disabled=!0)}getDataFromEvent(t){const{client:e}=this,n=this.getTargetElementFromEvent(t),r=e.resolveTaskRecord(n)||e.getRecordFromElement(n),s=r&&e.getElementFromTaskRecord(r,!1);return H.assign({event:t,targetElement:n,taskElement:s,taskRecord:r},e.getCellDataFromEvent(t))}callChainablePopulateMenuMethod(t){t.cellData&&this.client.populateCellMenu&&this.client.populateCellMenu(t),super.callChainablePopulateMenuMethod(...arguments)}shouldShowMenu(t){const{column:e}=t;return t.taskRecord&&(!e||e.enableCellContextMenu!==!1)}getElementFromRecord(t){return this.client.getElementFromTaskRecord(t)}populateTaskMenu({items:t,column:e,selection:n,taskRecord:r}){const{client:s}=this,{isTreeGrouped:a,usesDisplayStore:i}=s,o=n.includes(r)&&n.length>1;t.add={disabled:s.readOnly||a||i,hidden:o},t.convertToMilestone={disabled:s.readOnly||r.readOnly,hidden:r.isParent||r.milestone},t.indent={disabled:s.readOnly||!r.previousSibling||r.readOnly||a||i},t.outdent={disabled:s.readOnly||r.parent===s.taskStore.rootNode||r.readOnly||a||i},t.deleteTask={disabled:s.readOnly||r.readOnly},t.linkTasks={disabled:!o},t.unlinkTasks={disabled:t.linkTasks.disabled},e!=null&&e.cellMenuItems&&H.merge(t,e.cellMenuItems),s.showTaskColorPickers?t.taskColor={disabled:s.readOnly||r.readOnly}:t.taskColor={hidden:!0}}populateItemsWithData({items:t,taskRecord:e}){var n;super.populateItemsWithData(...arguments),this.client.showTaskColorPickers&&(n=t.taskColor)!==null&&n!==void 0&&n.menu&&H.merge(t.taskColor.menu.colorMenu,{value:e.eventColor,record:e})}changeItems(t){const{client:e}=this;return H.merge({add:{text:"L{Gantt.Add}",cls:"b-separator",icon:"b-icon-add",weight:500,menu:{addTaskAbove:{text:"L{Gantt.Task above}",weight:510,icon:"b-icon-up",onItem({taskRecord:n}){e.addTaskAbove(n)}},addTaskBelow:{text:"L{Gantt.Task below}",weight:520,icon:"b-icon-down",onItem({taskRecord:n}){e.addTaskBelow(n)}},milestone:{text:"L{Gantt.Milestone}",weight:530,icon:"b-icon-milestone",onItem({taskRecord:n}){e.addMilestoneBelow(n)}},subtask:{text:"L{Gantt.Sub-task}",weight:540,icon:"b-icon-subtask",at:"start",onItem({taskRecord:n}){e.addSubtask(n,{at:this.at})}},successor:{text:"L{Gantt.Successor}",weight:550,icon:"b-icon-successor",onItem({taskRecord:n}){e.addSuccessor(n)}},predecessor:{text:"L{Gantt.Predecessor}",weight:560,icon:"b-icon-predecessor",onItem({taskRecord:n}){e.addPredecessor(n)}}}},convertToMilestone:{icon:"b-icon-milestone",text:"L{Gantt.Convert to milestone}",weight:600,onItem({taskRecord:n}){n.convertToMilestone()}},indent:{text:"L{Gantt.Indent}",icon:"b-icon-indent",weight:700,separator:!0,onItem({selection:n,taskRecord:r}){e.indent(n.includes(r)?n:r)}},outdent:{text:"L{Gantt.Outdent}",icon:"b-icon-outdent",weight:800,onItem({selection:n,taskRecord:r}){e.outdent(n.includes(r)?n:r)}},deleteTask:{text:"L{Gantt.Delete task}",icon:"b-icon-trash",cls:"b-separator",weight:900,onItem({selection:n,taskRecord:r}){e.store.remove(n.includes(r)?n:r)}},linkTasks:{text:"L{Gantt.linkTasks}",icon:"b-icon-link",cls:"b-separator",weight:1e3,onItem({selection:n}){e.store.linkTasks(n)}},unlinkTasks:{text:"L{Gantt.unlinkTasks}",icon:"b-icon-unlink",weight:1010,onItem({selection:n}){e.store.unlinkTasks(n)}},taskColor:{text:"L{Gantt.color}",icon:"b-icon-palette",menu:{colorMenu:{type:"eventcolorpicker"}},separator:!0,weight:1100}},t)}}Vt.featureClass="",Vt._$name="TaskMenu",b.registerFeature(Vt,!0,"Gantt");const Ya={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"};class le extends $e.mixin(Yt){static get properties(){return{rowMap:new Map,taskMap:new Map}}construct(){super.construct(...arguments);const t=this,{client:e}=t;e.timeAxis.ion({name:"timeAxis",reconfigure:"onTimeAxisReconfigure",prio:100,thisObj:t}),e.taskStore.ion({filter:"clear",thisObj:t}),e.ion({beforeToggleNode:"clear",thisObj:t})}attachToProject(t){super.attachToProject(t),t.ion({name:"project",refresh:"onProjectRefresh",prio:100,thisObj:this})}onProjectRefresh(){this.clear()}onPaint({firstPaint:t}){t&&(this.mouseEventsDetacher=Xt.on({element:this.client.foregroundCanvas,delegate:".b-tasknonworkingtime",click:"handleMouseEvent",dblclick:"handleMouseEvent",contextmenu:"handleMouseEvent",thisObj:this}))}doDisable(t){super.doDisable(t),this.clear(),this.client.refresh()}updateMode(){this.isConfiguring||(this.clear(),this.client.refresh())}clear(){this.taskMap.clear(),this.rowMap.clear()}onTimeAxisReconfigure(){this.clear()}onTaskDataGenerated(t){if(t.task.effectiveCalendar){if(this.mode!=="bar"){const e=this.getCalendarIntervalsToRender(t,!1);t.extraConfigs.push(...e)}if(this.mode!=="row"){const e=this.getCalendarIntervalsToRender(t,!0);t.children.push(...e)}}}getCalendarIntervalsToRender(t,e=!1){const n=this,{rowMap:r,taskMap:s,client:a}=n,{timeAxis:i}=a,{task:o}=t,d=[],c=!n.maxTimeAxisUnit||y.compareUnits(i.unit,n.maxTimeAxisUnit)<=0,u=e?s:r;if(!n.disabled&&c){const g=i.first.durationMS;if(!u.has(o.id)){const m=o.effectiveCalendar,h=!e||o.isScheduled?m.getNonWorkingTimeRanges(e?o.startDate:a.startDate,e?o.endDate:a.endDate):[],p=[];for(let D=0;D<h.length;D++){const f=h[D];f.endDate-f.startDate>=g&&p.push(n.createIntervalDOMConfig({id:`r${o.id}i${D}`,iconCls:f.iconCls||m.iconCls||"",cls:`${m.cls?`${m.cls} `:""}${f.cls||""}`,startDate:f.startDate,endDate:f.endDate,name:f.name,isNonWorking:!0},t,e))}u.set(o.id,p)}d.push(...A.clone(u.get(o.id)))}return d}createIntervalDOMConfig(t,e,n=!1){const{client:r}=this,{taskRecord:s}=e,{cls:a,iconCls:i,name:o,startDate:d,endDate:c}=t,u=r.getCoordinateFromDate(d)-(n?e.left:0),g=r.getCoordinateFromDate(c)-u-(n?e.left:0),m=n?null:r.store.indexOf(s)*r.rowManager.rowOffsetHeight,h=n?null:r.rowHeight;return{className:{"b-tasknonworkingtime":1,[a]:1},style:{left:u,top:m,height:h,width:n&&g+u>e.width?e.width-u:g},children:[i?{tag:"i",className:i}:null,o],dataset:{taskId:t.id},elementData:{taskRecord:s,interval:t}}}changeTooltip(t,e){const n=this;return e==null||e.destroy(),!n.tooltipTemplate||!t?null:Zs.new({align:"b-t",forSelector:".b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) .b-sch-foreground-canvas > .b-tasknonworkingtime",forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hideDelay:0,anchorToTarget:!0,trackMouse:!1,getHtml:({activeTarget:r})=>{const{taskRecord:s,interval:a}=r.elementData;return n.tooltipTemplate({taskRecord:s,...a})}},t)}handleMouseEvent(t){const e=this,n=t.target.closest(".b-tasknonworkingtime"),{taskRecord:r,interval:s}=n.elementData;e.client.trigger("taskNonWorkingTime"+Ya[t.type],{feature:e,taskRecord:r,interval:s,domEvent:t})}}v(le,"$name","TaskNonWorkingTime"),v(le,"configurable",{idPrefix:"TaskNonWorkingTime",maxTimeAxisUnit:"week",tooltipTemplate:null,tooltip:{},mode:"row"}),v(le,"pluginConfig",{chain:["onTaskDataGenerated","onPaint"]}),v(le,"featureClass",""),le._$name="TaskNonWorkingTime",b.registerFeature(le,!1,"Gantt");class En extends Jt(ws){static get $name(){return"TaskResize"}static get configurable(){return{draggingItemCls:"b-sch-event-resizing",resizingItemInnerCls:null,pinSuccessors:!1}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isTaskElementDraggable"]}}onDragItemMouseMove(){this[`${this.client.rtl?"right":"left"}Handle`]=!1,super.onDragItemMouseMove(...arguments)}changePinSuccessors(t){return Xt.toSpecialKey(t)}isTaskElementDraggable(t,e,n,r){return this.isEventElementDraggable(...arguments)}checkValidity(){return this.basicValidityCheck(...arguments)}getBeforeResizeParams(t){return{}}setupProductResizeContext(t,e){var n;const r=this.client,s=r.resolveTaskRecord(t.element);Object.assign(t,{taskRecord:s,eventRecord:s,dateConstraints:(n=r.getDateConstraints)===null||n===void 0?void 0:n.call(r,s)})}async internalUpdateRecord(t,e){const{client:n}=this,{generation:r}=e,{startDate:s,endDate:a}=t,i={endDate:a};t.duration=i.duration=e.run("calculateProjectedDuration",s,a);const o=i[t.toSet]=e.run("calculateProjectedXDateWithDuration",s,!0,t.duration);return e.set(i),n.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(e),this.pinSuccessors&&t.event[this.pinSuccessors]?await e.setEndDatePinningSuccessors(o):await e.setEndDate(o,!1),e.endBatch(),e.generation!==r}triggerEventResizeStart(t,e,n){return super.triggerEventResizeStart(t,e,n),this.startFeatureTransaction()}triggerEventResizeEnd(t,e){super.triggerEventResizeEnd(t,e),e.changed?this.finishFeatureTransaction():this.rejectFeatureTransaction()}}En._$name="TaskResize",b.registerFeature(En,!0,"Gantt");class Gt extends jt{static get configurable(){return{capitalizedEventName:"TaskSegment"}}static get pluginConfig(){return{chain:["onPaint","isTaskElementDraggable"]}}isTaskElementDraggable(t,e,n,r){const s=this;return s.disabled||!e.isEventSegment&&!e.isSegmented?!0:!n.closest(s.drag.targetSelector)}triggerBeforeEventDrag(t,e){return this.client.trigger("beforeTaskSegmentDrag",e)}triggerBeforeEventDropFinalize(t,e,n){n.trigger(`before${this.capitalizedEventName}DropFinalize`,e)}triggerEventDrag(t,e){this.client.trigger("taskSegmentDrag",{taskRecords:t.draggedEntities,startDate:t.startDate,endDate:t.endDate,dragData:t,changed:t.startDate-e!==0})}triggerDragStart(t){this.client.trigger("taskSegmentDragStart",{taskRecords:t.draggedEntities,dragData:t})}triggerDragAbort(t){this.client.trigger("taskSegmentDragAbort",{taskRecords:t.draggedEntities,context:t})}triggerDragAbortFinalized(t){this.client.trigger("taskSegmentDragAbortFinalized",{taskRecords:t.draggedEntities,context:t})}triggerAfterDrop(t,e){this.currentOverClient.trigger("afterTaskSegmentDrop",{taskRecords:t.draggedEntities,context:t,valid:e})}onInternalInvalidDrop(t){super.onInternalInvalidDrop(...arguments),this.dragData.mainTaskElement.style.width=this.dragData.initialMainTaskElementWidth+"px"}buildDragHelperConfig(){const t=super.buildDragHelperConfig();return t.targetSelector=".b-sch-event-segment:not(.b-first)",t}getTaskScheduleRegion(t,e){const{client:n}=this,r=n.getElementFromTaskRecord(t.event),s=I.from(r,n.timeAxisSubGridElement),a=this.client.getScheduleRegion(t.event,!0,e);return a.translate(-s.x),a}setupProductDragData(t){const e=super.setupProductDragData(t);return e.mainTaskElement=this.client.getElementFromTaskRecord(e.record.event,!1),e.initialMainTaskElementWidth=parseFloat(e.mainTaskElement.style.width),e}updateDragContext(t,e){super.updateDragContext(...arguments);const{dirty:n,record:r,mainTaskElement:s,initialMainTaskElementWidth:a}=this.dragData;n&&!r.nextSegment&&(s.style.width=a+t.clientX-t.startClientX+"px")}get tipId(){return`${this.client.id}-task-segment-drag-tip`}async updateRecords(t){const{startDate:e,draggedEntities:[n]}=t,r=n.startDate;n.isEventSegment&&(await n.setStartDate(e,!0),n.startDate-r?this.client.trigger("taskSegmentDrop",{taskRecords:t.draggedEntities}):this.dragData.valid=!1)}getDateConstraints(t){const e=super.getDateConstraints(t)||{};let{minDate:n,maxDate:r}=e;return t.previousSegment&&(!n||n<t.previousSegment.endDate)&&(n=t.previousSegment.endDate),t.nextSegment&&(!r||r<t.nextSegment.startDate)&&(r=t.nextSegment.startDate),(n||r)&&{start:n,end:r}}}v(Gt,"$name","TaskSegmentDrag"),Gt._$name="TaskSegmentDrag",b.registerFeature(Gt,!0,"Gantt");class _t extends ks{static get configurable(){return{draggingItemCls:"b-sch-event-resizing",resizingItemInnerCls:null,leftHandle:!1}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isTaskElementDraggable","isTaskSegmentElementDraggable"]}}isTaskElementDraggable(t,e,n,r){return this.isEventElementDraggable(...arguments)}isTaskSegmentElementDraggable(t,e,n,r){return this.isEventElementDraggable(...arguments)}checkValidity(){return this.basicValidityCheck(...arguments)}getBeforeResizeParams(t){return{}}setupProductResizeContext(t,e){var n;const r=this.client,s=r.resolveTaskRecord(t.element);Object.assign(t,{taskRecord:s,eventRecord:s,dateConstraints:(n=r.getDateConstraints)===null||n===void 0?void 0:n.call(r,s)})}async internalUpdateRecord(t,e){const{client:n}=this,{generation:r}=e,{startDate:s,endDate:a}=t,i={endDate:a};t.duration=i.duration=e.run("calculateProjectedDuration",s,a);const o=i[t.toSet]=e.run("calculateProjectedXDateWithDuration",s,!0,t.duration);return e.set(i),n.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(e),this.pinSuccessors&&t.event[this.pinSuccessors]?await e.setEndDatePinningSuccessors(o):await e.setEndDate(o,!1),e.endBatch(),e.generation!==r}get tipId(){return`${this.client.id}-task-segment-resize-tip`}}v(_t,"$name","TaskSegmentResize"),_t._$name="TaskSegmentResize",b.registerFeature(_t,!0,"Gantt");class Tn extends Qe{static get $name(){return"TaskTooltip"}static get defaultConfig(){return{template(t){const e=this,{taskRecord:n}=t,r=e.client.formatDuration(n.duration,e.decimalPrecision);return`
                    ${n.name?`<div class="b-gantt-task-title">${$.encodeHtml(n.name)}</div>`:""}
                    <table>
                    <tr><td>${e.L("L{Start}")}:</td><td>${t.startClockHtml}</td></tr>
                    ${n.milestone?"":`
                        <tr><td>${e.L("L{End}")}:</td><td>${t.endClockHtml}</td></tr>
                        <tr><td>${e.L("L{Duration}")}:</td><td class="b-right">${r} ${y.getLocalizedNameOfUnit(n.durationUnit,n.duration!==1)}</td></tr>
                        <tr><td>${e.L("L{Complete}")}:</td><td class="b-right">${n.renderedPercentDone}%</td></tr>
                    `}
                    </table>                 
                `},decimalPrecision:null,cls:"b-gantt-task-tooltip",monitorRecordUpdate:!0}}}Tn._$name="TaskTooltip",b.registerFeature(Tn,!0,"Gantt");class Be extends Pa.mixin(Yt,Xe){updateParents(t){var e;!((e=t.children)===null||e===void 0)&&e.length&&ea.postWalk(t,n=>{var r;return!((r=n.children)!==null&&r!==void 0&&r[0].isLeaf)&&n.children},n=>{const{children:r}=n;let s=r[0].startDate,a=r[0].endDate,i=0;for(const o of r)o.startDate&&(s=Math.min(o.startDate,s||Number.MAX_SAFE_INTEGER)),o.endDate&&(a=Math.max(o.endDate,a)),i+=o.percentDone;n.startDate=new Date(s),n.endDate=new Date(a),n.duration=this.client.project.taskStore.rootNode.run("calculateProjectedDuration",n.startDate,n.endDate),n.percentDone=i/r.length})}processTransformedData(t){this.updateParents(t)}onTaskStoreChange({action:t,records:e}){const{client:n}=this;n.isTreeGrouped&&e.some(r=>r.isLeaf)&&t!=="dataset"&&(n.suspendRefresh(),this.updateParents(n.store.rootNode),n.resumeRefresh(),this.refresh())}refresh(){this.client.refreshWithTransition()}async applyLevels(t){this.detachListeners("taskStore"),await super.applyLevels(t),!this.isDestroyed&&(t==null?void 0:t.length)>0&&(this.detachListeners("taskStore"),this.client.taskStore.ion({name:"taskStore",change:"onTaskStoreChange",thisObj:this}))}}v(Be,"$name","TreeGroup"),v(Be,"delayable",{refresh:"raf"}),Be._$name="TreeGroup",b.registerFeature(Be,!1,"Gantt");class Ve extends nr{construct(t,e){super.construct(t,e),t.ion({taskMenuItem:({item:n,selection:r})=>{const s=this,a=r.length>1;n.ref==="deleteTask"?s.transactionDescription=a?s.L("L{Versions.deletedTasks}"):s.L("L{Versions.deletedTask}"):n.ref==="indent"?s.transactionDescription=s.L("L{Versions.indented}"):n.ref==="outdent"?s.transactionDescription=s.L("L{Versions.outdented}"):n.ref==="cut"?s.transactionDescription=s.L("L{Versions.cut}"):n.ref==="paste"&&(s.transactionDescription=s.L("L{Versions.pasted}"))}})}}v(Ve,"$name","Versions"),v(Ve,"configurable",{knownBaseTypes:[oe,...nr.configurable.knownBaseTypes]}),Ve._$name="GanttVersions",b.registerFeature(Ve,!1,"Gantt");const Qa=.4;var wn=l=>class extends l{async prepareComponent(e){await super.prepareComponent(e);const n=this,r=n.element.querySelector(".b-sch-foreground-canvas");q.removeEachSelector(r,".b-gantt-task-wrap"),q.removeEachSelector(r,".b-released")}collectEvents(e,n){const r=this,s=e.length,{client:a}=n,i=r.exportMeta.subGrids.normal.rows;e.forEach((o,d)=>{const c=i[i.length-s+d],u=a.store.getAt(o.dataIndex),g=c[3];if(u.isScheduled){const m=a.getElementFromTaskRecord(u,!1);m&&!g.has(u.id)&&g.set(u.id,[m.outerHTML,I.from(m.firstChild,m.offsetParent)])}})}renderEvents(e,n){const r=this,{client:s}=e,a=s.hasActiveFeature("baselines"),i=r.exportMeta.subGrids.normal.rows,o=r.exportMeta.topRowOffset=n[0].top-n[0].dataIndex*n[0].offsetHeight;n.forEach((d,c)=>{const u=i[c],g=u[3],m=s.store.getAt(d.dataIndex),h=s.currentOrientation.getTaskRenderData(d,m),{taskId:p}=h;if(h.top+=o,h.isTask){const D=s.currentOrientation.getTaskDOMConfig(h),f=document.createElement("div"),{isMilestone:S}=m,k=m.baselines.count;Ye.sync({targetElement:f,domConfig:D});let{left:w,top:ce,width:Fn,height:Ut}=h;S&&(w=w-Ut/2,Fn=Ut),g.set(p,[f.outerHTML,new I(w,ce,Fn,Ut*(a&&k?Qa:1)),[]])}if(h.extraConfigs.length){const D=document.createElement("div"),f=[];for(const S of h.extraConfigs)Ye.sync({targetElement:D,domConfig:S}),f.push(D.outerHTML);g.has(p)||g.set(p,["",null,[]]),g.get(p)[2]=f}})}getEventBox(e){if(!e)return;let n=this.exportMeta.eventsBoxes.get(String(e.id));if(!n){const{client:r}=this.exportMeta,s=r.getCoordinateFromDate(e.startDate),a=r.getCoordinateFromDate(e.endDate),{rows:i}=this.exportMeta.subGrids.normal,[o,d,c]=i[0],[,u]=i[i.length-1],g=parseInt(o.match(/data-index="(\d+)?"/)[1]),m=r.taskStore.indexOf(e),h=m<g?d-c:u+c;n=new I(s,h,a-s,c)}return n}};class kn extends wn(ya){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}}kn._$name="MultiPageExporter";class xn extends wn(Ca){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}}xn._$name="MultiPageVerticalExporter";class $n extends wn(Sa){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}}$n._$name="SinglePageExporter";class Mn extends ba{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[$n,kn,xn]}}}Mn._$name="PdfExport",b.registerFeature(Mn,!1,"Gantt");class Pr extends xs{}Pr._$name="CalendarIntervalModel";class ve extends kr.derive(lr).mixin($s,Gs,Ms,_s,Ns){static get defaults(){return{expanded:!0}}static get defaultConfig(){return{projectConstraintIntervalClass:et,dateConstraintIntervalClass:Is,dependencyConstraintIntervalClass:Rs,taskModelClass:oe,dependencyModelClass:Rt,resourceModelClass:Pt,assignmentModelClass:fe,calendarModelClass:It,taskStoreClass:Ae,dependencyStoreClass:dn,resourceStoreClass:cn,assignmentStoreClass:on,calendarManagerStoreClass:ln,tasksData:null,eventsData:null,dependenciesData:null,resourcesData:null,assignmentsData:null,calendarsData:null,timeRangeStore:{modelClass:Kt,storeId:"timeRanges"},convertEmptyParentToLeaf:!1,supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/gantt/docs/api/Gantt/model/ProjectModel#config-supportShortSyncResponse)',delayCalculation:!0,eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},stmClass:Ps}}static get configurable(){return{tasks:null,resources:null,assignments:null,dependencies:null,timeRanges:null,calendars:null,timeRangesData:null,syncDataOnLoad:null,ignoreRemoteChangesInSTM:!1}}construct(...t){const e=t[0]||{};t[0]=e,"tasksData"in e&&(e.eventsData=e.tasksData,delete e.tasksData),"taskStore"in e&&(e.eventStore=e.taskStore,delete e.taskStore),e.eventModelClass=e.taskModelClass||e.eventModelClass||this.getDefaultConfiguration().taskModelClass||this.defaultEventModelClass,e.eventStoreClass=e.taskStoreClass||e.eventStoreClass||this.getDefaultConfiguration().taskStoreClass||this.defaultEventStoreClass,super.construct(...t)}attachStore(t){this.syncDataOnLoad&&(t.syncDataOnLoad=this.syncDataOnLoad),t.ion({name:t.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(t)}detachStore(t){t&&this.detachListeners(t.$$name),super.detachStore(t)}relayStoreChange(t){return super.relayStoreChange(t),this.trigger("change",{store:t.source,...t,source:this})}get defaultEventModelClass(){return oe}get defaultEventStoreClass(){return Ae}set taskStore(t){this.eventStore=t}get taskStore(){return this.eventStore}get timeRangeStore(){return this._timeRangeStore}set timeRangeStore(t){const e=this;e.detachStore(e._timeRangeStore),e._timeRangeStore=xe.getStore(t,xe),e._timeRangeStore.storeId||(e._timeRangeStore.storeId="timeRanges"),e.attachStore(e._timeRangeStore)}async tryInsertChild(){return this.tryPropagateWithChanges(()=>{this.insertChild(...arguments)})}toJSON(){return{eventsData:this.eventStore.toJSON(),resourcesData:this.resourceStore.toJSON(),dependenciesData:this.dependencyStore.toJSON(),assignmentsData:this.assignmentStore.toJSON()}}get json(){return super.json}set json(t){typeof t=="string"&&(t=$.safeJsonParse(t)),this.loadInlineData(t)}get tasks(){return this.taskStore.allRecords}updateTasks(t){this.taskStore.data=t}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(t){this.calendarManagerStore.data=t}updateTimeRangesData(t){this.timeRangeStore.data=t}get inlineData(){return this.toJSON()}set inlineData(t){this.json=t}afterChange(t,e){super.afterChange(...arguments),e.calendar&&this.trigger("calendarChange")}refreshWbs(t){var s;const e=this,n=(s=e.unfilteredChildren)!=null?s:e.children;if(n!=null&&n.length){var r;(r=n[0].refreshWbs)===null||r===void 0||r.call(e,t,-1)}}}v(ve,"$name","ProjectModel"),ve.applyConfigs=!0,ve._$name="ProjectModel";class In extends Ls(ve){}v(In,"$name","WebSocketProjectModel"),In._$name="WebSocketProjectModel";const Za=new Date().getFullYear(),ei=y.add(y.startOf(new Date(Za,0,5),"week"),1-y.weekStartDay,"day"),U=new ca;function B(l,t){return parseInt(""+l+t)}class Lr{static async generateAsync(t,e,n=null,r=ei,s=!0){const a={startDate:r,tasksData:[],dependenciesData:[]},i=Math.ceil(t/10),o=Math.ceil(e/10),d=this.generateBlocks(i,o,a.startDate);let c=0,u=0,g=0,m=0;s&&console.time("generate");for(const h of d)a.tasksData.push(...h.tasksData),a.dependenciesData.push(...h.dependenciesData),h.projectDuration&&(u=Math.max(h.projectDuration,u)),g+=h.taskCount,m+=h.dependencyCount,++c%1e3===0&&(n==null||n(g,m,!1),await ta.animationFrame());return n==null||n(g,m,!0),a.endDate=y.add(a.startDate,Math.max(u,30),"days"),s&&console.timeEnd("generate"),a}static*generateBlocks(t,e,n){let r=1,s=1,a=0,i=0,o=0,d=0,c=n,u=0;function g(D=!0,f=!1){const S=U.nextRandom(5)+2;return D&&(i+=S),f&&(o=0),o+=S,d=S,S}function m(D=d){return c=y.add(c,D,"days"),c}function h(){return y.add(c,d,"days")}function p(D){u=0;for(const f of D)u+=f.duration*f.percentDone;return D}for(let D=0;D<t;D++){const f=r,S={tasksData:[{id:r++,name:"Parent "+f,startDate:m(D>0?d:0),expanded:!0,inactive:!1,children:[{id:r++,name:"Sub-parent "+B(f,1),startDate:m(0),expanded:!0,inactive:!1,children:p([{id:r++,name:"Task "+B(f,11),startDate:m(0),duration:g(!0,!0),effort:d,effortUnit:"day",endDate:h(),percentDone:U.nextRandom(100),inactive:!1},{id:r++,name:"Task "+B(f,12),startDate:m(),duration:g(),effort:d,effortUnit:"day",endDate:h(),percentDone:U.nextRandom(100),inactive:!1},{id:r++,name:"Task "+B(f,13),startDate:m(),duration:g(),effort:d,effortUnit:"day",endDate:h(),percentDone:U.nextRandom(100),inactive:!1},{id:r++,name:"Task "+B(f,14),startDate:m(),duration:g(),effort:d,effortUnit:"day",endDate:h(),percentDone:U.nextRandom(100),inactive:!1}]),duration:o,effort:o,effortUnit:"day",percentDone:u/o,endDate:h()},{id:r++,name:"Sub-parent "+B(f,2),startDate:m(),expanded:!0,inactive:!1,children:p([{id:r++,name:"Task "+B(f,21),startDate:m(0),duration:g(!0,!0),effort:d,effortUnit:"day",endDate:h(),percentDone:U.nextRandom(100),inactive:!1},{id:r++,name:"Task "+B(f,22),startDate:m(),duration:g(),effort:d,effortUnit:"day",endDate:h(),percentDone:U.nextRandom(100),inactive:!1},{id:r++,name:"Task "+B(f,23),startDate:m(),duration:g(),effort:d,effortUnit:"day",endDate:h(),percentDone:U.nextRandom(100),inactive:!1}]),duration:o,effort:o,effortUnit:"day",percentDone:u/o,endDate:h()}],duration:i,effort:i,effortUnit:"day",endDate:h()}],dependenciesData:[{id:s++,fromEvent:f+2,toEvent:f+3},{id:s++,fromEvent:f+3,toEvent:f+4},{id:s++,fromEvent:f+4,toEvent:f+5},{id:s++,fromEvent:f+5,toEvent:f+7},{id:s++,fromEvent:f+7,toEvent:f+8},{id:s++,fromEvent:f+8,toEvent:f+9}],taskCount:10,dependencyCount:5},k=S.tasksData[0],w=k.children[0],ce=k.children[1];k.percentDone=(w.duration*w.percentDone+ce.duration*ce.percentDone)/k.duration,a+=i,i=0,S.projectDuration=a,D%e!==0?(S.dependenciesData.push({id:s++,fromEvent:f-2,toEvent:f+2,type:2,lag:0,lagUnit:"d"}),S.dependencyCount++):a=0,r++,yield S}}}Lr._$name="ProjectGenerator";const{defineParser:W,alt:De,seq:z,string:Ar,regexp:ye,succeed:Fr,red:F,isSuccess:ti}=ua,jr=W(F(ye("[^\\[\\,]+"),l=>({resourceName:l.trim(),units:100,match:l}))),Nt=W(F(ye("[0-9\\s]+"),l=>({value:l.split(/\s*/).join(""),match:l}))),Or=W(F(De(Ar("."),Ar(",")),l=>({value:l,match:l}))),Br=W(De(F(z(()=>Nt,()=>Or,()=>Nt),(l,t,e)=>({value:+`${l.value}.${e.value}`,match:[l.match,t.match,e.match].join("")})),F(z(()=>Or,()=>Nt),(l,t)=>({value:+`0.${t.value}`,match:[l.match,t.match].join("")})),F(()=>Nt,l=>({value:+`${l.value}`,match:l.match})))),ni=W(De(F(z(()=>Br,ye("\\s*\\%")),(l,t)=>({value:l.value,match:[l.match,t].join("")})),F(()=>Br,l=>({value:l.value,match:l.match})))),ri=W(F(z(ye("\\s*\\[\\s*"),()=>ni,ye("\\s*\\]")),(l,t,e)=>({units:t.value,match:[l,t.match,e].join("")}))),Vr=W(F(ye("\\s*,\\s*"),l=>({value:l,match:l}))),Rn=W(De(z(()=>jr,()=>ri,De(z(()=>Vr,()=>Rn),Fr(""))),z(()=>jr,De(z(()=>Vr,()=>Rn),Fr(""))))),Gr=l=>{let t=!1,e=[],n="";Rn(l,s=>{if(ti(s)){const[,a,i]=s;a.length>e.length&&(e=a,n=i,t=!0)}});let r=0;return t?{rest:n,assignments:e.reduce((s,a)=>{let i;return typeof a=="object"&&(Object.prototype.hasOwnProperty.call(a,"resourceName")?(i=Object.assign({position:r},a),s.push(i)):(i=s[s.length-1],Object.prototype.hasOwnProperty.call(a,"units")&&(i.units=a.units),i.match+=a.match),r+=a.match.length),s},[])}:!1},_r=(l,t=!1)=>{let e="";return l.assignments&&(e+=l.assignments.reduce((n,{resourceName:r,units:s,match:a})=>(a&&t?n+=a:n+=(n.length?", ":"")+`${r} [${s}%]`,n),e)),l.rest&&(e+=l.rest),t||(e=e.trim()),e},si=l=>_r(Gr(l));var ai={parse:Gr,compose:_r,normalize:si};const Nr=y.clearTime(new Date(1900,5,15)),Ur={minute:3,hour:5,day:7,week:9,month:11},ii={minute:1,hour:2,day:3,week:4,month:5},oi={finishnoearlierthan:6,finishnolaterthan:7,mustfinishon:3,muststarton:2,startnoearlierthan:4,startnolaterthan:5},li={FixedDuration:1,FixedUnits:0,FixedEffort:2,Normal:0},di={0:3,1:2,2:1,3:0},R=class extends $e{constructor(){super(...arguments);v(this,"resourceCalendar",new Map)}generateExportData(){const e=this;return e.tasks=e.collectProjectTasks(),{...e.getMsProjectConfig(),Calendars:{Calendar:e.getCalendarsData()},Tasks:{Task:e.getTasksData()},Resources:{Resource:e.getResourcesData()},Assignments:{Assignment:e.getAssignmentsData()}}}export(e={}){const n=this;if(!n.disabled&&(n.resourceCalendar.clear(),e=A.assign({},n.config,e),e.filename||(e.filename=`${n.client.$$name}.xml`),n.client.trigger("beforeMspExport",{config:e})!==!1)){const r=n.generateExportData(e);n.trigger("dataCollected",{config:e,data:r});const s=n.convertToXml(r),a={config:e,data:r,fileContent:s};n.client.trigger("mspExport",a),na.download(e.filename,`data:text/xml;charset=utf-8,${encodeURIComponent(a.fileContent)}`)}}convertToXml(e){return ga.convertFromObject(e,{rootName:"Project",elementName:"",xmlns:"http://schemas.microsoft.com/project",rootElementForArray:!1})}getMsProjectConfig(){const e=this,n=e.dateFormat,{project:r}=e.client,s=e.filename||e.client.$$name;return{CalendarUID:e.getCalendarUID(r.effectiveCalendar),CreationDate:y.format(new Date,n),SplitsInProgressTasks:0,MoveCompletedEndsBack:0,MoveRemainingStartsBack:0,MoveRemainingStartsForward:0,MoveCompletedEndsForward:0,NewTaskStartDate:0,DaysPerMonth:r.daysPerMonth,FinishDate:y.format(r.endDate,n),MinutesPerDay:r.hoursPerDay*60,MinutesPerWeek:r.daysPerWeek*r.hoursPerDay*60,Name:s,ScheduleFromStart:r.direction==="Forward"?1:0,StartDate:y.format(r.startDate,n),Title:s,WorkFormat:ii[r.effortUnit],ProjectExternallyEdited:0}}getCalendarsData(){const e=this,{calendarManagerStore:n,project:r}=e.client,{effectiveCalendar:s}=r,a=n.allRecords||[];return n.getByInternalId(s.internalId)||a.push(s),e.client.resources.forEach(i=>{const o=new i.effectiveCalendar.constructor({name:i.name});o.parent=i.effectiveCalendar,o.isResourceCalendar=!0,e.resourceCalendar.set(i,o),a.push(o)}),a.map(i=>{const o=e.getCalendarUID(i);let d=i.name||i.internalId,c=0,u=0;return i.isResourceCalendar?c=e.getCalendarUID(i.parent,0):(d+=" - imported",u=1),{ID:o,UID:o,BaseCalendarUID:c,IsBaseCalendar:u,Name:d,WeekDays:{WeekDay:e.formatWeekDays(i)}}})}formatWeekDays(e){const{timeFormat:n}=this,r=[],s={};let a=Nr,i;for(let c=0;c<7;c++){const u=a.getDay();s[u]={DayType:u+1,DayWorking:0},i=y.clearTime(y.add(a,1,"day")),r.push({startDate:a,endDate:i}),a=i}e=e.copy();const o=new e.constructor({intervals:r});return this.client.project.combineCalendars([e,o]).forEachAvailabilityInterval({startDate:Nr,endDate:i},(c,u,g)=>{const m=g.getCalendarsWorkStatus(),h=s[c.getDay()];m.get(e)&&(h.DayWorking=1,h.WorkingTimes=h.WorkingTimes||{WorkingTime:[]},h.WorkingTimes.WorkingTime.push({FromTime:y.format(c,n),ToTime:y.format(u,n)}))}),Object.values(s)}collectProjectTasks(){const e=[];return this.client.store.rootNode.traverse(n=>e.push(n),!0),e}getTasksData(){const e=this,{project:n}=e.client,r=n.direction=="Forward",{dateFormat:s,tasks:a}=e;return a.map(i=>{const{startDate:o,endDate:d,wbsCode:c}=i,u=i.predecessors.filter(({fromEvent:w})=>w),g=n.convertDuration(i.duration,i.durationUnit,"millisecond"),m=n.convertDuration(i.effort,i.effortUnit,"millisecond"),h=i.percentDone*.01*g,p=y.format(o,s),D=y.format(d,s),f=R.convertDurationToMspDuration(g,"ms"),S=e.getTaskUID(i),k={UID:S,Name:i.name,Active:e.inactive?0:1,Manual:i.manuallyScheduled?1:0,Type:i.isLeaf?li[i.schedulingMode]:1,IsNull:o&&d?0:1,WBS:c,OutlineNumber:c,OutlineLevel:c.split(".").length,Start:p,Finish:D,Duration:f,ManualStart:p,ManualFinish:D,ManualDuration:f,DurationFormat:Ur[i.durationUnit],Work:R.convertDurationToMspDuration(m,"ms"),EffortDriven:i.effortDriven?1:0,Estimated:0,Milestone:i.isMilestone?1:0,Summary:i.isLeaf?0:1,PercentComplete:Math.round(i.percentDone),ActualStart:p,ActualDuration:R.convertDurationToMspDuration(h,"ms"),RemainingDuration:R.convertDurationToMspDuration(g-h,"ms"),PredecessorLink:u.map(w=>({LagFormat:Ur[w.lagUnit],LinkLag:n.convertDuration(w.lag,w.lagUnit,"minute")*10,PredecessorUID:e.getTaskUID(w.fromEvent),Type:di[w.type]})),Baseline:i.baselines.map((w,ce)=>({Number:ce,Finish:y.format(w.endDate,s),Start:y.format(w.startDate,s),Duration:R.convertDurationToMspDuration(w.duration,w.durationUnit)})),IgnoreResourceCalendar:i.ignoreResourceCalendar?1:0,Rollup:i.rollup?1:0,ConstraintType:i.constraintType?oi[i.constraintType]:r?0:1,CalendarUID:e.getCalendarUID(i.calendar)};return i.constraintDate&&(k.ConstraintDate=y.format(i.constraintDate,s)),i.deadlineDate&&(k.Deadline=y.format(i.deadlineDate,s)),i.note&&(k.Notes=i.note),k})}getTaskUID(e){return e.internalId}getCalendarUID(e,n=-1){return e&&!e.isRoot?e.internalId:n}getResourcesData(){return this.client.resources.map(e=>({UID:e.internalId,Name:e.name,Type:1,MaxUnits:"1.00",PeakUnits:"1.00",CalendarUID:this.msProjectVersion===2013?null:this.getCalendarUID(this.resourceCalendar.get(e))}))}getAssignmentsData(){const e=[];if(this.msProjectVersion===2013)return e;const{project:n}=this.client;for(const r of this.tasks){const s=r.assigned,a=this.getTaskUID(r),i=Math.round(r.percentDone),o=y.format(r.startDate,this.dateFormat),d=y.format(r.endDate,this.dateFormat);if(s.size)for(const c of s){const u=n.convertDuration(c.effort,r.effortUnit,"millisecond"),g=n.convertDuration(c.actualEffort,r.effortUnit,"millisecond"),m=u-g;e.push({UpdateNeeded:0,UID:c.internalId,TaskUID:a,ResourceUID:c.resource.internalId,PercentWorkComplete:i,Work:R.convertDurationToMspDuration(u,"ms"),ActualWork:R.convertDurationToMspDuration(g,"ms"),RemainingWork:R.convertDurationToMspDuration(m,"ms"),Start:o,Finish:d,Units:c.units/100})}else{const c=n.convertDuration(r.effort,r.effortUnit,"millisecond"),u=c*i*.01,g=R.convertDurationToMspDuration(c,"ms");e.push({UID:lr._internalIdCounter++,TaskUID:a,ResourceUID:-65535,PercentWorkComplete:i,ActualWork:R.convertDurationToMspDuration(u,"ms"),RemainingWork:R.convertDurationToMspDuration(c-u,"ms"),Start:o,Finish:d,Units:1,Work:g})}}return e}static convertDurationToMspDuration(e,n){if(e==null)return"";const r=y.getDelta(y.as("ms",e,n),{ignoreLocale:!0,maxUnit:"hour"}),{hour:s=0,minute:a=0,second:i=0}=r;return`PT${s}H${a}M${i}S`}};let de=R;v(de,"$name","MspExport"),v(de,"configurable",{filename:null,dateFormat:"YYYY-MM-DDTHH:mm:ss",timeFormat:"HH:mm:ss",msProjectVersion:2019}),de._$name="MspExport",b.registerFeature(de,!1,"Gantt");const ci=/-/g;var Wr=l=>class extends(l||N){static get $name(){return"GanttDom"}resolveEventRecord(e){return this.resolveTaskRecord(e)}resolveTaskRecord(e){const n=e.closest(this.eventSelector);return n?this.store.getById(n.dataset.taskId):this.getRecordFromElement(e)}resolveRowRecord(e){return this.resolveTaskRecord(e)}onElementKeyDown(e){const n=this.resolveTaskRecord(e.target);super.onElementKeyDown(e),n&&this.trigger("taskKeyDown",{taskRecord:n,event:e})}onElementKeyUp(e){const n=this.resolveTaskRecord(e.target);super.onElementKeyUp(e),n&&this.trigger("taskKeyUp",{taskRecord:n,event:e})}getElementFromTaskRecord(e,n=!0){return this.taskRendering.getElementFromTaskRecord(e,n)}getElementFromEventRecord(e){return this.getElementFromTaskRecord(e)}getEventRenderId(e){return`${this.id.toString().replace(ci,"_")}-${e.id}`}getEventData(e){const n=this,r=n.resolveTimeSpanRecord(e.target);if(r){const s=n.getCell({record:r,column:n.timeAxisColumn}),a=ra.get(s),i=a.id,o=a.columnId;return{cellElement:s,cellData:a,columnId:o,id:i,record:r,cellSelector:{id:i,columnId:o}}}else return super.getEventData(e)}get widgetClass(){}},zr=l=>class extends(l||N){static get $name(){return"GanttRegions"}getScheduleRegion(e,n=!0,r){const s=this,{timeAxisSubGridElement:a,timeAxis:i}=s;let o;if(e){const D=s.getElementFromTaskRecord(e),f=s.getRowById(e.id);if(!f)return null;if(o=I.from(f.getElement("normal"),a),D){const S=I.from(D,a);o.y=S.y,o.bottom=S.bottom}else o.y+=s.barMargin,o.bottom-=s.barMargin}else o=I.from(a).moveTo(null,0),o.width=a.scrollWidth,o.y=o.y+s.barMargin,o.bottom=o.bottom-s.barMargin;const d=i.startDate,c=i.endDate,{start:u,end:g}=r||{};if(u&&g&&!i.timeSpanInAxis(u,g))return null;if(!u&&!g){var m;r=((m=s.getDateConstraints)===null||m===void 0?void 0:m.call(s,e))||{start:d,end:c}}let h=s.getCoordinateFromDate(r.start?y.max(d,r.start):d),p=s.getCoordinateFromDate(r.end?y.min(c,r.end):c);return n||(h=s.translateToPageCoordinate(h),p=s.translateToPageCoordinate(p)),o.x=Math.min(h,p),o.width=Math.max(h,p)-Math.min(h,p),o}translateToPageCoordinate(e){const n=this.timeAxisSubGridElement;return e+n.getBoundingClientRect().left-n.scrollLeft}isRowVisible(e){return this.store.indexOf(e)>=0}getTaskBox(e,n=!1,r=!1){return this.taskRendering.getTaskBox(...arguments)}getSizeAndPosition(){return this.taskRendering.getSizeAndPosition(...arguments)}get widgetClass(){}};const Hr={block:"nearest",edgeOffset:20};var qr=l=>class extends(l||N){static get $name(){return"GanttScroll"}scrollTaskIntoView(e,n=Hr){let r=e.startDate,s=e.endDate;const a=this;if(n.edgeOffset==null&&(n.edgeOffset=20),!e.isScheduled)return this.scrollRowIntoView(e,n);if(a.timeAxisSubGrid.collapsed)return;r=r||s,s=s||r;const i=r<a.timeAxis.startDate|(s>a.timeAxis.endDate)<<1;if(i&&n.extendTimeAxis!==!1){const d=a.timeAxis.endDate-a.timeAxis.startDate;let c,u;i===3?a.timeAxis.setTimeSpan(new Date(r.valueOf()-d/2),new Date(s.getTime()+d/2)):(c=a.getCoordinateFromDate(i&1?s:r),i&1?a.timeAxis.setTimeSpan(new Date(r),new Date(r.valueOf()+d)):a.timeAxis.setTimeSpan(new Date(s.valueOf()-d),new Date(s)),u=i&1?a.getCoordinateFromDate(s):a.getCoordinateFromDate(r),a.timeAxisSubGrid.scrollable.scrollBy(u-c))}const o=a.getElementFromTaskRecord(e);return o?a.timeAxisSubGrid.scrollable.scrollIntoView(o,n):a.scrollUnrenderedTaskIntoView(e,n)}scrollUnrenderedTaskIntoView(e,n=Hr){n.edgeOffset==null&&(n.edgeOffset=20);const r=this,s=r.timeAxisSubGrid.scrollable,a=r.getTaskBox(e),i=s.viewport,o=a.translate(i.x-s.x,i.y-s.y);let d=s.scrollIntoView(o,Object.assign({},n,{highlight:!1}));if(n.highlight||n.focus){const c=r.ion({renderTask({taskRecord:u,element:g}){u===e&&(c(),d=d.then(()=>{n.highlight&&q.highlight(g),n.focus&&g.focus()}))}})}else d=Promise.all([d,new Promise(c=>{const u=r.ion({renderTask({taskRecord:g}){g===e&&(u(),c())}})})]);return d}get widgetClass(){}},Kr=l=>class extends(l||N){static get $name(){return"GanttState"}updateProject(e,n){super.updateProject(e,n),this.detachListeners("suspendStateDuringDelayedCalculation"),e!=null&&e.delayCalculation&&e.ion({name:"suspendStateDuringDelayedCalculation",delayCalculationStart:{fn:"suspendStateListener",prio:10},delayCalculationEnd:{fn:"resumeStateListener",prio:-10},thisObj:this})}suspendStateListener(){this.stateListenerSuspended=(this.stateListenerSuspended||0)+1}resumeStateListener(){const e=this;e.stateListenerSuspended=(e.stateListenerSuspended||1)-1,!e.stateListenerSuspended&&e.isSaveStatePending&&e.saveState({immediate:!0})}saveState(...e){if(!this.stateListenerSuspended)return super.saveState(...e)}applyState(e){var n,r;const s=this;if(!s.project.isInitialCommitPerformed&&((n=e.store)!==null&&n!==void 0&&n.sorters||(r=e.store)!==null&&r!==void 0&&r.filters)){const i=e.store;s.project.commitAsync().then(()=>{s.isDestroyed||(s.suspendRefresh(),s.store.state=i,s.resumeRefresh(!0))}),delete e.store}const a=["selectedCell","selectedRecords"];if(a.some(i=>i in e)){const i={};a.forEach(o=>{o in e&&(i[o]=e[o],delete e[o])}),s._applyStateAfterPaint=()=>{s._applyStateAfterPaint=null,s.suspendRefresh(),Object.keys(i).forEach(o=>s[o]=i[o]),s.resumeRefresh(!0)}}super.applyState(e)}get widgetClass(){}onPaint(...e){super.onPaint(...e);const n=this;n._applyStateAfterPaint&&(n.project.isInitialCommitPerformed?n._applyStateAfterPaint():n.project.ion({commitFinalized(){n._applyStateAfterPaint()},thisObj:n,once:!0}))}},Xr=l=>class extends xa(l||N){static get $name(){return"GanttStores"}static get projectStores(){return{calendarManagerStore:{},resourceStore:{dataName:"resources"},eventStore:{dataName:"events"},assignmentStore:{dataName:"assignments"},dependencyStore:{dataName:"dependencies"}}}static get configurable(){return{projectModelClass:ve,tasks:null,taskStore:null}}updateProject(e,n){super.updateProject(e,n),this.detachListeners("ganttStores"),this.bindCrudManager(e),e==null||e.ion({name:"ganttStores",refresh:"internalOnProjectRefresh",thisObj:this})}get replica(){return this.project.replica}internalOnProjectRefresh({isInitialCommit:e,isCalculated:n}){const r=this,{project:s,visibleDate:a={}}=r;if(r.isPainted){if(!r.appliedViewStartDate&&!("startDate"in r.initialConfig)&&s.startDate){const i=a==null?void 0:a.date,{startDate:o,endDate:d}=s,c=i?y.min(o,i):o,u=i?d?y.max(d,i):y.add(c,r.visibleDateRange.endDate-r.visibleDateRange.startDate):d;c&&u&&(r.setTimeSpan(c,u,{...a,visibleDate:i}),r.appliedViewStartDate=!0)}!e&&n?r.refreshWithTransition():r.refresh(),r.trigger("projectRefresh",{isInitialCommit:e,isCalculated:n})}}get timeRanges(){return this.project.timeRanges}set timeRanges(e){this.project.timeRanges=e}get calendars(){return this.project.calendars}set calendars(e){this.project.calendars=e}get usesDisplayStore(){return this.store!==this.taskStore}get tasks(){return this.project.eventStore.allRecords}changeTasks(e){const{project:n}=this;this.buildingProjectConfig?n.eventsData=e:n.eventStore.data=e}changeTaskStore(e){const{project:n}=this;if(this.buildingProjectConfig){n.eventStore=e;return}return this.initializingProject||n.eventStore!==e&&(n.setEventStore(e),e=n.eventStore),e}updateEventStore(e){const n=this;e.metaMapId=n.id,n.taskStore=n.store=e}bindStore(e){super.bindStore(e),this.timeAxisViewModel.store=e,this.detachListeners("storeBatchedUpdateListener"),e.ion({name:"storeBatchedUpdateListener",batchedUpdate:"onEventStoreBatchedUpdate",thisObj:this})}onEventStoreBatchedUpdate(e){const n=this;if(n.listenToBatchedUpdates){const r=n.enableEventAnimations;n.enableEventAnimations=!1,n.onStoreUpdateRecord(e),n.enableEventAnimations=r}}get widgetClass(){}},Jr=l=>class extends(l||N){static get $name(){return"GanttTimelineDateMapper"}getDisplayEndDate(e,n){return e}get widgetClass(){}};const ui={animate:100};var Yr=l=>class extends(l||N){static get $name(){return"TaskNavigation"}static get defaultConfig(){return{navigator:{inlineFlow:!1,prevKey:"ArrowUp",nextKey:"ArrowDown",keys:{Enter:"onTaskEnterKey"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:0,ArrowRight:0}}}processEvent(e){const n=this,r=e.target.closest(n.eventSelector);return!n.navigator.disabled&&r&&(e.taskRecord=e.eventRecord=n.resolveTaskRecord(r)),e}normalizeTarget(e){return e.taskRecord}onElementMouseDown(e){const n=this,{_focusedCell:r}=n,s=e.target.closest(n.navigator.itemSelector),a=s&&s===(r==null?void 0:r.target);if(super.onElementMouseDown(e),a&&n.lastNavigationEvent!==e){var i;(i=n.onCellNavigate)===null||i===void 0||i.call(n,n,r,r,!0),n.lastNavigationEvent=e}}selectEvent(e,n=!1){this.isSelected(e)||this.selectRow({record:e.id,column:!1,addToSelection:n})}deselectEvent(e){this.deselectRow(e.id)}getNext(e){const n=this,{store:r}=n;for(let s=r.indexOf(e)+1;s<r.count;s++){const a=r.getAt(s);if(n.isInTimeAxis(a))return a}}getPrevious(e){const n=this,{store:r}=n;for(let s=r.indexOf(e)-1;s>=0;s--){const a=r.getAt(s);if(n.isInTimeAxis(a))return a}}set activeEvent(e){this.navigator.activeItem=this.getElementFromTaskRecord(e,!1)}get activeEvent(){const{activeItem:e}=this.navigator;if(e)return this.resolveTaskRecord(e)}async navigateTo(e,{scrollIntoView:n=!0,uiEvent:r={}}){const s=this,{navigator:a}=s,{skipScrollIntoView:i}=a;e&&(n?(a.disabled=!0,await s.scrollTaskIntoView(e,ui),a.disabled=!1):a.skipScrollIntoView=!0,s.isDestroyed||(s.activeEvent=e,a.skipScrollIntoView=i,a.trigger("navigate",{event:r,item:s.getElementFromTaskRecord(e,!1)})))}clearEventSelection(){this.deselectAll()}onTaskEnterKey(){}onDeleteKey(e){const n=e.eventRecord;!this.readOnly&&this.enableDeleteKey&&n&&this.removeEvents([n])}onGridBodyFocusIn(e){if(this.timeAxisSubGridElement.contains(e.target)){const r=this,{navigationEvent:s}=r,{target:a}=e,i=a.closest(r.navigator.itemSelector),o=i?r.resolveTaskRecord(a):r.getRecordFromElement(a),d=r.normalizeCellContext({rowIndex:r.store.indexOf(o),column:r.timeAxisColumn,target:a});if(i){if(r.lastNavigationEvent!==s){var n;const{_focusedCell:c}=r;r._focusedCell=d,(n=r.onCellNavigate)===null||n===void 0||n.call(r,r,c,d,!0),r.lastNavigationEvent=s}return}r.navigateTo(o,{scrollIntoView:(s==null?void 0:s.type)!=="mousedown",uiEvent:s});return}super.onGridBodyFocusIn(e)}get widgetClass(){}};const gi={releaseElement:1,reuseElement:1},hi={newElement:1,reuseOwnElement:1,reuseElement:1};class Pn extends N{static get properties(){return{rowMap:new Map}}construct(t){this.gantt=t,t.rowManager.ion({renderDone:"onRenderDone",removeRows:"onRemoveRows",beforeRowHeight:"onBeforeRowHeightChange",renderRow:"onRenderRow",thisObj:this}),super.construct({})}init(){}refreshRows(){}onTimeAxisViewModelUpdate(){this.updateFromHorizontalScroll(this.gantt.timeAxisSubGrid.scrollable.x)}onViewportResize(){}onDragAbort(){}onBeforeRowHeightChange(t){var n;const{gantt:e}=this;e.foregroundCanvas&&(e.foregroundCanvas.style.fontSize=`${((n=t==null?void 0:t.height)!=null?n:e.rowHeight)-e.resourceMargin*2}px`)}get visibleDateRange(){return this._visibleDateRange}getTaskBox(t,e=!1,n=!1){const{gantt:r}=this,{isBatchUpdating:s}=t,{store:a}=r,i=s?t.get("startDate"):t.startDate,o=s?t.get("endDate"):t.endDate;if(n){const p=this.getElementFromTaskRecord(t);if(p)return I.from(p,r.timeAxisSubGridElement)}if(!i||!o||t.isTask&&(a.isDestroyed||!a.isAvailable(t)))return null;const d=this.getSizeAndPosition(t,e,n);if(!d)return null;const{position:c,width:u}=d,g=r.rowManager.calculateTop(a.indexOf(t.isBaseline?t.task:t))+r.resourceMargin,m=r.rowHeight-r.resourceMargin*2,h=new I(c,g,u,m);return h.layout=!0,h}getSizeAndPosition(t,e,n){var r;const s=this,{gantt:a}=s,{timeAxis:i}=a,o=i.startDate,d=i.endDate,c=t.milestone,u=c?(r=a.features.dependencies.pathFinder)===null||r===void 0?void 0:r.startArrowMargin:0;let g=t.isBatchUpdating?t.get("startDate"):t.startDate,m=t.isBatchUpdating?t.get("endDate"):t.endDate||(t.duration!=null?y.add(g,t.duration,t.durationUnit):null),h,p;if(!e&&(m<o||g>d))return null;if(e&&g<o)h=a.getCoordinateFromDate(o)-u;else if(e&&g>d)h=a.getCoordinateFromDate(d)+u;else if(g<o){const f=a.timeAxisViewModel.getSingleUnitInPixels("second"),S=(i.startMS-t.startDateMS)/1e3,k=S*f;h=a.getCoordinateFromDate(o)-k}else a.fillTicks&&!c&&(!t.isBatchUpdating||a.snap)&&(g=i.getSnappedTickFromDate(g).startDate),h=a.getCoordinateFromDate(g);if(!c)if(e&&m<o)p=a.getCoordinateFromDate(o);else if(e&&m>d)p=a.getCoordinateFromDate(d);else if(m>d){const f=a.timeAxisViewModel.getSingleUnitInPixels("second"),S=(t.endDateMS-i.endMS)/1e3,k=S*f;p=a.getCoordinateFromDate(d)+k}else{if(a.fillTicks&&(!t.isBatchUpdating||a.snap)){const f=Math.ceil(a.timeAxis.getTickFromDate(m))-1;m=a.timeAxis.getAt(f).endDate}p=a.getCoordinateFromDate(m)}let D=c?0:Math.abs(h-p);return n&&c&&g>o&&g<d&&(D=a.rowHeight-a.resourceMargin*2,h-=D/2),!e&&h+D<0?null:{position:h,width:D}}getRowRegion(t,e,n){const{gantt:r}=this,s=r.getRowFor(t);if(!s)return null;const a=s.getElement(r.timeAxisSubGrid.region),i=r.timeAxis.startDate,o=r.timeAxis.endDate,d=e?y.max(i,e):i,c=n?y.min(o,n):o,u=r.getCoordinateFromDate(d),g=r.getCoordinateFromDate(c,!0,!0),m=s.top+r.scrollTop,h=Math.min(u,g),p=m+a.offsetHeight;return new I(h,m,Math.max(u,g)-h,p-m)}getDateFromXY(t,e,n){let r=t[0];return n||(r=this.translateToScheduleCoordinate(r)),this.gantt.timeAxisViewModel.getDateFromPosition(r,e)}translateToScheduleCoordinate(t){return t-Math.floor(this.gantt.timeAxisSubGridElement.getBoundingClientRect().left)+this.gantt.scrollLeft}translateToPageCoordinate(t){const e=this.gantt.timeAxisSubGridElement;return t+e.getBoundingClientRect().left-e.scrollLeft}getElementFromTaskRecord(t,e=!0){var n;const{syncIdMap:r}=this.gantt.foregroundCanvas;let s=r==null?void 0:r[t.id];return!s&&t.hasLinks&&r&&t.forEachLinked((a,i)=>{r[i.id]&&(s=r[i.id])}),e?(n=s)===null||n===void 0?void 0:n.syncIdMap.task:s}getConnectorStartSide(t){return this.gantt.rtl?"right":"left"}getConnectorEndSide(t){return this.gantt.rtl?"left":"right"}onRenderRow({row:t,record:e}){t.assignCls({"b-inactive":e.inactive})}onRemoveRows({rows:t}){t.forEach(e=>this.rowMap.delete(e)),!this.gantt.refreshSuspended&&this.onRenderDone()}updateFromHorizontalScroll(t){const e=this,{gantt:n}=e,{timeAxisSubGrid:r,timeAxis:s,rtl:a}=n,{width:i}=r,{totalSize:o}=n.timeAxisViewModel,d=t,c=r.scrollable.maxX!==0&&Math.abs(r.scrollable.maxX)<=Math.round(d)+5,u=n.getDateFromCoord({coord:Math.max(0,d),ignoreRTL:!0}),g=c?s.endDate:n.getDateFromCoord({coord:d+i,ignoreRTL:!0})||s.endDate;if(u&&!n._viewPresetChanging){e._visibleDateRange={startDate:u,endDate:g,startMS:u.getTime(),endMS:g.getTime()},e.viewportCoords=a?{left:o-t-i,right:o-t}:{left:t,right:t+i};const m=n.timeView.range={startDate:u,endDate:g};n.onVisibleDateRangeChange(m)}}internalPopulateTaskRenderData(t,e){const{gantt:n}=this,r={className:"b-gantt-task-content",dataset:{taskBarFeature:"content"},children:[]};if(t){var s;let a=e.isResizable===void 0?!0:e.isResizable;t.startsOutsideView&&(a===!0?a="end":a==="start"&&(a=!1)),t.endsOutsideView&&(a===!0?a="start":a==="end"&&(a=!1)),Object.assign(t,{iconCls:new X(e.taskIconCls),id:n.getEventRenderId(e),style:e.style||"",taskId:e.id,wrapperCls:new X({[n.eventCls+"-wrap"]:1,[`${n.eventCls}-parent`]:e.isParent,"b-milestone-wrap":e.milestone,"b-inactive":e.inactive,"b-expanded":e.isExpanded(n.store),"b-readonly":e.readOnly,"b-linked":e.isLinked,"b-original":e.hasLinks,"b-temporary":!e.project}),cls:e.isResourceTimeRange?new X:e.cls.clone(),extraConfigs:[]}),Object.assign(t.cls,{[n.eventCls]:1,[n.generatedIdCls]:e.hasGeneratedId,[n.dirtyCls]:e.modifications,[n.committingCls]:e.isCommitting,[n.endsOutsideViewCls]:t.endsOutsideView,[n.startsOutsideViewCls]:t.startsOutsideView,[n.fixedEventCls]:e.isDraggable===!1,[`b-sch-event-resizable-${a}`]:1,"b-milestone":e.milestone,"b-task-started":e.isStarted,"b-task-finished":e.isCompleted,"b-task-selected":n.selectedRecords.includes(e)});const i=e.eventStyle||n.eventStyle,o=e.eventColor||n.eventColor;if(t.eventColor=o,t.eventStyle=i,n.taskRenderer){const d=n.taskRenderer.call(n.taskRendererThisObj||n,{taskRecord:e,renderData:t});typeof t.cls=="string"&&(t.cls=new X(t.cls)),typeof t.iconCls=="string"&&(t.iconCls=new X(t.iconCls)),typeof t.wrapperCls=="string"&&(t.wrapperCls=new X(t.wrapperCls));let c=null;$.isHtml(d)?c={tag:"span",html:d}:typeof d=="string"||typeof d=="object"?c=d:d!=null&&(c=String(d)),c&&(Array.isArray(c)?r.children.push(...c):r.children.push(c),t.cls.add("b-has-content"))}if(t.cls["b-sch-event-withicon"]=t.iconCls.length,t.wrapperCls[`b-sch-style-${t.eventStyle}`]=t.eventStyle,q.isNamedColor(t.eventColor))t.wrapperCls[`b-sch-color-${t.eventColor}`]=t.eventColor;else if(t.eventColor){const d=`background-color:${t.eventColor};`;t.style=d+t.style,t.wrapperCls["b-sch-custom-color"]=1,t._customColorStyle=d}else t.wrapperCls["b-sch-color-none"]=1;t.style&&e.isMilestone&&r&&(r.style=t.style,delete t.style),(s=t.iconCls)!==null&&s!==void 0&&s.length&&r.children.unshift({tag:"i",className:t.iconCls}),(r.children.length||e.milestone)&&t.children.push(r)}t.taskContent=r,t.wrapperChildren=[]}populateTaskRenderData(t,e){this.internalPopulateTaskRenderData(...arguments),this.gantt.onTaskDataGenerated(t)}getTaskRenderData(t,e){const n=this,r=n.getTaskBox(e,!1,!1,t),s={taskRecord:e,task:e,row:t,children:[]};return r?Object.assign(s,{isTask:!0,top:r.top,left:r.left,width:r.width,height:r.height}):s.top=t.top+n.gantt.resourceMargin,n.populateTaskRenderData(s,e),s}getTaskDOMConfig(t){return{className:t.wrapperCls,tabIndex:"0",children:[{className:t.cls,style:(t.internalStyle||"")+(t.style||""),children:t.children,dataset:{taskFeature:"task"},syncOptions:{syncIdField:"taskBarFeature"}},...t.wrapperChildren],style:{top:t.top,left:t.left-(this.gantt.rtl?t.width:0),width:t.width,zIndex:t.zIndex},dataset:{taskId:t.taskId},elementData:t,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}}}renderer({row:t,record:e}){const n=this,r=n.getTaskRenderData(t,e);let s;if(r.isTask)s=n.getTaskDOMConfig(r),n.gantt.trigger("beforeRenderTask",{renderData:r,domConfig:s});else if(r.extraConfigs.length===0){n.rowMap.delete(t);return}n.rowMap.set(t,[s,...r.extraConfigs])}onRenderDone(){const{gantt:t}=this,e=Array.from(this.rowMap.values()).flat();t.onBeforeTaskSync(e),Ye.sync({domConfig:{onlyChildren:!0,children:e},targetElement:t.foregroundCanvas,syncIdField:"taskId",callback({action:n,domConfig:r,lastDomConfig:s,targetElement:a}){if(n!=="none"&&r&&r.className&&r.className[t.eventCls+"-wrap"]){var i,o;const d=gi[n],c=hi[n];if(d&&s!==null&&s!==void 0&&(i=s.elementData)!==null&&i!==void 0&&i.isTask){const u={renderData:s.elementData,taskRecord:s.elementData.taskRecord,element:a};t.trigger("releaseTask",u)}if(c&&r!==null&&r!==void 0&&(o=r.elementData)!==null&&o!==void 0&&o.isTask){const u={renderData:r.elementData,taskRecord:r.elementData.taskRecord,element:a};u.reusingElement=n==="reuseElement",t.trigger("renderTask",u)}}}})}redraw(t){this.gantt.rowManager.refreshCell(t,this.gantt.timeAxisColumn.id)&&this.onRenderDone()}}Pn._$name="NewTaskRendering";const mi=Object.freeze({});let fi=0;class Ce extends $a.mixin(Us,Wr,zr,qr,Xr,Kr,Jr,Ma,Yr,As,Fs,Ia,Ra){constructor(){super(...arguments);v(this,"timeCellSelector",".b-sch-timeaxis-cell")}static get type(){return"ganttbase"}static get defaultConfig(){return{project:null,resourceImageFolderPath:null,defaultResourceImageName:null,toggleParentTasksOnClick:!0,scrollTaskIntoViewOnCellClick:!1,calendars:null,resources:null,tasks:null,dependencies:null,assignments:null,eventCls:"b-gantt-task",eventBarTextField:null,eventLayout:"none",eventSelectionDisable:!0,eventColor:null,eventStyle:null,rowHeight:45,scheduledEventName:"task",eventScrollMode:"move",overScheduledEventClass:"b-gantt-task-hover",mode:"horizontal",timeCellCls:"b-sch-timeaxis-cell",focusCls:"b-active",taskRenderer:null,newTaskDefaults:{},dependencyIdField:"id",getDateConstraints:null,showTaskColorPickers:null}}get isGantt(){return!0}construct(e={}){const n=this,r=!!(e.calendars||e.taskStore||e.dependencyStore||e.resourceStore||e.assignmentStore),s=!!(e.calendars||e.tasks||e.dependencies||e.resources||e.assignments);if(!e.features){const i=n.getDefaultConfiguration().features;e.features=i&&typeof i=="object"?i:{}}"tree"in e.features||(e.features.tree=!0),"group"in e.features||(e.features.group=!1);const{project:a}=e;if(a&&(r||s))throw new Error("Providing both project and inline data is not supported");a!=null&&a.isModel||(e.project=A.assign({calendarsData:e.calendars,eventsData:e.tasks,dependenciesData:e.dependencies,resourcesData:e.resources,assignmentsData:e.assignments,resourceStore:e.resourceStore,eventStore:e.taskStore,assignmentStore:e.assignmentStore,dependencyStore:e.dependencyStore,timeRangeStore:e.timeRangeStore},a),delete e.resourceStore,delete e.taskStore,delete e.assignmentStore,delete e.dependencyStore,delete e.timeRangeStore,delete e.calendars,delete e.resources,delete e.tasks,delete e.assignments,delete e.dependencies),super.construct(e),n.ion({taskclick:"onTaskBarClick",cellClick:"onNonTimeAxisCellClick",toggleNode:"onToggleParentNode"})}changeColumns(e,n){if(e){let r=e;Array.isArray(e)||(r=e.data,this._thisIsAUsedExpression(this.taskStore)),r.some(s=>{const a=s instanceof P?s.constructor:C.getColumnClass(s.type)||P;return a===me||a.prototype instanceof me})||r.unshift({type:"name"})}return super.changeColumns(e,n)}set timeAxisViewModel(e){super.timeAxisViewModel=e,this.store&&(this.timeAxisViewModel.store=this.store)}get timeAxisViewModel(){return super.timeAxisViewModel}onPaintOverride(){}resumeRefresh(e){super.resumeRefresh(!1),!this.refreshSuspended&&e&&this.isPainted&&(this.rowManager.topRow?this.refreshWithTransition():this.rowManager.reinitialize())}onStoreUpdateRecord(e){if(!this.project.isBatchingChanges){let n;return this.runWithTransition(()=>{n=super.onStoreUpdateRecord(e)},!this.refreshSuspended),n}}onStoreDataChange(e){this.runWithTransition(()=>{super.onStoreDataChange(e)},e.action==="batch")}onTaskDataGenerated(){}onBeforeTaskSync(){}onTaskBarClick({taskRecord:e}){this.toggleParentTasksOnClick&&!e.isLeaf&&this.toggleCollapse(e)}onNonTimeAxisCellClick({record:e,column:n}){const{scrollTaskIntoViewOnCellClick:r}=this;n.type!=="timeAxis"&&r&&e.isScheduled&&this.scrollTaskIntoView(e,r===!0?{animate:!0,block:"center",y:!1}:r)}onToggleParentNode({record:e}){e.parent.isExpanded(this.taskStore)&&this.taskRendering.redraw(e)}afterSelectionChange({selectedRecords:e,deselectedRecords:n}){const r=this;function s(a,i){const o=r.getElementFromTaskRecord(a);o&&Ye[i?"addCls":"removeCls"]("b-task-selected",o)}e==null||e.map(a=>s(a,!0)),n==null||n.map(a=>s(a,!1))}toggleEmptyText(){const e=this;e.bodyContainer&&e.rowManager&&q.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.project.isLoadingOrSyncing))}get currentOrientation(){const e=this;return e._currentOrientation||(e.taskRendering=e._currentOrientation=new Pn(e)),e._currentOrientation}getTimeSpanMouseEventParams(e,n){const r=this.resolveTaskRecord(e);return r?{taskRecord:r,taskElement:e,event:n}:null}getScheduleMouseEventParams(e){return{taskRecord:this.store.getById(e.id)}}resolveTimeSpanRecord(e){return this.resolveTaskRecord(e)}repaintEventsForResource(e){this.taskRendering.redraw(e)}get visibleResources(){var e,n;return{first:this.store.getById((e=this.firstVisibleRow)===null||e===void 0?void 0:e.id),last:this.store.getById((n=this.lastVisibleRow)===null||n===void 0?void 0:n.id)}}populateTaskMenu(){}async addTask(e,n=mi){const r=this,{milestone:s,asPredecessor:a,asSuccessor:i}=n,o=r.project,d=e.parent,c=typeof r.newTaskDefaults=="function"?r.newTaskDefaults(e):r.newTaskDefaults,u=r.taskStore.modelClass.new({startDate:e.startDate,duration:e.duration,durationUnit:e.durationUnit},c,n.data);return r.trigger("beforeTaskAdd",{taskRecord:u}),u.name||(u.name=`${r.L(s?"L{Gantt.New milestone}":"L{Gantt.New task}")} ${++fi}`),o.suspendChangesTracking(),n.asChild?e.insertChild(u,n.at==="end"?null:e.firstChild):n.above?d.insertChild(u,e):d.insertChild(u,e.nextSibling),o.resumeChangesTracking(!0),s?(await o.commitAsync(),await u.convertToMilestone()):await o.commitAsync(),i?r.dependencyStore.add({fromEvent:e,toEvent:u,type:j.EndToStart,fromSide:"right",toSide:"left"}):a&&r.dependencyStore.add({fromEvent:u,toEvent:e,type:j.EndToStart,fromSide:"right",toSide:"left"}),(i||a)&&await o.commitAsync(),u}addTaskAbove(e,n){return this.addTask(e,{...n,above:!0})}addTaskBelow(e,n){return this.addTask(e,n)}addMilestoneBelow(e,n){return this.addTask(e,{...n,milestone:!0})}addSubtask(e,n){const r=this.addTask(e,{...n,asChild:!0});return this.toggleCollapse(e,!1),r}addSuccessor(e,n){return this.addTask(e,{...n,asSuccessor:!0})}addPredecessor(e,n){return this.addTask(e,{...n,above:!0,asPredecessor:!0})}async indent(e){const n=this;if(n.isTreeGrouped)return;(!e||e instanceof Event)&&(e=n.selectedRecords),await this.project.commitAsync();const r=await n.taskStore.indent(e);return r||dr.show({rootElement:n.rootElement,html:n.L("L{Gantt.changeRejected}")}),r}async outdent(e){const n=this;if(n.isTreeGrouped)return;(!e||e instanceof Event)&&(e=n.selectedRecords),await this.project.commitAsync();const r=await n.taskStore.outdent(e);return r||dr.show({rootElement:n.rootElement,html:n.L("L{Gantt.changeRejected}")}),r}onElementKeyDown(e){super.onElementKeyDown(e)}onElementKeyUp(e){super.onElementKeyUp(e)}onElementMouseOver(e){super.onElementMouseOver(e)}onElementMouseOut(e){super.onElementMouseOut(e)}}v(Ce,"$name","GanttBase"),v(Ce,"configurable",{keyMap:{"Alt+Shift+ArrowLeft":"outdent","Alt+Shift+ArrowRight":"indent"}}),Ce.initClass(),ir.setVersion("gantt","5.5.0"),Ce._$name="GanttBase";class Ln extends Ce{static get $name(){return"Gantt"}static get type(){return"gantt"}}Ln.initClass(),Ln._$name="Gantt";export{tt as AddNewColumn,_a as AllColumns,Ct as AssignmentField,Dt as AssignmentGrid,fe as AssignmentModel,yt as AssignmentPicker,on as AssignmentStore,ae as AssignmentsManipulationStore,Lt as Baseline,ee as BaselineDurationColumn,te as BaselineDurationVarianceColumn,Z as BaselineEndDateColumn,re as BaselineEndVarianceColumn,Q as BaselineStartDateColumn,ne as BaselineStartVarianceColumn,Ft as Baselines,rt as CalendarColumn,Pr as CalendarIntervalModel,ln as CalendarManagerStore,It as CalendarModel,nt as CalendarPicker,hn as CellEdit,gr as ConstrainedByParentMixin,Ze as ConstrainedLateEventMixin,st as ConstraintDateColumn,at as ConstraintTypeColumn,mn as CriticalPaths,it as DeadlineDateColumn,Fe as Dependencies,Pe as DependencyColumn,O as DependencyField,Rt as DependencyModel,dn as DependencyStore,hr as DisableManuallyScheduledConflictResolution,ot as EarlyEndDateColumn,lt as EarlyStartDateColumn,dt as EffortColumn,ct as EndDateColumn,sn as EventModeColumn,vr as FixedEffortMixin,br as FixedUnitsMixin,Ln as Gantt,Ce as GanttBase,M as GanttDateColumn,Wr as GanttDom,en as GanttEvent,kr as GanttProjectMixin,zr as GanttRegions,qr as GanttScroll,Kr as GanttState,Xr as GanttStores,Jr as GanttTimelineDateMapper,wr as HasCriticalPathsMixin,se as IgnoreResourceCalendarColumn,ut as InactiveColumn,pn as Indicators,vn as Labels,gt as LateEndDateColumn,ht as LateStartDateColumn,mt as ManuallyScheduledColumn,Me as ManuallyScheduledParentConstraintInterval,mr as ManuallyScheduledParentConstraintIntervalDescription,Re as MilestoneColumn,de as MspExport,kn as MultiPageExporter,xn as MultiPageVerticalExporter,me as NameColumn,Pn as NewTaskRendering,ft as NoteColumn,je as ParentArea,Mn as PdfExport,pt as PercentDoneColumn,vt as PredecessorColumn,Dn as ProgressLine,et as ProjectConstraintInterval,xr as ProjectConstraintIntervalDescription,Lr as ProjectGenerator,yn as ProjectLines,ve as ProjectModel,St as ResourceAssignmentColumn,rn as ResourceAssignmentGridResourceColumn,ai as ResourceAssignmentParser,Pt as ResourceModel,cn as ResourceStore,bt as RollupColumn,Cn as Rollups,Qt as ScheduledByDependenciesLateEventMixin,ie as SchedulingDirectionColumn,Et as SchedulingModeColumn,Tt as SequenceColumn,wt as ShowInTimelineColumn,$n as SinglePageExporter,kt as StartDateColumn,xt as SuccessorColumn,Sn as Summary,pe as TaskCopyPaste,jt as TaskDrag,bn as TaskDragCreate,Bt as TaskEdit,Ot as TaskEditor,Vt as TaskMenu,oe as TaskModel,Yr as TaskNavigation,le as TaskNonWorkingTime,En as TaskResize,Gt as TaskSegmentDrag,_t as TaskSegmentResize,Ae as TaskStore,Tn as TaskTooltip,an as TimeAxisColumn,$t as TotalSlackColumn,Be as TreeGroup,Ve as Versions,Mt as WBSColumn,At as WbsField,In as WebSocketProjectModel,pr as fixedEffortSEDWUBackward,fr as fixedEffortSEDWUForward,Zt as fixedEffortSEDWUGraphDescription,Sr as fixedUnitsSEDWUBackwardEffortDriven,Cr as fixedUnitsSEDWUBackwardNonEffortDriven,yr as fixedUnitsSEDWUForwardEffortDriven,Dr as fixedUnitsSEDWUForwardNonEffortDriven,Ie as fixedUnitsSEDWUGraphDescription};
//# sourceMappingURL=gantt.module.thin.js.map
