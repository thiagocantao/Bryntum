{"version":3,"file":"Splitter.js","sources":["../../../../Core/lib/Core/widget/Splitter.js"],"sourcesContent":["import Widget from './Widget.js';\nimport DomHelper from '../helper/DomHelper.js';\nimport EventHelper from '../helper/EventHelper.js';\nimport BrowserHelper from '../helper/BrowserHelper.js';\n\n/**\n * @module Core/widget/Splitter\n */\n\nconst\n    classesHV = ['b-horizontal', 'b-vertical'],\n    hasFlex = el => DomHelper.getStyleValue(el.parentElement, 'display') === 'flex' &&\n        (parseInt(DomHelper.getStyleValue(el, 'flex-basis'), 10) || parseInt(DomHelper.getStyleValue(el, 'flex-grow'), 10)),\n    verticality = {\n        horizontal : false,\n        vertical   : true\n    };\n\n/**\n * A simple splitter widget that resizes the elements next to it or above/below it depending on orientation.\n *\n * @extends Core/widget/Widget\n * @classType splitter\n * @inlineexample Core/widget/Splitter.js\n * @widget\n */\nexport default class Splitter extends Widget {\n    //region Config\n\n    static get $name() {\n        return 'Splitter';\n    }\n\n    // Factoryable type name\n    static get type() {\n        return 'splitter';\n    }\n\n    static get configurable() {\n        return {\n            /**\n             * Fired when a drag starts\n             * @event dragStart\n             * @param {Core.widget.Splitter} source The Splitter\n             * @param {MouseEvent|TouchEvent} event The DOM event\n             */\n\n            /**\n             * Fired while dragging\n             * @event drag\n             * @param {Core.widget.Splitter} source The Splitter\n             * @param {MouseEvent|TouchEvent} event The DOM event\n             */\n\n            /**\n             * Fired after a drop\n             * @event drop\n             * @param {Core.widget.Splitter} source The Splitter\n             * @param {MouseEvent|TouchEvent} event The DOM event\n             */\n\n            /**\n             * Splitter orientation, see {@link #config-orientation}. When set to 'auto' then actually used orientation\n             * can be retrieved using {@link #property-currentOrientation}.\n             * @member {'auto'|'horizontal'|'vertical'} orientation\n             * @readonly\n             */\n            /**\n             * The splitter's orientation, configurable with 'auto', 'horizontal' or 'vertical'.\n             *\n             * 'auto' tries to determine the orientation by either checking the `flex-direction` of the parent element\n             * or by comparing the positions of the closest sibling elements to the splitter. If they are above and\n             * below 'horizontal' is used, if not it uses 'vertical'.\n             *\n             * ```\n             * new Splitter({\n             *    orientation : 'horizontal'\n             * });\n             * ```\n             *\n             * To receive the actually used orientation when configured with 'auto', see\n             * {@link #property-currentOrientation}.\n             *\n             * @config {'auto'|'horizontal'|'vertical'}\n             * @default\n             */\n            orientation : 'auto',\n\n            vertical : null,\n\n            containerElement : {\n                $config : 'nullify',\n                value   : null\n            },\n\n            nextNeighbor : {\n                $config : 'nullify',\n                value   : null\n            },\n\n            previousNeighbor : {\n                $config : 'nullify',\n                value   : null\n            }\n        };\n    }\n\n    static get delayable() {\n        return {\n            syncState : 'raf'\n        };\n    }\n\n    //endregion\n\n    //region Init & destroy\n\n    doDestroy() {\n        this.mouseDetacher?.();\n\n        super.doDestroy();\n    }\n\n    //endregion\n\n    //region Template & element\n\n    compose() {\n        return {\n            class : {\n                'b-splitter' : 1\n            },\n\n            // eslint-disable-next-line bryntum/no-listeners-in-lib\n            listeners : {\n                pointerdown : 'onMouseDown',\n                mouseenter  : 'syncState',\n\n                ...(!BrowserHelper.supportsPointerEvents && {\n                    mousedown  : 'onMouseDown',\n                    touchstart : 'onMouseDown'\n                })\n            }\n        };\n    }\n\n    //endregion\n\n    //region Orientation\n\n    /**\n     * Get actually used orientation, which is either the configured value for `orientation` or if configured with\n     * 'auto' the currently used orientation.\n     * @property {String}\n     * @readonly\n     */\n    get currentOrientation() {\n        return this.vertical ? 'vertical' : 'horizontal';\n    }\n\n    getSibling(next = true) {\n        let { element } = this,\n            result;\n\n        while (!result && (element = element[`${next ? 'next' : 'previous'}ElementSibling`])) {\n            if (!element.isConnected || DomHelper.isVisible(element)) {\n                result = element;\n            }\n        }\n\n        return result;\n    }\n\n    get nextWidget() {\n        let { element } = this,\n            result;\n\n        while (!result && (element = element.nextElementSibling)) {\n            // Second arg used to be 1, but when used inside elements inside another widget (FiddlePanel), nextWidget &\n            // previousWidget would both return the outer widget\n            result = Widget.fromElement(element, this.element.parentElement);\n        }\n\n        return result;\n    }\n\n    get previousWidget() {\n        let { element } = this,\n            result;\n\n        while (!result && (element = element.previousElementSibling)) {\n            result = Widget.fromElement(element, this.element.parentElement);\n        }\n\n        return result;\n    }\n\n    updateContainerElement(containerElement) {\n        const me = this;\n\n        me.stateDetector = me.stateDetector?.disconnect();\n\n        if (containerElement) {\n            me.stateDetector = new MutationObserver(() => me.syncState());  // syncState runs on next raf\n\n            me.stateDetector.observe(containerElement, {\n                attributes : true,  // in case style changes flip our orientation (when == 'auto')\n                childList  : true   // watch for our neighbors to render (so we can disable on hidden/collapsed state)\n            });\n        }\n    }\n\n    updateNextNeighbor(next) {\n        this.watchNeighbor(next, 'next');\n    }\n\n    updatePreviousNeighbor(previous) {\n        this.watchNeighbor(previous, 'previous');\n    }\n\n    watchNeighbor(neighbor, name) {\n        this.detachListeners(name);\n\n        neighbor?.ion({\n            name,\n            thisObj  : this,\n            collapse : 'syncState',\n            expand   : 'syncState',\n            hide     : 'syncState',\n            show     : 'syncState'\n        });\n    }\n\n    updateOrientation() {\n        this.syncState.now();\n    }\n\n    updateVertical(vertical) {\n        const classList = this.element?.classList;\n\n        classList?.add(classesHV[vertical ? 1 : 0]);\n        classList?.remove(classesHV[vertical ? 0 : 1]);\n    }\n\n    /**\n     * Determine orientation when set to `'auto'` and detects neighboring widgets to monitor their hidden/collapsed\n     * states.\n     * @private\n     */\n    syncState() {\n        const\n            me                                      = this,\n            { element, nextWidget, previousWidget } = me;\n\n        let vertical = verticality[me.orientation] ?? null;\n\n        me.nextNeighbor     = nextWidget;\n        me.previousNeighbor = previousWidget;\n\n        me.disabled = (\n            nextWidget && ((nextWidget.collapsible && nextWidget.collapsed) || nextWidget.hidden)\n        ) || (\n            previousWidget && ((previousWidget.collapsible && previousWidget.collapsed) || previousWidget.hidden)\n        );\n\n        if (vertical !== null && nextWidget && previousWidget) {\n            me.containerElement = null;\n        }\n        else {\n            // we'll need to monitor parent element child list changes until our neighbors are added to the DOM\n            me.containerElement = element.parentElement;\n\n            // Orientation auto and already rendered, determine orientation to use\n            if (me.rendered && element.offsetParent) {\n                const flexDirection = DomHelper.getStyleValue(element.parentElement, 'flex-direction');\n\n                // If used in a flex layout, determine orientation from flex-direction\n                if (flexDirection) {\n                    vertical = !flexDirection.startsWith('column');\n                }\n                // If used in some other layout, try to determine from sibling elements position\n                else {\n                    const\n                        previous = element.previousElementSibling,\n                        next = element.nextElementSibling;\n\n                    if (!previous || !next) {\n                        // To early in rendering, next sibling not rendered yet\n                        return;\n                    }\n\n                    const\n                        prevRect = previous.getBoundingClientRect(),\n                        nextRect = next.getBoundingClientRect(),\n                        topMost = prevRect.top < nextRect.top ? prevRect : nextRect,\n                        bottomMost = topMost === nextRect ? prevRect : nextRect;\n\n                    // orientation = topMost.top !== bottomMost.top ? 'horizontal' : 'vertical';\n                    vertical = topMost.top === bottomMost.top;\n                }\n            }\n        }\n\n        me.vertical = vertical;\n    }\n\n    //endregion\n\n    //region Events\n\n    onMouseDown(event) {\n        event.preventDefault();\n\n        if (event.touches) {\n            event = event.touches[0];\n        }\n\n        const\n            me          = this,\n            {\n                element,\n                nextNeighbor,\n                previousNeighbor\n            } = me,\n            prev        = previousNeighbor ? previousNeighbor.element : me.getSibling(false),\n            next        = nextNeighbor ? nextNeighbor.element : me.getSibling(),\n            prevHasFlex = hasFlex(prev),\n            nextHasFlex = hasFlex(next),\n            flexed      = [];\n\n        // First stop any ongoing drag operation, since we cannot trust that we always get the mouseup event\n        me.mouseDetacher?.();\n\n        // Remember flexed children, to enable maintaining their proportions on resize\n        for (const child of element.parentElement.children) {\n            if (hasFlex(child) && child !== element) {\n                flexed.push({\n                    element : child,\n                    width   : child.offsetWidth,\n                    height  : child.offsetHeight\n                });\n            }\n        }\n\n        me.context = {\n            startX     : event.pageX,\n            startY     : event.pageY,\n            prevWidth  : prev.offsetWidth,\n            prevHeight : prev.offsetHeight,\n            nextWidth  : next.offsetWidth,\n            nextHeight : next.offsetHeight,\n            prevHasFlex,\n            nextHasFlex,\n            flexed,\n            prev,\n            next\n        };\n\n        const events = {\n            element     : document,\n            pointermove : 'onMouseMove',\n            pointerup   : 'onMouseUp',\n            thisObj     : me\n        };\n\n        // <remove-on-release>\n        // TODO: Re-evaluate if this is needed in 2023, https://caniuse.com/pointer\n        // </remove-on-release>\n        if (!BrowserHelper.supportsPointerEvents) {\n            events.mousemove = events.touchmove = 'onMouseMove';\n            events.mouseup   = events.touchend  = 'onMouseUp';\n        }\n\n        element.classList.add('b-moving');\n        me.mouseDetacher = EventHelper.on(events);\n\n        me.trigger('splitterMouseDown', { event });\n    }\n\n    onMouseMove(event) {\n        const\n            me        = this,\n            {\n                context,\n                nextWidget,\n                previousWidget\n            }         = me,\n            prevStyle = context.prev.style,\n            nextStyle = context.next.style,\n            deltaX    = (event.pageX - context.startX) * (me.rtl ? -1 : 1),\n            deltaY    = event.pageY - context.startY;\n\n        event.preventDefault();\n\n        Object.assign(context, {\n            deltaX,\n            deltaY\n        });\n\n        if (!context.started) {\n            context.started = true;\n\n            me.trigger('dragStart', { context, event });\n\n            // Convert heights/widths to flex for flexed elements to maintain proportions\n            // 100px high -> flex-grow 100\n            context.flexed.forEach(flexed => {\n                flexed.element.style.flexGrow = me.vertical ? flexed.width : flexed.height;\n                //Remove flex-basis, since it interferes with resizing\n                flexed.element.style.flexBasis = '0';\n            });\n        }\n\n        // Adjust flex-grow or width/height for splitter's closest siblings\n        if (me.vertical) {\n            const\n                newPrevWidth = context.prevWidth + deltaX,\n                newNextWidth = context.nextWidth - deltaX;\n\n            if (context.prevHasFlex) {\n                prevStyle.flexGrow = newPrevWidth;\n            }\n            else if (previousWidget) {\n                previousWidget.width = newPrevWidth;\n            }\n            else {\n                prevStyle.width = `${newPrevWidth}px`;\n            }\n\n            if (context.nextHasFlex) {\n                nextStyle.flexGrow = newNextWidth;\n            }\n            else if (nextWidget) {\n                nextWidget.width = newNextWidth;\n            }\n            else {\n                nextStyle.width = `${newNextWidth}px`;\n            }\n        }\n        else {\n            const\n                newPrevHeight = context.prevHeight + deltaY,\n                newNextHeight = context.nextHeight - deltaY;\n\n            if (context.prevHasFlex) {\n                prevStyle.flexGrow = newPrevHeight;\n            }\n            else if (previousWidget) {\n                previousWidget.height = newPrevHeight;\n            }\n            else {\n                prevStyle.height = `${newPrevHeight}px`;\n            }\n\n            if (context.nextHasFlex) {\n                nextStyle.flexGrow = newNextHeight;\n            }\n            else if (nextWidget) {\n                nextWidget.height = newNextHeight;\n            }\n            else {\n                nextStyle.height = `${newNextHeight}px`;\n            }\n        }\n\n        me.trigger('drag', { context, event });\n    }\n\n    onMouseUp(event) {\n        const me = this;\n\n        me.mouseDetacher?.();\n        me.mouseDetacher = null;\n        me.element.classList.remove('b-moving');\n\n        if (me.context.started) {\n            me.trigger('drop', { context : me.context, event });\n        }\n\n        me.context = null;\n    }\n\n    //endregion\n\n    render() {\n        super.render(...arguments);\n\n        this.syncState.now();\n\n        if (this.vertical === null) {\n            this.syncState();  // try again on next raf\n        }\n    }\n}\n\n// Register this widget type with its Factory\nSplitter.initClass();\n"],"names":["classesHV","hasFlex","el","DomHelper","getStyleValue","parentElement","parseInt","verticality","horizontal","vertical","Splitter","Widget","$name","type","configurable","orientation","containerElement","$config","value","nextNeighbor","previousNeighbor","delayable","syncState","doDestroy","_this$mouseDetacher","mouseDetacher","call","compose","class","listeners","pointerdown","mouseenter","BrowserHelper","supportsPointerEvents","mousedown","touchstart","currentOrientation","getSibling","next","element","result","isConnected","isVisible","nextWidget","nextElementSibling","fromElement","previousWidget","previousElementSibling","updateContainerElement","_me$stateDetector","me","stateDetector","disconnect","MutationObserver","observe","attributes","childList","updateNextNeighbor","watchNeighbor","updatePreviousNeighbor","previous","neighbor","name","detachListeners","ion","thisObj","collapse","expand","hide","show","updateOrientation","now","updateVertical","_this$element","classList","add","remove","disabled","collapsible","collapsed","hidden","rendered","offsetParent","flexDirection","startsWith","prevRect","getBoundingClientRect","nextRect","topMost","top","bottomMost","onMouseDown","event","_me$mouseDetacher","preventDefault","touches","prev","prevHasFlex","nextHasFlex","flexed","child","children","push","width","offsetWidth","height","offsetHeight","context","startX","pageX","startY","pageY","prevWidth","prevHeight","nextWidth","nextHeight","events","document","pointermove","pointerup","mousemove","touchmove","mouseup","touchend","EventHelper","on","trigger","onMouseMove","prevStyle","style","nextStyle","deltaX","rtl","deltaY","Object","assign","started","forEach","flexGrow","flexBasis","newPrevWidth","newNextWidth","newPrevHeight","newNextHeight","onMouseUp","_me$mouseDetacher2","render","arguments","initClass","_$name"],"mappings":"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"}