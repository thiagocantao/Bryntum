/*!
 *
 * Bryntum Gantt 4.0.3
 *
 * Copyright(c) 2020 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
const productName="gantt",later=function(){var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),r=t.length>>>0;if(0===r)return-1;var n=0;if(arguments.length>1&&((n=Number(arguments[1]))!=n?n=0:0!=n&&n!=1/0&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=r)return-1;for(var i=n>=0?n:Math.max(r-Math.abs(n),0);i<r;i++)if(i in t&&t[i]===e)return i;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort((function(e,t){return+e-+t})),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,r){for(var n,i=0!==r[0],s=0,o=t.length-1;o>-1;--o){if((n=t[o])===e)return n;if(!(n>e||0===n&&i&&r[1]>e))break;s=o}return t[s]},e.array.nextInvalid=function(e,t,r){for(var n=r[0],i=r[1],s=t.length,o=0===t[s-1]&&0!==n?i:0,a=e,l=t.indexOf(e),c=a;a===(t[l]||o);)if(++a>i&&(a=n),++l===s&&(l=0),a===c)return;return a},e.array.prev=function(e,t,r){for(var n,i=t.length,s=0!==r[0],o=i-1,a=0;a<i;a++){if((n=t[a])===e)return n;if(!(n<e||0===n&&s&&r[1]<e))break;o=a}return t[o]},e.array.prevInvalid=function(e,t,r){for(var n=r[0],i=r[1],s=t.length,o=0===t[s-1]&&0!==n?i:0,a=e,l=t.indexOf(e),c=a;a===(t[l]||o);)if(--a<n&&(a=i),-1===--l&&(l=s-1),a===c)return;return a},e.day=e.D={name:"day",range:86400,val:function(t){return t.D||(t.D=e.date.getDate.call(t))},isValid:function(t,r){return e.D.val(t)===(r||e.D.extent(t)[1])},extent:function(t){if(t.DExtent)return t.DExtent;var r=e.M.val(t),n=e.DAYS_IN_MONTH[r-1];return 2===r&&366===e.dy.extent(t)[1]&&(n+=1),t.DExtent=[1,n]},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,r){r=r>e.D.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.D,e.M),i=e.D.extent(n)[1];return r=r>i?1:r||i,e.date.next(e.Y.val(n),e.M.val(n),r)},prev:function(t,r){var n=e.date.prevRollover(t,r,e.D,e.M),i=e.D.extent(n)[1];return e.date.prev(e.Y.val(n),e.M.val(n),r>i?i:r||i)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},isValid:function(t,r){return e.dc.val(t)===r||0===r&&e.D.val(t)>e.D.extent(t)[1]-7},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,r){r=r>e.dc.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.dc,e.M);r=r>e.dc.extent(n)[1]?1:r;var i=e.date.next(e.Y.val(n),e.M.val(n),0===r?e.D.extent(n)[1]-6:1+7*(r-1));return i.getTime()<=t.getTime()?(n=e.M.next(t,e.M.val(t)+1),e.date.next(e.Y.val(n),e.M.val(n),0===r?e.D.extent(n)[1]-6:1+7*(r-1))):i},prev:function(t,r){var n=e.date.prevRollover(t,r,e.dc,e.M),i=e.dc.extent(n)[1];return r=r>i?i:r||i,e.dc.end(e.date.prev(e.Y.val(n),e.M.val(n),1+7*(r-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},isValid:function(t,r){return e.dw.val(t)===(r||7)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,r){return r=r>7?1:r||7,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r-e.dw.val(t))+(r<=e.dw.val(t)?7:0))},prev:function(t,r){return r=r>7?7:r||7,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(r-e.dw.val(t))+(r>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},isValid:function(t,r){return e.dy.val(t)===(r||e.dy.extent(t)[1])},extent:function(t){var r=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,r%4?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,r){r=r>e.dy.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.dy,e.Y),i=e.dy.extent(n)[1];return r=r>i?1:r||i,e.date.next(e.Y.val(n),e.M.val(n),r)},prev:function(t,r){var n=e.date.prevRollover(t,r,e.dy,e.Y),i=e.dy.extent(n)[1];return r=r>i?i:r||i,e.date.prev(e.Y.val(n),e.M.val(n),r)}},e.hour=e.h={name:"hour",range:3600,val:function(t){return t.h||(t.h=e.date.getHour.call(t))},isValid:function(t,r){return e.h.val(t)===r},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,r){r=r>23?0:r;var n=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r<=e.h.val(t)?1:0),r);return!e.date.isUTC&&n.getTime()<=t.getTime()&&(n=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n),r+1)),n},prev:function(t,r){return r=r>23?23:r,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(r>=e.h.val(t)?-1:0),r)}},e.minute=e.m={name:"minute",range:60,val:function(t){return t.m||(t.m=e.date.getMin.call(t))},isValid:function(t,r){return e.m.val(t)===r},extent:function(e){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,r){var n=e.m.val(t),i=e.s.val(t),s=r>59?60-n:r<=n?60-n+r:r-n,o=new Date(t.getTime()+s*e.MIN-i*e.SEC);return!e.date.isUTC&&o.getTime()<=t.getTime()&&(o=new Date(t.getTime()+(s+120)*e.MIN-i*e.SEC)),o},prev:function(t,r){return r=r>59?59:r,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(r>=e.m.val(t)?-1:0),r)}},e.month=e.M={name:"month",range:2629740,val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},isValid:function(t,r){return e.M.val(t)===(r||12)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,r){return r=r>12?1:r||12,e.date.next(e.Y.val(t)+(r>e.M.val(t)?0:1),r)},prev:function(t,r){return r=r>12?12:r||12,e.date.prev(e.Y.val(t)-(r>=e.M.val(t)?1:0),r)}},e.second=e.s={name:"second",range:1,val:function(t){return t.s||(t.s=e.date.getSec.call(t))},isValid:function(t,r){return e.s.val(t)===r},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,r){var n=e.s.val(t),i=r>59?60-n:r<=n?60-n+r:r-n,s=new Date(t.getTime()+i*e.SEC);return!e.date.isUTC&&s.getTime()<=t.getTime()&&(s=new Date(t.getTime()+(i+7200)*e.SEC)),s},prev:function(t,r,n){return r=r>59?59:r,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(r>=e.s.val(t)?-1:0),r)}},e.time=e.t={name:"time",range:1,val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},isValid:function(t,r){return e.t.val(t)===r},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,r){r=r>86399?0:r;var n=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r<=e.t.val(t)?1:0),0,0,r);return!e.date.isUTC&&n.getTime()<t.getTime()&&(n=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n),e.h.val(n),e.m.val(n),r+7200)),n},prev:function(t,r){return r=r>86399?86399:r,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r>=e.t.val(t)?-1:0),0,0,r)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},isValid:function(t,r){return e.wm.val(t)===(r||e.wm.extent(t)[1])},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,r){r=r>e.wm.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.wm,e.M),i=e.wm.extent(n)[1];return r=r>i?1:r||i,e.date.next(e.Y.val(n),e.M.val(n),Math.max(1,7*(r-1)-(e.dw.val(n)-2)))},prev:function(t,r){var n=e.date.prevRollover(t,r,e.wm,e.M),i=e.wm.extent(n)[1];return r=r>i?i:r||i,e.wm.end(e.date.next(e.Y.val(n),e.M.val(n),Math.max(1,7*(r-1)-(e.dw.val(n)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(t){if(t.wy)return t.wy;var r=e.dw.next(e.wy.start(t),5),n=e.dw.next(e.Y.prev(r,e.Y.val(r)-1),5);return t.wy=1+Math.ceil((r.getTime()-n.getTime())/e.WEEK)},isValid:function(t,r){return e.wy.val(t)===(r||e.wy.extent(t)[1])},extent:function(t){if(t.wyExtent)return t.wyExtent;var r=e.dw.next(e.wy.start(t),5),n=e.dw.val(e.Y.start(r)),i=e.dw.val(e.Y.end(r));return t.wyExtent=[1,5===n||5===i?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,r){r=r>e.wy.extent(t)[1]?1:r;var n=e.dw.next(e.wy.start(t),5),i=e.date.nextRollover(n,r,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],o=e.wy.start(i);return r=r>s?1:r||s,e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(r-1))},prev:function(t,r){var n=e.dw.next(e.wy.start(t),5),i=e.date.prevRollover(n,r,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],o=e.wy.end(i);return r=r>s?s:r||s,e.wy.end(e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(r-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},isValid:function(t,r){return e.Y.val(t)===r},extent:function(){return[1970,2099]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,r){return r>e.Y.val(t)&&r<=e.Y.extent()[1]?e.date.next(r):e.NEVER},prev:function(t,r){return r<e.Y.val(t)&&r>=e.Y.extent()[0]?e.date.prev(r):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(t,r){return e.fd.val(t)===r},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(t,r){return e.fd.val(t)<r?new Date(r):e.NEVER},prev:function(t,r){return e.fd.val(t)>r?new Date(r):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(e,t){var r=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-r)*e.range,val:e.val,isValid:function(e,t){return this.val(e)>=r},extent:e.extent,start:e.start,end:e.end,next:function(t,n){return n!=r&&(n=e.extent(t)[0]),e.next(t,n)},prev:function(t,n){return n=n===r?e.extent(t)[1]:r-1,e.prev(t,n)}}},e.modifier.before=e.modifier.b=function(e,t){var r=t[t.length-1];return{name:"before "+e.name,range:e.range*(r-1),val:e.val,isValid:function(e,t){return this.val(e)<r},extent:e.extent,start:e.start,end:e.end,next:function(t,n){return n=n===r?e.extent(t)[0]:r,e.next(t,n)},prev:function(t,n){return n=n===r?r-1:e.extent(t)[1],e.prev(t,n)}}},e.compile=function(t){var r,n=[],i=0;for(var s in t){var o=s.split("_"),a=o[0],l=o[1],c=t[s],d=l?e.modifier[l](e[a],c):e[a];n.push({constraint:d,vals:c}),i++}return n.sort((function(e,t){var r=e.constraint.range,n=t.constraint.range;return n<r?-1:n>r?1:0})),r=n[i-1].constraint,{start:function(t,s){for(var o,a=s,l=e.array[t],c=1e3;c--&&!o&&a;){o=!0;for(var d=0;d<i;d++){var u=n[d].constraint,h=u.val(a),g=u.extent(a),m=l(h,n[d].vals,g);if(!u.isValid(a,m)){a=u[t](a,m),o=!1;break}}}return a!==e.NEVER&&(a="next"===t?r.start(a):r.end(a)),a},end:function(t,r){for(var s,o=e.array[t+"Invalid"],a=function(e){return"next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()}}(t),l=i-1;l>=0;l--){var c,d=n[l].constraint,u=d.val(r),h=d.extent(r),g=o(u,n[l].vals,h);void 0!==g&&(!(c=d[t](r,g))||s&&!a(s,c)||(s=c))}return s},tick:function(t,n){return new Date("next"===t?r.end(n).getTime()+e.SEC:r.start(n).getTime()-e.SEC)},tickStart:function(e){return r.start(e)}}},e.schedule=function(t){if(!t)throw new Error("Missing schedule definition.");if(!t.schedules)throw new Error("Definition must include at least one schedule.");for(var r=[],n=t.schedules.length,i=[],s=t.exceptions?t.exceptions.length:0,o=0;o<n;o++)r.push(e.compile(t.schedules[o]));for(var a=0;a<s;a++)i.push(e.compile(t.exceptions[a]));function l(t,n,o,a,l){var b,C,D,S=v(t),E=n,w=1e3,x=[],R=[],T=[],M="next"===t,P=M?0:1,I=M?1:0;if(!(o=o?new Date(o):new Date)||!o.getTime())throw new Error("Invalid start date.");for(!function(e,t,r,n){for(var i=0,s=t.length;i<s;i++)r[i]=t[i].start(e,n)}(t,r,x,o),function(t,r,n,i){for(var s=0,o=r.length;s<o;s++){var a=r[s].start(t,i);n[s]=a?[a,r[s].end(t,a)]:e.NEVER}}(t,i,R,o);w--&&E&&(b=y(x,S))&&(!a||!S(b,a));)if(s&&(u(t,i,R,b),C=m(t,R,b)))d(t,r,x,C);else{if(l){var A=p(R,S);C=f(t,r,x,b,A);var F=M?[new Date(Math.max(o,b)),C?new Date(a?Math.min(C,a):C):void 0]:[C?new Date(a?Math.max(a,C.getTime()+e.SEC):C.getTime()+e.SEC):void 0,new Date(Math.min(o,b.getTime()+e.SEC))];if(D&&F[P].getTime()===D[I].getTime()?(D[I]=F[I],E++):(D=F,T.push(D)),!C)break;d(t,r,x,C)}else T.push(M?new Date(Math.max(o,b)):g(r,x,b,a)),h(t,r,x,b);E--}for(var k=0,O=T.length;k<O;k++){var H=T[k];T[k]="[object Array]"===Object.prototype.toString.call(H)?[c(H[0]),c(H[1])]:c(H)}return 0===T.length?e.NEVER:1===n?T[0]:T}function c(e){if(e instanceof Date&&!isNaN(e.valueOf()))return new Date(e)}function d(e,t,r,n){for(var i=v(e),s=0,o=t.length;s<o;s++)r[s]&&!i(r[s],n)&&(r[s]=t[s].start(e,n))}function u(t,r,n,i){for(var s=v(t),o=0,a=r.length;o<a;o++)if(n[o]&&!s(n[o][0],i)){var l=r[o].start(t,i);n[o]=l?[l,r[o].end(t,l)]:e.NEVER}}function h(e,t,r,n){for(var i=0,s=t.length;i<s;i++)r[i]&&r[i].getTime()===n.getTime()&&(r[i]=t[i].start(e,t[i].tick(e,n)))}function g(e,t,r,n){for(var i,s=0,o=t.length;s<o;s++)if(t[s]&&t[s].getTime()===r.getTime()){var a=e[s].tickStart(r);if(n&&a<n)return n;(!i||a>i)&&(i=a)}return i}function m(e,t,r){for(var n,i=v(e),s=0,o=t.length;s<o;s++){var a=t[s];!a||i(a[0],r)||a[1]&&!i(a[1],r)||n&&!i(a[1],n)||(n=a[1])}return n}function p(e,t){for(var r,n=0,i=e.length;n<i;n++)!e[n]||r&&!t(r,e[n][0])||(r=e[n][0]);return r}function f(e,t,r,n,i){for(var s,o=v(e),a=0,l=t.length;a<l;a++){var c=r[a];if(c&&c.getTime()===n.getTime()){var d=t[a].end(e,c);if(i&&(!d||o(d,i)))return i;s&&!o(d,s)||(s=d)}}return s}function v(e){return"next"===e?function(e,t){return!t||e.getTime()>t.getTime()}:function(e,t){return!e||t.getTime()>e.getTime()}}function y(e,t){for(var r=e[0],n=1,i=e.length;n<i;n++)e[n]&&t(r,e[n])&&(r=e[n]);return r}return{isValid:function(t){return l("next",1,t,t)!==e.NEVER},next:function(e,t,r){return l("next",e||1,t,r)},prev:function(e,t,r){return l("prev",e||1,t,r)},nextRange:function(e,t,r){return l("next",e||1,t,r,!0)},prevRange:function(e,t,r){return l("prev",e||1,t,r,!0)}}},e.setTimeout=function(t,r){var n,i=e.schedule(r);return t&&function e(){var r=Date.now(),s=i.next(2,r);if(!s[0])return void(n=void 0);var o=s[0].getTime()-r;o<1e3&&(o=s[1]?s[1].getTime()-r:1e3);n=o<2147483647?setTimeout(t,o):setTimeout(e,2147483647)}(),{isDone:function(){return!n},clear:function(){clearTimeout(n)}}},e.setInterval=function(t,r){if(t){var n=e.setTimeout((function s(){i||(t(),n=e.setTimeout(s,r))}),r),i=n.isDone();return{isDone:function(){return n.isDone()},clear:function(){i=!0,n.clear()}}}},e.date={},e.date.timezone=function(t){e.date.build=t?function(e,t,r,n,i,s){return new Date(e,t,r,n,i,s)}:function(e,t,r,n,i,s){return new Date(Date.UTC(e,t,r,n,i,s))};var r=t?"get":"getUTC",n=Date.prototype;e.date.getYear=n[r+"FullYear"],e.date.getMonth=n[r+"Month"],e.date.getDate=n[r+"Date"],e.date.getDay=n[r+"Day"],e.date.getHour=n[r+"Hours"],e.date.getMin=n[r+"Minutes"],e.date.getSec=n[r+"Seconds"],e.date.isUTC=!t},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(t,r,n,i,s,o){return e.date.build(t,void 0!==r?r-1:0,void 0!==n?n:1,i||0,s||0,o||0)},e.date.nextRollover=function(t,r,n,i){var s=n.val(t),o=n.extent(t)[1];return(r||o)<=s||r>o?new Date(i.end(t).getTime()+e.SEC):i.start(t)},e.date.prev=function(t,r,n,i,s,o){var a=arguments.length;return r=a<2?11:r-1,n=a<3?e.D.extent(e.date.next(t,r+1))[1]:n,i=a<4?23:i,s=a<5?59:s,o=a<6?59:o,e.date.build(t,r,n,i,s,o)},e.date.prevRollover=function(e,t,r,n){return t>=r.val(e)||!t?n.start(n.prev(e,n.val(e)-1)):n.start(e)},e.parse={},e.parse.cron=function(e,t){var r={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},n={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},i={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function s(e,t,n){return isNaN(e)?r[e]||null:Math.min(+e+(t||0),n||9999)}function o(e,t,r,n,i){var s=r;for(e[t]||(e[t]=[]);s<=n;)e[t].indexOf(s)<0&&e[t].push(s),s+=i||1;e[t].sort((function(e,t){return e-t}))}function a(e,t,r,n){(t.d&&!t.dc||t.dc&&t.dc.indexOf(n)<0)&&(e.push(function(e){var t,r={};for(t in e)"dc"!==t&&"d"!==t&&(r[t]=e[t].slice(0));return r}(t)),t=e[e.length-1]),o(t,"d",r,r),o(t,"dc",n,n)}function l(e,t,n,i,l,c){var d,u,h=t.schedules,g=h[h.length-1];"L"===e&&(e=i-1),null!==(d=s(e,c,l))?o(g,n,d,d):null!==(d=s(e.replace("W",""),c,l))?function(e,t,n){var i={},s={};1===n?(o(t,"D",1,3),o(t,"d",r.MON,r.FRI),o(i,"D",2,2),o(i,"d",r.TUE,r.FRI),o(s,"D",3,3),o(s,"d",r.TUE,r.FRI)):(o(t,"D",n-1,n+1),o(t,"d",r.MON,r.FRI),o(i,"D",n-1,n-1),o(i,"d",r.MON,r.THU),o(s,"D",n+1,n+1),o(s,"d",r.TUE,r.FRI)),e.exceptions.push(i),e.exceptions.push(s)}(t,g,d):null!==(d=s(e.replace("L",""),c,l))?a(h,g,d,i-1):2===(u=e.split("#")).length?a(h,g,d=s(u[0],c,l),s(u[1])):function(e,t,r,n,i,a){var l=e.split("/"),c=+l[1],d=l[0];if("*"!==d&&"0"!==d){var u=d.split("-");n=s(u[0],a,i),i=s(u[1],a,i)||i}o(t,r,n,i,c)}(e,g,n,i,l,c)}function c(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function d(e,t){return c(e)&&!c(t)?1:e-t}var u=function(e){var t=e.toUpperCase();return n[t]||t}(e);return function(e){var t,r,n,s,o={schedules:[{}],exceptions:[]},a=e.replace(/(\s)+/g," ").split(" ");for(t in i)if((n=a[(r=i[t])[0]])&&"*"!==n&&"?"!==n){var c,u=(s=n.split(",").sort(d)).length;for(c=0;c<u;c++)l(s[c],o,t,r[1],r[2],r[3])}return o}(t?u:"0 "+u)},e.parse.recur=function(){var t,r,n,i,s,o,a,l,c,d=[],u=[],h=d;function g(e,d,u){if(e=s?e+"_"+s:e,t||(h.push({}),t=h[0]),t[e]||(t[e]=[]),r=t[e],i){for(n=[],l=d;l<=u;l+=i)n.push(l);c={n:e,x:i,c:r.length,m:u}}var g=(n=o?[d]:a?[u]:n).length;for(l=0;l<g;l+=1){var m=n[l];r.indexOf(m)<0&&r.push(m)}n=i=s=o=a=0}return{schedules:d,exceptions:u,on:function(){return n=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return i=e||1,this},after:function(e){return s="a",n=[e],this},before:function(e){return s="b",n=[e],this},first:function(){return o=1,this},last:function(){return a=1,this},time:function(){for(var e=0,t=n.length;e<t;e++){var r=n[e].split(":");r.length<3&&r.push(0),n[e]=3600*+r[0]+60*+r[1]+ +r[2]}return g("t"),this},second:function(){return g("s",0,59),this},minute:function(){return g("m",0,59),this},hour:function(){return g("h",0,23),this},dayOfMonth:function(){return g("D",1,a?0:31),this},dayOfWeek:function(){return g("d",1,7),this},onWeekend:function(){return n=[1,7],this.dayOfWeek()},onWeekday:function(){return n=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return g("dc",1,a?0:5),this},dayOfYear:function(){return g("dy",1,a?0:366),this},weekOfMonth:function(){return g("wm",1,a?0:5),this},weekOfYear:function(){return g("wy",1,a?0:53),this},month:function(){return g("M",1,12),this},year:function(){return g("Y",1970,2450),this},fullDate:function(){for(var e=0,t=n.length;e<t;e++)n[e]=n[e].getTime();return g("fd"),this},customModifier:function(t,r){var i=e.modifier[t];if(!i)throw new Error("Custom modifier "+t+" not recognized!");return s=t,n=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(t){var r=e[t];if(!r)throw new Error("Custom time period "+t+" not recognized!");return g(t,r.extent(new Date)[0],r.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,c.m)},between:function(e,r){return t[c.n]=t[c.n].splice(0,c.c),i=c.x,g(c.n,e,r),this},and:function(){return t=h[h.push({})-1],this},except:function(){return h=u,t=null,this}}},e.parse.text=function(t){var r,n=e.parse.recur,i=0,s="",o={eof:/^$/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},a={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(e,t,r,n){return{startPos:e,endPos:t,text:r,type:n}}function c(e){var t,r,n,o,a,c,d=e instanceof Array?e:[e],u=/\s+/;for(d.push(u),a=i;!t||t.type===u;){c=-1,r=s.substring(a),t=l(a,a,s.split(u)[0]);var h,g=d.length;for(h=0;h<g;h++)(n=(o=d[h]).exec(r))&&0===n.index&&n[0].length>c&&(t=l(a,a+(c=n[0].length),r.substring(0,c),o));t.type===u&&(a=t.endPos)}return t}function d(e){var t=c(e);return i=t.endPos,t}function u(e){for(var t=+y(e),r=f(o.through)?+y(e):t,n=[],i=t;i<=r;i++)n.push(i);return n}function h(e){for(var t=u(e);f(o.and);)t=t.concat(u(e));return t}function g(e){var t,r,n,i;f(o.weekend)?e.on(a.sun,a.sat).dayOfWeek():f(o.weekday)?e.on(a.mon,a.tue,a.wed,a.thu,a.fri).dayOfWeek():(t=y(o.rank),e.every(t),r=p(e),f(o.start)?(t=y(o.rank),e.startingOn(t),v(r.type)):f(o.between)&&(n=y(o.rank),f(o.and)&&(i=y(o.rank),e.between(n,i))))}function m(e){f(o.first)?e.first():f(o.last)?e.last():e.on(h(o.rank)),p(e)}function p(e){var t=v([o.second,o.minute,o.hour,o.dayOfYear,o.dayOfWeek,o.dayInstance,o.day,o.month,o.year,o.weekOfMonth,o.weekOfYear]);switch(t.type){case o.second:e.second();break;case o.minute:e.minute();break;case o.hour:e.hour();break;case o.dayOfYear:e.dayOfYear();break;case o.dayOfWeek:e.dayOfWeek();break;case o.dayInstance:e.dayOfWeekCount();break;case o.day:e.dayOfMonth();break;case o.weekOfMonth:e.weekOfMonth();break;case o.weekOfYear:e.weekOfYear();break;case o.month:e.month();break;case o.year:e.year();break;default:r=i}return t}function f(e){var t=c(e).type===e;return t&&d(e),t}function v(e){var t=d(e);return t.type?t.text=function(e,t){var r=e;switch(t){case o.time:var n=e.split(/(:|am|pm)/),i="pm"===n[3]&&n[0]<12?parseInt(n[0],10)+12:n[0],s=n[2].trim();r=(1===i.length?"0":"")+i+":"+s;break;case o.rank:r=parseInt(/^\d+/.exec(e)[0],10);break;case o.monthName:case o.dayName:r=a[e.substring(0,3)]}return r}(t.text,e):r=i,t}function y(e){return v(e).text}return function(e){i=0,s=e,r=-1;for(var t=n();i<s.length&&r<0;){switch(v([o.every,o.after,o.before,o.onthe,o.on,o.of,o.in,o.at,o.and,o.except,o.also]).type){case o.every:g(t);break;case o.after:void 0!==c(o.time).type?(t.after(y(o.time)),t.time()):(t.after(y(o.rank)),p(t));break;case o.before:void 0!==c(o.time).type?(t.before(y(o.time)),t.time()):(t.before(y(o.rank)),p(t));break;case o.onthe:m(t);break;case o.on:t.on(h(o.dayName)).dayOfWeek();break;case o.of:t.on(h(o.monthName)).month();break;case o.in:t.on(h(o.yearIndex)).year();break;case o.at:for(t.on(y(o.time)).time();f(o.and);)t.on(y(o.time)).time();break;case o.and:break;case o.also:t.and();break;case o.except:t.except();break;default:r=i}}return{schedules:t.schedules,exceptions:t.exceptions,error:r}}(t.toLowerCase())},e}();later.date.localTime();class BrowserHelper{static cacheFlags(e=navigator.platform,t=navigator.userAgent){const r=this;r._isLinux=Boolean(e.match(/Linux/)),r._isMac=Boolean(e.match(/Mac/)),r._isWindows=Boolean(e.match(/Win32/)),r._isIE11=Boolean(t.match(/rv:11/)),r._edgeVersion=r.getVersion(t,/Edge?\/(\d+)\./),r._isEdge=r._edgeVersion>0&&r._edgeVersion<80,r._isEdge||(r._edgeVersion=0),r._isWebkit=Boolean(t.match(/WebKit/))&&!r._isEdge,r._firefoxVersion=r.getVersion(t,/Firefox\/(\d+)\./),r._isFirefox=r._firefoxVersion>0,r._chromeVersion=r._isEdge?0:r.getVersion(t,/Chrom(?:e|ium)\/(\d+)\./),r._isChrome=r._chromeVersion>0,r._isSafari=Boolean(t.match(/Safari/))&&!r._isChrome&&!r._isEdge,r._isMobileSafari=Boolean(t.match(/Mobile.*Safari/)),r._isAndroid=Boolean(t.match(/Android/g));try{document.querySelector(":scope"),r.supportsQueryScope=!r._isFirefox}catch(e){r.supportsQueryScope=!1}r._supportsPassive=!1;try{document.addEventListener("__notvalid__",null,{get passive(){r._supportsPassive=!0}})}catch(e){}}static getVersion(e,t){const r=e.match(t);return r?parseInt(r[1]):0}static get isTouchDevice(){return"_isTouchDevice"in this?this._isTouchDevice:"ontouchstart"in window||!this.isEdge&&navigator.maxTouchPoints>0||this.isEdge&&window.TouchEvent||navigator.msMaxTouchPoints>0}static get supportsPointerEvents(){return Boolean(window.PointerEvent||window.MSPointerEvent)}static set isTouchDevice(e){this._isTouchDevice=e}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isIE11(){return this._isIE11}static get isEdge(){return this._isEdge}static get edgeVersion(){return this._edgeVersion}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get isMobileSafari(){return this._isMobileSafari}static get isAndroid(){return this._isAndroid}static get supportsPassive(){return this._supportsPassive}static get storageAvailable(){let e,t;try{return e=localStorage,t="__storage_test__",e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}static setLocalStorageItem(e,t){this.storageAvailable&&localStorage.setItem(e,t)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static searchParam(e,t=null,r=document.location.search){const n=new RegExp(`[?&]${e}=([^&]*)`),i=r.match(n);return i&&i[1]||t}static getCookie(e){const t=encodeURIComponent(e)+"=",r=document.cookie.split(";");for(let e=0;e<r.length;e++){let n=r[e];for(;" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return decodeURIComponent(n.substring(t.length,n.length))}return""}static download(e,t){const r=document.createElement("a");r.download=e,r.href=t||e,r.style.cssText="display:none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}static downloadBlob(e,t){const r=window.URL.createObjectURL(e);this.download(t,r),window.URL.revokeObjectURL(r)}static get queryString(){const e=new URL(window.location.href).searchParams;return Object.fromEntries(e.entries())}static get isBrowserEnv(){return"undefined"!=typeof window}static get global(){return"undefined"!=typeof window?window:"undefined"!=typeof global?global:globalThis||{}}static copyToClipboard(e){let t=!0;const r=document.createElement("textarea");r.value=e,r.style.height=r.style.width=0,document.body.appendChild(r),r.select();try{document.execCommand("copy")}catch(e){t=!1}return r.remove(),t}}BrowserHelper.isBrowserEnv&&BrowserHelper.cacheFlags(),BrowserHelper._$name="BrowserHelper";let isSiesta=!1;try{isSiesta=Boolean(BrowserHelper.global.parent&&BrowserHelper.global.parent.Siesta||"undefined"!=typeof process&&(BrowserHelper.global.StartTest||BrowserHelper.global.Siesta))}catch(e){}class VersionHelper{static setVersion(e,t){e=e.toLowerCase(),VH[e]={version:t,isNewerThan:e=>e<t,isOlderThan:e=>e>t};let r="";r="gantt";const n=`${r}.${e}${t.replace(/\./g,"-")}`;if(BrowserHelper.isBrowserEnv)if(!0===window.bryntum[n]){if(!isSiesta)throw new Error("Bundle included twice, check cache-busters and file types (.js)");window.BUNDLE_EXCEPTION=!0}else window.bryntum[n]=!0}static getVersion(e){if(e=e.toLowerCase(),!VH[e])throw new Error("No version specified! Please check that you import VersionHelper right into the class from where you call `deprecate` function.");return VH[e].version}static checkVersion(e,t,r){const n=VH.getVersion(e);let i;switch(r){case"<":i=n<t;break;case"<=":i=n<=t;break;case"=":i=n===t;break;case">=":i=n>=t;break;case">":i=n>t}return i}static deprecate(e,t,r){if(!VH.checkVersion(e,t,"<"))throw new Error("Deprecated API use. "+r);console.warn(`Deprecation warning: You are using a deprecated API which will change in v${t}. ${r}`)}static get isTestEnv(){return isSiesta}}const VH=VersionHelper;let charsToEncode,entitiesToDecode,htmlEncodeRe,htmlDecodeRe;BrowserHelper.isBrowserEnv&&((window.bryntum||(window.bryntum={})).getVersion=VH.getVersion.bind(VH),window.bryntum.checkVersion=VH.checkVersion.bind(VH),window.bryntum.deprecate=VH.deprecate.bind(VH)),VersionHelper._$name="VersionHelper";const camelLettersRe=/([a-z])([A-Z])/g,escapeRegExpRe=/[.*+?^${}()|[\]\\]/g,idRe=/(^[^a-z]+|[^\w]+)/gi,whiteSpaceRe=/\s+/,htmlDecoder=(e,t)=>entitiesToDecode[t.toLowerCase()]||String.fromCharCode(parseInt(t.substr(2),10)),htmlEncoder=(e,t)=>charsToEncode[t],replaceCamelLetters=(e,t,r)=>t+"-"+r.toLowerCase(),replaceNonIdChar=e=>e?"_x"+e.charCodeAt(0).toString(16):"__blank__",hyphenateCache={};class StringHelper{static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static capitalizeFirstLetter(e){return VersionHelper.deprecate("Core","5.0.0","Deprecated in favor of `capitalize()`, will be removed in 5.0"),e?e[0].toUpperCase()+e.substr(1):null}static decodeHtml(e){return e?String(e).replace(htmlDecodeRe,htmlDecoder):e}static encodeHtml(e){return e?String(e).replace(htmlEncodeRe,htmlEncoder):e}static lowercaseFirstLetter(e){return VersionHelper.deprecate("Core","5.0.0","Deprecated in favor of `uncapitalize()`, will be removed in 5.0"),e?e[0].toLowerCase()+e.substr(1):null}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){const t=hyphenateCache[e];return t||(hyphenateCache[e]=e.replace(camelLettersRe,replaceCamelLetters))}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const t=Object.keys(e);charsToEncode=e,entitiesToDecode=t.reduce(((t,r)=>(t[e[r]]=r,t)),{}),htmlEncodeRe=new RegExp(`([${t.map((e=>"[-]".includes(e)?"\\"+e:e)).join("")}])`,"g"),htmlDecodeRe=new RegExp(`(${Object.values(e).join("|")}|&#[0-9]+;)`,"ig")}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch(e){}return t}static safeJsonStringify(e,t=null,r=null){let n=null;try{n=JSON.stringify(e,t,r)}catch(e){}return n}static createId(e){return String(e).replace(idRe,replaceNonIdChar)}static escapeRegExp(e,t){let r=e.replace(escapeRegExpRe,"\\$&");return void 0!==t&&(r=new RegExp(r,t)),r}static joinPaths(e,t="/"){return e.join(t).replace(new RegExp("\\"+t+"+","g"),t)}static split(e,t=whiteSpaceRe){let r=e;return"string"==typeof r&&(r=e.trim(),r=r?r.split(t):[]),r}static xss(e,...t){const r=[];let n=t.length;for(r[n]=e[n];n-- >0;)r[n]=e[n]+StringHelper.encodeHtml(t[n]);return r.join("")}}StringHelper.initHtmlEntities(),StringHelper._$name="StringHelper";const{toString:toString}=Object.prototype,{isFrozen:isFrozen}=Object,typeNameRe=/\[object ([^\]]+)]/,typeCache={};class Objects{static assign(e,...t){for(let r,n,i=0;i<t.length;i++)if(r=t[i],r)for(n in r)e[n]=r[n];return e}static assignIf(e,...t){for(let r,n,i=0;i<t.length;i++)if(r=t[i],r)for(n in r)n in e&&void 0!==e[n]||(e[n]=r[n]);return e}static clone(e,t){let r,n=e;if(e&&"object"==typeof e)if(O.isObject(e))for(r in n={},e)n[r]=O.clone(e[r]);else if(Array.isArray(e))for(n=[],r=e.length;r-- >0;)n[r]=O.clone(e[r]);else O.isDate(e)?n=new Date(e.getTime()):t&&(n=t(e));return n}static createTruthyKeys(e){const t=StringHelper.split(e),r=t&&{};if(t)for(const e of t)e&&(r[e]=!0);return r}static getPath(e,t){return t.split(".").reduce(((e,t)=>(e||{})[t]),e)}static hasPath(e,t){return t.split(".").every((t=>t in e&&(e=e[t],!0)))}static getTruthyKeys(e){const t=Object.keys(e);for(let r=t.length;r-- >0;)e[t[r]]||t.splice(r,1);return t}static getTruthyValues(e){const t=Object.keys(e);for(let r=t.length;r-- >0;)e[t[r]]?t[r]=e[t[r]]:t.splice(r,1);return t}static isClass(e){var t;return"function"==typeof e&&(null===(t=e.prototype)||void 0===t?void 0:t.constructor)===e}static isDate(e){return Boolean(e&&e.getUTCDate)&&"date"===O.typeOf(e)}static isPromise(e){if(Promise&&Promise.resolve)return Promise.resolve(e)===e;throw new Error("Promise not supported in your environment")}static isEmpty(e){if(e&&"object"==typeof e)for(const t in e)return!1;return!0}static isObject(e){const t=e&&e.constructor;return Boolean(t?t===Object||t.getPrototypeOf&&t.prototype&&!Object.getPrototypeOf(t.prototype):e&&"object"==typeof e)}static merge(e,...t){for(let r,n,i,s,o=0;o<t.length;o++)if(n=t[o],n)for(i in n)s=n[i],s&&O.isObject(s)?(r=e[i],r&&O.isObject(r)?(isFrozen(r)&&(e[i]=r=O.clone(r)),O.merge(r,s)):e[i]=isFrozen(s)?s:O.clone(s)):e[i]=s;return e}static setPath(e,t,r){return t.split(".").reduce(((e,t,n,i)=>n===i.length-1?e[t]=r:(e[t]instanceof Object||(e[t]={}),e[t])),e),e}static typeOf(e){let t,r,n=typeof e;return"object"===n?null===e?n="null":(r=toString.call(e),(n=typeCache[r])||(t=typeNameRe.exec(r),typeCache[r]=n=t?t[1].toLowerCase():r)):e!=e&&(n="nan"),n}}const O=Objects;Objects._$name="Objects";const{defineProperty:defineProperty,getOwnPropertyDescriptor:getOwnPropertyDescriptor}=Reflect,{hasOwnProperty:hasOwnProperty$1,toString:toString$1}=Object.prototype,instancePropertiesSymbol=Symbol("instanceProperties"),configuringSymbol=Symbol("configuring"),lazyConfigValues=Symbol("lazyConfigValues"),DATE_TYPE=toString$1.call(new Date);class Config{static get(e,t){const{cache:r}=this,n=r[e]||(r[e]=new Config(e));let i,s=n;return t&&(i=Config.makeCacheKey(e,t),(s=i&&r[i])||(s=n.extend(t),i&&(r[i]=s))),s}constructor(e){const t=this,r=e[0].toUpperCase()+e.substr(1);t.base=t,t.name=e,t.field="_"+e,t.capName=r,t.changer="change"+r,t.initializing="initializing"+r,t.updater="update"+r}get descriptor(){let e=this._descriptor;return e&&hasOwnProperty$1.call(this,"_descriptor")||(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return e&&hasOwnProperty$1.call(this,"_initDescriptor")||(this._initDescriptor=e=this.makeInitter()),e}equal(e,t){return e===t}extend(e){const t=Object.assign(Object.create(this),e),{equal:r,merge:n}=e,{equalityMethods:i}=Config;return"string"==typeof r&&(r.endsWith("[]")?t.equal=Config.makeArrayEquals(i[r.substr(0,r.length-2)]):t.equal=i[r]),"string"==typeof n&&(t.merge=Config.mergeMethods[n]),t}define(e){const t=getOwnPropertyDescriptor(e,this.name);let r=this.descriptor;t&&t.get&&(r=Object.assign({},r),r.get=t.get),defineProperty(e,this.name,r)}defineInitter(e,t){const{name:r}=this,n=e[instancePropertiesSymbol];let i,s;n[r]||!(s=getOwnPropertyDescriptor(e,r))||"value"in s||(n[r]=s),defineProperty(e,r,this.initDescriptor),this.lazy&&(i=e[lazyConfigValues]||(e[lazyConfigValues]={$counter_:0}),i[r]=t,++i.$counter_)}static makeArrayEquals(e){return(t,r)=>{let n,i=t&&r&&t.length===(n=r.length);if(i&&Array.isArray(t)&&Array.isArray(r))if(e)for(;i&&n-- >0;)i=e(t[n],r[n]);else for(;i&&n-- >0;)i=t[n]===r[n];else i=e?e(t,r):t===r;return i}}static makeCacheKey(e,t){const r=Object.keys(t).sort();for(let e,n,i,s=r.length;s-- >0;)if(i=t[e=r[s]],null==i&&!1===i)r.splice(s,1);else{if(n=typeof i,"function"===n)return null;"string"===n?r[s]=`${e}:"${i}"`:"number"===n&&(r[s]=`${e}:${i}`)}return r.length?`${e}>${r.join("|")}`:e}makeDescriptor(){const e=this,{base:t,field:r,changer:n,updater:i,name:s}=e;return t!==e&&t.equal===e.equal?t.descriptor:{get(){return this[r]},set(t){const o=this;let a=o[r];if("string"==typeof t&&t.startsWith("up.")){const e=o.resolveProperty(t.substr(3));"function"!=typeof e&&(t=e)}if(o[n]){if(void 0===(t=o[n](t,a)))return;a=o[r]}(e.equal===equal?a===t:e.equal(a,t))||(o[r]=t,o[i]&&o[i](t,a),o.onConfigChange.$nullFn||o.onConfigChange({name:s,value:t,was:a,config:e}))}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:t,name:r}=e;return{configurable:!0,get(){const n=this;return e.removeInitter(n),n[t]=!0,n[r]=n[configuringSymbol][r],n[t]=!1,n.configDone[r]=!0,n[r]},set(t){e.removeInitter(this),this.configDone[r]=!0,this[r]=t}}}makeLazyInitter(){const e=this,{initializing:t,name:r}=e;return{configurable:!0,get(){const n=this,i=n[lazyConfigValues][r];return e.removeInitter(n),n[t]=!0,n[r]=i,n[t]=!1,n[r]},set(t){e.removeInitter(this),this[r]=t}}}removeInitter(e){const{name:t}=this,r=e[instancePropertiesSymbol][t];r?defineProperty(e,t,r):delete e[t],this.lazy&&(--e[lazyConfigValues].$counter_||delete e[lazyConfigValues])}merge(e,t){return t&&e&&Objects.isObject(t)&&Objects.isObject(e)&&(e=Objects.merge(Objects.clone(t),e)),e}}const{prototype:prototype}=Config,{equal:equal}=prototype;Config.symbols={configuring:configuringSymbol,instanceProperties:instancePropertiesSymbol},Config.cache=Object.create(null),Config.equalityMethods={array:Config.makeArrayEquals(),date:(e,t)=>e===t||!(!e||!t||toString$1.call(e)!==DATE_TYPE||toString$1.call(t)!==DATE_TYPE)&&e.getTime()===t.getTime(),strict:Config.equal=equal},Config.mergeMethods={distinct(e,t){const r=t?t.slice():[];return null!=e&&(Array.isArray(e)?e:[e]).forEach((e=>!r.includes(e)&&r.push(e))),r},merge:Config.merge=prototype.merge,objects:(e,t)=>!0===e?t||{}:Config.merge(e,t),replace:e=>e},Object.assign(prototype,{_descriptor:null,_initDescriptor:null,lazy:!1,nullify:!1,render:!1}),Config._$name="Config";class MetaClass{constructor(e){e&&Object.assign(this,e)}getInherited(e){var t;return this[e]||(this[e]=Object.create((null===(t=this.super)||void 0===t?void 0:t.getInherited(e))||null))}}const{getPrototypeOf:getPrototypeOf}=Object,{defineProperty:defineProperty$1}=Reflect,{hasOwnProperty:hasOwnProperty$2}=Object.prototype,metaSymbol=Symbol("classMetaData"),mixinTagSymbol=Symbol("mixinTag"),originalConfigSymbol=Symbol("originalConfig"),configuringSymbol$1=Config.symbols.configuring,instancePropertiesSymbol$1=Config.symbols.instanceProperties,defaultConfigOptions={merge:"replace",simple:!0},emptyFn=()=>{},newMeta=e=>new MetaClass(e),setupNames={};class Base{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const t=this,r=t.constructor;t.$meta.class!==r&&r.$meta,t.construct(...e),t.afterConstruct()}construct(...e){null!==e[0]&&this.configure(...e),this.afterConfigure()}static destroy(...e){e.forEach((e=>{e&&e.destroy&&!e.isDestroyed&&e.destroy()}))}destroy(){const e=this;e.isDestroying=!0,e.destroy=emptyFn,e.doDestroy(),Object.setPrototypeOf(e,null);for(const t in e)"destroy"!==t&&"isDestroying"!==t&&delete e[t];delete e[originalConfigSymbol],e.isDestroyed=!0}_thisIsAUsedExpression(e){}static get $$name(){return hasOwnProperty$2.call(this,"$name")&&this.$name||hasOwnProperty$2.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,t,r){"this"===t&&(t=this);const{handler:n,thisObj:i}=this.resolveCallback(e,t);return r?n.apply(i,r):n.call(i)}resolveProperty(e){let t=this;for(;t;){if(Objects.hasPath(t,e))return Objects.getPath(t,e);t=t.owner}}resolveCallback(e,t=this,r=!0){if(e.substr){if(e.startsWith("up.")){for(e=e.substr(3),t=this.owner;t&&!t[e];t=t.owner);if(!t)return}else e.startsWith("this.")&&(e=e.substr(5),t=this);if(!(t&&t instanceof Object))return;if("function"!=typeof t[e])return;e=t[e]}return{handler:e,thisObj:t}}bindCallback(e,t=this){if(e){const{handler:r,thisObj:n}=this.resolveCallback(e,t);if(r)return r.bind(n)}}delay(e,t){e=this.setTimeout?e:e.bind(this);(this.setTimeout?this:window)["number"==typeof t?"setTimeout":"requestAnimationFrame"](e,t)}doDestroy(){const{nullify:e}=this.$meta;if(e)for(let t=0;t<e.length;++t)this[e[t].name]=null}destroyProperties(...e){const t=this;let r,n;for(r of e)!(r in t)||t[configuringSymbol$1]&&t[configuringSymbol$1][r]||(n=t[r],n&&n.destroy&&n.destroy(),delete t[r])}configure(e={}){const t=this,{beforeConfigure:r}=e,n=t.$meta.configs,i=t.getDefaultConfiguration();let s,o,a;for(o in t.initialConfig=e,t.isConfiguring=!0,Object.assign(t,t.getProperties()),e)a=e[o],s=n[o],i[o]=s?s.merge(a,i[o],null):a;r&&(delete i.beforeConfigure,r(t,i)),t.setConfig(t[originalConfigSymbol]=i,!0),t.isConfiguring=!1}getConfig(e){return this[e]}setConfig(e,t){const r=this,n=r[configuringSymbol$1],i=n?r.configDone:r.configDone={},s=r.$meta.configs;let o,a;for(a in r[instancePropertiesSymbol$1]={},r[configuringSymbol$1]=n?Object.setPrototypeOf(Object.assign({},e),n):e,e)null!=e[a]||hasOwnProperty$2.call(e,a)?(o=s[a]||Config.get(a),o.defineInitter(r,e[a]),t?o.lazy&&(i[a]=!0):i[a]=!1):i[a]=!0;for(a in t&&r.startConfigure(e),e)i[a]||(r[a]=e[a]);return n?r[configuringSymbol$1]=n:delete r[configuringSymbol$1],t&&r.finishConfigure(e),r}triggerConfig(e){const{configDone:t}=this,r=this[configuringSymbol$1],n=r&&(null!=r[e]||hasOwnProperty$2.call(r,e))?!t[e]:null;return n&&this.getConfig(e),n}onConfigChange(){}get config(){const e={},t=this[originalConfigSymbol];for(const r in t)e[r]=t[r];return e}static initClass(){return this.$meta.class}static get $meta(){const e=this;let t=e[metaSymbol];return hasOwnProperty$2.call(e,metaSymbol)||(e[metaSymbol]=t=newMeta(),t.class=e,e.setupClass(t)),t}static onClassMixedIn(){}static mergeConfigs(e,...t){const r=this.$meta.configs,n=Objects.clone(e)||{};let i,s,o,a;for(s=0;s<t.length;++s)if(i=t[s],i)for(o in i)a=i[o],r[o]?a=r[o].merge(a,n[o]):n[o]&&a&&(a=Config.merge(a,n[o])),n[o]=a;return n}static mixin(...e){let t,r=this;for(t=0;t<e.length;++t){const n=e[t],i=n[mixinTagSymbol]||(n[mixinTagSymbol]=Symbol("mixinTag"));r[i]||(r=n(r),r[i]=!0,hasOwnProperty$2.call(r,"onClassMixedIn")&&r.onClassMixedIn())}return r}static setupClass(e){var t;const r=e.class,n=getPrototypeOf(r).$meta,i=r.$$name,s=n.names,o=r.prototype;if(defineProperty$1(o,"$meta",{value:e}),Object.assign(e,{super:n,config:Object.create(n.config),configs:Object.create(n.configs),declarables:n.declarables,forkConfigs:n.forkConfigs,hierarchy:Object.freeze([...n.hierarchy,r]),names:s.includes(i)?s:Object.freeze([...s,i]),properties:n.properties,nullify:null===(t=n.nullify)||void 0===t?void 0:t.slice()}),s!==e.names){const e="is"+i;hasOwnProperty$2.call(o,e)||defineProperty$1(o,e,{value:!0}),hasOwnProperty$2.call(r,e)||defineProperty$1(r,e,{value:!0})}for(let t,n,i=0;i<e.declarables.length;++i)t=e.declarables[i],hasOwnProperty$2.call(r,t)&&(n=setupNames[t]||(setupNames[t]="setup"+StringHelper.capitalize(t)),r[n](r,e))}static setupConfigs(e,t,r){const n=e.config,i=e.configs,s=e.class.prototype;let o,a,l,c,d;for(const u in t)c=t[u],r?(o=i[u])?c=o.merge(c,n[u],e):o=Config.get(u,defaultConfigOptions):(l=null,c&&"object"==typeof c&&"$config"in c&&(l=c.$config,l&&!Objects.isObject(l)&&(l=Objects.createTruthyKeys(l)),"default"in c&&defineProperty$1(s,Config.get(u).field,{configurable:!0,writable:!0,value:c.default}),c=c.value),(o=i[u])?(d=o.nullify,l&&(o=o.extend(l)),c=o.merge(c,n[u],e)):(o=Config.get(u,l),o.define(e.class.prototype),d=!1),o.nullify&&!d&&(a||(e.nullify=a=[])).push(o)),c&&(Objects.isObject(c)||Array.isArray(c))&&!Object.isFrozen(c)&&(e.forkConfigs=!0),i[u]=o,n[u]=c}static setupConfigurable(e,t){e.setupConfigs(t,e.configurable,!1)}static setupDefaultConfig(e,t){e.setupConfigs(t,e.defaultConfig,!0)}static setupDeclarable(e,t){const r=e.declarable;let n,i,s=t.declarables;for(i=0;i<r.length;++i)s.includes(r[i])||(n||(t.declarables=n=s=s.slice()),s.push(r[i]))}static setupProperties(e,t){t.properties=t.super.properties.slice(),t.properties.push(e),Object.freeze(t.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.$meta,t=e.forkConfigs?Base.fork(e.config):Object.create(e.config);if(VersionHelper.isTestEnv&&BrowserHelper.isBrowserEnv&&t.testConfig&&BrowserHelper.global.__applyTestConfigs)for(const e in t.testConfig)t[e]=t.testConfig[e];return t}static fork(e){let t,r,n=e;if(e&&Objects.isObject(e)&&!Object.isFrozen(e))for(t in n=Object.create(e),e)r=e[t],r&&(Objects.isObject(r)?n[t]=Base.fork(r):Array.isArray(r)&&(n[t]=r.slice()));return n}getProperties(){const e=this.$meta.properties,t={};for(let r=0;r<e.length;r++)Object.assign(t,e[r].properties);return t}static get superclass(){return getPrototypeOf(this)}classHierarchy(e){const t=this.$meta.hierarchy,r=e?t.indexOf(e):0;return r>0?t.slice(r):t}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(e){let t=this.$detachers;if(t=t&&t[e],t)for(;t.length;)t.pop()()}trackDetacher(e,t){const r=this.$detachers||(this.$detachers={});(r[e]||(r[e]=[])).push(t)}untrackDetachers(e){const t=this.$detachers;if(t)for(const r in t){const n=t[r];for(let t=n.length;t-- >0;)n[t].eventer===e&&n.splice(t,1)}}}const proto=Base.prototype;proto.onConfigChange.$nullFn=!0,Base[metaSymbol]=proto.$meta=newMeta({class:Base,config:Object.freeze({}),configs:Object.create(null),declarables:Base.declarable,forkConfigs:!1,hierarchy:Object.freeze([Base]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null}),Object.assign(proto,{$detachers:null,isDestroyed:!1,isDestroying:!1}),VersionHelper.setVersion("core","0.0.0"),Base._$name="Base";class ArrayHelper{static clean(e){return e.reduce(((e,t)=>(null==t||Array.isArray(t)&&0===t.length||""===t||e.push(t),e)),[])}static remove(e,...t){let r,n,i=!1;for(let s=0;s<t.length;s++)n=t[s],-1!==(r=e.indexOf(n))&&(e.splice(r,1),i=!0);return i}static findInsertionIndex(e,t,r=this.lexicalCompare,n){const i=t.length;let s,o;return n<i&&(s=n>0?r(t[n-1],e):0,o=n<i-1?r(e,t[n]):0,s<1&&o<1)?n:this.binarySearch(t,e,r)}static findLast(e,t,r){for(let{length:n}=e,i=n-1;i>=0;i--)if(t.call(r,e[i],i,e))return e[i]}static binarySearch(e,t,r=0,n=e.length,i=this.lexicalCompare){const s=e.length;let o,a;for(r instanceof Function?(i=r,r=0):n instanceof Function&&(i=n,n=s),--n;r<=n;)o=r+n>>1,a=i(t,e[o]),a>=0?r=o+1:a<0&&(n=o-1);return r}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return(e=String(e))<(t=String(t))?-1:e>t?1:0}static fill(e,t={},r=null){const n=[],i=Array.isArray(t)?t:[t];for(let t=0;t<e;t++)for(const e of i){const i=Object.assign({},e);r&&r(i,t),n.push(i)}return n}static populate(e,t){const r=[];for(let n=0;n<e;n++)r.push(t(n));return r}static include(e,t){e.includes(t)||e.push(t)}static unique(e){return[...new Set(e)]}static allowNegative(e){return new Proxy(e,{get(e,t,r){if("string"!=typeof t)return Reflect.get(e,t,r);const n=Number(t);return Number.isNaN(n)?Reflect.get(e,t,r):e[n<0?e.length+n:n]},set(e,t,r,n){if("string"!=typeof t)return Reflect.set(e,t,r,n);const i=Number(t);return Number.isNaN(i)?Reflect.set(e,t,r,n):(e[i<0?e.length+i:i]=r,!0)}})}static delta(e,t,r=!1){if(!t)return r?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const n=[],i=[],s=[];for(let r=0;r<e.length;r++){const i=e[r];t.includes(i)?s.push(i):n.push(i)}for(let e=0;e<t.length;e++){const r=t[e];s.includes(r)||i.push(r)}return r?{toAdd:n,toRemove:i,toKeep:s}:{onlyInA:n,onlyInB:i,inBoth:s}}}ArrayHelper._$name="ArrayHelper";const{hasOwnProperty:hasOwnProperty$3}=Object.prototype;class FunctionHelper{static after(e,t,r,n,i){const s="string"==typeof r,o=!1!==(null==i?void 0:i.return),a=(...t)=>{const i=a.$nextHook.call(e,...t),l=(null==n?void 0:n.isDestroyed)?void 0:o?s?n[r](i,...t):r.call(n,i,...t):s?n[r](...t):r.call(n,...t);return void 0===l?i:l};return FunctionHelper.hookMethod(e,t,a)}static before(e,t,r,n){const i="string"==typeof r,s=(...t)=>{const o=(null==n?void 0:n.isDestroyed)?0:i?n[r](...t):r.call(n,...t);return!1===o?o:s.$nextHook.call(e,...t)};return FunctionHelper.hookMethod(e,t,s)}static curry(e){return function t(...r){return r.length>=e.length?e.apply(this,r):function(...e){return t.apply(this,r.concat(e))}}}static bindAll(e){for(let t in e)"function"==typeof e[t]&&(e[t]=e[t].bind(e))}static createInterceptor(e,t,r){return(...n)=>!1!==t.call(r,...n)&&e.call(r,...n)}static createSequence(e,t,r){return(...n)=>{const i=e.call(r,...n),s=t.call(r,...n);return void 0===s?i:s}}static createThrottled(e,t,r,n,i){let s,o,a,l=0;const c=()=>{o=0,l=performance.now(),s.push.apply(s,n),e.apply(r,s)};return a=function(...e){let a=performance.now()-l;s=e,a>=t?(clearTimeout(o),c()):(o||(o=setTimeout(c,t-a)),i&&(s.push.apply(s,n),i.apply(r,s)))},a.cancel=()=>clearTimeout(o),a}static createBuffered(e,t,r,n){let i,s,o;const a=()=>{s=0,o.isPending=!1,i.push.apply(i,n),e.apply(r,i)};return o=function(...e){i=e,s&&clearTimeout(s),o.isPending=!0,s=setTimeout(a,t)},o.cancel=()=>{o.isPending=!1,clearTimeout(s)},o}static hookMethod(e,t,r){return r.$nextHook=e[t],e[t]=r,()=>{if(hasOwnProperty$3.call(e,t)){let s,o=e[t];var n;if(o===r)(null===(n=Object.getPrototypeOf(e))||void 0===n?void 0:n[t])===r.$nextHook?delete e[t]:e[t]=r.$nextHook;else for(;s=null===(i=o)||void 0===i?void 0:i.$nextHook;o=s){var i;if(s===r){o.$nextHook=r.$nextHook;break}}}}}static returnTrue(){return!0}static animate(e,t,r,n="linear"){let i=!1;const s=new Promise((s=>{const o=performance.now(),a=()=>{const l=Math.min((performance.now()-o)/e,1),c=r&&r.setTimeout?r:window;i||!1===t.call(r,this.easingFunctions[n](l))&&s(),i||1===l?c.requestAnimationFrame((()=>s())):c.requestAnimationFrame(a)};a()}));return s.cancel=()=>(i=!0,!1),s}}const half=.5,e1=1.70158,e2=7.5625,e3=1.525,e4=2/2.75,e5=2.25/2.75,e6=1/2.75,e7=1.5/2.75,e8=2.5/2.75,e9=2.625/2.75,e10=.75,e11=.9375,e12=.984375;FunctionHelper.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=.5)<1?.5*Math.pow(e,2):-.5*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=.5)<1?.5*Math.pow(e,5):.5*(Math.pow(e-2,5)+2),easeInSine:e=>1-Math.cos(e*(Math.PI/2)),easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-.5*(Math.cos(Math.PI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e)),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<e6?e2*e*e:e<e4?e2*(e-=e7)*e+e10:e<e8?e2*(e-=e5)*e+e11:e2*(e-=e9)*e+e12,easeInBack:e=>e*e*((e1+1)*e-e1),easeOutBack:e=>(e-=1)*e*((e1+1)*e+e1)+1,easeInOutBack:e=>{let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=e3))*e-t)*.5:.5*((e-=2)*e*((1+(t*=e3))*e+t)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=e3))*e-t)*.5:.5*((e-=2)*e*((1+(t*=e3))*e+t)+2)},swingFrom:e=>e*e*((e1+1)*e-e1),swingTo:e=>(e-=1)*e*((e1+1)*e+e1)+1,bounce:e=>e<e6?e2*e*e:e<e4?e2*(e-=e7)*e+e10:e<e8?e2*(e-=e5)*e+e11:e2*(e-=e9)*e+e12,bouncePast:e=>e<e6?e2*e*e:e<e4?2-(e2*(e-=e7)*e+e10):e<e8?2-(e2*(e-=e5)*e+e11):2-(e2*(e-=e9)*e+e12),easeFromTo:e=>(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},FunctionHelper._$name="FunctionHelper";const{isArray:isArray}=Array,specialProperties={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,name:1,_oldDestructor:1},priorityComparator=(e,t)=>t.prio-e.prio;var Events=e=>class t extends(e||Base){static get $name(){return"Events"}static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(e,t){const r=t.getInherited("deprecatedEvents"),n=e.deprecatedEvents;for(const e in n)r[e.toLowerCase()]=r[e]=n[e]}static get configurable(){return{listeners:{value:null,$config:{merge(e,t){if(null!==e){if(!e)return t;t&&(e=e?[e]:[]).push[isArray(t)?"apply":"call"](e,t)}return e}}}}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(e,...t){var r;(this.configuredListeners=null===(r=e)||void 0===r?void 0:r.listeners)&&delete(e={...e}).listeners,super.construct(e,...t),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const e=this,{isConfiguring:t}=e;e.isConfiguring=!1,e.listeners=e.configuredListeners,e.configuredListeners=null,e.isConfiguring=t}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(),super.doDestroy()}static setupClass(e){super.setupClass(e),["onListen","onUnlisten"].forEach((e=>t.prototype[e].$nullFn=!0))}addListener(e,t,r){if(isArray(e)){for(let r=0,{length:n}=e;r<n;r++)this.addListener(e[r],t);return}const n=this,i=n.$meta.getInherited("deprecatedEvents");if("string"==typeof e)return n.addListener({[e]:t,detachable:!1!==t.detachable,thisObj:r});{t=void 0!==e.thisObj?e.thisObj:t;for(const r in e)if(!specialProperties[r]){const s=r.toLowerCase(),o=null==i?void 0:i[s],a=n.eventListeners||(n.eventListeners={}),l=e[r],c=l.expires||e.expires,d={fn:"object"==typeof l?l.fn:l,thisObj:void 0!==l.thisObj?l.thisObj:t,args:l.args||e.args,prio:void 0!==l.prio?l.prio:void 0!==e.prio?e.prio:0,once:void 0!==l.once?l.once:void 0!==e.once&&e.once,catchAll:"catchAll"===r};if(o){const{product:e,invalidAsOfVersion:t,message:r}=o;VersionHelper.deprecate(e,t,r)}if(c){const e=n.isDelayable?n:window,{alt:r}=c,i=r?c.delay:c;e["number"==typeof i?"setTimeout":"requestAnimationFrame"]((()=>{n.un(s,d),r&&!d.called&&n.callback(r,t)}),i)}let u=a[s]||(a[s]=[]);u.$firing&&(a[s]=u=u.slice()),u.splice(ArrayHelper.findInsertionIndex(d,u,priorityComparator,u.length),0,d),!n.onListen.$nullFn&&u.length<2&&n.onListen(s)}e.relayAll&&n.relayAll(e.relayAll),t&&n.attachAutoDetacher(e,t);const r=!1!==e.detachable,o=e.name,a=e.expires||r||o?()=>{n.isDestroyed||n.removeListener(e,t)}:null;var s;if(a)if(a.eventer=n,a.listenerName=o,o&&(null===(s=t)||void 0===s?void 0:s.trackDetacher)&&t.trackDetacher(o,a),e.expires&&n.delay(a,e.expires),r)return a}}on(...e){return this.addListener(...e)}un(...e){this.removeListener(...e)}get listeners(){return this.eventListeners}changeListeners(e){if(!this.isConfiguring)return e&&!("thisObj"in e)&&(e=Objects.assign({thisObj:this},e)),e;e&&this.on(e,this)}updateListeners(e,t){t&&this.un(t),e&&this.on(e)}removeListener(e,t=e.thisObj,r){const n=this;if("string"==typeof e)return n.removeListener({[e]:t},r);Object.entries(e).forEach((([e,r])=>{if(!specialProperties[e]){e=e.toLowerCase();const i=n.eventListeners,s=n.findListener(e,r,t);if(s>=0){let t=i[e];t.length>1?(t.$firing&&(i[e]=t=t.slice()),t.splice(s,1)):(delete i[e],n.onUnlisten.$nullFn||n.onUnlisten(e))}}})),e.thisObj&&!e.thisObj.isDestroyed&&n.detachAutoDetacher(e)}findListener(e,t,r){var n;const i=null===(n=this.eventListeners)||void 0===n?void 0:n[e],s=t.fn||t,o=t.thisObj||r;if(i)for(let e,t=0,{length:r}=i;t<r;t++)if(e=i[t],e.fn===s&&e.thisObj===o)return t;return-1}hasListener(e){var t;return Boolean(null===(t=this.eventListeners)||void 0===t?void 0:t[null==e?void 0:e.toLowerCase()])}relayAll(e,t,r=!0){(this.relayAllTargets||(this.relayAllTargets=[])).push({through:e,prefix:t,transformCase:r})}removeAllListeners(){const e=this.eventListeners;let t,r;for(const i in e){const s=e[i];for(t=s.length;t-- >0;){var n;const e=s[t];this.removeListener(i,e),r=e.thisObj,(null===(n=r)||void 0===n?void 0:n.untrackDetachers)&&r.untrackDetachers(this)}}}relayEvents(e,t,r=""){const n={detachable:!0};return t.forEach((e=>{n[e]=(e,...t)=>this.trigger(r+e.type,e,...t)})),e.on(n)}onListen(){}onUnlisten(){}attachAutoDetacher(e,t){const r=e.thisObj||t,n="doDestroy"in r?"doDestroy":"destroy";if(n in r){let{$autoDetachers:t}=r;t||(r[n]=FunctionHelper.createInterceptor(r[n],(()=>{for(let e=0;e<t.length;e++){const{dispatcher:n,config:i}=t[e];n.isDestroyed||n.removeListener(i,r)}}),r),r.$autoDetachers=t=[]),t.push({config:e,dispatcher:this})}else r[n]=()=>{this.removeListener(e)}}detachAutoDetacher(e){const t=e.thisObj,r="doDestroy"in t?"doDestroy":"destroy";e._oldDestructor&&(t[r]=e._oldDestructor)}await(e,t={checkLog:!0,resetLog:!0,args:null}){const r=this;!1===t&&(t={checkLog:!1});const{args:n}=t;return new Promise((i=>{var s;if(t.checkLog&&(null===(s=r._triggered)||void 0===s?void 0:s[e])&&(i(),t.resetLog&&r.clearLog(e)),n){const s=r.on({[e]:(...o)=>{Object.keys(n).every((e=>e in o[0]&&o[0][e]===n[e]))&&(i(...o),t.resetLog&&r.clearLog(e),s())},prio:-1e4})}else r.on({[e]:(...n)=>{i(...n),t.resetLog&&r.clearLog(e)},prio:-1e4,once:!0})}))}clearLog(e){this._triggered&&(e?delete this._triggered[e]:this._triggered={})}callPreventable(e,t,r,n=[],i=!1){const s=this;if(!i&&!1===s.trigger("before"+StringHelper.capitalize(e),t))return!1;const o=r(t,...n);return i||s.trigger(e,t),o}trigger(e,t){var r,n;const i=this,s=e.toLowerCase(),{eventsSuspended:o,relayAllTargets:a,callOnFunctions:l,owner:c}=i;let d=null===(r=i.eventListeners)||void 0===r?void 0:r[s];if(i._triggered||(i._triggered={}),i._triggered[e]=!0,o)return o.shouldQueue&&o.queue.push(arguments),!0;if((null===(n=i.eventListeners)||void 0===n?void 0:n.catchall)&&((d=d?d.slice():[]).push(...i.eventListeners.catchall),d.sort(priorityComparator)),!d&&!a&&!l)return!0;if(t?"source"in t||(Object.isExtensible(t)?t.source=i:t=Object.setPrototypeOf({source:i},t)):t={source:i},t.type!==s&&(t.constructor!==Object?Reflect.defineProperty(t,"type",{get:()=>s}):t.type=s),l){const r="on"+StringHelper.capitalize(e);if(r in i&&(i.callback(i[r],i,[t]),!i.isDestroyed&&Object.prototype.hasOwnProperty.call(i,r)&&(!i.pluginFunctionChain||!i.pluginFunctionChain[r]))){const e=Object.getPrototypeOf(i);if(r in e&&(e[r].call(i,t),i.isDestroyed))return}}if(d){let e,r,n,o=0;for(d.$firing=!0;o<d.length&&!i.isDestroyed&&!1!==n;o++){e=d[o];let a=e.thisObj;if(!a||!a.isDestroyed){if(e.called=!0,e.once&&i.removeListener(s,e),"string"==typeof e.fn){if(a&&(r=a[e.fn]),!r){const t=i.resolveCallback(e.fn);r=t.handler,a=t.thisObj}}else r=e.fn;n=e.args?r.call(a||i,...e.args,t):r.call(a||i,t)}}if(d.$firing=!1,!1===n)return n}return a&&a.forEach((r=>{let n=e;if(r.transformCase&&(n=StringHelper.capitalize(n)),r.prefix&&(n=r.prefix+n),!1===r.through.trigger(n,t))return!1})),!(t.bubbles&&c&&!c.isDestroyed)||c.trigger(e,t)}suspendEvents(e=!1){(this.eventsSuspended||(this.eventsSuspended={shouldQueue:e,queue:[],count:0})).count++}resumeEvents(){const e=this.eventsSuspended;if(e&&0==--e.count&&(this.eventsSuspended=null,e.shouldQueue))for(const t of e.queue)this.trigger(...t);return!Boolean(this.eventsSuspended)}};const paramValueRegExp=/^(\w+)=(.*)$/,resourceRoot=BrowserHelper.queryString.__resourceRoot||"",parseParams=function(e){const t={},r=e.split("&");for(const e of r){const[r,n,i]=paramValueRegExp.exec(e),s=decodeURIComponent(n),o=decodeURIComponent(i);if(r){let e=t[s];e?(Array.isArray(e)||(e=t[s]=[e]),e.push(o)):t[s]=o}}return t};class AjaxHelper{static get(e,t){return this.fetch(e,t)}static post(e,t,r={}){return t instanceof FormData||"string"==typeof t||(t=JSON.stringify(t),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:t},r))}static fetch(e,t={}){const r=new AbortController;if(Object.assign(t,{abortController:r,signal:r.signal}),"credentials"in t||(t.credentials="include"),t.queryParams){const r=Object.entries(t.queryParams);r.length&&(e+=(e.includes("?")?"&":"?")+r.map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("&"))}const n=new Promise(((r,i)=>{fetch(resourceRoot+e,t).then((e=>{t.parseJson?e.json().then((t=>{e.parsedJson=t,r(e)})).catch((t=>{e.parsedJson=null,e.error=t,i(e)})):r(e)})).catch((e=>{e.stack=n.stack,"AbortError"!==e.name&&i(e)}))}));return n.stack=(new Error).stack,n.abort=function(){r.abort()},n}static mockUrl(e,t){const r=this;(r.mockAjaxMap||(r.mockAjaxMap={}))[e]=t,AjaxHelper.originalFetch||(AjaxHelper.originalFetch=AjaxHelper.fetch),AjaxHelper.fetch=r.mockAjaxFetch.bind(r)}static mockAjaxFetch(e,t){let r=e.split("?"),n=this.mockAjaxMap[r[0]],i=null;if(n){"function"==typeof n&&(n=n(r[0],r[1]&&parseParams(r[1]),t));try{i=t.parseJson&&JSON.parse(n.responseText)}catch(e){i=null,n.error=e}return n=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:i,text:()=>new Promise((e=>{e(n.responseText)})),json:()=>new Promise((e=>{e(i)}))},n),new Promise((function(e,t){n.synchronous?e(n):setTimeout((function(){e(n)}),"delay"in n?n.delay:100)}))}return AjaxHelper.originalFetch(e,t)}}AjaxHelper._$name="AjaxHelper";class LocaleHelper{static mergeLocales(...e){const t={};return e.forEach((e=>{Object.keys(e).forEach((r=>{"object"==typeof e[r]?t[r]={...t[r],...e[r]}:t[r]=e[r]}))})),t}static trimLocale(e,t){const r=(t,r)=>{if(!e[t])throw new Error(`Key "${t}" doesn't exist in locale`);if(r){if(!e[t][r])throw new Error(`SubKey "${t}.${r}" doesn't exist in locale`);delete e[t][r]}else delete e[t]};Object.keys(t).forEach((e=>{Array.isArray(t[e])?t[e].forEach((t=>r(e,t))):r(e)}))}static publishLocale(e,t){const r=window.bryntum=window.bryntum||{},n=r.locales=r.locales||{};n[e]=n[e]?this.mergeLocales(n[e],t):t}}LocaleHelper._$name="LocaleHelper";class LocaleManager extends(Events(Base)){static get defaultConfig(){return{locales:{},throwOnMissingLocale:VersionHelper.isTestEnv}}construct(...e){const t=this;super.construct(...e);const r=document.querySelector("script[data-default-locale]");r&&(t.defaultLocaleName=r.dataset.defaultLocale),BrowserHelper.isBrowserEnv&&window.bryntum&&window.bryntum.locales&&(Object.keys(window.bryntum.locales).forEach((e=>{if(!e.startsWith("moment")){const r=window.bryntum.locales[e];r.extends?t.extendLocale(r.extends,r):r.localeName&&t.registerLocale(r.localeName,{desc:r.localeDesc,locale:r})}})),t.locale||"En"!==t.defaultLocaleName&&t.applyLocale(t.defaultLocaleName||Object.keys(t.locales)[0]))}set locales(e){this._locales=e}get locales(){return this._locales}set locale(e){"string"==typeof e?this.applyLocale(e):(e.locale||(e={locale:e,localeName:e.localeName||"custom"}),this.registerLocale(e.localeName,e),this.applyLocale(e.localeName))}get locale(){return this._locale}registerLocale(e,t){const r=this,n=r.defaultLocaleName===e,i=r.locale&&r.locale.localeName===e,s=0===Object.keys(r.locales).length;r.locales[e]?r.locales[e].locale=LocaleHelper.mergeLocales(r.locales[e].locale,t.locale):r.locales[e]=t,(n||!r.defaultLocaleName&&(s||i))&&r.internalApplyLocale(r.locales[e])}extendLocale(e,t){var r;const n=this.locales[e];return!!n&&(n.locale=LocaleHelper.mergeLocales(n.locale,t),delete n.locale.extends,(null===(r=this.locale)||void 0===r?void 0:r.localeName)===e&&this.applyLocale(e),!0)}internalApplyLocale(e){this._locale=e.locale,this.trigger("locale",e)}applyLocale(e,t=!1,r=!1){const n=this,i=n.locales[e];if(i&&i.locale&&n._locale===i.locale&&!t)return!0;if(!i){if(r)return!0;throw new Error(`Locale ${e} not registered`)}function s(){n.internalApplyLocale(i)}return i.locale?(s(),!0):new Promise(((t,r)=>{n.loadLocale(i.path).then((r=>{r.text().then((r=>{new Function(r)(),BrowserHelper.isBrowserEnv&&(i.locale=window.bryntum.locales[e]),s(),t(i)}))})).catch((e=>r(e)))}))}loadLocale(e){return AjaxHelper.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}}const LocaleManagerSingleton=new LocaleManager,ObjectProto=Object.getPrototypeOf(Object),localeRe=/L{.*?}/g,escape$1=e=>e.replace(/{(\d+)}/gm,"[[$1]]"),unescape=e=>e.replace(/\[\[(\d+)]]/gm,"{$1}");var Localizable=e=>class t extends(e||Base){static get $name(){return"Localizable"}static get configurable(){return{localeClass:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(e){var t,r;return"string"==typeof e?e:e===ObjectProto?"Object":e.$$name||e.name||(null===(t=e.prototype)||void 0===t?void 0:t.$$name)||(null===(r=e.prototype)||void 0===r?void 0:r.name)}static parseLocaleString(e){var t;const r=[];let n;if(null===(t=e)||void 0===t?void 0:t.includes("L{")){const t=/L{(.*?)}/g;for(e=e.replace(/{(\d+)}/gm,"[[$1]]");null!=(n=t.exec(e));){const e=/((.*?)\.)?(.+)/g.exec(n[1]);r.push({match:unescape(n[0]),localeKey:unescape(e[3]),localeClass:e[2]})}}return r.length>0?r:[{match:e,localeKey:e,localeClass:void 0}]}construct(e={},...t){super.construct(e,...t),LocaleManagerSingleton.on("locale",this.updateLocalization,this),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(e){var r;const n=this,i=Objects.getPath(n,e),s=null===(r=n.$meta.configs[e])||void 0===r?void 0:r.localeKey;if(s){const r=t.localize(s,null,n.localeClass||n);r&&!(e in n.initialConfig)&&Objects.setPath(n,e,r)}else if("string"==typeof i){n.originalLocales=n.originalLocales||{};let t=Objects.getPath(n.originalLocales,e);void 0===t&&(Objects.setPath(n.originalLocales,e,i),t=i),t&&Objects.setPath(n,e,n.optionalL(t))}}updateLocalization(){var e;null===(e=this.localizableProperties)||void 0===e||e.forEach(this.localizeProperty,this)}static getTranslation(e,r,n){const{locale:i}=LocaleManagerSingleton;let s,o,a=null;if(i)for(const{match:l,localeKey:c,localeClass:d}of this.parseLocaleString(e)){const u=t=>{var n;const s=null===(n=i[t])||void 0===n?void 0:n[c];return s&&(a="function"==typeof s?null!=r?s(r):s:"object"==typeof s||e===l?s:(a||e).replace(l,s)),s};let h=!1;for(o=n;o&&(s=t.clsName(o))&&!(h=u(s))&&"string"!=typeof o;o=Object.getPrototypeOf(o));!h&&d&&u(d)}return a}static localize(e,r,...n){var i;0===(null===(i=n)||void 0===i?void 0:i.length)&&(n=[this]);let s=null;return n.some((n=>(s=t.getTranslation(e,r,n),null!=s))),s}static L(e,r,...n){var i;0===(null===(i=n)||void 0===i?void 0:i.length)&&(n=[this]);const s=this.localize(e,r,...n);if(LocaleManagerSingleton.throwOnMissingLocale&&LocaleManagerSingleton.locale&&null==s)throw new Error(`Localization is not found for '${e}' in '${n.map((e=>t.clsName(e))).join(", ")}'. ${LocaleManagerSingleton.locale.localeName?"Locale : "+LocaleManagerSingleton.locale.localeName:""}`);return null!=s?s:e}L(e,r){const{localeClass:n,constructor:i}=this;return n&&t.clsName(n)!==t.clsName(i)?t.L(e,r,n,i):t.L(e,r,i)}static optionalL(e,r,...n){var i;const s=LocaleManagerSingleton.throwOnMissingLocale;LocaleManagerSingleton.throwOnMissingLocale=s&&localeRe.test(e),0===(null===(i=n)||void 0===i?void 0:i.length)&&(n=[this]);const o=t.L(e,r,...n);return LocaleManagerSingleton.throwOnMissingLocale=s,o}optionalL(e,t){const r=LocaleManagerSingleton.throwOnMissingLocale;LocaleManagerSingleton.throwOnMissingLocale=r&&localeRe.test(e);const n=this.L(e,t);return LocaleManagerSingleton.throwOnMissingLocale=r,n}get localeManager(){return LocaleManagerSingleton}};const{toString:toString$2}=Object.prototype,DATE_TYPE$1=toString$2.call(new Date),enOrdinalSuffix=e=>e+({1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"),LTRSymbolRegexp=new RegExp("‎","g"),defaultValue=(e,t)=>isNaN(e)||null==e?t:e,useIntlFormat=(e,t,r)=>{let n=(intlFormatterCache[e]||(intlFormatterCache[e]=new Intl.DateTimeFormat(locale,t))).format(r);return BrowserHelper.isIE11&&(n=n.replace(LTRSymbolRegexp,"")),n},formatTime=(e,t,r,n=!1)=>{let i=useIntlFormat(e,t,r);return/am|pm/i.test(i)&&(i=i.replace(/^0/,""),n&&(i=i.replace(/:00/,""))),i},getDayDiff=(e,t)=>Math.floor((e.getTime()-t.getTime()-(e.getTimezoneOffset()-t.getTimezoneOffset())*validConversions.minute.millisecond)/validConversions.day.millisecond)+1,normalizeDay=e=>e>=0?e:e+7;let locale="en-US",ordinalSuffix=enOrdinalSuffix,formatCache={},intlFormatterCache={},parserCache={};const DEFAULT_YEAR=2020,DEFAULT_MONTH=0,DEFAULT_DAY=1,formats={M:e=>e.getMonth()+1,Mo:e=>ordinalSuffix(formats.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>useIntlFormat("MMM",{month:"short"},e),MMMM:e=>useIntlFormat("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/3),Qo:e=>ordinalSuffix(formats.Q(e).toString()),D:e=>e.getDate(),Do:e=>ordinalSuffix(formats.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/validConversions.day.millisecond),DDDo:e=>ordinalSuffix(formats.DDD(e).toString()),DDDD:e=>formats.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>ordinalSuffix(e.getDay().toString()),d1:e=>formats.ddd(e).substring(0,1),dd:e=>formats.ddd(e).substring(0,2),ddd:e=>useIntlFormat("ddd",{weekday:"short"},e),dddd:e=>useIntlFormat("dddd",{weekday:"long"},e),e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>DateHelper.getWeekNumber(e)[1],Wo:e=>ordinalSuffix(formats.W(e).toString()),WW:e=>formats.W(e).toString().padStart(2,"0"),Y:e=>e.getFullYear(),YY:e=>e.getFullYear()%100,YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>formats.h(e).toString().padStart(2,"0"),k:e=>e.getHours()+1,kk:e=>formats.k(e).toString().padStart(2,"0"),K:e=>formatTime("K",{hour:"numeric"},e),KK:e=>formatTime("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>formats.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>formats.s(e).toString().padStart(2,"0"),S:e=>e.getMilliseconds().toString().substr(0,1),SS:e=>e.getMilliseconds().toString().substr(0,2).padEnd(2,"0"),SSS:e=>e.getMilliseconds().toString().substr(0,3).padEnd(3,"0"),z:e=>useIntlFormat("z",{timeZoneName:"short"},e),zz:e=>useIntlFormat("zz",{timeZoneName:"long"},e),Z:e=>DH.getGMTOffset(e),LT:e=>formatTime("LT",{hour:"2-digit",minute:"2-digit"},e),LST:e=>formatTime("LST",{hour:"numeric",minute:"2-digit"},e,!0),LTS:e=>formatTime("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>useIntlFormat("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>useIntlFormat("l",{year:"numeric",month:"numeric",day:"numeric"},e),LL:e=>useIntlFormat("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>useIntlFormat("ll",{year:"numeric",month:"short",day:"numeric"},e),LLL:e=>useIntlFormat("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>useIntlFormat("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>useIntlFormat("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>useIntlFormat("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},formatKeys=Object.keys(formats).sort(((e,t)=>t.length-e.length)),formatRegexp=`^(?:${formatKeys.join("|")})`,emptyFn$1=()=>({}),isNumber=e=>numberRegex.test(e),parseMilliseconds=e=>isNumber(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))},parsers={YYYY:e=>({year:parseInt(e)}),Y:e=>({year:parseInt(e)}),YY:e=>{const t=parseInt(e);return{year:t+(t>1968?1900:2e3)}},MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),DD:e=>({date:parseInt(e)}),M:e=>({month:parseInt(e)-1}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:emptyFn$1,MMM:emptyFn$1,MMMM:emptyFn$1,DDDo:emptyFn$1,DDDD:emptyFn$1,d:emptyFn$1,do:emptyFn$1,d1:emptyFn$1,dd:emptyFn$1,ddd:emptyFn$1,dddd:emptyFn$1,Q:emptyFn$1,Qo:emptyFn$1,W:emptyFn$1,Wo:emptyFn$1,WW:emptyFn$1,e:emptyFn$1,E:emptyFn$1,HH:e=>({hours:parseInt(e)}),hh:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:parseMilliseconds,SS:parseMilliseconds,SSS:parseMilliseconds,A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",Z:e=>{if(!e||!timeZoneRegEx.test(e)&&"Z"!==e)return null;let t=0;if("Z"!==e){const r=timeZoneRegEx.exec(e);if(r){t=("+"===r[1]?1:-1)*(60*(parseInt(r[2])||0)+(parseInt(r[3])||0))}else t=-1*(new Date).getTimezoneOffset()}return{timeZone:t}}},parserKeys=Object.keys(parsers).sort(((e,t)=>t.length-e.length)),parserRegexp=new RegExp(`(${parserKeys.join("|")})`),localeStrRegExp=new RegExp("(l|LL|ll|LLL|lll|LLLL|llll)"),validConversions={year:{year:1,quarter:4,month:12,week:52,day:365,hour:8760,minute:525600,second:31536e3,millisecond:31536e6},quarter:{year:1/4,quarter:1,month:3,week:4,day:91,hour:2184,minute:131040,second:7862400,millisecond:78624e5},month:{year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-720,minute:-43200,second:-2592e3,millisecond:-2592e6},week:{year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{year:-1/8760,quarter:-1/2184,month:-1/720,week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{year:-1/525600,quarter:-1/131040,month:-1/43200,week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{year:-1/31536e3,quarter:-1/7862400,month:-1/2592e3,week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{year:-1/31536e6,quarter:-1/78624e5,month:-1/2592e6,week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:.001}},normalizedUnits={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year"},withDecimalsDurationRegex=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,noDecimalsDurationRegex=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,canonicalUnitNames=["millisecond","second","minute","hour","day","week","month","quarter","year"],canonicalUnitAbbreviations=[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"]],deltaUnits=["year","month","week","day","hour","minute","second","millisecond"],dateProperties=["milliseconds","seconds","minutes","hours","date","month","year"],parseNumber=e=>{const t=parseFloat(e);return isNaN(t)?null:t},numberRegex=/^[0-9]+$/,timeZoneRegEx=/([+-])(\d\d):*(\d\d)*$/,unitMagnitudes={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8},snapFns={round:(e,t=1)=>Math.round(e/t)*t,floor:(e,t=1)=>Math.floor(e/t)*t,ceil:(e,t=1)=>Math.ceil(e/t)*t},keyCache={};class DateHelper extends(Localizable()){static get $name(){return"DateHelper"}static set defaultFormat(e){DH._defaultFormat=e}static get defaultFormat(){return DH._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static buildParser(e){const t=e.split(parserRegexp),r=[];return 1===t.length||localeStrRegExp.test(e)?[]:(t.reduce(((t,n,i,s)=>{if(0!==i||""!==n)if(parserRegexp.test(n)){const o=(this.localize("L{parsers}")||{})[n]||parsers[n];if("Z"===n&&i<s.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);if("string"==typeof o){const e=DH.buildParser(o),n=e.pop();delete n.last,r.push(...e),t=n}else t.pattern=n,t.fn=parsers[n]}else t.splitter=n,r.push(t),t={};else Object.prototype.hasOwnProperty.call(t,"pattern")&&r.push(t);return t}),{}),r[r.length-1].last=!0,r)}static makeKey(e){e.getTime&&(e=e.getTime());const t=keyCache[e];return t||(keyCache[e]=DH.format(new Date(e),"YYYY-MM-DD"))}static parseKey(e){return DH.parse(e,"YYYY-MM-DD")}static parse(e,t=DH.defaultParseFormat){if(e instanceof Date)return e;if("string"!=typeof e||!e)return null;const r={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};t=t.replace(/S+/gm,"SSS");let n,i=parserCache[t];i||(i=parserCache[t]=DH.buildParser(t)),i.reduce(((e,t)=>{if(!t.last){let n,i,s;if(n="T"===t.splitter&&-1===e.indexOf("T")?e.indexOf(" "):""!==t.splitter?e.indexOf(t.splitter):t.pattern&&t.pattern.length||-1,-1===n||"SSS"===t.pattern&&e.match(/^\d+Z$/)){const t=e.split(/([Z\-+])/);1===t.length?(i=e,s=""):(i=t[0],s=`${t[1]}${t[2]}`)}else i=e.substring(0,n)||e,s=e.substring(n+t.splitter.length);if(t.fn){const e=t.fn(i);e?Object.assign(r,e):s=i+s}return s}Object.assign(r,t.fn(e))}),e),r.year&&!r.date&&(r.date=1);const s=DH.create(r);return n=s||new Date(e),n}static create(e){const t=Object.assign({},e);let r=isNaN(t.year),n=!1;if(!r){let e=!0;dateProperties.forEach((r=>{r in t&&!isNaN(t[r])||(t[r]=0),e=e&&null===t[r]})),r=e}if("pm"===t.amPm&&(t.hours=t.hours%12+12),"timeZone"in t&&(n=!0,t.minutes-=t.timeZone),r)return null;const i=[defaultValue(t.year,2020),defaultValue(t.month,0),defaultValue(t.date,1),t.hours,t.minutes,t.seconds,t.milliseconds];return n?new Date(Date.UTC(...i)):new Date(...i)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,t=DH.defaultFormat){if(!e||isNaN(e))return null;let r=formatCache[t],n="";if(!r){r=formatCache[t]=[];for(let e=0;e<t.length;e++){const n=t.substr(e).match(formatRegexp),i=n&&n[0];if(i){const t=(this.localize("L{formats}")||{})[i]||formats[i];r.push(t),e+=i.length-1}else if("{"===t[e]){const n=t.indexOf("}",e+1);-1===n?(r.push(t.substr(e+1)),e=t.length):(r.push(t.substring(e+1,n)),e=n)}else r.push(t[e])}}return r.forEach((t=>{n+="string"==typeof t?t:t(e)})),(BrowserHelper.isEdge||BrowserHelper.isIE11)&&(n=n.replace(/\u200E/g,"")),n}static asMilliseconds(e,t=null){return"string"==typeof e&&(t=e,e=1),DH.as("millisecond",e,t)}static asMonths(e){const t=DH.as("ms",DH.daysInMonth(e),"day"),r=(e.valueOf()-DH.startOf(e,"month").valueOf())/t;return 12*e.getYear()+e.getMonth()+r}static monthsToDate(e){const t=Math.floor(e),r=e-t,n=new Date(0,t),i=DH.as("ms",DH.daysInMonth(n),"days");return n.setTime(n.getTime()+r*i),n}static formatDelta(e,t){let r,n;"boolean"==typeof t?r=t:t&&(r=t.abbrev);const i=this.getDelta(e,t),s=[],o=r?"":" ";for(n in i)s.push(`${i[n]}${o}${n}`);return!1===(null==t?void 0:t.asString)?s:s.join(", ")}static getDelta(e,t){let r,n,i,s,o;"boolean"==typeof t?r=t:t&&(r=t.abbrev,s=DH.normalizeUnit(t.precision));const a={},l=r?DH.getShortNameOfUnit:DH.getLocalizedNameOfUnit;for(o of deltaUnits)if(n=DH.as(o,e),i=s===o,n=Math[i?"round":"floor"](n),(n||i&&!a.length)&&(a[l.call(DH,o,1!==n)]=n,e-=DH.as("ms",n,o)),i||!e)break;return a}static as(e,t,r="ms"){return"string"==typeof t&&(t=DH.parseDuration(t)),"object"==typeof t&&(r=t.unit,t=t.magnitude),e===r?t:(e=DH.normalizeUnit(e),r=DH.normalizeUnit(r),unitMagnitudes[r]>unitMagnitudes[e]?t*Math.abs(validConversions[r][e]):t/Math.abs(validConversions[e][r]))}static formatContainsHourInfo(e){return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(/(\\.)/g,""))}static is24HourFormat(e){return DH.format(DH.getTime(13,0,0),e).includes("13")}static add(e,t,r="ms"){let n;if(n="string"==typeof e?DH.parse(e):new Date(e.getTime()),!r||0===t)return n;switch(r=DH.normalizeUnit(r)){case"millisecond":n=new Date(n.getTime()+t);break;case"second":n=new Date(n.getTime()+1e3*t);break;case"minute":n=new Date(n.getTime()+6e4*t);break;case"hour":n=new Date(n.getTime()+36e5*t);break;case"day":t%1==0?n.setDate(n.getDate()+t):n=new Date(n.getTime()+864e5*t),23===n.getHours()&&0===e.getHours()&&(n=DH.add(n,1,"hour"));break;case"week":n.setDate(n.getDate()+7*t);break;case"month":{let e=n.getDate();e>28&&(e=Math.min(e,DH.getLastDateOfMonth(DH.add(DH.getFirstDateOfMonth(n),t,"month")).getDate())),n.setDate(e),n.setMonth(n.getMonth()+t);break}case"quarter":n=DH.add(n,3*t,"month");break;case"year":n.setFullYear(n.getFullYear()+t)}return n}static diff(e,t,r="ms",n=!0){if(r=DH.normalizeUnit(r),!e||!t)return 0;let i;switch(r){case"year":i=DH.diff(e,t,"month")/12;break;case"quarter":i=DH.diff(e,t,"month")/3;break;case"month":i=12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth());break;case"week":i=DH.diff(e,t,"day")/7;break;case"day":{const r=e.getTimezoneOffset()-t.getTimezoneOffset();i=(t-e+60*r*1e3)/864e5;break}case"hour":i=(t-e)/36e5;break;case"minute":i=(t-e)/6e4;break;case"second":i=(t-e)/1e3;break;case"millisecond":i=t-e}return n?i:Math.round(i)}static startOf(e,t="day",r=!0){if(!e)return null;t=DH.normalizeUnit(t),r&&(e=DH.clone(e));const n={},i=unitMagnitudes[t];for(let e=0;e<i;e++){const t=canonicalUnitNames[e];"quarter"!==t&&"week"!==t&&(n[t]="day"===t?1:0)}if("quarter"===t)n.month=3*(DH.get(e,"quarter")-1);else if("week"===t){const t=e.getDay()-DH.weekStartDay;n.day=e.getDate()-t}return DH.set(e,n)}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,t=!0){return DH.startOf(e,"day",t)}static midnight(e,t){let r=DH.clearTime(e);return t&&r<e&&(r=DH.add(r,1,"d")),r}static getTimeOfDay(e){return e.getHours()*validConversions.hour.millisecond+e.getMinutes()*validConversions.minute.millisecond+e.getSeconds()*validConversions.second.millisecond+e.getMilliseconds()}static set(e,t,r){if(!t)return e;if("string"==typeof t)switch(DH.normalizeUnit(t)){case"millisecond":(0!==r||e.getMilliseconds()>0)&&e.setMilliseconds(r);break;case"second":(0!==r||e.getSeconds()>0)&&e.setSeconds(r);break;case"minute":(0!==r||e.getMinutes()>0)&&e.setMinutes(r);break;case"hour":e.setHours(r);break;case"day":case"date":e.setDate(r);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(r);break;case"quarter":e.setDate(1),e.setMonth(3*(r-1));break;case"year":e.setFullYear(r)}else Object.entries(t).sort(((e,t)=>unitMagnitudes[e[0]]-unitMagnitudes[t[0]])).forEach((([t,r])=>{DH.set(e,t,r)}));return e}static setDateToMidday(e,t=!0){return DH.set(DH.clearTime(e,t),"hour",12)}static constrain(e,t,r){return null!=t&&(e=DH.max(e,t)),null==r?e:DH.min(e,r)}static getTime(e,t=0,r=0,n=0){return e instanceof Date&&(n=e.getMilliseconds(),r=e.getSeconds(),t=e.getMinutes(),e=e.getHours()),new Date(2020,0,1,e,t,r,n)}static copyTimeValues(e,t){return e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),e}static isDST(e){const t=e.getFullYear(),r=new Date(t,0,1),n=new Date(t,6,1);return e.getTimezoneOffset()<Math.max(r.getTimezoneOffset(),n.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,r=null){return null===r?e&&t&&e.getTime()===t.getTime():DH.startOf(e,r)-DH.startOf(t,r)==0}static compare(e,t,r=null){return r&&(e=DH.startOf(e,r),t=DH.startOf(t,r)),DH.isBefore(e,t)?-1:DH.isAfter(e,t)?1:0}static isStartOf(e,t){return DH.isEqual(e,DH.startOf(e,t))}static betweenLesser(e,t,r){return t.getTime()<=e.getTime()&&e.getTime()<r.getTime()}static betweenLesserEqual(e,t,r){return t.getTime()<=e.getTime()&&e.getTime()<=r.getTime()}static intersectSpans(e,t,r,n){return DH.betweenLesser(e,r,n)||DH.betweenLesser(r,e,t)}static compareUnits(e,t){return Math.sign(unitMagnitudes[e]-unitMagnitudes[t])}static timeSpanContains(e,t,r,n){return r-e>=0&&t-n>=0}static get weekStartDay(){return this.localize("L{weekStartDay}")||0}static get(e,t){switch(DH.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return formats.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInMonth(e){const t=DH.clone(e);return t.setDate(1),t.setMonth(e.getMonth()+1),t.setDate(0),t.getDate()}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,r=1,n=DH.weekStartDay){if("week"===t){let t=DH.clone(e);const i=t.getDay();return t=DH.startOf(t,"day"),t=DH.add(t,n-i+7*(r-(n<=i?0:1)),"day"),t.getDay()!==n&&DH.add(t,1,"hour"),t}return DH.startOf(DH.add(e,r,t),t)}static isValidDate(e){return DH.isDate(e)&&!isNaN(e)}static isDate(e){return e&&toString$2.call(e)===DATE_TYPE$1}static getStartOfNextDay(e,t,r){let n=DH.add(r?e:DH.clearTime(e,t),1,"day");if(n.getDate()===e.getDate()){const r=DH.add(DH.clearTime(e,t),2,"day").getTimezoneOffset(),i=e.getTimezoneOffset();n=DH.add(n,i-r,"minute")}return n}static getEndOfPreviousDay(e,t){const r=t?e:DH.clearTime(e,!0);return r-e?r:DH.add(r,-1,"day")}static getWeekNumber(e,t=DateHelper.weekStartDay){const r=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),11,31),i=normalizeDay(r.getDay()-t),s=normalizeDay(n.getDay()-t),o=(a=e,l=r,Math.floor((a.getTime()-l.getTime()-(a.getTimezoneOffset()-l.getTimezoneOffset())*validConversions.minute.millisecond)/validConversions.day.millisecond)+1);var a,l;let c;if(c=i<4?Math.floor((o+i-1)/7)+1:Math.floor((o+i-1)/7),c){let t=e.getFullYear();return 53===c&&s<3&&(t++,c=1),[t,c]}const d=DateHelper.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,d]}static formatCount(e,t){return t=DH.normalizeUnit(t),1!==e&&(t+="s"),e+" "+t}static getUnitToBaseUnitRatio(e,t,r=!1){return(e=DH.normalizeUnit(e))===(t=DH.normalizeUnit(t))?1:validConversions[e]&&validConversions[e][t]&&(r||validConversions[e][t]>0)?1/DH.as(t,1,e):validConversions[t]&&validConversions[t][e]&&(r||validConversions[t][e]>0)?DH.as(e,1,t):-1}static getMeasuringUnit(e){return"week"===e?"day":e}static getShortNameOfUnit(e){return e=DH.parseTimeUnit(e),DH.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t){return e=DH.normalizeUnit(e),e=DH.parseTimeUnit(e),DH.unitLookup[e][t?"plural":"single"]}static normalizeUnit(e){if(!e)return null;const t=e.toLowerCase();return"date"===t||canonicalUnitNames.includes(t)?t:normalizedUnits[e]||normalizedUnits[t]}static getUnitByName(e){return DH.normalizeUnit(e)||DH.normalizeUnit(DH.parseTimeUnit(e))}static getDurationInUnit(e,t,r,n){return DH.diff(e,t,r,n)}static doesUnitsAlign(e,t){return!(e!==t&&"week"===t)}static getSmallerUnit(e){return canonicalUnitNames[unitMagnitudes[DH.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return canonicalUnitNames[unitMagnitudes[DH.normalizeUnit(e)]+1]||null}static round(e,t,r){return DH.snap("round",e,t,r)}static floor(e,t,r){return DH.snap("floor",e,t,r)}static ceil(e,t,r){return DH.snap("ceil",e,t,r)}static snap(e,t,r,n){const i=snapFns[e];if("string"==typeof r){switch((r=DH.parseDuration(r)).unit){case"week":{const{weekStartDay:i}=DH,s=t.getDay();return n=DH.add(DH.clearTime(t),s>=i?i-s:-(s-i+7),"day"),DH[e](t,7*r.magnitude+" days",n)}case"month":{let e;return t=DH.asMonths(t),e=n?t+i(t-(n=DH.asMonths(n)),r.magnitude):i(t,r.magnitude),DH.monthsToDate(e)}case"quarter":return DH[e](t,3*r.magnitude+" months",n);case"year":return DH[e](t,12*r.magnitude+" months",n)}r=DH.as("ms",r.magnitude,r.unit)}if(n){const e=DH.as("ms",n.getTimezoneOffset()-t.getTimezoneOffset(),"ms");return new Date(n.valueOf()+i(DH.diff(n,t,"ms")+e,r))}{const e=60*t.getTimezoneOffset()*1e3;return new Date(i(t.valueOf()-e,r)+e)}}static parseDuration(e,t=!0,r){const n=(t?withDecimalsDurationRegex:noDecimalsDurationRegex).exec(e);if(null==e||!n)return null;const i=parseNumber(n[1]),s=DH.parseTimeUnit(n[2])||r;return s?{magnitude:i,unit:s}:null}static parseTimeUnit(e){const t=null==e?null:DH.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let e=0;e<canonicalUnitNames.length;e++)if(t[e+1])return canonicalUnitNames[e]}static getGMTOffset(e=new Date){if(!e)return;const t=e.getTimezoneOffset();return t?(t>0?"-":"+")+Math.abs(Math.trunc(t/60)).toString().padStart(2,"0")+":"+Math.abs(t%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),t=DH._dayNames||[],r=DH._dayShortNames||[];t.length=0,r.length=0;for(let n=2;n<9;n++)e.setDate(n),t.push(DH.format(e,"dddd")),r.push(DH.format(e,"ddd"));DH._dayNames=t,DH._dayShortNames=r}static getDayNames(){return DH._dayNames}static getDayName(e){return DH._dayNames[e]}static getDayShortNames(){return DH._dayShortNames}static getDayShortName(e){return DH._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),t=DH._monthNames||[],r=DH._monthShortNames||[];t.length=0,r.length=0;for(let n=0;n<12;n++)e.setMonth(n),t.push(DH.format(e,"MMMM")),r.push(DH.format(e,"MMM"));DH._monthNames=t,DH._monthShortNames=r}static getMonthShortNames(){return DH._monthShortNames}static getMonthShortName(e){return DH._monthShortNames[e]}static getMonthNames(){return DH._monthNames}static getMonthName(e){return DH._monthNames[e]}static set locale(e){locale=e}static get locale(){return locale}static setupDurationRegEx(e=[],t=[]){const r=this,n={};let i="";for(let s=0;s<t.length;s++){const o=t[s],a=e[s];a.canonicalUnitName=canonicalUnitNames[s],n[a.single]=n[a.single.toUpperCase()]=n[a.canonicalUnitName]=n[a.canonicalUnitName.toUpperCase()]=a,i+=(s?"|":"")+"(";for(let e=0;e<o.length;e++)i+=o[e]+"|";if(locale=r.localize("L{locale}")||"en-US","en-US"!==locale){const e=canonicalUnitAbbreviations[s];for(let t=0;t<e.length;t++)i+=e[t]+"|"}i+=`${a.single}|${a.plural}|${a.canonicalUnitName}|${a.canonicalUnitName}s)`}r.unitLookup=n,r.durationRegEx=new RegExp(`^(?:${i})$`)}static applyLocale(){const e=this,t=e.localize("L{unitAbbreviations}")||[],r=e.unitNames=e.localize("L{unitNames}");"unitNames"!==r&&(locale=e.localize("L{locale}")||"en-US",ordinalSuffix="en-US"===locale?enOrdinalSuffix:e.localize("L{ordinalSuffix}")||ordinalSuffix,formatCache={},parserCache={},intlFormatterCache={},DH.setupDurationRegEx(r,t),DH.fillDayNames(),DH.fillMonthNames())}}const DH=DateHelper;DH.useIntlFormat=useIntlFormat,LocaleManagerSingleton.on({locale:"applyLocale",prio:1e3,thisObj:DH}),LocaleManagerSingleton.locale&&DH.applyLocale(),DateHelper._$name="DateHelper";const{hasOwnProperty:hasOwnProperty$4}=Object.prototype,typeOf=e=>{const t=typeof e;if("object"===t){if(null===e)return"null";if("[object Date]"===Object.prototype.toString.call(e))return"date"}return t},toFixedFix="1.01"===1.005.toFixed(2)?null:function(e,t){const r=e.toString().split("."),n=+(r[1]?r.join(".")+"1":r[0]);return e.toFixed.call(n,t)};class ObjectHelper extends Objects{static transformArrayToNamedObject(e,t="ref"){const r={};return e.forEach(((e,n)=>{const i=null!=e[t]&&e[t].toString().length?e[t]:n;r[i]=e})),r}static transformNamedObjectToArray(e,t="ref"){return Object.keys(e).filter((t=>e[t])).map((r=>{const n=e[r];return n[t]=r,n}))}static isEqual(e,t,r=!1){if(null===e&&null!==t||void 0===e&&void 0!==t||null===t&&null!==e||void 0===t&&void 0!==e)return!1;if(null==e&&null==t)return!0;if(e===t)return!0;const n=typeof e;if(n===typeof t){switch(n){case"number":case"string":case"boolean":return e===t}switch(!0){case e instanceof Date&&t instanceof Date:return e.getTime()===t.getTime();case Array.isArray(e)&&Array.isArray(t):return e.length===t.length&&e.every(((e,n)=>OH.isEqual(e,t[n],r)));case"object"===n&&e.constructor.prototype===t.constructor.prototype:return r?OH.isDeeplyEqual(e,t,r):JSON.stringify(e)===JSON.stringify(t)}}return String(e)===String(t)}static isDeeplyEqual(e,t,r={}){if(e===t)return!0;if(!e||!t)return!1;const n=OH.keys(e,r.ignore),i=OH.keys(t,r.ignore);if(n.length!==i.length)return!1;for(let s=0;s<n.length;s++){const o=n[s],a=i[s];if(o!==a)return!1;const l=e[o],c=t[a];if(!r.shouldEvaluate||!1!==r.shouldEvaluate(o,{value:l,object:e},{value:c,object:t})){if(r.evaluate){const n=r.evaluate(o,{value:l,object:e},{value:c,object:t});if(!1===n)return!1;if(!0===n)continue}if(!OH.isEqual(l,c,r))return!1}}return!0}static isPartial(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),-1!=e.indexOf(t)}static isLessThan(e,t){return e instanceof Date&&t instanceof Date?DateHelper.isBefore(e,t):e<t}static isMoreThan(e,t){return e instanceof Date&&t instanceof Date?DateHelper.isAfter(e,t):e>t}static fork(e){var t,r,n;if(e&&e.constructor===Object)for(r in t=Object.setPrototypeOf({},e),e)(n=e[r])&&(n.constructor===Object?t[r]=OH.fork(n):n instanceof Array&&(t[r]=n.slice()));else t=e;return t}static copyProperties(e,t,r){let n,i;for(i=0;i<r.length;i++)n=r[i],n in t&&(e[n]=t[n]);return e}static copyPropertiesIf(e,t,r){if(t)for(const n of r)n in e||(e[n]=t[n]);return e}static keys(e,t=null){const r=[];for(const n in e)t&&t[n]||r.push(n);return r}static allKeys(e){const t=[];for(const r in e)t.push(r);return t}static pathExists(e,t){return t.split(".").every((t=>t in e&&(e=e[t],!0)))}static pathifyKeys(e){const t={};for(const r in e)if(Object.hasOwnProperty.call(e,r))if(e[r]instanceof Object){const n=this.pathifyKeys(e[r]);for(const e in n)t[`${r}.${e}`]=n[e]}else t[r]=e[r];return t}static deletePath(e,t){t.split(".").reduce(((e,t,r,n)=>{if(null==e)return null;if(Object.hasOwnProperty.call(e,t)){if(r!==n.length-1)return e[t];delete e[t]}}),e)}static coerce(e,t){var r=typeOf(e),n=typeOf(t),i="string"==typeof e;if(r!==n)switch(n){case"string":return String(e);case"number":return Number(e);case"boolean":return!(i&&(!e||"false"===e||"0"===e))&&Boolean(e);case"null":return!(!i||e&&"null"!==e)&&null;case"undefined":return!(!i||e&&"undefined"!==e)&&void 0;case"date":return i&&isNaN(e)?DateHelper.parse(e):Date(Number(e))}return e}static wrapProperty(e,t,r,n,i=!0){const s={};let o=Object.getPrototypeOf(e),a=Object.getOwnPropertyDescriptor(o,t);for(;!a&&o&&i;)o=Object.getPrototypeOf(o),o&&(a=Object.getOwnPropertyDescriptor(o,t));a?(a.set?s.set=t=>{a.set.call(e,t),n&&n.call(e,a.get.call(e))}:s.set=n,a.get?s.get=()=>{let t=a.get.call(e);return r&&(t=r.call(e,t)),t}:s.get=r):(s.set=r=>{e["_"+t]=r,n&&n.call(e,r)},s.get=()=>{let n=e["_"+t];return r&&(n=r.call(e,n)),n}),Object.defineProperty(e,t,s)}static getPropertyDescriptor(e,t){let r=null;for(let n=e;n&&!r&&!hasOwnProperty$4.call(n,"isBase");n=Object.getPrototypeOf(n))r=Object.getOwnPropertyDescriptor(n,t);return r}static cleanupProperties(e,t=!1){return Object.entries(e).forEach((([r,n])=>{t?void 0===n&&delete e[r]:null==n&&delete e[r]})),e}static removeAllProperties(e){return Object.keys(e).forEach((t=>delete e[t])),e}static assertType(e,t,r){if(null!=e&&typeof e!==t)throw new Error(`Incorrect type "${typeof e}" for ${r}, expected "${t}"`)}static assertNumber(e,t){const r=Number(e);if("number"!=typeof e||isNaN(r))throw new Error(`Incorrect type for ${t}, got "${e}" (expected a Number)`)}static assertBoolean(e,t){OH.assertType(e,"boolean",t)}static toFixed(e,t){return toFixedFix?toFixedFix(e,t):e.toFixed(t)}static roundTo(e,t=1){return Math.round(e/t)*t}static round(e,t){if(null==t)return e;const r=10**t;return Math.round(e*r)/r}static isPromise(e){return"function"==typeof(null==e?void 0:e.then)}}const OH=ObjectHelper;ObjectHelper._$name="ObjectHelper";const allBorders=["border-top-width","border-right-width","border-bottom-width","border-left-width"],allPaddings=["padding-top","padding-right","padding-bottom","padding-left"],borderNames={t:"border-top-width",r:"border-right-width",b:"border-bottom-width",l:"border-left-width"},paddingNames={t:"padding-top",r:"padding-right",b:"padding-bottom",l:"padding-left"},zeroBased=Object.freeze({x:0,y:0}),alignSpecRe=/^([trblc])(\d*)-([trblc])(\d*)$/i,alignPointRe=/^([trblc])(\d*)$/i,edgeNames=["top","right","bottom","left"],edgeIndices={t:0,r:1,b:2,l:3},defaultAlignments=["b-t","l-r","t-b","r-l"],zeroOffsets=Object.freeze([0,0]),matchDimensions=["width","height"];function parseAlign(e){const t=alignSpecRe.exec(e),r=parseInt(t[2]||50),n=parseInt(t[4]||50);return{myAlignmentPoint:t[1]+r,myEdge:t[1],myOffset:r,targetAlignmentPoint:t[3]+n,targetEdge:t[3],targetOffset:n,startZone:edgeIndices[t[3]]}}function flipAlign(e){return`${edgeNames[(edgeIndices[e.myEdge]+2)%4][0]}${e.myOffset}-${edgeNames[(edgeIndices[e.targetEdge]+2)%4][0]}${e.targetOffset}`}function createOffsets(e){return null==e?zeroOffsets:"number"==typeof e?[e,e]:e}class Rectangle{static from(e,t,r){var n;if(e instanceof Rectangle)return e;if(void 0===r&&"boolean"==typeof t&&(r=t,t=null),t){let{scrollLeft:e,scrollTop:r}=t;(BrowserHelper.isEdge||BrowserHelper.isSafari)&&t===document.body&&(e=r=0),t=Rectangle.from(t).translate(-e,-r)}else t=zeroBased;const i=e===document||e===window,s=i?new Rectangle(0,0,window.innerWidth,window.innerHeight):e.getBoundingClientRect(),o=r||i?[0,0]:[window.pageXOffset,window.pageYOffset];let a=0,l=0;var c,d;(BrowserHelper.isIE11||BrowserHelper.isEdge&&(null===(n=e.namespaceURI)||void 0===n?void 0:n.match(/svg/)))&&(a=(null===(c=e.dataset)||void 0===c?void 0:c.scaleX)||0,l=(null===(d=e.dataset)||void 0===d?void 0:d.scaleY)||0);return new Rectangle(s.left+o[0]-t.x+a/2,s.top+o[1]-t.y+l/2,s.width-a,s.height-l)}static fromScreen(e,t){return Rectangle.from(e,t,!0)}static inner(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const t=DomHelper.getStyleValue(e,allBorders);n.x+=parseFloat(t[borderNames.l]),n.y+=parseFloat(t[borderNames.t]),n.right-=parseFloat(t[borderNames.r]),n.bottom-=parseFloat(t[borderNames.b])}return n}static content(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const t=DomHelper.getStyleValue(e,allBorders),r=DomHelper.getStyleValue(e,allPaddings);n.x+=parseFloat(t[borderNames.l])+parseFloat(r[paddingNames.l]),n.y+=parseFloat(t[borderNames.t])+parseFloat(r[paddingNames.t]),n.right-=parseFloat(t[borderNames.r])+parseFloat(r[paddingNames.r]),n.bottom-=parseFloat(t[borderNames.b])+parseFloat(r[paddingNames.b])}return n}static client(e,t,r=!1){const n=this.content(e,t,r),i=DomHelper.scrollBarWidth;let s;return i&&(e.scrollHeight>e.clientHeight&&"hidden"!==DomHelper.getStyleValue(e,"overflow-y")&&(s=parseFloat(DomHelper.getStyleValue(e,"padding-right")),n.right+=s-Math.max(s,i)),e.scrollWidth>e.clientWidth&&"hidden"!==DomHelper.getStyleValue(e,"overflow-x")&&(s=parseFloat(DomHelper.getStyleValue(e,"padding-bottom")),n.bottom+=s-Math.max(s,i))),n}static union(...e){let t,{x:r,y:n,right:i,bottom:s}=e[0];if(e.length>1)for(let o=1;o<e.length;o++)t=e[o],t.x<r&&(r=t.x),t.y<n&&(n=t.y),t.right>i&&(i=t.right),t.bottom>s&&(s=t.bottom);return new Rectangle(r,n,i-r,s-n)}roundPx(e=window.devicePixelRatio||1){const t=this;return t._x=DomHelper.roundPx(t._x,e),t._y=DomHelper.roundPx(t._y,e),t._width=DomHelper.roundPx(t._width,e),t._height=DomHelper.roundPx(t._height,e),t}static get $$name(){return hasOwnProperty.call(this,"$name")&&this.$name||hasOwnProperty.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}constructor(e,t,r,n){ObjectHelper.assertNumber(e,"Rectangle.x"),ObjectHelper.assertNumber(t,"Rectangle.y"),ObjectHelper.assertNumber(r,"Rectangle.width"),ObjectHelper.assertNumber(n,"Rectangle.height");const i=this;i._x=e,i._y=t,i._width=r,i._height=n}clone(){const e=this,t=new Rectangle(e.x,e.y,e.width,e.height);return t.isAlignRectangle=e.isAlignRectangle,t.minHeight=e.minHeight,t.minWidth=e.minWidth,t}contains(e){const t=this;return e instanceof Rectangle&&(e._x>=t._x&&e._y>=t._y&&e.right<=t.right&&e.bottom<=t.bottom)}intersect(e,t=!1,r=!1){const n=this,i=Math.max(n.y,e.y),s=Math.min(n.right,e.right),o=Math.min(n.bottom,e.bottom),a=Math.max(n.x,e.x);return!!(r?o>=i&&s>=a:o>i&&s>a)&&(!!t||new Rectangle(a,i,s-a,o-i))}equals(e,t=!1){const r=t?e=>Math.round(e):e=>e;return e instanceof Rectangle&&r(e.x)===r(this.x)&&r(e.y)===r(this.y)&&r(e.width)===r(this.width)&&r(e.height)===r(this.height)}translate(e,t){return this._x+=e||0,this._y+=t||0,this}moveTo(e,t){return null!=e&&(this._x=e),null!=t&&(this._y=t),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){return new Rectangle.Point(this.x+this.width/2,this.y+this.height/2)}set x(e){const t=e-this._x;this._x=e,this._width-=t}get x(){return this._x}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){const t=e-this._y;this._y=e,this._height-=t}get y(){return this._y}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}get area(){return this.width*this.height}set minWidth(e){const t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.isAlignRectangle||(t.width=Math.max(t.width,t._minWidth)))}get minWidth(){return this._minWidth}set minHeight(e){const t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.isAlignRectangle||(t.height=Math.max(t.height,t._minHeight)))}get minHeight(){return this._minHeight}adjust(e,t,r,n){const i=this;return i.x+=e,i.y+=t,i.width+=r,i.height+=n,i}inflate(e){return this.adjust(-e,-e,e,e)}constrainTo(e,t){const r=this,n=r.height,i=r.y,s=r.minWidth||r.width,o=r.minHeight||r.height;if(r.height>=e.height){if(t&&o>e.height)return!1;r._y=e.y,r.height=e.height}if(r.width>=e.width){if(t&&s>e.width)return r.y=i,r.height=n,!1;r._x=e.x,r.width=e.width}let a=r.bottom-e.bottom;return a>0&&r.translate(0,-a),a=r.right-e.right,a>0&&r.translate(-a),a=e.y-r.y,a>0&&r.translate(0,a),a=e.x-r.x,a>0&&r.translate(a),r}alignTo(e){let t,r,n,i,s=this.clone(),o=e.target,a=e.constrainTo;if(!o||o instanceof Rectangle||(o=Rectangle.from(o.element?o.element:o)),a&&!(a instanceof Rectangle)){i=a===window||a===document;const t="ignorePageScroll"in e?e.ignorePageScroll:!i;a=Rectangle.from(a.element?a.element:a,null,t),e.constrainPadding&&a.inflate(-e.constrainPadding)}const l=this,c=createOffsets(e.offset),{align:d,axisLock:u,anchorSize:h,anchorPosition:g}=e,m=parseAlign(d),p=e.position||(o&&"Point"===o.$$name?o:null),f=a&&a.clone(),v=[],y=[{zone:r=m.startZone,align:d}],b=e.matchSize&&matchDimensions[1&m.startZone],C=l[b];if(b&&u&&(s[b]=o[b]),a&&s.constrainTo(a),a&&null!=m.startZone)if(u)y.push({zone:r=(r+2)%4,align:flipAlign(m)}),"flexible"===u&&(y.push({zone:r=(m.startZone+1)%4,align:defaultAlignments[r]}),y.push({zone:r=(r+2)%4,align:defaultAlignments[r]}));else for(let e=1;e<4;e++)y.push({zone:r=(r+1)%4,align:defaultAlignments[r]});if(g){const e=1&m.startZone?"y":"x";t={[e]:g[e],edge:edgeNames[(m.startZone+2)%4]}}if(f&&o&&(f.adjust(-o.width,-o.height,o.width,o.height),o.constrainTo(f)),s.minWidth=l.minWidth,s.minHeight=l.minHeight,p)s.moveTo(p.x,p.y),a&&s.constrainTo(a);else{const e=h?[h[1]+c[0],h[1]+c[1]]:c,r=o.getAlignmentPoint(m.targetAlignmentPoint,e),d=s.getAlignmentPoint(m.myAlignmentPoint);s.translate(r[0]-d[0],r[1]-d[1]);if(s.intersect(o,!0))a&&s.constrainTo(a),n=m.startZone,s.translate(...e);else if(a&&!a.contains(s)){let r,c,d=s.clone(),h=[];t=null,v[0]=r=a.clone(),r.bottom=o.y-e[1],v[1]=r=a.clone(),r.x=o.right+e[0],v[2]=r=a.clone(),r.y=o.bottom+e[1],v[3]=r=a.clone(),r.right=o.x-e[0];for(let t=0;t<y.length;t++){if(b&&2==t&&(s[b]=C),r=v[n=y[t].zone],s=s.alignTo({target:o,offsets:e,align:y[t].align}),s.constrainTo(r,!0)&&(h.push({result:s,zone:n}),!c||s.width<l.width||s.height<l.height)){s.align=y[t].align;break}if(!c||r.area>c.area){const e=s.clone();switch(n){case 0:e.moveTo(null,r.bottom-e.height);break;case 1:e.moveTo(r.left);break;case 2:e.moveTo(null,r.top);break;case 3:e.moveTo(r.right-e.width)}c={area:r.area,result:e,zone:n}}}h.length?(h.length>1&&!u&&h.sort(((e,t)=>Math.sqrt((d.x-e.result.x)**2+(d.y-e.result.y)**2)-Math.sqrt((d.x-t.result.x)**2+(d.y-t.result.y)**2))),s=h[0].result,n=h[0].zone):(s=c.result,n=c.zone,i&&s.constrainTo(a))}else n=m.startZone;if(s.zone=n,h){if(!t){let e=1&n,r=e?"y":"x",i=e?"bottom":"right",a=Math.max(o[r],s[r]),l=a+(Math.min(o[i],s[i])-a)/2-h[0]/2,c=l+h[0];c>s[i]&&(l-=c-s[i]),l<s[r]&&(l+=s[r]-l),t={[r]:l-s[r],edge:edgeNames[(n+2)%4]}}s.anchor=t}}return s}getAlignmentPoint(e,t=zeroOffsets){const r=this,n=alignPointRe.exec(e),i=n[1].toLowerCase(),s=Math.min(Math.max(parseInt(n[2]||50),0),100)/100;switch(i){case"t":return[r.x+r.width*s,r.y-t[1]];case"r":return[r.right+t[0],r.y+r.height*s];case"b":return[r.x+r.width*s,r.bottom+t[1]];case"l":return[r.x-t[0],r.y+r.height*s];case"c":{const e=r.center;return[e.x+t[0],e.y+t[1]]}}}highlight(){const e=this,t=DomHelper.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;\n                            left:${e.x}px;top:${e.y}px;width:${e.width}px;height:${e.height}px`});return DomHelper.highlight(t).then((()=>t.remove()))}}Rectangle._$name="Rectangle";class DomClassList{static change(e,t,r,n="string"){r=DomClassList.normalize(r,"object");const i=DomClassList.normalize(e,"array").filter((e=>!r[e]));if(t){t=DomClassList.normalize(t,"array");for(let e=0;e<t.length;++e)i.includes(t[e])||i.push(t[e])}return DomClassList.normalize(i,n)}static normalize(e,t="string"){const r=typeof(e=e||""),n="array"===t,i=!n&&!("object"===t);let s,o,a="string"===r;if("object"===r&&(1===e.nodeType&&"function"==typeof e.getAttribute?(e=e.getAttribute("class"),a=!0):Array.isArray(e)||(e=ObjectHelper.getTruthyKeys(e))),a){if(i)return e;e=e.split(" ")}if(n)o=e;else if(i)o=e.join(" ");else for(s of(o=Object.create(null),e))o[s]=!0;return o}constructor(...e){"object"==typeof e[0]?Object.assign(this,e[0]):this.process(1,e),this[dirtySymbol]=!0}clone(){return new DomClassList(this)}contains(e){return!("string"!=typeof e||!e)&&Boolean(this[e])}toString(){return this.length?this.value+" ":""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){if("string"==typeof e&&(testClassList.value=e,e=testClassList),this.length===e.length){const t=ObjectHelper.getTruthyKeys(e);for(let e=0,r=t.length;e<r;e++)if(!this[t[e]])return!1;return!0}return!1}get value(){const e=this;if(e[dirtySymbol]){const t=ObjectHelper.getTruthyKeys(e);e[lengthSymbol]=t.length,e[valueSymbol]=t.join(" "),e[dirtySymbol]=!1}return e[valueSymbol]}set value(e){const t=this,r=Object.keys(t),n=r.length;for(let e=0;e<n;e++)delete t[r[e]];e?t.process(1,[e]):t[dirtySymbol]=!0}get values(){return ObjectHelper.getTruthyKeys(this)}get length(){return this.value?this[lengthSymbol]:0}process(e,t){const r=t.length;for(let n=0;n<r;n++)if(t[n]){const r=t[n],i=r.values?Array.from(r.values()):r.item?Array.from(r):r.split(whiteSpaceRe$1),s=i.length;for(let t=0;t<s;t++)i[t]&&(this[i[t]]=e)}return this[dirtySymbol]=!0,this}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}split(){return ObjectHelper.getTruthyKeys(this)}forEach(e){return ObjectHelper.getTruthyKeys(this).forEach(e)}get isDomClassList(){return!0}}const whiteSpaceRe$1=/\s+/,valueSymbol=Symbol("value"),lengthSymbol=Symbol("length"),dirtySymbol=Symbol("dirty"),testClassList=new DomClassList;DomClassList._$name="DomClassList";const DEFAULT_FONT_SIZE=14,t0t0={align:"t0-t0"},ELEMENT_NODE=Node.ELEMENT_NODE,TEXT_NODE=Node.TEXT_NODE;let root,scrollBarWidth=null,idCounter=0,themeInfo=null;const numberRe=/[+-]?\d*\.?\d+[eE]?-?\d*/g,numberReSrc=numberRe.source,translateMatrix2dRe=new RegExp(`matrix\\((?:${numberReSrc}),\\s?(?:${numberReSrc}),\\s?(?:${numberReSrc}),\\s?(?:${numberReSrc}),\\s?(${numberReSrc}),\\s?(${numberReSrc})`),translateMatrix3dRe=new RegExp("matrix3d\\((?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(-?\\d*),\\s?(-?\\d*)"),translateMatrixRe=new RegExp(`(?:${translateMatrix2dRe.source})|(?:${translateMatrix3dRe.source})`),pxTtranslateXRe=new RegExp(`translate(3d|X)?\\((${numberReSrc})px(?:,\\s?(${numberReSrc})px)?`),pxTtranslateYRe=new RegExp(`translate(3d|Y)?\\((${numberReSrc})px(?:,\\s?(${numberReSrc})px)?`),domIdRe=/^[^a-z]+|[^\w:.-]+/gi,whiteSpaceRe$2=/\s+/,semicolonRe=/\s*;\s*/,colonRe=/\s*:\s*/,elementPropKey="$bryntum",elementCreateProperties={tag:1,html:1,for:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,className:1,unmatched:1,_element:1,onlyChildren:1,elementData:1,listeners:1,compareHtml:1,syncOptions:1},styleIgnoreProperties={length:1,parentRule:1,style:1},styleDimensionProperties={width:1,height:1,top:1,left:1,minWidth:1,minHeight:1,maxWidth:1,maxHeight:1,fontSize:1},nativeFocusableTags={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,HTML:BrowserHelper.isIE11?1:0,BODY:BrowserHelper.isIE11?0:1},win=window,doc=document,emptyObject={},emptyArray=[],arraySlice=Array.prototype.slice,immediatePromise=Promise.resolve(),fontProps=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],isHiddenWidget=e=>e._hidden,parentNode=e=>e.parentNode||e.host,isVisible=e=>{const t=e.ownerDocument.defaultView.getComputedStyle(e);return"none"!==t.getPropertyValue("display")&&"hidden"!==t.getPropertyValue("visibility")},getRootNode=document.documentElement.getRootNode?e=>e.getRootNode():e=>{for(;e.parentNode;)e=e.parentNode;return e},isShadowRoot=e=>e.host&&e.host instanceof Element,hasLayout=e=>e&&(e===document.body||("offsetParent"in e?e.offsetParent:hasLayout(e.parentNode))),isInDocument=e=>e&&(document.body.contains(e)||(root=getRootNode(e))&&isShadowRoot(root)&&isInDocument(root.host)),elementOrConfigToElement=e=>e instanceof Node?e:"string"==typeof e?DH$1.createElementFromTemplate(e):DH$1.createElement(e);let templateElement,htmlParser;class DomHelper{static isFocusable(e,t=!1){if(!t&&(!DH$1.isVisible(e)||DH$1.Widget.fromElement(e,isHiddenWidget)))return!1;const r=e.nodeName;return nativeFocusableTags[r]||("A"===r||"LINK"===r)&&!!e.href||null!=e.getAttribute("tabIndex")||"true"===e.contentEditable}static isInView(e,t=!0){let r=Rectangle.from(e),n=!0;const i=r.height,s=r.width;for(;n&&e.parentElement;)e=e.parentElement,r=r.intersect(Rectangle.from(e)),n=r&&(!t||r.height>=i&&r.width>=s);return n}static isVisible(e){const t=e.ownerDocument;for(;e;e=(r=e).parentNode||r.host){if(e===t)return!0;if(1===e.nodeType&&!isVisible(e))return!1}var r;return!1}static roundPx(e,t=window.devicePixelRatio||1){const r=1/t;return Math.round(e/r)*r}static isCustomElement(e){return e&&e.shadowRoot}static elementFromPoint(e,t){let r=document.elementFromPoint(e,t);return DH$1.isCustomElement(r)&&(r=r.shadowRoot.elementFromPoint(e,t)||r),r}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getId(e){return e.id||(e.id="b-element-"+ ++idCounter)}static getCommonAncestor(e,t){if(e===t)return e;for(;e&&!(null===(r=(n=e)[e.isWidget?"owns":"contains"])||void 0===r?void 0:r.call(n,t))&&e!==t;){var r,n;e=e.owner||e.parentNode}return e}static getElement(e){return e instanceof Element?e:doc.querySelector(e)}static setAttributes(e,t){const r=DH$1.getElement(e);Object.entries(t).forEach((([e,t])=>r.setAttribute(e,t)))}static setLength(e,t,r){return 1===arguments.length?"number"==typeof e?e+"px":e:(e=DH$1.getElement(e)).style[t]="number"==typeof r?r+"px":r}static getChild(e,t){if(BrowserHelper.supportsQueryScope)t=":scope>"+t;else{t=`#${e.id||(e.id="b-element-"+ ++idCounter)} > ${t}`}return e.querySelector(t)}static hasChild(e,t){return null!=DH$1.getChild(e,t)}static children(e,t){if(">"===t[0]||t.startsWith("# "))if("#"===t[0]&&(t=t.substr(2)),BrowserHelper.supportsQueryScope)t=":scope "+t;else{t=`#${e.id||(e.id="b-element-"+ ++idCounter)} ${t}`}return Array.from(e.querySelectorAll(t))}static down(e,t){if(!e)return null;if(e.matches&&e.matches(t))return e;if(BrowserHelper.supportsQueryScope)t=":scope "+t;else{t=`#${e.id||(e.id="b-element-"+ ++idCounter)} ${t}`}return e.querySelector(t)}static isDescendant(e,t){return e.contains||(e=e.body),e.contains(t)}static getEventElement(e,t="target"){return DH$1.isElement(e)?e:e[t]}static isElement(e){return 1===(null==e?void 0:e.nodeType)&&DH$1.isNode(e)}static isNode(e){return Boolean(e)&&"number"==typeof e.nodeType&&!ObjectHelper.isObject(e)}static forEachSelector(e,t,r){"string"==typeof e&&(r=t,t=e,e=doc),DH$1.children(e,t).forEach(r)}static forEachChild(e,t){Array.from(e.children).forEach(t)}static removeEachSelector(e,t){DH$1.forEachSelector(e,t,(e=>e.remove()))}static removeClsGlobally(e,...t){t.forEach((t=>DH$1.forEachSelector(e,"."+t,(e=>e.classList.remove(t)))))}static up(e,t){return e&&e.closest(t)}static getAncestor(e,t,r=null){let n,i=!1,s=e;for(Array.isArray(t)||(t=[t]);s=s.parentElement;){if(t.includes(s)){i=!0;break}if(r&&s===r)break;n=s}return i?n||e:null}static getParents(e){const t=[];for(;e.parentElement;)t.push(e.parentElement),e=e.parentElement;return t}static makeValidId(e){return null==e?null:String(e).replace(domIdRe,"")}static createElement(e={},t,...r){let n,i,s,o=t;"boolean"==typeof o?(i=r[0],s=r[1],t={returnAll:o,refs:i,syncIdField:s}):t&&(n=t.refOwner,i=t.refs,o=t.returnAll,s=t.syncIdField),"string"==typeof e.parent&&(e.parent=document.getElementById(e.parent)),e.syncOptions&&(s=e.syncOptions.syncIdField||s);const a=e.parent||e.nextSibling&&e.nextSibling.parentNode,{reference:l}=e;let c;c=e.ns?doc.createElementNS(e.ns,e.tag||"svg"):doc.createElement(e.tag||"div"),null!=e.html&&(e.html instanceof DocumentFragment?c.appendChild(e.html):c.innerHTML=e.html),e.tooltip&&DH$1.Widget.attachTooltip(c,e.tooltip),e.style&&DH$1.applyStyle(c,e.style),e.dataset&&Object.assign(c.dataset,e.dataset),e.for&&(c.htmlFor=e.for),a&&a.insertBefore(c,e.nextSibling),n&&(c.$refOwnerId=n.id),l&&(n?(n.byRef[c.$reference=l]=c,n.attachRef(l,c,e)):(i||((t=Object.assign({},t)).refs=i={}),i[l]=c,c.setAttribute("data-reference",l))),e.elementData&&(c.elementData=e.elementData);const d=e.className||e.class;d&&c.setAttribute("class",DomClassList.normalize(d));for(const t of Object.keys(e))elementCreateProperties[t]||(e.ns?c.setAttribute(t,e[t]):c[t]=e[t]);return!0===o?t.returnAll=o=[c]:Array.isArray(o)&&o.push(c),e.children&&(s&&(c.syncIdMap={}),e.children.forEach((r=>{if(r)if("string"==typeof r){const e=document.createTextNode(r);n&&(e.$refOwnerId=n.id),c.appendChild(e)}else if(isNaN(r.nodeType)){r.parent=c,!r.ns&&e.ns&&(r.ns=e.ns);const n=DH$1.createElement(r,t),i=r.dataset&&r.dataset[s];null!=i&&(c.syncIdMap[i]=n),delete r.parent}else c.appendChild(r)}))),c.lastDomConfig=e,e._element=c,i||o||c}static createElementFromTemplate(e,t=emptyObject){const{array:r,raw:n,fragment:i}=t;let s;if(DH$1.supportsTemplate){if((templateElement||(templateElement=doc.createElement("template"))).innerHTML=e,s=templateElement.content,i)return s.cloneNode(!0)}else{if((htmlParser||(htmlParser=new DOMParser)).parseFromString(e,"text/html"),s=htmlParser.parseFromString(e,"text/html").body,i){const e=s?s.childNodes:emptyArray;for(s=document.createDocumentFragment();e.length;)s.appendChild(e[0]);return s}s||(s={children:[],childNodes:[]})}return s=n?s.childNodes:s.children,1!==s.length||r?arraySlice.call(s):s[0]}static insertFirst(e,t){return t&&t.nodeType!==ELEMENT_NODE&&t.tag&&(t=DH$1.createElement(t)),e.insertBefore(t,e.firstElementChild)}static insertBefore(e,t,r){return t&&t.nodeType!==ELEMENT_NODE&&t.tag&&(t=DH$1.createElement(t)),r?e.insertBefore(t,r):DH$1.insertFirst(e,t)}static insertAt(e,t,r){const n=Array.from(e.children);if(r>=n.length)return DH$1.append(e,t);const i=n[r];return DH$1.insertBefore(e,t,i)}static append(e,t){if(t.forEach){if(Array.isArray(t)&&(t=t.map((e=>elementOrConfigToElement(e)))),e.append)e.append(...t);else{const r=document.createDocumentFragment();t.forEach((function(e){r.appendChild(e)})),e.appendChild(r)}return t}return e.appendChild(elementOrConfigToElement(t))}static getTranslateX(e){const t=e.style.transform;let r=pxTtranslateXRe.exec(t);return r?parseInt(r[2]):(r=translateMatrixRe.exec(t)||translateMatrixRe.exec(DH$1.getStyleValue(DH$1.getElement(e),"transform")),r?parseInt(r[1]||r[3]):0)}static getTranslateY(e){const t=e.style.transform;let r=pxTtranslateYRe.exec(t);if(r){const e=parseInt(r["Y"===r[1]?2:3]);return isNaN(e)?0:e}return r=translateMatrixRe.exec(t)||translateMatrixRe.exec(DH$1.getStyleValue(DH$1.getElement(e),"transform")),r?parseInt(r[2]||r[4]):0}static getTranslateXY(e){return[DH$1.getTranslateX(e),DH$1.getTranslateY(e)]}static getOffsetX(e,t=null){return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,t=null){return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,t=null){return[DH$1.getOffsetX(e,t),DH$1.getOffsetY(e,t)]}static focusWithoutScrolling(e){function t(e){e.forEach((({element:e,scrollLeft:t,scrollTop:r})=>{e.scrollLeft!==t&&(e.scrollLeft=t),e.scrollTop!==r&&(e.scrollTop=r)}))}if(BrowserHelper.chromeVersion>=64||BrowserHelper.firefoxVersion>=68)e.focus({preventScroll:!0});else{const r=DH$1.getParents(e).map((e=>({element:e,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop})));e.focus(),BrowserHelper.isIE11?t(r):setTimeout((()=>t(r)),0)}}static getPageX(e){return e.getBoundingClientRect().left+win.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+win.pageYOffset}static getExtremalSizePX(e,t){const r=StringHelper.hyphenate(t),n=r.split("-")[1];let i=DH$1.getStyleValue(e,r);return i=/%/.test(i)?e.parentElement?parseInt(DH$1.getStyleValue(e.parentElement,n),10):NaN:parseInt(i,10),i}static setTranslateX(e,t){const r=DH$1.getStyleValue(e,"transform").split(/,\s*/);t=DomHelper.roundPx(t),r.length>1?(r[r[0].startsWith("matrix3d")?12:4]=t,e.style.transform=r.join(",")):e.style.transform=`translateX(${t}px)`}static setTranslateY(e,t){const r=DH$1.getStyleValue(e,"transform").split(/,\s*/);t=DomHelper.roundPx(t),r.length>1?(r[r[0].startsWith("matrix3d")?13:5]=t,e.style.transform=r.join(",")+")"):e.style.transform=`translateY(${t}px)`}static setTop(e,t){DH$1.setLength(e,"top",t)}static setLeft(e,t){DH$1.setLength(e,"left",t)}static setTranslateXY(e,t,r){if(null==t)return DH$1.setTranslateY(e,r);if(null==r)return DH$1.setTranslateX(e,t);t=DomHelper.roundPx(t),r=DomHelper.roundPx(r);const n=DH$1.getStyleValue(e,"transform").split(/,\s*/),i=n[0].startsWith("matrix3d");n.length>1?(n[i?12:4]=t,n[i?13:5]=r,e.style.transform=n.join(",")+")"):e.style.transform=`translate(${t}px, ${r}px)`}static addTranslateX(e,t){DH$1.setTranslateX(e,DH$1.getTranslateX(e)+t)}static addTranslateY(e,t){DH$1.setTranslateY(e,DH$1.getTranslateY(e)+t)}static addLeft(e,t){DH$1.setLeft(e,DH$1.getOffsetX(e)+t)}static addTop(e,t){DH$1.setTop(e,DH$1.getOffsetY(e)+t)}static alignTo(e,t,r=t0t0,n){t=t instanceof Rectangle?t:Rectangle.from(t,!0);const i=DH$1.getTranslateXY(e),s=Rectangle.from(e,!0);n&&(s.round(),t.round());const o=s.alignTo(Object.assign(r,{target:t}));DH$1.setTranslateXY(e,i[0]+o.x-s.x,i[1]+o.y-s.y)}static getStyleValue(e,t,r,n){const i=r?e.style:e.ownerDocument.defaultView.getComputedStyle(e,n);if(Array.isArray(t)){const e={};for(const r of t)e[r]=i.getPropertyValue(StringHelper.hyphenate(r));return e}return i.getPropertyValue(StringHelper.hyphenate(t))}static getEdgeSize(e,t,r){const n="border"===t?"-width":"",i={raw:{}};for(const s of["top","right","bottom","left"])r&&!r.includes(s[0])||(i[s]=parseFloat(i.raw[s]=DomHelper.getStyleValue(e,`${t}-${s}${n}`)));return i.width=i.left+i.right,i.height=i.top+i.bottom,i}static parseStyle(e){if("string"==typeof e){const t=e.split(semicolonRe);e={};for(let r=0,{length:n}=t;r<n;r++){const n=t[r].split(colonRe);e[n[0]]=n[1]}}return e||{}}static applyStyle(e,t,r=!1){if("string"==typeof t)r?(t.length||e.style.cssText.length)&&(e.style.cssText=t):e.style.cssText+=t;else{r&&(e.style.cssText=""),t.style&&("string"==typeof t.style?e.style.cssText=t.style:t=Object.assign({},t.style,t));for(const r in t)styleIgnoreProperties[r]||(styleDimensionProperties[r]&&"number"==typeof t[r]?e.style[StringHelper.hyphenate(r)]=t[r]+"px":e.style[StringHelper.hyphenate(r)]=t[r])}}static getCSSText(e){if("string"==typeof e)return e;let t="";for(const r in e)styleIgnoreProperties[r]||(t+=`${StringHelper.hyphenate(r)}:${e[r]};`);return t}static addClasses(e,t){for(let r=0;r<t.length;r++)e.classList.add(t[r])}static removeClasses(e,t){for(let r=0;r<t.length;r++)e.classList.remove(t[r])}static toggleClasses(e,t,r=null){Array.isArray(t)||(t=[t]),!0===r?DH$1.addClasses(e,t):!1===r?DH$1.removeClasses(e,t):t.forEach((t=>e.classList.toggle(t)))}static addTemporaryClass(e,t,r,n=window){r>0&&(e.classList.add(t),n.setTimeout((()=>e.classList.remove(t)),r))}static getPropertyTransitionDuration(e,t){const r=window.getComputedStyle(e),n=r.transitionProperty.split(", "),i=r.transitionDuration.split(", "),s=n.indexOf(t);let o;return-1!==s&&(o=1e3*parseFloat(i[s])),o}static highlight(e,t=window){return e instanceof Rectangle?e.highlight():new Promise((r=>{t.setTimeout((()=>{e.classList.add("b-fx-highlight"),t.setTimeout((()=>{e.classList.remove("b-fx-highlight"),r()}),1e3)}),0)}))}static get scrollBarWidth(){if(null===scrollBarWidth&&doc.body){const e=DH$1.createElement({parent:doc.body,style:"position:absolute;top:-999px;width:100px;height:100px;overflow:scroll"});scrollBarWidth=e.offsetWidth-e.clientWidth,e.remove()}return scrollBarWidth}static get scrollBarPadElement(){return{className:"b-yscroll-pad",children:[{className:"b-yscroll-pad-sizer"}]}}static resetScrollBarWidth(){scrollBarWidth=null}static measureText(e,t,r=!1,n){const i=DH$1.getMeasureElement(t,n);i[r?"innerHTML":"innerText"]=e;const s=i.clientWidth;return i.className="",s}static measureSize(e,t){if(!e)return 0;if("number"==typeof e)return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(t){const r=DH$1.getMeasureElement(t);r.innerHTML="",r.style.width=DH$1.setLength(e);const n=r.offsetWidth;return r.style.width=r.className="",n}return/^\d+em$/.test(e)?14*parseInt(e):isNaN(e)?0:parseInt(e)}static getMeasureElement(e,t=doc.body){const r=win.getComputedStyle(e),n=t.offScreenDiv=t.offScreenDiv||DH$1.createElement({parent:t,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},!0)[1];return fontProps.forEach((e=>{n.style[e]!==r[e]&&(n.style[e]=r[e])})),n.className=e.className,n.parentElement.parentElement!==t&&t.appendChild(n.parentElement),n}static sync(e,t){if("string"==typeof e){if(""===e)return void(t.innerHTML="");e=DH$1.createElementFromTemplate(e)}return DH$1.performSync(e,t),t}static performSync(e,t){return e.outerHTML!==t.outerHTML&&(DH$1.syncAttributes(e,t),DH$1.syncContent(e,t),DH$1.syncChildren(e,t),!0)}static getSyncAttributes(e){const t={},r=[];for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n];if(i.specified){const e=i.name.toLowerCase();t[e]=i.value,r.push(e)}}return{attributes:t,names:r}}static syncAttributes(e,t){const{attributes:r,names:n}=DH$1.getSyncAttributes(e),{attributes:i,names:s}=DH$1.getSyncAttributes(t),o=n.includes("dataset"),a=n.filter((e=>!s.includes(e))),l=s.filter((e=>!(n.includes(e)||o&&e.startsWith("data-")))),c=n.filter((e=>s.includes(e)));if(a.length>0)for(let e=0;e<a.length;e++){const n=a[e];"style"===n?DH$1.applyStyle(t,r.style,!0):"dataset"===n?Object.assign(t.dataset,r.dataset):t.setAttribute(n,r[n])}if(l.length>0)for(let e=0;e<l.length;e++)t.removeAttribute(l[e]);if(c.length>0)for(let e=0;e<c.length;e++){const n=c[e];if("style"===n)DH$1.applyStyle(t,r.style,!0);else if("dataset"===n)Object.assign(t.dataset,r.dataset);else if("class"!==n||!r.class.isDomClassList&&"object"!=typeof r.class)i[n]!==r[n]&&t.setAttribute(n,r[n]);else{let e;e=r.class.isDomClassList?r.class:new DomClassList(r.class),e.isEqual(i.class)||t.setAttribute("class",e)}}}static syncContent(e,t){0===e.childElementCount&&(t.innerText=e.innerText)}static setInnerText(e,t){const r=e.firstChild;r?r.data=t:e.textContent=t}static syncChildren(e,t){const r=this,n=arraySlice.call(e.childNodes),i=arraySlice.call(t.childNodes);for(;n.length;){const e=n.shift(),s=i.shift();if(e&&e.nodeType!==TEXT_NODE&&e.nodeType!==ELEMENT_NODE)throw new Error(`Source node type ${e.nodeType} not supported by DomHelper.sync()`);if(s&&s.nodeType!==TEXT_NODE&&s.nodeType!==ELEMENT_NODE)throw new Error(`Target node type ${s.nodeType} not supported by DomHelper.sync()`);if(s)if(e.nodeType===s.nodeType)e.nodeType===TEXT_NODE?s.data=e.data:e.tagName===s.tagName?r.performSync(e,s):(t.insertBefore(e,s),s.remove());else{if(e.nodeType!==TEXT_NODE||s.nodeType!==ELEMENT_NODE)throw new Error("Currently no support for transforming nodeType");t.innerText=e.data.trim()}else t.appendChild(e)}i.forEach((e=>{e.remove()}))}static syncClassList(e,t){const r=e.classList,n="string"==typeof t,i=n?t.trim().split(whiteSpaceRe$2):Array.isArray(t)?t:ObjectHelper.getTruthyKeys(t),s=i.length;let o,a=r.length!==s;for(o=0;!a&&o<s;o++)a=!r.contains(i[o]);a&&(e.className=n?t:i.join(" "))}static setTheme(e){e=e.toLowerCase();const t=DH$1.themeInfo.name.toLowerCase(),r=document.head.querySelector("#bryntum-theme:not([data-loading])")||document.head.querySelector(`[href$="${t}.css"]:not([data-loading])`);if(DomHelper.removeEachSelector(document.head,"#bryntum-theme[data-loading]"),!r||!r.href.includes(t+".css"))throw new Error(`Theme link for ${t} not found`);return r.href.includes(e+".css")?immediatePromise:new Promise(((t,n)=>{const i=document.createElement("link"),s=r.nextSibling,o=DH$1.themeInfo.name.toLowerCase(),a={theme:e,prev:o};i.rel="stylesheet",i.id="bryntum-theme",i.addEventListener("load",(()=>{delete i.dataset.loading,themeInfo=null,r.remove(),window.bryntum.GlobalEvents.trigger("theme",a),t(a)})),i.addEventListener("error",(e=>{delete i.dataset.loading,n(e)})),i.dataset.loading="true",i.href=r.href.replace(o,e),s.parentNode.insertBefore(i,s)}))}static get themeInfo(){if(!themeInfo){const e=DH$1.createElement({parent:document.body,className:"b-theme-info"}),t=DH$1.getStyleValue(e,"content",!1,":before");if(t)try{themeInfo=JSON.parse(t.replace(/^["']|["']$|\\/g,""))}catch(e){themeInfo=null}e.remove()}return themeInfo}static isOrphaned(e){return e!==document.body&&e!==document.documentElement&&e.nodeType===Node.ELEMENT_NODE&&null===e.offsetParent}}const DH$1=DomHelper;let clearTouchTimer;const clearTouchEvent=()=>DH$1.isTouchEvent=!1,setTouchEvent=()=>{DH$1.isTouchEvent=!0,clearTimeout(clearTouchTimer),clearTouchTimer=setTimeout(clearTouchEvent,400)};if(doc.addEventListener("touchstart",setTouchEvent,!0),doc.addEventListener("touchend",setTouchEvent,!0),DH$1.supportsTemplate="content"in doc.createElement("template"),DH$1.elementPropKey="$bryntum",DH$1.numberRe=numberRe,!("children"in Node.prototype)){const e=e=>1===e.nodeType;Object.defineProperty(Node.prototype,"children",{get:function(){return Array.prototype.filter.call(this.childNodes,e)}})}if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){const t=(this.document||this.ownerDocument).querySelectorAll(e);let r=t.length;for(;--r>=0&&t.item(r)!==this;);return r>-1}),win.Element&&!Element.prototype.closest?Node.prototype.closest=Element.prototype.closest=function(e){var t=this;if(!doc.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}:Node.prototype.closest=function(e){var t;return null===(t=this.parentNode)||void 0===t?void 0:t.closest(e)},[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(e){Object.prototype.hasOwnProperty.call(e,"remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})})),SVGElement.prototype.contains||(SVGElement.prototype.contains=function(e){do{if(this===e)return!0;e=e.parentNode}while(e);return!1}),"function"!=typeof win.CustomEvent){let e,t;win.CustomEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:void 0}){return e=doc.createEvent("CustomEvent"),e.initCustomEvent(t,r.bubbles,r.cancelable,r.detail),e},t.prototype=win.Event.prototype,win.MouseEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:void 0}){return e=doc.createEvent("MouseEvents"),e.initMouseEvent(t,r.bubbles,r.cancelable,doc.defaultView||win,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,document),e},t.prototype=win.Event.prototype,win.KeyboardEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:void 0}){const n=`${r.shiftKey?"Shift ":""}${r.ctrlKey?"Control":""}`;return e=doc.createEvent("KeyboardEvent"),e.initKeyboardEvent(t,r.bubbles,r.cancelable,doc.defaultView||win,r.key,r.location,n,!1,""),e},t.prototype=win.Event.prototype}if(!Object.getOwnPropertyDescriptor(SVGElement.prototype,"dataset")||!Object.getOwnPropertyDescriptor(SVGElement.prototype,"dataset").get){var propDescriptor={enumerable:!0,get:function(){var e,t,r,n,i,s={},o=this.attributes,a=o.length,l=function(e){return e.charAt(1).toUpperCase()},c=function(){return this},d=function(e,t){return void 0!==t?this.setAttribute(e,t):this.removeAttribute(e)};for(e=0;e<a;e++)(i=o[e])&&i.name&&/^data-\w[\w-]*$/.test(i.name)&&(t=i.value,n=(r=i.name).substr(5).replace(/-./g,l),Object.defineProperty(s,n,{enumerable:this.enumerable,get:c.bind(t||""),set:d.bind(this,r)}));return s}};Object.defineProperty(SVGElement.prototype,"dataset",propDescriptor)}const nativeAdd=DOMTokenList.prototype.add,nativeRemove=DOMTokenList.prototype.remove;DOMTokenList.prototype.add=function(e){Array.isArray(e)?e.forEach((e=>nativeAdd.call(this,e))):nativeAdd.call(this,...arguments)},DOMTokenList.prototype.remove=function(e){Array.isArray(e)?e.forEach((e=>nativeRemove.call(this,e))):nativeRemove.call(this,...arguments)},window.addEventListener("resize",(()=>scrollBarWidth=null)),DomHelper._$name="DomHelper";const GlobalEvents=(window.bryntum||(window.bryntum={})).GlobalEvents=new class extends(Base.mixin(Events)){suspendFocusEvents(){focusEventsSuspended=!0}resumeFocusEvents(){focusEventsSuspended=!1}get lastInteractionType(){return lastInteractionType}},isTopVisibleModal=e=>e.isVisible&&e.isTopModal;let globaltouchStart,lastInteractionType,detacher,focusEventsSuspended=!1;function createWidgetEvent(e,t,r,n,i,s,o){const a=new CustomEvent(e,o);return Object.defineProperty(a,"_target",{get:()=>t}),Object.defineProperty(a,"relatedTarget",{get:()=>r}),a.fromWidget=n,a.toWidget=i,a.backwards=s,a}function getCommonAncestor(e,t){return DomHelper.getCommonAncestor(e,t)}function setupFocusListeners(e=document,t,r=!1){const n={element:e,touchstart(e){globaltouchStart=globaltouchStart||1!==e.changedTouches.length?null:e.changedTouches[0]},touchend:{handler:e=>{globaltouchStart&&(globaltouchStart.identifier===t.contextMenuTouchId?(e.stopImmediatePropagation(),e.preventDefault()):1===e.changedTouches.length&&e.changedTouches[0].identifier===globaltouchStart.identifier&&GlobalEvents.trigger("globaltap",{event:e}),globaltouchStart=null)},passive:!1},mousedown:{handler:e=>{lastInteractionType="mouse",globaltouchStart||GlobalEvents.trigger("globaltap",{event:e})},passive:!1},keydown(){lastInteractionType="key"},keypress(){lastInteractionType="key"},focusin(e){if(GlobalEvents.Widget.floatRoot.scrollTop=GlobalEvents.Widget.floatRoot.scrollLeft=0,focusEventsSuspended)return;const t=e.relatedTarget?e.relatedTarget instanceof HTMLElement?e.relatedTarget:document.body:null,r=e.target||document.body,n=GlobalEvents.Widget.fromElement(t),i=GlobalEvents.Widget.fromElement(r),s=getCommonAncestor(n,i),o=!!(t&&4&r.compareDocumentPosition(t)),a=GlobalEvents.Widget.query(isTopVisibleModal),l=DomHelper.activeElement;if(a&&(!i||!a.owns(i)))return void a.focus();let c=createWidgetEvent("focusout",t,e.target,n,i,o);for(let t=n;t&&t!==s;t=t.owner)if(!t.isDestroying&&t.onFocusOut&&(t.onFocusOut(c),e.target&&l!==DomHelper.activeElement))return;if(s&&e.target===s.element)DomHelper.activeElement===r&&s.focusElement&&s.focusElement!==s.element&&s.setTimeout((()=>s.focus&&s.focus()),0);else{c=createWidgetEvent("focusin",r,t,n,i,o);for(let e=i;e&&e!==s;e=e.owner)e.isDestroying||e.onFocusIn&&e.onFocusIn(c)}const d=getCommonAncestor(t&&1===t.nodeType?t:null,r)||r.parentNode;c=createWidgetEvent("focusmove",r,t,n,i,o,{bubbles:!0}),d.dispatchEvent(c)},focusout(e){if(!(focusEventsSuspended||e.relatedTarget&&GlobalEvents.Widget.fromElement(e.relatedTarget))){const t=e.relatedTarget&&e.relatedTarget instanceof HTMLElement?e.relatedTarget:null;n.focusin({target:t,relatedTarget:e.target})}},capture:!0,passive:!0};r&&detacher&&detacher(),detacher=t.on(n)}function getDescriptor(e,t){const r=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t);return r&&(r.get||r.set)?r:null}class InstancePlugin extends(Base.mixin(Events,Localizable)){static get configurable(){return{clientListeners:null,disabled:!1}}static initPlugins(e,...t){const r=e.plugins||(e.plugins={});for(const n of t)r[n.$$name]=new n(e)}get client(){return this._client}set client(e){this._client=e}getFocusRevertTarget(){var e;return null===(e=this.client)||void 0===e?void 0:e.getFocusRevertTarget()}construct(...e){const t=this;let r,[n,i]=e;1===e.length?ObjectHelper.isObject(n)&&(i=n,n=i.client):(i=ObjectHelper.assign({},i),delete i.client),t.client=n,super.construct(i),t.applyPluginConfig(n),r=t.clientListeners,r&&(r=ObjectHelper.assign({},r),r.thisObj=t,n.on(r))}applyPluginConfig(e){const t=this,r=t.pluginConfig||t.constructor.pluginConfig;if(r){const{assign:n,chain:i,after:s,before:o,override:a}=r;n&&t.applyAssign(e,n),(i||s)&&t.applyChain(e,i||s),o&&t.applyChain(e,o,!1),a&&t.applyOverride(e,a)}}applyAssign(e,t){t.forEach((t=>this.assign(e,t)))}applyChain(e,t,r=!0){if(Array.isArray(t))for(const n of t)this.chain(e,n,n,r);else for(const n in t)this.chain(e,n,t[n],r)}applyOverride(e,t){const r=this;r.overridden||(r.overridden={}),t.forEach((t=>{if(!r[t])throw new Error(`Trying to chain fn ${e.$$name}#${t}, but plugin fn ${r.$$name}#${t} does not exist`);"function"==typeof e[t]&&(r.overridden[t]=e[t].bind(e)),e[t]=r[t].bind(r)}))}assign(e,t){const r=this,n=getDescriptor(r,t);n?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n.get&&n.get.bind(r),set:n.set&&n.set.bind(r)}):e[t]=r[t].bind(r)}chain(e,t,r,n=!0){const i=this,s=e.pluginFunctionChain||(e.pluginFunctionChain={}),o=i[r]&&i[r].bind(i),a=i.functionChainRunner;if(!o)throw new Error(`Trying to chain fn ${e.$$name}#${r}, but plugin fn ${i.$$name}#${r} does not exist`);if(!s[t]){let r=e[t];r&&(r=r.bind(e),r.$this=e),s[t]=r?[r]:[],e[t]=(...e)=>a(s[t],e)}o.$this=i,s[t][n?"push":"unshift"](o)}functionChainRunner(e,t){let r,n,i;for(n=0;n<e.length&&(r=e[n],r.$this.isDestroyed||(i=r(...t),!1!==i));n++);return i}doDisable(e){const t=this,{constructor:r}=t,n="featureClass"in r?r.featureClass:"b-"+r.$$name.toLowerCase();var i,s;n&&(null===(i=t.client)||void 0===i||null===(s=i.element)||void 0===s||s.classList[e?"remove":"add"](n));t.isConfiguring||(e?t.trigger("disable"):t.trigger("enable"))}updateDisabled(e){this.doDisable(e)}throwOverrideIsMissing(e){throw new Error(`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`)}}InstancePlugin._$name="InstancePlugin";var Pluggable=e=>class extends(e||Base){static get $name(){return"Pluggable"}get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(e){e&&(Array.isArray(e)||(e=[e]),InstancePlugin.initPlugins(this,...e)),this.initPlugins()}initPlugins(){}addPlugins(...e){InstancePlugin.initPlugins(this,...e)}hasPlugin(e){return null!=this.getPlugin(e)}getPlugin(e){return"function"==typeof e&&(e=e.$$name),this.plugins&&this.plugins[e]}get widgetClass(){}},State=e=>class extends(e||Base){static get $name(){return"State"}get state(){return this._state=this.getState(),this._state}set state(e){this._state=e,this.applyState(e)}get widgetClass(){}};const idCounts=Object.create(null),idTypes={string:1,number:1};var Identifiable=e=>class extends(e||Base){static get $name(){return"Identifiable"}static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(e,t){const{identifiable:r}=e;r.idMap=Object.create(null),Reflect.defineProperty(e,"identifiable",{get:()=>r})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(e,t){const r=this;return t&&(r.hasGeneratedId=!1,r.constructor.unregisterInstance(r)),e=e||r.generateAutoId(),r.constructor.registerInstance(r,e),e}generateAutoId(){return this.hasGeneratedId=!0,this.constructor.generateId(`b-${this.$$name.toLowerCase()}-`)}static generateId(e="generatedId"){return e+(idCounts[e]=(idCounts[e]||0)+1)}static registerInstance(e,t=e.id){const{idMap:r}=this.identifiable;if(t in r&&!this.disableThrow)throw new Error("Id "+t+" already in use");r[t]=e}static unregisterInstance(e){const t=this.identifiable.idMap;idTypes[typeof e]?delete t[e]:t[e.id]===e&&delete t[e.id]}static getById(e){const t=this.identifiable.idMap;if(t)return t[e]}static get registeredInstances(){const e=this.identifiable.idMap;return e?Object.values(e):[]}};const STM_PROP=Symbol("STM_PROP"),unrecordedFields={parentIndex:1};var ModelStm=e=>class extends(e||Base){static get $name(){return"ModelStm"}static get defaultConfig(){return{stm:null}}joinStore(e){super.joinStore&&super.joinStore(e),this.stm||(this.stm=e.stm)}unJoinStore(e){this.stm===e.stm&&(this.stm=null),super.unJoinStore&&super.unJoinStore(e)}get stm(){return this[STM_PROP]}set stm(e){this[STM_PROP]=e}beforeSet(e,t,r,n){const i=super.beforeSet?super.beforeSet(e,t,r,n):[],s=this.stm;if(s&&!s.disabled&&!unrecordedFields[e]){let r,n;"object"==typeof e?[r,n]=Object.keys(e).reduce(((t,r)=>(t[0][r]=e[r],t[1][r]=this.get(r),t)),[{},{}]):(r={[e]:t},n={[e]:this.get(e)}),i.push([r,n])}return i}afterSet(e,t,r,n,i,s){const o=this.stm;if(o&&!o.disabled&&!unrecordedFields[e]){const e=i.pop();if(s){let[t,r]=e,[n,i]=Object.keys(s).reduce(((e,n)=>(e[0][n]=t[n],e[1][n]=r[n],e)),[{},{}]);o.onModelUpdate(this,n,i)}}super.afterSet&&super.afterSet(e,t,r,n,i,s)}beforeInsertChild(e){const t=super.beforeInsertChild?super.beforeInsertChild(e):[],r=this.stm;return r&&!r.disabled&&t.push(e.reduce(((e,t)=>(t.root===this.root&&e.set(t,{parent:t.parent,index:t.parent?t.parentIndex:void 0}),e)),new Map)),t}afterInsertChild(e,t,r,n){const i=this.stm;if(i&&!i.disabled){const t=r.pop();n&&i.onModelInsertChild(this,e,n,t)}super.afterInsertChild&&super.afterInsertChild(e,t,r,n)}beforeRemoveChild(e,t){const r=super.beforeRemoveChild?super.beforeRemoveChild(e,t):[],n=this.stm;return!n||n.disabled||t||r.push(e.reduce(((e,t)=>(e.set(t,t.parentIndex),e)),new Map)),r}afterRemoveChild(e,t,r){const n=this.stm;if(n&&!n.disabled&&!r){const r=t.pop();e&&e.length&&n.onModelRemoveChild(this,e,r)}super.afterRemoveChild&&super.afterRemoveChild(e,t,r)}},TreeNode=e=>class extends(e||Base){static get $name(){return"TreeNode"}static set convertEmptyParentToLeaf(e){!0===e?e={onLoad:!0,onRemove:!0}:!1===e&&(e={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=e}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(e,t=this.stores){const{inProcessChildren:r,constructor:n}=this,i=t[0];if(!0===e)return!!r||[];if(e){Array.isArray(e)||(e=[e]);const t=e.length,r=[];for(let s,o=0;o<t;o++)s=e[o],s=s.isModel?s:i?i.createRecord(s):new n(s,null,null,!0),s=i?i.processRecord(s):s,r.push(s);return r}}processChildren(e=this.stores){const t=this,{meta:r}=t;t.inProcessChildren=!0;const n=t.ingestChildren(t.data[t.constructor.childrenField],e);n&&(n.length?(r.isLeaf=!1,!0===t.children&&(t.children=[]),t.appendChild(n)):!0===n?(r.isLeaf=!1,t.children=!0):t.isRoot||(r.isLeaf=t.constructor.convertEmptyParentToLeaf.onLoad)),t.inProcessChildren=!1}ancestorsExpanded(e){const{parent:t}=this;return!t||t.isExpanded(e)&&t.ancestorsExpanded(e)}isExpanded(e){const t=this.instanceMeta(e.id);return Object.prototype.hasOwnProperty.call(t,"collapsed")||(t.collapsed=!this.expanded),!t.collapsed}get expanded(){return this.data.expanded}get childLevel(){let e=this,t=-1;for(;e&&!e.isRoot;)++t,e=e.parent;return t}get isLeaf(){return!1!==this.meta.isLeaf&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(e=!1,t=this.firstStore){const r=this.children;return!r||!Array.isArray(r)||e&&!this.isExpanded(t)?0:r.reduce(((t,r)=>t+r.getDescendantCount(e)),r.length)}get allChildren(){const e=this.children;return e?e.reduce(((e,t)=>(e.push(t),e.push.apply(e,t.allChildren),e)),[]):[]}get firstChild(){const e=this.children;return e&&e.length&&e[0]||null}get lastChild(){const e=this.children;return e&&e.length&&e[e.length-1]||null}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get root(){return this.parent&&this.parent.root||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(e){const t=this,{parent:r}=t,n=e&&t.firstStore.getById(e);n!==r&&(r||n)&&(t.isBatchUpdating?t.meta.batchChanges.parentId=e:n?n.appendChild(t):t.parent.removeChild(t))}static set parentIdField(e){this._parentIdField=e,Object.defineProperty(this.prototype,e,{set:function(e){this.parentId=e},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}traverse(e,t=!1){const{children:r}=this;t||e.call(this,this);for(let t=0,n=r&&r.length;t<n;t++)r[t].traverse(e)}traverseBefore(e,t=!1){const{children:r}=this;for(let t=0,n=r&&r.length;t<n;t++)r[t].traverse(e);t||e.call(this,this)}traverseWhile(e,t=!1){const r=this;let n=!0;return t||(n=!1!==e.call(r,r)),n&&r.isLoaded&&(n=r.children.every((t=>t.traverseWhile(e)))),n}bubble(e,t=!1){let r=this;for(t||e.call(r,r);r.parent;)r=r.parent,e.call(r,r)}bubbleWhile(e,t=!1){let r=this,n=!0;for(t||(n=e.call(r,r));n&&r.parent;)r=r.parent,n=e.call(r,r);return n}contains(e){return e&&"object"==typeof e&&(e=e.id),!this.traverseWhile((t=>t.id!=e))}getTopParent(e){let t;return e?(t=[],this.bubbleWhile((e=>(t.push(e),e.parent&&!e.parent.isRoot)))):(t=null,this.bubbleWhile((e=>(e.parent||(t=e),e.parent&&!e.parent.isRoot)))),t}appendChild(e,t=!1){return this.insertChild(e,null,t)}insertChild(e,t=null,r=!1){if("number"==typeof e){const r=e;e=t,t=this.children[r]}const n=this,i=n.isLeaf,s=Array.isArray(e);if(Array.isArray(e)||(e=[e]),!r&&!n.stores.every((t=>!1!==t.trigger("beforeAdd",{records:e,parent:n}))))return null;e=n.ingestChildren(e);const o=t?t.parentIndex:n.children?n.children.length:0,a=n.beforeInsertChild?n.beforeInsertChild(e):void 0,l=n.internalAppendInsert(e,t,r);return i&&l.length&&(n.meta.isLeaf=!1),n.isLeaf===i||n.root.isLoading||r||n.stores.forEach((e=>{const t={isLeaf:{value:!1,oldValue:!0}};e.trigger("update",{record:n,changes:t}),e.trigger("change",{action:"update",record:n,changes:t})})),n.afterInsertChild&&n.afterInsertChild(o,e,a,l),s||!l?l:l[0]}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(e,t,r){const n=this,{stores:i,root:s}=n,{firstStore:o}=s,{parentIdField:a}=n.constructor,l=n.isAutoRoot?null:n.id,c={};let d,u,h,g;if(t&&t.parent!==n&&(t=null),n.children){const r=n.children,i=t?t.parentIndex:r.length;if(r[u=i]===e[0]||r[u=i-1]===e[0])for(d=!0,h=0;d&&h<e.length;h++)e[h]!==r[u+h]&&(d=!1)}if(d)return e;for(h=0;h<e.length;h++){const t=e[h],r=t.parent;c[t.id]=t.root===s,o&&t.traverse((e=>{e.root===s&&(c[e.id]=!0)})),r&&!1===r.removeChild(t,c[t.id])?(g||(e=e.slice(),g=!0),e.splice(h--,1)):(t.parent=n,t.data[a]=l,r&&(t.meta.oldParentId=r.id))}if(e.length){const s=n.addToChildren(n.children||(n.children=[]),t,e);n.addToChildren(n.unfilteredChildren,t,e,!0),i.forEach((t=>{t.isChained||(e.forEach((e=>{e.joinStore(t)})),t.onNodeAddChild(n,e,s,c,r),e.forEach((e=>{if(null!=e.meta.oldParentId&&!n.inProcessChildren&&!n.isLoading){const t={[a]:l,[n.getDataSource("parentIndex")]:e.parentIndex},r={},{modified:i,oldParentId:s}=e.meta,o=i.parentIndex;delete e.meta.oldParentId,n.id!==s&&(r[a]={value:l,oldValue:s}),e.parentIndex!==o&&(r.parentIndex={value:e.parentIndex,oldValue:o}),i[a]===n.id?Reflect.deleteProperty(i,a):a in i||(i[a]=s),e.afterChange(t,r)}})))}))}return e}removeChild(e,t=!1,r=!1){const n=this,i=n.isLeaf,{children:s,stores:o}=n;if(Array.isArray(e)||(e=[e]),e=e.filter((e=>e.parent===n)),!r)for(const r of o)if(!r.isChained&&!1===r.trigger("beforeRemove",{parent:n,records:e,isMove:t}))return!1;const a=n.beforeRemoveChild?n.beforeRemoveChild(e,t):void 0;for(const i of e){const{parentIdField:e}=i.constructor,{modified:a}=i.meta,l=i.parent?i.parent.id:null;e in a||(a[e]=l);const c=n.removeFromChildren(s,i);n.removeFromChildren(n.unfilteredChildren,i,!0),o.forEach((e=>{e.isChained||e.onNodeRemoveChild(n,[i],c,{isMove:t,silent:r})})),t||(i.parent=i.parentIndex=i.unfilteredIndex=i.nextSibling=i.previousSibling=null,i.data[e]=null)}s.length||!n.constructor.convertEmptyParentToLeaf.onRemove||n.isRoot||(n.meta.isLeaf=!0),n.isLeaf===i||r||n.stores.forEach((e=>{const t={isLeaf:{value:!0,oldValue:!1}};e.trigger("update",{record:n,changes:t}),e.trigger("change",{action:"update",record:n,changes:t})})),n.afterRemoveChild&&n.afterRemoveChild(e,a,t)}clearParentId(){const e=this;Reflect.deleteProperty(e.data,e.parentIdField),Reflect.deleteProperty(e.originalData,e.parentIdField),e.meta.modified&&Reflect.deleteProperty(e.meta.modified,e.parentIdField)}clearChildren(e=!1){const t=this,{children:r,stores:n}=t;r&&(t.children=[],n.forEach((n=>{n.isChained||n.onNodeRemoveChild(t,r,0,{unfiltered:!0,silent:e})})),t.unfilteredChildren&&(t.unfilteredChildren=[]))}clear(){const e=this,{stores:t}=e,r=e.children&&e.children.slice();if(e.isRoot&&r){for(const n of t)if(!n.isChained&&!1===n.trigger("beforeRemove",{parent:e,records:r,isMove:!1,removingAll:!0}))return!1;e.children.length=0,t.forEach((e=>{r.forEach((t=>{t.stores.includes(e)&&t.unJoinStore(e),t.parent=t.parentIndex=t.nextSibling=t.previousSibling=null})),e.storage.suspendEvents(),e.storage.clear(),e.storage.resumeEvents(),e.added.clear(),e.modified.clear(),e.trigger("removeAll"),e.trigger("change",{action:"removeall"})}))}}updateChildrenIndices(e,t=!1,r=!1){const n=t?"unfilteredIndex":"parentIndex";let i=null;for(let s=0;s<e.length;s++){const o=e[s],a=o[n];"parentIndex"===n?void 0===a||r?o.setData("parentIndex",s):a!==s&&o.set("parentIndex",s,!0):o[n]=s,t||(o.previousSibling=i,i&&(i.nextSibling=o),s===e.length-1&&(o.nextSibling=null),i=o)}}addToChildren(e,t,r,n=!1){if(e){const i=n?"unfilteredIndex":"parentIndex",s=t?t[i]:e.length;return e.splice(s,0,...r),this.updateChildrenIndices(e,n),s}}removeFromChildren(e,t,r=!1){if(e){const n=t[r?"unfilteredIndex":"parentIndex"];return n>-1&&(e.splice(n,1),this.updateChildrenIndices(e,r)),n}}};const{defineProperty:defineProperty$2}=Reflect,ownerSymbol=Symbol("owner"),typeSplitRe=/[\s,]+/;var Factoryable=e=>class extends(e||Base){static get $name(){return"Factoryable"}static get declarable(){return["factoryable","alias","type"]}static register(e,t,r=!1){const{factoryable:n}=this.initClass(),{caseless:i,registry:s}=n,o=StringHelper.split(e,typeSplitRe);for(let e,a,l=0;l<o.length;++l){if(a=o[l],e=i?a.toLowerCase():a,!r&&e in s)throw new Error(`Type "${a}" already registered with ${n.class.name} factory`);s[a]=s[e]=t.initClass()}}static isA(e,t){return this.isType(e,t,!0)}static isType(e,t,r){const{factoryable:n}=this,{caseless:i,registry:s}=n,o=s[i?t.toLowerCase():t];return!!o&&(r?e instanceof o:e.constructor===o)}static setupAlias(e){e.register(e.alias,e)}static setupFactoryable(e,t){const r=t.super.class;let{factoryable:n}=e;n={caseless:!0,defaultType:null,extends:r.factoryable?[r]:null,typeKey:"type",...n},n.class=e,n.registry=Object.create(null),n.extends&&!Array.isArray(n.extends)&&(n.extends=[n.extends]),defineProperty$2(e,"factoryable",{get:()=>n})}static setupType(e){const{type:t}=e;e.register(t,e),defineProperty$2(e.prototype,"type",{value:t})}static create(e,t){return this.reconfigure(null,e,t)}static reconfigure(e,t,r){const n=this,{factoryable:i}=n,{typeKey:s}=i;let o,a,l,c,d,u,h,g=t,m=r;if(r&&!ObjectHelper.isClass(r)&&(m=null,h=typeof r,"function"===h?u=r:"string"===h?m=r:ObjectHelper.isObject(r)?(o=r.cleanup,a=r.defaults,c=r.owner,u=r.setup,m=r.type):c=r),"string"==typeof g)t={};else if(t){if(!ObjectHelper.isObject(t)){var p;if(c&&t!==e&&(null==e?void 0:e[ownerSymbol])===c)"string"==typeof o?c[o](e):null===(p=o)||void 0===p||p(e),e.destroy();return t}g=t[s]}if(g=g&&n.resolveType(g),e){if(t&&(!g||e.constructor===g))return s in t&&delete(t=ObjectHelper.assign({},t))[s],e.setConfig(t),e;var f;if(c&&e[ownerSymbol]===c)"string"==typeof o?c[o](e):null===(f=o)||void 0===f||f(e),e.destroy()}if(t){if(a){if(!(l=g)){if(!(l=a[s]||m||i.defaultType))throw new Error(`No default mergeType defined for ${i.class.name} factory`);l=n.resolveType(l)}l&&(t=l.mergeConfigs(a,t))}if(u){if(d="string"==typeof u?c[u](t,g,a):u(t,g,a),null===d)return d;t=d||t}if(!g){if(!(g=t[s]||m||i.defaultType))throw new Error(`No default type defined for ${i.class.name} factory`);g=n.resolveType(g)}a&&!l&&(t=g.mergeConfigs(a,t)),s in t&&delete(t=ObjectHelper.assign({},t))[s],t=new g(t),c&&(t[ownerSymbol]=c)}return t||null}static resolveType(e,t){if("string"!=typeof e)return e;const{factoryable:r}=this,n=r.extends;let i,s=r.registry[r.caseless?e.toLowerCase():e];for(i=0;!s&&n&&i<n.length;++i)s=n[i].resolveType(e,!0);if(!s&&!t)throw new Error(`Invalid type name "${e}" passed to ${r.class.name} factory`);return s}};class DataField extends(Base.mixin(Factoryable)){static get type(){return"auto"}static get factoryable(){return{defaultType:"auto"}}static get prototypeProperties(){return{compare:null,compareItems:null,dataSource:null,nullable:!0,nullText:null,nullValue:void 0,persist:!0,readOnly:!1}}construct(e){const t=this;e&&(t.name=e.name,Object.assign(t,e)),t.compare&&(t.compareItems=(e,r)=>t.compare(null==e?void 0:e[t.name],null==r?void 0:r[t.name]))}defineAccessor(e,t){const{name:r}=this;!t&&r in e||Reflect.defineProperty(e,r,{configurable:!0,enumerable:!0,get(){return this.get(r)},set(e){const t=this.$meta.fields.map[r];t&&t.readOnly||this.set(r,e)}})}isEqual(e,t){return ObjectHelper.isEqual(e,t)}print(e){return null==e?this.nullText:this.printValue(e)}printValue(e){return String(e)}}DataField._$name="DataField";class BooleanDataField extends DataField{static get type(){return"boolean"}static get alias(){return"bool"}static get prototypeProperties(){return{nullValue:!1}}convert(e){return null==e?this.nullable?e:this.nullValue:Boolean(e)}}BooleanDataField.initClass(),BooleanDataField._$name="BooleanDataField";class DateDataField extends DataField{static get type(){return"date"}static get prototypeProperties(){return{format:null}}get dateFormat(){return this.format}set dateFormat(e){VersionHelper.deprecate("Core","5.0.0",`DateDataField "${this.name}": dateFormat config has been renamed to "format"`),this.format=e}convert(e){return null==e?this.nullable||(e=this.nullValue):"now"===e?e=new Date:e instanceof Date||(e=(e=DateHelper.parse(e,this.format||DateHelper.defaultParseFormat))||void 0),e}serialize(e){return e instanceof Date&&(e=DateHelper.format(e,this.format||DateHelper.defaultFormat)),e}printValue(e){return DateHelper.format(e,this.format||DateHelper.defaultFormat)}}DateDataField.initClass(),DateDataField._$name="DateDataField";class IntegerDataField extends DataField{static get type(){return"integer"}static get alias(){return"int"}static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(e){return null==e?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}}IntegerDataField.initClass(),IntegerDataField._$name="IntegerDataField";class ModelDataField extends DataField{static get type(){return"model"}static get prototypeProperties(){return{complexMapping:!0}}}ModelDataField.initClass(),ModelDataField._$name="ModelDataField";class NumberDataField extends DataField{static get type(){return"number"}static get alias(){return"float"}static get prototypeProperties(){return{nullValue:0,precision:null}}convert(e){if(null==e)return this.nullable?e:this.nullValue;e=Number(e);let t=this.precision;return t?(t=10**t,e=Math.round(e*t)/t):0===t&&(e=Math.round(e)),e}}NumberDataField.initClass(),NumberDataField._$name="NumberDataField";class ObjectDataField extends DataField{static get type(){return"object"}static get prototypeProperties(){return{complexMapping:!0}}}ObjectDataField.initClass(),ObjectDataField._$name="ObjectDataField";class StringDataField extends DataField{static get type(){return"string"}static get prototypeProperties(){return{nullValue:""}}convert(e){return null==e?this.nullable?e:this.nullValue:String(e)}}StringDataField.initClass(),StringDataField._$name="StringDataField";const{defineProperty:defineProperty$3}=Reflect,{hasOwnProperty:hasOwnProperty$5}=Object.prototype,_undefined=void 0,internalProps={children:1,data:1,meta:1},abbreviationFields=["name","title","text","label","description"];class Model extends(Base.mixin(ModelStm,TreeNode)){static get $name(){return"Model"}static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1}]}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){return this._childrenField||"children"}get indexPath(){const e=[];let t=this,r=t.childLevel;for(t=this;t&&!t.isRoot;t=t.parent)e[r--]=t.parentIndex+1;return e}construct(e={},t=null,r=null,n=!1){const i=this,s=t?Array.isArray(t)?t:[t]:[],{constructor:o,fieldMap:a}=i;let l=null;if(t=s[0],i.meta={modified:{},...o.metaConfig,...r},o.applyConfigs)for(const t in i.$meta.config)l||(l={},i.useRawData&&i.useRawData.enabled||(e={...e})),t in e&&(l[t]=e[t],delete e[t]);if(super.construct(l),n||o.exposeProperties(e),!hasOwnProperty$5.call(o,"idFieldProcessed")){let e=i.meta.idField;e||(o._assignedIdField?e=o.idField:t&&(e=t.idField)),e&&e!==a.id.dataSource&&o.addField({name:"id",dataSource:e}),o.idFieldProcessed=!0}i._internalId=Model._internalIdCounter++,i.stores=[],i.unjoinedStores=[],i.originalData||(i.originalData=e),i.data=o.processData(e,!1,t),null==i.id&&i.setData("id",i.generateId(t)),i.data[o.childrenField]&&i.processChildren(s),i.generation=0}equals(e){if(e instanceof this.constructor){for(let t=this.$meta.fields.defs,r=0,{length:n}=t;r<n;r++){const n=t[r],{name:i}=n;if("id"!==i&&!n.isEqual(this[i],e[i]))return!1}return!0}return!1}get subclass(){return new this.constructor(Object.setPrototypeOf({id:undefined},this.data),this.stores[0],null,!0)}static processData(e,t=!1,r){const{fieldMap:n,defaultValues:i}=this,{useRawData:s={enabled:!1}}=r||{},o=s.enabled?e:{...e};let a;if(!(t=t||s.disableDefaultValue))for(a in i)undefined===o[a]&&(o[a]=i[a]);if(!s.disableTypeConversion)for(a in n){const r=n[a],{name:i,dataSource:l}=r,c=l!==i,d=c&&ObjectHelper.pathExists(e,l),u=i in e&&(!c||!d),h=!s.disableTypeConversion&&r.convert;if((u||h)&&(!t||u||d)){const e=u?o[i]:ObjectHelper.getPath(o,l);ObjectHelper.setPath(o,l,h?r.convert(e):e),c&&delete o[i]}}return o}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,t){var r,n,i,s,o;const a=hasOwnProperty$5.call(e,"fields")&&e.fields,l=t.super.fields,c=t.fields={defs:null!==(r=null==l?void 0:l.defs.slice())&&void 0!==r?r:[],exposedData:!1,defaults:l?{...l.defaults}:{},exposed:Object.create(null!==(n=null==l?void 0:l.exposed)&&void 0!==n?n:null),ordinals:Object.create(null!==(i=null==l?void 0:l.ordinals)&&void 0!==i?i:null),map:Object.create(null!==(s=null==l?void 0:l.map)&&void 0!==s?s:null),sources:Object.create(null!==(o=null==l?void 0:l.sources)&&void 0!==o?o:null)};hasOwnProperty$5.call(e,"defaults")&&Object.assign(c.defaults,e.defaults),hasOwnProperty$5.call(e,"idField")&&(e.addField({name:"id",dataSource:e.idField}),c.exposed[e.idField]=!0),(null==a?void 0:a.length)&&a.map(e.addField,e),e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e){const t=this,r=t.$meta.fields;if(e&&t.autoExposeFields&&!r.exposedData){let n,i,s;for(n in e)r.exposed[n]||(s=typeof e[n],i={name:n,dataSource:n,fromData:!0},"boolean"!==s&&"number"!==s||(i.type=s),t.addField(i));r.exposedData=!0}t.exposeRelations()}static addField(e){if(null==e)return;"string"==typeof e&&(e={name:e});const t=this.initClass(),r=t.$meta.fields,{ordinals:n}=r,i=r.exposed,{name:s}=e,o=r.map[s],a=e.dataSource||(e.dataSource=s);let l,c;if(!o||e.type&&e.type!==o.type)l=DataField.create(e),l.definedBy=o?o.definedBy:t,l.ordinal=o?o.ordinal:n[s]=r.defs.length;else for(c in l=Object.create(o),e)"type"!==c&&(l[c]=e[c]);return l.owner=t,r.defs[l.ordinal]=l,r.map[s]=l,r.sources[a]||(r.sources[a]=l),a.includes(".")&&(l.complexMapping=!0),l.complexMapping?i[a.split(".")[0]]=!0:i[a]=!0,"defaultValue"in l&&(r.defaults[a]=l.defaultValue),internalProps[s]||l.defineAccessor(t.prototype),l}static removeField(e){const t=this.initClass(),r=t.$meta.fields,n=r.map[e],{ordinals:i}=r,s=i[e];if(n){r.defs.splice(s,1),delete i[e],delete r.defaults[e],delete r.exposed[e],delete r.map[e],delete r.sources[n.dataSource];for(const e in i)i[e]>s&&--i[e];delete t.prototype[e]}}static exposeRelations(){const e=this;hasOwnProperty$5.call(e,"relationsExposed")||e.relationConfig&&(e.relationsExposed=!0,e.relations=[],e.relationConfig.forEach((t=>{e.relations.push(t);const r=t.relationName;Reflect.ownKeys(e.prototype).includes(r)||defineProperty$3(e.prototype,r,{enumerable:!0,get:function(){return this.getForeign(r)},set:function(e){this.setForeign(r,e,t)}})})))}static get autoExposeFields(){return!0}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.$meta.fields.map[e]}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.$meta.fields.map[e]}static getFieldDataSource(e){return this.getFieldDefinition(e).dataSource}getDataSource(e){const t=this.constructor.getFieldDefinition(e);return(null==t?void 0:t.dataSource)||(null==t?void 0:t.name)}static processField(e,t){const r=this.fieldMap[e];return(null==r?void 0:r.convert)?r.convert(t):t}initRelations(){const e=this;e.constructor.relations&&e.stores.forEach((t=>{var r;t.modelRelations||t.initRelations();const n=[];null===(r=t.modelRelations)||void 0===r||r.forEach((t=>{n.push({related:e.initRelation(t),config:t})})),t.updateRecordRelationCache(e,n)}))}initRelation(e){const t=this,r=t.get(e.fieldName),n=undefined!==r&&"string"!=typeof e.store&&e.store.getById(r),i={id:r,placeHolder:!0};return t.meta.relationCache||(t.meta.relationCache={}),t.meta.relationCache[e.relationName]=n||(null!=r?i:null),n}removeRelation(e){this.meta.relationCache[e.relationName]&&(delete this.meta.relationCache[e.relationName],e.nullFieldOnRemove&&this.setData(e.fieldName,null))}getForeign(e){var t;return null===(t=this.meta.relationCache)||void 0===t?void 0:t[e]}setForeign(e,t,r){const n=Model.asId(t);return this.set(r.fieldName,n)}get(e){const t=this,r=t.meta.batchChanges,{fieldMap:n}=t,i=t.data;let s=n[e];const o=s?s.dataSource:e;if(r&&e in r)return r[e];if(o){var a;if(!s&&e.includes(".")){s=n[e.split(".")[0]]}return(null===(a=s)||void 0===a?void 0:a.complexMapping)?ObjectHelper.getPath(i,o):o in i?i[o]:i[e]}}setData(e,t){const{data:r,fieldMap:n}=this;if("string"==typeof e){var i;const s=n[e],o=null!==(i=null==s?void 0:s.dataSource)&&void 0!==i?i:e;(null==s?void 0:s.complexMapping)?ObjectHelper.setPath(r,o,t):r[o]=t}else{const t=Object.keys(e);for(let i=0;i<t.length;i++){var s;const o=t[i],a=n[o],l=null!==(s=null==a?void 0:a.dataSource)&&void 0!==s?s:o;l&&((null==a?void 0:a.complexMapping)?ObjectHelper.setPath(r,l,e[o]):r[l]=e[o])}}}getData(e){var t;const r=this.fieldMap[e],n=null!==(t=null==r?void 0:r.dataSource)&&void 0!==t?t:e;if(n)return(null==r?void 0:r.complexMapping)?ObjectHelper.getPath(this.data,n):this.data[n]}syncId(e){const t=this.id;if(t!==e){this.setData("id",e);const r={id:{value:e,oldValue:t}};this.afterChange(r,r)}}set(e,t,r=!1,n=!1,i=!1){const s=this;if(s.isBatchUpdating)return s.inBatchSet(e,t),null;{var o;const a=s.beforeSet?s.beforeSet(e,t,r,n):undefined,l=s.inSet(e,t,r,n,i);return null===(o=s.afterSet)||void 0===o||o.call(s,e,t,r,n,a,l),l}}fieldToKeys(e,t){return"string"!=typeof e?ObjectHelper.assign({},e):{[e]:t}}inBatchSet(e,t){const{meta:r,constructor:n}=this;let i=!1;"string"!=typeof e?Object.keys(this.fieldToKeys(e,t)).forEach((s=>{t=n.processField(s,e[s]),r.batchChanges[s]!==t&&(r.batchChanges[s]=t,i=!0)})):r.batchChanges[e]!==t&&(r.batchChanges[e]=t,i=!0),i&&this.generation++}inSet(e,t,r,n,i=!1){const s=this,{data:o,meta:a,fieldMap:l,constructor:c}=s,{prototype:d,childrenField:u}=c,h={},g=s.fieldToKeys(e,t),m=Object.keys(g);let p=!1;if(!r&&!s.triggerBeforeUpdate(g))return null;for(let e=0;e<m.length;e++){var f;const t=m[e];if(t===u)continue;const r=l[t],v=r||ObjectHelper,y=null==r?void 0:r.readOnly,b=null!==(f=null==r?void 0:r.dataSource)&&void 0!==f?f:t,C=!i&&!r&&t in d,D=C?s[b]:(null==r?void 0:r.complexMapping)?ObjectHelper.getPath(o,b):o[b],S=c.processField(t,g[t]),E=g[t]={value:S},w=s.getRelationConfig(t);y||v.isEqual(D,S)||(s.generation++,E.oldValue=D,p=!0,v.isEqual(s.meta.modified[t],S)?Reflect.deleteProperty(a.modified,t):s.ignoreBag||(t in a.modified||(a.modified[t]=D),undefined===E.oldValue&&Reflect.deleteProperty(E,"oldValue")),h[t]=E,s.applyValue(C,b,S,i,r),w&&!n&&(s.initRelation(w),s.stores.forEach((e=>e.cacheRelatedRecord(s,S,w.relationName,E.oldValue)))))}return p&&s.afterChange(g,h,r,n,i),p?h:null}applyValue(e,t,r,n,i){var s;if(e)this[t]=r;else{if(!i&&t.includes(".")){const e=t.split(".")[0];i=this.constructor.fieldMap[e]}(null===(s=i)||void 0===s?void 0:s.complexMapping)?ObjectHelper.setPath(this.data,t,r):this.data[t]=r}}afterChange(e,t,r,n,i){this.stores.forEach((i=>{i.onModelChange(this,e,t,r,n)}))}get isPersistable(){return!0}get isModified(){return Boolean(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!ObjectHelper.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&this.meta.modified[e]}getFieldPersistentValue(e){const t="string"==typeof e?this.getFieldDefinition(e):e,r=(null==t?void 0:t.name)||e;let n;return t&&!t.persist||(n=this[r],(null==t?void 0:t.serialize)&&(n=t.serialize(n,this))),n}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,t={};if(!e.isModified)return null;let r=!1;return Object.keys(e.meta.modified).forEach((n=>{const i=e.getFieldPersistentValue(n);undefined!==i&&(t[n]=i,r=!0)})),r?t:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&ObjectHelper.setPath(e,this.constructor.getFieldDefinition(this.constructor.idField).dataSource,this.id),e}get rawModificationData(){const e=this,{fieldMap:t}=e.constructor,r={};if(!e.isModified)return null;let n=!1;return Object.keys(e.meta.modified).forEach((i=>{const s=t[i];if(null==s?void 0:s.persist){const t=e.getFieldPersistentValue(i);undefined!==t&&(ObjectHelper.setPath(r,s.dataSource,t),n=!0)}})),n?r:null}get persistableData(){const e=this,t={};return e.fields.forEach((r=>{const n=e.getFieldPersistentValue(r);undefined!==n&&((null==r?void 0:r.complexMapping)?ObjectHelper.setPath(t,r.dataSource,n):t[r.dataSource]=n)})),t}get isCommitting(){return Boolean(this.meta.committing)}clearChanges(e=!0,t=!0){const r=this,{meta:n}=r;n.modified={},n.committing=!1,e&&r.stores.forEach((e=>{if(e.modified.remove(r),e.added.remove(r),t){const t=e.collectDescendants(r).all;e.added.remove(t),e.modified.remove(t)}}))}revertChanges(){this.set(this.meta.modified)}get internalId(){return this._internalId}get isPhantom(){return""===this.id||null==this.id||this.hasGeneratedId}get isModel(){return!0}get hasGeneratedId(){return"string"==typeof this.id&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return this.generatedIdIndex||(this.generatedIdIndex=0),`_generated${e}${++this.generatedIdIndex}`}generateId(){return this.constructor.generateId()}static asId(e){return(null==e?void 0:e.isModel)?e.id:e}get json(){return StringHelper.safeJsonStringify(this)}toJSON(){const{children:e}=this,t=this.persistableData;return e&&(t[this.constructor.childrenField]=e.map((e=>e.toJSON()))),t}toString(){const e=this,t=abbreviationFields.find((t=>t in e.constructor.fieldMap)),r=t?{[e.constructor.idField]:e.id,[t]:e[t]}:e.data;return StringHelper.safeJsonStringify(r)}get isBatchUpdating(){return Boolean(this.batching)}beginBatch(){const e=this;e.batching||(e.batching=0,e.meta.batchChanges={}),e.batching++}endBatch(e=!1,t=!1){const r=this,{parentIdField:n}=r.constructor;if(r.batching&&(r.batching--,!(r.batching>0||ObjectHelper.isEmpty(r.meta.batchChanges)))){const i={...r.meta.batchChanges};r.meta.batchChanges=null,i[n]&&(r.parentId=i[n],delete i[n]),r.set(i,undefined,e,!1,t),r.cancelBatch()}}cancelBatch(){this.batching=null,this.meta.batchChanges=null}triggerBeforeUpdate(e){return!this.stores.some((t=>{if(!1===t.trigger("beforeUpdate",{record:this,changes:e}))return!0}))}copy(e=null,t){const r=this,n={...r.data},i=r.constructor.idField;let s,o;s=ObjectHelper.isObject(t)?t.deep:t,!1!==e&&delete n[i],e&&"object"==typeof e?(o=e.id,"deep"in e?(s=e.deep,VersionHelper.deprecate("Grid","5.0.0","`deep` attribute deprecated, in favor of a separate second parameter"),delete e.id,delete e.deep):Object.assign(n,e)):o=e,s&&r.children?n.children=r.children.map((e=>e.copy(void 0,t))):(delete n.children,delete n.expanded),null==n[i]&&(n[i]=o||r.generateId(r.firstStore));const a=new r.constructor(n);return a.originalInternalId=r.internalId,a}remove(e=!1){const t=this,{parent:r}=this;r?r.removeChild(t):t.stores.length&&(t.isSpecialRow||t.stores.forEach((r=>r.remove(t,e,!1,!0))))}get firstStore(){return this.stores.length>0&&this.stores[0]}getRelationConfig(e){var t,r;return null===(t=this.firstStore)||void 0===t||null===(r=t.modelRelations)||void 0===r?void 0:r.find((t=>t.fieldName===e))}get isValid(){return!0}joinStore(e){const t=this,{stores:r,unjoinedStores:n}=t;r.includes(e)||(super.joinStore&&super.joinStore(e),e.register(t),r.push(e),n.includes(e)&&n.splice(n.indexOf(e),1),t.isLoaded&&t.children.forEach((t=>t.joinStore(e))),t.initRelations(),e.tree&&!t.isRoot&&(t.instanceMeta(e.id).collapsed=!t.expanded))}unJoinStore(e,t=!1){const r=this,{stores:n,unjoinedStores:i}=r;var s;n.includes(e)&&(e.unregister(r),null===(s=r.children)||void 0===s||s.forEach((r=>r.unJoinStore(e,t))),n.splice(n.indexOf(e),1),i.push(e),super.unJoinStore&&super.unJoinStore(e,t),e.uncacheRelatedRecord(r))}isPartOfStore(e){return e?e.includes(this):this.stores.length>0}get isRemoved(){return!this.isPartOfStore()}instanceMeta(e){const{meta:t}=this,r=e.id||e;return t.map||(t.map={}),t.map[r]||(t.map[r]={})}get isSpecialRow(){return this.meta.specialRow}}Model._idField="id",Model._internalIdCounter=1,Model._assignedIdField=!1,Model.exposeProperties(),Model._$name="Model";class CollectionFilter extends(Base.mixin(Identifiable)){static get defaultConfig(){return{property:null,value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null}}construct(e){"function"==typeof e&&(e={filterBy:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||CollectionFilter.generateId("b-filter"))}set id(e){this._id=e}onChange(e){const t=this;!t.isConfiguring&&t.owner&&!t.owner.isConfiguring&&t.owner.onFilterChanged&&t.owner.onFilterChanged(t,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){return this[this.operator](this.convert(e[this.property]))}set property(e){this._property=e,this.onChange("property")}get property(){return this._property}set value(e){var t,r;this._value=e,e=null!==(t=null===(r=e)||void 0===r?void 0:r.valueOf())&&void 0!==t?t:e,this._filterValue=this.caseSensitive||"string"!=typeof e?e:e.toLowerCase(),this.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){return this._operator||("string"==typeof this.filterValue?"*":"=")}convert(e){var t,r;"string"==typeof this.filterValue&&e instanceof Date||(e=null!==(t=null===(r=e)||void 0===r?void 0:r.valueOf())&&void 0!==t?t:e);return e=this.caseSensitive||"string"!=typeof e?e:e.toLowerCase()}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}"="(e){return ObjectHelper.isEqual(e,this.filterValue)}"!="(e){return!ObjectHelper.isEqual(e,this.filterValue)}">"(e){return ObjectHelper.isMoreThan(e,this.filterValue)}">="(e){return ObjectHelper.isMoreThan(e,this.filterValue)||ObjectHelper.isEqual(e,this.filterValue)}"<"(e){return ObjectHelper.isLessThan(e,this.filterValue)}"<="(e){return ObjectHelper.isLessThan(e,this.filterValue)||ObjectHelper.isEqual(e,this.filterValue)}"*"(e){return ObjectHelper.isPartial(e,this.filterValue)}static generateFiltersFunction(e){return e&&(e.length||e.count)?function(t){let r=!0;for(const n of e)if(n.disabled||(r=n.filter(t)),!r)break;return r}:FunctionHelper.returnTrue}}CollectionFilter._$name="CollectionFilter";class IdHelper{static generateId(e="generatedId"){return e+(IdHelper.idCounts[e]=(IdHelper.idCounts[e]||0)+1)}}IdHelper.idCounts={},IdHelper._$name="IdHelper";class CollectionSorter extends Base{static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){"function"==typeof e&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||IdHelper.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,t){const{convert:r,property:n,useLocaleSort:i}=this,s="desc"===this.direction.toLowerCase()?-1:1;if(e=e[n],t=t[n],r&&(e=r(e),t=r(t)),i&&null!=e&&null!=t){if(!0===i)return String(e).localeCompare(t);if("string"==typeof i)return String(e).localeCompare(t,i);if("object"==typeof i)return String(e).localeCompare(t,i.locale,i)}return(e>t?1:e<t?-1:0)*s}static generateSortFunction(e,t){const r=e.isCollection?e.values:e,n=r.length;return(e,i)=>{let s,o;for(o=0;o<n;++o)if(s=r[o].sortFn(e,i),s)return s;return t?t(e,i):0}}}CollectionSorter._$name="CollectionSorter";const return0=()=>0,reverseNumericSortFn=(e,t)=>t-e,filteredIndicesProperty=Symbol("filteredIndicesProperty"),emptyArray$1=Object.freeze([]),sortEvent=Object.freeze({action:"sort",added:emptyArray$1,removed:emptyArray$1,replaced:emptyArray$1}),filterEvent=Object.freeze({action:"filter",added:emptyArray$1,removed:emptyArray$1,replaced:emptyArray$1}),keyTypes={string:1,number:1};function addItemToIndex(e,t,r){if(!1!==t.unique)t.set(r,e);else{let n=t.get(r);n||(n=new Set,t.set(r,n)),n.add(e)}}function removeItemFromIndex(e,t,r){!1!==t.unique?t.delete(r):t.has(r)&&(t.get(r).delete(e),t.get(r).size||t.delete(r))}function doRebuildIndices(e,t,r,n){for(let i=0;i<e.length;i++){const s=e[i];for(let e=0;e<n;e++){const n=r[e],i=s[n];addItemToIndex(s,t[n],i)}}}class Collection extends(Base.mixin(Events)){static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const t=this;t._values.length=0,t.isFiltered&&(t._filteredValues.length=0,t.filters.destroy()),null===(e=t._sorters)||void 0===e||e.destroy()}clear(){const e=this,t=e._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}replaceValues({values:e,filteredValues:t,silent:r=!1,isNewDataset:n=!1}){const i=this;let s,o;if(i.isFiltered&&!n){Boolean(t)?e&&(s=i._values,i._values=e.slice()):(t=e.slice(),e=null),o=i._filteredValues,i._filteredValues=t.slice()}else s=i._values,i._values=e.slice(),t=null,i.isFiltered&&n&&i.autoFilter?(i._filterFunction=null,i._filteredValues=i._values.filter(i.filterFunction)):i._filteredValues&&(i._filteredValues.length=0);i._indicesInvalid=!0,i.generation++,r||i.trigger("change",{action:"replaceValues",replacedValues:s,replacedFilteredValues:o,values:e,filteredValues:t})}set values(e){this._indicesInvalid=!0,this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,t=!1){(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}map(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}find(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}add(...e){1===e.length?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){1===e.length?this.splice(0,...e):this.splice(0,e)}move(e,t){const r=this,{_values:n}=r,i=r.indexOf(e,!0);let s=t?r.indexOf(t,!0):n.length;if(-1===i||-1===s)throw new Error("Collection move parameters must be present in Collection");return i!==s&&i!==s-1&&(i<s&&s--,n.splice(i,1),n.splice(s,0,e),r.trigger("change",{action:"move",item:e,from:i,to:s})),s}splice(e=0,t,...r){const n=this,i=n.idProperty,s=n._values,o={},a=[],l=[],c=n.totalCount;let d,u;if(r)if(1===r.length&&Array.isArray(r[0])&&(r=r[0]),c&&r.length){const e=n.indices[i];d=[];for(let t=0;t<r.length;t++){const n=r[t],a=n[i],c=e.get(a),u=c?s.indexOf(c):-1;o[a]=!0,-1!==u?s[u]!==n&&(l.push([s[u],n]),s[u]=n):d.push(n)}}else d=r;if(t){if("number"==typeof t)for(let r=e;t;--t){o[s[r][i]]?(e++,r++):(a.push(s[r]),s.splice(r,1),u=!0)}else{let e,r=0===d.length;Array.isArray(t)||(t=[t]);const l=t.reduce(((t,i)=>{const s="number"==typeof i,o=s?i:n.indexOf(i,!0);return r&&(null!=e&&o!==e+1||s)&&(r=!1),o>=0&&o<c&&t.push(o),e=o,t}),[]).sort(reverseNumericSortFn);if(r)l.length&&(a.push.apply(a,t),s.splice(l[l.length-1],l.length),u=!0);else for(let e=0;e<l.length;e++){const t=l[e];if(-1!==t){o[s[t][i]]||(a.unshift(s[t]),s.splice(t,1),u=!0)}}}a.length&&!n._indicesInvalid&&a.forEach(n.removeFromIndices,n)}d.length&&(s.splice(Math.min(e,s.length),0,...d),u=!0,n._indicesInvalid||d.forEach(n.addToIndices,n)),l.length&&!n._indicesInvalid&&l.forEach((e=>{n.removeFromIndices(e[0]),n.addToIndices(e[1])})),u||l.length?(n.isSorted?n.onSortersChanged():n.isFiltered&&(n.autoFilter?n.onFiltersChanged():n._filteredValues.push(...d)),n.generation++,n.trigger("change",{action:"splice",removed:a,added:d,replaced:l,oldCount:c})):n.trigger("noChange",{index:e,toRemove:t,toAdd:r})}changeId(e,t){const r=this,{idProperty:n}=r,i=keyTypes[typeof e]?e:e[n],s=r.get(i);if(s){const o=r.get(t);if(o&&s!==o)throw new Error(`Attempt to set item ${i} to already existing member's id ${t}`);r.removeIndexEntry(e,n,i),r.addIndexEntry(e,n,t),s[n]=t}}get(e,t=!1){return this.getBy(this.idProperty,e,t)}getAt(e,t=!1){return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}getBy(e,t,r=!1){return this.findItem(e,t,this.isFiltered&&r)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new Collection({values:Array.isArray(e)?e:[e],listeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const t=e instanceof CollectionSorter?e:new CollectionSorter(e);return this.sorters.add(t),t}get isSorted(){var e;return Boolean(null===(e=this._sorters)||void 0===e?void 0:e.count)}onSortersChanged(){const e=this;delete e._sortFunction,e._values.sort(e.sortFunction),e.trigger("change",sortEvent)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=CollectionSorter.generateSortFunction(this.sorters.values):this._sortFunction=return0),this._sortFunction}get filters(){return this._filters||(this._filters=new Collection({listeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const t=e instanceof CollectionFilter?e:new CollectionFilter(e);return this.filters.add(t),t}get isFiltered(){return Boolean(this._filters&&this._filters.count)}onFiltersChanged(){const e=this;e._filterFunction=null,e._filteredValues=e._values.filter(e.filterFunction),e._indicesInvalid=!0,e.trigger("change",filterEvent)}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=CollectionFilter.generateFiltersFunction(this.filters.values):this._filterFunction=FunctionHelper.returnTrue),this._filterFunction}changeExtraKeys(e){return(Array.isArray(e)?e:[e]).map((e=>"string"==typeof e?{property:e,unique:!0}:e))}updateExtraKeys(e){for(let t=0;t<e.length;t++)this.addIndex(e[t])}addIndex(e){e&&((this._indices||(this._indices={}))[e.property]=new Map,Object.assign(this._indices[e.property],e),this._indicesInvalid=!0)}findIndex(e,t,r=!1){const n=this.findItem(e,t,r);if(!n)return-1;return(this.isFiltered&&!r?this._filteredValues:this._values).indexOf(n)}findItem(e,t,r=!1){const n=this,{isFiltered:i}=n,s=i&&!r?n.indices[filteredIndicesProperty][e]:n.indices[e];if(s){var o;const e=null!==(o=s.get(t))&&void 0!==o?o:"string"==typeof t&&!isNaN(t)&&s.get(Number(t))||null;if(null!=e)return e}else{const s=i&&!r?n._filteredValues:n._values,o=s.length;for(let r=0;r<o;r++){const n=s[r];if(n[e]==t)return n}}return null}indexOf(e,t=!1){return this.findIndex(this.idProperty,keyTypes[typeof e]?e:e[this.idProperty],t)}includes(e,t=!1){return Boolean(this.findItem(this.idProperty,keyTypes[typeof e]?e:e[this.idProperty],t))}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}rebuildIndices(){const e=this,t=e.isFiltered,r=e._indices||(e._indices={}),n=Object.keys(r),i=n.length,s=e._values;let o;t&&(o=r[filteredIndicesProperty]={});for(let e=0;e<i;e++){const i=r[n[e]];if(i.clear(),t){let t=o[n[e]];t?t.clear():(t=o[n[e]]=new Map,t.unique=i.unique)}}doRebuildIndices(s,r,n,i),t&&doRebuildIndices(e._filteredValues,o,n,i),e._indicesInvalid=!1}getIndices(e){const t=[this.indices[e]];return this.isFiltered&&t.push(this.indices[filteredIndicesProperty][e]),t}addToIndices(e){Object.keys(this.indices).forEach((t=>{this.addIndexEntry(e,t,e[t])}))}removeFromIndices(e){Object.keys(this.indices).forEach((t=>{this.removeIndexEntry(e,t,e[t])}))}removeIndexEntry(e,t,r){this.getIndices(t).forEach((t=>removeItemFromIndex(e,t,r)))}addIndexEntry(e,t,r){this.getIndices(t).forEach((t=>addItemToIndex(e,t,r)))}onItemMutation(e,t){this.extraKeys&&!this._indicesInvalid&&Object.keys(t).forEach((r=>{if(this.indices[r]){const{value:n,oldValue:i}=t[r];this.removeIndexEntry(e,r,i),this.addIndexEntry(e,r,n)}}))}}Collection._$name="Collection";const nonPrimitives=new WeakMap,safeIndexKey=e=>{if(e&&"object"==typeof e){let t=nonPrimitives.get(e);void 0===t&&(t=Symbol("bscik"),nonPrimitives.set(e,t)),e=t}return e};class Bag{constructor(e){const t=this;t.generation=0,t.items=new Set,t.idMap={},t.idProperty="id",e&&(e.idProperty&&(t.idProperty=e.idProperty),e.values&&(t.values=e.values))}get(e){return this.idMap[safeIndexKey(e)]}get count(){return this.items.size}add(...e){1===e.length&&Array.isArray(e[0])&&(e=e[0]);const t=this,{items:r,idMap:n,idProperty:i}=t,s=e.length;for(let o=0;o<s;o++){const s=e[o],a=keyTypes[typeof s]?s:safeIndexKey(s[i]),l=n[a];null==l?(n[a]=s,r.add(s),t.generation++):l!==s&&(n[a]=s,r.delete(l),r.add(s))}}remove(e){Array.isArray(e)||(e=[e]);const{items:t,idMap:r,idProperty:n}=this,i=e.length;for(let s=0;s<i;s++){const i=e[s],o=keyTypes[typeof i]?i:safeIndexKey(i[n]),a=r[o];null!=a&&(t.delete(a),delete r[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}changeId(e,t){const r=this,{idMap:n,idProperty:i}=r,s=keyTypes[typeof e]?e:safeIndexKey(e[i]),o=r.get(s);if(o){const e=r.get(t);if(e&&o!==e)throw new Error(`Attempt to set item ${s} to already existing member's id ${t}`);o[i]=t,delete n[s],n[t]=o}}includes(e){const t=keyTypes[typeof e]?e:safeIndexKey(e[this.idProperty]);return Boolean(this.idMap[t])}map(e,t){const{items:r}=this,n=new Array(r.size);let i=0;return r.forEach((s=>{n[i]=e.call(t,s,i++,r)})),n}forEach(e,t){return this.items.forEach(e,t)}find(e){for(const t of this.items)if(e(t))return t}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e){return this.values.indexOf(e)}get values(){return[...this.items]}set values(e){Array.isArray(e)||(e=[e]),this.clear(),this.add.apply(this,e),this.generation++}sort(e){this.values=this.values.sort(e)}some(e,t){return this.values.some(e,t)}}Bag._$name="Bag";class StoreBag extends Bag{add(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter((e=>e.isPersistable)))}}StoreBag._$name="StoreBag";var StoreCRUD=e=>class extends(e||Base){static get $name(){return"StoreCRUD"}static get defaultConfig(){return{autoCommit:!1,suspendCount:0}}remove(e,t=!1){const r=this,{storage:n}=r;if(e instanceof Set&&(e=Array.from(e)),(e=(Array.isArray(e)?e:[e]).reduce(((e,t)=>((t=r.getById(t))&&e.push(t),e)),[])).length){if(r.isRemoving=!0,r.tree){const n=e.reduce(((e,t)=>{const r=t.parent;return r&&(e[r.id]||(e[r.id]=[r,[]]),e[r.id][1].push(t)),e}),{});for(const e of Object.values(n))e[0].removeChild(e[1],!1,t);return r.isRemoving=!1,e}if(r.isGrouped){const t=n.count,i=[],s=new Set;for(const t of e){const{groupParent:e}=t.instanceMeta(r);e&&e.meta.collapsed&&i.push(t),ArrayHelper.remove(e.groupChildren,t),e.meta.childCount--,s.add(e)}for(const e of s)r.onModelChange(e,{},{});i.length&&n.trigger("change",{action:"splice",removed:i,added:[],replaced:[],oldCount:t})}if(!e.length||!t&&!1===r.trigger("beforeRemove",{records:e}))return r.isRemoving=!1,null;t&&r.suspendEvents(),n.remove(e),t&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),r.isRemoving=!1}return e}clear(e=!0){const t=this,{storage:r}=t;if(t.storage.totalCount){if(e&&!1===t.trigger("beforeRemove",{records:r.allValues,removingAll:!0}))return null;if(!e){const e=t.registeredRecords;for(let r,n=e.length-1;n>=0;n--)r=e[n],r&&!r.isDestroyed&&r.unJoinStore(t);t.removed.clear()}e||r.suspendEvents(),r.clear(),e||r.resumeEvents(),t.added.clear(),t.modified.clear()}}removeAll(e=!1){const t=this,r=t.storage;let n;if(t.isRemoving=!0,e){r.suspendEvents();const e=t.registeredRecords;for(let r,n=e.length-1;n>=0;n--)r=e[n],r&&!r.isDestroyed&&r.unJoinStore(t)}return n=t.tree?!1!==t.rootNode.clear():null!==t.clear(),e&&r.resumeEvents(),t.isRemoving=!1,n}add(e,t=!1){const r=this,n=r.storage,i=[];if(Array.isArray(e)){if(!e.length)return}else e=[e];if(r.tree=r.tree||Boolean(r.autoTree&&e[0].children),r.tree){const n=new Map,i=[];return e.forEach((e=>{const t=e[r.modelClass.parentIdField];n.has(t)||n.set(t,[]),n.get(t).push(e)})),n.forEach(((e,n)=>{const s=null==n?r.rootNode:r.getById(n);if(!s)throw new Error(`Parent node with id ${n} not found, cannot add children.`);i.push(...s.appendChild(e,t))})),i}return t||!1!==r.trigger("beforeAdd",{records:e})?(r.tree=r.tree||Boolean(r.autoTree&&e[0].children),r.tree?r.rootNode.appendChild(e):(e.forEach((e=>{i.push(r.processRecord(e.isModel?e:r.createRecord(e)))})),t&&r.suspendEvents(),n.add(i),t&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),i)):null}insert(e,t,r=!1){const n=this,i=n.storage,s=[],o=n.getAt(e),a=i.values,l=[];if(Array.isArray(t)||(t=[t]),!1===n.trigger("beforeAdd",{records:t}))return null;let c,d,u;if(a[d=e]===t[0]||a[d=e-1]===t[0])for(c=!0,u=0;c&&u<t.length;u++)t[u]!==a[d+u]&&(c=!1);if(c)return null;if(t.forEach((t=>{const r=n.processRecord(t.isModel?t:n.createRecord(t)),a=i.indexOf(r);r.children&&r.children.length&&n.autoTree&&(n.tree=!0),s.push(r),a>-1&&(a<e&&o&&e--,l.push(a)),r.meta.previousIndex=a})),n.tree){const r=n.rootNode;return r.insertChild(t,r.children&&r.children[e])}return n.suspendEvents(),n.storage.remove(l),n.resumeEvents(),r&&n.suspendEvents(),i.splice(e,0,...s),r&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),s}move(e,t){this.storage.move(e,t)}setMultiple(e,t,r){const n=this,i=[],s=[];n.forEach((n=>{e(n)&&(s.push(n.set(t,r,!0)),i.push(n))})),n.trigger("updateMultiple",{records:i,all:n.records.length===i.length}),n.trigger("change",{action:"updatemultiple",records:i,all:n.records.length===i.length}),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}setAll(e,t){const r=this,n=[];r.forEach((r=>{n.push(r.set(e,t,!0))})),r.trigger("updateMultiple",{records:r.records,all:!0}),r.trigger("change",{action:"updatemultiple",records:r.records,all:!0}),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}acceptChanges(){const e=this;e.added.forEach((e=>e.clearChanges(!1))),e.modified.forEach((e=>e.clearChanges(!1))),e.added.clear(),e.modified.clear(),e.removed.clear()}commit(e=!1){const{changes:t}=this;return this.callPreventable("commit",{changes:t},(()=>(this.acceptChanges(),t)),[],e)}clearChanges(){const e=this,{changes:t}=e;e.remove(e.added.values,!0),e.modified.forEach((e=>e.clearChanges(!1))),e.added.clear(),e.modified.clear(),e.removed.clear(),e.trigger("change",{action:"clearchanges",changes:t})}get changes(){const e=this,t=e.modified.values.filter((e=>e.rawModifications));return e.added.count||t.length||e.removed.count?{added:e.added.values.slice(),modified:t,removed:e.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(e){this._autoCommit=e,e&&this.changes&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(e=!0){this.suspendCount--,this.autoCommit&&e&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}applyChangesFromStore(e){const t=this,r=e.changes;r&&(r.added&&t.add(r.added),r.removed&&t.remove(r.removed.map((e=>e.id))),r.modified&&r.modified.forEach((e=>{t.getById(e.id).set(e.modifications)})))}},StoreFilter=e=>class extends(e||Base){static get $name(){return"StoreFilter"}static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set reapplyFilterOnAdd(e){this.storage.autoFilter=e}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(e){const t=this,r=t.filters;if(r.clear(),t._filtersFunction=null,e){if("Object"===e.constructor.name)for(const t of Object.entries(e))"filterBy"===t[0]&&"function"==typeof t[1]?r.add(new CollectionFilter({filterBy:t[1]})):r.add(new CollectionFilter("Object"===t[1].constructor.name?Object.assign({property:t[0]},t[1]):{property:t[0],value:t[1]}));else Array.isArray(e)?r.add(...e.map((e=>e instanceof CollectionFilter?e:new CollectionFilter(e)))):e.isCollection?r.add(...e.values):r.add(new CollectionFilter({filterBy:e}));r.forEach((e=>e.owner=t))}}get filters(){return this._filters||(this._filters=new Collection({extraKeys:["property"]}))}set filtersFunction(e){this._filtersFunction=e}get filtersFunction(){const e=this,{filters:t,isGrouped:r}=e;if(!e._filtersFunction)if(t.count){const n=CollectionFilter.generateFiltersFunction(t);e._filtersFunction=e=>r&&e.isSpecialRow?e.groupChildren.some(n):n(e)}else e._filtersFunction=FunctionHelper.returnTrue;return e._filtersFunction}get isFiltered(){return this.filters.values.some((e=>!e.disabled))}traverseFilter(e){const t=this,r=!e.isRoot&&t.filtersFunction(e),n=e.unfilteredChildren||e.children;return n&&n.length?(e.unfilteredChildren||(e.unfilteredChildren=e.children.slice()),e.children=e.unfilteredChildren.filter((e=>t.traverseFilter(e))),e.updateChildrenIndices(e.unfilteredChildren,!0),e.updateChildrenIndices(e.children,!1),r||Boolean(e.children.length)):r}traverseClearFilter(e){const t=this;e.unfilteredChildren&&(e.children=e.unfilteredChildren.slice(),e.unfilteredChildren=null),e.children&&e.children.forEach((e=>t.traverseClearFilter(e)))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(e,t=!1){return(e=e instanceof CollectionFilter?e:new CollectionFilter(e)).owner=this,this.filters.add(e),t||this.filter(),e}filter(e){const t=this,{filters:r}=t;let n=!1;if(e){let i=typeof e;if("object"===i&&("silent"in e||"replace"in e)&&(n=e.silent,e.replace&&r.clear(),i=typeof(e=e.filters)),e&&(t.isConfiguring=!0,Array.isArray(e)?e.forEach((e=>t.addFilter(e,!0)),t):"function"===i?t.addFilter(new CollectionFilter(e),!0):"string"===i?t.addFilter({property:e,value:arguments[1]},!0):t.addFilter(e,!0),t.isConfiguring=!1,!t.isFiltered))return}t.filtersFunction=null,t.performFilter(n)}performFilter(e){const t=this,{storage:r,filters:n,rootNode:i}=t,s=t.count;t.tree?(t.isFiltered?t.traverseFilter(i):t.traverseClearFilter(i),r.replaceValues({values:t.collectDescendants(i).visible,silent:!0})):t.isFiltered?r.addFilter({id:"primary-filter",filterBy:t.filtersFunction}):r.filters.clear(),t.afterPerformFilter(e?null:{action:"filter",filters:n,oldCount:s,records:t.storage.values})}afterPerformFilter(e){this.resetRelationCache(),e&&this.triggerFilterEvent(e)}get filtered(){return this.storage.isFiltered}triggerFilterEvent(e){this.trigger("filter",e),this.remoteFilter||(this.trigger("refresh",e),this.trigger("change",e))}filterBy(e){this.filter(e)}removeFilter(e,t=!1){const r=this,n=e instanceof CollectionFilter?e:r.filters.get(e);if(n)return r.filters.remove(n),r._filtersFunction=null,t||r.filter(),n}clearFilters(){this.filters.clear(),this.filter()}convertFilterToString(e){const t=this.filters.getBy("property",e);return t&&!t.filterBy?String(t):""}get filterState(){return this.filters.values.map((e=>ObjectHelper.cleanupProperties(e.config)))}};const resortActions={add:1,replace:1};var StoreGroup=e=>class extends(e||Base){static get $name(){return"StoreGroup"}static get defaultConfig(){return{groupers:null}}construct(e){super.construct(e),this.on("change",this.onDataChanged)}get groupers(){return this._groupers}set groupers(e){const t=this;e&&e.length?t._groupers=e:t.groupers&&(delete t._groupers,t.groupRecords.forEach((e=>{e.meta.collapsed&&t.includeGroupRecords(e)})),t.storage.replaceValues({values:t.removeHeadersAndFooters(t.storage._values),filteredValues:t.storage.isFiltered?t.removeHeadersAndFooters(t.storage._filteredValues):null,silent:!0}),t.group(null,null,null,!1),"groupRecords"in t&&delete t.groupRecords)}storeCollapsedGroups(){const e=this;return e.collapsedGroupsHash={},!(!e.groupRecords||!e.groupRecords.length)&&(e.groupRecords.forEach((t=>{e.expand(t)&&(e.collapsedGroupsHash[t.id]=!0)})),!0)}restoreCollapsedGroups(){const e=this,{collapsedGroupsHash:t}=e;t&&Object.keys(t).forEach((t=>e.collapse(e.getById(t))))}onDataChange({source:e,action:t,removed:r}){const n=this,{groupers:i}=n;if(i){const s=e.values;i.length?"splice"===t&&r&&r.length&&(n.storeCollapsedGroups()&&n.storage.replaceValues({values:n.removeHeadersAndFooters(s),silent:!0}),n.storage.replaceValues({values:n.prepareGroupRecords(s),silent:!0}),n.restoreCollapsedGroups()):e.replaceValues({values:n.removeHeadersAndFooters(s),silent:!0})}super.onDataChange&&super.onDataChange(...arguments)}collapse(e){return!(!e||e.meta.collapsed)&&(this.excludeGroupRecords(e),e.meta.collapsed=!0,!0)}expand(e){return!(!e||!e.meta.collapsed)&&(this.includeGroupRecords(e),e.meta.collapsed=!1,!0)}removeHeadersAndFooters(e){const t=this;return e.filter((e=>!e.isSpecialRow||(t.unregister(e),!1)),!0)}prepareGroupRecords(e){const t=this;if(e=t.removeHeadersAndFooters(e),!t.isGrouped)return e;const r=[],n=t.groupers[0].field,i=[];let s=null,o=null,a=0;function l(){const e=o.meta.groupRowFor,n="group-footer-"+("number"==typeof e?e:StringHelper.createId(e)),s=t.getById(n)||new t.modelClass({id:n},t,{specialRow:!0,groupFooterFor:e,groupRecord:o});return t.register(s),s.groupChildren=o.groupChildren,i.push(s),r.push(s),t.allRecords.push(s),o.groupChildren.push(s),a++,s}return e.forEach((e=>{const c=null==e[n]?"__novalue__":e[n],d="group-header-"+("number"==typeof c?c:StringHelper.createId(c));!e.groupChildren||e.groupChildren.length?(ObjectHelper.isEqual(c,s)||(o&&(t.useGroupFooters&&l(),o.meta.childCount=a),o=t.getById(d)||new t.modelClass({id:d},t,{specialRow:!0,groupRowFor:c,groupField:n}),t.register(o),o.groupChildren=[],r.push(o),t.allRecords.push(o),i.push(o),s=c,a=0),e.instanceMeta(t.id).groupParent=o,r.push(e),o.groupChildren.push(e),a++):t.unregister(e)})),o&&(t.useGroupFooters&&l(),o.meta.childCount=a),t.groupRecords=i,r}get isGrouped(){return Boolean(this.groupers&&this.groupers.length)}group(e,t,r=!1,n=!0,i=!1){const s=this;let o;if(r?s.groupers.push(o={field:e,ascending:t,complexMapping:e.includes(".")}):e&&(null==t&&(t=!s.groupInfo||s.groupInfo.field!==e||!s.groupInfo.ascending),s.groupInfo=o={field:e,ascending:t,complexMapping:e.includes(".")},s.groupers=[s.groupInfo]),o){const{prototype:t}=s.modelClass;o.complexMapping&&!Object.prototype.hasOwnProperty.call(t,e)&&Object.defineProperty(t,e,{get(){return ObjectHelper.getPath(this,e)}})}!1!==n&&s.sort(null,null,!1,!0),i||(s.trigger("group",{isGrouped:s.isGrouped,groupers:s.groupers,records:s.storage.values}),s.trigger("refresh",{action:"group",isGrouped:s.isGrouped,groupers:s.groupers,records:s.storage.values}))}addGrouper(e,t=!0){this.group(e,t,!0)}removeGrouper(e){const t=this,r=t.groupers.findIndex((t=>t.field===e));r>-1&&(t.groupers.splice(r,1),t.groupers.length?t.group():t.clearGroupers())}clearGroupers(){this.groupers=null}isRecordInGroup(e,t){if(!this.isGrouped)return null;return e[this.groupers[0]&&this.groupers[0].field]===t&&!e.isSpecialRow}isInCollapsedGroup(e){const t=e.instanceMeta(this).groupParent;return t&&t.meta.collapsed}getGroupRecords(e){const t=this;return t.isGrouped?t.storage.values.filter((r=>t.isRecordInGroup(r,e))):null}getGroupTitles(){const e=this;return e.isGrouped?e.getDistinctValues(e.groupers[0]&&e.groupers[0].field):null}onDataChanged({changes:e,action:t}){this.isGrouped&&(!e&&resortActions[t]||e&&this.groupers.some((t=>t.field in e)))&&this.sort()}internalIncludeExcludeGroupRecords(e,t){const r=this,n=r.indexOf(e),i=r.id;if(-1!==n&&!(e.meta.collapsed&&!t||!e.meta.collapsed&&t)){if(e.groupChildren.forEach((e=>e.instanceMeta(i).hiddenByCollapse=!t)),t){const t=e.groupChildren.filter((e=>!r.isAvailable(e)));r.storage.values.splice(n+1,0,...t)}else r.storage.values.splice(n+1,e.groupChildren.length);r.storage._indicesInvalid=!0,r._idMap=null}}excludeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!1)}includeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!0)}collectGroupRecords(e,t=!0){return(e?this.storage.allValues:this.storage.values).reduce(((e,r)=>(r.isSpecialRow&&(t&&e.push(r),"groupRowFor"in r.meta&&e.push.apply(e,r.groupChildren)),e)),[])}},StoreProxy=e=>class extends(e||Base){static get configurable(){return{objectify:null}}initProxy(){if(!BrowserHelper.global.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(e,t){if(t in e)return e[t];let r=e.getById(t);return r||isNaN(parseInt(t))||(r=e.getAt(parseInt(t))),r},set:(e,t,r)=>(t in e||e.isDestroying?e[t]=r:e.add({[e.modelClass.idField]:t,...r}),!0),deleteProperty:(e,t)=>e.isDestroying?(delete e[t],!0):Boolean(e.remove(t).length),has(e,t){if(t in e)return!0;if(t.startsWith("{")&&t.endsWith("}")){const e=StringHelper.safeJsonParse(t);t=null==e?void 0:e.id}return e.includes(t)}})}},StoreRelation=e=>class extends(e||Base){static get $name(){return"StoreRelation"}initRelations(e){const t=this,r=t.modelClass.relations;e&&t.modelRelations&&t.modelRelations.forEach((e=>{e.storeDetacher&&e.storeDetacher()})),t.modelRelations&&0!==t.modelRelations.length&&!e||!r||(t.modelRelations=[],r&&r.forEach((r=>{const n=Object.assign({},r),i="string"==typeof n.store?t[n.store]:n.store;if(n.dependentStore=t,t.modelRelations.push(n),i){n.storeProperty=n.store,n.store=i;const r=i.dependentStoreConfigs;if(r.has(t)){const i=r.get(t);if(e){const e=i.find((e=>e.relationName===n.relationName));e&&ArrayHelper.remove(i,e)}i.push(n)}else r.set(t,[n]);n.collectionName&&i.initRelationCollection(n,t),i.count>0&&i.updateDependentStores("dataset",i.records)}})))}initRelationCollection(e,t){const r=this,n=e.collectionName;r.collectionStores||(r.collectionStores={}),r.collectionStores[n]={store:t,config:e},r[n+"Store"]||(r[n+"Store"]=t),r.count>0&&r.initModelRelationCollection(n,r.records)}initModelRelationCollection(e,t){const r=this;t.forEach((t=>{t.traverse((t=>{const n=e in t?"$related"+StringHelper.capitalize(e):e;Object.defineProperty(t,n,{enumerable:!0,configurable:!0,get:function(){return r.getCollection(this,e)},set:function(t){return r.setCollection(this,e,t)}})}))}))}resetRelationCache(){this.relationCache={},this.forEach((e=>e.initRelations()))}updateRecordRelationCache(e,t){const r=this;t&&t.forEach((t=>{const n=t.related?t.related.id:e.get(t.config.fieldName);void 0!==n&&r.cacheRelatedRecord(e,n,t.config.relationName,n)}))}getRelationCollection(e,t){const r=Model.asId(t);return this.relationCache[e]&&this.relationCache[e][r]||[]}getCollection(e,t){const{config:r,store:n}=this.collectionStores[t];return n.relationCache[r.relationName]&&n.relationCache[r.relationName][e.id]||[]}setCollection(e,t,r){const{config:n,store:i}=this.collectionStores[t];i.relationCache[n.relationName]||(i.relationCache[n.relationName]={});const s=(i.relationCache[n.relationName][e.id]||[]).slice(),o=[],a=[];i.suspendEvents(),s.forEach((e=>{r.includes(e)||(e[n.fieldName]=null,i.remove(e),a.push(e))})),r.forEach((t=>{t instanceof Model?t.stores.includes(i)||(i.add(t),o.push(t)):([t]=i.add(t),o.push(t)),t[n.fieldName]=e.id})),i.resumeEvents(),a.length&&(i.trigger("remove",{records:a}),i.trigger("change",{action:"remove",records:a})),o.length&&(i.trigger("add",{records:o}),i.trigger("change",{action:"add",records:o}))}cacheRelatedRecord(e,t,r,n=null){const i=this,s=i.relationCache[r]||(i.relationCache[r]={});null!==n&&i.uncacheRelatedRecord(e,r,n),null!=t&&ArrayHelper.include(s[t]||(s[t]=[]),e)}uncacheRelatedRecord(e,t=null,r=null){const n=this;function i(t,r){const i=n.relationCache[t],s=i&&i[r];if(s){const t=s.indexOf(e);t>=0&&s.splice(t,1),0===s.length&&delete i[r]}}null!=r?i(t,r):e.meta.relationCache&&Object.entries(e.meta.relationCache).forEach((([e,t])=>{i(e,t&&t.id)}))}updateDependentStores(e,t){this.dependentStoreConfigs.forEach((r=>{r.forEach((r=>{const n=r.dependentStore,i=n.relationCache[r.relationName];return"dataset"===e?(r.collectionName&&this.initModelRelationCollection(r.collectionName,t),void n.forEach((e=>{const t=e.initRelation(r);t&&n.cacheRelatedRecord(e,t.id,r.relationName,t.id)}))):"removeall"===e?(n.forEach((e=>{e.removeRelation(r)})),void delete n.relationCache[r.relationName]):("add"===e&&r.collectionName&&this.initModelRelationCollection(r.collectionName,t),void("add"!==e&&"remove"!==e||t.forEach((t=>{const s=i&&i[t.id];switch(e){case"remove":s&&s.forEach((e=>e.removeRelation(r)));break;case"add":n.forEach((e=>{e.get(r.fieldName)==t.id&&(e.initRelation(r),n.cacheRelatedRecord(e,t.id,r.relationName))}))}}))))}))}))}updateDependentRecordIds(e,t){this.dependentStoreConfigs&&this.dependentStoreConfigs.forEach((r=>{r.forEach((r=>{const n=r.dependentStore,i=n.relationCache[r.relationName],s=i&&i[e]&&i[e].slice();s&&s.forEach((i=>{n.cacheRelatedRecord(i,t,r.relationName,e),i.set(r.fieldName,t,!1,!0)}))}))}))}},StoreSum=e=>class extends(e||Base){static get $name(){return"StoreSum"}sum(e,t=this.storage.values){return t?t.reduce(((t,r)=>{if(r.isSpecialRow)return t;const n=Number(r[e]);return isNaN(n)?t:t+n}),0):0}min(e,t=this.storage.values){return t&&t.length?t.reduce(((t,r)=>("number"==typeof r[e]&&r[e]<t&&(t=r[e]),t)),t[0][e]):0}max(e,t=this.storage.values){return t&&t.length?t.reduce(((t,r)=>("number"==typeof r[e]&&r[e]>t&&(t=r[e]),t)),t[0][e]):0}average(e,t=this.storage.values){if(!t||!t.length)return 0;let r=0;const n=t.reduce(((t,n)=>{if(n.isSpecialRow)return t;const i=parseFloat(n[e]);return isNaN(i)?t:(r++,t+i)}),0);return r>0?n/r:0}groupSum(e,t){return this.sum(t,this.getGroupRecords(e))}};const stringFound=(e,t)=>-1!==String(e).toLowerCase().indexOf(t),comparisons={string:stringFound,number:stringFound,boolean:stringFound,date:(e,t)=>e instanceof Date&&t instanceof Date?String(e)===String(t):-1!==String(e.getMonth()+1).indexOf(t)||-1!==String(e.getDate()).indexOf(t)||-1!==String(e.getFullYear()).indexOf(t)};var StoreSearch=e=>class extends(e||Base){static get $name(){return"StoreSearch"}search(e,t=null){const r=this.storage.values,n=r.length,i=[];if(null==e)return null;let s,o,a,l,c;for("string"==typeof e&&(e=String(e).toLowerCase()),s=0;s<n;s++){o=r[s];for(const r of t||o.fieldNames)a=o[r],l=a instanceof Date?"date":typeof a,c=comparisons[l],a&&c&&c(a,e)&&i.push({index:s,data:o,field:r,id:o.id})}return i}findByField(e,t){let r,n,i,s=this.storage.values,o=s.length,a=[];for(null!=t&&(t=String(t).toLowerCase()),r=0;r<o;r++){n=s[r],i=n[e];const o=i instanceof Date?"date":typeof i,l={date:()=>Boolean(i)&&i.toLocaleString().includes(t),string:()=>Boolean(i)&&i.toLowerCase().includes(t),number:()=>"number"==typeof i&&i.toString().includes(t),object:()=>i===t,undefined:()=>i===t};(null==t&&i===t||t&&l[o]())&&a.push({id:n.id,index:r,data:n})}return a}find(e,t=!1){let r=t?this.storage.allValues:this.storage.values;return this.isGrouped&&(r=this.collectGroupRecords(t,!1)),r.find(e)}findRecord(e,t,r=!1){const n=r=>ObjectHelper.isEqual(r[e],t);return this.tree?this.query(n)[0]:(r?this.storage.allValues:this.storage.values).find(n)}query(e,t=!1){let r=t?this.storage.allValues:this.storage.values;if(this.isTree){const t=[];return this.traverse((r=>{e(r)&&t.push(r)})),t}return this.isGrouped&&(r=this.collectGroupRecords(t,!1)),r.filter(e)}some(e,t=!1){let r=t?this.storage.allValues:this.storage.values;return this.isGrouped&&(r=this.collectGroupRecords(t,!1)),r.some(e)}},StoreSort=e=>class extends(e||Base){static get $name(){return"StoreSort"}static get defaultConfig(){return{sorters:[],useLocaleSort:null}}get isSorted(){return Boolean(this.sorters.length)||this.isGrouped}sort(e,t,r=!1,n=!1){const i=this,s=i.allRecords,o=i.sorters?i.sorters.slice():[];let a,l=null;if(e)if(Array.isArray(e))i.sorters=e.map((e=>i.normalizeSorterConfig(e,"string"==typeof e||t)));else{const n=i.normalizeSorterConfig(e,t);r?(a=i.getCurrentSorterByField(n.field),a?(l=a.ascending,a.ascending=n.ascending):i.sorters.push(n)):i.sorters=[n]}return n||!1!==i.trigger("beforeSort",{sorters:i.sorters,records:s,currentSorters:o})?i.performSort(n):(i.sorters=o,void(null!==l&&(a.ascending=l)))}normalizeSorterConfig(e,t){const r=this,n={ascending:t};if("object"==typeof e?(n.field=e.field,n.sortFn=e.fn||e.sortFn,n.useLocaleSort=e.useLocaleSort,n.ascending=null!=e.ascending?e.ascending:t):"function"==typeof e?n.sortFn=e:n.field=e,null==n.ascending){const e=r.getCurrentSorterByField(n.field);n.ascending=!e||!e.ascending}if(null==n.sortFn){var i,s;const e=null===(i=r.modelClass)||void 0===i||null===(s=i.$meta.fields.map[n.field])||void 0===s?void 0:s.compareItems;e&&(n.sortFn=e)}return n}getCurrentSorterByField(e){return"string"==typeof e&&this.sorters.find((t=>t.field===e))||null}addSorter(e,t=!0){this.sort(e,t,!0)}removeSorter(e){const t=this,r=t.sorters.findIndex((t=>t.field===e));r>-1&&(t.sorters.splice(r,1),t.sort())}clearSorters(){this.sorters.length=0,this.sort()}createSorterFn(e){const t=this.useLocaleSort;return(r,n)=>{for(let i=0;i<e.length;i++){const s=e[i],{field:o,ascending:a=!0,useLocaleSort:l=t}=s,c=s.fn||s.sortFn,d=a?1:-1;if(c){const e=c(r,n);if(null!==e)return e*d}const u=r[o],h=n[o];if(u!==h){if(null==u)return-d;if(null==h)return d;if(l){if(!0===l)return String(u).localeCompare(h)*d;if("string"==typeof l)return String(u).localeCompare(h,l)*d;if("object"==typeof l)return String(u).localeCompare(h,l.locale,l)*d}if(u>h)return d;if(u<h)return-d}}return 0}}performSort(e){const t=this,{rootNode:r,storage:n,sorters:i}=t,s=t.createSorterFn(t.isGrouped?t.groupers.concat(i):i);t.isGrouped&&t.storeCollapsedGroups()&&n.replaceValues({values:t.removeHeadersAndFooters(n.values),silent:!0}),t.tree?(r.traverse((e=>{e.isLoaded&&e.isParent&&(e.children.sort(s),e.updateChildrenIndices(e.children,!1,!0))})),n.replaceValues({values:t.collectDescendants(r).visible,silent:!0})):n.replaceValues({values:n.values.sort(s),silent:!0}),t.afterPerformSort(e)}afterPerformSort(e){const t=this,{storage:r}=t;if(t._idMap=null,t.isGrouped&&(r.replaceValues({values:t.prepareGroupRecords(r.values),silent:!0}),t.restoreCollapsedGroups()),!e){const e={action:"sort",sorters:t.sorters,records:t.allRecords};t.trigger("sort",e),t.sortParamName||t.trigger("refresh",e)}}};const returnTrue=()=>!0;var StoreChained=e=>class extends(e||Base){static get $name(){return"StoreChained"}static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],keepUncommittedChanges:!1,excludeCollapsedRecords:!0}}construct(e){super.construct(e);const t=this,{masterStore:r}=t;r&&(t.methodNamesToRelay.forEach((e=>t[e]=(...r)=>t.relayToMaster(e,r))),t.removeAll=(...e)=>{r.remove(t.getRange(),...e)},r.on({changePreCommit:t.onMasterDataChangedPreCommit,change:t.onMasterDataChanged,prio:1,thisObj:t}),r.chainedStores||(r.chainedStores=[]),r.chainedStores.push(t),t.fillFromMaster())}get isChained(){return Boolean(this.masterStore)}set chainedFilterFn(e){this._chainedFilterFn=this.thisObj?e.bind(this.thisObj):e}get chainedFilterFn(){return this._chainedFilterFn||returnTrue}get methodNamesToRelay(){const e=Array.isArray(this.doRelayToMaster),t=Array.isArray(this.dontRelayToMaster);return e&&this.doRelayToMaster.filter((e=>!t||!this.dontRelayToMaster.includes(e)))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach((e=>e.fillFromMaster()))}fillFromMaster(){const e=this,{masterStore:t,isTree:r}=e;if(!e.isChained)throw new Error("fillFromMaster only allowed on chained store");if(e.keepUncommittedChanges){if(r)throw new Error("Cannot use keepUncommittedChanges on a chained tree store");e.data=[].concat(e.added.values.filter((t=>!e.removed.includes(t))),t.allRecords.filter((t=>!e.removed.includes(t)&&!e.added.includes(t)&&e.chainedFilterFn(t))))}else{let n=t.allRecords.filter(e.chainedFilterFn);if(r&&(e.idRegister={},e.internalIdRegister={},n.forEach((t=>{t.stores.includes(e)?e.register(t):t.joinStore(e)})),e.excludeCollapsedRecords)){const t=e.getChildren(e.rootNode);n=e.doIncludeExclude(t,!0)}e.data=n}}commitToMaster(){const e=this,t=e.masterStore;if(!e.isChained)throw new Error("commitToMaster only allowed on chained store");return t.beginBatch(),t.remove(e.removed.values),t.add(e.added.values),t.endBatch(),e.commit()}relayToMaster(e,t){return this.masterStore[e](...t)}onMasterDataChangedPreCommit(e){this.onMasterDataChanged(e),this.$masterEventhandled=!0}onMasterDataChanged({action:e,changes:t,$handled:r}){var n;this.$masterEventhandled?this.$masterEventhandled=!1:("update"!==e||(null===(n=this.chainedFields)||void 0===n?void 0:n.some((e=>e in t))))&&this.fillFromMaster()}},StoreState=e=>class extends(e||Base){static get $name(){return"StoreState"}getState(){const e=this,t={};return e.sorters&&e.sorters.length&&(t.sorters=e.sorters.slice()),e.groupers&&e.groupers.length&&(t.groupers=e.groupers.slice()),e.filters&&e.filters.values.length&&(t.filters=e.filterState),t}applyState(e){const t=this;"sorters"in e&&(t.sorters=e.sorters.slice()),"groupers"in e&&(t.groupers=e.groupers.slice()),("sorters"in e||"groupers"in e)&&t.sort(),"filters"in e&&(t.filters=e.filters.slice(),t.filter())}};const emptyArray$2=Object.freeze([]);var StoreTree=e=>class extends(e||Base){static get $name(){return"StoreTree"}get isTree(){return this.tree||this.masterStore&&this.masterStore.tree}get leaves(){const e=this,t=[];return e.isTree?(e.traverse((e=>{e.isLeaf&&t.push(e)})),t):(e.allRecords.forEach((e=>{e.isLeaf&&t.push(e),e.traverse((e=>{e.isLeaf&&t.push(e)}),!0)})),t)}async loadChildren(e){}onNodeAddChild(e,t,r,n,i=!1){const s=this,o=e===s.rootNode&&e.isLoading,{storage:a}=s,l=[],c=[],d=t[0].previousSibling;let u;if(s.collectDescendants(t,l,c,{inCollapsedBranch:!(e.isExpanded(s)&&e.ancestorsExpanded(s))}),!o&&c.length)for(const e of c)s.modified.includes(e)||n[e.id]||(s.removed.includes(e)?s.removed.remove(e):s.added.add(e));var h;if(o&&s.rootVisible&&(l.unshift(e),c.unshift(e)),l.length&&(u=0!==r&&d?a.indexOf(d)+d.getDescendantCount(!0,s):a.indexOf(e),a.suspendEvents(),s.storage.splice(++u,0,l),a.resumeEvents()),s.updateDependentStores("add",t),o&&l.length){if(s.sorters.length&&s.sort(null,null,!1,!0),null===(h=s.afterLoadData)||void 0===h||h.call(s),!i){const e={action:"dataset",data:s._data,records:l};s.trigger("refresh",e),s.trigger("change",e)}}else if(!i){const r={action:"add",parent:e,isChild:!0,isMove:n,records:t,allRecords:c,index:u};s.trigger("add",r),s.trigger("change",r)}}onNodeRemoveChild(e,t,r,n={isMove:!1,silent:!1,unfiltered:!1}){const i=this,{storage:s}=i,o=[],a=[],{isMove:l,silent:c,unfiltered:d}=n,u=d&&i.isFiltered,h=u&&e.unfilteredChildren?e.unfilteredChildren:t;if(i.collectDescendants(h,o,a,{inCollapsedBranch:!(e.isExpanded(i)&&e.ancestorsExpanded(i)),unfiltered:u}),!l){for(const e of t)e.unJoinStore(i);if(a.length){for(const e of a)e.stores.includes(i)&&e.unJoinStore(i),i.added.includes(e)?i.added.remove(e):i.removed.add(e);i.modified.remove(a)}}if(o.length?(r=s.indexOf(o[0]))>-1&&(s.suspendEvents(),s.splice(r,o.length),s.resumeEvents()):r=-1,!c){const n={action:"remove",parent:e,isChild:!0,isMove:l,records:t,allRecords:a,index:r};i.trigger("remove",n),i.trigger("change",n)}}collectDescendants(e,t=[],r=[],n={inCollapsedBranch:!1,unfiltered:!1}){const i=this,{inCollapsedBranch:s,unfiltered:o}=n,a=Array.isArray(e)?e:i.getChildren(e,o);if(a)for(let e,n=0,l=a.length;n<l;n++)e=a[n],s||t.push(e),r.push(e),i.collectDescendants(e,t,r,{inCollapsedBranch:s||!e.isExpanded(i),unfiltered:o});return{visible:t,all:r}}getChildren(e,t=!1){const r=(t||this.isChained)&&e.unfilteredChildren||e.children;return r&&r.length?this.isChained?r.filter(this.chainedFilterFn):r:emptyArray$2}internalToggleTreeSubRecords(e,t){const r=this,{storage:n}=r,i=n.indexOf(e),s=r.doIncludeExclude(r.getChildren(e),t);if(s.length&&!1!==i){if(n.suspendEvents(),t){n.splice(i+1,0,...s);const e={action:"add",isExpand:!0,records:s,index:i+1};r.trigger("add",e),r.trigger("change",e)}else{n.splice(i+1,s.length);const e={action:"remove",isCollapse:!0,records:s,index:i+1};r.trigger("remove",e),r.trigger("change",e)}n.resumeEvents()}}doIncludeExclude(e,t,r=[]){const n=this,i=e&&e.length;for(let s=0;s<i;s++){const i=e[s];if(!n.isChained||n.chainedFilterFn(i)){const e=i.instanceMeta(n.id);t?r.push(i):e.hidden||r.push(i),e.hidden=!t,i.isExpanded(n)&&n.doIncludeExclude(n.getChildren(i),t,r)}}return r}async toggleCollapse(e,t){const r=this,n=r.getById(e),i=n.instanceMeta(r);if(void 0===t&&(t=!i.collapsed),!i.isLoadingChildren&&!n.isLeaf&&n.isExpanded(r)===t){if(r.trigger("beforeToggleNode",{record:n,collapse:t}),i.collapsed=t,i.collapsed)return r.onNodeCollapse(n),!0;{r.onNodeExpand(n);let e=!0;if(!n.isLoaded){i.isLoadingChildren=!0;try{await r.loadChildren(n)}catch(t){i.collapsed=!0,e=!1,r.trigger("loadChildrenException",{record:n,exception:t})}finally{i.isLoadingChildren=!1}}return e}}}onNodeCollapse(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!1)}onNodeExpand(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!0)}};class WalkHelper{static preWalk(e,t,r){const n=[e];let i,s;for(;n.length;)i=n.pop(),r(i),s=t(i),s&&n.push.apply(n,s.slice().reverse())}static preWalkWithParent(e,t,r){const n=[{node:e,parent:null}];for(;n.length;){const{parent:e,node:i}=n.pop();r(e,i);const s=t(i);s&&n.push(...s.slice().reverse().map((e=>({node:e,parent:i}))))}}static preWalkUnordered(e,t,r){let n,i,s=[e];for(;s.length;)n=s[s.length-1],r(n),i=t(n),i?s.splice(s.length-1,1,...i):s.length=s.length-1}static postWalk(e,t,r){let n,i,s=new Map,o=[e];for(;o.length;)n=o[o.length-1],s.has(n)?(r(n),o.pop()):(i=t(n),i&&(o=o.concat(i.slice().reverse())),s.set(n,n))}static prePostWalk(e,t,r,n){let i,s,o=new Map,a=[e];for(;a.length;)i=a[a.length-1],o.has(i)?(n(i),a.pop()):(r(i),s=t(i),s&&(a=a.concat(s.slice().reverse())),o.set(i,i))}}WalkHelper._$name="WalkHelper";var StoreSync=e=>class extends(e||Base){static get $name(){return"StoreSync"}static get defaultConfig(){return{syncDataOnLoad:null}}syncDataset(e){const t=this,{storage:r}=t,{toAdd:n,toRemove:i,updated:s}=t.tree?t.syncTreeDataset(e):t.syncFlatDataset(e);let{threshold:o}=t.syncDataOnLoad,a=!1;if(o&&("string"==typeof o&&(o=parseInt(o,10)/100*t.count),a=n.length+i.length+s.length>o),t.tree){if(n.length){t.add(n,a).forEach((e=>e.clearParentId()))}t.remove(i,a)}else a&&r.suspendEvents(),r.splice(t.count-i.length,i,n),a&&r.resumeEvents();o&&!a&&s.forEach((({record:e,toSet:r,wasSet:n})=>t.onModelChange(e,r,n))),t.acceptChanges();const l={added:n,removed:i,updated:s,thresholdSurpassed:a};a&&this.trigger("refresh",{action:"batch",data:e,records:r.values,syncInfo:l}),t.isFiltered&&t.filter(),t.isGrouped?t.group():t.isSorted&&t.sort(),t.trigger("loadSync",l)}syncFlatDataset(e){if(!e)return;const t=this,r=t.modelClass.idField,n=[],i=[],s=[],o={};let{threshold:a}=t.syncDataOnLoad,l=0;return e.forEach((e=>{const n=e[r],c=t.getById(n);if(c){const t=c.set(e,null,Boolean(a));t&&s.push({record:c,wasSet:t,toSet:e}),l++}else i.push(t.processRecord(t.createRecord(e)));o[n]=1})),l<t.allCount&&t.forEach((e=>{o[e.id]||n.push(e)})),{toAdd:i,toRemove:n,updated:s}}syncTreeDataset(e){if(!e)return;const t=this,{idField:r,parentIdField:n}=t.modelClass,i=[],s=[],o=[],a={},{threshold:l}=t.syncDataOnLoad;return WalkHelper.preWalkWithParent({isRoot:!0,children:e},(e=>e.children),((e,i)=>{if(e){const c=i[r],d=t.getById(c);if(d){const e=d.set(i,null,Boolean(l));e&&o.push({record:d,wasSet:e,toSet:i})}else i[n]=e[r],s.push(i);a[c]=1}})),t.traverse((e=>{a[e.id]||i.push(e)})),{toAdd:s,toRemove:i,updated:o}}};const STM_PROP$1=Symbol("STM_PROP");var StoreStm=e=>class extends(e||Base){static get $name(){return"StoreStm"}static get defaultConfig(){return{stm:null}}get stm(){return this[STM_PROP$1]}set stm(e){const t=this;t.stm!=e&&(t.stm&&t.stm.hasStore(t)&&t.stm.removeStore(t),t[STM_PROP$1]=e,t.stm&&!t.stm.hasStore(t)&&t.stm.addStore(t))}add(e,t=!1){let r;const n=this.stm;return this.tree||!n||n.disabled?r=super.add(e,t):(r=super.add(e,t),r&&r.length&&n.onStoreModelAdd(this,r,t)),r}insert(e,t,r=!1){let n;const i=this.stm;if(this.tree||!i||i.disabled)n=super.insert(e,t,r);else{const s=(Array.isArray(t)?t:[t]).reduce(((e,t)=>{const r=t instanceof Model?this.indexOf(t):void 0;return void 0!==r&&-1!==r&&e.set(t,r),e}),new Map);n=super.insert(e,t),n&&n.length&&(e=this.indexOf(n[0]),i.onStoreModelInsert(this,e,n,s,r))}return n}remove(e,t=!1,r){let n;const i=this.stm;if(this.tree||!i||i.disabled)n=super.remove(e,t,r);else{const s=(Array.isArray(e)?e:[e]).map((e=>this.getById(e))).filter((e=>!!e)).reduce(((e,t)=>{const r=this.indexOf(t);return void 0!==r&&-1!=r&&e.set(t,r),e}),new Map);n=super.remove(e,t,r),n&&n.length&&i.onStoreModelRemove(this,n,s,t)}return n}removeAll(e){const t=this.stm;let r;if(t&&!t.disabled){const{tree:n,rootNode:i,allRecords:s}=this,o=s.length,a=n?i.children.slice():s.slice();r=super.removeAll(e),o&&0===this.count&&t.onStoreRemoveAll(this,a,e)}else r=super.removeAll(e);return r}};class Store extends(Base.mixin(Identifiable,Events,Pluggable,State,StoreFilter,StoreCRUD,StoreRelation,StoreSum,StoreSearch,StoreSort,StoreGroup,StoreChained,StoreState,StoreTree,StoreStm,StoreSync,StoreProxy)){static get properties(){return{relationCache:{},dependentStoreConfigs:new Map}}static get defaultConfig(){return{id:!0,fields:null,autoTree:!0,modelClass:Model,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:!1,allowNoId:!0,preventSubClassingModel:null}}static get identifiable(){return{}}constructor(...e){if(super(...e),this.objectify)return this.initProxy()}construct(e={}){Object.assign(this,{added:new StoreBag,removed:new StoreBag,modified:new StoreBag,idRegister:{},internalIdRegister:{}}),super.construct(e),this.initRelations()}doDestroy(){const e=this,t=e.registeredRecords;for(let n,i=t.length-1;i>=0;i--){var r;n=t[i],(null===(r=n)||void 0===r?void 0:r.isDestroyed)||n.unJoinStore(e)}e.storage.destroy(),e.stm&&e.stm.removeStore(e),super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const t=this;(null==e?void 0:e.isCollection)?t._storage=e:t._storage=new Collection(e),t._storage.autoFilter=t.reapplyFilterOnAdd;for(const e of t._storage)e.joinStore(t);t._storage.on({change:"onDataChange",thisObj:t})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){const e=this;if(e.isTree){const t=e.collectDescendants(e.rootNode,void 0,void 0,{unfiltered:!0}).all;return e.rootVisible&&t.unshift(e.rootNode),t}return e.isGrouped?e.collectGroupRecords():e.storage.allValues}onDataChange({source:e,action:t,added:r,removed:n,replaced:i,oldCount:s,item:o,from:a,to:l}){const c=this,d=null==r?void 0:r.length,u=null==n?void 0:n.length;let h;if(c._idMap=null,d&&r.forEach((e=>{e.joinStore(c)})),null==i||i.forEach((([e,t])=>{e.unJoinStore(c,!0),t.joinStore(c)})),super.onDataChange(...arguments),!c.isTree){if(d){for(const e of r)c.removed.includes(e)?c.removed.remove(e):c.added.add(e);h=!c.remoteFilter&&c.filtered&&c.reapplyFilterOnAdd,h&&c.filter({silent:!0})}if(u){for(const e of n)e.unJoinStore(c),c.added.includes(e)?c.added.remove(e):e._undoingInsertion||c.removed.add(e);c.modified.remove(n),h=!c.remoteFilter&&c.filtered,h&&c.filter({silent:!0})}}switch(t){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(d){c.updateDependentStores("add",r);const t=r.reduce(((e,t)=>{const{previousIndex:r}=t.meta;return r>-1&&r<e&&(e=r),e}),r[0].meta.previousIndex),n={records:r,index:e.indexOf(r[0],!e.autoFilter)};t>-1&&(n.oldIndex=t),c.trigger("add",n),c.trigger("change",Object.assign({action:"add"},n)),h&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:s,records:c.storage.allValues})}n.length&&(c.updateDependentStores("remove",n),c.trigger("remove",{records:n}),c.trigger("change",{action:"remove",records:n})),i.length&&(c.trigger("replace",{records:i,all:c.records.length===i.length}),c.trigger("change",{action:"replace",replaced:i,all:c.records.length===i.length}));break;case"filter":c.isGrouped?c.group(null,null,null,null,!0):c.isSorted&&c.performSort(!0);break;case"move":for(let e=c.storage.allValues,t=Math.min(a,l);t<=Math.max(a,l);t++)e[t].setData("parentIndex",t);c.trigger("move",{record:o,from:a,to:l}),c.trigger("change",{action:t,record:o,from:a,to:l})}}onDataReplaced(e,t){var r;const n=this;if(n.storage.allValues.forEach((e=>{e.joinStore(n)})),n.prepareGroupRecords(n.storage.values),n.restoreCollapsedGroups(),!n.remoteFilter&&n.isFiltered&&n.filter({silent:!0}),n.isGrouped&&n.group(null,null,!1,!n.sorters.length,!0),!n.sortParamName&&n.sorters.length&&n.sort(null,null,!1,!0),!n.useRawData.disableDuplicateIdCheck){const e=n.idMap;if(Object.keys(e).length<n.storage.values.length){const t=[];throw n.storage.values.forEach((r=>e[r.id]?delete e[r.id]:t.push(r))),new Error("Id collision on "+t.map((e=>e.id)))}}const i={action:e,data:t,records:n.storage.values};n.updateDependentStores(e,i.records),null===(r=n.afterLoadData)||void 0===r||r.call(n),n.trigger("refresh",i),n.trigger("change",i)}onModelChange(e,t,r,n,i){const s=this,o=e.constructor.idField,a={record:e,changes:r,batch:null!=e.batching,fromRelationUpdate:i},l=!e.ignoreBag&&s.updateModifiedBagForRecord(e);if(this.storage.onItemMutation(e,r),!n){if(o in r){const{oldValue:r,value:n}=t[o];s.updateDependentRecordIds(r,n),s.onRecordIdChange({record:e,oldValue:r,value:n}),s.trigger("idChange",{store:s,record:e,oldValue:r,value:n})}s.onUpdateRecord(e,r),s.trigger("update",a),s.trigger("change",Object.assign({action:"update"},a))}s.autoCommit&&l&&s.doAutoCommit()}updateModifiedBagForRecord(e){const t=this;let r=!1;return e.isModified?t.modified.includes(e)||t.added.includes(e)||!e.isPartOfStore(t)||e.isAutoRoot||(e.isPhantom?t.added.add(e):t.modified.add(e),r=!0):t.modified.remove(e),r}get idMap(){const e=this,t=e.storage.values,r=!e._idMap,n=e._idMap||(e._idMap={});if(r)for(let e,r=0,i=0;r<t.length;r++)e=t[r],n[e.id]={index:r,visibleIndex:i,record:e},e.isSpecialRow||i++;return n}get modelClass(){return this._modelClass}set modelClass(e){const t=this.fields;let r=null;r=(null==t?void 0:t.length)?class extends e{static get fields(){return t}}:this.preventSubClassingModel?e:class extends e{},r.initClass(),this._modelClass=r}set storeId(e){this.id=e}get storeId(){return this.id}set id(e){const t=this;if(t._id&&Store.unregisterInstance(t),t._id=!0===e?e=Store.generateId("store-"):e,e){const r=Store.getById(e);r&&Store.unregisterInstance(r),Store.registerInstance(t)}}get id(){return this._id}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}buildRootNode(){return{}}static getStore(e,t){if(e instanceof Store)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let r;const n=e.map((e=>(e instanceof Model?r=e.constructor:"string"==typeof e&&(e={text:e}),e)));e={autoCreated:!0,data:n,modelClass:r||class extends Model{},allowNoId:!0},t||(t=Store)}return t?new t(e):void 0}static get stores(){return Store.registeredInstances}get rootNode(){return this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var t;const r=this,n=r._rootNode;e!==n&&(n&&r.clear(!1),e instanceof Model?(e.instanceMeta(r).collapsed=!1,r._rootNode=e):r._rootNode=e=new r.modelClass(Object.assign({expanded:!0,[r.modelClass.idField]:r.id+"-rootNode"},e),r,null,!0),r._tree=!0,e.isRoot=!0,e.joinStore(r),((null===(t=e.children)||void 0===t?void 0:t.length)||r.rootVisible)&&(e.isLoading=!0,r.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),r.trigger("rootChange",{oldRoot:n,rootNode:e}))}set data(e){this.setStoreData(e)}setStoreData(e){const t=this;if(t.getConfig("plugins"),t.processConfiguredListeners(),e&&!Array.isArray(e)&&(e=ObjectHelper.transformNamedObjectToArray(e,t.modelClass.idField)),t.tree=!t.isChained&&(t.tree||Boolean(t.autoTree&&e&&e.some((e=>e[t.modelClass.childrenField])))),t.syncDataOnLoad&&t._data)t.syncDataset(e);else{if(t._data=e,t.tree){const r=t.rootNode;r.clearChildren(!0),r.isLoading=!0,r.appendChild(e),t.updateDependentStores("dataset",[r]),r.isLoading=!1,0===e.length?t.trigger("refresh",{action:"dataset",data:[],records:[]}):t.isFiltered&&t.filter()}else t.loadData(e);t.added.clear(),t.removed.clear(),t.modified.clear()}}loadData(e,t="dataset"){const r=this,{storage:n,allowNoId:i}=r,s=r.modelClass.fieldMap.id.dataSource;if(r.storeCollapsedGroups(),r.removeHeadersAndFooters(r.storage.values),r._idMap=null,e){if(!(e[0]instanceof Model)){r.modelClass.exposeProperties(e[0]);const t=e.length,o=new Array(t);for(let n=0;n<t;n++){const t=e[n];if(!i&&null==t[s])throw new Error("Id required but not found on row "+n);o[n]=r.processRecord(r.createRecord(t,!0),!0),o[n].setData("parentIndex",n)}r.allCount&&r.clear(!1),n.replaceValues({values:o,isNewDataset:!0,silent:!0})}else r.allCount&&r.clear(!1),n.replaceValues({values:e.slice(),isNewDataset:!0,silent:!0});r.onDataReplaced(t,e)}else r.allCount&&r.clear(!1),r._data=null}get data(){return this._data}getRange(e,t,r=!0){return(r?this.storage.allValues:this.storage.values).slice(e,t)}createRecord(e,t=!1){return new this.modelClass(e,this,null,t)}processRecord(e,t=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:t,value:r}){const n=this,i=n._idMap,{idRegister:s}=n;n.storage._indicesInvalid=!0,i&&(delete i[t],i[r]=e),n.added.changeId(t,r),n.removed.changeId(t,r),n.modified.changeId(t,r),delete s[t],s[r]=e,e.index=n.storage.indexOf(e)}onUpdateRecord(e,t){const{internalId:r}=t,{internalIdRegister:n}=this;r&&(this.storage._indicesInvalid=!0,delete n[r.oldValue],n[r.value]=e),this.reapplyFilterOnUpdate&&this.isFiltered&&this.filter()}get useRawData(){return this._useRawData}set useRawData(e){this._useRawData=!0===e?{enabled:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0,disableDefaultValue:!1}:e?Object.assign(e,{enabled:!0}):{enabled:!1}}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){return this.storage.totalCount}get count(){return this.storage.count}get allCount(){return this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,t=!1){return this.storage.getAt(e,t)}register(e){const t=this,r=t.isTree&&t.idRegister[e.id];if(r&&r!==e)throw new Error("Id collision on "+e.id);t.idRegister[e.id]=e,t.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){return(null==e?void 0:e.isModel)?e:this.idRegister[e]}isAvailable(e){const t=this.getById(e);return t&&this.storage.includes(t)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?null!=this.idRegister[Model.asId(e)]:this.indexOf(e)>-1}indexOf(e,t=!1){const r=Model.asId(e);if(null==r)return-1;if(this.isTree)return this.storage.indexOf(r);const n=this.idMap[r];return n?n[t?"visibleIndex":"index"]:-1}allIndexOf(e){if(this.isTree){const t=this.getById(e);let r=-1;return t&&t.bubble((e=>{e.parent?r+=e.parentIndex+1:e===this.rootNode&&this.rootVisible&&(r+=1)})),r}return this.storage.indexOf(e,!0)}getDistinctValues(e){const t=[],r={};let n;return this.forEach((i=>{i.isSpecialRow||i.isRoot||(n=i.get(e),r[n]||(t.push(n),r[n]=1))})),t}getValueCount(e,t){let r=0;return this.forEach((n=>{ObjectHelper.isEqual(n.get(e),t)&&r++})),r}set json(e){"string"==typeof e&&(e=StringHelper.safeJsonParse(e)),this.data=e}get json(){return StringHelper.safeJsonStringify(this)}get formattedJSON(){return StringHelper.safeJsonStringify(this,null,4)}toJSON(){return(this.isTree?this.rootNode.children:this).map((e=>e.toJSON()))}forEach(e,t=this){const r=(r,n)=>{if(!r.isRoot&&!r.isSpecialRow)return e.call(t,r,n)};if(this.isTree)this.rootNode.traverseWhile(r);else{const e=this.storage.values;for(let t=0;t<e.length;t++)if(!1===r(e[t],t))return}}map(e,t=this){return this.storage.values.map(e,t)}reduce(e,t=[],r=this){return r!==this&&(e=e.bind(r)),this.storage.values.reduce(e,t,r)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,t=this.rootNode,r=t===this.rootNode){const n=this;if(n.isTree){if("boolean"==typeof t&&(r=t,t=n.rootNode),n.isChained){const t=e;e=e=>{n.chainedFilterFn(e)&&t(e)}}t.traverse(e,r)}else for(const t of n.storage)t.traverse(e)}traverseWhile(e,t=this.rootNode,r=t===this.rootNode){const n=this;if(n.isTree){if("boolean"==typeof t&&(r=t,t=n.rootNode),n.isChained){const t=e;e=e=>{n.chainedFilterFn(e)&&t(e)}}t.traverseWhile(e,r)}else for(const t of n.storage)if(!1===t.traverse(e))break}getNext(e,t=!1,r=!1){const n=this,i=n.storage.values;let s=n.indexOf(e);if(s>=i.length-1){if(!t)return null;s=-1}const o=i[s+1];return r&&o&&o.isSpecialRow?n.getNext(i[s+1],t,!0):o}getPrev(e,t=!1,r=!1){const n=this,i=n.storage.values;let s=n.indexOf(e);if(0===s){if(!t)return null;s=i.length}const o=i[s-1];return r&&o&&o.isSpecialRow?n.getNext(i[s+1],t,!0):o}getAdjacent(e,t=!0,r=!1,n=!1){return t?this.getNext(e,r,n):this.getPrev(e,r,n)}getNextLeaf(e,t=!1){const r=this.leaves,n=this.getById(e);let i=r.indexOf(n);if(i>=r.length-1){if(!t)return null;i=-1}return r[i+1]}getPrevLeaf(e,t=!1){const r=this.leaves,n=this.getById(e);let i=r.indexOf(n);if(0===i){if(!t)return null;i=r.length}return r[i-1]}getAdjacentLeaf(e,t=!0,r=!1){return t?this.getNextLeaf(e,r):this.getPrevLeaf(e,r)}makeChained(e=(()=>!0),t,r){return new this.constructor(Object.assign(r||{},{tree:!1,autoTree:!1,masterStore:this,modelClass:this.modelClass,chainedFilterFn:e,chainedFields:t}))}chain(){return this.makeChained(...arguments)}}Store.storeMap={},Store._$name="Store";const processParamEntry=(e,t)=>(Array.isArray(t[1])?t[1].forEach((r=>e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(r)))):e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(t[1])),e),immediatePromise$1=Promise.resolve();class AjaxStore extends Store{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:!1,writeAllFields:null,parentIdParamName:"id",responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",filterParamName:null,restfulFilter:!1,sortParamName:null,pageParamName:null,pageStartParamName:null,pageSizeParamName:"pageSize",pageSize:50,useRestfulMethods:!1,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"}}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch((()=>{}))}get isLoading(){return this._isLoading}get isCommitting(){return Boolean(this.commitPromise)}set pageParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this._pageParamName=e}get pageParamName(){return this._pageParamName}set pageStartParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this._pageStartParamName=e}get pageStartParamName(){return this._pageStartParamName}get isPaged(){return this.pageParamName||this.pageStartParamName}get allCount(){return"remoteTotal"in this?this.remoteTotal:super.allCount}get lastPage(){if(this.isPaged)return Math.floor((this.allCount+this.pageSize-1)/this.pageSize)}buildQueryString(...e){const t=Object.entries(Object.assign({},...e)).reduce(processParamEntry,[]).join("&");return t?"?"+t:""}performSort(e){const t=this;if(t.sortParamName){const{groupRecords:r}=t,n={};return t.isGrouped&&r&&r.length&&r.forEach((e=>{e.meta.collapsed&&(t.includeGroupRecords(e),n[e.id]=!0)})),t.internalLoad({},"",(r=>{t.data=r.data,t.afterPerformSort(e,n)}))}super.performSort(e)}performFilter(e){const t=this;if(t.remoteFilter){const r=t.count,{filters:n}=t;return t.currentPage=1,t.internalLoad({},"",(i=>{t.data=i.data,t.afterPerformFilter(e?null:{action:"filter",filters:n,oldCount:r,records:t.storage.values})}))}super.performFilter(e)}encodeFilterParams(e){const t=[];for(const{property:r,operator:n,value:i,caseSensitive:s}of e)t.push({field:r,operator:n,value:i,caseSensitive:s});return JSON.stringify(t)}encodeSorterParams(e){return JSON.stringify(e.filter((e=>!e.sortFn)).map((e=>e)))}buildReadUrl(){const{readUrl:e}=this;if(this.restfulFilter){return(e.endsWith("/")?e:e+"/")+this.filters.first.value}return e}internalLoad(e,t,r){const n=this,i=ObjectHelper.assign({},n.params,e),s=n.buildReadUrl(),o={action:"read"+t,params:i,url:s};return s?new Promise(((e,s)=>{if(!1===n.trigger("beforeLoad"+t,o))return s(!1);if(n._isLoading=!0,n.trigger(`load${t}Start`,o),n.trigger("beforeRequest",o),n.filterParamName&&n.isFiltered&&(i[n.filterParamName]=n.encodeFilterParams(n.filters.values)),n.sortParamName&&n.isSorted&&(i[n.sortParamName]=n.encodeSorterParams(n.groupers?n.groupers.concat(n.sorters):n.sorters)),n.isPaged){if(!i[n.pageParamName]&&!i[n.pageStartParamName]){const e=Math.min(n.currentPage||1,n.allCount?n.lastPage:1/0);n.pageParamName?i[n.pageParamName]=e:i[n.pageStartParamName]=(e-1)*n.pageSize}i[n.pageSizeParamName]=n.pageSize}const a={headers:n.headers,parseJson:!0};n.useRestfulMethods&&(a.method=n.httpMethods.read),AjaxHelper.get(o.url+n.buildQueryString(i),ObjectHelper.assign(a,n.fetchOptions)).then((async a=>{const l=a.parsedJson,c=Array.isArray(l),d=c||l&&!1!==ObjectHelper.getPath(l,n.responseSuccessProperty),u=c?null:ObjectHelper.getPath(l,n.responseTotalProperty);if(n._isLoading=!1,o.response=a,o.json=l,d){if(null!=u&&(n.remoteTotal=parseInt(u,10)),n.isPaged){if(!(n.remoteTotal>=0))throw new Error("A paged store must receive its responseTotalProperty in each data packet");{const e=n.pageParamName?i[n.pageParamName]:i[n.pageStartParamName]/n.pageSize+1;n.currentPage=Math.min(e,n.lastPage)}}o.data=c?l:ObjectHelper.getPath(l,n.responseDataProperty),await r(o),n.trigger("load"+t,o),e(o)}else o.exception=!0,o.exceptionType="server",n.trigger("exception",o),s(o);n.trigger("afterRequest",o)})).catch((e=>{n._isLoading=!1,o.exception=!0,e instanceof Response?(o.exceptionType=e.ok?"server":"network",o.response=e,o.error=e.error):(o.exceptionType="server",o.error=e),n.trigger("exception",o),s(o),n.trigger("afterRequest",o)}))})):null}async load(e){const t=this;return t.isPaged?t.loadPage((t.currentPage||0)+1,e):t.internalLoad(e,"",(e=>{t.data=e.data}))}async loadChildren(e){return this.internalLoad({[this.parentIdParamName]:e.id},"Children",(t=>{t.parentRecord=e,e.data[e.constructor.childrenField]=t.data,e.processChildren(e.stores)}))}async loadPage(e,t){this.allCount&&(e=Math.min(e,this.lastPage));const r=this,n=r.pageParamName?{[r.pageParamName]:e}:{[r.pageStartParamName]:(e-1)*r.pageSize};return n[r.pageSizeParamName]=r.pageSize,r.internalLoad(ObjectHelper.assign(n,t),"Page",(e=>{r.loadData(e.data,"pageLoad")}))}async nextPage(e){return this.isPaged&&this.currentPage!==this.lastPage?this.loadPage(this.currentPage+1,e):immediatePromise$1}async previousPage(e){return this.isPaged&&1!==this.currentPage?this.loadPage(this.currentPage-1,e):immediatePromise$1}async commit(){const e=this,{changes:t}=e,r=[];if(e.commitPromise)return!1;if(!t)return e.modified.count&&(e.modified.forEach((e=>e.clearChanges(!1))),e.modified.clear()),immediatePromise$1;if([...t.added,...t.modified,...t.removed].forEach((e=>e.meta.committing=!0)),!1!==e.trigger("beforeCommit",{changes:t})){const n={action:"commit",exception:!1,changes:t};let i=e.commitRemoved(n);return i&&r.push(i),i=e.commitAdded(n),i&&r.push(i),i=e.commitModified(n),i&&r.push(i),r.length?(i=1===r.length?r[0]:Promise.all(r),e.commitPromise=new Promise(((r,s)=>{i.then((()=>{e.commitPromise=null,n.exception?(e.trigger("exception",n),s(n)):(e.trigger("commit",{changes:t}),r(n))})).catch((()=>{e.commitPromise=null,s(n)}))}))):(e.modified.forEach((e=>e.clearChanges(!1))),e.modified.clear(),e.added.forEach((e=>e.clearChanges(!1))),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:t}),immediatePromise$1)}}doAutoCommit(){this.suspendCount<=0&&this.commit().catch((e=>{const{response:t}=e;if(!t||!(t.ok&&t.parsedJson||[500,404].includes(t.status)))throw e}))}commitAdded(e){const t=this,r=t.added,n={action:"create",params:t.params};return r.count&&t.createUrl?new Promise((i=>{const s=r.values.map((e=>e.persistableData));e.create=n;let o=n.body={data:s};if(t.trigger("beforeRequest",n),t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),o=e}const a={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(a.method=t.httpMethods.create),AjaxHelper.post(t.createUrl+t.buildQueryString(t.params),o,ObjectHelper.assign(a,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;e.response=s,n.json=o,n.response=s,l?(t.processReturnedData(r.values,a?o:o[t.responseDataProperty]),r.clear(),t.trigger("commitAdded"),t.trigger("refresh",n),i(e)):(r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,e.exceptionType=n.exceptionType="server",t.trigger("exception",n),i(e)),t.trigger("afterRequest",n)})).catch((s=>{r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,s instanceof Response?(e.response=s,n.exceptionType=s.ok?"server":"network",n.response=s,n.error=s.error):(n.exceptionType="server",n.error=s),t.trigger("exception",n),i(e),t.trigger("afterRequest",n)}))})):null}commitModified(e){const t=this,{modified:r}=t.changes,n={action:"update",params:t.params},i=r.length&&t.updateUrl?new Promise((i=>{const s=r.map((e=>t.writeAllFields?e.persistableData:e.modificationData)).filter((e=>!ObjectHelper.isEmpty(e)));if(0===s.length)return t.modified.clear(),r.forEach((e=>e.meta.committing=!1)),void i();e.update=n;let o=n.body={data:s};if(t.trigger("beforeRequest",n),t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),o=e}const a={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(a.method=t.httpMethods.update),AjaxHelper.post(t.updateUrl+t.buildQueryString(t.params),o,ObjectHelper.assign(a,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;e.response=s,n.json=o,n.response=s,l?(t.processReturnedData(r,a?o:o[t.responseDataProperty],!0),t.modified.clear(),t.trigger("commitModified"),t.trigger("refresh",n),i(e)):(r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,n.exceptionType="server",t.trigger("exception",n),i(e)),t.trigger("afterRequest",n)})).catch((s=>{r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,s instanceof Response?(e.response=s,n.exceptionType=s.ok?"server":"network",n.response=s,n.error=s.error):(n.exceptionType="server",n.error=s),t.trigger("exception",n),i(e),t.trigger("afterRequest",n)}))})):null;return!r.length&&t.modified.count&&t.modified.clear(),i}processReturnedData(e,t,r=!1){const n=this.modelClass,i=n.fieldMap.id.dataSource;t.forEach(((t,s)=>{const o=e[s];o.clearChanges(!1),o.syncId(t[i]),Object.assign(e[s].data,n.processData(t,r))}))}commitRemoved(e){const t=this,r=t.removed,n={action:"delete",params:t.params};return r.count&&t.deleteUrl?new Promise((i=>{e.delete=n;let s=n.body={ids:r.map((e=>e.id))};if(t.trigger("beforeRequest",n),t.sendAsFormData){const e=new FormData;e.append("id",JSON.stringify(s.ids)),s=e}const o={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(o.method=t.httpMethods.delete),AjaxHelper.post(t.deleteUrl+t.buildQueryString(t.params),s,ObjectHelper.assign(o,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o)||o&&!1!==o.success;e.response=s,n.json=o,n.response=s,a?(r.forEach((e=>e.meta.committing=!1)),r.clear(),t.trigger("commitRemoved"),t.trigger("refresh",n),i(e)):(r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,n.exceptionType="server",t.trigger("exception",n),i(e)),t.trigger("afterRequest",n)})).catch((s=>{r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,s instanceof Response?(e.response=s,n.exceptionType=s.ok?"server":"network",n.response=s,n.error=s.error):(n.exceptionType="server",n.error=s),t.trigger("exception",n),i(e),t.trigger("afterRequest",n)}))})):null}get remoteFilter(){return Boolean(this.filterParamName||this.restfulFilter)}}AjaxStore._$name="AjaxStore";class DomDataStore{static get(e,t){const r=e._domData||(e._domData={});return null!=t?r[t]:r}static remove(e,t){const{_domData:r}=e,n=null==r?void 0:r[t];return null==r||delete r[t],n}static set(e,t,r){3===arguments.length?(e._domData||(e._domData={}))[t]=r:e._domData=t}static assign(e,t){Object.assign(e._domData||(e._domData={}),t)}}DomDataStore._$name="DomDataStore";class Duration{constructor(e,t){"number"==typeof e?(this._magnitude=e,this._unit=t):("string"==typeof e&&(e=DateHelper.parseDuration(e)),"object"==typeof e&&Object.assign(this,e))}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude="number"==typeof e&&e}get unit(){return this._unit}set unit(e){this._unit=DateHelper.parseTimeUnit(e)}get isValid(){return null!=this._magnitude&&this._unit}get milliseconds(){return this.isValid?Math.round(DateHelper.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return Boolean(e&&this.milliseconds===e.milliseconds)}toString(e){const t=this,r=t.useAbbreviation?"getShortNameOfUnit":"getLocalizedNameOfUnit";return t.isValid?`${t._magnitude} ${DateHelper[r](t._unit,1!==t._magnitude)}`:""}valueOf(){return this.milliseconds}}Duration._$name="Duration";const throwAbstractMethodCall=()=>{throw new Error("Abstract method call!")},throwInvalidMethodCall=()=>{throw new Error("Method cannot be called at this state!")};class StateBase extends Base{canUndo(e){throwAbstractMethodCall()}canRedo(e){throwAbstractMethodCall()}onUndo(e){throwAbstractMethodCall()}onRedo(e){throwAbstractMethodCall()}onStartTransaction(e){throwAbstractMethodCall()}onStopTransaction(e){throwAbstractMethodCall()}onStopTransactionDelayed(e){throwAbstractMethodCall()}onRejectTransaction(e){throwAbstractMethodCall()}onEnable(e){throwAbstractMethodCall()}onDisable(e){throwAbstractMethodCall()}onAutoRecordOn(e){throwAbstractMethodCall()}onAutoRecordOff(e){throwAbstractMethodCall()}onResetQueue(e){throwAbstractMethodCall()}onModelUpdate(e){throwAbstractMethodCall()}onStoreModelAdd(e){throwAbstractMethodCall()}onStoreModelInsert(e){throwAbstractMethodCall()}onStoreModelRemove(e){throwAbstractMethodCall()}onStoreModelRemoveAll(e){throwAbstractMethodCall()}onModelInsertChild(e){throwAbstractMethodCall()}onModelRemoveChild(e){throwAbstractMethodCall()}}StateBase._$name="StateBase";const STATE_PROP=Symbol("STATE_PROP"),STORES_PROP=Symbol("STORES_PROP"),QUEUE_PROP=Symbol("QUEUE_PROP"),POS_PROP=Symbol("POS_PROP"),TRANSACTION_PROP=Symbol("TRANSACTION_PROP"),TRANSACTION_TIMER_PROP=Symbol("TRANSACTION_TIMER_PROP"),AUTO_RECORD_PROP=Symbol("AUTO_RECORD_PROP"),PROPS=Object.freeze([STATE_PROP,STORES_PROP,QUEUE_PROP,POS_PROP,TRANSACTION_PROP,TRANSACTION_TIMER_PROP,AUTO_RECORD_PROP]),registry=new Map,registerStmState=(e,t)=>{registry.set(e,t)},resolveStmState=e=>("string"==typeof e&&(e=registry.get(e)),e);var Registry={registerStmState:registerStmState,resolveStmState:resolveStmState};const resetQueue=(e,t)=>{const{undo:r,redo:n}=t;let i;return i=r&&!n?{[QUEUE_PROP]:e[QUEUE_PROP].slice(e.position),[POS_PROP]:0}:n&&!r?{[QUEUE_PROP]:e[QUEUE_PROP].slice(0,e.position)}:{[QUEUE_PROP]:[],[POS_PROP]:0},[i,()=>{e.notifyStoresAboutQueueReset(t)}]};class DisabledStateClass extends StateBase{canUndo(){return!1}canRedo(){return!1}onUndo(){throwInvalidMethodCall()}onRedo(){throwInvalidMethodCall()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){throwInvalidMethodCall()}onAutoRecordOn(){return{[AUTO_RECORD_PROP]:!0}}onAutoRecordOff(){return{[AUTO_RECORD_PROP]:!1}}onStartTransaction(){throwInvalidMethodCall()}onStopTransaction(){throwInvalidMethodCall()}onStopTransactionDelayed(){throwInvalidMethodCall()}onRejectTransaction(){throwInvalidMethodCall()}onResetQueue(e,t){return resetQueue(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const DisabledState=new DisabledStateClass;Registry.registerStmState("disabledstate",DisabledState);const ACTION_QUEUE_PROP=Symbol("ACTION_QUEUE_PROP");class Transaction extends Base{get defaultConfig(){return{title:null}}construct(...e){this[ACTION_QUEUE_PROP]=[],super.construct(...e)}get queue(){return this[ACTION_QUEUE_PROP].slice(0)}get length(){return this[ACTION_QUEUE_PROP].length}addAction(e){this[ACTION_QUEUE_PROP].push(e)}undo(){const e=this[ACTION_QUEUE_PROP];for(let t=e.length-1;t>=0;--t)e[t].undo()}redo(){const e=this[ACTION_QUEUE_PROP];for(let t=0,r=e.length;t<r;++t)e[t].redo()}}Transaction._$name="Transaction";class ReadyStateClass extends StateBase{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,t){const r=e[QUEUE_PROP];let n=e.position,i=Math.max(0,n-t);return[{[STATE_PROP]:"restoringstate",[POS_PROP]:i},()=>{for(e.notifyStoresAboutStateRestoringStart();n!=i;)r[--n].undo();return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onRedo(e,t){const r=e[QUEUE_PROP];let n=e.position,i=Math.min(r.length,n+t);return[{[STATE_PROP]:"restoringstate",[POS_PROP]:i},()=>{e.notifyStoresAboutStateRestoringStart();do{r[n++].redo()}while(n!=i);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onEnable(){throwInvalidMethodCall()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[STATE_PROP]:"autoreadystate",[AUTO_RECORD_PROP]:!0}}onAutoRecordOff(){throwInvalidMethodCall()}onStartTransaction(e,t){const r=new Transaction({title:t});return[{[STATE_PROP]:"recordingstate",[TRANSACTION_PROP]:r},()=>{e.notifyStoresAboutStateRecordingStart(r)}]}onStopTransaction(){throwInvalidMethodCall()}onStopTransactionDelayed(){throwInvalidMethodCall()}onRejectTransaction(){throwInvalidMethodCall()}onResetQueue(e,t){return resetQueue(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}let ReadyState=new ReadyStateClass;Registry.registerStmState("readystate",ReadyState);class RecordingStateClass extends StateBase{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const t=e[TRANSACTION_PROP];return e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[STATE_PROP]:"disabledstate",[TRANSACTION_PROP]:null}}onAutoRecordOn(e){return[{[STATE_PROP]:"autorecordingstate",[AUTO_RECORD_PROP]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){throwInvalidMethodCall()}onStartTransaction(){throwInvalidMethodCall()}onStopTransaction(e,t){const r=e[TRANSACTION_PROP];let n=e[POS_PROP],i=e[QUEUE_PROP];return r.length&&(r.title||t||!e.getTransactionTitle?t&&(r.title=t):r.title=e.getTransactionTitle(r),i[n]=r,i.length=++n),[{[STATE_PROP]:"readystate",[POS_PROP]:n,[TRANSACTION_PROP]:null},()=>{e.notifyStoresAboutStateRecordingStop(r,{stop:!0})}]}onRejectTransaction(e){const t=e[TRANSACTION_PROP];return[{[STATE_PROP]:"restoringstate",[TRANSACTION_PROP]:null},()=>(t.length&&t.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onStopTransactionDelayed(){throwInvalidMethodCall()}onQueueReset(){throwInvalidMethodCall()}onModelUpdate(e,t,r,n){e[TRANSACTION_PROP].addAction(e.makeModelUpdateAction(t,r,n))}onModelInsertChild(e,t,r,n,i,s){e[TRANSACTION_PROP].addAction(e.makeModelInsertChildAction(t,r,n,i,s))}onModelRemoveChild(e,t,r,n){e[TRANSACTION_PROP].addAction(e.makeModelRemoveChildAction(t,r,n))}onStoreModelAdd(e,t,r,n){e[TRANSACTION_PROP].addAction(e.makeStoreModelAddAction(t,r,n))}onStoreModelInsert(e,t,r,n,i,s){e[TRANSACTION_PROP].addAction(e.makeStoreModelInsertAction(t,r,n,i,s))}onStoreModelRemove(e,t,r,n,i){e[TRANSACTION_PROP].addAction(e.makeStoreModelRemoveAction(t,r,n,i))}onStoreRemoveAll(e,t,r,n){e[TRANSACTION_PROP].addAction(e.makeStoreRemoveAllAction(t,r,n))}}const RecordingState=new RecordingStateClass;Registry.registerStmState("recordingstate",RecordingState);class RestoringStateClass extends StateBase{canUndo(){return!1}canRedo(){return!1}onUndo(){throwInvalidMethodCall()}onRedo(){throwInvalidMethodCall()}onEnable(){throwInvalidMethodCall()}onDisable(){throwInvalidMethodCall()}onAutoRecordOn(){return{[AUTO_RECORD_PROP]:!0}}onAutoRecordOff(){return{[AUTO_RECORD_PROP]:!1}}onStartTransaction(){throwInvalidMethodCall()}onStopTransaction(){throwInvalidMethodCall()}onStopTransactionDelayed(){throwInvalidMethodCall()}onRejectTransaction(){throwInvalidMethodCall()}onQueueReset(){throwInvalidMethodCall()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const RestoringState=new RestoringStateClass;Registry.registerStmState("restoringstate",RestoringState);class AutoReadyStateClass extends ReadyStateClass{onAutoRecordOn(){throwInvalidMethodCall()}onAutoRecordOff(){return{[STATE_PROP]:"readystate",[AUTO_RECORD_PROP]:!1}}onStartTransaction(e,t){const r=new Transaction({title:t});return[{[STATE_PROP]:"autorecordingstate",[TRANSACTION_PROP]:r},()=>{e.notifyStoresAboutStateRecordingStart(r),e.stopTransactionDelayed()}]}onModelUpdate(e,t,r,n){e.startTransaction(),e.onModelUpdate(t,r,n)}onModelInsertChild(e,t,r,n,i){e.startTransaction(),e.onModelInsertChild(t,r,n,i)}onModelRemoveChild(e,t,r,n){e.startTransaction(),e.onModelRemoveChild(t,r,n)}onStoreModelAdd(e,t,r,n){e.startTransaction(),e.onStoreModelAdd(t,r,n)}onStoreModelInsert(e,t,r,n,i,s){e.startTransaction(),e.onStoreModelInsert(t,r,n,s)}onStoreModelRemove(e,t,r,n,i){e.startTransaction(),e.onStoreModelRemove(t,r,n,i)}onStoreRemoveAll(e,t,r,n){e.startTransaction(),e.onStoreRemoveAll(t,r,n)}}const AutoReadyState=new AutoReadyStateClass;Registry.registerStmState("autoreadystate",AutoReadyState);const{defineProperty:defineProperty$4}=Reflect;let globalDelays=null;if(VersionHelper.isTestEnv){const e=BrowserHelper.global.bryntum||(BrowserHelper.global.bryntum={});globalDelays=e.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,isEmpty:(e=!1)=>globalDelays.timeouts.size+globalDelays.animationFrames.size+(e?globalDelays.intervals.size:0)===0}}const makeInvoker=(e,t,r,n)=>{const i="string"==typeof t,s=n&&n.appendArgs||[],o=()=>{r.timerId=null,r.lastCallTime=performance.now();const n=r.args;r.args=null,i?e[t](...n,...s):t.call(e,...n,...s),r.called=!0,++r.calls};return n&&(e=n.thisObj||e),r.lastCallTime=-9e9,r.calls=0,r.invoker=o,o.wrapFn=r,o},decorateWrapFn=(e,t,r="clearTimeout")=>(t.cancel=()=>{t.isPending&&(e[r](t.timerId),t.args=t.timerId=null)},t.flush=()=>{t.isPending&&(e[r](t.timerId),t.timerId=null,t.invoker())},t.now=(...e)=>{t.cancel(),t.args=e,t.invoker()},t.immediate=!1,t.timerId=null,defineProperty$4(t,"isPending",{get:()=>null!==t.timerId}),t);var Delayable=e=>class extends(e||Base){static get $name(){return"Delayable"}static get declarable(){return["delayable"]}doDestroy(){const e=this;e.timeoutIds&&(e.timeoutIds.forEach(((e,t)=>{"function"==typeof e&&e(),clearTimeout(t),globalDelays&&globalDelays.timeouts.delete(t)})),e.timeoutIds=null),e.timeoutMap&&(e.timeoutMap.forEach(((e,t)=>clearTimeout(t))),e.timeoutMap=null),e.intervalIds&&(e.intervalIds.forEach((e=>{clearInterval(e),globalDelays&&globalDelays.intervals.delete(e)})),e.intervalIds=null),e.animationFrameIds&&(e.animationFrameIds.forEach((e=>{cancelAnimationFrame(e),globalDelays&&globalDelays.animationFrames.delete(e)})),e.animationFrameIds=null),super.doDestroy()}hasTimeout(e){return!(!this.timeoutMap||!this.timeoutMap.has(e))}setTimeout({fn:e,delay:t,name:r,runOnDestroy:n,cancelOutstanding:i,args:s}){(arguments.length>1||"function"==typeof arguments[0])&&([e,t,r,n]=arguments),"string"==typeof e?r=e:r||(r=e.name),i&&this.clearTimeout(r);const o=this,a=o.timeoutIds||(o.timeoutIds=new Map),l=o.timeoutMap||(o.timeoutMap=new Map),c=setTimeout((()=>{"string"==typeof e&&(e=o[r]),a&&a.delete(c),l&&l.delete(r),globalDelays&&globalDelays.timeouts.delete(c),e.apply(o,s)}),t);return a.set(c,!n||e),globalDelays&&globalDelays.timeouts.set(c,{fn:e,delay:t,name:r}),r&&l.set(r,c),c}clearTimeout(e){let t=e;if("string"==typeof t){if(!this.timeoutMap)return;t=this.timeoutMap.get(e),this.timeoutMap.delete(e)}clearTimeout(t),this.timeoutIds&&this.timeoutIds.delete(t),globalDelays&&globalDelays.timeouts.delete(t)}clearInterval(e){clearInterval(e),this.intervalIds&&this.intervalIds.delete(e),globalDelays&&globalDelays.intervals.delete(e)}setInterval(e,t){const r=setInterval(e,t);return(this.intervalIds||(this.intervalIds=new Set)).add(r),globalDelays&&globalDelays.intervals.set(r,{fn:e,delay:t}),r}requestAnimationFrame(e,t=[],r=this){const n=this.animationFrameIds||(this.animationFrameIds=new Set),i=requestAnimationFrame((()=>(globalDelays&&globalDelays.animationFrames.delete(i),n.delete(i),e.apply(r,t))));return n.add(i),globalDelays&&globalDelays.animationFrames.set(i,{fn:e,extraArgs:t,thisObj:r}),i}createOnFrame(e,t=[],r=this,n){let i;const s=(...s)=>{i&&n&&(this.cancelAnimationFrame(i),i=null),i||(i=this.requestAnimationFrame((()=>{"string"==typeof e&&(e=r[e]),i=null,s.push(...t),e.apply(r,s)})))};return s.cancel=()=>this.cancelAnimationFrame(i),s}cancelAnimationFrame(e){cancelAnimationFrame(e),this.animationFrameIds&&this.animationFrameIds.delete(e),globalDelays&&globalDelays.animationFrames.delete(e)}async nextAnimationFrame(){return new Promise((e=>this.requestAnimationFrame(e)))}buffer(e,t){let r=t;t&&"number"!=typeof t?r=t.delay:t=null;const n=(...e)=>{const{delay:t}=n;n.cancel(),n.called=!1,n.args=e,n.immediate||!t?i():n.timerId=this.setTimeout(i,t)},i=makeInvoker(this,e,n,t);return n.delay=r,decorateWrapFn(this,n)}raf(e,t){let r=t;t&&"boolean"!=typeof t?r=t.cancelOutstanding:t=null;const n=(...e)=>{n.cancelOutstanding&&n.cancel(),n.called=!1,n.args=e,n.immediate?i():n.isPending||(n.timerId=this.requestAnimationFrame(i))},i=makeInvoker(this,e,n,t);return n.cancelOutstanding=r,decorateWrapFn(this,n,"cancelAnimationFrame")}throttle(e,t){let r,n=t;t&&"number"!=typeof t?(n=t.delay,r=t.throttled):t=null;const i=this,s=(...e)=>{const{delay:t}=s,n=performance.now()-s.lastCallTime;s.args=e,s.immediate||n>=t?(i.clearTimeout(s.timerId),o()):(s.isPending||(s.timerId=i.setTimeout(o,t-n),s.called=!1),r&&(r.wrapFn.args=e,r()))},o=makeInvoker(i,e,s,t);return s.delay=n,r&&(r=makeInvoker(i,r,(()=>{}),t)),decorateWrapFn(i,s)}static setupDelayable(e){e.setupDelayableMethods(e.delayable)}static setupDelayableMethods(e,t=null){const r=e.static,n=t||this.prototype;r&&delete e.static;for(const t in e){let r=e[t];const i=t+"Now",s=typeof r;n[i]=n[t],"number"===s?r={type:"buffer",delay:r}:"string"===s&&(r={type:r}),defineProperty$4(n,t,{get(){const e=this[r.type](((...e)=>{this[i](...e)}),r);return defineProperty$4(this,t,{value:e}),e}})}}get widgetClass(){}};class AutoRecordingStateClass extends(RecordingStateClass.mixin(Delayable)){onDisable(e){const t=e[TRANSACTION_PROP],r=e[TRANSACTION_TIMER_PROP];return r&&this.clearTimeout(r),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[STATE_PROP]:"disabledstate",[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null}}onAutoRecordOn(e){throwInvalidMethodCall()}onAutoRecordOff(e){const t=e[TRANSACTION_TIMER_PROP];return t&&this.clearTimeout(t),{[STATE_PROP]:"recordingstate",[AUTO_RECORD_PROP]:!1,[TRANSACTION_TIMER_PROP]:null}}onStopTransaction(e,t){const r=e[TRANSACTION_PROP],n=e[TRANSACTION_TIMER_PROP];let i=e[POS_PROP],s=e[QUEUE_PROP];return n&&this.clearTimeout(n),r.length&&(r.title||t||!e.getTransactionTitle?t&&(r.title=t):r.title=e.getTransactionTitle(r),s[i]=r,s.length=++i),[{[STATE_PROP]:"autoreadystate",[POS_PROP]:i,[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null},()=>{e.notifyStoresAboutStateRecordingStop(r,{stop:!0})}]}onStopTransactionDelayed(e){let t=e[TRANSACTION_TIMER_PROP];return t&&this.clearTimeout(t),t=this.setTimeout((()=>{e.stopTransaction()}),e.autoRecordTransactionStopTimeout),{[STATE_PROP]:AutoRecordingState,[TRANSACTION_TIMER_PROP]:t}}onRejectTransaction(e){const t=e[TRANSACTION_PROP],r=e[TRANSACTION_TIMER_PROP];return r&&this.clearTimeout(r),[{[STATE_PROP]:"restoringstate",[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null},()=>(t.length&&t.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onModelUpdate(e,...t){super.onModelUpdate(e,...t),e.stopTransactionDelayed()}onModelInsertChild(e,...t){super.onModelInsertChild(e,...t),e.stopTransactionDelayed()}onModelRemoveChild(e,...t){super.onModelRemoveChild(e,...t),e.stopTransactionDelayed()}onStoreModelAdd(e,...t){super.onStoreModelAdd(e,...t),e.stopTransactionDelayed()}onStoreModelInsert(e,...t){super.onStoreModelInsert(e,...t),e.stopTransactionDelayed()}onStoreModelRemove(e,...t){super.onStoreModelRemove(e,...t),e.stopTransactionDelayed()}onStoreRemoveAll(e,...t){super.onStoreRemoveAll(e,...t),e.stopTransactionDelayed()}}const AutoRecordingState=new AutoRecordingStateClass;Registry.registerStmState("autorecordingstate",AutoRecordingState);const throwAbstractMethodCall$1=()=>{throw new Error("Abstract method call!")};class ActionBase extends Base{get type(){return this.constructor.name}undo(){throwAbstractMethodCall$1()}redo(){throwAbstractMethodCall$1()}}ActionBase._$name="ActionBase";const MODEL_PROP=Symbol("MODEL_PROP"),NEW_DATA_PROP=Symbol("NEW_DATA_PROP"),OLD_DATA_PROP=Symbol("OLD_DATA_PROP");class UpdateAction extends ActionBase{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0}}get type(){return"UpdateAction"}get model(){return this[MODEL_PROP]}set model(e){this[MODEL_PROP]=e}get newData(){return this[NEW_DATA_PROP]}set newData(e){this[NEW_DATA_PROP]=Object.assign({},e)}get oldData(){return this[OLD_DATA_PROP]}set oldData(e){this[OLD_DATA_PROP]=Object.assign({},e)}undo(){this.model.set(this.oldData,null,null,null,!0),this.model.$&&Object.assign(this.model,this.oldData)}redo(){this.model.set(this.newData,null,null,null,!0),this.model.$&&Object.assign(this.model,this.newData)}}UpdateAction._$name="UpdateAction";const PARENT_MODEL_PROP=Symbol("PARENT_MODEL_PROP"),CHILD_MODELS_PROP=Symbol("CHILD_MODELS_PROP"),INSERT_INDEX_PROP=Symbol("INSERT_INDEX_PROP"),CONTEXT_PROP=Symbol("CONTEXT_PROP");class InsertChildAction extends ActionBase{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[PARENT_MODEL_PROP]}set parentModel(e){this[PARENT_MODEL_PROP]=e}get childModels(){return this[CHILD_MODELS_PROP]}set childModels(e){this[CHILD_MODELS_PROP]=e.slice(0)}get insertIndex(){return this[INSERT_INDEX_PROP]}set insertIndex(e){this[INSERT_INDEX_PROP]=e}get context(){return this[CONTEXT_PROP]}set context(e){this[CONTEXT_PROP]=e}undo(){const{parentModel:e,context:t,childModels:r}=this;r.sort(((e,r)=>{const{lhsParent:n,lhsIndex:i}=t.get(e)||{},{rhsParent:s,rhsIndex:o}=t.get(r)||{};return n&&n===s?i-o:0})),r.forEach((r=>{const{parent:n,index:i}=t.get(r)||{};if(n)if(n===e){let e;e=i>r.parentIndex?i+1:i,e=i===n.children.length-1?null:e;const t=n.children[e];n.insertChild(r,t)}else n.insertChild(r,n.children[i]);else e.removeChild(r)}))}redo(){const{parentModel:e,insertIndex:t,childModels:r}=this,n=e.children[t];e.insertChild(r,n)}}InsertChildAction._$name="InsertChildAction";const PARENT_MODEL_PROP$1=Symbol("PARENT_MODEL_PROP"),CHILD_MODELS_PROP$1=Symbol("CHILD_MODELS_PROP"),CONTEXT_PROP$1=Symbol("CONTEXT_PROP");class RemoveChildAction extends ActionBase{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[PARENT_MODEL_PROP$1]}set parentModel(e){this[PARENT_MODEL_PROP$1]=e}get childModels(){return this[CHILD_MODELS_PROP$1]}set childModels(e){this[CHILD_MODELS_PROP$1]=e.slice(0)}get context(){return this[CONTEXT_PROP$1]}set context(e){this[CONTEXT_PROP$1]=e}undo(){const{parentModel:e,context:t,childModels:r}=this;r.sort(((e,r)=>t.get(e)-t.get(r))),r.forEach((r=>{e.insertChild(t.get(r),r)}))}redo(){this.parentModel.removeChild(this.childModels)}}RemoveChildAction._$name="RemoveChildAction";const STORE_PROP=Symbol("STORE_PROP"),MODEL_LIST_PROP=Symbol("MODEL_LIST_PROP");class AddAction extends ActionBase{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[STORE_PROP]}set store(e){this[STORE_PROP]=e}get modelList(){return this[MODEL_LIST_PROP]}set modelList(e){this[MODEL_LIST_PROP]=e.slice(0)}undo(){const e=this;e.store.remove(e.modelList,e.silent)}redo(){const e=this;e.store.add(e.modelList,e.silent)}}AddAction._$name="AddAction";const STORE_PROP$1=Symbol("STORE_PROP"),MODEL_LIST_PROP$1=Symbol("MODEL_LIST_PROP"),INSERT_INDEX_PROP$1=Symbol("INSERT_INDEX_PROP"),CONTEXT_PROP$2=Symbol("CONTEXT_PROP");class InsertAction extends ActionBase{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[STORE_PROP$1]}set store(e){this[STORE_PROP$1]=e}get modelList(){return this[MODEL_LIST_PROP$1]}set modelList(e){this[MODEL_LIST_PROP$1]=e.slice(0)}get insertIndex(){return this[INSERT_INDEX_PROP$1]}set insertIndex(e){this[INSERT_INDEX_PROP$1]=e}get context(){return this[CONTEXT_PROP$2]}set context(e){this[CONTEXT_PROP$2]=e}undo(){const{store:e,modelList:t,context:r,silent:n}=this;t.sort(((e,t)=>{const n=r.get(e),i=r.get(t);return void 0!==n&&void 0!==i?n-i:0})),t.forEach((t=>{const i=r.get(t);t._undoingInsertion=!0,void 0!==i?e.insert(i,t,n):e.remove(t,n),t._undoingInsertion=!1}))}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}}InsertAction._$name="InsertAction";const STORE_PROP$2=Symbol("STORE_PROP"),MODEL_LIST_PROP$2=Symbol("MODEL_LIST_PROP"),CONTEXT_PROP$3=Symbol("CONTEXT_PROP");class RemoveAction extends ActionBase{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[STORE_PROP$2]}set store(e){this[STORE_PROP$2]=e}get modelList(){return this[MODEL_LIST_PROP$2]}set modelList(e){this[MODEL_LIST_PROP$2]=e.slice(0)}get context(){return this[CONTEXT_PROP$3]}set context(e){this[CONTEXT_PROP$3]=e}undo(){const{store:e,context:t,modelList:r,silent:n}=this;r.sort(((e,r)=>t.get(e)-t.get(r))),r.forEach((r=>{const i=t.get(r);e.insert(i,r,n)}))}redo(){const e=this;e.store.remove(e.modelList,e.silent)}}RemoveAction._$name="RemoveAction";const STORE_PROP$3=Symbol("STORE_PROP"),ALL_RECORDS_PROP=Symbol("ALL_RECORDS_PROP");class RemoveAllAction extends ActionBase{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[STORE_PROP$3]}set store(e){this[STORE_PROP$3]=e}get allRecords(){return this[ALL_RECORDS_PROP]}set allRecords(e){this[ALL_RECORDS_PROP]=e.slice(0)}undo(){const{store:e,allRecords:t,silent:r}=this;e.add(t,r)}redo(){this.store.removeAll(this.silent)}}RemoveAllAction._$name="RemoveAllAction";const makeModelUpdateAction=(e,t,r)=>new UpdateAction({model:e,newData:t,oldData:r}),makeModelInsertChildAction=(e,t,r,n)=>new InsertChildAction({parentModel:e,childModels:r,insertIndex:t,context:n}),makeModelRemoveChildAction=(e,t,r)=>new RemoveChildAction({parentModel:e,childModels:t,context:r}),makeStoreModelAddAction=(e,t,r)=>new AddAction({store:e,modelList:t,silent:r}),makeStoreModelInsertAction=(e,t,r,n,i)=>new InsertAction({store:e,insertIndex:t,modelList:r,context:n,silent:i}),makeStoreModelRemoveAction=(e,t,r,n)=>new RemoveAction({store:e,modelList:t,context:r,silent:n}),makeStoreRemoveAllAction=(e,t,r)=>new RemoveAllAction({store:e,allRecords:t,silent:r}),stateTransition=(e,t,...r)=>{const n=t.call(e[STATE_PROP],e,...r);if("string"==typeof n)e[STATE_PROP]=Registry.resolveStmState(n);else if(n instanceof StateBase)e[STATE_PROP]=n;else if(Array.isArray(n)){const[t,i]=n;"string"==typeof t?e[STATE_PROP]=Registry.resolveStmState(t):t instanceof StateBase?e[STATE_PROP]=t:t&&"object"==typeof t&&((e=Object.assign(e,t))[STATE_PROP]=Registry.resolveStmState(e[STATE_PROP])),"function"==typeof i&&stateTransition(e,i,...r)}else n&&"object"==typeof n&&((e=Object.assign(e,n))[STATE_PROP]=Registry.resolveStmState(e[STATE_PROP]))};class StateTrackingManager extends(Events(Base)){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:makeModelUpdateAction,makeModelInsertChildAction:makeModelInsertChildAction,makeModelRemoveChildAction:makeModelRemoveChildAction,makeStoreModelAddAction:makeStoreModelAddAction,makeStoreModelInsertAction:makeStoreModelInsertAction,makeStoreModelRemoveAction:makeStoreModelRemoveAction,makeStoreRemoveAllAction:makeStoreRemoveAllAction,getTransactionTitle:null}}construct(...e){Object.assign(this,{[STATE_PROP]:ReadyState,[STORES_PROP]:[],[QUEUE_PROP]:[],[POS_PROP]:0,[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null,[AUTO_RECORD_PROP]:!1}),super.construct(...e)}get state(){return this[STATE_PROP]}get position(){return this[POS_PROP]}get length(){return this[QUEUE_PROP].length}get stores(){return Array.from(this[STORES_PROP])}hasStore(e){return this[STORES_PROP].includes(e)}addStore(e){this.hasStore(e)||(this[STORES_PROP].push(e),e.stm=this)}removeStore(e){this.hasStore(e)&&(this[STORES_PROP]=this[STORES_PROP].filter((t=>t!==e)),e.stm=null)}forEachStore(e){this[STORES_PROP].forEach((t=>e(t,t.id)))}get disabled(){return this.state===DisabledState}set disabled(e){const t=this;t.disabled!=e&&(stateTransition(t,e?t.state.onDisable:t.state.onEnable,t),t.trigger("stmDisabled",{disabled:e}),t.trigger("disabled",{disabled:e}))}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===ReadyState||this.state===AutoReadyState}get isRecording(){return this.state===RecordingState||this.state===AutoRecordingState}get autoRecord(){return this[AUTO_RECORD_PROP]}set autoRecord(e){const t=this;t.autoRecord!=e&&stateTransition(t,e?t.state.onAutoRecordOn:t.state.onAutoRecordOff,t)}startTransaction(e=null){stateTransition(this,this.state.onStartTransaction,e)}stopTransaction(e=null){stateTransition(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){stateTransition(this,this.state.onStopTransactionDelayed)}rejectTransaction(){stateTransition(this,this.state.onRejectTransaction)}get transaction(){return this[TRANSACTION_PROP]}get queue(){return this[QUEUE_PROP].map((e=>e.title))}get isRestoring(){return this.state===RestoringState}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}undo(e=1){stateTransition(this,this.state.onUndo,e)}undoAll(){this.undo(this.length)}redo(e=1){stateTransition(this,this.state.onRedo,e)}redoAll(){this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){stateTransition(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore((t=>{t.onStmRecordingStart&&t.onStmRecordingStart(this,e)})),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,t){this.forEachStore((r=>{r.onStmRecordingStop&&r.onStmRecordingStop(this,e,t)})),this.trigger("recordingStop",{stm:this,transaction:e,reason:t})}notifyStoresAboutStateRestoringStart(){this.forEachStore((e=>{e.onStmRestoringStart&&e.onStmRestoringStart(this)})),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop(){this.forEachStore((e=>{e.onStmRestoringStop&&e.onStmRestoringStop(this)})),this.trigger("restoringStop",{stm:this})}notifyStoresAboutQueueReset(e){this.forEachStore((t=>{t.onStmQueueReset&&t.onStmQueueReset(this,e)})),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,t,r){stateTransition(this,this.state.onModelUpdate,e,t,r)}onModelInsertChild(e,t,r,n){stateTransition(this,this.state.onModelInsertChild,e,t,r,n)}onModelRemoveChild(e,t,r){stateTransition(this,this.state.onModelRemoveChild,e,t,r)}onStoreModelAdd(e,t,r){stateTransition(this,this.state.onStoreModelAdd,e,t,r)}onStoreModelInsert(e,t,r,n,i){stateTransition(this,this.state.onStoreModelInsert,e,t,r,n,i)}onStoreModelRemove(e,t,r,n){stateTransition(this,this.state.onStoreModelRemove,e,t,r,n)}onStoreRemoveAll(e,t,r){stateTransition(this,this.state.onStoreRemoveAll,e,t,r)}}StateTrackingManager._$name="StateTrackingManager";class AsyncHelper{static animationFrame(){return new Promise((e=>{requestAnimationFrame(e)}))}static sleep(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}static yield(){return Promise.resolve()}}AsyncHelper._$name="AsyncHelper";class CSSHelper{static insertRule(e){const{styleSheet:t}=this,r=t.cssRules.length;if(t.insertRule(e,0),t.cssRules.length>r)return t.cssRules[0]}static findRule(e){let t,r="function"==typeof e;return Array.prototype.find.call(document.head.querySelectorAll("link[rel=stylesheet],style[type*=css]"),(n=>{if(t=Array.prototype.find.call(n.sheet.rules||n.sheet.cssRules,(t=>r?e(t):t.selectorText===e)),t)return!0})),t}static get styleSheet(){return this._stylesheet||(this._stylesheet=DomHelper.createElement({tag:"style",id:"bryntum-private-styles",type:"text/css",parent:document.head}).sheet),this._stylesheet}}CSSHelper._$name="CSSHelper";const arraySlice$1=Array.prototype.slice,htmlRe=/[&<]/,syncEqualityEvaluator={ignore:{_element:1,parent:1,elementData:1,ns:1},evaluate(e,t,r){if("html"===e&&"string"!=typeof t.value&&"compareHtml"in t.object)return t.object.compareHtml===r.object.compareHtml}},syncIgnoreAttributes={tag:1,html:1,text:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,_element:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,listeners:1,isReleased:1},isClass={class:1,className:1,classname:1},emptyArray$3=Object.freeze([]);class DomSync{static sync(e){const t=e.refOwner,r=t&&t.byRef;let n,i,s,o,a=e.affected;if("string"==typeof a&&(a=[a]),t){if(t.byRef={},a)for(i in r)a.includes(i)||(t.byRef[i]=r[i]);e=Object.assign({refsWas:r},e)}if(this.performSync(e,e.targetElement)&&t)for(a||(a=Object.keys(r)),n=0;n<a.length;++n)i=a[n],i in t.byRef||(s=r[i],s&&(o=s.lastDomConfig,s.remove(),t.detachRef(i,s,o)));return e.targetElement}static performSync(e,t){const{domConfig:r,callback:n}=e;return(e.configEquality?e.configEquality(r,t.lastDomConfig,syncEqualityEvaluator):ObjectHelper.isDeeplyEqual(r,t.lastDomConfig,syncEqualityEvaluator))?(this.relinkElements(r,t),n&&n({action:"none",domConfig:r,targetElement:t}),!1):(r?(r.onlyChildren||(this.syncAttributes(r,t,e),this.syncContent(r,t)),this.syncChildren(e,t),r._element=t):(t.innerHTML=null,t.syncIdMap=null),t.lastDomConfig=r,!0)}static relinkElements(e,t){e.retainElement||(e._element=t,e.children&&e.children.forEach(((e,r)=>{e&&"string"!=typeof e&&this.relinkElements(e,t.lastDomConfig.children[r]._element)})))}static syncDataset(e,t){const{lastDomConfig:r}=t,n=e===r,i=Object.keys(e.dataset),s=r&&r.dataset&&Object.keys(r.dataset),o=ArrayHelper.delta(i,s);for(let r=0;r<o.onlyInA.length;r++){const n=o.onlyInA[r],i=e.dataset[n];void 0!==i&&t.setAttribute("data-"+StringHelper.hyphenate(n),i)}for(let i=0;i<o.inBoth.length;i++){const s=o.inBoth[i];(n||e.dataset[s]!=r.dataset[s])&&t.setAttribute("data-"+StringHelper.hyphenate(s),e.dataset[s])}for(let e=0;e<o.onlyInB.length;e++)t.removeAttribute("data-"+StringHelper.hyphenate(o.onlyInB[e]))}static syncClassList(e,t,r){let n,i,s,o,a,l,c=e.className||e.class;if(r){for(i=DomClassList.normalize(t,"array"),c=DomClassList.normalize(c,"object"),l=DomClassList.normalize(r.className||r.class,"object"),a=[],s=0,o=i.length;s<o;++s)n=i[s],!c[n]&&n in l||(l[n]=1,a.push(n));for(n in c)l[n]||a.push(n);c=a.join(" ")}else c=DomClassList.normalize(c);t.setAttribute("class",c)}static getSyncAttributes(e){const t={},r=[];return e&&Object.keys(e).forEach((n=>{if(!syncIgnoreAttributes[n]){const i=n.toLowerCase();t[i]=e[n],r.push(i)}})),{attributes:t,names:r}}static syncAttributes(e,t,r){const{lastDomConfig:n}=t,i=e===n,s=this.getSyncAttributes(e),{attributes:o,names:a}=s,{attributes:l,names:c}=i?s:this.getSyncAttributes(n),{onlyInA:d,onlyInB:u,inBoth:h}=i?{onlyInA:emptyArray$3,onlyInB:emptyArray$3,inBoth:a}:ArrayHelper.delta(a,c);for(let r=0;r<d.length;r++){const n=d[r],i=o[n];"style"===n?DomHelper.applyStyle(t,i,!0):"dataset"===n?this.syncDataset(e,t):isClass[n]?this.syncClassList(e,t):void 0!==i&&t.setAttribute(n,i)}for(let e=0;e<u.length;e++)t.removeAttribute(u[e]);for(let n=0;n<h.length;n++){const s=h[n],a=o[s],c=l[s];null==a?t.removeAttribute(s):"style"===s?r.strict?i?this.syncStyles(t,a):ObjectHelper.isEqual(a,c,!0)||this.syncStyles(t,a,c):!i&&ObjectHelper.isEqual(a,c,!0)||DomHelper.applyStyle(t,a,!0):"dataset"===s?this.syncDataset(e,t):isClass[s]?this.syncClassList(e,t,r.strict&&t.lastDomConfig):(i||a!==c)&&t.setAttribute(s,a)}}static syncStyles(e,t,r){let n,i,s;if(r){if(n={},t)for(i in t)s=t[i],r[i]!==s&&(n[i]=s);for(i in r)i in t||(n[i]="")}else n=t;DomHelper.applyStyle(e,n)}static syncContent(e,t){const{html:r,text:n}=e,i=null!=n?n:r;e.elementData&&(t.elementData=e.elementData),i instanceof DocumentFragment?1===t.childNodes.length&&0===t.childElementCount&&1===i.childNodes.length&&0===i.childElementCount?DomHelper.setInnerText(t,i.firstChild.data):(t.innerHTML="",t.appendChild(i)):null!=r&&htmlRe.test(r)?t.innerHTML=String(r):null!=i&&DomHelper.setInnerText(t,String(i))}static insertTextNode(e,t,r,n,i=null){const s=document.createTextNode(e);t.insertBefore(s,i),n&&(s.$refOwnerId=n.id),r&&r({action:"newNode",domConfig:e,targetElement:s})}static insertElement(e,t,r,n,i,s,o){const a=o.ns?document.createElementNS(o.ns,e.tag||"svg"):document.createElement(e.tag||"div");t.insertBefore(a,r),this.performSync(o,a),null!=s&&(i[s]=a),n&&(a.$refOwnerId=n.id,s&&(a.$reference=s,n.attachRef(s,a,e))),o.callback&&o.callback({action:"newElement",domConfig:e,targetElement:a,syncId:s})}static syncChildren(e,t){var r;let{domConfig:n,syncIdField:i,callback:s,releaseThreshold:o,configEquality:a,ns:l,refOwner:c,refsWas:d,strict:u}=e;if(null!==(r=n.html)&&void 0!==r?r:n.text)return;const h=this,g=c?c.byRef:{},m=arraySlice$1.call(n.children||[]),p=arraySlice$1.call(t.childNodes),f=d||t.syncIdMap||{},v=n.syncOptions||{},y=t.releasedIdMap||{};i=v.syncIdField||i,u=v.strict||u,s=v.callback||s,a=v.configEquality||a,o="releaseThreshold"in v?v.releaseThreshold:o;let b,C=null;i&&(t.syncIdMap=g);const D={refOwner:c,refsWas:d,strict:u,syncIdField:i,releaseThreshold:o,callback:s,configEquality:a};for(;m.length;){const e=m.shift();if(b=null,!e)continue;const r="string"==typeof e;if(D.domConfig=e,D.ns=e.ns||l,!r){if(c?b=e.reference:i&&e.dataset&&(b=e.dataset[i]),null!=b&&!e.unmatched){const r=f[b]||y[b];if(r){const{lastDomConfig:n}=r;!r.retainElement&&h.performSync(D,r)&&s&&s({action:"reuseOwnElement",domConfig:e,lastDomConfig:n,targetElement:r,syncId:b}),e.retainElement&&(r.retainElement=!0,e._element=r),g[b]=r,ArrayHelper.remove(p,r),delete y[b],r.isReleased=!1,(u||r.parentNode!==t)&&t.insertBefore(r,p[0]||null)}else u?this.insertElement(e,t,p[0]||null,c,g,b,D):(m.push(e),e.unmatched=!0);continue}e.unmatched&&delete e.unmatched}let n,o=null,a=null;for(;p.length&&!a;){if(n=p.shift(),c){if(n.$refOwnerId!==c.id)continue;if(n.$reference){if(!u)continue;o=n;break}a=n}else n.retainElement||(a=n);a||(C||(C=[])).push(n)}if(o||!a)r?this.insertTextNode(e,t,s,c,o):this.insertElement(e,t,o,c,g,b,D);else if(r||a.nodeType!==Node.ELEMENT_NODE||(e.tag||"div").toLowerCase()!==a.tagName.toLowerCase())r&&a.nodeType===Node.TEXT_NODE?a.data=e:(r?this.insertTextNode(e,t,s,c,a):this.insertElement(e,t,a,c,g,b,D),a.remove());else{var S;const{lastDomConfig:t}=a,r=h.performSync(D,a);i&&(null==t||null===(S=t.dataset)||void 0===S?void 0:S[i])&&delete y[t.dataset[i]],null!=b&&(g[b]=a),a.isReleased=!1,r&&s&&s({action:"reuseElement",domConfig:e,lastDomConfig:t,targetElement:a,syncId:b})}}const E=p.length;if(E)if(c)for(let e=0;e<E;++e){const t=p[e];t.$refOwnerId!==c.id||t.$reference||(C||(C=[])).push(t)}else C?C.push(...p):C=p;C&&this.syncChildrenCleanup(t,C,g,s,c,o,i)}static syncChildrenCleanup(e,t,r,n,i,s,o){let a,l=0;for(const c of t){const{lastDomConfig:t}=c;c.retainElement?o&&t&&(r[c.dataset[o]]=c):!i&&o&&(null==s||l<s)?(c.isReleased||(c.className="b-released",c.isReleased=!0,(null==t?void 0:t.dataset)&&(e.releasedIdMap||(e.releasedIdMap={}),e.releasedIdMap[t.dataset[o]]=c),n&&n({action:"releaseElement",domConfig:t,lastDomConfig:t,targetElement:c}),t&&(t.isReleased=!0,t.className&&(t.className="b-released"),t.style&&(t.style=null))),l++):(c.remove(),i&&(a=c.$reference,a&&i.detachRef(a,c,t)),e.releasedIdMap&&o&&(null==t?void 0:t.dataset)&&delete e.releasedIdMap[t.dataset[o]],n&&n({action:"removeElement",domConfig:c.lastDomConfig,lastDomConfig:c.lastDomConfig,targetElement:c}))}}static removeChild(e,t){if(e.contains(t)){const r=e.syncIdMap;if(r){const e=Object.values(r).indexOf(t);e>-1&&delete r[Object.keys(r)[e]]}e.removeChild(t)}}static addChild(e,t,r){e.appendChild(t),e.syncIdMap[r]=t}static getChild(e,t){const r=t.split(".");for(const t of r)e=e.syncIdMap[t];return e}}DomSync._$name="DomSync";var DragHelperContainer=e=>class extends(e||Base){static get $name(){return"DragHelperContainer"}initContainerDrag(){const e=this;if(e.mode||(e.mode="container"),"container"===e.mode&&!e.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(e){const t=this;if(!t.ignoreSelector||!DomHelper.up(e.target,t.ignoreSelector)){const r=DomHelper.getAncestor(e.target,t.containers,t.outerElement);if(r){const n=r.getBoundingClientRect();t.context={element:r,valid:!0,action:"container",offsetX:e.pageX-n.left,offsetY:e.pageY-n.top,originalPosition:{parent:r.parentElement,prev:r.previousElementSibling,next:r.nextElementSibling}}}return!0}return!1}startContainerDrag(e){const{context:t}=this,{element:r}=t,n=r.cloneNode(!0),i=r.getBoundingClientRect();n.classList.add(this.dragProxyCls),n.classList.add(this.draggingCls),document.body.appendChild(n),t.dragProxy=n,n.style.width=i.width+"px",n.style.height=i.height+"px",DomHelper.setTranslateXY(t.dragProxy,i.left,i.top),t.dragging=r,r.classList.add(this.dropPlaceholderCls)}updateContainerDrag(e){const t=this,r=t.context;if(!r.started||!r.targetElement)return;const n=DomHelper.getAncestor(r.targetElement,t.containers,"b-grid"),i=r.dragging&&r.dragging.contains(DomHelper.activeElement);n&&DomHelper.isDescendant(r.element,n)||(i&&GlobalEvents.suspendFocusEvents(),n&&r.valid?t.moveNextTo(n,e):t.revertPosition(),i&&GlobalEvents.resumeFocusEvents(),e.preventDefault())}finishContainerDrag(e){const t=this,r=t.context,{dragging:n,dragProxy:i,valid:s,draggedTo:o,insertBefore:a,originalPosition:l}=r;n&&(r.valid=s&&o&&(n!==a||l.parent!==o),r.finalize=(e=r.valid)=>{!e&&this.context&&t.revertPosition(),n.classList.remove(t.dropPlaceholderCls),i.remove(),t.reset()},r.async=!1,t.trigger("drop",{context:r,event:e}),r.async?r.awaitingFinalization=!0:r.finalize())}abortContainerDrag(e=!1,t=null,r=!1){const n=this,i=n.context;i.dragging&&(i.dragging.classList.remove(n.dropPlaceholderCls),i.dragProxy.remove(),n.context={}),r||n.trigger(e?"drop":"abort",{context:i,event:t})}updateContainerProxy(e){const t=this,r=t.context,n=r.dragProxy;let i,s=e.pageX-r.offsetX,o=e.pageY-r.offsetY;if("number"==typeof t.minX&&(s=Math.max(t.minX,s)),"number"==typeof t.maxX&&(s=Math.min(t.maxX-n.offsetWidth,s)),"number"==typeof t.minY&&(o=Math.max(t.minY,o)),"number"==typeof t.maxY&&(o=Math.min(t.maxY-n.offsetHeight,o)),t.lockX?DomHelper.setTranslateY(n,o):t.lockY?DomHelper.setTranslateX(n,s):DomHelper.setTranslateXY(n,s,o),"touchmove"===e.type){const t=e.changedTouches[0];i=DomHelper.elementFromPoint(t.clientX,t.clientY)}else i=e.target;r.targetElement=i}moveNextTo(e,t){const r=this.context,n=r.dragging,i=e.parentElement;if(e!==n){const s=e.getBoundingClientRect().left+e.offsetWidth/2;t.pageX<s?(i.insertBefore(n,e),r.insertBefore=e):e.nextElementSibling?e.nextElementSibling!==n?(r.insertBefore=e.nextElementSibling,i.insertBefore(n,e.nextElementSibling)):r.insertBefore||n.parentElement.lastElementChild===n||(r.insertBefore=e.nextElementSibling):(i.appendChild(n),r.insertBefore=null),r.draggedTo=i}}revertPosition(){const e=this.context,t=e.originalPosition;if(t.next){t.next&&t.next.previousSibling===e.dragging||!t.next&&e.dragging===t.parent.lastChild||t.parent.insertBefore(e.dragging,t.next)}else t.parent.appendChild(e.dragging);e.draggedTo=null}};const noScroll={pageXOffset:0,pageYOffset:0};var DragHelperTranslate=e=>class extends(Delayable(e||Base)){static get $name(){return"DragHelperTranslate"}initTranslateDrag(){const e=this;e.mode=e.mode||"translateXY",!e.isElementDraggable&&e.targetSelector&&(e.isElementDraggable=t=>DomHelper.up(t,e.targetSelector))}grabTranslateDrag(e){const t=this,r=t.getTarget(e);return!!r&&(t.context={valid:!0,action:t.mode,element:r,startPageX:e.pageX,startPageY:e.pageY,startClientX:e.clientX,startClientY:e.clientY},!0)}getTarget(e){return DomHelper.up(e.target,this.targetSelector)}startTranslateDrag(e){const t=this,r=t.context,{relatedElements:n}=r;let i=r.dragProxy||r.element;if(i&&!r.started){const s=i,o=i.parentElement,a=t.dragWithin=t.dragWithin||t.cloneTarget&&document.body,l=t.outerElement;if(t.cloneTarget){const e=DomHelper.getOffsetX(i,a),r=DomHelper.getOffsetY(i,a),n=i.offsetWidth,o=i.offsetHeight;i=t.createProxy(i),DomHelper.setTranslateXY(i,e,r),i.style.width=n+"px",i.style.height=o+"px",i.classList.add(t.dragProxyCls),a.appendChild(i),s.classList.add("b-drag-original"),t.hideOriginalElement&&s.classList.add("b-hidden")}Object.assign(t.context,{element:i,grabbed:s,grabbedParent:o,grabbedNextSibling:i.nextElementSibling,elementStartX:DomHelper.getTranslateX(i),elementStartY:DomHelper.getTranslateY(i),elementX:DomHelper.getOffsetX(i,a||l),elementY:DomHelper.getOffsetY(i,a||l),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!t.cloneTarget||a===l}),i.classList.add(t.draggingCls),a&&(r.parentElement=i.parentElement,a!==i.parentElement&&a.appendChild(i),t.updateTranslateProxy(e)),n&&n.forEach((e=>{e.classList.add(t.draggingCls)}))}}applyConstraints(e,t,r){const n=this,i=n.dragWithin,{pageXOffset:s,pageYOffset:o}=i===document.body?window:noScroll;return i&&n.constrain&&(t<0&&(t=0),t+e.offsetWidth>i.scrollWidth&&(t=i.scrollWidth-e.offsetWidth),r<0&&(r=0),r+e.offsetHeight>i.scrollHeight&&(r=i.scrollHeight-e.offsetHeight)),"number"==typeof n.minX&&(t=Math.max(n.minX+s,t)),"number"==typeof n.maxX&&(t=Math.min(n.maxX+s,t)),"number"==typeof n.minY&&(r=Math.max(n.minY+o,r)),"number"==typeof n.maxY&&(r=Math.min(n.maxY+o,r)),{constrainedX:t,constrainedY:r}}updateTranslateProxy(e,t){const r=this,{mode:n,lockX:i,lockY:s}=r,o=r.context,a=o.dragProxy||o.element,{relatedElements:l,relatedElDragFromPos:c}=o;o.scrollManagerElementContainsDragProxy&&t&&(o.scrollX=t.scrollRelativeLeft,o.scrollY=t.scrollRelativeTop),o.pageX=e.pageX,o.pageY=e.pageY,o.clientX=e.clientX,o.clientY=e.clientY;const d=o.elementStartX+e.pageX-o.startPageX+o.scrollX,u=o.elementStartY+e.pageY-o.startPageY+o.scrollY,{constrainedX:h,constrainedY:g}=r.applyConstraints(a,d,u);if("translateXY"!==n||i||s?"translateX"===n||s?DomHelper.setTranslateX(a,h):("translateY"===n||i)&&DomHelper.setTranslateY(a,g):DomHelper.setTranslateXY(a,h,g),l){const e=i||"translateY"===n?0:h-o.elementStartX,t=s||"translateX"===n?0:g-o.elementStartY;l.forEach(((r,n)=>{const[i,s]=c[n];DomHelper.setTranslateXY(r,i+e,s+t)}))}o.newX=h,o.newY=g}finishTranslateDrag(e){const t=this,r=t.context,n=r.newX!==r.elementStartX,i=r.newY!==r.elementStartY,s=r.dragProxy||r.element,{relatedElements:o}=r;function a(){s.classList.remove(t.invalidCls),s.classList.remove(t.draggingCls),o&&o.forEach((e=>{e.classList.remove(t.invalidCls),e.classList.remove(t.draggingCls)})),s.classList.contains("b-aborting")||(t.hideOriginalElement&&r.grabbed.classList.remove("b-hidden"),r.grabbed.classList.remove("b-drag-original"))}if(!t.ignoreSamePositionDrop||"translateY"!==t.mode&&n||"translateX"!==t.mode&&i){if(!1===r.valid)t.abortTranslateDrag(!0,e);else{const n=Rectangle.from(t.dragWithin||t.outerElement);!t.minX&&e.pageX<n.left||!t.maxX&&e.pageX>n.right||!t.minY&&e.pageY<n.top||!t.maxY&&e.pageY>n.bottom?(r.valid=!1,t.abortTranslateDrag(!0,e)):(r.finalize=(e=r.valid)=>{r.asyncCleanup&&a(),!e&&t.context?t.abortTranslateDrag(!0,null,!0):(t.cloneTarget||r.dragProxy)&&s.remove(),t.reset()},r.async=!1,t.trigger("drop",{context:r,event:e}),r.async?r.awaitingFinalization=!0:r.finalize())}r.asyncCleanup||a()}else t.abortTranslateDrag(!1,e)}abortTranslateDrag(e=!1,t=null,r=!1){const n=this,i=n.context,{relatedElements:s,relatedElStartPos:o,grabbed:a}=i,l=i.dragProxy||i.element,c=n.cloneTarget&&n.hideOriginalElement?a:l;let{elementStartX:d,elementStartY:u}=i;l&&i.started&&(!n.cloneTarget&&n.dragWithin&&n.dragWithin!==i.grabbedParent&&i.grabbedParent.insertBefore(l,i.grabbedNextSibling),a.classList.remove("b-hidden"),n.cloneTarget&&(n.hideOriginalElement&&([d,u]=DomHelper.getTranslateXY(a),DomHelper.alignTo(a,l),c.getBoundingClientRect()),l.remove()),c.classList.add("b-aborting"),"translateXY"!==n.mode||n.lockX||n.lockY||(DomHelper.setTranslateXY(c,d,u),s&&s.forEach(((e,t)=>{e.classList.add("b-aborting"),DomHelper.setTranslateXY(e,o[t][0],o[t][1])}))),("translateX"===n.mode||n.lockY)&&(DomHelper.setTranslateX(c,d),s&&s.forEach(((e,t)=>{e.classList.add("b-aborting"),DomHelper.setTranslateX(e,o[t][0])}))),("translateY"===n.mode||n.lockX)&&(DomHelper.setTranslateY(c,u),s&&s.forEach(((e,t)=>{e.classList.add("b-aborting"),DomHelper.setTranslateY(e,o[t][1])}))),n.setTimeout((()=>{c.classList.remove("b-aborting"),a.classList.remove("b-dragging"),a.classList.remove("b-drag-original"),n.cloneTarget||(s&&s.forEach(((e,t)=>{e.classList.remove("b-aborting")})),l.classList.remove("b-aborting"),l.classList.remove(n.draggingCls),l.classList.remove(n.invalidCls))}),n.transitionDuration,void 0,!0),r||n.trigger(e?"drop":"abort",{context:i,event:t})),n.reset()}};class Point extends Rectangle{static from(e){const t=e.changedTouches;return new Point(t?t[0].screenX:e.screenX,t?t[0].screenY:e.pageY)}constructor(e,t){super(e,t,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}}Object.getPrototypeOf(Point).Point=Point,Point._$name="Point";const touchProperties=["clientX","clientY","pageX","pageY","screenX","screenY"],isOption={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1},ctrlKeyProp={get:()=>!0},normalizedKeyNames={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"};function getAccessorFromPrototype(e,t){let r,n;for(;(e=Object.getPrototypeOf(e))&&!n;)r=Object.getOwnPropertyDescriptor(e,t),n=r&&r.get;return n}class EventHelper{static normalizeEvent(e){return ObjectHelper.copyPropertiesIf(e,e.changedTouches[0]||e.touches[0],touchProperties)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,t){const r=EH.getXY(e),n=EH.getXY(t);return Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2))}static getPagePoint(e){return new Rectangle.Point(e.pageX,e.pageY)}static getClientPoint(e){return new Rectangle.Point(e.clientX,e.clientY)}static addListener(e,t,r,n){return n=e.nodeType?"string"==typeof t?Object.assign({element:e,[t]:r},n):Object.assign({element:e},t):e,EH.on(n)}static on(e){const t=e.element,r=e.thisObj,n=[];for(const i in e)if(!isOption[i]){let s=e[i];"object"!=typeof s&&(s={handler:s});const o=s.element||t;BrowserHelper.isTouchDevice&&!BrowserHelper.isAndroid&&"contextmenu"===i&&n.push(EH.addElementListener(o,"touchstart",{handler:EH.createContextMenuWrapper(s.handler,s.thisObj||r)},e)),n.push(EH.addElementListener(o,i,s,e))}const i=()=>{for(let e,t=0;t<n.length;t++)e=n[t],EH.removeEventListener(e[0],e[1],e[2]);n.length=0};return r&&!1!==e.autoDetach&&(r.doDestroy=FunctionHelper.createInterceptor(r.doDestroy,i,r)),i}static addElementListener(e,t,r,n){const i=EH.createHandler(e,t,r,n),s="passive"in r,o=r.expires||n.expires;let a=r.capture||n.capture;if((s||"passive"in n)&&BrowserHelper.supportsPassive&&(a={capture:!!a,passive:s?r.passive:n.passive}),e.addEventListener(t,i,a),o){const s=r.thisObj||n.thisObj,a=(null==s?void 0:s.isDelayable)?s:window,{alt:l}=o,c=l?o.delay:o,{spec:d}=i;d.expires=o,d.timerId=a["number"==typeof c?"setTimeout":"requestAnimationFrame"]((()=>{d.timerId=null,EH.removeEventListener(e,t,i),l&&!i.called&&("string"==typeof l?s[l]:l).call(s)}),c,"listener-timer-"+performance.now())}return[e,t,i,a]}static fixEvent(e){var t,r,n,i;const{type:s}=e;if(s.startsWith("key")){const t=normalizedKeyNames[e.key];t&&Object.defineProperty(e,"key",{get:()=>t})," "!==e.key||e.code||Object.defineProperty(e,"code",{get:()=>"Space"})}if(e.metaKey&&!e.ctrlKey&&Object.defineProperty(e,"ctrlKey",ctrlKeyProp),(null===(t=e.target)||void 0===t?void 0:t.shadowRoot)&&e.composedPath&&!BrowserHelper.isIE11&&!BrowserHelper.isEdge){const t=e.composedPath()[0],r=e.target;e.target!==t&&(Object.defineProperty(e,"target",{get:()=>t,configurable:!0}),Object.defineProperty(e,"originalTarget",{get:()=>r,configurable:!0}))}if(BrowserHelper.isChrome&&e.target&&"offsetX"in e&&(Object.getOwnPropertyDescriptor(e,"offsetX")||Object.defineProperty(e,"offsetX",{get:()=>{const t=getAccessorFromPrototype(e,"offsetX").call(e),{target:r}=e,{offsetWidth:n}=r,i=Math.min(Math.max(t,0),n-1);return t<0||t>=n?i:t}}),Object.getOwnPropertyDescriptor(e,"offsetY")||Object.defineProperty(e,"offsetY",{get:()=>{const t=getAccessorFromPrototype(e,"offsetY").call(e),{target:r}=e,{offsetHeight:n}=r,i=Math.min(Math.max(t,0),n-1);return t<0||t>=n?i:t}})),9===(null===(r=e.target)||void 0===r?void 0:r.nodeType)&&"clientX"in e){const t=DomHelper.elementFromPoint(e.clientX,e.clientY);Object.defineProperty(e,"target",{get:()=>t})}if(3===(null===(n=e.target)||void 0===n?void 0:n.nodeType)){const t=e.target.parentElement;Object.defineProperty(e,"target",{get:()=>t})}if(3===(null===(i=e.relatedTarget)||void 0===i?void 0:i.nodeType)){const t=e.target.parentElement;Object.defineProperty(e,"relatedTarget",{get:()=>t})}return s.startsWith("touch")&&e.touches.length&&this.normalizeEvent(e),e}static createHandler(e,t,r,n){const i=r.delay||n.delay,s=r.throttled||n.throttled,o=r.block||n.block,a=r.once||n.once,l=r.thisObj||n.thisObj,c=r.capture||n.capture,d=r.delegate||n.delegate,u=r.handler;let h=(e,...t)=>{if(h.called=!0,!(EH.playingDemo&&e.isTrusted||l&&l.isDestroyed)){if(e=EH.fixEvent(e),d){const t=e.target instanceof HTMLElement&&e.target.closest(d);if(!t)return;Object.defineProperty(e,"currentTarget",{get:()=>t,configurable:!0})}("string"==typeof u?l[u]:u).call(l,e,...t)}};if(o){const e=h;let t,r;h=(n,...i)=>{const s=performance.now();(!t||n.target!==r||s-t>o)&&(r=n.target,t=s,e(n,...i))}}if(null!=i){const e=h,t=l&&l.setTimeout?l:window;h=(...r)=>{t.setTimeout((()=>{e(...r)}),i)}}if(null!=s){let e,t=s;s.buffer&&(e=e=>s.alt.call(EH,EH.fixEvent(e)),t=s.buffer),h=l&&l.isDelayable?l.throttle(h,{delay:t,throttled:e}):FunctionHelper.createThrottled(h,t,l,null,e)}if(a){const r=h;h=(...n)=>{EH.removeEventListener(e,t,h),r(...n)}}return r.thisObj&&!1!==r.autoDetach&&(l.doDestroy=FunctionHelper.createInterceptor(l.doDestroy,(()=>EH.removeEventListener(e,t,h)),l)),h.spec={delay:i,throttled:s,block:o,once:a,thisObj:l,capture:c,delegate:d},h}static removeEventListener(e,t,r){const{expires:n,timerId:i,thisObj:s,capture:o}=r.spec;if((null==n?void 0:n.alt)&&i){((null==s?void 0:s.isDelayable)?s:window)["number"==typeof n.delay?"clearTimeout":"cancelAnimationFrame"](i)}e.removeEventListener(t,r,o)}static onTransitionEnd({element:e,property:t,handler:r,duration:n=DomHelper.getPropertyTransitionDuration(e,t),thisObj:i=window}){let s;const o=i.isDelayable?i:window,a=()=>{l(),i.isDestroyed||(i.callback?i.callback(r,i):r.call(i))},l=EH.on({element:e,transitionend({propertyName:r,target:n}){r===t&&n===e&&(s&&(o.clearTimeout(s),s=null),a())}});return null!=n&&(s=o.setTimeout(a,n+20)),l}static createContextMenuWrapper(e,t){return r=>{if(1===r.touches.length){const n=r.touches[0],i=setTimeout((()=>{o();const i=new MouseEvent("contextmenu",n);Object.defineProperty(i,"target",{get:()=>n.target}),"string"==typeof e&&(e=t[e]),i.browserEvent=r,e.call(t,i),EH.contextMenuTouchId=n.identifier}),EH.longPressTime),s=()=>{EH.contextMenuTouchId=null,o(),clearTimeout(i)},o=EH.on({element:document,touchmove:s,touchend:s,pointermove:s,pointerup:s,capture:!0})}}}static createDblClickWrapper(e,t,r){let n,i,s;return()=>{i||(i=EH.on({element:e,touchstart:e=>{n=e.changedTouches[0].identifier,e.preventDefault()},touchend:e=>{if(e.changedTouches[0].identifier===n){e.preventDefault(),clearTimeout(s),n=i=null;const o=Rectangle.from(e.changedTouches[0].target,null,!0),a=e.changedTouches[0].pageX-o.x,l=e.changedTouches[0].pageY-o.y,c=Object.assign({browserEvent:e},e),d=new MouseEvent("dblclick",c);Object.defineProperty(d,"target",{get:()=>e.target}),Object.defineProperty(d,"offsetX",{get:()=>a}),Object.defineProperty(d,"offsetY",{get:()=>l}),"string"==typeof t&&(t=r[t]),t.call(r,d)}},once:!0}),s=setTimeout((()=>{i(),n=i=null}),EH.dblClickTime))}}static lockComposedPath(e){var t;e.composedPath&&(e.composedPath=(t=e.composedPath(),()=>t))}}const EH=EventHelper;EH.longPressTime=500,EH.dblClickTime=300,EH.on({element:document,mousedown(){DomHelper.isTouchEvent||(DomHelper.usingKeyboard=!1,document.body.classList.remove("b-using-keyboard"))},touchmove(){DomHelper.usingKeyboard=!1,document.body.classList.remove("b-using-keyboard")},keydown(){DomHelper.usingKeyboard=!0,document.body.classList.add("b-using-keyboard")}}),BrowserHelper.isTouchDevice&&EH.on({element:document,touchmove:e=>{e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0}),setupFocusListeners(document,EventHelper),EventHelper._$name="EventHelper";const documentListeners={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class DragHelper extends(Base.mixin(Events,DragHelperContainer,DragHelperTranslate)){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:null,isElementDraggable:null,targetSelector:null,dropTargetSelector:null,cloneTarget:!1,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,transitionDuration:300,clickSwallowDuration:50,ignoreSamePositionDrop:!0,testConfig:{transitionDuration:10,clickSwallowDuration:BrowserHelper.isEdge?300:50}}}construct(e){const t=this;super.construct(e),t.initListeners(),"container"===t.mode?t.initContainerDrag():t.mode.startsWith("translate")&&t.initTranslateDrag(),t.initialMode=t.mode}doDestroy(){this.abort(!0),super.doDestroy()}get listenersTarget(){return document}initListeners(){const e={element:this.outerElement,mousedown:documentListeners.down,thisObj:this};BrowserHelper.isTouchDevice&&(e.touchstart=documentListeners.touchstart),EventHelper.on(e)}onPointerDown(e){let t=this,r=!1,n="touches"in e;if(t.context)t.context.awaitingFinalization||(t.onMouseUp(e),t.reset());else if(t.startEvent=e,(!t.isElementDraggable||t.isElementDraggable(e.target,e))&&(t.mode&&(r||"container"!==t.mode||(r=t.grabContainerDrag(e)),!r&&t.mode.startsWith("translate")&&(r=t.grabTranslateDrag(e))),r)){const e={element:t.listenersTarget,thisObj:t,keydown:documentListeners.keydown};if(n?(e.touchmove={handler:documentListeners.touchmove,passive:!1},e.touchend=e.pointerup=documentListeners.touchend):(e.mousemove=documentListeners.move,e.mouseup=documentListeners.up),t.removeListeners=EventHelper.on(e),t.dragWithin&&t.dragWithin!==t.outerElement){const e=t.dragWithin.getBoundingClientRect();t.minY=e.top,t.maxY=e.bottom,t.minX=e.left,t.maxX=e.right}}}onTouchStart(e){const t=this;1===e.touches.length&&(t.touchStartTimer=t.setTimeout((()=>{t.touchStartTimer=null}),t.touchStartDelay,"touchStartDelay"),t.onPointerDown(e))}onMouseDown(e){0===e.button&&this.onPointerDown(e)}internalMove(e){const t=this,r=t.context,n=EventHelper.getDistanceBetween(t.startEvent,e);if(t.touchStartTimer&&n>t.dragThreshold)t.abort(!0);else if(!t.touchStartTimer&&r&&r.element&&e.target&&e.target.nodeType===Node.ELEMENT_NODE&&(r.started||n>=t.dragThreshold)){if(!r.started&&!1===t.callPreventable("dragStart",{context:r,event:e},(()=>{"container"!==t.mode&&(t.lockY?t.mode="translateX":t.lockX?t.mode="translateY":t.mode=t.initialMode);const n=t.lockX?"vertical":t.lockY?"horizontal":"both";r.action.startsWith("translate")?t.startTranslateDrag(e):"container"===r.action&&t.startContainerDrag(e),r.started=!0,t.scrollManager&&t.scrollManager.startMonitoring({direction:n,element:t.dragWithin||t.outerElement,callback:e=>{t.context.element&&t.lastMouseMoveEvent&&(t.lastMouseMoveEvent.isScroll=!0,t.update(t.lastMouseMoveEvent,e))},thisObj:t}),document.body.classList.add("b-draghelper-active")})))return t.abort();"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.update(e)}}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,t){const r=this,n=r.context,i=n.dragProxy||n.element;let s=e.target,o=document.scrollingElement||document.body;if("touchmove"===e.type){const t=e.changedTouches[0];s=DomHelper.elementFromPoint(t.clientX+o.scrollLeft,t.clientY+o.scrollTop)}n.target=s,r.dropTargetSelector?n.valid=Boolean(s.closest(r.dropTargetSelector)):n.valid=!0,n.action&&("container"===n.action&&r.updateContainerProxy(e,t),n.action.startsWith("translate")&&r.updateTranslateProxy(e,t)),r.trigger("drag",{context:n,event:e}),"container"===n.action&&r.updateContainerDrag(e,t),i.classList[n.valid?"remove":"add"](r.invalidCls),e&&(r.lastMouseMoveEvent=e)}abort(e=!1){const t=this,r=t.context;t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),r&&(r.element.getBoundingClientRect(),r.valid=!1,"container"===r.action?t.abortContainerDrag(void 0,void 0,e):t.abortTranslateDrag(void 0,void 0,e)),t.reset()}removeListeners(){}reset(e){document.body.classList.remove("b-draghelper-active"),this.removeListeners(),e||this.trigger("reset"),this.context=this.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,r=t.context;t.removeListeners(),r&&(t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),"container"===r.action?t.finishContainerDrag(e):r.started&&r.action.startsWith("translate")&&t.finishTranslateDrag(e),r.started?EventHelper.on({element:document,thisObj:t,click:documentListeners.docclick,capture:!0,expires:t.clickSwallowDuration,once:!0}):t.reset(!0))}onKeyDown(e){"Escape"===e.key&&this.abort()}createProxy(e){const t=e.cloneNode(!0);return t.removeAttribute("id"),t}}DragHelper._$name="DragHelper";const documentListeners$1={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class ResizeHelper extends(Events(Base)){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50}}construct(e){const t=this;super.construct(e),!t.handleSelector&&BrowserHelper.isTouchDevice&&(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=t=>DomHelper.up(t,e.targetSelector)),e.grab){const{edge:t,element:r,event:n}=e.grab;e.startEvent=n;const i=e.getCursorOffsetToElementEdge(n,r,t);e.context={element:r,edge:t,valid:!0,async:!1,elementStartX:DomHelper.getTranslateX(r)||r.offsetLeft,elementStartY:DomHelper.getTranslateY(r)||r.offsetTop,newX:DomHelper.getTranslateX(r)||r.offsetLeft,newY:DomHelper.getTranslateY(r)||r.offsetTop,elementWidth:r.offsetWidth,elementHeight:r.offsetHeight,cursorOffset:i,startX:n.clientX+i.x+e.scrollLeft,startY:n.clientY+i.y+e.scrollTop,finalize:()=>{var t;return null===(t=e.reset)||void 0===t?void 0:t.call(e)}},r.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:documentListeners$1.down,thisObj:e};BrowserHelper.isTouchDevice?t.touchstart=documentListeners$1.touchstart:e.handleSelector||(t.mousemove={handler:documentListeners$1.move,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),e.removeListeners=EventHelper.on(t)}removeListeners(){}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const t={element:document,keydown:documentListeners$1.keydown,thisObj:this};e?(t.touchmove=documentListeners$1.touchmove,t.touchend=t.pointerup=documentListeners$1.touchend):(t.mousemove=documentListeners$1.move,t.mouseup=documentListeners$1.up),this.removeDragListeners=EventHelper.on(t)}removeDragListeners(){}reset(){var e;null===(e=this.removeDragListeners)||void 0===e||e.call(this),this.context=null}onPointerDown(e,t){const r=this;r.startEvent=t,r.isElementResizable&&!r.isElementResizable(t.target,t)||r.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),r.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){0===e.button&&this.onPointerDown(!1,e)}internalMove(e,t){const r=this,n=r.context;n&&n.element&&(n.started||EventHelper.getDistanceBetween(r.startEvent,t)>=r.dragThreshold)?(n.started||(r.scrollManager&&r.scrollManager.startMonitoring({direction:r.direction,element:r.dragWithin||r.outerElement,callback:e=>r.context&&r.context.element&&r.lastMouseMoveEvent&&r.update(r.lastMouseMoveEvent,e),thisObj:r}),r.trigger("resizeStart",{context:n,event:t}),n.started=!0),r.update(t)):e||r.handleSelector||r.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,t){var r;const n=this,i=n.context;if(null===(r=n.removeDragListeners)||void 0===r||r.call(n),i)n.scrollManager&&n.scrollManager.stopMonitoring(n.dragWithin||n.outerElement),i.started&&EventHelper.on({element:document,thisObj:n,click:documentListeners$1.docclick,expires:n.clickSwallowDuration,capture:!0,once:!0}),n.finishResize(t);else if(!i.async){var s;null===(s=n.reset)||void 0===s||s.call(n)}}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){"Escape"===e.key&&this.abort()}update(e){const t=this,r=t.context,n=Rectangle.from(t.outerElement);r.currentX=Math.max(Math.min(e.clientX+r.cursorOffset.x,n.right),n.x)+t.scrollLeft,r.currentY=Math.max(Math.min(e.clientY+r.cursorOffset.y,n.bottom),n.y)+t.scrollTop,t.updateResize(e),t.trigger("resizing",{context:r,event:e}),r.element.classList[!1===r.valid?"add":"remove"](t.invalidCls),e&&(t.lastMouseMoveEvent=e)}abort(e=!1){const t=this;t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),t.context?t.abortResize(null,e):t.isDestroyed||t.reset()}grabResizeHandle(e,t){const r=this;if(r.allowResize&&!r.allowResize(t.target,t))return!1;const n=r.handleSelector,i="touchstart"===t.type?t.changedTouches[0]:t,s=i.clientX,o=i.clientY,a=r.targetSelector?DomHelper.up(t.target,r.targetSelector):t.target;if(a){let l;if(n){if(!t.target.matches(n))return!1;l="horizontal"===r.direction?t.pageX<DomHelper.getPageX(a)+a.offsetWidth/2?"left":"right":t.pageY<DomHelper.getPageY(a)+a.offsetHeight/2?"top":"bottom"}else if("horizontal"===r.direction?r.overLeftHandle(t,a)?l="left":r.overRightHandle(t,a)&&(l="right"):r.overTopHandle(t,a)?l="top":r.overBottomHandle(t,a)&&(l="bottom"),!l)return r.context=null,!1;"touchstart"===t.type&&t.preventDefault();const c=r.getCursorOffsetToElementEdge(i,a,l);if(!1!==r.trigger("beforeResizeStart",{element:a,event:t}))return r.context={element:a,edge:l,valid:!0,async:!1,direction:r.direction,isTouch:e,elementStartX:DomHelper.getTranslateX(a)||a.offsetLeft,elementStartY:DomHelper.getTranslateY(a)||a.offsetTop,newX:DomHelper.getTranslateX(a)||a.offsetLeft,newY:DomHelper.getTranslateY(a)||a.offsetTop,elementWidth:a.offsetWidth,elementHeight:a.offsetHeight,cursorOffset:c,startX:s+c.x+r.scrollLeft,startY:o+c.y+r.scrollTop,finalize:()=>{var e;return null===(e=r.reset)||void 0===e?void 0:e.call(r)}},a.classList.add(r.resizingCls),!0}return!1}getCursorOffsetToElementEdge(e,t,r){const n=Rectangle.from(t);let i=0,s=0;switch(r){case"left":i=n.x-e.clientX;break;case"right":i=n.x+n.width-e.clientX;break;case"top":s=n.y-e.clientY;break;case"bottom":s=n.y+n.height-e.clientY}return{x:i,y:s}}checkResizeHandles(e){const t=this,r=t.targetSelector?DomHelper.up(e.target,t.targetSelector):e.target;if(!r||t.allowResize&&!t.allowResize(e.target,e))t.currentElement&&t.unHighlightHandle();else if(t.currentElement=t.handleContainerSelector?DomHelper.up(e.target,t.handleContainerSelector):e.target,t.currentElement){let n=!1;n="horizontal"===t.direction?t.overLeftHandle(e,r)||t.overRightHandle(e,r):t.overTopHandle(e,r)||t.overBottomHandle(e,r),n?t.highlightHandle():t.unHighlightHandle()}}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?DomHelper.up(e.target,t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const t=this,r=t.context;t.allowEdgeSwitch&&("horizontal"===t.direction?r.edge=r.currentX>r.startX?"right":"left":r.edge=r.currentY>r.startY?"bottom":"top");const n=r.currentX-r.startX,i=r.currentY-r.startY,s=DomHelper.getExtremalSizePX(r.element,"minWidth")||t.minWidth,o=DomHelper.getExtremalSizePX(r.element,"maxWidth")||t.maxWidth,a=DomHelper.getExtremalSizePX(r.element,"minHeight")||t.minHeight,l=DomHelper.getExtremalSizePX(r.element,"maxHeight")||t.maxHeight,c="right"===r.edge||"bottom"===r.edge?1:-1,d=r.elementWidth+n*c,u=r.elementHeight+i*c;let h=Math.max(s,d),g=Math.max(a,u);o>0&&(h=Math.min(h,o)),l>0&&(g=Math.min(g,l)),r.element.style.flex&&(r.element.style.flex=""),"horizontal"===t.direction?(r.element.style.width=Math.abs(h)+"px",r.newWidth=h,"left"===r.edge||h<0?(r.newX=Math.max(Math.min(r.elementStartX+r.elementWidth-t.minWidth,r.elementStartX+n),0),t.skipTranslate||DomHelper.setTranslateX(r.element,r.newX)):"right"===r.edge&&t.allowEdgeSwitch&&!t.skipTranslate&&DomHelper.setTranslateX(r.element,r.elementStartX)):(r.element.style.height=Math.abs(g)+"px",r.newHeight=g,"top"===r.edge||g<0?(r.newY=Math.max(Math.min(r.elementStartY+r.elementHeight-t.minHeight,r.elementStartY+i),0),t.skipTranslate||DomHelper.setTranslateY(r.element,r.newY)):"bottom"===r.edge&&t.allowEdgeSwitch&&!t.skipTranslate&&DomHelper.setTranslateY(r.element,r.elementStartY))}finishResize(e){const t=this,r=t.context,n={context:r,event:e};if(r.element.classList.remove(t.resizingCls),r.started){let e=!1;e="horizontal"===t.direction?r.newWidth&&r.newWidth!==r.elementWidth:r.newHeight&&r.newHeight!==r.elementHeight,t.trigger(e?"resize":"cancel",n),r.async||r.finalize()}else{var i;null===(i=t.reset)||void 0===i||i.call(t)}}abortResize(e=null,t=!1){const r=this,n=r.context;n.element.classList.remove(r.resizingCls),"horizontal"===r.direction?(DomHelper.setTranslateX(n.element,n.elementStartX),n.element.style.width=n.elementWidth+"px"):(DomHelper.setTranslateY(n.element,n.elementStartY),n.element.style.height=n.elementHeight+"px"),!t&&r.trigger("cancel",{context:n,event:e}),r.isDestroyed||r.reset()}highlightHandle(){const e=this,t=e.targetSelector?DomHelper.up(e.currentElement,e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?DomHelper.up(e.currentElement,e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return"horizontal"===this.direction?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return"horizontal"===this.direction?this.overRightHandle(e,t):this.overBottomHandle(e,t)}getDynamicHandleSize(e,t){const r=e?2:1,{handleSize:n}=this;return this.dynamicHandleSize&&n*r>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/r),0):n}overLeftHandle(e,t){const r=this,{offsetWidth:n}=t;if(r.leftHandle&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const i=Rectangle.from(t);return i.width=r.getDynamicHandleSize(r.rightHandle,n),i.width>0&&i.contains(EventHelper.getPagePoint(e))}return!1}overRightHandle(e,t){const r=this,{offsetWidth:n}=t;if(r.rightHandle&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const i=Rectangle.from(t);return i.x=i.right-r.getDynamicHandleSize(r.leftHandle,n),i.width>0&&i.contains(EventHelper.getPagePoint(e))}return!1}overTopHandle(e,t){const r=this,{offsetHeight:n}=t;if(r.topHandle&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const i=Rectangle.from(t);return i.height=r.getDynamicHandleSize(r.bottomHandle,n),i.height>0&&i.contains(EventHelper.getPagePoint(e))}return!1}overBottomHandle(e,t){const r=this,{offsetHeight:n}=t;if(r.bottomHandle&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const i=Rectangle.from(t);return i.y=i.bottom-r.getDynamicHandleSize(r.bottomHandle,n),i.height>0&&i.contains(EventHelper.getPagePoint(e))}return!1}}ResizeHelper._$name="ResizeHelper";let resizeFireTimer=null;const resizedQueue=[],isAbsolutelyPositioned=e=>{var t;return 1===e.nodeType&&"absolute"===(null===(t=e.ownerDocument.defaultView)||void 0===t?void 0:t.getComputedStyle(e).getPropertyValue("position"))};class ResizeMonitor{static addResizeListener(e,t){const r=this;if(e!==document&&e!==window||(e=document.body),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)r.hasWindowResizeListener||(window.addEventListener("resize",r.onWindowResize),r.hasWindowResizeListener=!0);else if(window.ResizeObserver)r.resizeObserver||(r.resizeObserver=new ResizeObserver(r.onElementResize)),r.resizeObserver.observe(e);else{e.classList.add("b-no-resizeobserver");const[n,i,s]=DomHelper.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},!0);i.scrollLeft=i.scrollTop=s.scrollLeft=s.scrollTop=1e6,i.addEventListener("scroll",r.onSizeMonitorScroll,!0),s.addEventListener("scroll",r.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver((e=>{const t=[];for(const r of e)"childList"===r.type&&(t.push.apply(t,r.removedNodes),t.push.apply(t,r.addedNodes));t.length>0&&t.every(isAbsolutelyPositioned)||(!BrowserHelper.isEdge&&!BrowserHelper.isIE11||i.classList.contains("b-resize-monitor-expand"))&&i.dispatchEvent(new CustomEvent("scroll",{bubbles:!1}))}))).observe(e,{childList:!0,subtree:!0}),t.monitorElement=n}e._bResizemonitor.handlers.push(t)}static removeResizeListener(e,t){if(e){e!==document&&e!==window||(e=document.body);const r=e._bResizemonitor;let n=0;r&&r.handlers&&(ArrayHelper.remove(r.handlers,t),n=r.handlers.length),n||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(const t of e){const e=t.target,r=e._bResizemonitor,n=t.contentRect||e.getBoundingClientRect();if(e.offsetParent&&(!r.rectangle||n.width!==r.rectangle.width||n.height!==r.rectangle.height)){const t=r.rectangle;r.rectangle=n;for(const i of r.handlers)i(e,t,n)}}}static onSizeMonitorScroll(e){var t;if(null===(t=document.body)||void 0===t?void 0:t.contains(e.target)){e.stopImmediatePropagation();const t=e.target.parentNode,r=t.parentNode,n=r._bResizemonitor,i=r.getBoundingClientRect();n.rectangle&&i.width===n.rectangle.width&&i.height===n.rectangle.height||(resizedQueue.push([r,n.rectangle,i]),n.rectangle=i,resizeFireTimer||(resizeFireTimer=requestAnimationFrame(ResizeMonitor.fireResizeEvents))),t.firstChild.scrollLeft=t.firstChild.scrollTop=t.childNodes[1].scrollTop=t.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){const t=document.body,r=t._bResizemonitor,n=r.rectangle;r.rectangle=document.documentElement.getBoundingClientRect();for(const e of r.handlers)e(t,n,r.rectangle)}static fireResizeEvents(){for(const e of resizedQueue)for(const t of e[0]._bResizemonitor.handlers)e[0].offsetParent&&t.apply(this,e);resizeFireTimer=null,resizedQueue.length=0}}ResizeMonitor._$name="ResizeMonitor";const tagSpaceRe=/>[ \t\r\n]+</g,multiSpaceRe=/\s\s+/g;class TemplateHelper{static tpl(e,...t){let r=0,n=t.map(((t,n)=>{let i=e[n];return Array.isArray(t)?i+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(void 0===t&&(t=""),i+="string"==typeof t?t.trim():t),r++,i})).join("");return r<=e.length&&(n+=e[e.length-1]),n.replace(tagSpaceRe,"><").replace(multiSpaceRe," ").trim()}static docsTpl(e,...t){let r=0,n=t.map(((t,n)=>{let i=e[n];return Array.isArray(t)?i+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(void 0===t&&(t=""),i+="string"==typeof t?t.trim():t),r++,i})).join("");return r<=e.length&&(n+=e[e.length-1]),n.replace(tagSpaceRe,"><").trim()}static repeat(e){return function(...t){return TemplateHelper.tpl(...t).repeat(e)}}static loop(e){}}TemplateHelper._$name="TemplateHelper";const scrollLiterals={true:"auto",false:"hidden","hidden-scroll":"auto"},scrollerCls="b-widget-scroller",defaultScrollOptions={block:"nearest"},immediatePromise$2=Promise.resolve(),scrollPromise=e=>new Promise((t=>EventHelper.on({element:e,scroll:t,once:!0}))),xAxis={x:1};class Scroller extends(Delayable(Events(Base))){static get configurable(){return{widget:null,element:null,overflowX:null,overflowY:null,translate:null,x:0,y:0,scrollEndBuffer:100}}syncOverflowState(){const{element:e}=this,{classList:t}=e;BrowserHelper.isEdge?t[e.scrollWidth-e.clientWidth>1?"add":"remove"]("b-horizontal-overflow"):t[e.scrollWidth>e.clientWidth?"add":"remove"]("b-horizontal-overflow"),t[e.scrollHeight>e.clientHeight?"add":"remove"]("b-vertical-overflow")}hasScrollbar(e="y"){const{element:t}=this;if(t&&DomHelper.scrollBarWidth){const r="y"===e,n=r?"Width":"Height",i=t["client"+n],s=parseInt(DomHelper.getStyleValue(t,`border${r?"Left":"Top"}Width`))+parseInt(DomHelper.getStyleValue(t,`border${r?"Right":"Bottom"}Width`)),o=t["offset"+n]-s-i;return Math.abs(o-DomHelper.scrollBarWidth)<2}}addPartner(e,t=xAxis){"string"==typeof t&&(t={[t]:1}),(this.partners||(this.partners=new Collection)).add({id:e.id,scroller:e,axes:t}),e.partners&&e.partners.includes(this.id)||e.addPartner(this,t)}removePartner(e){this.partners&&this.partners.includes(e)&&(this.partners.remove(e),e.removePartner(this))}scrollIntoView(e,t=defaultScrollOptions){const r=this,n=e instanceof Rectangle,i=n?e:Rectangle.from(e),{xDelta:s,yDelta:o}=r.getDeltaTo(e,t),a=r.scrollBy(s,o,t);return(t.highlight||t.focus)&&a.then((()=>{n&&(e=i.translate(-s,-o)),t.highlight&&(isNaN(t.highlight)?(r.widget||r).callback(t.highlight,null,[e]):DomHelper.highlight(e,r)),t.focus&&e.focus()})),a}scrollBy(e=0,t=0,r=defaultScrollOptions){const n=this,i="object"==typeof r?r.animate:r,s=Math.abs(e),o=Math.abs(t);n.scrollAnimation&&(n.scrollAnimation.cancel(),n.scrollAnimation=null),(e||t)&&(n.silent=r.silent);let a=i&&("number"==typeof i?i:"number"==typeof i.duration?i.duration:300);if(a&&(s>10||o>10)){const{x:l,y:c}=n;let d=l,u=c;return Math.max(s,o)<50&&(a=Math.min(a,500)),n.scrollAnimation=FunctionHelper.animate(a,(i=>{const s=1===i;if(e){if(n.x!==d&&!r.force)return n.scrollAnimation&&n.scrollAnimation.cancel();n.x=Math.max(l+(s?e:Math.round(e*i)),0)}if(t){if(n.y!==u&&!r.force)return n.scrollAnimation&&n.scrollAnimation.cancel();n.y=Math.max(c+(s?t:Math.round(t*i)),0)}d=n.x,u=n.y}),n,i.easing),n.element.classList.add("b-scrolling"),n.scrollAnimation.then((()=>{n.isDestroyed||(n.element.classList.remove("b-scrolling"),n.scrollAnimation=null)})),n.scrollAnimation}return e|t?(n.x+=e,n.y+=t,l=n.element,new Promise((e=>EventHelper.on({element:l,scroll:e,once:!0})))):immediatePromise$2;var l}scrollTo(e,t,r){const{x:n,y:i}=this,s=null==e?0:e-n,o=null==t?0:t-i;return this.scrollBy(s,o,r)}doDestroy(){const e=this;e._element&&(e._element.removeEventListener("scroll",e.scrollHandler),e.wheelListenerRemover&&e.wheelListenerRemover()),e.scrollAnimation&&e.scrollAnimation.cancel(),e.partners&&e.partners.forEach((t=>t.scroller.removePartner(e))),super.doDestroy()}onElMutation(e){const t=this,[r,n]=DomHelper.getTranslateXY(t.element);if(t._x!==-r||t.y!==-n){const e=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(e,"target",{get:()=>t.element}),t.onScroll(e)}}onScroll(e){const t=this;t.widget&&t.widget.isDestroyed||(t.positionDirty=!0,t.element.classList.contains("b-scrolling")||t.element.classList.add("b-scrolling"),e.widget=t.widget,t.silent||t.trigger("scroll",e),t.syncPartners(),t.controllingPartner=null,t.scrollEndHandler(e))}syncPartners(){const e=this;e.partners&&e.partners.forEach((({axes:t,scroller:r})=>{r!==e.controllingPartner&&r.sync(e,t)}))}onScrollEnd(e){this.silent&&(this.silent=!1),this.trigger("scrollEnd",e),this.controllingPartner=null,this.element.classList.remove("b-scrolling")}getDeltaTo(e,t){const r=this;if(!r.viewport)return{xDelta:0,yDelta:0};const n=e instanceof Rectangle?e:Rectangle.from(e),i=t.block||"nearest",s=r.viewport,o=t.edgeOffset||0,a=s.width>=n.width+2*o?o:0,l=s.height>=n.height+2*o?o:0,c=n.clone().adjust(-a,-l,a,l).constrainTo(new Rectangle(s.x-r.x,s.y-r.y,r.scrollWidth,r.scrollHeight)),d=c.clone();let u=0,h=0;if("start"===i)d.moveTo(s.x,s.y),u=c.x-d.x,h=c.y-d.y;else if("end"===i)d.translate(s.right-d.right,s.bottom-d.bottom),u=c.x-d.x,h=c.y-d.y;else if("center"===i){const e=s.center;d.moveTo(e.x-d.width/2,e.y-d.height/2),u=u||c.x-d.x,h=h||c.y-d.y}else d.width>s.width?u=d.x-s.x:d.right>s.right?u=d.right-s.right:d.x<s.x&&(u=d.x-s.x),d.height>s.height?h=d.y-s.y:d.bottom>s.bottom?h=d.bottom-s.bottom:d.y<s.y&&(h=d.y-s.y);return{xDelta:!1===t.x?0:Math.round(Math.max(Math.min(u,r.maxX-r.x),-r.x)),yDelta:!1===t.y?0:Math.round(Math.max(Math.min(h,r.maxY-r.y),-r.y))}}get viewport(){return Rectangle.client(this.element)}updateElement(e,t){const r=this,n=r.scrollHandler||(r.scrollHandler=r.onScroll.bind(r));if(r.scrollEndHandler||(r.scrollEndHandler=r.buffer(r.onScrollEnd,r.scrollEndBuffer)),t&&(r.translate?r.mutationObserver&&r.mutationObserver.disconnect(t):(t.removeEventListener("scroll",n),t.classList.remove(scrollerCls))),r.translate){if(r.mutationObserver||(r.mutationObserver=new MutationObserver((e=>r.onElMutation(e)))),r.mutationObserver.observe(e,{attributes:!0}),r._x=r._y=0,document.contains(e)){const[t,n]=DomHelper.getTranslateXY(e);r._x=-t,r._y=-n}}else e.addEventListener("scroll",n),e.classList.add(scrollerCls);r.positionDirty&&(r.updateOverflowX(r.overflowX),r.updateOverflowY(r.overflowY)),r.isConfiguring&&(r._x&&r.updateX(r._x),r._y&&r.updateY(r._y)),r.positionDirty=!0}get x(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[r,n]=DomHelper.getTranslateXY(t);e._x=-r,e._y=-n}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._x}changeX(e){if(!this.isConfiguring||e)return e;this._x=e}updateX(e){const{element:t,widget:r}=this;t&&!(null==r?void 0:r.isConfiguring)&&(this.trigger("scrollStart",{x:e}),this.translate?DomHelper.setTranslateX(t,-e):t.scrollLeft=e),this.positionDirty=!0}sync(e,t){const{x:r,y:n}=t;null!=r&&this.x!==e.x&&(this.controllingPartner=e,this.x=e.x),null!=n&&this.y!==e.y&&(this.controllingPartner=e,this.y=e.y)}get y(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[r,n]=DomHelper.getTranslateXY(t);e._x=-r,e._y=-n}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._y}changeY(e){if(!this.isConfiguring||e)return e;this._y=e}updateY(e){const{element:t,widget:r}=this;t&&!(null==r?void 0:r.isConfiguring)&&(this.trigger("scrollStart",{y:e}),this.translate?DomHelper.setTranslateY(t,-e):t.scrollTop=e),this.positionDirty=!0}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}updateOverflowX(e){const{element:t,translate:r}=this;t&&("hidden-scroll"!==e||r||(t.classList.add("b-hide-scroll"),this.enableWheel()),r||(t.style.overflowX=scrollLiterals[e]||e)),this.positionDirty=!this.isConfiguring}updateOverflowY(e){const{element:t,translate:r}=this;t&&("hidden-scroll"!==e||r||(t.classList.add("b-hide-scroll"),this.enableWheel()),r||(t.style.overflowY=scrollLiterals[e]||e)),this.positionDirty=!this.isConfiguring}enableWheel(){BrowserHelper.isChrome||BrowserHelper.isSafari||this.wheelListenerRemover||(this.wheelListenerRemover=EventHelper.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&!1!==this.overflowX?(this.x+=e.deltaX,e.stopPropagation()):!1!==this.overflowY&&(this.y+=e.deltaY,e.stopPropagation())}get scrollWidth(){return this.element?this.element.scrollWidth:0}set scrollWidth(e){const t=this;let r=t.widthStretcher;r&&null==e?(r.remove(),t.widthStretcher=null):e&&(r||(r=t.widthStretcher=DomHelper.createElement({className:"b-scroller-stretcher"})),r.style.transform=`translateX(${e-1}px)`,t.element&&t.element.lastChild!==r&&t.element.appendChild(r)),t.syncOverflowState()}get scrollHeight(){return this.element?this.element.scrollHeight:0}set scrollHeight(e){const t=this,r=t.stretcher||(t.stretcher=DomHelper.createElement({className:"b-scroller-stretcher"}));r.style.transform=`translateY(${e-1}px)`,t.element&&t.element.lastChild!==r&&t.element.appendChild(r)}get clientWidth(){return this.element?this.element.clientWidth:0}get clientHeight(){return this.element?this.element.clientHeight:0}get id(){return this._id||(this.widget?this._id=this.widget.id+"-scroller":this._id=IdHelper.generateId("scroller-")),this._id}}Scroller._$name="Scroller";const localeName="En",localeDesc="English",locale$1={localeName:"En",localeDesc:"English",Object:{Yes:"Yes",No:"No",Cancel:"Cancel"},Combo:{noResults:"No results"},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:e=>"Value must be less than or equal to "+e.max,rangeUnderflow:e=>"Value must be greater than or equal to "+e.min,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},NumberFormat:{locale:"en-US",currency:"USD"},TimeField:{invalidTime:"Invalid time input"},List:{loading:"Loading..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:e=>"of "+e.lastPage,summaryTemplate:e=>`Displaying records ${e.start} - ${e.end} of ${e.allCount}`},DateHelper:{locale:"en-US",weekStartDay:0,unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A"},ordinalSuffix:e=>e+({1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th")}};LocaleManagerSingleton.registerLocale("En",{desc:"English",locale:locale$1});class Promissory{constructor(e){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t})),e&&e(this)}}Promissory._$name="Promissory";const{defineProperty:defineProperty$5}=Reflect;class Renderable extends(Base.mixin(Localizable,Events,Delayable,Identifiable)){static get configurable(){return{element:null}}static get delayable(){return{refreshDom:"raf"}}static get identifiable(){return{}}static get renderConfigs(){const e=this,t=e.$meta;let r,n,i=t.renderConfigs;if(void 0===i){for(n in i=null,r=t.configs,r)r[n].render&&(i||(i=new Set)).add(n);t.renderConfigs=e.prototype.$renderConfigs=i}return i}construct(...e){this.$iid=++Renderable.$idSeed,this.byRef={},super.construct(...e),this.onDraw!==Renderable.prototype.onDraw&&this.initDrawable()}startConfigure(e){this.element=this.renderContext.renderDom(),super.startConfigure(e)}get element(){return this.refreshDom.flush(),this._element}changeElement(e,t){const r=this;return t&&t.remove(),e&&(e.id=r.id,e=DomHelper.createElement(e,{refOwner:r})),e}updateId(e,t){const r=this;if(t){const n=r.element;n.id=e,r.fixRefOwnerId(n,e,t)}}get classes(){return this.element.classList}fixRefOwnerId(e,t,r){if(e.$refOwnerId===r){e.$refOwnerId=t;const n=e.$reference;n&&(e.id=`${t}-${n}`);for(const n of e.childNodes)this.fixRefOwnerId(n,t,r)}}onConfigChange({name:e}){!this.isConfiguring&&this.$renderConfigs.has(e)&&this.refreshDom()}attachRef(e,t,r){const n=this,i="_"+e,{listeners:s}=r;i in n||defineProperty$5(n,e,{get:()=>(n.refreshDom.flush(),n[i]),set(e){n[i]=e}}),t.id=`${n.id}-${e}`,n[e]=t,s&&(r.listeners={on:s,un:EventHelper.on(Object.assign({element:t,thisObj:n},s))})}detachRef(e,t,r){r.listeners&&(r.listeners.un(),r.listeners=null),this[e]=null}renderDom(){return{}}get renderContext(){const e=this,t=e.$meta,r=e.constructor;let n=t.renderConfigs||r.renderConfigs,i=e;if(!n){i=Object.create(e),n=new Set;for(const r in t.configs)defineProperty$5(i,r,{get:()=>(n.add(r),e[r])});i.renderDom=()=>e.renderDom.call(i),e.$renderConfigs=n}return defineProperty$5(e,"renderContext",{value:i}),i}refreshDom(){DomSync.sync({targetElement:this.element,domConfig:this.renderContext.renderDom(),refOwner:this,strict:!0})}onListen(e){"draw"===e&&this.initDrawable()}initDrawable(){const e=this;if(!e.intersector){let t=Object.values(e.byRef).find((e=>e.classList.contains("b-drawable")));t||(t=e.element,t.classList.add("b-drawable")),e.intersector=!0,EventHelper.on({element:DomHelper.createElement({parent:t,class:"b-drawable-el"}),animationend({animationName:t}){"b-drawable-anim"===t&&e.onDraw({count:++e.drawCounter})}})}}onDraw(e){this.trigger("draw",e)}}Renderable.$idSeed=0,Object.assign(Renderable.prototype,{drawCounter:0,hasGeneratedId:!1,intersector:null}),Renderable._$name="Renderable";class Mask extends Renderable{static get $name(){return"Mask"}static get type(){return"mask"}static get configurable(){return{autoClose:null,cover:null,icon:"b-icon b-icon-spinner",errorDefaults:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},maxProgress:null,mode:"dark",progress:null,owner:null,target:null,text:null,type:null,showDelay:null,useTransition:!1}}static get delayable(){return{deferredClose:0,delayedShow:0}}construct(e){if(e){let t,r=e.element;r&&(VersionHelper.deprecate("Core","4.0.0",'Mask "element" config has been renamed to "target"'),e=t=Object.assign({},e),delete t.element,t.target=r),r=e.target,"string"==typeof r&&(e=t=t||Object.assign({},e),t.target=e.owner[r])}super.construct(e),this.target||(this.target=document.body),this.show()}doDestroy(){const e=this,{element:t}=e;t&&(e.element=null,e.mode.endsWith("blur")&&DomHelper.forEachChild(t,(t=>{t.classList.remove("b-masked-"+e.mode)})),e.target.classList.remove("b-masked"),e.target[e.maskName]=null),super.doDestroy()}get maskElement(){return this.element}get maskName(){const e=this.type;return"mask"+("string"==typeof e?e.trim():"")}set error(e){this.setConfig(this.errorDefaults),this.text=e}renderDom(){const e=this,{maxProgress:t}=e;return{class:{"b-mask":1,"b-delayed-show":e.showDelay,"b-widget":1,["b-mask-"+e.mode]:1,"b-progress":t,"b-prevent-transitions":!e.useTransition},children:[{reference:"maskContent",class:"b-mask-content b-drawable",children:[t?{reference:"progressElement",class:"b-mask-progress-bar",style:{width:Math.max(0,Math.min(100,Math.round(e.progress/t*100)))+"%"}}:null,{reference:"maskText",class:"b-mask-text",html:(e.icon?`<i class="b-mask-icon ${e.icon}"></i>`:"")+e.text}]}]}}static mergeConfigs(...e){const t={};for(const r of e)"string"==typeof r?t.text=r:ObjectHelper.assign(t,r);return t}static mask(e,t=document.body){return new Mask("string"!=typeof e?Object.assign({target:t},e):{target:t,text:e})}static unmask(e=document.body){return e.mask&&e.mask.close()}updateAutoClose(e){const t=this;t.deferredClose.cancel(),e&&(t.deferredClose.delay=e,t.deferredClose())}updateCover(){const e=this.owner;e&&e.syncMaskCover&&e.syncMaskCover(this)}updateShowDelay(e){const t=this.delayedShow;t.delay=e,e||t.flush()}deferredClose(){const e=this.owner;this.close().then((()=>{e&&e.onMaskAutoClose&&e.onMaskAutoClose(this)})),e&&e.onMaskAutoClosing&&e.onMaskAutoClosing(this)}delayedShow(){this.classes.remove("b-delayed-show")}show(){const e=this,{element:t,target:r,hiding:n,maskName:i}=e;n&&(n.resolve(),e.hiding=null,e.clearTimeout("hide")),e.showDelay&&(t.classList.add("b-delayed-show"),e.delayedShow()),t.classList.add("b-visible"),t.classList.remove("b-hidden"),r.classList.add("b-masked"),r[i]||(r[i]=e,r.appendChild(t)),e.shown=!0,e.mode.endsWith("blur")&&DomHelper.forEachChild(r,(r=>{r!==t&&r.classList.add("b-masked-"+e.mode)}))}hide(){const e=this,{target:t,element:r}=e;let n=e.hiding;if(!n){if(!e.shown)return Promise.resolve();e.hiding=n=new Promissory,e.shown=!1,r.classList.remove("b-visible"),r.classList.add("b-hidden"),t.classList.remove("b-masked"),e.mode.endsWith("blur")&&DomHelper.forEachChild(t,(t=>{t!==r&&t.classList.remove("b-masked-"+e.mode)})),n.promise=n.promise.then((()=>{e.hiding===n&&(e.hiding=null)})),e.setTimeout((()=>n.resolve()),500,"hide")}return n.promise}close(){return this.hide().then((()=>{this.destroy()}))}}Mask._$name="Mask";const isTransparent=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,textInputTypes={INPUT:1,TEXTAREA:1},mergeAnim=(e,t)=>e&&t&&t[ObjectHelper.keys(e)[0]]?Config.merge(e,t):e,widgetTriggerPaint=e=>{e.isVisible&&e.triggerPaint()},negationPseudo=/^:not\((.+)\)$/,isScaled=e=>null!=e.scale,{hasOwnProperty:hasOwnProperty$6}=Object.prototype,parseDuration=e=>parseFloat(e)*(e.endsWith("ms")?1:1e3);class Widget extends(Base.mixin(Localizable,Events,Delayable,Identifiable,Factoryable)){static get $name(){return"Widget"}static get type(){return"widget"}static get configurable(){return{element:!0,callOnFunctions:!0,id:"",html:null,content:null,hasGeneratedId:null,cls:null,contentElementCls:null,htmlCls:"b-html",style:null,disabled:null,readOnly:null,adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:null,preventTooltipOnTouch:null,monitorResize:{$config:["lazy"],value:null},masked:null,maskDefaults:{target:"element"},cache:{},floating:null,positioned:null,draggable:null,align:"t-b",centered:null,constrainTo:void 0,anchor:null,owner:null,scrollAction:null,hideAnimation:{$config:{merge:mergeAnim},value:null},showAnimation:{$config:{merge:mergeAnim},value:null},x:null,y:null,scrollable:null,scrollerClass:Scroller,defaultBindProperty:"html",defaultAction:null,width:null,height:null,maxHeight:null,maxWidth:null,minWidth:null,minHeight:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,weight:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title"],requireSize:!1,ref:null,hidden:null,textAlign:null,ignoreScrollDuration:500,tag:"div"}}static get factoryable(){return{defaultType:"widget"}}static get identifiable(){return{}}construct(e={},...t){const r=this;r.alignConstrained=0,r.byRef=Object.create(null),r.callRealign=r.realign.bind(r),r.doHideOrRealign=r.doHideOrRealign.bind(r),r.initialRender=!0,r._isUserAction=!1,super.construct(e,t),r.finalizeInit()}isType(e,t){return Widget.isType(this,e,t)}startConfigure(e){const t=this,{adopt:r,element:n}=t;if(r){const i="string"==typeof r?document.getElementById(r):r,s=Widget.fromElement(i);if(s&&s.adopt&&s!==t){("string"==typeof s.adopt?document.getElementById(s.adopt):s.adopt)===i&&s.destroy()}t.preExistingElements=Array.from(i.childNodes),t.adoptedElementClassName=i.className,t.adoptedElementCssText=i.style.cssText,i.id&&!e.id&&(t.id=n.id=i.id),DomHelper.syncAttributes(n,i);for(let e=0,{length:t}=n.childNodes;e<t;e++)i.appendChild(n.childNodes[0]);t._element=i,delete t._contentRange}t.scaleToFitWidth||t.getConfig("monitorResize"),super.startConfigure(e)}updateTitle(e){this.titleElement&&(this.titleElement.innerHTML=e)}attachRef(e,t,r){const n=this,i=r&&r.listeners;n[e]=n.byRef[e]=t,t.dataset&&(t.dataset.ownerCmp=n.id),i&&(r.listeners={on:i,un:EventHelper.on(Object.assign({element:t,thisObj:n},i))})}detachRef(e,t,r){r.listeners&&(r.listeners.un(),r.listeners=null),this[e]=null,delete this.byRef[e]}changeElement(e){const t=this;let r,n;"string"==typeof e?e=DomHelper.createElementFromTemplate(e):ObjectHelper.isObject(e)?e=DomHelper.createElement(e,{refOwner:t}):1!==e.nodeType&&(e=DomHelper.createElementFromTemplate(t.template(t))),t._element=e;const i=e.classList;e.id=t.id,e.className+=" "+t.widgetClassList.join(" "),t.contentElementCls&&(t.contentElement.className+=" "+t.contentElementCls),t._hidden&&i.add("b-hidden"),t._readOnly&&i.add("b-readonly"),t.parent||(i.add("b-outer"),DomHelper.addClasses(e,Widget.outerCls));const s=e.querySelectorAll("[data-reference]");for(n=0;n<s.length;++n)r=s[n],t.attachRef(r.getAttribute("data-reference"),r),r.removeAttribute("data-reference");return e}set parent(e){this._parent=e,this._element&&this._element.classList[e?"remove":"add"]("b-outer")}get parent(){return this._parent}get constrainTo(){const e=this._constrainTo;return void 0===e?window:e}updateCentered(e){const{element:t}=this;if(e&&!this.floating&&!this.positioned)throw new Error("`centered` is only relevant when a Widget is `floating` or `positioned`");e?(t.classList.add("b-centered"),t.style.transform=t.style.left=t.style.top=""):t.classList.remove("b-centered")}get contentElement(){return this.element}get contentRange(){const e=this,{contentElement:t}=e,r=e._contentRange||(e._contentRange=BrowserHelper.isIE11?document.createRange():new Range);return r.collapsed&&(r.setStart(t,e.contentRangeStartOffset||0),r.setEnd(t,e.contentRangeEndOffset||t.childNodes.length)),r}updateId(e,t){if(t){const{element:r}=this,n=r.querySelectorAll(`[data-owner-cmp="${t}"]`);for(let t=0,{length:r}=n;t<r;t++)n[t].dataset.ownerCmp=e;r.id=e}}get style(){return this.element?this.element.ownerDocument.defaultView.getComputedStyle(this.element):this._style}updateStyle(e){this.element&&DomHelper.applyStyle(this.element,e)}get dataset(){return this.element.dataset}get dragGhost(){return this.constructor._dragGhost||(this.constructor._dragGhost=DomHelper.createElement({html:" ",style:"position:absolute;top:-10000em;left:-10000em"}))}changeDataset(e){Object.assign(this.dataset,e)}finalizeInit(){(this.insertBefore||this.appendTo||this.insertFirst||this.adopt)&&this.render()}doDestroy(){const e=this,{tooltip:t,preExistingElements:r,element:n}=e;if(e.scrollable&&e.scrollable.destroy(),t&&(e._tooltip?t.destroy():t.hide()),e.unmask(),n){var i,s;if(e.clearTimeout(e.scrollListenerTimeout),e.clearTimeout(e.resizeListenerTimeout),e.removeTransientListeners(),e.floating||e.positioned?e.hide():e.revertFocus(),ResizeMonitor.removeResizeListener(n.parentElement,e.onParentElementResize),ResizeMonitor.removeResizeListener(n,e.onElementResize),e.adopt){for(let e=Array.from(n.childNodes),t=0,{length:i}=e;t<i;t++){const n=e[t];r.includes(n)||n===Widget.floatRoot||n.remove()}n.className=e.adoptedElementClassName,n.style.cssText=e.adoptedElementCssText}else n.remove();null===(i=e.dragEventDetacher)||void 0===i||i.call(e),null===(s=e.dragOverEventDetacher)||void 0===s||s.call(e),e.dragGhost.remove()}super.doDestroy()}render(e,t=!0){const r=this,{element:n}=r;r.emptyCache(),r.syncElement&&r.currentElement?DomHelper.sync(n,r.currentElement):(e?(r.appendTo="string"==typeof e?document.getElementById(e):e,r.appendTo.appendChild(n)):r.insertBefore?(r.insertBefore="string"==typeof r.insertBefore?document.getElementById(r.insertBefore):r.insertBefore,r.insertBefore.parentElement.insertBefore(n,r.insertBefore)):r.insertFirst?(r.insertFirst="string"==typeof r.insertFirst?document.getElementById(r.insertFirst):r.insertFirst,r.insertFirst.firstChild?r.insertFirst.insertBefore(n,r.insertFirst.firstChild):r.insertFirst.appendChild(n)):r.appendTo&&(r.appendTo="string"==typeof r.appendTo?document.getElementById(r.appendTo):r.appendTo,r.appendTo.appendChild(n)),r.currentElement=n),r.rendered=!0,t&&(r.getConfig("contentRange"),r.triggerPaint())}template(e){return`<${e.tag} class="${e.html?e.htmlCls:""}" ${e.name?`data-name="${e.name}"`:""}>${e.html||""}</${e.tag}>`}alignTo(e){(1===e.nodeType||e instanceof Widget||"Point"===e.$$name)&&(e={target:e}),this.releaseSizeConstraints();const t=this,{scrollable:r,element:n,constrainTo:i}=t,s=t.scale||1,o=e.target,a=o&&(o instanceof Rectangle?o:o.element||o),l=Rectangle.from(n,t.positioned?n.offsetParent:null,!0),c=a&&1===a.nodeType,d=(e=ObjectHelper.assign({constrainTo:i,align:"b-t",axisLock:t.axisLock,anchor:t.anchor},t.align,e)).minWidth||t.minWidth,u=e.minHeight||t.minHeight;if(l.isAlignRectangle=!0,d&&(l.minWidth=d*s),u&&(l.minHeight=u*s),t.lastAlignSpec=e,c&&a.offsetParent){(e=Object.setPrototypeOf({},e)).target=Rectangle.from(a,t.positioned?n.offsetParent:null,!t.positioned),e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1);const r=t.clippedBy;if(r){const n=e.target.intersect(r);if(!n){const e=t.hide();return t.lastAlignSpec.targetHidden=!0,e}e.target=n}t.anchoredTo=a}else t.anchoredTo=null;if(e.anchor&&(e.anchorSize=t.anchorSize,n.appendChild(t.anchorElement)),i&&!i.isRectangle&&t.positioned){const t=i===document||i===window;e.constrainTo=Rectangle.from(t?document.body:e.constrainTo,n.offsetParent)}t.isAligning=!0,t.trigger("beforeAlign",e),t.isAligning=!1;const h=l.alignTo(e);let{align:g,anchor:m,x:p,y:f,width:v,height:y,bottom:b,right:C}=h;if(t.lastAlignSpec.zone=h.zone,y!==l.height&&("configuredHeight"in t||(t.configuredHeight=n.style.height),t.height=y/s,t.alignConstrained=1|t.alignConstrained,r&&(r.overflowY=!0)),v!==l.width&&("configuredWidth"in t||(t.configuredWidth=n.style.width),t.width=v/s,t.alignConstrained=2|t.alignConstrained,r&&(r.overflowX=r.clientWidth>r.scrollWidth)),g&&t.alignConstrained){e.align=g;const r=Rectangle.from(n,t.positioned?n.offsetParent:null,!0).alignTo(e);m=r.anchor,p=r.x,f=r.y,v=r.width,y=r.height,b=r.bottom,C=r.right}if(t.setXY(p,f),m){const{edge:e}=m,{anchorElement:r}=t,i=Rectangle.from(n,null,!0),o=[],a=n.style.pointerEvents;n.style.pointerEvents="all","top"===e||"bottom"===e?(o[0]=i.x+m.x,o[1]="top"===e?i.y+1:b-1):(o[0]="left"===e?i.x+1:C-1,o[1]=i.y+m.y);const l=DomHelper.elementFromPoint(...o);if(n.style.pointerEvents=a||null,l){const e=DomHelper.getStyleValue(l,"background-color");e.match(isTransparent)?t.anchorPathElement.setAttribute("fill",t.defaultAnchorBackgroundColor):t.anchorPathElement.setAttribute("fill",e)}r.classList.remove("b-hide-display"),r.style.transform="",r.className="b-anchor b-anchor-"+e,m.x&&(m.x/=s),m.y&&(m.y/=s),DomHelper.setTranslateXY(r,m.x,m.y),n.classList.add("b-anchored")}else t._anchorElement&&(t.anchorElement.classList.add("b-hide-display"),n.classList.remove("b-anchored"));"hide"!==t.scrollAction||c||(n.style.pointerEvents="none",t.anchoredTo=DomHelper.elementFromPoint(p,f),n.style.pointerEvents=""),("realign"===t.scrollAction&&c||"hide"===t.scrollAction)&&!t.documentScrollListener&&(t.clearTimeout(t.scrollListenerTimeout),t.scrollListenerTimeout=t.setTimeout((()=>{t.documentScrollListener=!0,document.addEventListener("scroll",t.doHideOrRealign,!0)}),"hide"===t.scrollAction?t.ignoreScrollDuration:0)),c&&e.monitorResize&&!t.targetResizeListener&&(ResizeMonitor.addResizeListener(a,t.callRealign),t.targetResizeListener=!0),BrowserHelper.isAndroid||t.constrainListeners||i instanceof Rectangle||(t.clearTimeout(t.resizeListenerTimeout),t.resizeListenerTimeout=t.setTimeout((()=>{t.constrainListeners=!0,ResizeMonitor.addResizeListener(i||window,t.callRealign)}),t.ignoreScrollDuration))}realign(e){const t=this;if(t.isVisible&&(t.floating||t.positioned)&&t.lastAlignSpec){const r=t.lastAlignSpec.target;if(r&&1===r.nodeType){if(BrowserHelper.isIE11&&!isInDocument(r))return t.hide();const n=Widget.fromElement(r),i=Rectangle.from(r),s=(!n||n.isVisible)&&DomHelper.isVisible(r);if(i.minHeight=i.minWidth=1,r!==document.body&&!s||e&&1===e.nodeType&&e.contains(r)&&!Rectangle.from(e).intersect(i))return t.hide()}t.alignTo(t.lastAlignSpec)}}releaseSizeConstraints(){const e=this,t=e.scrollable;1&e.alignConstrained&&(e.height=e.configuredHeight,t&&(t.overflowY=t.config.overflowY)),2&e.alignConstrained&&(e.width=e.configuredWidth,t&&(t.overflowX=t.config.overflowX)),e.alignConstrained=0}toFront(){const{element:e}=this,t=this.floating?Widget.floatRoot:this.positioned?null==e?void 0:e.parentNode:null;if(e&&e.nextSibling){const r=this._toFrontRange||(this._toFrontRange=document.createRange());r.setStartBefore(e.nextSibling),r.setEndAfter(t.lastElementChild),t.insertBefore(r.extractContents(),e)}}updateRef(e){this.element.dataset.ref=e}set clippedBy(e){this._clippedBy=Array.isArray(e)?e:e?[e]:null}get clippedBy(){const e=this._clippedBy;if((null==e?void 0:e.length)>0){let t,r=Rectangle.from(null==e?void 0:e[0],null,!0);for(t=1;t<e.length;t++)r=r.intersect(Rectangle.from(null==e?void 0:e[t],null,!0));return r}}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}changeAlign(e){return"string"==typeof e?{align:e}:e}changeScrollable(e,t){var r;return"boolean"==typeof e&&(e={overflowX:e,overflowY:e}),e.element=this.overflowElement,e.widget=this,t?!e||e.isScroller?t.destroy():(t.setConfig(e),e=t):e=new this.scrollerClass(e),null===(r=e)||void 0===r||r.syncOverflowState(),e}get html(){return this.initializingElement||!this.element?this.content||this._html:this.contentElement.innerHTML}updateHtml(e){const t=this,r=null==e,{element:n,contentElement:i,htmlCls:s}=t;if(n){const o=i===n&&t._anchorElement;s&&n.classList[r?"remove":"add"](s),o&&t.element.removeChild(o),e&&"object"==typeof e?DomSync.sync({domConfig:e,targetElement:t.contentElement,onlyChildren:!0}):t.contentElement.innerHTML=r?"":e,o&&n.appendChild(o),(t.floating||t.positioned)&&(t.isAligning||t.realign())}}updateContent(e){const t=this,r=null==e,{element:n,htmlCls:i}=t;if(n){const{contentRange:s}=t;i&&n.classList[r?"remove":"add"](i),isInDocument(n)?(s.deleteContents(),r||s.insertNode(DomHelper.createElementFromTemplate(e,{fragment:!0}))):t.contentElement.innerHTML=e,t.contentRangeStartOffset=s.startOffset,t.contentRangeEndOffset=s.endOffset,!t.floating&&!t.positioned||t.isAligning||t.realign()}}onThemeChange(){var e;(null===(e=this.anchorElement)||void 0===e?void 0:e.offsetParent)&&(this._anchorSize=null,this.realign())}get anchorSize(){const e=this;let t=this._anchorSize;if(!t){const r=parseFloat(DomHelper.getStyleValue(e.element,"border-top-width")),n=DomHelper.getStyleValue(e.element,"border-top-color"),i=e.anchorElement,s=i.firstElementChild,o=e.anchorPathElement=s.lastElementChild,a=e._hidden;let l=DomHelper.getStyleValue(e.contentElement,"background-color");l.match(isTransparent)&&(l=DomHelper.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=l,t=i.getBoundingClientRect();const[c,d]=t=e._anchorSize=[t.width,t.height];s.setAttribute("height",d+r),s.setAttribute("width",c),o.setAttribute("d",`M0,${d}L${c/2},0.5L${c},${d}`),r&&(o.setAttribute("stroke-width",r),o.setAttribute("stroke",n)),t[1]-=r,a&&e.element.classList.add("b-hidden"),e.themeChangeListener||(e.themeChangeListener=GlobalEvents.on({theme:"onThemeChange",thisObj:e})),e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}return t}get anchorElement(){let e=this._anchorElement;if(!e){const t=this.floating&&!(BrowserHelper.isIE11||BrowserHelper.isEdge);e=this._anchorElement=DomHelper.createElement({parent:this.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[t?{tag:"defs",children:[{tag:"filter",id:"shadow-filter",children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:2,"flood-opacity":.05}]}]}:null,{tag:"path",[null!=t?t:"filter"]:"url(#shadow-filter)"}]}]})}return e}updateAnchor(e){this._anchorElement&&this._anchorElement.classList[e?"remove":"add"]("b-hide-display")}updateDraggable(e){const t=this,{element:r}=t;var n,i,s;(BrowserHelper.isFirefox||r.setAttribute("draggable",Boolean(e)),e)?(t.dragEventDetacher=EventHelper.addListener({element:r,dragstart:"onWidgetDragStart",dragend:"onWidgetDragEnd",thisObj:t}),BrowserHelper.isFirefox&&(t.ffDragDetacher=EventHelper.on({element:r,mousedown(e){DomHelper.up(e.target,".b-field-inner")||r.setAttribute("draggable","true")},thisObj:t}))):(null===(n=t.dragEventDetacher)||void 0===n||n.call(t),null===(i=t.dragOverEventDetacher)||void 0===i||i.call(t),null===(s=t.ffDragDetacher)||void 0===s||s.call(t))}onWidgetDragStart(e){const t=this,{element:r}=t,n=DomHelper.elementFromPoint(e.clientX,e.clientY),{handleSelector:i}=t.draggable;if(i){const t=negationPseudo.exec(i)[1];if(t){if(n.closest(`#${r.id} ${t}`))return void e.preventDefault()}else if(!n.closest(`#${r.id} ${i}`))return void e.preventDefault()}t.removeTransientListeners();const s=e.clientX,o=e.clientY,a=document.scrollingElement||document.body,l=t.getXY()[0],c=t.getXY()[1];document.body.appendChild(t.dragGhost),t.setDragImage(e),e.dataTransfer.effectAllowed="none",t.dragOverEventDetacher=EventHelper.addListener({element:document.body,dragover:e=>{r.classList.remove("b-centered"),DomHelper.setTranslateXY(r,l+e.clientX-s-a.scrollLeft,c+e.clientY-o-a.scrollTop)}}),t.anchor=null}setDragImage(e){e.dataTransfer.setDragImage&&(e.dataTransfer.setData("application/node type",""),e.dataTransfer.setDragImage(this.dragGhost,0,0))}onWidgetDragEnd(){this.dragGhost.remove(),this.dragOverEventDetacher(),BrowserHelper.isFirefox&&this.element.removeAttribute("draggable")}changeFloating(e){return Boolean(e)}changePositioned(e){return Boolean(e)}updatePositioned(e){this.element.classList[e?"add":"remove"]("b-positioned")}getXY(){return[DomHelper.getPageX(this.element),DomHelper.getPageY(this.element)]}setXY(e,t){const r=this;(r.floating||r.positioned)&&(null!=e&&(r._x=e,r.centered=!1),null!=t&&(r._y=t,r.centered=!1),DomHelper.setTranslateXY(r.element,r._x||0,r._y||0))}get x(){return this.getXY()[0]}changeX(e){this.setXY(e)}get y(){return this.getXY()[1]}changeY(e){this.setXY(null,e)}get width(){const e=this,t=e.element;return e.monitorResize?(null==e._width&&(e._width=t.offsetWidth),e._width):t.offsetWidth}changeWidth(e){DomHelper.setLength(this.element,"width",e),this._width=null,this._flex=null,this.element.style.flex=""}get maxWidth(){return DomHelper.measureSize(this.element.style.maxWidth,this.element)}updateMaxWidth(e){DomHelper.setLength(this.element,"maxWidth",e)}get minWidth(){return DomHelper.measureSize(this.element.style.minWidth,this.element)}updateMinWidth(e){DomHelper.setLength(this.element,"minWidth",e)}updateFlex(e){"number"!=typeof e&&isNaN(e)||(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=BrowserHelper.isIE11?"":null}updateAlignSelf(e){this.element.style.alignSelf=e}updateMargin(e){this.element.style.margin=this.parseTRBL(e).join(" ")}updateTextAlign(e,t){t&&this.element.classList.remove("b-text-align-"+t),this.element.classList.add("b-text-align-"+e)}get height(){const e=this,t=e.element;return e.monitorResize?(null==e._height&&(e._height=t.offsetHeight),e._height):t.offsetHeight}changeHeight(e){DomHelper.setLength(this.element,"height",e),this._height=null}get maxHeight(){return DomHelper.measureSize(this.maxHeightElement.style.maxHeight,this.element)}updateMaxHeight(e){const t=this,{element:r}=t;DomHelper.setLength(t.maxHeightElement,"maxHeight",e),BrowserHelper.isIE11&&t.contentElement!==r&&(null==e?ResizeMonitor.removeResizeListener(r,t.boundMaxHeightBugHandler):(ResizeMonitor.addResizeListener(r,t.boundMaxHeightBugHandler||(t.boundMaxHeightBugHandler=t.fixIEMaxHeightBug.bind(t))),document.body.contains(r)&&t.fixIEMaxHeightBug()))}fixIEMaxHeightBug(){const{element:e,contentElement:t}=this;if("column"===DomHelper.getStyleValue(e,"flex-direction")){t.style.maxHeight="";let r=Rectangle.client(e).height;const n=e.childNodes,i=n.length;for(let e=0;e<i;e++){const i=n[e];i===t||i.classList.contains("b-resize-monitors")||(r-=i.offsetHeight)}this.contentElement.style.maxHeight=r+"px"}}get minHeight(){return DomHelper.measureSize(this.element.style.minHeight,this.element)}updateMinHeight(e){DomHelper.setLength(this.element,"minHeight",e)}updateDisabled(e){const t=this.element,r=this.focusElement;e&&this.revertFocus(),t&&(t.classList[e?"add":"remove"]("b-disabled"),r&&(r.disabled=e)),this.onDisabled(e)}onDisabled(e){}disable(){this.disabled=!0}enable(){this.disabled=!1}get tooltip(){if(this._tooltip)return this._tooltip;{const{tooltip:e}=Widget;if(e&&e.activeTarget===this._element&&e.isVisible)return e}}changeTooltip(e,t){const r=this;let n=null;return t&&t.destroy(),delete r.element.dataset.btip,e&&(r.preventTooltipOnTouch&&BrowserHelper.isTouchDevice||("Object"!==e.constructor.name&&(e={html:"string"==typeof e?e:r.placeholder,textContent:!0}),e.newInstance?(e.type="tooltip",e.forElement||(e.forElement=r.element),"showOnHover"in e||e.forSelector||(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),n=Widget.create(e)):(r.element.dataset.btip=!0,r.tipConfig=e))),n}get isVisible(){const e=this,{element:t}=e;return Boolean(t&&!e._hidden&&!e.isDestroying&&isInDocument(t)&&(!e.requireSize||hasLayout(t))&&(!e.owner||e.owner.isVisible))}focus(){this.isFocusable&&DomHelper.focusWithoutScrolling(this.focusElement)}get focusElement(){}get isFocusable(){const e=this.focusElement;return e&&this.isVisible&&!this.disabled&&(e===document.body||e.offsetParent)}show(){return new Promise((e=>{const t=this,{showAnimation:r,element:n}=t,{floatRoot:i}=Widget,{style:s}=n;let o,a;if(t.isVisible||!1===t.trigger("beforeShow")||t.internalBeforeShow&&!1===t.internalBeforeShow())e();else{if(t.cancelHideShowAnimation(),t.updateCentered(t._centered),t.floating){i.contains(n)||(t.rendered?i.appendChild(t.element):t.render(i,!1)),s.transform.includes("scale")&&(t.scale=null,s.transform=s.transformOrigin="");const e=t.closest(isScaled);if(e){const{scale:r}=e;t.scale=r,s.transform=`scale(${r})`,s.transformOrigin="0 0"}}t._hidden=!1,n.classList.remove("b-hidden"),r&&(o=Object.keys(r)[0],a=r[o],t.currentAnimation={styleProp:o,resolve:e},t.isAnimating=!0,t.currentAnimation.detacher=EventHelper.onTransitionEnd({element:n,property:o,duration:parseDuration(a.duration)+20,handler:"afterHideShowAnimate",thisObj:t}),s[o]=a.from,DomHelper.getStyleValue(n,o),s.transition=`${o} ${a.duration} ease ${a.delay}`,s[o]=a.to),t.afterShow(!r&&e),t.inShowBy||!t.floating||!t.forElement||t.centered||t.hidden||t.alignTo(t.forElement)}}))}showBy(e){const t=this;t.inShowBy=!0;const r=t.show();return t.inShowBy=!1,t.isVisible&&t.alignTo(e),r}showByPoint(e,t,r){const n=1===arguments.length?e:[e,t];return this.showBy(Object.assign({target:new Rectangle(n[0],n[1],1,1),matchSize:!1,align:"t-b"},r))}afterShow(e){var t;this.boundMaxHeightBugHandler&&this.boundMaxHeightBugHandler(),this.trigger("show"),null===(t=this.parent)||void 0===t||t.onChildShow(),this.triggerPaint(),e&&e()}triggerPaint(){const e=this,{element:t}=e,r=!e.isPainted;e.isVisible&&(r&&e.scaleToFitWidth&&!e.monitorResize&&(e.onParentElementResize=e.onParentElementResize.bind(e),ResizeMonitor.addResizeListener(t.parentElement,e.onParentElementResize),e.updateScale()),e.eachWidget(widgetTriggerPaint,!1),e.trigger("paint",{firstPaint:r}),r&&e.monitorResize&&!e.scaleToFitWidth&&ResizeMonitor.onElementResize([{target:t}]),e.isPainted=!0)}cancelHideShowAnimation(){const{currentAnimation:e,element:t}=this,{style:r}=t;e&&(this.isAnimating=!1,t.classList.remove("b-hiding"),e.detacher(),r.transition=r[e.styleProp]="",this.currentAnimation=null)}afterHideShowAnimate(){if(this.isDestroyed||!this.currentAnimation)return;const e=this,{element:t}=e,{style:r}=t,{styleProp:n,resolve:i}=e.currentAnimation;t.classList.remove("b-hiding"),e.isAnimating=!1,e.currentAnimation=null,r.transition=r[n]="",e._hidden&&e.afterHideAnimation(),i()}hide(e=!0){return new Promise((t=>{const r=this,{element:n}=r,{style:i}=n,s=e&&r.hideAnimation;if(r.clearTimeout(r.scrollListenerTimeout),r.clearTimeout(r.resizeListenerTimeout),!r._hidden&&!1!==r.trigger("beforeHide")){if(r._hidden=!0,!n)return void t();if(r.revertFocus(),(BrowserHelper.isSafari||BrowserHelper.isFirefox)&&n.contains(document.activeElement)&&r.revertFocus(!0),r.isDestroyed)return void t();if(r.cancelHideShowAnimation(),s){const e=Object.keys(s)[0],o=s[e];Number(getComputedStyle(r.element)[e])!==o.to?(r.currentAnimation={styleProp:e,resolve:t},n.classList.add("b-hiding"),r.isAnimating=!0,r.currentAnimation.detacher=EventHelper.onTransitionEnd({element:n,property:e,duration:parseDuration(o.duration)+20,handler:"afterHideShowAnimate",thisObj:r}),i[e]=o.from,DomHelper.getStyleValue(n,e),i.transition=`${e} ${o.duration} ease ${o.delay}`,i[e]=o.to):n.classList.add("b-hidden")}else n.classList.add("b-hidden");r.afterHide(!s&&t,s)}}))}doHideOrRealign(e){var t;const r=this,{anchoredTo:n,lastAlignSpec:i}=r,s=i&&i.target,o=DomHelper.activeElement,[a,l]=r.getXY();if(!r.element.contains(e.target)&&e.isTrusted&&!(9===(null===(t=e.target)||void 0===t?void 0:t.nodeType)&&r.element.contains(o)&&textInputTypes[o]&&window.innerHeight<document.body.offsetHeight)&&(r.realign(e.target),!r.isDestroyed&&"hide"===r.scrollAction)){const[t,i]=r.getXY();(t!==a||i!==l||"Point"===(null==s?void 0:s.$$name))&&(!n||e.target&&DomHelper.isDescendant(e.target,n))&&r.hide()}}afterHide(e=null,t=this.hideAnimation){var r;const n=this,{lastAlignSpec:i}=n;i&&(i.targetHidden=null),n.removeTransientListeners(),t||n.afterHideAnimation(),n.trigger("hide"),null===(r=n.parent)||void 0===r||r.onChildHide(),e&&e()}removeTransientListeners(){const e=this;e.documentScrollListener&&(document.removeEventListener("scroll",e.doHideOrRealign,!0),e.documentScrollListener=!1),e.targetResizeListener&&(ResizeMonitor.removeResizeListener(e.lastAlignSpec.target,e.callRealign),e.targetResizeListener=!1),e.constrainListeners&&(ResizeMonitor.removeResizeListener(e.lastAlignSpec.constrainTo||window,e.callRealign),e.constrainMutationMonitor&&e.constrainMutationMonitor.disconnect(),e.constrainListeners=!1)}afterHideAnimation(){const e=this,{element:t}=e;e.floating&&Widget.floatRoot.contains(t)?t.remove():t.classList.add("b-hidden"),e.defaultAnchorBackgroundColor&&e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}changeHidden(e){let t;return this.isConfiguring?(t=Boolean(e),this.element.classList[e?"add":"remove"]("b-hidden")):e?this.hide():this.show(),t}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){var e,t;const r=1===(null===(e=this.forElement)||void 0===e?void 0:e.nodeType)?this.forElement:null===(t=this.element)||void 0===t?void 0:t.parentNode;return this.parent||this._owner||(null==r?void 0:r.closest(".b-widget"))&&Widget.fromElement(r)}get previousSibling(){return this.getSibling(-1)}get nextSibling(){return this.getSibling(1)}getSibling(e){const t=this,{parent:r}=t,n=r?r.childItems:Array.from(t.element.parentElement.querySelectorAll(".b-widget"));return r?n[n.indexOf(t)+e]:Widget.fromElement(n[n.indexOf(t.element)+e])}up(){const{owner:e}=this;if(e)return e.closest(...arguments)}closest(e,t,r){const n=typeof r,i="number"===n,s="string"===n;for(let n=this,o=1;n;n=n.owner,o++){if(Widget.widgetMatches(n,e,t))return n;if(i&&o>=r)return;if(s&&Widget.widgetMatches(n,r,t))return;if(n===r)return}}owns(e){if(e){if(e.eventPhase&&(e=e.target),1===e.nodeType){if(this.element.contains(e))return!0;e=Widget.fromElement(e)}for(;e;){if(e===this)return!0;e=e.owner}}return!1}eachAncestor(e){let t=this.owner;for(;t;){if(!1===e(t))return!1;t=t.owner}return!0}get readOnly(){return this._readOnly||!1}changeMonitorResize(e){return!this.scaleToFitWidth&&e}updateMonitorResize(e){const t=this;hasOwnProperty$6.call(t,"onElementResize")||(t.onElementResize=t.onElementResize.bind(t)),ResizeMonitor[e?"addResizeListener":"removeResizeListener"](t.element,t.onElementResize)}changeReadOnly(e){if(e=Boolean(e),Boolean(this._readOnly)!==e)return e}updateReadOnly(e){var t;null===(t=this.element)||void 0===t||t.classList[e?"add":"remove"]("b-readonly"),this.isConfiguring||(this.eachWidget((t=>{"_originalReadOnly"in t||(t._originalReadOnly=t.config.readOnly||!1),t.readOnly=e||t._originalReadOnly}),!1),this.trigger("readOnly",{readOnly:e}))}eachWidget(e,t=!0){const r=this.childItems,n=r?r.length:0;for(let i=0;i<n;i++){const n=r[i];if(!1===e(n))return!1;if(t&&n.eachWidget&&!1===n.eachWidget(e,t))return!1}return!0}queryAll(e){const t=[];return this.eachWidget((r=>{e(r)&&t.push(r)})),t}query(e){let t=null;return this.eachWidget((r=>{if(e(r))return t=r,!1})),t}getWidgetByRef(e){var t,r;return e instanceof Widget?e:(null==this||null===(t=this.widgetMap)||void 0===t?void 0:t[e])||(null==this||null===(r=this.owner)||void 0===r?void 0:r.getWidgetByRef(e))}onFocusIn(e){const t=this,{element:r}=t;t.containsFocus=!0,t.focusInEvent=e,r.classList.add("b-contains-focus"),r.contains(e._target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=EventHelper.on({element:r,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}onFocusOut(e){const t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(e.relatedTarget||t.revertFocus(!t.isVisible),t.containsFocus=!1,t.element.classList.remove("b-contains-focus"),t.trigger("focusout",e))}revertFocus(e){let t=this.focusInEvent&&this.focusInEvent.relatedTarget;(e||this.containsFocus&&t&&1===t.nodeType&&this.element.contains(DomHelper.activeElement))&&(t&&DomHelper.isFocusable(t)||(t=this.getFocusRevertTarget()),t&&DomHelper.isFocusable(t)&&DomHelper.focusWithoutScrolling(t))}getFocusRevertTarget(){const e=this,{owner:t,focusInEvent:r}=e,n=r&&r.backwards?1:-1;let i=r&&r.relatedTarget;const s=i&&Widget.fromElement(i);if(t&&!t.isDestroyed&&(!i||!DomHelper.isFocusable(i)||s&&!s.isFocusable)){if(i=null,t.eachWidget){const r=[];if(t.eachWidget((t=>{(t===e||t.isFocusable)&&r.push(t)}),!1),r.length>1){const t=r.indexOf(e);i=r[t+n]||r[t-n]}}!i&&t.isFocusable&&(i=t),i=i?i.focusElement:t.getFocusRevertTarget()}return i}get widgetClassList(){const e=this,t=e.cls,r=e.classHierarchy(Widget).reduce(((t,r)=>{const n=Reflect.getOwnPropertyDescriptor(r.prototype,"widgetClass");let i;if(n&&n.get)i=n.get.call(e);else{const e=hasOwnProperty$6.call(r,"$$name")||hasOwnProperty$6.call(r,"$name")||hasOwnProperty$6.call(r,"_$name")?r.$$name:r.name;(e.length<3||e.includes("$"))&&console.warn(`Class "${e}" which extends "${r.$name}" should have "$name" static getter with no less than 3 chars.`),i="b-"+e.toLowerCase()}return i&&t.push(...i.split(" ")),t}),(null==t?void 0:t.values)||[]);return e.floating&&r.push("b-floating"),BrowserHelper.isTouchDevice&&r.push("b-touch"),r}changeCls(e){return new DomClassList(e)}changeContentCls(e){return new DomClassList(e)}fromCache(e,t=!1,r=this.element){if(!r)return null;const n=this;return n.cache[e]||(n.cache[e]=t?DomHelper.children(r,e):DomHelper.down(r,e)),n.cache[e]}emptyCache(){this.cache={}}changeMasked(e,t){if(!0!==e&&""!==e||(e=" "),t)"string"==typeof e?(t.text=e,e=t):e?(t.setConfig(e),e=t):t.destroy();else if(e){const t=Widget.resolveType("mask");(e=t.mergeConfigs(this.maskDefaults,e)).owner=this,e=t.mask(e)}return e||null}onMaskAutoClose(e){e.isDestroyed&&e===this.masked&&(this.masked=null)}mask(e){return this.masked=e,this.masked}unmask(){this.masked=null}onInternalResize(e,t,r,n,i){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e){const t=this,{element:r,scrollable:n}=t,i=t._width,s=t._height,o=r.offsetWidth,a=r.offsetHeight;var l;(t.floating&&t.onFloatingWidgetResize(...arguments),n)&&(null===(l=n.syncOverflowState)||void 0===l||l.call(n));t.suspendResizeMonitor||i===o&&s===a||(t.onInternalResize(r,o,a,i,s),t.trigger("resize",{width:o,height:a,oldWidth:i,oldHeight:s}))}onFloatingWidgetResize(e,t,r){const n=this,{lastAlignSpec:i,constrainTo:s}=n;if(n.isVisible&&i&&i.target){const e=!t||r.height!==t.height,o=!t||r.width!==t.width,a=s&&!Rectangle.from(s).contains(Rectangle.from(n.element,null,!0));(e&&2!==i.zone||o&&1!==i.zone||a)&&n.requestAnimationFrame((()=>n.realign()))}}updateScale(){const e=this,t=e.element,r=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),t.style.display="none";const n=Rectangle.client(r).width/e.configuredWidth,i=e.scale=e.allowGrowWidth?Math.min(n,1):n;t.style.transform=`scale(${i})`,t.style.transformOrigin="top left",t.style.display="",e.allowGrowWidth&&n>1&&(e.width=e.configuredWidth*n)}onParentElementResize(e){this.updateScale()}parseTRBL(e,t="px"){if("number"==typeof(e=e||0))return[`${e}${t}`,`${e}${t}`,`${e}${t}`,`${e}${t}`];const r=e.split(" "),n=r.length;return 1===n?r[1]=r[2]=r[3]=r[0]:2===n?(r[2]=r[0],r[3]=r[1]):3===n&&(r[3]=r[1]),[isFinite(r[0])?`${r[0]}${t}`:r[0],isFinite(r[1])?`${r[1]}${t}`:r[2],isFinite(r[2])?`${r[2]}${t}`:r[3],isFinite(r[3])?`${r[3]}${t}`:r[4]]}static get floatRoot(){const e=this;if(e._floatRoot||(e._floatRoot=document.querySelector(".b-float-root")),e._floatRoot)document.body.contains(e._floatRoot)||document.body.appendChild(e._floatRoot);else{var t;const{outerCls:r}=e,n=null===(t=DomHelper.themeInfo)||void 0===t?void 0:t.name;n&&r.push("b-theme-"+n.toLowerCase()),e._floatRoot=DomHelper.createElement({className:"b-float-root "+r.join(" "),parent:document.body}),BrowserHelper.isAndroid&&(e._floatRoot.style.height=screen.height+"px",EventHelper.on({element:window,orientationchange:()=>e._floatRoot.style.height=screen.height+"px"})),GlobalEvents.on({theme:({theme:t,prev:r})=>{e.floatRoot.classList.add("b-theme-"+t.toLowerCase()),e.floatRoot.classList.remove("b-theme-"+r.toLowerCase())}})}return e._floatRoot}static get outerCls(){const e=[];return BrowserHelper.isTouchDevice&&e.push("b-touch-events"),DomHelper.scrollBarWidth?e.push("b-visible-scrollbar"):e.push("b-overlay-scrollbar"),BrowserHelper.isChrome?e.push("b-chrome"):BrowserHelper.isSafari?e.push("b-safari"):BrowserHelper.isFirefox?e.push("b-firefox"):BrowserHelper.isIE11?e.push("b-ie"):BrowserHelper.isEdge&&e.push("b-edge"),window.ResizeObserver||e.push("b-no-resizeobserver"),e}get isAnimating(){return this._animating}set isAnimating(e){const t=this;e!==t.isAnimating&&(t.element.classList[e?"add":"remove"]("b-animating"),t._animating=e)}static query(e,t=!1){const{idMap:r}=Widget.identifiable;for(const n in r)if(Widget.widgetMatches(r[n],e,t))return r[n];return null}static queryAll(e,t=!1){const{idMap:r}=Widget.identifiable,n=[];for(const i in r)Widget.widgetMatches(r[i],e,t)&&n.push(r[i]);return n}static fromElement(e,t,r){const n=typeof t;e&&e instanceof Event&&(e=e.target),("number"===n||t&&1===t.nodeType)&&(r=t,t=null);let i,s,o,a=e,l=0;for("number"!=typeof r&&(i=r,r=Number.MAX_VALUE),"string"===n&&(t=t.toLowerCase());a&&1===a.nodeType&&l<r&&a!==i;){if(s=a.dataset&&a.dataset.ownerCmp||a.id,s){if(o=Widget.getById(s),o){if(!t)return o;if("function"===n){if(t(o))return o}else if(Widget.widgetMatches(o,t,!0))return o}l++}a=a.parentNode}return null}triggerFieldChange(e,t=!0){t&&this.trigger("change",e),this.eachAncestor((t=>{t.onFieldChange&&t.onFieldChange(e)}))}static widgetMatches(e,t,r){return"*"===t||("function"==typeof t?t(e):Widget.isType(e,t,r))}static attachTooltip(e,t){return"string"==typeof t&&(t={html:t}),Widget.create(Object.assign({forElement:e},t),"tooltip"),e}}Widget.initClass(),Widget.register("mask",Mask),DomHelper.Widget=Widget,GlobalEvents.Widget=Widget,Mask.identifiable.idMap=Widget.identifiable.idMap,(window.bryntum||(window.bryntum={})).get=Widget.getById.bind(Widget),window.bryntum.Widget=Widget,window.bryntum.query=Widget.query,window.bryntum.queryAll=Widget.queryAll,window.bryntum.fromElement=Widget.fromElement,Widget._$name="Widget";class Toast extends Widget{static get $name(){return"Toast"}static get type(){return"toast"}static get defaultConfig(){return{testConfig:{timeout:100,destroyTimeout:1},floating:!0,timeout:2500,destroyTimeout:200,showProgress:!0,color:null,bottomMargin:20}}doDestroy(){const e=Toast.toasts.indexOf(this);e>-1&&Toast.toasts.splice(e,1),super.doDestroy()}set element(e){}get element(){if(!this._element&&!this.isConfiguring){const e=this,t=Toast.toasts.length&&Toast.toasts[0].element,r=t?t._nextBottom:e.bottomMargin,n=super.element=DomHelper.createElement({parent:e.appendTo||Widget.floatRoot,children:e.showProgress?[{className:"b-toast-progress",style:`animation-duration:${e.timeout/1e3}s;`}]:null,html:e._html,className:e.color||"",style:e._style||""});EventHelper.on({element:n,click:"hide",thisObj:e}),Toast.toasts.unshift(e),n._nextBottom=r+n.offsetHeight+e.bottomMargin,n.style.cssText+=`;bottom:${r}px;transform:translateY(0)`}return super.element}show(){super.show(),this.timeout>0&&(this.hideTimeout=this.setTimeout("hide",this.timeout))}hide(){const e=this;e.destroyTimer||(e.element.classList.add("b-toast-hide"),e.element.style.bottom="",e.destroyTimer=e.setTimeout("destroy",e.destroyTimeout))}static hideAll(){Toast.toasts.reverse().forEach((e=>e.hide()))}static show(e){const t=new Toast("string"==typeof e?{html:e}:e);return t.show(),t}}Toast.toasts=[],Toast.initClass(),Toast._$name="Toast";class WidgetHelper{static getById(e){return Widget.getById(e)}static fromElement(e,t,r){return Widget.fromElement(e,t,r)}static createWidget(e={}){return e.isWidget?e:Widget.create(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),t.insertFirst){const e="string"==typeof t.insertFirst?document.getElementById(t.insertFirst):t.insertFirst;e.firstChild?t.insertBefore=e.firstChild:t.appendTo=e}return e.map((e=>Widget.create(ObjectHelper.assign({},t||{},e))))}static openPopup(e,t){return Widget.create(ObjectHelper.assign({forElement:e},"string"==typeof t?{html:t}:t),"popup")}static showContextMenu(e,t){const r=this;return r.currentContextMenu&&r.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:Array.isArray(e)?t.forElement={target:new Point(...e)}:e instanceof Point&&(t.forElement={target:e}),r.currentContextMenu=Widget.create(t,"menu"),r.currentContextMenu.on("destroy",(()=>{r.currentContextMenu=null})),r.currentContextMenu}static attachTooltip(e,t){return Widget.attachTooltip(e,t)}static hasTooltipAttached(e){return Widget.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return Widget.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={target:e,text:t}),Mask.mask(e,e.target)}static unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}static toast(e){return Toast.show(e)}}WidgetHelper._$name="WidgetHelper";class RandomGenerator{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){let t,r=this.randomCache;return r[e]?t=r[e]:(t=this.random100.filter((t=>t<e)),r[e]=t),t[this.rndIndex++%t.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}}RandomGenerator._$name="RandomGenerator";class DataGenerator{static reset(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}static*generate(e,t=!1,r=1){const n=this,i=n.rnd,s=n.rndTime,o=n.rndRating,a=n.firstNames,l=n.surNames,c=n.teams,d=n.foods,u=n.colors,h=n.cities;for(let n=0;n<e;n++){const g=i.fromArray(a),m=i.fromArray(l),p=`${g} ${String.fromCharCode(65+n%25)} ${m}`,f=i.nextRandom(60)+1,v=new Date(2019,0,f),y=new Date(2019,0,f+i.nextRandom(30)+2),b={id:n+r,title:"Row "+n,name:p,firstName:g,surName:m,city:i.fromArray(h),team:i.fromArray(h)+" "+i.fromArray(c),age:10+i.nextRandom(80),food:i.fromArray(d),color:i.fromArray(u),score:10*i.nextRandom(100),rank:i.nextRandom(100)+1,start:v,finish:y,time:DateHelper.getTime(s.nextRandom(24),5*s.nextRandom(12)),percent:i.nextRandom(100),done:i.nextRandom(100)<50,rating:o.nextRandom(5),relatedTo:Math.min(e-1,n+r+i.nextRandom(10))};t&&(b.rowHeight=5*i.nextRandom(!0===t?20:t)+20),yield b}}static generateData(e,t=!1,r=1,n=!0){n&&this.reset();const i=[],s=DataGenerator.overrideRowCount?DataGenerator.overrideRowCount:e,o=this.generate(s,t,r);for(let e=0;e<s;e++)i.push(o.next().value);return i}}Object.assign(DataGenerator,{rnd:new RandomGenerator,rndTime:new RandomGenerator,rndRating:new RandomGenerator,cities:["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Moscow"],firstNames:["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"],surNames:["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"],teams:["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"],foods:["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"],colors:["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"]}),DataGenerator._$name="DataGenerator";const knownProps=["action","target","to","deltaX","deltaY","x","y","text"];class DemoBot extends(Events(Delayable())){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(e){super.construct(e);const t=this;t.widget&&(t.outerElement=t.widget.element,t.widget.playingDemo=!0),EventHelper.playingDemo=!0,Object.assign(t,{prevTarget:null,currentStep:0,mouse:DomHelper.createElement({parent:t.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),t.intervalId=t.setInterval(t.nextStep.bind(t),1e3),t.outerElement.classList.add("b-playing-demo"),t.outerElement.addEventListener("click",(e=>{e.isTrusted&&t.abort()}))}doDestroy(){this.abort()}abort(e=!1){const t=this;t.mouse.style.top="-100px",t.clearInterval(t.intervalId),t.timeoutId&&t.clearTimeout(t.timeoutId),t.innerIntervalId&&t.clearInterval(t.innerIntervalId),t.outerElement.classList.remove("b-playing-demo"),t.widget&&(t.widget.playingDemo=!1),EventHelper.playingDemo=!1,t.trigger(e?"done":"abort")}triggerEvent(e,t,r){if(!e)return null;let n;if(t.startsWith("mouse")){const e=this.mouse.getBoundingClientRect();n=new MouseEvent(t,Object.assign({view:window,bubbles:!0,cancelable:!0,clientX:e.left,clientY:e.top},r||{}))}else n=document.createEvent("Event"),n.initEvent(t,!0,!1);return e.dispatchEvent(n),n}handleMouseMove(e,t){const r=this,n=r.mouse;n.classList.add("quick"),r.mouseDown&&n.classList.add("drag");const i=Rectangle.from(n,r.outerElement),s=i.x,o=i.y;let a=0,l=0;if(e.to)if("string"==typeof e.to){const t=r.outerElement.querySelector(e.to);if(t){const e=Rectangle.from(t,r.outerElement),n=e.x+e.width/2,i=e.y+e.height/2;a=(n-s)/10,l=(i-o)/10}}else e.to.x?a=(e.to.x-s)/10:(a=e.to[0]/10,l=e.to[1]/10);else e.deltaX?a=e.deltaX/10:e.x&&(a=(e.x-s)/10);e.deltaY&&(l=e.deltaY/10);let c=0;r.innerIntervalId=r.setInterval((()=>{if(r.shouldPause)return;9==c++&&(clearInterval(r.innerIntervalId),e.then&&e.then());const t=s+a*c,i=o+l*c;n.style.left=t+"px",n.style.top=i+"px";const d=n.getBoundingClientRect(),u=d.left,h=d.top,g=DomHelper.elementFromPoint(u,h);g!==r.prevTarget&&(r.prevTarget&&(r.mouseOutElements.push(r.prevTarget),DomHelper.isDescendant(r.mouseOutElements[0],g)||(r.mouseOutElements.forEach((e=>r.triggerEvent(e,"mouseout"))),r.mouseOutElements.length=0)),r.prevTarget=g,r.triggerEvent(g,"mouseover")),r.triggerEvent(g,e.action,{clientX:u,clientY:h})}),50)}getTarget(e){const t=this,r=e.target;return r?"function"==typeof r?r(e):document.querySelector(r):t.prevTarget||t.outerElement}normalizeStep(e){if(e.action)return"function"==typeof e.action?e.action(e):e;if("function"==typeof e)return e(),e;for(const t in e)Object.hasOwnProperty.call(e,t)&&!knownProps.includes(t)&&(e.action=t.toLowerCase(),e.to=e[t]);return e.target||"string"!=typeof e.to&&"function"!=typeof e.to||(e.target=e.to),e}get isScrolling(){const e=this,t=e.outerElement.getBoundingClientRect(),r=e.lastTop&&t.top!==e.lastTop;return e.lastTop=t.top,r}get isInView(){const e=this.outerElement.getBoundingClientRect();return e.top<window.innerHeight&&e.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const e=this;if(e.shouldPause)return;if(e.currentStep===e.steps.length){if(!e.repeat)return e.abort(!0);e.currentStep=0}0===e.currentStep&&e.trigger("initialize");const t=e.mouse,r=e.normalizeStep(e.steps[e.currentStep++]),n=e.getTarget(r),i=r.action;if(n&&i)if(t.className="simulated-mouse","mousemove"===i)e.handleMouseMove(r,n);else{if(n!==e.prevTarget){const r=Rectangle.from(n,e.outerElement);t.style.left=r.x+r.width/2+"px",t.style.top=r.y+r.height/2+"px"}"mousedown"===i&&(e.mouseDown=!0),"mouseup"===i&&(e.mouseDown=!1),e.timeoutId=e.setTimeout((()=>{if(e.prevTarget=n,t.classList.add(i),"type"===i){const e=Widget.fromElement(n),t=r.text.split("|");e.value=t[1===t.length||e.value!=t[0]?0:1]}else e.triggerEvent(n,i)}),"type"===i?100:550)}}}DemoBot._$name="DemoBot";const hasOwnProperty$7=Object.prototype.hasOwnProperty;let cacheKey=null;function setParser(e,t){return Object.defineProperty(e,"parser",{value:t}),t}class Default{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,t){return this.formatter.defaultParse(e,t)}resolvedOptions(){return null}}class Formatter{static get(e){if(null==e)return this.NULL;const t="string"==typeof e?e:JSON.stringify(e),r=this.cache;let n=r.get(t);return n||(cacheKey=t,n=new this(e),r.set(t,n)),n}static get cache(){return hasOwnProperty$7.call(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return hasOwnProperty$7.call(this,"_null")?this._null:this._null=new this(null)}constructor(e){const t=this;if(t.cacheKey=cacheKey,cacheKey=null,t.initialize(),null===e)setParser(t,t.formatter=new Default(t));else{t.configure(e);for(const[e,r]of Object.entries(t.resolvedOptions()))null!=r&&e in t.defaults&&(t[e]=r)}}get parser(){return setParser(this,new this.constructor.Parser(this))}defaultFormat(e){return null==e?e:String(e)}defaultParse(e){return e}format(e){return null==e?e:this.formatter.format(e)}parse(e,t){return null==e?e:this.parser.parse(e,t)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}}Formatter._$name="Formatter";class Fullscreen{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=t=>e.map((e=>{let r=t+StringHelper.capitalize(e);return"moz"===t&&(r=r.replace("screen","Screen"),"mozCancelFullScreen"in document&&"exitFullscreen"===e&&(r="mozCancelFullScreen")),r}));this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];const r=["fullscreenchange","fullscreenerror"],n=e=>r.map((t=>e+StringHelper.capitalize(t)));this.events="fullscreenEnabled"in document&&r||"webkitFullscreenEnabled"in document&&n("webkit")||"mozFullscreenEnabled"in document&&n("moz")||"msFullscreenEnabled"in document&&["MSFullscreenChange","MSFullscreenError"]||[]}static get enabled(){return document[this.functions[0]]}static request(e){return e[this.functions[1]]()}static exit(){return document[this.functions[2]]()}static get isFullscreen(){return!!document[this.functions[3]]}static onFullscreenChange(e){document.addEventListener(this.events[0],e)}static unFullscreenChange(e){document.removeEventListener(this.events[0],e)}}Fullscreen.init(),Fullscreen._$name="Fullscreen";const escapeRegExp=StringHelper.escapeRegExp,digitsRe=/[\d+-]/g,newFormatter=(e,t)=>new Intl.NumberFormat(e||void 0,t),numFormatRe=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/;class NumberParser{constructor(e){const t=this,r=e.locale,n=newFormatter(r,{maximumFractionDigits:3}),i=e.is.currency?t._decodeStyle(r,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,s=e.is.percent?t._decodeStyle(r,{style:"percent"}):null,o=n.format(1.2).replace(digitsRe,"")[0],a=n.format(1e9).replace(digitsRe,"")[0];Object.assign(t,{currency:i,decimal:o,formatter:e,grouper:a,percent:s}),t.decimal=o,t.decimalRe=escapeRegExp(o,"g"),t.grouper=a,t.stripRe=new RegExp(`(?:\\s+|${escapeRegExp(a)})`+(i?`|(?:${escapeRegExp(i.text)})`:"")+(s?`|(?:${escapeRegExp(s.text)})`:""),"g")}parse(e,t){return"string"==typeof e&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,"."),e=t?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,t){const r=newFormatter(e,t),n=newFormatter(e,Object.assign(r.resolvedOptions(),{style:"decimal"})),i=r.format(0),s=n.format(0);return{suffix:i.startsWith(s),text:i.replace(s,"").trim()}}}class NumberFormat extends Formatter{static get $name(){return"NumberFormat"}initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}configure(e){const t=this;"string"!=typeof e?Object.assign(t,e):t.template=e;const r={},n=t.locale?LocaleManagerSingleton.locales[t.locale]:LocaleManagerSingleton.locale,i=n&&n.NumberFormat,s=t.template;if(i)for(const e in i)null==t[e]&&"function"!=typeof i[e]&&(t[e]=i[e]);if(s){const e=numFormatRe.exec(s),r=e[2],n=e[4];t.useGrouping=!!e[3],t.style=e[1]?"currency":e[6]?"percent":"decimal",r&&(t.integer=+r),"*"===n?t.fraction=[0,20]:null!=n&&(t.fraction=[e[5].length,n.length])}t._minMax("fraction",!0,!0),t._minMax("integer",!0,!1),t._minMax("significant",!1,!0);for(const e in t.defaults)null!=t[e]&&(r[e]=t[e]);t.is.from=t.from&&t.from.is,t.is[t.style]=!(t.is.null=!1),t.formatter=newFormatter(t.locale,r)}as(e,t=null){const r=this.resolvedOptions()||{template:"9.*"},n=this._as;let i=t&&n[t];return i||("string"==typeof e?r.style=e:Object.assign(r,e),r.from=this,i=new NumberFormat(r)),t&&(n[t]=i),i}defaultParse(e,t){return null==e?e:t?Number(e):parseFloat(e)}format(e){if("string"==typeof e){const t=Number(e);e=isNaN(t)?this.parse(e):t}return super.format(e)}round(e){return this.parse(this.format(e))}truncate(e){const t=this.maximumFractionDigits;let r,n,i=this.parse(e);return null!=t&&(n=this.as({style:"decimal",maximumFractionDigits:Math.min(20,t+1)},"truncator"),i=n.format(i),r=i.indexOf(n.parser.decimal),r>-1&&i.length-r-1>t&&(i=i.substr(0,r+t+1)),i=n.parse(i)),i}resolvedOptions(){const e=super.resolvedOptions();for(const t in e)void 0===e[t]&&(e[t]=this[t]);return e}_minMax(e,t,r){const n=this,i=n[e];if(null!=i){const s=StringHelper.capitalize(e),o=`maximum${s}Digits`,a=`minimum${s}Digits`;"number"==typeof i?(t&&(n[a]=i),r&&(n[o]=i)):(n[a]=i[0],n[o]=i[1])}}}NumberFormat.Parser=NumberParser,Object.assign(NumberFormat.prototype,{defaults:{style:"decimal",currency:null,currencyDisplay:"symbol",locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,useGrouping:!0},fraction:null,from:null,integer:null,significant:null,template:null}),Object.assign(NumberFormat.prototype,NumberFormat.prototype.defaults),Formatter.number=(e,t)=>NumberFormat.format(e,t),NumberFormat._$name="NumberFormat";var Finalizable=e=>class extends(e||Base){static get $name(){return"Finalizable"}construct(...e){super.construct(...e),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}doFinalize(){this.destroy()}finalize(){const e=this;let t=e.finalizing;return t||e.isFinalized||(e.isFinalizing=!0,e.finalizing=t=e._awaitFinalizer()),t}async _awaitFinalizer(){const e=this;try{await e.finalizer}finally{e.finalizing=null,e.isFinalized=!0,e.doFinalize()}}};const ABORTED=Symbol("dragAbort"),INIT=Symbol("dragInit"),DRAGGING=Symbol("dragDrag"),DROPPED=Symbol("dragDrop"),lockDirections={x:"horizontal",y:"vertical"};class DragContext extends(Base.mixin(Finalizable,Delayable)){static get configurable(){return{itemElement:null,scrollManager:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300}}construct(...e){super.construct(...e);const t=this,{event:r}=t;Object.assign(t,{altKey:null,cleaners:[],ctrlKey:null,data:new Map,element:r.target,endEvent:null,lastMoveEvent:null,metaKey:null,scrollerAction:null,shiftKey:null,state:INIT,startEvent:r,touchStartTimer:null,_valid:!0}),"touches"in r&&(t.touchStartTimer=t.setTimeout((()=>t.touchStartTimer=null),t.touchStartDelay,"touchStartDelay"))}doDestroy(){const e=this,{source:t,target:r}=e;e.cleanup(),(null==r?void 0:r.dropping)===e&&(r.dropping=null),(null==t?void 0:t.dragging)===e&&(t.dragging=null),super.doDestroy()}get aborted(){return this.state===ABORTED}get completed(){return this.aborted||null!==this.endEvent}get started(){return this.state!==INIT&&!this.aborted}get valid(){return this.started&&null!=this.targetElement&&this._valid}set valid(e){this._valid=e}async get(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(!this.completed)throw new Error("Data is not available until drag completion");if(Array.isArray(e))return Promise.all(e.map((e=>this.get(e))));let t=this.data.get(e);return"function"==typeof t&&(t=await t(),this.data.set(e,t)),t}has(e){return this.data.has(e)}peek(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(e))return e.map((e=>this.peek(e)));let t=this.data.get(e);return"function"==typeof t&&(t=!0),t}set(e,t){this.data.set(e,t)}changeTarget(e,t){if(e!==t){const r=this;r._target=e,t&&(t.dropping=null),e&&(e.dropping=r,e.dropping!==r&&(e=null,r.valid=!1)),r._target=t}return e}updateTarget(e,t){const r=this;t&&r.source.dragLeaveTarget(r,t),e&&(r.valid=!0,e.dragMove(r),r.source.dragEnterTarget(r))}updateTargetElement(e){const t=null==e?void 0:e.closest(".b-droppable");t&&t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY&&(this.target=DomDataStore.get(t,"droppable")||null)}abort(){const e=this,{element:t,source:r}=e;null==t||t.getBoundingClientRect(),e.state!==DROPPED&&(e.state=ABORTED,e.cleanup()),null==r||r.endDrag(e)}begin(){const e=this,{source:t}=e;!1!==t.beforeDrag(e)&&(t.dragging=e)}cleanup(){let e;for(;e=this.cleaners.pop();)e()}end(e){const t=this,{lastMoveEvent:r,target:n}=t,{dragSwallowClickTime:i}=t.source;t.event=t.endEvent=e,t.syncFlags(),t.started&&((null==r?void 0:r.clientX)===e.clientX&&(null==r?void 0:r.clientY)===e.clientY&&(null==r?void 0:r.target)===e.target||t.track(),i&&EventHelper.on({element:document,capture:!0,expires:i,once:!0,click(e){e.stopPropagation()}}),t.state=DROPPED,n!==t.source&&(null==n||n.dragDrop(t)))}fakeKey(e,t){const r=this,{lastMoveEvent:n}=r;if(n&&r.element){let i;n.isKey=!0,"Alt"===e.key?r.altKey!==t&&(r.altKey=t,i=!0):"Control"===e.key&&r.ctrlKey!==t&&(r.ctrlKey=t,i=!0),i&&(r.event=n,r.track())}}keyDown(e){this.completed||("Escape"===e.key?this.abort():this.isDragToggleKey(e.key)&&this.fakeKey(e,!0))}keyUp(e){!this.completed&&this.isDragToggleKey(e.key)&&this.fakeKey(e,!1)}getDistance(e){return EventHelper.getDistanceBetween(this.startEvent,e)}isDragToggleKey(e){return"Control"===e||"Alt"===e}move(e){const t=this,{target:r}=e,n=t.getDistance(e)>=t.threshold;if(t.syncFlags(),t.touchStartTimer)n&&t.abort();else if(r&&r.nodeType===Node.ELEMENT_NODE){if(n&&!t.started&&(t.event=e,!1===t.start()))return void t.abort();t.started&&(t.lastMoveEvent=t.event=e,"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.track())}}start(){const e=this,{scrollManager:t,source:r}=e,{draggingBodyCls:n,dragLock:i}=r,s=r.dragRootElement;if(e.state=DRAGGING,t&&(t.startMonitoring({thisObj:r,direction:lockDirections[i]||i||"both",element:s,callback(t){const{lastMoveEvent:r}=e;r&&e.element&&(r.isScroll=!0,e.event=r,e.scrollerAction=t,e.track(),e.scrollerAction=null)}}),e.cleaners.push((()=>t.stopMonitoring(s)))),document.body.classList.add(n),e.cleaners.push((()=>document.body.classList.remove(n))),!1===r.startDrag(e))return e.cleanup(),!1}syncFlags(){const e=this,{event:t}=e;e.altKey=t.altKey,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey}track(){const e=this,{event:t,source:r,target:n}=e;let i,s=t.target;"touchmove"===t.type&&(i=t.changedTouches[0],s=DomHelper.elementFromPoint(i.clientX,i.clientY)),e.targetElement=s,n===e.target&&(null==n||n.dragMove(e)),r.trackDrag(e)}}DragContext.prototype.STATE=DragContext.STATE=Object.freeze({ABORTED:ABORTED,INIT:INIT,DRAGGING:DRAGGING,DROPPED:DROPPED}),DragContext._$name="DragContext";class DragProxy extends(Base.mixin(Factoryable)){static get type(){return"default"}static get configurable(){return{dragging:null}}static get factoryable(){return{defaultType:DragProxy}}updateDragging(e,t){t&&this.close(t),e&&this.open(e)}close(e){}open(e){}dragStart(e){this.dragging=e}dragMove(e){}dragEnd(e){this.dragging=null}}DragProxy.initClass(),DragProxy._$name="DragProxy";var Draggable=e=>class extends(e||Base){static get $name(){return"Draggable"}static get configurable(){return{dragging:null,draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,testConfig:{dragSwallowClickTime:BrowserHelper.isEdge?300:50}}}static get properties(){return{draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started"}}dragStart(e){}dragOver(e){}dragEnterTarget(e){}dragLeaveTarget(e,t){}dragDrop(e){}dragEnd(e){}get activeDrag(){const{dragging:e}=this;return(null==e?void 0:e.started)&&!e.completed?e:null}get dragEventer(){return this.callPreventable?this:null}get draggingClassElement(){const{draggingClsSelector:e,dragRootElement:t}=this;return e?null==t?void 0:t.closest(e):t}beforeDrag(e){const{dragSelector:t}=this;return!t||e.element.matches(t)}beginDrag(e){const{draggingCls:t,draggingClassElement:r}=this;t&&r&&(r.classList.add(t),e.cleaners.push((()=>r.classList.remove(t))))}async endDrag(e){const t=this,{dragEventer:r,dragProxy:n}=t;t.dragEnd(e),e.valid&&await t.dragDrop(e),null==n||n.dragEnd(e),null==r||r.trigger(e.valid?"drop":"dragCancel",{drag:e,event:e.event}),t.finalizeDrag(e)}async finalizeDrag(e){await e.finalize()}moveDrag(e){if(!1!==this.dragOver(e)){const{dragEventer:t,dragProxy:r}=this;null==r||r.dragMove(e),null==t||t.trigger("drag",{drag:e,event:e.event})}}setupDragContext(e){const t=this,{dragItemSelector:r}=t,{target:n}=e;return{event:e,itemElement:r?n.closest(r):n,touchStartDelay:t.dragTouchStartDelay,source:t,threshold:t.dragThreshold}}startDrag(e){const{draggingStartedCls:t,draggingClassElement:r,draggingItemCls:n,dragEventer:i,dragProxy:s}=this,{itemElement:o}=e;if(!1===(null==i?void 0:i.trigger("beforeDragStart",{drag:e,event:e.event})))return!1;t&&r&&(r.classList.add(t),e.cleaners.push((()=>r.classList.remove(t)))),n&&o&&(o.classList.add(n),e.cleaners.push((()=>o.classList.remove(n)))),null==s||s.dragStart(e),this.dragStart(e),null==i||i.trigger("dragStart",{drag:e,event:e.event})}trackDrag(e){var t;const{dropTargetSelector:r}=this;e.valid=!(r&&!(null===(t=e.targetElement)||void 0===t?void 0:t.closest(r))),this.moveDrag(e)}updateDragging(e){const t=this;if(e){const r=ObjectHelper.assign({thisObj:t},t.dragDocumentListeners);"touches"in e.startEvent?(delete r.mousemove,delete r.mouseup):(delete r.contextmenu,delete r.touchmove,delete r.touchend,delete r.pointerup),e.cleaners.push(EventHelper.on(r)),t.beginDrag(e)}}changeDragProxy(e,t){return DragProxy.reconfigure(t,e,{owner:this,defaults:{owner:this}})}updateDragRootElement(e){var t;const r=this;null===(t=r._dragRootDetacher)||void 0===t||t.call(r),r._dragRootDetacher=e&&EventHelper.on({thisObj:r,element:e,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart"})}onDragContextMenu(e){e.preventDefault()}onDragKeyDown(e){this.dragging.keyDown(e)}onDragKeyUp(e){this.dragging.keyUp(e)}onDragMouseDown(e){0===e.button&&this.onDragPointerDown(e)}onDragPointerDown(e){let{dragging:t}=this;t?t.isFinalizing||t.abort():(t=new DragContext(this.setupDragContext(e)),t.begin())}onDragPointerMove(e){const{dragging:t}=this;t&&!t.completed&&(null==t||t.move(e))}onDragPointerUp(e){const{dragging:t}=this;t&&!t.completed&&(t.end(e),this.endDrag(t))}onDragTouchStart(e){1===e.touches.length&&this.onDragPointerDown(e)}},Droppable=e=>class extends(e||Base){static get $name(){return"Droppable"}static get configurable(){return{dropping:null,dropRootElement:{$config:"nullify",value:null}}}get droppableCls(){return"b-droppable"}dragEnter(e){}dragMove(e){}dragDrop(e){}dragLeave(e){}changeDropping(e,t){if(e!==t){const r=this;t&&(!t.aborted&&t.completed||r.dragLeave(t)),e&&(r._dropping=e,!1===r.dragEnter(e)&&(e=null),r._dropping=t)}return e}updateDropRootElement(e,t){const{droppableCls:r}=this;t&&(t.classList.remove(r),DomDataStore.get(t,"droppable")===this&&DomDataStore.remove(t,"droppable")),e&&(e.classList.add(r),DomDataStore.set(e,"droppable",this))}};const PENDING=Symbol("pendingCreate");class DynamicObject extends Base{static get prototypeProperties(){return{created:null,factory:null,inferType:"name",owner:null,ownerName:null,proxyable:"undefined"!=typeof Proxy,setup:null}}static get properties(){return{defaults:{},instances:{},object:Object.create({})}}get proxy(){const e=this;let t=null;return e.proxyable&&(t=new Proxy(e.instances,{get:(t,r)=>e.get(r),set:(t,r,n)=>(e.set(r,n),!0),deleteProperty:(t,r)=>(e.set(r,null),!0)})),Reflect.defineProperty(e,"proxy",{configurable:!0,value:t}),t}get target(){return this.proxy||this.object}define(e,t){this.instances[e]=PENDING,this.setDefaults(e,t),this.defineProp(e,!0)}defineProp(e,t){const r=this,{object:n}=r;r.proxy||Reflect.defineProperty(t?Object.getPrototypeOf(n):n,e,{configurable:!t,enumerable:!t,get:()=>r.get(e),set:t=>r.set(e,t)})}flush(){for(const e in this.defaults)this.get(e)}get(e){const{defaults:t,instances:r}=this;return r[e]===PENDING&&this.set(e,PENDING),r[e]||t[e]&&null}set(e,t){const r=this,{defaults:n,factory:i,instances:s,setup:o}=r,a=s[e]===PENDING?null:s[e],l=i.reconfigure(a,t===PENDING?{}:t||null,{defaults:n[e]||r.setDefaults(e,{}),owner:r.owner,setup:o&&((t,r,n)=>o(t,e,r,n))});var c;l!==a&&(s[e]=l,l?(r.defineProp(e),null===(c=r.created)||void 0===c||c.call(r,l,e)):(delete r.object[e],delete s[e]))}setDefaults(e,t){const{defaults:r,factory:n,inferType:i,instances:s,owner:o,ownerName:a}=this,{typeKey:l}=n.factoryable;return t=!0===t?{}:ObjectHelper.assign({},t),("name"===i||!0===i&&!t[l])&&(t[l]=e),a&&(t[a]=o),t.beforeConfigure=t=>{s[e]=t},r[e]=t}update(e){const t=this;let r,n;if(e)for(r in e)n=e[r],t.defaults[r]?t.set(r,n):n&&t.define(r,n);else for(r in t.instances)t.set(r,null)}}DynamicObject.initClass(),DynamicObject._$name="DynamicObject";var Featureable=e=>class extends(e||Base){static get $name(){return"Featureable"}static get configurable(){return{features:null}}static get declarable(){return["featureable"]}static setupFeatureable(e){const t={ownerName:"client",...e.featureable};t.factory.initClass(),Reflect.defineProperty(e,"featureable",{get:()=>t})}afterConfigure(){var e;super.afterConfigure(),null===(e=this.$features)||void 0===e||e.flush()}doDestroy(){this.features=null,super.doDestroy()}hasFeature(e){var t;return Boolean(null===(t=this.features)||void 0===t?void 0:t[e])}changeFeatures(e){const t=this,{featureable:r}=t.constructor,n=t.$features||(t.$features=new DynamicObject({factory:r.factory,owner:t,ownerName:r.ownerName}));return n.update(e),t.isConfiguring||n.flush(),n.target}get widgetClass(){}};const EDGES={e:"b-hover-edge",t:"b-hover-top",r:"b-hover-right",b:"b-hover-bottom",l:"b-hover-left"},EDGE_CLASSES={[EDGES.e]:1,[EDGES.t]:1,[EDGES.r]:1,[EDGES.b]:1,[EDGES.l]:1},ZONES={t:[EDGES.e,EDGES.t],r:[EDGES.e,EDGES.r],b:[EDGES.e,EDGES.b],l:[EDGES.e,EDGES.l],tr:[EDGES.e,EDGES.t,EDGES.r],bl:[EDGES.e,EDGES.b,EDGES.l],tl:[EDGES.e,EDGES.t,EDGES.l],br:[EDGES.e,EDGES.b,EDGES.r]};var Hoverable=e=>class extends(e.mixin(Delayable)){static get $name(){return"Hoverable"}static get configurable(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}static get delayable(){return{setHoverTarget:0}}hoverEnter(e){}hoverIgnore(e){var t;return null===(t=this.hoverIgnoreElement)||void 0===t?void 0:t.contains(e)}hoverLeave(e){}hoverMove(e){}onHoverMouseMove(e){const t=this,{hoverEdges:r,hoverEdgeSize:n,hoverTarget:i}=t;if(i){if(r){const{top:s,left:o,width:a,height:l,right:c,bottom:d}=i.getBoundingClientRect(),{clientX:u,clientY:h}=e,g=o+a/2,m=s+l/2,p=h<(n?s+n:m),f=u>=(n?c-n:g),v=h>=(n?d-n:m),y=u<(n?o+n:g),b=p||v?p?"t":"b":"",C=f||y?f?"r":"l":"";t.hoverZone=(r.includes(b)?b:"")+(r.includes(C)?C:"")}t.hoverEvent=e,t.hoverTrack&&t.hoverMove(e)}}onHoverMouseOver(e){this.hoverEvent=e,this.hoverElement=e.target}onHoverMouseOut(e){this.hoverEvent=e,this.hoverElement=e.relatedTarget}updateHoverDelay(e){this.setHoverTarget.delay=e}changeHoverEdges(e){return!0===e?"trbl":(e||"").replace("v","tb").replace("h","lr")}updateHoverEdges(){this.syncHoverListeners()}changeHoverElement(e){if(!this.hoverIgnore(e))return e}updateHoverElement(e){const{hoverSelector:t}=this;var r;t&&(e=null===(r=e)||void 0===r?void 0:r.closest(t));this.setHoverTarget(e)}updateHoverRootElement(e,t){const{hoverRootCls:r}=this;r&&(null==t||t.classList.remove(r),null==e||e.classList.add(r)),this.syncHoverListeners()}changeHoverTarget(e,t){return t&&(this.hoverZone=null),e}updateHoverTarget(e,t){const r=this,{hoverCls:n,hoverAnimationCls:i,hoverRootActiveCls:s,hoverRootElement:o}=r;s&&(null==o||o.classList[e?"add":"remove"](s)),t&&(n&&t.classList.remove(n),i&&t.classList.remove(i),r.hoverLeave(t)),e&&(n&&e.classList.add(n),r.hoverEnter(t),r.hoverTrack&&r.hoverMove(r.hoverEvent),i&&(e.getBoundingClientRect(),e.classList.add(i)))}updateHoverTrack(){this.syncHoverListeners()}updateHoverZone(e){const{hoverAnimationCls:t,hoverTarget:r}=this;if(r){const{className:n}=r,i=DomClassList.change(n,e?ZONES[e]:null,EDGE_CLASSES);n!==i&&(r.className=i,e&&t&&(r.classList.remove(t),r.getBoundingClientRect(),r.classList.add(t)))}}setHoverTarget(e){this.hoverTarget=e}syncHoverListeners(){var e;const t=this,r=t.hoverRootElement,n={element:r,thisObj:t,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(t.hoverTrack||t.hoverEdges)&&(n.mousemove="onHoverMouseMove"),null===(e=t._hoverRootDetacher)||void 0===e||e.call(t),t._hoverRootDetacher=r&&EventHelper.on(n)}};const excludedPropNames={constructor:1,prototype:1,name:1,length:1,arguments:1,caller:1,callee:1,__proto__:1};class Override{static apply(e){if(!e.target)throw new Error("Override must specify what it overrides, using static getter target");if(!e.target.class)throw new Error("Override must specify which class it overrides, using target.class");if(!this.shouldApplyOverride(e))return!1;const t=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(e.prototype);return t.splice(t.indexOf("target"),1),this.internalOverrideAll(e.target.class,t,e),this.internalOverrideAll(e.target.class.prototype,r,e.prototype),!0}static internalOverrideAll(e,t,r){Reflect.ownKeys(r).forEach((n=>{if(t.includes(n)&&!excludedPropNames[n]){const t=Object.getOwnPropertyDescriptor(r,n);let i=e,s=null;for(;!s&&i;)s=Object.getOwnPropertyDescriptor(i,n),s||(i=Object.getPrototypeOf(i));s&&this.internalOverride(i,n,t,s)}}))}static internalOverride(e,t,r,n){(e._overridden=e._overridden||{})[t]=e[t],n.get?Object.defineProperty(e,t,{enumerable:!1,configurable:!0,get:r.get}):e[t]=r.value}static shouldApplyOverride(e){const t=e.target;if(!t.maxVersion&&!t.minVersion)return!0;if(!t.product)throw new Error("Override must specify product when using versioning");return(!t.maxVersion||!VersionHelper[t.product].isNewerThan(t.maxVersion))&&(!t.minVersion||!VersionHelper[t.product].isOlderThan(t.minVersion))}}Override._$name="Override";class ClickRepeater extends(Delayable(Base)){static get defaultConfig(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3}}doDestroy(){this.mousedownRemover&&this.mousedownRemover(),super.doDestroy()}set element(e){this._element=e,this.mousedownRemover=EventHelper.on({element:e,mousedown:"onMouseDown",thisObj:this})}get element(){return this._element}onMouseDown(e){const t=this,r=t.delegate?e.target.closest(t.delegate):t.element;r&&(t.triggerEvent=e,EventHelper.lockComposedPath(t.triggerEvent),t.activeListenerRemover=EventHelper.on({mouseup:{element:document,handler:"onMouseUp"},mousemove:{element:r,handler:"onTargetMouseMove"},mouseleave:{element:r,handler:"onTargetMouseLeave"},mouseenter:{element:r,handler:"onTargetMouseEnter"},thisObj:t}),t.setTimeout("startAutoRepeat",t.delay))}onMouseUp(e){const t=this;t.acceleration&&t.acceleration.cancel(),t.activeListenerRemover&&t.activeListenerRemover(),t.clearTimeout("startAutoRepeat"),t.clearTimeout(t.repeatTimer)}onTargetMouseLeave(){this.clearInterval(this.repeatTimer)}onTargetMouseEnter(e){this.triggerEvent=e,this.fireClick()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=FunctionHelper.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,t=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(t),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}}ClickRepeater._$name="ClickRepeater";class Tool extends Widget{static get $name(){return"Tool"}static get type(){return"tool"}static get configurable(){return{align:{value:null,$config:{merge:"replace"}}}}changeAlign(e){return e}template(){return`<button class="b-icon b-align-${this.align||"end"}"></button>`}construct(e){super.construct(e),EventHelper.on({element:this.element,click:"onClick",thisObj:this})}get focusElement(){return this.element}onClick(e){const{handler:t,panel:r}=this;!1!==r.trigger("toolclick",{domEvent:e,tool:this})&&t&&this.callback(t,r,[e])}onInternalKeyDown(e){"Enter"===(e.key.trim()||e.code)&&(e.cancelBubble=!0,e.stopPropagation())}get panel(){return this.parent}}Tool.initClass(),Tool._$name="Tool";class Layout extends(Events(Base)){static get configurable(){return{containerCls:"b-auto-container",itemCls:null}}static getLayout(e,t){if(e instanceof Layout)return e.owner=this,e;const r={owner:t};return"string"==typeof e?r.type=e:ObjectHelper.assign(r,e),new layoutClasses[r.type||"default"](r)}static registerLayout(e,t=e.$$name.toLowerCase()){layoutClasses[t]=e}onChildAdd(e){}onChildRemove(e){}renderChildren(){const{owner:e,containerCls:t,itemCls:r}=this,{contentElement:n,items:i}=e,s=e.itemCls,o=i&&i.length;if(n.classList.add("b-content-element"),t&&n.classList.add(t),o){e.textContent=!1;for(let t=0;t<o;t++){const o=i[t],{element:a}=o;a.dataset.itemIndex=t,r&&a.classList.add(r),s&&a.classList.add(s),a.classList.remove("b-outer"),o.render(n,Boolean(e.isPainted))}}this.syncChildCount()}removeChild(e){const{element:t}=e,{owner:r,itemCls:n}=this,{contentElement:i}=r,s=r.itemCls;i.removeChild(t),delete t.dataset.itemIndex,n&&t.classList.remove(n),s&&t.classList.remove(s),this.fixChildIndices(),this.syncChildCount()}appendChild(e){const{element:t}=e,r=this.owner.indexOfChild(e),{owner:n,itemCls:i}=this,{contentElement:s}=n,o=n.itemCls;t.dataset.itemIndex=r,n.textContent=!1,i&&t.classList.add(i),o&&t.classList.add(o),e.render(s,Boolean(n.isPainted)),this.syncChildCount()}insertChild(e,t){const{element:r}=e,{owner:n,itemCls:i}=this,{contentElement:s}=n,o=s.querySelector(`[data-item-index="${t}"]`),a=n.itemCls;n.textContent=!1,i&&r.classList.add(i),a&&r.classList.add(a),s.insertBefore(r,o),e.render(null,Boolean(n.isPainted)),this.fixChildIndices(),this.syncChildCount()}fixChildIndices(){this.owner.items.forEach(((e,t)=>{e.element.dataset.itemIndex=t}))}syncChildCount(){const{owner:e}=this,{length:t}=e.items;e.contentElement.classList[1===t?"add":"remove"]("b-single-child")}}const layoutClasses={default:Layout};Layout._$name="Layout";let lastTouchTime=0;const hasRipple=e=>e.ripple,Ripple=window.Ripple=new class extends Widget{static get defaultConfig(){return{id:"bryntum-ripple",old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,scrollAction:"realign",color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}static get $name(){return"Ripple"}afterConstruct(){super.afterConstruct(),EventHelper.on({element:document,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}onRippleControllingEvent(e){const t=this;t.show();const r=DomHelper.getStyleValue(t.circleElement,"animationName");t.hide(),t.listenerDetacher&&t.listenerDetacher(),r&&"none"!==r&&(t.listenerDetacher=EventHelper.on({mousedown:{element:document,capture:!0,handler:"onDocumentMousedown"},touchstart:{element:document,capture:!0,handler:"onDocumentTouchStart"},animationend:{element:t.circleElement,handler:"onAnimationEnd"},thisObj:t}),"mousedown"===e.type&&(t.onDocumentMousedown(e),GlobalEvents.on({theme:"onRippleControllingEvent",thisObj:this})))}onDocumentTouchStart(e){lastTouchTime=performance.now(),this.handleTriggerEvent(e)}onDocumentMousedown(e){performance.now()-lastTouchTime>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const t=Widget.fromElement(e.target,hasRipple);if(t){const r=t.ripple,n=r.delegate?e.target.closest(r.delegate):t.focusElement||t.element;if(n){const i=ObjectHelper.assign({event:e,target:n,radius:this.radius},r);if("string"==typeof i.clip&&(i.clip=t[i.clip]||e.target.closest(i.clip),!i.clip))return;this.ripple(i)}}}ripple({event:e,point:t=EventHelper.getClientPoint(e),target:r=e.target,clip:n=r,radius:i=this.radius,color:s=this.color}){this.clip=n,n=Rectangle.from(n,null,!0);const o=this,a=n.getDelta(t),l=o.rippleElement.style,c=o.circleElement;o.hide(),o.alignTo(n),l.transform=`translateX(${a[0]}px) translateY(${a[1]}px)`,l.height=l.width=i+"px",c.setAttribute("r",i),c.setAttribute("fill",s),o.show(),o.requestAnimationFrame((()=>{document.addEventListener("scroll",o.callRealign,!0),o.documentScrollListener=!0}))}alignTo(e){1===e.nodeType&&(e=Rectangle.from(e,null,!0));const t=this,{x:r,y:n,width:i,height:s}=e;t.x=r,t.y=n,t.height=s,t.width=i}onAnimationEnd(e){"b-ripple-expand"===e.animationName&&this.hide()}realign(){this.isVisible&&this.alignTo(this.clip)}},emptyObject$1=Object.freeze({}),emptyArray$4=Object.freeze([]),returnWeight=e=>e.weight,sortByWeight=({weight:e},{weight:t})=>"string"==typeof e||"string"==typeof t?String(e).localeCompare(String(t)):(null!=e?e:Number.MAX_SAFE_INTEGER)-(null!=t?t:Number.MAX_SAFE_INTEGER),isNotHidden=e=>!e.hidden;class Container extends Widget{static get $name(){return"Container"}static get type(){return"container"}static get configurable(){return{items:null,lazyItems:{$config:["lazy"],value:null},defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:"default",namedItems:null,textContent:!0,record:null,autoUpdateRecord:null,hideWhenEmpty:null}}startConfigure(e){const t=e.items||e.lazyItems;this.hasItems=Boolean(t&&(Array.isArray(t)?t:Object.keys(t)).length),super.startConfigure(e)}remove(...e){let t=!0;1===e.length&&(Array.isArray(e[0])?e=e[0]:t=!1);const r=this,{_items:n}=r,i=[];for(let t=0;t<e.length;t++){const s=e[t];n.includes(s)&&(n.remove(s),r.layout.removeChild(s),i.push(s),r.onChildRemove(s))}return t?i:i[0]}removeAll(){return this.remove(this.items)}add(...e){let t=!0;1===e.length&&(Array.isArray(e[0])?e=e[0]:t=!1),this.items||(this.items=[]);const r=this,{_items:n}=r,i=[];for(let t=0;t<e.length;t++){let s=e[t];if(null!=s.weight){const e=ArrayHelper.findInsertionIndex(s,r._items.values,sortByWeight);i.push(r.insert(s,e))}else s instanceof Widget?s.parent=r:s=r.createWidget(s),n.includes(s)||(n.add(s),r.onChildAdd(s),r.layout.appendChild(s),i.push(s))}return t?i:i[0]}insert(e,t){this.items||(this.items=[]);const r=this,{_items:n}=r;e instanceof Widget?e.parent=r:e=r.createWidget(e),n.includes(t)&&(t=r.indexOfChild(t)),t=Math.min(t,n.count);const i=n.values;return i.splice(t,0,e),n.values=i,r.onChildAdd(e),r.layout.insertChild(e,t),e}indexOfChild(e){return this.items.indexOf(e)}changeLazyItems(e){this.items=e,this.layout.renderChildren()}changeItems(e){const t=this,r=[],n=new Bag;return Array.isArray(e)?t.processItemsArray(e,r):e&&t.processItemsObject(e,t.namedItems,r),r.some(returnWeight)&&r.sort(sortByWeight),n.add(r),n}updateItems(e){e.forEach(this.onChildAdd,this)}updateHideWhenEmpty(){this.syncChildCount()}get items(){if(this.getConfig("lazyItems"),!this._items){if(this.initializingItems)return[];this.items=emptyArray$4}return this._items.values}processItemsArray(e,t){const r=e.length;let n,i;for(n=0;n<r;n++)i=e[n],i instanceof Widget?(i.parent=this,DomHelper.removeClasses(i.element,Widget.outerCls)):i=this.createWidget(i),i&&t.push(i)}processItemsObject(e,t=emptyObject$1,r){let n,i;for(i in e)n=e[i],n&&(i in t&&(n="object"==typeof n?ObjectHelper.merge(ObjectHelper.clone(t[i]),n):t[i]),n&&(n instanceof Widget?n.parent=this:(n instanceof Object&&(n.ref=i),n=this.createWidget(n)),n&&(n.ref=i,r.push(n))))}onChildAdd(e){const t=e.ref||e.id;if(this.readOnly&&(e.readOnly=!0),this.layout.onChildAdd(e),t)for(let r=this;r;r=r.parent)r.addDescendant(e,t);this.syncChildCount()}onChildHide(){this.syncChildCount()}onChildShow(){this.syncChildCount()}syncChildCount(){if(!this.isConfiguring){const e=this,{childItems:t}=e,{length:r}=t,{length:n}=t.filter(isNotHidden);if(e.hideWhenEmpty){const t=Boolean(!n);Boolean(e._hidden)!==t&&(e.hidden=t)}e.hasItems=Boolean(r),e.contentElement.classList[n?"remove":"add"]("b-no-visible-children"),e.updateTextContent(e._textContent)}}addDescendant(e,t){const r=this._widgetMap||(this._widgetMap={});r[t]||(r[t]=e)}onChildRemove(e){const t=e.ref||e.id;if(t)for(let r=this;r;r=r.parent)r.widgetMap[t]===e&&delete r.widgetMap[t];this.layout.onChildRemove(e),this.syncChildCount()}get widgetMap(){return this._widgetMap||(this._widgetMap={}),this.initializingItems||this.getConfig("items"),this._widgetMap}changeRecord(e){return this._record=null==e?emptyObject$1:null,e}updateRecord(e){this.trigger("beforeSetRecord",{record:e}),this.setValues(e,!0,!this.$highlight)}setRecord(e,t){this.$highlight=t,this.record=e,this.$highlight=!1}onFieldChange({source:e,userAction:t}){if(this.autoUpdateRecord){const{record:r}=this,{name:n,isValid:i,value:s}=e;r&&t&&n&&i&&(r[n]=s)}}getValues(e){const t=this.queryAll((e=>e.name)),r=t.length,n={};for(let i=0;i<r;i++){const r=t[i],s=r.name;e&&!e(r)||(n[s]=r.value)}return n}get hasNoChildren(){const{lazyItems:e}=this.initialConfig,t=e&&(Array.isArray(e)?e:Object.values(e)),{length:r}=(t&&!this._items?t:this.items).filter(isNotHidden);return!r}updateTextContent(e){this.contentElement.classList[e&&this.hasNoChildren?"add":"remove"]("b-text-content"),this.rendered&&this.realign()}updateLayoutStyle(e){DomHelper.applyStyle(this.contentElement,e)}changeLayout(e){return Layout.getLayout(e,this)}get childItems(){return this.items}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}setupWidgetConfig(e,t){const r=this;"string"==typeof e?e={html:e}:1===e.nodeType&&(e={element:e,id:e.id}),("string"==typeof t||!t&&(t=e.type))&&(t=Widget.resolveType(t,!0));for(let n=(e=(t||Widget).mergeConfigs(r.defaults,e,{parent:r})).parent;n;n=n.parent)if(!1===n.processWidgetConfig(e))return null;return!1===r.trigger("beforeWidgetCreate",{widgetConfig:e})?null:e}createWidget(e){return Widget.create(this.setupWidgetConfig(e),this.defaultType)}updateDefaults(e,t){if(!this.isConfiguring){const r=Object.entries(e);this.eachWidget((e=>{r.forEach((([r,n])=>{e[r]===t[r]&&(e[r]=n)}))}),!1)}}render(){this.getConfig("lazyItems"),this.layout.renderChildren(),this.syncChildCount(),super.render(...arguments)}get focusElement(){const e=this.query(this.defaultFocus||(e=>e.isFocusable&&"close"!==e.ref));return e?e.focusElement:super.focusElement}doDestroy(){const{_items:e}=this;e&&e.forEach((e=>e.destroy&&e.destroy())),super.doDestroy()}get isValid(){let e=!0;return this.eachWidget((t=>{"isValid"in t&&!t.isValid&&(e=!1)}),!0),e}get values(){const e={};return this.eachWidget((t=>{"value"in t&&(e[t.name||t.ref||t.id]=t.value)}),!0),e}set values(e){this.setValues(e)}get isSettingValues(){var e;return Boolean(this._isSettingValues||(null===(e=this.parent)||void 0===e?void 0:e.isSettingValues))}setValues(e,t=!1,r=!0){this._isSettingValues={preventHighlight:r},this.eachWidget((n=>{const i=n.highlightExternalChange,s=t?n.name:n.name||n.ref||n.id;"value"in n&&s&&(r&&(n.highlightExternalChange=!1),n.value=e&&s in e?e[s]:null,n.highlightExternalChange=i)}),!0),this._isSettingValues=!1}}Container.initClass(),Container._$name="Container";var Badge=e=>class extends(e||Base){static get $name(){return"Badge"}static get configurable(){return{badge:null}}updateBadge(e){const{element:t}=this;t&&(null!=e&&""!==e?(t.dataset.badge=e,t.classList.add("b-badge")):(t.dataset.badge&&delete t.dataset.badge,t.classList.remove("b-badge")))}get widgetClass(){if(this.badge)return"b-badge"}};const bIcon=/^b-icon-/,bFa=/^b-fa-/;class Button extends(Badge(Widget)){static get $name(){return"Button"}static get type(){return"button"}static get configurable(){return{icon:null,pressedIcon:null,iconAlign:"start",text:"",color:null,toggleable:!1,pressed:!1,toggleGroup:null,ripple:{radius:75},defaultBindProperty:"text",localizableProperties:["text"],menu:{$config:["lazy","nullify"],value:null},menuDefaults:{type:"menu",autoShow:!1,autoClose:!0,floating:!0,scrollAction:"realign",align:"t0-b0"},href:null,target:null,onMenuHideTimeout:300,testConfig:{onMenuHideTimeout:0}}}template(){const e=this,t=e.href?"a":"button";return TemplateHelper.tpl`
            <${t} ${"a"===t?`href="${e.href}"`:""} ${"a"===t&&e.target?`target="${e.target}"`:""} class="${e.color||""} ${e.toggleable&&e.pressed?"b-pressed":""}" ${e.toggleGroup?`data-group="${e.toggleGroup}"`:""}>
                <label data-reference="label">\xa0</label>
            </${t}>
        `}construct(e={},...t){(e.toggleGroup||e.menu)&&(e.toggleable=!0),super.construct(e,...t),EventHelper.on({element:this.element,click:"onInternalClick",thisObj:this})}get childItems(){if(this._menu)return[this.menu]}onFocusOut(e){super.onFocusOut(e),this.menu&&this.menu.hide()}get focusElement(){return this.element}changeText(e){return null==e?"":e}updateText(e){const{element:t,label:r}=this;r.innerText=e,t.classList[String(e).length?"add":"remove"]("b-text")}get menuContainerElement(){return document.body}changeMenu(e,t){const r=this;if(e){const n=()=>!r.isDestroying&&r.setTimeout((()=>r.toggle(!1)),r.onMenuHideTimeout);e.isWidget?(e.forElement=r.element,e.on("hide",n)):("object"!=typeof e||"type"in e||"items"in e||"widgets"in e||"html"in e||(e={lazyItems:e}),e=Widget.reconfigure(t,e?Objects.merge({constrainTo:r.menuContainerElement,forElement:r.element,owner:r,onHide:n},r.menuDefaults,e):null,r))}else t&&t.destroy();return e}updateMenu(e){this.toggleable=Boolean(e)}updatePressed(e){const t=this;e&&t.toggleGroup&&DomHelper.forEachSelector(`button[data-group=${t.toggleGroup}]`,(e=>{e!==t.element&&Widget.getById(e.id).toggle(!1)})),t.element&&t.element.classList[e?"add":"remove"]("b-pressed")}updateIcon(){this.syncIconCls()}updatePressedIcon(){this.syncIconCls()}updateIconAlign(e,t){const r=this.element.classList;t&&r.remove("b-icon-align-"+t),this.icon&&r.add("b-icon-align-"+e)}onInternalClick(e){const t=this,r={event:e};if(t.toggleable){if(t.toggleGroup&&t.pressed)return;if(t.toggle(!t.pressed),t.isDestroyed)return}t.trigger("click",r),t.isDestroyed||t.trigger("action",r),this.href||(e.preventDefault(),e.stopPropagation())}toggle(e=null){const t=this,{menu:r}=t;t.toggleable&&(null===e&&(e=!t.pressed),t.pressed=e,t.toggling=!0,r&&(r.minWidth=t.width,r[e?"show":"hide"]()),t.syncIconCls(),t.trigger("toggle",{pressed:e}),t.toggling=!1)}syncIconCls(){const e=this;let t=e._iconEl;if(e.icon){t||(t=e._iconEl=DomHelper.createElement({tag:"i",nextSibling:e.element.firstChild}));const r=e.pressed&&e.pressedIcon?e.pressedIcon:e.icon;e._iconEl.className=r,bIcon.test(r)?t.classList.add("b-icon"):bFa.test(r)&&t.classList.add("b-fa")}else t&&t.remove()}}Button.initClass(),Button._$name="Button";class Toolbar extends Container{static get $name(){return"Toolbar"}static get type(){return"toolbar"}static get configurable(){return{defaultType:"button",widgetCls:null,layout:"default"}}createWidget(e){"->"===e?e={type:"widget",cls:"b-toolbar-fill"}:"|"===e?e={type:"widget",cls:"b-toolbar-separator"}:"string"==typeof e&&(e={type:"widget",cls:"b-toolbar-text",html:e});const t=super.createWidget(e);return this.widgetCls&&t.element.classList.add(this.widgetCls),t}}Toolbar.initClass(),Toolbar._$name="Toolbar";const acceptNode=e=>!e.classList.contains("b-focus-trap")&&DomHelper.isFocusable(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP,byWeight=(e,t)=>(e.weight||0)-(t.weight||0),byWeightReverse=(e,t)=>(t.weight||0)-(e.weight||0);acceptNode.acceptNode=acceptNode;class Panel extends Container{static get $name(){return"Panel"}static get type(){return"panel"}static get configurable(){return{localizableProperties:["title"],trapFocus:null,title:null,header:null,footer:null,tools:{$config:{nullify:!0},value:null},tbar:{$config:{nullify:!0,merge:"objects"},value:null},bbar:{$config:{nullify:!0,merge:"objects"},value:null}}}set element(e){const t=this,r=t.title&&(!t.parent||!t.parent.suppressChildHeaders),{tools:n,footer:i,tbar:s}=t,o=t.header||(n||r?{}:null),a=t.bbar||t.buttons,l=[{reference:"topFocusTrap",className:"b-focus-trap",tabIndex:0}],c=[],d=[],u={children:l};if((t.hasItems&&!1!==t.focusable||t.focusable)&&(u.tabIndex=0),o){const e="string"==typeof o?o:t.title||o.title,r=o.titleAlign||"start",i=t.classHierarchy(Panel).reduce(((e,t)=>(e[`b-${t.$$name.toLowerCase()}-header`]=1,e)),"string"==typeof o.cls?{[o.cls]:1}:o.cls||{}),s=[{reference:"titleElement",className:"b-header-title b-align-"+r,html:e}];for(const e in n){const t=n[e];"start"===t.align?c.unshift(t):d.push(t)}c.sort(byWeight),d.sort(byWeightReverse),s.unshift(...c.map((e=>e.element))),s.push(...d.map((e=>e.element))),i["b-hide-display"]=!(e||n&&Object.values(n).some((e=>!e.hidden))),i["b-dock-"+(o.dock||"top")]=1,l.push({tag:"header",reference:"headerElement",className:i,children:s})}s&&(s.layout.renderChildren(),l.push(s.element)),l.push(t.bodyConfig),a&&(a.layout.renderChildren(),l.push(a.element)),i&&l.push({tag:"footer",reference:"footerElement",className:`b-dock-${i.dock||"bottom"} ${i.cls||""}`}),l.push({reference:"bottomFocusTrap",className:"b-focus-trap",tabIndex:0}),super.element=u}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){return ObjectHelper.merge({},this._bodyConfig,{reference:"bodyElement",className:this.classHierarchy(Panel).reduce(((e,t)=>(e[`b-${t.$$name.toLowerCase()}-content`]=1,e)),{}),html:this.html})}get element(){return super.element}changeTbar(e,t){return e?(Array.isArray(e)&&(e={items:e}),e.isWidget?e.parent=this:e=Toolbar.reconfigure(t,Toolbar.mergeConfigs({type:"toolbar",parent:this},e)),e&&(this.hasItems=this.hasItems||e.hasItems,DomHelper.addClasses(e.element,["b-top-toolbar","b-dock-"+(e.dock||"top")]))):t&&t.destroy(),e}changeBbar(e,t){return e?(Array.isArray(e)&&(e={items:e}),e.isWidget?e.parent=this:e=Toolbar.reconfigure(t,Toolbar.mergeConfigs({type:"toolbar",parent:this},e)),e&&(this.hasItems=this.hasItems||e.hasItems,DomHelper.addClasses(e.element,["b-bottom-toolbar","b-dock-"+(e.dock||"bottom")]))):t&&t.destroy(),e}updateTitle(e){const{tools:t}=this;this.headerElement&&(this.titleElement.innerHTML=e,this.headerElement.classList[e||t&&Object.values(t).some((e=>!e.hidden))?"remove":"add"]("b-hide-display"))}get childItems(){const e=this,t=e.items?e.items.slice():[];return e.tools&&t.unshift(...Object.values(e.tools)),e.tbar&&t.unshift(e.tbar),e.bbar&&t.push(e.bbar),t}changeTools(e,t){const r=this,n={};if(e){for(const t in e)if(e[t]){const i=n[t]=Panel.create(ObjectHelper.assign({type:"tool",ref:t,parent:r},e[t]),r.defaultToolType||"tool");r.onChildAdd(i)}}else if(t)for(const e of Object.values(t))e.destroy();return n}updateTrapFocus(e){const t=this;t.element.classList[e?"add":"remove"]("b-focus-trapped"),e?(t.focusTrapListener=EventHelper.on({element:t.element,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:t}),t.treeWalker||(t.treeWalker=this.setupTreeWalker(t.element,NodeFilter.SHOW_ELEMENT,acceptNode,!1))):t.focusTrapListener&&(t.focusTrapListener(),t.focusTrapListener=null)}setupTreeWalker(e,t,r,n){return document.createTreeWalker(e,t,r,n)}onFocusTrapped(e){const t=this,r=t.treeWalker;e.target===t.bottomFocusTrap?(r.currentNode=t.topFocusTrap,r.nextNode()):(r.currentNode=t.bottomFocusTrap,r.previousNode()),t.requestAnimationFrame((()=>r.currentNode.focus()))}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}get widgetClassList(){const e=this,t=super.widgetClassList,r=e.header;return(r||e.title||e.tools)&&t.push("b-panel-has-header b-header-dock-"+(r&&r.dock||"top")),e.tbar&&t.push("b-panel-has-top-toolbar"),e.bbar&&t.push("b-panel-has-bottom-toolbar"),t}}Panel.initClass(),Panel._$name="Panel";class Popup extends Panel{static get $name(){return"Popup"}static get type(){return"popup"}static get configurable(){return{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,hideAnimation:BrowserHelper.isIE11?null:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:BrowserHelper.isIE11?null:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,modal:null,tools:{close:{cls:"b-popup-close",handler:"close",weight:-1e3,hidden:!0}},highlightReturnedFocus:!0}}finalizeInit(){const e=this;e.anchoredTo=e.forElement,e.initialAnchor=e.anchor,e.forElement&&e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),EventHelper.on({element:e.forElement,click:"onElementUserAction",thisObj:e})),super.finalizeInit(),e.autoShow&&(!0===e.autoShow?e.show():e.setTimeout((()=>e.show()),e.autoShow))}doDestroy(){this.syncModalMask(),super.doDestroy()}close(){const e=this;if(!e._hidden&&!1!==e.trigger("beforeClose")||e._hidden&&"destroy"===e.closeAction)return e.containsFocus&&e.highlightReturnedFocus&&e.setTimeout((()=>document.body.classList.add("b-using-keyboard")),0),e[e.closeAction]()}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.close(!0))}onDocumentMouseDown({event:e}){const t=this;t.modal&&e.target===Popup.modalMask?(e.preventDefault(),t.modal.closeOnMaskTap?t.close():t.containsFocus||t.focus()):t.owns(e.target)||!t.autoClose||t.containsFocus||t.close()}get isTopModal(){return DomHelper.isVisible(Popup.modalMask)&&this.element.previousElementSibling===Popup.modalMask}onFocusIn(e){const t=DomHelper.activeElement;super.onFocusIn(e),DomHelper.activeElement===t&&e.target===this.element&&this.focus()}onFocusOut(e){!this.modal&&this.autoClose&&this.close(),super.onFocusOut(e)}onShow(){const e=this;e.autoClose&&e.addDocumentMouseDownListener(),e.focusOnToFront&&e.focus(),super.onShow&&super.onShow(),e.syncModalMask()}addDocumentMouseDownListener(){this.mouseDownRemover||(this.mouseDownRemover=GlobalEvents.on({globaltap:"onDocumentMouseDown",thisObj:this}))}syncModalMask(){const e=this,{modal:t}=e;if(t&&e.isVisible)e._x||e._y||(e.centered=!0),e.modalMask.classList.remove("b-hide-display"),e.element.classList.add("b-modal");else{e.element.classList.remove("b-modal");const t=e.constructor.floatRoot.querySelectorAll(".b-modal"),r=t.length?Popup.fromElement(t[t.length-1],"popup"):null;r?r.syncModalMask():Popup.modalMask.classList.add("b-hide-display")}}onHide(){const e=this;e.mouseDownRemover&&(e.mouseDownRemover(),e.mouseDownRemover=null),super.onHide&&super.onHide(),e.syncModalMask()}onElementUserAction(){this.show()}updateClosable(e){this.tools.close[e?"show":"hide"](),this.title||this.headerElement.classList[Object.values(this.tools).some((e=>!e.hidden))?"remove":"add"]("b-hide-display")}updateTextContent(e){this.element.classList[e&&this.hasNoChildren?"add":"remove"]("b-text-popup"),super.updateTextContent(e)}get modalMask(){const{modalMask:e}=Popup;return e.nextElementSibling!==this.element&&Popup.floatRoot.insertBefore(e,this.element),e}static get modalMask(){return this._modalMask||(this._modalMask=DomHelper.createElement({className:"b-modal-mask b-hide-display"}))}}Popup.initClass(),Popup._$name="Popup";const realignTransitions={left:!0,right:!0,top:!0,bottom:!0,transform:!0},isBoolean={true:1,false:1};class Tooltip extends Popup{static get $name(){return"Tooltip"}static get listenersTarget(){return document.body}static get type(){return"tooltip"}static get configurable(){return{mouseOffsetX:15,mouseOffsetY:15,floating:!0,getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:!1,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:!1,anchor:!0,align:"b-t",axisLock:!0,testConfig:{hideDelay:100,hoverDelay:100,showAnimation:null,hideAnimation:null}}}afterConstruct(){const e=this,{forSelector:t}=e;t&&(e.showOnHover=!0,e.forElement||(e.trackMouse=!0,e.forElement=Tooltip.listenersTarget)),super.afterConstruct(),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=EventHelper.on({element:e.forElement,mouseover:"internalOnPointerOver",mouseout:"internalOnPointerOut",thisObj:e})),e.autoShow&&e.show(),e.allowOver&&EventHelper.on({element:e.element,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:e})}doDestroy(){this.pointerOverOutDetacher&&this.pointerOverOutDetacher(),super.doDestroy()}set focusOnToFront(e){super.focusOnToFront=e}get focusOnToFront(){return super.focusOnToFront&&DomHelper.usingKeyboard}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get trackMouse(){return this._trackMouse&&!this.anchorToTarget}updateAnchorToTarget(e){e||(this.anchor=!1)}onDocumentMouseDown({event:e}){const t=this,{triggeredByEvent:r}=t;r&&DomHelper.isTouchEvent&&e.pageX===r.pageX&&e.pageY===r.pageY&&t.activeTarget.contains(e.target)&&performance.now()-r.timeStamp<500||(t.abortDelayedShow(),super.onDocumentMouseDown({event:e}))}internalOnPointerOver(e){const t=this,r=t.forElement,n=t.forSelector,i=t.activeTarget;let s;if(!(t.disabled||t.allowOver&&t.element.contains(e.target))){if(n){if(i&&i.contains(e.target)&&i.contains(e.relatedTarget))return;if(s=e.target.closest(n),s&&e.relatedTarget&&e.relatedTarget.closest(n)===s)return}else{if(r.contains(e.relatedTarget))return;s=r}s?t.handleForElementOver(e,s):i&&t.handleForElementOut()}}onTransitionEnd(e){const t=this,r=Tooltip.currentOverElement;if(realignTransitions[e.propertyName]){if(t.allowOver&&t.element.contains(r))return;t.activeTarget&&t.activeTarget.contains(r)&&!t.trackMouse&&t.realign()}}async handleForElementOver(e,t){const r=this;if(!1===r.trigger("pointerOver",{event:e,target:t}))r.internalOnPointerOut(e);else if(r.triggeredByEvent=e,r.abortDelayedHide(),!r.hideOnDelegateChange&&r.element.classList.contains("b-hiding")&&(r.element.classList.remove("b-hiding"),r.show(!1)),r.isVisible&&!r.hideOnDelegateChange){if(r.updateActiveTarget(t),!1===r.trigger("beforeShow"))return r.hide();const e=r.updateContent();ObjectHelper.isPromise(e)&&!r.loadingMsg&&await e,r.alignTo({target:r.anchorToTarget?t:new Point(r.triggeredByEvent.pageX-window.pageXOffset+r.mouseOffsetX,r.triggeredByEvent.pageY-window.pageYOffset+r.mouseOffsetY),overlap:!(r.anchorToTarget&&r.anchor)}),r.trigger("show"),r.afterShowByTarget()}else r.hideOnDelegateChange&&r.hide(),r.updateActiveTarget(t),r.delayShow(t)}async delayShow(e){const t=this;if(t.currentAnimation&&(t.cancelHideShowAnimation(),t._hidden=!0),t.isVisible||t.hasTimeout("show"))t.isVisible&&t.showByTarget(e);else if(!t.hoverDelay||t.forSelector&&Date.now()-t.lastHidden<t.quickShowInterval){const r=t.updateContent();ObjectHelper.isPromise(r)&&!t.loadingMsg&&await r,t.showByTarget(e)}else t.addDocumentMouseDownListener(),t.listeningForMouseMove||t.anchorToTarget||(t.mouseMoveRemover=EventHelper.on({element:Tooltip.listenersTarget,mousemove:"onMouseMove",thisObj:t})),t.setTimeout((async()=>{if(!DomHelper.isOrphaned(e)){const r=t.updateContent();ObjectHelper.isPromise(r)&&!t.loadingMsg&&await r,t.showByTarget(e)}}),t.triggeredByEvent&&"mouseover"!==t.triggeredByEvent.type?0:t.hoverDelay,"show")}async updateContent(){const e=this;if(e.getHtml){const t=e.getHtml({tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent});return e.html=t,t}}get hasContent(){return Boolean("string"==typeof this.html&&this.html.length||this.items.length)}internalBeforeShow(){return this.updateContentOnMouseMove||this.hasContent}showAsyncMessage(e=this.optionalL(this.loadingMsg)){e&&(this.html=`\n                <div class="b-tooltip-loading">\n                    <i class="b-icon b-icon-spinner"></i>\n                    ${e}\n                </div>\n            `)}showByTarget(e){const t=this;t.mouseMoveRemover&&(t.mouseMoveRemover(),t.mouseMoveRemover=null),t.showBy({target:t.anchorToTarget?e:new Point(t.triggeredByEvent.pageX-window.pageXOffset+t.mouseOffsetX,t.triggeredByEvent.pageY-window.pageYOffset+t.mouseOffsetY),overlap:!(t.anchorToTarget&&t.anchor)})}afterShowByTarget(){const e=this,t=e.dismissDelay;e.abortDelayedShow(),t&&e.setTimeout("hide",t),e.toFront()}updateActiveTarget(e){const t=this,r=t.activeTarget;t.activeTarget=e,t.isConfiguring||t.trigger("overtarget",{newTarget:e,lastTarget:r})}internalOnPointerOut(e){const t=this,r=e.relatedTarget;t.allowOver&&t.element.contains(r)||t.element.contains(e.target)&&t.activeTarget&&t.activeTarget.contains(r)||t.activeTarget&&!t.activeTarget.contains(e.relatedTarget)&&t.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:t}=e;!1!==e.trigger("pointerOut")?(e.abortDelayedShow(),e.isVisible&&!1!==t&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())):e.activeTarget=null}show(){const e=this;e.forElement&&e.anchorToTarget&&!e.forSelector&&!e.inShowBy?e.showByTarget(e.forElement):(e.inShowBy&&(e.y=-1e4),super.show()),e.afterShowByTarget(),e.mouseMoveRemover||e._hidden||!e.trackMouse&&!e.updateContentOnMouseMove||(e.mouseMoveRemover=EventHelper.on({element:Tooltip.listenersTarget,[BrowserHelper.supportsPointerEvents?"pointermove":"touchmove"]:"onMouseMove",thisObj:e})),!e.forElement||e.transitionEndDetacher||e._hidden||(e.transitionEndDetacher=EventHelper.on({element:e.forElement,transitionend:"onTransitionEnd",thisObj:e}))}hide(...e){const t=this;t.abortDelayedShow(),t.isVisible&&(t.abortDelayedHide(),super.hide(...e),t.lastHidden=Date.now(),t.activeTarget=null,t.mouseMoveRemover&&(t.mouseMoveRemover(),t.mouseMoveRemover=null),t.transitionEndDetacher&&(t.transitionEndDetacher(),t.transitionEndDetacher=null),t.listeningForMouseMove=!1)}abortDelayedShow(){const e=this;e.hasTimeout("show")&&(e.mouseDownRemover&&(e.mouseDownRemover(),e.mouseDownRemover=null),e.clearTimeout("show"),e.mouseMoveRemover&&(e.mouseMoveRemover(),e.mouseMoveRemover=null),e.transitionEndDetacher&&(e.transitionEndDetacher(),e.transitionEndDetacher=null))}abortDelayedHide(){this.clearTimeout("hide")}realign(e){const t=this,r=t.lastAlignSpec,n=t.clippedBy;if(!t.isConfiguring&&n&&!t.isVisible&&r&&r.targetHidden){Rectangle.from(r.target,t.positioned?t.element.offsetParent:null,!t.positioned).intersect(n)&&(t.show(),r.targetHidden=!1)}super.realign(e)}alignTo(e){const t=this;t.isVisible&&(t.triggeredByEvent&&t.element.contains(t.triggeredByEvent.target)||1===e.nodeType&&(e={target:e}),super.alignTo(e))}changeHtml(e){const t=this;return!1===e?(VersionHelper.deprecate("Grid","5.0.0","Setting false to indicate loading is deprecated, in favor of `showAsyncMessage`. Please see https://bryntum.com/docs/grid/#guides/upgrades/3.0.1.md for more information"),void this.showAsyncMessage()):ObjectHelper.isPromise(e)?(t.showAsyncMessage(),e.target=t.activeTarget,void e.then((r=>{e.target===t.activeTarget&&(t.html=r)}))):("object"!=typeof e&&(e=null!=e?t.optionalL(String(e)):""),e)}updateHtml(e,t){const r=this;super.updateHtml(e,t),r.hasContent?(r.isVisible&&r.realign(),ObjectHelper.isPromise(e)||r.trigger("innerHtmlUpdate")):r.hide()}onMouseMove(e){const t=this,{forElement:r}=t,n=e.pageX-window.pageXOffset+t.mouseOffsetX,i=e.pageY-window.pageYOffset+t.mouseOffsetY,s=t.hasTimeout("hide"),o=e.target;if(t.triggeredByEvent=e,!t._hidden){let a;const l=t.forSelector&&t.activeTarget&&!s&&1===o.nodeType&&!o.matches(t.forSelector)&&!(t.allowOver&&t.element.contains(o)),c=(null==r?void 0:r.document)?r.document.documentElement:r,d=c&&(c.contains?c.contains(o):16&c.compareDocumentPosition(o));l&&(a=t.handleForElementOut()),(a||!s||d)&&(t.dismissDelay&&!s&&t.setTimeout("hide",t.dismissDelay),t.updateContentOnMouseMove&&t.getHtml&&(t.html=t.getHtml({tip:t,element:t.element,forElement:t.activeTarget,event:e})),t.trackMouse&&t.alignTo({position:new Point(n,i),ignorePageScroll:!0}))}}onOwnElementMouseEnter(e){this.abortDelayedHide()}}function setupMouseEnterListener(){EventHelper.on({element:Tooltip.listenersTarget,mouseenter:e=>Tooltip.currentOverElement=e.target,capture:!0})}let globalInstance,timeoutId;function createGlobalTooltipInstance(){globalInstance=new Tooltip({id:"bryntum-tooltip",forElement:Tooltip.listenersTarget,forSelector:"[data-btip]",header:!0,resetCfg:{},listeners:{pointerOver({source:e,target:t}){for(const t in e.resetCfg)"listeners"===t?e.un(e.resetCfg[t].set):"html"!==t&&(e[t]=e.resetCfg[t].was);e.resetCfg={};const r=Widget.getById(t.id),n=(null==r?void 0:r.tipConfig)||e.gatherDataConfigs(t.dataset);for(const t in n)e.resetCfg[t]={set:n[t],was:e[t]},"listeners"===t?e.on(n[t]):e[t]=n[t];e.headerElement.style.display=e.title?"":"none"}},gatherDataConfigs(e){const t=this,r={};for(const n in e)if(n.startsWith("btip"))if(n.length>4){const i=StringHelper.uncapitalize(n.substr(4));if(i in t.getDefaultConfiguration()){const t=e[n];r[i]=isBoolean[t]?"true"===t:isNaN(t)?t:parseInt(t,10)}}else r.html=e[n];return r}})}function createTooltip(e=0){timeoutId&&clearTimeout(timeoutId),0===e?createGlobalTooltipInstance():timeoutId=setTimeout(createGlobalTooltipInstance,e)}Tooltip.listenersTarget?setupMouseEnterListener():document.addEventListener("DOMContentLoaded",setupMouseEnterListener),Tooltip.initClass(),Object.defineProperty(Widget,"tooltip",{get:()=>(globalInstance||(clearTimeout(timeoutId),createGlobalTooltipInstance()),globalInstance)}),Tooltip.listenersTarget?createTooltip(VersionHelper.isTestEnv?0:1e3):document.addEventListener("DOMContentLoaded",(()=>createTooltip(VersionHelper.isTestEnv?0:1e3))),Tooltip._$name="Tooltip";class DragTipProxy extends DragProxy{static get type(){return"tip"}static get configurable(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}open(){this.getConfig("tooltip")}close(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}dragMove(e){const{offset:t,tooltip:r}=this,{event:n}=e;r&&(r.isVisible||r.show(),r.alignTo({align:this.align,target:new Rectangle(n.clientX-t,n.clientY-t,2*t,2*t)}))}changeTooltip(e,t){return Widget.reconfigure(t,e,this)}}DragTipProxy.initClass(),DragTipProxy._$name="DragTipProxy";const sundayAndSaturday={0:!0,6:!0};class Month extends(Events(Base)){static get configurable(){return{date:{$config:{equal:"date"},value:DateHelper.clearTime(new Date)},month:null,year:null,weekStartDay:DateHelper.weekStartDay,hideNonWorkingDays:null,nonWorkingDays:sundayAndSaturday,sixWeeks:null}}configure(e){super.configure(e),e.date&&(this.date=e.date)}changeDate(e){if(!this.isConfiguring){if(e="string"==typeof e?DateHelper.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,t){const r=this,{dayColumnIndex:n}=r,i=DateHelper.getFirstDateOfMonth(e),s=DateHelper.getLastDateOfMonth(i),o=n[i.getDay()],a=n[s.getDay()],l=!t||e.getFullYear()!==t.getFullYear(),c=r.eventListeners&&(t?e.getDate()!==t.getDate()|(r.getWeekId(e)!==r.getWeekId(t))<<1|(e.getMonth()!==t.getMonth())<<2|l<<3:15);if(r._year=e.getFullYear(),r._month=e.getMonth(),r.startDayOfMonth=1-o,r.endDayOfMonth=s.getDate()+(6-a),r.sixWeeks&&(r.endDayOfMonth+=7*(6-r.weekCount)),r.weekBase&&!l||r.calculateWeekBase(),c){const n={newDate:e,oldDate:t,changes:{d:!0,w:Boolean(2&c),m:Boolean(12&c),y:Boolean(8&c)}};r.trigger("dateChange",n),2&c&&r.trigger("weekChange",n),12&c&&r.trigger("monthChange",n),8&c&&r.trigger("yearChange",n)}}calculateWeekBase(){const e=this,{dayColumnIndex:t}=e,r=new Date(e.year,0,1),n=new Date(e.year,11,31),i=e.month?e.getOtherMonth(r):e;e.dayColumnIndex[r.getDay()]>3?e.weekBase=i.startDate:e.weekBase=new Date(e.year,0,i.startDayOfMonth-7);const s=Math.floor(DateHelper.diff(e.weekBase,n,"day")/7);e.has53weeks=53===s&&t[n.getDay()]>2}getWeekStart(e){if("number"==typeof e)return DateHelper.add(this.weekBase,7*Math.max(e,1),"day");const t=this,[r,n]=e;return r===t.year?t.getWeekStart(n):t.getOtherMonth(new Date(r,0,1)).getWeekStart(n)}getOtherMonth(e){const t=this,r=t===otherMonth?new Month(null):otherMonth;return r.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks}),r.date=e,r.date!==e&&r.updateDate(r.date,r.date),r}changeYear(e){const t=new Date(this.date);t.setFullYear(e),this.date=t}changeMonth(e){const t=new Date(this.date);t.setMonth(e),this.date=t}changeWeekStartDay(e){return null==e?DateHelper.weekStartDay:e}updateWeekStartDay(){const e=this;e.updateDayNumbers(),e.calculateWeekBase(),e.isConfiguring||e.updateDate(e.date,e.date)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.endDayOfMonth)}eachDay(e){for(let t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}eachWeek(e){const t=this,{weekCount:r}=t;for(let n=t.startDayOfMonth,i=0;i<r;i++){const r=[],i=t.getWeekNumber(new Date(t.year,t.month,n));for(let e=0;e<7;e++,n++)r.push(new Date(t.year,t.month,n));e(i,r)}}getWeekNumber(e){const t=this;if((e=DateHelper.clearTime(e)).getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let r=Math.floor(DateHelper.diff(t.weekBase,e,"day")/7),n=e.getFullYear();return r?(53!==r||t.has53weeks?r>53&&(r%=52):(r=1,n++),[n,r]):t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0))}getWeekId(e){const t=this.getWeekNumber(e);return 100*t[0]+t[1]}getCellData(e){const t=this,r=e.getDay(),n=t.visibleDayColumnIndex[r],i=t.nonWorkingDays[r],s=t.hideNonWorkingDays&&i;return(e<t.startDate||e>t.endDate)&&(t.month=e.getMonth()),{day:r,visibleColumnIndex:n,isNonWorking:i,week:t.getWeekNumber(e),key:DateHelper.format(e,"YYYY-MM-DD"),columnIndex:t.dayColumnIndex[r],date:new Date(e),isOtherMonth:Math.sign(e.getMonth()+12*e.getFullYear()-(t.month+12*t.year)),visible:!s&&e>=t.startDate&&e<DateHelper.add(t.endDate,1,"day"),tomorrow:DateHelper.add(e,1,"day"),isRowStart:0===n,isRowEnd:n===t.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:t,nonWorkingDays:r,hideNonWorkingDays:n}=e,i=e.dayColumnIndex=[],s=e.canonicalDayNumbers=[],o=e.visibleDayColumnIndex=[];let a=0;for(let e=0;e<7;e++){const l=(t+e)%7;s[e]=l,i[l]=e,n&&r[l]||(o[l]=a++)}e.visibleColumnCount=a,e.weekLength=n?7-ObjectHelper.keys(r).length:7}}const otherMonth=new Month(null);Month._$name="Month";let nextObjectIdentity=0;const objectIdentityMap=new WeakMap,argsToCacheKey=(...e)=>e.map((e=>{let t;return e&&"object"==typeof e||"function"==typeof e?(t=objectIdentityMap.get(e),void 0===t&&(t=++nextObjectIdentity,objectIdentityMap.set(e,t))):t=String(e),t})).join("-"),memo=e=>{const t=new Map;return(...r)=>{const n=argsToCacheKey(r);let i=t.get(n);return void 0===i&&(i=e(...r),t.set(n,i)),i}},memoCps=e=>{const t=new Map,r=e=>e[0],n=e=>e[1],i=(e,t)=>r(e).push(t);return(s,o)=>{const a=(e=>{let r=t.get(e);return void 0===r&&(r=[[],[]],t.set(e,r)),r})(s);(e=>!n(e).length&&!r(e).length)(a)?(i(a,o),e(s,(e=>{((e,t)=>n(e).some((e=>ObjectHelper.isEqual(e,t))))(a,e)||(((e,t)=>{n(e).push(t)})(a,e),r(a).forEach((t=>t(e))))}))):(i(a,o),n(a).forEach((e=>o(e))))}},SUCCESS=Symbol("success"),FAILURE=Symbol("failure"),success=(e,t)=>[SUCCESS,e,t],failure=e=>[FAILURE,e],isSuccess=e=>e.length&&e[0]===SUCCESS,resolveParser=e=>"function"!=typeof e||e.length?e:e(),succeed=memo((e=>memoCps(((t,r)=>r(success(e,t)))))),string=memo((e=>memoCps(((t,r)=>{const n=Math.min(e.length,t.length),i=t.substr(0,n),s=t.substr(n);r(i===e?success(i,s):failure(s))})))),bind=(e,t)=>(r,n)=>resolveParser(e)(r,(e=>{if(isSuccess(e)){const[,r,i]=e;t(r)(i,n)}else n(e)})),seq=memo(((...e)=>{const t=memo(((e,t)=>memoCps(bind(e,(e=>bind(t,(t=>succeed([].concat(e,t)))))))));return e.reduce(t,succeed([]))})),alt=memo(((...e)=>memoCps(((t,r)=>e.forEach((e=>resolveParser(e)(t,r))))))),regexp=memo((e=>(t,r)=>{const n=new RegExp("^"+e).exec(t);if(n){const e=n[0],i=t.substr(e.length);r(success(e,i))}else r(failure(t))})),red=memo(((e,t)=>bind(e,((...e)=>succeed(t(...[].concat.apply([],e))))))),runParser=(e,t)=>{let r=[];return e(t,(e=>{if(isSuccess(e)){const[,,t]=e;""===t&&r.push(e)}})),r},defineParser=e=>(t,r)=>r?resolveParser(e)(t,r):runParser(resolveParser(e),t);var Parser={memo:memo,memoCps:memoCps,success:success,failure:failure,isSuccess:isSuccess,resolveParser:resolveParser,succeed:succeed,string:string,bind:bind,seq:seq,alt:alt,regexp:regexp,red:red,runParser:runParser,defineParser:defineParser};let timeoutId$1;function createTooltip$1(e){timeoutId$1&&clearTimeout(timeoutId$1),void 0===e&&(e=VersionHelper.isTestEnv?0:1e3),0===e||(timeoutId$1=setTimeout((()=>Field.errorTip),e))}const byWeight$1=(e,t)=>(e.weight||0)-(t.weight||0),byWeightReverse$1=(e,t)=>(t.weight||0)-(e.weight||0);class Field extends(Badge(Widget)){static get $name(){return"Field"}static get type(){return"field"}static get configurable(){return{placeholder:null,value:"",name:null,label:null,labelCls:null,labels:null,labelWidth:{value:null,$config:{localeKey:"L{labelWidth}"}},required:null,clearable:null,revertOnEscape:null,hint:null,hintHtml:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",triggers:null,highlightExternalChange:!0,localizableProperties:["label","title","placeholder","labelWidth"],autoSelect:!1,autoComplete:"off",inputAttributes:null,inputType:null,inputAlign:null,attributes:{value:["placeholder","autoComplete","minLength","maxLength","pattern","tabIndex","min","max"],$config:{merge:"distinct"}},nullValue:{$config:null,value:null,default:null},updatedClsDuration:500,inputReadOnly:!1,testConfig:{updatedClsDuration:10}}}static get delayable(){return{highlightChanged:"raf"}}doDestroy(){var e,t;const r=this,{triggers:n}=r,i=Field._errorTip;if(null===(e=r.inputListenerRemover)||void 0===e||e.call(r),null===(t=r.keyListenerRemover)||void 0===t||t.call(r),super.doDestroy(),n)for(const e of Object.values(n))e.destroy();(null==i?void 0:i.field)===r&&i.hide()}get invalidValueError(){return"L{invalidValue}"}get errorTip(){return this.constructor.errorTip}static get errorTip(){return Field._errorTip||(Field._errorTip=new Tooltip({id:"bryntum-field-errortip",cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:"l-r",scrollAction:"realign",onBeforeShow(){const e=this,t=Widget.fromElement(e.activeTarget);if(t){const r=t.getErrors();if(r)return e.html=r.join("<br>"),e.field=t,!0}return!1}}))}construct(e){super.construct(e);const t=this;Tooltip.listenersTarget?createTooltip$1():document.addEventListener("DOMContentLoaded",createTooltip$1),t.keyStrokeChangeDelay&&(t.changeOnKeyStroke=t.buffer(t.internalOnChange,t.keyStrokeChangeDelay))}onFocusIn(e){this.valueOnFocus=ObjectHelper.clone(this.value),super.onFocusIn(e)}onFocusOut(e){super.onFocusOut(e),this.syncRequired(),this.onEditComplete()}onEditComplete(){}set element(e){const t=this,r=t.initialConfig.value,n=t.innerElements,i=[{className:"b-field-inner",reference:"inputWrap",children:n}],s=[],o=[];let a;const l=t.labels||[];t.label&&l.push({reference:"labelElement",className:t.labelCls,html:t.label}),l&&l.forEach((e=>{const r=Object.assign({tag:"label",htmlFor:t.id+"-input",className:"b-align-"+(e.align||"start")},e);e.align&&"start"!==e.align?i.push(r):i.unshift(r)})),t.getConfig("clearable");for(const e in t.triggers){const r=t.triggers[e];"start"===r.align?(s.unshift(r),a=!0):o.push(r)}s.sort(byWeight$1),o.sort(byWeightReverse$1),n.unshift(...s.map((e=>e.element))),n.push(...o.map((e=>e.element))),super.element={children:i,className:{"b-has-label":l.length,"b-has-start-trigger":a,"b-readonly":t.readOnly}},null!=r&&(t.value=r),t.syncEmpty(),t.updateInputReadOnly(t.inputReadOnly),t.syncInvalid();const c=t.input||t.focusElement;c&&(t.keyListenerRemover=EventHelper.on({element:c,thisObj:t,keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"}))}get element(){return super.element}get innerElements(){return[this.setInputAttributes(this.inputElement)]}get inputElement(){const e=this,t={tag:"input",reference:"input",class:e.inputCls||"",value:e._value||"",name:e.name||e.id,id:e.id+"-input"};return e.inputType&&(t.type=e.inputType),t}setInputAttributes(e){const t=this;if(!(e instanceof HTMLElement)){const{reference:t}=e;e=DomHelper.createElement(e),t&&(e=e[t])}return t.attributes.forEach((r=>{const n=t[r];null!=n&&e.setAttribute(r,n)})),t.inputAttributes&&Object.entries(t.inputAttributes).forEach((([t,r])=>{null!=r&&e.setAttribute(t,r)})),e}get caretPos(){return this.textSelection[0]}set caretPos(e){this.textSelection=e}get focusElement(){return this.input}get textSelection(){const e=this.input;let t;try{t=[e.selectionStart,e.selectionEnd,e.selectionDirection]}catch(r){t=e.value,t=t?t.length:0,t=[t,t]}return t}set textSelection(e){"number"==typeof e?this.select(e,e):this.select(...e)}get hasTextSelection(){const[e,t]=this.textSelection;return e&&t-e>0}getAfterValue(e){const[t,r]=this.textSelection,n=this.input.value;return`${n.substr(0,t)}${e}${n.substr(r||t)}`}select(e,t){const r=this.focusElement;if(r.value.length){if(0===arguments.length)return void this.selectAll();if(!this.supportsTextSelection)return;BrowserHelper.isIE11?(r.focus(),r.setSelectionRange(e,t)):r.setSelectionRange(e,t)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}syncEmpty(){const{isEmptyInput:e,isEmpty:t,element:r,clearIcon:n}=this,i=e&&t;r&&(n&&n.classList[i?"add":"remove"]("b-icon-hidden"),r.classList[i?"add":"remove"]("b-empty"))}updateHint(){this.syncHint()}updateHintHtml(){this.syncHint()}syncHint(){const e=this,{input:t,hint:r,hintHtml:n}=e,i=null==t?void 0:t.parentElement;if(t){let s=n||r;const o=e.hintElement||s&&(e.hintElement=DomHelper.createElement({parent:i,className:"b-field-hint",nextSibling:t.nextSibling,children:[{className:"b-field-hint-content"}]}));o&&("function"==typeof s&&(s=s({source:e,value:e.value})),o.firstChild[n?"innerHTML":"textContent"]=s||""),e.element.classList[s?"remove":"add"]("b-field-no-hint")}}syncInvalid(){this.updatingInvalid=!0;const{isValid:e,element:t,inputWrap:r}=this,n=Tooltip.listenersTarget&&this.errorTip;t&&(t.classList[e?"remove":"add"]("b-invalid"),e?(null==n?void 0:n.isVisible)&&n.field===this&&n.hide():n&&r.contains(Tooltip.currentOverElement)&&(n.activeTarget===r&&n.isVisible?n.onBeforeShow():(n.activeTarget=r,n.showBy(r)))),this.updatingInvalid=!1}updateEditable(){this.syncInputReadOnly()}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly||!1===this.editable}updateInputReadOnly(e){const t=this,{input:r,inputListenerRemover:n}=t;r&&(r.readOnly=e?"readOnly":null,e?t.inputListenerRemover=null==n?void 0:n():n||(t.inputListenerRemover=EventHelper.on({element:r,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"})))}changeReadOnly(e){return Boolean(e)}updateReadOnly(e){var t;null===(t=this.element)||void 0===t||t.classList[e?"add":"remove"]("b-readonly"),this.syncInputReadOnly()}updateClearable(e){const t=this;t.getConfig("triggers"),t.triggers={clear:e&&ObjectHelper.assign({cls:"b-icon-remove",weight:1e3,handler(){t._isUserAction=!0,t.clear(),t._isUserAction=!1}},e)||null}}changeTriggers(e){const t=this,r=t.$triggers||(t.$triggers=new DynamicObject({factory:Field.Trigger,inferType:!1,owner:t,setup(e,r){e.reference=r,e.parent=t}}));return!1===t.stepTriggers&&(e.back||e.forward)&&(delete(e=ObjectHelper.assign({},e)).back,delete e.forward),r.update(e),r.flush(),r.target}updateLabelWidth(e){this.labelElement&&(this.labelElement.style.flex="0 0 "+DomHelper.setLength(e),this.inputWrap.style.flexBasis=null==e?"":0)}updateInputWidth(e){this.input.style.width=DomHelper.setLength(e),BrowserHelper.isIE11&&(this.input.parentElement.style.flexBasis=this.input.style.width),this.element.classList.add("b-has-width")}updateInputAlign(e){this.input.style.textAlign=e}changeLabel(e){return null==e?"":e}updateLabel(e){this.labelElement&&(this.labelElement.innerHTML=e)}get isValid(){const e=this;if(!e.disabled){if(e.syncRequired(),e.errors&&Object.keys(e.errors).length)return!1;const t=e.validity;if(t)return t.valid}return!0}get isEmpty(){return null==this.value||""===this.value}get isEmptyInput(){return!this.input||null==this.input.value||""===this.input.value}get validity(){const e=this.input;return e&&e.validity}changeValue(e,t){return null==e&&(e=this.nullValue),this.hasChanged(t,e)?e:(""===e&&this.syncRequired(),t)}updateValue(e,t){const r=this;r.isConfiguring||(r.syncRequired(),r.inputting||r.triggerChange()),r.inputting||(r._lastValue=e),r.syncInputFieldValue()}hasChanged(e,t){return t!==e}syncInputFieldValue(e=!1){const t=this,{input:r,parent:n}=t;r&&!t.inputting&&(t.input[t.inputValueAttr]=t.inputValue,t.isConfiguring||t.containsFocus||!t.highlightExternalChange||(r.classList.remove("b-field-updated"),t.clearTimeout("removeUpdatedCls"),e||n&&n.isSettingValues&&n._isSettingValues.preventHighlight||t.highlightChanged())),t.syncEmpty(),t.syncInvalid()}highlightChanged(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return null==this.value?"":this.value}get inputValueAttr(){return"value"}get supportsTextSelection(){const e=this.focusElement;return e&&("textarea"===e.tagName.toLowerCase()||e.type&&(/text|search|password|tel|url/.test(e.type)||BrowserHelper.isEdge))}internalOnInputFocus(){const e=this.input.value.length;BrowserHelper.isIE11&&e&&!this.autoSelect&&this.select(e,e)}internalOnChange(e){const t=this;t.isValid&&t.hasChanged(t._lastValue,t.value)&&(t.triggerChange(e,!0),t._lastValue=t.value)}triggerChange(e,t=Boolean(this._isUserAction)){const r=this,{value:n,_lastValue:i,isValid:s}=r;r.syncHint(),r.triggerFieldChange({value:n,oldValue:i,event:e,userAction:t,valid:s}),"change"===r.defaultAction&&r.trigger("action",{value:n,oldValue:i,event:e,userAction:t,valid:s})}internalOnInput(e){const t=this;t.inputting=!0,t.value=t.input.value,t.inputting=!1,t.trigger("input",{value:t.value,event:e}),t.changeOnKeyStroke&&t.changeOnKeyStroke(e)}internalOnKeyEvent(e){const t=this,{value:r}=t;let n=!1;if("keydown"===e.type)if("Escape"!==e.key||t.readOnly||t.disabled)"Enter"===e.key&&BrowserHelper.isIE11&&t.internalOnChange(e);else{const e="initialValue"in t?t.initialValue:t.valueOnFocus,i=t.hasChanged(e,r),s=t.input.value!==String(t.inputValue);t.revertOnEscape&&(!t.isValid||i||s)?(i&&(t.value=e),s&&t.syncInputFieldValue(!0),t.clearError(),n=i&&t.isValid):t.clearable&&(r||t.input.value)&&t.clear()}t.isDestroyed||(n&&e.stopImmediatePropagation(),t.trigger(e.type,{event:e}))}clear(){this.value=this.nullValue,this.trigger("clear")}onDisabled(){this.syncInvalid()}syncRequired(){var e;const t=this;!t.isConfiguring&&t.required&&t.isEmpty&&!(null===(e=t.parent)||void 0===e?void 0:e.isSettingValues)?t.setError("L{fieldRequired}",t.updatingInvalid):t.clearError("L{fieldRequired}",t.updatingInvalid)}setError(e,t){(this.errors||(this.errors={}))[this.L(e)]=1,t||this.syncInvalid()}clearError(e,t){this.errors&&(e?delete this.errors[this.L(e)]:this.errors={}),t||this.syncInvalid()}getErrors(){const e=this;if(!e.isValid){const t=e.input.validity,r=ObjectHelper.allKeys(t).find((e=>"valid"!==e&&"customError"!==e&&t[e]));let n;if(n=e.errors?Object.keys(e.errors):t.customError?[e.input.validationMessage]:r?[e.L(r,{min:e.min,max:e.max})]:[e.L(e.invalidValueError)],n&&n.length>0)return n}}}Field.Trigger=class extends Widget{static get $name(){return"FieldTrigger"}static get factoryable(){return{defaultType:Field.Trigger,extends:null}}static get type(){return"trigger"}static get configurable(){return{align:null}}template(){return`<div class="b-icon b-align-${this.align||"end"}"></div>`}construct(e){super.construct(e),EventHelper.on({element:this.element,click:{handler:"onClick",thisObj:this},mousedown:{handler:"onMousedown",thisObj:this}})}changeAlign(e){return e}onClick(e){const t=this,r=t.field,n="function"==typeof t.handler?t.handler:r[t.handler];r.disabled||r.readOnly||n&&!1!==r.trigger("trigger",{trigger:t})&&n.call(r,e)}onMousedown(e){const t=this.field;!("key"in e)&&DomHelper.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout((()=>t.editable=!0),500)),e.preventDefault(),DomHelper.activeElement!==t.input&&t.focus()}get field(){return this.parent}},Field.SpinTrigger=class extends Field.Trigger{static get $name(){return"SpinTrigger"}static get type(){return"spintrigger"}static get configurable(){return{repeat:!0}}doDestroy(){this.clickRepeater&&this.clickRepeater.destroy(),super.doDestroy()}template(){return`<div class="b-icon b-align-${this.align||"end"}">\n                    <div data-reference="upButton" class="b-icon b-spin-up"></div>\n                    <div data-reference="downButton" class="b-icon b-spin-down"></div>\n                </div>`}updateRepeat(e){const t=this;e?t.clickRepeater=new ClickRepeater(Object.assign({element:t.element},e)):t.clickrepeater&&(t.clickRepeater.destroy(),t.clickrepeater=null)}onClick(e){const t=this,{field:r}=t;r.disabled||r.readOnly||(e.target===t.upButton?r.doSpinUp(e.shiftKey):e.target===t.downButton&&r.doSpinDown(e.shiftKey))}},Field.Trigger.initClass(),Field.SpinTrigger.initClass(),Widget.register(Field.Trigger,"trigger"),Widget.register(Field.SpinTrigger,"spintrigger"),Field._$name="Field";class TextField extends Field{static get type(){return"textfield"}static get alias(){return"text"}static get configurable(){return{nullValue:""}}static get $name(){return"TextField"}construct(e){"hidden"===e.inputType&&(e.hidden=!0),super.construct(...arguments)}updatePlaceholder(e){this.input&&(this.input.placeholder=null!=e?e:"")}}TextField.initClass(),TextField._$name="TextField";class PickerField extends TextField{static get $name(){return"PickerField"}static get type(){return"pickerfield"}static get configurable(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoClose:!0,autoExpand:null,picker:{value:{floating:!0},$config:"lazy"},inputType:"text",monitorResize:!0,nullValue:null}}doDestroy(){this.globalTapListener&&this.globalTapListener(),this.picker=null,super.doDestroy()}finalizeInit(){super.finalizeInit();const e=this,t=e.element;!1===e.editable?(t.classList.add("b-not-editable"),EventHelper.on({element:e.input,click:"onTriggerClick",thisObj:e})):e.globalTapListener=GlobalEvents.on({globaltap:"showKeyboard",thisObj:e})}changePicker(e,t){throw new Error("changePicker(oldPicker, newPicker) must be implemented in PickerField subclass implementations")}get childItems(){if(this._picker)return[this.picker]}onEditComplete(){super.onEditComplete(),this.autoClosePicker()}onElementResize(e){const t=this;t.pickerVisible&&t.picker.requestAnimationFrame(t.picker.realign,null,t.picker),super.onElementResize(e)}internalOnKeyEvent(e){const t=this;let r=!0;if("keydown"===e.type&&!t.disabled)if(t.pickerVisible){const{picker:n}=t;"Escape"===e.key?(e.stopImmediatePropagation(),t.hidePicker(),r=!1):n.onInternalKeyDown?n.onInternalKeyDown(e):"ArrowDown"===e.key&&n.focusable&&n.focus()}else"ArrowDown"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),t.onTriggerClick(e));r&&super.internalOnKeyEvent(e)}onFocusIn(e){super.onFocusIn(e),this.autoExpand&&(this.minChars=0,this.onTriggerClick(e))}onFocusOut(e){this.autoClosePicker(),super.onFocusOut(e)}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}showKeyboard({event:e}){const t=this.input;DomHelper.isTouchEvent&&DomHelper.activeElement===t&&e.target===t&&(GlobalEvents.suspendFocusEvents(),t.blur(),t.focus(),GlobalEvents.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const t=this,r=t.picker;t.pickerHideShowListenersAdded||(r.on({show:"onPickerShow",hide:"onPickerHide",thisObj:t}),t.pickerHideShowListenersAdded=!0),r.autoClose=t.autoClose,r.show(),r.isVisible&&e&&t.focusPicker()}onPickerShow(){const e=this;e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=GlobalEvents.on({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=EventHelper.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){const e=this;e.pickerVisible=!1,e.element.classList.remove("b-open"),e.trigger("togglePicker",{show:!1}),e.pickerTapOutRemover&&e.pickerTapOutRemover(),e.pickerKeyDownRemover&&e.pickerKeyDownRemover()}onPickerTapOut({event:e}){this.owns(e.target)||this.autoClosePicker()}onPickerKeyDown(e){if("Tab"===e.key){const t=DomHelper.activeElement,r=new KeyboardEvent("keydown",e);this.input.dispatchEvent(r),r.defaultPrevented&&e.preventDefault(),DomHelper.activeElement===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}autoClosePicker(){this.autoClose&&this.hidePicker()}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;DomHelper.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout((()=>e.readOnly=!1),500)),super.focus()}}PickerField._$name="PickerField";class Navigator extends(Events(Base)){static get configurable(){return{ownerCmp:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,activeItem:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,scrollDuration:50,disabled:null,testConfig:{scrollDuration:1}}}updateOwnerCmp(e){this.itemSelector||(this.itemSelector="."+this.ownerCmp.itemCls)}onKeyDown(e){const t=this,{ownerCmp:r,itemSelector:n,activeItem:i,itemsTabbable:s}=t,{target:o}=e,a=t.target.querySelector(n),l=(e.key||"").trim()||e.code,c=`${e.ctrlKey?"CTRL+":""}${e.shiftKey?"SHIFT+":""}${e.altKey?"ALT+":""}${l}`,d=o.matches(n)||o===t.keyEventTarget;if(!t.disabled&&a&&t.target.offsetParent&&d){if(!s){if(null==t.inlineFlow){const e=a.parentNode,r=DomHelper.getStyleValue(a,"position"),n=DomHelper.getStyleValue(a,"display"),i=DomHelper.getStyleValue(a,"float");t.inlineFlow="absolute"===r||"inline"===n||"inline-block"===n||"left"===i||"right"===i||"flex"===DomHelper.getStyleValue(e,"display")&&"row"===DomHelper.getStyleValue(e,"flex-direction")}t.prevKey||(t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown"))}if(t.processEvent&&!(e=t.processEvent.call(r,e)))return;if(i)switch(l){case t.prevKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),t.navigatePrevious(e);break;case t.nextKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),t.navigateNext(e);break;default:{const n=t.keys&&t.keys[c];if(n&&!t.disabled?t.callback(n,t.thisObj||r,[e]):r.onInternalKeyDown&&r.onInternalKeyDown(e),DomHelper.activeElement!==o&&e.preventDefault(),s)return}}else{if(s)return;t.activeItem=t.previousActiveItem||t.getDefaultNavigationItem(e)}t.activeItem!==i&&t.triggerNavigate(e)}}getDefaultNavigationItem(e){const{target:t,itemSelector:r,prevKey:n,nextKey:i}=this;return 4&t.compareDocumentPosition(e.target)&&e.key===n?t.querySelector(r+":last-of-type"):2&t.compareDocumentPosition(e.target)&&e.key===i?t.querySelector(""+r):void 0}navigatePrevious(e){const t=this,r=t.previous;e.preventDefault(),r&&t.ownerCmp.scrollable.scrollIntoView(r,{animate:t.scrollDuration}).then((()=>{t.activeItem=r,t.triggerNavigate(e)}))}navigateNext(e){const t=this,r=t.next;e.preventDefault(),r&&t.ownerCmp.scrollable.scrollIntoView(r,{animate:t.scrollDuration}).then((()=>{t.activeItem=r,t.triggerNavigate(e)}))}get owner(){return this.ownerCmp}get previous(){return this.getAdjacent(-1)}get next(){return this.getAdjacent(1)}getAdjacent(e=1,t=this.activeItem){const r=this.treeWalker;if(r.currentNode=t,r[e<0?"previousNode":"nextNode"](),r.currentNode!==this.activeItem)return r.currentNode}onTargetFocusIn(e){const t=this,{target:r}=e,{itemsTabbable:n,skipScrollIntoView:i}=t;var s,o;if(!r.matches(".b-focus-trap"))if(r.matches(t.itemSelector))t.skipScrollIntoView=!0,t.activeItem=r,t.skipScrollIntoView=i,t.activeItem&&n&&t.triggerNavigate(e);else if(!n&&(null===(s=e.relatedTarget)||void 0===s||null===(o=s.matches)||void 0===o?void 0:o.call(s,t.itemSelector))){var a;null===(a=t.owner.previousSibling)||void 0===a||a.focus()}}onTargetFocusOut(e){const t=this,{relatedTarget:r}=e;(null==r?void 0:r.matches(".b-focus-trap"))||r&&t.target.contains(r)&&r.matches(t.itemSelector)||t.activeItem&&(t.activeItem=null,t.itemsTabbable&&t.triggerNavigate(e))}onTargetMouseDown(e){if(!1===this.ownerCmp.itemsFocusable)this.onFocusGesture(e);else{const t=e.target.closest(this.itemSelector);t&&(e.preventDefault(),DomHelper.focusWithoutScrolling(t))}}onTargetClick(e){const t=this,{skipScrollIntoView:r}=t;t.disabled||(t.skipScrollIntoView=!0,t.processEvent&&(e=t.processEvent.call(t.ownerCmp,e)),e&&(t.activeItem=e.target.closest(t.itemSelector),t.triggerNavigate(e)),t.skipScrollIntoView=r)}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&!1===this.ownerCmp.itemsFocusable)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}changeActiveItem(e){return null!=e&&this.ownerCmp.getItem&&(e=this.ownerCmp.getItem(e)),e}updateActiveItem(e,t){const r=this,{ownerCmp:n}=r,i=t&&r.target.contains(t);if(i&&(r.previousActiveItem=t),null!=e){if(r.skipScrollIntoView||n.scrollable.scrollIntoView(e,{block:"nearest",focus:DomHelper.isFocusable(e)&&e!==DomHelper.activeElement,silent:r.scrollSilently}),e===t&&i)return;t&&t.classList.remove(r.focusCls),e.classList.add(r.focusCls),r._activeItem=e}else t&&(t.classList.remove(r.focusCls),t===DomHelper.activeElement&&n.revertFocus()),r._activeItem=null}updateTarget(e,t){const r=this,n={element:e,thisObj:r,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut"};r.itemsTabbable||(n.mousedown="onTargetMouseDown",n.click="onTargetClick"),Object.prototype.hasOwnProperty.call(r,"acceptNode")||(r.acceptNode=r.acceptNode.bind(r),r.acceptNode.acceptNode=r.acceptNode),EventHelper.on(n),r.treeWalker=r.setupTreeWalker(e,NodeFilter.SHOW_ELEMENT,r.acceptNode,!1),r.keyEventTarget||(r.keyEventTarget=e),(r.targetMutationMonitor=new MutationObserver(r.onTargetChildListChange.bind(r))).observe(e,{childList:!0,subtree:!0})}setupTreeWalker(e,t,r,n){return document.createTreeWalker(e,t,r,n)}onTargetChildListChange(){const e=this.activeItem;e&&(this.target.contains(e)?e.classList.add(this.focusCls):this.activeItem=this.target.querySelector(`${this.itemSelector}[data-id="${e.dataset.id}"]`)||null)}changeKeyEventTarget(e){this._keyEventTarget=e,EventHelper.on({element:e,keydown:"onKeyDown",thisObj:this})}triggerNavigate(e,t=this.activeItem){var r;const n={event:e,item:t,oldItem:this.previousActiveItem};this.trigger("navigate",n),null===(r=this.ownerCmp)||void 0===r||r.trigger("navigate",n)}}Navigator._$name="Navigator";const itemRange=document.createRange();class List extends Widget{static get $name(){return"List"}static get type(){return"list"}static get configurable(){return{itemCls:"b-list-item",selectedCls:"b-selected",selectIconCls:"b-icon-check",items:null,store:null,navigator:!0,scrollable:{x:!1,y:!0},itemsFocusable:!0,multiSelect:!1,toggleAllIfCtrlPressed:!1,itemTpl:e=>e.text,selected:{},activateOnMouseover:null}}construct(e,...t){const r=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...t);const{element:n}=r,{classList:i}=n;r.multiSelect&&i.add("b-multiselect"),r.store&&r.store.count?r.refresh():i.add("b-empty"),EventHelper.on({element:n,delegate:r.itemSelector,mouseover:"onMouseOver",click:"onClick",thisObj:r})}doDestroy(){var e;this.detachListeners("store"),null===(e=this.navigator)||void 0===e||e.destroy(),super.doDestroy()}onFocusIn(e){const t=e._target.classList.contains(this.itemCls)?e._target.dataset.id:0;this.restoreActiveItem(this.navigator.previousActiveItem||this.getItem(t)),super.onFocusIn(e)}contentTpl(){return TemplateHelper.tpl`${this.store.records.map(((e,t)=>this.itemWrapperTpl(e,t)))}`}itemWrapperTpl(e,t){return TemplateHelper.tpl`<div class="${this.getItemClasses(e,t)}" data-index="${t}" data-id="${e.id}" ${this.itemsFocusable?'tabindex="-1"':""}>
            ${this.itemContentTpl(e,t)}
            </div>`}itemContentTpl(e,t){return`${this.itemIconTpl(e,t)}${this.itemTpl(e,t)}`}itemIconTpl(e,t){return this.multiSelect?`<div class="b-selected-icon b-icon ${this.selectIconCls}"></div>`:""}getItemClasses(e){var t;const r=this,n=null===(t=r._navigator)||void 0===t?void 0:t.activeItem,i=(null==n?void 0:n.dataset.id)==e.id,s=r.selected.includes(e);return`${r.itemCls} ${e.cls||""} ${s?r.selectedCls:""} ${i?r.navigator.focusCls:""}`}onBeforeStoreLoad(){this.mask(this.L("L{loading}"))}onAfterStoreRequest(){this.unmask()}onStoreChange({source:e,action:t,records:r,record:n}){switch(t){case"remove":this.selected.remove(r);break;case"clear":this.selected.clear();break;case"update":return void this.refreshItem(n)}this.refresh()}onStoreRefresh(){this.refresh()}refresh(){const e=this;if(e.isVisible){const{activeItem:t}=e.navigator;e.paintListener=null,e.clearItems().insertNode(DomHelper.createElementFromTemplate(e.contentTpl(),{fragment:!0})),t&&e.restoreActiveItem(t),e.refreshCount=(e.refreshCount||0)+1,e.element.classList[e.store.count>0?"remove":"add"]("b-empty")}else e.paintListener||(e.paintListener=e.on({paint:"refresh",thisObj:e,once:!0}))}clearItems(){const e=this,t=e.contentElement.querySelector(e.itemSelector),r=e.contentElement.lastChild;if(t){const r=e.contentElement.querySelectorAll(e.itemSelector+":not(.b-mask)");itemRange.setStartBefore(t),itemRange.setEndAfter(r[r.length-1]),itemRange.deleteContents()}else r?(itemRange.setStartAfter(r),itemRange.setEndAfter(r)):(itemRange.setStart(e.contentElement,0),itemRange.setEnd(e.contentElement,0));return itemRange}refreshItem(...e){for(const t of e){const e=this.getItem(t);if(e){const r=this.store.indexOf(t),n=DomHelper.createElementFromTemplate(this.itemWrapperTpl(t,r));DomHelper.sync(n,e)}}}getItem(e){if(null!=e)return"number"==typeof e?this.contentElement.querySelector(`[data-index="${e}"]`):(1===e.nodeType&&(e=e.dataset.id),null!=e.id&&(e=e.id),this.contentElement.querySelector(`[data-id="${e}"]`))}getRecord(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}updateItems(e){const t=this;t.store&&t.store.autoCreated&&t.store.destroy(),t.store=Store.getStore(e)}updateSelected(e){e&&e instanceof Collection||(e=new Collection(e)),this._selected=e,e.on({change:"onSelectionChange",thisObj:this})}get itemSelector(){return"."+this.itemCls}get selected(){return this._selected}get store(){return this._thisIsAUsedExpression(this.items),this._store}changeStore(e){const t=this;if(e instanceof Store||(e=new Store(e)),t.detachListeners("store"),e){const r={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:t};e.readUrl&&(r.beforeLoad="onBeforeStoreLoad",r.afterRequest="onAfterStoreRequest"),e.on(r)}return e}updateStore(){this.refresh()}changeNavigator(e){const t=this,{element:r}=t;return r&&(e=new(e.class||Navigator)(Object.assign({ownerCmp:t,target:r,keyEventTarget:r},e))).keyEventTarget===r&&(r.tabIndex=0),e}get minAlignHeight(){const e=this.element.lastElementChild,t=this.minHeight;if(null!=t)return this.store.count?Math.min(e.offsetTop+e.offsetHeight,t):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(...e){this.navigator.activeItem=null,super.hide(...e)}show(){const{refreshCount:e}=this,{previousActiveItem:t}=this.navigator;super.minHeight=this._minHeight,super.show(),this.refreshCount===e&&this.restoreActiveItem(t,!0)}restoreActiveItem(e=this.navigator.previousActiveItem,t="nearest"){const r=this,{navigator:n,lastAlignSpec:i}=r;if(null!=e){if("string"!=typeof t){const e=i?i.zone:1;t=1&e?"nearest":e?"start":"end"}(e=r.getItem(e))&&(r.scrollable.scrollIntoView(e,{block:t}),n.activeItem=e)}}onMouseOver(e){const t=this,r=e.currentTarget;!DomHelper.isTouchEvent&&r&&t.navigator&&t.activateOnMouseover&&t.setTimeout({fn:"handleMouseOver",delay:30,args:[r],cancelOutstanding:!0})}handleMouseOver(e){this.navigator.activeItem=e}onClick(e){const t=e.target.closest(this.itemSelector);t&&this.onItemClick(t,e)}onInternalKeyDown(e){const t=this.navigator.activeItem;switch(e.key){case" ":if("INPUT"===e.target.nodeName.toUpperCase()&&!e.target.readOnly)break;case"Enter":t&&(this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}}onItemClick(e,t){const r=this,n=parseInt(e.dataset.index);let i=r.store.getAt(n);if(r._isUserAction=!0,r.trigger("item",{item:e,record:i,index:n,event:t,userAction:!0}),!e.contains(t.target.closest("[data-noselect]"))){const e=r.selected,n=e.includes(i);r.multiSelect?(r.toggleAllIfCtrlPressed&&t.ctrlKey&&(i=r.store.getRange()),e[n?"remove":"add"](i)):e.splice(0,e.count,i)}r.lastClicked=i,r._isUserAction=!1}onSelectionChange({action:e,removed:t,added:r,replaced:n}){const i=this,{selectedCls:s,unselectedCls:o}=i;let a,l;if("clear"===e)for(l of i.element.querySelectorAll("."+s))l.classList.remove(s),o&&l.classList.remove(o);else{for(a of t)l=i.getItem(a),l&&l.classList.remove(s);for(a of r)l=i.getItem(a),l&&l.classList.add(s)}}}List.initClass(),List.prototype.navigatorClass=Navigator,List._$name="List";class ChipView extends List{static get $name(){return"ChipView"}static get type(){return"chipview"}static get configurable(){return{itemCls:"b-chip",closable:!0,iconTpl:null,closeHandler:null}}itemContentTpl(e,t){const r=this;return TemplateHelper.tpl`${r.iconTpl?this.iconTpl(e):""}
            ${r.itemTpl(e,t)}
            ${r.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){this.closable&&this.selected.count&&("Delete"===e.key||"Backspace"===e.key)?this.callback(this.closeHandler,this.owner,[this.selected.values,{isKeyEvent:!0}]):super.onInternalKeyDown(e)}updateClosable(e){this.element.classList[e?"add":"remove"]("b-chips-closable"),this.navigator.disabled=!e,this.isConfiguring||this.refresh()}onClick(e){const t=this,r=e.target.closest("."+t.itemCls);if(t.closable&&e.target.classList.contains("b-close-icon")){const e=t.store.getAt(parseInt(r.dataset.index));t.callback(t.closeHandler,t.owner,[[e]])}else super.onClick(e)}}ChipView.initClass(),ChipView._$name="ChipView";const errorFieldRequired="L{Field.fieldRequired}",errorValidateFilter="L{Field.validateFilter}";class Combo extends PickerField{static get $name(){return"Combo"}static get type(){return"combo"}static get alias(){return"combobox,dropdown"}static get configurable(){return{primaryFilter:{},picker:{type:"list",floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},multiSelect:null,items:null,store:null,valueField:void 0,displayField:"text",pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:e=>e.map((e=>e.value)),filterOnEnter:!1,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:"all",filterOperator:"startsWith",caseSensitive:!1,hidePickerOnSelect:null,chipView:{$config:["lazy","nullify"],value:{type:"combochipview"}},chipStore:{$config:["lazy","nullify"],value:{}},filterSelected:null,emptyText:null,value:null,validateFilter:!0,clearTextOnPickerHide:!0}}static get queryLast(){return"last"}construct(e){super.construct(...arguments),this.store||(this.items=[]),this.filterOnEnter&&(this.hideTrigger=!0)}startConfigure(e){this.usingRecordAsValue=null===e.valueField,super.startConfigure(...arguments)}afterConfigure(){super.afterConfigure(),"_value"in this||(this._value=this.valueField===this.displayField?"":null)}get childItems(){const{_chipView:e,_picker:t}=this,r=[];return e&&r.push(e),t&&r.push(t),r}changeChipStore(e){return!e||e instanceof Store||(e=new Store(Store.mergeConfigs({storage:this.valueCollection},e))),e}updateChipStore(e,t){null==t||t.destroy()}changeChipView(e,t){const r=this,{input:n}=r;let i;return e&&!(i=r.chipStore)&&(r.chipStore={},i=r.chipStore),e||!r.multiSelect||r.isDestroying||(e={}),ComboChipView.reconfigure(t,e,{defaults:{parent:r,insertBefore:n,store:i,closable:!r.readOnly,navigator:{class:ComboChipNavigator,keyEventTarget:n}}})}updateChipView(e){var t;const r=this;r._chipViewEventDetacher=null===(t=r._chipViewEventDetacher)||void 0===t?void 0:t.call(r),r.chipStore=null==e?void 0:e.store,e&&(e.element.appendChild(r.input),r._chipViewEventDetacher=EventHelper.on({element:e.element,mousedown:"onChipViewMousedown",thisObj:r}))}updateMultiSelect(e){const t=this,r=e?t.chipView:t._chipView,{input:n}=t,{parentNode:i}=n,s=!t.isConfiguring;let o,{value:a}=t;t.element.classList[e?"add":"remove"]("b-multiselect"),e?(r||(t.chipView={type:"combochipview"}),o=t.chipView.element,o!==i&&(i.insertBefore(o,n),o.appendChild(n),t.chipView.refresh()),n.value="",s&&!Array.isArray(a)&&(a=a?[a]:null)):((o=null==r?void 0:r.element)===i&&(o.parentNode.insertBefore(n,o),o.remove()),s&&"string"!=typeof a&&(a=a&&a.length?a[0]:null)),s&&(t.value=a)}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(e,t={}){(t.isKeyEvent&&""===this.input.value||!t.isKeyEvent)&&(this._isUserAction=!0,this.valueCollection.remove(e),this._isUserAction=!1)}updateFilterParamName(e){!1!==this.hideTrigger&&(this.hideTrigger=Boolean(e))}updateHideTrigger(e){this.element.classList[e?"add":"remove"]("b-hide-trigger")}updateKeyStrokeFilterDelay(e){const t=this;e&&(t.filterList=t.buffer(t.doFilter,e))}updateReadOnly(e){super.updateReadOnly(...arguments),this._chipView&&(this._chipView.closable=!e)}get minChars(){const e=this._minChars;return null!=e?e:this.remoteFilter?4:1}get items(){return this.store.allRecords}changeItems(e){const t=this;if(null==e){if(t.store&&!t.store.isItemStore)return;e=[]}if(e instanceof Store)return void(t.store=e);const r=t.displayField;let n,i,s=t.valueField;if(Array.isArray(e)?i=e.map((e=>{let i=e;return e instanceof Model?(n=e.constructor,s||(t.valueField=s=n.idField)):"string"==typeof e||"number"==typeof e?(s||(t.valueField=s=t.displayField),i={[s]:e,[r]:e}):(s||(t.valueField=s="value"),Array.isArray(e)&&(i={[s]:e[0],[r]:e[1]})),i.selected&&(t.value=i),i})):(s||(t.valueField=s="value"),i=[],Object.entries(e).forEach((([e,t])=>{i.push({[s]:e,[r]:t})}))),t.store)t.store.data=i;else{const e=s===r?{name:"value",dataSource:r}:s;t.store=new Store({isItemStore:!0,data:i,idField:s,modelClass:n||class extends Model{static get idField(){return t.valueField}static set idField(e){super.idField=e}static get fields(){return[e,r]}}})}}get value(){const{valueCollection:e,valueField:t}=this;return null==t?this.multiSelect?e.values.slice():e.first:this.multiSelect?e.map((e=>e[t])):e.count?e.first[t]:this._value}set value(e){super.value=e}changeValue(e,t){const r=this;if(e===t)return void r.syncInputFieldValue(!0);if(!r.multiSelect&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiSelect Combo");r.triggerConfig("items");const{valueField:n,displayField:i,store:s,valueCollection:o}=r;if(r.remoteFilter){if(null!=e){if("object"!=typeof e){const t=r.isConfiguring;return r.primaryFilter.setConfig({value:e,disabled:!1}),void s.performFilter(!0).then((()=>{const{isConfiguring:e}=r;r.isConfiguring=t,o.splice(0,o.count,s.allRecords),r.isConfiguring=e}))}this.store.data=[e],this.valueCollection.splice(0,this.valueCollection.count,this.store.first)}}else s.filtered&&(r.primaryFilter.disabled=!0,s.filter());let a;if(null!=e){const t=Array.isArray(e),l=t?e.slice():[e];for(let e=0,t=l.length;e<t;e++){let r=l[e];if(r instanceof Model)s.storage.includes(r)||s.add(r);else{const o=ObjectHelper.isObject(r);o&&(r=r[n]),a=s.storage.getBy(i,r)||s.storage.getBy(n,r),a?(o&&a.set(l[e]),l[e]=a):(l.splice(e,1),t--,e--)}}const c=o.generation;o.splice(0,o.count,l),o.generation===c&&r.syncInputFieldValue(),l.length||(r._value=t?l[0]||null:e)}else if(o.count)o.clear();else{const t=r._value;r._value=null,r.syncInputFieldValue(),r.syncEmpty(),r.isConfiguring||r.triggerFieldChange({value:e,oldValue:t,userAction:r._isUserAction,valid:r.isValid})}r._lastValue=r.value}onComboStoreChange({action:e}){"filter"!==e&&this.syncInputFieldValue(!0)}syncInputFieldValue(e){this.multiSelect||super.syncInputFieldValue(e)}get isEmpty(){return 0===this.valueCollection.count}get inputValue(){const e=this;let t=e.value;return t=e.selected?e.selected[e.displayField]:t,e.displayValueRenderer&&(t=e.callback(e.displayValueRenderer,e,[e.selected,e])),null==t?"":t}get valueCollection(){let e=this._valueCollection;return e||(this._valueCollection=e=new Collection({listeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),e}changePrimaryFilter(e){return e instanceof CollectionFilter||("function"==typeof e&&(e={filterBy:e}),e=new CollectionFilter({id:"primary",disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive,...e})),e}changeStore(e){if(!Array.isArray(e)){if(e){"string"==typeof e?e=Store.getStore(e):ObjectHelper.isObject(e)&&(e=new(e.readUrl?AjaxStore:Store)(e));const t=this,r=t.remoteFilter||e.restfulFilter,{filterParamName:n}=t,i=[];r&&n&&(e.filterParamName=n,t.encodeFilterParams&&(e.encodeFilterParams=t.encodeFilterParams)),t.valueField||t.usingRecordAsValue||(t.valueField=e.modelClass.idField),i.push(t.primaryFilter),r?t.filterSelected&&(e.storage.autoFilter=!0,e.storage.addFilter({id:t.id+"-selected-filter",filterBy:e=>!t.valueCollection.includes(e)})):t.filterSelected&&(t.selectedItemsFilter=e=>!t.valueCollection.includes(e),i.push(t.selectedItemsFilter),e.reapplyFilterOnAdd=!0),e.filter(i)}return e}this.items=e}updateStore(e){const t=this,{_picker:r}=t;let n;r&&(r.store=e),e.storage.addIndex(t.displayField),e.storage.addIndex(t.valueField),t.remoteFilter&&(n={filter:"onRemoteFilter"}),t.displayValueRenderer&&((n||(n={})).change="onComboStoreChange",t.syncInputFieldValue()),t.detachListeners("store"),n&&(n.name="store",n.thisObj=t,e.on(n))}get remoteFilter(){var e;return Boolean(this.filterParamName||(null===(e=this._store)||void 0===e?void 0:e.restfulFilter))}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){return this.valueCollection.first}onEditComplete(){const e=this,t=e.valueCollection.count;super.onEditComplete(),t&&(e.clearError(errorValidateFilter),e.syncInputFieldValue()),e.required&&!t&&e.setError(errorFieldRequired)}onTriggerClick(){var e;const t=this;if(!t.remoteFilter||!t.filterOnEnter)if(t.pickerVisible)t.hidePicker();else if(!t.readOnly&&!t.disabled)switch(null===(e=t.triggerAction)||void 0===e?void 0:e.toLowerCase()){case"all":t.doFilter(null);break;case"last":t.doFilter(t.lastQuery);break;default:t.doFilter(t.input.value)}}internalOnInput(e){const t=this,r=t.input.value,n=r.length;t.editable&&(t.syncEmpty(),t.syncInputWidth(),t.inputting=!0,n>=t.minChars&&!t.filterOnEnter?t.filterList(r):(t.validateFilter&&!t.remoteFilter&&t[n?"setError":"clearError"](errorValidateFilter),t.hidePicker()),t.inputting=!1,t.trigger("input",{value:r,event:e}))}syncInputWidth(){const e=this;if(e.multiSelect){const t=e.input,r=e._inputPadding||(e._inputPadding=DomHelper.getEdgeSize(t,"padding","lr")),n=t.value||"",i=DomHelper.measureText(n+"W",t,!1,e.element)+r.width;t.style.flex=`1 1 ${Math.ceil(i)}px`}}filterList(e){this.doFilter(e)}doFilter(e){const t=this,{store:r}=t,{_picker:n}=t,i=null==e||""===e;t.lastQuery=e,t.primaryFilter.setConfig({value:e,disabled:i}),t.remoteFilter&&r.clear(!0),t.getConfig("picker"),r.filter(),(null==n?void 0:n.isVisible)?0===n.lastAlignSpec.zone&&n.realign():t.showPicker(),r.count?i||(t.picker.navigator.activeItem=0):t.remoteFilter||i||!t.validateFilter||t.setError(errorValidateFilter)}onRemoteFilter(){const e=this,t=e._picker;e.store.count?t&&(t.navigator.activeItem=0):e.validateFilter&&e.setError(errorValidateFilter),e.filterSelected&&e.valueCollection.count&&(e.store.storage.onFiltersChanged(),t&&t.refresh())}onValueCollectionChange({source:e}){var t;const r=this,{multiSelect:n,_picker:i}=r,s=null!==(t=r.hidePickerOnSelect)&&void 0!==t?t:!n,o=n?e.values.slice():e.first,a=e.values.slice(),l=r._isUserAction||(null==i?void 0:i._isUserAction)||s&&r.pickerVisible||!1,c=r._value;s&&r.hidePicker(),!e.count&&r.required?r.setError(errorFieldRequired):(r.clearError(errorFieldRequired),r.clearError(errorValidateFilter)),r.validateFilter&&o&&r.clearError(errorValidateFilter),r.filterSelected&&(r.remoteFilter?(r.store.storage.onFiltersChanged(),r._picker&&r._picker.refresh()):r.store.filter()),r._value=null;const d=r._value=r.value;r.syncInputFieldValue(),r.syncEmpty(),r.isConfiguring||(r.triggerFieldChange({value:d,oldValue:c,userAction:l,valid:r.isValid}),r.trigger("select",{record:o,records:a,userAction:l}),"select"===r.defaultAction&&r.trigger("action",{value:d,record:o,records:a,userAction:l}))}onValueCollectionNoChange({toAdd:e}){!this.multiSelect&&e.length&&this.pickerVisible&&this.picker.hide()}showPicker(){const e=this,{picker:t}=e;e.readOnly||(t.multiSelect=e.multiSelect,super.showPicker(),e.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),!e.multiSelect&&e.selected&&t.restoreActiveItem(e.selected,!0),e.input.focus())}changePicker(e,t){var r;const n=this,i=n.pickerWidth||(null===(r=e)||void 0===r?void 0:r.width);return(e=List.reconfigure(t,e?List.mergeConfigs({owner:n,store:n.store,selected:n.valueCollection,multiSelect:n.multiSelect,cls:n.listCls,itemTpl:n.listItemTpl||(e=>e[n.displayField]),forElement:n[n.pickerAlignElement],align:{matchSize:null==i,anchor:n.overlayAnchor,target:n[n.pickerAlignElement],minHeight:40*Math.min(3,n.store.count)},width:i,navigator:{keyEventTarget:n.input}},e):null,n))&&(e.element.dataset.emptyText=n.emptyText||n.L("L{noResults}")),e}onPickerHide(){const e=this;super.onPickerHide(),e.multiSelect&&e.clearTextOnPickerHide&&(e.input.value="")}internalOnKeyEvent(e){const t=this,r=t.input.value,n=r.length;super.internalOnKeyEvent(...arguments),"keydown"===e.type&&"Enter"===e.key&&t.filterOnEnter&&n>=t.minChars&&(e.stopPropagation(),t.filterList(r))}}class ComboChipView extends ChipView{static get $name(){return"ComboChipView"}static get type(){return"combochipview"}static get defaultConfig(){return{closeHandler:"up.onChipClose",itemsFocusable:!1,multiSelect:!0,itemTpl(e){return e[this.owner.displayField]},scrollable:{overflowY:"auto"}}}}class ComboChipNavigator extends Navigator{static get defaultConfig(){return{allowShiftKey:!0}}onTargetClick(e){const t=e.target.closest(this.itemSelector);!t||e.shiftKey||t.contains(e.target.closest("[data-noselect]"))||this.ownerCmp.selected.clear(),this.inClickHandler=!0,this.activeItem=t,this.inClickHandler=!1}onKeyDown(e){"Enter"!==e.key&&super.onKeyDown(e)}updateActiveItem(e,t){const r=this.ownerCmp;super.updateActiveItem(e,t),e&&!this.inClickHandler&&r.selected.add(r.getRecord(e))}navigatePrevious(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.previous?super.navigatePrevious(e):this.activeItem=null}navigateNext(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}}Combo.initClass(),ComboChipView.initClass(),Combo._$name="Combo";class BooleanCombo extends(Localizable(Combo)){static get $name(){return"BooleanCombo"}static get type(){return"booleancombo"}static get configurable(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,store:{value:[],$config:"lazy"},value:!1}}changeStore(e,t){const r=this;return super.changeStore(new Store({data:[{id:r.positiveValue,text:r.positiveText||r.L("L{Object.Yes}")},{id:r.negativeValue,text:r.negativeText||r.L("L{Object.No}")}]}),t)}}BooleanCombo.initClass(),BooleanCombo._$name="BooleanCombo";class ButtonGroup extends Container{static get $name(){return"ButtonGroup"}static get type(){return"buttongroup"}static get configurable(){return{defaultType:"button",cls:null,items:null,color:null,toggleGroup:null,valueSeparator:",",columns:null}}updateReadOnly(e){this.element.style.pointerEvents=e?"none":""}onChildAdd(e){super.onChildAdd(e),e.on({click:"onItemClick",thisObj:this})}onChildRemove(e){e.un({click:"onItemClick",thisObj:this}),super.onChildAdd(e)}onItemClick(){this._value=null}createWidget(e){const t=this;return t.constructor.resolveType(e.type||"button").isButton&&(t.color&&!e.color&&(e.color=t.color),t.toggleGroup&&!e.toggleGroup&&("boolean"==typeof t.toggleGroup&&(t.toggleGroup=ButtonGroup.generateId("toggleGroup")),e.toggleGroup=t.toggleGroup)),t.columns&&(e.width=100/t.columns+"%"),super.createWidget(e)}get value(){if(!this._value){const e=[];this.items.forEach((t=>{t.pressed&&void 0!==t.value&&e.push(t.value)})),this._value=e.join(this.valueSeparator)}return this._value}set value(e){Array.isArray(e)||(e=null==e?[]:"string"==typeof e?e.split(this.valueSeparator):[e]),this._value=e,this.items.forEach((t=>{void 0!==t.value&&(t.pressed=e.indexOf(t.value)>-1)}))}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.items.forEach((t=>t.disabled=e))}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}}ButtonGroup.initClass(),ButtonGroup._$name="ButtonGroup";class CalendarPanel extends Panel{static get $name(){return"CalendarPanel"}static get type(){return"calendarpanel"}static get configurable(){return{textContent:!1,date:{$config:{equal:"date"},value:null},month:{},year:null,weekStartDay:!1,sixWeeks:!0,showWeekNumber:null,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:{0:!0,6:!0},tip:null,dayCellCls:"b-calendar-cell",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null}}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onPaint({firstPaint:e}){e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){this.tip&&this.tip.destroy(),super.doDestroy()}changeMinRowHeight(e){const t=parseInt(DomHelper.getStyleValue(this.element,"--min-row-height"),10)||75;return null==e?e:Math.max(parseInt(e)||0,t)}updateMinRowHeight(e){this.weekElements.forEach((t=>DomHelper.setLength(t,"flexBasis",e))),this.scrollable={overflowY:!!e&&"auto"}}changeMinColumnWidth(e){const t=parseInt(DomHelper.getStyleValue(this.element,"--min-column-width"),10)||75;return null==e?e:Math.max(parseInt(e)||0,t)}updateMinColumnWidth(e){const t=this;t.weekdayCells.forEach((t=>DomHelper.setLength(t,"minWidth",e))),t.cellElements.forEach((r=>r.matches("."+t.dayCellCls)&&DomHelper.setLength(r,"minWidth",e))),t.scrollable={overflowX:!!e&&"auto"},t.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromEvent(e){const t=(1===e.nodeType?e:e.target).closest(`#${this.id} [data-date]`);if(t)return DateHelper.parseKey(t.dataset.date)}changeTip(e,t){const r={pointerOver:"onTipOverCell",thisObj:this};return t&&t.un(r),e&&(e instanceof Widget||(e=Widget.create(Object.assign({owner:this,type:"tooltip",id:this.id+"-cell-tip",forElement:this.bodyElement,forSelector:"."+this.dayCellCls},e))),e.on(r)),e}changeElement(e){const t=this;e=super.changeElement(...arguments),t.updateHideNonWorkingDays(t.hideNonWorkingDays),t.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),t.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),t.cellElements=[];for(let e=0,{length:r}=t.weekDayElements;e<r;e++)t.cellElements.push(t.weekDayElements[e].previousSibling,...t.weekDayElements[e].children);return e}changeDate(e){if(e="string"==typeof e?DateHelper.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return DateHelper.clearTime(e)}updateDate(e){this.month.date=e}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let t=4;t<11;t++)e.setDate(t),this.shortDayNames.push(DateHelper.format(e,this.dayNameFormat))}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:DateHelper.weekStartDay}updateWeekStartDay(e){const t=this;if(t._month){t.month.weekStartDay=e,t.dayNames=[];for(let e=0;e<7;e++)t.dayNames[e]=t.shortDayNames[t.canonicalDayNumbers[e]];t.refresh()}}updateHideNonWorkingDays(e){var t;this.contentElement.classList[e?"add":"remove"](this.hideNonWorkingDaysCls),null===(t=this.scrollable)||void 0===t||t.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e)}changeNonWorkingDays(e){return ObjectHelper.assign({},e)}updateNonWorkingDays(e){var t;this._month&&(this.month.nonWorkingDays=e,this.refresh(),null===(t=this.scrollable)||void 0===t||t.syncOverflowState())}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return DateHelper.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return DateHelper.add(e,1,"day")}changeMonth(e,t){const r=this;if(!(e instanceof Month)){if("number"==typeof e){if(t)return void(t.month=e);const n=r.date||DateHelper.clearTime(new Date);n.setMonth(e),e={date:n}}e=new Month(ObjectHelper.assign({weekStartDay:r.weekStartDay,nonWorkingDays:r.nonWorkingDays,hideNonWorkingDays:r.hideNonWorkingDays,sixWeeks:r.sixWeeks},e))}return e.on({dateChange:"onMonthDateChange",thisObj:r}),e}onMonthDateChange({source:e,newDate:t,oldDate:r}){const n=this;n.year=e.year,n.isConfiguring||(n.refresh(),r-t&&n.trigger("dateChange",{value:t,oldValue:r}))}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-column"),t.floating&&(t.isAligning||t.realign())}refresh(){this.doRefresh()}doRefresh(){this.getConfig("element");const e=this,t=DateHelper.clearTime(new Date),{cellElements:r,weekElements:n,weekDayElements:i,date:s,month:o,dayCellCls:a,disabledCls:l,otherMonthCls:c,weekendCls:d,todayCls:u,nonWorkingDayCls:h,canonicalDayNumbers:g}=e;s||(e.date=t),e.getConfig("dayNameFormat");for(let e=0,t=r.length;e<t;e++)r[e].lastDomConfig=null,r[e].className=a;for(let t=0;t<7;t++){const r=e.weekdayCells[t],n=e.canonicalDayNumbers[t],i=r.classList;r.className=r.innerHTML="",e.headerRenderer?e.headerRenderer(r,t,n):r.innerHTML=e.shortDayNames[n],i.add("b-calendar-day-header"),0!==n&&6!==n||i.add(d),e.nonWorkingDays[n]&&i.add(h),r.dataset.columnIndex=t,r.dataset.cellDay=n}let m=0,p=0,f=6;for(let t=6;t>=0;t--)if(!e.nonWorkingDays[g[t]]){f=t;break}o.eachWeek(((r,s)=>{const a=i[m],g=[a.previousSibling,...a.children];n[m].dataset.week=`${r[0]},${r[1]}`,g[0].className="b-week-number-cell",e.weekRenderer?e.weekRenderer(g[0],r):g[0].innerHTML=r[1];for(let n=0;n<7;n++){const i=s[n],a=i.getDay(),m=g[n+1],v=m.classList;e.isDisabledDate(i)&&v.add(l),i.getMonth()!==o.month&&v.add(c),0!==a&&6!==a||v.add(d),i.getTime()===t.getTime()&&v.add(u),e.nonWorkingDays[a]&&v.add(h),v[n===f?"add":"remove"]("b-last-working-day"),m.dataset.date=DateHelper.makeKey(i),m.dataset.cellIndex=p,m.dataset.columnIndex=n,e.cellRenderer?e.cellRenderer({cell:m,date:i,day:a,cellIndex:p,columnIndex:n,visibleColumnIndex:e.visibleDayColumnIndex[a],week:r}):m.innerHTML=i.getDate(),p++}m++})),e.floating&&(e.isAligning||e.realign()),e.refreshCount=(e.refreshCount||0)+1,e.trigger("refresh")}isDisabledDate(e){const t=e.getDay(),r=this.disabledDates;if(this.disableWeekends&&(0===t||6===t))return!0;if(r){if("function"==typeof r)return r(e);if(Array.isArray(r))return e=DateHelper.clearTime(e,!0),r.some((t=>!(DateHelper.clearTime(t,!0)-e)))}}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",reference:"weekdaysHeader",children:this.dayNameCells},{className:"b-weeks-container notranslate",reference:"weeksElement",children:t}];for(let e=0;e<6;e++){const e={className:"b-calendar-row b-calendar-week",children:[{},{className:"b-calendar-days",children:[]}]};for(let t=0;t<7;t++)e.children[1].children.push({});t.push(e)}return e}get dayNameCells(){const e=this,t=document.createElement("div"),r=[t];e.weekdayCells=[],t.className="b-week-number-cell";for(let t=0;t<7;t++){const t=document.createElement("div");r.push(t),e.weekdayCells.push(t)}return r}get firstVisibleDate(){for(const e=this.month.startDate;;e.setDate(e.getDate()+1))if(!this.hideNonWorkingDays||!this.nonWorkingDays[e.getDay()])return e}getCell(e){return"string"!=typeof e&&(e=DateHelper.makeKey(e)),this.weeksElement.querySelector(`[data-date="${e}"]`)}onTipOverCell({source:e,target:t}){e.date=DateHelper.parseKey(t.dataset.date)}updateLocalization(){this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}}CalendarPanel.initClass(),CalendarPanel._$name="CalendarPanel";class Checkbox extends Field{static get $name(){return"Checkbox"}static get type(){return"checkbox"}static get alias(){return"check"}static get configurable(){return{inputType:"checkbox",text:"",color:null,value:"",toggleGroup:null,defaultBindProperty:"value",localizableProperties:["label","text"]}}construct(e){"checked"in e&&((e=ObjectHelper.assign({},e)).value=e.checked,delete e.checked),super.construct(e),this.syncHasText()}get innerElements(){return[this.inputElement,{tag:"label",class:"b-checkbox-label",for:this.id+"-input",reference:"textLabel",html:this.text||""}]}get inputElement(){const e=this,t=super.inputElement;return e.toggleGroup&&(t.dataset={group:e.toggleGroup}),t}get checked(){return this.value}set checked(e){this.value=e}syncHasText(){this.element.classList[this.text?"add":"remove"]("b-text")}updateText(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}changeValue(e){return"false"!==e&&Boolean(e)}updateValue(e){const t=this;t.inputting||(t.inputting=!0,t.input.checked=e,t.inputting=!1,t.uncheckToggleGroupMembers(),t.isConfiguring||t.triggerChange(!1))}get inputValueAttr(){return"checked"}updateColor(e,t){const r=this.element.classList;t&&r.remove(t),e&&r.add(e)}getToggleGroupMembers(){const{checked:e,toggleGroup:t,input:r}=this,n=[];return e&&t&&DomHelper.forEachSelector(`input[type=checkbox][data-group=${t}]`,(e=>{if(e!==r){const t=Widget.fromElement(e);t&&n.push(t)}})),n}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>e.checked=!1))}updateReadOnly(e){this.input.disabled=e,super.updateReadOnly(e)}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnChange(e){const t=this;t.inputting||(t.inputting=!0,t.value=t.input.checked,t.triggerChange(!0),t.inputting=!1)}triggerChange(e){const t=this,{checked:r}=t.input;(!r&&e&&t.toggleGroup&&t.getToggleGroupMembers().filter((e=>e.isVisible&&!e.disabled)).length||!t.callPreventable("change",{checked:r,value:r,userAction:e,valid:!0},(r=>(t.triggerFieldChange(r,!1),e&&t.uncheckToggleGroupMembers(),t.trigger("action",r),!0))))&&(t.input.checked=t._value=!r)}}Checkbox.initClass(),Checkbox._$name="Checkbox";class Fit extends Layout{static get $name(){return"Fit"}static get configurable(){return{containerCls:"b-fit-container",itemCls:"b-fit-item"}}}Fit._$name="Fit",Layout.registerLayout(Fit);class Editor extends Container{static get $name(){return"Editor"}static get type(){return"editor"}static get configurable(){return{positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",invalidAction:"block",completeOnChange:null}}afterConfigure(){const e=this;super.afterConfigure(),e.onTargetSizeChange=e.onTargetSizeChange.bind(e),(e.completeKey||e.cancelKey)&&EventHelper.on({element:e.element,keydown:"onKeyDown",thisObj:e}),e.on({hide:"afterEditorHide",thisObj:e}),LocaleManagerSingleton.on({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){const{inputField:e}=this;e&&!e.isDestroyed&&e.syncInputFieldValue&&e.syncInputFieldValue(!0)}startEdit({target:e,align:t=this.align,hideTarget:r=!1,matchSize:n=!0,matchFont:i=!0,fitTargetContent:s=!1,value:o,record:a,field:l=this.inputField.name,focus:c=!0}){const d=this,{inputField:u}=d,h=DomHelper.getStyleValue(e,"font-size"),g=DomHelper.getStyleValue(e,"font-family");if(!1!==d.trigger("beforestart",{value:o})){if(a&&l&&void 0===o&&(d.record=a,d.dataField=l,o=a[l]),n&&(e instanceof HTMLElement&&d.updateSize(e),e instanceof HTMLElement&&ResizeMonitor.addResizeListener(e,d.onTargetSizeChange)),u.input&&(i?(u.input.style.fontSize=h,u.input.style.fontFamily=g):u.input.style.fontSize=u.input.style.fontFamily=""),u.clearError&&u.clearError(),u.value=o,u.initialValue=u.value,d.showBy({target:e,...t}),s){const e=u.input.scrollWidth-u.input.clientWidth;e>0&&(d.width+=e+DomHelper.scrollBarWidth)}return c&&d.inputField.focus&&d.inputField.focus(),1===e.nodeType&&(e.classList.add("b-editing"),r&&e.classList.add("b-hide-visibility")),d.editing=!0,d.trigger("start",{value:u.value}),d.oldValue=u.value,Array.isArray(d.oldValue)&&(d.oldValue=d.oldValue.slice()),!0}return!1}refreshEdit(){if(this.isVisible){const{record:e,dataField:t,inputField:r}=this;if(e&&t){const n=e[t];ObjectHelper.isEqual(r.value,n)||(r.value=n)}}}finishEdit(){const{target:e}=this.lastAlignSpec;1===e.nodeType&&(e.classList.remove("b-editing"),e.classList.remove("b-hide-visibility")),this.editing=!1}onKeyDown(e){const t=this;switch(e.key){case t.completeKey:t.completeEdit(),e.stopImmediatePropagation();break;case t.cancelKey:t.cancelEdit(),e.stopImmediatePropagation()}t.trigger("keydown",{event:e})}onFocusOut(e){if(super.onFocusOut(e),!this.isFinishing&&this.editing){const e=this[this.blurAction+"Edit"];e&&e.call(this)}}async completeEdit(e){const t=this,{inputField:r,oldValue:n,record:i}=t,s=r.invalidAction||(!1===r.allowInvalid?"block":t.invalidAction),{value:o}=r;if(t.isVisible){if(r.isValid){if(ObjectHelper.isEqual(o,n))return t.cancelEdit(),!0;{const a={inputField:r,record:i,value:o,oldValue:n};if(!1!==t.trigger("beforeComplete",a)){if(e||(e=a.finalize||a.editorContext&&a.editorContext.finalize),e){let i=await e(a);if(!0===i)t.onEditComplete();else{if(r.setError){const e=i||r.invalidValueError,t=()=>{n(),r.clearError(e)},n=r.on({change:t,input:t});r.setError(e)}"block"===s?r.focus&&r.focus():"revert"===s&&(r.value=n,i=!0),i=!1}return i}return t.onEditComplete(),!0}r.focus&&r.focus()}}else{if("block"===s)return r.focus&&r.focus(),!1;if("revert"===s)return t.cancelEdit(),!0}return!1}}cancelEdit(){const e=this,{inputField:t,oldValue:r}=e,{value:n}=t;e.isVisible&&!e.isFinishing&&!1!==e.trigger("beforeCancel",{value:n,oldValue:r})&&(e.isFinishing=!0,e.hide(),e.trigger("cancel",{value:n,oldValue:r}),e.finishEdit(),e.isFinishing=!1)}onEditComplete(){const e=this,{record:t,dataField:r,inputField:n,oldValue:i}=e,{value:s}=n;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t){const e="set"+StringHelper.capitalize(r);t[e]?t[e](s):t[r]=s}e.trigger("complete",{value:s,oldValue:i}),e.finishEdit(),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||Widget.fromElement(this.element.parentNode)}changeInputField(e,t){const r=this;return t&&t.destroy(),"string"==typeof e&&(e={type:e}),e instanceof Widget||(e=Widget.create(e),r.createdInputField=!0),r.completeOnChange&&e.on({change:"onInputFieldChange",thisObj:r}),e.parent=r,e}updateInputField(e){this.removeAll(),this.add(e)}get inputField(){return this.items[0]}onInputFieldChange(){this.containsFocus&&this.completeEdit()}onTargetSizeChange(e,t,r){t&&r&&this.updateSize(e)}updateSize(e){const t=e.getBoundingClientRect();this.width=t.width-this.align.offset[0],this.height=t.height}afterEditorHide(){ResizeMonitor.removeResizeListener(this.lastAlignSpec.target,this.onTargetSizeChange)}}Editor.initClass(),Editor._$name="Editor";class DatePicker extends CalendarPanel{static get $name(){return"DatePicker"}static get type(){return"datepicker"}static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{$config:{equal:"date"},value:null}}}static get defaultConfig(){return{focusable:!0,textContent:!1,tools:{prevMonth:{align:"start",cls:"b-icon b-icon-angle-left",handler:"gotoPrevMonth"},nextMonth:{align:"end",cls:"b-icon b-icon-angle-right",handler:"gotoNextMonth"}},header:{title:'<div class="b-editable b-datepicker-month" data-reference="monthElement"></div> <div class="b-editable b-datepicker-year" data-reference="yearElement"></div>',titleAlign:"center"},minDate:null,maxDate:null,outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date",focusDisabledDates:null,multiSelect:!1,editOnHover:!0,editMonth:!0}}construct(e){const t=this;t.selection=[],super.construct(e),t.element.setAttribute("aria-activedescendant",t.id+"-active-day"),EventHelper.on({element:t.element,mouseover:"onPickerMouseover",click:"onPickerClick",thisObj:t})}doDestroy(){this._yearEditor&&this._yearEditor.destroy(),this._monthEditor&&this._monthEditor.destroy(),super.doDestroy()}get focusElement(){return this.element}get childItems(){const e=super.childItems;return this._yearEditor&&e.unshift(this._yearEditor),this._monthEditor&&e.unshift(this._monthEditor),e}refresh(){const e=this,t=DomHelper.scrollBarWidth;super.refresh(),e.monthElement.innerHTML=DateHelper.format(e.month.date,"MMMM"),e.yearElement.innerHTML=DateHelper.format(e.month.date,"YYYY"),e.editMonth&&(e.monthElement.style.minWidth=`calc(${e.maxMonthLength+1}ch + ${t}px)`,e.yearElement.style.minWidth=t?`calc(3ch + ${t}px`:"7ch")}cellRenderer({cell:e,date:t}){const r=this,{activeCls:n,selectedCls:i}=r,s=e.classList;e.innerHTML=t.getDate(),e.setAttribute("aria-label",DateHelper.format(t,"MMMM D, YYYY")),r.isActiveDate(t)?(s.add(n),e.id=r.id+"-active-day"):e.removeAttribute("id"),r.isSelectedDate(t)&&s.add(i),(r.minDate&&t<r.minDate||r.maxDate&&t>r.maxDate)&&s.add(r.outOfRangeCls)}onPickerMouseover(e){if(this.editOnHover){if(this.editMonth&&DomHelper.up(e.target,".b-editable"))return this.onEditGesture(e)}}onPickerClick(e){const t=this,{target:r}=e,n=DomHelper.up(r,`.${t.dayCellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`),i=t.editMonth&&DomHelper.up(r,".b-editable");return n?t.onCellClick(e):t.editOnHover&&!DomHelper.isTouchEvent||!i?(t._monthEditor&&!t._monthEditor.owns(e)&&t._monthEditor.cancelEdit(),void(t._yearEditor&&!t._yearEditor.owns(e)&&t._yearEditor.cancelEdit())):t.onEditGesture(e)}onCellClick(e){this.onUIDateSelect(DateHelper.parseKey(e.target.dataset.date),e)}onEditGesture(e){const t=this,{month:r}=t,{target:n}=e;n===t.monthElement?t.monthEditor.startEdit({target:n,value:r.month,fitTargetContent:!1,hideTarget:!0}):n===t.yearElement&&(t.yearEditor.minWidth=DomHelper.scrollBarWidth+50+"px)",t.yearEditor.startEdit({target:n,value:r.year,fitTargetContent:!0,hideTarget:!0}))}onUIDateSelect(e,t){const r=this,{lastClickedDate:n,selection:i}=r;r.activeDate=e,r.lastClickedDate=e,r.isDisabledDate(e)||(r.activatingEvent=t,r.multiSelect?r.multiRange||n&&e.getTime()===n.getTime()||(n&&t.shiftKey?(i[1]=e,i.sort()):(i.length=0,i[0]=e),r.trigger("selectionChange",{selection:i,userAction:Boolean(t)})):r.value&&r.value.getTime()===e.getTime()?r.floating&&r.hide():r.value=e,r.activatingEvent=null),r.refresh()}onInternalKeyDown(e){const t=this,r=e.key.trim()||e.code,n=t.activeDate,i=new Date(n);if("Escape"===r&&t.floating)return t.hide();if(n&&e.target===t.focusElement){do{switch(r){case"ArrowLeft":e.preventDefault(),e.ctrlKey?i.setMonth(i.getMonth()-1):i.setDate(i.getDate()-1);break;case"ArrowUp":e.preventDefault(),i.setDate(i.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?i.setMonth(i.getMonth()+1):i.setDate(i.getDate()+1);break;case"ArrowDown":e.preventDefault(),i.setDate(i.getDate()+7);break;case"Enter":return t.onUIDateSelect(n,e)}}while(t.isDisabledDate(i)&&!t.focusDisabledDates);if(t.minDate&&i<t.minDate)return;if(t.maxDate&&i>t.maxDate)return;t.activeDate=i}}set minDate(e){this._minDate=e?this.changeDate(e):null,this.refresh()}get minDate(){return this._minDate}set maxDate(e){this._maxDate=e?this.changeDate(e):null,this.refresh()}get maxDate(){return this._maxDate}updateDate(e){super.updateDate(e),this.activeDate=e}changeActiveDate(e){if(e=e?this.changeDate(e):this.date||(this.date=DateHelper.clearTime(new Date)),isNaN(e))throw new Error("DatePicker date ingestion must be passed a Date, or a YYYY-MM-DD date string");return e}updateActiveDate(e){this.month.date=e,this.refresh()}set value(e){const t=this,{selection:r}=t;let n;if(e){if(void 0===(e=t.changeDate(e,t.value)))return;t.value&&e.getTime()===t.value.getTime()||(r.length=0,r[0]=e,n=!0),t.date=e}else n=r.length,r.length=0,t.date=new Date;n&&t.trigger("selectionChange",{selection:r,userAction:Boolean(t.activatingEvent)})}get value(){return this.selection[this.selection.length-1]}gotoPrevMonth(){const{activeDate:e}=this,t=e&&this.getCell(e)?e:this.date,r=new Date(t);r.setMonth(r.getMonth()-1),this.date=r}gotoNextMonth(){const{activeDate:e}=this,t=e&&this.getCell(e)?e:this.date,r=new Date(t);r.setMonth(r.getMonth()+1),this.date=r}isActiveDate(e){return this.activeDate&&this.changeDate(e).getTime()===this.activeDate.getTime()}isSelectedDate(e){return this.selection.some((t=>t.getTime()===e.getTime()))}get monthEditor(){const e=this;return e._monthEditor||(e._monthEditor=new Editor({owner:e,appendTo:e.element,inputField:e.monthInput=new Combo({editable:!1,autoExpand:!e.editOnHover,items:e.monthItems,highlightExternalChange:!1,picker:{align:{align:"t0-b0"},cls:"b-month-picker-list",scrollable:{overflowX:!1}}}),completeOnChange:!0,listeners:{complete:"onMonthPicked",beforeCancel:"onBeforeEditorCancel",thisObj:e}})),e._monthEditor}onMonthPicked({value:e,oldValue:t}){this.activeDate=DateHelper.add(this.activeDate,e-t,"month")}get yearEditor(){const e=this;return e._yearEditor||(e._yearEditor=new Editor({owner:e,appendTo:e.element,inputField:e.yearInput=new Combo({editable:!1,autoExpand:!e.editOnHover,items:e.yearItems,highlightExternalChange:!1,picker:{cls:"b-year-picker-list",scrollable:{overflowX:!1}}}),completeOnChange:!0,listeners:{complete:"onYearPicked",beforeCancel:"onBeforeEditorCancel",thisObj:e}})),e._yearEditor}onYearPicked({value:e}){const t=new Date(this.activeDate);t.setFullYear(e),this.activeDate=t}onBeforeEditorCancel({source:e}){if(e.containsFocus)return this.element.focus(),!1}get monthItems(){return DateHelper.getMonthNames().map(((e,t)=>[t,e]))}get yearItems(){const e=[],t=(new Date).getFullYear();for(let r=t-20;r<t+21;r++)e.push(r);return e}get maxMonthLength(){if(!this._maxMonthLength){this._maxMonthLength=0;for(let e=0,t=this.monthItems;e<12;e++)this._maxMonthLength=Math.max(this._maxMonthLength,t[e][1].length)}return this._maxMonthLength}updateLocalization(){this._monthEditor&&(this._monthEditor.doDestroy(),this._monthEditor=null),this._yearEditor&&(this._yearEditor.doDestroy(),this._yearEditor=null),this._maxMonthLength=0,super.updateLocalization()}}DatePicker.initClass(),DatePicker._$name="DatePicker";class DateField extends PickerField{static get $name(){return"DateField"}static get type(){return"datefield"}static get alias(){return"date"}static get configurable(){return{format:"L",fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:null,weekStartDay:null,picker:{type:"datepicker",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null}}changePicker(e,t){const r=this,n={owner:r,forElement:r[r.pickerAlignElement],minDate:r.min,maxDate:r.max,weekStartDay:r._weekStartDay,align:{anchor:r.overlayAnchor,target:r[r.pickerAlignElement]},onSelectionChange:({selection:e,source:t})=>{t.isVisible&&(r._isUserAction=!0,r.value=e[0],r._isUserAction=!1,t.hide())}};return r.value?n.value=r.value:n.date=new Date,(e=DatePicker.reconfigure(t,e,{owner:r,defaults:n}))&&r.calendarContainerCls&&e.element.classList.add(r.calendarContainerCls),e}get backShiftDate(){return DateHelper.add(this.value,-1*this._step.magnitude,this._step.unit)}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const r=e.backShiftDate;(!t||t.getTime()<=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}get forwardShiftDate(){return DateHelper.add(this.value,this._step.magnitude,this._step.unit)}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const r=e.forwardShiftDate;(!t||t.getTime()>=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}showPicker(e){if(this.readOnly)return;const{_picker:t}=this;t&&(t.value=this.value),super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this,t=e.min,r=e.max;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let n=e.value;if(n){if(n=n.getTime(),t&&t.getTime()>n)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(r&&r.getTime()<n)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e){return null!=e&&(DateHelper.isDate(e)||(e="string"==typeof e?DateHelper.parse(e,this.format)||DateHelper.parse(e,this.fallbackFormat):new Date(e)),DateHelper.isValidDate(e))?this.transformTimeValue(e):null}transformTimeValue(e){const t=this.keepTime;if(e=DateHelper.clone(e),t){const r=DateHelper.parse(t,this.timeFormat);DateHelper.isValidDate(r)?DateHelper.copyTimeValues(e,r):DateHelper.isValidDate(this.value)&&DateHelper.copyTimeValues(e,this.value)}else DateHelper.clearTime(e,!1);return e}changeMin(e){return this.transformDateValue(e)}updateMin(e){const{input:t,_picker:r}=this;t&&(t.min=e),r&&(r.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e)}updateMax(e){const{input:t,_picker:r}=this;t&&(t.max=e),r&&(r.maxDate=e),this.syncInvalid()}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:DateHelper.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,t){const r=this,n=r.transformDateValue(e);if(!e||n){if(r.clearError("L{invalidDate}"),r.hasChanged(t,n))return super.changeValue(n,t);r.inputting||r.syncInputFieldValue()}else r.setError("L{invalidDate}")}updateValue(e,t){const r=this._picker;r&&!this.inputting&&(r.value=e),super.updateValue(e,t)}changeStep(e,t){const r=typeof e;return e?("number"===r?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:"string"===r&&(e=DateHelper.parseDuration(e)),e&&e.unit&&e.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,t){return e&&e.getTime&&t&&t.getTime?!DateHelper.isEqual(DateHelper.clearTime(e),DateHelper.clearTime(t)):super.hasChanged(e,t)}get inputValue(){const e=this.value;return e?DateHelper.format(e,this.format):""}updateFormat(){this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){super.internalOnKeyEvent(e),"Enter"===e.key&&this.isValid&&this.picker.hide()}}DateField.initClass(),DateField._$name="DateField";class TimePicker extends Popup{static get $name(){return"TimePicker"}static get type(){return"timepicker"}static get defaultConfig(){return{items:[{type:"number",ref:"fieldHours",min:0,max:23,highlightExternalChange:!1,format:"2>9"},{html:"<label>:</label>"},{type:"number",ref:"fieldMinutes",min:0,max:59,highlightExternalChange:!1,format:"2>9"},{type:"button",text:"AM",toggleGroup:"am-pm",ref:"buttonAM",cls:"b-blue"},{type:"button",text:"PM",toggleGroup:"am-pm",ref:"buttonPM",cls:"b-blue"}],float:"1",autoShow:!1,trapFocus:!0,value:DateHelper.getTime(0),format:null}}construct(e){const t=this;super.construct(e),t._pm=!1,t.fieldHours.on("change",t.onFieldChange,t),t.fieldMinutes.on("change",t.onFieldChange,t),t.buttonAM.on("click",t.onButtonAMClick,t),t.buttonPM.on("click",t.onButtonPMClick,t),EventHelper.on({element:t.element,keydown:"onPickerKeyDown",thisObj:t}),EventHelper.on({element:t.fieldHours.element,keydown:"onPickerKeyDown",thisObj:t}),EventHelper.on({element:t.fieldMinutes.element,keydown:"onPickerKeyDown",thisObj:t}),t.refresh()}onFieldChange(){const e=this;e._time&&(e.value=e.pickerToTime())}onButtonAMClick(){const e=this;e._pm=!1,e._time&&(e.value=e.pickerToTime())}onButtonPMClick(){const e=this;e._pm=!0,e._time&&(e.value=e.pickerToTime())}onPickerKeyDown(e){const t=this;switch(e.key&&e.key.trim()||e.code){case"Escape":t.triggerTimeChange(t._initialValue),t.hide(),e.preventDefault();break;case"Enter":t.value=t.pickerToTime(),t.hide(),e.preventDefault()}}pickerToTime(){const e=this,t=e._pm;e.fieldHours.format=e._is24Hour?"2>9":null;let r=e.fieldHours.value,n=new Date(e._time);return e._is24Hour||(t&&r<12&&(r+=12),t||12!==r||(r=0)),n.setHours(r),n.setMinutes(e.fieldMinutes.value),e._min&&(n=DateHelper.max(e._min,n)),e._max&&(n=DateHelper.min(e._max,n)),n}triggerTimeChange(e){this.trigger("timeChange",{time:e})}set value(e){const t=this;let r=!1;e&&t._time?e.getTime()!==t._time.getTime()&&(t._time=e,r=!0):(t._time=TimePicker.defaultConfig.value,r=!0),r&&(t.isVisible&&t.triggerTimeChange(t.value),t.refresh())}get value(){return this._time}set format(e){const t=this;t._format=e,t._is24Hour=DateHelper.is24HourFormat(t._format),t.refresh()}get format(){return this._format}set min(e){this._min=e}get min(){return this._min}set max(e){this._max=e}get max(){return this._max}set initialValue(e){this.value=e,this._initialValue=e}get initialValue(){return this._initialValue}get buttonAM(){return this.widgetMap.buttonAM}get buttonPM(){return this.widgetMap.buttonPM}get fieldHours(){return this.widgetMap.fieldHours}get fieldMinutes(){return this.widgetMap.fieldMinutes}refresh(){const e=this;if(!e.isConfiguring){const t=e._time,r=e._is24Hour,n=t.getHours(),i=e._pm=n>=12,s=e.fieldHours;e.element.classList[r?"add":"remove"]("b-24h"),s.min=r?0:1,s.max=r?23:12,s.value=r?n:n%12||12,e.fieldMinutes.value=t.getMinutes(),e.buttonAM.pressed=!i,e.buttonPM.pressed=i,e.buttonAM.hidden=e.buttonPM.hidden=r}}}TimePicker.initClass(),TimePicker._$name="TimePicker";class TimeField extends PickerField{static get $name(){return"TimeField"}static get type(){return"timefield"}static get alias(){return"time"}static get configurable(){return{picker:{type:"timepicker",floating:!0,align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{template:()=>`<div class="b-align-${this.align||"end"}"><div class="b-icon-clock-live"></div></div>`,handler:"onTriggerClick",align:"end"},back:{cls:"b-icon b-icon-angle-left b-step-trigger",handler:"onBackClick",align:"start"},forward:{cls:"b-icon b-icon-angle-right b-step-trigger",handler:"onForwardClick",align:"end"}},min:null,max:null,step:"5m",stepTriggers:null,value:null}}changePicker(e,t){const r=this;return TimePicker.reconfigure(t,e,{owner:r,defaults:{forElement:r[r.pickerAlignElement],owner:r,align:{anchor:r.overlayAnchor,target:r[r.pickerAlignElement]},onTimeChange({time:e}){r._isUserAction=!0,r.value=e,r._isUserAction=!1}}})}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const r=DateHelper.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const r=DateHelper.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,t){return e&&e.getTime&&t&&t.getTime?e.getHours()!==t.getHours()||e.getMinutes()!==t.getMinutes()||e.getSeconds()!==t.getSeconds()||e.getMilliseconds()!==t.getMilliseconds():super.hasChanged(e,t)}showPicker(e){const t=this,{picker:r}=t;t.readOnly||(r.initialValue=t.value,r.format=t.format,r.maxTime=t.max,r.minTime=t.min,t.value=r.value,super.showPicker(e))}onPickerShow(){super.onPickerShow(),this.pickerKeyDownRemover&&this.pickerKeyDownRemover()}focusPicker(){this.picker.focus()}transformTimeValue(e){return null!=e&&(DateHelper.isDate(e)||(e="string"==typeof e?DateHelper.parse(e,this.format):new Date(e)),DateHelper.isValidDate(e))?DateHelper.getTime(e):null}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:t}=this;t&&(t.min=e),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:t}=this;t&&(t.max=e),this.syncInvalid()}changeValue(e,t){const r=this,n=r.transformTimeValue(e);if(e&&!n||r.isRequired&&""===e)r.setError("L{invalidTime}");else{if(r.clearError("L{invalidTime}"),r.hasChanged(t,n))return super.changeValue(n,t);r.inputting||r.syncInputFieldValue(!0)}}updateValue(e,t){const{expand:r}=this.triggers;r&&e&&(r.element.firstElementChild.style.animationDelay=-(60*e.getHours()+e.getMinutes())/10+"s"),super.updateValue(e,t)}changeStep(e,t){const r=typeof e;return e?("number"===r?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:"string"===r&&(e=DateHelper.parseDuration(e)),e&&e.unit&&e.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}updateFormat(){this.syncInputFieldValue(!0)}get inputValue(){return DateHelper.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}}TimeField.initClass(),TimeField._$name="TimeField";class DateTimeField extends Field{static get configurable(){return{timeField:{flex:"0 0 45%"},dateField:{keepTime:!0,flex:1,step:"1 d"},weekStartDay:null,inputTemplate:()=>""}}static get $name(){return"DateTimeField"}static get type(){return"datetimefield"}static get alias(){return"datetime"}get innerElements(){return[this.dateField.element,this.timeField.element]}changeTimeField(e){const t=this,r=new TimeField(ObjectHelper.assign({syncInvalid(...e){const r=t.updatingInvalid;TimeField.prototype.syncInvalid.apply(this,e),t.timeField&&!r&&t.syncInvalid()}},e));return t.readOnly&&(r.readOnly=!0),r}updateTimeField(e){const t=this;e.on({change({userAction:e,value:r}){if(e&&!t.$settingValue){const e=t.dateField.value;t._isUserAction=!0,t.value=e?DateHelper.copyTimeValues(e,r):null,t._isUserAction=!1}},thisObj:t})}changeDateField(e){const t=this,r=(null==e?void 0:e.type)||"datefield",n=Widget.resolveType(e.type||"datefield"),i=Widget.create(ObjectHelper.assign({type:r,syncInvalid(...e){const r=t.updatingInvalid;n.prototype.syncInvalid.apply(this,e),t.dateField&&!r&&t.syncInvalid()}},e));return t.readOnly&&(i.readOnly=!0),i}get childItems(){return[this.dateField,this.timeField]}updateDateField(e){const t=this;e.on({change({userAction:e,value:r}){e&&!t.$isInternalChange&&(t._isUserAction=!0,t.value=r,t._isUserAction=!1)},thisObj:t})}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var t,r;return"number"==typeof e?e:null!==(t=null===(r=this.dateField)||void 0===r?void 0:r.weekStartDay)&&void 0!==t?t:DateHelper.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0),e||this.highlightExternalChange||(e=!0);const t=this,r=t.dateField.highlightExternalChange,n=t.timeField.highlightExternalChange;t.$isInternalChange=!0,t.dateField.highlightExternalChange=!1,t.dateField.value=null,t.dateField.highlightExternalChange=r,e&&(t.timeField.highlightExternalChange=t.dateField.highlightExternalChange=!1),t.timeField.value=t.dateField.value=t.inputValue,t.dateField.highlightExternalChange=r,t.timeField.highlightExternalChange=n,t.$isInternalChange=!1,t.syncInvalid()}updateRequired(e,t){this.timeField.required=this.dateField.required=e}updateReadOnly(e,t){super.updateReadOnly(e,t),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}hasChanged(e,t){return!DateHelper.isEqual(e,t)}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,t){[this.dateField,this.timeField].forEach((r=>r.setError(e,t)))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,t){[this.dateField,this.timeField].forEach((r=>r.clearError(e,t)))}updateInvalid(){this.updatingInvalid=!0,[this.dateField,this.timeField].forEach((e=>e.updateInvalid())),this.updatingInvalid=!1}}DateTimeField.initClass(),DateTimeField._$name="DateTimeField";class DisplayField extends TextField{static get $name(){return"DisplayField"}static get type(){return"displayfield"}static get alias(){return"display"}static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}}DisplayField.initClass(),DisplayField._$name="DisplayField";class DurationField extends TextField{static get $name(){return"DurationField"}static get type(){return"durationfield"}static get alias(){return"duration"}static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}get inputValue(){return null==this.value?"":this.value.toString(this.useAbbreviation)}set unit(e){this._unit=e,super.value=this.calcValue()}get unit(){return this._unit}set magnitude(e){this._magnitude=this.roundMagnitude(e),super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&null!=this.decimalPrecision?ObjectHelper.round(e,this.decimalPrecision):e}get allowDecimals(){return 0!==this.decimalPrecision}get isValid(){const e=this,t=null==e.value||e.value&&null==e.value.magnitude;return super.isValid&&(t&&!e.required||!t&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const t=this,r=t.value,n=t._lastValue;t.hasChanged(n,r)&&(t._lastValue=r,t.triggerFieldChange({value:r,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){return this.syncInputFieldValue(!0),super.onFocusOut(e)}set value(e){const t=this;let r,n;if("number"==typeof e)r=t.roundMagnitude(e),n=t._unit;else if("string"==typeof e){const i=DateHelper.parseDuration(e,t.allowDecimals,t._unit||DurationField.defaultConfig.defaultUnit);i&&(n=i.unit,r=t.roundMagnitude(i.magnitude))}else e&&"unit"in e&&"magnitude"in e?(n=e.unit,r=t.roundMagnitude(e.magnitude)):(n=null,r=null);t._magnitude===r&&t._unit===n||(t._magnitude=r,t._unit=n,super.value=t.calcValue())}get value(){return super.value}calcValue(){const e=this;return e._unit&&null!=e._magnitude||!e.clearable?new Duration(e._magnitude,e._unit||DurationField.defaultConfig.defaultUnit):null}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&!e.isEqual(t)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){"ArrowUp"===e.key?this.doSpinUp():"ArrowDown"===e.key&&this.doSpinDown()}doSpinUp(){const e=this;e._isUserAction=!0,e.magnitude=(e.magnitude||0)+e.step,e._isUserAction=!1}doSpinDown(){const e=this;(e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.magnitude=(e.magnitude||0)-e.step,e._isUserAction=!1)}}DurationField.initClass(),DurationField._$name="DurationField";class FileField extends Field{static get $name(){return"FileField"}static get type(){return"filefield"}internalOnChange(e){super.internalOnInput(e),super.internalOnChange(e)}internalOnInput(){}static get configurable(){return{multiple:null,accept:null,inputType:"file",attributes:["multiple","accept"]}}get files(){return this.input.files}pickFile(){this.input.click()}get multiple(){return this._multiple?"":null}clear(){this.input.value=null}triggerChange(e){this.triggerFieldChange({event:e,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}}FileField.initClass(),FileField._$name="FileField";class FilePicker extends Container{static get $name(){return"FilePicker"}static get type(){return"filepicker"}static get defaultConfig(){return{defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null}}construct(e={}){const t=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),super.construct(e),t.button.on({click:t.onButtonClick,thisObj:t}),t.fileField.on({change:t.onFileFieldChange,thisObj:t}),t._thisIsAUsedExpression(t.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const e=this;return e._fileTip||(e._fileTip=new Tooltip({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",listeners:{beforeshow(){const t=this,r=e.files;return!(!r||!r.length)&&(t.html=""+Array.from(r).map((e=>e.name)).join("<br>"),!0)}}}))}clear(){const e=this;e.fileField.clear(),e.button.badge="",e.trigger("clear")}onButtonClick({event:e}){this.fileField.pickFile(),e.preventDefault()}onFileFieldChange({valid:e}){const t=this;t.button.badge=t.files.length||"",t.triggerFieldChange({files:t.files,valid:e})}}FilePicker.initClass(),FilePicker._$name="FilePicker";class FilterField extends TextField{static get $name(){return"FilterField"}static get type(){return"filterfield"}static get configurable(){return{field:null,store:null,filterFunction:null,clearable:!0,keyStrokeChangeDelay:100,onChange({value:e}){const{store:t,field:r,filterFunction:n}=this;if(t){const i=(r||this.id)+"-Filter";if(0===e.length)t.removeFilter(i);else{let s;n?s=t=>n(t,e):(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=t=>t.get(r).match(new RegExp(e,"i"))),t.filter({id:i,filterBy:s})}}}}}}FilterField.initClass(),FilterField._$name="FilterField";const bIcon$1=/^b-icon-/,bFa$1=/^b-fa-/;class MenuItem extends Widget{static get $name(){return"MenuItem"}static get type(){return"menuitem"}static get configurable(){return{checked:null}}static get defaultConfig(){return{menu:null,icon:null,text:null,closeParent:null,href:null,target:null,localizableProperties:["text"]}}doAction(e){const t=this,r=this.parent,n={menu:r,item:t,element:t.element,bubbles:!0};"boolean"==typeof t.checked&&(t.checked=!t.checked),t.trigger("beforeItem",n),t.trigger("item",n),t.closeParent&&r&&(r.rootMenu.close(),e&&!t.href&&e.preventDefault())}doDestroy(){const e=this._menu;e instanceof Widget&&e.destroy(),super.doDestroy()}template(e){const t=e.icon||("boolean"==typeof e.checked?`b-fw-icon b-icon-${e.checked?"":"un"}checked`:""),r=bIcon$1.test(t)?" b-icon":bFa$1.test(t)?" b-fa":"",n=e.href?"a":"div";return TemplateHelper.tpl`
            <${n} ${"a"===n?`href="${e.href}"`:""} ${"a"===n&&e.target?`target="${e.target}"`:""} class="${e.hasMenu?"b-has-submenu":""}" ${e.name?`data-name="${e.name}"`:""} tabIndex="-1">
                ${t?`<i class="b-menuitem-icon ${t}${r}" data-reference="iconElement"></i>`:""}
                <span class="b-menu-text" data-reference="textElement">${e.text}</span>
                ${e.hasMenu?'<i class="b-fw-icon b-icon-sub-menu" data-reference="subMenuIcon"></i>':""}
            </${n}>`}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const e=this.focusElement;return e&&this.isVisible&&(e===document.body||e.offsetParent)}onFocusIn(e){super.onFocusIn(e),!this.disabled&&this.menu&&this.openMenu()}onFocusOut(e){super.onFocusOut(e),this.closeMenu()}openMenu(e){const t=this.menu;!this.disabled&&t&&(t.focusOnToFront=e,t.show(),this.owner.currentSubMenu=t)}closeMenu(){this._menu instanceof Widget&&this.menu.close()}changeChecked(e,t){if(this.isConfiguring||"boolean"==typeof t)return Boolean(e)}updateChecked(e){const t=this;t.isConfiguring||(t.iconElement.classList[e?"add":"remove"]("b-icon-checked"),t.iconElement.classList[e?"remove":"add"]("b-icon-unchecked"),t.trigger("toggle",{menu:t.owner,item:t,checked:e,element:t.element,bubbles:!0}))}set menu(e){this._menu=e}get text(){return this.html}set text(e){this.html=e}get menu(){const e=this;let t=e._menu;return t&&t.isDestroyed&&(t=e._menu=null),!t||t instanceof Widget||("object"!=typeof t||"items"in t||"widgets"in t||"html"in t||(t={lazyItems:t}),t=e.menu=Widget.create(Object.assign({type:"menu",autoShow:!1,autoClose:!0,scrollAction:e.owner.scrollAction,constrainTo:e.owner.constrainTo,forElement:e.element,align:"l0-r0",anchor:!0,owner:e,cls:"b-sub-menu"},t))),t}set closeParent(e){this._closeParent=e}get closeParent(){return("boolean"==typeof this.checked?this._closeParent:!1!==this._closeParent)&&!this.hasMenu}get hasMenu(){const e=this.isConfiguring?this.initialConfig.menu:this._menu;return e&&(e instanceof Widget||"object"==typeof e||e.length>0)}get childItems(){const{menu:e}=this;return e?[e]:[]}}MenuItem.initClass(),MenuItem._$name="MenuItem";const validKeys={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1};class Menu extends Popup{static get $name(){return"Menu"}static get type(){return"menu"}static get configurable(){return{align:"t-b",scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem",tools:{close:!1}}}construct(e){Array.isArray(e)&&(e={lazyItems:e}),super.construct(e),EventHelper.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseleave:"onMouseLeave",thisObj:this})}afterShow(e){this.items.some((e=>Boolean(e._menu)))&&this.element.classList.add("b-menu-with-submenu");this.items.some((e=>e.icon))&&this.element.classList.add("b-menu-with-icon"),super.afterShow(e)}createWidget(e){return"string"==typeof e&&(e={text:e}),super.createWidget(e)}get focusElement(){var e;const t=null===(e=this.parentMenu)||void 0===e?void 0:e.element.contains(DomHelper.activeElement),r=this.items[0];return!t&&r instanceof MenuItem?this.element:super.focusElement}onDocumentMouseDown(e){this.parentMenu&&this.parentMenu.owns(e.event.target)||super.onDocumentMouseDown(e)}hide(e){super.hide(e),this.currentSubMenu&&!this.currentSubMenu.isDestroyed&&this.currentSubMenu.hide(e),this.parentMenu&&(this.parentMenu.currentSubMenu=null)}onMouseClick(e){const t=this,r=e.target.closest(".b-menuitem");r&&(t.triggerElement(r,e),e.stopImmediatePropagation())}onMouseOver(e){const t=this;if(!1!==this.focusOnHover){const r=DomHelper.up(e.relatedTarget,".b-widget"),n=DomHelper.up(e.target,".b-widget"),i=Widget.fromElement(n);!DomHelper.isTouchEvent&&n&&n!==r&&i.parent===this&&t.setTimeout({fn:"handleMouseOver",delay:30,args:[i],cancelOutstanding:!0})}}handleMouseOver(e){e.focus()}onMouseLeave(e){const t=this,{relatedTarget:r}=e,n=r&&t.owns(r);let i=r&&r instanceof HTMLElement&&Widget.fromElement(r),s=!n;if(i){for(;i.ownerCmp;)i=i.ownerCmp;s&=!DomHelper.getAncestor(i.element,[e.target])}!n&&s&&(t.currentSubMenu&&t.currentSubMenu.hide(),t.currentSubMenu=t.selectedElement=null,t.element.contains(DomHelper.activeElement)&&DomHelper.activeElement.matches(".b-menuitem")&&t.focusElement.focus())}onInternalKeyDown(e){const t=Widget.fromElement(e),r=t&&t!==this&&!(t instanceof MenuItem);if("Escape"===e.key)return void(r?this:this.rootMenu).close();if(super.onInternalKeyDown(e),r)return;validKeys[e.key]&&e.preventDefault();const n=DomHelper.activeElement,i=this.element;this.navigateFrom(n!==i&&i.contains(n)?n:null,e.key,e)}navigateFrom(e,t,r){const n=this,i=n.treeWalker,s=e&&n.getItem(e);let o;switch(t){case"ArrowUp":i.currentNode=e||(e=n.bottomFocusTrap),i.previousNode(),o=i.currentNode;break;case"ArrowDown":i.currentNode=e||(e=n.topFocusTrap),i.nextNode(),o=i.currentNode;break;case" ":e&&!e.classList.contains("b-disabled")&&(s&&s.menu?n.openSubMenu(e,s):n.triggerElement(e,r));break;case"ArrowRight":if(e&&s&&s.menu&&!e.classList.contains("b-disabled")){const t=n.openSubMenu(e,s);t&&t.focus()}else i.currentNode=e||(e=n.topFocusTrap),i.nextNode(),o=i.currentNode;break;case"ArrowLeft":n.isSubMenu?n.hide():e||(i.currentNode=e||(e=n.topFocusTrap),i.nextNode(),o=i.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&n.triggerElement(e,r)}o&&(o===n.element?n.navigateFrom(n.bottomFocusTrap,"ArrowUp",r):o===e?n.navigateFrom(n.topFocusTrap,"ArrowDown",r):o.focus())}getItem(e){if(null!=e)return"number"==typeof e?this.items[e]:1===e.nodeType?Widget.fromElement(e,"menuitem",this.contentElement):this.items.find((t=>t.id==e))}triggerElement(e,t){const r=this.getItem(e);r&&!r.disabled&&r.doAction(t)}get isSubMenu(){return this.owner&&this===this.owner.menu}openSubMenu(e,t){const r=this,n=t.menu;if(n){if(!n.isVisible){const i={item:t,element:e};if(!1===r.trigger("beforeSubMenu",i))return;if(t.onBeforeSubMenu&&!1===t.onBeforeSubMenu(i))return;n.show()}return r.currentSubMenu=n}}set selectedElement(e){const t=this,r=t._selectedElement;if(r){const e=t.getItem(r),n=e&&e.menu;n&&n.hide(),r.classList.remove("b-active")}if(t._selectedElement=e,e){const r=DomHelper.isFocusable(e);e.classList.add("b-active"),t.scrollable.scrollIntoView(e,{animate:!r,focus:r})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame((()=>e.currentNode.focus()))}get parentMenu(){let e=this.owner;if(e instanceof MenuItem&&(e=e.owner),e instanceof Menu)return e}get rootMenu(){let e=this;for(;e.parentMenu&&e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}}Menu.initClass(),Menu._$name="Menu";class MessageDialog extends Popup{static get $name(){return"MessageDialog"}static get type(){return"messagedialog"}static get configurable(){return{id:"bryntum-msgdialog",centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:" ",lazyItems:{$config:["lazy"],value:[{type:"widget",id:"bryntum-msgdialog-message",cls:"b-msgdialog-message",ref:"message"},{type:"textfield",id:"bryntum-msgdialog-input",cls:"b-msgdialog-input",ref:"input"}]},bbar:{id:"bryntum-msgdialog-bbar",items:[{ref:"yesButton",id:"bryntum-msgdialog-yesbutton",cls:"b-msgdialog-yesbutton b-green",text:"L{Object.Yes}",onClick:"up.onYesClick"},{ref:"noButton",id:"bryntum-msgdialog-nobutton",cls:"b-msgdialog-nobutton b-gray",text:"L{Object.No}",onClick:"up.onNoClick"},{ref:"cancelButton",id:"bryntum-msgdialog-cancelbutton",cls:"b-msgdialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"}]}}}construct(){this.noButton=0,this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}async confirm({message:e,title:t=" "}){const r=this;return r.getConfig("lazyItems"),r.title=r.optionalL(t),r.element.classList.remove(r.showClass),e?(r.showClass="b-show-message-yes-no",r.widgetMap.message.html=r.optionalL(e)):r.showClass="b-show-yes-no",r.element.classList.add(r.showClass),r.show(),r.promise=new Promise((e=>{r.resolve=e}))}doResolve(e){const t=this,{resolve:r}=t;r&&(t.resolve=t.reject=t.promise=null,r(e),t.hide())}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.widgetMap.cancelButton.isVisible?this.onCancelClick():this.onNoClick()),super.onInternalKeyDown(e)}onYesClick(){this.doResolve(MessageDialogSingleton.yesButton)}onNoClick(){this.doResolve(MessageDialogSingleton.noButton)}onCancelClick(){this.doResolve(MessageDialogSingleton.cancelButton)}}MessageDialog.initClass();const MessageDialogSingleton=new MessageDialog,digitRe=/\d/;class NumberField extends Field{static get $name(){return"NumberField"}static get type(){return"numberfield"}static get alias(){return"number"}static get configurable(){return{min:null,max:null,step:1,largeStep:0,value:0,format:"",decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const t=this;t.input.addEventListener("dblclick",(()=>{t.select()})),"number"==typeof t.changeOnSpin&&(t.bufferedSpinChange=t.buffer(t.triggerChange,t.changeOnSpin))}acceptValue(e){let t=!isNaN(e);if(t&&!this.hasTextSelection){t=!1;const r=this.input.value;r!=e&&(t=!this.acceptValue(r))}return t}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if("keydown"===e.type){const t=this,r=e.key;let n;if("ArrowUp"===r)t.doSpinUp(e.shiftKey),n=!0;else if("ArrowDown"===r)t.doSpinDown(e.shiftKey),n=!0;else if(!e.altKey&&!e.ctrlKey&&r&&1===r.length){const e=t.getAfterValue(r),i=t.formatter.parseStrict(e);n=!t.acceptValue(i)}"Enter"===r&&t._changedBySilentSpin&&(t.triggerChange(e,!0),t._changedBySilentSpin=!1),n&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const t=this;let r=(t.value||0)+(e?t.largeStep:t.step);t.okMin(r)||(r=t.min),t.okMax(r)&&t.applySpinChange(r)}doSpinDown(e=!1){const t=this;let r=(t.value||0)-(e?t.largeStep:t.step);t.okMax(r)||(r=t.max),t.okMin(r)&&t.applySpinChange(r)}applySpinChange(e){const t=this;t._isUserAction=!0,!0!==t.changeOnSpin&&(t._changedBySilentSpin=!0,t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){super.onFocusOut(...arguments),this._changedBySilentSpin&&(this.triggerChange(e,!0),this._changedBySilentSpin=!1)}internalOnInput(e){const t=this,r=t.input,n=r.value,i=t.formatter.truncate(n),s=isNaN(i)?"":t.formatValue(i);if(n!==s&&digitRe.test(n[n.length-1])){const e=n.length-t.caretPos;r.value=s,t.caretPos=s.length-e}super.internalOnInput(e)}formatValue(e){return this.formatter.format(e)}changeFormat(e){const t=this;if(""===e){const{leadingZeroes:r,decimalPrecision:n}=t;e=r?r+">9":null,null!=n?e=`${e||""}9.${"#".repeat(n)}`:e&&(e+=".*")}return e}get formatter(){const e=this,t=e.format;let r=e._formatter;return r&&e._lastFormat===t||(r=NumberFormat.get(e._lastFormat=t),e._formatter=r),r}updateStep(e){this.element.classList[e?"remove":"add"]("b-hide-spinner"),this._step=e}changeLargeStep(e){return e||10*this.step}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}changeValue(e,t){const r=this;if(e||0===e){let t;"number"!=typeof e&&(e="string"==typeof e?r.formatter.parse(e):Number(e),t=isNaN(e),t&&(e="")),!t&&r.format&&(e=r.formatter.round(e))}else e=void 0;return super.changeValue(e,t)}get inputValue(){let e=this.value;return null!=e&&this.format&&(e=this.formatValue(e)),e}}NumberField.initClass(),NumberField._$name="NumberField";class PagingToolbar extends Toolbar{static get $name(){return"PagingToolbar"}static get type(){return"pagingtoolbar"}static get defaultConfig(){return{store:null,defaults:{localeClass:this},items:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"b-fa-angle-double-left"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"b-fa-angle-left"},pageNumber:{type:"numberfield",label:"L{page}",min:1,max:1,triggers:null,onChange:"up.onPageNumberChange",highlightExternalChange:!1},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text"},nextPageButton:{onClick:"up.onNextPageClick",icon:"b-fa-angle-right"},lastPageButton:{onClick:"up.onLastPageClick",icon:"b-fa-angle-double-right"},separator:{type:"widget",cls:"b-toolbar-separator"},reloadButton:{onClick:"up.onReloadClick",icon:"b-fa-redo"},spacer:{type:"widget",cls:"b-toolbar-fill"},dataSummary:{type:"widget",cls:"b-toolbar-text"}}}}set parent(e){super.parent=e,this.store||(this.store=e.store)}get parent(){return super.parent}set store(e){const t=this,r={beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:t};t.store&&t.store.un(r),t._store=e,e&&(e.on(r),e.isLoading&&t.onStoreBeforeRequest())}get store(){return this._store}onStoreBeforeRequest(){this.eachWidget((e=>e.disable()))}updateLocalization(){const e=this,{reloadButton:t,firstPageButton:r,previousPageButton:n,nextPageButton:i,lastPageButton:s}=e.widgetMap;r.tooltip=e.L("L{firstPage}"),n.tooltip=e.L("L{prevPage}"),i.tooltip=e.L("L{nextPage}"),s.tooltip=e.L("L{lastPage}"),t.tooltip=e.L("L{reload}"),e.updateSummary(),super.updateLocalization()}updateSummary(){const e=this,{pageCount:t,dataSummary:r}=e.widgetMap;let n,i,s,o,a;if(n=i=s=o=a=0,e.store){const{store:t}=e,{pageSize:r,currentPage:l}=t;n=t.count,i=t.lastPage,a=t.allCount,s=Math.max(0,(l-1)*r+1),o=Math.min(a,s+r-1)}t.html=e.L("L{pageCountTemplate}")({lastPage:i}),r.html=n?e.L("L{summaryTemplate}")({start:s,end:o,allCount:a}):e.L("L{noRecords}")}onStoreChange(){const e=this,{widgetMap:t,store:r}=e,{count:n,lastPage:i,currentPage:s}=r,{pageNumber:o,pageCount:a,firstPageButton:l,previousPageButton:c,nextPageButton:d,lastPageButton:u,dataSummary:h}=t;e.eachWidget((e=>e.enable())),o.value=s,o.max=i,h.disabled=o.disabled=a.disabled=!n,l.disabled=c.disabled=s<=1||!n,d.disabled=u.disabled=s>=i||!n,e.updateSummary()}onPageNumberChange({value:e}){this.store.currentPage!==e&&this.store.loadPage(e)}onFirstPageClick(){this.store.loadPage(1)}onPreviousPageClick(){this.store.previousPage()}onNextPageClick(){this.store.nextPage()}onLastPageClick(){this.store.loadPage(this.store.lastPage)}onReloadClick(){this.store.loadPage(this.store.currentPage)}}PagingToolbar.initClass(),PagingToolbar._$name="PagingToolbar";class Slider extends Widget{static get $name(){return"Slider"}static get type(){return"slider"}static get defaultConfig(){return{text:"",showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:null,thumbSize:20,localizableProperties:["text"]}}construct(e){const t=this;super.construct(e),t.updateLabel(),t.showTooltip&&(t.tip=new Tooltip({forElement:t.input,anchor:!1,align:"b-t",axisLock:!0})),t.input.addEventListener("input",t.onInternalInput.bind(t)),t.input.addEventListener("change",t.onInternalChange.bind(t)),t.input.addEventListener("mouseover",t.onInternalMouseOver.bind(t)),t.input.addEventListener("mouseout",t.onInternalMouseOut.bind(t))}template(e){return TemplateHelper.tpl`
            <div class="${e.text?"b-text b-has-label":""}">
                <input type="range"
                   data-reference="input"
                   id="${e.id}-input"
                   min="${e.min}"
                   max="${e.max}"
                   step="${e.step}"
                   value="${e.value}">
                <label data-reference="label" for="${e.id}-input">${e.text}</label>
            </div>
        `}get focusElement(){return this.input}onInternalInput(e){const t=this;t._value=parseInt(t.input.value),t.updateUI(),t.trigger("input",{value:t.value})}onInternalChange(e){const t=this;t.updateUI(),t.triggerChange(!0),t.trigger("action",{value:t.value})}onInternalMouseOver(e){const t=this;t.updateLabel(),t.tip&&t.tip.showBy({target:t.calcThumbPosition(),offset:5})}onInternalMouseOut(e){this.tip&&this.tip.hide()}triggerChange(e){this.triggerFieldChange({value:this.value,valid:!0,userAction:e})}get text(){return this._text}set text(e){const t=this;t._text=e,t.label&&(t.showValue&&(e=e?`${e} (${t.value})`:t.value),t.label.innerHTML=e),t.tip&&(t.tip.html=t.value)}get value(){return this.input?parseInt(this.input.value):this._value}set value(e){const t=this;t._value!==e&&(t.input&&(t.input.value=e,t.updateUI(),t.triggerChange(!1)),t._value=e)}get min(){return this.input?this.input.min:this._min}set min(e){const t=this;t.input&&(t.input.min=e,t._value<e&&(t.value=e,t.trigger("input",{value:t.value}))),t._min=e}get max(){return this.input?this.input.max:this._max}set max(e){const t=this;t.input&&(t.input.max=e,t._value>e&&(t.value=e,t.trigger("input",{value:t.value}))),t._max=e}get step(){return this.input?this.input.step:this._step}set step(e){this.input&&(this.input.step=e),this._step=e}updateLabel(){this.text=this._text}updateTooltipPosition(){this.tip&&this.tip.alignTo({target:this.calcThumbPosition(),offset:5})}updateUI(){this.updateLabel(),this.updateTooltipPosition()}calcThumbPosition(){const e=this,t=Rectangle.from(e.input),r=(t.width-e.thumbSize)*e.calcPercentProgress()/100;return new Rectangle(t.x+r,t.y+t.height/2-e.thumbSize/2,e.thumbSize,e.thumbSize)}calcPercentProgress(){return(this.value-this.min)/(this.max-this.min)*100}}Slider.initClass(),Slider._$name="Slider";const hasFlex=e=>parseInt(DomHelper.getStyleValue(e,"flex-basis"),10)||parseInt(DomHelper.getStyleValue(e,"flex-grow"),10);class Splitter extends Widget{static get type(){return"splitter"}static get defaultConfig(){return{orientation:"auto"}}doDestroy(){this.mouseDetacher&&this.mouseDetacher(),super.doDestroy()}template(){return'<div class="b-splitter"></div>'}get element(){return super.element}set element(e){super.element=e;const t={element:this.element,pointerdown:"onMouseDown",thisObj:this};BrowserHelper.supportsPointerEvents||(t.mousedown="onMouseDown",t.touchstart="onMouseDown"),EventHelper.on(t)}get currentOrientation(){return this._currentOrientation}get orientation(){return this._orientation}set orientation(e){this._orientation=e,this._currentOrientation="auto"===e?null:e,this.updateOrientation()}updateOrientation(){const e=this,{element:t}=this;if(e._prevOrientation&&t.classList.remove(e._prevOrientation),!e._currentOrientation&&e.rendered&&t.offsetParent){const r=DomHelper.getStyleValue(t.parentElement,"flex-direction");if(r)e._currentOrientation=r.startsWith("column")?"horizontal":"vertical";else{const r=t.previousElementSibling,n=t.nextElementSibling;if(!r||!n)return;const i=r.getBoundingClientRect(),s=n.getBoundingClientRect(),o=i.top<s.top?i:s,a=o===s?i:s;e._currentOrientation=o.top!==a.top?"horizontal":"vertical"}}e._currentOrientation&&t.classList.add("b-"+e._currentOrientation),e._prevOrientation=e._currentOrientation}onMouseDown(e){e.preventDefault(),e.touches&&(e=e.touches[0]);const t=this,{element:r}=t,n=r.previousElementSibling,i=r.nextElementSibling,s=hasFlex(n),o=hasFlex(i),a=[];t.mouseDetacher&&t.mouseDetacher();for(const e of r.parentElement.children)hasFlex(e)&&e!==r&&a.push({element:e,width:e.offsetWidth,height:e.offsetHeight});t.context={startX:e.pageX,startY:e.pageY,prevWidth:n.offsetWidth,prevHeight:n.offsetHeight,nextWidth:i.offsetWidth,nextHeight:i.offsetHeight,prevHasFlex:s,nextHasFlex:o,flexed:a,prev:n,next:i};const l={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:t};BrowserHelper.supportsPointerEvents||(l.mousemove="onMouseMove",l.touchmove="onMouseMove",l.mouseup=l.touchend="onMouseUp"),t.mouseDetacher=EventHelper.on(l)}onMouseMove(e){const t=this,{context:r}=t,n=e.pageX-r.startX,i=e.pageY-r.startY;if(e.preventDefault(),Object.assign(r,{deltaX:n,deltaY:i}),r.started||(r.started=!0,t.trigger("start",{context:r,event:e}),r.flexed.forEach((e=>{"vertical"===t.currentOrientation?e.element.style.flexGrow=e.width:e.element.style.flexGrow=e.height,e.element.style.flexBasis="0"}))),"vertical"===t.currentOrientation){const e=r.prevWidth+n,t=r.nextWidth-n;r.prevHasFlex?r.prev.style.flexGrow=e:r.prev.style.width=e+"px",r.nextHasFlex?r.next.style.flexGrow=t:r.next.style.width=t+"px"}else{const e=r.prevHeight+i,t=r.nextHeight-i;r.prevHasFlex?r.prev.style.flexGrow=e:r.prev.style.height=e+"px",r.nextHasFlex?r.next.style.flexGrow=t:r.next.style.height=t+"px"}t.trigger("move",{context:r,event:e})}onMouseUp(e){const t=this;t.mouseDetacher&&t.mouseDetacher(),t.mouseDetacher=null,t.context.started&&t.trigger("end",{context:t.context,event:e}),t.context=null}render(){super.render(...arguments);const e=this;e._currentOrientation||(e.updateOrientation(),e._currentOrientation||e.requestAnimationFrame((()=>e.updateOrientation())))}}Splitter.initClass(),Splitter._$name="Splitter";const animationClasses=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"];class Card extends Layout{static get $name(){return"Card"}static get configurable(){return{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null}}onChildAdd(e){super.onChildAdd(e),e.on({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:this});const{activeItem:t,owner:r}=this,n=null!=r.activeIndex?r.activeIndex:this.activeIndex||0,i=r.items.indexOf(e);(null!=t?e===t:i===n)?(e.show(),this._activeIndex=i,this._activeItem=e):e.hide()}onChildRemove(e){super.onChildRemove(e),this._activeItem===e&&this.activateSiblingOf(e),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:this})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:t}=this,r=t.items.slice(),n=r.indexOf(e);r.splice(n,1),this.activeIndex=Math.min(n,r.length-1)}setActiveItem(e,t=this.activeIndex){const r=this,{owner:n}=r,{items:i}=n,s=e instanceof Widget,o=i[t],a=n.items[e=s?e=i.indexOf(e):parseInt(e)],l={prevActiveIndex:t,prevActiveItem:o};if(a&&!a.$isActivating&&a!==o){const i=o&&o.element,s=a&&a.element;if(l.activeIndex=e,l.activeItem=a,!1===n.trigger("beforeActiveItemChange",l))return null;if(r.animateDetacher){const e=r.animateDetacher.event;r.animateDetacher(),DomHelper.removeClasses(e.prevActiveItem.element,animationClasses),DomHelper.removeClasses(e.activeItem.element,animationClasses),r.animateDetacher=null}l.promise=new Promise(((c,d)=>{if(i&&n.isVisible&&r.animateCardChange){const u=o.monitorResize;o.monitorResize=!1,o._hidden=!0,a.$isActivating=!0,a.show(),a.$isActivating=!1,i.classList.add(e>t?"b-slide-out-left":"b-slide-out-right"),s.classList.add(e<t?"b-slide-in-left":"b-slide-in-right"),n.isAnimating=!0,r.animateDetacher=EventHelper.on({element:s,animationend:()=>{r.animateDetacher=null,n.isAnimating=!1,DomHelper.removeClasses(s,animationClasses),i&&(DomHelper.removeClasses(i,animationClasses),o.$isDeactivating=!0,o._hidden=!1,o.hide(),o.monitorResize=u,o.$isDeactivating=!1),r.onActiveItemChange(l,c)},once:!0}),r.animateDetacher.reject=d,r.animateDetacher.event=l}else a.$isActivating=!0,a.show(),a.$isActivating=!1,o&&(o.$isDeactivating=!0,o.hide(),o.$isDeactivating=!1),r.onActiveItemChange(l,c)}))}return l}onActiveItemChange(e,t){this._activeItem=e.activeItem,this._activeIndex=e.activeIndex,this.owner.trigger("activeItemChange",e),e.activeItem.focus(),t(e)}renderChildren(){const{owner:e}=this;BrowserHelper.isIE11&&(this.animateCardChange=!1),e.contentElement.classList[e.suppressChildHeaders?"add":"remove"](this.hideChildHeaderCls),super.renderChildren()}changeActiveIndex(e){const{owner:t}=this;return t.isConfiguring&&!t._items?e:Math.min(e,t.items.length-1)}updateActiveIndex(e,t){this.owner.isConfiguring||this.setActiveItem(e,t)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}}Card._$name="Card",Layout.registerLayout(Card);class TabPanel extends Container{static get $name(){return"TabPanel"}static get type(){return"tabpanel"}static get alias(){return"tabs"}static get configurable(){return{suppressChildHeaders:!0,activeTab:0,tabMinWidth:null,tabMaxWidth:null,animateTabChange:!0}}static get defaultConfig(){return{itemCls:"b-tabpanel-item",defaultType:"container",layout:"card"}}construct(e){const t=this;super.construct(e),t.items.forEach(((e,r)=>{e.titleElement=t.element.querySelector(`div.b-tabpanel-tab[data-index="${r}"] span`)})),EventHelper.on({element:t.tabStrip,delegate:".b-tabpanel-tab",click:"onTabElementClick",thisObj:this})}changeElement(){const e=this;return super.changeElement({children:[{className:"b-tabpanel-tabs",reference:"tabStrip",children:e.items.map(((t,r)=>({className:{"b-tabpanel-tab":1,"b-active":r===e.activeTab,[t.cls]:t.cls,"b-hidden":t.$hideTab},style:{minWidth:DomHelper.setLength(e.tabMinWidth),maxWidth:DomHelper.setLength(e.tabMaxWidth)},tabindex:-1,dataset:{index:r},children:[{tag:"span",className:"b-tabpanel-tab-title",html:t.title}]})))},{className:{"b-tabpanel-body":1},reference:"tabPanelBody"}]})}onChildAdd(e){e.hidden&&(e.$hideTab=!0),super.onChildAdd(e),e.on({beforeHide:"onBeforeChildHide",thisObj:this,prio:1e3})}onChildRemove(e){super.onChildRemove(e),e.un({beforeHide:"onBeforeChildHide",thisObj:this})}updateTabMinWidth(e){this.element&&DomHelper.forEachSelector(this.element,".b-tabpanel-tab",(t=>{DomHelper.setLength(t,"minWidth",e||null)}))}updateTabMaxWidth(e){this.element&&DomHelper.forEachSelector(this.element,".b-tabpanel-tab",(t=>{DomHelper.setLength(t,"maxWidth",e||null)}))}changeLayout(e){return(e=super.changeLayout(e)).activeIndex=this.activeTab,e.animateCardChange=this.animateTabChange,e}get contentElement(){return this.tabPanelBody}get focusElement(){const e=this,t=e.items[e.activeTab||0];return t&&t.focusElement||e.tabStrip.children[e.activeTab]}changeActiveTab(e){return parseInt(e,10)}updateActiveTab(e){const t=this;if("number"==typeof e){if(e<0||e>=t.items.length)throw new Error("Invalid tab index: "+e)}else-1===this.items.indexOf(e)&&(e=t.add(e));t.isConfiguring||(t.layout.activeItem=e)}onActiveItemChange(e){const t=this,{tabStrip:r}=t,{prevActiveIndex:n,activeIndex:i}=e,s=r.children[n];t.activeTab=i,s&&s.classList.remove("b-active"),r.children[i].classList.add("b-active"),r.children[i].classList.remove("b-hidden"),t.trigger("tabChange",e)}get activeIndex(){return this.layout.activeIndex}get activeItem(){return this.layout.activeItem}onTabElementClick(e){this.activeTab=e.currentTarget.dataset.index}onBeforeChildHide({source:e}){if(!e.$isDeactivating){this.element.querySelector(`div.b-tabpanel-tab[data-index="${this.items.indexOf(e)}"]`).classList.add("b-hidden")}}}TabPanel.initClass(),TabPanel._$name="TabPanel";class TextAreaField extends PickerField{static get $name(){return"TextAreaField"}static get type(){return"textareafield"}static get alias(){return"textarea"}static get configurable(){return{picker:{type:"widget",cls:"b-textareafield-picker",floating:!0,scrollAction:"realign",align:{align:"t-b",axisLock:!0},autoShow:!1},triggers:null,inline:!0,resize:"none",inputType:null}}startConfigure(e){this.getConfig("inline"),super.startConfigure(e)}get inputElement(){const e=super.inputElement;return this.inline?(e.tag="textarea",e.style=(e.style||"")+";resize:"+this.resize):(e.readOnly="readonly",e.reference="displayElement"),e}get focusElement(){return this.inline||this._picker&&this._picker.isVisible?this.input:this.displayElement}showPicker(){if(this.inline)return;const{picker:e}=this;e.width=this.pickerWidth||this[this.pickerAlignElement].offsetWidth,super.showPicker(!0)}focusPicker(){this.input.focus()}onPickerKeyDown(e){const t=this,r=t.input;switch(e.key.trim()||e.code){case"Escape":return void t.picker.hide();case"Enter":e.ctrlKey&&(t.syncInputFieldValue(),t.picker.hide())}t.input=t.displayElement;const n=super.onPickerKeyDown(e);return t.input=r,n}syncInputFieldValue(e){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue(e)}changeValue(e){return null==e?"":e}updateInline(e){e||this.triggers||(this.triggers={})}changeTriggers(e,t){return this.inline||((e||(e={})).expand={cls:"b-icon-picker",handler:"onTriggerClick"}),super.changeTriggers(e,t)}changePicker(e,t){var r;const n=this,i=n.pickerWidth||(null===(r=e)||void 0===r?void 0:r.width);if(e=TextAreaField.reconfigure(t,e?Objects.merge({owner:n,forElement:n[n.pickerAlignElement],align:{matchSize:null==i,anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},html:`<textarea id="${n.id+"-input"}" style="resize:${n.resize}">${n.value}</textarea>`},e):null,n)){const t=n.input=e.element.querySelector(`#${n.id}-input`);n.inputListenerRemover=EventHelper.on({element:t,thisObj:n,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}return e}}TextAreaField.initClass(),TextAreaField._$name="TextAreaField";const ns="http://www.w3.org/2000/svg",typePrio={bar:1,outline:2,text:3},byDatasetOrder=(e,t)=>parseInt(e.dataset.order,10)-parseInt(t.dataset.order,10),getField=e=>e.field,returnFalse=()=>!1;class Histogram extends Widget{static get type(){return"histogram"}static get $name(){return"Histogram"}static get defaultConfig(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:ns,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:ns,tag:"g",reference:"scaledSvgGroup"},{ns:ns,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:null,monitorResize:!0,getRectClass:null,getBarTip:null,getBarText:null}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}set tip(e){this.tip&&this.tip.destroy(),this._tip=e?new Tooltip(Object.assign({owner:this,forElement:this.svgElement,forSelector:"rect",listeners:{beforeShow:"up.onBeforeTipShow"}},e)):null}onElementResize(){super.onElementResize(...arguments);const e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform",`scale(${e.width} ${e.height})`)}onBeforeTipShow({source:e}){const t=parseInt(e.activeTarget.dataset.index);e.html=e.contentTemplate({histogram:this,index:t})}set series(e){const t=this._series={};for(const r in e)if(!1!==e[r]){const n=t[r]=Object.assign({},e[r]);!n.type&&e[r].type&&(n.type=e[r].type),!n.field&&e[r].field&&(n.field=e[r].field),"order"in t||(n.order=typePrio[n.type]),n.id=r}this.scheduleRefresh()}get series(){return this._series}set data(e){const t=this;if(t._data=e,!t.topValue){const r=Object.values(t.series).map(getField);for(let n=0,{length:i}=e;n<i;n++)for(let i=0,{length:s}=r;i<s;i++)t.topValue=Math.max(t.topValue||0,e[n][r[i]])}t.scheduleRefresh()}get data(){return this._data}set topValue(e){this._topValue=e,this.scheduleRefresh()}get topValue(){return this._topValue}scheduleRefresh(){}refresh(){const e=this,{series:t,_tip:r}=e,n=[];for(const r in t){const i=t[r],s=e["draw"+StringHelper.capitalize(i.type)](i);Array.isArray(s)?n.push.apply(n,s):n.push(s)}n.sort(byDatasetOrder),DomSync.syncChildren({domConfig:{children:n},configEquality:returnFalse},e.scaledSvgGroup),DomSync.syncChildren({domConfig:{children:e.drawText()}},e.unscaledSvgGroup),r&&r.isVisible&&e.onBeforeTipShow({source:r})}drawBar(e){const t=this,{topValue:r,data:n,omitZeroHeightBars:i,barStyle:s}=t,{field:o,order:a}=e,l=1/n.length,c=[];let d;for(let u=0,h=0,{length:g}=n;u<g;u++,h+=d){const g=n[u],m=g[o],p=(m>r?r:m)/r,f=1-p,v=g.rectConfig={ns:ns,tag:"rect",dataset:{}};if(d=g.width||l,BrowserHelper.isEdge||BrowserHelper.isIE11){const e=t.svgElement.getBoundingClientRect();v.dataset.scaleX=e.width,v.dataset.scaleY=e.height}s?v.style=s:delete v.style,Object.assign(v.dataset,{index:u,order:a}),Object.assign(v,{x:h,y:f,width:d,height:p,class:t.callback("getRectClass",t,[e,v,g,u])});const y=t.callback("getBarTip",t,[e,v,g,u]);y?v.dataset.btip=y:delete v.dataset.btip,!p&&i||c.push(v)}return c}drawOutline(e){const t=this,{topValue:r,data:n}=t,{field:i,order:s}=e,o=1/n.length,a=["M 0,1"],l=e.outlineElement||(e.outlineElement={ns:ns,tag:"path",dataset:{order:s}});if(BrowserHelper.isEdge||BrowserHelper.isIE11){const e=t.svgElement.getBoundingClientRect();l.style=`stroke-width: ${1/Math.min(e.width,e.height)}px`}let c,d="M",u="L";for(let e=0,t=0,{length:s}=n;e<s;e++){const s=1-n[e][i]/r;c=n[e].width||o,a.push(`${d} ${t},${s} ${u} ${t+=c},${s}`),d=u=""}return l.d=a.join(" "),l}drawText(){const e=this,{data:t}=e,r=1/t.length,n=[];for(let i,s=0,o=0,{length:a}=t;s<a;s++,o+=i){i=t[s].width||r;e.callback("getBarText",e,[t[s],s])&&n.push({ns:ns,tag:"text",className:"b-bar-legend",html:e.callback("getBarText",e,[t[s],s]),x:100*(o+i/2)+"%",y:"100%",dataset:{index:s}})}return n}getBarText(e,t){return""}getBarTip(e,t,r,n){}getRectClass(e,t,r,n){return""}}Histogram.initClass(),Histogram._$name="Histogram";const ns$1="http://www.w3.org/2000/svg";class Scale extends Widget{static get type(){return"scale"}static get $name(){return"Scale"}static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:ns$1,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:ns$1,tag:"g",reference:"scaledSvgGroup",children:[{ns:ns$1,tag:"path",reference:"pathElement"}]},{ns:ns$1,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(e){return e||(e=this.horizontal?"bottom":"right"),e}updateAlign(e,t){this.element.classList.remove("b-align-"+t),this.element.classList.add("b-align-"+e)}updateHorizontal(e,t){this.element.classList.remove("b-scale-"+(t?"horizontal":"vertical")),this.element.classList.add("b-scale-"+(e?"horizontal":"vertical"))}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){const e=this,{horizontal:t,width:r,height:n,align:i,scalePoints:s,scaleMaxPadding:o}=e,a=s[s.length-1].value,l=[],c=[],d=1/(a+o*a);e.scaledSvgGroup.setAttribute("transform",`scale(${t?r:1} ${t?1:n})`);for(const e of s){const s=Boolean(e.text),o=d*e.value;if(s){const s={ns:ns$1,tag:"text",className:"b-scale-tick-label",html:e.text,dataset:{tick:e.value}};t?(s.x=100*o+"%",s.y="top"===i?"1.6em":n-12):(s.x="left"===i?"12":""+(r-12),s.y=100*(1-o)+"%"),c.push(s)}t?"top"===i?l.push(`M${o},0 L${o},${s?10:5}`):l.push(`M${o},${n} L${o},${n-(s?10:5)}`):"left"===i?l.push(`M0,${1-o} L${s?10:5},${1-o}`):l.push(`M${r},${1-o} L${r-(s?10:5)},${1-o}`)}e.pathElement.setAttribute("d",l.join("")),DomSync.syncChildren({domConfig:{children:c}},e.unscaledSvgGroup)}}Scale._$name="Scale";const validWidth=e=>"number"==typeof e||(null==e?void 0:e.endsWith("px"));class Column extends(Events(Localizable(Model))){static get fields(){return["text","field","renderer","width","flex","autoWidth",{name:"editor",defaultValue:{}},"finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0},{name:"searchable",defaultValue:!0},{name:"filterable",defaultValue:!0},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},"type",{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"}]}static get autoExposeFields(){return!1}construct(e,t){const r=this;r.masterStore=t,t&&(r._grid=Array.isArray(t)?t[0].grid:t.grid),r.localizableProperties=e.localizableProperties||["text"],e.localeClass&&(r.localeClass=e.localeClass),super.construct(e,t,null,!1),"field"in r.data||(r.field="_"+(r.type||"")+ ++Column.emptyCount,r.noFieldSpecified=!0),r.hasComplexMapping=r.field&&r.field.includes("."),r.width||r.flex||r.children||r.set({width:Column.defaultWidth,flex:null},null,!0)}remove(){const{subGrid:e,grid:t}=this,r=e&&t&&t.focusedCell;r&&r.columnId===this.id&&(DomHelper.activeElement===t?t.navigateRight():r.columnId=e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0).id),super.remove()}getRawValue(e){const t=this;return t.hasComplexMapping?ObjectHelper.getPath(e,t.field):e[t.field]}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get nextVisibleSibling(){const e=this.region;let t=this.nextSibling;for(;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}get isLastInSubGrid(){return!this.nextVisibleSibling&&(!this.parent||this.parent.isLastInSubGrid)}get element(){return this.grid.getHeaderElement(this)}get textWrapper(){return DomHelper.getChild(this.element,".b-grid-header-text")}get textElement(){return DomHelper.down(this.element,".b-grid-header-text-content")}get contentElement(){return DomHelper.down(this.element,".b-grid-header-children")}get editor(){let e=this.data.editor;if(e&&!(e instanceof Widget)){const t=this.grid.processCellEditor({editor:e,field:this.field});t?e=this.data.editor=t.editor:("string"==typeof e&&(e={type:e}),e=this.data.editor=Widget.create(Object.assign(this.defaultEditor,e,{owner:this.grid})))}return e}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}get isFocusable(){return this.isLeaf}static get type(){return"column"}static get text(){return this.$meta.fields.defaults.text}get grid(){return this._grid||this.parent&&this.parent.grid}get locked(){return"locked"===this.data.region}set locked(e){this.region=e?"locked":"normal"}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.data.groupable}set groupable(e){this.set("groupable",e)}hide(e=!1){const t=this,r=t.parent;if(!t.hidden){if(t.hidden=!0,r&&!r.isRoot){r.children.some((e=>!0!==e.hidden))||r.hidden||(e=!0,r.hide())}t.children&&t.children.forEach((e=>e.hide(!0))),e||t.stores.forEach((e=>e.trigger("columnHide",{column:t})))}}show(e=!1){const t=this,r=t.parent;t.hidden&&(t.hidden=!1,r&&r.hidden&&r.show(),t.children&&t.children.forEach((e=>e.show(!0))),e||t.stores.forEach((e=>e.trigger("columnShow",{column:t}))))}toggle(e=null){return this.hidden&&void 0===e||!0===e?this.show():!this.hidden&&void 0===e||!1===e?this.hide():void 0}generateId(){return Column.generatedIdIndex||(Column.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++Column.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}get calcMinWidth(){const{width:e,minWidth:t}=this.data;return validWidth(e)&&validWidth(t)?Math.max(parseInt(e)||0,parseInt(t)||0):e}get width(){return this.data.width}set width(e){const t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}set flex(e){const t={flex:e};e&&"width"in this.data&&(t.width=null),this.set(t)}get flex(){return this.data.flex}set subGrid(e){this._subGrid=e}get subGrid(){return this._subGrid||(this.grid?this.grid.getSubGridFromColumn(this):void 0)}get subGridElement(){return this.subGrid.element}measureSize(e){return DomHelper.measureSize(e,this.subGrid?this.subGrid.element:void 0)}calculateMinWidth(){const e=this,t=e.measureSize(e.width),r=e.measureSize(e.minWidth);let n=0;return e.children&&(n=e.children.reduce(((e,t)=>e+t.calculateMinWidth()),0)),Math.max(t,r,n)}resizeToFitContent(e,t){const r=this,{grid:n,renderer:i,defaultRenderer:s,element:o}=r,a=n.rowManager,l=n.store,c=l.count,d=i||s;if(c<=0)return;const u=n.element.querySelector(`.b-grid-cell[data-column-id="${r.id}"]`),h=u.cssText,g=u.className;let m,p,f,v,y,b=0;if(n.resizeToFitIncludesHeader){const e=window.getComputedStyle(o);b=DomHelper.measureText(o.innerText,o,!1,o.parentElement)+parseInt(e.paddingLeft),o.parentElement.offScreenDiv.parentElement.remove()}for(c>1e3?(m=Math.max(Math.min(a.topIndex+a.rowCount/2-500,c-1e3),0),p=m+1e3):(m=0,p=c),f=m;f<p;f++)v=l.getAt(f),y=r.getRawValue(v),d&&(y=d.call(r,{cellElement:u,rowElement:u.parentNode,value:y,record:v,column:r,size:{height:v.rowHeight||0},grid:n,row:{},updatingSingleRow:!1}),y=null==y?u.innerHTML:String(y)),y&&(b=Math.max(b,DomHelper.measureText(y,u,!(r.htmlEncode&&!r.disableHtmlEncode),r.subGrid.element)));return Array.isArray(e)&&([e,t]=e),b=Math.max(b,e||0),b=Math.min(b,t||1e6),u.className=g,u.cssText=h,r.width=b}getState(){const e=this,t={[e.flex?"flex":"width"]:e.flex?e.flex:e.width,id:e.id,hidden:e.hidden,index:e.allIndex,region:e.region,filterable:e.filterable,text:e.text,locked:e.locked};return e.children&&(t.children=e.children.map((e=>e.getState()))),t}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"minWidth"in e&&(t.minWidth=e.minWidth),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=void 0:"flex"in e&&t.width&&(t.width=void 0),"text"in e&&(t.text=e.text),"region"in e&&(t.region=e.region),"renderer"in e&&(t.renderer=e.renderer),"filterable"in e&&(t.filterable=e.filterable),t.endBatch(),"hidden"in e&&t.toggle(!0!==e.hidden)}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}clearCell(e){e.innerHTML=""}canEdit(e){return!0}}Column.emptyCount=0,Column.defaultWidth=100,Column.exposeProperties(),Column._$name="Column";class ColumnStore extends(Localizable(Store)){static get defaultConfig(){return{modelClass:Column,tree:!0,autoAddField:!1}}construct(e){const t=this;e.grid&&(e.grid._columnStore=t,t.id=e.grid.id+"-columns",e.grid.on({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:t})),super.construct(e),t.on({change:t.clearCaches,thisObj:t,prio:1})}get modelClass(){return this._modelClass}set modelClass(e){this._modelClass=e}doDestroy(){const e=[];this.traverse((t=>e.push(t))),super.doDestroy(),e.forEach((e=>e.destroy()))}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.traverseWhile(((r,n)=>e.call(t,r,n)),!0)}get totalFixedWidth(){let e=0;for(const t of this)t.hidden||(t.children?t.children.forEach((t=>e+=this.calculateFixedWidth(t))):e+=this.calculateFixedWidth(t));return e}calculateFixedWidth(e){return e.flex?e.measureSize(Column.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter((e=>!(e.hidden||e.subGrid&&e.subGrid.collapsed)))),e._visibleColumns}clearSubGridCaches(e){e.columns.clearCaches(),this.clearCaches()}clearCaches(){this._visibleColumns=null}onMasterDataChanged(e){super.onMasterDataChanged(e),this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,r=!1){const n=this.visibleColumns,i=e instanceof Column?e:this.getById(e);let s=n.indexOf(i)+(t?1:-1);if(!n[s]){if(!r)return null;s=t?0:n.length-1}return n[s]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){const{grid:t={}}=this,{store:r}=t;let n=this.modelClass;if(e.type&&(n=ColumnStore.getColumnClass(e.type),!n))throw new Error(`Column type '${e.type}' not registered`);e.locked&&(e.region="locked",delete e.locked);const i=new n(e,this);if(i.data.region||(i.data.region=t.defaultRegion||"normal"),this.autoAddField&&!i.noFieldSpecified&&r&&!r.modelClass.getFieldDefinition(i.field)){let e=i.field;i.constructor.fieldType&&(e={name:i.field,type:i.constructor.fieldType}),r.modelClass.addField(e)}return i}indexOf(e){const t=super.indexOf(e);return t>-1?t:this.records.findIndex((t=>t.field===e))}static registerColumnType(e,t=!1){ColumnStore.columnTypes||(ColumnStore.columnTypes={}),e.simpleRenderer=t,ColumnStore.columnTypes[e.type]=e}static getColumnClass(e){return ColumnStore.columnTypes&&ColumnStore.columnTypes[e]}}const columnResizeEvent=(e,t)=>({update:({store:r,record:n,changes:i})=>{let s=!0;return("width"in i||"minWidth"in i||"flex"in i)&&(s=e.call(t,{store:r,record:n,changes:i})),s}});ColumnStore.registerColumnType(Column,!0),ColumnStore._$name="ColumnStore";class ActionColumn extends Column{static get type(){return"action"}static get fields(){return["actions"]}static get defaults(){return{filterable:!1,groupable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,minWidth:30}}construct(e,t){this.internalCellCls="b-action-cell",super.construct(...arguments),e.width||e.flex||this.grid.on("paint",this.updateAutoWidth,this)}renderer({column:e,record:t}){const r=t&&"groupRowFor"in t.meta;return{className:{"b-action-ct":1},children:e.actions.map(((n,i)=>{if("visible"in n){if("function"==typeof n.visible&&!1===n.visible({record:t}))return"";if(!1===n.visible)return""}if(r&&!n.showForGroup||!r&&n.showForGroup)return"";let s;if(s="function"==typeof n.tooltip?n.tooltip({record:t}):n.tooltip||"",n.renderer&&"function"==typeof n.renderer){const r=n.renderer({index:i,record:t,column:e,tooltip:s,action:n});return"string"==typeof r?{tag:"span",dataset:{index:i},html:r}:(r.dataset=r.dataset||{},r.dataset.index=i,r)}return{tag:"i",dataset:{index:i,btip:s},className:{"b-action-item":1,[n.cls]:1}}}))}}onCellClick({grid:e,column:t,record:r,target:n}){if(!n.classList.contains("b-action-item")||e.readOnly)return;let i=n.dataset.index;i||(i=n.parentElement.dataset&&n.parentElement.dataset.index);const s=t.actions[i],o=s&&s.onClick;o&&this.callback(o,t,[{record:r,action:s}])}updateAutoWidth(){const e=this,t=[];let r=[];e.actions.forEach((e=>{const n={...e};delete n.visible,n.showForGroup?(delete n.showForGroup,t.push(n)):r.push(n)})),t.length>r.length&&(r=t);const n=DomHelper.createElement(e.renderer({column:{actions:r}})).outerHTML;e.width=DomHelper.measureText(n,e.element,!0,e.element.parentElement)}}ColumnStore.registerColumnType(ActionColumn),ActionColumn.exposeProperties(),ActionColumn._$name="ActionColumn";class AggregateColumn extends Column{static get type(){return"aggregate"}static get fields(){return["function"]}static get defaults(){return{function:"sum"}}construct(e,t){this.configuredAlign="align"in e,this.configuredEditor="editor"in e,super.construct(...arguments);const{grid:r}=t;r&&(this.owner=r,r.on({paint:"onGridPaint",thisObj:this,prio:1e3}))}onGridPaint({source:e}){this.store=e.store}set store(e){const t=this,r={update:"onRecordUpdate",thisObj:t,prio:1e3},n=t._store;if(e!==n){n&&n.un(r),t._store=e;const{modelClass:i}=e,s=i.fieldMap[t.field];s&&"number"===s.type&&(t.configuredAlign||(t.align="end"),t.configuredEditor||(t.editor="number")),e.on(r)}}canEdit(e){return e.isLeaf}get store(){return this._store}sum(...e){let t=0;for(let r=0,{length:n}=e;r<n;r++)t+=parseInt(e[r]||0,10);return t}avg(...e){let t=0;const{length:r}=e;for(let n=0;n<r;n++)t+=parseInt(e[n]||0,10);return t/r}onRecordUpdate({record:e,changes:t}){const r=this,{rowManager:n}=r.grid;r.field in t&&e.isLeaf&&e.bubble((e=>{const t=n.getRowFor(e);if(t){const n=t.getCell(r.field);n&&t.renderCell(n,e)}}),!0)}getRawValue(e){let t=0;if(e.children){const r=this,n=r.function,i="string"==typeof n&&"function"==typeof Math[n],{handler:s,thisObj:o}=i?{handler:Math[n],thisObj:Math}:r.resolveCallback(n);for(let n=0,{length:i}=e.children;n<i;n++)t=s.call(o,t,r.getRawValue(e.children[n]));e.setData(r.field,t)}else t=e[this.field];return t}}ColumnStore.registerColumnType(AggregateColumn,!0),AggregateColumn.exposeProperties(),AggregateColumn._$name="AggregateColumn";class WidgetColumn extends Column{static get type(){return"widget"}static get fields(){return["widgets"]}static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1}}construct(e,t){this.widgetMap={},this.internalCellCls="b-widget-cell",super.construct(...arguments)}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}renderer(e){const t=this,{cellElement:r,column:n,value:i,record:s,isExport:o}=e,a=n.widgets;if(!o&&a&&(r.widgets||t.clearCell(r),r.widgets=a.map(((o,a)=>{let l,c;return r.widgets&&(l=r.widgets[a],c=l.element.nextElementSibling,o.recreate&&l&&(delete t.widgetMap[l.id],l.destroy(),r.widgets[a]=null)),l||(t.onBeforeWidgetCreate(o,e),l=WidgetHelper.append(o,c?{insertBefore:c}:r)[0],t.widgetMap[l.id]=l,t.onAfterWidgetCreate(l,e)),l.cellInfo={cellElement:r,value:i,record:s,column:n},t.grid&&(l.readOnly=t.grid.readOnly),!1!==t.onBeforeWidgetSetValue(l,e)&&(o.noValueOnRender||(o.valueProperty?l[o.valueProperty]=i:l.defaultBindProperty?l[l.defaultBindProperty]=i:l.text=l.value=i)),t.onAfterWidgetSetValue(l,e),l}))),o)return null}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}onBeforeWidgetSetValue(e,t){}onAfterWidgetSetValue(e,t){}clearCell(e){e.widgets&&(e.widgets.forEach((e=>{delete this.widgetMap[e.id],e.destroy()})),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}}ColumnStore.registerColumnType(WidgetColumn),WidgetColumn.exposeProperties(),WidgetColumn._$name="WidgetColumn";class CheckColumn extends WidgetColumn{static get type(){return"check"}static get fields(){return["checkCls","showCheckAll"]}static get defaults(){return{align:"center",checkCls:null,showCheckAll:!1,widgets:[{type:"checkbox",valueProperty:"checked"}]}}constructor(e,t){var r;super(...arguments);const n=this;n.internalCellCls="b-check-cell",null===(r=n.grid)||void 0===r||r.on({destroy:()=>{var e;return null===(e=n.headerCheckbox)||void 0===e?void 0:e.destroy()},thisObj:n})}headerRenderer({headerElement:e,column:t}){const r=this;if(e.classList.add("b-check-header"),!t.showCheckAll)return t.text;e.classList.add("b-check-header-with-checkbox"),t.headerCheckbox&&t.headerCheckbox.destroy(),t.headerCheckbox=new Checkbox({appendTo:e,owner:r.grid,listeners:{change:({checked:e})=>{t.trigger("toggleAll",{checked:e})}}})}renderer({value:e,isExport:t}){if(t)return null==e?"":e;super.renderer(...arguments)}onBeforeWidgetCreate(e,t){e.cls=this.checkCls}onAfterWidgetCreate(e,t){t.cellElement.widget=e,e.on({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}onBeforeWidgetSetValue(e){e.record=e.cellInfo.record,this.isInitialSet=!0}onAfterWidgetSetValue(e){this.isInitialSet=!1}onBeforeCheckboxChange({source:e,checked:t}){if(!this.isInitialSet)return this.trigger("beforeToggle",{record:e.cellInfo.record,checked:t})}onCheckboxChange({source:e,checked:t}){if(!this.isInitialSet){const r=e.cellInfo.record,n=this.field;if(n){const e="set"+StringHelper.capitalize(n);r[e]?r[e](t):r.set(n,t)}this.trigger("toggle",{record:r,checked:t})}}onCellKeyDown({event:e,cellElement:t}){if(" "===e.key){const r=t.widget;null==r||r.toggle(),e.preventDefault()}}}ColumnStore.registerColumnType(CheckColumn,!0),CheckColumn._$name="CheckColumn";class DateColumn extends Column{static get $name(){return"DateColumn"}static get type(){return"date"}static get fieldType(){return"date"}static get fields(){return["format","pickerFormat","step"]}static get defaults(){return{format:"L",step:1,minWidth:85,filterType:"date"}}constructor(e,t){super(...arguments),this.internalCellCls="b-date-cell"}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=DateHelper.parse(e,this.format||void 0)),DateHelper.format(e,this.format||void 0)}set format(e){const t=this,r=t.editor;t.set("format",e),r&&(r.format=t.format)}get format(){return this.get("format")}get defaultEditor(){const e=this;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:e.grid.weekStartDay,format:e.format,step:e.step}}}ColumnStore.registerColumnType(DateColumn,!0),DateColumn.exposeProperties(),DateColumn._$name="DateColumn";class PercentColumn extends Column{static get type(){return"percent"}static get fieldType(){return"number"}static get fields(){return["lowThreshold"]}static get defaults(){return{editor:{type:"number",min:0,max:100},showValue:!0,lowThreshold:20,filterType:"number",htmlEncode:!1,searchable:!1,summaryRenderer:e=>e+"%"}}constructor(e,t){super(...arguments),this.internalCellCls="b-percent-bar-cell"}defaultRenderer({value:e}){return{className:"b-percent-bar-outer",children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":0===(e=e||0),"b-low":e<this.lowThreshold},style:{width:e+"%"},text:this.showValue?e+"%":void 0}]}}resizeToFitContent(){}}PercentColumn.sum="average",ColumnStore.registerColumnType(PercentColumn,!0),PercentColumn._$name="PercentColumn";class NumberColumn extends Column{static get type(){return"number"}static get fieldType(){return"number"}static get fields(){return["format","min","max","step","largeStep","unit"]}static get defaults(){return{filterType:"number",format:""}}constructor(e,t){super(...arguments),this.internalCellCls="b-number-cell"}get defaultEditor(){const{format:e,name:t,max:r,min:n,step:i,largeStep:s,align:o}=this;return ObjectHelper.cleanupProperties({type:"numberfield",format:e,name:t,max:r,min:n,step:i,largeStep:s,textAlign:o})}get formatter(){const e=this,{format:t}=e;let r=e._formatter;return r&&e._lastFormat===t||(e._formatter=r=NumberFormat.get(e._lastFormat=t)),r}defaultRenderer({value:e}){return null!=e&&(e=this.formatter.format(e),this.unit&&(e=`${e}${this.unit}`)),e}}ColumnStore.registerColumnType(NumberColumn,!0),NumberColumn.exposeProperties(),NumberColumn._$name="NumberColumn";class RatingColumn extends NumberColumn{static get type(){return"rating"}static get fieldType(){return"number"}static get fields(){return["emptyIcon","filledIcon","editable"]}static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,minWidth:"11.2em",editor:!1}}constructor(e,t){super(...arguments),this.internalCellCls="b-rating-cell"}renderer({value:e}){return{className:{"b-rating-cell-inner":1,"b-not-editable":!this.editable},children:ArrayHelper.populate(this.max,(t=>{const r=t<e;return{tag:"i",className:{"b-rating-icon":!0,"b-filled":r,"b-empty":!r,[r?this.filledIcon:this.emptyIcon]:!0}}}))}}onCellClick({grid:e,column:t,record:r,target:n,event:i}){if(n.classList.contains("b-rating-icon")&&!e.readOnly&&t.editable){let e=[].indexOf.call(n.parentNode.childNodes,n);n.classList.contains("b-filled")&&(i.metaKey||i.shiftKey)&&(e-=1),1===r.get(t.field)&&0===e&&(e=-1),r.set(t.field,e+1)}}}ColumnStore.registerColumnType(RatingColumn,!0),RatingColumn.exposeProperties(),RatingColumn._$name="RatingColumn";class RowNumberColumn extends Column{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,minWidth:50,width:50,align:"right",text:"#",editor:!1}}construct(e,t){const r=this;super.construct(...arguments);const{grid:n}=r;n&&(n.store.on({["change"+n.asyncEventSuffix]:"onStoreChange",thisObj:r}),n.store.count&&n.on({render:"resizeToFitContent",thisObj:r,once:!0})),r.internalCellCls="b-row-number-cell"}static get type(){return"rownumber"}onStoreChange({action:e}){"dataset"!==e&&"add"!==e&&"remove"!==e&&"removeall"!==e||this.resizeToFitContent()}renderer({record:e,grid:t}){return e.isSpecialRow?"":t.store.indexOf(e,!0)+1}resizeToFitContent(){const{grid:e}=this,{store:t}=e,{count:r}=t;if(r&&!this.hidden){const t=e.element.querySelector(`.b-grid-cell[data-column-id="${this.id}"]`);if(t){const e=parseInt(DomHelper.getStyleValue(t,"padding-left")),n=DomHelper.measureText(r,t);this.width=n+2*e}}}set flex(e){}}ColumnStore.registerColumnType(RowNumberColumn,!0),RowNumberColumn._$name="RowNumberColumn";class TemplateColumn extends Column{static get fields(){return["template"]}static get defaults(){return{htmlEncode:!1}}constructor(e,t){super(...arguments);if(!this.template)throw new Error("TemplateColumn needs a template");if("function"!=typeof this.template)throw new Error("TemplateColumn.template must be a function")}static get type(){return"template"}renderer(e){if(!e.record.isSpecialRow)return this.template({value:e.value,record:e.record,field:e.column.field})}}ColumnStore.registerColumnType(TemplateColumn,!0),TemplateColumn.exposeProperties(),TemplateColumn._$name="TemplateColumn";class TimeColumn extends Column{static get type(){return"time"}static get fieldType(){return"date"}static get fields(){return["format"]}static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}constructor(e,t){super(...arguments),this.internalCellCls="b-time-cell"}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){const t=this;return"string"==typeof e&&(e=DateHelper.parse(e,t.format)),DateHelper.format(e,t.format)}set format(e){const t=this,r=t.editor;t.set("format",e),r&&(r.format=t.format)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"time",format:this.format}}}ColumnStore.registerColumnType(TimeColumn,!0),TimeColumn.exposeProperties(),TimeColumn._$name="TimeColumn";let currentParentHasIcon=!1;class TreeColumn extends Column{static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.7},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"}]}static get type(){return"tree"}constructor(e,t){super(...arguments);const r=this;r.internalCellCls="b-tree-cell",r.shouldHtmlEncode=r.htmlEncode,r.tempDiv=document.createElement("div"),r.setData("htmlEncode",!1),r.renderer&&(r.originalRenderer=r.renderer),r.renderer=r.treeRenderer.bind(r)}treeRenderer(e){const t=this,{cellElement:r,row:n,record:i,isExport:s}=e,o=i.instanceMeta(e.grid.store),a=i.href?"a":"div";let l,{value:c}=e;if(t.originalRenderer){const n=t.originalRenderer(e);c=!1===n?r.innerHTML:n}if(s)l=null!=c?c:"";else{let s,d="";if(i.isLeaf)r.classList.add("b-tree-leaf-cell"),s=e.iconCls||i.iconCls||t.leafIconCls;else{const a=o.collapsed,l=a?t.expandIconCls:t.collapseIconCls,c=a?t.collapsedFolderIconCls:t.expandedFolderIconCls;if("Row"===n.$$name){const e="b-loading-children",t="b-tree-collapsed",r="b-tree-expanded",i=["b-tree-parent-row"],s=[];o.isLoadingChildren?i.push(e):s.push(e),a?(i.push(t),s.push(r)):(i.push(r),s.push(t)),n.removeCls(...s),n.addCls(...i)}r.classList.add("b-tree-parent-cell"),d+=`<div class="b-tree-expander">${l?`<i class="${l}"></i>`:""}</div>`,currentParentHasIcon=s=e.iconCls||i.iconCls||c}c=null!=c?c:"",t.shouldHtmlEncode&&(t.tempDiv.innerText=c,c=t.tempDiv.innerHTML),d+=`<div class="b-tree-cell-value">${s?`<i class="b-tree-icon ${s}"></i>`:""}${c}</div>`;const u=i.childLevel*t.indentSize+(i.isLeaf?currentParentHasIcon?2:s?.5:.4:0);l=`<${a} ${i.href?`href="${i.href}"`:""} ${"a"===a&&i.target?`target="${i.target}"`:""} class="b-tree-cell-inner" style="padding-left:${u}em;">${d}</${a}>`}return l}}ColumnStore.registerColumnType(TreeColumn,!0),TreeColumn.exposeProperties(),TreeColumn._$name="TreeColumn";class GridRowModel extends Model{static get fields(){return["iconCls","expanded","cls","rowHeight","href","target"]}}GridRowModel.exposeProperties(),GridRowModel._$name="GridRowModel";class ContextMenuBase extends InstancePlugin{static get $name(){return"ContextMenuBase"}static get defaultConfig(){return{type:null,menuConfig:null,items:null,processItems:null,triggerEvent:null}}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick","onElementKeyDown"]}}construct(){if(super.construct(...arguments),!this.type||!this.type.length)throw new Error("Config 'type' is required to be specified for context menu")}doDestroy(){var e;null===(e=this.menu)||void 0===e||e.destroy(),super.doDestroy()}onElementContextMenu(e){"contextmenu"===this.triggerEvent&&this.internalShowContextMenu(e)}onElementClick(e){"click"===this.triggerEvent&&this.internalShowContextMenu(e)}onElementDblClick(e){"dblclick"===this.triggerEvent&&this.internalShowContextMenu(e)}onElementKeyDown(e){}internalShowContextMenu(e){const t=this;if(t.disabled)return;const r=t.getDataFromEvent(e);t.shouldShowMenu(r)&&t.showContextMenu(r)}getDataFromEvent(e){return{event:e,targetElement:this.getTargetElementFromEvent(e)}}getTargetElementFromEvent(e){return e.target}showContextMenu(e){const t=this;if(t.disabled)return;const{type:r,client:n,processItems:i,items:s}=t,{event:o,targetElement:a}=e,l=o?[o.clientX+1,o.clientY+1]:Rectangle.from(a).center;ObjectHelper.assign(e,{items:{},selection:n.selectedRecords}),t.callChainablePopulateMenuMethod(e);for(const e in s)!0===s[e]&&Reflect.deleteProperty(s,e);ObjectHelper.merge(e.items,s),i&&!1===i(e)||!t.hasActiveMenuItems(e)||(t.populateItemsWithData(e),t.preventDefaultEvent(e),!1!==t.beforeContextMenuShow(e)&&!1!==n.trigger(r+"MenuBeforeShow",e)&&!1!==n.trigger(r+"ContextMenuBeforeShow",e)&&(t.menu=WidgetHelper.showContextMenu(l,ObjectHelper.merge({items:e.items,owner:n,scrollAction:"hide",constrainTo:window,onBeforeItem(t){Object.assign(t,e)},onItem(e){n.trigger(r+"MenuItem",e),n.trigger("contextMenuItem",e),n.trigger(r+"ContextMenuItem",e)},onToggle(e){n.trigger(r+"MenuToggleItem",e),n.trigger("contextMenuToggleItem",e)},onDestroy(){t.menu=null},onShow({source:t}){e.menu=t,n.trigger(r+"MenuShow",e),n.trigger(r+"ContextMenuShow",e)}},t.menuConfig))))}hideContextMenu(e){var t;null===(t=this.menu)||void 0===t||t.hide(e)}callChainablePopulateMenuMethod(e){const t=`populate${StringHelper.capitalize(this.type)}Menu`;this.client[t]&&this.client[t](e)}createContextMenuEventForElement(e){const t=Rectangle.from(e).center,r=new MouseEvent(this.triggerEvent,{clientX:t.x,clientY:t.y});return Object.defineProperty(r,"target",{get:()=>e}),r}hasActiveMenuItems(e){return Object.values(e.items).some((e=>e))}shouldShowMenu(){return!0}beforeContextMenuShow(e){}populateItemsWithData(e){}preventDefaultEvent(e){var t;null===(t=e.event)||void 0===t||t.preventDefault()}set triggerEvent(e){this._triggerEvent=e}get triggerEvent(){return this._triggerEvent||this.client.contextMenuTriggerEvent}set type(e){this._type=e}get type(){return this._type}set menuConfig(e){this._menuConfig=e}get menuConfig(){return this._menuConfig}}ContextMenuBase._$name="ContextMenuBase";const consumerToFeatureMap=new Map,consumerToDefaultFeatureMap=new Map,DEFAULT_FOR_TYPE="Grid",remapToBase={Grid:"GridBase",Scheduler:"SchedulerBase",Gantt:"GanttBase"},classNameFix=/\$\d+$/;class GridFeatureManager{static registerFeature(e,t=!1,r=null,n=null){n=(n=StringHelper.uncapitalize(n||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name)).replace(classNameFix,""),Array.isArray(r)||(r=[r||"Grid"]),r.forEach((r=>{const i=remapToBase[r]||r,s=consumerToFeatureMap.get(i)||new Map,o=consumerToDefaultFeatureMap.get(i)||new Map;s.set(n,e),o.set(e,t),consumerToFeatureMap.set(i,s),consumerToDefaultFeatureMap.set(i,o)}))}static getTypeNameFeatures(e="Grid"){const t=remapToBase[e]||e,r=consumerToFeatureMap.get(t),n={};return r&&r.forEach(((e,t)=>n[t]=e)),n}static getTypeNameDefaultFeatures(e="Grid"){const t=remapToBase[e]||e,r=consumerToFeatureMap.get(t),n=consumerToDefaultFeatureMap.get(t),i={};return r&&n&&r.forEach(((e,t)=>{n.get(e)&&(i[t]=e)})),i}static getInstanceFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.assign(e,this.getTypeNameFeatures(t))),{})}static getInstanceDefaultFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce(((e,[r,n])=>(this.isDefaultFeatureForTypeName(n,t)?e[r]=n:delete e[r],e)),e)),{})}static isDefaultFeatureForTypeName(e,t="Grid"){const r=remapToBase[t]||t,n=consumerToDefaultFeatureMap.get(r);return n&&n.get(e)||!1}static isDefaultFeatureForInstance(e,t){const r=t.$meta.names.slice().reverse();let n=null;for(let t=0,i=r.length;t<i&&null===n;++t){const i=consumerToDefaultFeatureMap.get(r[t]);i&&i.has(e)&&(n=i.get(e))}return n||!1}static reset(){consumerToFeatureMap.clear(),consumerToDefaultFeatureMap.clear()}}GridFeatureManager._$name="GridFeatureManager";class CellMenu extends ContextMenuBase{static get $name(){return"CellMenu"}static get defaultConfig(){return{type:"cell"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateCellMenu"),e}showContextMenu(e){const{cellSelector:t,id:r,event:n}=e;this.client.focusCell(t,{doSelect:!this.client.isSelected(r),event:n}),super.showContextMenu(e)}shouldShowMenu({column:e}){return e&&!1!==e.enableCellContextMenu}getDataFromEvent(e){return ObjectHelper.assign(super.getDataFromEvent(e),this.client.getCellDataFromEvent(e))}beforeContextMenuShow(e){e.record&&!e.record.isSpecialRow||(e.items.removeRow=!1)}populateCellMenu({items:e,column:t}){const{client:r}=this;(null==t?void 0:t.cellMenuItems)&&(Array.isArray(t.cellMenuItems)&&VersionHelper.deprecate("Grid","5.0.0","`cellMenuItems` column config specified as an array is deprecated, need to specify the config as a named object. Please see https://bryntum.com/docs/grid/#guides/upgrades/4.0.0.md for more information."),ObjectHelper.merge(e,t.cellMenuItems)),r.readOnly||(e.removeRow={text:r.selectedRecords.length>1?"L{removeRows}":"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",name:"removeRow",cls:"b-separator",weight:100,onItem:()=>r.store.remove(r.selectedRecords)},r.showRemoveRowInContextMenu||(VersionHelper.deprecate("Grid","5.0.0","`showRemoveRowInContextMenu` config is deprecated, in favor of `CellMenu` feature configuration. Please see https://bryntum.com/docs/grid/#guides/upgrades/4.0.0.md for more information."),e.removeRow=!1))}get showMenu(){return!0}}CellMenu.featureClass="",CellMenu._$name="CellMenu",GridFeatureManager.registerFeature(CellMenu,!0,["Grid","Scheduler"]),GridFeatureManager.registerFeature(CellMenu,!1,["Gantt"]);class CellTooltip extends InstancePlugin{static get $name(){return"CellTooltip"}static get defaultConfig(){return{tooltipRenderer:null}}construct(e,t){super.construct(e,this.processConfig(t))}initTip(){const e=this;e.tip=new Tooltip(Object.assign({forElement:e.client.element,forSelector:".b-grid-cell",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:e.getTooltipContent.bind(e),listeners:{pointerOver:"onPointerOver",thisObj:e}},e.initialConfig)),e.relayEvents(e.tip,["beforeshow","show"])}onPointerOver({target:e}){return!1!==this.client.getColumnFromElement(e).tooltipRenderer}processConfig(e){return"function"==typeof e?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.tip&&this.tip.destroy(),super.doDestroy()}doDisable(e){e?this.tip&&(this.tip.destroy(),this.tip=null):this.initTip(),super.doDisable(e)}getTooltipContent({tip:e,activeTarget:t,event:r}){const n=this,i=n.client.getRecordFromElement(t),s=n.client.getColumnFromElement(t);let o;return n.forSelector||i!==n.lastRecord||s!==n.lastColumn?(n.lastRecord=i,n.lastColumn=s,s.tooltipRenderer?(o=s.tooltipRenderer({cellElement:t,record:i,column:s,event:r,tip:e,cellTooltip:n}),!1===o&&VersionHelper.deprecate("Grid","5.0.0","Returning false to indicate loading is deprecated. Please see https://bryntum.com/docs/grid/#guides/upgrades/3.0.1.md for more information")):n.tooltipRenderer&&!1!==s.tooltipRenderer&&(o=n.tooltipRenderer({cellElement:t,record:i,column:s,event:r,tip:e,cellTooltip:n}),!1===o&&VersionHelper.deprecate("Grid","5.0.0","Returning false to indicate loading is deprecated. Please see https://bryntum.com/docs/grid/#guides/upgrades/3.0.1.md for more information")),o):n.tip._html}}CellTooltip._$name="CellTooltip",GridFeatureManager.registerFeature(CellTooltip);const storeListenerName="store";class ColumnAutoWidth extends(Delayable(InstancePlugin)){static get $name(){return"ColumnAutoWidth"}construct(e){var t;super.construct(e);const r=null===(t=this.client)||void 0===t?void 0:t.store;r&&this.bindStore(r)}static get defaultConfig(){return{default:null,delay:0}}static get pluginConfig(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}doDestroy(){this.unbindStore(),super.doDestroy()}bindStore(e){this.lastSync=null,e.on({name:"store",["change"+this.client.asyncEventSuffix]:"onStoreChange"},this)}unbindStore(){this.detachListeners("store")}get columnAutoWidthPending(){return null===this.lastSync||this.hasTimeout("syncAutoWidthColumns")}onStoreChange({action:e}){"move"!==e&&(++this.storeGeneration,this.hasTimeout("syncAutoWidthColumns")||this.setTimeout("syncAutoWidthColumns",this.delay))}syncAutoWidthColumns(){const e=this,t=e.client,r=e.storeGeneration;if(e.lastSync!==r){let n,i;e.lastSync=r;for(const r of t.columns.visibleColumns)n=r.autoWidth,n&&(!0===n&&(n=e.default),t.resizingColumns=i=!0,r.resizeToFitContent(n));i&&(t.resizingColumns=!1,t.afterColumnsResized())}e.hasTimeout("syncAutoWidthColumns")&&e.clearTimeout("syncAutoWidthColumns")}}ColumnAutoWidth.prototype.storeGeneration=0,ColumnAutoWidth._$name="ColumnAutoWidth",GridFeatureManager.registerFeature(ColumnAutoWidth,!0);class ColumnDragToolbar extends(Delayable(InstancePlugin)){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(e,t){e.features.columnReorder&&e.features.columnReorder.on("beforedestroy",this.onColumnReorderBeforeDestroy,this),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,t=e.grid;t.features.columnReorder&&(e.reorderDetacher=t.features.columnReorder.on({gridheaderdragstart({context:r}){const n=t.columns.getById(r.element.dataset.columnId);e.showToolbar(n)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridheaderdrop:({context:t})=>{t.valid?e.hideToolbar():e.onDrop(t)},thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const t=this,r=t.grid.getColumnDragToolbarItems(e,[]),n=[];t.clearTimeout(t.buttonHideTimer),t.clearTimeout(t.toolbarHideTimer),r.forEach((e=>{e.text=e.localeClass.L(e.text);let t=n.find((t=>t.text===e.group));t||(t={text:e.localeClass.L(e.group),buttons:[]},n.push(t)),t.buttons.push(e)})),t.element=DomHelper.append(t.grid.element,t.template(n)),t.groups=n,t.buttons=r,t.column=e}hideToolbar(){const e=this;return new Promise((t=>{e.element&&!e.toolbarHideTimer&&(e.element.classList.add("b-remove"),e.toolbarHideTimer=e.setTimeout((()=>{e.toolbarHideTimer=null,e.element&&e.element.remove(),e.element=null,t()}),200))}))}onDrag(e){const t=this;if(e.dragProxy.getBoundingClientRect().top-t.grid.element.getBoundingClientRect().top>100?t.element.classList.add("b-closer"):t.element.classList.remove("b-closer"),t.hoveringButton&&(t.hoveringButton.classList.remove("b-hover"),t.hoveringButton=null),e.targetElement&&e.targetElement.closest(".b-columndragtoolbar")){t.element.classList.add("b-hover");const r=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");r&&(r.classList.add("b-hover"),t.hoveringButton=r)}else t.element.classList.remove("b-hover")}onDrop(e){const t=this;if(e.targetElement&&e.targetElement.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const r=e.targetElement,n=t.buttons.find((e=>e.name===r.dataset.name));n&&(r.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout((()=>{t.hideToolbar(),n.onDrop({column:t.column})}),100))}else t.hideToolbar()}template(e){return TemplateHelper.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${e.map((e=>TemplateHelper.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${e.buttons.map((e=>TemplateHelper.tpl`
                        <div class="b-target-button" data-name="${e.name}" data-disabled="${e.disabled}">
                            <i class="${e.icon}"></i>
                            ${e.text}
                        </div>
                    `))}
                    </div>
                    <div class="b-title">${e.text}</div>
                </div>
            `))}
            </div>`}}ColumnDragToolbar.featureClass="b-hascolumndragtoolbar",ColumnDragToolbar._$name="ColumnDragToolbar",GridFeatureManager.registerFeature(ColumnDragToolbar,BrowserHelper.isTouchDevice);class ColumnPicker extends InstancePlugin{static get $name(){return"ColumnPicker"}static get defaultConfig(){return{groupByRegion:!1,groupByTag:!1}}static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}construct(e,t){this.grid=e,super.construct(e,t)}getColumnPickerItems(e){const t=this;if(t.groupByRegion)return t.grid.regions.map((e=>{const r=t.grid.getSubGrid(e).columns.topColumns;return{text:StringHelper.capitalize(e),menu:t.buildColumnMenu(r),disabled:0===r.length,region:e}}));if(t.groupByTag){const r={};return e.topColumns.forEach((e=>{e.tags&&e.hideable&&e.tags.forEach((e=>{r[e]||(r[e]=1)}))})),Object.keys(r).sort().map((e=>({text:StringHelper.capitalize(e),menu:t.buildColumnMenu(t.getColumnsForTag(e)),tag:e,onBeforeSubMenu:({item:e,itemEl:r})=>{t.refreshTagMenu(e,r)}})))}return t.buildColumnMenu(e.topColumns)}getColumnsForTag(e){return this.grid.columns.records.filter((t=>t.tags&&t.tags.includes(e)&&!1!==t.hideable))}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach((t=>{const r=e.items.find((e=>e.column===t));r&&(r.checked=!0!==t.hidden)}))}buildColumnMenu(e){let t=e.length>0&&e[0].region;const{grid:r}=this;return e.reduce(((e,n)=>{const i=this.grid.columns.visibleColumns.filter((e=>e.region===n.region));if(!1!==n.hideable){const s={grid:r,text:n.text,column:n,name:n.id,checked:!0!==n.hidden,disabled:!0!==n.hidden&&1===i.length,cls:n.region!==t?"b-separator":""};t=n.region,n.children&&(s.menu=this.buildColumnMenu(n.children)),e.push(s)}return e}),[])}populateHeaderMenu({column:e,items:t}){const r=this,{columns:n}=r.grid;if(!1!==e.showColumnPicker&&n.some((e=>e.hideable))&&(t.columnPicker={text:"L{columnsMenu}",localeClass:r,name:"columnPicker",icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:r.getColumnPickerItems(n),onToggle:r.onColumnToggle,disabled:r.disabled}),!1!==e.hideable){const i=n.visibleColumns.filter((t=>t.region===e.region));t.hideColumn={text:"L{hideColumn}",localeClass:r,icon:"b-fw-icon b-icon-hide-column",weight:210,name:"hideColumn",disabled:1===i.length||r.disabled,onItem:()=>e.hide()}}}onColumnToggle({menu:e,item:t,checked:r}){if(!!t.column.hidden!=!r){t.column[r?"show":"hide"]();const{grid:n,column:i}=t,{columns:s,features:o}=n,a=e.items,l=s.visibleColumns.filter((e=>e.region===t.column.region)),{contextMenu:c,headerMenu:d}=o,u=c&&!c.disabled,h=u?c:d,g=h&&h[u?"currentMenu":"menu"],m=u?g.items.find((e=>"hideColumn"===e.name)):g.widgetMap.hideColumn;if(1===l.length){const e=a.find((e=>e.name===l[0].id));e&&(e.disabled=!0),m&&i.region===t.column.region&&(m.disabled=!0)}else l.forEach((e=>{const t=a.find((t=>t.column===e));t&&(t.disabled=!1)})),m&&i.region===t.column.region&&(m.disabled=!1);t.menu&&t.menu.eachWidget((e=>{e.checked=r}));const p=e.owner;p&&p.column===i.parent&&(p.checked=a.some((e=>!0===e.checked)))}}getColumnDragToolbarItems(e,t){const r=this.grid.columns.visibleColumns.filter((t=>t.region===e.region));return!1!==e.hideable&&r.length>1&&t.push({text:"L{hideColumnShort}",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,name:"hideColumn",onDrop:({column:e})=>e.hide()}),t}}ColumnPicker._$name="ColumnPicker",GridFeatureManager.registerFeature(ColumnPicker,!0);class ColumnReorder extends(Delayable(InstancePlugin)){static get $name(){return"ColumnReorder"}construct(e,t){this.ignoreSelectors=[".b-grid-header-resize-handle",".b-field"],this.grid=e,super.construct(e,t)}doDestroy(){this.dragHelper&&this.dragHelper.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e,r=t.element,n=DomHelper.children(r,".b-grid-headers");n.push(...DomHelper.children(r,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=n:(e.dragHelper=new DragHelper({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",outerElement:r.querySelector("header.b-grid-header-container"),containers:n,isElementDraggable(r){if(Boolean(DomHelper.up(r,e.ignoreSelectors.join(",")))||e.disabled)return!1;const n=DomHelper.up(r,this.targetSelector),i=n&&t.columns.getById(n.dataset.columnId),s=i&&0===i.childLevel&&1===t.subGrids[i.region].columns.count;return Boolean(i)&&!1!==i.draggable&&!s},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",listeners:{dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"))}static get pluginConfig(){return{after:["render","renderContents"]}}onDrag({context:e,event:t}){const r=Widget.fromElement(t.target,"gridheader");r&&r.subGrid.sealedColumns?e.valid=!1:this.grid.features.columnDragToolbar||(e.valid=Boolean(t.target.closest(".b-grid-headers")))}onDragStart(){const e=this;if(!e.grid.features.columnDragToolbar){const t=e.grid.element.querySelector(".b-grid-header-container").getBoundingClientRect();e.dragHelper.minY=t.top,e.dragHelper.maxY=t.bottom}this.grid.headerContainer.classList.add("b-dragging-header")}onDrop({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,r=t.grid,n=e.dragging,i=DomHelper.up(e.target,".b-grid-header"),s=r.columns.get(i.dataset.column),o=e.draggedTo.dataset.region||s.region,a=e.insertBefore,l=r.columns.getById(n.dataset.columnId),c=a?r.columns.getById(a.dataset.columnId):r.subGrids[o].columns.last.nextSibling,d=c?c.parent:r.columns.rootNode;if(r.headerContainer.classList.remove("b-dragging-header"),o===l.region&&(s===l.previousSibling||c===l.nextSibling))return void t.dragHelper.abort();const u=l.parent&&1===l.parent.children.length&&l.parent;u&&u.parent.removeChild(u),n.remove(),l.region=o,d.insertChild(l,c)}onInvalidDrop(){this.grid.headerContainer.classList.remove("b-dragging-header")}renderContents(){this.init()}render(){this.init()}}ColumnReorder.featureClass="b-column-reorder",ColumnReorder._$name="ColumnReorder",GridFeatureManager.registerFeature(ColumnReorder,!0);class ColumnResize extends InstancePlugin{static get $name(){return"ColumnResize"}static get defaultConfig(){return{liveResize:"auto"}}construct(e,t){const r=this;r.grid=e,super.construct(e,t),r.resizer=new ResizeHelper({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,listeners:{beforeresizestart:r.onBeforeResizeStart,resizestart:r.onResizeStart,resizing:r.onResizing,resize:r.onResize,thisObj:r}})}static get pluginConfig(){return[]}set liveResize(e){"auto"===e&&(e=!BrowserHelper.isMobileSafari),this._liveResize=e}get liveResize(){return this._liveResize}doDestroy(){this.resizer&&this.resizer.destroy(),super.doDestroy()}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:e}){const{grid:t,resizer:r}=this,n=e.column=t.columns.getById(e.element.dataset.columnId);r.minWidth=n.minWidth,e.element.style.minWidth="",t.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.resizingColumns=!0,e.column.width=e.newWidth)}onResize({context:e}){const{grid:t}=this,{column:r}=e;if(t.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(t.resizingColumns=!1,t.afterColumnsResized()):r.width=e.newWidth,BrowserHelper.isIE11&&r.parent&&r.parent.flex)){const e=r.parent;t.getHeaderElement(e.id).style.flexBasis=e.children.reduce(((e,r)=>e+t.getHeaderElement(r.id).offsetWidth),0)+"px"}}}ColumnResize._$name="ColumnResize",GridFeatureManager.registerFeature(ColumnResize,!0);class ContextMenu extends InstancePlugin{static get $name(){return"ContextMenu"}static get defaultConfig(){return{headerItems:[],processHeaderItems:null,cellItems:[],processCellItems:null,triggerEvent:null,disableCellContextMenu:null}}construct(e,t){super.construct(e,t),this.grid=e,VersionHelper.deprecate("Grid","5.0.0","`ContextMenu` feature is deprecated, in favor of `CellMenu` and `HeaderMenu` features. Please see https://bryntum.com/docs/grid/#guides/upgrades/3.1.0.md for more information."),e.features.cellMenu&&(e.features.cellMenu.disabled=!0),e.features.headerMenu&&(e.features.headerMenu.disabled=!0)}doDestroy(){this.currentMenu&&this.currentMenu.destroy(),super.doDestroy()}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick","onElementKeyDown"]}}onElementContextMenu(e){"contextmenu"===this.triggerEvent&&this.showContextMenu(e)}onElementClick(e){"click"===this.triggerEvent&&this.showContextMenu(e)}onElementDblClick(e){"dblclick"===this.triggerEvent&&this.showContextMenu(e)}onElementKeyDown(e){if(!e.handled&&e.target.matches(".b-grid-header.b-depth-0"))switch(e.key){case" ":case"ArrowDown":this.showContextMenu(e)}}showContextMenu(e){if(!this.disabled){const t=DomHelper.up(e.target,".b-grid-header"),r=this.grid.getCellDataFromEvent(e);t?this.handleHeaderContextMenu(t,e):r&&!this.disableCellContextMenu&&this.handleCellContextMenu(r,e)}}handleHeaderContextMenu(e,t){if(e.dataset.column){const r=this,n=r.grid,i=n.columns.getById(e.dataset.columnId);if(!1!==i.enableHeaderContextMenu){const s=[...r.headerItems,...i.headerMenuItems||[]],o=ObjectHelper.transformArrayToNamedObject(s),a={owner:r.client,constrainTo:document,cls:"b-context-menu",scrollAction:"hide",onItem({item:e,element:t}){n.trigger("contextMenuItem",{source:n,item:e,column:i,element:t})},onToggle({item:e,checked:t,element:r}){n.trigger("contextMenuToggleItem",{source:n,item:e,column:i,checked:t,element:r})},onDestroy(){r.currentMenu=null},listeners:{show({source:e}){d.menu=e,n.trigger("headerContextMenuShow",d)}}};n.populateHeaderMenu({column:i,items:o,menu:a});const l=ObjectHelper.transformNamedObjectToArray(o),{processHeaderItems:c}=r,d={items:l,column:i,event:t,element:e};ObjectHelper.merge(a,{items:l}),(!c||!1!==c(d))&&l.length>0&&(t.preventDefault(),l.sort(((e,t)=>(e.weight||150)-(t.weight||150))),!1!==n.trigger("headerContextMenuBeforeShow",d)&&(r.currentMenu=WidgetHelper.showContextMenu("keydown"===t.type?e:[t.clientX+1,t.clientY+1],a),r.currentMenu.eachWidget((e=>{!e.column&&e instanceof MenuItem&&(e.column=i)}),!0)))}}}handleCellContextMenu(e,t){const r=this,n=r.grid,i=n.columns.getById(e.columnId);if(!1!==i.enableCellContextMenu){n.focusCell(e.cellSelector,{doSelect:!n.isSelected(e.id),event:t});const s=e.record,o=[...r.cellItems||[],...i.cellMenuItems||[]],a=ObjectHelper.transformArrayToNamedObject(o);n.populateCellMenu({column:i,record:s,items:a});const l=ObjectHelper.transformNamedObjectToArray(a),{processCellItems:c}=r,d=e.cellElement,u={items:l,column:i,event:t,record:s,element:d},h={owner:r.client,items:l,onBeforeItem:e=>{Object.assign(e,u)},onItem({item:e}){n.trigger("contextMenuItem",{source:n,item:e,column:i,record:s,cell:d})},onClose({reason:e}){"outside"!==e&&n.focus()},onDestroy(){r.currentMenu=null},listeners:{show({source:e}){u.menu=e,n.trigger("cellContextMenuShow",u)}}};(!c||!1!==c(u))&&l.length>0&&(l.forEach((e=>{e.column=i,e.record=s})),t.preventDefault(),l.sort(((e,t)=>(e.weight||150)-(t.weight||150))),!1!==n.trigger("cellContextMenuBeforeShow",u)&&(r.currentMenu=WidgetHelper.showContextMenu([t.clientX+1,t.clientY+1],h)))}}hideContextMenu(e){this.currentMenu&&this.currentMenu.hide(e)}get triggerEvent(){return this._triggerEvent||this.client.contextMenuTriggerEvent}set triggerEvent(e){this._triggerEvent=e}}ContextMenu.featureClass="",ContextMenu._$name="ContextMenu",GridFeatureManager.registerFeature(ContextMenu);const fieldTypeMap={date:"date",integer:"number",number:"number",string:"text",duration:"duration"};class Filter extends InstancePlugin{static get $name(){return"Filter"}construct(e,t){if(e.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const r=this;r.grid=e,r.closeFilterEditor=r.closeFilterEditor.bind(r),super.construct(e,t),r.bindStore(e.store),t&&"object"==typeof t&&e.store.filter(t,null,e.isConfiguring)}doDestroy(){var e,t;null===(e=this.filterTip)||void 0===e||e.destroy(),null===(t=this.filterEditorPopup)||void 0===t||t.destroy(),super.doDestroy()}get store(){return this.grid.store}bindStore(e){this.detachListeners("name"),e.on({name:"store",filter:"onStoreFilter",thisObj:this})}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(e){const t=this,r=t.grid,n=r.headerContainer;if(n){DomHelper.children(n,".b-filter-icon.b-latest").forEach((e=>e.classList.remove("b-latest"))),t.filterTip||(t.filterTip=new Tooltip({forElement:n,forSelector:".b-filter-icon",getHtml:({activeTarget:e})=>e.dataset.filterText}));for(const e of r.columns)if(!1!==e.filterable){const r=t.store.filters.getBy("property",e.field),n=e.element;if(n){const i=e.textWrapper;let s,o=null==i?void 0:i.querySelector(".b-filter-icon");s=r?t.L("L{filter}")+": "+("string"==typeof r?r:`${r.operator} ${r.displayValue||r.value||""}`):t.L("L{applyFilter}"),o?o.dataset.filterText=s:(o=DomHelper.createElement({parent:i,tag:"div",className:"b-filter-icon",dataset:{filterText:s}}),n.classList.add("b-filterable")),e.field===t.store.latestFilterField&&o.classList.add("b-latest"),n.classList[r?"add":"remove"]("b-filter")}e.meta.isFiltered=!!r}e&&r.refreshRows()}}applyFilter(e){const{store:t}=this,r=this.grid.columns.get(e.property);"function"==typeof r.filterable?t.filter({filterBy:t=>r.filterable(Object.assign({},e,{record:t})),value:e.value,property:e.property,operator:e.operator,displayValue:e.displayValue}):t.filter(e)}getPopupDateItems(e,t,r,n,i,s,o){const a=this,l=s;function c(){a.store.removeFilter(n)}function d({event:e}){"Enter"===e.key&&s()}function u({source:e,value:t}){null==t?c():(a.clearSiblingsFields(e),a.applyFilter({property:n,operator:e.operator,value:t,displayValue:e._value}))}return[{type:"date",ref:"on",placeholder:"L{on}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==t?void 0:t.operator)?t.value:r,operator:"=",onKeydown:d,onChange:u,onClose:l,onClear:c},{type:"date",ref:"before",placeholder:"L{before}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:"<"===(null==t?void 0:t.operator)?t.value:null,operator:"<",onKeydown:d,onChange:u,onClose:l,onClear:c},{type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:">"===(null==t?void 0:t.operator)?t.value:null,operator:">",onKeydown:d,onChange:u,onClose:l,onClear:c}]}getPopupNumberItems(e,t,r,n,i,s,o){const a=this,l=s;function c(){a.store.removeFilter(n)}function d({event:e}){"Enter"===e.key&&s()}function u({source:e,value:t}){null==t?c():(a.clearSiblingsFields(e),a.applyFilter({property:n,operator:e.operator,value:t}))}return[{type:"number",placeholder:"L{Filter.equals}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==t?void 0:t.operator)?t.value:r,onKeydown:d,operator:"=",onChange:u,onEsc:l,onClear:c},{type:"number",placeholder:"L{lessThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==t?void 0:t.operator)?t.value:null,onKeydown:d,operator:"<",onChange:u,onEsc:l,onClear:c},{type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==t?void 0:t.operator)?t.value:null,onKeydown:d,operator:">",onChange:u,onEsc:l,onClear:c}]}clearSiblingsFields(e){var t;null===(t=this.filterEditorPopup)||void 0===t||t.items.forEach((t=>{t!==e&&(null==t||t.clear())}))}getPopupDurationItems(e,t,r,n,i,s,o){const a=this,l=s,c=o;function d({source:e,value:t}){null==t?o():(a.applyFilter({property:n,operator:e.operator,value:t}),s())}return[{type:"duration",placeholder:"L{Filter.equals}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==t?void 0:t.operator)?t.value:r,operator:"=",onChange:d,onEsc:l,onClear:c},{type:"duration",placeholder:"L{lessThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==t?void 0:t.operator)?t.value:null,operator:"<",onChange:d,onEsc:l,onClear:c},{type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==t?void 0:t.operator)?t.value:null,operator:">",onChange:d,onEsc:l,onClear:c}]}getPopupStringItems(e,t,r,n,i,s,o,a){const l=this;return[ObjectHelper.assign({type:e,cls:"b-last-row",placeholder:"L{filter}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t?t.value||t:r,onChange:({value:e})=>{""===e?o():(l.applyFilter({property:n,value:e}),s())},onClose:s,onClear:o},a)]}getPopupItems(e,t,r,n,i,s,o,a){switch(e){case"date":return this.getPopupDateItems(...arguments);case"number":return this.getPopupNumberItems(...arguments);case"duration":return this.getPopupDurationItems(...arguments);default:return this.getPopupStringItems(...arguments)}}showFilterEditor(e,t){const r=this,{store:n}=r,i="string"==typeof e?r.grid.columns.getById(e):e,s=i.element,o=n.modelClass.fieldMap[i.field],a=n.filters.getBy("property",i.field),l=i.filterType,c=l?fieldTypeMap[l]:fieldTypeMap[i.type]||o&&fieldTypeMap[o.type]||"text";if(!1===i.filterable)return;r.closeFilterEditor();const d=r.getPopupItems(c,a,t,i.field,r.store,r.closeFilterEditor,(()=>{r.store.removeFilter(i.field),r.closeFilterEditor()}),i.filterable.filterField);d.forEach((e=>e.placeholder=this.L(e.placeholder))),r.filterEditorPopup=WidgetHelper.openPopup(s,{owner:this.grid,width:"16em",cls:"b-filter-popup",scrollAction:"realign",items:d})}closeFilterEditor(){var e;null===(e=this.filterEditorPopup)||void 0===e||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}populateCellMenuWithDateItems({column:e,record:t,items:r}){const n=e.field,i=t.getFieldDefinition(n);if("date"===(e.filterType||(null==i?void 0:i.type)||e.type)){const i=this,s=t[n],o=t=>{i.applyFilter({property:n,operator:t,value:s,displayValue:e.formatValue?e.formatValue(s):s})};r.filterDateEquals={text:"L{on}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterDateEquals",weight:300,disabled:i.disabled,onItem:()=>o("=")},r.filterDateBefore={text:"L{before}",localeClass:i,icon:"b-fw-icon b-icon-filter-before",name:"filterDateBefore",weight:310,disabled:i.disabled,onItem:()=>o("<")},r.filterDateAfter={text:"L{after}",localeClass:i,icon:"b-fw-icon b-icon-filter-after",name:"filterDateAfter",weight:320,disabled:i.disabled,onItem:()=>o(">")}}}populateCellMenuWithNumberItems({column:e,record:t,items:r}){const n=e.field,i=t.getFieldDefinition(n);if("number"===(e.filterType||e.type||(null==i?void 0:i.type))){const e=this,i=t[n],s=t=>{e.applyFilter({property:n,operator:t,value:i})};r.filterNumberEquals={text:"L{equals}",localeClass:e,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterNumberEquals",weight:300,disabled:e.disabled,onItem:()=>s("=")},r.filterNumberLess={text:"L{lessThan}",localeClass:e,icon:"b-fw-icon b-icon-filter-less",name:"filterNumberLess",weight:310,disabled:e.disabled,onItem:()=>s("<")},r.filterNumberMore={text:"L{moreThan}",localeClass:e,icon:"b-fw-icon b-icon-filter-more",name:"filterNumberMore",weight:320,disabled:e.disabled,onItem:()=>s(">")}}}populateCellMenuWithDurationItems({column:e,record:t,items:r}){const n=e.field,i=t.getFieldDefinition(n);if("duration"===(e.filterType||(null==i?void 0:i.type)||e.type)){const e=this,i=t[n],s=t=>{e.applyFilter({property:n,operator:t,value:i})};r.filterDurationEquals={text:"L{equals}",localeClass:e,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterDurationEquals",weight:300,disabled:e.disabled,onItem:()=>s("=")},r.filterDurationLess={text:"L{lessThan}",localeClass:e,icon:"b-fw-icon b-icon-filter-less",name:"filterDurationLess",weight:310,disabled:e.disabled,onItem:()=>s("<")},r.filterDurationMore={text:"L{moreThan}",localeClass:e,icon:"b-fw-icon b-icon-filter-more",name:"filterDurationMore",weight:320,disabled:e.disabled,onItem:()=>s(">")}}}populateCellMenuWithStringItems({column:e,record:t,items:r}){const n=e.field,i=t.getFieldDefinition(n),s=e.filterType||(null==i?void 0:i.type)||e.type;if(!/(date|number|duration)/.test(s)){const e=this,i=t[n];r.filterStringEquals={text:"L{equals}",localeClass:e,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterStringEquals",weight:300,disabled:e.disabled,onItem:()=>e.applyFilter({property:n,value:i})}}}populateCellMenu({column:e,record:t,items:r}){const n=this;!1!==e.filterable&&(n.populateCellMenuWithDateItems(...arguments),n.populateCellMenuWithNumberItems(...arguments),n.populateCellMenuWithDurationItems(...arguments),n.populateCellMenuWithStringItems(...arguments),e.meta.isFiltered&&(r.filterRemove={text:"L{removeFilter}",localeClass:n,icon:"b-fw-icon b-icon-clear",cls:"b-separator",weight:400,name:"filterRemove",disabled:n.disabled,onItem:()=>n.store.removeFilter(e.field)}))}populateHeaderMenu({column:e,items:t}){const r=this;e.meta.isFiltered?(t.editFilter={text:"L{editFilter}",localeClass:r,name:"editFilter",weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:r.disabled,onItem:()=>r.showFilterEditor(e)},t.removeFilter={text:"L{removeFilter}",localeClass:r,name:"removeFilter",weight:110,icon:"b-fw-icon b-icon-remove",disabled:r.disabled,onItem:()=>r.store.removeFilter(e.field)}):!1!==e.filterable&&(t.filter={text:"L{filter}",localeClass:r,name:"filter",weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:r.disabled,onItem:()=>r.showFilterEditor(e)})}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick(e){const t=e.target;if(this.filterEditorPopup&&this.closeFilterEditor(),t.classList.contains("b-filter-icon")){const e=DomHelper.up(t,".b-grid-header");return this.showFilterEditor(e.dataset.columnId),!1}}}Filter._$name="Filter",GridFeatureManager.registerFeature(Filter);class FilterBar extends InstancePlugin{static get $name(){return"FilterBar"}static get defaultConfig(){return{keyStrokeFilterDelay:300,clearStoreFiltersOnHide:!0}}construct(e,t){if(e.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const r=this;Object.assign(r,{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSupended:0,grid:e}),r.onColumnFilterFieldChange=r.onColumnFilterFieldChange.bind(r),super.construct(e,Array.isArray(t)?{filter:t}:t),r.bindStore(e.store),r.filter&&e.store.filter(r.filter),r.gridDetacher=e.on("beforeelementclick",r.onBeforeElementClick,r)}bindStore(e){this.detachListeners("store"),e.on({name:"store",filter:"onStoreFilter",thisObj:this})}doDestroy(){var e;this.destroyFilterBar(),null===(e=this.gridDetacher)||void 0===e||e.call(this),super.doDestroy()}doDisable(e){const{columns:t}=this.grid;null==t||t.forEach((t=>{const r=this.getColumnFilterField(t);r&&(r.disabled=e)})),super.doDisable(e)}static get pluginConfig(){return{before:["onElementKeyDown"],chain:["renderHeader","populateHeaderMenu","bindStore"]}}destroyFilterBar(){var e;null===(e=this.grid.columns)||void 0===e||e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var e;const t=this;t.clearStoreFiltersOnHide&&t.suspendStoreTracking(),null===(e=t.grid.columns)||void 0===e||e.forEach((e=>t.hideColumnFilterField(e,!0))),t.grid.store.filter(),t.clearStoreFiltersOnHide&&t.resumeStoreTracking(),t.hidden=!0}showFilterBar(){this.renderFilterBar(),this.hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(){this.grid.columns.visibleColumns.forEach((e=>this.renderColumnFilterField(e))),this.rendered=!0}renderColumnFilterField(e){const t=this,r=t.grid,n=t.getColumnFilterable(e);if(n&&!e.hidden){const i=e.element;let s=t.getColumnFilterField(e);if(s)t.onColumnFilterFieldChange({source:s,value:s.value}),s.render(i),s.show();else{const o=r.store.filters.getBy("property",e.field),a=(e.filterType||"text")+"field";s=WidgetHelper.append(Object.assign({type:a,owner:t.grid,clearable:!0,column:e,name:e.field,value:o&&!o._filterBy&&t.buildFilterString(o),cls:t.filterFieldCls,inputCls:t.filterFieldInputCls,keyStrokeChangeDelay:t.keyStrokeFilterDelay,onChange:t.onColumnFilterFieldChange,onClear:t.onColumnFilterFieldChange,disabled:t.disabled},n.filterField),i)[0],t.setColumnFilterField(e,s)}i.classList.add(t.filterableColumnCls)}}updateColumnFilterFields(){const{columns:e,store:t}=this.grid;let r,n;for(const i of e)r=this.getColumnFilterField(i),r&&(n=t.filters.getBy("property",i.field),n?n._filterBy||(r.value=this.buildFilterString(n)):r.value="")}getColumnFilterable(e){if(!e.isRoot&&!1!==e.filterable&&e.field)return"function"==typeof e.filterable&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e),t.destroy(),this.setColumnFilterField(e,void 0))}hideColumnFilterField(e,t){const r=this,{store:n}=r.grid,i=e.element,s=r.getColumnFilterField(e);s&&(s.hide(),r.clearStoreFiltersOnHide&&e.field&&n.removeFilter(e.field,t),null==i||i.classList.remove(r.filterableColumnCls))}getColumnFilterField(e){var t;return null===(t=this._columnFilters)||void 0===t?void 0:t[e.data.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e){const t=String(e).match(this.filterParseRegExp);return{operator:t[1]||"*",value:t[2]}}buildFilterString(e){return("*"===e.operator?"":e.operator)+e.value}onStoreFilter(){!this.storeTrackingSupended&&this.rendered&&this.updateColumnFilterFields()}suspendStoreTracking(){this.storeTrackingSupended++}resumeStoreTracking(){this.storeTrackingSupended--}renderHeader(){this.hidden||this.renderFilterBar()}onElementKeyDown(e){if(!e.handled&&e.target.matches(this.filterFieldInputSelector))switch(e.key){case"ArrowLeft":case"ArrowRight":e.handled=!0}}onBeforeElementClick({event:e}){if(e.target.closest("."+this.filterFieldCls))return!1}onColumnFilterFieldChange({source:e,value:t}){const r=this,{store:n}=r.grid,i=r.getColumnFilterable(e.column);r.suspendStoreTracking(),null==t||""===t||Array.isArray(t)&&0===t.length?n.removeFilter(e.name):i.filterFn?n.filter({filterBy:r=>i.filterFn({property:e.name,value:t,record:r}),property:e.name}):n.filter(Object.assign({property:e.name},r.parseFilterValue(t))),r.resumeStoreTracking()}populateHeaderMenu({items:e}){e.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,name:"toggleFilterBar",weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}}FilterBar.featureClass="b-filter-bar",FilterBar._$name="FilterBar",GridFeatureManager.registerFeature(FilterBar);var SummaryFormatter=e=>class extends(e||Base){static get $name(){return"SummaryFormatter"}generateHtml(e,t,r){const n=this.store,i=e.summaries||(e.sum?[{sum:e.sum,renderer:e.summaryRenderer}]:[]);let s=`<table class="${r}">`;return i.forEach((r=>{let i=r.sum,o=null;switch(!0===i&&(i="sum"),i){case"sum":case"add":o=n.sum(e.field,t);break;case"max":o=n.max(e.field,t);break;case"min":o=n.min(e.field,t);break;case"average":case"avg":o=n.average(e.field,t);break;case"count":o=t.length;break;case"countNotEmpty":o=t.reduce(((t,r)=>t+(null!=r[e.field]?1:0)),0)}if("function"==typeof i&&(o=t.reduce(i,"seed"in r?r.seed:0)),null!==o){const e="b-grid-summary-value",t=r.label?`<td class="b-grid-summary-label">${r.label}</td>`:"";let n,i=r.renderer?r.renderer({config:r,sum:o}):o;null==i&&(i=""),n=String(i).includes("<td>")?i:t?`${t}<td class="${e}">${i}</td>`:`<td colspan="2" class="${e}">${i}</td>`,s+=`<tr>${n}</tr>`}})),s+"</table>"}};class GroupSummary extends(SummaryFormatter(InstancePlugin)){static get $name(){return"GroupSummary"}static get configurable(){return{collapseToHeader:null}}construct(e,t){if(this.grid=e,super.construct(e,t),!e.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(e.store),e.rowManager.on({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}bindStore(e){this.detachListeners("store"),e.on({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}get store(){return this.grid.store}doDisable(e){this.store.useGroupFooters=!e,this.isConfiguring||this.store.group(),super.doDisable(e)}static get pluginConfig(){return{chain:["bindStore"]}}onBeforeRenderRow({row:e,record:t}){e.isGroupFooter&&!("groupFooterFor"in t.meta)?(e.isGroupFooter=!1,e.removeCls("b-group-footer"),e.forceInnerHTML=!0):e.isGroupHeader&&!t.meta.collapsed&&(e.removeCls("b-header-summary"),e.eachElement(this.removeSummaryElements))}removeSummaryElements(e){const t=e.querySelector(".b-timeaxis-group-summary");null==t||t.remove()}renderCell({column:e,cellElement:t,rowElement:r,row:n,record:i,size:s,isFirstColumn:o}){const a=this,{meta:l}=i,c="groupRowFor"in l,d="groupFooterFor"in l;if(a.store.isGrouped&&(d||a.collapseToHeader&&c&&l.collapsed&&!o)){const o=c?i:l.groupRecord;n.isGroupFooter=d,n.isGroupHeader=c,d?r.classList.add("b-group-footer"):r.classList.add("b-header-summary");const u=a.updateSummaryHtml(t,e,o),h="number"==typeof u?u:u.count;h>1&&(s.height=a.grid.rowHeight+h*a.grid.rowHeight*.1),u.height&&(s.height+=u.height)}}updateSummaryHtml(e,t,r){const n=r.groupChildren.slice();n.pop();const i=this.generateHtml(t,n,"b-grid-group-summary");return e.children.length?DomHelper.sync(i,e.firstElementChild):e.innerHTML=i,t.summaries?t.summaries.length:t.sum?1:0}onStoreUpdate({source:e,changes:t}){if(!this.disabled&&e.isGrouped){if(t&&e.groupers.find((e=>e.field in t)))return;Object.keys(t).some((e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}))&&(this.grid.forceFullRefresh=!0)}}}GroupSummary.featureClass="b-group-summary",GroupSummary._$name="GroupSummary",GridFeatureManager.registerFeature(GroupSummary);class Summary extends(SummaryFormatter(InstancePlugin)){static get $name(){return"Summary"}construct(e,t){this.grid=e,super.construct(e,t),this.bindStore(e.store),e.hideFooters=!1}bindStore(e){this.detachListeners("store"),e.on({name:"store",change:"onStoreChange",thisObj:this})}get store(){return this.grid.store}doDestroy(){super.doDestroy()}doDisable(e){super.doDisable(e),e?this.grid.element.classList.add("b-summary-disabled"):(this.updateSummaries(),this.grid.element.classList.remove("b-summary-disabled"))}static get pluginConfig(){return{chain:["renderRows"]}}renderRows(){this.updateSummaries()}updateSummaries(){const e=this,{grid:t,store:r}=e,n=DomHelper.children(t.element,".b-grid-footer"),i=r.storage.values.filter((e=>!e.isSpecialRow));t.columns.forEach((e=>{e.summaries&&e.summaries.forEach((e=>{"seed"in e&&("initialSeed"in e||(e.initialSeed=e.seed),["number","string","date"].includes(typeof e.initialSeed)?e.seed=e.initialSeed:e.seed=Object.assign({},e.initialSeed))}))})),n.forEach((r=>{if(!r.dataset.column)return;const n=t.columns.get(r.dataset.column),s=e.generateHtml(n,i,"b-grid-footer-summary");(n.summaries?n.summaries.length:!!n.sum)&&(r.children.length?DomHelper.sync(s,r.firstElementChild):r.innerHTML=s)}))}onStoreChange({action:e,changes:t}){let r=!0;this.disabled||("update"===e&&(r=Object.keys(t).some((e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}))),r&&this.updateSummaries())}}Summary.featureClass="b-summary",Summary._$name="Summary",GridFeatureManager.registerFeature(Summary);class Group extends InstancePlugin{static get $name(){return"Group"}static get defaultConfig(){return{field:null,renderer:null}}construct(e,t){const r=this;e.features.tree||(r._thisIsAUsedExpression(e.features.groupSummary),t=r.processConfig(t),r.grid=e,r.rowManager=e.rowManager,super.construct(e,t),r.bindStore(e.store),r.rowManager.on({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:r}))}processConfig(e){return"string"==typeof e?{field:e,ascending:null}:e}setConfig(e){null===e?this.store.clearGroupers():super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.on({name:"store",group:"onStoreGroup",thisObj:this})}set renderer(e){this.groupRenderer=e}set field(e){this._field=e,this.store.group(e,this.ascending)}get field(){return this._field}doDestroy(){super.doDestroy()}doDisable(e){const{store:t}=this;if(e&&t.isGrouped){const{sorters:e}=t;e.unshift(...t.groupers),t.clearGroupers(),t.sort(e)}super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","onElementKeyDown","bindStore"]}}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,r=!1){const n=this,i=n.store,s=i.getById(e),o=s.meta;void 0!==o.groupRowFor&&((t=void 0===t?!o.collapsed:t)?i.excludeGroupRecords(s):i.includeGroupRecords(s),o.collapsed=t,n.grid.trigger("toggleGroup",{groupRecord:s,collapse:t}),r||n.rowManager.renderFromRecord(s))}collapseAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!0,!0))),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!1,!0))),e.grid.refreshRows())}onBeforeRenderRow({row:e,record:t}){const r=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||r&&"groupRowFor"in r.meta}renderCell(e){const t=this;if(!t.store.isGrouped||t.disabled)return;const{cellElement:r,rowElement:n,column:i}=e,s=t.grid,o=e.record.meta,a=s.columns.visibleColumns[0],l=s.subGrids[s.regions[0]].columns.visibleColumns;if("groupRowFor"in o){if("action"===i.type)return;i.clearCell(r),n.classList[o.collapsed?"add":"remove"]("b-grid-group-collapsed"),n.classList.add("b-group-row"),("rownumber"===a.type&&i===l[1]||"rownumber"!==a.type&&i===l[0])&&r.classList.add("b-group-title"),t.buildGroupHeader(e)}else r===n.firstElementChild&&(n.classList.remove("b-group-row"),n.classList.remove("b-grid-group-collapsed"),r.classList.remove("b-group-title"))}buildGroupHeader(e){const t=this,{record:r,cellElement:n,column:i,persist:s}=e,o=t.grid,a=r.meta,l=a.childCount-(o.features.groupSummary?1:0),c=o.columns.visibleColumns[0],d=i&&o.subGrids[o.regions[0]].columns.visibleColumns,u=e.isFirstColumn="rownumber"===c.type&&i===d[1]||"rownumber"!==c.type&&i===d[0];let h=null,g=!0;if(s||i){const n=o.columns.get(a.groupField);(null==n?void 0:n.groupRenderer)?u&&(h=n.groupRenderer(Object.assign({},e,{groupRowFor:a.groupRowFor,groupRecords:r.groupChildren,groupColumn:n,count:l})),g=!1):t.groupRenderer&&(h=t.groupRenderer(Object.assign({},e,{groupRowFor:a.groupRowFor,groupRecords:r.groupChildren,groupColumn:n,count:l,isFirstColumn:u}))),u&&null==h&&g&&(h=`${"__novalue__"===a.groupRowFor?"":a.groupRowFor} (${l})`)}else t.groupRenderer&&(h=t.groupRenderer(e));return"string"==typeof h?n.innerHTML=h:"object"==typeof h&&DomSync.sync({targetElement:n,domConfig:{onlyChildren:!0,children:Array.isArray(h)?h:[h]}}),n.childElementCount>0&&(n._hasHtml=!0),n.innerHTML}renderHeader(e){const{store:t,grid:r}=this;if(t.isGrouped)for(const e of t.groupers){const t=r.columns.get(e.field),n=t&&r.getHeaderElement(t.id);n&&(n.classList.add("b-group"),n.classList.add(e.ascending?"b-asc":"b-desc"))}}populateHeaderMenu({column:e,items:t}){const r=this;!1!==e.groupable&&(t.groupAsc={text:"L{groupAscending}",localeClass:r,icon:"b-fw-icon b-icon-group-asc",name:"groupAsc",cls:"b-separator",weight:400,disabled:r.disabled,onItem:()=>r.store.group(e.field,!0)},t.groupDesc={text:"L{groupDescending}",localeClass:r,icon:"b-fw-icon b-icon-group-desc",name:"groupDesc",weight:410,disabled:r.disabled,onItem:()=>r.store.group(e.field,!1)}),r.store.isGrouped&&(t.groupRemove={text:"L{stopGrouping}",localeClass:r,icon:"b-fw-icon b-icon-clear",name:"groupRemove",cls:e.groupable?"":"b-separator",weight:420,disabled:r.disabled,onItem:()=>r.store.clearGroupers()})}getColumnDragToolbarItems(e,t){var r;const n=this,i=n.store;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:n,icon:"b-icon b-icon-group-asc",name:"groupAsc",cls:"b-separator",weight:110,disabled:n.disabled,onDrop:({column:e})=>i.group(e.field,!0)}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:n,icon:"b-icon b-icon-group-desc",name:"groupDesc",weight:110,disabled:n.disabled,onDrop:({column:e})=>i.group(e.field,!1)});const s=(null===(r=i.groupers)||void 0===r?void 0:r.some((t=>t.field===e.field)))&&!n.disabled;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:n,icon:"b-icon b-icon-clear",name:"groupRemove",disabled:!s,weight:110,onDrop:({column:e})=>i.removeGrouper(e.field)}),t}onStoreGroup({groupers:e}){const{grid:t}=this,{element:r}=t,n=r&&DomHelper.children(r,".b-grid-header.b-group");if(r){for(const e of n)DomHelper.removeClasses(e,["b-group","b-asc","b-desc"]);if(e)for(const r of e){const e=t.getHeaderElementByField(r.field);e&&DomHelper.addClasses(e,["b-group",r.ascending?"b-asc":"b-desc"])}}}onElementTouchStart(e){const t=this,r=e.target,n=DomHelper.up(r,".b-grid-header"),i=n&&t.grid.getColumnFromElement(n);e.touches.length>1&&i&&!1!==i.groupable&&!t.disabled&&t.store.group(i.field)}onElementClick(e){const t=this,{store:r}=t,{target:n}=e,i=DomHelper.up(n,".b-group-row"),s=DomHelper.up(n,".b-grid-header"),o=null==s?void 0:s.dataset.column;if(!(n.classList.contains("b-resizer")||t.disabled||n.classList.contains("b-action-item"))){if(s&&o){var a;const n=null===(a=r.groupers)||void 0===a?void 0:a.find((e=>e.field===o));if(n&&!e.shiftKey)return r.group(o,!n.ascending),!1;if(e.shiftKey){!1!==t.grid.columns.get(o).groupable&&(e.altKey?r.removeGrouper(o):r.group(o))}e.preventDefault()}return i?(t.internalToggleCollapse(DomDataStore.get(i).id),!1):void 0}}onElementKeyDown(e){const t=this;!t.disabled&&t.store.isGrouped&&e.target===t.grid.focusElement&&" "===e.key&&t.grid.focusedCell&&(e.preventDefault(),t.internalToggleCollapse(t.grid.focusedCell.id))}}Group._$name="Group",GridFeatureManager.registerFeature(Group,!0,["Grid","Scheduler"]);class HeaderMenu extends ContextMenuBase{static get $name(){return"HeaderMenu"}static get defaultConfig(){return{type:"header",_showForTimeAxis:!1}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateHeaderMenu"),e}onElementKeyDown(e){if(!e.handled&&e.target.matches(".b-grid-header.b-depth-0"))switch(e.key){case" ":this.internalShowContextMenu(this.createContextMenuEventForElement(e.target))}}shouldShowMenu(e){const{column:t}=e;return t&&!1!==t.enableHeaderContextMenu&&(this._showForTimeAxis||t!==this.client.timeAxisColumn)}showContextMenu({column:e}){super.showContextMenu(...arguments),e===this.client.timeAxisColumn&&this.menu&&(this.menu.scrollAction="realign")}getDataFromEvent(e){return ObjectHelper.assign(super.getDataFromEvent(e),this.client.getHeaderDataFromEvent(e))}populateHeaderMenu({items:e,column:t}){return(null==t?void 0:t.headerMenuItems)&&(Array.isArray(t.headerMenuItems)&&VersionHelper.deprecate("Grid","5.0.0","`headerMenuItems` column config specified as an array is deprecated, need to specify the config as a named object. Please see https://bryntum.com/docs/grid/#guides/upgrades/4.0.0.md for more information."),ObjectHelper.merge(e,t.headerMenuItems)),e}}HeaderMenu.featureClass="",HeaderMenu._$name="HeaderMenu",GridFeatureManager.registerFeature(HeaderMenu,!0);class QuickFind extends InstancePlugin{static get $name(){return"QuickFind"}static get defaultConfig(){return{mode:"header",find:""}}static get pluginConfig(){return{chain:["onElementKeyDown","onElementKeyPress","onCellNavigate"]}}construct(e,t){this.grid=e,super.construct(e,t)}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}showQuickFind(){const e=this,t=e.grid.getHeaderElement(e.columnId);if(t){if(!e.headerField){const[r,n,i]=DomHelper.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},!0);"header"===e.mode?t.appendChild(r):(r.className+=" b-quick-hit-mode-grid",e.grid.element.appendChild(r)),e.headerField={header:r,field:n,badge:i,colHeader:t}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,t.classList.add("b-quick-find-header"),e.renderListenerInitialized||(e.grid.rowManager.on({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}}hideQuickFind(){const e=this,{grid:t,headerField:r}=e;for(const r of e.prevFound||e.found){const n=t.getRowById(r.id);if(n){const t=n.getCell(e.columnId);t._content=null,n.renderCell(t,r.data)}}r&&(r.header.parentNode.removeChild(r.header),r.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(t.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),t.trigger("hideQuickFind")}search(e,t=this.columnId){const r=this,{grid:n,currentColumn:i}=r,s=n.columns.getById(t)||n.columns.get(t),o=r.store.findByField(s.field,e);let a=1;Object.assign(r,{foundMap:{},prevFound:r.found,found:o,find:e,columnId:s.id}),e?r.showQuickFind():r.hideQuickFind(),i&&i!==s&&(i.disableHtmlEncode=!1);for(const e of DomHelper.children(n.element,".b-quick-hit")){e.classList.remove("b-quick-hit"),e.classList.remove("b-quick-hit-cell");const t=DomDataStore.get(e).row;e._content=null,t.renderCell(e)}if(s.disableHtmlEncode=!0,r.currentColumn=s,o){o.length>0&&r.gotoClosestHit(n.focusedCell,o);for(const e of o){r.foundMap[e.id]=a++;const t=n.getRowById(e.data.id);if(t&&t.renderCell(t.getCell(s.id)),a>1e3)break}n.trigger("quickFind",{find:e,found:o})}}clear(){var e;(null===(e=this.found)||void 0===e?void 0:e.length)&&this.search("")}get foundCount(){var e,t;return null!==(e=null===(t=this.found)||void 0===t?void 0:t.length)&&void 0!==e?e:0}gotoHit(e){const t=this.found[e];return t&&this.grid.focusCell({columnId:this.columnId,id:t.id}),!!t}gotoClosestHit(e,t){const r=e?this.grid.store.indexOf(e.id):0,n=t.slice().sort(((e,t)=>Math.abs(e.index-r)-Math.abs(t.index-r)));this.gotoHit(t.indexOf(n[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){var e;const t=this,{grid:r}=t,n=r._focusedCell?r._focusedCell.id:null===(e=r.lastFocusedCell)||void 0===e?void 0:e.id,i=r.store.indexOf(n)||0,s=t.found.find((e=>e.index>i));s?r.focusCell({columnId:t.columnId,id:s.id}):t.gotoFirstHit()}gotoPrevHit(){var e;const t=this,{grid:r,found:n}=t,i=r._focusedCell?r._focusedCell.id:null===(e=r.lastFocusedCell)||void 0===e?void 0:e.id,s=r.store.indexOf(i)||0;let o;if(n.length){for(let e=n.length-1;e--;e>=0)if(n[e].index<s){o=n[e];break}o?r.focusCell({columnId:t.columnId,id:o.id}):t.gotoLastHit()}}renderCell(e){var t;const r=this,n=e.cellElement,i=r.columnId===e.column.id&&(null===(t=r.foundMap)||void 0===t?void 0:t[e.record.id]);if(i){const t=e.column.htmlEncode||e.column.shouldHtmlEncode;if(n.classList.add("b-quick-hit"),t){var s;let e=DomHelper.down(n,".b-grid-cell-value,.b-tree-cell-value")||n,t=e.innerText,o=null===(s=t)||void 0===s?void 0:s.toLowerCase().indexOf(r.find.toLowerCase());if(o>-1){const n=o+r.find.length,s=t.slice(o,n);let a="";" "===t[o-1]&&(a="&nbsp;"),t=t.slice(0,o)+`<span class="b-quick-hit-text">${a}${s}</span>`+t.slice(n),e.innerHTML=t+`<div class="b-quick-hit-cell-badge">${i}</div>`}else n.classList.add("b-quick-hit-cell")}else n.classList.add("b-quick-hit-cell")}}onElementKeyDown(e){const t=this,r=t.grid.features.filter;t.disabled||DomHelper.up(e.target,BrowserHelper.isIE11?".b-widget:not(.b-grid-subgrid):not(.b-grid)":".b-widget:not(.b-grid)")||t.find.length>0&&("Backspace"===e.key?(e.preventDefault(),t.find=t.find.substr(0,t.find.length-1),t.search(t.find)):"Escape"===e.key?(e.preventDefault(),t.find="",t.search(t.find)):"F3"===e.key||"g"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),e.shiftKey?t.gotoPrevHit():t.gotoNextHit()):r&&t.columnId&&t.foundCount&&e.ctrlKey&&e.shiftKey&&"F"===e.key&&(t.clear(),r.showFilterEditor(t.grid.columns.getById(t.columnId),t.find)))}onElementKeyPress(e){const t=this,{grid:r}=t;if(!t.disabled&&!DomHelper.up(e.target,BrowserHelper.isIE11?".b-widget:not(.b-grid-subgrid):not(.b-grid)":".b-widget:not(.b-grid)")&&"Enter"!==e.key&&r._focusedCell){const i=r.columns.getById(r._focusedCell.columnId);var n;if(i&&!1!==i.searchable)t.columnId=r._focusedCell.columnId,1===(null===(n=e.key)||void 0===n?void 0:n.length)&&(t.find+=e.key,t.search(t.find))}}onCellNavigate(e,t,r){const n=this;!(n.prevFound||n.found)||r&&r.columnId===n.columnId||n.clear()}}QuickFind._$name="QuickFind",GridFeatureManager.registerFeature(QuickFind);class RegionResize extends InstancePlugin{static get $name(){return"RegionResize"}construct(e,t){this.grid=e,super.construct(e,t)}doDestroy(){super.doDestroy()}static get pluginConfig(){return{chain:["onElementTouchStart","onElementTouchMove","onElementTouchEnd","onElementMouseDown","onElementMouseMove","onElementDblClick","onElementMouseUp","onSubGridCollapse","onSubGridExpand","render"]}}onElementDblClick(e){const t=this,r=t.grid,n=DomHelper.up(e.target,".b-grid-splitter-collapsed");if(n&&!t.expanding){t.expanding=!0;let e=n.dataset.region,i=r.getSubGrid(e);i.collapsed||(e=r.getLastRegions()[1],i=r.getSubGrid(e)),i.expand().then((()=>t.expanding=!1))}}startMove(e,t){const{grid:r}=this,n=e.dataset.region,i=r.element,s=r.regions[r.regions.indexOf(n)+1],o=r.getSubGrid(s),a=r.getSubGrid(n);let l=a,c=1;if(null!=l.flex&&null==o.flex&&(l=o,c=-1),e.classList.contains("b-grid-splitter-collapsed"))return;const d=l.element.offsetWidth+o.element.offsetWidth;this.dragContext={element:e,headerEl:l.header.element,subGridEl:l.element,subGrid:l,splitterSubGrid:a,originalWidth:l.element.offsetWidth,originalX:t,minWidth:l.minWidth||0,maxWidth:Math.min(d,l.maxWidth||d),flip:c},i.classList.add("b-moving-splitter"),a.toggleSplitterCls("b-moving")}endMove(){const e=this.dragContext;e&&(this.grid.element.classList.remove("b-moving-splitter"),e.splitterSubGrid.toggleSplitterCls("b-moving",!1),this.dragContext=null)}onCollapseClick(e,t){const r=this.grid,n=t.dataset.region,i=r.getLastRegions();if(i[0]===n){const e=r.getSubGrid(i[1]);if(e.collapsed)return void e.expand()}e.collapse()}onExpandClick(e,t){const r=this.grid,n=t.dataset.region,i=r.getLastRegions();if(i[0]!==n||e.collapsed)e.expand();else{r.getSubGrid(i[1]).collapse()}}updateMove(e){const{dragContext:t}=this;if(t){const r=e-t.originalX,n=Math.min(t.maxWidth,t.originalWidth+r*t.flip);t.subGrid.width=Math.max(n,t.minWidth)}}onElementTouchStart(e){const t=e.target.closest(".b-grid-splitter");t&&this.startMove(t,e.touches[0].clientX)}onElementTouchMove(e){this.dragContext&&(this.updateMove(e.touches[0].clientX),e.preventDefault())}onElementTouchEnd(e){this.dragContext&&(this.endMove(),e.preventDefault())}onElementMouseDown(e){const t=this,r=e.target,n=r.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),i=n&&t.grid.getSubGrid(n.dataset.region);0===e.button&&(r.classList.contains("b-grid-splitter")||r.classList.contains("b-grid-splitter-inner")?t.startMove(n,e.clientX):r.classList.contains("b-icon-collapse-gridregion")?t.onCollapseClick(i,n):r.classList.contains("b-icon-expand-gridregion")&&t.onExpandClick(i,n))}onElementMouseMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementMouseUp(e){this.dragContext&&(this.endMove(),e.preventDefault())}onSubGridCollapse(e){const t=this.grid.resolveSplitter(e);this.grid.getLastRegions()[1]===e.region&&t.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand(e){this.grid.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}render(){const{regions:e,subGrids:t}=this.grid;e.length>2&&(t[e[0]].splitterElement.classList.add("b-left-only"),t[e[1]].splitterElement.classList.add("b-right-only"))}}RegionResize.featureClass="b-split",RegionResize._$name="RegionResize",GridFeatureManager.registerFeature(RegionResize);class RowReorder extends(Delayable(InstancePlugin)){static get $name(){return"RowReorder"}static get defaultConfig(){return{hoverExpandTimeout:1e3,finalizeDelay:300}}construct(e,t){this.grid=e,super.construct(...arguments)}doDestroy(){var e;null===(e=this.dragHelper)||void 0===e||e.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e;e.dragHelper=new DragHelper({name:"rowReorder",mode:"translateXY",cloneTarget:!0,dragThreshold:10,targetSelector:".b-grid-row",lockX:!0,transitionDuration:t.transitionDuration,scrollManager:t.scrollManager,dragWithin:t.verticalScroller,outerElement:t.verticalScroller,ignoreSamePositionDrop:!1,createProxy(e){const r=e.cloneNode(!0),n=document.createElement("div");if(r.removeAttribute("id"),r.style.transform="",n.appendChild(r),t.selectedRecords.length>1){const e=r.cloneNode(!0);e.classList.add("b-row-dragging-multiple"),n.appendChild(e)}return DomHelper.removeClsGlobally(n,"b-selected","b-hover","b-focused"),n},listeners:{beforedragstart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,reset:e.onReset,prio:1e4,thisObj:e}}),e.dropIndicator=DomHelper.createElement({parent:t.bodyContainer,className:"b-row-drop-indicator"}),e.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow")}static get pluginConfig(){return{after:["render"]}}onBeforeDragStart({context:e}){const t=this.grid,r=t.regions[0],n=t.subGrids[r].element;if(this.disabled||t.readOnly||!n.contains(e.element))return!1;const i=e.records=t.selectedRecords.slice().sort(((e,r)=>t.store.indexOf(e)-t.store.indexOf(r)));return e.startRecord=t.getRecordFromElement(e.element),e.record=e.startRecord,i.length>0&&!i.some((e=>e.isSpecialRow))}onDragStart({context:e}){const t=this,{cellEdit:r,contextMenu:n,cellMenu:i,headerMenu:s}=t.grid.features;r&&(t.cellEditDisabledState=r.disabled,r.disabled=!0),null==n||n.hideContextMenu(!1),null==i||i.hideContextMenu(!1),null==s||s.hideContextMenu(!1),t.grid.element.classList.add("b-row-reordering");const o=e.element.querySelector(".b-focused");null==o||o.classList.remove("b-focused"),DomHelper.removeClasses(e.element.firstElementChild,["b-selected","b-hover"])}onDrag({context:e,event:t}){const r=this,{grid:n}=r,{store:i,rowManager:s}=n,{outerElement:o}=r.dragHelper;if(!o.contains(t.target)||!t.target.closest(".b-grid-subgrid"))return void(e.valid=!1);if(BrowserHelper.isChrome&&!Rectangle.from(o).contains(EventHelper.getPagePoint(t)))return;let a,l,c,d,u=e.valid,h=n.rowManager.getRowAt(t.clientY);if(h){const e=h.top+n._bodyRectangle.y-n.scrollable.y+h.height/2;l=h.dataIndex,a=h&&i.getAt(l),c=t.clientY>e}else l=i.count-1,a=i.last,h=n.rowManager.getRow(l),c=!0;if(a===e.startRecord&&(u=!1),i.tree){if(DomHelper.removeClsGlobally(n.element,"b-row-reordering-target-parent"),d=c?a.nextSibling:a,e.records.some((e=>e.contains(a)))&&(u=!1),e.parent=a.parent,!e.parent.isRoot){const t=s.getRowById(e.parent);t&&t.addCls("b-row-reordering-target-parent")}r.clearTimeout(r.hoverTimer),a&&a.isParent&&!a.isExpanded(i)&&(r.hoverTimer=r.setTimeout((()=>n.expand(a)),r.hoverExpandTimeout))}else d=c?i.getAt(l+1):a;DomHelper.setTranslateY(r.dropIndicator,h.top+(c?h.height:0)),e.insertBefore=d,e.valid=u}async onDrop(e){const t=this,r=e.context;t.trigger("gridRowBeforeDropFinalize",e),r.valid?(r.asyncCleanup=r.async=!0,r.element.classList.add("b-dropping"),t.setTimeout((()=>t.finalizeReorder(r).then((()=>t.trigger("gridRowDrop",e)))),t.finalizeDelay)):t.trigger("gridRowDrop",e)}async finalizeReorder(e){const t=this.grid,r=t.store;let n=e.records;if(e.valid=e.valid&&!n.some((e=>!r.includes(e))),e.valid){let t;r.tree?(n=n.filter((e=>!e.parent||!n.includes(e.parent))),t=await e.parent.tryInsertChild(n,e.insertBefore),e.valid=!1!==t):r.insert(e.insertBefore?r.indexOf(e.insertBefore):r.count,n),r.clearSorters()}e.finalize(e.valid),t.element.classList.remove("b-row-reordering")}onReset(){const e=this,t=e.grid.features.cellEdit;e.grid.element.classList.remove("b-row-reordering"),t&&(t.disabled=e.cellEditDisabledState),DomHelper.removeClsGlobally(e.grid.element,"b-row-reordering-target-parent")}render(){this.init()}}RowReorder.featureClass="",RowReorder._$name="RowReorder",GridFeatureManager.registerFeature(RowReorder,!1),GridFeatureManager.registerFeature(RowReorder,!0,"Gantt");class Search extends InstancePlugin{static get $name(){return"Search"}construct(e,t){super.construct(e,t),Object.assign(this,{grid:e,find:"",hitEls:[]})}doDestroy(){this.clear(!0),super.doDestroy()}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["populateCellMenu","onElementKeyDown"]}}search(e,t=!0,r=!1){var n;const i=this;if(!e)return i.clear();if(!r&&e===i.find||i.disabled)return;const{grid:s,store:o}=i,a=s.columns.visibleColumns.filter((e=>!1!==e.searchable)).map((e=>e.field)),l=o.search(e,a);let c=1;if(Object.assign(i,{foundMap:{},prevFound:i.found,found:l,find:e}),i.clearHits(),l){null===(n=i.hitColumns)||void 0===n||n.forEach((e=>e.disableHtmlEncode=!1)),i.hitColumns=[];for(const e of l){i.foundMap[e.field+"-"+e.id]=c++;const t=s.columns.get(e.field);if(t&&(t.disableHtmlEncode=!0,i.hitColumns.push(t)),c>1e3)break}return i.listenersInitialized||(s.rowManager.on({rendercell:i.renderCell},i),o.on({["refresh"+s.asyncEventSuffix]:i.onStoreRefresh},i),i.listenersInitialized=!0),s.refreshRows(),s.trigger("search",{grid:s,find:e,found:l}),t&&!i.isHitFocused&&i.gotoNextHit(!0),l}}clearHits(){for(const e of DomHelper.children(this.grid.element,".b-search-hit")){e.classList.remove("b-search-hit"),e.classList.remove("b-search-hit-cell");const t=DomDataStore.get(e).row;e._content=null,t.renderCell(e)}}clear(e=!1){const t=this,{grid:r}=t;t.foundMap&&delete t.foundMap,delete t.find,t.clearHits(),t.listenersInitialized&&(r.rowManager.un({rendercell:t.renderCell},t),t.store.un({refresh:t.onStoreRefresh},t),t.listenersInitialized=!1),e||r.trigger("clearSearch",{grid:r})}get foundCount(){var e,t;return null!==(e=null===(t=this.found)||void 0===t?void 0:t.length)&&void 0!==e?e:0}get isHitFocused(){const{grid:e}=this,t=e.focusedCell?e.store.indexOf(e.focusedCell.id):-1,r=e.focusedCell?e.columns.getById(e.focusedCell.columnId):null;return-1!==t&&this.found.some((e=>e.index===t&&r&&e.field===r.field))}gotoNextHit(e=!1){var t;const r=this;if(!(null===(t=r.found)||void 0===t?void 0:t.length))return;const{grid:n}=r,i=n.focusedCell||n.lastFocusedCell,s=i&&!e?n.store.indexOf(i.id):-1,o=r.found.findIndex((e=>e.index>s));-1!==o&&r.gotoHit(o)}gotoPrevHit(){var e;const t=this;if(!(null===(e=t.found)||void 0===e?void 0:e.length))return;const{grid:r,found:n}=t,i=r.focusedCell||r.lastFocusedCell,s=i?r.store.indexOf(i.id):0;for(let e=n.length-1;e--;e>=0){if(n[e].index<s){t.gotoHit(e);break}}}gotoHit(e){const{grid:t}=this,r=this.found[e];return r&&t.focusCell({field:r.field,id:r.id}),Boolean(r)}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:t,record:r,value:n,cellContent:i}){var s;const o=this,a=null===(s=o.foundMap)||void 0===s?void 0:s[t.field+"-"+r.id];if(a){e.classList.add("b-search-hit");const t=DomHelper.down(e,".b-grid-cell-value")||e,r=String(o.find).toLowerCase();if(String(n).toLowerCase()===r)t.innerHTML=`<span class="b-search-hit-text">${i}</span><div class="b-search-hit-cell-badge">${a}</div>`;else{const r=String(o.find).toLowerCase(),n=i&&i.toLowerCase().indexOf(r);if(n>-1){const e=n+r.length,s=i.slice(n,e);t.innerHTML=`${i.slice(0,n)}<span class="b-search-hit-text">${s}</span>${i.slice(e)}<div class="b-search-hit-cell-badge">${a}</div>`}else e.classList.add("b-search-hit-cell")}o.hitEls.push(e)}}populateCellMenu({column:e,record:t,items:r}){const n=this;e.searchable&&(r.search={text:"L{searchForValue}",localeClass:n,icon:"b-fw-icon b-icon-search",cls:"b-separator",name:"search",weight:200,disabled:n.disabled,onItem:()=>{let r=window.getSelection().toString();r||(r=t[e.field]),n.search(r)}})}onElementKeyDown(e){const t=this;t.find&&""!==t.find&&("F3"===e.key||"g"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))&&(e.preventDefault(),e.shiftKey?t.gotoPrevHit():t.gotoNextHit())}onStoreRefresh(){this.search(this.find,!1,!0)}}Search.featureClass="b-search",Search._$name="Search",GridFeatureManager.registerFeature(Search);class Sort extends InstancePlugin{static get $name(){return"Sort"}static get defaultConfig(){return{multiSort:!0,ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){t=this.processConfig(t),this.grid=e,this.bindStore(e.store),super.construct(e,t)}processConfig(e){return"string"==typeof e||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.on({name:"store",sort:"syncHeaderSortState",thisObj:this})}set field(e){const t=this.grid.columns.get(e);t&&"object"==typeof t.sortable&&(t.sortable.field=t.sortable.property||e,e=t.sortable),this.store.sort(e,this.ascending)}doDestroy(){super.doDestroy()}get store(){return this.grid.store}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader"]}}syncHeaderSortState(){const e=this,t={};if(!e.grid.isConfiguring){const n=e.store.sorters,i=n.length,s=new DomClassList;let o;for(let e=0;e<i;e++){const r=n[e];r.field&&(t[r.field]={ascending:r.ascending,sortIndex:e+1})}for(const n of e.grid.columns.bottomColumns){const a=n.element;if(a){var r;const l=null===(r=n.textWrapper)||void 0===r?void 0:r.dataset;(null==l?void 0:l.sortIndex)&&delete l.sortIndex,s.value=a.classList,!1!==n.sortable?(s.add(e.sortableCls),o=t[n.field],o?(i>1&&l&&(l.sortIndex=o.sortIndex),s.add(e.sortedCls),o.ascending?(s.add(e.sortedAscCls),s.remove(e.sortedDescCls)):(s.add(e.sortedDescCls),s.remove(e.sortedAscCls))):(s.remove(e.sortedCls),s["b-group"]||(s.remove(e.sortedAscCls),s.remove(e.sortedDescCls)))):s.remove(e.sortableCls),DomHelper.syncClassList(a,s)}}}}populateHeaderMenu({column:e,items:t}){const r=this,{store:n}=r,i="function"==typeof e.sortable?e.sortable:e.field;if(!1!==e.sortable&&(t.sortAsc={text:"L{sortAscending}",localeClass:r,icon:"b-fw-icon b-icon-sort-asc",name:"sortAsc",cls:"b-separator",weight:300,disabled:r.disabled,onItem:()=>n.sort(i,!0)},t.sortDesc={text:"L{sortDescending}",localeClass:r,icon:"b-fw-icon b-icon-sort-desc",name:"sortDesc",weight:310,disabled:r.disabled,onItem:()=>n.sort(i,!1)},r.multiSort&&r.grid.columns.records.some((e=>e.sortable)))){const s=n.sorters.find((t=>t.field===e.field));t.multiSort={text:"L{multiSort}",localeClass:r,icon:"b-fw-icon b-icon-sort",name:"multiSort",weight:320,disabled:r.disabled,menu:{addSortAsc:{text:s?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:r,icon:"b-fw-icon b-icon-sort-asc",name:"addSortAsc",disabled:s&&(null==s?void 0:s.ascending),weight:330,onItem:()=>n.addSorter(i,!0)},addSortDesc:{text:s?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:r,icon:"b-fw-icon b-icon-sort-desc",name:"addSortDesc",disabled:s&&!s.ascending,weight:340,onItem:()=>n.addSorter(i,!1)},removeSorter:{text:"L{removeSorter}",localeClass:r,icon:"b-fw-icon b-icon-remove",name:"removeSorter",weight:350,disabled:!s,onItem:()=>n.removeSorter(i)}}}}}getColumnDragToolbarItems(e,t){const r=this,{store:n,disabled:i}=r;if(!1!==e.sortable){t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:r,icon:"b-icon b-icon-sort-asc",name:"sortAsc",cls:"b-separator",weight:105,disabled:i,onDrop:({column:e})=>n.sort(e.field,!0)}),t.push({text:"L{sortDescendingShort}",group:"L{sort}",localeClass:r,icon:"b-icon b-icon-sort-desc",name:"sortDesc",weight:105,disabled:i,onDrop:({column:e})=>n.sort(e.field,!1)});const s=n.sorters.find((t=>t.field===e.field));Array.prototype.push.apply(t,[{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:r,icon:"b-icon b-icon-sort-asc",name:"multisortAddAsc",disabled:i||s&&s.ascending,weight:105,onDrop:({column:e})=>n.addSorter(e.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:r,icon:"b-icon b-icon-sort-desc",name:"multisortAddDesc",disabled:i||s&&!s.ascending,weight:105,onDrop:({column:e})=>n.addSorter(e.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:r,icon:"b-icon b-icon-remove",name:"multisortRemove",weight:105,disabled:i||!s,onDrop:({column:e})=>n.removeSorter(e.field)}])}return t}onElementClick(e){const t=this,r=t.store,n=e.target,i=DomHelper.up(n,".b-grid-header.b-sortable"),s=null==i?void 0:i.dataset.column;if(!t.ignoreRe.test(n.className)&&!t.disabled&&i&&s){const n=t.grid.columns.getById(i.dataset.columnId);if(r.isGrouped&&r.groupers.find((e=>e.field===s))&&!e.shiftKey)return;if(n.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)r.removeSorter(n.field);else{let t=n.field;"function"==typeof n.sortable?t={field:n.field,fn:n.sortable}:"object"==typeof n.sortable&&(t=n.sortable,t.field||(t.field=t.property||n.field)),r.sort(t,null,e.ctrlKey)}}}renderHeader(){this.syncHeaderSortState()}}Sort.featureClass="b-sort",Sort._$name="Sort",GridFeatureManager.registerFeature(Sort,!0);class Stripe extends InstancePlugin{static get $name(){return"Stripe"}construct(e,t){super.construct(e,t),e.rowManager.on({renderrow:"onRenderRow",thisObj:this})}doDisable(e){this.isConfiguring||this.client.refreshRows(),super.doDisable(e)}onRenderRow({row:e}){this.disabled||e.addCls(e.dataIndex%2==0?"b-even":"b-odd")}}Stripe._$name="Stripe",GridFeatureManager.registerFeature(Stripe);const immediatePromise$3=Promise.resolve();class Tree extends(InstancePlugin.mixin(Delayable)){static get $name(){return"Tree"}static get defaultConfig(){return{expandOnCellClick:!1}}static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],before:["navigateRight","navigateLeft"],chain:["onElementClick","onElementKeyDown","bindStore"]}}construct(e,t){super.construct(e,t);const r=e.columns.find((e=>e instanceof TreeColumn));Object.assign(this,{grid:e,rowManager:e.rowManager,treeColumn:r}),this.bindStore(e.store)}doDisable(e){}get store(){return this.grid.store}bindStore(e){this.detachListeners("store"),e.on({name:"store",beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",thisObj:this})}async toggleCollapse(e,t,r=!1){const n=this,{store:i,grid:s}=n,{rowManager:o}=s,a=i.getById(e),l=a.instanceMeta(i);if(await i.toggleCollapse(a,t)){const e=o.getRowFor(a);if(e){const t=e.getCell(n.treeColumn.id);t&&e.renderCell(t,a)}n.isTogglingNode||(s.element.classList.add("b-toggling-node"),n.isTogglingNode=!0,n.requestAnimationFrame((()=>{s.element.classList.remove("b-toggling-node"),n.isTogglingNode=!1}))),s.trigger(l.collapsed?"collapseNode":"expandNode",{source:s,record:a}),s.trigger("toggleNode",{source:s,record:a,collapse:t})}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}onBeforeToggleNode({record:e,collapse:t}){this.grid.trigger("beforeToggleNode",{record:e,collapse:t})}onBeforeLoadChildren({source:e,params:t}){const r=e.getById(t[e.modelClass.idField]),n=this.grid.rowManager.getRowFor(r);n&&n.addCls("b-loading-children")}onLoadChildren({source:e,params:t}){const r=e.getById(t[e.modelClass.idField]),n=this.grid.rowManager.getRowFor(r);n&&n.removeCls("b-loading-children")}onLoadChildrenException({record:e}){const t=this.grid.rowManager.getRowFor(e);t&&t.removeCls("b-loading-children")}expandOrCollapseAll(e=!0,t=this.store.rootNode){const{grid:r,store:n}=this,i=[],s=[];return r.trigger("beforeToggleAllNodes",{source:r,collapse:e}),n.suspendEvents(),n.traverse((t=>{const r=t.instanceMeta(n);t.isLeaf||(e&&!r.collapsed?(this.toggleCollapse(t,!0,!0),s.push(...t.children)):!e&&r.collapsed&&(Array.isArray(t.children)&&s.push(...t.children),i.push(this.toggleCollapse(t,!1,!0))))}),t,t===n.rootNode),n.resumeEvents(),(e?immediatePromise$3:Promise.all(i)).then((()=>{r.refreshRows(e),s.length&&(e?n.trigger("remove",{records:s,isCollapse:!0,isCollapseAll:!0}):n.trigger("add",{records:s,isExpand:!0,isExpandAll:!0})),r.trigger("toggleAllNodes",{source:r,collapse:e})}))}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e){const t=this,r=t.store.getById(e);if(!1===r.instanceMeta(t.store).hiddenByCollapse)return;let n=!1,i=r.parent;const s=[];for(;i&&!i.isRoot;)s.push(i),i=i.parent;await s.reverse().forEach((async e=>{e.instanceMeta(t.store).collapsed&&(n=!0),await t.toggleCollapse(e,!1,!0)})),n&&t.grid.refreshRows(),await t.grid.scrollRowIntoView(r)}onElementClick(e){const t=this,r=e.target,n=t.grid.getCellDataFromEvent(e),i=r.closest(".b-tree-expander");(i||t.expandOnCellClick&&n&&n.record.isParent)&&(i&&e.preventDefault(),t.toggleCollapse(n.record))}onElementKeyDown(e){e.target===this.client.focusElement&&" "===e.key&&(e.preventDefault(),this.toggleCollapse(this.grid.focusedCell.id))}navigateRight(e){const t=this,r=t.grid,n=r.focusedCell;if(n){const i=r.store.getById(n.id);if(r.columns.getById(n.columnId).tree&&(e.shiftKey||1===r.columns.count))return i.isParent&&i.instanceMeta(r.store).collapsed?t.expand(i):r.navigateDown(e),!1}}navigateLeft(e){const t=this,r=t.grid,n=r.focusedCell;if(n){const i=r.store.getById(n.id);if(r.columns.getById(n.columnId).tree&&(e.shiftKey||1===r.columns.count))return i.isParent&&!i.instanceMeta(r.store).collapsed?t.collapse(i):i.parent&&r.focusCell({id:i.parent.id,columnId:n.columnId}),!1}}}Tree.featureClass="b-tree",Tree._$name="Tree",GridFeatureManager.registerFeature(Tree,!1,"Grid"),GridFeatureManager.registerFeature(Tree,!0,"TreeGrid");const RowsRange={all:"all",visible:"visible"},PaperFormat={A6:{width:4.13,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69},A3:{width:11.69,height:16.49},Legal:{width:8.5,height:14},Letter:{width:8.5,height:11}},Orientation={portrait:"portrait",landscape:"landscape"},FileFormat={pdf:"pdf",png:"png"};var LocalizableComboItems=e=>class extends(e||Combo){static get $name(){return"LocalizableComboItems"}static get defaultConfig(){return{items:!0}}set items(e){!0===e&&(e=this.buildLocalizedItems()),super.items=e}get items(){return super.items}construct(...e){this.inConstruct=!0,super.construct(...e),this.inConstruct=!1}buildLocalizedItems(){return[]}updateLocalizedItems(){const e=this;if(e.store&&!e.inConstruct){const{value:t}=e;e.store.data=e.buildLocalizedItems(),e.value=null,e.value=t,e.syncInputFieldValue(!0)}}updateLocalization(){this.updateLocalizedItems(),super.updateLocalization()}};class LocalizableCombo extends(LocalizableComboItems(Combo)){static get $name(){return"LocalizableCombo"}static get type(){return"localizablecombo"}}LocalizableCombo.initClass(),LocalizableCombo._$name="LocalizableCombo";class ExportRowsCombo extends LocalizableCombo{static get $name(){return"ExportRowsCombo"}static get type(){return"ExportRowsCombo"}static get defaultConfig(){return{editable:!1}}buildLocalizedItems(){return[{id:RowsRange.all,text:this.L("L{all}")},{id:RowsRange.visible,text:this.L("L{visible}")}]}}ExportRowsCombo.initClass(),ExportRowsCombo._$name="ExportRowsCombo";class ExportOrientationCombo extends LocalizableCombo{static get $name(){return"ExportOrientationCombo"}static get type(){return"ExportOrientationCombo"}static get defaultConfig(){return{editable:!1}}buildLocalizedItems(){return[{id:Orientation.portrait,text:this.L("L{portrait}")},{id:Orientation.landscape,text:this.L("L{landscape}")}]}}ExportOrientationCombo.initClass(),ExportOrientationCombo._$name="ExportOrientationCombo";class ExportDialog extends Popup{static get $name(){return"ExportDialog"}static get defaultConfig(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,hidePNGMultipageOption:!0,exporterType:"singlepage",orientation:"portrait",paperFormat:"A4",fileFormat:"pdf",alignRows:!1,rowsRange:"all",title:"L{exportSettings}",defaults:{localeClass:this},bbar:{defaults:{type:"button",localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200}}}}}construct(e={}){const t=this,{client:r}=e;if(!r)throw new Error("`client` config is required");const n=t.buildDialogItems(e);e.items?Array.isArray(e.items)?e.items.push(...n):n.forEach((t=>{e.items[t.ref]=t,delete t.ref})):e.items=n,e.width=e.width||t.L("L{width}"),super.construct(e),t.widgetMap.exportButton.on("click",t.onExportClick,t),t.widgetMap.cancelButton.on("click",t.onCancelClick,t),LocaleManagerSingleton.on({locale:"onLocaleChange",prio:-1,thisObj:t})}get fieldProperties(){return["exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader"]}getDefaultFieldValues(e){const t=ObjectHelper.copyProperties({},e,this.fieldProperties);return ObjectHelper.copyPropertiesIf(t,this.getDefaultConfiguration(),this.fieldProperties)}buildDialogItems(e){const t=this,{exporters:r,client:n}=e,{exporterType:i,orientation:s,paperFormat:o,fileFormat:a,alignRows:l,rowsRange:c,repeatHeader:d}=t.getDefaultFieldValues(e),u=t.L("L{ExportDialog.labelWidth}");function h(e,t=(e=>e)){return Object.keys(e).map((e=>({id:e,text:t(e)})))}return t.columnsStore=n.columns.chain((e=>e.isLeaf&&e.exportable)),[{labelWidth:u,type:"combo",ref:"columnsField",label:"L{ExportDialog.columns}",store:t.columnsStore,value:t.columnsStore.allRecords,valueField:"id",displayField:"text",multiSelect:!0},{labelWidth:u,type:"exportrowscombo",ref:"rowsRangeField",label:"L{ExportDialog.rows}",value:c},{labelWidth:u,type:"localizablecombo",ref:"exporterTypeField",label:"L{ExportDialog.exporterType}",editable:!1,value:i,buildLocalizedItems:()=>r.map((e=>({id:e.type,text:t.optionalL(e.title,this)}))),onChange({value:e}){this.owner.widgetMap.alignRowsField.hidden="singlepage"===e,this.owner.widgetMap.repeatHeaderField.hidden="multipagevertical"!==e}},{labelWidth:u,type:"checkbox",ref:"alignRowsField",label:"L{ExportDialog.alignRows}",checked:l,hidden:"singlepage"===i},{labelWidth:u,type:"checkbox",ref:"repeatHeaderField",label:"L{ExportDialog.repeatHeader}",localeClass:this,value:d,hidden:"multipagevertical"!==i},{labelWidth:u,type:"combo",ref:"fileFormatField",label:"L{ExportDialog.fileFormat}",localeClass:this,editable:!1,value:a,items:h(FileFormat,(e=>e.toUpperCase())),onChange({value:e,oldValue:r}){if(t.hidePNGMultipageOption){const n=t.widgetMap.exporterTypeField,i=n.store.find((e=>"singlepage"===e.id));e===FileFormat.png&&i?(this._previousDisabled=n.disabled,n.disabled=!0,this._previousValue=n.value,n.value="singlepage"):r===FileFormat.png&&this._previousValue&&(n.disabled=this._previousDisabled,n.value=this._previousValue)}}},{labelWidth:u,type:"combo",ref:"paperFormatField",label:"L{ExportDialog.paperFormat}",editable:!1,value:o,items:h(PaperFormat)},{labelWidth:u,type:"exportorientationcombo",ref:"orientationField",label:"L{ExportDialog.orientation}",value:s}]}onLocaleChange(){const e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget((t=>{t instanceof Field&&(t.labelWidth=e)}))}onExportClick(){const e=this.values;this.trigger("export",{values:e})}onCancelClick(){this.trigger("cancel"),this.hide()}get values(){const e=/field/i,t={};return this.eachWidget((r=>{e.test(r.ref)&&(t[r.ref.replace(e,"")]=r instanceof Checkbox?r.checked:r.value)})),t}}function _AwaitValue(e){this.wrapped=e}function _AsyncGenerator(e){var t,r;function n(t,r){try{var s=e[t](r),o=s.value,a=o instanceof _AwaitValue;Promise.resolve(a?o.wrapped:o).then((function(e){a?n("return"===t?"return":"next",e):i(s.done?"return":"normal",e)}),(function(e){n("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,i){return new Promise((function(s,o){var a={key:e,arg:i,resolve:s,reject:o,next:null};r?r=r.next=a:(t=r=a,n(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function _wrapAsyncGenerator(e){return function(){return new _AsyncGenerator(e.apply(this,arguments))}}function _awaitAsyncGenerator(e){return new _AwaitValue(e)}ExportDialog._$name="ExportDialog","function"==typeof Symbol&&Symbol.asyncIterator&&(_AsyncGenerator.prototype[Symbol.asyncIterator]=function(){return this}),_AsyncGenerator.prototype.next=function(e){return this._invoke("next",e)},_AsyncGenerator.prototype.throw=function(e){return this._invoke("throw",e)},_AsyncGenerator.prototype.return=function(e){return this._invoke("return",e)};class Exporter extends(Delayable(Events(Localizable(Base)))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0}}pageTpl(e){const{title:t,header:r,footer:n,styles:i,htmlClasses:s,bodyStyle:o,bodyClasses:a=[],paperHeight:l,paperWidth:c,html:d}=e;return a.push("b-"+this.constructor.type),DomHelper.scrollBarWidth?a.push("b-visible-scrollbar"):a.push("b-overlay-scrollbar"),BrowserHelper.isChrome?a.push("b-chrome"):BrowserHelper.isSafari?a.push("b-safari"):BrowserHelper.isFirefox?a.push("b-firefox"):BrowserHelper.isIE11?a.push("b-ie"):BrowserHelper.isEdge&&a.push("b-edge"),TemplateHelper.tpl`
            <!DOCTYPE html>
            <html class="${s}" style="width: ${c}in; height: ${l}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${t}</title>
                    ${i.join("")}
                </head>
                <body class="b-export ${a.join(" ")}" style="width: ${c}in; height: ${l}in; ${o}">
                    <div class="b-export-content">
                        ${r&&`<div class="b-export-header" style="width: 100%">${r}</div>`}
                        <div class="b-export-body"><div class="b-export-viewport">${d}</div></div>
                        ${n&&`<div class="b-export-footer" style="width: 100%">${n}</div>`}
                    </div>
                </body>
            </html>`}get stylesheets(){const e=this;if(e._stylesheets)return e._stylesheets;const t=e.translateURLsToAbsolute,r=window.origin,n=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),i=[];return n.forEach((n=>{if(n=n.cloneNode(!0),t&&n.href){let e;e=!0===t?n.href:this.keepPathName?n.href.replace(r,t):new URL(n.getAttribute("href"),t),n.setAttribute("href",e)}let s;if(s=BrowserHelper.isIE11&&n.styleSheet&&/style/i.test(n.tagName)?`<style type="text/css">${n.styleSheet.cssText}</style>`:n.outerHTML,t&&/style/i.test(n.tagName)){const r=e.getStyleTagURLConverter(t);s=s.replace(/url\(['"]?(.+?)['"]?\)/g,r)}i.push(s)})),i.push("<style>\n                body, html {\n                    overflow: auto;\n                }\n\n                body {\n                    position: relative;\n                    margin: 0;\n                }\n            </style>"),e._stylesheets=i}set stylesheets(e){this._stylesheets=e}getStyleTagURLConverter(e){return function(t,r){let n;try{let i;/^#/.test(r)?n=t:(i=!0===e?window.location.href:this.keepPathName?window.location.href.replace(window.location.origin,e):e,n=`url('${new URL(r,i).href}')`)}catch(e){n=t}return n}.bind(this)}saveState({client:e}){this.state=e.state;const{tbar:t,bbar:r}=e;t&&(this.state.tbar_hidden=t.hidden,t.hide(!1)),r&&(this.state.bbar_hidden=r.hidden,r.hide(!1))}async restoreState({client:e}){const t=[],r=new Set,{tbar:n,bbar:i}=e;r.add(e.scrollable.on({scrollStart(){t.push(e.scrollable.await("scrollEnd"))}})),e.eachSubGrid((({header:e,scrollable:n})=>{r.add(n.on({scrollStart(){t.push(n.await("scrollEnd"))}})),r.add(e.scrollable.on({scrollStart(){t.push(e.scrollable.await("scrollEnd"))}}))})),n&&(n.hidden=this.state.tbar_hidden,delete this.state.tbar_hidden),i&&(i.hidden=this.state.bbar_hidden,delete this.state.bbar_hidden),e.state=this.state,await Promise.all(t),r.forEach((e=>e()))}beforeExport(){this.element=document.createElement("div")}cloneElement(e,t=this.element,r=!0){r&&(t.innerHTML=""),BrowserHelper.isChrome?t.appendChild(e.cloneNode(!0)):t.innerHTML=e.outerHTML,DomHelper.removeEachSelector(t,".b-grid-row");const n=t.querySelector(".b-gridbase > .b-mask");n&&n.remove()}measureElement(e=""){e instanceof HTMLElement&&(e=e.outerHTML);const t=DomHelper.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:`<div style="height: 1px"></div>${e}<div style="height: 1px"></div>`}),r=t.offsetHeight-2;return t.remove(),r}prepareHTML(e){e instanceof HTMLElement&&(e=e.outerHTML);const t=DomHelper.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:e}),r=t.querySelectorAll("img");for(let e=0,t=r.length;e<t;e++)r[e].setAttribute("src",r[e].src);const n=t.innerHTML;return t.remove(),n}createPlaceholder(e,t=!0){return t&&(e.innerHTML=""),DomHelper.createElement({parent:e,id:IdHelper.generateId("export")})}getVirtualScrollerHeight(e){let t=0;return e.eachSubGrid((e=>{e.overflowingHorizontally&&(t=DomHelper.scrollBarWidth)})),0===t?t:t+1}inchToPx(e){return 96*e}getScaleValue(e,t){return Math.floor(1e4*e/t)/1e4}getVisibleRowsCount(e){const t=e.rowManager,r=t.rows.indexOf(t.firstVisibleRow),n=t.rows.indexOf(t.lastVisibleRow);let i;return i=-1!==r?-1===n?e.store.count-r:n-r+1:e.store.count,i}async export(e){const t=this;let r;t.beforeExport(),t.saveState(e),await t.prepareComponent(e);try{r=await t.getPages(e)}finally{await t.restoreComponent(e),t.stylesheets=null,await new Promise((e=>t.requestAnimationFrame(e))),await t.restoreState(e)}return r}async getPages(e){const t=this.pagesExtractor(e),r=[];let n;for(;(n=await t.next())&&!n.done;)r.push(n.value);return r}adjustRowBuffer(e){const{contentHeight:t}=this.exportMeta,{rowManager:r}=e;this.oldRowManagerConfig={prependRowBuffer:r.prependRowBuffer,appendRowBuffer:r.appendRowBuffer};const n=Math.ceil(t/r.rowOffsetHeight);r.prependRowBuffer=n,r.appendRowBuffer=n,e.renderRows(!1),e.rowManager.jumpToPosition(e.scrollable.y)}restoreRowBuffer(e){e.rowManager.prependRowBuffer=this.oldRowManagerConfig.prependRowBuffer,e.rowManager.appendRowBuffer=this.oldRowManagerConfig.appendRowBuffer}async prepareComponent(e){const t=this,{client:r,columns:n,rowsRange:i,keepRegionSizes:s}=e,o=t.exportMeta={totalWidth:0,totalHeight:0-t.getVirtualScrollerHeight(r),subGrids:{}};if(r.columns.forEach((e=>{n.includes(e.id)?e.show():e.hide()})),r.rowManager.rowCount>0)if(i===RowsRange.all)o.firstVisibleDataIndex=r.rowManager.rows[0].dataIndex,await r.scrollRowIntoView(r.store.first,{block:"start"});else{const t=o.firstVisibleDataIndex=r.rowManager.rows.find((e=>e.bottom>r.scrollable.y)).dataIndex;await r.scrollRowIntoView(r.store.getAt(t),{block:"start"}),e.alignRows=!0}this.cloneElement(r.element);const{element:a}=t;r.eachSubGrid((e=>{var n;const i=t.createPlaceholder(a.querySelector(`[id="${e.id}"]`),!1);let l;l=(null==s?void 0:s[e.region])?e.element.offsetWidth:e.columns.visibleColumns.reduce(((e,t)=>("number"==typeof t.width?e+=t.width:e+=r.getHeaderElement(t.id).offsetWidth,e)),0),o.totalWidth+=l;const c=(null===(n=e.splitterElement)||void 0===n?void 0:n.offsetWidth)||0;o.totalWidth+=c,o.subGrids[e.region]={id:e.id,headerId:e.header&&e.header.id||null,footerId:e.footer&&e.footer.id||null,rows:[],splitterWidth:c,placeHolder:i,width:l}}))}prepareExportElement(){const{element:e,exportMeta:t}=this;return Object.values(t.subGrids).forEach((({width:t,id:r,headerId:n,footerId:i})=>{[r,n,i].forEach((r=>{if(r){const n=e.querySelector(`[id="${r}"]`);n&&(n.style.width=t+"px",n.style.flex="")}}))})),e.innerHTML}async restoreComponent(e){}async scrollRowIntoView(e,t){await e.scrollRowIntoView(e.store.getAt(t),{block:"start"}),await new Promise((e=>this.requestAnimationFrame(e)))}}Exporter.prototype.pagesExtractor=function(){var e=_wrapAsyncGenerator((function*(){yield""}));return function(){return e.apply(this,arguments)}}(),Exporter._$name="Exporter";class MultiPageExporter extends Exporter{static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:t}=this;++t.currentPage,++t.verticalPosition,delete t.lastExportedRowBottom,t.verticalPosition>=t.verticalPages&&(t.verticalPosition=t.currentPageTopMargin=0,++t.horizontalPosition,await this.scrollRowIntoView(e,t.firstVisibleDataIndex,{block:"start"}))}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:r}=t,{client:n,headerTpl:i,footerTpl:s,alignRows:o,rowsRange:a}=e,l=PaperFormat[e.paperFormat],c=e.orientation===Orientation.portrait,d=c?l.width:l.height,u=c?l.height:l.width,h=t.inchToPx(d),g=t.inchToPx(u),m=Math.ceil(r.totalWidth/h);let p=r.totalHeight+n.height-n.bodyHeight+n.scrollable.scrollHeight,f=g;i&&(f-=t.measureElement(i({totalWidth:r.totalWidth,totalPages:-1,currentPage:-1}))),s&&(f-=t.measureElement(s({totalWidth:r.totalWidth,totalPages:-1,currentPage:-1})));let v,y=n.store.count;if(a===RowsRange.visible){y=t.getVisibleRowsCount(n);const e=n.rowManager.rows[y-1].bottom;p=p-n.scrollable.scrollHeight+e}if(o&&a!==RowsRange.visible){const e=n.rowManager.rowOffsetHeight,t=Math.floor((f-n.headerHeight)/e),r=Math.floor(f/e),i=y-t;v=1+Math.ceil(i/r)}else v=Math.ceil(p/f);Object.assign(r,{paperWidth:d,paperHeight:u,pageWidth:h,pageHeight:g,horizontalPages:m,verticalPages:v,totalHeight:p,contentHeight:f,totalRows:y,totalPages:m*v,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0}),this.adjustRowBuffer(n)}async restoreComponent(e){await super.restoreComponent(e),this.restoreRowBuffer(e.client)}async buildPage(e){const t=this,{exportMeta:r}=t,{client:n,headerTpl:i,footerTpl:s,alignRows:o}=e,{totalWidth:a,totalPages:l,currentPage:c,subGrids:d,currentPageTopMargin:u,verticalPosition:h,totalRows:g}=r,{rowManager:m}=n,{rows:p}=m;Object.values(d).forEach((e=>e.rows=[])),e.rowsRange===RowsRange.all&&(r.totalHeight=n.height-n.bodyHeight+n.scrollable.scrollHeight-t.getVirtualScrollerHeight(n));let f,v,y,b=0,C=0,D=e.rowsRange===RowsRange.visible?p.findIndex((e=>e.bottom>n.scrollable.y)):p.findIndex((e=>e.bottom+u+n.headerHeight>0));const S=D,E=0===h?0:p[D].top+u+n.headerHeight;i&&(v=t.prepareHTML(i({totalWidth:a,totalPages:l,currentPage:c})),b=t.measureElement(v)),s&&(y=t.prepareHTML(s({totalWidth:a,totalPages:l,currentPage:c})),C=t.measureElement(y)),f=r.pageHeight-b-C-E,0===h&&(f-=n.headerHeight);let w,x=0;for(;f>0;){const r=p[D];o&&f<r.offsetHeight?(x=-f,f=0,t.exportMeta.lastExportedRowBottom=p[D-1].bottom):(t.collectRow(r),f-=r.offsetHeight,w=r.dataIndex,(++D===p.length&&f>0||e.rowsRange===RowsRange.visible&&D-S===g)&&(f=0))}const R=p[D-1];if(R&&(r.exactGridHeight=R.bottom+n.footerContainer.offsetHeight+n.headerContainer.offsetHeight),await t.onRowsCollected(p.slice(S,D),e),e.rowsRange===RowsRange.visible)r.exactGridHeight-=r.scrollableTopMargin=n.scrollable.y;else{const e=m.on("offsetrows",(({offset:e})=>x+=e));await t.scrollRowIntoView(n,w+1),e()}return{html:t.buildPageHtml(),header:v,footer:y,offset:x}}async onRowsCollected(){}collectRow(e){const t=this.exportMeta.subGrids;Object.entries(e.elements).forEach((([e,r])=>{t[e].rows.push(r.outerHTML)}))}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:r})=>{const n=e.outerHTML;t=t.replace(n,r.join(""))})),t}prepareExportElement(){const{element:e,exportMeta:t}=this;return t.scrollableTopMargin&&(e.querySelector(".b-grid-vertical-scroller").style.marginTop=`-${t.scrollableTopMargin}px`),super.prepareExportElement()}}MultiPageExporter.prototype.pagesExtractor=function(){var e=_wrapAsyncGenerator((function*(e){const t=this,{exportMeta:r,stylesheets:n}=t,{totalWidth:i,totalPages:s,paperWidth:o,paperHeight:a,contentHeight:l}=r;let c;for(;(c=r.currentPage)<s;){t.trigger("exportStep",{text:t.L(MultiPageExporter.exportingPageText,{currentPage:c,totalPages:s}),progress:Math.round((c+1)/s*90)});const{html:d,header:u,footer:h,offset:g}=yield _awaitAsyncGenerator(t.buildPage(e)),m=[...n,`\n                <style>\n                    #${e.client.id} {\n                        height: ${r.exactGridHeight}px !important;\n                        width: ${i}px !important;\n                    }\n                    \n                    .b-export-body .b-export-viewport {\n                        margin-left : ${-o*r.horizontalPosition}in;\n                        margin-top  : ${r.currentPageTopMargin}px;\n                    }\n                </style>\n            `];r.currentPageTopMargin-=l+g,yield _awaitAsyncGenerator(t.stateNextPage(e)),yield{html:t.pageTpl({html:d,header:u,footer:h,styles:m,paperWidth:o,paperHeight:a})}}}));return function(t){return e.apply(this,arguments)}}(),MultiPageExporter._$name="MultiPageExporter";class MultiPageVerticalExporter extends Exporter{static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:t}=this,{totalRows:r,processedRows:n,totalPages:i}=t;++t.currentPage,++t.verticalPosition,t.currentPage===i&&n.size!==r&&(++t.totalPages,++t.verticalPages)}estimateTotalPages(e){const t=this,{exportMeta:r}=t,{client:n,headerTpl:i,footerTpl:s,alignRows:o,rowsRange:a,repeatHeader:l}=e,{pageWidth:c,pageHeight:d,totalWidth:u}=r,h=t.getScaleValue(c,u);let g,m=0-t.getVirtualScrollerHeight(n)+n.height-n.bodyHeight+n.scrollable.scrollHeight,p=d/h,f=n.store.count,v=0;if(i&&(p-=t.measureElement(i({totalWidth:u,totalPages:-1,currentPage:-1}))),s&&(p-=t.measureElement(s({totalWidth:u,totalPages:-1,currentPage:-1}))),l&&(p-=n.headerHeight,m-=n.headerHeight),a===RowsRange.visible){const e=n.rowManager,r=e.firstVisibleRow,i=e.lastVisibleRow;v=r.top,f=t.getVisibleRowsCount(n),m=m-n.scrollable.scrollHeight+i.bottom-r.top}if(o&&!l&&a!==RowsRange.visible){const e=n.rowManager.rowOffsetHeight,t=Math.floor((p-n.headerHeight)/e),r=Math.floor(p/e),i=f-t;g=1+Math.ceil(i/r)}else g=Math.ceil(m/p);Object.assign(r,{scale:h,contentHeight:p,totalRows:f,totalHeight:m,verticalPages:g,initialScroll:v,horizontalPages:1,totalPages:g})}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:r}=t,{client:n}=e,i=PaperFormat[e.paperFormat],s=e.orientation===Orientation.portrait,o=s?i.width:i.height,a=s?i.height:i.width,l=t.inchToPx(o),c=t.inchToPx(a);Object.assign(r,{paperWidth:o,paperHeight:a,pageWidth:l,pageHeight:c,horizontalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,processedRows:new Set}),t.estimateTotalPages(e),t.adjustRowBuffer(n)}async restoreComponent(e){await super.restoreComponent(e),this.restoreRowBuffer(e.client)}async buildPage(e){const t=this,{exportMeta:r}=t,{client:n,headerTpl:i,footerTpl:s,alignRows:o,repeatHeader:a}=e,{totalWidth:l,totalPages:c,currentPage:d,subGrids:u,currentPageTopMargin:h,verticalPosition:g,totalRows:m,contentHeight:p}=r,f=a?0:n.headerHeight,{rowManager:v}=n,{rows:y}=v;Object.values(u).forEach((e=>e.rows=[])),e.rowsRange===RowsRange.all&&(r.totalHeight=n.height-n.bodyHeight+n.scrollable.scrollHeight-t.getVirtualScrollerHeight(n));let b,C,D,S=e.rowsRange===RowsRange.visible?y.findIndex((e=>e.bottom>n.scrollable.y)):y.findIndex((e=>e.bottom+h+f>0));const E=S,w=0===g?0:y[S].top+h+f;i&&(C=t.prepareHTML(i({totalWidth:l,totalPages:c,currentPage:d}))),s&&(D=t.prepareHTML(s({totalWidth:l,totalPages:c,currentPage:d}))),b=p-w,0===g&&(b-=f);let x,R=0;for(;b>0;){const n=y[S];o&&b<n.offsetHeight?(R=-b,b=0):(t.collectRow(n),b-=n.offsetHeight,b>0&&r.processedRows.add(n.dataIndex),x=n.dataIndex,(++S===y.length&&b>0||e.rowsRange===RowsRange.visible&&S-E===m)&&(b=0))}const T=y[S-1];if(T&&(r.exactGridHeight=T.bottom+n.footerContainer.offsetHeight+n.headerContainer.offsetHeight),await t.onRowsCollected(y.slice(E,S),e),e.rowsRange===RowsRange.visible)r.scrollableTopMargin=n.scrollable.y;else{const e=v.on("offsetrows",(({offset:e})=>R+=e));await t.scrollRowIntoView(n,x+1),e()}return{html:t.buildPageHtml(),header:C,footer:D,offset:R}}async onRowsCollected(){}collectRow(e){const t=this.exportMeta.subGrids;Object.entries(e.elements).forEach((([e,r])=>{t[e].rows.push(r.outerHTML)}))}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:r})=>{const n=e.outerHTML;t=t.replace(n,r.join(""))})),t}}MultiPageVerticalExporter.prototype.pagesExtractor=function(){var e=_wrapAsyncGenerator((function*(e){const t=this,{exportMeta:r,stylesheets:n}=t,{totalWidth:i,paperWidth:s,paperHeight:o,contentHeight:a,scale:l,initialScroll:c}=r;let d,{totalPages:u}=r;for(;(d=r.currentPage)<u;){t.trigger("exportStep",{text:t.L(MultiPageVerticalExporter.exportingPageText,{currentPage:d,totalPages:u}),progress:Math.round((d+1)/u*90)});const{html:h,header:g,footer:m,offset:p}=yield _awaitAsyncGenerator(t.buildPage(e)),f=[...n,`\n                <style>\n                    #${e.client.id} {\n                        width: ${i}px !important;\n                    }\n                    \n                    .b-export .b-export-content {\n                        transform: scale(${l});\n                        transform-origin: top left;\n                        height: auto;\n                    }\n                </style>\n            `];if(e.repeatHeader){const t=r.exactGridHeight?r.exactGridHeight+r.currentPageTopMargin+"px":"100%";f.push(`\n                <style>\n                    #${e.client.id} {\n                        height: ${t} !important;\n                    }\n                    \n                    .b-export .b-export-content {\n                        height: ${100/l}%;\n                    }\n                    \n                    .b-export-body {\n                        height: 100%;\n                        display: flex;\n                    }\n                \n                    .b-export-viewport {\n                        height: 100%;\n                    }\n                    \n                    .b-grid-vertical-scroller {\n                        margin-top: ${r.currentPageTopMargin-c}px;\n                    }\n                </style>\n                `)}else{const t=r.exactGridHeight||a-r.currentPageTopMargin;f.push(`\n                <style>\n                    #${e.client.id} {\n                        height: ${t}px !important;\n                    }\n                    \n                    .b-export-body {\n                        overflow: hidden;\n                    }\n                    \n                    .b-export .b-export-content {\n                        height: ${100/l}%;\n                    }\n                    \n                    .b-export-body .b-export-viewport {\n                        margin-top: ${r.currentPageTopMargin}px;\n                    }\n                    \n                    .b-grid-vertical-scroller {\n                        margin-top: -${c}px;\n                    }\n                </style>\n                `)}r.currentPageTopMargin-=a+p,yield _awaitAsyncGenerator(t.stateNextPage(e)),({totalPages:u}=r),yield{html:t.pageTpl({html:h,header:g,footer:m,styles:f,paperWidth:s,paperHeight:o})}}}));return function(t){return e.apply(this,arguments)}}(),MultiPageVerticalExporter._$name="MultiPageVerticalExporter";class SinglePageExporter extends Exporter{static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(e){await super.prepareComponent(e),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}positionRows(e){let t=0;return e.map((([e,r])=>{const n=e.replace(/translate\(\d+px, \d+px\)/,`translate(0px, ${t}px)`);return t+=r,n}))}collectRow(e){const t=this.exportMeta.subGrids;Object.entries(e.elements).forEach((([r,n])=>{t[r].rows.push([n.outerHTML,e.offsetHeight])}))}buildPageHtml(){const e=this,{subGrids:t}=e.exportMeta;let r=e.prepareExportElement();return Object.values(t).forEach((({placeHolder:t,rows:n})=>{const i=t.outerHTML;r=r.replace(i,e.positionRows(n).join(""))})),r}}SinglePageExporter.prototype.pagesExtractor=function(){var e=_wrapAsyncGenerator((function*(e){const t=this,{client:r}=e,{rowManager:n,store:i}=r,s=t.stylesheets,o=e.orientation===Orientation.portrait,a=PaperFormat[e.paperFormat],l=o?a.width:a.height,c=o?a.height:a.width,d=e.rowsRange===RowsRange.visible&&i.count?Math.min(i.count,n.visibleRowCount):i.count;let u,h,{totalHeight:g,totalWidth:m}=t.exportMeta,p=0,f=-1;if(n.rows.length>0)for(e.rowsRange===RowsRange.visible&&(f=n.rows.find((e=>e.bottom>r.scrollable.y)).dataIndex-1);p<d;){const i=n.rows,s=i[i.length-1],o=p;i.forEach((e=>{e.dataIndex>f&&p<d&&(++p,g+=e.offsetHeight,t.collectRow(e))}));const a=i.findIndex((e=>e.dataIndex===f+1)),l=a+(p-o);yield _awaitAsyncGenerator(t.onRowsCollected(i.slice(a,l),e)),p<d&&(f=s.dataIndex,yield _awaitAsyncGenerator(t.scrollRowIntoView(r,f+1)))}const v=t.buildPageHtml();g+=r.height-r.bodyHeight;const y=g;if(e.headerTpl){u=t.prepareHTML(e.headerTpl({totalWidth:m}));const r=t.measureElement(u);g+=r}if(e.footerTpl){h=t.prepareHTML(e.footerTpl({totalWidth:m}));const r=t.measureElement(h);g+=r}const b=Math.min(1,t.getScaleValue(t.inchToPx(l),m)),C=Math.min(1,t.getScaleValue(t.inchToPx(c),g)),D=Math.min(b,C);s.push(`<style>\n                #${r.id} {\n                    height: ${y}px !important;\n                    width: ${m}px !important;\n                }\n                \n                .b-export-content {\n                    ${t.centerContentHorizontally?"left: 50%;":""}\n                    transform: scale(${D}) ${t.centerContentHorizontally?"translateX(-50%)":""};\n                    transform-origin: top left;\n                    height: ${1===D?"inherit":"auto !important"};\n                }\n            </style>`),BrowserHelper.isIE11&&s.push(`<style>\n                .b-export-body {\n                   min-height: ${y}px !important;\n                }\n         </style>`),yield{html:t.pageTpl({html:v,header:u,footer:h,styles:s,paperWidth:l,paperHeight:c})}}));return function(t){return e.apply(this,arguments)}}(),SinglePageExporter._$name="SinglePageExporter";class PdfExport extends(Localizable(InstancePlugin)){static get $name(){return"PdfExport"}static get defaultConfig(){return{exportServer:void 0,fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[SinglePageExporter,MultiPageExporter,MultiPageVerticalExporter],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",localizableProperties:["exportMask","exportProgressMask"]}}doDestroy(){this.exportDialog&&this.exportDialog.destroy(),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(e){this._currentExportPromise=e}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(e={}){const t=this,{exportersMap:r}=t,{type:n}=e;let i;if(r.has(n))i=r.get(n);else{const s=this.exporters.find((e=>e.type===n));if(!s)throw new Error(`Exporter type ${n} is not found. Make sure you've configured it`);delete(e=ObjectHelper.clone(e)).type,i=new s(e),i.relayAll(t),r.set(n,i)}return i}buildRequest(e,t){return{html:JSON.stringify(e),fileFormat:t.fileFormat,format:t.paperFormat,orientation:t.orientation}}buildExportConfig(e={}){const{client:t,exportServer:r,clientURL:n,fileFormat:i,fileName:s,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,exporters:h,translateURLsToAbsolute:g,keepPathName:m,headerTpl:p,footerTpl:f}=this;e.columns||(e.columns=t.columns.visibleColumns.map((e=>e.id)));const v=ObjectHelper.assign({client:t,exportServer:r,clientURL:n,fileFormat:i,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,translateURLsToAbsolute:g,keepPathName:m,headerTpl:p,footerTpl:f,exporterType:h[0].type,fileName:s||t.$$name},e);if("multipagevertical"!==v.exporterType&&(v.repeatHeader=!1),!("alignRows"in e)&&e.repeatHeader&&(v.alignRows=!0),!("keepRegionSizes"in e)&&!v.keepRegionSizes){const e=[],r={};t.eachSubGrid((t=>t.collapsed&&e.push(t.region))),e.length&&(t.eachSubGrid((t=>{e.includes(t.region)||(r[t.region]=!0)})),v.keepRegionSizes=r)}return v}async export(e={}){const t=this,{client:r,pagesPerRequest:n}=t;let i;if((e=t.buildExportConfig(e)).exporterConfig=ObjectHelper.assign({type:e.exporterType,translateURLsToAbsolute:e.translateURLsToAbsolute,keepPathName:e.keepPathName},e.exporterConfig||{}),!1!==r.trigger("beforeExport",e)){r.ignoreViewBox=!0,r.mask(t.exportMask);try{const s=t.getExporter(e.exporterConfig);if(0===n){const r=await s.export(e);t.trigger("exportStep",{progress:90,text:t.exportProgressMask});const n=await AjaxHelper.post(e.exportServer,{html:r,orientation:e.orientation,format:e.paperFormat,fileFormat:e.fileFormat,fileName:e.fileName,clientURL:e.clientURL},Object.assign({credentials:"omit",parseJson:!0},t.fetchOptions));if(i={response:n},n.ok){const r=n.parsedJson;if(t.openAfterExport)if(r.success)if(BrowserHelper.isIE11)window.open(r.url,"ExportedPanel");else{const n=document.createElement("a");n.download=e.fileName,n.href=r.url,t.openInNewTab&&(n.target="_blank"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}else WidgetHelper.toast(r.msg)}}}catch(e){throw i=e instanceof Response?{response:e}:{error:e},e}finally{t.exportDialog&&t.exportDialog.close(),r.unmask(),r.ignoreViewBox=!1,t.trigger("export",i),i.error?WidgetHelper.toast(t.L("L{Export failed}")):i.response.ok||WidgetHelper.toast(t.L("L{Server error}")),r.trigger("export",i)}}return i}get defaultExportDialogConfig(){return ObjectHelper.copyProperties({},this,["client","exporters","exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader"])}showExportDialog(){const e=this;return e.exportDialog||(e.exportDialog=new ExportDialog(Object.assign({},e.defaultExportDialogConfig,{listeners:{export:e.onExportDialogExport,thisObj:e}}))),e.exportDialog.show()}onExportDialogExport({values:e}){const t=this;t.mask=new Mask({progress:0,maxProgress:100,text:t.exportMask,target:t.exportDialog.element});const r=t.on({export(){t.mask.close(),r()},exportstep({progress:e,text:r}){t.mask.progress=e,null!=r&&(t.mask.text=r)}});t.currentExportPromise=t.export(e),t.currentExportPromise.then((()=>t.currentExportPromise=null))}}PdfExport._$name="PdfExport",GridFeatureManager.registerFeature(PdfExport,!1,"Grid");class TableExporter extends Base{static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"    "}}export(e={}){const t=this;return e=ObjectHelper.assign({},t.config,e),t.normalizeColumns(e),t.generateExportData(e)}generateExportData(e){const t=this.generateColumns(e);return{rows:this.generateRows(e),columns:t}}normalizeColumns(e){const t=e.columns||this.target.columns.visibleColumns.filter((e=>!1!==e.exportable));e.columns=t.map((e=>"string"==typeof e?this.target.columns.find((t=>t.field===e))||{field:e}:e))}generateColumns(e){return e.columns.map((t=>this.processColumn(t,e)))}generateRows(e){const{columns:t}=e;if(!t.length)return[];const r=this,{target:n}=r;return n.store.map((n=>r.processRecord(n,t,e))).filter((e=>e.length))}getColumnType(e,t=this.target.store){let r=e.exportedType||"object";if(void 0===e.exportedType&&e.field){const n=t.modelClass.getFieldDefinition(e.field);n&&"auto"!==n.type&&(r=n.type)}return r}processColumn(e,t){const{target:r}=this,{defaultColumnWidth:n}=t;let{field:i,text:s,width:o,minWidth:a}=e;if(i in r.store.modelClass.fieldMap||(i=""),!s||!o){const e=r.columns.find((e=>e.field===i));s||(s=e&&e.text||i),null==o&&(o=e&&e.width||n)}return o=Math.max(o||n,a||n),{field:i,value:s,width:o,type:this.getColumnType(e)}}processRecord(e,t,r){const{target:n}=this,{showGroupHeader:i,indent:s,indentationSymbol:o}=r;let a;return e?e.isSpecialRow?i&&e.meta.groupRowFor&&(a=t.map((t=>n.features.group.buildGroupHeader({cellElement:DomHelper.createElement(),grid:n,record:e,column:t})))):a=t.map((t=>{let i=e[t.field],a=t.renderer||t.defaultRenderer;return!a||i&&t.isDateColumn&&r.exportDateAsInstance||(i=a.call(t,{value:i,record:e,column:t,grid:n,isExport:!0})),s&&t.tree&&(i=`${o.repeat(e.childLevel)}${i}`),i})):a=t.map((()=>"")),a}}TableExporter._$name="TableExporter";class BooleanUnicodeSymbol{constructor(e){this._value=e}get value(){return this._value}toString(){return Boolean(this.value)?"✓":""}}BooleanUnicodeSymbol._$name="BooleanUnicodeSymbol";class ExcelExporter extends InstancePlugin{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{filename:null,dateFormat:"YYYY-MM-DD",exporterClass:TableExporter,exporterConfig:null,zipcelx:null,convertEmptyValueToEmptyString:!0}}processValue(e){return null==e||Number.isNaN(e)||"function"==typeof e||"object"==typeof e&&"[object Object]"===String(e)?"":e}generateExportData(e){const t=this,{rows:r,columns:n}=t.exporter.export(e.exporterConfig);return{rows:r.map((r=>r.map(((r,i)=>{var s;r instanceof Date?r=DateHelper.format(r,e.dateFormat):"boolean"==typeof r&&(r=new BooleanUnicodeSymbol(r)),t.convertEmptyValueToEmptyString&&(r=t.processValue(r));return{value:r,type:"number"===(null===(s=n[i])||void 0===s?void 0:s.type)?"number":"string"}})))),columns:n.map((e=>{let{field:t,value:r,width:n,type:i}=e;return i="string",{field:t,value:r,width:n,type:i}}))}}export(e={}){const t=this;if(!t.zipcelx)throw new Error('ExcelExporter: "zipcelx" library is required');if(t.disabled)return;(e=ObjectHelper.assign({},t.config,e)).filename||(e.filename=t.client.$$name);const{filename:r}=e,{rows:n,columns:i}=t.generateExportData(e);t.zipcelx({filename:r,sheet:{data:[i].concat(n),cols:i}})}construct(e,t){super.construct(e,t),this.zipcelx||"undefined"!=typeof zipcelx&&(this.zipcelx=zipcelx)}get exporter(){return this._exporter||(this._exporter=new this.exporterClass(Object.assign({target:this.client},this.exporterConfig)))}}ExcelExporter._$name="ExcelExporter",GridFeatureManager.registerFeature(ExcelExporter,!1,"Grid");class XMLHelper{static convertFromObject(e,t={}){Objects.assignIf(t,{rootName:"root",elementName:"element",includeHeader:!0,rootElementForArray:!0});const{rootName:r,elementName:n,includeHeader:i,rootElementForArray:s}=t;let{xmlns:o}=t;o=o?` xmlns="${o}"`:"";const a=e=>{const t=[];for(const r in e){const i=e[r];if(Array.isArray(i)){s&&t.push(`<${r}>`);for(const e of i)n.length?t.push(`<${n}>`):t.push(`<${r}>`),t.push(a(e)),n.length?t.push(`</${n}>`):t.push(`</${r}>`);s&&t.push(`</${r}>`)}else Objects.isObject(i)?t.push(`<${r}>${a(i)}</${r}>`):null==i?t.push(`<${r}/>`):t.push(`<${r}>${StringHelper.encodeHtml(i)}</${r}>`)}return t.join("")};return`${i?'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>':""}<${r}${o}>${a(e)}</${r}>`}}XMLHelper._$name="XMLHelper";const MIN_DATE=DateHelper.clearTime(new Date(1900,5,15)),taskUnitMap={minute:3,hour:5,day:7,week:9,month:11},projectUnitMap={minute:1,hour:2,day:3,week:4,month:5},constraintMap={finishnoearlierthan:6,finishnolaterthan:7,mustfinishon:3,muststarton:2,startnoearlierthan:4,startnolaterthan:5},typeMap={FixedDuration:1,FixedUnits:0,FixedEffort:2,Normal:0},dependencyTypeMap={0:3,1:2,2:1,3:0};class MspExport extends InstancePlugin{static get $name(){return"MspExport"}static get configurable(){return{filename:null,dateFormat:"YYYY-MM-DDTHH:mm:ss",timeFormat:"HH:mm:ss",msProjectVersion:2019}}generateExportData(){const e=this;return{...e.getMsProjectConfig(),Calendars:{Calendar:e.getCalendarsData()},Tasks:{Task:e.getTasksData()},Resources:{Resource:e.getResourcesData()},Assignments:{Assignment:e.getAssignmentsData()}}}export(e={}){const t=this;if(t.disabled)return;(e=ObjectHelper.assign({},t.config,e)).filename||(e.filename=t.client.$$name+".xml");const r=t.generateExportData(e),n=t.convertToXml(r);BrowserHelper.download(e.filename,"data:text/xml;charset=utf-8,"+escape(n))}convertToXml(e){return XMLHelper.convertFromObject(e,{rootName:"Project",elementName:"",xmlns:"http://schemas.microsoft.com/project",rootElementForArray:!1})}getMsProjectConfig(){const e=this,t=e.dateFormat,{project:r}=e.client,n=e.filename||e.client.$$name;return{CalendarUID:e.getCalendarUID(r.effectiveCalendar),CreationDate:DateHelper.format(new Date,t),CurrentDate:DateHelper.format(new Date,t),DaysPerMonth:r.daysPerMonth,FinishDate:DateHelper.format(r.endDate,t),MinutesPerDay:60*r.hoursPerDay,MinutesPerWeek:r.daysPerWeek*r.hoursPerDay*60,Name:n,ScheduleFromStart:"Forward"===r.direction?1:0,StartDate:DateHelper.format(r.startDate,t),Title:n,WorkFormat:projectUnitMap[r.effortUnit]}}getCalendarsData(){const e=this,{calendarManagerStore:t,project:r}=e.client,{calendar:n}=r,i=t.allRecords||[];return t.getByInternalId(n.internalId)||i.push(n),i.map((t=>({BaseCalendarUID:e.getCalendarUID(t.parent),IsBaseCalendar:t.parentId?0:1,Name:(t.name||t.internalId)+" - imported",UID:e.getCalendarUID(t),WeekDays:{WeekDay:e.formatWeekDays(t)}})))}formatWeekDays(e){const{timeFormat:t}=this,r=[],n={};let i,s=MIN_DATE;for(let e=0;e<7;e++){const e=s.getDay();n[e]={DayType:e+1,DayWorking:0},i=DateHelper.clearTime(DateHelper.add(s,1,"day")),r.push({startDate:s,endDate:i}),s=i}const o=new e.constructor({intervals:r});return this.client.project.combineCalendars([e,o]).forEachAvailabilityInterval({startDate:MIN_DATE,endDate:i},((r,i,s)=>{const o=s.getCalendarsWorkStatus(),a=n[r.getDay()];o.get(e)&&(a.DayWorking=1,a.WorkingTimes=a.WorkingTimes||{WorkingTime:[]},a.WorkingTimes.WorkingTime.push({FromTime:DateHelper.format(r,t),ToTime:DateHelper.format(i,t)}))})),Object.values(n)}getTasksData(){const e=this,{dateFormat:t}=e,{project:r}=e.client;return e.client.tasks.map((n=>{const{wbsCode:i}=n;return{CalendarUID:e.getCalendarUID(n.effectiveCalendar),ConstraintDate:DateHelper.format(n.constraintDate,t),ConstraintType:constraintMap[n.constraintType],Deadline:DateHelper.format(n.deadlineDate,t),Duration:e.toTimeSpanValue(n.duration,n.durationUnit),DurationFormat:taskUnitMap[n.durationUnit],EarlyFinish:DateHelper.format(n.earlyEnd,t),EarlyStart:DateHelper.format(n.earlyStart,t),EffortDriven:n.effortDriven?1:0,Estimated:0,Finish:DateHelper.format(n.endDate,t),LateFinish:DateHelper.format(n.lateEnd,t),LateStart:DateHelper.format(n.lateStart,t),Manual:n.manuallyScheduled?1:0,ManualDuration:e.toTimeSpanValue(n.duration,n.durationUnit),ManualFinish:DateHelper.format(n.endDate,t),ManualStart:DateHelper.format(n.startDate,t),Milestone:n.isMilestone?1:0,Name:n.name,Notes:n.note,ProjectExternallyEdited:0,OutlineLevel:i.split(".").length,OutlineNumber:i,PredecessorLink:n.predecessors.map((e=>({LagFormat:taskUnitMap[e.lagUnit],LinkLag:10*r.convertDuration(e.lag,e.lagUnit,"minute"),PredecessorUID:e.fromEvent.id,Type:dependencyTypeMap[e.type]}))),RemainingDuration:e.toTimeSpanValue(n.duration,n.durationUnit),Rollup:n.rollup?1:0,Start:DateHelper.format(n.startDate,t),Summary:n.isLeaf?0:1,TotalSlack:n.totalSlack,Type:n.isLeaf?typeMap[n.schedulingMode]:1,UID:n.id,WBS:i,Work:e.toTimeSpanValue(n.effort,n.effortUnit)}}))}getCalendarUID(e,t=-1){return e&&!e.isRoot?e.internalId:t}getResourcesData(){return this.client.resources.map((e=>({CalendarUID:2013===this.msProjectVersion?null:this.getCalendarUID(e.effectiveCalendar),Name:e.name,UID:e.id,Type:1})))}getAssignmentsData(){return 2013===this.msProjectVersion?[]:this.client.assignments.map((({data:e,event:t})=>({Finish:DateHelper.format(t.endDate,this.dateFormat),ResourceUID:e.resource,Start:DateHelper.format(t.startDate,this.dateFormat),TaskUID:e.event,UID:e.id,Units:e.units/100})))}toTimeSpanValue(e,t){const r=DateHelper.getDelta(DateHelper.as("ms",e,t),{abbrev:!0}),{w:n,min:i,s:s}=r;let{yr:o,mon:a,d:l,h:c}=r;return c=c||0,o&&(c+=DateHelper.as("h",o,"y")),a&&(c+=DateHelper.as("h",a,"month")),n&&(c+=DateHelper.as("h",n,"w")),l&&(c+=DateHelper.as("h",l,"d")),`PT${c}H${i||0}M${s||0}S`}}MspExport._$name="MspExport",GridFeatureManager.registerFeature(MspExport,!1,"Gantt");class ScrollManager extends(Delayable(Base)){static get defaultConfig(){return{zoneWidth:50,scrollSpeed:5,verticalElement:null,direction:"both",monitoring:[],startScrollDelay:500,testConfig:{scrollSpeed:2,startScrollDelay:0}}}startMonitoring(e){const t=this,r=e instanceof HTMLElement?{element:e}:e,n=r.element,i=r.verticalElement||t.verticalElement||n;if(n&&(n.scrollWidth>n.offsetWidth||i.scrollHeight>i.offsetHeight)){if(t.monitoring.find((e=>e.element===n)))return;r.direction=r.direction||t.direction,Object.assign(r,{verticalElement:i,scrollManager:t,startScrollLeft:n.scrollLeft,startScrollTop:i.scrollTop,scrollLeft:n.scrollLeft,scrollTop:i.scrollTop,scrollRelativeLeft:0,scrollRelativeTop:0});const e=t.onMouseMove.bind(r);t.mouseMoveDetacher=EventHelper.on({mousemove:e,touchmove:e,mouseleave:()=>t.clearTimeout(t.scrollTimeout),element:n}),r.scrollWidth=n.scrollWidth,t.monitoring.push(r)}}stopMonitoring(e){const t=this,r=t.monitoring.find((t=>t.element===e));r&&(t.stopScroll(r),t.mouseMoveDetacher&&t.mouseMoveDetacher(),t.monitoring.splice(t.monitoring.indexOf(r),1))}startScroll(e){e.scrolling=!0,this.performScroll(e)}stopScroll(e){const t=this;e.scrolling=!1,e.scrollRequested&&(t.cancelAnimationFrame(e.frameId),e.scrollRequested=!1),t.clearTimeout(t.scrollTimeout),t.scrollTimeout=null}performScroll(e){if(e.scrolling&&!e.scrollRequested){const t=e.element,r=e.verticalElement;0!==e.scrollDeltaX&&(e.scrollLeft+=e.scrollDeltaX,e.scrollLeft=Math.max(Math.min(e.scrollLeft,e.scrollWidth-t.clientWidth),0),e.scrollRelativeLeft=e.scrollLeft-e.startScrollLeft,t.scrollLeft=e.scrollLeft),0!==e.scrollDeltaY&&(e.scrollTop+=e.scrollDeltaY,e.scrollTop=Math.max(Math.min(e.scrollTop,r.scrollHeight-r.clientHeight),0),e.scrollRelativeTop=e.scrollTop-e.startScrollTop,r.scrollTop=e.scrollTop),0===e.scrollRelativeLeft&&0===e.scrollRelativeTop||!e.callback||e.callback.call(e.thisObj||this,e),e.scrollRequested=!0,e.frameId=this.requestAnimationFrame((()=>{e.scrollRequested=!1,this.performScroll(e)}))}}onMouseMove(e){const t=this,r=t.scrollManager,n=t.element,i=t.verticalElement,s=n.getBoundingClientRect(),o=i.getBoundingClientRect(),a=r.zoneWidth,l=r.scrollSpeed;t.scrollDeltaX=0,"vertical"!==t.direction&&(e.clientX>s.right-a?t.scrollDeltaX=Math.round((a-(s.right-e.clientX))/l)+1:e.clientX<s.left+a&&(t.scrollDeltaX=-Math.round((a+(s.left-e.clientX))/l)-1)),t.scrollDeltaY=0,"horizontal"!==t.direction&&(e.clientY>o.bottom-a?t.scrollDeltaY=Math.round((a-(o.bottom-e.clientY))/l)+1:e.clientY<o.top+a&&(t.scrollDeltaY=-Math.round((a+(o.top-e.clientY))/l)-1)),0===t.scrollDeltaX&&0===t.scrollDeltaY?r.stopScroll(t):r.scrollTimeout||(r.scrollTimeout=r.setTimeout((()=>r.startScroll(t)),r.startScrollDelay))}}ScrollManager._$name="ScrollManager";class Bar extends Widget{static get $name(){return"Bar"}static get type(){return"gridbar"}static get defaultConfig(){return{htmlCls:"",scrollable:{}}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this;let t,r=!1;e.columns.traverse((n=>{const i=e.getBarCellElement(n.id),s=DomHelper.setLength(n.width),o=DomHelper.setLength(n.minWidth);if(i){if(t=BrowserHelper.isIE11?`calc(${s} - ${e.getLrPadding(i)}px)`:s,r=r||Boolean(n.flex),n.isParent&&null==n.width&&null==n.flex){const e=n.children.reduce(((e,t)=>e+(!t.hidden&&t.flex||0)),0);i.style.flex=e>0?e+" 0 auto":"",e>0&&n.traverse((e=>e.data.minWidth=null))}else if(parseInt(n.minWidth)>=0&&(i.style.minWidth=o),i.style.flex=i.style.flexBasis=i.style.width="",n.flex)!isNaN(parseInt(n.flex))&&n.children?i.style.flex=n.flex+" 0 auto":i.style.flex=n.flex;else if(parseInt(n.width)>=0){const r=n.parent;!e.isHeader||r.isRoot||r.width?i.style.flexBasis=t:i.style.width=s}n.height>=0&&(i.style.height=DomHelper.setLength(n.height))}})),e.element.classList[r?"add":"remove"]("b-has-flex")}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}}Bar.initClass(),Bar._$name="Bar";class Footer extends Bar{static get $name(){return"Footer"}static get type(){return"gridfooter"}startConfigure(e){e.scrollable.overflowX="hidden-scroll",super.startConfigure(e)}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return TemplateHelper.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map((e=>e.hidden?"":TemplateHelper.tpl`
                <div
                    class="b-grid-footer ${e.align?"b-grid-footer-align-"+e.align:""} ${e.cls||""}"
                    data-column="${e.field||""}" data-column-id="${e.id}" data-all-index="${e.allIndex}"
                    >
                    ${e.footerText||""}
                </div>`)).join("")}fixFooterWidths(){this.fixCellWidths()}}Footer.initClass(),Footer._$name="Footer";class Row extends(Delayable(Base)){static get defaultConfig(){return{cls:"b-grid-row"}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1},e),super.construct()}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){if(this._dataIndex!==e){const t=this._elementsArray;this._dataIndex=e;for(let r=0;r<t.length;r++)t[r].dataset.index=e}}get id(){return this._id}set id(e){const t=this,r={id:e},n=t.rowManager.idMap,i=t._elementsArray,s=t._allCells;if(t._id!=e||n[e]!==t){n[t._id]===t&&delete n[t._id],n[e]=t,t._id=e;for(let e=0;e<i.length;e++)DomDataStore.assign(i[e],r);for(let e=0;e<s.length;e++)DomDataStore.assign(s[e],r);for(let t=0;t<i.length;t++)i[t].dataset.id=e}}addElement(e,t){const r=this;let n=t.firstElementChild;for(r._elements[e]=t,r._elementsArray.push(t),r._regions.push(e),DomDataStore.assign(t,{index:r.index}),r._cells[e]=[];n;)r._cells[e].push(n),r._allCells.push(n),DomDataStore.set(n,{column:n.dataset.column,columnId:n.dataset.columnId,rowElement:n.parentNode,row:r}),n=n.nextElementSibling;t.dataset.index=r.index}getElement(e){return this._elements[e]}eachElement(e){for(let t=0;t<this._elementsArray.length;t++)e(this._elementsArray[t],t)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e){return this._allCells.find((t=>{const r=DomDataStore.get(t);return r.columnId===e||r.column===e}))}removeElements(e=!1){const t=this;t.rowManager.trigger("removeRow",{row:t}),e||t._elementsArray.forEach((e=>e.remove())),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(){const e=this;if(e.rowManager.storeKnownHeight(e.id,e.height),e.lastHeight!==e.height){const t=e._elementsArray;for(let r=0;r<t.length;r++)t[r].style.height=e.offsetHeight+"px";e.lastHeight=e.height}}addCls(...e){this.eachElement((t=>DomHelper.addClasses(t,e)))}removeCls(...e){this.eachElement((t=>DomHelper.removeClasses(t,e)))}get isFirst(){return 0===this.dataIndex}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e,t){this._top!==e&&(this._top=e,this.translateElements(t))}setBottom(e,t){this.setTop(e-this.offsetHeight,t)}translateElements(e){const t=this,r=t.grid.positionMode;if(t.lastTop!==t.top){const n=t._elementsArray;for(let e=0;e<n.length;e++){const i=n[e].style;"translate"===r?i.transform=`translate(0,${t.top}px)`:"translate3d"===r?i.transform=`translate3d(0,${t.top}px,0)`:"position"===r&&(i.top=t.top+"px")}e||t.rowManager.trigger("translateRow",{row:t}),t.lastTop=t.top}}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}render(e,t,r=!0,n=!1){var i;const s=this,{cells:o,grid:a,rowManager:l,height:c}=s,d=s._id,u=s._elementsArray,h=DomDataStore.get(u[0]),g=l._rowHeight,m=r&&a.transitionDuration?s.cls+" b-grid-row-updating":s.cls;let p,f,v,y=0;t||!1===t||(t=a.store.getById(h.id),e=a.store.indexOf(t));const b=t&&a.isSelected(t.id);for(l.trigger("beforeRenderRow",{row:s,record:t,recordIndex:e,oldId:d});y<u.length;y++)p=u[y],p.className=m,b&&p.classList.add("b-selected"),t.cls&&t.cls.split(" ").forEach((e=>p.classList.add(e)));r&&a.transitionDuration&&s.setTimeout((()=>{u.forEach((e=>{e.classList.remove("b-grid-row-updating")}))}),a.transitionDuration),s.id=t.id,s.dataIndex=e;const C=!a.fixedRowHeight&&a.getRowHeight(t)||g;let D=null;for(y=0;y<o.length;y++)f=o[y],v=s.renderCell(f,t,y,r,C),l.fixedRowHeight||null!=v.height&&(D=Math.max(D,v.height));s.height=null!==(i=D)&&void 0!==i?i:C,s.updateElementsHeight(),r&&(c!==s.height&&l.translateFromRow(s,n),l.trigger("updateRow",{row:s,record:t,recordIndex:e,oldId:d}),l.trigger("renderDone")),l.trigger("renderRow",{row:s,record:t,recordIndex:e,oldId:d}),s.forceInnerHTML=!1}renderCell(e,t,r,n=!0,i){const s=this,{grid:o}=s,a=DomDataStore.get(e),l=o.columns.getById(a.columnId),c=a.rowElement,d=DomDataStore.get(c),{internalCellCls:u,cellCls:h,align:g,renderer:m,defaultRenderer:p,id:f}=l,v={columnId:f,id:d.id},y=m||p;if(!t){if(null===d.id)return void(e.className="b-grid-cell");if(!(t=o.store.getById(d.id)))return}let b=l.getRawValue(t),C=!0;const D=t.fieldMap[l.field],S={configuredHeight:i,height:null},E={cellElement:e,dataField:D,rowElement:c,value:b,record:t,column:l,size:S,grid:o,row:a.row,updatingSingleRow:n},w={"b-grid-cell":1,[u]:u,[h]:t.isSpecialRow&&"b-check-cell"===l.internalCellCls?void 0:h,"b-cell-dirty":t.isFieldModified(l.field),["b-grid-cell-align-"+g]:g,"b-selected":o.isSelected(v),"b-focused":o.isFocused(v)};DomHelper.syncClassList(e,w),y?(b=y.call(l,E),void 0===b&&(C=!1)):D&&(b=D.print(b)),o.processCellContent&&(C=o.processCellContent({cellContent:b,cellElement:e,record:t,cellElementData:a,rendererData:E}));const x=E.cellContent=null==b?"":String(b);if(C)if(s.forceInnerHTML&&(e.innerHTML="",e.lastDomConfig=null),l.htmlEncode&&!l.disableHtmlEncode)BrowserHelper.isLinux||e._hasHtml?(e.innerText=x,e._hasHtml=!1):DomHelper.setInnerText(e,x);else{const t="string"==typeof b,r="object"==typeof b;!l.autoSyncHtml||t&&!e.childElementCount?r?DomSync.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.isArray(b)?b:[b]}}):e._content!==x&&(e.innerHTML=e._content=x):t?DomHelper.sync(x,e.firstElementChild):DomSync.sync({domConfig:b,targetElement:e})}return s.rowManager.trigger("renderCell",E),S}}Row._$name="Row";class RowManager extends InstancePlugin{static get pluginConfig(){return{chain:["getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement","destroy"],assign:["rowHeight","topRow","bottomRow"]}}static get defaultConfig(){return{prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this._rows.forEach((e=>e.destroy())),super.doDestroy()}initWithHeight(e,t=!1){const r=this;return r.autoHeight&&(e=r.store.allCount*r.preciseRowOffsetHeight),r.viewHeight=e,r.calculateRowCount(t),e}reinitialize(e=!1){const t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.store.count&&(e=!0);const r=t.topRow&&!e?t.topRow.top:0;t.scrollTargetRecordId=null,e&&(t.topIndex=t.lastScrollTop=0);const{topRow:n}=t;n&&(n.dataIndex=t.topIndex,n.setTop(r,!0)),t.estimateTotalHeight(),t.renderFromRow(n)}matchRowCount(e=!1){const t=this,{rows:r,grid:n}=t,i=r.length,s=i-t.rowCount;if(s)if(s<0){const s=[];for(let e=i,o=i?r[i-1].dataIndex+1:0;e<t.rowCount;e++,o++)s.push(new Row({rowManager:t,grid:n,index:e,dataIndex:o}));r.push.apply(r,s),t.trigger("addRows",{rows:s}),e||t.renderFromRow(r[Math.max(0,i-1)])}else{const e=r.splice(i-s,s);t.trigger("removeRows",{rows:e}),e.forEach((e=>e.destroy()))}}calculateRowCount(e=!1,t=!0,r=!1){const n=this,{store:i}=n,s=Math.ceil(n.viewHeight/n.minRowOffsetHeight),o=s+n.prependRowBuffer+n.appendRowBuffer;return!n.grid.columns.count||isNaN(s)?(n.rowCount=0,0):(o<n.rowCount&&!t||(n.visibleRowCount=s,n.rowCount=Math.min(i.count,o),e||(n.rows&&n.rowCount!==n.rows.length?n.matchRowCount(r):n.rowCount||n.trigger("changeTotalHeight",{totalHeight:n.totalHeight}),n.grid.toggleEmptyText())),n.rowCount)}removeAllRows(){const e=this,{topRow:t}=e,r=t?e.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:e.refreshDetails,n=e.rows.slice();return e.trigger("removeRows",{rows:n}),e.rows.forEach((e=>e.destroy())),e.rows.length=0,e.idMap={},r}setPosition(e){const{topRow:t}=this,{topRowIndex:r,topRowTop:n}=e;t.setTop(n),t.dataIndex=r}get store(){return this.client.store}get rows(){return this._rows}getRow(e){return this.rowCount&&this.rows[e-this.topIndex]}getRowById(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return(e=e.closest(".b-grid-row"))&&this.getRow(e.dataset.index)}getRowAt(e,t=!1){return t||(e-=Rectangle.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=DomHelper.roundPx(e),this.rows.find((t=>e>=t.top&&e<t.bottom))}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const t="number"==typeof e?e:e.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}get firstVisibleRow(){return this.rows.find((e=>e.bottom>this.grid.scrollable.y))}get firstFullyVisibleRow(){return this.rows.find((e=>e.top>=this.grid.scrollable.y))}get lastVisibleRow(){const e=this.grid;return ArrayHelper.findLast(this.rows,(t=>t.top<e.scrollable.y+e.bodyHeight))}offsetRows(e){if(0!==e){const{rows:t}=this,{length:r}=t;for(let n=0;n<r;n++)t[n].offset(e)}this.trigger("offsetRows",{offset:e})}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:r,fixedRowHeight:n}=t,i=t.rowHeight;if(ObjectHelper.assertNumber(e,"rowHeight"),e<10&&(e=10),t.trigger("beforeRowHeight",{height:e}),t.minRowHeight=t._rowHeight=e,t.prependBufferHeight=t.prependRowBuffer*t.rowOffsetHeight,t.appendBufferHeight=t.appendRowBuffer*t.rowOffsetHeight,n&&(t.averageRowHeight=e),t.rows.length){const s=r.scrollable.y,o=t.getRowAt(s,!0),a=o?o.top-s:0;let l,c;n?(l=e,c=i):(c=l=t.averageRowHeight,t.clearKnownHeights(),l*=e/i),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(l+r._rowBorderHeight),!0),t.refresh();s*(l/c)!==s&&r.scrollRowIntoView(o.id,{block:"start",edgeOffset:a})}t.trigger("rowHeight",{height:e})}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(e,t){const r=this,{heightMap:n}=r;r.fixedRowHeight||(n.has(e)&&(r.totalKnownHeight-=n.get(e)),n.set(e,t),r.totalKnownHeight+=t,t<r.minRowHeight&&(r.minRowHeight=t),r.averageRowHeight=r.totalKnownHeight/n.size)}getOffsetHeight(e){const t=this;return(t.heightMap.get(e.id)||t.grid.getRowHeight(e)||t.averageRowHeight||t.rowHeight)+t.grid._rowBorderHeight}invalidateKnownHeight(e){const t=this;if(!t.fixedRowHeight){const{heightMap:r}=t;Array.isArray(e)||(e=[e]),e.forEach((e=>{e&&r.has(e.id)&&(t.totalKnownHeight-=r.get(e.id),r.delete(e.id))})),t.averageRowHeight=t.totalKnownHeight/r.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{store:t}=this;let r=0;for(let n=0;n<e;n++){const e=t.getAt(n);r+=this.getOffsetHeight(e)}return Math.floor(r)}getRecordCoords(e,t=!1,r=!1){const n=this,i="string"==typeof e||"number"==typeof e?e:e.id,s=n.getRowById(e);let o=n.client._bodyRectangle;return t||(o=n.client._bodyRectangle=Rectangle.client(n.client.bodyContainer)),s?new Rectangle(o.x,t?Math.round(s.top):Math.round(s.top+o.y-n.client.scrollable.y),o.width,s.offsetHeight):n.getRecordCoordsByIndex(n.store.indexOf(i),t,r)}getRecordCoordsByIndex(e,t=!1,r=!1){const n=this,{topRow:i,bottomRow:s}=n,o=n.client._bodyRectangle,{id:a}=n.store.getAt(e),l=n.preciseRowOffsetHeight,c=i.dataIndex,d=s.dataIndex,u=e>d?{index:e-d-1,y:s.bottom,from:"bottomRow"}:e>c/2?{index:e-c,y:i.top,from:"topRow"}:{index:e,y:0,from:"top"},h=n.allHeightsKnown&&!r?n.calculateTop(e):Math.floor(u.y+u.index*l),g=new Rectangle(o.x,t?h:h+o.y-n.client.scrollable.y,o.width,Math.floor(n.heightMap.get(a)||l));return g.virtual=!0,g.block=g.bottom<o.y?"start":g.y>o.bottom?"end":"nearest",g}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(e,t){const r=this.getRowFor(e);if(r){const e=r.getCell(t);if(e)return r.renderCell(e),!0}return!1}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null){const t=this,{rows:r,store:n}=t,i=n.count;if(0===t.calculateRowCount(!1,i<r.length,!0))return;let s,o=e?r.indexOf(e):0,a=e?e.dataIndex:r[0].dataIndex,l=i-a-1,c=Math.min(r.length-1,o+l),d=r.length-c-1,u=o>0?r[o-1].bottom:r[o].top;for(let e=o;e<=c;e++)s=r[e],s.dataIndex=a,s.setTop(u,!0),s.render(a,n.getAt(a++),!1),u+=s.offsetHeight;for(;d-- >0;)t.displayRecordAtTop();t.estimateTotalHeight(!0),t.trigger("renderDone")}renderRows(e){let t,r=!1;(e=Array.from(e)).sort(((e,t)=>e.dataIndex-t.dataIndex));for(const n of e)t=n.height,n.render(null,null,!1),r|=n.height!==t;r&&this.translateFromRow(e[0]),this.trigger("renderDone")}translateFromRow(e,t=!1){const r=this;let n,i,s=e.bottom;for(i=e.dataIndex+1,n=r.getRow(i);n;n=r.getRow(++i))n.setTop(s),s+=n.offsetHeight;t||r.estimateTotalHeight(!0)}refresh(){const e=this,{topRow:t}=e;t&&(e.idMap={},e.renderFromRow(t),e.trigger("refresh"))}jumpToPosition(e,t){const r=this,{store:n,heightMap:i}=r,s=n.count;if(r.allHeightsKnown&&!r.fixedRowHeight){const t=e-r.prependBufferHeight,o=r.grid._rowBorderHeight;let a=0,l=0;for(;a<t;){const e=n.getAt(l);a+=i.get(e.id)+o,l++}const c=Math.max(Math.min(l,s-r.rowCount),0);r.lastScrollTop=e,r.topRow.dataIndex=r.topIndex=c,r.topRow.setTop(r.calculateTop(c),!1),r.refresh()}else{const n=r.preciseRowOffsetHeight,i=null==t?Math.floor(e/n)-r.prependRowBuffer:t-Math.floor(r.rowCount/2),o=Math.max(Math.min(i,s-r.rowCount),0),a=r.client.scrollable.y,l=Math.min(r.client._bodyRectangle.height+a+r.appendBufferHeight,r.totalHeight);if(r.lastScrollTop=e,r.topRow.dataIndex=r.topIndex=o,r.topRow.setTop(Math.floor(o*n),!1),r.refresh(),r.bottomRow.bottom<l)for(r.calculateRowCount(!1,!1,!1);r.bottomRow.bottom<l&&r._rows[r.prependRowBuffer].top<a&&r.bottomRow.dataIndex<s-1;)r.displayRecordAtBottom();r.estimateTotalHeight()}if(null!=t){const{scrollable:n}=r.grid,i=r.getRow(t),s=i&&Rectangle.from(i._elementsArray[0]).center.y,o=n.viewport.center.y;i&&(n.y=e=Math.floor(n.y+(s-o)))}return e}warpIfNeeded(e){const t=this,r={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(r.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let n;t.scrollTargetRecordId&&(n=t.store.indexOf(t.scrollTargetRecordId)),r.newScrollTop=t.jumpToPosition(e,n),r.deltaTop=0}return r}updateRenderedRows(e,t,r=!1){const n=this,i=n.client._bodyRectangle;if(0===n.rowCount)return 0;let s=n.totalHeight;if(t||Math.abs(e-n.lastScrollTop)>=n.rowOffsetHeight||n.topRow.top>e||n.bottomRow.bottom<e+i.height){const t=n.warpIfNeeded(e);n.scrollTargetRecordId=null,n.lastScrollTop=t.newScrollTop,t.deltaTop>0?n.fillBelow(t.newScrollTop):t.deltaTop<0&&n.fillAbove(t.newScrollTop),n.fixedRowHeight||r||n.correctError(t,i,e),s=n.estimateTotalHeight()}return s}correctError(e,t,r){const n=this;let i=0;(n.allHeightsKnown||e.deltaTop<0&&r<2*t.height||e.deltaTop>0&&r>n.totalHeight-2*t.height-3)&&(i=n.topRow.top-n.calculateTop(n.topRow.dataIndex)),i&&(n.offsetRows(-i),n.grid.scrollable.y=n.lastScrollTop=n.grid.scrollable.y-i)}fillAbove(e){const t=this,r=e-t.topRow.top-t.prependBufferHeight;let n=0;for(;n>r&&t.topIndex>0;)n-=t.displayRecordAtTop();t.trigger("renderDone")}fillBelow(e){const t=this,r=e-t.topRow.top-t.prependBufferHeight,n=t.store.count,i=t.rowCount;let s=0;for(;s<r&&t.topIndex+i<n&&t.topRow.top+t.topRow.offsetHeight<e;)s+=t.displayRecordAtBottom();t.trigger("renderDone")}estimateTotalHeight(e=!1){const t=this;if(t.grid.renderingRows)return;const r=t.store.count,n=r-t.heightMap.size,{bottomRow:i}=t;let s;if(t.fixedRowHeight)s=r*t.rowOffsetHeight;else{if(s=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+n*t.preciseRowOffsetHeight,i&&n){const e=i.bottom;(e>s||t.topIndex+t.rowCount>=r&&s>e)&&(s=e,i.dataIndex<r-1&&(s+=(r-1-i.dataIndex)*t.preciseRowOffsetHeight))}s=Math.floor(s)}return s!==t.totalHeight&&!1!==t.trigger("changeTotalHeight",{totalHeight:s,immediate:e})&&(t._totalHeight=s),s}displayRecordAtTop(){const e=this,t=e.topIndex-1,r=e.store.getAt(t),n=e.bottomRow,i=n.top;return e.trigger("beforeTranslateRow",{row:n,newRecord:r}),n._top=e.topRow.top-e.getOffsetHeight(r),n.estimatedTop=!e.fixedRowHeight,n.render(t,r,!1),n._top=i,n.setBottom(e.topRow.top),n.estimatedTop=!1,e.topIndex--,e._rows.unshift(e._rows.pop()),n.offsetHeight}displayRecordAtBottom(){const e=this,t=e.topIndex+e.rowCount,r=e.store.getAt(t),n=e.topRow;return e.trigger("beforeTranslateRow",{row:n,newRecord:r}),n.dataIndex=t,n.setTop(e.bottomRow.bottom),n.render(t,r,!1),e.topIndex++,e._rows.push(e._rows.shift()),n.offsetHeight}get widgetClass(){}}RowManager._$name="RowManager";const xAxis$1={x:1};class GridScroller extends Scroller{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=xAxis$1){if("string"==typeof t&&(t={[t]:1}),t.x)for(let t=0;t<this.xScrollers.length;t++)this.xScrollers[t].addPartner(e.xScrollers[t],"x");t.y&&super.addPartner(e,"y")}updateOverflowX(e){this.xScrollers&&this.xScrollers.forEach((t=>t.overflowX=e)),this.widget.virtualScrollers.classList[!1===e?"add":"remove"]("b-hide-display")}scrollIntoView(e,t){if(1!==e.nodeType)return super.scrollIntoView(e,t);for(const r of this.xScrollers)if(r.element.contains(e))return r.scrollIntoView(e,t)}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}}GridScroller._$name="GridScroller";class Header extends Bar{static get $name(){return"Header"}static get type(){return"gridheader"}startConfigure(e){e.scrollable.overflowX="hidden-scroll",super.startConfigure(e)}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=e,this.id=e.id+"-header"}get region(){return this.subGrid&&this.subGrid.region}template(){const e=this.region;return TemplateHelper.tpl`
            <div class="b-grid-header-scroller b-grid-header-scroller-${e}">
                <div data-reference="headersElement" class="b-grid-headers b-grid-headers-${e}" data-region="${e}" data-max-depth="${this.maxDepth}" data-reference="headersElement"></div>
            </div>
        `}get overflowElement(){return this.headersElement}contentTemplate(e){const t=this;return e.hidden?"":TemplateHelper.tpl`
                <div class="b-grid-header" data-column="${e.field||""}" data-column-id="${e.id}" ${e.isFocusable?'tabindex="0"':""}>
                    <div class="b-grid-header-text">
                        <div class="b-grid-header-text-content"></div>
                    </div>
                    ${e.children?`\n                    <div class="b-grid-header-children">\n                            ${e.children.map((e=>t.contentTemplate(e))).join("")}\n                    </div>\n                    `:""}
                    <div class="b-grid-header-resize-handle"></div>
                </div>
            `}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach((t=>{e+=t.calculateMinWidth()})),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse((t=>{const r=e.getBarCellElement(t.id);if(r){const n=new DomClassList({"b-grid-header":1,"b-grid-header-parent":t.isParent,["b-level-"+t.childLevel]:1,["b-depth-"+t.meta.depth]:1,["b-grid-header-align-"+t.align]:t.align,"b-grid-header-resizable":t.resizable&&t.isLeaf,[t.cls]:t.cls,"b-last-parent":t.isParent&&t.isLastInSubGrid,"b-last-leaf":t.isLeaf&&t.isLastInSubGrid});let i=t.text;r.className=n,t.headerRenderer&&(i=t.headerRenderer.call(t.thisObj||e,{column:t,headerElement:r})),t.icon&&(i=`<i class="${t.icon}"></i>`+(i||""));const s=r.querySelector(".b-grid-header-text-content");s&&(s.innerHTML=i||"")}})),e.fixHeaderWidths()}get columns(){const e=this,t=super.columns;return e.columnsDetacher||(e.columnsDetacher=t.on({change(){e.initDepths()},thisObj:e}),e.initDepths()),t}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,t=null){let r=this,n=0;t&&t.meta&&t.meta.depth++;for(const i of e)i.meta.depth=0,i.children&&(r.initDepths(i.children.filter(r.columns.chainedFilterFn),i),i.meta.depth&&t&&(t.meta.depth+=i.meta.depth)),i.meta.depth>n&&(n=i.meta.depth);return t||(r.maxDepth=n),n}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;e.content=e.columns.topColumns.map((t=>e.contentTemplate(t))).join(""),e.refreshHeaders()}onPaint({firstPaint:e}){e&&this.refreshContent()}}Header.initClass(),Header._$name="Header";const gridElementEventHandlers={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",mouseover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keydown:"onElementKeyDown",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu"};var GridElementEvents=e=>class extends(e||Base){static get $name(){return"GridElementEvents"}static get defaultConfig(){return{longPressTime:400}}initInternalEvents(){const e=Object.keys(gridElementEventHandlers),t=e.length,r={element:this.element,thisObj:this};for(let n=0;n<t;n++)r[e[n]]="handleEvent";EventHelper.on(r),EventHelper.on({focus:"onGridElementFocus",element:this.focusElement,thisObj:this})}getCellDataFromEvent(e){const t=this,r=DomHelper.up(e.target,".b-grid-cell");if(r){const e=DomDataStore.get(r),{id:n,columnId:i}=e,s=t.store.getById(n),o=t.columns.getById(i);return s?{cellElement:r,cellData:e,columnId:i,id:n,record:s,column:o,cellSelector:{id:n,columnId:i}}:null}}getHeaderDataFromEvent(e){const t=DomHelper.up(e.target,".b-grid-header");if(t){const e=ObjectHelper.assign({},t.dataset),{columnId:r}=e,n=this.columns.getById(r);return n?{headerElement:t,headerData:e,columnId:r,column:n}:null}}handleEvent(e){this.disabled||(this.event=e,gridElementEventHandlers[e.type]&&this[gridElementEventHandlers[e.type]](e))}onElementTouchStart(e){const t=this,r=t.getCellDataFromEvent(e);DomHelper.isTouchEvent=!0,1===e.touches.length&&(t.longPressTimeout=t.setTimeout((()=>{t.onElementLongPress(e),e.preventDefault(),t.longPressPerformed=!0}),t.longPressTime)),r&&!e.defaultPrevented&&t.onFocusGesture(r,e)}onElementTouchMove(e){const t=this;t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementTouchEnd(e){const t=this;t.longPressPerformed&&(e.cancelable&&e.preventDefault(),t.longPressPerformed=!1),t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementLongPress(e){}triggerCellMouseEvent(e,t){const r=this,n=r.getCellDataFromEvent(t);if(n){const i=r.columns.getById(n.columnId);r.trigger("cell"+StringHelper.capitalize(e),{grid:this,record:n.record,column:i,cellSelector:n.cellSelector,cellElement:n.cellElement,target:t.target,event:t})}}onElementMouseDown(e){const t=this,r=t.getCellDataFromEvent(e);t.skipFocusSelection=!0,t.triggerCellMouseEvent("mousedown",e),r&&!e.defaultPrevented&&t.onFocusGesture(r,e)}onElementMouseMove(e){this.mouseMoveEvent=e}onElementMouseUp(e){}onHandleElementClick(e){!1!==this.trigger("beforeElementClick",{event:e})&&this.onElementClick(e)}onElementClick(e){const t=this,r=t.getCellDataFromEvent(e);r&&(t.triggerCellMouseEvent("click",e),DomDataStore.get(r.cellElement).row.removeCls("b-hover"))}onFocusGesture(e,t){e&&this.focusCell(e.cellSelector,{scroll:!1,doSelect:!0,event:t})}onElementDblClick(e){const t=this,r=e.target;if(t.triggerCellMouseEvent("dblClick",e),r.classList.contains("b-grid-header-resize-handle")){const e=DomHelper.up(r,".b-grid-header");t.columns.getById(e.dataset.columnId).resizeToFitContent()}}onElementMouseOver(e){if(!this.scrolling){const t=DomHelper.up(e.target,".b-grid-cell");if(t){const r=DomDataStore.get(t).row;!r||"number"==typeof e.buttons&&0!==e.buttons||(this.hoveredRow=r),this.triggerCellMouseEvent("mouseOver",e)}this.trigger("mouseOver",{event:e})}}onElementMouseOut(e){if(this.hoveredRow=null,!this.scrolling){DomHelper.up(e.target,".b-grid-cell")&&this.triggerCellMouseEvent("mouseOut",e),this.trigger("mouseOut",{event:e})}}set hoveredRow(e){const t=this;t._hoveredRow&&!t._hoveredRow.isDestroyed&&(t._hoveredRow.removeCls("b-hover"),t._hoveredRow=null),e&&!t.scrolling&&(t._hoveredRow=e,e.addCls("b-hover"))}onElementKeyDown(e){const t=this;if(e.handled)return;const r=t.focusedCell;if(e.target.matches(".b-grid-header.b-depth-0"))t.handleHeaderKeyDown(e);else if(e.target===t.focusElement||BrowserHelper.isIE11&&e.currentTarget===t.focusElement){if(t.handleViewKeyDown(e),r){var n;const i=r.element,s=t.columns.getById(i.dataset.columnId);null===(n=s.onCellKeyDown)||void 0===n||n.call(s,{event:e,cellElement:i})}}else if("Escape"===e.key&&t.isActionableLocation){const e=ObjectHelper.clone(r);e.element=null,t.focusCell(e),DomHelper.focusWithoutScrolling(t.element)}}handleViewKeyDown(e){const t=this;switch(e.key){case"ArrowLeft":return e.preventDefault(),t.navigateLeft(e);case"ArrowRight":return e.preventDefault(),t.navigateRight(e);case"ArrowUp":return e.preventDefault(),t.navigateUp(e);case"ArrowDown":return e.preventDefault(),t.navigateDown(e)}}handleHeaderKeyDown(e){const t=this,r=t.columns.getById(e.target.dataset.columnId);switch(r.onKeyDown&&r.onKeyDown(e),e.key){case"ArrowLeft":t.onHeaderLeftKey(r);break;case"ArrowRight":t.onHeaderRightKey(r);break;case"ArrowDown":e.preventDefault(),t.onHeaderDownKey(r);break;case"Enter":t.onHeaderEnterKey(r)}}onHeaderLeftKey(e){const t=this.columns.getAdjacentVisibleLeafColumn(e,!1);t&&this.getHeaderElement(t.id).focus()}onHeaderRightKey(e){const t=this.columns.getAdjacentVisibleLeafColumn(e,!0);t&&this.getHeaderElement(t.id).focus()}onHeaderDownKey(e){const t=this.firstFullyVisibleRow;t&&this.focusCell({columnId:e.id,id:t.id})}onHeaderEnterKey(e){this.getHeaderElement(e.id).click()}onElementKeyPress(e){}onElementKeyUp(e){}onElementContextMenu(e){const t=this,r=t.getCellDataFromEvent(e);r&&(t.triggerCellMouseEvent("contextMenu",e),DomHelper.isTouchEvent&&t.onFocusGesture(r,e))}onInternalResize(e,t,r,n,i){const s=this;s._devicePixelRatio&&s._devicePixelRatio!==window.devicePixelRatio&&DomHelper.resetScrollBarWidth(),s._devicePixelRatio=window.devicePixelRatio,s._bodyRectangle=Rectangle.client(s.bodyContainer),super.onInternalResize(...arguments),r!==i&&(s._bodyHeight=s.bodyContainer.offsetHeight,s.isPainted&&s.rowManager.initWithHeight(s._bodyHeight)),s.refreshVirtualScrollbars(),t!==n&&s.setTimeout((()=>{s.isDestroyed||s.updateResponsive(t,n)}),0)}get widgetClass(){}};const validConfigTypes={string:1,object:1,function:1};var GridFeatures=e=>class extends(e||Base){static get $name(){return"GridFeatures"}set features(e){const t=this,r=GridFeatureManager.getInstanceDefaultFeatures(this);e=t._features=ObjectHelper.assign({},e),r&&Object.keys(r).forEach((t=>{t in e||(e[t]=!0)}));const n=GridFeatureManager.getInstanceFeatures(this);for(const r of Object.keys(e)){const i=e[r];if(i){if(StringHelper.uncapitalize(r)!==r)throw new Error(`Invalid feature name '${r}', must start with a lowercase letter`);const s=n[r];if(!s)throw new Error(`Feature '${r}' not available, make sure you have imported it`);Reflect.defineProperty(e,r,t.createFeatureInitializer(e,r,s,i))}}}get features(){return this._features}createFeatureInitializer(e,t,r,n){const i=[this],s=r.prototype.construct;return validConfigTypes[typeof n]&&(i[1]=n),{configurable:!0,get:()=>(delete e[t],r.prototype.construct=function(...n){e[t]=this,s.apply(this,n),r.prototype.construct=s},new r(...i))}}hasFeature(e){return!(!this.features||!this.features[e])}get widgetClass(){}};const defaultFocusOptions=Object.freeze({doSelect:!0}),disableScrolling=Object.freeze({x:!1,y:!1});var GridNavigation=e=>class extends(e||Base){static get $name(){return"GridNavigation"}get focusedCell(){const e=this._focusedCell;if(e&&this.getCell(e))return e;this.clearFocus()}get isActionableLocation(){const e=this._focusedCell;return Boolean(e&&e.element&&this.getCell(e).contains(e.element))}set focusedCell(e){this.focusCell(e,{doSelect:!1})}get focusedRecord(){if(this._focusedCell)return this.store.getById(this._focusedCell.id)}get cellCSSSelector(){const e=this._focusedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.index}] [data-column-id=${e.columnId}]`:""}onGridElementFocus(e){const t=this,r={doSelect:!1,event:e};if(t._initialFocusedCellContext){const{cellSelector:e,options:r}=t._initialFocusedCellContext;t._focusedCell=null,t.focusCell(e,r),t._initialFocusedCellContext=null}else if(t._focusedCell)t.focusCell(t._focusedCell,r);else{const n=t.element.contains(e.relatedTarget)?null:t.lastFocusedCell;if(n){const e=t.getCell(n);if(!e||!DomHelper.isVisible(e)||!t.store.getById(n.id))return void t.revertFocus();t.returningFocus=!0,t.focusCell(n,r),t.returningFocus=!1}else if(!t.scrolling&&!t.skipFocusSelection&&t.store.first){const{mouseMoveEvent:e,rowManager:n,_bodyRectangle:i}=t,s=e&&n.getRowAt(Math.min(Math.max(e.clientY,i.y),i.bottom))||t.firstFullyVisibleRow,o=e&&t.getCellDataFromEvent(e)||{id:s.id,columnId:t.columns.visibleColumns[0].id};t.getCell(o)&&t.focusCell(o,r)}}t.skipFocusSelection=!1}onFocusOut(e){super.onFocusOut(e),this.clearFocus()}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=this.mouseMoveEvent=null}isFocused(e){return Boolean(this._focusedCell)&&this.isLocationEqual(e,this._focusedCell)}focusCell(e,t=defaultFocusOptions){var r,n,i;if(!document.hasFocus()&&BrowserHelper.isMac&&2===(null===(r=t)||void 0===r||null===(n=r.event)||void 0===n?void 0:n.button))return;const s=this,{activeElement:o}=DomHelper;e=s.normalizeCellContext(e===Object?Object.assign({},e):e);const a=!1!==t.doSelect,{event:l,scroll:c}=t,d=s.lastFocusedCell=s._focusedCell,u=s.isLocationEqual(e,d),h=d&&s.getCell(d),g=s.getSubGridFromColumn(e.columnId);let m=s.getCell(e);if(l&&"mousedown"===l.type)for(let t=l.target;t!==m;t=t.parentElement)if(DomHelper.isFocusable(t))return void(e.element=t);if(u)return l&&s.onCellNavigate&&s.onCellNavigate(s,null,s._focusedCell,l,a),e;h&&h.classList.remove("b-focused");const p=m||s.getCell({row:s.rowManager.topIndex,columnId:e.columnId}),f=Rectangle.from(g.element),v=Rectangle.from(s.bodyContainer),y=Rectangle.from(p).moveTo(null,f.y);return!1===c?t=Object.assign({},t,disableScrolling):(t=Object.assign({},t,c),y.width>f.width||y.height>v.height?t.x=t.y=!1:t.column=e.columnId,s.scrollRowIntoView(e.id,t)),o===s.focusElement||s.focusElement.contains(o)||(null===(i=Widget.fromElement(o))||void 0===i?void 0:i.owner)===s?(m=s.getCell(e),m&&(e.element=m,m.classList.add("b-focused")),s._focusedCell=e,s.onCellNavigate&&s.onCellNavigate(s,d,s._focusedCell,l,a),s.trigger("navigate",{lastFocusedCell:d,focusedCell:s._focusedCell,event:l}),e):(s._initialFocusedCellContext={cellSelector:e,options:t},DomHelper.focusWithoutScrolling(s.focusElement),void(s.isLocationEqual(e,s._focusedCell)||BrowserHelper.isIE11||(s._initialFocusedCellContext=null)))}isLocationEqual(e,t){return e&&t&&e.id===t.id&&e.columnId===t.columnId&&(!e.element||!t.element||e.element===t.element)}blurCell(e){const t=this.getCell(e);t&&t.classList.remove("b-focused")}clearFocus(){const e=this;e._focusedCell&&(e.lastFocusedCell=e._focusedCell,e.blurCell(e._focusedCell),e._focusedCell=null)}internalNextPrevCell(e=!0,t){const r=this,n=r._focusedCell;return n?r.focusCell({id:n.id,columnId:r.columns.getAdjacentVisibleLeafColumn(n.columnId,e,!0).id},{doSelect:!0,event:t}):null}navigateRight(e){return this.internalNextPrevCell(!0,e)}navigateLeft(e){return this.internalNextPrevCell(!1,e)}internalNextPrevRow(e,t=!0,r){const n=this,i=n._focusedCell;if(!i)return!1;const s=n.store["get"+(e?"Next":"Prev")](i.id,!1,t);return s?n.focusCell({id:s.id,columnId:i.columnId,scroll:{x:!1}},{doSelect:!0,event:r}):e?void 0:(this.clearFocus(),this.getHeaderElement(i.columnId).focus())}navigateDown(e){return this.internalNextPrevRow(!0,!1,e)}navigateUp(e){return this.internalNextPrevRow(!1,!1,e)}get widgetClass(){}},GridResponsive=e=>class extends(e||Base){static get $name(){return"GridResponsive"}static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(e){let t=this,r=Object.keys(t.responsiveLevels),n=null,i=99995,s=null;return r.forEach((r=>{let o=t.responsiveLevels[r];if(["number","string"].includes(typeof o)||(o=o.levelWidth),"*"===o)s=r;else if(e<o){const t=o-e;t<i&&(i=t,n=r)}})),n||s}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(e,t){const r=this,n=r.getClosestBiggerLevel(t),i=r.getClosestBiggerLevel(e);if(n!==i){const s=r.responsiveLevels[i];["number","string"].includes(typeof s)||r.applyState(s),r.columns.forEach((e=>{const t=e.responsiveLevels;t&&(t[i]?e.applyState(t[i]):t["*"]&&e.applyState(t["*"]))})),r.element.classList.remove("b-responsive-"+n),r.element.classList.add("b-responsive-"+i),r.trigger("responsive",{level:i,width:e,oldLevel:n,oldWidth:t})}}get widgetClass(){}};const validIdTypes={string:1,number:1},isSelectAction={dataset:1,batch:1};var GridSelection=e=>class extends(e||Base){static get $name(){return"GridSelection"}static get defaultConfig(){return{selectionMode:{row:!0,cell:!0,rowCheckboxSelection:!1,multiSelect:!0,checkbox:!1,showCheckAll:!1},selectedRecordCollection:{}}}afterConfigure(){const e=this;if(e.selectionMode.checkbox){const t=ColumnStore.getColumnClass("check");if(!t)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const r=e.checkboxColumn=new t({id:e.id+"-selection-column",width:"4em",minWidth:"4em",field:null,cellCls:"b-checkbox-selection",region:e.items[0].region,showCheckAll:e.selectionMode.showCheckAll},e.columns);r.meta.depth=0,r._grid=e;const n=r.renderer;r.renderer=t=>{t.value=e.isSelected(t.record),n.call(r,t)},r.on({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:e});const i=e.columns.indexOf(e.columns.findRecord("type","rownumber"))+1;e.columns.insert(i,r)}super.afterConfigure()}onStoreRecordIdChange({record:e,oldValue:t}){super.onStoreRecordIdChange&&super.onStoreRecordIdChange(...arguments);this.selectedRecordCollection.get(t)===e&&this.selectedRecordCollection.rebuildIndices()}onSelectedRecordCollectionChange({source:e,action:t,added:r=[],removed:n}){const i=this;i._selectedCell&&!i.isSelectable(i._selectedCell)&&i.deselectCell(i._selectedCell),r=r.filter((e=>i.isSelectable(e))),i.triggerChangeEvent({mode:"row",action:r.length?"select":"deselect",selection:i.selectedRecords,selected:r,deselected:n},i.silent)}onCheckChange({source:e,checked:t,record:r}){t?(this.selectRow({record:r,column:e,addToSelection:!1!==this.selectionMode.multiSelect,scrollIntoView:!1}),e.headerCheckbox&&this.selectedRecords.length===this.store.count-(this.store.groupRecords?this.store.groupRecords.length:0)&&(e.suspendEvents(),e.headerCheckbox.checked=!0,e.resumeEvents())):(this.deselectRow(r),e.headerCheckbox&&(e.suspendEvents(),e.headerCheckbox.checked=!1,e.resumeEvents()))}onCheckAllChange({checked:e}){this[e?"selectAll":"deselectAll"]()}set selectedRecordCollection(e){e instanceof Collection||(e=new Collection(e)),this._selectedRecordCollection=e,e.on({change:"onSelectedRecordCollectionChange",thisObj:this})}get selectedRecordCollection(){return this._selectedRecordCollection}spliceSelectedRecords(e,t,r){this._selectedRecordCollection.splice(e,t,r)}isSelected(e){var t;const r=this;return(null===(t=e)||void 0===t?void 0:t.isModel)&&(e=e.id),validIdTypes[typeof e]?r.selectedRecordCollection.includes(e):r._selectedCell&&r._selectedCell.id==e.id&&r._selectedCell.columnId===e.columnId}isSelectable(e){if(!e)return!1;const t=this.store.getById(e.id||e);return t&&!(t.meta&&t.isSpecialRow)}get selectedCell(){return this._selectedCell}set selectedCell(e){this.selectCell(e)}set selectionMode(e){e&&e.rowCheckboxSelection&&(e.row=e.checkbox=!0,e.cell=!1),this._selectionMode=e}get selectionMode(){return this._selectionMode}get selectedRecord(){return this.selectedRecordCollection.last||null}set selectedRecord(e){this.selectRow({record:e})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(e){const{selectedRecordCollection:t,store:r}=this,n=[];if(e)for(let t of e)t=r.getById(t),t&&n.push(t);t.splice(0,t.count,n)}get selectedCellCSSSelector(){const e=this._selectedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.dataIndex}] [data-column-id=${e.columnId}]`:""}selectRow({record:e,column:t=this.columns.bottomColumns[0],scrollIntoView:r=!0,addToSelection:n=!1}){if("object"!=typeof arguments[0]){const t=arguments;e=t[0],r=!(t.length>1)||t[1],n=t[2]||!1}const i=this,s=i.store.getById(e);e?i.selectCell({id:s.id,column:t},r,n):i.deselectAll()}selectCell(e,t=!1,r=!1,n=!1){const i=this,{selectedRecordCollection:s,selectionMode:o}=i,a=i.normalizeCellContext(e),l=a.record||i.store.getById(a.id);if(i.isSelectable(l)){if(t&&i.scrollRowIntoView(a.id,{column:a.columnId}),o.row&&(n&&(i.silent=(i.silent||0)+1),r?s.add(l):s.splice(0,s.count,l),n&&i.silent--,1===i.selectedRecordCollection.count&&(i.startCell=a,i.lastRange=null)),o.cell&&(a.columnId||a.column)&&!i.isSelected(a)){const e=i._selectedCell?[i._selectedCell]:[];i._selectedCell=a,i.triggerChangeEvent({mode:"cell",action:"select",selected:[a],deselected:e,selection:[a]},n)}return a}this.deselectAll()}selectAll(){const e=this;e.store.isFiltered?e.selectedRecordCollection.add(...e.store.records.filter((e=>!e.isSpecialRow))):e.selectedRecords=e.store.records.filter((e=>!e.isSpecialRow))}deselectAll(){const e=this;e.store.isFiltered?e.selectedRecordCollection.remove(...e.store.records.filter((e=>!e.isSpecialRow))):e.selectedRecordCollection.clear(),e._selectedCell&&e.deselectCell(e._selectedCell)}deselectRow(e){this.deselectRows(e)}deselectRows(e){const t=(e=Array.isArray(e)?e:[e]).map((e=>this.store.getById(e)));this.selectedRecordCollection.remove(t)}deselectCell(e){const t=this,r=t.normalizeCellContext(e),n=t.selectionMode,i=r.record||t.store.getById(r.id),s=t._selectedCell;return n.row&&t.selectedRecordCollection.remove(i),n.cell&&r.columnId&&s&&s.id===r.id&&s.columnId===r.columnId&&(t._selectedCell=null,t.triggerChangeEvent({mode:"cell",action:"deselect",selected:[],deselected:[r],selection:[]})),r}selectRange(e,t){const{store:r,selectedRecordCollection:n}=this,i=r.indexOf(e),s=r.indexOf(t),o=Math.min(i,s),a=Math.max(i,s);if(-1===o||-1===a)throw new Error("Record not found in selectRange");n.splice(0,n.count,r.getRange(o,a+1,!1))}onStoreRemove(e){super.onStoreRemove&&super.onStoreRemove(e),this.selectedRecordCollection.remove(e.records)}onStoreDataChange({action:e,source:t}){if(super.onStoreDataChange&&super.onStoreDataChange(...arguments),isSelectAction[e]){const e=this.selectedRecordCollection,r=[];e.forEach((n=>{if(t.includes(n)){const r=e.indexOf(n);e.splice(r,1,t.getById(n.id))}else r.push(n)})),e.remove(r)}}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(),this.deselectAll()}handleMouseMultiSelect(e,t){const r=this,n=e.id;(t.metaKey||t.ctrlKey)&&r.isSelected(n)?r.deselectRow(n):r.selectionMode.multiSelect&&(t.shiftKey&&r.startCell?function(e,t){const{store:n,selectedRecordCollection:i}=r,s=n.indexOf(e),o=n.indexOf(t),a=Math.min(s,o),l=Math.max(s,o);if(-1===a||-1===l)throw new Error("Record not found in selectRange");const c=n.getRange(a,l+1,!1).filter((e=>r.isSelectable(e)));i.splice(0,r.lastRange||0,c),r.lastRange=c}(r.startCell.id,n):(t.ctrlKey||t.metaKey)&&r.selectRow({record:n,scrollIntoView:!1,addToSelection:!0}))}onCellNavigate(e,t,r,n,i=!0){if(e.columns.getById(r.columnId)===e.checkboxColumn||e.selectionMode.rowCheckboxSelection)return;if(!i||e.returningFocus||n&&n.target.closest(".b-tree-expander"))return;const s=t&&r.id===t.id,o=n&&"mousedown"===n.type&&n.ctrlKey;if(!n||n.button&&2!==n.button||!n.shiftKey&&!o){const t=s&&(!n||n.shiftKey||n.ctrlKey),i=n&&e.isSelected(r.id),a=o;e.selectCell(r,!1,t||a||i)}else e.handleMouseMultiSelect(r,n);e.startCell&&!o||(e.startCell=r,e.lastRange=null)}triggerChangeEvent(e,t){const r=this,{mode:n,selected:i,deselected:s}=e;let o,a,l,c;if("row"===n){for(o=0,a=i.length;o<a;o++)l=r.getRowFor(i[o]),l&&(l.addCls("b-selected"),!r.checkboxColumn||r.checkboxColumn.hidden||i[o].isSpecialRow||(l.getCell(r.checkboxColumn.id).widget.checked=!0));for(o=0,a=s.length;o<a;o++)l=r.getRowFor(s[o]),l&&(l.removeCls("b-selected"),!r.checkboxColumn||r.checkboxColumn.hidden||s[o].isSpecialRow||(l.getCell(r.checkboxColumn.id).widget.checked=!1))}else if("cell"===n){for(o=0,a=i.length;o<a;o++)c=r.getCell(i[o]),c&&c.classList.add("b-selected");for(o=0,a=s.length;o<a;o++)c=r.getCell(s[o]),c&&c.classList.remove("b-selected")}t||r.trigger("selectionChange",e)}onCellClick({event:e,record:t}){const r=this;r.selectionMode.checkbox||!r.selectionMode.multiSelect||e.shiftKey||e.metaKey||e.ctrlKey||r.deselectRows(r.selectedRecords.filter((e=>e!==t)))}get widgetClass(){}};const suspendStoreEvents=e=>e.columns.suspendEvents(),resumeStoreEvents=e=>e.columns.resumeEvents(),fillSubGridColumns=e=>{e.columns.clearCaches(),e.columns.fillFromMaster()},compareStateSortIndex=(e,t)=>e.stateSortIndex-t.stateSortIndex;var GridState=e=>class extends(e||Base){static get $name(){return"GridState"}getState(){const e=this,t=e.element.style.cssText,r={rowHeight:e.rowHeight,readOnly:e.readOnly};if(t&&(r.style=t),e.selectedCell){const{id:t,columnId:n}=e.selectedCell;r.selectedCell={id:t,columnId:n}}return r.selectedRecords=e.selectedRecords.map((e=>e.id)),r.columns=e.columns.map((e=>e.getState())),r.store=e.store.state,r.scroll=e.storeScroll(),r.subGrids={},e.eachSubGrid((e=>{const t=r.subGrids[e.region]=r.subGrids[e.region]||{};null==e.flex&&(t.width=e.width),t.collapsed=e.collapsed})),r}applyState(e){const t=this;if("readOnly"in e&&(t.readOnly=e.readOnly),"rowHeight"in e&&(t.rowHeight=e.rowHeight),"style"in e&&(t.style=e.style),"selectedCell"in e&&(t.selectedCell=e.selectedCell),"store"in e&&(t.store.state=e.store),"selectedRecords"in e&&(t.selectedRecords=e.selectedRecords),"columns"in e){let r=!1,n=!1;t.columns.suspendEvents(),t.eachSubGrid(suspendStoreEvents),e.columns.forEach(((e,i)=>{const s=t.columns.getById(e.id);if(s){const t=s.generation;s.applyState(e),r=r||s.generation!==t,s.stateSortIndex=i,s.allIndex!==i&&(n=r=!0)}})),r&&t.eachSubGrid(fillSubGridColumns),n&&(t.eachSubGrid((e=>{e.columns.records.sort(compareStateSortIndex),e.columns.allRecords.sort(compareStateSortIndex)})),t.columns.sort({fn:compareStateSortIndex,ascending:!0})),t.isPainted&&r&&t.renderContents(),t.columns.resumeEvents(),t.eachSubGrid(resumeStoreEvents)}"subGrids"in e&&t.eachSubGrid((t=>{if(t.region in e.subGrids){const r=e.subGrids[t.region];"width"in r&&(t.width=r.width),"collapsed"in r&&(t.collapsed=r.collapsed)}})),"scroll"in e&&t.restoreScroll(e.scroll)}get widgetClass(){}};const immediatePromise$4=Promise.resolve(),defaultScrollOptions$1={block:"nearest"};class SubGridScroller extends Scroller{scrollIntoView(e,t=defaultScrollOptions$1){const{xDelta:r,yDelta:n}=this.getDeltaTo(e,t),i=r||n?this.scrollBy(r,n,t):immediatePromise$4;return(t.highlight||t.focus)&&i.then((()=>{t.highlight&&(e instanceof Rectangle?e.translate(-r,-n).highlight():DomHelper.highlight(e)),t.focus&&e.focus&&e.focus()})),i}scrollBy(e,t,r){const n=t&&this.yScroller.scrollBy(0,t,r),i=e&&super.scrollBy(e,0,r);if(i&&i.cancel&&n&&n.cancel){const e=i.cancel,t=n.cancel;return i.cancel=n.cancel=()=>{e(),t()},Promise.all([i,n])}return i||n||immediatePromise$4}scrollTo(e,t,r){const n=null!=t&&this.yScroller.scrollTo(null,t,r),i=null!=e&&super.scrollTo(e,null,r);if(r&&r.animate||this.syncPartners(),i&&i.cancel&&n&&n.cancel){const e=i.cancel,t=n.cancel;return i.cancel=n.cancel=()=>{e(),t()},Promise.all([i,n])}return i||n||immediatePromise$4}get viewport(){const e=Rectangle.from(this.element);return e.intersect(Rectangle.from(this.yScroller.element))||new Rectangle(e.x,e.y,e.width,0)}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}}SubGridScroller._$name="SubGridScroller";class SubGrid extends Widget{static get $name(){return"SubGrid"}static get type(){return"subgrid"}static get defaultConfig(){return{localizableProperties:["emptyText"],insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,collapsed:null,scrollable:{overflowX:!0},scrollerClass:SubGridScroller,hasCalculatedWidth:null,sealedColumns:null,emptyText:null}}static get configurable(){return{element:!0,header:!0,footer:!0,virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0}}construct(e){super.construct(e),this.rowManager.on("addrows",this.onAddRow,this)}doDestroy(){var e;const t=this;t.header.destroy(),t.footer.destroy(),null===(e=t.fakeScroller)||void 0===e||e.destroy(),t.virtualScrollerElement.remove(),t.splitterElement.remove(),t.headerSplitter.remove(),t.scrollerSplitter.remove(),t.footerSplitter.remove(),super.doDestroy()}get barConfig(){const e=this,{width:t,flex:r}=e.element.style,n={subGrid:e,parent:e};return r?n.flex=r:t&&(n.width=t),n}changeHeader(){return new this.headerClass(this.barConfig)}changeFooter(){return new this.footerClass(this.barConfig)}toggleSplitterCls(e,t=!0){const r=this;[r.splitterElement,r.headerSplitter,r.footerSplitter,r.scrollerSplitter].forEach((r=>null==r?void 0:r.classList[t?"add":"remove"](e)))}changeElement(e){const{region:t}=this;super.changeElement({className:{"b-grid-subgrid":1,["b-grid-subgrid-"+t]:1,"b-grid-horizontal-scroller":1,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:t}})}get rowElementConfig(){return{className:"b-grid-row",children:this.columns.visibleColumns.map((e=>({className:"b-grid-cell",dataset:{column:e.field||"",columnId:e.id}})))}}changeVirtualScrollerElement(){const e=DomHelper.createElement({reference:"virtualScrollerElement",className:"b-virtual-scroller",dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}changeSplitterElement(){const e=DomHelper.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{tag:"i",className:"b-icon b-icon-collapse-gridregion"},{tag:"i",className:"b-icon b-icon-expand-gridregion"}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return DomHelper.createElement(this.splitterConfig)}changeScrollerSplitter(){return DomHelper.createElement(this.splitterConfig)}changeFooterSplitter(){return DomHelper.createElement(this.splitterConfig)}hideSplitter(){this.splitterElement.classList.add("b-hide-display"),this.headerSplitter.classList.add("b-hide-display"),this.scrollerSplitter.classList.add("b-hide-display"),this.footerSplitter.classList.add("b-hide-display"),this.$showingSplitter=!1}showSplitter(){this.splitterElement.classList.remove("b-hide-display"),this.headerSplitter.classList.remove("b-hide-display"),this.scrollerSplitter.classList.remove("b-hide-display"),this.footerSplitter.classList.remove("b-hide-display"),this.$showingSplitter=!0}render(...e){const t=this;super.render(...e),t.grid&&(t.updateHasFlex(),t.element.parentNode.insertBefore(t.splitterElement,t.element.nextElementSibling),EventHelper.on({element:t.grid.element,delegate:`.b-grid-splitter[data-region=${t.region}]`,mouseover:"onSplitterMouseOver",mouseout:"onSplitterMouseOut",thisObj:t}),t._collapsed&&t.collapse())}refreshHeader(){this.header.refreshContent()}refreshFooter(){var e;null===(e=this.footer)||void 0===e||e.refreshContent()}eachWidget(e,t=!0){const r=[this.header,this.footer];for(let n=0;n<r.length;n++){const i=r[n];if(!1===e(i))return;t&&i.eachWidget&&i.eachWidget(e,t)}}fixCellWidths(e,t=null){t||(t=this.columns.bottomColumns.filter((e=>!e.hidden)));let r=e.firstElementChild,n=0;for(;r;){const e=t[n];e.minWidth&&(r.style.minWidth=DomHelper.setLength(e.minWidth)),e.flex?(r.style.flex=e.flex,r.style.width=""):e.width?(r.style.width=DomHelper.setLength(e.width),BrowserHelper.isIE11&&(r.style.flex="",r.style.minWidth=DomHelper.setLength(e.calcMinWidth))):r.style.flex=r.style.width=r.style.minWidth="",r=r.nextElementSibling,n++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:r,footer:n}=e;if(!e.collapsed){if(e.flex)r.flex=e.flex,n&&(n.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some((e=>!e.hidden&&e.flex))&&e.totalFixedWidth!==e.width)return e.width=e.totalFixedWidth,void(e.hasCalculatedWidth=!0);let i=e.width;if(!i){i=0;for(const t of e.columns)t.flex||t.hidden||(i+=t.width)}t.style.width=i+"px",r.width=i,n&&(n.width=i)}e.syncScrollingPartners(!1)}}fixRowWidthsInSafariEdge(){if(BrowserHelper.isSafari||BrowserHelper.isEdge){const e=this,{region:t,header:r}=e,n=r.calculateMinWidthForSafari();e.rowManager.forEach((e=>{const r=e.getElement(t);r&&(r.style.width=n+"px")})),r.headersElement.style.width=n+"px"}}set width(e){const t=this;t.hasCalculatedWidth=!1,super.width=e,t.header.width=e,t.footer.width=e,t.isPainted&&t.onElementResize()}get width(){return super.width}set flex(e){const t=this;t.hasCalculatedWidth=!1,t.header.flex=e,t.footer.flex=e,super.flex=e,t.isPainted&&t.onElementResize()}get flex(){return super.flex}onInternalResize(e,t,r,n,i){const s=this,{grid:o}=s;super.onInternalResize(e,t,r,n,i),o&&(s.syncSplitterButtonPosition(),t!==n&&(o.trigger("horizontalScroll",{subGrid:s,grid:o,scrollLeft:s.scrollable.x}),s.refreshFakeScroll(),s.fixRowWidthsInSafariEdge()),s.trigger("afterInternalResize",s))}syncParallelSplitters(e){const t=this,{grid:r}=t;if(t.splitterElement&&t.$showingSplitter)t.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const n=r.getSubGrid(r.getPreviousRegion(t.region));n&&n.splitterElement&&n.syncParallelSplitters(e)}}onSplitterMouseOver(){const e=this,{nextSibling:t}=e;e.collapsed||t&&t.collapsed||e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseOut(){const e=this,{nextSibling:t}=e;e.toggleSplitterCls("b-hover",!1),e.collapsed||t&&t.collapsed||e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.on({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const e=this;e.splitterButtons.style.transform=`translateY(${e.grid.scrollable.y+e.grid.bodyHeight/2-(e.headerSplitter?e.grid.headerHeight:0)}px)`}get viewRectangle(){const e=this;return new Rectangle(e.scrollable.x,e.scrollable.y,e._width||0,e.rowManager.viewHeight)}updateHasFlex(){const e=this.columns.visibleColumns.some((e=>e.flex));DomHelper.toggleClasses(this.element,["b-has-flex"],e)}get overflowingHorizontally(){const{scrollable:e}=this;return e.scrollWidth>e.clientWidth+(BrowserHelper.isEdge?1:0)}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:r,virtualScrollerWidth:n,totalFixedWidth:i,store:s,header:o,footer:a}=e,l=e.scrollable;l.scrollWidth=(null==s?void 0:s.count)?null:i,r.style.width=t.style.width,r.style.flex=t.style.flex,e.collapsed||(e.overflowingHorizontally?(n.style.width=l.scrollWidth+"px",o.element.classList.add("b-overflowing"),a.element.classList.add("b-overflowing"),e.grid.virtualScrollers.classList.remove("b-hide-display")):(n.style.width=0,o.element.classList.remove("b-overflowing"),a.element.classList.remove("b-overflowing")))}initScroll(){const e=this,t=e.scrollable,r=e.virtualScrollerElement;e.syncPartnersOnFrame=e.createOnFrame(e.syncScrollingPartners),BrowserHelper.isFirefox&&t.element.addEventListener("wheel",(e=>{e.deltaX&&(t.x+=e.deltaX,e.preventDefault())})),t.yScroller=e.grid.scrollable,t.yScroller.addScroller(t),e.fakeScroller=new Scroller({element:r,overflowX:!0}),t.on({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),t.addPartner(e.fakeScroller,"x"),t.addPartner(e.header.scrollable,"x"),t.addPartner(e.footer.scrollable,"x")}onSubGridScrollEnd(){this.forceScrollUpdate||this.syncScrollingPartners(),this.scrolling=!1}onSubGridScroll(){this.forceScrollUpdate?(this.syncScrollingPartners(),this.forceScrollUpdate=!1):this.syncPartnersOnFrame()}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}syncScrollingPartners(e=!0){const t=this,{grid:r}=t;!t.scrolling&&e&&(t.scrolling=!0),r.trigger("horizontalScroll",{subGrid:t,grid:r,scrollLeft:t.scrollable.x})}scrollColumnIntoView(e,t){const r=this,n=r.header.scrollable;if(e=e instanceof Column?e:r.columns.get(e)||r.columns.getById(e)||r.columns.getAt(e)){const i=r.header.getHeader(e.id);if(i)return n.scrollIntoView(Rectangle.from(i,null,!0),t)}}onAddRow({rows:e}){const t=this,r=t.rowElementConfig,n=t.columns.bottomColumns.filter((e=>!e.hidden)),i=document.createDocumentFragment();e.forEach((e=>{const s=DomHelper.createElement(r);i.appendChild(s),e.addElement(t.region,s),t.fixCellWidths(s,n)})),t.fixRowWidthsInSafariEdge(),t.element.insertBefore(i,t.insertRowsBefore)}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=DomHelper.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}get emptyText(){return this._emptyText}set emptyText(e){this._emptyText=e,this.element.dataset.emptyText=e}toggleTransitionClasses(e=!1){const t=this,r=t.grid,n=r.getSubGrid(r.getNextRegion(t.region)),i=r.resolveSplitter(n);n.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),n.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),i.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){const e=this,t=e.grid,r=t.getSubGrid(t.getNextRegion(e.region)),n=e.splitterElement?e:e.previousSibling;let i=0;return t.eachSubGrid((t=>{t!==e&&!t._collapsed&&++i})),0===i&&await r.expand(),new Promise((t=>{if(!e._beforeCollapseState){e._beforeCollapseState={};let n=!1;e.width&&(n=!0,e.on({afterinternalresize:()=>{t(e)},thisObj:e,once:!0})),e._beforeCollapseState.width=e.width,e._beforeCollapseState.elementWidth=e.element.style.width,""===r.element.style.flex&&(e._beforeCollapseState.nextRegionWidth=r.width,r.width+=e._beforeCollapseState.width),""!==e.element.style.flex&&(e._beforeCollapseState.flex=e.element.style.flex,e.header.element.style.flex=e.element.style.flex=""),e.element.classList.add("b-grid-subgrid-collapsed"),e.virtualScrollerElement.classList.add("b-collapsed"),e.header.element.classList.add("b-collapsed"),e.footer.element.classList.add("b-collapsed"),e.width="",e._collapsed=!0,n||t(!1)}})).then((t=>{e.isDestroyed||!1===t||(e.syncParallelSplitters(!0),e.grid.trigger("subGridCollapse",e),n.startSplitterButtonSyncing&&n.startSplitterButtonSyncing())}))}async expand(){const e=this,t=e.grid,r=t.getSubGrid(t.getNextRegion(e.region)),n=e.splitterElement?e:e.previousSibling;return new Promise((t=>{if(null!=e._beforeCollapseState){let n=!1;e.width!==e._beforeCollapseState.elementWidth&&(n=!0,e.on({afterinternalresize:()=>{e.setTimeout((()=>t(e)),10)},thisObj:e,once:!0})),""===r.element.style.flex&&(r.width=e._beforeCollapseState.nextRegionWidth),e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,e.virtualScrollerElement.classList.remove("b-collapsed"),e.header.element.classList.remove("b-collapsed"),e.footer.element.classList.remove("b-collapsed"),e._beforeCollapseState.flex?(e.width=e._beforeCollapseState.width,e.header.flex=e.flex=e._beforeCollapseState.flex,e.footer.flex=e._beforeCollapseState.flex,e._width=null):e.width=e._beforeCollapseState.elementWidth,e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,n||t(!1),delete e._beforeCollapseState}})).then((t=>{!1!==t&&(n.stopSplitterButtonSyncing(),e.syncParallelSplitters(!1),e.grid.trigger("subGridExpand",e))}))}}SubGrid.initClass(),SubGrid._$name="SubGrid";var GridSubGrids=e=>class extends(e||Base){static get $name(){return"GridSubGrids"}static get properties(){return{subGrids:{},regions:[]}}changeSubGridConfigs(e){const t=this,r=new Set;for(const n of t.columns)n.region&&!e[n.region]&&(e[n.region]={}),r.add(n.region);e.normal&&ObjectHelper.isEmpty(e.normal)&&(e.normal=GridBase.defaultConfig.subGridConfigs.normal);for(const n of r)t.createSubGrid(n,e[n]);return t.items=Object.values(t.subGrids),e}createSubGrid(e,t=null){const r=this,n=r.columns.makeChained((t=>t.region===e),["region"]),i=ObjectHelper.assign({grid:r,store:r.store,rowManager:r.rowManager,region:e,headerClass:r.headerClass,footerClass:r.footerClass,columns:n,weight:e},t||r.subGridConfigs[e]);r.regions.push(e);let s=!1;i.flex||i.width||(i.width=n.totalFixedWidth,s=!0);const o=r.subGrids[e]=new SubGrid(i);return o.hasCalculatedWidth=s,e===r.regions[0]&&(o.isFirstRegion=!0),o}onChildAdd(e){if(e.isSubGrid){const t=this,{items:r,headerContainer:n,virtualScrollers:i,footerContainer:s}=t,o=2*r.indexOf(e);t.hideHeaders||(DomHelper.insertAt(n,e.headerSplitter,o),DomHelper.insertAt(n,e.header.element,o)),DomHelper.insertAt(i,e.scrollerSplitter,o),DomHelper.insertAt(i,e.virtualScrollerElement,o),DomHelper.insertAt(s,e.footerSplitter,o),DomHelper.insertAt(s,e.footer.element,o),r.forEach(((e,t)=>{t<r.length-1&&e.showSplitter()}))}return super.onChildAdd(e)}onChildRemove(e){super.onChildRemove(e);const{items:t}=this;delete this.subGrids[e.region],ArrayHelper.remove(this.regions,e.region),e.destroy(),t.length&&t[t.length-1].hideSplitter()}doDestroy(){this.eachSubGrid((e=>e.destroy())),super.doDestroy()}eachSubGrid(e,t=null){this.items.forEach(((r,n)=>{e.call(t||r,r,n++)}))}eachWidget(e,t=!0){this.items.forEach((r=>{!1!==e(r)&&t&&r.eachWidget&&r.eachWidget(e,t)}))}callEachSubGrid(e,...t){let r=null;return this.items.forEach(((n,i)=>{if(n[e]){const s=n[e](...t);0===i&&(r=s)}})),r}getLastRegions(){const e=this.regions.slice(-2);return 2===e.length?e:[e[0],e[0]]}getNextRegion(e){const t=this.regions;return t[t.indexOf(e)+1]||t[t.length-2]}getPreviousRegion(e){return this.regions[this.regions.indexOf(e)-1]}getSubGrid(e){return this.subGrids[e]}getSubGridFromColumn(e){return e=e instanceof Column?e:this.columns.get(e)||this.columns.getById(e),this.getSubGrid(e.region)}resolveSplitter(e){const t=this.getLastRegions();let r=e instanceof SubGrid?e.region:e;return t[1]===r&&(r=t[0]),this.subGrids[r].splitterElement}get widgetClass(){}};const locale$2=LocaleHelper.mergeLocales(locale$1,{ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",loadMask:"Loading...",syncMask:"Saving changes, please wait...",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",removeRow:"Delete record",removeRows:"Delete records",moveColumnTo:e=>"Move column to "+e},CellMenu:{removeRow:"Delete record",removeRows:"Delete records"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages..."},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`}});LocaleManagerSingleton.registerLocale("En",{desc:"English",locale:locale$2});const resolvedPromise=new Promise((e=>e())),storeListenerName$1="GridBase:store",defaultScrollOptions$2={block:"nearest",inline:"nearest"},preserveScroll={dataset:1,filter:1};class GridBase extends(Panel.mixin(Pluggable,State,GridElementEvents,GridFeatures,GridNavigation,GridResponsive,GridSelection,GridState,GridSubGrids)){static get $name(){return"GridBase"}static get type(){return"gridbase"}static get delayable(){return{onGridScroll:{type:"raf"},bufferedAfterColumnsResized:250}}static get configurable(){return{enableSticky:null,subGridConfigs:{normal:{flex:1}},hideFooters:!0}}static get defaultConfig(){return{rowHeight:null,fixedRowHeight:null,defaultRowHeight:45,emptyText:"L{noRows}",fullRowRefresh:!0,hideHeaders:null,showRemoveRowInContextMenu:!0,autoHeight:null,store:{},data:null,columns:[],defaultRegion:"normal",destroyStore:null,enableTextSelection:null,loadMask:"L{loadMask}",loadMaskDefaults:{useTransition:!0,showDelay:1e3},loadMaskError:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},maskDefaults:{cover:"body",target:"element"},syncMask:"L{syncMask}",columnLines:!0,fillLastColumn:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!BrowserHelper.isIE11,disableGridRowModelWarning:null,headerClass:Header,footerClass:Footer,testPerformance:!1,positionMode:"translate",rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:GridScroller,scrollManager:null,showDirty:null,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText","loadMask","syncMask"],asyncEventSuffix:""}}static getLKey(){return"bf757ffb-df5b-11e9-9294-d094663d5c88"}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}static get deprecatedEvents(){return{cellContextMenuBeforeShow:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`cellContextMenuBeforeShow` event is deprecated, in favor of `cellMenuBeforeShow` event. Please see https://bryntum.com/docs/grid/#guides/upgrades/4.0.0.md for more information."},cellContextMenuShow:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`cellContextMenuShow` event is deprecated, in favor of `cellMenuShow` event. Please see https://bryntum.com/docs/grid/#guides/upgrades/4.0.0.md for more information."},headerContextMenuBeforeShow:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`headerContextMenuBeforeShow` event is deprecated, in favor of `headerMenuBeforeShow` event. Please see https://bryntum.com/docs/grid/#guides/upgrades/4.0.0.md for more information."},headerContextMenuShow:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`headerContextMenuShow` event is deprecated, in favor of `headerMenuShow` event. Please see https://bryntum.com/docs/grid/#guides/upgrades/4.0.0.md for more information."},contextMenuItem:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`contextMenuItem` event is deprecated, in favor of `cellMenuItem` and `headerMenuItem` events. Please see https://bryntum.com/docs/grid/#guides/upgrades/4.0.0.md for more information."},contextMenuToggleItem:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`contextMenuToggleItem` event is deprecated, in favor of `cellMenuToggleItem` and `headerMenuToggleItem` events. Please see https://bryntum.com/docs/grid/#guides/upgrades/4.0.0.md for more information."}}}finishConfigure(e){const t=this;super.finishConfigure(e),t.scrollManager=new ScrollManager(ObjectHelper.assign({grid:t,verticalElement:t.scrollable.element},t.scrollManager)),LocaleManagerSingleton.on({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),LocaleManagerSingleton.on({locale:"onLocaleChange",prio:-1,thisObj:t}),GlobalEvents.on({theme:"onThemeChange",thisObj:t}),t.on({subGridExpand:"onSubGridExpand",prio:-1,thisObj:t}),t.bufferedFixElementHeights=t.buffer("fixElementHeights",350,t),t.setGridClassList(t.element.classList)}updateEnableSticky(e){this.positionMode=e?"position":"translate",this.element.classList[e?"add":"remove"]("b-enable-sticky")}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}doDestroy(){const e=this;e.detachListeners("GridBase:store");for(const t of Object.values(e.features))t.destroy&&t.destroy();e.columns&&(e.columns=null),e.store&&(e.store=null),super.doDestroy()}setGridClassList(e){const t=this;e.add("b-grid-"+t.positionMode),t.enableTextSelection||e.add("b-grid-notextselection"),t.autoHeight&&e.add("b-autoheight"),t.fillLastColumn&&e.add("b-fill-last-column"),t.showDirty&&e.add("b-show-dirty");for(const r in t.features){const n=t.features[r];let i;i=Object.prototype.hasOwnProperty.call(n.constructor,"featureClass")?n.constructor.featureClass:"b-"+(n instanceof Base?n.$$name:n.constructor.name),i&&e.add(i.toLowerCase())}}get bodyConfig(){return{reference:"bodyElement",className:"b-grid-panel-body",children:[{tag:"header",reference:"headerContainer",className:{"b-grid-header-container":1,"b-hidden":this.hideHeaders}},{reference:"bodyContainer",className:"b-grid-body-container",tabIndex:-1,children:[{reference:"verticalScroller",className:"b-grid-vertical-scroller"}]},{reference:"virtualScrollers",className:"b-virtual-scrollers",style:BrowserHelper.isFirefox?{height:DomHelper.scrollBarWidth+"px"}:void 0},{tag:"footer",reference:"footerContainer",className:{"b-grid-footer-container":1,"b-hidden":this.hideFooters}}]}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}get focusElement(){return this.bodyContainer}updateHideFooters(e){var t;null===(t=this.footerContainer)||void 0===t||t.classList[e?"add":"remove"]("b-hidden")}set columns(e){const t=this;var r,n;t._columnStore?e?t._columnStore.data=e:t._columnStore.destroy():(e instanceof ColumnStore?(e.grid||(e.grid=t),t._columnStore=e):Array.isArray(e)?t._columnStore=new ColumnStore({grid:t,data:e}):e&&(t._columnStore=new ColumnStore(Object.assign({grid:t},e))),t._columnStore.on("change",t.onColumnsChanged,t),t._columnStore.on((r=t.onColumnsResized,n=t,{update:({store:e,record:t,changes:i})=>{let s=!0;return("width"in i||"minWidth"in i||"flex"in i)&&(s=r.call(n,{store:e,record:t,changes:i})),s}})),BrowserHelper.isTouchDevice&&(t.touch=!0,t._columnStore.forEach((e=>{const t=e.touchConfig;t&&e.applyState(t)}))))}get columns(){return this._columnStore}onColumnsChanged({action:e,changes:t,record:r}){const n=this;if(n.isPainted){if("update"===e){if("width"in t||"minWidth"in t||"flex"in t){const e=r.region;return void n.columns.visibleColumns.forEach((t=>{t.region===e&&t.repaintOnResize&&n.refreshColumn(t)}))}if("hidden"in t){const e=n.getSubGridFromColumn(r.id);e.header.fixHeaderWidths(),e.footer.fixFooterWidths(),e.updateHasFlex()}}if("dataset"===e||"update"===e&&"region"in t){const e=n.columns.getDistinctValues("region"),{toRemove:t,toAdd:r}=ArrayHelper.delta(e,n.regions,!0);n.remove(t.map((e=>n.getSubGrid(e)))),n.add(r.map((e=>n.createSubGrid(e))))}n._suspendRenderContentsOnColumnsChanged||n.renderContents()}}onColumnsResized({changes:e,record:t}){const r=this,n=DomHelper.setLength(t.width),i=DomHelper.setLength(t.minWidth),s=r.getSubGridFromColumn(t.id);s.header.fixHeaderWidths(),s.footer.fixFooterWidths(),s.updateHasFlex(),r.cellEls&&t===r.lastColumnResized||(r.cellEls=DomHelper.children(r.element,`.b-grid-cell[data-column-id="${t.id}"]`),r.lastColumnResized=t);for(const s of r.cellEls){var o;if("width"in e&&(s.style.width=n,BrowserHelper.isIE11&&(s.style.flex="",s.style.minWidth=DomHelper.setLength(t.calcMinWidth))),"minWidth"in e&&(s.style.minWidth=i),"flex"in e)s.style.flex=null!==(o=t.flex)&&void 0!==o?o:null}r.resizingColumns||r.afterColumnsResized()}afterColumnsResized(){const e=this;e.eachSubGrid((e=>{e.collapsed||(e.fixWidths(),e.fixRowWidthsInSafariEdge())})),e.lastColumnResized=e.cellEls=null,e.bufferedAfterColumnsResized()}bufferedAfterColumnsResized(){this.refreshVirtualScrollbars(),this.eachSubGrid((e=>{e.collapsed||e.refreshFakeScroll()})),this.onHeightChange()}processCellEditor(e){}get rowManager(){const e=this;return e._isRowMeasured||e.measureRowHeight(),e._rowManager||(e._rowManager=new RowManager({grid:e,rowHeight:e.rowHeight,rowScrollMode:e.rowScrollMode||"move",autoHeight:e.autoHeight,fixedRowHeight:e.fixedRowHeight,listeners:{changeTotalHeight:e.onRowManagerChangeTotalHeight,requestScrollChange:e.onRowManagerRequestScrollChange,thisObj:e}}))}getRowHeight(e){return e.rowHeight}bindStore(e){const t=this.asyncEventSuffix;e.on({name:"GridBase:store",["refresh"+t]:"onStoreDataChange",["add"+t]:"onStoreAdd",["remove"+t]:"onStoreRemove",["move"+t]:"onStoreMove",["replace"+t]:"onStoreReplace",["removeAll"+t]:"onStoreRemoveAll",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",clearChanges:"onStoreDataChange",exception:"onStoreException",commit:"onStoreCommit"},this)}unbindStore(e){this.detachListeners("GridBase:store"),this.destroyStore&&e.destroy()}get store(){return this._store}set store(e){const t=this,{rowManager:r}=t,n=t.initialConfig.features,i=t._store;if(e!==i)if(i&&t.unbindStore(i),e){if("string"==typeof e&&(e=Store.getStore(e)),e instanceof Store);else{const r={};t.data&&(r.data=t.data),(null==n?void 0:n.tree)&&(r.tree=!0),e.modelClass||(r.modelClass=class extends GridRowModel{}),e=new(e.readUrl?AjaxStore:Store)(Object.assign(r,e))}t._store=e,t.bindStore(e),t.isPainted&&!t.refreshSuspended&&r.reinitialize()}else t._store=null}onStoreUpdateRecord({source:e,record:t,changes:r}){const n=this;if(n.forceFullRefresh)n.rowManager.refresh(),n.forceFullRefresh=!1;else{let i;if(t.isFieldModified("id")&&(i=n.getRowFor(t.meta.modified.id)),i=i||n.getRowFor(t),!i)return;if(n.fullRowRefresh||t.isSpecialRow){const r=e.indexOf(t);-1!==r&&i.render(r,t)}else n.columns.visibleColumns.forEach((e=>{const n=e.field;if(!(e.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(e.data,"renderer"))||r[n]){const e=i.getCell(n);e&&i.renderCell(e,t)}}))}}refreshFromRowOnStoreAdd(e,t){const r=this,{rowManager:n}=r;n.renderFromRow(e),n.trigger("changeTotalHeight",{totalHeight:n.totalHeight}),1===r.store.count&&r.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(e){super.onMaskAutoClose(e),this.toggleEmptyText()}onStoreAdd({source:e,records:t,index:r,oldIndex:n,isChild:i,oldParent:s,isMove:o,isExpandAll:a}){if(!this.isPainted||a)return;if(i&&!t[0].ancestorsExpanded(e))return;this.rowManager.calculateRowCount(!1,!0,!0);const l=this,{rowManager:c}=l,{topIndex:d,rows:u,rowCount:h}=c,g=c.topIndex+c.rowCount-1,m=r,p=r+t.length-1,f=g>=e.count-t.length-1;if(s||n>-1||i&&o)c.refresh();else if(m>=d&&m<d+h)l.refreshFromRowOnStoreAdd(u[m-d],...arguments);else if(p>=d&&p<d+h)c.refresh();else{const{totalHeight:e}=c.totalHeight;f&&r>g&&c.fillBelow(l._scrollTop||0),e!==c.totalHeight&&c.trigger("changeTotalHeight",{totalHeight:c.totalHeight})}}onStoreException({action:e,type:t,response:r,exceptionType:n,error:i}){const s=this;let o;switch(t){case"server":o=r.message||s.L("L{unspecifiedFailure}");break;case"exception":o="network"===n?s.L("L{networkFailure}"):i&&i.message||s.L("L{parseFailure}")}if(s.masked){const t=`<div class="b-grid-load-failure">\n                    <div class="b-grid-load-fail">${s.L("read"===e?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>\n                    <div class="b-grid-load-fail">${r&&r.url?r.url+" responded with":""}</div>\n                    <div class="b-grid-load-fail">${o}</div>\n                </div>`;ObjectHelper.assign(s.masked.errorDefaults,s.loadMaskError),s.masked.error=t}}onStoreDataChange({action:e,changes:t,source:r}){if(this.suspendRendering)return;super.onStoreDataChange&&super.onStoreDataChange(...arguments);const n=this,i=r.isGrouped&&t&&r.groupers.some((e=>e.field in t));"dataset"===e&&n.rowManager.clearKnownHeights(),n.isPainted&&!i&&n.renderRows(null,e in preserveScroll),n.toggleEmptyText()}onStoreRecordIdChange(){super.onStoreRecordIdChange&&super.onStoreRecordIdChange(...arguments)}onStoreBeforeRequest(){const e=this.loadMask;e&&(this.masked=Mask.mergeConfigs(this.loadMaskDefaults,e))}onStoreAfterRequest(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove(){const e=this._features;return(null==e?void 0:e.group)&&!e.group.disabled||(null==e?void 0:e.groupSummary)&&!e.groupSummary.disabled}onStoreRemove({records:e,isCollapse:t,isChild:r,isMove:n,isCollapseAll:i}){if(!this.isPainted||n||i)return;super.onStoreRemove&&super.onStoreRemove(...arguments);let s=2**53-1;const o=this,{rowManager:a}=o,l=e.reduce(((e,t)=>{const r=a.getRowById(t.id);return r&&(e.push(r),s=Math.min(s,a.rows.indexOf(r))),e}),[]);if(a.invalidateKnownHeight(e),o.animateRemovingRows&&l.length&&!t&&!r){const e=l[0];o.isAnimating=!0,EventHelper.onTransitionEnd({element:e._elementsArray[0],property:"left",duration:o.transitionDuration,thisObj:o,handler(){o.isAnimating=!1,l.forEach((e=>!e.isDestroyed&&e.removeCls("b-removing"))),a.refresh(),o.trigger("rowRemove")}}),l.forEach((e=>e.addCls("b-removing")))}else o.needsFullRefreshOnStoreRemove(...arguments)?a.refresh():(a.calculateRowCount(!1,!0,!0),a.rows[s]?a.renderFromRow(a.rows[s]):a.trigger("changeTotalHeight",{totalHeight:a.totalHeight}),o.trigger("rowRemove",{isCollapse:t}))}onStoreMove({from:e,to:t}){const{rowManager:r}=this,{topIndex:n,rowCount:i}=r,[s,o]=[e,t].sort();s>=n&&s<n+i?r.renderFromRow(r.rows[s-n]):o>=n&&o<n+i&&r.refresh()}onStoreReplace({records:e,all:t}){const{rowManager:r}=this;if(t)r.clearKnownHeights(),r.refresh();else{const t=e.reduce(((e,[,t])=>{const r=this.getRowFor(t);return r&&e.push(r),e}),[]);r.invalidateKnownHeight(e),r.renderRows(t)}}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const t=[];e.modified.forEach((e=>{const r=this.rowManager.getRowFor(e);r&&t.push(r)})),this.rowManager.renderRows(t)}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}get emptyText(){return this._emptyText}set emptyText(e){this._emptyText=e,this.eachSubGrid((t=>t.emptyText=e))}populateHeaderMenu({column:e,items:t}){const r=this,{subGrids:n,regions:i}=r;let s=!0;Object.entries(n).forEach((([o,a])=>{if(!a.sealedColumns&&e.draggable&&o!==e.region&&(!e.parent&&n[e.region].columns.count>1||e.parent&&e.parent.children.length>1)){const l=a.element.compareDocumentPosition(n[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,c=i.length>2?r.L("L{moveColumnTo}",r.optionalL(o)):r.L(l?"L{moveColumnRight}":"L{moveColumnLeft}");t[o+"Region"]={targetSubGrid:o,text:c,icon:"b-fw-icon "+(l?"b-icon-column-move-right":"b-icon-column-move-left"),name:"moveColumn",cls:s?"b-separator":"",onItem:({item:t})=>{e.traverse((e=>e.region=o)),r.columns.insert(r.columns.indexOf(n[t.targetSubGrid].columns.last)+1,e),r.scrollColumnIntoView(e)}},s=!1}}))}populateCellMenu({record:e,items:t}){var r;const n=this;if((null===(r=n.features)||void 0===r?void 0:r.contextMenu)&&!n.features.contextMenu.disabled&&n.showRemoveRowInContextMenu&&!n.readOnly&&e&&!e.isSpecialRow){const r=n.selectedRecords.length>1;t.removeRow={text:r?"L{removeRows}":"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",name:r?"removeRows":"removeRow",onItem:()=>n.store.remove(r?n.selectedRecords:e)}}}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const{columns:t,store:r}=this;if(e instanceof r.modelClass)return{record:e,id:e.id,columnId:t.bottomColumns[0].id};if(!("columnId"in e)){if("field"in e){const r=t.get(e.field);e.columnId=r&&r.id}else if("column"in e){const r="number"==typeof e.column?t.bottomColumns[e.column]:e.column;e.columnId=r&&r.id}"columnId"in e||(e.columnId=t.bottomColumns[0].id)}if("id"in e){if(e.element&&!r.getById(e.id)){const t=this.getRecordFromElement(e.element);t&&(e.id=t.id)}}else{const t="row"in e?r.getAt(e.row):e.record;t&&(e.id=t.id)}return e}getCell(e){let t,r=null;return"id"in(e=this.normalizeCellContext(e))&&(t=this.getRowById(e.id)),t&&"columnId"in e&&(r=t.getCell(e.columnId)),r}getHeaderElement(e){return"string"!=typeof e&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(e){const t=DomHelper.up(e,".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const r=DomDataStore.get(t);return this.columns.getById(r.columnId)}get autoHeight(){return this._autoHeight}set autoHeight(e){ObjectHelper.assertBoolean(e,"autoHeight"),this._autoHeight=e}get columnLines(){return this._columnLines}set columnLines(e){ObjectHelper.assertBoolean(e,"columnLines"),DomHelper.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}fixSizes(){this.callEachSubGrid("fixWidths")}onRowManagerChangeTotalHeight({totalHeight:e,immediate:t}){return this.refreshTotalHeight(e,t)}refreshTotalHeight(e=this.rowManager.totalHeight,t=!1){const r=this;if(r.renderingRows||!r.isVisible)return!1;r.rowManager.bottomRow&&(e=Math.max(e,r.rowManager.bottomRow.bottom));const n=r.scrollable,i=Math.abs(r.virtualScrollHeight-e),s=r._bodyRectangle.height;if(i){const o=e-s-r._scrollTop<2*s||r._verticalScrollHeight&&r._verticalScrollHeight-s<r._scrollTop;n.scrollHeight=r.virtualScrollHeight=e,r.isPainted&&(r.scrolling&&!o||i<100)&&!t?r.bufferedFixElementHeights():(r.virtualScrollHeightDirty&&r.virtualScrollHeightDirty(),r.bufferedFixElementHeights.cancel(),r.fixElementHeights())}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,r=t+"px";e._verticalScrollHeight=t,e.verticalScroller.style.height=r,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=r,e._bodyHeight=t,e._bodyRectangle=Rectangle.client(e.bodyContainer)),e.refreshVirtualScrollbars()}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){"string"==typeof e&&(e=this.subGrids[e]),this.scrollManager.startMonitoring({element:e.element})}disableScrollingCloseToEdges(e){"string"==typeof e&&(e=this.subGrids[e]),this.scrollManager.stopMonitoring(e.element)}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this;if(!e.scrollInitialized){let t;const r=e.createOnFrame((()=>{t=e.scrollable.y,t!==e._scrollTop&&(e._scrollTop=t,e.scrolling||(e.scrolling=!0,e.eachSubGrid((e=>e.suspendResizeMonitor=!0))),e.rowManager.updateRenderedRows(t),e.trigger("scroll",{scrollTop:t}))}));e.scrollInitialized=!0,e.scrollable.on({scroll:r,scrollend(){e.scrolling=!1,e.eachSubGrid((e=>e.suspendResizeMonitor=!1))}}),e.callEachSubGrid("initScroll")}}scrollRowIntoView(e,t=defaultScrollOptions$2){const r=this,n=t.block||"nearest",{rowManager:i}=r;if(e=r.store.getById(e)){if(-1===r.store.indexOf(e))return resolvedPromise;let s=r.scrollable,o=r.getRecordCoords(e);const a=Rectangle.from(s.element);if(o.virtual){const l=o.block;if(s.scrollIntoView(o,{block:"center"}),i.scrollTargetRecordId=e,i.updateRenderedRows(s.y,!0),o=r.getRecordCoords(e),i.lastScrollTop=s.y,o.virtual)return resolvedPromise;const c="nearest"!==n?t:{block:l};if(t.animate){s.suspendEvents(),"end"===n||"nearest"===n&&"end"===l?s.y-=a.bottom-o.bottom:("start"===n||"nearest"===n&&"start"===l)&&(s.y+=o.y-a.y),i.updateRenderedRows(s.y,!1,!0),"end"===l?s.y-=i.appendRowBuffer*i.rowHeight-1:s.y+=i.prependRowBuffer*i.rowHeight-1;return s.scrollIntoView(r.getRecordCoords(e),Object.assign({},t,c)).then((()=>s.resumeEvents()))}return r.scrollRowIntoView(e,Object.assign({},t,c))}{let{column:n}=t;if(n){if("string"==typeof n&&(n=r.columns.getById(n)||r.columns.get(n)),n){s=r.getSubGridFromColumn(n).scrollable;const t=Rectangle.from(i.getRowFor(e).getCell(n.id));o.x=t.x,o.width=t.width}}else t.x=!1;return s.scrollIntoView(o,t)}}}scrollColumnIntoView(e,t){return e=e instanceof Column?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,t)}scrollCellIntoView(e,t){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},"boolean"==typeof t?{animate:t}:t))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this,t=e.storedScrollState={scrollTop:e.scrollable.y,scrollLeft:{}};return e.eachSubGrid((e=>{t.scrollLeft[e.region]=e.scrollable.x})),t}restoreScroll(e=this.storedScrollState){this.eachSubGrid((t=>{t.scrollable.x=e.scrollLeft[t.region]})),this.scrollable.y=e.scrollTop}measureRowHeight(){var e;const t=this,r=DomHelper.createElement({tag:"div",className:"b-grid "+((null===(e=t.features)||void 0===e?void 0:e.stripe)?"b-stripe":""),style:"position: absolute; visibility: hidden",html:'<div class="b-grid-subgrid"><div class="b-grid-row"></div></div>',parent:document.getElementById(t.appendTo)||document.body}),n=r.firstElementChild.firstElementChild,i=parseInt(DomHelper.getStyleValue(n,"height")),s=parseInt(DomHelper.getStyleValue(n,"border-top-width")),o=parseInt(DomHelper.getStyleValue(n,"border-bottom-width"));null!=t.rowHeight&&t.rowHeight!==t._rowHeightFromStyle||(t.rowHeight=!isNaN(i)&&i?i:t.defaultRowHeight,t._rowHeightFromStyle=t.rowHeight),t._rowBorderHeight=s+o,t._isRowMeasured=!0,r.remove()}onThemeChange({theme:e}){this.measureRowHeight(),this.trigger("theme",{theme:e})}refreshRows(e=!1){const{element:t,rowManager:r}=this;t.classList.add("b-notransition"),e?r.returnToTop():r.refresh(),t.classList.remove("b-notransition")}refreshColumn(e){if(!e.hidden){const t=e.field;this.rowManager.forEach((e=>{const r=e.getCell(t);e.renderCell(r)}))}}refreshVirtualScrollbars(){const e=this,{headerContainer:t,footerContainer:r,virtualScrollers:n,hasVerticalOverflow:i}=e,s=i?"add":"remove";Object.values(e.subGrids).some((e=>e.overflowingHorizontally))?n.classList.remove("b-hide-display"):n.classList.add("b-hide-display"),DomHelper.scrollBarWidth&&(t.classList[s]("b-show-yscroll-padding"),r.classList[s]("b-show-yscroll-padding"),n.classList[s]("b-show-yscroll-padding")),e.onHeightChange()}get hasVerticalOverflow(){const{scrollable:e}=this;return BrowserHelper.isEdge||BrowserHelper.isIE11?Math.abs(e.scrollHeight-e.clientHeight)>1:e.scrollHeight>e.clientHeight}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}get firstVisibleRow(){return this.rowManager.firstVisibleRow}get firstFullyVisibleRow(){return this.rowManager.firstFullyVisibleRow}onContentChange(){const e=this,t=e.rowManager;e.isVisible?(t.estimateTotalHeight(),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.on({paint:"onContentChange",once:!0,thisObj:e}))}onHeightChange(){const e=this;e._bodyRectangle=Rectangle.client(e.bodyContainer),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}renderHeader(e,t){}renderFooter(e,t){}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh"))}renderRows(e=!0,t=!1){const r=this,n=e&&r.storeScroll();r.refreshSuspended||(r.trigger("beforeRenderRows"),r.renderingRows=!0,r.element.classList.add("b-grid-refreshing"),t&&(r.scrollable.y=r._scrollTop=0),r.rowManager.reinitialize(t),r.trigger("renderRows"),r.renderingRows=!1,r.onContentChange(),e&&r.restoreScroll(n),r.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:t,headerContainer:r,footerContainer:n,rowManager:i}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader",r),e.callEachSubGrid("refreshFooter",n),e.renderHeader(r,t),e.renderFooter(n,t),e.fixSizes();const s=i.removeAllRows();i.calculateRowCount(!1,!0,!0),i.rowCount&&(i.setPosition(s),e.renderRows())}}onPaint(){const e=this,{rowManager:t,store:r,element:n,headerContainer:i,bodyContainer:s,footerContainer:o}=e,a=DomHelper.scrollBarPadElement;if(e.isPainted)return;let l,c=0;e.columns.on({change:()=>l=!0,single:!0}),e._bodyRectangle=Rectangle.client(e.bodyContainer);const d=e.bodyContainer.offsetHeight;e.updateResponsive(e.width,0),l&&(e.callEachSubGrid("refreshHeader",i),e.callEachSubGrid("refreshFooter",o)),e.renderHeader(i,n),e.renderFooter(o,n),DomHelper.append(i,a),DomHelper.append(o,a),DomHelper.append(e.virtualScrollers,a),e.autoHeight?(e._bodyHeight=t.initWithHeight(n.offsetHeight-i.offsetHeight-o.offsetHeight,!0),s.style.height=e.bodyHeight+"px"):(e._bodyHeight=d,t.initWithHeight(e._bodyHeight,!0)),e.eachSubGrid((e=>{e.header.maxDepth>c&&(c=e.header.maxDepth)})),i.dataset.maxDepth=c,e.fixSizes(),!r.count&&r.isLoading||e.renderRows(!1,!1),e.initScroll(),e.initInternalEvents()}render(){const e=this;e.requireSize=Boolean(e.owner),super.render(...arguments),e.autoHeight||!e.headerContainer.offsetHeight||e.bodyContainer.offsetHeight||console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget")}maskBody(e){const t=this;if(!t.bodyContainer)return;t.unmaskBody();const{maskElement:r}=t.activeMask=Mask.mask(e,t.element);return r.style.marginTop=t.bodyContainer.offsetTop+"px",r.style.height=t.virtualScrollers.offsetTop+t.virtualScrollers.offsetHeight-t.bodyContainer.offsetTop+"px",t.activeMask}unmaskBody(){const e=this;e.loadmaskHideTimer&&e.clearTimeout(e.loadmaskHideTimer),e.loadmaskHideTimer=null,e.activeMask&&e.activeMask.destroy(),e.activeMask=null}toggleEmptyText(){this.bodyContainer&&DomHelper.toggleClasses(this.bodyContainer,"b-grid-empty",!(this.rowManager.rowCount>0||this.store.isLoading||this.store.isCommitting))}}GridBase.initClass(),VersionHelper.setVersion("grid","4.0.2"),GridBase._$name="GridBase";const validNonEditingKeys={Enter:1,F2:1},validEditingKeys={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1};class CellEdit extends(Delayable(InstancePlugin)){static get $name(){return"CellEdit"}static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",addNewAtEnd:null,autoEdit:!1,editorClass:Editor,triggerEvent:"celldblclick",focusCellAnimationDuration:100}}static get pluginConfig(){return{assign:["startEditing"],before:["onElementKeyDown","onElementMouseDown"],chain:["onElementClick","bindStore"]}}construct(e,t){super.construct(e,t);const r=this,n={beforeRenderRows:"onGridBeforeRenderRows",cellClick:"onCellClick",thisObj:r};r.grid=e,"cellclick"!==r.triggerEvent&&(n[r.triggerEvent]="onTriggerEditEvent"),e.on(n),r.bindStore(e.store)}bindStore(e){this.detachListeners("store"),e.on({name:"store",update:"onStoreUpdate",thisObj:this})}async confirm(e){let t=!0;return this.editorContext&&(MessageDialogSingleton.owner=this.editorContext.editor.inputField,t=await MessageDialogSingleton.confirm(e),MessageDialogSingleton.owner=null),t===MessageDialogSingleton.yesButton}doDestroy(){this.cancelEditing(!0),this.grid.columns.allRecords.forEach((e=>{e._cellEditor&&e._cellEditor.destroy()})),super.doDestroy()}doDisable(e){e&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return Boolean(super.disabled||e.disabled||e.readOnly)}get isEditing(){return Boolean(this.editorContext)}get activeRecord(){var e;return(null===(e=this.editorContext)||void 0===e?void 0:e.record)||null}getEditorForCell({cell:e,column:t,selector:r,editor:n}){const i=this,{grid:s}=i;let o=t._cellEditor,a=0;if(t.editTargetSelector){a=e.querySelector(t.editTargetSelector).offsetLeft}return n.autoSelect=i.autoSelect,o?(o.inputField!==n&&(o.remove(o.items[0]),o.add(n)),o.align.offset[0]=a):o=t._cellEditor=new i.editorClass({constrainTo:null,cls:"b-cell-editor",inputField:n,blurAction:"none",invalidAction:t.invalidAction,completeKey:!1,cancelKey:!1,owner:s,align:{align:"t0-t0",offset:[a,0]},listeners:i.getEditorListeners()}),t.instantUpdate&&!n.cellEditValueSetter&&(ObjectHelper.wrapProperty(n,"value",null,(e=>{const{editorContext:t}=i;(null==t?void 0:t.editor.isValid)&&!ObjectHelper.isEqual(t.record[t.column.field],e)&&(t.record[t.column.field]=e)})),n.cellEditValueSetter=!0),Object.assign(o.element.dataset,{rowId:r.id,columnId:r.columnId,field:t.field}),o.inputField.revertOnEscape=t.revertOnEscape,i.editor=o}getEditorListeners(){return{focusout:"onEditorFocusOut",focusin:"onEditorFocusIn",start:"onEditorStart",beforecomplete:"onEditorBeforeComplete",complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:this}}onEditorStart({source:e}){const t=this,r=t.editorContext=e.cellEditorContext;if(r){const{grid:e}=t,{cell:n}=r;n.classList.add("b-editing"),"cellclick"!==t.triggerEvent&&e.on({cellclick:"onCellClickWhileEditing"},t),t.removeEditingListeners=GlobalEvents.addListener({globaltap:"onTapOut",thisObj:t}),e.trigger("startCellEdit",{grid:e,editorContext:r})}}onEditorBeforeComplete(e){const{grid:t}=this,r=e.source.cellEditorContext;return e.grid=t,e.editorContext=r,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,r=e.cellEditorContext;r.value=e.inputField.value,t.trigger("finishCellEdit",{grid:t,editorContext:r}),this.cleanupAfterEdit(r)}onEditorCancel(){const{editorContext:e,muteEvents:t,grid:r}=this;e&&this.cleanupAfterEdit(e),t||r.trigger("cancelCellEdit",{grid:r})}cleanupAfterEdit(e){const t=this,{editor:r}=e;e.cell.classList.remove("b-editing"),r.cellEditorContext=t.editorContext=null,t.grid.un({cellclick:"onCellClickWhileEditing",viewportResize:"onViewportResizeWhileEditing"},t),t.removeEditingListeners(),GlobalEvents.suspendFocusEvents(),r.element.remove(),GlobalEvents.resumeFocusEvents()}async getAdjacentEditableCell(e,t){const{grid:r}=this,{store:n,columns:i}=r;let s=e.id,o=e.columnId,a=i.getAdjacentLeaf(o,t);for(;s;){const r=n.getById(s);if(a){if(o=a.id,!a.hidden&&a.editor&&a.canEdit(r))return{id:s,columnId:a.id};a=i.getAdjacentLeaf(o,t)}else{const r=n.getAdjacent(e.id,t,!1,!0);s=null==r?void 0:r.id,r&&(a=t?i.first:i.leaves[i.leaves.length-1])}}return null}async doAddNewAtEnd(e){const{grid:t}=this,r=t.store.add(e)[0];return t.rowManager.getRowFor(r)||t.rowManager.displayRecordAtBottom(),r}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{grid:t}=this,r=t.columns.getById(e.columnId),n=t.store.getById(e.id);if(r&&!r.hidden&&r.editor&&n&&!n.isSpecialRow&&r.canEdit(n)){const t=null==n?void 0:n[r.field];return{column:r,record:n,value:void 0===t?null:t,selector:e,editor:r.editor}}return!1}startEditing(e={}){const t=this;if(!t.editorContext&&!t.disabled){const{grid:r}=t,n=r.normalizeCellContext(e),i=t.getEditingContext(n);if(!i)return!1;if(r.focusCell(e),i.cell=r.getCell(e),!1===r.trigger("beforeCellEditStart",{grid:r,editorContext:i}))return!1;DomHelper.focusWithoutScrolling(r.focusElement);const s=i.editor=t.getEditorForCell(i),{cell:o,record:a,column:l}=i;return s.inputField.highlightExternalChange=!1,s.cellEditorContext=i,s.render(t.grid.getSubGridFromColumn(l).element),s.startEdit({target:o,record:a,field:s.inputField.name||i.column.field}),!0}return!1}cancelEditing(e=!1){const t=this,{editorContext:r,editor:n,grid:i}=t;r&&(n.containsFocus&&(t.editorContext=null,n.inputField.owns(DomHelper.activeElement)&&DomHelper.focusWithoutScrolling(i.focusElement),t.editorContext=r),t.muteEvents=e,n.cancelEdit(),t.muteEvents=!1)}async finishEditing(){const{editorContext:e}=this;let t=!1;if(e){const{column:r}=e;this.finishEditingPromise=e.editor.completeEdit(r.bindCallback(r.finalizeCellEdit)),t=await this.finishEditingPromise,this.finishEditingPromise=null}return t}async onCellClickWhileEditing({event:e,cellSelector:t}){const r=this;r.finishEditingPromise||r.editorContext&&!r.editorContext.editor.owns(e.target)&&(r.getEditingContext(t)?await r.finishEditing()?r.startEditing(t):(r.grid.focusCell(r.editorContext.selector),r.editor.inputField.focus()):r.finishEditing())}onCellClick({source:e,record:t,cellSelector:r,cellElement:n,target:i,event:s}){const o=e.focusedCell||{},a=e.columns.getById(r.columnId);if(a.onCellClick)a.onCellClick({grid:e,column:a,record:t,cellSelector:r,cellElement:n,target:i,event:s});else{if(i.closest(".b-tree-expander"))return this.cancelEditing(),!1;DomHelper.isTouchEvent&&r.id==o.id&&r.columnId==o.columnId?this.startEditing(r):"cellclick"===this.triggerEvent&&this.onTriggerEditEvent({cellSelector:r})}}onTriggerEditEvent({cellSelector:e}){this.editorContext&&!this.finishEditing()||this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:r}=this;(null==r?void 0:r.editor.isVisible)&&t===r.record&&r.editor.dataField in e&&r.editor.refreshEdit()}onGridBeforeRenderRows(){var e;(null===(e=this.editorContext)||void 0===e?void 0:e.editor.isVisible)&&this.cancelEditing()}async onElementKeyDown(e){const t=this;if(!e.handled&&t.grid.focusElement.contains(e.target))if(t.editorContext){switch(e.key){case"Enter":t.onEnterKeyPress(e);break;case"F2":e.preventDefault(),t.finishEditing();break;case"Escape":e.stopPropagation(),e.preventDefault(),t.cancelEditing();break;case"Tab":t.onTabKeyPress(e)}validEditingKeys[e.key]&&(e.handled=!0)}else{const{key:r}=e,n="Backspace"===r,i=t.autoEdit&&(1===r.length||n);if((i||validNonEditingKeys[r])&&t.grid.focusedCell){if(t.startEditing(t.grid.focusedCell)){const{inputField:s}=t.editor,{input:o}=s;i&&o&&(s.internalOnKeyEvent(e),e.defaultPrevented||(o.value=n?"":r,s.internalOnInput(e),s.moveCaretToEnd()))}e.preventDefault()}}}async onEnterKeyPress(e){const t=this,{grid:r}=t;if(e.preventDefault(),e.stopPropagation(),await t.finishEditing()&&!t.isEditing){if(e.ctrlKey||e.metaKey||e.altKey||t.grid.touch)return;e.shiftKey?r.navigateUp()&&t.startEditing(r.focusedCell):r.navigateDown()&&t.startEditing(r.focusedCell)}}async onTabKeyPress(e){e.preventDefault();const t=this,{focusedCell:r}=t.grid;if(r){const n=!e.shiftKey;let i=await t.getAdjacentEditableCell(r,n);if(!i&&n&&t.addNewAtEnd){!0===await t.finishEditing()&&(await this.doAddNewAtEnd("object"==typeof t.addNewAtEnd?ObjectHelper.clone(t.addNewAtEnd):{}),i=await t.getAdjacentEditableCell(r,n))}if(i){let e=!0;t.isEditing&&(e=await t.finishEditing()),e&&(t.grid.focusCell(i,{animate:t.focusCellAnimationDuration}),t.startEditing(i))}}}onElementMouseDown(e){2===e.button&&this.editorContext&&e.preventDefault()}onEditorFocusOut(e){const t=this,{grid:r}=t;t.editorContext&&!t.editor.isFinishing&&t.editor.inputField.owns(e._target)&&(e.toWidget!==r||r.isLocationEqual(t.grid.focusedCell,t.editorContext.selector))&&("cancel"===t.blurAction?t.cancelEditing():t.finishEditingPromise||t.finishEditing())}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}onTapOut({event:e}){const t=this;t.grid.bodyContainer.contains(e.target)||t.editor.owns(e.target)||("cancel"===t.blurAction?t.cancelEditing():t.finishEditing())}onElementClick(e){e.target.classList.contains("b-grid-body-container")&&this.editorContext&&this.finishEditing()}}CellEdit._$name="CellEdit",GridFeatureManager.registerFeature(CellEdit,!0);class Grid extends GridBase{static get $name(){return"Grid"}static get type(){return"grid"}}Grid.initClass(),Grid._$name="Grid";class TreeGrid extends Grid{static get $name(){return"TreeGrid"}static get type(){return"treegrid"}set store(e){if(e&&!e.tree){if(e instanceof Store)throw new Error("TreeGrid requires a Store configured with tree : true");e.tree=!0}super.store=e}get store(){return super.store}}TreeGrid.initClass(),TreeGrid._$name="TreeGrid";const storeSortFn=function(e,t,r){return e.store&&(e=e.store),t.store&&(t=t.store),(e=e[r]||0)<(t=t[r]||0)?-1:e>t?1:0},storeLoadSortFn=function(e,t){return storeSortFn(e,t,"loadPriority")},storeSyncSortFn=function(e,t){return storeSortFn(e,t,"syncPriority")},nullFn=()=>{};var AbstractCrudManagerMixin=e=>{e.$meta;const t=[];return e.isEvents||t.push(Events),e.isDelayable||t.push(Delayable),class extends((e||Base).mixin(...t)){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,createMissingRecords:!1,autoSyncTimerId:null,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(e={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(e)}afterConstruct(){super.afterConstruct(),this.autoLoad&&this.doAutoLoad()}doAutoLoad(){return this.load().catch((e=>{if(!e||!this.isValidResponse(e.rawResponse,e.response))throw e}))}getStoreDescriptor(e){return e?e instanceof Store?this.crudStores.find((t=>t.store===e)):"object"==typeof e?this.crudStoresIndex[e.storeId]:this.crudStoresIndex[e]||this.getStoreDescriptor(Store.getStore(e)):null}fillStoreDescriptor(e){const{store:t}=e,{storeIdProperty:r=this.storeIdProperty,modelClass:n}=t;return e.storeId||(e.storeId=t[r]),e.idField||(e.idField=n.idField),e.phantomIdField||(e.phantomIdField=n.phantomIdField),e.phantomParentIdField||(e.phantomParentIdField=n.phantomParentIdField),"writeAllFields"in e||(e.writeAllFields=t.writeAllFields),e}updateCrudStoreIndex(){const e=this.crudStoresIndex={};this.crudStores.forEach((t=>t.storeId&&(e[t.storeId]=t)))}getCrudStore(e){const t=this.getStoreDescriptor(e);return null==t?void 0:t.store}forEachCrudStore(e,t=this){e&&this.crudStores.every((r=>!1!==e.call(t,r.store,r.storeId,r)))}set crudStores(e){this._crudStores=[],this.addCrudStore(e);for(const e of this._crudStores)e.loadPriority=e.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(e){return this._orderedCrudStores=e}set syncApplySequence(e){this._syncApplySequence=[],this.addStoreToApplySequence(e)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(e){const t=this;let r;return e instanceof Store?r={store:e}:"object"==typeof e?(e.stores?(Array.isArray(e.stores)||(e.stores=[e.stores]),e.stores.forEach(((t,r)=>{let n=t;"string"==typeof t&&(n={storeId:t}),n.masterStoreInfo=e,e.stores[r]=n}))):e.store||(e={storeId:e.id,store:new Store(e)}),r=e):r={store:Store.getStore(e)},t.fillStoreDescriptor(r),(e=r.store).setCrudManager?e.setCrudManager(t):e.crudManager=t,e.pageSize=null,t.overrideCrudStoreLoad&&e.load&&(e.load=e.commit=()=>{}),t.bindCrudStoreListeners(e),r}addCrudStore(e,t,r){if(!e)return;if(Array.isArray(e)||(e=[e]),!e.length)return;const n=this,i=e.map(n.internalAddCrudStore,n);if(void 0===t)n.crudStores.push(...i);else{let e=t;r&&((r instanceof Store||"object"!=typeof r)&&(r=n.getStoreDescriptor(r)),e+=n.crudStores.indexOf(r)),n.crudStores.splice(e,0,...i)}n.orderedCrudStores.push(...i),n.updateCrudStoreIndex()}addPrioritizedStore(e){const t=this;t.hasCrudStore(e)||this.addCrudStore(e,ArrayHelper.findInsertionIndex(e,t.crudStores,storeLoadSortFn)),t.hasApplySequenceStore(e)||this.addStoreToApplySequence(e,ArrayHelper.findInsertionIndex(e,t.syncApplySequence,storeSyncSortFn))}hasCrudStore(e){var t;return null===(t=this.crudStores)||void 0===t?void 0:t.some((t=>t===e||t.store===e||t.storeId===e))}removeCrudStore(e){const t=this,r=t.crudStores;for(let n=0,i=r.length;n<i;n++){const i=r[n];if(i===e||i.store===e||i.storeId===e){t.unbindCrudStoreListeners(i.store),delete t.crudStoresIndex[i.storeId],r.splice(n,1),t.syncApplySequence&&t.removeStoreFromApplySequence(e);break}}}bindCrudStoreListeners(e){e.on({name:e.id,change:"onCrudStoreChange",thisObj:this})}unbindCrudStoreListeners(e){this.detachListeners(e.id)}addStoreToApplySequence(e,t,r){if(!e)return;Array.isArray(e)||(e=[e]);const n=this,i=e.reduce(((e,t)=>{const r=n.getStoreDescriptor(t);return r&&e.push(r),e}),[]);if(void 0===t)n.syncApplySequence.push(...i);else{let e=t;r&&((r instanceof Store||"object"!=typeof r)&&(r=n.getStoreDescriptor(r)),e+=n.syncApplySequence.indexOf(r)),n.syncApplySequence.splice(e,0,...i)}const s=n.syncApplySequence.map((e=>e.storeId));n.orderedCrudStores=[...n.syncApplySequence],n.crudStores.forEach((e=>{s.includes(e.storeId)||n.orderedCrudStores.push(e)}))}removeStoreFromApplySequence(e){const t=this.syncApplySequence.findIndex((t=>t===e||t.store===e||t.storeId===e));t>-1&&(this.syncApplySequence.splice(t,1),this.orderedCrudStores.splice(t,1))}hasApplySequenceStore(e){return this.syncApplySequence.some((t=>t===e||t.store===e||t.storeId===e))}onCrudStoreChange(){const e=this;e.crudIgnoreUpdates||(e.crudStoreHasChanges()?(e.trigger("hasChanges"),e.autoSync&&e.scheduleAutoSync()):e.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++,this.forEachCrudStore((e=>e.suspendAutoCommit()))}resumeAutoSync(e=!0){const t=this;t.autoSyncSuspendCounter--,t.autoSyncSuspendCounter<=0&&(t.autoSyncSuspendCounter=0,t.autoSync&&e&&(t.forEachCrudStore((t=>t.resumeAutoCommit(e))),t.sync()))}scheduleAutoSync(){const e=this;e.autoSyncTimerId||e.autoSyncSuspendCounter||(e.autoSyncTimerId=e.setTimeout((()=>{e.autoSyncTimerId=null,e.sync().catch((t=>{if(!t||!e.isValidResponse(t.rawResponse,t.response))throw t}))}),e.autoSyncTimeout))}async internalOnResponse(e,t,r,n){const i=this;i.activeRequests[e]=null;const s=t?i.decode(t):null;return s&&s.success?(!1!==i.trigger("beforeResponseApply",{requestType:e,response:s})&&!1!==i.trigger("before"+StringHelper.capitalize(e)+"Apply",{response:s,options:n})&&(i.crudRevision=s.revision,await i.applyResponse(e,s,n),i.trigger("requestDone",{requestType:e,response:s,responseOptions:r}),i.trigger(e,{response:s,responseOptions:r,options:n}),"load"!==e&&i.crudStoreHasChanges()||i.trigger("noChanges")),s):(i.trigger("requestFail",{requestType:e,response:s,responseText:t,responseOptions:r}),i.trigger(e+"Fail",{response:s,responseOptions:r,responseText:t,options:n}),s)}async internalOnLoad(e,t,r){return this.crudLoaded=!0,this.internalOnResponse("load",e,t,r)}async internalOnSync(e,t,r){return this.internalOnResponse("sync",e,t,r)}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(e){!this.crudIgnoreUpdates||--this.crudIgnoreUpdates||e||this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(e){return e?this.isCrudStoreDirty(this.getCrudStore(e)):this.crudStores.some(this.isCrudStoreDirty)}isCrudStoreDirty(e){return Boolean(null==e?void 0:e.store.changes)}emitCrudStoreEvents(e,t,r){const n={action:"read"+t,...r};for(const r of this.crudStores)e.includes(r.storeId)&&r.store.trigger(t,n)}getLoadPackage(e){const t={type:"load",requestId:this.requestId},r=this.crudStores,n=Object.assign({},e);return delete n.request,t.stores=r.map((e=>{var t;const r=null==n?void 0:n[e.storeId],i=e.pageSize||(null===(t=e.store)||void 0===t?void 0:t.pageSize);if(r||i){const t=Object.assign({storeId:e.storeId,page:1},r);return i&&(t.pageSize=i),e.currentPage=t.page,r&&delete n[e.storeId],t}return e.storeId})),Object.assign(t,n),t}loadCrudStore(e,t,r){const n=null==t?void 0:t.rows;(null==r?void 0:r.append)||(null==t?void 0:t.append)?e.add(n):e.data=n,e.trigger("load",{data:n})}loadDataToCrudStore(e,t,r){const n=this,i=e.store,s=e.stores,o=e.idField||"id",a=i.tree,l=null==t?void 0:t.rows;if(i.__loading=!0,l){let c;s&&(c=n.getSubStoresData(l,s,o,a)),n.loadCrudStore(i,t,r,e),c&&c.forEach((e=>{n.loadDataToCrudStore(Object.assign({store:i.getById(e.id).get(e.storeDesc.storeId)},e.storeDesc),e.data)}))}i.__loading=!1}loadCrudManagerData(e,t={}){this.suspendChangesTracking(),this.crudStores.forEach((r=>{const n=r.storeId,i=e[n];i&&this.loadDataToCrudStore(r,i,t[n])})),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return Boolean(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return Boolean(this.activeRequests.load||this.activeRequests.sync)}load(e){const t=this,r=t.getLoadPackage(e);return new Promise(((n,i)=>{if(!1!==t.trigger("beforeLoad",{pack:r})){const{load:s}=t.activeRequests;s&&(t.cancelRequest(s.desc,s.reject),t.trigger("loadCanceled",{pack:r}));const o=Objects.assign({data:t.encode(r),type:"load",success:t.onLoadSuccess,failure:t.onLoadFailure,thisObj:t},null==e?void 0:e.request);t.activeRequests.load={options:e,pack:r,resolve:n,reject(...e){o.success=o.failure=null,i(...e)},id:r.requestId,desc:t.sendRequest(o)},t.emitCrudStoreEvents(r.stores,"loadStart"),t.trigger("loadStart",{pack:r})}else t.trigger("loadCanceled",{pack:r}),t.processPromise(i,null,{action:"load",cancelled:!0})}))}async onLoadSuccess(e,t){if(this.isDestroyed)return;let r="";const n=this.activeRequests.load,{options:i}=n;if(await e.text().then((e=>r=e)).catch(nullFn),this.isDestroyed)return;const s=await this.internalOnLoad(r,t,i);this.isDestroyed||(this.emitCrudStoreEvents(n.pack.stores,"afterRequest"),(null==s?void 0:s.success)?n.resolve({response:s,rawResponse:e,responseText:r,options:i}):this.processPromise(n.reject,n.resolve,{action:"load",cancelled:!1,response:s,rawResponse:e,responseText:r,options:i}))}async onLoadFailure(e,t={}){var r;if(this.isDestroyed)return;const n=this.activeRequests.load,{options:i}=n,s=null===(r=t.abortController)||void 0===r?void 0:r.signal,o=Boolean(null==s?void 0:s.aborted);if(!o){let r="";if(e&&await e.text().then((e=>r=e)).catch(nullFn),this.isDestroyed)return;const s=await this.internalOnLoad(r,t,i);if(this.isDestroyed)return;this.emitCrudStoreEvents(n.pack.stores,"afterRequest",{exception:!0}),this.processPromise(n.reject,null,{action:"load",cancelled:o,response:s,rawResponse:e,responseText:r,options:i,request:n})}}getSubStoresData(e,t,r,n){if(!e)return;const i=[];function s(e,t){t.forEach((t=>{const n=t.storeId;e[n]&&(i.push({id:e[r],storeDesc:t,data:e[n]}),delete e[n])}))}return n?e.forEach((e=>{s(e,t);const n=this.getSubStoresData(e.children,t,r,!0);n&&i.push(...n)})):e.forEach((e=>s(e,t))),i}prepareAdded(e,t){const{store:r,stores:n}=t,{isTree:i}=r,s=t.phantomIdField||this.phantomIdField,o=t.phantomParentIdField||this.phantomParentIdField;return e.filter((e=>e.isValid)).map((e=>{const t=e.constructor,r=Object.assign(e.persistableData,{[s]:e.id});if(i){const{parent:t}=e;t&&!t.isRoot&&t.isPhantom&&(r[o]=t.id)}return this.resetIdsBeforeSync&&ObjectHelper.deletePath(r,t.getFieldDataSource(t.idField)),n&&this.processSubStores(e,r,n),r}))}prepareUpdated(e,t){const{store:r,stores:n}=t,{isTree:i}=r,s=t.writeAllFields||!1!==t.writeAllFields&&this.writeAllFields,o=t.phantomParentIdField||this.phantomParentIdField;if(t.store.tree){const r=t.store.rootNode;e=e.filter((e=>e!==r))}return e.filter((e=>e.isValid)).reduce(((e,t)=>{let r;if(r=s?t.persistableData:t.modificationData,i){const{parent:e}=t;e&&!e.isRoot&&e.isPhantom&&(r[o]=e.id)}return n&&this.processSubStores(t,r,n),ObjectHelper.isEmpty(r)||e.push(r),e}),[])}prepareRemoved(e){return e.map((e=>{const t=e.constructor;return ObjectHelper.setPath({},t.getFieldDataSource(t.idField),e.id)}))}processSubStores(e,t,r){r.forEach((r=>{const n=r.storeId,i=e.get(n);if(i){const e=this.getCrudStoreChanges(Object.assign({store:i},r));e?t[n]=Object.assign(e,{$store:!0}):delete t[n]}else delete t[n]}))}getCrudStoreChanges(e){const{store:t}=e;let r,n=t.added.values,i=t.modified.values,s=t.removed.values;return n.length&&(n=this.prepareAdded(n,e)),i.length&&(i=this.prepareUpdated(i,e)),s.length&&(s=this.prepareRemoved(s)),(n.length||i.length||s.length)&&(r={},n.length&&(r.added=n),i.length&&(r.updated=i),s.length&&(r.removed=s)),r}getChangeSetPackage(){const e={type:"sync",requestId:this.requestId,revision:this.crudRevision};let t=0;return this.crudStores.forEach((r=>{const n=this.getCrudStoreChanges(r);n&&(t++,e[r.storeId]=n)})),t?e:null}applyChangesToRecord(e,t,r){const n=this,i=e.constructor,{fieldDataSourceMap:s}=i,o=i.prototype,a={},l=e.data,c={[n.phantomIdField]:!0};let d;r&&r.forEach((r=>{const i=r.storeId;if(Object.prototype.hasOwnProperty.call(t,i)){c[i]=!0;const s=e.get(i);s?n.applyChangesToStore(Object.assign({store:s},r),t[i]):console.log("Can't find store for the response sub-package")}}));const u={};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&!c[e]&&(u[e]=t[e]);const h=ObjectHelper.pathifyKeys(u);for(const t in h){const r=s[t],n=r?r.name:t,c=i.processField(n,h[t]),u=t in o?e[n]:ObjectHelper.getPath(l,t);((null==r?void 0:r.isEqual)?r.isEqual(u,c):ObjectHelper.isEqual(u,c))||(d=!0,a[n]=c)}if(d){n.suspendChangesTracking();for(const t in a)e[t]=a[t];n.resumeChangesTracking(!0)}e.clearChanges(!0,!1)}applyRemovals(e,t,r){const{removed:n,modelClass:i}=e,s=r.findByIdFn,o=r.removeRecordFn,a=i.getFieldDataSource(i.idField);let l=0;return t.forEach((e=>{const t=e[a];let r=!1;if(n.includes(t)&&(n.remove(t),r=!0,l++),!r){const e=s(t);e?(this.suspendChangesTracking(),o(e),n.remove(e),l++,this.resumeChangesTracking(!0)):console.log("Can't find record to remove from the response package")}})),l}getApplyChangesToStoreHelpers(e){return e.tree?{findByPhantomFn:t=>e.getById(t),findByIdFn:t=>e.getById(t),addRecordFn:t=>(t.parentId&&e.getById(t.parentId)||e.rootNode).appendChild(t),removeRecordFn:e=>e.remove()}:{findByPhantomFn:t=>e.getById(t),findByIdFn:t=>e.getById(t),addRecordFn:t=>e.add(t)[0],removeRecordFn:t=>e.remove(t)}}applyChangesToStore(e,t){const r=this,n=e.phantomIdField||r.phantomIdField,i=e.store,{modelClass:s}=i,o=s.getFieldDataSource(s.idField),{findByPhantomFn:a,findByIdFn:l,addRecordFn:c,removeRecordFn:d}=r.getApplyChangesToStoreHelpers(i),{rows:u,removed:h}=t;if(u){const t=e.stores;u.forEach((e=>{const s=e[n],d=ObjectHelper.getPath(e,o);let u=null;null!=s?u=a(s):null!=d&&(u=l(d)),u?r.applyChangesToRecord(u,e,t,i):(r.suspendChangesTracking(),u=c(e),r.resumeChangesTracking(!0),u.clearChanges())}))}h&&r.applyRemovals(i,h,{findByIdFn:l,removeRecordFn:d})&&i.trigger("dataChanged",{source:i})}applySyncResponse(e){const t=this,r=t.orderedCrudStores;t.applyingSyncResponse=!0;for(const n of r){const r=e[n.storeId];r&&t.applyChangesToStore(n,r)}t.applyingSyncResponse=!1}applyLoadResponse(e,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(e,t),this.applyingLoadResponse=!1}async applyResponse(e,t,r){switch(this.trackResponseType&&(e=t.type||e),e){case"load":this.applyLoadResponse(t,r);break;case"sync":this.applySyncResponse(t)}}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const e=this;return e.activeRequests.sync?(e.trigger("syncDelayed"),e.activeSyncPromise=e.activeSyncPromise.finally((()=>e.sync()))):e.activeSyncPromise=new Promise(((t,r)=>{const n=e.getChangeSetPackage();n?!1!==e.trigger("beforeSync",{pack:n})?(e.trigger("syncStart",{pack:n}),e.activeRequests.sync={pack:n,resolve:t,reject:r,id:n.requestId,desc:e.sendRequest({data:e.encode(n),type:"sync",success:e.onSyncSuccess,failure:e.onSyncFailure,thisObj:e})}):(e.trigger("syncCanceled",{pack:n}),this.processPromise(r,null,{action:"sync",cancelled:!0})):t(null)})).catch((e=>{if(e&&!e.cancelled)throw e;return e}))}async onSyncSuccess(e,t){if(this.isDestroyed)return;let r="";if(await e.text().then((e=>r=e)).catch(nullFn),this.isDestroyed)return;const n=this.activeRequests.sync,i=await this.internalOnSync(r,t);this.isDestroyed||((null==i?void 0:i.success)?n.resolve({response:i,rawResponse:e,responseText:r,request:n}):this.processPromise(n.reject,n.resolve,{action:"sync",cancelled:!1,response:i,rawResponse:e,responseText:r,request:n}))}async onSyncFailure(e,t={}){var r;if(this.isDestroyed)return;const n=this.activeRequests.sync,{options:i}=n,s=null===(r=t.abortController)||void 0===r?void 0:r.signal,o=Boolean(null==s?void 0:s.aborted);if(!o){let r="";if(e&&await e.text().then((e=>r=e)).catch(nullFn),this.isDestroyed)return;const s=await this.internalOnSync(r,t,i);if(this.isDestroyed)return;this.processPromise(n.reject,null,{action:"sync",cancelled:o,response:s,rawResponse:e,responseText:r,options:i,request:n})}}commitCrudStores(){this.crudStores.forEach((e=>e.store.commit()))}rejectCrudStores(){this.orderedCrudStores.forEach((e=>e.store.clearChanges()))}doDestroy(){const e=this,{load:t,sync:r}=e.activeRequests;for(t&&e.cancelRequest(t.desc,t.reject),r&&e.cancelRequest(r.desc,r.reject);e.crudStores.length>0;)e.removeCrudStore(e.crudStores[0]);super.doDestroy&&super.doDestroy()}isValidResponse(e,t){return e&&(e.ok&&t||[500,404].includes(e.status))}processPromise(e,t,r){const{cancelled:n,action:i,rawResponse:s,response:o}=r;if(t&&this.isValidResponse(s,o))t(r);else{const t=`${StringHelper.capitalize(i)} ${n?"canceled":"failed"}`,s=new Error(t);Object.assign(s,r),e(s)}}}};class AbstractCrudManager extends(Base.mixin(AbstractCrudManagerMixin)){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}static get defaultConfig(){return{overrideCrudStoreLoad:!0,stores:null}}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}commit(){this.commitCrudStores()}reject(){this.rejectCrudStores()}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}}AbstractCrudManager._$name="AbstractCrudManager";var AjaxTransport=e=>class t extends(e||Base){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(e,t){t()}shouldUseBodyForRequestData(e,t,r){return!("HEAD"===t||"GET"===t||r)}sendRequest(e){const r=this,{data:n}=e,i=r.transport[e.type]||{},s=Objects.assign({},i,i.requestConfig);s.method=s.method||t.defaultMethod[e.type],s.params=Objects.assign(s.params||{},e.params);let o,{paramName:a}=s;if(r.shouldUseBodyForRequestData(i,s.method,a)?(s.body=n,s.headers=s.headers||{},s.headers["Content-Type"]=s.headers["Content-Type"]||"application/json"):(a=a||"data",s.params[a]=n),!s.url)throw new Error("Trying to request without URL specified");delete s.requestConfig,delete s.paramName,r.trigger("beforeSend",{params:s.params,type:e.type,requestConfig:s,config:e}),s.queryParams=s.params,delete s.params;const l=Objects.assign({},s,s.fetchOptions),c=AjaxHelper.fetch(s.url,l);return c.catch((e=>{const t=l.abortController&&l.abortController.signal;t&&!t.aborted&&console.warn(e)})).then((t=>{var n,i;t&&t.ok?o=null===(n=e.success)||void 0===n?void 0:n.call(e.thisObj||r,t,l):o=null===(i=e.failure)||void 0===i?void 0:i.call(e.thisObj||r,t,l)})),Promise.all([c,o])}},CrudManagerView=e=>class extends e{static get $name(){return"CrudManagerView"}static get configurable(){return{crudManagerClass:null,crudManager:null}}afterConstruct(){const e=this,{crudManager:t}=e;super.afterConstruct(),t&&e.loadMask&&t.isCrudManagerLoading&&e.onCrudManagerLoadStart()}bindCrudManager(e){this.detachListeners("crudManager"),null==e||e.on({name:"crudManager",loadStart:"onCrudManagerLoadStart",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",thisObj:this})}onCrudManagerLoadStart(){const e=this,{loadMask:t}=e;t&&(e.masked=Mask.mergeConfigs(e.loadMaskDefaults,t)),e.toggleEmptyText()}onCrudManagerSyncStart(){const e=this,{syncMask:t}=e;t&&(e.masked=Mask.mergeConfigs(e.loadMaskDefaults,t))}onCrudManagerRequestFinalize(e=!0,t,r){const n=this;if(e)n.masked=null,n.toggleEmptyText();else{const e=`<div class="b-grid-load-failure">\n                <div class="b-grid-load-fail">${n.L(`L{GridBase.${t}FailedMessage}`)}</div>\n                ${r&&r.message?`<div class="b-grid-load-fail">${n.L("L{CrudManagerView.serverResponseLabel}")} ${r.message}</div>`:""}\n            </div>`;n.masked=Mask.mergeConfigs(n.loadMaskDefaults,n.loadMaskError,e)}}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize()}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize()}onCrudManagerLoad(){this.onCrudManagerRequestFinalize()}onCrudManagerSync(){this.onCrudManagerRequestFinalize()}onCrudManagerRequestFail({requestType:e,response:t}){this.onCrudManagerRequestFinalize(!1,e,t)}changeCrudManager(e){e&&!e.isCrudManager&&(e=new this.crudManagerClass(Object.assign({scheduler:this},e))),this._crudManager=e,this.bindCrudManager(e)}get widgetClass(){}},JsonEncoder=e=>class extends(e||Base){static get $name(){return"JsonEncoder"}encode(e){return StringHelper.safeJsonStringify(e)}decode(e){return StringHelper.safeJsonParse(e)}},SchedulerProjectCrudManager=e=>class extends((e||Base).mixin(AbstractCrudManagerMixin,AjaxTransport,JsonEncoder)){static get defaultConfig(){return{project:null}}startConfigure(e){this.getConfig("project"),super.startConfigure(e)}async doAutoLoad(){const{project:e}=this;return e&&await e.commitAsync(),super.doAutoLoad()}loadCrudManagerData(e,t={}){const r=this,{project:n}=r;r.suspendChangesTracking(),super.loadCrudManagerData(...arguments),(null==e?void 0:e.project)&&(r.applyingProjectResponse=!0,Object.assign(n,e.project),r.applyingProjectResponse=!1),r.resumeChangesTracking()}async sync(){const{project:e}=this;return this.suspendAutoSync(),e&&await e.commitAsync(),this.resumeAutoSync(!1),super.sync()}async applyResponse(e,t,r){const n=this;if(!n.isDestroyed&&(n.trigger("startApplyResponse"),n.clearCrudStoresChanges({clearRemovedCollection:!1}),await super.applyResponse(e,t,r),n.clearCrudStoresChanges({removeAddedRecords:!1,clearAddedCollection:!1,clearModifiedCollection:!1,clearRemovedCollection:!0}),n.applyingProjectResponse=!0,t&&t.project&&Object.assign(n,t.project),n.applyingProjectResponse=!1,n.project)){n.trackResponseType&&(e=t.type||e);const r=`propagating${StringHelper.capitalize(e)}Changes`;n[r]=!0,await n.project.commitAsync(),n[r]=!1}}clearCrudStoresChanges(e={removeAddedRecords:!0,clearAddedCollection:!0,clearModifiedCollection:!0,clearRemovedCollection:!0}){const{removeAddedRecords:t,clearAddedCollection:r,clearModifiedCollection:n,clearRemovedCollection:i}=e;this.forEachCrudStore((e=>{t&&e.remove(this.added,!0),n&&(e.modified.forEach((e=>e.clearChanges(!1))),e.modified.clear()),r&&e.added.clear(),i&&e.removed.clear()}))}};class TimeSpan extends Model{static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0},{name:"durationUnit",type:"string",defaultValue:"d"},{name:"fullDuration",persist:!1},{name:"cls",defaultValue:""},"iconCls",{name:"style",type:"object"},{name:"name",type:"string",defaultValue:""}]}afterConstruct(){super.afterConstruct(),this.normalize()}get eventStore(){const e=this;if(e.isOccurrence)return e.recurringTimeSpan.eventStore;var t;e._eventStore||(e._eventStore=null===(t=e.stores)||void 0===t?void 0:t.find((e=>e.isEventStore)));return e._eventStore}normalize(){const e=this,{startDate:t,endDate:r,duration:n,durationUnit:i}=e,s=null!=n;t&&r&&!s?e.setData("duration",DateHelper.diff(t,r,i,!0)):t&&!r&&s?e.setData("endDate",DateHelper.add(t,n,i)):!t&&r&&s&&e.setData("startDate",DateHelper.add(r,-n,i))}get cls(){return this._cls||(this._cls=new DomClassList(super.get("cls"))),this._cls}set cls(e){const t=this;t._cls?t._cls.value=e:t._cls=new DomClassList(e),t.set("cls",t._cls.value)}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,t=this.durationUnit){const r={duration:e=parseFloat(e),durationUnit:t};this.startDate?r.endDate=DateHelper.add(this.startDate,e,t):this.endDate&&(r.startDate=DateHelper.add(this.endDate,-e,t)),this.set(r)}get fullDuration(){return new Duration({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){"string"==typeof e&&(e=DateHelper.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,t=!0){const r=this,n={startDate:e};if(e){let i;if(t)i=null!=r.duration;else if(r.endDate){if(n.duration=DateHelper.diff(e,r.endDate,r.durationUnit,!0),n.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(n.endDate=DateHelper.add(e,r.duration,r.durationUnit))}else n.duration=null;r.set(n)}setEndDate(e,t=!1){const r=this,n={endDate:e};if(e){let i;if(!0===t)i=null!=r.duration;else if(r.startDate){if(n.duration=DateHelper.diff(r.startDate,e,r.durationUnit,!0),n.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(n.startDate=DateHelper.add(e,-r.duration,r.durationUnit))}r.set(n)}setStartEndDate(e,t,r){this.set({startDate:e,endDate:t},null,r)}get dates(){const e=[],t=DateHelper.startOf(this.startDate,"day"),r=this.endDate;for(let n=t;n<r;n=DateHelper.add(n,1,"day"))e.push(n);return e}get startDateMS(){var e;return null===(e=this.startDate)||void 0===e?void 0:e.getTime()}get endDateMS(){var e;return null===(e=this.endDate)||void 0===e?void 0:e.getTime()}get durationMS(){const e=this;return e.endDate&&e.startDate?e.endDateMS-e.startDateMS:DateHelper.asMilliseconds(e.duration||0,e.durationUnit)}get isMilestone(){return 0===this.durationMS}inSetNormalize(e){if("string"!=typeof e){let{startDate:t,endDate:r,duration:n,durationUnit:i}=e;return"string"==typeof t&&(t=this.getFieldDefinition("startDate").convert(t)),"string"==typeof r&&(r=this.getFieldDefinition("endDate").convert(r)),"duration"in e?(t&&!r&&(r=DateHelper.add(t,n,i||this.durationUnit,!0,!0)),!t&&r&&(t=DateHelper.add(r,-n,i||this.durationUnit,!0,!0))):t&&r&&(n=DateHelper.diff(t,r,i||this.durationUnit,!0)),t&&(e.startDate=t),r&&(e.endDate=r),null!=n&&(e.duration=n),e}}inSet(e,t,r,n,i){return i||(e=this.inSetNormalize(e)||e),super.inSet(e,t,r,n,i)}forEachDate(e,t){return this.dates.forEach(e.bind(t))}get isScheduled(){const e=this;return Boolean(e.startDate&&e.endDate&&e.hasValidDates)}get isValid(){let e=!0;if(e){const{startDate:t,endDate:r}=this;e=!t||!r||r-t>=0}return e}get hasValidDates(){const{startDateMS:e,endDateMS:t}=this;return!e||!t||t-e>=0}shift(e,t=this.durationUnit){if("string"==typeof e){const r=e;e=t,t=r}return this.setStartDate(DateHelper.add(this.startDate,e,t,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,t){const r=this.startDate,n=this.endDate;return r&&n&&DateHelper.intersectSpans(r,n,e,t)}split(e=.5){const t=this,r=t.copy(),{eventStore:n,assignmentStore:i}=t,s=t.duration*e,o=t.duration-s;if(e<=0||e>=1)throw new Error("Split point must be > 0 and < 1");return r.startDate=DateHelper.add(t.startDate,s,t.durationUnit),r.duration=o,t.duration=s,n&&(n.add(r),i&&!n.usesSingleAssignment&&i.add(t.assignments.map((e=>{const t=Object.assign({},e.data,{eventId:r.id,event:null,resource:null});return delete t.id,t})))),r}toICSString(e={}){if(!this.isScheduled)return"";const t=DateHelper.toUTC(new Date),r=DateHelper.toUTC(this.startDate),n=DateHelper.toUTC(this.endDate),i="YYYYMMDDTHHmmss",s=e.DTSTAMP||DateHelper.format(t,i)+"Z";delete e.DTSTAMP;let o={};if(this.allDay){const e="YYYYMMDD";o={"DTSTART;VALUE=DATE":DateHelper.format(r,e),"DTEND;VALUE=DATE":DateHelper.format(n,e)}}else o={DTSTART:DateHelper.format(r,i)+"Z",DTEND:DateHelper.format(n,i)+"Z"};const a={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${VersionHelper.scheduler&&VersionHelper.getVersion("scheduler")||VersionHelper.calendar&&VersionHelper.getVersion("calendar")||""} //EN`,END:"VCALENDAR"},l={BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:s,...o,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...e,END:"VEVENT"},c=Object.keys(a).map((e=>`${e}:${a[e]}`)),d=Object.keys(l).map((e=>`${e}:${l[e]}`));return c.splice(c.length-1,0,...d),c.join("\n")}exportToICS(e){if(this.isScheduled){const t=new Blob([this.toICSString(e)],{type:"text/calendar"});BrowserHelper.downloadBlob(t,(this.name||"Event")+".ics")}}}TimeSpan._$name="TimeSpan";class ResourceTimeRangeModel extends TimeSpan{static get fields(){return["resourceId","timeRangeColor"]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"timeRanges",nullFieldOnRemove:!0}]}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}}ResourceTimeRangeModel._$name="ResourceTimeRangeModel";class ResourceTimeRangeStore extends AjaxStore{static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:ResourceTimeRangeModel,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}}ResourceTimeRangeStore._$name="ResourceTimeRangeStore";var PartOfProject=e=>class extends(e||Base){static get $name(){return"PartOfProject"}},AssignmentModelMixin=e=>class extends e{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(e,...t){null!=(e=e||{}).eventId&&(e.event=e.eventId),null!=e.resourceId&&(e.resource=e.resourceId),super.construct(e,...t)}get eventResourceKey(){const e=this;return`${e.event?e.eventId:e.getData("eventId")||e.internalId}-${e.resource?e.resourceId:e.getData("resourceId")||e.internalId}`}set(e,t,...r){const n=this.fieldToKeys(e,t);var i,s;"resource"in n&&(n.resourceId=null===(i=n.resource)||void 0===i?void 0:i.id);"event"in n&&(n.eventId=null===(s=n.event)||void 0===s?void 0:s.id);super.set(n,null,...r)}set resourceId(e){const{resource:t}=this;(null==t?void 0:t.isModel)&&t.id===e?this.set("resourceId",e):this.resource=e}get resourceId(){var e;return this.get("resourceId")||(null===(e=this.resource)||void 0===e?void 0:e.id)}set eventId(e){const{event:t}=this;(null==t?void 0:t.isModel)&&t.id===e?this.set("eventId",e):this.event=e}get eventId(){var e;return this.get("eventId")||(null===(e=this.event)||void 0===e?void 0:e.id)}get eventName(){var e;return null===(e=this.event)||void 0===e?void 0:e.name}get resourceName(){var e;return null===(e=this.resource)||void 0===e?void 0:e.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){const{event:e,resource:t,unjoinedStores:r,assignmentStore:n}=this,i=null==n?void 0:n.crudManager;let s;return s=n?this.isValid&&(i||!e.hasGeneratedId&&!t.hasGeneratedId):Boolean(r[0]),s}get isValid(){return null!=this.resource&&null!=this.event}toString(){return this.resourceName?`${this.resourceName} ${this.units}%`:""}};function split(e){const t=[],r=[];let n;return[function*(){for(n||(n=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),n;){const{value:t,done:i}=n.next();if(i){n=null,e=null;break}r.push(t),yield t}}(),function*(){for(n||(n=e[Symbol.iterator]());r.length&&(yield*r,r.length=0),n;){const{value:r,done:i}=n.next();if(i){n=null,e=null;break}t.push(r),yield r}}()]}function*inBatchesBySize(e,t){if(t<0)throw new Error("Batch size needs to a natural number");t|=0;const r=[];for(const n of e)r.length===t&&(yield r,r.length=0),r.push(n);r.length>0&&(yield r)}function*filter(e,t){let r=0;for(const n of e)t(n,r++)&&(yield n)}function*drop(e,t){let r=0;for(const n of e)++r>t&&(yield n)}function every(e,t){let r=0;for(const n of e)if(!t(n,r++))return!1;return!0}function some(e,t){let r=0;for(const n of e)if(t(n,r++))return!0;return!1}function*map(e,t){let r=0;for(const n of e)yield t(n,r++)}function reduce(e,t,r){let n=0,i=r;for(const r of e)i=t(i,r,n++);return i}function*uniqueOnly(e){const t=new Set;for(const r of e)t.has(r)||(t.add(r),yield r)}function*uniqueOnlyBy(e,t){const r=new Set;for(const n of e){const e=t(n);r.has(e)||(r.add(e),yield n)}}function*takeWhile(e,t){let r=0;for(const n of e){if(!t(n,r++))return;yield n}}function*concat(...e){for(let t=0;t<e.length;t++)yield*e[t]}function*concatIterable(e){for(const t of e)yield*t}class ChainedIteratorClass{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new ChainedIteratorClass(e)}copy(){const[e,t]=split(this.iterable);return this.iterable=t,new ChainedIteratorClass(e)}split(){const[e,t]=split(this.iterable);return[new ChainedIteratorClass(e),this.derive(t)]}inBatchesBySize(e){return this.derive(inBatchesBySize(this.iterable,e))}filter(e){return this.derive(filter(this.iterable,e))}drop(e){return this.derive(drop(this.iterable,e))}map(e){return this.derive(map(this.iterable,e))}reduce(e,t){return reduce(this,e,t)}concat(){return this.derive(concatIterable(this.iterable))}uniqueOnly(){return this.derive(uniqueOnly(this.iterable))}uniqueOnlyBy(e){return this.derive(uniqueOnlyBy(this.iterable,e))}every(e){return every(this,e)}some(e){return some(this,e)}takeWhile(e){return this.derive(takeWhile(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new MemoizedIteratorClass(this)}}const ChainedIterator=e=>new ChainedIteratorClass(e),CI=ChainedIterator;class MemoizedIteratorClass extends ChainedIteratorClass{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new ChainedIteratorClass(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let t=this.$iterator,r=e.length;for(r>0&&(yield*e);;){if(e.length>r){for(let t=r;t<e.length;t++)yield e[t];r=e.length}if(!t)break;const{value:n,done:i}=t.next();i?(t=this.$iterator=null,this.$iterable=null):(e.push(n),r++,yield n)}}else yield*e}}const MemoizedIterator=e=>new MemoizedIteratorClass(e),MI=MemoizedIterator,MixinInstanceOfProperty=Symbol("MixinIdentity"),MixinStateProperty=Symbol("MixinStateProperty");class MixinWalkDepthState{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=MI(this.linearizedByTopoLevels())}static new(e){const t=new this;return e&&Object.assign(t,e),t}get topoLevels(){return void 0!==this.$topoLevels?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort(((e,t)=>e-t))}get elementsByTopoLevel(){return void 0!==this.$elementsByTopoLevel?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,t){let r=e.get(t);return r||(r=[],e.set(t,r)),r}buildElementsByTopoLevel(){let e=0;const t=this.baseEl?CI(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,r=CI(this.sourceEl.requirements).map((e=>e.walkDepthState.elementsByTopoLevel)).concat().reduce(((t,[r,n])=>(r>e&&(e=r),this.getOrCreateLevel(t,r).push(n),t)),new Map);return this.getOrCreateLevel(r,e+1).push([this.sourceEl]),CI(r).map((([e,r])=>[e,CI(r).concat().uniqueOnly().filter((e=>!t.has(e))).sort(((e,t)=>e.id-t.id))])).toMap()}*linearizedByTopoLevels(){yield*CI(this.topoLevels).map((e=>this.elementsByTopoLevel.get(e))).concat()}}let MIXIN_ID=1;const identity=e=>class extends e{};class ZeroBaseClass{}class MixinState{constructor(){this.id=MIXIN_ID++,this.requirements=[],this.baseClass=ZeroBaseClass,this.identitySymbol=void 0,this.mixinLambda=identity,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(e){const t=new this;e&&Object.assign(t,e),t.walkDepthState=MixinWalkDepthState.new({sourceEl:t,baseEl:getMixinState(t.baseClass)});const r=t.mixinLambda,n=t.identitySymbol=Symbol(r.name),i=Object.assign((function(e){const t=r(e);return t.prototype[n]=!0,t}),{[MixinInstanceOfProperty]:n,[MixinStateProperty]:t});return Object.defineProperty(i,Symbol.hasInstance,{value:isInstanceOfStatic}),t.mixinLambda=i,t}get minimalClass(){return void 0!==this.$minimalClass?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const t=this.constructor,r=t.baseClassesIds.get(e);if(void 0!==r)return r;const n=MIXIN_ID++;return t.baseClassesIds.set(e,n),n}buildMinimalClass(){const e=this.constructor;let t=this.baseClass;const r=this.walkDepthState.linearizedByTopoLevelsSource.reduce(((t,r)=>{const{cls:n,hash:i}=t,s=i+String.fromCharCode(r.id);let o=e.minimalClassesByLinearHash.get(s);return o||(o=r.mixinLambda(n),r.name=o.name,e.minimalClassesByLinearHash.set(s,o)),t.cls=o,t.hash=s,t}),{cls:t,hash:String.fromCharCode(this.getBaseClassMixinId(t))}).cls,n=Object.assign(r,{[MixinInstanceOfProperty]:this.identitySymbol,[MixinStateProperty]:this,mix:this.mixinLambda,derive:e=>Mixin([n,e],(e=>class extends e{})),$:this,toString:this.toString.bind(this)});return Object.defineProperty(n,Symbol.hasInstance,{value:isInstanceOfStatic}),n}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce(((e,t)=>`${t.name}(${e})`),this.baseClass.name)}}MixinState.minimalClassesByLinearHash=new Map,MixinState.baseClassesIds=new Map;const isMixinClass=e=>Object.getPrototypeOf(e.prototype).constructor.hasOwnProperty(MixinStateProperty),getMixinState=e=>Object.getPrototypeOf(e.prototype).constructor[MixinStateProperty],mixin=(e,t)=>{let r;if(e.length>0){const t=e[e.length-1];n=t,Object.getPrototypeOf(n.prototype).constructor.hasOwnProperty(MixinStateProperty)||t===ZeroBaseClass||(r=t)}var n;const i=[];e.forEach(((t,n)=>{const s=t[MixinStateProperty];if(void 0!==s){const e=s.baseClass;if(e!==ZeroBaseClass)if(r){if(r!==e){const t=e.prototype.isPrototypeOf(r.prototype),n=r.prototype.isPrototypeOf(e.prototype);if(!t&&!n)throw new Error("Base class mismatch");r=n?e:r}}else r=e;i.push(s)}else if(n!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}));return MixinState.new({requirements:i,mixinLambda:t,baseClass:r||ZeroBaseClass}).minimalClass},isInstanceOfStatic=function(e){return Boolean(e&&e[this[MixinInstanceOfProperty]])},isInstanceOf=(e,t)=>Boolean(e&&e[t[MixinInstanceOfProperty]]),Mixin=mixin,MixinAny=mixin;class Base$1{initialize(e){e&&Object.assign(this,e)}static new(e){const t=new this;return t.initialize(e),t}}const MIN_SMI=-Math.pow(2,30),MAX_SMI=Math.pow(2,30)-1,uppercaseFirst=e=>e.slice(0,1).toUpperCase()+e.slice(1),isAtomicValue=e=>Object(e)!==e,defineProperty$6=(e,t,r)=>(Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0}),r),prototypeValue=e=>function(t,r){t[r]=e},copySetInto=(e,t)=>{for(const r of e)t.add(r);return t},delay=e=>new Promise((t=>setTimeout(t,e)));let isRegeneratorRuntime=null;const isGeneratorFunction=function(e){return null===isRegeneratorRuntime&&(isRegeneratorRuntime="undefined"!=typeof regeneratorRuntime),!0===isRegeneratorRuntime?regeneratorRuntime.isGeneratorFunction(e):"GeneratorFunction"===e.constructor.name},emptyFn$2=(...e)=>{},DEBUG_ONLY=e=>emptyFn$2;var __decorate=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const BreakCurrentStackExecution=Symbol("BreakCurrentStackExecution");class Effect extends Base$1{}__decorate([prototypeValue(!0)],Effect.prototype,"sync",void 0),__decorate([prototypeValue(!0)],Effect.prototype,"pure",void 0);const ProposedOrPreviousSymbol=Symbol("ProposedOrPreviousSymbol"),ProposedOrPrevious=Effect.new({handler:ProposedOrPreviousSymbol}),RejectSymbol=Symbol("RejectSymbol");class RejectEffect extends Effect{constructor(){super(...arguments),this.handler=RejectSymbol}}__decorate([prototypeValue(!1)],RejectEffect.prototype,"pure",void 0);const Reject=e=>RejectEffect.new({reason:e}),TransactionSymbol=Symbol("TransactionSymbol"),GetTransaction=Effect.new({handler:TransactionSymbol}),OwnQuarkSymbol=Symbol("OwnQuarkSymbol"),OwnQuark=Effect.new({handler:OwnQuarkSymbol}),OwnIdentifierSymbol=Symbol("OwnIdentifierSymbol"),OwnIdentifier=Effect.new({handler:OwnIdentifierSymbol}),WriteSymbol=Symbol("WriteSymbol");class WriteEffect extends Effect{constructor(){super(...arguments),this.handler=WriteSymbol}}__decorate([prototypeValue(!1)],WriteEffect.prototype,"pure",void 0);const Write=(e,t,...r)=>WriteEffect.new({identifier:e,proposedArgs:[t,...r]}),WriteSeveralSymbol=Symbol("WriteSeveralSymbol");class WriteSeveralEffect extends Effect{constructor(){super(...arguments),this.handler=WriteSeveralSymbol}}__decorate([prototypeValue(!1)],WriteSeveralEffect.prototype,"pure",void 0);const PreviousValueOfSymbol=Symbol("PreviousValueOfSymbol");class PreviousValueOfEffect extends Effect{constructor(){super(...arguments),this.handler=PreviousValueOfSymbol}}const PreviousValueOf=e=>PreviousValueOfEffect.new({identifier:e}),ProposedValueOfSymbol=Symbol("ProposedValueOfSymbol"),HasProposedValueSymbol=Symbol("HasProposedValueSymbol");class HasProposedValueEffect extends Effect{constructor(){super(...arguments),this.handler=HasProposedValueSymbol}}const HasProposedValue=e=>HasProposedValueEffect.new({identifier:e}),ProposedOrPreviousValueOfSymbol=Symbol("ProposedOrPreviousValueOfSymbol");class ProposedOrPreviousValueOfEffect extends Effect{constructor(){super(...arguments),this.handler=ProposedOrPreviousValueOfSymbol}}const ProposedOrPreviousValueOf=e=>ProposedOrPreviousValueOfEffect.new({identifier:e}),ProposedArgumentsOfSymbol=Symbol("ProposedArgumentsOfSymbol");class ProposedArgumentsOfEffect extends Effect{constructor(){super(...arguments),this.handler=ProposedArgumentsOfSymbol}}const ProposedArgumentsOf=e=>ProposedArgumentsOfEffect.new({identifier:e}),UnsafeProposedOrPreviousValueOfSymbol=Symbol("UnsafeProposedOrPreviousValueOfSymbol");class UnsafeProposedOrPreviousValueOfEffect extends Effect{constructor(){super(...arguments),this.handler=UnsafeProposedOrPreviousValueOfSymbol}}const UnsafeProposedOrPreviousValueOf=e=>UnsafeProposedOrPreviousValueOfEffect.new({identifier:e}),UnsafePreviousValueOfSymbol=Symbol("UnsafePreviousValueOfSymbol");class CalculationGen extends(Mixin([],(e=>class extends e{constructor(){super(...arguments),this.iterator=void 0,this.iterationResult=void 0}isCalculationStarted(){return Boolean(this.iterator||this.iterationResult)}isCalculationCompleted(){return Boolean(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(e,...t){const r=this.iterator=this.calculation.call(this.context||this,e,...t);return this.iterationResult=r.next()}continueCalculation(e){return this.iterationResult=this.iterator.next(e)}cleanupCalculation(){this.iterationResult=void 0,this.iterator=void 0}*calculation(e,...t){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(e,...t){for(this.startCalculation(e,...t);!this.isCalculationCompleted();)this.continueCalculation(e(this.iterationResult.value));return this.iterator=void 0,this.result}async runAsyncWithEffect(e,...t){for(this.startCalculation(e,...t);!this.isCalculationCompleted();)this.continueCalculation(await e(this.iterationResult.value));return this.iterator=void 0,this.result}}))){}const SynchronousCalculationStarted=Symbol("SynchronousCalculationStarted"),calculationStartedConstant={value:SynchronousCalculationStarted};class CalculationSync extends(Mixin([],(e=>class extends e{constructor(){super(...arguments),this.iterationResult=void 0}isCalculationStarted(){return Boolean(this.iterationResult)}isCalculationCompleted(){return Boolean(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(e,...t){return this.iterationResult=calculationStartedConstant,this.iterationResult={done:!0,value:this.calculation.call(this.context||this,e,...t)}}continueCalculation(e){throw new Error("Can not continue synchronous calculation")}cleanupCalculation(){this.iterationResult=void 0}calculation(e,...t){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(e,...t){return this.startCalculation(e,...t),this.result}async runAsyncWithEffect(e,...t){throw new Error("Can not run synchronous calculation asynchronously")}}))){}function runGeneratorSyncWithEffect(e,t,r,n){const i=t.apply(n||null,r);let s=i.next();for(;!s.done;)s=i.next(e(s.value));return s.value}async function runGeneratorAsyncWithEffect(e,t,r,n){const i=t.apply(n||null,r);let s=i.next();for(;!s.done;){const t=e(s.value);s=t instanceof Promise?i.next(await t):i.next(t)}return s.value}var OnCycleAction;!function(e){e.Cancel="Cancel",e.Resume="Resume"}(OnCycleAction||(OnCycleAction={}));const WalkSource=Symbol("WalkSource"),NOT_VISITED=-1,VISITED_TOPOLOGICALLY=-2;class WalkContext extends Base$1{constructor(){super(...arguments),this.visited=new Map,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e.map((e=>({node:e,from:WalkSource,label:void 0})))),this.walkDepth()}onNode(e,t){}onTopologicalNode(e){}onCycle(e,t){return OnCycleAction.Cancel}forEachNext(e,t){throw new Error("Abstract method called")}collectNext(e,t,r){throw new Error("Abstract method called")}getVisitedInfo(e){return this.visited.get(e)}setVisitedInfo(e,t,r){return r?(r.visitedAt=t,r.visitEpoch=this.currentEpoch):(r={visitedAt:t,visitEpoch:this.currentEpoch},this.visited.set(e,r)),r}walkDepth(){this.visited;const e=this.toVisit;let t;for(;t=e.length;){const r=e[t-1].node,n=this.getVisitedInfo(r);if(n&&-2===n.visitedAt&&n.visitEpoch===this.currentEpoch)e.pop();else if(n&&n.visitEpoch===this.currentEpoch&&-1!==n.visitedAt){if(n.visitedAt<t){if(this.onCycle(r,e)!==OnCycleAction.Resume)break}else n.visitedAt=-2,this.onTopologicalNode(r);e.pop()}else{if(!1===this.onNode(r,e[t-1]))break;const i=this.setVisitedInfo(r,t,n),s=e.length;this.collectNext(r,e,i),e.length===s&&(i.visitedAt=-2,this.onTopologicalNode(r),e.pop())}}}}function cycleInfo(e){const t=e.length;if(0===t)return[];const r=e[t-1].node,n=[r];let i=t-1,s=i;for(;i>=0&&e[i].from!==r;){for(;i>=0&&e[i].from===e[s].from;)i--;i>=0&&(n.push(e[i].node),s=i)}return i<0?[]:(n.push(r),n.reverse())}var EdgeType;!function(e){e[e.Normal=1]="Normal",e[e.Past=2]="Past"}(EdgeType||(EdgeType={}));let ORIGIN_ID=0;class Quark extends(MixinAny([Map],(e=>class extends e{constructor(){super(...arguments),this.createdAt=void 0,this.identifier=void 0,this.value=void 0,this.proposedValue=void 0,this.proposedArguments=void 0,this.usedProposedOrPrevious=!1,this.previous=void 0,this.origin=void 0,this.originId=MIN_SMI,this.needToBuildProposedValue=!1,this.edgesFlow=0,this.visitedAt=-1,this.visitEpoch=0,this.promise=void 0,this.$outgoingPast=void 0}static new(e){const t=new this;return e&&Object.assign(t,e),t}get level(){return this.identifier.level}get calculation(){return this.identifier.calculation}get context(){return this.identifier.context||this.identifier}forceCalculation(){this.edgesFlow=MAX_SMI}cleanup(){this.cleanupCalculation()}isShadow(){return Boolean(this.origin&&this.origin!==this)}resetToEpoch(e){this.visitEpoch=e,this.visitedAt=-1,this.edgesFlow<0&&(this.edgesFlow=0),this.usedProposedOrPrevious=!1,this.cleanupCalculation(),void 0!==this.value&&this.clearOutgoing(),this.promise=void 0,this.origin&&this.origin===this?(this.proposedArguments=void 0,void 0!==this.value&&(this.proposedValue=this.value),this.value=void 0):(this.origin=void 0,this.value=void 0),this.identifier.proposedValueIsBuilt&&this.proposedValue!==TombStone&&(this.needToBuildProposedValue=!0,this.proposedValue=void 0)}copyFrom(e){this.value=e.value,this.proposedValue=e.proposedValue,this.proposedArguments=e.proposedArguments,this.usedProposedOrPrevious=e.usedProposedOrPrevious}clearProperties(){this.value=void 0,this.proposedValue=void 0,this.proposedArguments=void 0}mergePreviousOrigin(e){const t=this.origin;if(t!==this.previous)throw new Error("Invalid state");this.copyFrom(t);const r=this.getOutgoing();for(const[n,i]of t.getOutgoing()){if(!r.get(n)){const t=e.get(n);t&&t.originId!==i.originId||r.set(n,t||i)}}if(void 0!==t.$outgoingPast){const r=this.getOutgoingPast();for(const[n,i]of t.getOutgoingPast()){if(!r.get(n)){const t=e.get(n);t&&t.originId!==i.originId||r.set(n,t||i)}}}this.origin=this,t.clearProperties(),t.clear()}setOrigin(e){this.origin=e,this.originId=e.originId}getOrigin(){return this.origin?this.origin:this.startOrigin()}startOrigin(){return this.originId=ORIGIN_ID++,this.origin=this}getOutgoing(){return this}getOutgoingPast(){return void 0!==this.$outgoingPast?this.$outgoingPast:this.$outgoingPast=new Map}addOutgoingTo(e,t){(t===EdgeType.Normal?this:this.getOutgoingPast()).set(e.identifier,e)}clearOutgoing(){this.clear(),void 0!==this.$outgoingPast&&this.$outgoingPast.clear()}getValue(){return this.origin?this.origin.value:void 0}setValue(e){if(this.origin&&this.origin!==this)throw new Error("Can not set value to the shadow entry");this.getOrigin().value=e}hasValue(){return void 0!==this.getValue()}hasProposedValue(){return!this.isShadow()&&this.hasProposedValueInner()}hasProposedValueInner(){return void 0!==this.proposedValue}getProposedValue(e){return this.needToBuildProposedValue&&(this.needToBuildProposedValue=!1,this.proposedValue=this.identifier.buildProposedValue.call(this.identifier.context||this.identifier,this.identifier,this,e)),this.proposedValue}outgoingInTheFutureCb(e,t){let r=this;for(;r;){for(const n of r.getOutgoing().values())n.originId===e.getLatestEntryFor(n.identifier).originId&&t(n);r=r.isShadow()?r.previous:null}}outgoingInTheFutureAndPastCb(e,t){let r=this;for(;r;){for(const n of r.getOutgoing().values()){const r=e.getLatestEntryFor(n.identifier);r&&n.originId===r.originId&&t(n)}if(void 0!==r.$outgoingPast)for(const n of r.$outgoingPast.values()){const r=e.getLatestEntryFor(n.identifier);r&&n.originId===r.originId&&t(n)}r=r.isShadow()?r.previous:null}}outgoingInTheFutureAndPastTransactionCb(e,t){let r=this;for(;r;){for(const n of r.getOutgoing().values()){const r=e.getLatestStableEntryFor(n.identifier);r&&n.originId===r.originId&&t(n)}if(void 0!==r.$outgoingPast)for(const n of r.$outgoingPast.values()){const r=e.getLatestStableEntryFor(n.identifier);r&&n.originId===r.originId&&t(n)}r=r.isShadow()?r.previous:null}}outgoingInTheFutureTransactionCb(e,t){let r=this;for(;r;){for(const n of r.getOutgoing().values()){const r=e.getLatestEntryFor(n.identifier);r&&n.originId===r.originId&&t(n)}r=r.isShadow()?r.previous:null}}}))){}const TombStone=Symbol("Tombstone");var Levels,__decorate$1=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};!function(e){e[e.UserInput=0]="UserInput",e[e.DependsOnlyOnUserInput=1]="DependsOnlyOnUserInput",e[e.DependsOnlyOnDependsOnlyOnUserInput=2]="DependsOnlyOnDependsOnlyOnUserInput",e[e.DependsOnSelfKind=3]="DependsOnSelfKind"}(Levels||(Levels={}));class Meta extends Base$1{constructor(){super(...arguments),this.name=void 0,this.lazy=!1,this.total=!0,this.pure=!0,this.proposedValueIsBuilt=!1}calculation(e){throw new Error("Abstract method `calculation` called")}equality(e,t){return e===t}}__decorate$1([prototypeValue(Levels.DependsOnSelfKind)],Meta.prototype,"level",void 0),__decorate$1([prototypeValue(!0)],Meta.prototype,"sync",void 0);class Identifier extends Meta{constructor(){super(...arguments),this.context=void 0}newQuark(e){const t=this.quarkClass.new();return t.createdAt=e,t.identifier=this,t.needToBuildProposedValue=this.proposedValueIsBuilt,t}write(e,t,r,n,...i){(r=r||t.getWriteTarget(e)).proposedValue=n,r.proposedArguments=i.length>0?i:void 0}writeToTransaction(e,t,...r){e.write(this,t,...r)}writeToGraph(e,t,...r){e.write(this,t,...r)}readFromGraphAsync(e){return e.readAsync(this)}readFromGraph(e){return e.read(this)}readFromTransaction(e){return e.read(this)}readFromTransactionAsync(e){return e.readAsync(this)}buildProposedValue(e,t,r){}enterGraph(e){}leaveGraph(e){}}const QuarkSync=Quark.mix(CalculationSync.mix(Map)),QuarkGen=Quark.mix(CalculationGen.mix(Map));class Variable extends Identifier{calculation(e){throw new Error("The 'calculation' method of the variables will never be called. Instead the value will be set directly to quark")}write(e,t,r,n,...i){(r=r||t.getWriteTarget(e)).value=n,r.proposedArguments=i.length>0?i:void 0}}function VariableC(...e){return Variable.new(...e)}__decorate$1([prototypeValue(Levels.UserInput)],Variable.prototype,"level",void 0),__decorate$1([prototypeValue(QuarkSync)],Variable.prototype,"quarkClass",void 0);class CalculatedValueSync extends Identifier{calculation(e){return e(ProposedOrPrevious)}}function CalculatedValueSyncC(...e){return CalculatedValueSync.new(...e)}__decorate$1([prototypeValue(QuarkSync)],CalculatedValueSync.prototype,"quarkClass",void 0);class CalculatedValueGen extends Identifier{*calculation(e){return yield ProposedOrPrevious}}function CalculatedValueGenC(...e){return CalculatedValueGen.new(...e)}__decorate$1([prototypeValue(QuarkGen)],CalculatedValueGen.prototype,"quarkClass",void 0);const throwUnknownIdentifier=e=>{throw new Error("Unknown identifier "+e)};let CLOCK=0;class Revision extends Base$1{constructor(){super(...arguments),this.createdAt=CLOCK++,this.name="revision-"+this.createdAt,this.previous=void 0,this.scope=new Map,this.reachableCount=0,this.referenceCount=0,this.selfDependent=new Set}getLatestEntryFor(e){let t=this;for(;t;){const r=t.scope.get(e);if(r)return r;t=t.previous}return null}hasIdentifier(e){const t=this.getLatestEntryFor(e);return Boolean(t&&t.getValue()!==TombStone)}*previousAxis(){let e=this;for(;e;)yield e,e=e.previous}}class LeveledQueue{constructor(){this.length=0,this.levels=[],this.lowestLevel=MAX_SMI}getLowestLevel(){for(let e=this.lowestLevel!==MAX_SMI?this.lowestLevel:0;e<this.levels.length;e++)if(this.levels[e])return this.lowestLevel=e;return this.lowestLevel=MAX_SMI}takeLowestLevel(){for(let e=this.lowestLevel!==MAX_SMI?this.lowestLevel:0;e<this.levels.length;e++){const t=this.levels[e];if(t)return this.length-=t.length,this.levels[e]=null,this.lowestLevel=e+1,t}}pop(){for(let e=this.lowestLevel!==MAX_SMI?this.lowestLevel:0;e<this.levels.length;e++){const t=this.levels[e];if(this.lowestLevel=e,t&&t.length>0)return this.length--,t.pop()}this.lowestLevel=MAX_SMI}push(e){const t=e.level;let r=this.levels[t];if(!r){for(let e=this.levels.length;e<t;e++)this.levels[e]=null;r=this.levels[t]=[]}r.push(e),this.length++,t<this.lowestLevel&&(this.lowestLevel=t)}*[Symbol.iterator](){for(let e=0;e<this.levels.length;e++){const t=this.levels[e];t&&(yield*t)}}}class ComputationCycle extends Base$1{toString(){const e=[],t=[];return this.cycle.forEach((({name:r,context:n})=>{e.push(r),t[t.length-1]!==n&&t.push(n)})),"events: \n"+t.map((e=>"#"+e.id)).join(" => ")+"\n\nidentifiers: \n"+e.join("\n")}}class TransactionCycleDetectionWalkContext extends WalkContext{constructor(){super(...arguments),this.transaction=void 0}onCycle(e,t){return OnCycleAction.Cancel}doCollectNext(e,t,r){let n=this.visited.get(t);n||(n={visitedAt:-1,visitEpoch:this.currentEpoch},this.visited.set(t,n)),r.push({node:t,from:e,label:void 0})}collectNext(e,t){const r=this.transaction.getLatestEntryFor(e);r&&r.outgoingInTheFutureTransactionCb(this.transaction,(r=>{this.doCollectNext(e,r.identifier,t)}))}}class TransactionWalkDepth extends Base$1{constructor(){super(...arguments),this.visited=new Map,this.transaction=void 0,this.baseRevision=void 0,this.pushTo=void 0,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e),this.walkDepth()}startNewEpoch(){if(this.toVisit.length)throw new Error("Can not start new walk epoch in the middle of the walk");this.currentEpoch++}onTopologicalNode(e,t){e.lazy||e.level===Levels.UserInput||this.pushTo.push(t)}onCycle(e,t){return OnCycleAction.Resume}doCollectNext(e,t,r){let n=this.visited.get(t);n||(n=t.newQuark(this.baseRevision),n.visitEpoch=this.currentEpoch,this.visited.set(t,n)),r.push(t)}collectNext(e,t,r){const n=this.baseRevision.getLatestEntryFor(e);n&&(r.previous=n,n.outgoingInTheFutureAndPastTransactionCb(this.transaction,(r=>{this.doCollectNext(e,r.identifier,t)})));for(const n of r.getOutgoing().keys())this.doCollectNext(e,n,t);if(void 0!==r.$outgoingPast)for(const n of r.getOutgoingPast().keys())this.doCollectNext(e,n,t)}walkDepth(){const e=this.visited,t=this.toVisit;let r;for(;r=t.length;){const n=t[r-1];let i=e.get(n);if(i&&-2===i.visitedAt&&i.visitEpoch===this.currentEpoch)i.edgesFlow++,t.pop();else if(i&&i.visitEpoch===this.currentEpoch&&-1!==i.visitedAt){if(i.visitedAt<r){if(this.onCycle(n,t)!==OnCycleAction.Resume)break;i.edgesFlow++}else i.visitedAt=-2,this.onTopologicalNode(n,i);t.pop()}else{const s=t.length;i||(i=n.newQuark(this.baseRevision),i.visitEpoch=this.currentEpoch,e.set(n,i)),this.collectNext(n,t,i),i.visitEpoch<this.currentEpoch&&i.resetToEpoch(this.currentEpoch),i.visitedAt=r,i.edgesFlow++,t.length===s&&(i.visitedAt=-2,this.onTopologicalNode(n,i),t.pop())}}}}const EdgeTypeNormal=EdgeType.Normal,EdgeTypePast=EdgeType.Past;class Transaction$1 extends Base$1{constructor(){super(...arguments),this.baseRevision=void 0,this.candidateClass=Revision,this.candidate=void 0,this.graph=void 0,this.isClosed=!1,this.walkContext=void 0,this.entries=new Map,this.stackGen=new LeveledQueue,this.activeStack=[],this.onEffectSync=void 0,this.onEffectAsync=void 0,this.propagationStartDate=0,this.lastProgressNotificationDate=0,this.startProgressNotificationsAfterMs=500,this.emitProgressNotificationsEveryMs=200,this.emitProgressNotificationsEveryCalculations=100,this.plannedTotalIdentifiersToCalculate=0,this.ongoing=Promise.resolve(),this.selfDependedMarked=!1,this.rejectedWith=void 0}initialize(...e){super.initialize(...e),this.walkContext=TransactionWalkDepth.new({visited:this.entries,transaction:this,baseRevision:this.baseRevision,pushTo:this.stackGen}),this.candidate||(this.candidate=this.candidateClass.new({previous:this.baseRevision})),this.onEffectSync=this.read.bind(this),this.onEffectAsync=this.readAsync.bind(this)}get dirty(){return this.entries.size>0}markSelfDependent(){if(!this.selfDependedMarked){this.selfDependedMarked=!0;for(const e of this.baseRevision.selfDependent){const t=this.entries.get(e);t&&t.getValue()===TombStone||this.touch(e)}}}getActiveEntry(){return this.activeStack[this.activeStack.length-1]}yieldAsync(e){return e instanceof Promise?e:this.graph[e.handler](e,this)}yieldSync(e){if(e instanceof Promise)throw new Error("Can not yield a promise in the synchronous context");return this.graph[e.handler](e,this)}async readAsync(e){if(!(e instanceof Identifier))return this.yieldAsync(e);let t;const r=this.getActiveEntry();if(r)t=this.addEdge(e,r,EdgeTypeNormal);else if(t=this.entries.get(e),!t){const r=this.baseRevision.getLatestEntryFor(e);r||throwUnknownIdentifier(e),t=r.hasValue()?r:this.touch(e)}if(t.hasValue())return t.getValue();if(t.promise)return t.promise;for(t.previous&&t.previous.hasValue()||t.forceCalculation();this.stackGen.lowestLevel<e.level;)await runGeneratorAsyncWithEffect(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,this.stackGen.takeLowestLevel()],this);return this.markSelfDependent(),this.ongoing=t.promise=this.ongoing.then((()=>{if(void 0===t.getValue())return runGeneratorAsyncWithEffect(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[t]],this)})).then((()=>{if(this.rejectedWith)throw new Error("Transaction rejected: "+String(this.rejectedWith.reason));if(!t.hasValue())throw new Error("Computation cycle. Sync");return t.getValue()}))}get(e){if(!(e instanceof Identifier))return this.yieldSync(e);let t;const r=this.getActiveEntry();if(r)t=this.addEdge(e,r,EdgeTypeNormal);else if(t=this.entries.get(e),!t){const r=this.baseRevision.getLatestEntryFor(e);r||throwUnknownIdentifier(e),t=r.hasValue()?r:this.touch(e)}const n=t.getValue();if(n===TombStone&&throwUnknownIdentifier(e),void 0!==n&&t.hasValue())return n;if(t.promise)return t.promise;for(t.previous&&t.previous.hasValue()||t.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());if(this.markSelfDependent(),e.sync){this.calculateTransitionsStackSync(this.onEffectSync,[t]);const r=t.getValue();if(void 0===r)throw new Error("Cycle during synchronous computation");return r===TombStone&&throwUnknownIdentifier(e),r}return this.ongoing=t.promise=this.ongoing.then((()=>{if(void 0===t.getValue())return runGeneratorAsyncWithEffect(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[t]],this)})).then((()=>{if(this.rejectedWith)throw new Error("Transaction rejected: "+String(this.rejectedWith.reason));const r=t.getValue();if(void 0===r)throw new Error("Computation cycle. Async get");return r===TombStone&&throwUnknownIdentifier(e),r}))}read(e){if(!(e instanceof Identifier))return this.yieldSync(e);let t;const r=this.getActiveEntry();if(r)t=this.addEdge(e,r,EdgeTypeNormal);else if(t=this.entries.get(e),!t){const r=this.baseRevision.getLatestEntryFor(e);r||throwUnknownIdentifier(e),t=r.hasValue()?r:this.touch(e)}const n=t.getValue();if(n===TombStone&&throwUnknownIdentifier(e),void 0!==n)return n;for(t.previous&&t.previous.hasValue()||t.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());this.markSelfDependent(),this.calculateTransitionsStackSync(this.onEffectSync,[t]);const i=t.getValue();if(void 0===i)throw new Error("Cycle during synchronous computation");return i===TombStone&&throwUnknownIdentifier(e),i}readCurrentOrProposedOrPrevious(e){const t=this.entries.get(e);if(t){const e=t.getValue();if(void 0!==e)return e;if(void 0!==t.proposedValue)return t.proposedValue}return this.readPrevious(e)}readCurrentOrProposedOrPreviousAsync(e){const t=this.entries.get(e);if(t){const e=t.getValue();if(void 0!==e)return e;if(void 0!==t.proposedValue)return t.proposedValue}return this.readPreviousAsync(e)}readPrevious(e){const t=this.baseRevision.getLatestEntryFor(e);if(!t)return;const r=t.getValue();return r!==TombStone?void 0!==r?r:this.read(e):void 0}readPreviousAsync(e){const t=this.baseRevision.getLatestEntryFor(e);if(!t)return;const r=t.getValue();return r!==TombStone?void 0!==r?r:this.readAsync(e):void 0}readProposedOrPrevious(e){const t=this.entries.get(e);return t&&void 0!==t.proposedValue?t.proposedValue:this.readPrevious(e)}readProposedOrPreviousAsync(e){const t=this.entries.get(e);return t&&void 0!==t.proposedValue?t.proposedValue:this.readPreviousAsync(e)}write(e,t,...r){void 0===t&&(t=null),e.write.call(e.context||e,e,this,null,t,...r)}getWriteTarget(e){return this.touch(e).startOrigin()}acquireQuarkIfExists(e){const t=this.entries.get(e);return t&&t.origin===t?t.origin:void 0}touch(e){const t=this.entries.get(e);(!t||t.visitEpoch<this.walkContext.currentEpoch)&&this.walkContext.continueFrom([e]);const r=t||this.entries.get(e);return r.forceCalculation(),r}hasIdentifier(e){const t=this.entries.get(e);return(!t||t.getValue()!==TombStone)&&Boolean(t||this.baseRevision.getLatestEntryFor(e))}addIdentifier(e,t,...r){let n=this.entries.get(e);const i=e.level===Levels.UserInput;return n||(n=e.newQuark(this.baseRevision),n.previous=this.baseRevision.getLatestEntryFor(e),n.forceCalculation(),this.entries.set(e,n),e.lazy||i||this.stackGen.push(n)),(void 0!==t||i)&&(n.startOrigin(),e.write.call(e.context||e,e,this,n,void 0===t&&i?null:t,...r)),n.getValue()===TombStone&&(n.value=void 0),e.enterGraph(this.graph),n}removeIdentifier(e){e.leaveGraph(this.graph);this.touch(e).startOrigin().setValue(TombStone)}populateCandidateScopeFromTransitions(e,t){if(0===e.scope.size)e.scope=t;else for(const[r,n]of t)if(n.isShadow()){const t=e.getLatestEntryFor(r);n.getOutgoing().forEach(((e,r)=>t.getOutgoing().set(r,e)))}else e.scope.set(r,n)}preCommit(e){if(this.isClosed)throw new Error("Can not propagate closed revision");this.markSelfDependent(),this.isClosed=!0,this.propagationStartDate=Date.now(),this.plannedTotalIdentifiersToCalculate=this.stackGen.length}postCommit(){this.populateCandidateScopeFromTransitions(this.candidate,this.entries);const e=this.entries;return this.walkContext=void 0,{revision:this.candidate,entries:e,transaction:this}}commit(e){return this.preCommit(e),this.calculateTransitionsSync(this.onEffectSync),this.postCommit()}reject(e=RejectEffect.new()){this.rejectedWith=e;for(const e of this.entries.values())e.cleanup();this.entries.clear(),this.walkContext=void 0}async commitAsync(e){return this.preCommit(e),this.ongoing=this.ongoing.then((()=>runGeneratorAsyncWithEffect(this.onEffectAsync,this.calculateTransitions,[this.onEffectAsync],this))).then((()=>this.postCommit()))}getLatestEntryFor(e){let t=this.entries.get(e)||this.baseRevision.getLatestEntryFor(e);if(t.getValue()!==TombStone)return t}getLatestStableEntryFor(e){let t=this.entries.get(e);if(t){const r=t.getValue();if(r===TombStone)return;return void 0===r?this.baseRevision.getLatestEntryFor(e):t}return this.baseRevision.getLatestEntryFor(e)}addEdge(e,t,r){if(t.identifier.level<e.level)throw new Error("Identifier can not read from higher level identifier");let n=this.entries.get(e);if(!n){const t=this.baseRevision.getLatestEntryFor(e);t||throwUnknownIdentifier(e),n=e.newQuark(this.baseRevision),t.origin&&n.setOrigin(t.origin),n.previous=t,this.entries.set(e,n)}return n.addOutgoingTo(t,r),n}onQuarkCalculationCompleted(e,t){e.cleanup();const r=e.identifier,n=e.previous,i=Boolean(n&&n.hasValue()&&r.equality(t,n.getValue()));i?(n.outgoingInTheFutureAndPastTransactionCb(this,(e=>{const t=this.entries.get(e.identifier);t&&t.edgesFlow--})),e.edgesFlow=MAX_SMI,e.setOrigin(n.origin),e.value=t):(e.startOrigin(),e.setValue(t));let s=!1;e.usedProposedOrPrevious&&(void 0!==e.proposedValue?r.equality(t,e.proposedValue)&&(s=!0):(i||!n&&null===t)&&(s=!0),s||this.candidate.selfDependent.add(r))}onReadIdentifier(e,t,r){const n=this.addEdge(e,t,EdgeTypeNormal);if(n.hasValue()||void 0!==n.value){const r=n.getValue();return r===TombStone&&throwUnknownIdentifier(e),t.continueCalculation(r)}if(n.isShadow())return n.startOrigin(),n.forceCalculation(),void r.push(n);if(!n.isCalculationStarted())return r.push(n),void(n.previous&&n.previous.hasValue()||n.forceCalculation());{let e;TransactionCycleDetectionWalkContext.new({transaction:this,onCycle:(t,r)=>(e=ComputationCycle.new({cycle:cycleInfo(r)}),OnCycleAction.Cancel)}).startFrom([n.identifier]),this.graph.onComputationCycleHandler(t,n,e)}}*calculateTransitions(e){const t=this.stackGen;for(;t.length;)yield*this.calculateTransitionsStackGen(e,t.takeLowestLevel())}calculateTransitionsSync(e){const t=this.stackGen;for(;t.length;)this.calculateTransitionsStackSync(e,t.takeLowestLevel())}*calculateTransitionsStackGen(e,t){if(this.rejectedWith)return;this.walkContext.startNewEpoch();const r=this.entries,n=this.propagationStartDate,i=!!this.graph&&this.graph.enableProgressNotifications;let s=0;const o=this.activeStack;for(this.activeStack=t;t.length&&!this.rejectedWith;){if(i&&!(s++%this.emitProgressNotificationsEveryCalculations)){const e=Date.now();if(e-n>this.startProgressNotificationsAfterMs){const r=this.lastProgressNotificationDate;(!r||e-r>this.emitProgressNotificationsEveryMs)&&(this.lastProgressNotificationDate=e,this.graph.onPropagationProgressNotification({total:this.plannedTotalIdentifiersToCalculate,remaining:t.length,phase:"propagating"}),yield delay(0))}}const e=t[t.length-1],o=e.identifier;if(r.get(o)!==e){e.cleanup(),t.pop();continue}if(0==e.edgesFlow){e.edgesFlow--;const t=e.previous;t&&t.outgoingInTheFutureAndPastTransactionCb(this,(e=>{const t=r.get(e.identifier);t&&t.edgesFlow--}))}if(e.edgesFlow<0&&e.previous&&e.previous.origin){e.setOrigin(e.previous.origin),0===e.size&&r.delete(o),e.cleanup(),t.pop();continue}if(e.hasValue()||e.proposedValue===TombStone){e.cleanup(),t.pop();continue}const a=e.visitEpoch;let l=e.isCalculationStarted()?e.iterationResult:e.startCalculation(this.onEffectSync);for(;l;){const r=void 0===l.value?null:l.value;if(e.isCalculationCompleted()){e.visitEpoch==a&&this.onQuarkCalculationCompleted(e,r),t.pop();break}if(r instanceof Identifier)l=this.onReadIdentifier(r,e,t);else{if(r===SynchronousCalculationStarted){t.pop();break}{const n=yield r;if(n===BreakCurrentStackExecution)break;if(e.visitEpoch!==a){t.pop();break}l=e.continueCalculation(n)}}}}this.activeStack=o}calculateTransitionsStackSync(e,t){if(this.rejectedWith)return;this.walkContext.startNewEpoch();const r=this.entries,n=this.activeStack;for(this.activeStack=t;t.length&&!this.rejectedWith;){const n=t[t.length-1],i=n.identifier;if(r.get(i)!==n){n.cleanup(),t.pop();continue}if(0==n.edgesFlow){n.edgesFlow--;const e=n.previous;e&&e.outgoingInTheFutureAndPastTransactionCb(this,(e=>{const t=r.get(e.identifier);t&&t.edgesFlow--}))}if(n.edgesFlow<0&&n.previous&&n.previous.origin){n.setOrigin(n.previous.origin),0===n.size&&r.delete(i),n.cleanup(),t.pop();continue}if(n.hasValue()||n.proposedValue===TombStone){n.cleanup(),t.pop();continue}const s=n.visitEpoch;let o=n.isCalculationStarted()?n.iterationResult:n.startCalculation(this.onEffectSync);for(;o;){const r=void 0===o.value?null:o.value;if(n.isCalculationCompleted()){n.visitEpoch==s&&this.onQuarkCalculationCompleted(n,r),t.pop();break}if(r instanceof Identifier)o=this.onReadIdentifier(r,n,t);else{if(r===SynchronousCalculationStarted){t.pop();break}{const i=e(r);if(i instanceof Promise)throw new Error("Effect resolved to promise in the synchronous context, check that you marked the asynchronous calculations accordingly");if(i===BreakCurrentStackExecution)break;if(n.visitEpoch!==s){t.pop();break}o=n.continueCalculation(i)}}}}this.activeStack=n}}const CommitZero={rejectedWith:null};class Listener extends Base$1{constructor(){super(...arguments),this.handlers=[]}trigger(e){for(let t=0;t<this.handlers.length;t++)this.handlers[t](e)}}class ChronoGraph extends Base$1{constructor(){super(...arguments),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.baseRevision=Revision.new(),this.topRevision=void 0,this.historyLimit=0,this.listeners=new Map,this.$activeTransaction=void 0,this.isCommitting=!1,this.enableProgressNotifications=!1,this.ongoing=Promise.resolve(),this._isInitialCommit=!0,this.autoCommitTimeoutId=null,this.autoCommit=!1,this.autoCommitMode="sync",this.autoCommitHandler=null,this.onWriteDuringCommit="throw",this.onComputationCycle="throw",this.transactionClass=Transaction$1,this.$followingRevision=void 0}initialize(...e){super.initialize(...e),this.topRevision||(this.topRevision=this.baseRevision),this.autoCommit&&(this.autoCommitHandler="sync"===this.autoCommitMode?e=>this.commit(e):async e=>this.commitAsync(e)),this.markAndSweep()}hasPendingAutoCommit(){return null!==this.autoCommitTimeoutId}get dirty(){return this.activeTransaction.dirty}clear(){this.reject(),this.unScheduleAutoCommit(),this.baseRevision.scope&&this.baseRevision.scope.clear(),this.baseRevision.previous=null,this.listeners.clear(),this.topRevision=this.baseRevision,this.$followingRevision=void 0,this.$activeTransaction=void 0,this.markAndSweep()}*eachReachableRevision(){let e=!0,t=0;for(const r of this.topRevision.previousAxis())yield[r,e||t<this.historyLimit],r===this.baseRevision?e=!1:e||t++}get isInitialCommit(){return this._isInitialCommit}set isInitialCommit(e){this._isInitialCommit=e}markAndSweep(){let e;const t=[];for(const[r,n]of this.eachReachableRevision())n?(r.reachableCount++,e=r):t.push(r),r.referenceCount++;t.unshift(e);for(let e=t.length-1;e>=1&&0===t[e].reachableCount;e--)this.compactRevisions(t[e-1],t[e])}compactRevisions(e,t){if(t.reachableCount>0||e.previous!==t)throw new Error("Invalid compact operation");if(t.referenceCount<=1){for(const[r,n]of e.scope)if(n.getValue()===TombStone)t.scope.delete(r);else{const i=t.scope.get(r);n.origin===n?i&&(i.clear(),i.clearProperties()):i&&n.origin===i?n.mergePreviousOrigin(e.scope):r.lazy&&!n.origin&&i&&i.origin&&(n.startOrigin().proposedValue=void 0!==i.origin.value?i.origin.value:i.origin.proposedValue),n.previous=void 0,t.scope.set(r,n)}copySetInto(e.selfDependent,t.selfDependent),e.scope=t.scope,t.scope=null}else e.scope=new Map(concat(t.scope,e.scope)),e.selfDependent=new Set(concat(t.selfDependent,e.selfDependent)),t.referenceCount--;e.previous=null}get followingRevision(){if(void 0!==this.$followingRevision)return this.$followingRevision;const e=Array.from(this.topRevision.previousAxis()),t=[];for(let r=e.length-1;r>0;r--)t.push([e[r],e[r-1]]);return this.$followingRevision=new Map(t)}get activeTransaction(){return this.$activeTransaction?this.$activeTransaction:this.$activeTransaction=this.transactionClass.new({baseRevision:this.baseRevisionTentative||this.baseRevision,graph:this})}branch(e){return this.constructor.new(Object.assign({},e,{baseRevision:this.baseRevision}))}propagate(e){return this.commit(e)}reject(e){this.activeTransaction.reject(RejectEffect.new({reason:e})),this.ongoing=Promise.resolve(),this.$activeTransaction=void 0,this.baseRevisionTentative=void 0,this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable,this.baseRevisionStable=void 0)}commit(e){this.unScheduleAutoCommit(),this.baseRevisionStable=this.baseRevision;const t=this.activeTransaction.commit(e);this.$activeTransaction=void 0;const r=this.finalizeCommit(t);return this.baseRevisionStable=void 0,this.isInitialCommit=!1,r}async propagateAsync(e){return this.commitAsync(e)}async commitAsync(e){return this.isCommitting?this.ongoing:(this.isCommitting=!0,this.baseRevisionStable=this.baseRevision,this.ongoing=this.ongoing.then((()=>this.doCommitAsync(e))).then((e=>e)).finally((()=>{this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.isInitialCommit=!1,this.isCommitting=!1})))}async doCommitAsync(e){this.unScheduleAutoCommit();const t=this.activeTransaction,r=await t.commitAsync(e);this.baseRevisionTentative=t.candidate,this.$activeTransaction=void 0;const n=this.finalizeCommit(r);return await this.finalizeCommitAsync(r),this.activeTransaction.dirty?await this.doCommitAsync(e):n}finalizeCommit(e){const{revision:t,entries:r,transaction:n}=e;if(n.rejectedWith)this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0;else{if(t.previous!==this.baseRevision)throw new Error("Invalid revisions chain");for(const[e,t]of this.eachReachableRevision())t&&e.reachableCount--,e.referenceCount--;this.baseRevision=this.topRevision=t;for(const[e,t]of r){if(t.cleanup(),t.isShadow()||!t.hasValue())continue;const r=this.listeners.get(e);r&&r.trigger(t.getValue())}this.$followingRevision=void 0,this.markAndSweep()}return{rejectedWith:n.rejectedWith}}async finalizeCommitAsync(e){}onComputationCycleHandler(e,t,r){const n=new Error("Computation cycle:\n"+r);switch(n.cycle=r,this.onComputationCycle){case"ignore":return console.log(n.message),e.continueCalculation(void 0!==t.proposedValue?t.proposedValue:t.value);case"throw":throw n;case"reject":this.reject(n)}}scheduleAutoCommit(){null===this.autoCommitTimeoutId&&(this.autoCommitTimeoutId=setTimeout(this.autoCommitHandler,10))}unScheduleAutoCommit(){null!==this.autoCommitTimeoutId&&(clearTimeout(this.autoCommitTimeoutId),this.autoCommitTimeoutId=null)}variable(e){const t=VariableC();return this.addIdentifier(t,void 0===e?null:e)}variableNamed(e,t){const r=VariableC({name:e});return this.addIdentifier(r,void 0===t?null:t)}identifier(e,t){const r=isGeneratorFunction(e)?CalculatedValueGenC({calculation:e,context:t}):CalculatedValueSyncC({calculation:e,context:t});return this.addIdentifier(r)}identifierNamed(e,t,r){const n="GeneratorFunction"===t.constructor.name?CalculatedValueGenC({name:e,calculation:t,context:r}):CalculatedValueSyncC({name:e,calculation:t,context:r});return this.addIdentifier(n)}addIdentifier(e,t,...r){if(this.isCommitting){if("throw"===this.onWriteDuringCommit)throw new Error("Adding identifier during commit");this.onWriteDuringCommit}return this.activeTransaction.addIdentifier(e,t,...r),this.autoCommit&&this.scheduleAutoCommit(),e}removeIdentifier(e){if(this.isCommitting){if("throw"===this.onWriteDuringCommit)throw new Error("Removing identifier during commit");this.onWriteDuringCommit}this.activeTransaction.removeIdentifier(e),this.listeners.delete(e),this.autoCommit&&this.scheduleAutoCommit()}hasIdentifier(e){return this.activeTransaction.hasIdentifier(e)}write(e,t,...r){if(this.isCommitting){if("throw"===this.onWriteDuringCommit)throw new Error("Write during commit");this.onWriteDuringCommit}this.activeTransaction.write(e,t,...r),this.autoCommit&&this.scheduleAutoCommit()}readPrevious(e){return this.activeTransaction.readPrevious(e)}readPreviousAsync(e){return this.activeTransaction.readPreviousAsync(e)}read(e){return this.activeTransaction.read(e)}readAsync(e){return this.activeTransaction.readAsync(e)}get(e){return this.activeTransaction.get(e)}observe(e,t){const r=this.addIdentifier(CalculatedValueGen.new({lazy:!1,calculation:e}));return this.addListener(r,t),r}observeContext(e,t,r){const n=this.addIdentifier(CalculatedValueGen.new({lazy:!1,calculation:e,context:t}));return this.addListener(n,r),n}addListener(e,t){let r=this.listeners.get(e);r||(r=Listener.new(),this.listeners.set(e,r)),r.handlers.push(t)}undo(){const e=this.baseRevision.previous;return!!e&&(this.baseRevision=e,this.$activeTransaction=void 0,!0)}redo(){const e=this.baseRevision;if(e===this.topRevision)return!1;const t=this.followingRevision.get(e);return this.baseRevision=t,this.$activeTransaction=void 0,!0}onPropagationProgressNotification(e){}[ProposedOrPreviousSymbol](e,t){const r=t.getActiveEntry();r.usedProposedOrPrevious=!0;const n=r.getProposedValue(t);if(void 0!==n)return n;if(!r.previous)return;return r.identifier.lazy?r.previous.hasValue()?r.previous.getValue():r.previous.hasProposedValue()?r.previous.getProposedValue(t):null:t.readPrevious(r.identifier)}[RejectSymbol](e,t){return this.reject(e.reason),BreakCurrentStackExecution}[TransactionSymbol](e,t){return t}[OwnQuarkSymbol](e,t){return t.getActiveEntry()}[OwnIdentifierSymbol](e,t){return t.getActiveEntry().identifier}[WriteSymbol](e,t){const r=t.getActiveEntry();if(r.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");const n=e.identifier.level>r.identifier.level;return n||t.walkContext.startNewEpoch(),t.write(e.identifier,...e.proposedArgs),n?void 0:BreakCurrentStackExecution}[WriteSeveralSymbol](e,t){const r=t.getActiveEntry();if(r.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");let n=!0;return e.writes.forEach((e=>{e.identifier.level<=r.identifier.level&&n&&(t.walkContext.startNewEpoch(),n=!1),t.write(e.identifier,...e.proposedArgs)})),n?void 0:BreakCurrentStackExecution}[PreviousValueOfSymbol](e,t){const r=t.getActiveEntry(),n=e.identifier;return t.addEdge(n,r,EdgeTypePast),t.readPrevious(n)}[ProposedValueOfSymbol](e,t){const r=t.getActiveEntry(),n=e.identifier;t.addEdge(n,r,EdgeTypePast);const i=t.entries.get(n);return i&&!i.isShadow()?i.getProposedValue(t):void 0}[HasProposedValueSymbol](e,t){const r=t.getActiveEntry(),n=e.identifier;t.addEdge(n,r,EdgeTypePast);const i=t.entries.get(n);return!!i&&i.hasProposedValue()}[ProposedOrPreviousValueOfSymbol](e,t){const r=t.getActiveEntry(),n=e.identifier;return t.addEdge(n,r,EdgeTypePast),t.readProposedOrPrevious(n)}[UnsafeProposedOrPreviousValueOfSymbol](e,t){return t.readProposedOrPrevious(e.identifier)}[UnsafePreviousValueOfSymbol](e,t){return t.readPrevious(e.identifier)}[ProposedArgumentsOfSymbol](e,t){const r=t.getActiveEntry(),n=e.identifier;t.addEdge(n,r,EdgeTypePast);const i=t.entries.get(n);return i&&!i.isShadow()?i.proposedArguments:void 0}}class EntityMeta extends Base$1{constructor(){super(...arguments),this.name=void 0,this.ownFields=new Map,this.schema=void 0,this.$skeleton={},this.$allFields=void 0}hasField(e){return void 0!==this.getField(e)}getField(e){return this.allFields.get(e)}addField(e){const t=e.name;if(!t)throw new Error("Field must have a name");if(this.ownFields.has(t))throw new Error(`Field with name [${t}] already exists`);return e.entity=this,this.ownFields.set(t,e),e}forEachParent(e){let t=this;for(;t;)e(t),t=t.parentEntity}get allFields(){if(void 0!==this.$allFields)return this.$allFields;const e=new Map,t=new Set;return this.forEachParent((r=>{r.ownFields.forEach(((r,n)=>{t.has(n)||(t.add(n),e.set(n,r))}))})),this.$allFields=e}forEachField(e){this.allFields.forEach(e)}}var ReadMode;!function(e){e[e.Current=0]="Current",e[e.Previous=1]="Previous",e[e.ProposedOrPrevious=2]="ProposedOrPrevious",e[e.CurrentOrProposedOrPrevious=3]="CurrentOrProposedOrPrevious"}(ReadMode||(ReadMode={}));class Replica extends(Mixin([ChronoGraph],(e=>class extends e{constructor(){super(...arguments),this.autoCommit=!0,this.readMode=ReadMode.Current}addEntity(e){e.enterGraph(this)}addEntities(e){e.forEach((e=>this.addEntity(e)))}removeEntity(e){e.leaveGraph(this)}removeEntities(e){e.forEach((e=>this.removeEntity(e)))}}))){}class FieldIdentifier extends(Mixin([Identifier],(e=>class extends e{constructor(){super(...arguments),this.field=void 0,this.self=void 0,this.DATA=void 0}getFromGraph(e){return e?e.readMode===ReadMode.Current?e.get(this):e.readMode===ReadMode.Previous?e.activeTransaction.readPrevious(this):(e.readMode===ReadMode.ProposedOrPrevious&&e.activeTransaction.readProposedOrPrevious(this),e.activeTransaction.readCurrentOrProposedOrPrevious(this)):this.DATA}readFromGraph(e){return e?e.read(this):this.DATA}writeToGraph(e,t,...r){e?e.write(this,t,...r):this.DATA=t}leaveGraph(e){const t=e.activeTransaction.getLatestStableEntryFor(this);t&&(this.DATA=t.getValue()),super.leaveGraph(e)}toString(){return this.name}}))){}class MinimalFieldIdentifierSync extends(FieldIdentifier.mix(CalculatedValueSync)){}class MinimalFieldIdentifierGen extends(FieldIdentifier.mix(CalculatedValueGen)){}class MinimalFieldVariable extends(FieldIdentifier.mix(Variable)){}class EntityIdentifier extends(Mixin([Identifier],(e=>class extends e{constructor(){super(...arguments),this.entity=void 0,this.self=void 0}equality(){return!1}toString(){return`Entity identifier [${this.self}]`}}))){}class MinimalEntityIdentifier extends(EntityIdentifier.mix(CalculatedValueGen)){}class Field$1 extends Meta{constructor(){super(...arguments),this.persistent=!0}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?isGeneratorFunction(e)?MinimalFieldIdentifierGen:MinimalFieldIdentifierSync:MinimalFieldVariable}}const isEntityMarker=Symbol("isEntity");class Entity extends(Mixin([],(e=>{return class extends e{[isEntityMarker](){}get $entity(){return createEntityOnPrototype(this.constructor.prototype)}get $(){const e={};return this.$entity.forEachField(((t,r)=>{e[r]=this.createFieldIdentifier(t)})),defineProperty$6(this,"$",e)}get $$(){return defineProperty$6(this,"$$",MinimalEntityIdentifier.new({name:this.$entityName,entity:this.$entity,calculation:this.calculateSelf,context:this,self:this}))}get $entityName(){return this.constructor.name||this.$entity.name}*calculateSelf(){return this}createFieldIdentifier(e){const t=e.name,r=this.$entity,n=this.constructor,i=r.$skeleton;i[t]||(i[t]=n.getIdentifierTemplateClass(this,e));const s=new i[t];return s.context=this,s.self=this,s.name=`${this.$$.name}.$.${e.name}`,s}forEachFieldIdentifier(e){this.$entity.forEachField(((t,r)=>e(this.$[r],r)))}enterGraph(e){if(this.graph)throw new Error("Already entered replica");this.graph=e,e.addIdentifier(this.$$),this.$entity.forEachField(((t,r)=>{const n=this.$[r];e.addIdentifier(n,n.DATA),n.DATA=void 0}))}leaveGraph(e){const t=this.graph,r=e||t;r&&(this.$entity.forEachField(((e,t)=>r.removeIdentifier(this.$[t]))),r.removeIdentifier(this.$$),r===t&&(this.graph=void 0))}propagate(e){return this.commit(e)}commit(e){const t=this.graph;return t?t.commit(e):CommitZero}async propagateAsync(){return this.commitAsync()}async commitAsync(e){const t=this.graph;return t?t.commitAsync(e):Promise.resolve(CommitZero)}static get $entity(){return ensureEntityOnPrototype(this.prototype)}static getIdentifierTemplateClass(e,t){const r=t.name,n={name:`${e.$$.name}.$.${r}`,field:t};t.hasOwnProperty("sync")&&(n.sync=t.sync),t.hasOwnProperty("lazy")&&(n.lazy=t.lazy),t.hasOwnProperty("equality")&&(n.equality=t.equality);const i=e.$calculations&&e[e.$calculations[r]];i&&(n.calculation=i);const s=e.$writes&&e[e.$writes[r]];s&&(n.write=s);const o=e.$buildProposed&&e[e.$buildProposed[r]];o&&(n.buildProposedValue=o,n.proposedValueIsBuilt=!0);const a=t.getIdentifierClass(i).new(n),l=function(){};return l.prototype=a,l}run(e,...t){return runGeneratorSyncWithEffect((e=>{if(e instanceof Identifier)return this.graph.read(e);throw new Error("Helper methods can not yield effects during computation")}),this[e],t,this)}static createPropertyAccessorsFor(e){const t=e,r=this.prototype;Object.defineProperty(r,t,{get:function(){return this.$[t].getFromGraph(this.graph)},set:function(e){this.$[t].writeToGraph(this.graph,e)}})}static createMethodAccessorsFor(e){const t=e,r=this.prototype,n="get"+uppercaseFirst(t),i="set"+uppercaseFirst(t),s="put"+uppercaseFirst(t);n in r||(r[n]=function(){return this.$[t].getFromGraph(this.graph)}),i in r||(r[i]=function(e,...r){return this.$[t].writeToGraph(this.graph,e,...r),this.graph?"sync"===this.graph.autoCommitMode?this.graph.commit():this.graph.commitAsync():Promise.resolve(CommitZero)}),s in r||(r[s]=function(e,...r){this.$[t].writeToGraph(this.graph,e,...r)})}}}))){}const createEntityOnPrototype=e=>{let t=Object.getPrototypeOf(e);return defineProperty$6(e,"$entity",EntityMeta.new({parentEntity:t.hasOwnProperty(isEntityMarker)?null:t.$entity,name:e.constructor.name}))},ensureEntityOnPrototype=e=>(e.hasOwnProperty("$entity")||createEntityOnPrototype(e),e.$entity),generic_field=(e,t=Field$1)=>function(r,n){ensureEntityOnPrototype(r).addField(t.new(Object.assign(e||{},{name:n})));const i=r.constructor;i.createPropertyAccessorsFor(n),i.createMethodAccessorsFor(n)},field=generic_field,calculate=function(e){return function(t,r,n){let i;ensureEntityOnPrototype(t),i=t.$calculations?t.hasOwnProperty("$calculations")?t.$calculations:t.$calculations=Object.create(t.$calculations):t.$calculations={},i[e]=r}},write=function(e){return function(t,r,n){let i;ensureEntityOnPrototype(t),i=t.$writes?t.hasOwnProperty("$writes")?t.$writes:t.$writes=Object.create(t.$writes):t.$writes={},i[e]=r}},build_proposed=function(e){return function(t,r,n){let i;ensureEntityOnPrototype(t),i=t.$buildProposed?t.hasOwnProperty("$buildProposed")?t.$buildProposed:t.$buildProposed=Object.create(t.$buildProposed):t.$buildProposed={},i[e]=r}};var __decorate$2=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class ReferenceField extends(Mixin([Field$1],(e=>class extends e{constructor(){super(...arguments),this.identifierCls=MinimalReferenceIdentifier}}))){}const reference=(e,t=ReferenceField)=>generic_field(e,t);class ReferenceIdentifier extends(Mixin([FieldIdentifier],(e=>{class t extends e{constructor(){super(...arguments),this.field=void 0,this.proposedValueIsBuilt=!0}hasBucket(){return Boolean(this.field.bucket)}getBucket(e){return e.$[this.field.bucket]}buildProposedValue(e,t,r){const n=t.proposedValue;if(null===n)return null;const i=isInstanceOf(n,Entity)?n:e.resolve(n);return i&&e.hasBucket()&&e.getBucket(i).addToBucket(r,e.self),i}resolve(e){const t=this.field.resolver;return t?t.call(this.self,e):null}enterGraph(e){if(this.hasBucket()){const t=e.activeTransaction.readProposedOrPrevious(this);t instanceof Entity&&this.getBucket(t).addToBucket(e.activeTransaction,this.self)}super.enterGraph(e)}leaveGraph(e){if(this.hasBucket()){const t=e.activeTransaction.readProposedOrPrevious(this);t instanceof Entity&&this.getBucket(t).removeFromBucket(e.activeTransaction,this.self)}super.leaveGraph(e)}write(e,t,r,n){const i=r||t.acquireQuarkIfExists(e);if(e.hasBucket())if(i){const r=i.getValue();r instanceof Entity&&e.getBucket(r).removeFromBucket(t,e.self)}else if(t.baseRevision.hasIdentifier(e)){const r=t.readPrevious(e);r instanceof Entity&&e.getBucket(r).removeFromBucket(t,e.self)}super.write(e,t,r,n)}}return __decorate$2([prototypeValue(Levels.DependsOnlyOnUserInput)],t.prototype,"level",void 0),__decorate$2([prototypeValue(QuarkSync)],t.prototype,"quarkClass",void 0),t}))){}class MinimalReferenceIdentifier extends(ReferenceIdentifier.mix(FieldIdentifier.mix(CalculatedValueSync))){}var __decorate$3=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class ReferenceBucketField extends(Mixin([Field$1],(e=>class extends e{constructor(){super(...arguments),this.persistent=!1,this.identifierCls=MinimalReferenceBucketIdentifier}}))){}const bucket=(e,t=ReferenceBucketField)=>generic_field(e,t);var BucketMutationType;!function(e){e.Add="Add",e.Remove="Remove"}(BucketMutationType||(BucketMutationType={}));class ReferenceBucketQuark extends(Mixin([Quark],(e=>class extends e{constructor(){super(...arguments),this.mutations=[],this.previousValue=void 0}hasProposedValueInner(){return this.mutations.length>0}}))){}const MinimalReferenceBucketQuark=ReferenceBucketQuark.mix(QuarkSync);class ReferenceBucketIdentifier extends(Mixin([FieldIdentifier],(e=>{class t extends e{constructor(){super(...arguments),this.proposedValueIsBuilt=!0}addToBucket(e,t){const r=e.getWriteTarget(this);r.mutations.push({type:BucketMutationType.Add,entity:t});const n=e.baseRevision;!r.previousValue&&n.hasIdentifier(this)&&(r.previousValue=e.readPrevious(this))}removeFromBucket(e,t){const r=e.entries.get(this);if(r&&r.getValue()===TombStone)return;const n=e.getWriteTarget(this);n.mutations.push({type:BucketMutationType.Remove,entity:t});const i=e.baseRevision;!n.previousValue&&i.hasIdentifier(this)&&(n.previousValue=e.readPrevious(this))}buildProposedValue(e,t,r){const n=t,i=new Set(n.previousValue);for(let e=0;e<n.mutations.length;e++){const{type:t,entity:r}=n.mutations[e];t===BucketMutationType.Remove?i.delete(r):t===BucketMutationType.Add&&i.add(r)}return i}leaveGraph(e){super.leaveGraph(e),this.DATA=void 0}}return __decorate$3([prototypeValue(Levels.DependsOnlyOnDependsOnlyOnUserInput)],t.prototype,"level",void 0),__decorate$3([prototypeValue(MinimalReferenceBucketQuark)],t.prototype,"quarkClass",void 0),t}))){}class MinimalReferenceBucketIdentifier extends(ReferenceBucketIdentifier.mix(FieldIdentifier.mix(CalculatedValueSync))){}var __decorate$4=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const isSerializableEqual=function(e,t){return e===t||((null==t?void 0:t.isBase)?this.serialize(t):t)==((null==e?void 0:e.isBase)?this.serialize(e):e)};class ModelField extends Field$1{constructor(){super(...arguments),this.modelFieldConfig={}}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?isGeneratorFunction(e)?MinimalChronoModelFieldIdentifierGen:MinimalChronoModelFieldIdentifierSync:MinimalChronoModelFieldVariable}}class ModelReferenceField extends(ReferenceField.mix(ModelField)){constructor(){super(...arguments),this.identifierCls=ChronoModelReferenceFieldIdentifier}}class ModelBucketField extends(ReferenceBucketField.mix(Field$1)){constructor(){super(...arguments),this.identifierCls=ChronoModelReferenceBucketFieldIdentifier}}const IsChronoModelSymbol=Symbol("IsChronoModelSymbol");class ChronoModelFieldIdentifier extends(Mixin([FieldIdentifier],(e=>{const t=e.prototype;class r extends e{[IsChronoModelSymbol](){}getFromGraph(e){return e?e.readMode===ReadMode.CurrentOrProposedOrPrevious?this.sync?e.get(this):e.activeTransaction.readCurrentOrProposedOrPrevious(this):t.getFromGraph.call(this,e):this.DATA}write(e,r,n,i,...s){i=e.convert(i),t.write.call(this,e,r,n,i,...s)}convert(e){const t=this.field,r=this.self.getFieldDefinition(t.name);return(null==r?void 0:r.convert)?e=r.convert(e):t.converter&&(e=t.converter(e,t)),e}equality(e,t){return e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e===t}}return __decorate$4([prototypeValue(!1)],r.prototype,"sync",void 0),r}))){}class ChronoModelReferenceFieldQuark extends(Mixin([ReferenceBucketQuark],(e=>{const t=e.prototype;return class extends e{setValue(e){t.setValue.call(this,e),e!==TombStone&&(this.identifier.DATA=e)}}}))){}const MinimalChronoModelReferenceFieldQuark=ChronoModelReferenceFieldQuark.mix(MinimalReferenceBucketQuark);class ChronoModelReferenceFieldIdentifier extends(ReferenceIdentifier.mix(ChronoModelFieldIdentifier.mix(MinimalFieldIdentifierSync))){buildProposedValue(e,t,r){const n=t,i=n.proposedValue;if(null===i)return r.candidate.failedResolutionReferences.delete(n.identifier),null;if(isInstanceOf(i,Entity))return e.hasBucket()&&e.getBucket(i).addToBucket(r,e.self),r.candidate.failedResolutionReferences.delete(n.identifier),i;const s=e.resolve(i);return isInstanceOf(s,Entity)?(e.hasBucket()&&e.getBucket(s).addToBucket(r,e.self),r.candidate.failedResolutionReferences.delete(n.identifier),s):(r.candidate.failedResolutionReferences.set(n.identifier,i),null)}}__decorate$4([prototypeValue(!0)],ChronoModelReferenceFieldIdentifier.prototype,"sync",void 0),__decorate$4([prototypeValue(MinimalChronoModelReferenceFieldQuark)],ChronoModelReferenceFieldIdentifier.prototype,"quarkClass",void 0);class ChronoModelReferenceBucketFieldIdentifier extends(ReferenceBucketIdentifier.mix(ChronoModelFieldIdentifier.mix(MinimalFieldIdentifierSync))){}__decorate$4([prototypeValue(!0)],ChronoModelReferenceBucketFieldIdentifier.prototype,"sync",void 0);class MinimalChronoModelFieldIdentifierSync extends(ChronoModelFieldIdentifier.mix(MinimalFieldIdentifierSync)){}class MinimalChronoModelFieldIdentifierGen extends(ChronoModelFieldIdentifier.mix(MinimalFieldIdentifierGen)){}class MinimalChronoModelFieldVariable extends(ChronoModelFieldIdentifier.mix(MinimalFieldVariable)){}const model_field=function(e={},t={},r=ModelField){return function(n,i){generic_field(Object.assign({modelFieldConfig:e},t),r)(n,i),injectStaticFieldsProperty(n.constructor)}},injectStaticFieldsProperty=e=>{e.hasOwnProperty("fields")||Object.defineProperty(e,"fields",{get:function(){return getDecoratedModelFields(this)}})},getDecoratedModelFields=e=>{const t=e.prototype,r=[];return t.hasOwnProperty("$entity")&&t.$entity.ownFields.forEach((e=>{if(e instanceof ModelField){const t=e.modelFieldConfig||{};!t.convert&&e.converter&&e.converter!==dateConverter&&(t.convert=e.converter),r.push(Object.assign(t,{$chrono:e,name:e.name}))}})),r},dateConverter=(e,t)=>{var r,n;return null===e?null:(e instanceof Date||(e=DateHelper.parse(e,(null===(r=t.modelFieldConfig)||void 0===r?void 0:r.format)||(null===(n=t.modelFieldConfig)||void 0===n?void 0:n.dateFormat)||DateHelper.defaultParseFormat)),e||void 0)};class ChronoModelMixin extends(Mixin([Entity,Model],(e=>{const t=e.prototype;return class extends e{construct(e,...r){this.constructor.exposeProperties(),this.originalData=e=e||{},t.construct.call(this,e,...r)}copy(e=null,r=null){const n=t.copy.call(this,e,r);return(ObjectHelper.isObject(r)&&!r.skipFieldIdentifiers||!ObjectHelper.isObject(r))&&this.forEachFieldIdentifier(((e,t)=>{n[t]=this[t]})),n}applyValue(e,r,n,i,s){this.$entity.getField(r)&&(e=!0),i&&(e=!1),t.applyValue.call(this,e,r,n,i,s)}afterChange(e,r,n,i,s){!s&&Object.keys(r).some((e=>this.$entity.getField(e)))?t.afterChange.call(this,e,r,!0,i,s):t.afterChange.apply(this,arguments)}get data(){return this._data}set data(e){this._data=e;const{fields:t}=this;for(let r=0;r<t.length;r++){const n=t[r];if(this.$entity.getField(n.name)){const t=n.complexMapping?ObjectHelper.getPath(e,n.dataSource):e[n.dataSource];this[n.name]=t}}}get $entityName(){const e=this.constructor.name||this.$entity.name,t=this.id;return`${e}${null!=t?"-"+String(t):""}`}}}))){}class AbstractPartOfProjectGenericMixin extends(Mixin([],(e=>{e.prototype;return class extends e{async commitAsync(){return this.project.commitAsync()}set project(e){this.$project=e}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(e){return this.project=e}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const e=this.getProject();return null==e?void 0:e.assignmentStore}getDependencyStore(){const e=this.getProject();return null==e?void 0:e.dependencyStore}getEventStore(){const e=this.getProject();return null==e?void 0:e.eventStore}getResourceStore(){const e=this.getProject();return null==e?void 0:e.resourceStore}getCalendarManagerStore(){const e=this.getProject();return null==e?void 0:e.calendarManagerStore}}}))){}class ChronoPartOfProjectGenericMixin extends(Mixin([AbstractPartOfProjectGenericMixin],(e=>{e.prototype;return class extends e{getGraph(){const e=this.getProject();return null==e?void 0:e.getGraph()}getEventById(e){var t;return null===(t=this.getEventStore())||void 0===t?void 0:t.getById(e)}getDependencyById(e){var t;return null===(t=this.getDependencyStore())||void 0===t?void 0:t.getById(e)}getResourceById(e){var t;return null===(t=this.getResourceStore())||void 0===t?void 0:t.getById(e)}getAssignmentById(e){var t;return null===(t=this.getAssignmentStore())||void 0===t?void 0:t.getById(e)}getCalendarById(e){var t;return null===(t=this.getCalendarManagerStore())||void 0===t?void 0:t.getById(e)}}}))){}class ChronoStoreMixin extends(Mixin([Store],(e=>class extends e{}))){}class AbstractPartOfProjectStoreMixin extends(Mixin([AbstractPartOfProjectGenericMixin,Store],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.isLoadingData=!1}construct(e={}){return e.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},t.construct.call(this,e)}trigger(e,r){const n=this,{asyncEvents:i,project:s}=n,o=null==i?void 0:i[e];return o&&(!0===o||o[r.action])?(t.trigger.call(n,e+"PreCommit",Object.assign({},r)),!s||s.isEngineReady()&&!s.isWritingData?t.trigger.call(n,e,r):null==s||s.on({dataReady(){t.trigger.call(n,e,r)},once:!0,thisObj:this}),!0):t.trigger.call(n,e,r)}calculateProject(){return this.project}setStoreData(e){var r;this.project&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,t.setStoreData.call(this,e),this.isLoadingData=!1,null===(r=this.project)||void 0===r||r.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&!this.project.isEngineReady()&&await this.project.commitAsync(),t.doAutoCommit.call(this)}async addAsync(e,t){const r=this.add(e,t);return await this.project.commitAsync(),r}async insertAsync(e,t,r){const n=this.insert(e,t,r);return await this.project.commitAsync(),n}async loadDataAsync(e){this.data=e,await this.project.commitAsync()}}}))){}class ChronoPartOfProjectStoreMixin extends(Mixin([AbstractPartOfProjectStoreMixin,ChronoPartOfProjectGenericMixin,ChronoStoreMixin],(e=>{const t=e.prototype;return class extends e{setStoreData(e){var r;null===(r=this.project)||void 0===r||r.repopulateStore(this),t.setStoreData.call(this,e)}}}))){}class AbstractPartOfProjectModelMixin extends(Mixin([AbstractPartOfProjectGenericMixin,Model],(e=>{const t=e.prototype;return class extends e{joinStore(e){let r=!1;if(isInstanceOf(e,AbstractPartOfProjectStoreMixin)){const t=e.getProject();!t||t.isRepopulatingStores||this.getProject()||(this.setProject(t),r=!0)}t.joinStore.call(this,e),r&&this.joinProject()}unJoinStore(e,r=!1){t.unJoinStore.call(this,e,r);const n=this.getProject();n&&!n.isDestroying&&!n.isRepopulatingStores&&isInstanceOf(e,AbstractPartOfProjectStoreMixin)&&n===e.getProject()&&(this.leaveProject(r),this.setProject(null))}joinProject(){}leaveProject(e=!1){}calculateProject(){const e=this.stores.find((e=>isInstanceOf(e,AbstractPartOfProjectStoreMixin)&&!!e.getProject()));return null==e?void 0:e.getProject()}async setAsync(e,t,r){var n;const i=this.set(e,t,r);return await(null===(n=this.project)||void 0===n?void 0:n.commitAsync()),i}async getAsync(e){var t;return await(null===(t=this.project)||void 0===t?void 0:t.commitAsync()),this.get(e)}}}))){}class ChronoPartOfProjectModelMixin extends(Mixin([AbstractPartOfProjectModelMixin,ChronoPartOfProjectGenericMixin,ChronoModelMixin],(e=>{const t=e.prototype;return class extends e{joinProject(){this.getGraph().addEntity(this)}leaveProject(e=!1){t.leaveProject.call(this,e);this.getGraph().removeEntity(this)}getProject(){return t.getProject.call(this)}calculateProject(){const e=this.stores.find((e=>isInstanceOf(e,ChronoPartOfProjectStoreMixin)&&!!e.getProject()));return null==e?void 0:e.getProject()}}}))){}var _window$bryntum,__decorate$5=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class BaseAssignmentMixin extends(Mixin([ChronoPartOfProjectModelMixin],(e=>{e.prototype;class t extends e{}return __decorate$5([generic_field({bucket:"assigned",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual,persist:!1}},ModelReferenceField)],t.prototype,"event",void 0),__decorate$5([generic_field({bucket:"assigned",resolver:function(e){return this.getResourceById(e)},modelFieldConfig:{serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual,persist:!1}},ModelReferenceField)],t.prototype,"resource",void 0),injectStaticFieldsProperty(t),t}))){}class CorePartOfProjectGenericMixin extends(Mixin([AbstractPartOfProjectGenericMixin],(e=>{e.prototype;return class extends e{get eventStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.eventStore}get resourceStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.resourceStore}get assignmentStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore}get dependencyStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.dependencyStore}get calendarManagerStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.calendarManagerStore}getEventById(e){var t;return null===(t=this.eventStore)||void 0===t?void 0:t.getById(e)}getDependencyById(e){var t;return null===(t=this.dependencyStore)||void 0===t?void 0:t.getById(e)}getResourceById(e){var t;return null===(t=this.resourceStore)||void 0===t?void 0:t.getById(e)}getAssignmentById(e){var t;return null===(t=this.assignmentStore)||void 0===t?void 0:t.getById(e)}getCalendarById(e){var t;return null===(t=this.calendarManagerStore)||void 0===t?void 0:t.getById(e)}}}))){}class CorePartOfProjectModelMixin extends(Mixin([AbstractPartOfProjectModelMixin,CorePartOfProjectGenericMixin,Model],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}joinProject(){this.invalidate()}leaveProject(e=!1){var r;t.leaveProject.call(this,e),null===(r=this.project)||void 0===r||r.bufferedCommitAsync()}invalidate(){var e;null===(e=this.project)||void 0===e||e.invalidate(this)}getCurrentOrProposed(e){var t;return e in this.$changed?this.$changed[e]:null!==(t=this.get(e))&&void 0!==t?t:null}hasCurrentOrProposed(e){return null!=this.$changed[e]||null!=this.get(e)}propose(e){Object.keys(e).forEach((t=>{this.$changed[t]=e[t]})),this.invalidate()}setChanged(e,t,r=!0,n=!1){const i=this;i.$changed[e]=t,n&&(e in i.$beforeChange||(i.$beforeChange[e]=i.get(e)),i.setData(e,t)),r&&i.invalidate()}calculateInvalidated(){}finalizeInvalidated(e=!1){const t=this;t.$isCalculating=!0,t.$changed.__REFADR__&&(t.$changed=Object.assign({},t.$changed)),Object.keys(t.$beforeChange).forEach((e=>{t.setData(e,t.$beforeChange[e])})),t.set(t.$changed,null,e),t.$changed={},t.$beforeChange={},t.$isCalculating=!1}}}))){}class CoreEventMixin extends(Mixin([CorePartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"string",defaultValue:"day"}]}get startDate(){return this.getCurrentOrProposed("startDate")}get endDate(){return this.getCurrentOrProposed("endDate")}get duration(){return this.getCurrentOrProposed("duration")}set startDate(e){this.proposeStartDate(e)}set endDate(e){this.proposeEndDate(e)}set duration(e){this.proposeDuration(e)}getStartDate(){return this.startDate}proposeStartDate(e,t=!0){this.propose({startDate:e,keepDuration:t})}async setStartDate(e,t=!0){var r;return this.proposeStartDate(e,t),null===(r=this.project)||void 0===r?void 0:r.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(e,t=!1){this.propose({endDate:e,keepDuration:t})}async setEndDate(e,t=!1){var r;return this.proposeEndDate(e,t),null===(r=this.project)||void 0===r?void 0:r.commitAsync()}getDuration(){return this.duration}proposeDuration(e,t,r=!0){this.propose({duration:e,keepStart:r}),t&&this.propose({durationUnit:t})}async setDuration(e,t,r=!0){var n;return this.proposeDuration(e,t,r),null===(n=this.project)||void 0===n?void 0:n.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){var e;const r=this.$changed;if(this.hasCurrentOrProposed("startDate")&&(r.startDate=this.getCurrentOrProposed("startDate")),this.hasCurrentOrProposed("endDate")&&(r.endDate=this.getCurrentOrProposed("endDate")),this.hasCurrentOrProposed("duration")&&(r.duration=this.getCurrentOrProposed("duration")),this.eventStore&&!this.eventStore.isLoadingData){const t=null===(e=this.assignmentStore)||void 0===e?void 0:e.storage.findItem("event",null);if(t)for(const e of t)e.getCurrentOrProposed("event")===this.id&&e.setChanged("event",this)}t.joinProject.call(this)}applyValue(e,r,n,i,s){"startDate"!==r&&"duration"!=r&&"endDate"!==r||(e=!0),i&&(e=!1),t.applyValue.call(this,e,r,n,i,s)}afterChange(e,r,n,i,s){this.$isCalculating||s||this.setData(this.$changed),t.afterChange.call(this,e,r,n,i,s)}calculateInvalidated(){const e=this.$changed,t="startDate"in e,r="endDate"in e,n="duration"in e,{startDate:i,endDate:s,duration:o,keepDuration:a,keepStart:l}=e;let c=null;switch(!t||r||n?t||!r||n?t||r||!n?t&&r&&!n?null===i&&null===s?e.duration=null:c="duration":t&&!r&&n?c="endDate":!t&&r&&n?c="startDate":t&&r&&n&&(c=null==o?"duration":null==i?"startDate":"endDate"):null===o?e.endDate=null:!this.hasCurrentOrProposed("startDate")||!l&&this.hasCurrentOrProposed("endDate")?this.hasCurrentOrProposed("endDate")&&(c="startDate"):(l&&e.duration<0&&(e.duration=0),c="endDate"):null===s?e.startDate=null:this.hasCurrentOrProposed("startDate")&&s<this.getCurrentOrProposed("startDate")&&!a?(e.startDate=s,e.duration=0):!this.hasCurrentOrProposed("duration")||!a&&this.hasCurrentOrProposed("startDate")?this.hasCurrentOrProposed("startDate")&&(c="duration"):c="startDate":null===i?e.endDate=null:this.hasCurrentOrProposed("endDate")&&i>this.getCurrentOrProposed("endDate")&&!a?(e.endDate=i,e.duration=0):!this.hasCurrentOrProposed("duration")||!a&&this.hasCurrentOrProposed("endDate")?this.hasCurrentOrProposed("endDate")&&(c="duration"):c="endDate",c){case"startDate":e.startDate=DateHelper.add(this.getCurrentOrProposed("endDate"),-this.getCurrentOrProposed("duration"),this.getCurrentOrProposed("durationUnit"));break;case"endDate":e.endDate=DateHelper.add(this.getCurrentOrProposed("startDate"),this.getCurrentOrProposed("duration"),this.getCurrentOrProposed("durationUnit"));break;case"duration":e.duration=DateHelper.diff(this.getCurrentOrProposed("startDate"),this.getCurrentOrProposed("endDate"),this.getCurrentOrProposed("durationUnit"))}delete e.keepDuration,delete e.keepStart}}}))){}class CoreResourceMixin extends(Mixin([CorePartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{get assigned(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore.getResourcesAssignments(this)}joinProject(){var e;this.resourceStore&&!this.resourceStore.isLoadingData&&(null===(e=this.assignmentStore)||void 0===e||e.query((e=>e.get("resource")===this.id)).forEach((e=>e.setChanged("resource",this)))),t.joinProject.call(this)}leaveProject(e=!1){if(this.assigned&&!e){const e=this.resourceStore;this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this)}applyValue(e,r,n,i,s){"id"===s.name&&this.assigned.forEach((e=>{e.set("resourceId",n)})),t.applyValue.call(this,e,r,n,i,s)}}}))){}class CoreAssignmentMixin extends(Mixin([CorePartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"resource",isEqual:(e,t)=>e===t,persist:!1},{name:"event",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,r,n){const{assignmentStore:i,eventStore:s,resourceStore:o,project:a}=this;let l=!1;if("event"===e){const e=isInstanceOf(r,CoreEventMixin)?r:null==s?void 0:s.getById(r);e&&(l=!0),r=e||r}if("resource"===e){const e=isInstanceOf(r,CoreResourceMixin)?r:null==o?void 0:o.getById(r);e&&(l=!0),r=e||r}t.setChanged.call(this,e,r,n,!0),!i||!l||a.isPerformingCommit||i.isLoadingData||i.isBatchAssigning||i.updateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){var e,t;let{event:r=this.event,resource:n=this.resource}=this.$changed;if(null!==r&&!isInstanceOf(r,CoreEventMixin)){const t=null===(e=this.eventStore)||void 0===e?void 0:e.getById(r);t&&this.setChanged("event",t,!1)}if(null!==n&&!isInstanceOf(n,CoreResourceMixin)){const e=null===(t=this.resourceStore)||void 0===t?void 0:t.getById(n);e&&this.setChanged("resource",e,!1)}}set event(e){this.setChanged("event",e)}get event(){const e=this.get("event");return isInstanceOf(e,CoreEventMixin)?e:null}set resource(e){this.setChanged("resource",e)}get resource(){const e=this.get("resource");return isInstanceOf(e,CoreResourceMixin)?e:null}}}))){}const EngineMixin=(null===(_window$bryntum=window.bryntum)||void 0===_window$bryntum?void 0:_window$bryntum.useBasicEngine)?BaseAssignmentMixin:CoreAssignmentMixin;class AssignmentModel extends(AssignmentModelMixin(PartOfProject(EngineMixin.derive(Model)))){}AssignmentModel.exposeProperties(),AssignmentModel._$name="AssignmentModel";var PartOfBaseProject=e=>class extends e{static get $name(){return"PartOfBaseProject"}get assignmentStore(){return this.project.assignmentStore}get calendarManagerStore(){return this.project.calendarManagerStore}get dependencyStore(){return this.project.dependencyStore}get eventStore(){return this.project.eventStore}get resourceStore(){return this.project.resourceStore}},AssignmentStoreMixin=e=>class extends e{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(e){Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++){let r=e[t];if(r instanceof Model||(e[t]=r=this.createRecord(r)),-1!==this.storage.findIndex("eventResourceKey",r.eventResourceKey,!0))throw new Error(`Duplicate assignment Event: ${r.eventId} to resource: ${r.resourceId}`)}return super.add(e)}setStoreData(e){super.setStoreData(e)}set storage(e){super.storage=e,this.storage.addIndex("eventResourceKey")}get storage(){return super.storage}get isAssignmentStore(){return!0}getOccurrence(e,t){if(!e||!(null==t?void 0:t.isOccurrence))return e;const r=this;return{id:`${t.id}:a${e.id}`,event:t,resource:e.resource,eventId:t.id,resourceId:e.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(e){return r.occurrenceInstanceMeta(this,e)}}}occurrenceInstanceMeta(e,t){const r=this,n=t.id||t,{id:i}=e;let{occurrenceMeta:s}=r;return s||(s=r.occurrenceMeta={}),s[i]||(s[i]={}),s[i][n]||(s[i][n]={})}mapAssignmentsForEvent(e,t,r){e=this.eventStore.getById(e);const n=Boolean(t),i=Boolean(r);return n||i?e.assignments.reduce(((e,s)=>{const o=n?t(s):s;return i&&!r(o)||e.push(o),e}),[]):e.assignments}mapAssignmentsForResource(e,t,r){e=this.resourceStore.getById(e);const n=Boolean(t),i=Boolean(r);return n||i?e.assignments.reduce(((e,s)=>{const o=n?t(s):s;return i&&!r(o)||e.push(o),e}),[]):e.assignments}getAssignmentsForEvent(e){return e.assignments}removeAssignmentsForEvent(e){return this.remove(e.assignments)}getAssignmentsForResource(e){return(e=this.resourceStore.getById(e)).assignments}removeAssignmentsForResource(e){this.remove(this.getAssignmentsForResource(e))}getResourcesForEvent(e){return e.resources}getEventsForResource(e){return(e=this.resourceStore.getById(e))&&e.events}assignEventToResource(e,t,r=(e=>e),n=!1){const i=this,s=n?new Set(e.assignments):null;if(t=Array.isArray(t)?t:[t],i.eventStore&&i.eventStore.usesSingleAssignment&&e.assignments.length)return i.isEventAssignedToResource(e,t[0])||(e.resource=t[0]),[];let o=[];return i.suspendAutoCommit(),t.forEach((t=>{const a=i.getAssignmentForEventAndResource(e,t);if(a)n&&s.delete(a);else{let n={eventId:Model.asId(e),resourceId:Model.asId(t)};n=r(n),o.push(n)}})),o=i.add(o),n&&i.remove(Array.from(s)),i.resumeAutoCommit(),o}unassignEventFromResource(e,t){const r=this,n=[];if(!t)return r.removeAssignmentsForEvent(e);Array.isArray(t)||(t=[t]);for(let i=0;i<t.length;i++)r.isEventAssignedToResource(e,t[i])&&n.push(r.getAssignmentForEventAndResource(e,t[i]));return r.remove(n)}isEventAssignedToResource(e,t){return Boolean(this.getAssignmentForEventAndResource(e,t))}getAssignmentForEventAndResource(e,t){return e=this.eventStore.getById(e),t=this.resourceStore.getById(t),e&&t?this.getOccurrence(e.assignments.find((e=>e.resource===t)),e):null}};const isNotNumber=e=>Number(e)!==e,CIFromSetOrArrayOrValue=e=>e instanceof Set||e instanceof Array?CI(e):CI([e]),delay$1=e=>new Promise((t=>setTimeout(t,e)));class AbstractAssignmentStoreMixin extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(e,r){this.assignmentsForRemoval=CIFromSetOrArrayOrValue(e).toSet();const n=t.remove.call(this,e);return this.assignmentsForRemoval.clear(),n}removeAll(e){this.allAssignmentsForRemoval=!0;const r=t.removeAll.call(this,e);return this.allAssignmentsForRemoval=!1,r}}}))){}class ChronoAssignmentStoreMixin extends(Mixin([AbstractAssignmentStoreMixin,ChronoPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:BaseAssignmentMixin}}set data(e){this.allAssignmentsForRemoval=!0,super.data=e,this.allAssignmentsForRemoval=!1}}}))){}class CorePartOfProjectStoreMixin extends(Mixin([AbstractPartOfProjectStoreMixin,CorePartOfProjectGenericMixin,Store],(e=>{const t=e.prototype;return class extends e{setProject(e){const r=t.setProject.call(this,e);return e&&this.joinProject(e),r}joinProject(e){}onCommitAsync(){}}}))){}const emptySet=new Set;class CoreAssignmentStoreMixin extends(Mixin([AbstractAssignmentStoreMixin,CorePartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:CoreAssignmentMixin,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1}]}}}set data(e){this.allAssignmentsForRemoval=!0,super.data=e,this.allAssignmentsForRemoval=!1}getEventsAssignments(e){return this.storage.findItem("event",e)||emptySet}getResourcesAssignments(e){return this.storage.findItem("resource",e)||emptySet}updateIndices(){this.storage.rebuildIndices()}linkAssignments(e,t){const r=this.storage.findItem(t,null);if(r){this.isBatchAssigning=!0;for(const n of r){const r=e.getById(n.getCurrentOrProposed(t));r&&n.setChanged(t,r)}this.isBatchAssigning=!1,this.updateIndices()}}onCommitAsync(){this.updateIndices()}}}))){}var _window$bryntum$1;const EngineMixin$1=(null===(_window$bryntum$1=window.bryntum)||void 0===_window$bryntum$1?void 0:_window$bryntum$1.useBasicEngine)?PartOfBaseProject(ChronoAssignmentStoreMixin.derive(AjaxStore)):PartOfProject(CoreAssignmentStoreMixin.derive(AjaxStore));class AssignmentStore extends(AssignmentStoreMixin(EngineMixin$1)){static get defaultConfig(){return{modelClass:AssignmentModel}}}AssignmentStore._$name="AssignmentStore";var ResourceStoreMixin=e=>class extends(e||Base){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(e){if(super.construct(e),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const e=super.removeAll(...arguments);return e&&this.assignmentStore.removeAll(),e}onRecordIdChange({record:e,oldValue:t,value:r}){super.onRecordIdChange({record:e,oldValue:t,value:r}),e.isFieldModified("id")&&(this.isChangingId=!0,e.updateAssignmentResourceIds(),this.isChangingId=!1)}},ResourceModelMixin=e=>class extends e{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image"]}updateAssignmentResourceIds(){this.assigned.forEach((e=>{e.resourceId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce(((e,t)=>(t.event&&e.push(t.event),e)),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(e){e.forEach((e=>{e.resource=this}))}getEvents(){return this.events}get isPersistable(){return!this.parent||this.parent.isPersistable}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}};const stripDuplicates=e=>Array.from(new Set(e));var TimeUnit,ConstraintType,SchedulingMode,DependencyValidationResult,DependencyType,DependenciesCalendar,ProjectType,Direction;!function(e){e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"}(TimeUnit||(TimeUnit={})),function(e){e.MustStartOn="muststarton",e.MustFinishOn="mustfinishon",e.StartNoEarlierThan="startnoearlierthan",e.StartNoLaterThan="startnolaterthan",e.FinishNoEarlierThan="finishnoearlierthan",e.FinishNoLaterThan="finishnolaterthan"}(ConstraintType||(ConstraintType={})),function(e){e.Normal="Normal",e.FixedDuration="FixedDuration",e.FixedEffort="FixedEffort",e.FixedUnits="FixedUnits"}(SchedulingMode||(SchedulingMode={})),function(e){e[e.NoError=0]="NoError",e[e.CyclicDependency=1]="CyclicDependency",e[e.DuplicatingDependency=2]="DuplicatingDependency"}(DependencyValidationResult||(DependencyValidationResult={})),function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToStart=2]="EndToStart",e[e.EndToEnd=3]="EndToEnd"}(DependencyType||(DependencyType={})),function(e){e.Project="Project",e.FromEvent="FromEvent",e.ToEvent="ToEvent"}(DependenciesCalendar||(DependenciesCalendar={})),function(e){e[e.SchedulerBasic=1]="SchedulerBasic",e[e.SchedulerPro=2]="SchedulerPro",e[e.Gantt=3]="Gantt"}(ProjectType||(ProjectType={})),function(e){e.Forward="Forward",e.Backward="Backward",e.None="None"}(Direction||(Direction={}));const MIN_DATE$1=new Date(-864e13),MAX_DATE=new Date(864e13),isDateFinite=e=>{if(!e)return!1;const t=e.getTime();return t!==MIN_DATE$1.getTime()&&t!==MAX_DATE.getTime()};var EdgeInclusion,CalendarIteratorResult;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(EdgeInclusion||(EdgeInclusion={})),function(e){e[e.FullRangeIterated=0]="FullRangeIterated",e[e.StoppedByIterator=1]="StoppedByIterator",e[e.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",e[e.MaxRangeReached=3]="MaxRangeReached"}(CalendarIteratorResult||(CalendarIteratorResult={}));class CalendarCache{constructor(e){this.cacheFilledStartDate=MAX_DATE,this.cacheFilledEndDate=MIN_DATE$1,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=TimeUnit.Day,this.maxCacheExtendCycles=100,this.maxRange=15552e7,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,t,r){e.ensureCacheFilledForInterval(t,r),this.intervalCache.includeWrappingRange(e.intervalCache,t,r)}ensureCacheFilledForInterval(e,t){const r=this.cacheFilledStartDate.getTime(),n=this.cacheFilledEndDate.getTime();if(r!==MAX_DATE.getTime()){const i=e.getTime(),s=t.getTime();if(r<=i&&s<=n)return;if(s<=r)t=new Date(r-1);else if(i>=n)e=new Date(n+1);else if(r<=i&&i<=n)e=new Date(n+1);else{if(!(r<=s&&s<=n))return this.ensureCacheFilledForInterval(e,new Date(r-1)),void this.ensureCacheFilledForInterval(new Date(n+1),t);t=new Date(r-1)}}(r===MAX_DATE.getTime()||e.getTime()<n)&&(this.cacheFilledStartDate=e),(n===MIN_DATE$1.getTime()||n<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(e,t)}fillCache(e,t){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=MAX_DATE,this.cacheFilledEndDate=MIN_DATE$1,this.intervalCache.clear()}forEachAvailabilityInterval(e,t,r){var n;r=r||this;const i=e.startDate,s=e.endDate,o=i&&i.getTime(),a=s&&s.getTime(),l=null!==(n=e.maxRange)&&void 0!==n?n:this.maxRange,c=!1!==e.isForward;if(c?!i:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const d=this.intervalCache;let u=c?i:s,h=c?i:s;const g=h.getTime();for(let e=1;e<this.maxCacheExtendCycles;e++){c?this.ensureCacheFilledForInterval(u,s||DateHelper.add(u,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(i||DateHelper.add(u,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),u);let e=d.getIntervalOf(h,c?EdgeInclusion.Left:EdgeInclusion.Right);for(;e;){const n=e.startDate,u=e.endDate;if(c&&a&&n.getTime()>=a||!c&&o&&u.getTime()<=o)return CalendarIteratorResult.FullRangeIterated;if(c&&n.getTime()-g>=l||!c&&g-u.getTime()>=l)return CalendarIteratorResult.MaxRangeReached;if(c&&n.getTime()>this.cacheFilledEndDate.getTime()||!c&&u.getTime()<this.cacheFilledStartDate.getTime())break;h=c?u:n;const m=o&&n.getTime()<o?i:n,p=a&&u.getTime()>a?s:u;if(!1===t.call(r,m,p,e.cacheInterval))return CalendarIteratorResult.StoppedByIterator;e=c?d.getNextInterval(e):d.getPrevInterval(e)}if(c&&h.getTime()===MAX_DATE.getTime()||!c&&h.getTime()===MIN_DATE$1.getTime())return CalendarIteratorResult.FullRangeIterated;u=c?this.cacheFilledEndDate:this.cacheFilledStartDate}return CalendarIteratorResult.MaxCacheExtendCyclesReached}}class CalendarCacheIntervalMultiple{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const t=this.intervalGroups.slice();return t.push([e.calendar,e]),new CalendarCacheIntervalMultiple({intervalGroups:t})}getIsWorkingForEvery(){if(null!=this.isWorkingForEvery)return this.isWorkingForEvery;for(let[e,t]of this.getGroups())if(!t[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(null!=this.isWorkingForSome)return this.isWorkingForSome;for(let[e,t]of this.getGroups())if(t[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[t,r]of this.getGroups())e.set(t,r[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[t,r]of this.getGroups())r[0].isWorking&&e.push(t);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[t,r]of this.getGroups())r[0].isWorking||e.push(t);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const e=this.calendars=[],t=new Map;return this.intervalGroups.forEach((([r,n])=>{let i=t.get(r);i||(e.push(r),i=[],t.set(r,i)),i.push.apply(i,n.intervals)})),t.forEach(((e,r)=>{const n=stripDuplicates(e);n.sort(((e,t)=>t.getPriorityField()-e.getPriorityField())),t.set(r,n)})),this.intervalsByCalendar=t}}const binarySearch=(e,t,r=((e,t)=>e-t))=>{let n=0,i=t.length;for(;n<i;){const s=(n+i)/2|0,o=r(e,t[s]);if(0===o)return{found:!0,index:s};o<0?i=s:n=s+1}return{found:!1,index:i}};var IndexPosition;!function(e){e[e.Exact=0]="Exact",e[e.Next=1]="Next"}(IndexPosition||(IndexPosition={}));class SortedMap{constructor(e){this.keys=[],this.values=[],this.comparator=e||((e,t)=>e-t)}set(e,t){const r=binarySearch(e,this.keys,this.comparator);return r.found?this.values[r.index]=t:(this.keys.splice(r.index,0,e),this.values.splice(r.index,0,t)),r.index}insertAt(e,t,r){this.keys.splice(e,0,t),this.values.splice(e,0,r)}setValueAt(e,t){this.values[e]=t}get(e){const t=binarySearch(e,this.keys,this.comparator);return t.found?this.values[t.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const t=binarySearch(e,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const t=binarySearch(e,this.keys,this.comparator);return{found:t.found?IndexPosition.Exact:IndexPosition.Next,index:t.index}}map(e){const t=this.keys,r=this.values,n=[];for(let i=0;i<t.length;i++)n.push(e(r[i],t[i],i));return n}getAllEntries(){return this.map(((e,t)=>({value:e,key:t})))}clear(){this.keys.length=0,this.values.length=0}}class IntervalCache{constructor(e){if(this.points=new SortedMap(((e,t)=>e.getTime()-t.getTime())),this.leftInfinityKey=MIN_DATE$1,this.rightInfinityKey=MAX_DATE,Object.assign(this,e),void 0===this.emptyInterval||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,t=EdgeInclusion.Left){let r,{found:n,index:i}=this.indexOf(e);return r=t===EdgeInclusion.Left&&n===IndexPosition.Exact?i:i-1,this.getIntervalWithStartDateIndex(r)}getPrevInterval(e){return 0===e.startDateIndex?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,t,r){const n=this.points,{found:i,index:s}=n.indexOfKey(e);let o,a;if(i==IndexPosition.Exact){const e=r(a=n.getValueAt(s));n.setValueAt(s,e),o=s+1}else{const t=r(a=n.getValueAt(s-1));n.insertAt(s,e,t),o=s+1}for(;o<n.size();){if(n.getKeyAt(o).getTime()>=t.getTime())break;const e=r(a=n.getValueAt(o));n.setValueAt(o,e),o++}if(o===n.size())n.insertAt(n.size(),t,this.emptyInterval);else{n.getKeyAt(o).getTime()===t.getTime()||n.insertAt(o,t,a)}}includeWrappingRange(e,t,r){let n=e.getIntervalOf(t);for(;n&&(this.addInterval(n.startDate,n.endDate,(e=>this.combineIntervalsFn(e,n.cacheInterval))),!(n.endDate.getTime()>r.getTime()));)n=e.getNextInterval(n)}getSummary(){return this.points.map(((e,t)=>({label:e,date:t})))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}class CalendarCacheMultiple extends CalendarCache{constructor(e){super(e),this.calendarCaches=stripDuplicates(this.calendarCaches),this.intervalCache=new IntervalCache({emptyInterval:new CalendarCacheIntervalMultiple,combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.calendarCaches.forEach((r=>{r.fillCache(e,t),this.includeWrappingRangeFrom(r,e,t)}))}}class CalendarIntervalMixin extends(Mixin([AbstractPartOfProjectModelMixin],(e=>{e.prototype;return class extends e{static get fields(){return["name",{name:"startDate",type:"date",format:"YYYY-MM-DDTHH:mm:ssZ"},{name:"endDate",type:"date",format:"YYYY-MM-DDTHH:mm:ssZ"},"recurrentStartDate","recurrentEndDate",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(null!=this.priorityField)return this.priorityField;let e=1e4+100*this.getCalendar().getDepth(),t=this.priority;return null==t&&(t=this.isRecurrent()?20:30),this.priorityField=e+t}isRecurrent(){return Boolean(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return Boolean(this.startDate&&this.endDate)}parseDateSchedule(e){if(e&&e!==Object(e)&&((e=later.parse.text(e))!==Object(e)||e.error>0))try{e=JSON.parse(e)}catch(e){return null}return e}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const e=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=later.schedule(e)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;const e=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=later.schedule(e)}}}))){}class CalendarIntervalStore extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:CalendarIntervalMixin}}}}))){}class CalendarCacheInterval{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(-1==this.intervals.indexOf(e)){const t=this.intervals.slice();return t.push(e),new CalendarCacheInterval({intervals:t,calendar:this.calendar})}return this}combineWith(e){return new CalendarCacheInterval({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(null!=this.isWorking)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const t=stripDuplicates(e);return t.sort(((e,t)=>t.getPriorityField()-e.getPriorityField())),t}}class CalendarCacheSingle extends CalendarCache{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new IntervalCache({emptyInterval:new CalendarCacheInterval({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,t);const r=e.getTime(),n=t.getTime();if(r>n)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval((i=>{const s=i.getStartDateSchedule(),o=i.getEndDateSchedule();let a=s.prev(1,e),l=o.next(1,t);if(a!==later.NEVER&&a.getTime()===r){const t=s.prev(2,e);t!==later.NEVER&&2===t.length&&(a=t[1])}if(l!==later.NEVER&&l.getTime()===n){const e=o.next(2,t);e!==later.NEVER&&2===e.length&&(l=e[1])}const c=s.next(1/0,a!==later.NEVER?a:e,l!==later.NEVER?new Date(l.getTime()-1):t);if(c===later.NEVER)return;const d=o.next(1/0,new Date(c[0].getTime()+1),l!==later.NEVER?l:t);d.length>c.length?d.length=c.length:d.length<c.length&&(c.length=d.length),c.forEach(((e,t)=>{const r=e,n=d[t];this.intervalCache.addInterval(r,n,(e=>e.includeInterval(i)))}))}))}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval((e=>{this.intervalCache.addInterval(e.startDate,e.endDate,(t=>t.includeInterval(e)))}))}forEachStaticInterval(e){this.intervalStore.forEach((t=>{t.isStatic()&&e(t)}))}forEachRecurrentInterval(e){this.intervalStore.forEach((t=>{t.isRecurrent()&&e(t)}))}}class UnspecifiedTimeIntervalModel extends(Mixin([CalendarIntervalMixin],(e=>{e.prototype;return class extends e{getCalendar(){return this.calendar}getPriorityField(){return null!=this.priorityField?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}}))){}class AbstractCalendarMixin extends(Mixin([AbstractPartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},"intervals"]}get intervalStoreClass(){return CalendarIntervalStore}afterConstruct(){t.afterConstruct.call(this);const e=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass;this.intervalStore=new this.intervalStoreClass({calendar:this,modelClass:e}),this.intervals&&this.intervals.length&&this.addIntervals(this.intervals)}isDefault(){const e=this.getProject();return!!e&&this===e.defaultCalendar}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(e,t,r){return this.calendarCache.forEachAvailabilityInterval(e,t,r)}accumulateWorkingTime(e,t,r){if(0===t)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(t))throw new Error("Invalid duration");let n=e;return this.forEachAvailabilityInterval(r?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,i,s)=>{let o=!0;if(s.getIsWorking()){const s=e.getTimezoneOffset()-i.getTimezoneOffset(),a=i.getTime()-e.getTime()+60*s*1e3;t<=a?(n=r?new Date(e.getTime()+t):new Date(i.getTime()-t),t=0,o=!1):(n=r?i:e,t-=a)}return o})),{finalDate:new Date(n),remainingDurationInMs:t}}calculateDurationMs(e,t){let r=0;return this.forEachAvailabilityInterval({startDate:e,endDate:t},((e,t,n)=>{if(n.getIsWorking()){const n=e.getTimezoneOffset()-t.getTimezoneOffset();r+=t.getTime()-e.getTime()+60*n*1e3}})),r}calculateEndDate(e,t){const r=t>=0,n=this.accumulateWorkingTime(e,Math.abs(t),r);return 0===n.remainingDurationInMs?n.finalDate:null}calculateStartDate(e,t){const r=t<=0,n=this.accumulateWorkingTime(e,Math.abs(t),r);return 0===n.remainingDurationInMs?n.finalDate:null}skipNonWorkingTime(e,t=!0){let r;const n=this.forEachAvailabilityInterval(t?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,n,i)=>{if(i.getIsWorking())return r=t?e:n,!1}));return n===CalendarIteratorResult.MaxRangeReached||n===CalendarIteratorResult.FullRangeIterated?"empty_calendar":r?new Date(r):new Date(e)}addInterval(e){return this.addIntervals([e])}addIntervals(e){return this.bumpVersion(),this.intervalStore.add(e)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(void 0!==this.$calendarCache)return this.$calendarCache;const e=new UnspecifiedTimeIntervalModel({isWorking:this.unspecifiedTimeIsWorking});return e.calendar=this,this.$calendarCache=new CalendarCacheSingle({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse((e=>{e.intervalStore.forEach((e=>e.resetPriority()))}))}insertChild(e,r){let n=t.insertChild.call(this,e,r);return Array.isArray(n)||(n=[n]),n.forEach((e=>{e.bumpVersion(),e.resetPriorityOfAllIntervals()})),n}joinProject(){t.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){t.leaveProject.call(this),this.intervalStore.setProject(null),this.intervalStore.destroy(),this.clearCache()}isDayHoliday(e){const t=DateHelper.clearTime(e),r=DateHelper.getNext(e,TimeUnit.Day);let n=!1;return this.forEachAvailabilityInterval({startDate:t,endDate:r,isForward:!0},((e,t,r)=>(n=r.getIsWorking(),!n))),!n}getDailyHolidaysRanges(e,t){const r=[];for(e=DateHelper.clearTime(e);e<t;)this.isDayHoliday(e)&&r.push({startDate:e,endDate:DateHelper.getStartOfNextDay(e,!0,!0)}),e=DateHelper.getNext(e,TimeUnit.Day);return r}getNonWorkingTimeRanges(e,t){const r=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0},((e,t,n)=>{if(!n.getIsWorking()){const i=n.intervals[0];r.push({name:i.name,startDate:e,endDate:t})}})),r}isWorkingTime(e,t){const r=this.skipNonWorkingTime(e);return!(!r||"empty_calendar"===r)&&r<t}}}))){}var __decorate$6=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const hasMixin=Symbol("CalendarMixin");class BaseCalendarMixin extends(Mixin([AbstractCalendarMixin,ChronoPartOfProjectModelMixin],(e=>{e.prototype;class t extends e{constructor(){super(...arguments),this.version=1}[hasMixin](){}}return __decorate$6([field({persistent:!1})],t.prototype,"version",void 0),__decorate$6([model_field({type:"string"})],t.prototype,"name",void 0),__decorate$6([model_field({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),__decorate$6([model_field()],t.prototype,"intervals",void 0),t}))){}var __decorate$7=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class HasCalendarMixin extends(Mixin([ChronoPartOfProjectModelMixin],(e=>{e.prototype;class t extends e{writeCalendar(e,t,r,n){const i=this.getCalendarManagerStore(),s=n;n&&i&&n instanceof BaseCalendarMixin&&!i.includes(s)&&i.add(n),e.constructor.prototype.write.call(this,e,t,r,n)}resolveCalendar(e){var t;return null===(t=this.getCalendarManagerStore())||void 0===t?void 0:t.getById(e)}*calculateEffectiveCalendar(){let e=yield this.$.calendar;if(!e){const t=this.getProject();e=yield t.$.effectiveCalendar}return yield e.$.version,e}}return __decorate$7([field()],t.prototype,"effectiveCalendar",void 0),__decorate$7([generic_field({modelFieldConfig:{persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual},resolver:function(e){return this.resolveCalendar(e)},sync:!0},ModelReferenceField)],t.prototype,"calendar",void 0),__decorate$7([write("calendar")],t.prototype,"writeCalendar",null),__decorate$7([calculate("effectiveCalendar")],t.prototype,"calculateEffectiveCalendar",null),injectStaticFieldsProperty(t),t}))){}class CanCombineCalendarsMixin extends(Mixin([],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.combinedcalendarscache=new Map}combineCalendars(e){const t=stripDuplicates(e);if(0===t.length)throw new Error("No calendars to combine");t.sort(((e,t)=>e.internalId<t.internalId?-1:1));const r=t.map((e=>e.internalId+"/")).join(""),n=t.map((e=>e.version+"/")).join(""),i=this.combinedcalendarscache.get(r);let s;return i&&i.versionsHash===n?s=i.cache:(s=new CalendarCacheMultiple({calendarCaches:t.map((e=>e.calendarCache))}),this.combinedcalendarscache.set(r,{versionsHash:n,cache:s})),s}}}))){}var _window$bryntum$2,__decorate$8=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class BaseResourceMixin extends(Mixin([HasCalendarMixin,ChronoPartOfProjectModelMixin],(e=>{const t=e.prototype;class r extends e{get assignments(){return[...this.assigned]}leaveProject(e=!1){if(this.assigned&&!e){const e=this.getResourceStore();this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this)}}return __decorate$8([generic_field({},ModelBucketField)],r.prototype,"assigned",void 0),r}))){}const EngineMixin$2=(null===(_window$bryntum$2=window.bryntum)||void 0===_window$bryntum$2?void 0:_window$bryntum$2.useBasicEngine)?BaseResourceMixin:CoreResourceMixin;class ResourceModel extends(ResourceModelMixin(PartOfProject(EngineMixin$2.derive(GridRowModel)))){}ResourceModel.exposeProperties(),ResourceModel._$name="ResourceModel";class AbstractResourceStoreMixin extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}remove(e,r){const n=t.remove.call(this,e);return this.afterResourceRemoval(),n}afterResourceRemoval(){const e=this.getAssignmentStore();if(e&&!e.allAssignmentsForRemoval){const t=[...this.assignmentsForRemoval].filter((t=>!e.assignmentsForRemoval.has(t)));t.length>0&&e.remove(t)}this.assignmentsForRemoval.clear()}removeAll(e){const r=t.removeAll.call(this,e);return this.afterResourceRemoval(),r}processRecord(e,t=!1){const r=this.getById(e.id);if(r&&r!==e)for(const t of r.assigned)t.resource=e;return e}}}))){}class ChronoResourceStoreMixin extends(Mixin([AbstractResourceStoreMixin,ChronoPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:BaseResourceMixin}}}}))){}class CoreResourceStoreMixin extends(Mixin([AbstractResourceStoreMixin,CorePartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:CoreResourceMixin}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}afterLoadData(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}}}))){}var _window$bryntum$3;const EngineMixin$3=(null===(_window$bryntum$3=window.bryntum)||void 0===_window$bryntum$3?void 0:_window$bryntum$3.useBasicEngine)?PartOfBaseProject(ChronoResourceStoreMixin.derive(AjaxStore)):PartOfProject(CoreResourceStoreMixin.derive(AjaxStore));class ResourceStore extends(ResourceStoreMixin(EngineMixin$3)){static get defaultConfig(){return{modelClass:ResourceModel}}}ResourceStore._$name="ResourceStore";const returnTrue$1=()=>!0,emptyArray$5=Object.freeze([]),emptyIndex=Object.freeze({}),MS_PER_DAY=864e5,notRecurring=e=>!e.isRecurring;var EventStoreMixin=e=>class extends(e||Base){static get $name(){return"EventStoreMixin"}construct(e){super.construct(e),Object.assign(this,{autoTree:!0})}afterLoadData(){this.syncIndices("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:e,added:t,removed:r,replaced:n}){this.syncIndices(e,t,r,n),super.onDataChange(...arguments)}onDataReplaced(e,t){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(e,t)}syncIndices(e,t=emptyArray$5,r=emptyArray$5,n,i){var s,o,a,l,c,d,u;const h=this,g=null===(s=t)||void 0===s?void 0:s.length,m=null===(o=r)||void 0===o?void 0:o.length,p=null==n?void 0:n.length;let f,v,y,b,C;if(h.dateIndicesRequested)switch(e){case"clear":h._startDateIndex={},h._dateIndex={};break;case"splice":if(p)for(t=t.slice(),r=r.slice(),y=0;y<p;y++)r.push(n[y][0]),t.push(n[y][1]);if(m)for(y=0;y<m;y++){var D,S,E;if(C=r[y],f=null===(D=DateHelper.clearTime(C.startDate))||void 0===D?void 0:D.getTime(),v=null!==(S=null===(E=C.endDate)||void 0===E?void 0:E.getTime())&&void 0!==S?S:f,f){h.removeIndexEntry("startDate",C,DateHelper.makeKey(f));do{h.removeIndexEntry("date",C,DateHelper.makeKey(f)),f+=864e5}while(f<v)}}if(g)for(y=0;y<g;y++){var w,x,R;if(b=t[y],b.isScheduled)if(f=null===(w=DateHelper.clearTime(b.startDate))||void 0===w?void 0:w.getTime(),v=null!==(x=null===(R=b.endDate)||void 0===R?void 0:R.getTime())&&void 0!==x?x:f,f){h.addIndexEntry("startDate",b,DateHelper.makeKey(f));do{h.addIndexEntry("date",b,DateHelper.makeKey(f)),f+=864e5}while(f<v)}}break;case"reschedule":if(C=t[0],f=null===(a=DateHelper.clearTime((null===(l=i.startDate)||void 0===l?void 0:l.oldValue)||C.startDate))||void 0===a?void 0:a.getTime(),v=null!==(c=null===(d=(null===(u=i.endDate)||void 0===u?void 0:u.oldValue)||C.endDate)||void 0===d?void 0:d.getTime())&&void 0!==c?c:f,f){h.removeIndexEntry("startDate",C,DateHelper.makeKey(f));do{h.removeIndexEntry("date",C,DateHelper.makeKey(f)),f+=864e5}while(f<v)}h.syncIndices("splice",t)}}onModelChange(e,t,r,n,i){("startDate"in r||"endDate"in r)&&this.syncIndices("reschedule",[e],null,null,r),super.onModelChange(...arguments)}addIndexEntry(e,t,r=t[e]){const n=`_${e}Index`,i=this[n]||(this[n]={});(i[r]||(i[r]=new Set)).add(t)}removeIndexEntry(e,t,r=t[e]){const n=`_${e}Index`,i=(this[n]||(this[n]={}))[r];i&&i.delete(t)}getDateIndex(e){const t=this;return t.dateIndicesRequested||(t.dateIndicesRequested=!0,t.syncIndices("splice",t.storage.allValues)),t[`_${e}Index`]||emptyIndex}getEventsInTimeSpan(e,t,r=!0,n=!1){return VersionHelper.deprecate("Scheduler","5.0.0","`getEventsInTimeSpan` method deprecated, in favor of `getEvents`"),this.getEvents({startDate:e,endDate:t,allowPartial:r,onlyAssigned:n})}getEventsByStartDate(e){return VersionHelper.deprecate("Scheduler","5.0.0","`getEventsByStartDate` method deprecated, in favor of `getEvents`"),this.getEvents({startDate:e,startOnly:!0})}getEvents({filter:e,date:t,startDate:r,endDate:n,startOnly:i,includeOccurrences:s,allowPartial:o,onlyAssigned:a=!1,dateMap:l=!1,getDateIndex:c}){const d=this,u=arguments[0],{lastDateRange:h,added:g,filtersFunction:m}=d,p=e;if(a&&(u.filter=p?e=>p(e)&&e.resources.length:e=>e.resources.length),"startDate"in u||(r=u.startDate=t),"includeOccurrences"in u||(s=u.includeOccurrences=!0),"allowPartial"in u||(o=u.allowPartial=!i),u.storeFilterFn=d.isFiltered?d.reapplyFilterOnAdd?m:e=>g.includes(e)?d.indexOf(e)>-1:m(e):null,!n)if(r)(n=u.endDate=DateHelper.clearTime(r)).setDate(n.getDate()+1);else{if(s)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");u.dateFilter=returnTrue$1}u.dateFilter||(u.dateFilter=i?e=>e.startDate&&!(DateHelper.clearTime(e.startDate)-r):o?e=>e.startDate&&DateHelper.intersectSpans(e.startDate,e.endDate||e.startDate,r,n):e=>e.startDate&&e.startDate>=r&&(e.endDate||e.startDate)<=n);const f={startDate:r,endDate:n};return(!h||h.startDate-f.startDate||h.endDate-f.endDate)&&(d.processConfiguredListeners(),d.trigger("loadDateRange",{old:h||{},new:Object.assign({},f)}),d.lastDateRange=f),l?d.getEventsAsMap(u):d.getEventsAsArray(u)}getEventsAsArray({filter:e,date:t,resourceRecord:r,startDate:n=t,endDate:i,startOnly:s,includeOccurrences:o=!0,dateFilter:a,storeFilterFn:l,getDateIndex:c}){const d=this,u=[];if(d.count){let e=r?d.getEventsForResource(r):new Set;if(!r){const t=new Set,r=d.getDateIndex(s?"startDate":"date");d.recurringEvents.forEach((e=>{DateHelper.clearTime(e.startDate)<=n&&t.add(e)}));for(const e=new Date(n);e<i;e.setDate(e.getDate()+1)){const n=(c?d.getDateIndex(c(e)):r)[DateHelper.makeKey(e)];n&&n.forEach((e=>t.add(e)))}e=[...t]}l&&(e=e.filter(l));for(let t=0,{length:r}=e;t<r;t++){const r=e[t];r.isRecurring&&o?u.push.apply(u,r.getOccurrencesForDateRange(n,i).filter(a)):a(r)&&u.push(r)}}return e?u.filter(e):u}getEventsAsMap({filter:e,date:t,resourceRecord:r,startDate:n=t,endDate:i,startOnly:s,includeOccurrences:o=!0,dateMap:a,storeFilterFn:l,getDateIndex:c}){const d=this;if(a.clear?a.clear():a=new Map,d.count){const t=d.getDateIndex(s?"startDate":"date"),u=[],h=t=>(!e||e(t))&&(!l||l(t));if(r)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");d.recurringEvents.forEach((e=>{DateHelper.clearTime(e.startDate)<i&&u.push(e)}));for(const e=new Date(n);e<i;e.setDate(e.getDate()+1)){const r=DateHelper.makeKey(e);let n=(c?d.getDateIndex(c(e)):t)[DateHelper.makeKey(e)];n&&(n=[...n].filter(notRecurring).filter(h),(a.get(r)||a.set(r,[]).get(r)).push(...n))}for(let e=0,{length:t}=u;e<t;e++){const t=u[e];let r=(o?t.getOccurrencesForDateRange(n,i):[t]).filter(h);for(let e=0,{length:t}=r;e<t;e++){const t=r[e],n=DateHelper.clearTime(t.startDate),i="startDate"===(c?c(n):s?"startDate":"date")?DateHelper.endOf(n):t.endDate||DateHelper.add(t.startDate,t.duration,t.durationUnit);for(;n<i;n.setDate(n.getDate()+1)){const e=DateHelper.makeKey(n);(a.get(e)||a.set(e,[]).get(e)).push(t)}}}}return a}forEachScheduledEvent(e,t=this){this.forEach((r=>{const{startDate:n,endDate:i}=r;if(n&&i)return e.call(t,r,n,i)}))}getTotalTimeSpan(){let e=new Date(9999,0,1),t=new Date(0);return this.forEach((r=>{r.startDate&&(e=DateHelper.min(r.startDate,e)),r.endDate&&(t=DateHelper.max(r.endDate,t))})),e=e<new Date(9999,0,1)?e:null,t=t>new Date(0)?t:null,this.lastTotalTimeSpan={startDate:e||null,endDate:t||e||null}}isEventPersistable(e){return e.isPersistable}isDateRangeAvailable(e,t,r,n){const i=new Set(this.getEventsForResource(n));if(r instanceof AssignmentModel){r.event.resources.forEach((e=>{e.id!==r.resourceId&&this.getEventsForResource(e).forEach((e=>i.add(e)))}))}if(r){const e=r instanceof AssignmentModel?r.event:r;i.delete(e)}return!Array.from(i).some((r=>r.isScheduled&&DateHelper.intersectSpans(e,t,r.startDate,r.endDate)))}filterEventsForResource(e,t,r=this){return e.getEvents(this).filter(t.bind(r))}getResourcesForEvent(e){return e.isOccurrence&&(e=e.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(e)}getEventsForResource(e){return this.assignmentStore.getEventsForResource(e)}getAssignmentsForEvent(e){return this.assignmentStore.getAssignmentsForEvent(e)||[]}getAssignmentsForResource(e){return this.assignmentStore.getAssignmentsForResource(e)||[]}assignEventToResource(e,t,r=!1){return this.assignmentStore.assignEventToResource(e,t,void 0,r)}unassignEventFromResource(e,t){this.assignmentStore.unassignEventFromResource(e,t)}reassignEventFromResourceToResource(e,t,r){const n=this,i=Model.asId(r),s=n.assignmentStore.getAssignmentForEventAndResource(e,t);s?s.resourceId=i:n.assignmentStore.assignEventToResource(e,r)}isEventAssignedToResource(e,t){return this.assignmentStore.isEventAssignedToResource(e,t)}removeAssignmentsForEvent(e){this.assignmentStore.removeAssignmentsForEvent(e)}removeAssignmentsForResource(e){this.assignmentStore.removeAssignmentsForResource(e)}},SharedEventStoreMixin=e=>class extends e{static get $name(){return"SharedEventStoreMixin"}static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0}}static get properties(){return{assignmentsAutoAddSuspended:0}}construct(e){if(super.construct(e,!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}suspendAssignmentsAutoAdd(){this.assignmentsAutoAddSuspended++}resumeAssignmentsAutoAdd(){this.assignmentsAutoAddSuspended>0&&this.assignmentsAutoAddSuspended--}append(e){return this.add(e)}get project(){return super.project}set project(e){super.project=e,this.detachListeners("project"),e&&(e.on({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}),e.assignmentStore&&e.assignmentStore.isAssignmentStore&&this.attachToAssignmentStore(e.assignmentStore))}processRecord(e,t=!1){super.processRecord(e,t);const r=e.get("resourceId");if(null!=r){const n=this,{assignmentStore:i}=n,s=n.getById(e.id);if(s&&s!==e&&!t){const t=i.find((t=>t.eventId===e.id));t&&(t.resource=r,n.reassignedFromReplace=!0)}else if(!i||t||n.assignmentsAutoAddSuspended)n.$processResourceIds=!0;else{i.find((t=>t.resourceId===r&&t.eventId===e.id))||i.add({id:i.modelClass.generateId(""),resourceId:r,eventId:e.id})}n.usesSingleAssignment=!0}return e}processResourceIds(){const{assignmentStore:e}=this;if(this.$processResourceIds&&(null==e?void 0:e.isAssignmentStore)){const t=[];this.forEach((r=>{const{resourceId:n,id:i}=r;null!=n&&t.push({id:e.modelClass.generateId(""),resourceId:n,eventId:i})})),e.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},e.usesSingleAssignment=!1,e.data=t,e.usesSingleAssignment=!0,this.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:e}){var t;const r=this;if(r.removeUnassignedEvent&&!r.isRemoving&&!r.isSettingData&&!(null===(t=r.stm)||void 0===t?void 0:t.isRestoring)&&!r.usesSingleAssignment){const t=new Set;e.forEach((r=>{const{event:n}=r;n&&!n.isRemoved&&n.assignments.every((t=>e.includes(t)))&&t.add(n)})),t.size&&r.remove([...t])}}onProjectAssignmentStoreChange({store:e}){this.attachToAssignmentStore(e)}attachToAssignmentStore(e){const t=this;t.detachListeners("assignmentStore"),e&&(t.processResourceIds(),e.on({name:"assignmentStore",addPreCommit({records:e}){!t.usesSingleAssignment||t.isSettingData||t.isAssigning||e.forEach((e=>{const{event:t}=e;(null==t?void 0:t.isEvent)&&t.resourceId!==e.resourceId&&(t.meta.isAssigning=!0,t.set("resourceId",e.resourceId),t.meta.isAssigning=!1)}))},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:e}){t.usesSingleAssignment&&e.forEach((e=>{var r;null===(r=t.getById(e.eventId))||void 0===r||r.set("resourceId",null)}))},removeAllPreCommit(){t.usesSingleAssignment&&!t.isSettingData&&t.allRecords.forEach((e=>e.set("resourceId",null)))},update({record:e,changes:r}){if(t.usesSingleAssignment&&"resourceId"in r){const{event:t}=e;t.meta.isAssigning=!0,t.set("resourceId",r.resourceId.value),t.meta.isAssigning=!1}},thisObj:t}))}set data(e){this.isSettingData=!0,this.usesSingleAssignment&&this.assignmentStore.removeAll(!0),super.data=e,this.isSettingData=!1}trigger(e,t){const{changes:r}=t||{};r&&"resourceId"in r&&1===Object.keys(r).length&&(t.isAssign=!0),super.trigger(...arguments)}};const emptyArray$6=Object.freeze([]);var RecurringTimeSpansMixin=e=>class extends(e||Base){static get $name(){return"RecurringTimeSpansMixin"}construct(...e){this.globalOccurrences=new Map,this.recurringEvents=new Set,super.construct(...e)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:e,added:t,removed:r,replaced:n}){this.refreshRecurringEventsCache(e,t,r,n),super.onDataChange(...arguments)}refreshRecurringEventsCache(e,t=emptyArray$6,r=emptyArray$6,n){const{recurringEvents:i}=this,s=null==n?void 0:n.length;switch(e){case"clear":i.clear();break;case"splice":if(s){t=t.slice(),r=r.slice();for(let e=0;e<s;e++)r.push(n[e][0]),t.push(n[e][1])}const e=t.length,o=r.length;if(o)for(let e=0;e<o;e++){const t=r[e];t.isRecurring&&i.delete(t)}if(e)for(let r=0;r<e;r++){const e=t[r];e.isRecurring&&i.add(e)}}}add(e){const t=Array.isArray(e)?e:[e];if(t.some((e=>e.isOccurrence)))throw new Error("Occurrences must not be added to the event store");return super.add(t)}getById(e){let t=super.getById(e);return t||(t=this.globalOccurrences.get(this.modelClass.asId(e))),t}onModelChange(e,t,r,n,i){const s=this.isRecurrenceRelatedFieldChange(e,r);if(s&&!n&&e.removeOccurrences(),super.onModelChange(...arguments),s&&!n){const e={action:"batch",records:this.storage.values};this.trigger("refresh",e),this.trigger("change",e)}}isRecurrenceRelatedFieldChange(e,t){return e.isRecurring||"recurrenceRule"in t}getOccurrencesForTimeSpan(e,t,r){const n=[];return e.isRecurring&&e.recurrence.forEachOccurrence(t,r,(e=>n.push(e))),n}set data(e){this.globalOccurrences.clear(),super.data=e}getRecurringTimeSpans(){return[...this.recurringEvents]}},RecurringEventsMixin=e=>class extends(RecurringTimeSpansMixin(e||Base)){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(e){return super.isEventPersistable(e)&&(!e.supportsRecurring||!e.isOccurrence)}};const dayParseRegExp=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,days=["SU","MO","TU","WE","TH","FR","SA"];class RecurrenceDayRuleEncoder extends Base{static decodeDay(e){let t,r;return(t=dayParseRegExp.exec(e))&&(r=[days.indexOf(t[2])],t[1]&&(t[1]=parseInt(t[1],10),r.push(t[1]))),r}static encodeDay(e){let t;return Array.isArray(e)&&([e,t]=e),(t?t.toString():"")+days[e]}static decode(e){let t,r=[];if(e)for(let n=0;n<e.length;n++)(t=this.decodeDay(e[n]))&&r.push(t);return r}static encode(e){let t,r=[];if(e)for(let n=0;n<e.length;n++)(t=this.encodeDay(e[n]))&&r.push(t);return r}}RecurrenceDayRuleEncoder._$name="RecurrenceDayRuleEncoder";const frequencyToUnitRe=/ly$/i,frequencyToUnit=e=>{const t=e.replace(frequencyToUnitRe,"");return"DAI"===t?"DAY":t},fn=(e,t,r,n)=>n.buildOccurrence(e,r),captureLastOccurrence=e=>lastOccurrenceDate=e;let lastOccurrenceDate;class AbstractRecurrenceIterator extends Base{static processIterationConfig(e){const{recurrence:t}=e,{frequency:r,interval:n,timeSpan:i,endDate:s,count:o}=t;if(!e.syncingStartDate&&!i.meta.isSyncedWithRule){const s=DateHelper.add(i.startDate,n,frequencyToUnit(r)),o=DateHelper.min(s,e.endDate||s);this.forEachDate({syncingStartDate:!0,startDate:i.startDate,endDate:o,recurrence:t,fn:fn})}const a=i.startDate;let{startDate:l=a,endDate:c=s}=e;l<a&&(l=a),s?(!c||c>s)&&(c=s):o&&l>a&&(this.forEachDate({recurrence:t,fn:captureLastOccurrence}),(!c||c>lastOccurrenceDate)&&(c=lastOccurrenceDate));const d=l;return e.startOnly||(l=new Date(DateHelper.max(DateHelper.add(l,-n,frequencyToUnit(r)),a))),Object.assign({extraArgs:[],startOnly:!Boolean(i.durationMS)},e,{startDate:l,endDate:c,timeSpan:i,timeSpanStart:a,earliestVisibleDate:d,durationMS:i.durationMS,spansStart:l<=a&&c>a})}static get frequency(){return"NONE"}static get MAX_OCCURRENCES_COUNT(){return 1e6}static getNthDayInPeriod(e,t,r,n){let i,s,o;if(n){const a=864e5,l=6048e5;n>0?(s=1,o=e):(s=-1,o=t);const c=r-o.getDay();s*c<0&&(n+=s),i=new Date(o.getTime()+(n-s)*l+c*a),(i<e||i>t)&&(i=null)}return i}static buildDate(e,t,r){const n=new Date(e,t,r);if(n.getFullYear()===e&&n.getMonth()===t&&n.getDate()===r)return n}static isValidPosition(e){return Boolean(e)}static forEachDateAtPositions(e,t,r,n){const i=e.length,s={};for(let o=0;o<t.length;o++){const a=t[o];if(this.isValidPosition(a)){const t=a>0?e[a-1]:e[i+a];if(t&&!s[t.getTime()]&&(s[t.getTime()]=!0,!1===r.call(n,t)))return!1}}}static isInView(e,t,r,n,i){return(e?t>=r:t.valueOf()+n>r)&&!i.hasException(t)}}AbstractRecurrenceIterator._$name="AbstractRecurrenceIterator";class DailyRecurrenceIterator extends AbstractRecurrenceIterator{static get frequency(){return"DAILY"}static forEachDate(e){const{startOnly:t,startDate:r,endDate:n,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g}=c,m=r-s,p=864e5*g,f=Math.floor(m/p);let v=c.count,y=0,b=DateHelper.add(s,f*g,"day");for(n||v||(v=this.MAX_OCCURRENCES_COUNT);!n||b<=n;){if(y++,this.isInView(t,b,o,a,i)&&(n&&b>n||!1===d.apply(h,[b,y,1===y&&l,i,...u])||v&&y>=v))break;b=DateHelper.add(b,g,"day")}}}DailyRecurrenceIterator._$name="DailyRecurrenceIterator";class WeeklyRecurrenceIterator extends AbstractRecurrenceIterator{static get frequency(){return"WEEKLY"}static forEachDate(e){const{startOnly:t,startDate:r,endDate:n,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:m}=c;let p,f,v=0,{count:y}=c,b=RecurrenceDayRuleEncoder.decode(m);for(b&&b.length?b.sort(((e,t)=>e[0]-t[0])):b=[[s.getDay()]],p=DateHelper.getNext(y?s:r,"week",0,0),n||y||(y=this.MAX_OCCURRENCES_COUNT);!n||p<=n;){for(let e=0;e<b.length;e++)if(f=DateHelper.copyTimeValues(DateHelper.add(p,b[e][0],"day"),s),f>=s){if(v++,this.isInView(t,f,o,a,i)&&(n&&f>n||!1===d.apply(h,[f,v,1===v&&l,i,...u])||y&&v>=y))return}p=DateHelper.getNext(p,"week",g,0)}}}WeeklyRecurrenceIterator._$name="WeeklyRecurrenceIterator";class MonthlyRecurrenceIterator extends AbstractRecurrenceIterator{static get frequency(){return"MONTHLY"}static getNthDayOfMonth(e,t){const r=DateHelper.daysInMonth(e);let n=null;return t&&Math.abs(t)<=r&&(n=new Date(e.getFullYear(),e.getMonth(),t<0?r+t+1:t)),n}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const{startOnly:t,startDate:r,endDate:n,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:m,count:p,positions:f}=c,v=RecurrenceDayRuleEncoder.decode(m),y=f&&f.length,b={};let C,D,S,E,w,x,{monthDays:R}=c,T=0;for(D=DateHelper.startOf(p?s:r,"month"),S=new Date(DateHelper.getNext(D,"month",1)-1),R&&R.length||v&&v.length||(R=[s.getDate()]),v&&v.length&&v.forEach((e=>{e[1]&&(C=C||{},C[e[0]]=e[1])}));(!n||n>=D)&&(!p||T<p);){if(E=[],v&&v.length){if(v.forEach((e=>{const t=e[0];let r=1,n=53;for(e[1]&&(r=n=e[1]),x=r;x<=n;x++)(w=this.getNthDayInPeriod(D,S,t,x))&&(w=DateHelper.copyTimeValues(w,s),b[w.getTime()]||(b[w.getTime()]=!0,E.push(w)))})),E.sort(((e,t)=>e-t)),!y)for(x=0;x<E.length;x++)if(w=E[x],w>=s){const e=this.isInView(t,w,o,a,i);if(T++,e&&(n&&w>n||!1===d.apply(h,[w,T,1===T&&l,i,...u])||p&&T>=p))return!1}}else{const e=[];for(x=0;x<R.length;x++)(w=this.getNthDayOfMonth(D,R[x]))&&!b[w.getTime()]&&(b[w.getTime()]=!0,e.push(w));for(e.sort(((e,t)=>e-t)),x=0;x<e.length;x++)if(w=DateHelper.copyTimeValues(e[x],s),y)E.push(w);else if(w>=s){const e=this.isInView(t,w,o,a,i);if(T++,e&&(n&&w>n||!1===d.apply(h,[w,T,1===T&&l,i,...u])||p&&T>=p))return}}y&&E.length&&this.forEachDateAtPositions(E,f,(e=>{if(e>=s){const r=t?e>=o:e.valueOf()+a>o&&!i.hasException(e);if(T++,r&&(!n||e<=n)&&(!1===d.apply(h,[e,T,1===T&&l,i,...u])||p&&T>=p))return!1}})),D=DateHelper.getNext(D,"month",g),S=new Date(DateHelper.getNext(D,"month",1)-1)}}}MonthlyRecurrenceIterator._$name="MonthlyRecurrenceIterator";class YearlyRecurrenceIterator extends AbstractRecurrenceIterator{static get frequency(){return"YEARLY"}static forEachDate(e){const{startOnly:t,startDate:r,endDate:n,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:m,count:p,positions:f}=c,v=RecurrenceDayRuleEncoder.decode(m),y=f&&f.length,b={};let C,D,S,E,w,x,{months:R}=c,T=0;for(E=DateHelper.startOf(p?s:r,"year"),w=new Date(DateHelper.getNext(E,"year",1)-1),R&&R.sort(((e,t)=>e-t)),R&&R.length||v&&v.length||(R=[s.getMonth()+1]),v&&v.length&&v.forEach((e=>{e[1]&&(x=x||{},x[e[0]]=e[1])}));(!n||n>=E)&&(!p||T<p);){if(S=[],v&&v.length){if(v.forEach((e=>{let t=e[0],r=1,n=53;for(e[1]&&(r=n=e[1]),C=r;C<=n;C++)(D=this.getNthDayInPeriod(E,w,t,C))&&(D=DateHelper.copyTimeValues(D,s),b[D.getTime()]||(b[D.getTime()]=!0,S.push(D)))})),S.sort(((e,t)=>e-t)),!y)for(C=0;C<S.length;C++)if(D=S[C],D>=s){const e=this.isInView(t,D,o,a,i);if(T++,e&&(n&&D>n||!1===d.apply(h,[D,T,1===T&&l,i,...u])||p&&T>=p))return}}else for(C=0;C<R.length;C++)if((D=this.buildDate(E.getFullYear(),R[C]-1,s.getDate()))&&(D=DateHelper.copyTimeValues(D,s),!b[D.getTime()]))if(b[D.getTime()]=!0,y)S.push(D);else if(D>=s){const e=t?D>=o:D.valueOf()+a>o&&!i.hasException(D);if(T++,e&&(n&&D>n||!1===d.apply(h,[D,T,1===T&&l,i,...u])||p&&T>=p))return}y&&S.length&&this.forEachDateAtPositions(S,f,(e=>{if(e>=s){const r=t?e>=o:e.valueOf()+a>o&&!i.hasException(e);if(T++,r&&(!n||e<=n)&&(!1===d.apply(h,[e,T,1===T&&l,i,...u])||p&&T>=p))return!1}})),E=DateHelper.getNext(E,"year",g),w=new Date(DateHelper.getNext(E,"year",1)-1)}}}YearlyRecurrenceIterator._$name="YearlyRecurrenceIterator";const recurrenceIterators={};function convertStringOfIntegerItemsValue(e){return e?"string"==typeof e&&(e=e.split(",").map((e=>parseInt(e,10)))):e=null,e}function convertStringOfItemsValue(e){return e?"string"==typeof e&&(e=e.split(",")):e=null,e}function isEqualAsString(e,t){return String(e)===String(t)}function convertInteger(e){return this.defaultValue&&void 0===e?this.defaultValue:this.allowNull&&null==e?null:(e=parseInt(e),isNaN(e)?void 0:e)}[DailyRecurrenceIterator,WeeklyRecurrenceIterator,MonthlyRecurrenceIterator,YearlyRecurrenceIterator].forEach((e=>{recurrenceIterators[e.frequency]=e}));class RecurrenceModel extends Model{get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:convertInteger},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:convertInteger},{name:"days",convert:convertStringOfItemsValue,isEqual:isEqualAsString},{name:"monthDays",convert:convertStringOfIntegerItemsValue,isEqual:isEqualAsString},{name:"months",convert:convertStringOfIntegerItemsValue,isEqual:isEqualAsString},{name:"positions",convert:convertStringOfIntegerItemsValue,isEqual:isEqualAsString}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return recurrenceIterators[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const e=this,t=[];return e.frequency&&(t.push("FREQ="+e.frequency),e.interval>1&&t.push("INTERVAL="+e.interval),e.days&&e.days.length&&t.push("BYDAY="+e.days.join(",")),e.monthDays&&e.monthDays.length&&t.push("BYMONTHDAY="+e.monthDays.join(",")),e.months&&e.months.length&&t.push("BYMONTH="+e.months.join(",")),e.count&&t.push("COUNT="+e.count),e.endDate&&t.push("UNTIL="+DateHelper.format(e.endDate,e.dateFormat)),e.positions&&e.positions.length&&t.push("BYSETPOS="+e.positions.join(","))),t.join(";")}set rule(e){const t=this;if(t.beginBatch(),e){const r=e.split(";");for(let e=0,n=r.length;e<n;e++){const n=r[e].split("="),i=n[1];switch(n[0]){case"FREQ":t.frequency=i;break;case"INTERVAL":t.interval=i;break;case"COUNT":t.count=i,t.until=null;break;case"UNTIL":t.endDate=i?DateHelper.parse(i,t.dateFormat):null,t.count=null;break;case"BYDAY":t.days=i;break;case"BYMONTHDAY":t.monthDays=i;break;case"BYMONTH":t.months=i;break;case"BYSETPOS":t.positions=i}}t.sanitize()}else t.set({frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null});t.endBatch()}construct(e={}){const t=this,{rule:r,timeSpan:n}=e;t._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),r&&(t.suspendTimeSpanNotifying(),t.rule=r,t.resumeTimeSpanNotifying()),t.timeSpan=n}forEachOccurrence(e,t,r){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:t,fn(e,t,n,i){r(i.buildOccurrence(e,n),n,t,e)}})}sanitize(){const e=this,t=e.timeSpan,r=t&&t.startDate;switch(e.beginBatch(),e.isSanitizing=!0,e.frequency){case"DAILY":e.positions=null,e.days=null,e.monthDays=null,e.months=null;break;case"WEEKLY":e.positions=null,e.monthDays=null,e.months=null;const t=e.days;r&&t&&1==t.length&&t[0]==RecurrenceDayRuleEncoder.encodeDay(r.getDay())&&(e.days=null);break;case"MONTHLY":e.monthDays&&e.monthDays.length&&(e.positions=null,e.days=null),e.months=null;const n=e.monthDays;r&&n&&1==n.length&&n[0]==r.getDate()&&(e.monthDays=null);break;case"YEARLY":e.monthDays=null;const i=e.months;r&&i&&1==i.length&&i[0]==r.getMonth()+1&&(e.months=null)}e.isSanitizing=!1,e.endBatch()}copy(...e){const t=super.copy(...e);return t.dateFormat=this.dateFormat,t.timeSpan=this.timeSpan,t}afterChange(e,t,r){const n=super.afterChange(e,t,r),{timeSpan:i}=this;if(this.isSanitizing||this.sanitize(),i){if("endDate"in t){const e=DateHelper.clearTime(t.endDate.value),{exceptionDates:r}=i;if(i.removeOccurrencesFrom(e),r)for(const t in r){DateHelper.parseKey(t)>=e&&delete r[t]}}this.isTimeSpanNotifyingSuspended||i.onRecurrenceChanged()}return n}get count(){return this.get("count")}set count(e){e&&(this.endDate=null),this.set("count",e)}get endDate(){return this.get("endDate")}set endDate(e){e&&(this.count=null),this.set("endDate",e)}get isTimeSpanNotifyingSuspended(){return Boolean(this._suspendedTimeSpanNotifying)}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}}function convertExceptionDatesValue(e){const t={},{dateFormat:r}=this;return e&&(e="string"==typeof e?e.split(","):Array.isArray(e)?e:[e]).forEach((e=>{"string"==typeof e&&(e=DateHelper.parse(e,r)),isNaN(e)||(t[DateHelper.makeKey(e)]=1)})),t}function serializeExceptionDatesValue(e){const t=[],{dateFormat:r}=this;for(const n in e)e[n]&&t.push(DateHelper.format(DateHelper.parseKey(n),r));return t}RecurrenceModel._$name="RecurrenceModel";const emptyArray$7=[];var RecurringTimeSpan=e=>class extends(e||TimeSpan){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule"},{name:"exceptionDates",convert:convertExceptionDatesValue,serialize:serializeExceptionDatesValue}]}remove(){if(!this.isOccurrence)return super.remove(...arguments);this.cancelBatch(),this.detachFromRecurringEvent()}get eventStore(){var e;let t=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!t&&(null===(e=this.firstStore)||void 0===e?void 0:e.isRecurringTimeSpansMixin)&&(t=this.firstStore),t}get recurrenceModel(){return this._recurrenceModel||RecurrenceModel}set recurrenceModel(e){this._recurrenceModel=e}setRecurrence(e,t,r){const n=this;let i;e&&(e.isRecurrenceModel||("string"==typeof e&&(e={frequency:e},t&&(e.interval=t),r&&(r instanceof Date?e.endDate=r:e.count=r)),e=new n.recurrenceModel(e)),e.timeSpan=n,i=e.rule),n.recurrence=e,n.recurrenceRule=i}get recurrence(){const e=this,t=e.recurrenceRule;return!e._recurrence&&t&&(e._recurrence=new e.recurrenceModel({rule:t,timeSpan:e,id:e.id+"-recurrence"})),e._recurrence}set recurrence(e){const t=this;t._recurrence=e,e?(e.timeSpan=t,t.recurrenceRule=e.rule):t.isOccurrence?t.setData("recurrenceRule",null):t.recurrenceRule=null}get isRecurring(){return Boolean(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return Boolean(this.recurringTimeSpan)}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return!this.supportsRecurring||!this.isOccurrence}set recurringTimeSpan(e){this._recurringTimeSpan=e}getOccurrencesForDateRange(e,t=e){return this.eventStore.getOccurrencesForTimeSpan(this,e,t)}get occurrences(){if(this.isRecurring){const e=[];return this.occurrenceMap.forEach((t=>{t!==this&&e.push(t)})),e}return emptyArray$7}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(e){var t;const r=e.isTimeSpan?e.occurrenceDate:e;null===(t=this.eventStore)||void 0===t||t.globalOccurrences.delete(this.createRecurrenceKey(r)),this.occurrenceMap.delete(DateHelper.makeKey(r))}removeOccurrencesFrom(e){this.occurrenceMap.forEach(((t,r)=>{DateHelper.parseKey(r)>=e&&this.removeOccurrence(t)}))}removeOccurrences(){[this,...this.occurrences].forEach((e=>this.removeOccurrence(e)))}onRecurrenceChanged(){var e;this.recurrenceRule=(null===(e=this.recurrence)||void 0===e?void 0:e.rule)||null}get occurrenceDate(){var e;return(null===(e=this.meta.modified)||void 0===e?void 0:e.startDate)||this.startDate}buildOccurrence(e,t){var r;const n=this,{occurrenceMap:i,recurrence:s,meta:o}=n,a=null===(r=n.eventStore)||void 0===r?void 0:r.globalOccurrences,l=n.createRecurrenceKey(e),c=!(e-n.startDate),{fieldMap:d}=n.constructor;let u=null==a?void 0:a.get(l),{duration:h}=n;!n.endDate||!n.allDay&&h||(h=DateHelper.as(n.durationUnit,n.endDate.getTime()-n.startDate.getTime()));const g=void 0!==h?DateHelper.add(e,h,n.durationUnit):void 0;return u||(t||c?(u=n,c||(n.setStartEndDate(e,g,!0),s.suspendTimeSpanNotifying(),s.sanitize(),s.resumeTimeSpanNotifying()),o.isSyncedWithRule=!0):(u=n.copy({[d.id.dataSource]:l,[d.startDate.dataSource]:e,[d.endDate.dataSource]:g,[d.duration.dataSource]:h}),u.recurringTimeSpan=n),null==a||a.set(l,u),i.set(DateHelper.makeKey(e),u)),u}createRecurrenceKey(e=this.startDate){return`_generated:${this.id}:${DateHelper.format(e,"YYYYMMDD")}`}afterChange(e,t,r,...n){const i=this,{eventStore:s}=i;if("recurrenceRule"in t&&(i._recurrence=null,null==s||s.recurringEvents[t.recurrenceRule.value?"add":"delete"](i)),i.isOccurrence){var o;const{recurringTimeSpan:e,resource:r}=i,n=(null===(o=t.startDate)||void 0===o?void 0:o.value)||i.startDate;e.beginBatch(),i.detachFromRecurringEvent(),i.clearChanges(),i.setData("id",i.generateId(e.eventStore)),e.eventStore.add(i,!0),i.startDate=n,"resourceId"in i.data||i.assign(r),e.endBatch()}else"newExceptionDate"in t&&(i.meta.modified.exceptionDates=!0,delete i.meta.modified.newExceptionDate,i.removeOccurrence(t.newExceptionDate.value));return super.afterChange(e,t,r,...n)}detachFromRecurringEvent(){const e=this,{recurringTimeSpan:t,occurrenceDate:r,startDate:n}=e;e.recurringTimeSpan=null,t.addExceptionDate(r),e.recurrenceRule&&(t.recurrence.endDate=DateHelper.add(n,-1,"minute"))}set newExceptionDate(e){if(e){(this.exceptionDates||(this.exceptionDates={}))[DateHelper.makeKey(e)]=1}}addExceptionDate(e){return this.set({newExceptionDate:e})}hasException(e){var t;return null===(t=this.exceptionDates)||void 0===t?void 0:t[DateHelper.makeKey(e)]}};const oneDayMS=864e5;var EventModelMixin=e=>class extends e{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return["resourceId",{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0},{name:"allDay",defaultValue:!1},"eventStyle","eventColor","milestoneWidth"]}get resources(){return this.assignments.reduce(((e,t)=>(t.resource&&e.push(t.resource),e)),[])}set resources(e){Array.isArray(e)||(e=[e]);const t=this,r=e.map(t.constructor.asId),n=t.assignments.map((e=>e.resource.id)),{onlyInA:i,onlyInB:s}=ArrayHelper.delta(r,n);t.assignmentStore.add(i.map((e=>({resource:e,event:t})))),t.assignmentStore.remove(s.map((e=>t.assignments.find((t=>t.resource.id===e)))))}forEachResource(e,t=this){for(const r of this.resources)if(!1===e.call(t,r))return}getResource(e){return null==e?this.resource:this.resourceStore?this.resourceStore.getById(e):null}get startDate(){let e=super.startDate;return this.isOccurrence&&(e=this.get("startDate")),this.allDay&&(e=this.constructor.getAllDayStartDate(e)),e}set startDate(e){this.batching?this.set({startDate:e}):super.startDate=e}get endDate(){let e=super.endDate;return this.isOccurrence&&(e=this.get("endDate")),this.allDay&&(e=this.constructor.getAllDayEndDate(e)),e}set endDate(e){this.batching?this.set({endDate:e}):super.endDate=e}get isEvent(){return!0}get isDraggable(){return this.draggable}get isResizable(){return!this.isMilestone&&this.resizable}get isPersistable(){return super.isPersistable}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}get persistableData(){const e=super.persistableData;return this.usesSingleAssignment||delete e.resourceId,e}get resource(){const{resources:e}=this;return e.length?e[0]:null}set resource(e){this.resourceId=this.constructor.asId(e)}get resourceId(){var e;return this.usesSingleAssignment?this.get("resourceId"):null===(e=this.resource)||void 0===e?void 0:e.id}set resourceId(e){this.applyResourceId(e)}applyResourceId(e,t=!1){const r=this,{assignments:n,assignmentStore:i,eventStore:s}=r;if(s)if(null!=e)if(r.skipEnforcingSingleAssignment||(s.usesSingleAssignment=!0),(null==n?void 0:n.length)&&e!==n[0].resourceId){const t=Boolean(s.eventsSuspended);t&&i.suspendEvents(),n[0].resource=e,t&&i.resumeEvents()}else i.assignEventToResource(r,e);else i.remove(r.assignments);else t||r.set({resourceId:e})}applyValue(e,t,r,n,i){if(i&&"resourceId"===i.name&&!this.meta.isAssigning){const{eventStore:e}=this;e&&(e.isAssigning=!0),this.applyResourceId(r,!0),e&&(e.isAssigning=!1)}super.applyValue(e,t,r,n,i)}get assignments(){return[...this.assigned||[]]}assign(e,t=!1){const{eventStore:r}=this;r&&!r.usesSingleAssignment?r.assignEventToResource(this,e,t):(this.resourceId=this.constructor.asId(e),r||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(e,t=!1){var r;const n=this;e=n.constructor.asId(e),n.meta.removingResource=t,null===(r=n.eventStore)||void 0===r||r.unassignEventFromResource(n,e),n.meta.removingResource=null}reassign(e,t){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,e,t)}isAssignedTo(e){const t=this.constructor.asId(e);return this.assignments.some((e=>e.resourceId===t))}get predecessors(){return[...this.incomingDeps]}get successors(){return[...this.outgoingDeps]}get dependencies(){return[...this.incomingDeps,...this.outgoingDeps]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:e}=this;if(e>=864e5)return!0;const{endDate:t,startDate:r}=this,n=DateHelper.clearTime(r);return n.setDate(n.getDate()+1),(t||DateHelper.add(r,e))>n}static getAllDayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),e&&(e=DateHelper.clearTime(e,!0)),e}static getAllDayEndDate(e){return e&&e.isEvent&&(e=e.get("endDate")),e&&(e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0)&&(e=DateHelper.getNext(e,"d",1)),e}static getAllDayDisplayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),DateHelper.clearTime(e,!0)}static getAllDayDisplayEndDate(e,t){return e&&e.isEvent&&(t=e.get("endDate"),e=e.get("startDate")),t&&(e=this.constructor.getAllDayDisplayStartDate(e),DateHelper.clearTime(t,!0).valueOf()===t.valueOf()?t=DateHelper.add(t,DateHelper.DAY,-1):e.valueOf()!==t.valueOf()&&(t=DateHelper.clearTime(t,!0))),t}};const required=emptyFn$2;var __decorate$9=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let FORMULA_ID=0;const CalculateProposed=FORMULA_ID++;class Formula extends Base$1{constructor(){super(...arguments),this.formulaId=FORMULA_ID++,this.inputs=new Set}}class VariableWalkContext extends WalkContext{collectNext(e,t){if(e instanceof Formula)t.push({node:e.output,from:e,label:void 0});else{const r=this.cache.formulasByInput.get(e);r&&r.forEach((r=>t.push({node:r,from:e,label:void 0})))}}}class FormulasCache extends(Mixin([Base$1],(e=>class extends e{constructor(){super(...arguments),this.variables=new Set,this.formulas=new Set,this.$formulasByInput=void 0,this.$formulasByOutput=void 0}get formulasByInput(){return void 0!==this.$formulasByInput||this.fillCache(),this.$formulasByInput}get formulasByOutput(){return void 0!==this.$formulasByOutput||this.fillCache(),this.$formulasByOutput}add(e){this.$formulasByInput=void 0,this.$formulasByOutput=void 0,this.formulas.add(e)}has(e){return this.formulas.has(e)}fillCache(){this.$formulasByInput=new Map,this.$formulasByOutput=new Map,this.formulas.forEach((e=>{let t=this.$formulasByOutput.get(e.output);t||(t=new Set,this.$formulasByOutput.set(e.output,t)),t.add(e),e.inputs.forEach((t=>{let r=this.$formulasByInput.get(t);r||(r=new Set,this.$formulasByInput.set(t,r)),r.add(e)}))}))}allInputVariables(){return uniqueOnly(concatIterable(map(this.formulas,(e=>e.inputs.values()))))}isCyclic(){let e=!1;return VariableWalkContext.new({cache:this,onCycle:()=>(e=!0,OnCycleAction.Cancel)}).startFrom(Array.from(this.allInputVariables())),e}}))){}class CycleDescription extends FormulasCache{}class CycleResolution extends Base$1{constructor(){super(...arguments),this.description=void 0,this.defaultResolutionFormulas=new Set,this.resolutionsByInputHash=new Map}clear(){this.resolutionsByInputHash.clear()}resolve(e){const t=this.resolutionsByInputHash.get(e.hash);if(void 0!==t)return t;const r=this.buildResolution(e);return this.resolutionsByInputHash.set(e.hash,r),r}buildResolution(e){const t=WalkState.new({context:this,input:e}),r=Array.from(t.next()).map((e=>({resolution:e.asResolution(),nbrOfDefaultFormulas:Array.from(e.activatedFormulas.formulas).reduce(((t,r)=>e.formulaIsDefault(r)?t+1:t),0),unCoveredInputWeight:e.unCoveredInputWeight()})));if(r.sort(((e,t)=>e.unCoveredInputWeight<t.unCoveredInputWeight?-1:e.unCoveredInputWeight>t.unCoveredInputWeight?1:t.nbrOfDefaultFormulas-e.nbrOfDefaultFormulas)),r.length>0)return r[0].resolution}}var VariableInputState,Instruction;!function(e){e[e.NoInput=0]="NoInput",e[e.HasPreviousValue=1]="HasPreviousValue",e[e.HasProposedValue=2]="HasProposedValue",e[e.KeepIfPossible=4]="KeepIfPossible"}(VariableInputState||(VariableInputState={}));class CycleResolutionInput extends Base$1{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.$hash=""}get hash(){return""!==this.$hash?this.$hash:this.$hash=this.buildHash()}get description(){return this.context.description}get resolution(){return this.context.resolve(this)}initialize(...e){super.initialize(...e),this.input=new Map(CI(this.description.variables).map((e=>[e,VariableInputState.NoInput])))}buildHash(){return String.fromCharCode(...CI(this.description.variables).inBatchesBySize(5).map((e=>this.batchToCharCode(e))))}batchToCharCode(e){return e.reduceRight(((e,t,r)=>e|this.input.get(t)<<3*r),0)}addProposedValueFlag(e){const t=this.input.get(e);this.input.set(e,t|VariableInputState.HasProposedValue)}hasProposedValue(e){return Boolean(this.input.get(e)&VariableInputState.HasProposedValue)}hasProposedValueVars(){return CI(this.description.variables).filter((e=>this.hasProposedValue(e)))}addPreviousValueFlag(e){const t=this.input.get(e);this.input.set(e,t|VariableInputState.HasPreviousValue)}hasPreviousValue(e){return Boolean(this.input.get(e)&VariableInputState.HasPreviousValue)}hasPreviousValueVars(){return CI(this.description.variables).filter((e=>this.hasPreviousValue(e)))}addKeepIfPossibleFlag(e){const t=this.input.get(e);this.input.set(e,t|VariableInputState.KeepIfPossible)}keepIfPossible(e){return Boolean(this.input.get(e)&VariableInputState.KeepIfPossible)}keepIfPossibleVars(){return CI(this.description.variables).filter((e=>this.keepIfPossible(e)))}}__decorate$9([required],CycleResolutionInput.prototype,"context",void 0);class WalkState extends Base$1{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.previous=void 0,this.activatedFormula=void 0,this.$activatedFormulas=void 0}get activatedFormulas(){if(void 0!==this.$activatedFormulas)return this.$activatedFormulas;const e=FormulasCache.new({variables:this.description.variables,formulas:CI(this.thisAndPreviousStates()).map((e=>e.activatedFormula)).toSet()});return this.$activatedFormulas=e}get description(){return this.context.description}*thisAndPreviousStates(){let e=this;for(;e&&e.activatedFormula;)yield e,e=e.previous}formulaHasProposedValueInInput(e){return Array.from(e.inputs).some((e=>this.input.hasProposedValue(e)))}unCoveredInputWeight(){const e=map(this.input.hasProposedValueVars(),(e=>({variable:e,isProposed:!0}))),t=map(this.input.keepIfPossibleVars(),(e=>({variable:e,isProposed:!1})));return CI([e,t]).concat().uniqueOnlyBy((e=>e.variable)).reduce(((e,{variable:t,isProposed:r})=>{let n=0;const i=this.activatedFormulas.formulasByOutput.get(t);if(i){const e=1===i.size?Array.from(i)[0]:null;e&&this.formulaIsDefault(e)&&this.formulaHasProposedValueInInput(e)?n+=r?1e6:1e4:n+=r?1e7:1e5}const s=this.activatedFormulas.formulasByInput.get(t);return s&&s.size>0||(n+=r?1e3:100),e+n}),0)}preferFormula(e,t){const r=this.formulaAllInputsHasProposed(e),n=this.formulaAllInputsHasProposed(t);if(r&&!n)return-1;if(n&&!r)return 1;const i=this.formulaCountInputsWithProposedOrKeep(e),s=this.formulaCountInputsWithProposedOrKeep(t);return i>s?-1:i<s?1:this.formulaIsDefault(e)&&!this.formulaIsDefault(t)?-1:this.formulaIsDefault(t)&&!this.formulaIsDefault(e)?1:0}formulaIsDefault(e){return this.context.defaultResolutionFormulas.has(e)}formulaCountInputsWithProposedOrKeep(e){let t=0;return Array.from(e.inputs).forEach((e=>{(this.input.hasProposedValue(e)||this.input.keepIfPossible(e))&&t++})),t}formulaAllInputsHasProposedOrKeep(e){return Array.from(e.inputs).every((e=>this.input.hasProposedValue(e)||this.input.keepIfPossible(e)))}formulaAllInputsHasProposed(e){return Array.from(e.inputs).every((e=>this.input.hasProposedValue(e)))}formulaIsApplicable(e){const t=Array.from(e.inputs).every((e=>this.input.hasProposedValue(e)||this.input.hasPreviousValue(e)||this.activatedFormulas.formulasByOutput.has(e))),r=FormulasCache.new({formulas:new Set(this.activatedFormulas.formulas)});return r.add(e),t&&!r.isCyclic()}formulaIsInsignificant(e){const t=this.activatedFormulas.formulasByOutput.has(e.output),r=this.input.hasPreviousValue(e.output);return t||r&&Array.from(e.inputs).some((e=>!this.input.hasPreviousValue(e)&&!this.input.hasProposedValue(e)))}unvisitedFormulas(){return Array.from(this.description.formulas).filter((e=>!this.activatedFormulas.has(e)))}*next(){const e=this.unvisitedFormulas();e.sort(this.preferFormula.bind(this));let t=!0;for(const r of e){if(!this.formulaIsApplicable(r)||this.formulaIsInsignificant(r))continue;const e=WalkState.new({previous:this,context:this.context,input:this.input,activatedFormula:r});yield*e.next(),t=!1}t&&(yield this)}asResolution(){return new Map(CI(this.description.variables).map((e=>{const t=this.activatedFormulas.formulasByOutput.get(e);if(t)for(const r of t)return[e,r.formulaId];return[e,CalculateProposed]})))}}class CycleResolutionInputChrono extends CycleResolutionInput{collectInfo(e,t,r){null!=e(PreviousValueOf(t))&&this.addPreviousValueFlag(r),e(HasProposedValue(t))&&this.addProposedValueFlag(r)}}!function(e){e.KeepDuration="KeepDuration",e.KeepStartDate="KeepStartDate",e.KeepEndDate="KeepEndDate"}(Instruction||(Instruction={}));const StartDateVar=Symbol("StartDate"),EndDateVar=Symbol("EndDate"),DurationVar=Symbol("Duration"),startDateFormula=Formula.new({output:StartDateVar,inputs:new Set([DurationVar,EndDateVar])}),endDateFormula=Formula.new({output:EndDateVar,inputs:new Set([DurationVar,StartDateVar])}),durationFormula=Formula.new({output:DurationVar,inputs:new Set([StartDateVar,EndDateVar])}),SEDGraphDescription=CycleDescription.new({variables:new Set([StartDateVar,EndDateVar,DurationVar]),formulas:new Set([startDateFormula,endDateFormula,durationFormula])}),SEDForwardCycleResolutionContext=CycleResolution.new({description:SEDGraphDescription,defaultResolutionFormulas:new Set([endDateFormula])}),SEDBackwardCycleResolutionContext=CycleResolution.new({description:SEDGraphDescription,defaultResolutionFormulas:new Set([startDateFormula])});class SEDDispatcher extends CycleResolutionInputChrono{addInstruction(e){e===Instruction.KeepStartDate&&this.addKeepIfPossibleFlag(StartDateVar),e===Instruction.KeepEndDate&&this.addKeepIfPossibleFlag(EndDateVar),e===Instruction.KeepDuration&&this.addKeepIfPossibleFlag(DurationVar)}}class SEDDispatcherIdentifier extends(FieldIdentifier.mix(CalculatedValueGen)){equality(e,t){const r=e.resolution,n=t.resolution;return r.get(StartDateVar)===n.get(StartDateVar)&&r.get(EndDateVar)===n.get(EndDateVar)&&r.get(DurationVar)===n.get(DurationVar)}}var __decorate$a=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class BaseEventMixin extends(Mixin([HasCalendarMixin],(e=>{e.prototype;class t extends e{*calculateDispatcher(e){yield ProposedOrPrevious;const t=yield*this.prepareDispatcher(e),r=yield ProposedArgumentsOf(this.$.startDate),n=r?r[0]?Instruction.KeepDuration:Instruction.KeepEndDate:void 0;n&&t.addInstruction(n);const i=yield ProposedArgumentsOf(this.$.endDate),s=i?i[0]?Instruction.KeepDuration:Instruction.KeepStartDate:void 0;s&&t.addInstruction(s);const o=yield this.$.direction,a=yield ProposedArgumentsOf(this.$.duration);let l;if(a)switch(a[0]){case!0:l=Instruction.KeepStartDate;break;case!1:l=Instruction.KeepEndDate}return!l&&t.hasProposedValue(DurationVar)&&(l=o===Direction.Forward||o===Direction.None?Instruction.KeepStartDate:Instruction.KeepEndDate),l&&t.addInstruction(l),t}*prepareDispatcher(e){const t=this.dispatcherClass(e).new({context:this.cycleResolutionContext(e)});return t.collectInfo(e,this.$.startDate,StartDateVar),t.collectInfo(e,this.$.endDate,EndDateVar),t.collectInfo(e,this.$.duration,DurationVar),t}cycleResolutionContext(e){const t=e(this.$.direction);return t===Direction.Forward||t===Direction.None?SEDForwardCycleResolutionContext:SEDBackwardCycleResolutionContext}dispatcherClass(e){return SEDDispatcher}buildProposedDispatcher(e,t,r){const n=this.dispatcherClass(r.onEffectSync).new({context:this.cycleResolutionContext(r.onEffectSync)});return n.addPreviousValueFlag(StartDateVar),n.addPreviousValueFlag(EndDateVar),n.addPreviousValueFlag(DurationVar),n}*skipNonWorkingTime(e,t){const r=yield this.$.effectiveCalendar;if(!e)return null;const n=r.skipNonWorkingTime(e,t);if(n instanceof Date)return n;yield Reject("Empty calendar")}*skipWorkingTime(e,t,r,n){const i=yield this.$.durationUnit;return n&&n!==i&&(r=yield*this.getProject().$convertDuration(r,n,i)),yield*this.calculateProjectedXDateWithDuration(e,t,r)}setStartDate(e,t=!0){if(this.graph)return this.graph.write(this.$.startDate,e,t),this.graph.commitAsync();this.$.startDate.DATA=e}writeStartDate(e,t,r,n,i=!0){if(!t.baseRevision.hasIdentifier(e)&&null==n)return;i?Instruction.KeepDuration:Instruction.KeepEndDate;e.constructor.prototype.write.call(this,e,t,r,n,i)}*calculateStartDate(){const e=(yield this.$.dispatcher).resolution.get(StartDateVar);if(e===CalculateProposed)return yield*this.calculateStartDateProposed();if(e===startDateFormula.formulaId)return yield*this.calculateStartDatePure();throw new Error("Unknown formula for `startDate`")}*calculateStartDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.endDate,!1,yield this.$.duration)}*calculateStartDateProposed(){const e=yield ProposedOrPrevious;return yield*this.skipNonWorkingTime(e,!0)}*calculateProjectedXDateWithDuration(e,t,r){const n=yield this.$.durationUnit,i=yield this.$.effectiveCalendar,s=this.getProject();return e&&(o=r,Number(o)===o)?(t=void 0===t||t)?i.calculateEndDate(e,yield*s.$convertDuration(r,n,TimeUnit.Millisecond)):i.calculateStartDate(e,yield*s.$convertDuration(r,n,TimeUnit.Millisecond)):null;var o}setEndDate(e,t=!1){if(this.graph)return this.graph.write(this.$.endDate,e,t),this.graph.commitAsync();this.$.endDate.DATA=e}writeEndDate(e,t,r,n,i=!1){(t.baseRevision.hasIdentifier(e)||null!=n)&&e.constructor.prototype.write.call(this,e,t,r,n,i)}*calculateEndDate(){const e=(yield this.$.dispatcher).resolution.get(EndDateVar);if(e===CalculateProposed)return yield*this.calculateEndDateProposed();if(e===endDateFormula.formulaId)return yield*this.calculateEndDatePure();throw new Error("Unknown formula for `endDate`")}*calculateEndDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.startDate,!0,yield this.$.duration)}*calculateEndDateProposed(){const e=yield ProposedOrPrevious;return yield*this.skipNonWorkingTime(e,!1)}getDuration(e){const t=this.duration;return void 0!==e?this.getProject().convertDuration(t,this.durationUnit,e):t}setDuration(e,t,r){if(this.graph){if(void 0!==e)return this.graph.write(this.$.duration,e,t,r),this.graph.commitAsync()}else this.$.duration.DATA=e,null!=t&&(this.$.durationUnit.DATA=t)}setDurationUnit(e){throw new Error("Use `setDuration` instead")}writeDuration(e,t,r,n,i,s){n<0&&(n=0),(t.baseRevision.hasIdentifier(e)||null!=n)&&(e.constructor.prototype.write.call(this,e,t,r,n,s),null!=i&&t.write(this.$.durationUnit,i))}*calculateDuration(){const e=(yield this.$.dispatcher).resolution.get(DurationVar);if(e===CalculateProposed)return yield*this.calculateDurationProposed();if(e===durationFormula.formulaId)return yield*this.calculateDurationPure();throw new Error("Unknown formula for `duration`")}*calculateDurationPure(){const e=yield this.$.startDate,t=yield this.$.endDate;return e&&t?e>t?void(yield Write(this.$.duration,0,null)):yield*this.calculateProjectedDuration(e,t):null}*calculateDurationProposed(){return yield ProposedOrPrevious}*calculateProjectedDuration(e,t,r){if(!e||!t)return null;r||(r=yield this.$.durationUnit);const n=yield this.$.effectiveCalendar,i=this.getProject();return yield*i.$convertDuration(n.calculateDurationMs(e,t),TimeUnit.Millisecond,r)}*calculateEffectiveDuration(){let e;const t=(yield this.$.dispatcher).resolution.get(DurationVar);return t===CalculateProposed?e=yield this.$.duration:t===durationFormula.formulaId&&(e=yield*this.calculateProjectedDuration(yield ProposedOrPreviousValueOf(this.$.startDate),yield ProposedOrPreviousValueOf(this.$.endDate))),e}}var r;return __decorate$a([model_field({type:"date"},{converter:dateConverter})],t.prototype,"startDate",void 0),__decorate$a([model_field({type:"date"},{converter:dateConverter})],t.prototype,"endDate",void 0),__decorate$a([model_field({type:"number",allowNull:!0})],t.prototype,"duration",void 0),__decorate$a([model_field({type:"string",defaultValue:TimeUnit.Day},{converter:DateHelper.normalizeUnit})],t.prototype,"durationUnit",void 0),__decorate$a([model_field({type:"string",defaultValue:Direction.Forward},{sync:!0})],t.prototype,"direction",void 0),__decorate$a([field({identifierCls:SEDDispatcherIdentifier})],t.prototype,"dispatcher",void 0),__decorate$a([model_field({type:"boolean",defaultValue:!1})],t.prototype,"manuallyScheduled",void 0),__decorate$a([calculate("dispatcher")],t.prototype,"calculateDispatcher",null),__decorate$a([(r="dispatcher",function(e,t,n){let i;ensureEntityOnPrototype(e),i=e.$buildProposed?e.hasOwnProperty("$buildProposed")?e.$buildProposed:e.$buildProposed=Object.create(e.$buildProposed):e.$buildProposed={},i[r]=t})],t.prototype,"buildProposedDispatcher",null),__decorate$a([write("startDate")],t.prototype,"writeStartDate",null),__decorate$a([calculate("startDate")],t.prototype,"calculateStartDate",null),__decorate$a([write("endDate")],t.prototype,"writeEndDate",null),__decorate$a([calculate("endDate")],t.prototype,"calculateEndDate",null),__decorate$a([write("duration")],t.prototype,"writeDuration",null),__decorate$a([calculate("duration")],t.prototype,"calculateDuration",null),t}))){}class AbstractHasAssignmentsMixin extends(Mixin([AbstractPartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{getAssignmentFor(e){for(const t of this.assigned)if(t.resource===e)return t;return null}isAssignedTo(e){return Boolean(this.getAssignmentFor(e))}async assign(e){if(this.getAssignmentFor(e))throw new Error("Resource can't be assigned twice to the same task");const t=this.project.assignmentStore.modelClass;return this.addAssignment(new t({event:this,resource:e})),this.commitAsync()}async unassign(e){const t=this.getAssignmentFor(e);if(!t)throw new Error(`Can't unassign resource \`${e}\` from task \`${this}\` - resource is not assigned to the task!`);return this.removeAssignment(t),this.commitAsync()}leaveProject(){if(this.assigned){const e=this.getEventStore();this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this,...arguments)}remove(){if(!this.parent)return t.remove.call(this);{const e=this.getEventStore();t.remove.call(this),e&&e.afterEventRemoval()}}addAssignment(e){return this.getProject().assignmentStore.add(e),e}removeAssignment(e){return this.getProject().assignmentStore.remove(e),e}}}))){}var __decorate$b=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class BaseHasAssignmentsMixin extends(Mixin([BaseEventMixin,AbstractHasAssignmentsMixin],(e=>{e.prototype;class t extends e{get assignments(){return this.assigned?[...this.assigned]:[]}}return __decorate$b([generic_field({},ModelBucketField)],t.prototype,"assigned",void 0),t}))){}var _window$bryntum$4,__decorate$c=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class HasDependenciesMixin extends(Mixin([BaseEventMixin],(e=>{const t=e.prototype;class r extends e{leaveProject(){const e=this.getEventStore();this.outgoingDeps&&this.outgoingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),this.incomingDeps&&this.incomingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),t.leaveProject.call(this)}}return __decorate$c([generic_field({},ModelBucketField)],r.prototype,"outgoingDeps",void 0),__decorate$c([generic_field({},ModelBucketField)],r.prototype,"incomingDeps",void 0),r}))){}class SchedulerBasicEvent extends(Mixin([BaseEventMixin,BaseHasAssignmentsMixin,HasDependenciesMixin],(e=>{e.prototype;return class extends e{}}))){}class CoreHasAssignmentsMixin extends(Mixin([CoreEventMixin,AbstractHasAssignmentsMixin],(e=>{const t=e.prototype;return class extends e{get assigned(){var e;const t=null===(e=this.project)||void 0===e?void 0:e.assignmentStore.getEventsAssignments(this);return t?this.$cachedAssignments=t:this.$cachedAssignments}applyValue(e,r,n,i,s){var o;"id"===r&&(null===(o=this.assigned)||void 0===o||o.forEach((e=>e.set("eventId",n)))),t.applyValue.call(this,e,r,n,i,s)}copy(e=null,r=null){const n=t.copy.call(this,e,r);return(ObjectHelper.isObject(r)&&!r.skipFieldIdentifiers||!ObjectHelper.isObject(r))&&(n.$cachedAssignments=this.assigned),n}}}))){}class CoreHasDependenciesMixin extends(Mixin([CoreEventMixin],(e=>{const t=e.prototype;return class extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const e=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),this.incomingDeps&&this.incomingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),t.leaveProject.call(this)}}}))){}class SchedulerCoreEvent extends(Mixin([CoreEventMixin,CoreHasAssignmentsMixin,CoreHasDependenciesMixin],(e=>{e.prototype;return class extends e{}}))){}const EngineMixin$4=(null===(_window$bryntum$4=window.bryntum)||void 0===_window$bryntum$4?void 0:_window$bryntum$4.useBasicEngine)?SchedulerBasicEvent:SchedulerCoreEvent;class EventModel extends(EngineMixin$4.derive(TimeSpan).mixin(RecurringTimeSpan,PartOfProject,EventModelMixin)){}EventModel.exposeProperties(),EventModel._$name="EventModel";class AbstractEventStoreMixin extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}remove(e,r){const n=t.remove.call(this,e);return this.afterEventRemoval(),n}afterEventRemoval(){const{assignmentsForRemoval:e,dependenciesForRemoval:t}=this;if(!e)return;const r=this.getAssignmentStore();if(r&&!r.allAssignmentsForRemoval&&e.size){const t=[...e].filter((e=>!r.assignmentsForRemoval.has(e)));t.length>0&&r.remove(t)}e.clear();const n=this.getDependencyStore();if(n&&!n.allDependenciesForRemoval&&t.size){const e=[...t].filter((e=>!n.dependenciesForRemoval.has(e)));e.length>0&&n.remove(e)}t.clear()}removeAll(e){const r=t.removeAll.call(this,e);return this.afterEventRemoval(),r}processRecord(e,t=!1){var r;if(!(null===(r=this.project)||void 0===r?void 0:r.isRepopulatingStores)){const t=this.getById(e.id);if(t&&t!==e)for(const r of t.assigned)r.event=e}return e}}}))){}class ChronoEventStoreMixin extends(Mixin([AbstractEventStoreMixin,ChronoPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:SchedulerBasicEvent}}set data(e){super.data=e,this.afterEventRemoval()}}}))){}class ChronoEventTreeStoreMixin extends(Mixin([ChronoEventStoreMixin],(e=>{e.prototype;return class extends e{buildRootNode(){return this.getProject()||{}}static get defaultConfig(){return{tree:!0}}}}))){}class CoreEventStoreMixin extends(Mixin([AbstractEventStoreMixin,CorePartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:SchedulerCoreEvent}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}afterLoadData(){var e;this.afterEventRemoval(),null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}}}))){}var _window$bryntum$5;const EngineMixin$5=(null===(_window$bryntum$5=window.bryntum)||void 0===_window$bryntum$5?void 0:_window$bryntum$5.useBasicEngine)?PartOfBaseProject(ChronoEventStoreMixin.derive(AjaxStore)):PartOfProject(CoreEventStoreMixin.derive(AjaxStore));class EventStore extends(EngineMixin$5.mixin(SharedEventStoreMixin,RecurringEventsMixin,EventStoreMixin)){static get defaultConfig(){return{modelClass:EventModel,defaultCalendar:null}}}EventStore._$name="EventStore";const canonicalDependencyTypes=["SS","SF","FS","FF"];class DependencyBaseModel extends Model{static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"}]}get sourceEvent(){return VersionHelper.deprecate("scheduler","5.0.0","Deprecated in favor of fromEvent"),this.fromEvent}set sourceEvent(e){this.fromEvent=e}get targetEvent(){return VersionHelper.deprecate("scheduler","5.0.0","Deprecated in favor of toEvent"),this.toEvent}set targetEvent(e){this.targetEvent=e}construct(e){null!=e.from&&(e.fromEvent=e.from),null!=e.to&&(e.toEvent=e.to),super.construct(...arguments)}get eventStore(){const{unjoinedStores:e}=this;return this.eventStore||e[0]&&e[0].eventStore}set from(e){const{fromEvent:t}=this;t&&t.isModel&&t.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:t}=this;t&&t.isModel&&t.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let t;return e!==this.getHardType()&&(t=this.set({type:e,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(e){"number"==typeof e?this.set({lag:e}):this.setLag(e)}setLag(e,t){1!==arguments.length?(e=parseFloat(e),this.set({lag:e,lagUnit:t})):"number"==typeof e?this.lag=e:(e=DateHelper.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}))}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${DateHelper.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new Duration({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){"string"==typeof e?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:t,unjoinedStores:r}=e,n=t[0];let i;if(n){const{fromEvent:t,toEvent:r}=e,s=n.crudManager;i=t&&(s||!t.hasGeneratedId)&&r&&(s||!r.hasGeneratedId)}else i=Boolean(r[0]);return i}getSourceEvent(){return this.fromEvent}getTargetEvent(){return this.toEvent}getDateRange(e=!1){const{fromEvent:t,toEvent:r}=this;if(t&&r&&t.isScheduled&&r.isScheduled){const n=DependencyBaseModel.Type;let i,s;switch(this.type){case n.StartToStart:i=t.startDate,s=r.startDate;break;case n.StartToEnd:i=t.startDate,s=r.endDate;break;case n.EndToEnd:i=t.endDate,s=r.endDate;break;case n.EndToStart:i=t.endDate,s=r.startDate}return{start:e?i:DateHelper.min(i,s),end:e?s:DateHelper.max(i,s)}}return null}highlight(e){const t=this.highlighted?this.highlighted.split(" "):[];t.includes(e)||(this.highlighted=t.concat(e).join(" "))}unhighlight(e){const{highlighted:t}=this;if(t){const r=t.split(" "),n=r.findIndex((t=>t===e));n>=0&&(r.splice(n,1),this.highlighted=r.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const t=canonicalDependencyTypes[this.type];return e?t:this.type===DependencyBaseModel.Type.EndToStart?"":t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{from:e,to:t,type:r}=this;return"number"==typeof r&&e&&""!==e&&null!=t&&""!==t&&e!==t}}DependencyBaseModel.exposeProperties(),DependencyBaseModel._$name="DependencyBaseModel";var _window$bryntum$6,__decorate$d=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class BaseDependencyMixin extends(Mixin([ChronoPartOfProjectModelMixin],(e=>{e.prototype;class t extends e{}return __decorate$d([generic_field({bucket:"outgoingDeps",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual}},ModelReferenceField)],t.prototype,"fromEvent",void 0),__decorate$d([generic_field({bucket:"incomingDeps",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual}},ModelReferenceField)],t.prototype,"toEvent",void 0),__decorate$d([model_field({type:"int",defaultValue:DependencyType.EndToStart})],t.prototype,"type",void 0),t}))){}class CoreDependencyMixin extends(Mixin([CorePartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"fromEvent",isEqual:(e,t)=>e===t,persist:!1},{name:"toEvent",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,r,n){var i,s,o;let a=!1;if("fromEvent"===e||"toEvent"===e){const e=isInstanceOf(r,CoreEventMixin)?r:null===(i=this.eventStore)||void 0===i?void 0:i.getById(r);e&&(a=!0),r=e||r}t.setChanged.call(this,e,r,n,!0),!a||this.project.isPerformingCommit||(null===(s=this.dependencyStore)||void 0===s?void 0:s.isLoadingData)||null===(o=this.dependencyStore)||void 0===o||o.updateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){var e,t;let{fromEvent:r,toEvent:n}=this.$changed;if(null!==r&&!isInstanceOf(r,CoreEventMixin)){const t=null===(e=this.eventStore)||void 0===e?void 0:e.getById(r);t&&(this.$changed.fromEvent=t)}if(null!==n&&!isInstanceOf(n,CoreEventMixin)){const e=null===(t=this.eventStore)||void 0===t?void 0:t.getById(n);e&&(this.$changed.toEvent=e)}}set fromEvent(e){this.setChanged("fromEvent",e)}get fromEvent(){const e=this.get("fromEvent");return isInstanceOf(e,CoreEventMixin)?e:null}set toEvent(e){this.setChanged("toEvent",e)}get toEvent(){const e=this.get("toEvent");return isInstanceOf(e,CoreEventMixin)?e:null}}}))){}const EngineMixin$6=(null===(_window$bryntum$6=window.bryntum)||void 0===_window$bryntum$6?void 0:_window$bryntum$6.useBasicEngine)?BaseDependencyMixin:CoreDependencyMixin;class DependencyModel extends(PartOfProject(EngineMixin$6.derive(DependencyBaseModel))){getTypeFromSides(e,t,r){const n=DependencyBaseModel.Type,i=r?"right":"left",s=r?"left":"right";return e===i?t===i?n.StartToStart:n.StartToEnd:t===s?n.EndToEnd:n.EndToStart}}DependencyModel.exposeProperties(),DependencyModel._$name="DependencyModel";var DependencyStoreMixin=e=>class extends e{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(e,t,r,n=!0,i){return i=i||(e=>this.getEventDependencies(e)),(e=Array.isArray(e)?e:[e]).reduce(((e,r)=>{r.children&&!n?r.traverse((r=>{e=i(r).reduce(t,e)})):e=i(r).reduce(t,e)}),r),r}mapEventDependencies(e,t,r,n,i){return this.reduceEventDependencies(e,((e,t)=>(r(t)&&e.push(t),e)),[],n,i)}mapEventPredecessors(e,t,r,n){return this.reduceEventPredecessors(e,((e,t)=>(r(t)&&e.push(t),e)),[],n)}mapEventSuccessors(e,t,r,n){return this.reduceEventSuccessors(e,((e,t)=>(r(t)&&e.push(t),e)),[],n)}getEventDependencies(e){return[].concat(e.predecessors||[],e.successors||[])}getEventPredecessors(e){return VersionHelper.deprecate("scheduler","5.0.0","Superfluous, will be removed in favour of `event.predecessors`"),e.predecessors}getEventSuccessors(e){return VersionHelper.deprecate("scheduler","5.0.0","Superfluous, will be removed in favour of `event.successors`"),e.successors}removeEventDependencies(e){this.remove(this.getEventDependencies(e))}removeEventPredecessors(e){this.remove(e.predecessors)}removeEventSuccessors(e,t){this.remove(e.successors)}getBySourceTargetId(e){return this.records.find((t=>e==this.constructor.makeDependencySourceTargetCompositeKey(t.from,t.to)))}getDependencyForSourceAndTargetEvents(e,t){return e=Model.asId(e),t=Model.asId(t),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(e,t))}getEventsLinkingDependency(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)||this.getDependencyForSourceAndTargetEvents(t,e)}isValidDependency(e,t,r){return 1===arguments.length&&(t=e.to||e.toEvent,e=e.from||e.fromEvent),e instanceof TimeSpan&&t instanceof TimeSpan?this.project.isValidDependency(e,t,r):null!=e&&null!=t&&e!==t}isValidDependencyToCreate(e,t,r){return this.isValidDependency(e,t,r)}getHighlightedDependencies(e){return this.records.reduce(((t,r)=>(r.isHighlightedWith(e)&&t.push(r),t)),[])}static makeDependencySourceTargetCompositeKey(e,t){return`source(${e})-target(${t})`}getTimeSpanDependencies(e){return this.getEventDependencies(e)}};class AbstractDependencyStoreMixin extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(e,r){this.dependenciesForRemoval=CIFromSetOrArrayOrValue(e).toSet();const n=t.remove.call(this,e);return this.dependenciesForRemoval.clear(),n}removeAll(e){this.allDependenciesForRemoval=!0;const r=t.removeAll.call(this,e);return this.allDependenciesForRemoval=!1,r}}}))){}class ChronoDependencyStoreMixin extends(Mixin([AbstractDependencyStoreMixin,ChronoPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{set data(e){this.allDependenciesForRemoval=!0,super.data=e,this.allDependenciesForRemoval=!1}}}))){}const emptySet$1=new Set;class CoreDependencyStoreMixin extends(Mixin([AbstractDependencyStoreMixin,CorePartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:CoreDependencyMixin,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(e){return this.storage.findItem("toEvent",e)||emptySet$1}getOutgoingDepsForEvent(e){return this.storage.findItem("fromEvent",e)||emptySet$1}set data(e){this.allDependenciesForRemoval=!0,super.data=e,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}onCommitAsync(){this.updateIndices()}}}))){}var _window$bryntum$7;const EngineMixin$7=(null===(_window$bryntum$7=window.bryntum)||void 0===_window$bryntum$7?void 0:_window$bryntum$7.useBasicEngine)?PartOfBaseProject(ChronoDependencyStoreMixin.derive(AjaxStore)):PartOfProject(CoreDependencyStoreMixin.derive(AjaxStore));class DependencyStore extends(DependencyStoreMixin(EngineMixin$7.derive(AjaxStore))){static get defaultConfig(){return{modelClass:DependencyModel}}}DependencyStore._$name="DependencyStore";class CrudManager extends(AbstractCrudManager.mixin(SchedulerProjectCrudManager,AjaxTransport,JsonEncoder)){static get defaultConfig(){return{resourceStoreClass:ResourceStore,eventStoreClass:EventStore,assignmentStoreClass:AssignmentStore,dependencyStoreClass:DependencyStore,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null,scheduler:null}}startConfigure(e){e.scheduler&&(e.scheduler._crudManager=this),super.startConfigure(e)}afterConstruct(){const e=this,{scheduler:t}=e;if(t){const{timeRanges:r}=t.features;r&&(e.addCrudStore(r.store),e._timeRangesStore=r.store)}else e.project||(e.project=null);super.afterConstruct()}set project(e){const t=this;t._project=e,e&&(t.eventStore=e.eventStore,t.resourceStore=e.resourceStore,t.assignmentStore=e.assignmentStore,t.dependencyStore=e.dependencyStore,t.resourceTimeRangeStore=e.resourceTimeRangeStore),t.eventStore||(t.eventStore={}),t.resourceStore||(t.resourceStore={}),t.assignmentStore||(t.assignmentStore={}),t.dependencyStore||(t.dependencyStore={})}get project(){return this._project}get timeRangesStore(){return this._timeRangesStore}get resourceStore(){var e;return null===(e=this._resourceStore)||void 0===e?void 0:e.store}set resourceStore(e){this.setFeaturedStore("_resourceStore",e,this.resourceStoreClass)}get eventStore(){var e;return null===(e=this._eventStore)||void 0===e?void 0:e.store}set eventStore(e){this.setFeaturedStore("_eventStore",e,this.eventStoreClass)}get assignmentStore(){var e;return null===(e=this._assignmentStore)||void 0===e?void 0:e.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){var e;return null===(e=this._dependencyStore)||void 0===e?void 0:e.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}set resourceTimeRangeStore(e){this._resourceTimeRangesStore=e,this.addCrudStore(e)}get resourceTimeRangeStore(){return this._resourceTimeRangesStore}setFeaturedStore(e,t,r){var n;const i=this,s=null===(n=i[e])||void 0===n?void 0:n.store;var o;s!==t&&(t=Store.getStore(t,(null===(o=t)||void 0===o?void 0:o.storeClass)||r),s&&i.removeStore(s),i[e]=t&&{store:t}||null,i.addPrioritizedStore(i[e]));return i[e]}getChangeSetPackage(){const e=super.getChangeSetPackage();return e&&this.eventStore.usesSingleAssignment&&(delete e[this.assignmentStore.storeId],!this.crudStores.some((t=>e[t.storeId])))?null:e}}CrudManager._$name="CrudManager";class ViewPreset extends Model{static get fields(){return[{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(e){super.construct(...arguments),this.normalizeUnits()}generateId(e){const t=this,{headers:r}=t,n=[];let i=Object.getPrototypeOf(t.data).id;if(!i){for(let{length:e}=r,t=e-1;t>=0;t--)n.push(t?r[t].unit:StringHelper.capitalize(r[t].unit));i=n.join("And")}return e.includes(i)&&(i+=`-${t.tickWidth}by${t.tickHeight||t.tickWidth}`,e.includes(i)&&(i+="-"+t.bottomHeader.increment,e.includes(i)&&(i=IdHelper.generateId(i+"-")))),i}normalizeUnits(){const e=this,{timeResolution:t,headers:r}=e;for(let e=0,{length:t}=r;e<t;e++){const t=r[e];t.unit=DateHelper.normalizeUnit(t.unit),t.splitUnit&&(t.splitUnit=DateHelper.normalizeUnit(t.splitUnit)),"increment"in t||(r[e]=Object.assign({increment:1},t))}t&&(t.unit=DateHelper.normalizeUnit(t.unit)),e.shiftUnit&&(e.shiftUnit=DateHelper.normalizeUnit(e.shiftUnit))}static normalizeHeaderConfig(e){const{headerConfig:t,columnLinesFor:r,mainHeaderLevel:n}=e,i=e.headers=[];if(t.top&&("top"==r&&(e.columnLinesFor=0),"top"==n&&(e.mainHeaderLevel=0),i[0]=t.top),!t.middle)throw new Error("ViewPreset.headerConfig must be configured with a middle");"middle"==r&&(e.columnLinesFor=i.length),"middle"==n&&(e.mainHeaderLevel=i.length),i.push(t.middle),t.bottom&&(e.mainHeaderLevel=i.length-1,null==r?e.columnLinesFor=i.length-1:"bottom"==r&&(e.columnLinesFor=i.length),null==n&&(e.mainHeaderLevel=i.length-1),"bottom"==n&&(e.mainHeaderLevel=i.length),i.push(t.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const e={},{headers:t}=this,{length:r}=t;switch(r){case 1:e.middle=t[0];break;case 2:0===this.mainHeaderLevel?(e.middle=t[0],e.bottom=t[1]):(e.top=t[0],e.middle=t[1]);break;case 3:e.top=t[0],e.middle=t[1],e.bottom=t[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}set mainHeaderLevel(e){this.data.mainHeaderLevel=e}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:3===this.data.headers.length?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get mainUnit(){return this.mainHeader}get msPerPixel(){const{bottomHeader:e}=this;return Math.round(DateHelper.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}get isValid(){const e=this;let t=!0;for(const r of e.headers)t=t&&Boolean(DateHelper.normalizeUnit(r.unit));return e.timeResolution&&(t=t&&DateHelper.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(t=t&&DateHelper.normalizeUnit(e.shiftUnit)),t}}ViewPreset._$name="ViewPreset";class PresetStore extends(Localizable(Store)){static get defaultConfig(){return{useRawData:!0,modelClass:ViewPreset,zoomOrder:1}}set storage(e){super.storage=e,this.storage.addSorter(((e,t)=>{const r=e.bottomHeader,n=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||unitMagnitudes[r.unit]-unitMagnitudes[n.unit]||r.increment-n.increment)*this.zoomOrder}))}get storage(){return super.storage}createRecord(e){if(e.base){const t=this.getById(e.base)||pm.getById(e.base);Object.setPrototypeOf(e,t.data)}return super.createRecord(...arguments)}updateLocalization(){super.updateLocalization();const e=this;let t=e.allRecords;e.isPresetManager&&(t=new Set(t.concat(Object.values(e.basePresets)))),t.forEach((t=>{let r=e.optionalL(t.id);"string"==typeof r&&t.baseId&&(r=e.optionalL(t.baseId)),r&&"object"==typeof r&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),0===t.mainHeaderLevel&&r.topDateFormat&&(r.middleDateFormat=r.middleDateFormat||r.topDateFormat),t.setData("displayDateFormat",r.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach((e=>{const n=t.headerConfig[e],i=r[e+"DateFormat"];n&&(n.originalDateFormat||(n.originalDateFormat=n.dateFormat),i&&n.renderer&&(n.renderer=null),n.dateFormat=i||n.originalDateFormat)})))}))}}PresetStore._$name="PresetStore";class PresetManager extends PresetStore{static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"llll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Hours",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Hours 2",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer:e=>`\n                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${DateHelper.format(e,"HH")}</span>\n                                    <span class="b-sch-calendarcolumn-minutes">${DateHelper.format(e,"mm")}</span></div>\n                                `}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer:e=>`\n                                    <div class="sch-calendarcolumn-ct">\n                                    <span class="sch-calendarcolumn-hours">${DateHelper.format(e,"HH")}</span>\n                                    <span class="sch-calendarcolumn-minutes">${DateHelper.format(e,"mm")}</span>\n                                    </div>\n                                `}]},dayAndWeek:{name:"Days 2",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer:e=>DateHelper.getShortNameOfUnit("week")+"."+DateHelper.format(e,"WW MMM YYYY")},{unit:"day",dateFormat:"dd DD"}]},weekAndDay:{name:"Days",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks 2",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Weeks 3",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer:(e,t,r)=>DateHelper.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}]},manyYears:{name:"Years 2",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",dateFormat:"YYYY",increment:5},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","weekAndDay",{width:54,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:30,increment:15,resolution:5,preset:"minuteAndHour"},{width:130,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:5,resolution:5,preset:"minuteAndHour"},{width:100,increment:5,resolution:5,preset:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,preset:"secondAndMinute"},{width:130,increment:5,resolution:5,preset:"secondAndMinute"}],listeners:{locale:"updateLocalization"}}}set basePresets(e){const t=this._basePresets={};for(const r in e)e[r].id=r,t[r]=this.createRecord(e[r])}get basePresets(){return this._basePresets}set defaultPresets(e){for(let t=0,{length:r}=e;t<r;t++){const r=e[t],n="string"==typeof r,i=n?r:r.preset;let s;if(n)s=this.basePresets[i];else{const e=Object.setPrototypeOf(ObjectHelper.clone(this.basePresets[i].data),{id:i}),{timeResolution:t}=e,n=e.headers[e.headers.length-1];e.id=void 0,"width"in r&&(e.tickWidth=r.width),"height"in r&&(e.tickHeight=r.height),"increment"in r&&(n.increment=r.increment),"resolution"in r&&(t.increment=r.resolution),"resolutionUnit"in r&&(t.unit=DateHelper.getUnitByName(r.resolutionUnit)),s=this.createRecord(e),s.baseId=i}this.add(s)}}getById(e){return super.getById(e)||this.basePresets[e]}registerPreset(e,t){const r=this.createRecord(Object.assign({id:e},t)),n=this.find((e=>e.equals(r)));if(n)return n;if(!r.isValid)throw new Error("Invalid preset, please check your configuration");return this.add(r),r}getPreset(e){return"number"==typeof e&&(e=this.getAt(e)),"string"==typeof e?e=this.getById(e):e instanceof ViewPreset||(e=this.createRecord(e)),e}normalizePreset(e){const t=this;if(!(e instanceof ViewPreset))if("string"==typeof e){if(!(e=t.getPreset(e)))throw new Error("You must define a valid view preset. See PresetManager for reference")}else if("object"==typeof e){if(e.base){const t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=ObjectHelper.merge(ObjectHelper.clone(t.data),e)}e.id?e=t.createRecord(e):(e=t.createRecord(ObjectHelper.assign({},e))).id=e.generateId(e)}return e}deletePreset(e){"string"==typeof e?e=this.getById(e):"number"==typeof e&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}}const pm=new PresetManager;class TimeAxis extends Store{static get defaultConfig(){return{modelClass:TimeSpan,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,weekStartDay:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,defaultSpan:1,tickCache:{},viewPreset:null}}construct(e){const t=this;if(t.generateTicksValidatorFn=()=>!0,super.construct(e),t.originalContinuous=t.continuous,t.on({change:({action:e})=>{"filter"!==e&&t.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>t.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:e=>t.trigger("reconfigure",e)}),t.startDate)t.internalOnReconfigure(),t.trigger("reconfigure");else if(t.viewPreset){const e=t.getAdjustedDates(new Date);t.startDate=e.startDate,t.endDate=e.endDate}}get isTimeAxis(){return!0}reconfigure(e,t=!1,r=!1){const n=this,i=n.getAdjustedDates(e.startDate,e.endDate);if(!1!==n.trigger("beforeReconfigure",{startDate:i.startDate,endDate:i.endDate,config:e})){if(n.trigger("beginReconfigure"),n._configuredStartDate=e.startDate,n._configuredEndDate=e.endDate,Object.assign(n,e),!1===n.internalOnReconfigure(r))return!1;n.trigger("endReconfigure",{suppressRefresh:t,config:e})}}internalOnReconfigure(e=!1){const t=this;t.isConfigured=!0;const r=t.getAdjustedDates(t.startDate,t.endDate,!0),n=t.getAdjustedDates(t.startDate,t.endDate),i=n.startDate,s=n.endDate;if(i>=s)throw new Error(`Invalid start/end dates. Start date must less than end date. Start date: ${i}. End date: ${s}.`);const o=t.unit,a=t.increment||1,l=t.generateTicks(i,s,o,a);t.suspendEvents(),t.data=l;const{count:c}=t;if(0===c){if(e)return t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.resumeEvents();const d=t.last.endDate;t.isContinuous?(t.adjustedStart=r.startDate,t.adjustedEnd=DateHelper.getNext(c>1?l[c-1].startDate:r.startDate,o,a,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=d);do{t.visibleTickStart=(t.startDate-t.adjustedStart)/(DateHelper.asMilliseconds(o)*a),t.autoAdjust&&(t.visibleTickStart=Math.floor(t.visibleTickStart)),t.visibleTickStart>=1&&(t.adjustedStart=DateHelper.getNext(t.adjustedStart,o,a,t.weekStartDay))}while(t.visibleTickStart>=1);do{t.visibleTickEnd=c-(t.adjustedEnd-d)/(DateHelper.asMilliseconds(o)*a),c-t.visibleTickEnd>=1&&(t.adjustedEnd=DateHelper.getNext(t.adjustedEnd,o,-1,t.weekStartDay))}while(c-t.visibleTickEnd>=1);t.updateTickCache(!0)}get viewPreset(){return this._viewPreset}set viewPreset(e){if(!((e=pm.getPreset(e))instanceof ViewPreset))throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");this._viewPreset=e,Object.assign(this,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}set weekStartDay(e){this._weekStartDay=e}get weekStartDay(){return null==this._weekStartDay?DateHelper.weekStartDay:this._weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this._resolutionUnit}set resolutionUnit(e){this._resolutionUnit=e}get resolutionIncrement(){return this._resolutionIncrement}set resolutionIncrement(e){this._resolutionIncrement=e||1}set mainUnit(e){this._mainUnit=e}get mainUnit(){return this._mainUnit}set shiftUnit(e){this._shiftUnit=e}get shiftUnit(){return this._shiftUnit||this._mainUnit}set shiftIncrement(e){this._shiftIncrement=e}get shiftIncrement(){return this._shiftIncrement||1}set unit(e){this._unit=e}get unit(){return this._unit}set increment(e){this._increment=e}get increment(){return this._increment}get defaultSpan(){return this._defaultSpan}set defaultSpan(e){this._defaultSpan=e}setTimeSpan(e,t,r=!1){const n=this,{startDate:i,endDate:s}=n.getAdjustedDates(e,t);if(n.startDate-i!=0||n.endDate-s!=0)return n.reconfigure({startDate:i,endDate:s},!1,r)}shift(e,t=this.shiftUnit){const r=this;let{startDate:n,endDate:i}=r;r.isFiltered&&(n=r.allRecords[0].startDate,i=r.allRecords[r.allCount-1].endDate);let s=0;do{n=DateHelper.add(n,e,t),i=DateHelper.add(i,e,t)}while(s++<100&&!1===r.setTimeSpan(n,i,!0))}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,t=this){const r=this;r.filters.clear(),super.filterBy(((r,n)=>e.call(t,r.data,n))),0===r.count&&(r.trigger("invalidFilter"),r.clearFilters())}triggerFilterEvent(e){const t=this;e.filters.count?t.continuous=!1:t.continuous=t.originalContinuous,t.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return!1!==this.continuous&&!this.filtered}getAdjustedDates(e,t,r=!1){const n=this;return e=e||n.startDate,t=t||DateHelper.add(e,n.defaultSpan,n.mainUnit),n.autoAdjust||r?{startDate:n.floorDate(e,!1,n.autoAdjust?n.mainUnit:n.unit,1),endDate:n.ceilDate(t,!1,n.autoAdjust?n.mainUnit:n.unit,1)}:{startDate:e,endDate:t}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=DateHelper.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=DateHelper.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,t,r,n){const i=this,s=(t=!1!==t)?DateHelper.clone(i.startDate):null,o=n||i.resolutionIncrement,a=r||(t?i.resolutionUnit:i.mainUnit),l=(e,t)=>Math.floor(e/t)*t;if(t){const t=l(DateHelper.diff(s,e,a),o);return DateHelper.add(s,t,a)}let c=DateHelper.clone(e);if("week"===a){const e=c.getDay()||7,t=i.weekStartDay||7;c=DateHelper.add(DateHelper.startOf(c,"day"),e>=t?t-e:-(7-t+e),"day"),c.getDay()!==t&&23===c.getHours()&&(c=DateHelper.add(c,1,"hour"))}else{c=DateHelper.startOf(c,a);const e=["day","year"].includes(a)?1:0,t="day"===a?"date":a,r=l(DateHelper.get(c,t)-e,o)+e;c=DateHelper.set(c,t,r)}return c}roundDate(e,t){const r=this,n=DateHelper.clone(e),i=r.resolutionIncrement||1;switch(t=DateHelper.clone(t||r.startDate),r.resolutionUnit){case"week":DateHelper.startOf(n,"day");let e,s=n.getDay()-r.weekStartDay;return s<0&&(s=7+s),e=1===Math.round(s/7)?7-s:-s,DateHelper.add(n,e,"day");case"month":const o=DateHelper.diff(t,n,"month")+DateHelper.as("month",n.getDay()/DateHelper.daysInMonth(n)),a=Math.round(o/i)*i;return DateHelper.add(t,a,"month");case"quarter":return DateHelper.startOf(n,"month"),DateHelper.add(n,"month",3-n.getMonth()%3);default:const l=DateHelper.as(r.resolutionUnit,DateHelper.diff(t,n)),c=DateHelper.as(r.resolutionUnit,t.getTimezoneOffset()-n.getTimezoneOffset(),"minute"),d=Math.round((l+c)/i)*i;return DateHelper.add(t,d-c,r.resolutionUnit)}}ceilDate(e,t,r,n){const i=this;t=!1!==t,n=n||(t?this.resolutionIncrement:1);let s=DateHelper.clone(e),o=!1,a=r||(t?i.resolutionUnit:i.mainUnit);switch(a){case"minute":o=!DateHelper.isStartOf(s,"minute");break;case"hour":o=!DateHelper.isStartOf(s,"hour");break;case"day":case"date":o=!DateHelper.isStartOf(s,"day");break;case"week":s=DateHelper.startOf(s,"day"),o=s.getDay()!==i.weekStartDay||!DateHelper.isEqual(s,e);break;case"month":s=DateHelper.startOf(s,"day"),o=1!==s.getDate()||!DateHelper.isEqual(s,e);break;case"quarter":s=DateHelper.startOf(s,"day"),o=s.getMonth()%3!=0||1!==s.getDate()||!DateHelper.isEqual(s,e);break;case"year":s=DateHelper.startOf(s,"day"),o=0!==s.getMonth()||1!==s.getDate()||!DateHelper.isEqual(s,e)}return o?DateHelper.getNext(s,a,n,i.weekStartDay):s}get include(){return this._include}set include(e){const t=this;t._include=e,t.continuous=!e,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure(),t.trigger("includeChange"))}processExclusion(e,t,r){const{include:n}=this;return!!n&&Object.entries(n).some((([n,i])=>{if(!i)return!1;const{from:s,to:o}=i;if(DateHelper.compareUnits("day",r)>=0&&DateHelper.getLargerUnit(n)===r&&(s&&DateHelper.set(e,n,s),o)){let e=r;"day"===r&&(e="date"),DateHelper.set(t,{[e]:DateHelper.get(t,e)-1,[n]:o})}if(DateHelper.compareUnits(n,r)>=0){const t="day"===n?e.getDay():DateHelper.get(e,n);if(s&&t<s||o&&t>=o)return!0}}))}initExclusion(){Object.entries(this.include).forEach((([e,t])=>{if(t){const{from:r,to:n}=t;t.lengthFactor=DateHelper.getUnitToBaseUnitRatio(e,DateHelper.getLargerUnit(e))/(n-r),t.lengthFactorExcl=DateHelper.getUnitToBaseUnitRatio(e,DateHelper.getLargerUnit(e))/(n-r-1),t.center=r+r/(t.lengthFactor-1)}}))}generateTicks(e,t,r=this.unit,n=this.increment){const i=this,s=[],o=Boolean(i.include);let a,l,c,d=0,{startDate:u,endDate:h}=i.getAdjustedDates(e,t);for(i.tickCache={},o&&i.initExclusion();u<h;){if(a=DateHelper.getNext(u,r,n,i.weekStartDay),!i.autoAdjust&&a>h&&(a=h),"hour"===r&&n>1&&s.length>0&&0===d){const e=s[s.length-1];d=(e.startDate.getHours()+n)%24-e.endDate.getHours(),0!==d&&(a=DateHelper.add(a,d,"hour"))}c=!1,o?(l=new Date(a.getTime()),c=i.processExclusion(u,a,r)):l=a,i.generateTicksValidatorFn(u)&&!c&&(s.push({id:s.length+1,startDate:u,endDate:a}),i.tickCache[u.getTime()]=s.length-1),u=l}return s}get visibleTickTimeSpan(){const e=this;return e.isContinuous?e.visibleTickEnd-e.visibleTickStart:e.count}getTickFromDate(e){const t=this,r=t.records,n=e.getTime();let i,s,o,a,l=0,c=r.length-1;if(!r.length||e<r[0].startDate||e>r[c].endDate)return-1;if(t.isContinuous){for(;l<c;)i=l+c+1>>1,n>r[i].endDate.getTime()?l=i+1:n<r[i].startDate.getTime()?c=i-1:l=i;return s=r[l],o=s.startDate.getTime(),n>o&&(a=s.endDate.getTime(),l+=(n-o)/(a-o)),Math.min(Math.max(l,t.visibleTickStart),t.visibleTickEnd)}for(let t=0;t<=c;t++)if(a=r[t].endDate,e<=a)return o=r[t].startDate,s=t+(e>o?(e-o)/(a-o):0),s}getDateFromTick(e,t){const r=this;if(e===r.visibleTickEnd)return r.endDate;const n=Math.floor(e),i=e-n,s=r.getAt(n);if(!s)return null;let o=0===n?r.adjustedStart:s.startDate,a=n===r.count-1&&r.isContinuous?r.adjustedEnd:s.endDate,l=DateHelper.add(o,i*(a-o),"millisecond");return t&&(l=r[t+"Date"](l)),l}get ticks(){return this.records}updateTickCache(e=!1){const t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach(((e,r)=>t.tickCache[e.startDate.getTime()]=r)))}dateInAxis(e,t=!1){const r=this,n=r.startDate,i=r.endDate;if(r.isContinuous)return t?DateHelper.betweenLesserEqual(e,n,i):DateHelper.betweenLesser(e,n,i);{let n,i,s,o=r.getCount();for(let a=0;a<o;a++)if(s=r.getAt(a),n=s.startDate,i=s.endDate,t&&e<=i||!t&&e<i)return e>=n}return!1}timeSpanInAxis(e,t){const r=this;return t&&t.getTime()!==e.getTime()?r.isContinuous?DateHelper.intersectSpans(e,t,r.startDate,r.endDate):e<r.startDate&&t>r.endDate||r.getTickFromDate(e)!==r.getTickFromDate(t):this.dateInAxis(e,!0)}isTimeSpanInAxis(e){const t=this,{startMS:r,endMS:n}=t,{startDateMS:i,endDateMS:s}=e;if(!i||!s)return!1;if(s===i)return t.dateInAxis(e.startDate,!0);if(t.isContinuous)return s>r&&i<n;const o=t.getTickFromDate(e.startDate),a=t.getTickFromDate(e.endDate);return!(o===t.count&&DateHelper.isEqual(e.startDate,t.last.endDate)||0===a&&DateHelper.isEqual(e.endDate,t.first.startDate))&&(i<r&&s>n||o!==a)}forEachAuxInterval(e,t=1,r,n=this){let i,s=this.endDate,o=this.startDate,a=0;if(o>s)throw new Error("Invalid time axis configuration");for(;o<s;)i=DateHelper.min(DateHelper.getNext(o,e,t,this.weekStartDay),s),r.call(n,o,i,a),o=i,a++}}TimeAxis._$name="TimeAxis";class ColumnLines extends InstancePlugin{static get $name(){return"ColumnLines"}static get pluginConfig(){return{after:["render","updateCanvasSize"]}}construct(e,t){e.useBackgroundCanvas=!0,e.on({visibleRangeChange:"onRangeChange",thisObj:this}),super.construct(e,t)}doDisable(e){super.doDisable(e),this.isConfiguring||this.refresh()}render(){this.refresh()}refresh(){const e=this,{client:t}=e,{timeAxis:r,timeAxisViewModel:n,isHorizontal:i}=t;if(!r.startDate||!e.startDate)return;const s=n.columnLinesFor,o=Math.max(s-1,0),a=e.startDate.getTime(),l=e.endDate.getTime(),c=[],d=new Set;if(e.element||(e.element=DomHelper.createElement({parent:t.backgroundCanvas,className:"b-column-lines-canvas"})),!e.disabled){const e=(e,t)=>{const r=e.end.getTime();r>a&&r<l&&!d.has(r)&&(d.add(r),c.push({className:t?"b-column-line-major":"b-column-line",style:{[i?"left":"top"]:e.coord+e.width-1},dataset:{line:t?"major-"+e.index:"line-"+e.index}}))};s!==o&&n.columnConfig[o].forEach((t=>e(t,!0))),n.columnConfig[s].forEach((t=>e(t,!1)))}DomSync.sync({targetElement:e.element,onlyChildren:!0,domConfig:{children:c,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}onRangeChange({startDate:e,endDate:t}){this.startDate=e,this.endDate=t,this.refresh()}updateCanvasSize(){this.refresh()}}ColumnLines._$name="ColumnLines",GridFeatureManager.registerFeature(ColumnLines,!0,["Scheduler","Gantt"]);var DependencyCreation=e=>class extends(e||Base){static get $name(){return"DependencyCreation"}static get defaultConfig(){return{showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["left","top","right","bottom"],allowCreate:!0}}construct(e,t){super.construct(e,t);const r=this;r.view=e,r.eventName=e.scheduledEventName,e.on("readOnly",(()=>r.updateCreateListeners())),r.updateCreateListeners()}doDestroy(){var e,t;const r=this;r.detachListeners("view"),r.creationData=null,null===(e=r.mouseDetacher)||void 0===e||e.call(r),null===(t=r.creationTooltip)||void 0===t||t.destroy(),super.doDestroy()}updateCreateListeners(){const e=this;e.view&&(e.detachListeners("view"),e.isCreateAllowed&&e.view.on({name:"view",[e.eventName+"mouseenter"]:"onTimeSpanMouseEnter",[e.eventName+"mouseleave"]:"onTimeSpanMouseLeave",thisObj:e}))}set allowCreate(e){this._allowCreate=e,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.view.readOnly&&!this.disabled}get listenersTarget(){return document.body}onTimeSpanMouseEnter(e){const t=e[this.eventName+"Record"],r=e[this.eventName+"Element"];this.showTerminals(t,DomHelper.down(r,e.source.eventInnerSelector))}onTimeSpanMouseLeave(e){const t=this,r=e[t.eventName+"Element"];t.creationData&&DomHelper.isDescendant(r,t.creationData.sourceTerminal.parentElement)||t.hideTerminals(r)}onTerminalMouseOut(e){const t=this,r=DomHelper.up(e.target,t.view.eventSelector);!r||DomHelper.isDescendant(r,t.showingTerminalsFor)||t.creationData&&r===t.creationData.sourceTerminal.parentElement||(t.hideTerminals(r),t.view.unhover(e))}onTerminalMouseDown(e){const t=this;if(0===e.button&&!t.creationData){var r;const n=t.view,i=n.timeAxisSubGridElement,s=e.target,o=s.parentElement.closest(n.eventSelector),a=Rectangle.from(n.element,document.body);e.preventDefault(),e.stopPropagation(),t.creationData={source:n.resolveTimeSpanRecord(o),sourceTerminal:s,startPoint:Rectangle.from(s,i).center,startX:e.pageX-a.x+n.scrollLeft,startY:e.pageY-a.y+n.scrollTop,valid:!1,sourceResource:null===(r=n.resolveResourceRecord)||void 0===r?void 0:r.call(n,o)},t.mouseDetacher=EventHelper.on({mouseup:{element:t.listenersTarget,handler:"onMouseUp"},mousemove:{element:i,handler:"onMouseMove"},thisObj:t})}}onMouseMove(e){const t=this,{view:r,creationData:n}=t,i=Rectangle.from(r.element,document.body),s=e.pageX-i.x+r.scrollLeft-n.startX,o=e.pageY-i.y+r.scrollTop-n.startY,a=Math.round(Math.sqrt(s*s+o*o))-3,l=Math.atan2(o,s);let{connector:c}=t;if(!c){if(!1===t.onRequestDragCreate())return;c=t.connector}c.style.width=a+"px",c.style.transform=`rotate(${l}rad)`,t.lastMouseMoveEvent=e}onRequestDragCreate(){const e=this,{view:t,creationData:r}=e;if(!1===t.trigger("beforeDependencyCreateDrag",{data:r}))return e.abort(),!1;t.element.classList.add("b-creating-dependency"),e.connector=e.createConnector(r.startPoint.x,r.startPoint.y),t.trigger("dependencyCreateDragStart",{data:r}),e.showCreationTooltip&&(e.creationTooltip=e.creationTooltip||e.createDragTooltip(),e.creationTooltip.disabled=!1,e.creationTooltip.show()),t.scrollManager.startMonitoring({element:t.timeAxisSubGridElement,callback:()=>e.lastMouseMoveEvent&&e.onMouseMove(e.lastMouseMoveEvent),thisObj:e})}onOverTargetTerminal(e){const t=this,{target:r}=e,{view:n,creationData:i}=t,{connector:s}=t;if(!ObjectHelper.isPromise(i.valid))if(r!==i.sourceTerminal){if(r!==i.targetTerminal){i.targetTerminal=r,i.target=n.resolveTimeSpanRecord(r),n.resolveResourceRecord&&(i.targetResource=n.resolveResourceRecord(r));const e=i.sourceTerminal.dataset.side,o=i.targetTerminal.dataset.side,a=e=>{t.isDestroyed||(i.valid=e,r.classList.add(e?"b-valid":"b-invalid"),s.classList.add(e?"b-valid":"b-invalid"),n.trigger("dependencyValidationComplete",{data:i}))};let l;switch(!0){case"left"===e&&"left"===o:l=DependencyBaseModel.Type.StartToStart;break;case"left"===e&&"right"===o:l=DependencyBaseModel.Type.StartToEnd;break;case"right"===e&&"left"===o:l=DependencyBaseModel.Type.EndToStart;break;case"right"===e&&"right"===o:l=DependencyBaseModel.Type.EndToEnd}n.trigger("dependencyValidationStart",{data:i}),i.valid=t.dependencyStore.isValidDependency(i.source,i.target,l),ObjectHelper.isPromise(i.valid)?i.valid.then(a):a(i.valid)}}else s.classList.remove("b-valid"),s.classList.remove("b-invalid")}onMouseUp(e){const t=this,r=t.creationData,n=e.target;t.abort();const i=async()=>{r.targetTerminal=e.target;const n=t.createDependency(r);ObjectHelper.isPromise(n)&&await n,t.view.trigger("dependencyCreateDrop",{data:r})},s=e=>{t.view.trigger("afterDependencyCreateDrop",{data:e})};r.valid&&n.matches("."+t.terminalCls)?ObjectHelper.isPromise(r.valid)?r.valid.then((e=>{r.valid=e,e?i().then((()=>s(r))):s(r)})):i().then((()=>s(r))):(r.valid=!1,s(r))}abort(){var e;const t=this,{view:r,creationData:n}=t;if(n){const{source:e,sourceResource:i,target:s,targetResource:o}=n;if(e){const n=r.getElementFromEventRecord(e,i);n&&t.hideTerminals(n)}if(s){const e=r.getElementFromEventRecord(s,o);e&&t.hideTerminals(e)}}t.creationTooltip&&(t.creationTooltip.disabled=!0),t.creationData=t.lastMouseMoveEvent=null,null===(e=t.mouseDetacher)||void 0===e||e.call(t),t.removeConnector()}createConnector(e,t){const r=this,n=r.view;return r.connector=DomHelper.createElement({parent:n.timeAxisSubGridElement,className:r.baseCls+"-connector",style:`left:${e}px;top:${t}px`}),n.element.classList.add("b-creating-dependency"),r.connector}createDragTooltip(){const e=this,t=e.view;return e.creationTooltip=new Tooltip(Object.assign({id:t.id+"-dependency-drag-tip",cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",autoShow:!0,anchorToTarget:!1,forSelector:".b-sch-terminal",forElement:t.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,getHtml:({tip:t,event:r})=>{if(e.creationData)return r&&e.onOverTargetTerminal(r),e.generateTooltipContent(t,e.creationData)},header:{dock:"right"},listeners:{pointerout:({source:t})=>{const r=e.creationData;return r.target=r.targetTerminal=null,r.valid=!1,t.html=t.getHtml({tip:t}),!1},beforeShow:({source:e})=>{e.html=e.getHtml({tip:e})}}},e.creationTooltip||{}))}removeConnector(e){const t=this,{connector:r,view:n}=t;r&&(r.classList.add("b-removing"),r.style.width="0",t.setTimeout((()=>{r.remove(),t.connector=null,e&&e.call(t)}),200)),n.element.classList.remove("b-creating-dependency"),t.creationTooltip&&t.creationTooltip.hide(),n.scrollManager.stopMonitoring(n.timeAxisSubGridElement)}showTerminals(e,t){const r=this;if(!r.isCreateAllowed)return;const n=r.terminalCls,i=n+"s-visible";(t=DomHelper.down(t,r.view.eventInnerSelector)).classList.contains(i)||this.view.element.classList.contains("b-resizing-event")||r.view.readOnly||(r.terminalSides.forEach((e=>{const i=DomHelper.createElement({parent:t,className:`${n} ${n}-${e}`,dataset:{side:e,feature:!0}});i.detacher=EventHelper.on({element:i,mouseout:"onTerminalMouseOut",mousedown:{handler:"onTerminalMouseDown",capture:!0},thisObj:r})})),t.classList.add(i),e.cls.add(i),r.showingTerminalsFor=t)}hideTerminals(e){const t=this,r=t.client.getTimeSpanMouseEventParams(e),n=null==r?void 0:r[t.eventName+"Record"],i=t.terminalCls+"s-visible";DomHelper.forEachSelector(e,"."+t.terminalCls,(e=>{e.detacher&&e.detacher(),e.remove()})),DomHelper.down(e,t.view.eventInnerSelector).classList.remove(i),n.cls.remove(i),t.showingTerminalsFor=null}createDependency(e){const{source:t,target:r}=e,n=e.sourceTerminal.dataset.side,i=e.targetTerminal.dataset.side,s=("left"===n?0:2)+("right"===i?1:0);return this.dependencyStore.add({from:t.id,to:r.id,type:s,fromSide:n,toSide:i})[0]}generateTooltipContent(e,t){var r,n,i,s;const o=this,{valid:a}=t,{classList:l}=e.element;let c,d;return Object.assign(t,{fromText:t.source.name,toText:null!==(r=null===(n=t.target)||void 0===n?void 0:n.name)&&void 0!==r?r:"",fromSide:t.sourceTerminal.dataset.side,toSide:null!==(i=null===(s=t.targetTerminal)||void 0===s?void 0:s.dataset.side)&&void 0!==i?i:""}),ObjectHelper.isPromise(a)?(l.remove("b-invalid"),l.add("b-checking"),new Promise((r=>a.then((n=>{t.valid=n,e.isDestroyed||r(o.generateTooltipContent(e,t))}))))):(!0===a?(l.remove("b-invalid"),l.remove("b-checking"),c="valid",d=o.L("L{Dependencies.valid}")):(l.remove("b-checking"),l.add("b-invalid"),c="invalid",d=o.L("L{Dependencies.invalid}")),e.title=`<i class="b-icon b-icon-${c}"></i>${d}`,`<table class="b-sch-dependency-creation-tooltip">\n                        <tr><td>${o.L("L{Dependencies.from}")}: </td><td>${t.fromText}</td><td><div class="b-sch-box b-${t.fromSide}"></div></td></tr>\n                        <tr><td>${o.L("L{Dependencies.to}")}: </td><td>${t.toText}</td><td><div class="b-sch-box b-${t.toSide}"></div></td></tr>\n                    </table>`)}};class TimeSpanMenuBase extends ContextMenuBase{get menuConfig(){return ObjectHelper.assign({},super.menuConfig,{clippedBy:[this.client.timeAxisSubGridElement,this.client.bodyContainer]})}}TimeSpanMenuBase._$name="TimeSpanMenuBase";class EventMenu extends TimeSpanMenuBase{static get $name(){return"EventMenu"}static get defaultConfig(){return{type:"event"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateEventMenu"),e}onElementKeyDown(e){!e.handled&&e.target.matches(this.client.eventSelector)&&" "===e.key&&this.internalShowContextMenu(this.createContextMenuEventForElement(e.target))}getDataFromEvent(e){const t=super.getDataFromEvent(e),r=t.targetElement,{client:n}=this,i=n.resolveEventRecord(r),s=i&&(n.resolveResourceRecord(r)||n.resourceStore.last),o=i&&n.resolveAssignmentRecord(r);return ObjectHelper.assign(t,{eventElement:r,eventRecord:i,resourceRecord:s,assignmentRecord:o})}getTargetElementFromEvent({target:e}){return DomHelper.up(e,this.client.eventSelector)||e}shouldShowMenu(e){return e.eventRecord}showContextMenuFor(e,{targetElement:t,event:r}={}){this.disabled||(t||(t=this.getElementFromRecord(e)))&&(r=r||this.createContextMenuEventForElement(t),this.internalShowContextMenu(r))}getElementFromRecord(e){return this.client.getElementsFromEventRecord(e)[0]}populateEventMenu({items:e}){const{client:t}=this;t.readOnly||(e.deleteEvent={text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",weight:200,onItem({menu:e,eventRecord:r}){var n;const i=null===(n=e.focusInEvent)||void 0===n?void 0:n.relatedTarget;i&&(i.focus(),t.navigator.activeItem=i),t.removeRecords([r])}},t.eventStore.usesSingleAssignment||(e.unassignEvent={text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,name:"unassignEvent",onItem({menu:e,eventRecord:r,resourceRecord:n}){var i;const s=null===(i=e.focusInEvent)||void 0===i?void 0:i.relatedTarget;s&&(s.focus(),t.navigator.activeItem=s),r.unassign(n)}}))}}EventMenu.featureClass="",EventMenu._$name="EventMenu",GridFeatureManager.registerFeature(EventMenu,!0,"Scheduler");class EventContextMenu extends EventMenu{static get $name(){return"EventContextMenu"}construct(e,t){super.construct(...arguments),this.scheduler=e,VersionHelper.deprecate("Scheduler","5.0.0","`EventContextMenu` feature is deprecated, in favor of `EventMenu` feature. Please see https://bryntum.com/docs/scheduler/#guides/upgrades/3.1.0.md for more information."),e.features.eventMenu&&(e.features.eventMenu.disabled=!0)}}EventContextMenu.featureClass="",EventContextMenu._$name="EventContextMenu",GridFeatureManager.registerFeature(EventContextMenu);class ClockTemplate extends Base{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(e){return`<div class="b-sch-clockwrap b-sch-clock-${e.mode||this.mode} ${e.cls||""}">\n                    <div class="b-sch-clock">\n                        <div class="b-sch-hour-indicator">${DateHelper.format(e.date,"MMM")}</div>\n                        <div class="b-sch-minute-indicator">${DateHelper.format(e.date,"D")}</div>\n                        <div class="b-sch-clock-dot"></div>\n                    </div>\n                    <span class="b-sch-clock-text">${e.text}</span>\n                </div>`}}}generateContent(e){const t=this,r=e.date,n=t.template(e),i=t.div;return i.innerHTML=n,t.updateDateIndicator(i,r),i.innerHTML}updateDateIndicator(e,t){const r=e.querySelector(".b-sch-hour-indicator"),n=e.querySelector(".b-sch-minute-indicator");t&&r&&n&&("hour"===this.mode?(r.style.transform=`rotate(${t.getHours()%12*30}deg)`,n.style.transform=`rotate(${6*t.getMinutes()}deg)`):(r.style.transform="none",n.style.transform="none"))}set mode(e){this._mode=e}get mode(){if(this._mode)return this._mode;const e=DateHelper.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,t=DateHelper.formatContainsHourInfo(this.scheduler.displayDateFormat);return e&&t?"hour":"day"}set template(e){this._template=e}get template(){return this._template}}ClockTemplate._$name="ClockTemplate";class DragBase extends InstancePlugin{static get defaultConfig(){return{dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,constrainDragToResource:!0,showTooltip:!0,showExactDropPosition:!1,constrainDragToTimeline:!0,store:null,dragHelperConfig:null,tooltipCls:null}}static get pluginConfig(){return{chain:["render"]}}render(){var e;const t=this,{client:r,constrainDragToTimeline:n}=t;null===(e=t.drag)||void 0===e||e.destroy(),t.drag=new DragHelper(Object.assign({name:t.constructor.name,mode:"translateXY",[r.isHorizontal?"lockY":"lockX"]:t.constrainDragToResource,[r.isHorizontal?"lockX":"lockY"]:t.constrainDragToTimeSlot,minX:!0,maxX:!0,constrain:!1,cloneTarget:!n,dragWithin:n?null:document.body,hideOriginalElement:!0,outerElement:r.timeAxisSubGridElement,targetSelector:r.eventSelector,isElementDraggable:(e,n)=>!r.readOnly&&(!t.dragHelperConfig||!t.dragHelperConfig.isElementDraggable||t.dragHelperConfig.isElementDraggable(e,n))&&t.isElementDraggable(e,n),scrollManager:n?r.scrollManager:null,transitionDuration:r.transitionDuration,listeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",reset:"onDragReset",thisObj:t}},t.dragHelperConfig)),r.rowManager.on({changeTotalHeight:"updateYConstraint",thisObj:t}),t.showTooltip&&(t.clockTemplate=new ClockTemplate({scheduler:r}))}doDestroy(){var e,t,r;null===(e=this.drag)||void 0===e||e.destroy(),null===(t=this.clockTemplate)||void 0===t||t.destroy(),null===(r=this.tip)||void 0===r||r.destroy(),super.doDestroy()}onBeforeDragStart({context:e}){const t=this,{client:r}=t,n=r.scheduledEventName,i=r.resolveEventRecord(e.element);if(t.disabled||!i||!1===i.isDraggable)return!1;e.pointerStartDate=r.getDateFromXY([e.startClientX,e.startPageY],null,!1);const s=!1!==r.trigger(`before${n}Drag`,{eventRecord:i,context:t.dragData});return!1!==s&&t.updateYConstraint(i),s}set constrainDragToTimeSlot(e){const t=this.client.isHorizontal?"lockX":"lockY";this._constrainDragToTimeSlot=e,this.drag&&(this.drag[t]=e)}get constrainDragToTimeSlot(){return this._constrainDragToTimeSlot}set constrainDragToResource(e){const t=this.client.isHorizontal?"lockY":"lockX";this._constrainDragToResource=e,this.drag&&(this.drag[t]=e)}get constrainDragToResource(){return this._constrainDragToResource}onDragStart({context:e,event:t}){const r=this,{client:n}=r;r.currentOverClient=n,r.scrollClients={},r.onMouseOverNewTimeline(n);const i=r.dragData=r.getDragData(e,t);if(e.element.retainElement=!0,r.showTooltip){const t=i.context.dragProxy?i.context.dragProxy.firstChild:e.element;r.tip?r.tip.showBy(t):(r.tip=new Tooltip({id:n.id+"-event-drag-tip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,clippedBy:r.constrainDragToTimeline?[n.timeAxisSubGridElement,n.bodyContainer]:null,forElement:t,getHtml:r.getTipHtml.bind(r),style:"pointer-events:none",cls:r.tooltipCls}),r.tip.on("innerhtmlupdate",r.updateDateIndicator,r))}r.triggerDragStart(i)}updateDateIndicator(){const{startDate:e,endDate:t}=this.dragData,{tip:r}=this,n=r.element.querySelector(".b-sch-tooltip-enddate");this.clockTemplate.updateDateIndicator(r.element,e),n&&this.clockTemplate.updateDateIndicator(n,t)}onDrag({context:e,event:t}){const r=this,n=r.dragData,i=n.startDate;let s;if(r.constrainDragToTimeline)s=r.client;else{let e=t.target;if(/^touch/.test(t.type)){const t=Rectangle.from(n.context.element,null,!0).center;e=DomHelper.elementFromPoint(t.x,t.y)}s=Widget.fromElement(e,"timelinebase")}const o=r.client.features.dependencies,a=e.newX,l=e.newY;if(!s)return void(o&&o.updateDependenciesForTimeSpan(n.draggedEntities[0],n.context.element));if(s!==r.currentOverClient&&r.onMouseOverNewTimeline(s),r.updateDragContext(e,t),r.constrainDragToTimeline&&!r.constrainDragToTimeSlot&&(r.showExactDropPosition||r.client.timeAxisViewModel.snap)){const t=s.getDateFromCoordinate(r.getCoordinate(n.draggedEntities[0],e.element,[a,l]))-n.sourceDate,i=new Date(n.origStart-0+t),o=s.timeAxisViewModel.getDistanceBetweenDates(i,n.startDate);n.startDate>=s.timeAxis.startDate&&null!=o&&(r.client.isVertical?DomHelper.addTranslateY(e.element,o):DomHelper.addTranslateX(e.element,o))}r.triggerEventDrag(n,i);let c=r.checkDragValidity(n,t);c&&"boolean"!=typeof c&&(e.message=c.message||"",c=c.valid),e.valid=!1!==c,r.showTooltip&&r.tip.realign(),o&&o.updateDependenciesForTimeSpan(n.draggedEntities[0],n.context.element.querySelector(s.eventInnerSelector),n.newResource)}onMouseOverNewTimeline(e){const t=this,r=t.scrollClients||{};if(t.currentOverClient.element.classList.remove("b-dragging-"+t.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),!(e.id in r)){e.scrollManager.startMonitoring({element:e.timeAxisSubGridElement}),r[e.id]=e}t.currentOverClient=e}onDrop({context:e,event:t}){var r;const n=this,{currentOverClient:i,dragData:s}=n;let o=!1;n.updateDragContext(e,t),null===(r=n.tip)||void 0===r||r.hide(),e.valid&&s.startDate&&s.endDate&&(s.finalize=(...t)=>{n.finalize(...t),e.finalize(...t)},i.trigger(`before${i.capitalizedEventName}DropFinalize`,{context:s,event:t}),e.async=s.async,!e.async&&n.isValidDrop(s)&&(o=s.startDate-s.origStart!=0||s.newResource!==s.resourceRecord)),e.async||n.finalize(s.valid&&e.valid&&o)}onDragAbort({context:e}){var t;const r=this;r.client.currentOrientation.onDragAbort({context:e,dragData:r.dragData}),r.resumeElementRedrawing(r.dragData.record),null===(t=r.tip)||void 0===t||t.hide(),r.triggerDragAbort(r.dragData)}onDragReset({source:e}){var t,r;const n=this,i=n.scrollClients||{};for(const e in i)i[e].scrollManager.stopMonitoring(i[e].timeAxisSubGridElement);if(e.context&&e.context.started){const{eventBarEls:e}=n.dragData;e[0].classList.remove("b-drag-main")}n.scrollClients=null,null===(t=n.currentOverClient)||void 0===t||t.element.classList.remove("b-dragging-"+n.currentOverClient.scheduledEventName),!1===(null===(r=n.dragData)||void 0===r?void 0:r.context.valid)&&n.currentOverClient.features.dependencies&&n.currentOverClient.features.dependencies.scheduleDraw(!0)}onInternalInvalidDrop(){var e;null===(e=this.tip)||void 0===e||e.hide(),this.drag.abort(),this.triggerAfterDrop(this.dragData,!1)}async finalize(e){const t=this,{dragData:r}=t,{context:n,draggedEntities:i}=r;let s;return i.forEach(((e,n)=>{t.resumeElementRedrawing(e),r.eventBarEls[n].classList.remove(t.drag.draggingCls),r.eventBarEls[n].retainElement=!1})),e?(s=t.updateRecords(r),ObjectHelper.isPromise(s)&&(n.async=!0,await s),r.valid?(t.drag.reset(),t.triggerAfterDrop(r,!0)):t.onInternalInvalidDrop()):t.onInternalInvalidDrop(),s}updateDragContext(e,t){const r=this,{drag:n}=r,i=r.dragData,s=r.currentOverClient,{isHorizontal:o}=s,a=e.element,l=Rectangle.from(a,s.timeAxisSubGridElement),c=i.draggedEntities[0],d=c.isAssignment?c.event:c,u=r.constrainDragToTimeSlot||(o?n.lockX:n.lockY);if(i.browserEvent=t,u)i.timeDiff=0;else{if(s.timeAxis.isContinuous){const{dateConstraints:t}=i,{timeAxisSubGrid:n}=s,{scrollable:o}=n,a=o.viewport,l=s.isHorizontal?e.pageX-a.x+o.x:e.pageY-a.y+o.y,c=s.timeAxisViewModel.getDateFromPosition(l,null,!0),u=i.timeDiff=c-e.pointerStartDate;i.startDate=r.adjustStartDate(i.origStart,u),t&&(i.startDate=DateHelper.constrain(i.startDate,t.start,new Date(t.end-d.durationMS))),i.endDate=new Date(i.startDate-0+i.duration)}else{const e=r.resolveStartEndDates(l);i.valid=Boolean(e.startDate&&e.endDate),i.valid&&(i.startDate=e.startDate,i.endDate=e.endDate)}i.valid&&(i.timeDiff=i.startDate-i.origStart)}if(Object.assign(i,r.getProductDragContext(i)),i.valid)if(i.endDate<=s.timeAxis.startDate||i.startDate>=s.timeAxis.endDate)i.context.valid=!1,i.context.message=r.L("L{EventDrag.noDropOutsideTimeline}");else{const e=!t||r.checkDragValidity(i,t);e&&"boolean"!=typeof e?(i.context.valid=!1!==e.valid,i.context.message=e.message):(i.context.valid=!1!==e,i.context.message="")}else i.context.valid=!1}suspendElementRedrawing(e,t=!0){const r=this.getRecordElement(e);r&&(r.retainElement=t),e.instanceMeta(this.client).retainElement=t}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e,t){const r=this,{client:n,drag:i}=r,{record:s,dateConstraints:o,eventBarEls:a,draggedEntities:l}=r.setupProductDragData(e),c=s.isAssignment?s.event:s,d=c.startDate,u=c.endDate,h=n.timeAxis,g=d<h.startDate,m=u>h.endDate,p=r.getCoordinate(c,e.element,[e.elementStartX,e.elementStartY]),f=r.getCoordinate(c,e.element,[e.startClientX,e.startClientY]);l.forEach((e=>r.suspendElementRedrawing(e))),i.startEvent.ctrlKey&&(s.isAssignment?n.selectAssignment(s,!0):n.selectEvent(s,!0));const v={context:e,dateConstraints:o,eventBarEls:a,record:s,draggedEntities:l,sourceDate:g?d:n.getDateFromCoordinate(p),screenSourceDate:n.getDateFromCoordinate(f,null,!1),origStart:d,origEnd:u,startDate:d,endDate:u,timeDiff:0,startsOutsideView:g,endsOutsideView:m,duration:u-d,browserEvent:t};if(a.forEach((e=>{e.classList.add(i.draggingCls),e.classList.remove("b-sch-event-hover"),e.classList.remove("b-active")})),a.length>1)if(r.constrainDragToTimeline?e.relatedElements=a.slice(1):e.relatedElements=a.slice(1).map((e=>{const t=DomHelper.getOffsetX(e,i.dragWithin),r=DomHelper.getOffsetY(e,i.dragWithin),n=e.offsetWidth,s=e.offsetHeight,o=i.createProxy(e);return DomHelper.setTranslateXY(o,t,r),o.style.width=n+"px",o.style.height=s+"px",i.dragWithin.appendChild(o),e.classList.add("b-drag-original"),i.hideOriginalElement&&e.classList.add("b-hidden"),o})),e.relatedElStartPos=[],e.relatedElDragFromPos=[],r.unifiedDrag){r.client.isAnimating=!0,EventHelper.on({element:a[1],transitionend(){r.client.isAnimating=!1},once:!0}),a[0].classList.add("b-drag-main");let[t,n]=DomHelper.getTranslateXY(e.element);e.relatedElements.forEach(((r,i)=>{e.relatedElStartPos[i]=DomHelper.getTranslateXY(r),t+=10,n+=10,DomHelper.setTranslateXY(r,t,n),e.relatedElDragFromPos[i]=[t,n]}))}else e.relatedElements.forEach(((t,r)=>{e.relatedElStartPos[r]=e.relatedElDragFromPos[r]=DomHelper.getTranslateXY(t)}));return v}getRelatedRecords(e){return[]}setupConstraints(e,t,r,n){const i=this,s=!i.showExactDropPosition&&r>1?r:0;n?i.setXConstraint(e.left,e.right-t.width,s):i.setXConstraint(!0,!0,s),i.setYConstraint(e.top,e.bottom-t.height,0)}updateYConstraint(e){const t=this,{client:r}=t,{context:n}=t.drag,i=r.timeAxisViewModel.snapPixelAmount;if(n&&!t.drag.lockY){let s;if(!t.constrainDragToTimeline)return void t.setYConstraint(null,null,i);s=r.getScheduleRegion(null,e),t.setYConstraint(s.top,s.bottom-n.element.offsetHeight,i)}else t.setYConstraint(null,null,i)}setXConstraint(e,t,r){const{drag:n}=this;n.leftConstraint=e,n.rightConstraint=t,n.minX=e,n.maxX=t}setYConstraint(e,t,r){const{drag:n}=this;n.topConstraint=e,n.bottomConstraint=t,n.minY=e,n.maxY=t}adjustStartDate(e,t){return this.client.timeAxis.roundDate(new Date(e-0+t),!!this.client.snapRelativeToEventStartDate&&e)}resolveStartEndDates(e){const{start:t,end:r}=this.client.getStartEndDatesFromRectangle(e,"round",this.dragData.duration);return{startDate:t,endDate:r}}getTipHtml(){const e=this,{dragData:t,client:r}=e,{startDate:n,endDate:i,draggedEntities:s}=t,o=r.getFormattedDate(n),a=r.getFormattedEndDate(i,n),{valid:l,message:c}=t.context,d=s[0],u=d.isTask?d:d.event;return e.dragTipTemplate({valid:l,startDate:n,endDate:i,startText:o,endText:a,dragData:t,message:c||"",[r.scheduledEventName+"Record"]:u,startClockHtml:e.clockTemplate.template({date:n,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:u.isMilestone?"":e.clockTemplate.template({date:i,text:a,cls:"b-sch-tooltip-enddate"})})}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,t){throw new Error("Implement in subclass")}getCoordinate(e,t,r){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}getRecordElement(e){throw new Error("Implement in subclass")}}DragBase._$name="DragBase";class EventDrag extends DragBase{static get $name(){return"EventDrag"}static get defaultConfig(){return{constrainDragToResource:!1,constrainDragToTimeSlot:!1,validatorFn:()=>{},validatorFnThisObj:null,unifiedDrag:null}}get scheduler(){return this.client}isElementDraggable(e,t){const{scheduler:r}=this,n=DomHelper.up(e,r.eventSelector),{eventResize:i}=r.features;if(!n||this.disabled)return!1;if(e.matches('[class$="-handle"]'))return!1;const s=r.resolveEventRecord(n);return!(i&&s.resizable&&!s.isMilestone&&i.resize.overAnyHandle(t,n))}getTriggerParams(e){const{assignmentRecords:t,eventRecords:r}=e;return{context:e,draggedRecords:r,eventRecords:r,assignmentRecords:t}}triggerEventDrag(e,t){e.startDate-t==0&&e.newResource===e.resourceRecord||this.scheduler.trigger("eventDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate,newResource:e.newResource}))}triggerDragStart(e){this.scheduler.trigger("eventDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.scheduler.trigger("eventDragAbort",this.getTriggerParams(e))}triggerAfterDrop(e,t){this.currentOverClient.trigger("afterEventDrop",Object.assign(this.getTriggerParams(e),{valid:t}))}onDragStart({context:e,event:t}){const{eventMenu:r,eventContextMenu:n}=this.client.features,i=r&&!r.disabled?r:n;super.onDragStart({context:e,event:t}),null==i||i.hideContextMenu(!1)}isValidDrop(e){const{newResource:t,resourceRecord:r}=e,n=e.draggedEntities[0];return!(!t||t.isSpecialRow)&&(r===t||!n.event.resources.includes(t))}checkDragValidity(e,t){const r=this,n=r.currentOverClient;let i=r.dragData.context.valid;return i&&(i=n.allowOverlap||n.isDateRangeAvailable(e.startDate,e.endDate,e.draggedEntities[0],e.newResource)?r.validatorFn.call(r.validatorFnThisObj||r,e,t):{valid:!1,message:r.L("L{eventOverlapsExisting}")}),i}async updateRecords(e){const t=this,r=t.scheduler,n=t.currentOverClient;r.eventStore.suspendAutoCommit(),n.eventStore.suspendAutoCommit();const i=await t.updateAssignments(r,n,e,false);return r.eventStore.resumeAutoCommit(),n.eventStore.resumeAutoCommit(),n.trigger("eventDrop",Object.assign(t.getTriggerParams(e),{isCopy:false,event:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource})),i}async updateAssignments(e,t,r,n){var i;const s=this,o=e!==t,a="vertical"===t.mode,{assignmentStore:l,eventStore:c,resourceStore:d}=e,{assignmentStore:u,eventStore:h}=t,{eventRecords:g,assignmentRecords:m,timeDiff:p,resourceRecord:f,newResource:v}=r,y=s.unifiedDrag||o&&m.length>1,b=s.constrainDragToResource?0:d.indexOf(f)-d.indexOf(v),C=s.adjustStartDate(m[0].event.startDate,p),D=[],S=[],E=[],w=[],x=[],R=new Set,T=new Set;e.suspendRefresh(),t.suspendRefresh();let M=!1,P=!1;a&&g.forEach(((t,n)=>{const i=r.eventBarEls[n];delete t.instanceMeta(e).hasTemporaryDragElement,i.dataset.transient&&i.remove()}));for(let i=0;i<m.length;i++){let a=m[i],c=a.event;const g=r.eventBarEls[i],f=c,A=f.startDate,F=a.resource,k=this.constrainDragToTimeSlot?A:y?C:s.adjustStartDate(A,p),O=t.isInTimeAxis(f);if(R.add(F),g.querySelector(e.eventInnerSelector).classList.add(e.committingCls),n)a=a.copy(null),E.push(a);else if(l!==u){const e=f.assignments.length>1,t=a.copy();if(w.push(a),e||S.push(f),!h.getById(f.id)){const e=Object.assign({},f.data,{id:f.id,calendar:null});c=e,D.push(e)}h.usesSingleAssignment||E.push(t),a=t}let H=y||o?v:F;if(!y&&!o&&0!==b){const e=Math.max(Math.min(d.indexOf(F)-b,d.count-1),0);H=d.getAt(e)}if(R.add(H),!s.constrainDragToTimeline&&(DomSync.removeChild(e.foregroundCanvas,g),t.rowManager.getRowFor(H)&&O)){const e=0===i?r.context.element:r.context.relatedElements[i-1],n=Rectangle.from(e,t.foregroundCanvas,!0);DomHelper.setTranslateXY(e,n.x,n.y),e.classList.remove("b-sch-event-hover"),e.classList.remove("b-active"),e.classList.remove("b-drag-proxy"),e.classList.remove("b-dragging"),e.retainElement=!1,DomSync.addChild(t.foregroundCanvas,e,a.id)}var I;if(a.resource!==H&&(a.resource=H,c.isEvent&&T.add(c),M=!0,c.isOccurrence&&(c.newResource=H),o&&h.usesSingleAssignment&&(c.resourceId=H.id)),!DateHelper.isEqual(c.startDate,k))x.push({draggedEvent:c,originalStartDate:A}),c.startDate=k,c.isEvent&&T.add(c),P=!0,null===(I=c.resources)||void 0===I||I.forEach((e=>R.add(e)))}l.remove(w),c.remove(S),u.add(E),null===(i=h.add(D))||void 0===i||i.forEach((e=>T.add(e))),(w.length||S.length||E.length||D.length)&&(M=!0),(M||P)&&(h.usesSingleAssignment&&T.forEach((e=>e.beginBatch())),await Promise.all([t.project!==e.project?t.project.commitAsync():null,e.project.commitAsync()]),h.usesSingleAssignment&&T.forEach((e=>e.endBatch(!1,!0)))),M||(M=x.some((({draggedEvent:e,originalStartDate:t})=>!DateHelper.isEqual(e.startDate,t)))),t.resumeRefresh(),e.resumeRefresh(),M?(t.refreshWithTransition(),o&&e.refreshWithTransition()):r.valid=!1}getProductDragContext(e){const t=this.scheduler.resolveEventRecord(e.browserEvent.target);let r;r=this.constrainDragToResource?e.resourceRecord:this.constrainDragToTimeline?this.resolveResource()||e.newResource||e.resourceRecord:this.resolveResource();const{assignmentRecords:n,eventRecords:i}=e;return{valid:Boolean(r),draggedRecords:i,eventRecords:i,assignmentRecords:n,newResource:r,targetEventRecord:t}}setupProductDragData(e){const t=this,{scheduler:r}=t,n=e.grabbed,i=r.resolveEventRecord(n),s=r.resolveResourceRecord(n),o=r.resolveAssignmentRecord(n),a=Rectangle.from(n),l=[o],c=[];if(t.constrainDragToResource&&!s)throw new Error("Resource could not be resolved for event: "+i.id);const d=r.getDateConstraints(t.constrainDragToResource?s:null,i);return t.constrainDragToTimeline&&t.setupConstraints(r.getScheduleRegion(t.constrainDragToResource?s:null,i),a,r.timeAxisViewModel.snapPixelAmount,Boolean(d)),r.multiEventSelect&&(r.isAssignmentSelected(l[0])||t.drag.startEvent.ctrlKey)&&l.push.apply(l,t.getRelatedRecords(o)),l.forEach((e=>{let t=r.getElementFromAssignmentRecord(e);t||(t=r.currentOrientation.addTemporaryDragElement(e.event,e.resource),t=t.innerElement),c.push(t)})),c.forEach(((e,t)=>c[t]=e.parentNode)),{record:o,dateConstraints:d,eventBarEls:c,draggedEntities:l}}getDragData(e,t){const r=super.getDragData(e,t),n=r.draggedEntities,i=[...new Set(n.map((e=>e.event)))];return ObjectHelper.assign(r,{resourceRecord:this.scheduler.resolveResourceRecord(e.grabbed),eventRecords:i,assignmentRecords:n})}getRelatedRecords(e){return this.scheduler.selectedAssignments.filter((t=>t!==e&&t.event.isDraggable))}getCoordinate(e,t,r){const n=this.currentOverClient;if(n.isHorizontal){let i=r[0];if("default"!==n.milestoneLayoutMode&&e.isMilestone)switch(n.milestoneAlign){case"center":i+=t.offsetWidth/2;break;case"end":i+=t.offsetWidth}return i}{let i=r[1];if("default"!==n.milestoneLayoutMode&&e.isMilestone)switch(n.milestoneAlign){case"center":i+=t.offsetHeight/2;break;case"end":i+=t.offsetHeight}return i}}resolveResource(){const e=this,t=e.currentOverClient,{isHorizontal:r}=t,{context:n}=e.dragData,i=n.dragProxy||n.element,s=Rectangle.from(i,null,!0),o=t.isVertical||e.unifiedDrag?n.clientY:s.center.y,a=Rectangle.from(i,e.currentOverClient.timeAxisSubGridElement,!0),{x:l,y:c}=a.center;if(r){const e=t.rowManager.getRowAt(o);return e&&t.resourceStore.getAt(e.dataIndex)}return t.resolveResourceRecord(t.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[l,c])}adjustStartDate(e,t){const r=this.currentOverClient;return r.timeAxis.roundDate(new Date(e-0+t),!!r.snapRelativeToEventStartDate&&e)}resolveStartEndDates(e){const t=this.currentOverClient,{timeAxis:r}=t,n=this.dragData;let{start:i,end:s}=t.getStartEndDatesFromRectangle(e,"round",n.duration,!r.isContinuous);if(i&&s)if(n.startsOutsideView)n.endsOutsideView||(i=s&&DateHelper.add(s,-n.duration,"ms"));else{if(i&&!t.timeAxis.dateInAxis(i,!1)){const e=t.timeAxis.getTickFromDate(i);e>=0&&(i=t.timeAxis.getDateFromTick(e))}s=i&&DateHelper.add(i,n.duration,"ms")}return{startDate:i,endDate:s}}getRecordElement(e){return this.scheduler.getElementFromAssignmentRecord(e,!0)}}EventDrag._$name="EventDrag",GridFeatureManager.registerFeature(EventDrag,!0,"Scheduler");class DragCreateBase extends InstancePlugin{static get defaultConfig(){return{showTooltip:!0,dragTolerance:2,preventMultiple:!1,validatorFn:()=>{},validatorFnThisObj:null,proxyCls:"b-sch-dragcreator-proxy",tipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `}}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"],before:["onElementContextMenu"]}}doDestroy(){var e,t;null===(e=this.tip)||void 0===e||e.destroy(),null===(t=this.resize)||void 0===t||t.destroy(),super.doDestroy()}addProxy(e){const t=this,{client:r}=t,{barMargin:n}=r,i=r.currentOrientation.getRowRegion(e.rowRecord);let s,o,a,l;return r.isHorizontal?(a="currentX"in e?Math.min(e.startX,e.currentX+1):e.startX,l=i.y+n,s=e.width||t.dragTolerance,o=i.height-2*n):(a=i.x+n,l="currentY"in e?Math.min(e.startY,e.currentY+1):e.startY,s=i.width-2*n,o=e.height||t.dragTolerance),r.element.classList.add("b-dragcreating"),r.element.classList.add("b-dragcreating-proxy-sizing"),t.proxy=DomHelper.createElement({parent:r.foregroundCanvas,className:t.proxyCls,style:`transform:translate(${a}px, ${l}px);width:${s}px;height:${o}px`,retainElement:!0})}removeProxy(){const e=this;var t;e.proxy&&(e.proxy.remove(),e.resize.destroy(),e.proxy=e.resize=null,e.client.element.classList.remove("b-dragcreating"),e.client.element.classList.remove("b-dragcreating-proxy-sizing"),null===(t=e.tip)||void 0===t||t.hide())}initResizer(e,t){var r;const n=this,{client:i}=n;let s;s=i.isHorizontal?t.currentX>t.startX?"right":"left":t.currentY>t.startY?"bottom":"top",null===(r=n.resize)||void 0===r||r.destroy(),n.resize=new ResizeHelper({name:n.constructor.name,direction:i.isVertical?"vertical":"horizontal",isTouch:e.type.startsWith("touch"),dragThreshold:n.dragTolerance,grab:{element:n.proxy,edge:s,event:t.startEvent},allowEdgeSwitch:!0,outerElement:i.timeAxisSubGridElement,scrollManager:i.scrollManager,scroller:i.timeAxisSubGrid.scrollable,listeners:{resizing:"onResizing",resize:"onResize",cancel:"onCancel",thisObj:n}}),n.resize.context.resource=t.resource}initTooltip(){const e=this,{client:t}=e;e.showTooltip&&(e.tip?e.tip.showBy(e.getTooltipTarget()):(e.clockTemplate=new ClockTemplate({scheduler:t}),e.tip=new Tooltip({id:t.id+"-drag-create-tip",autoShow:!0,trackMouse:!1,updateContentOnMouseMove:!0,getHtml:e.getTipHtml.bind(e),align:t.isVertical?"t-b":"b100-t100",hideDelay:0,axisLock:!0}),e.tip.on("innerhtmlupdate",e.updateDateIndicator,e)))}updateDateIndicator(){const e=this,{startDate:t,endDate:r}=e.createContext,{tip:n}=e,i=n.element.querySelector(".b-sch-tooltip-enddate");t&&r&&(e.clockTemplate.updateDateIndicator(n.element,t),i&&e.clockTemplate.updateDateIndicator(i,r))}getTipHtml(){if(!this.resize.context)return;const e=this,{client:t}=e,{edge:r,newX:n,newY:i,elementStartX:s,elementStartY:o,elementWidth:a,elementHeight:l,newWidth:c,newHeight:d,valid:u,message:h}=e.resize.context;let g,m;if(t.isHorizontal){const e="left"===r?n:s,i=Math.min(Math.max(e+(c||a)-1,0),t.timeAxisViewModel.totalSize-1);g=t.getDateFromCoordinate(e,"round",!0),m=t.getDateFromCoordinate(i,"round",!0)}else{const e="top"===r?i:o,n=Math.min(Math.max(e+(d||l)-1,0),t.timeAxisViewModel.totalSize-1);g=t.getDateFromCoordinate(e,"round",!0),m=t.getDateFromCoordinate(n,"round",!0)}const p=DateHelper.min(g,m),f=DateHelper.max(g,m),v=p&&t.getFormattedDate(p),y=f&&m&&t.getFormattedEndDate(f,p);return e.tipTemplate({startDate:p,endDate:f,startClockHtml:e.clockTemplate.template({date:p,text:v,cls:"b-sch-tooltip-startdate"}),endClockHtml:e.clockTemplate.template({date:t.getDisplayEndDate(f,p),text:y,cls:"b-sch-tooltip-enddate"}),valid:u,startText:v,endText:y,message:h})}finalize(e){const t=this,r=()=>{t.proxy.retainElement=!1,t.reset()},n=()=>{t.client.trigger("afterDragCreate",{proxyElement:t.proxy}),r()};if(e){const e=t.finalizeDragCreate(t.createContext);ObjectHelper.isPromise(e)?e.then(n,r):n()}else n()}onElementMouseDown(e){const t=this,{client:r}=t;if(0===e.button&&e.target.matches(".b-sch-timeaxis-cell")&&!t.disabled&&!r.readOnly){const n=r.isVertical?r.resolveResourceRecord(e):r.getRecordFromElement(e.target);if(n.isSpecialRow)return;if(t.preventMultiple&&!t.isRowEmpty(n))return;t.monitorMove=!0,t.createContext={startEvent:e,startScreenX:e.screenX,startScreenY:e.screenY,startX:e.offsetX,startY:e.offsetY,cellElement:e.target,rowRecord:n},t.mouseUpDetacher=EventHelper.on({element:document.body,mouseup:"onMouseUp",once:!0,thisObj:this})}}onElementMouseMove(e){const t=this;if(t.monitorMove){const{createContext:r,client:n}=t,i=n.isVertical?r.startScreenY-e.screenY:r.startScreenX-e.screenX;if(Math.abs(i)>t.dragTolerance){const i=n.getDateFromDomEvent(e),s=Rectangle.from(n.timeAxisSubGridElement,null,!0);if(!1===t.handleBeforeDragCreate(i,e))return void(t.monitorMove=!1);r.currentX=Math.max(e.clientX-s.x+n.timeAxisSubGrid.scrollable.x,0),r.currentY=Math.max(e.clientY-s.y+n.timeAxisSubGrid.scrollable.y,0),t.addProxy(t.createContext),t.initResizer(e,t.createContext),t.initTooltip(),t.monitorMove=!1,n.trigger("dragCreateStart",{proxyElement:t.proxy})}}t.proxy&&t.showTooltip&&t.resize.context&&t.tip.alignTo(t.getTooltipTarget())}getTooltipTarget(){const e=this,t=Rectangle.from(e.proxy,null,!0);return e.client.isVertical?("bottom"===e.resize.context.edge&&(t.y=t.bottom-1),t.height=e.tip.anchorSize[1]/2):("right"===e.resize.context.edge&&(t.x=t.right-1),t.width=e.tip.anchorSize[0]/2),{target:t}}onMouseUp(){this.client.element.classList.remove("b-dragcreating-proxy-sizing"),this.monitorMove=!1}onElementContextMenu(){if(this.proxy)return!1}onResizing({context:e,event:t}){const r=this,{client:n}=r,i="left"===e.edge?e.newX:e.elementStartX,s="top"===e.edge?e.newY:e.elementStartY,o=Math.min(i+Math.max((e.newWidth||e.elementWidth)-1,0),n.timeAxisViewModel.totalSize-1),a=Math.min(s+Math.max((e.newHeight||e.elementHeight)-1,0),n.timeAxisViewModel.totalSize-1),l=n.isVertical?s:i,c=n.isVertical?a:o,d=n.getDateFromCoordinate(l,"round",!0),u=n.getDateFromCoordinate(c,"round",!0),h=r.dateConstraints;let g=DateHelper.min(d,u),m=DateHelper.max(d,u);h&&(m=DateHelper.constrain(m,h.start,h.end),g=DateHelper.constrain(g,h.start,h.end)),Object.assign(r.createContext,{startDate:g,endDate:m}),e.valid=r.checkValidity(r.createContext,t),e.message="",e.valid&&"boolean"!=typeof e.valid&&(e.message=e.valid.message,e.valid=e.valid.valid),e.valid=!1!==e.valid}onResize({context:{valid:e},event:t}){const r=this,{startDate:n,endDate:i}=r.createContext;(!n||!i||i-n<=0)&&(e=!1),r.createContext=r.prepareCreateContextForFinalization(r.createContext,t,r.finalize.bind(r)),e&&r.client.trigger("beforeDragCreateFinalize",{context:r.createContext,event:t,proxyElement:r.proxy}),r.createContext&&(r.resize.context.async=r.createContext.async,r.createContext.async?r.resize.removeListeners():r.finalize(e))}prepareCreateContextForFinalization(e,t,r,n=!1){return Object.assign({},e,{async:n,event:t,finalize:r})}get dragging(){return this.resize}onCancel(){this.cancel()}cancel(){this.reset(),this.mouseUpDetacher&&this.mouseUpDetacher()}reset(){const e=this;e.removeProxy(),e.createContext=null,e.monitorMove=!1}checkValidity(e,t){throw new Error("Implement in subclass")}triggerDragCreateEnd(e,t){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,t){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}}DragCreateBase._$name="DragCreateBase";class EventDragCreate extends DragCreateBase{static get $name(){return"EventDragCreate"}static get defaultConfig(){return{validatorFn:()=>{}}}construct(e,t){this.scheduler=e,super.construct(e,t)}get store(){return this.scheduler.eventStore}finalizeDragCreate(e){const t=new this.store.modelClass({startDate:e.startDate,duration:null,endDate:e.endDate});this.proxy.dataset.eventId=t.id,this.scheduler.trigger("dragCreateEnd",{newEventRecord:t,resourceRecord:e.rowRecord,event:e.event,proxyElement:this.proxy})}handleBeforeDragCreate(e,t){const r=this,n=r.scheduler.trigger("beforeDragCreate",{resourceRecord:r.createContext.rowRecord,date:e,event:t});if(n){var i;const e=r.scheduler.features.scheduleTooltip;null==e||null===(i=e.hoverTip)||void 0===i||i.hide()}return r.dateConstraints=r.scheduler.getDateConstraints(r.createContext.rowRecord,e),n}checkValidity(e,t){const r=this,{client:n}=r;return e.resourceRecord=e.rowRecord,(n.allowOverlap||n.isDateRangeAvailable(e.startDate,e.endDate,null,e.resourceRecord))&&r.validatorFn.call(r.validatorFnThisObj||r,e,t)}isRowEmpty(e){const t=this.store.getEventsForResource(e);return!t||!t.length}}EventDragCreate._$name="EventDragCreate",GridFeatureManager.registerFeature(EventDragCreate,!0,"Scheduler");class EventDragSelect extends(Delayable(InstancePlugin)){static get $name(){return"EventDragSelect"}construct(e,t){if(this.timeline=e,e.multiEventSelect=!0,e.features.eventDragCreate||e.features.pan)throw new Error("Cannot combine this feature with Pan or EventDragCreate features");this.targetSelector=[".b-timeline-subgrid .b-grid-cell",".b-timeline-subgrid"].join(","),super.construct(e,t)}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove","onElementMouseUp"]}}onElementMouseDown(e){const t=this,r=t.client;e.touches||0!==e.button||t.disabled||e.target.matches(t.targetSelector)&&(t.startX=e.clientX,t.startY=e.clientY,t.element=DomHelper.createElement({tag:"div",className:"b-dragselect-rect"},!0)[0],Widget.floatRoot.appendChild(t.element),r.element.classList.add("b-dragselecting"),t.eventRectangles=Array.from(r.element.querySelectorAll(r.eventSelector)).map((e=>({rectangle:Rectangle.from(e,!0),record:r.resolveEventRecord(e)}))),r.clearEventSelection(),t.subGridElementRect=Rectangle.from(r.timeAxisSubGrid.element,!0),r.navigator.disabled=!0)}onElementMouseMove(e){const t=this;if(0!==e.buttons||BrowserHelper.isSafari||BrowserHelper.isIE11&&!e.isTrusted){if("number"==typeof t.startX){const r=Math.max(e.clientX,t.subGridElementRect.left),n=Math.max(e.clientY,t.subGridElementRect.top),i=Math.min(t.startX,r),s=Math.min(t.startY,n),o=Math.abs(t.startX-r),a=Math.abs(t.startY-n),l=new Rectangle(i,s,o,a).constrainTo(t.subGridElementRect);DomHelper.setTranslateXY(t.element,l.left,l.top),t.element.style.width=l.width+"px",t.element.style.height=l.height+"px",t.rectangle=l,t.updateSelection()}}else t.onElementMouseUp(e)}onElementMouseUp(){const e=this;"number"==typeof e.startX&&(e.element&&e.element.remove(),e.client.element.classList.remove("b-dragselecting"),e.startX=e.startY=null,e.setTimeout((()=>e.client.navigator.disabled=!1),100))}updateSelection(){const e=this,t=e.eventRectangles,r=e.rectangle;for(let n=0,i=t.length;n<i;n++){const i=t[n],s=r.intersect(i.rectangle,!0);s&&!i.selected?(i.selected=!0,e.client.selectEvent(i.record,!0)):!s&&i.selected&&(i.selected=!1,e.client.deselectEvent(i.record))}}}EventDragSelect._$name="EventDragSelect",GridFeatureManager.registerFeature(EventDragSelect,!1,"Scheduler");const DH$2=DateHelper,makeDate=e=>{if(1===e.length)return e[0].value;if(2===e.length){const[t,r]=e[0]instanceof DateField?e:e.reverse(),n=DH$2.parse(t.value);return n&&n.setHours(r.value.getHours(),r.value.getMinutes(),r.value.getSeconds(),r.value.getMilliseconds()),n?DateHelper.clone(n):null}return null},copyTime=(e,t)=>{const r=new Date(e.getTime());return r.setHours(t.getHours(),t.getMinutes()),r},adjustEndDate=(e,t,r)=>{if(e&&t){const e=DH$2.add(copyTime(r.startDateField.value,r.startTimeField.value),r.eventRecord.durationMS,"milliseconds");r.endDateField.value=e,r.endTimeField.value=DH$2.clone(e)}};class EditBase extends InstancePlugin{static get configurable(){return{autoClose:!0,saveAndCloseOnEnter:!0,triggerEvent:null,showDeleteButton:!0,showNameField:!0,startTimeConfig:null,startDateConfig:null,endTimeConfig:null,endDateConfig:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,extraItems:null,items:null,weekStartDay:null}}construct(e,t){const r=this;e.eventEdit=r,super.construct(e,ObjectHelper.assign({weekStartDay:e.weekStartDay},t)),r.clientListenersDetacher=e.on({[r.triggerEvent]:r.onActivateEditor,dragcreateend:r.onDragCreateEnd,thisObj:r})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}changeEditorConfig(e){const{items:t,extraItems:r}=this;return r?(e=Objects.clone(e),e=this.insertExtraWidgetsIntoDefaultWidgets(e)):t&&((e=Objects.clone(e)).items=Config.merge(t,e.items)),e}insertExtraWidgetsIntoDefaultWidgets(e){VersionHelper.deprecate("Scheduler","5.0.0","extraItems replaced by items in EditFeature.");const{extraItems:t}=this,{items:r}=e,n=Array.isArray(t)?t:t&&Object.values(t);if(!t||!Object.keys(n).length)return e;if(Object.values(n).some((e=>"index"in e))){const n=Array.isArray(t)?t:t&&ObjectHelper.transformNamedObjectToArray(t);VersionHelper.deprecate("Scheduler","5.0.0","index in extraItems replaced by weight to sort editor items");let i,s=ObjectHelper.transformNamedObjectToArray(r),o=s[s.length-1],a=s.findIndex((e=>"extraItems"===e.type));a>-1&&(s.splice(a,1),i=s.splice(a));const l=n.filter((e=>e.index>=0)),c=n.filter((e=>!(e.index>=0)));c.forEach(((e,t)=>e.weight=o.weight+100*t)),s=s.concat(c),l.sort(((e,t)=>e.index-t.index)),l.forEach((e=>{const t=s[Math.min(e.index,s.length)-1];e.weight=t?t.weight+1:-100,s.splice(e.index,0,e)})),i&&i.length&&(s=s.concat(i)),e.items=ObjectHelper.transformArrayToNamedObject(s)}else{let n=900;for(const e of Array.isArray(t)?t:Object.values(t))e.ref||(e.ref=e.id),e.weight=n+=100;e.items={...r,...Array.isArray(t)?ObjectHelper.transformArrayToNamedObject(t):t}}return e}onDatesChange(e){const t=this,r=e.source,n=e.value;switch(r.ref){case"startDateField":t.startTimeField&&adjustEndDate(n,t.startTimeField.value,t);break;case"startTimeField":t.startDateField&&adjustEndDate(t.startDateField.value,n,t)}t.endTimeField&&(DH$2.isEqual(DH$2.clearTime(t.startDateField.value),DH$2.clearTime(t.endDateField.value))?t.endTimeField.min=t.startTimeField.value:t.endTimeField.min=null)}async save(){throw new Error("Implement in subclass")}get isValid(){return Object.values(this.editor.widgetMap).every((e=>!(e.name&&!e.hidden)||!1!==e.isValid))}get values(){const e=this,{editor:t}=e,r=[],n=[],i={};return t.eachWidget((s=>{var o;const a=s.name;if(a&&!s.hidden&&!s.up((t=>t===e.recurrenceEditor)))switch(a){case"startDate":r.push(s);break;case"endDate":n.push(s);break;case"resource":i[a]=s.record;break;case"recurrenceRule":i[a]="none"===(null===(o=t.widgetMap.recurrenceCombo)||void 0===o?void 0:o.value)?"":s.value;break;default:i[a]=s.value}}),!0),r.length&&(i.startDate=makeDate(r)),n.length&&(i.endDate=makeDate(n)),"startDate"in i&&"endDate"in i&&(i.duration=DH$2.diff(i.startDate,i.endDate,e.editor.record.durationUnit,!0)),i}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;this.scheduler.assignmentStore&&delete t.resource,e.set(t)}resetEditingContext(){const e=this;e.isEditing=!1,e.targetEventElement=null,e.client.element.classList.remove("b-eventeditor-editing"),e.phantomEventElement&&e.phantomEventElement.remove(),e.phantomEventElement=null}onPopupKeyDown({event:e}){!this.readOnly&&"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),"startDate"===e.target.name&&adjustEndDate(this.startDateField.value,this.startTimeField.value,this),this.onSaveClick())}async onSaveClick(){await this.save()&&this.editor.close()}async onDeleteClick(){await this.deleteEvent()&&(this.editor.autoClose&&!this.editor.containsFocus||this.editor.close())}onCancelClick(){this.editor.close()}}EditBase._$name="EditBase";class EventEditor extends Popup{static get type(){return"eventeditor"}static get $name(){return"EventEditor"}static get configurable(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",scrollable:{overflowY:!0},readOnly:null,titleRenderer:null}}updateLocalization(){super.updateLocalization(...arguments),this.initialTitle=this.title||""}processWidgetConfig(e){var t;const r=this,n=r.eventEditFeature;if((null===(t=e.type)||void 0===t?void 0:t.includes("date"))&&null==e.weekStartDay&&(e.weekStartDay=r.weekStartDay),"extraItems"===e.type)return!1;let i={};if("resourceField"===e.ref){if(!n.showResourceField)return!1;r.resourceStore=e.store=n.resourceStore.makeChained((e=>!e.isSpecialRow),null,{excludeCollapsedRecords:!1}),e.multiSelect=!n.eventStore.usesSingleAssignment,n.resourceFieldConfig&&(i=n.resourceFieldConfig)}return!("nameField"===e.ref&&!n.showNameField)&&(!("deleteButton"===e.ref&&!n.showDeleteButton)&&("startDate"!==e.name&&"endDate"!==e.name||"date"!==e.type||(i.format=n.dateFormat),"startDate"!==e.name&&"endDate"!==e.name||"time"!==e.type||(i.format=n.timeFormat),n.startDateConfig&&"startDate"===e.name&&"date"===e.type&&(i=n.startDateConfig),n.startTimeConfig&&"startDate"===e.name&&"time"===e.type&&(i=n.startTimeConfig),n.endDateConfig&&"endDate"===e.name&&"date"===e.type&&(i=n.endDateConfig),n.endTimeConfig&&"endDate"===e.name&&"time"===e.type&&(i=n.endTimeConfig),Object.assign(e,i),super.processWidgetConfig(e)))}show(...e){this.resourceStore&&this.resourceStore.fillFromMaster(),super.show(...e)}onBeforeShow(...e){const t=this,{record:r,titleRenderer:n}=t,i=t.widgetMap.deleteButton;i&&(i.hidden=t.readOnly||!r.stores.length&&!r.isOccurrence),t.title=n?t.callback(n,t,[r]):t.initialTitle,super.onBeforeShow&&super.onBeforeShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}updateReadOnly(e){const{deleteButton:t,saveButton:r,cancelButton:n}=this.widgetMap;super.updateReadOnly(e),t&&(t.hidden=e),r&&(r.hidden=e),n&&(n.hidden=e)}}EventEditor.initClass(),EventEditor._$name="EventEditor";class RecurrenceConfirmationPopup extends Popup{static get $name(){return"RecurrenceConfirmationPopup"}static get type(){return"recurrenceconfirmation"}static get defaultConfig(){return{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:window,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:this},items:{changeMultipleButton:{weight:100,color:"b-green",text:"L{Object.Yes}",onClick:"up.onChangeMultipleButtonClick"},changeSingleButton:{weight:200,color:"b-gray",text:"L{update-only-this-btn-text}",onClick:"up.onChangeSingleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}onRecurrenceClose(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}confirm(e={}){const t=this;return["actionType","eventRecord","title","html","changerFn","cancelFn","thisObj"].forEach((r=>{r in e&&(t[r]=e[r])})),t.updatePopupContent(),super.show(e)}updatePopupContent(){const e=this,{changeMultipleButton:t,changeSingleButton:r,cancelButton:n}=e.widgetMap,{eventRecord:i,actionType:s="update"}=e,o=i&&i.isRecurring;o?(t.text=e.L("L{Object.Yes}"),e.html=e.L(s+"-all-message")):(t.text=e.L(s+"-further-btn-text"),e.html=e.L(s+"-further-message")),r.text=e.L(s+"-only-this-btn-text"),n.text=e.L("L{Object.Cancel}"),o?r.hide():r.show(),e.width=e.L("L{width}"),e.title=e.L(s+"-title")}processMultipleRecords(){const{eventRecord:e,changerFn:t,thisObj:r}=this;e.beginBatch(),this.callback(t,r,[e]),e.endBatch()}processSingleRecord(){const{eventRecord:e,changerFn:t,thisObj:r}=this;e.beginBatch(),e.recurrence=null,this.callback(t,r,[e]),e.recurrenceRule=null,e.endBatch()}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}}RecurrenceConfirmationPopup.initClass(),RecurrenceConfirmationPopup._$name="RecurrenceConfirmationPopup";class RecurrenceFrequencyCombo extends(LocalizableComboItems(Combo)){static get $name(){return"RecurrenceFrequencyCombo"}static get type(){return"recurrencefrequencycombo"}static get defaultConfig(){return{editable:!1,displayField:"text",valueField:"value"}}buildLocalizedItems(){return[{value:"DAILY",text:this.L("L{Daily}")},{value:"WEEKLY",text:this.L("L{Weekly}")},{value:"MONTHLY",text:this.L("L{Monthly}")},{value:"YEARLY",text:this.L("L{Yearly}")}]}}RecurrenceFrequencyCombo.initClass(),RecurrenceFrequencyCombo._$name="RecurrenceFrequencyCombo";class RecurrenceCombo extends RecurrenceFrequencyCombo{static get $name(){return"RecurrenceCombo"}static get type(){return"recurrencecombo"}static get defaultConfig(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}buildLocalizedItems(){const e=this;return[{value:"none",text:e.L("L{None}")},...super.buildLocalizedItems(),{value:e.customValue,text:e.L("L{Custom}"),cls:e.splitCls}]}set value(e){e=e||"none",super.value=e}get value(){return super.value}set recurrence(e){const t=this;t.value=e?t.isCustomRecurrence(e)?t.customValue:e.frequency:null}isCustomRecurrence(e){const{interval:t,days:r,monthDays:n,months:i}=e;return Boolean(t>1||r&&r.length||n&&n.length||i&&i.length)}}RecurrenceCombo.initClass(),RecurrenceCombo._$name="RecurrenceCombo";class RecurrenceLegend extends(Localizable()){static get $name(){return"RecurrenceLegend"}static get allDaysValue(){return"SU,MO,TU,WE,TH,FR,SA"}static get workingDaysValue(){return"MO,TU,WE,TH,FR"}static get nonWorkingDaysValue(){return"SU,SA"}static getLegend(e,t){const r=this,{timeSpan:n,interval:i,days:s,monthDays:o,months:a,positions:l}=e,c=t||n.startDate,d={interval:i};let u;switch(e.frequency){case"DAILY":return 1===i?r.L("L{Daily}"):r.L("L{Every {0} days}",d);case"WEEKLY":return s&&s.length?d.days=r.getDaysLegend(s):c&&(d.days=DateHelper.getDayName(c.getDay())),r.L(1===i?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",d);case"MONTHLY":return s&&s.length&&l&&l.length?d.days=r.getDaysLegend(s,l):o&&o.length?(o.sort(((e,t)=>e-t)),d.days=r.arrayToText(o)):c&&(d.days=c.getDate()),r.L(1===i?"L{Monthly on {1}}":"L{Every {0} months on {1}}",d);case"YEARLY":return s&&s.length&&l&&l.length?d.days=r.getDaysLegend(s,l):d.days=c.getDate(),a&&a.length?(a.sort(((e,t)=>e-t)),u=a.length>2?e=>DateHelper.getMonthShortName(e-1):e=>DateHelper.getMonthName(e-1),d.months=r.arrayToText(a,u)):d.months=DateHelper.getMonthName(c.getMonth()),r.L(1===i?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",d)}}static getDaysLegend(e,t){const r=this,n={position:""};let i;if(t&&t.length&&(n.position=r.arrayToText(t,(e=>r.L(`L{position${e}}`)))),e.length)switch(e.sort(((e,t)=>RecurrenceDayRuleEncoder.decodeDay(e)[0]-RecurrenceDayRuleEncoder.decodeDay(t)[0])),e.join(",")){case r.allDaysValue:n.days=r.L("L{day}");break;case r.workingDaysValue:n.days=r.L("L{weekday}");break;case r.nonWorkingDaysValue:n.days=r.L("L{weekend day}");break;default:i=e.length>2?e=>DateHelper.getDayShortName(RecurrenceDayRuleEncoder.decodeDay(e)[0]):e=>DateHelper.getDayName(RecurrenceDayRuleEncoder.decodeDay(e)[0]),n.days=r.arrayToText(e,i)}return r.L("L{daysFormat}",n)}static arrayToText(e,t){return t&&(e=e.map(t)),e.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}}RecurrenceLegend._$name="RecurrenceLegend";class RecurrenceLegendButton extends Button{static get $name(){return"RecurrenceLegendButton"}static get type(){return"recurrencelegendbutton"}static get defaultConfig(){return{localizableProperties:[],recurrence:null}}set recurrence(e){this._recurrence=e,this.updateLegend()}get recurrence(){return this._recurrence}set eventStartDate(e){this._eventStartDate=e,this.updateLegend()}get eventStartDate(){return this._eventStartDate}updateLegend(){const e=this,{recurrence:t}=e;e.text=t?RecurrenceLegend.getLegend(t,e.eventStartDate):""}onLocaleChange(){this.updateLegend()}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}}RecurrenceLegendButton.initClass(),RecurrenceLegendButton._$name="RecurrenceLegendButton";class RecurrenceDaysCombo extends(LocalizableComboItems(Combo)){static get $name(){return"RecurrenceDaysCombo"}static get type(){return"recurrencedayscombo"}static get defaultConfig(){const e="SU,MO,TU,WE,TH,FR,SA";return{allDaysValue:e,editable:!1,defaultValue:e,workingDaysValue:"MO,TU,WE,TH,FR",nonWorkingDaysValue:"SU,SA",splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildLocalizedItems(){const e=this;return e._weekDays=null,e.weekDays.concat([{value:e.allDaysValue,text:e.L("L{day}"),cls:e.splitCls},{value:e.workingDaysValue,text:e.L("L{weekday}")},{value:e.nonWorkingDaysValue,text:e.L("L{weekend day}")}])}get weekDays(){const e=this;if(!e._weekDays){const t=DateHelper.weekStartDay,r=DateHelper.getDayNames().map(((e,t)=>({text:e,value:RecurrenceDayRuleEncoder.encodeDay(t)})));e._weekDays=r.slice(t).concat(r.slice(0,t))}return e._weekDays}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),e&&t.store.findRecord("value",e)||(e=t.defaultValue),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}}RecurrenceDaysCombo.initClass(),RecurrenceDaysCombo._$name="RecurrenceDaysCombo";class RecurrenceDaysButtonGroup extends ButtonGroup{static get $name(){return"RecurrenceDaysButtonGroup"}static get type(){return"recurrencedaysbuttongroup"}static get defaultConfig(){return{defaults:{cls:"b-raised",toggleable:!0}}}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}updateItemText(e){const t=RecurrenceDayRuleEncoder.decodeDay(e.value)[0];e.text=DateHelper.getDayName(t).substring(0,3)}buildItems(){const e=this;if(!e.__items){const t=DateHelper.weekStartDay,r=DateHelper.getDayNames().map(((e,t)=>({text:e.substring(0,3),value:RecurrenceDayRuleEncoder.encodeDay(t)})));e.__items=r.slice(t).concat(r.slice(0,t))}return e.__items}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}RecurrenceDaysButtonGroup.initClass(),RecurrenceDaysButtonGroup._$name="RecurrenceDaysButtonGroup";class RecurrenceMonthDaysButtonGroup extends ButtonGroup{static get $name(){return"RecurrenceMonthDaysButtonGroup"}static get type(){return"recurrencemonthdaysbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}get minValue(){return 1}get maxValue(){return 31}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}buildItems(){const e=this,t=[];for(let r=e.minValue;r<=e.maxValue;r++)t.push({text:r+"",value:r});return t}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}RecurrenceMonthDaysButtonGroup.initClass(),RecurrenceMonthDaysButtonGroup._$name="RecurrenceMonthDaysButtonGroup";class RecurrenceMonthsButtonGroup extends ButtonGroup{static get $name(){return"RecurrenceMonthsButtonGroup"}static get type(){return"recurrencemonthsbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}construct(e={}){e.columns=4,e.items=this.buildItems(),super.construct(e)}buildItems(){return DateHelper.getMonthNames().map(((e,t)=>({text:e.substring(0,3),value:t+1})))}updateItemText(e){e.text=DateHelper.getMonthName(e.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}RecurrenceMonthsButtonGroup.initClass(),RecurrenceMonthsButtonGroup._$name="RecurrenceMonthsButtonGroup";class RecurrenceStopConditionCombo extends(LocalizableComboItems(Combo)){static get $name(){return"RecurrenceStopConditionCombo"}static get type(){return"recurrencestopconditioncombo"}static get defaultConfig(){return{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}}buildLocalizedItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(e){e=e||"never",super.value=e}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(e){let t=null;e.endDate?t="date":e.count&&(t="count"),this._recurrence=e,this.value=t}}RecurrenceStopConditionCombo.initClass(),RecurrenceStopConditionCombo._$name="RecurrenceStopConditionCombo";class RecurrencePositionsCombo extends(LocalizableComboItems(Combo)){static get $name(){return"RecurrencePositionsCombo"}static get type(){return"recurrencepositionscombo"}static get defaultConfig(){return{editable:!1,splitCls:"b-sch-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildLocalizedItems(){const e=this;return e.buildDayNumbers().concat([{value:"-1",text:e.L("L{position-1}"),cls:e.splitCls}])}buildDayNumbers(){const e=this;return ArrayHelper.populate(e.maxPosition,(t=>({value:t,text:e.L("position"+(t+1))})))}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),e&&t.store.findRecord("value",e)||(e=t.defaultValue),super.value=e}get value(){const e=super.value;return e?(""+e).split(",").map((e=>parseInt(e,10))):[]}}RecurrencePositionsCombo.initClass(),RecurrencePositionsCombo._$name="RecurrencePositionsCombo";class RecurrenceEditor extends Popup{static get $name(){return"RecurrenceEditor"}static get type(){return"recurrenceeditor"}static get configurable(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:400,defaults:{localeClass:this},items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{Frequency}",weight:10,onChange:"up.onFrequencyFieldChange"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{Every}",min:1,required:!0},daysButtonField:{type:"recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY"},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",forFrequency:"MONTHLY",label:"L{Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:50,name:"months",forFrequency:"YEARLY"},positionAndDayRadioField:{type:"checkbox",weight:60,toggleGroup:"radio",forFrequency:"MONTHLY|YEARLY",label:"L{On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY"},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",flex:1},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{End repeat}",onChange:"up.onStopRecurrenceFieldChange"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" "},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler",weight:100},saveButton:{color:"b-green",text:"L{Save}",onClick:"up.onSaveClick",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick",weight:300}}}}}updateReadOnly(e){super.updateReadOnly(e),this.bbar.hidden=e}updateRecord(e){super.updateRecord(e);const t=this,r=e.timeSpan,n=r&&r.startDate,{daysButtonField:i,monthDaysButtonField:s,monthsButtonField:o,monthDaysRadioField:a,positionAndDayRadioField:l,stopRecurrenceField:c}=t.widgetMap;n&&(e.days&&e.days.length||(i.value=[RecurrenceDayRuleEncoder.encodeDay(n.getDay())]),e.monthDays&&e.monthDays.length||(s.value=n.getDate()),e.months&&e.months.length||(o.value=n.getMonth()+1)),e.days&&e.positions?(l.check(),t.isPainted||a.uncheck()):(a.check(),t.isPainted||l.uncheck()),c.recurrence=e}onSaveClick(){const e=this;e.saveHandler?e.saveHandler.call(e.thisObj||e,e,e.record):(e.syncEventRecord(),e.close())}onCancelClick(){const e=this;e.cancelHandler?e.cancelHandler.call(e.thisObj||e,e,e.record):e.close()}syncEventRecord(e){const t=this.getValues((t=>t.name in e&&!t.disabled));e.set(t)}toggleStopFields(){const{countField:e,endDateField:t}=this.widgetMap;switch(this.widgetMap.stopRecurrenceField.value){case"count":e.show(),e.enable(),t.hide(),t.disable();break;case"date":e.hide(),e.disable(),t.show(),t.enable();break;default:e.hide(),t.hide(),e.disable(),t.disable()}}onMonthDaysRadioFieldChange({checked:e}){const{monthDaysButtonField:t}=this.widgetMap;t.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onPositionAndDayRadioFieldChange({checked:e}){const{daysCombo:t,positionsCombo:r}=this.widgetMap;t.disabled=r.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onStopRecurrenceFieldChange(){this.toggleStopFields()}isWidgetAvailableForFrequency(e,t=this.widgetMap.frequencyField.value){return!e.forFrequency||e.forFrequency.indexOf(t)>-1}onFrequencyFieldChange({value:e,valid:t}){const r=this,n=r.queryAll((e=>"forFrequency"in e));if(t&&e){for(let t=0;t<n.length;t++){const i=n[t];r.isWidgetAvailableForFrequency(i,e)?(i.show(),i.enable()):(i.hide(),i.disable())}r.widgetMap.intervalField.hint=r.L(e+"intervalUnit"),r.toggleFieldsState()}}toggleFieldsState(){const e=this,{widgetMap:t}=this;e.onMonthDaysRadioFieldChange({checked:t.monthDaysRadioField.checked}),e.onPositionAndDayRadioFieldChange({checked:t.positionAndDayRadioField.checked}),e.onStopRecurrenceFieldChange()}updateLocalization(){const{countField:e,intervalField:t,frequencyField:r}=this.widgetMap;e.hint=this.L("L{time(s)}"),r.value&&(t.hint=this.L(r.value+"intervalUnit")),super.updateLocalization()}}RecurrenceEditor.initClass(),RecurrenceEditor._$name="RecurrenceEditor";var RecurringEventEdit=e=>class extends(e||Base){static get $name(){return"RecurringEventEdit"}static get configurable(){return{recurringEventsItems:{recurrenceCombo:{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo",weight:700},editRecurrenceButton:{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",color:"b-gray",flex:"1",weight:800}},showRecurringUI:null}}changeEditorConfig(e){return e.items={...e.items,...this.recurringEventsItems},e=super.changeEditorConfig(e)}construct(e,t){const r=this;super.construct(e,t),r.scheduler.on({beforeEventDelete:r.onRecurrableEventBeforeDelete,beforeEventSave:r.onRecurrableEventBeforeSave,thisObj:r})}doDestroy(){this._recurrenceConfirmation&&this.recurrenceConfirmation.destroy(),this._recurrenceEditor&&this.recurrenceEditor.destroy(),super.doDestroy()}onEditorConstructed(e){const t=this;e.on("hide",t.onRecurringEventEditorHide,t),e.widgetMap.editRecurrenceButton.menu=t.recurrenceEditor,t.recurrenceCombo.on("change",t.onRecurrenceComboChange.bind(t))}internalShowEditor(){this.toggleRecurringFieldsVisibility(this.client.enableRecurringEvents&&!1!==this.showRecurringUI)}toggleRecurringFieldsVisibility(e=!0){const t=e?"show":"hide";this.editRecurrenceButton&&this.editRecurrenceButton[t](),this.recurrenceCombo&&this.recurrenceCombo[t]()}onRecurringEventEditorHide({source:e}){const{recurrenceEditor:t,recurrenceConfirmation:r}=this;t&&t.isVisible&&t.hide(),r&&r.isVisible&&r.hide()}makeRecurrence(e){const t=this.eventRecord,r=t.copy();let n=t.recurrence;return n=!e&&n?n.copy():new t.recurrenceModel(e?{rule:e}:{}),n.timeSpan=r,r.setStartDate(this.values.startDate),n.suspendTimeSpanNotifying(),n}onRecurrableEventBeforeSave({eventRecord:e,context:t}){const r=this;if(e.supportsRecurring&&(e.isRecurring||e.isOccurrence))return r.recurrenceConfirmation.confirm({actionType:"update",eventRecord:e,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),t.async=!0,!1}showDisplayConfirmationOnEventDelete(e){return this.isEditing&&this.eventRecord===e&&e.supportsRecurring&&(e.isRecurring||e.isOccurrence)}onRecurrableEventBeforeDelete({eventRecords:e,context:t}){const[r]=e;if(this.showDisplayConfirmationOnEventDelete(r))return this.recurrenceConfirmation.confirm({actionType:"delete",eventRecord:r,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),!1}set recurrenceConfirmation(e){this._recurrenceConfirmation=e}get recurrenceConfirmation(){const e=this;let t=e._recurrenceConfirmation;return t&&t.$$name||(t=Widget.create(Object.assign({type:"recurrenceconfirmation",owner:e.getEditor()},t)),e._recurrenceConfirmation=t),t}set recurrenceEditor(e){this._recurrenceEditor=e}get recurrenceEditor(){const e=this;let t=e._recurrenceEditor;return t&&t.$$name||(t=Widget.create(Object.assign({type:"recurrenceeditor",autoShow:!1,clippedBy:[e.scheduler.timeAxisSubGridElement,e.scheduler.bodyContainer],centered:!0,modal:!0,constrainTo:window,anchor:!1,saveHandler:e.recurrenceEditorSaveHandler,onBeforeShow:e.onBeforeShowRecurrenceEditor.bind(e),thisObj:e},t)),e._recurrenceEditor=t,t.readOnly=e._readOnly),t}onBeforeShowRecurrenceEditor(){const e=this,{recurrenceEditor:t,eventRecord:r}=e;t&&r&&r.supportsRecurring&&(e.recurrence||(e.recurrence=e.makeRecurrence()),e.recurrence.timeSpan.setStartDate(e.values.startDate),t.record=e.recurrence,t.centered=!0)}loadRecurrenceData(e){this.recurrence=e,this.updateRecurrenceFields(e)}updateRecurrenceFields(e){const t=this,{editRecurrenceButton:r}=t;t.recurrenceCombo&&(t.recurrenceCombo.recurrence=e),r&&(r.recurrence=e,r.value=e?e.rule:null,e&&t.client.enableRecurringEvents&&!1!==t.showRecurringUI?r.show():r.hide())}onRecurrenceComboChange({source:e,value:t,userAction:r}){const n=this,{recurrenceEditor:i}=n;t==e.customValue?r&&(n.recurrenceCombo.recurrence=n.makeRecurrence(),i.centered?i.show():i.show((n.editRecurrenceButton||e).element)):n.loadRecurrenceData(t?n.makeRecurrence("FREQ="+t):null)}recurrenceEditorSaveHandler(e,t){e.syncEventRecord(t),this.updateRecurrenceFields(t),e.close()}onDatesChange(...e){super.onDatesChange(...e);const t=this,{editRecurrenceButton:r}=t;if(!t.loadingRecord&&r){const{startDate:e}=t.values;e&&(r.eventStartDate=e)}}internalLoadRecord(e,t){this.recurrenceCombo&&e&&e.supportsRecurring&&this.loadRecurrenceData(e.recurrence?this.makeRecurrence():null)}};class ResourceCombo extends Combo{static get $name(){return"ResourceCombo"}static get type(){return"resourcecombo"}static get configurable(){return{showEventColor:!1,picker:{cls:"b-resourcecombo-picker",itemIconTpl(e,t){const{eventColor:r}=e,n=null==r?void 0:r.startsWith("#");return`<div class="b-icon b-icon-square${!r||n?"":" b-sch-foreground-"+r}"${r?n?` style="color:${r}"`:"":' style="display:none"'}></div>`}}}}changeShowEventColor(e){return Boolean(e)}updateShowEventColor(e){this.element.classList[e?"add":"remove"]("b-show-event-color")}changePicker(e,t){return(e=super.changePicker(e,t))&&e.element.classList[this.showEventColor?"add":"remove"]("b-show-event-color"),e}get innerElements(){return[{class:"b-icon b-resource-icon b-icon-square b-hide-display",reference:"resourceIcon"},this.inputElement]}syncInputFieldValue(){var e,t;const r=this,{resourceIcon:n,lastResourceIconCls:i}=r,{classList:s}=n,o=null!==(e=null===(t=r.selected)||void 0===t?void 0:t.eventColor)&&void 0!==e?e:"";super.syncInputFieldValue(),n.style.color="",i&&s.remove(i),r.lastResourceIconCls=null,o?(o.startsWith("#")?n.style.color=o:(r.lastResourceIconCls="b-sch-foreground-"+o,s.add(r.lastResourceIconCls)),s.remove("b-hide-display")):s.add("b-hide-display")}}ResourceCombo.initClass(),ResourceCombo._$name="ResourceCombo";class EventEdit extends(EditBase.mixin(RecurringEventEdit,Delayable)){static get $name(){return"EventEdit"}static get configurable(){return{triggerEvent:"eventdblclick",showResourceField:!0,resourceFieldConfig:null,typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{type:"eventeditor",title:"L{EventEdit.Edit event}",closable:!0,localeClass:this,defaults:{localeClass:this},items:{nameField:{type:"text",label:"L{Name}",clearable:!0,name:"name",weight:100,required:!0},resourceField:{type:"resourcecombo",label:"L{Resource}",name:"resource",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,weight:200},startDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{Start}",name:"startDate",flex:"1 0 60%",weight:300},startTimeField:{type:"time",clearable:!1,required:!0,name:"startDate",cls:"b-match-label",flex:"1 0 40%",weight:400},endDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{End}",name:"endDate",flex:"1 0 60%",weight:500},endTimeField:{type:"time",clearable:!1,required:!0,name:"endDate",cls:"b-match-label",flex:"1 0 40%",weight:600}},bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{color:"b-green",text:"L{Save}",weight:100},deleteButton:{color:"b-gray",text:"L{Delete}",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",weight:300}}}},targetEventElement:null}}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey"],assign:["editEvent"]}}construct(e,t){this.scheduler=e,this.readOnly=e.readOnly,super.construct(e,t),e.on({projectChange:"onChangeProject",readOnly:"onClientReadOnlyToggle",thisObj:this})}get readOnly(){return this.editor?this.editor.readOnly:this._readOnly}updateReadOnly(e){this.editor&&(this.editor.readOnly=e)}onClientReadOnlyToggle({readOnly:e}){this.readOnly=e}getEditor(){var e,t,r,n,i;const s=this;let{editor:o}=s;return o||(o=s.editor=Widget.create(s.getEditorConfig()),o.readOnly=s._readOnly,0===o.items.length&&console.warn("Event Editor configured without any `items`"),o.on({beforehide:"resetEditingContext",beforeshow:"onBeforeEditorShow",keydown:"onPopupKeyDown",thisObj:s}),this.scheduler.relayEvents(o,["beforeSetRecord"],"eventEdit"),Object.values(o.widgetMap).forEach((e=>{const t=e.ref||e.id;if(t&&!s[t])switch(s[t]=e,e.name){case"startDate":case"endDate":e.on("change",s.onDatesChange,s)}})),null===(e=s.onEditorConstructed)||void 0===e||e.call(s,o),null===(t=s.eventTypeField)||void 0===t||t.on("change",s.onEventTypeChange,s),null===(r=s.saveButton)||void 0===r||r.on("click",s.onSaveClick,s),null===(n=s.deleteButton)||void 0===n||n.on("click",s.onDeleteClick,s),null===(i=s.cancelButton)||void 0===i||i.on("click",s.onCancelClick,s),s.editor)}getEditorConfig(){const e=this,{autoClose:t,cls:r,scheduler:n}=e;return ObjectHelper.assign({owner:n,eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:n.id+"-event-editor",autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[n.timeAxisSubGridElement,n.bodyContainer],constrainTo:window,autoClose:t,cls:r},e.editorConfig)}internalShowEditor(e,t,r=null){const n=this,i=n.scheduler,s=r||DomHelper.down(i.getElementFromEventRecord(e,t),i.eventInnerSelector);if(s||!e.isPartOfStore(i.eventStore)){var o;if(!1===i.trigger("beforeEventEdit",{eventEdit:n,eventRecord:e,resourceRecord:t,eventElement:s}))return i.element.classList.remove("b-eventeditor-editing"),null===(o=n.phantomEventElement)||void 0===o||o.remove(),void(n.phantomEventElement=null);n.resourceRecord=t;const a=n.getEditor(e);n.editingContext={eventRecord:e,resourceRecord:t,eventElement:s,editor:a},super.internalShowEditor&&super.internalShowEditor(e,t,r),n.typeField&&n.toggleEventType(e.get(n.typeField)),n.isEditing=!0,n.loadRecord(e,t),a.centered||!a.anchor?a.show():s?(n.targetEventElement=s,a.showBy({target:s,anchor:!0})):a.showBy({target:i.element,anchor:!1,align:"c-c"});const l=i.timeAxisViewModel.timeResolution;"hour"!==l.unit&&"minute"!==l.unit||(n.startTimeField.step=n.endTimeField.step=`${l.increment}${l.unit}`)}}onBeforeEditorShow(){this.scheduler.trigger("beforeEventEditShow",Object.assign({eventEdit:this},this.editingContext))}updateTargetEventElement(e,t){e&&e.classList.add("b-editing"),t&&t.classList.remove("b-editing")}editEvent(e,t,r=null){const n=this;if(n.isEditing&&n.resetEditingContext(),!n.disabled)return n.scheduler.element.classList.add("b-eventeditor-editing"),n.doEditEvent(...arguments)}doEditEvent(e,t,r=null){const n=this,i=n.scheduler,s=!e.isOccurrence&&i.eventStore.indexOf(e)<0;t||(t=e.resource||n.resourceStore.getById(e.resourceId)),s&&(this.phantomEventElement=r,TimeSpan.prototype.normalize.call(e)),r||s?n.internalShowEditor(e,t,r):i.scrollResourceEventIntoView(t,e,null,{animate:!0,edgeOffset:0,extendTimeAxis:!1}).then((()=>n.internalShowEditor(e,t)),(()=>i.element.classList.remove("b-eventeditor-editing")))}loadRecord(e,t){this.loadingRecord=!0,this.internalLoadRecord(e,t),this.loadingRecord=!1}internalLoadRecord(e,t){const r=this,{eventStore:n}=r.client,{editor:i}=r;if(r.eventRecord=e,r.resourceRecord=t,i.record=e,r.resourceField){const t=n.getResourcesForEvent(e);i._isSettingValues=!0,!n.storage.includes(e,!0)&&r.resourceRecord?r.resourceField.value=r.resourceRecord[r.resourceField.valueField]:r.assignmentStore&&(r.resourceField.value=t.map((e=>e[r.resourceField.valueField]))),i._isSettingValues=!1}super.internalLoadRecord(e,t)}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget((t=>{var r;(null===(r=t.dataset)||void 0===r?void 0:r.eventType)&&(t.hidden=t.dataset.eventType!==e)}))}async finalizeEventSave(e,t,r,n){const i=this,{scheduler:s,eventStore:o,assignmentStore:a,phantomEventElement:l}=i;if(a.suspendAutoCommit(),s.suspendRefresh(),i.onBeforeSave(e),e.beginBatch(),i.updateRecord(e),e.endBatch(),!e.isOccurrence)if(o&&!e.stores.length){if(!1===s.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:t,resources:t}))return void r(!1);{o.add(e);const[r]=o.assignEventToResource(e,t);l&&(i.eventStore.includes(e)?DomSync.addChild(s.foregroundCanvas,l,r.id):l.remove(),i.phantomEventElement=null)}}else o.assignEventToResource(e,t,!0);await s.project.commitAsync(),a.resumeAutoCommit(),s.resumeRefresh(!0),s.trigger("afterEventSave",{eventRecord:e}),i.onAfterSave(e),r(e)}save(){return new Promise(((e,t)=>{var r;const n=this,{scheduler:i,eventRecord:s}=n;if(!s||!n.isValid)return void e(!1);const{eventStore:o,values:a}=n,l=(null===(r=n.resourceField)||void 0===r?void 0:r.records)||(n.resourceRecord?[n.resourceRecord]:[]),c=l[0];if(!n.scheduler.allowOverlap&&o){if(l.some((e=>!o.isDateRangeAvailable(a.startDate,a.endDate,s,e))))return void e(!1)}const d={finalize(r){try{!1!==r?n.finalizeEventSave(s,l,e,t):e(!1)}catch(e){t(e)}}};!1!==i.trigger("beforeEventSave",{eventRecord:s,resourceRecords:l,resourceRecord:c,values:a,context:d})?d.finalize():d.async||e()}))}deleteEvent(){return new Promise(((e,t)=>{const{eventRecord:r,editor:n}=this;this.scheduler.removeRecords([r],(t=>{t&&n.containsFocus&&n.revertFocus(),e(t)}))}))}onChangeProject({project:e}){this.resourceField&&(this.resourceField.store=e.resourceStore)}set resourceStore(e){this._resourceStore=e}get eventStore(){return this.scheduler.project.eventStore}get resourceStore(){return this.scheduler.project.resourceStore}get assignmentStore(){return this.scheduler.project.assignmentStore}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:r}){this.editEvent(e,t,r)}onDragCreateEnd({newEventRecord:e,resourceRecord:t,proxyElement:r}){const n=this;if(!n.disabled){n.scheduler.onEventCreated(e);const i=r.cloneNode(!0);i.removeAttribute("id"),r.parentElement.appendChild(i),n.editEvent(e,t,i)}}onEventEnterKey({assignmentRecord:e,eventRecord:t,target:r}){const n=r.closest(this.client.eventInnerSelector);e?this.editEvent(t,e.resource,n):t&&this.editEvent(t,t.resource,n)}onEventTypeChange({value:e}){this.toggleEventType(e)}populateEventMenu({eventRecord:e,resourceRecord:t,items:r}){this.scheduler.readOnly||(r.editEvent={text:"L{EventEdit.Edit event}",localeClass:this,icon:"b-icon b-icon-edit",weight:100,onItem:()=>{this.editEvent(e,t)}})}}EventEdit._$name="EventEdit",GridFeatureManager.registerFeature(EventEdit,!0,"Scheduler"),GridFeatureManager.registerFeature(EventEdit,!1,"SchedulerPro"),EventEdit.initClass();class EventFilter extends InstancePlugin{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["populateHeaderMenu","populateTimeAxisHeaderMenu"]}}construct(e,t){super.construct(e,t),this.scheduler=e}populateHeaderMenu({column:e,items:t}){"timeAxis"===e.type&&this.populateTimeAxisHeaderMenu(...arguments)}populateTimeAxisHeaderMenu({column:e,items:t}){const r=this;t.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:r.disabled,localeClass:this,weight:100,menu:{type:"popup",localeClass:this,items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:this,width:200,listeners:{change:r.onEventFilterChange,thisObj:r}}},onBeforeShow({source:e}){const[t]=e.items,n=r.scheduler.eventStore.filters.getBy("property","name");t.value=n&&n.value||""}}}}onEventFilterChange({value:e}){const t=this;""!==e?t.scheduler.eventStore.filter("name",e):t.scheduler.eventStore.removeFilter("name")}}EventFilter.featureClass="b-event-filter",EventFilter._$name="EventFilter",GridFeatureManager.registerFeature(EventFilter,!0,["Scheduler","Gantt"]);const tipAlign={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"};class ResizeBase extends InstancePlugin{static get defaultConfig(){return{showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>{},validatorFnThisObj:null,tip:null,tipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `}}static get pluginConfig(){return{chain:["render"]}}render(){const e=this;e.resize&&e.resize.destroy(),e.resize=e.createResizeHelper(),e.showTooltip&&(e.clockTemplate=new ClockTemplate({scheduler:e.client}))}doDestroy(){const e=this;e.tip&&e.tip.destroy(),e.clockTemplate&&e.clockTemplate.destroy(),e.resize&&e.resize.destroy(),super.doDestroy()}isElementResizable(e,t){const{client:r,resize:n}=this,i=r.resolveTimeSpanRecord(e);if(r.readOnly)return!1;let s=i&&i.isResizable;const o=(e=DomHelper.up(t.target,r.eventSelector))?e.firstElementChild:e,a=t.target.closest('[class$="-handle"]');if(!s||a&&a!==o)return!1;const l=e.classList.contains("b-sch-event-startsoutside"),c=e.classList.contains("b-sch-event-endsoutside");if(!0===s){if(l&&c)return!1;if(l)s="end";else{if(!c)return n.overStartHandle(t,e)||n.overEndHandle(t,e);s="start"}}return!(l&&"start"===s||c&&"end"===s)&&!!(n.overStartHandle(t,e)&&"start"===s||n.overEndHandle(t,e)&&"end"===s)}onBeforeResizeStart({element:e,event:t}){const{client:r}=this,n=r.scheduledEventName,i=r.resolveTimeSpanRecord(e);return!this.disabled&&!1!==r.trigger(`before${r.capitalizedEventName}Resize`,{[n+"Record"]:i,event:t})}onResizeStart({context:e,event:t}){const r=this,n=r.client,i=n.resolveTimeSpanRecord(e.element),s=n.scheduledEventName;n.element.classList.add("b-resizing-event"),r.setupProductResizeContext(e,t),r.showTooltip&&(r.tip?(r.tip.align=tipAlign[e.edge],r.tip.showBy(r.getTooltipTarget())):(r.tip=new Tooltip({id:n.id+"-event-resize-tip",autoShow:!0,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,getHtml:r.getTipHtml.bind(r),align:tipAlign[e.edge],hideDelay:0}),r.tip.on("innerhtmlupdate",r.updateDateIndicator,r))),i.instanceMeta(n).retainElement=!0,n.trigger(s+"ResizeStart",{[s+"Record"]:i,event:t})}updateDateIndicator(){const{edge:e,startDate:t,endDate:r}=this.resize.context,{element:n}=this.tip;(t||r)&&("right"===e||"bottom"===e?this.clockTemplate.updateDateIndicator(n.querySelector(".b-sch-tooltip-enddate"),r):this.clockTemplate.updateDateIndicator(n,t))}getTooltipTarget(){const e=this,t=Rectangle.from(e.resize.context.element,null,!0);return"horizontal"===e.resize.direction?("right"===e.resize.context.edge&&(t.x=t.right-1),t.width=e.tip.anchorSize[0]/2):("bottom"===e.resize.context.edge&&(t.y=t.bottom-1),t.height=e.tip.anchorSize[1]/2),{target:t}}onResizing({context:e,event:t}){const r=this,{client:n}=r,i=n.features.dependencies,s=r.getTimespanRecord(e),o=n.scheduledEventName,{element:a,edge:l}=e,c=DomHelper.getTranslateXY(a);let d,u;if("top"===l||"left"===l?(u=s.endDate,n.snapRelativeToEventStartDate?(d=n.getDateFromXY(c,null,!0),d=n.timeAxis.roundDate(d,s.startDate)):d=n.getDateFromXY(c,"round",!0)):(c[0]+=a.offsetWidth,c[1]+=a.offsetHeight,d=s&&s.startDate,n.snapRelativeToEventStartDate?(u=n.getDateFromXY(c,null,!0),u=n.timeAxis.roundDate(u,s.endDate)):u=n.getDateFromXY(c,"round",!0)),d=d||e.startDate,u=u||e.endDate,e.dateConstraints&&(d=DateHelper.constrain(d,e.dateConstraints.start,e.dateConstraints.end),u=DateHelper.constrain(u,e.dateConstraints.start,e.dateConstraints.end)),r.showExactResizePosition||n.timeAxisViewModel.snap){const t="top"===l||"left"===l?n.timeAxisViewModel.getDistanceBetweenDates(d,s.endDate):n.timeAxisViewModel.getDistanceBetweenDates(s.startDate,u);switch(l){case"top":DomHelper.setTranslateY(a,e.elementStartY+e.elementWidth-t),a.style.height=t+"px";break;case"right":a.style.width=t+"px";break;case"bottom":a.style.height=t+"px";break;case"left":DomHelper.setTranslateX(a,e.elementStartX+e.elementWidth-t),a.style.width=t+"px"}}const h=e.endDate-u!=0||e.startDate-d!=0;e.endDate=u,e.startDate=d,h&&(e.valid=r.checkValidity(e,t)),n.trigger(o+"PartialResize",{[o+"Record"]:s,startDate:d,endDate:u,element:a,context:e}),i&&i.updateDependenciesForTimeSpan(s,a),r.showTooltip&&r.tip.alignTo(r.getTooltipTarget())}checkValidity(e,t){let r=e.startDate&&e.endDate>e.startDate&&this.validatorFn.call(this.validatorFnThisObj||this,e,t);return r&&"boolean"!=typeof r&&(e.message=r.message||"",r=r.valid),!1!==r}onFinishResize({source:e,context:t,event:r}){const n=this,i=n.getTimespanRecord(t),s=i.startDate,o=i.endDate,a=t.startDate||s,l=t.endDate||o,c=n.client;let d=!1;n.tip&&n.tip.hide(),i.instanceMeta(c).retainElement=!1,t.oldFinalize=t.finalize,t.finalize=(...e)=>{t.async&&n.finalize(...e)},t.valid=a&&l&&l-a>0&&(a-s!=0||l-o!=0)&&!1!==t.valid,t.valid&&(c.trigger(`before${c.scheduledEventName}ResizeFinalize`,{context:t,event:r}),d=!0),t.async||n.finalize(d)}onCancelResize({context:e}){const t=this.getTimespanRecord(e);t&&(t.instanceMeta(this.client).retainElement=!1),this.finalize(!1)}async finalize(e){const t=this,{client:r}=t,n=t.resize.context,i=t.getTimespanRecord(n),s=r.scheduledEventName;let o=!1;if(t.tip&&t.tip.hide(),n.started)if(e&&(o=await t.internalUpdateRecord(n,i)),e&&o)n.oldFinalize();else{const e=r.features.dependencies;t.resize.abortResize(null,!0),e&&e.scheduleDraw(!0)}r.element.classList.remove("b-resizing-event"),r.trigger(s+"ResizeEnd",{changed:o,[s+"Record"]:i||r.resolveEventRecord(n.element)})}getTipHtml({tip:e}){const t=this;let{startDate:r,endDate:n,valid:i,message:s}=t.resize.context;if(!r||!n)return e.html;void 0===s&&(s=""),n=t.client.getDisplayEndDate(n,r);const o=t.client.getFormattedDate(r),a=t.client.getFormattedDate(n);return t.tipTemplate({valid:i,startDate:r,endDate:n,startText:o,endText:a,message:s,startClockHtml:t.clockTemplate.template({date:r,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:t.clockTemplate.template({date:n,text:a,cls:"b-sch-tooltip-enddate"})})}getRowRecord(e){throw new Error("Implement in subclass")}getTimespanRecord(e){throw new Error("Implement in subclass")}setupProductResizeContext(e,t){throw new Error("Implement in subclass")}get store(){throw new Error("Implement in subclass")}}ResizeBase._$name="ResizeBase";class EventResize extends ResizeBase{static get $name(){return"EventResize"}createResizeHelper(){const e=this,t=e.client;return new ResizeHelper({direction:t.isVertical?"vertical":"horizontal",name:e.constructor.$$name,isElementResizable:(t,r)=>e.isElementResizable(t,r),targetSelector:t.eventSelector,handleContainerSelector:t.eventInnerSelector,resizingCls:"b-sch-event-wrap-resizing",allowResize:e.isElementResizable.bind(e),outerElement:t.timeAxisSubGridElement,scrollManager:t.scrollManager,dragThreshold:0,dynamicHandleSize:!0,reservedSpace:5,scroller:t.timeAxisSubGrid.scrollable,listeners:{beforeresizestart:e.onBeforeResizeStart,resizestart:e.onResizeStart,resizing:e.onResizing,resize:e.onFinishResize,cancel:e.onCancelResize,thisObj:e}})}get store(){return this.client.eventStore}getTimespanRecord(e){return e.eventRecord}getRowRecord(e){return e.resourceRecord}setupProductResizeContext(e,t){const r=this.client,n=r.resolveEventRecord(e.element),i=r.resolveResourceRecord(e.element);Object.assign(e,{eventRecord:n,resourceRecord:i,dateConstraints:r.getDateConstraints(i,n)})}onResizeStart({context:e,event:t}){super.onResizeStart({context:e,event:t}),this.client.features.dependencies&&this.client.features.dependencies.hideTerminals(e.element),e.element.querySelector(".b-sch-event").classList.add("b-sch-event-resizing")}checkValidity(e,t){return(this.client.allowOverlap||this.client.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&super.checkValidity(e,t)}onFinishResize({source:e,context:t,event:r}){super.onFinishResize({source:e,context:t,event:r}),this.client.features.dependencies&&this.client.features.dependencies.showTerminals(t.eventRecord,t.element)}async internalUpdateRecord(e,t){const{generation:r}=t;return t.isOccurrence?t.set(TimeSpan.prototype.inSetNormalize.call(t,{startDate:e.startDate,endDate:e.endDate})):"left"===e.edge||"top"===e.edge?await t.setStartDate(e.startDate,!1):await t.setEndDate(e.endDate,!1),t.generation!==r}finalize(e){this.resize.context.element.querySelector(".b-sch-event").classList.remove("b-sch-event-resizing"),super.finalize(e)}}EventResize._$name="EventResize",GridFeatureManager.registerFeature(EventResize,!0,"Scheduler");class TooltipBase extends InstancePlugin{static get defaultConfig(){return{autoUpdate:!1,template:null,cls:null,align:{align:"b-t"},clockTemplate:null}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const r=this;t=r.processConfig(t),super.construct(e,t),r.forSelector||(r.forSelector=e.eventInnerSelector+":not(.b-dragproxy)"),r.clockTemplate=new ClockTemplate({scheduler:e}),e.on({[`before${e.scheduledEventName}drag`]:()=>{var e;return null===(e=r.tooltip)||void 0===e?void 0:e.hide()}})}processConfig(e){return"function"==typeof e?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){var e,t;null===(e=this.clockTemplate)||void 0===e||e.destroy(),null===(t=this.tooltip)||void 0===t||t.destroy(),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}render(){const e=this,t=e.client,r=[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-dragcreating",".b-dragging-"+t.scheduledEventName,".b-creating-dependency",".b-dragproxy"].map((e=>`:not(${e})`)).join("");e.tooltip&&e.tooltip.destroy(),e.tooltip=new Tooltip(Object.assign({axisLock:"flexible",id:e.tipId||e.client.id+"-event-tip",cls:e.tipCls,forSelector:`.b-timelinebase${r} .b-grid-body-container:not(.b-scrolling) ${e.forSelector}`,scrollAction:"realign",clippedBy:[t.timeAxisSubGridElement,t.bodyContainer],forElement:t.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:100,anchorToTarget:!0,allowOver:Boolean(e.config.items||e.config.tools),getHtml:e.getTipHtml.bind(e),disabled:e.disabled},e.config)),e.tooltip.on("innerhtmlupdate",e.updateDateIndicator,e)}updateDateIndicator(){const e=this,{client:t}=e,r=e.tooltip,n=r.activeTarget&&t.resolveTimeSpanRecord(r.activeTarget),i=r.element.querySelector(".b-sch-tooltip-enddate");n&&(e.clockTemplate.updateDateIndicator(r.element,n.startDate),i&&e.clockTemplate.updateDateIndicator(i,n.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,activeTarget:t}){const r=this,{client:n}=r,i=r.recordType||n.scheduledEventName+"Record",s=r.resolveTimeSpanRecord(t);if((null==s?void 0:s.startDate)instanceof Date){const{startDate:t,endDate:o}=s,a=n.getFormattedDate(t),l=n.getDisplayEndDate(o,t),c=n.getFormattedDate(l);return e.eventRecord=s,r.template({tip:e,[""+i]:s,startDate:t,endDate:o,startText:a,endText:c,startClockHtml:r.clockTemplate.template({date:t,text:a,cls:"b-sch-tooltip-startdate"}),endClockHtml:s.isMilestone?"":r.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})})}return e.hide(),""}}TooltipBase._$name="TooltipBase";class EventTooltip extends TooltipBase{static get $name(){return"EventTooltip"}static get defaultConfig(){return{template:e=>`\n                ${e.eventRecord.name?`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:""}\n                ${e.startClockHtml}\n                ${e.endClockHtml}`,cls:"b-sch-event-tooltip"}}construct(e,t){const r=this;super.construct(e,t),"string"==typeof r.align&&(r.align={align:r.align})}render(){const e=this,t=e.client.features.dependencies;if(super.render(),t){const r=e.align.offset;e.tooltip.on("beforeshow",(({source:e})=>{t.disabled?e.align.offset=r:e.align.offset=[0,10]}))}}}EventTooltip._$name="EventTooltip",GridFeatureManager.registerFeature(EventTooltip,!0,"Scheduler");class Header$1 extends Header{static get $name(){return"SchedulerHeader"}refreshContent(){this.headersElement&&0===this.headersElement.childNodes.length&&super.refreshContent()}}Header$1._$name="Header";class TimeAxisViewModel extends(Events()){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,calendar:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,eventStore:null,originalTickSize:null,headersDatesCache:[]}}construct(e){const t=this;t.unitToPixelsCache={},super.construct(e);const r=t.timeAxis.viewPreset||t.viewPreset;if(r)if(r instanceof ViewPreset)t.consumeViewPreset(r);else{const e=pm.getPreset(r);e&&t.consumeViewPreset(e)}t.timeAxis.on("reconfigure",t.onTimeAxisReconfigure,t),t.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this)}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get headers(){return this._headers}set headers(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}get isTimeAxisViewModel(){return!0}get isHorizontal(){return"vertical"!==this.mode}get isVertical(){return"vertical"===this.mode}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){const t=this;t.headers=null,t.setConfig(e),t.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:t}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),t||this.update()}update(e,t=!1,r=!1){const n=this,{timeAxis:i,headers:s}=n;if(n.isConfiguring||n._availableSpace===e)return void(r&&n.trigger("update"));if(n._availableSpace=Math.max(e||n.availableSpace||0,0),"number"!=typeof n.availableSpace)throw new Error("Invalid available space provided to TimeAxisModel");n.columnConfig=[];const o=n._tickSize=n.calculateTickSize(n.originalTickSize);if("number"!=typeof o||o<=0)throw new Error("Invalid timeAxis tick size");n.unitToPixelsCache={},n._totalSize=null;for(let e=0,{length:t}=s;e<t;e++){const t=s[e];if(t.cellGenerator){const r=t.cellGenerator.call(n,i.startDate,i.endDate);n.columnConfig[e]=n.createHeaderRow(e,t,r)}else n.columnConfig[e]=n.createHeaderRow(e,t)}t||n.trigger("update")}getDistanceBetweenDates(e,t){return Math.round(this.getPositionFromDate(t)-this.getPositionFromDate(e))}getDistanceForDuration(e){const t=this.timeAxis.getAt(0);return this.tickSize/(t.endDate-t.startDate)*e}getPositionFromDate(e,t={}){const r=this,n=r.getScaledTick(e,t);return-1===n?-1:Math.round(r.tickSize*(n-r.timeAxis.visibleTickStart))}getScaledTick(e,{respectExclusion:t,snapToNextIncluded:r,isEnd:n,min:i,max:s}){const{timeAxis:o}=this,{include:a,unit:l}=o;let c=o.getTickFromDate(e);if(-1!==c&&t&&a){let t=!1;if(a.hour&&DateHelper.compareUnits(l,"hour")>0&&"day"!==l){const{from:n,to:i,lengthFactor:s,center:o}=a.hour,l=e.getHours(),c=Math.min(Math.max(l,n),i);if(!r&&c!==l)return-1;const d=o-(o-(c+e.getMinutes()/60))*s;e=DateHelper.add(e,d-l,"h"),t=!0}if(a.day&&DateHelper.compareUnits(l,"day")>0){const{from:l,to:c,lengthFactor:d,center:u}=a.day;let h=e.getDay();n&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()&&--h<0&&(h=6);let g=0;if(h<l||h>=c){if(!r)return-1;if(g=n?(c-h-8)%7:(l-h+7)%7,e=DateHelper.add(e,g,"d"),e=DateHelper.startOf(e,"d",!1),s&&e.getTime()>=s||i&&e.getTime()<=i)return-1}const{weekStartDay:m}=o,p=0===e.getDay()?0:u,f=e.getDay()+e.getHours()/24,v=p-(p-f)*d;e=DateHelper.add(e,v-f+m,"d"),t=!0}t&&(e=DateHelper.constrain(e,o.startDate,o.endDate),c=o.getTickFromDate(e))}return c}getDateFromPosition(e,t,r=!1){const n=this,i=n.timeAxis,s=n.getScaledPosition(e)/n.tickSize+i.visibleTickStart;return s<0||s>i.count?r?s<0?DateHelper.add(i.startDate,s,i.unit):DateHelper.add(i.endDate,s-i.count,i.unit):null:i.getDateFromTick(s,t)}getScaledPosition(e){const{include:t,unit:r,weekStartDay:n}=this.timeAxis;if(t){const i=this.getSingleUnitInPixels("day");if(t.day&&DateHelper.compareUnits(r,"day")>0){const{from:r,lengthFactor:s}=t.day,o=e%(7*i);e=o/s+(r-n)*i+(e-o)}if(t.hour&&DateHelper.compareUnits(r,"hour")>0&&"day"!==r){const{from:r,lengthFactorExcl:n}=t.hour,s=e%i;e=s/n+r*this.getSingleUnitInPixels("hour")+(e-s)}}return e}getSingleUnitInPixels(e){const t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=DateHelper.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickSize/t.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,t){this._tickSize=this.originalTickSize=e,this.update(void 0,t)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const t=this,{forceFit:r,timeAxis:n,suppressFit:i}=t,s=n.unit;let o=0,a=1;if(t.snap){const e=n.resolution;a=DateHelper.getUnitToBaseUnitRatio(s,e.unit)*e.increment}if(i)o=e;else{const i=n.visibleTickTimeSpan,s=Math[r?"floor":"round"](t.availableSpace/i);if(o=r||e<s?s:e,a>0&&(!r||a<1)){const e=r?"floor":"round";o=Math.round(Math.max(1,Math[e](a*o))/a)}}return o}get totalSize(){return this._totalSize||(this._totalSize=Math.round(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const t=this;if(t._availableSpace=Math.max(0,e),t._availableSpace>0){const e=t.calculateTickSize(t.originalTickSize);e>0&&e!==t.tickSize&&t.update()}}getDates(e=this.columnLinesFor,t=!1,r=!1){const n=this,i=[],s=t?n.lowestHeader:e,o=n.majorHeaderLevel,a=n.headers&&n.headers[e].unit,l=null!=o&&n.headers&&n.headers[o].unit,c=null!=o&&DateHelper.doesUnitsAlign(l,a);if(!(!n.headers||!n.headers[s].cellGenerator)){const e=n.columnConfig[s];for(let t=1,r=e.length;t<r;t++)i.push({date:e[t].startDate})}else n.forEachInterval(s,((t,s)=>{i.push({date:r?s:t,isMajor:o!==e&&c&&n.isMajorTick(r?s:t)})}));return i}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const t=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(t,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,t,r){const n=this,i=[],s=t.align,o=DateHelper.clearTime(new Date),a=t.headerCellCls||"",l=(r,l,d,u)=>{let h=DateHelper.format(r,t.dateFormat);const g={align:s,start:r,end:l,value:u?u.header:h,headerCellCls:a,width:this.getDistanceBetweenDates(r,l),index:d};0!==g.width&&(g.coord=c,c+=g.width,n.headersDatesCache[e][r.getTime()]=1,t.renderer&&(h=t.renderer.call(t.thisObj||n,r,l,g,d,n.eventStore),g.value=null==h?"":h),"day"!==t.unit||t.increment&&1!==t.increment||(g.headerCellCls+=" b-sch-dayheadercell-"+r.getDay(),n.calendar&&n.calendar.isWeekend(r)&&(g.headerCellCls+=" b-sch-dayheadercell-nonworking"),DateHelper.clearTime(r,!0)-o==0&&(g.headerCellCls+=" b-sch-dayheadercell-today")),i.push(g))};let c=0;return n.headersDatesCache[e]={},r?r.forEach(((e,t)=>l(e.start,e.end,t,e))):n.forEachInterval(e,l),i}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:e}=this;return e?Math.max(e.length-2,0):null}isMajorTick(e){const t=this.majorHeaderLevel;return null!=t&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}forEachInterval(e,t,r=this){const{headers:n}=this;if(n)if(e===n.length-1)this.timeAxis.forEach(((e,n)=>t.call(r,e.startDate,e.endDate,n)));else{const i=n[e];this.timeAxis.forEachAuxInterval(i.unit,i.increment,t,r)}}forEachMainInterval(e,t){this.forEachInterval(this.mainHeaderLevel,e,t)}consumeViewPreset(e){const t=this;t.headers=null,t._thisIsAUsedExpression(t.tickSize),t.viewPreset=e,Object.assign(t,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:t.isHorizontal?e.tickWidth:e.tickHeight}),t.originalTickSize=t.tickSize}}TimeAxisViewModel._$name="TimeAxisViewModel";const tempDate=new Date;var TimelineDateMapper=e=>class extends(e||Base){static get $name(){return"TimelineDateMapper"}getDateFromCoordinate(e,t,r=!0,n=!1){return r||(e=this.currentOrientation.translateToScheduleCoordinate(e)),this.timeAxisViewModel.getDateFromPosition(e,t,n)}getDateFromXY(e,t,r=!0,n=!1){return this.currentOrientation.getDateFromXY(e,t,r,n)}getDateFromDomEvent(e,t,r=!1){return this.getDateFromXY([e.pageX,e.pageY],t,!1,r)}getStartEndDatesFromRectangle(e,t,r,n=!1){const i=this,{isHorizontal:s}=i,o=s?i.timeAxisSubGrid.width:i.timeAxisSubGrid.height,a=s?e.x:e.top,l=s?e.right:e.bottom;let c,d;return a>=0&&l<o?(c=i.getDateFromCoordinate(a,null,!0),d=i.getDateFromCoordinate(l,null,!0)):a<0?(d=i.getDateFromCoordinate(l,t,!0,n),c=d&&DateHelper.add(d,-r,"ms")):(c=i.getDateFromCoordinate(a,t,!0,n),d=c&&DateHelper.add(c,r,"ms")),{start:c,end:d}}get displayDateFormat(){return this._displayDateFormat}set displayDateFormat(e){this._displayDateFormat=e,this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return DateHelper.format(e,this.displayDateFormat)}getDisplayEndDate(e,t){return 0!==e.getHours()||0!==e.getMinutes()||t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()||DateHelper.formatContainsHourInfo(this.displayDateFormat)||(e=DateHelper.add(e,-1,"day")),e}getFormattedEndDate(e,t){return this.getFormattedDate(this.getDisplayEndDate(e,t))}getCoordinateFromDate(e,t=!0){const r=this,{timeAxisViewModel:n}=r,{isContinuous:i,startMS:s,endMS:o,startDate:a,unit:l}=r.timeAxis,c=e.valueOf();let d;if(!0===t?t={local:!0}:t?"local"in t||(t.local=!0):t={local:!1},e instanceof Date||(tempDate.setTime(e),e=tempDate),i&&e.getTimezoneOffset()===a.getTimezoneOffset()&&-1!==DateHelper.getUnitToBaseUnitRatio(l,"day")){if(c<s||c>o)return-1;d=Math.round((c-s)/(o-s)*n.totalSize)}else d=n.getPositionFromDate(e,t);return t.local||(d=r.currentOrientation.translateToPageCoordinate(d)),d}getTimeSpanDistance(e,t){return this.timeAxisViewModel.getDistanceBetweenDates(e,t)}get viewportCenterDate(){const e=this,{isHorizontal:t,timeAxis:r}=e,n=t?e.timeAxisSubGrid.scrollable:e.scrollable,i=n.x+n.clientWidth/2,s=n.y+n.clientHeight/2;if(r.isContinuous){const e=t?i/n.scrollWidth:s/n.scrollHeight,o=r.startMS+(r.endMS-r.startMS)*e;return new Date(o)}{const r=t?[i,0]:[0,s];return e.getDateFromXY(r,null,!0)}}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(e){this.timeAxis.resolution="number"==typeof e?{increment:e,unit:this.timeAxis.resolution.unit}:e}set snap(e){this.isConfiguring?this._snap=e:this.timeAxisViewModel.snap=e}get snap(){return this.isConfiguring?this._snap:this.timeAxisViewModel.snap}onSchedulerHorizontalScroll({subGrid:e,scrollLeft:t}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}};const eventNameMap={mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseover:"MouseOver",mouseout:"MouseOut"};var TimelineDomEvents=e=>class extends(e||Base){static get $name(){return"TimelineDomEvents"}static get defaultConfig(){return{scheduledBarEvents:{mousedown:"handleScheduledBarEvent",mouseup:"handleScheduledBarEvent",click:"handleScheduledBarEvent",dblclick:"handleScheduledBarEvent",contextmenu:"handleScheduledBarEvent",mouseover:"handleScheduledBarEvent",mouseout:"handleScheduledBarEvent"},schedulerEvents:{click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent"}}}initDomEvents(){const e=this;e.scheduledBarEvents.element=e.schedulerEvents.element=e.timeAxisSubGridElement,e.scheduledBarEvents.thisObj=e.schedulerEvents.thisObj=e,EventHelper.on(e.scheduledBarEvents),EventHelper.on(e.schedulerEvents)}getTimeSpanMouseEventParams(e,t){throw new Error("Implement in subclass")}getScheduleMouseEventParams(e,t){throw new Error("Implement in subclass")}handleScheduledBarEvent(e){const t=this,r=DomHelper.up(e.target,t.eventInnerSelector),n=eventNameMap[e.type]||StringHelper.capitalize(e.type);r&&t.trigger(t.scheduledEventName+n,t.getTimeSpanMouseEventParams(r,e))}handleScheduleEvent(e){const t=this,r=!DomHelper.up(e.target,t.eventSelector)&&DomHelper.up(e.target,"."+t.timeCellCls),n=eventNameMap[e.type]||StringHelper.capitalize(e.type);if(r){const i=t.getDateFromDomEvent(e,"floor");if(!i)return;const s=DomDataStore.get(r),o=s.row.dataIndex,a=t.timeAxis.getTickFromDate(i),l=t.timeAxis.getAt(Math.floor(a));l&&t.trigger("schedule"+n,Object.assign({date:i,tickStartDate:l.startDate,tickEndDate:l.endDate,row:s.row,index:o,event:e},t.getScheduleMouseEventParams(s,e)))}}onElementMouseOver(e){super.onElementMouseOver(e);const t=this,r=e.target;if(r.closest(t.eventInnerSelector)){const n=r.closest(t.eventSelector);if(n.classList.add(t.overScheduledEventClass),n!==t.hoveredEventNode&&!t.preventOverCls){t.hoveredEventNode=n;const r=t.getTimeSpanMouseEventParams(n,e);r&&t.trigger(t.scheduledEventName+"MouseEnter",r)}}else t.hoveredEventNode=null}onElementMouseOut(e){super.onElementMouseOut(e);const t=this;if(e.target.closest(t.eventInnerSelector)&&t.resolveTimeSpanRecord(e.target)&&t.hoveredEventNode){if(e.relatedTarget&&DomHelper.isDescendant(e.target.closest(t.eventInnerSelector),e.relatedTarget))return;t.unhover(e)}}unhover(e){const t=this,r=t.hoveredEventNode;r&&(r.classList.remove(t.overScheduledEventClass),t.trigger(t.scheduledEventName+"MouseLeave",t.getTimeSpanMouseEventParams(r,e)),t.hoveredEventNode=null)}get widgetClass(){}};const datesDiffer=(e=0,t=0)=>t-e;var TimelineViewPresets=e=>class extends(e||Base){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter"}}static get defaultConfig(){return{displayDateFormat:null,presets:!0}}set presets(e){!0===e&&(e=pm.allRecords),this._presets=new PresetStore({data:e})}get presets(){return this._presets}normalizePreset(e){const t=e,{presets:r}=this;if(!(e instanceof ViewPreset)){if("object"==typeof e){if(e.base){const t=r.getById(e.base)||pm.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=ObjectHelper.merge(ObjectHelper.clone(t.data),pm.createRecord(e).data)}e.id?e=r.createRecord(e):(e=r.createRecord(ObjectHelper.assign({},e))).id=e.generateId(r)}else e="number"==typeof e?r.getAt(e):r.getById(e)||pm.getById(e);if(!e)throw new Error("Invalid ViewPreset requested: "+t)}return r.add(e)[0]}changeViewPreset(e,t){const r=this;if(!(e instanceof ViewPreset)&&e.name&&!e.base)throw new Error("ViewPreset name config replaced by base config. See https://www.bryntum.com/docs/scheduler/#guides/upgrades/3.0.0.md");e=r.normalizePreset(e);const n=r.lastViewPresetOptions||{},i=e.options||(e.options={}),s=i.event={startDate:i.startDate,endDate:i.endDate,from:t,to:e,preset:e},o=!r._viewPreset||!r._viewPreset.equals(e),a=datesDiffer(i.startDate,n.startDate)||datesDiffer(i.endDate,n.endDate)||datesDiffer(i.centerDate,n.centerDate)||i.startDate&&datesDiffer(i.startDate,r.startDate)||i.endDate&&datesDiffer(i.endDate,r.endDate);if((o||a)&&(o||(r._viewPreset=null),r.isConfiguring||!1!==r.trigger("beforePresetChange",s)))return e}updateViewPreset(e){const t=this,{options:r}=e,{event:n,startDate:i,endDate:s}=r,{isHorizontal:o,_timeAxis:a}=t;let{centerDate:l}=r;if(t._viewPresetChanging=!0,t.displayDateFormat=t.config.displayDateFormat||e.displayDateFormat,a){if(t.lastViewPresetOptions=r,a.isConfigured){t.suspendRefresh();const r={weekStartDay:t.weekStartDay,startTime:t.startTime,endTime:t.endTime};i?(r.startDate=i,r.endDate=s,!l&&s&&(l=new Date((i.getTime()+s.getTime())/2))):(r.startDate=a.startDate,r.endDate=s||a.endDate,l||(l=t.viewportCenterDate)),a.isConfigured=!1,a.viewPreset=e,a.reconfigure(r,!0),t.timeAxisViewModel.reconfigure({viewPreset:t.viewPreset,headers:e.headers,columnLinesFor:null!=e.columnLinesFor?e.columnLinesFor:e.headers.length-1,tickSize:o?e.tickWidth:e.tickHeight||e.tickWidth||60}),t.resumeRefresh()}if(t.refresh(),!r.notScroll&&t.isPainted)if(l){t.cachedCenterDate=l,n.centerDate=l;const e=t.isHorizontal?t.timeAxisSubGrid.width:t.timeAxisSubGrid.height,r=Math.max(Math.floor(t.getCoordinateFromDate(l,!0)-e/2),0);t.viewPresetActiveScroll=t.isHorizontal?{left:r}:{top:r},t.scrollingToCenter=!0,t.isHorizontal?t.scrollHorizontallyTo(r,!1):t.scrollVerticallyTo(r,!1),t.setTimeout((()=>{t.scrollingToCenter=!1}),100)}else t.isHorizontal?t.scrollHorizontallyTo(0,!1):t.scrollVerticallyTo(0,!1)}t.trigger("presetChange",n),t._viewPresetChanging=!1}get widgetClass(){}},TimelineZoomable=e=>class extends(e||Base){static get $name(){return"TimelineZoomable"}static get defaultConfig(){return{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,preventScrollZoom:null,minZoomLevel:null,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}}construct(e){const t=this;super.construct(e),t.zoomOnMouseWheel&&EventHelper.on({element:t.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt(e){e.ctrlKey&&e.preventDefault()}},thisObj:t,capture:!0,passive:!1}),t.zoomOnTimeAxisDoubleClick&&t.on("timeaxisheaderdblclick",(({startDate:e,endDate:r})=>{t.isVertical||t.zoomToSpan({startDate:e,endDate:r})}))}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(e){if("number"!=typeof e&&(e=this.presets.count-1),e<0||e>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=e}get minZoomLevel(){return this._minZoomLevel||0}set minZoomLevel(e){if("number"!=typeof e&&(e=0),e<0||e>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(e){this.zoomToLevel(e)}getMilliSecondsPerPixelForZoomLevel(e,t){const{bottomHeader:r}=e,n=this.isHorizontal?e.tickWidth:e.tickHeight;return Math.round((DateHelper.add(new Date(1,0,1),r.increment||1,r.unit)-new Date(1,0,1))/(t?n:e.actualWidth||n))}zoomTo(e){const t=this;"object"==typeof e?e.preset?t.zoomToLevel(e.preset,e):null!=e.level?t.zoomToLevel(e.level,e):t.zoomToSpan(e):t.zoomToLevel(e)}zoomToLevel(e,t={}){"number"==typeof e&&(e=Math.min(Math.max(e,this.minZoomLevel),this.maxZoomLevel));const r=this,n=r.isVertical?"tickHeight":"tickWidth",i=r.normalizePreset(e),s=i[n],o=t.startDate?new Date(t.startDate):null,a=t.endDate?new Date(t.endDate):null;let l=o&&a?{startDate:o,endDate:a}:null;const c=t.centerDate||(l?new Date((o.getTime()+a.getTime())/2):r.viewportCenterDateCached),d=r.timeAxisSubGrid.width;if(0===d)return null;l||(l=r.calculateOptimalDateRange(c,d,i)),"width"in t&&i.setData(n,t.width),r.isZooming=!0,i.options={startDate:l.startDate||r.startDate,endDate:l.endDate||r.endDate,centerDate:c},r.viewPreset=i,i.actualWidth=r.timeAxisViewModel.tickSize,r.isZooming=!1,i.setData(n,s)}zoomToFit(e){const t=this.eventStore.getTotalTimeSpan();(e=Object.assign({leftMargin:0,rightMargin:0},e,t)).startDate&&e.endDate&&this.zoomToSpan(e)}zoomToSpan(e={}){if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const t=this,r=e.adjustStart>=0||e.adjustEnd>=0;let{startDate:n,endDate:i}=e;if(r&&(n=DateHelper.add(n,-e.adjustStart,t.timeAxis.mainUnit),i=DateHelper.add(i,e.adjustEnd,t.timeAxis.mainUnit)),n<=i){const{availableSpace:s}=t.timeAxisViewModel,o=t.presets.allRecords,a=i-n||1;let l,c,d=t.zoomLevel;-1===d&&(d=0);let u,h=t.getMilliSecondsPerPixelForZoomLevel(o[d],!0),g=d+(l=a/h+e.leftMargin+e.rightMargin>s?-1:1),m=null;for(;g>=0&&g<=o.length-1;){u=o[g],h=t.getMilliSecondsPerPixelForZoomLevel(u,!0);const r=a/h+e.leftMargin+e.rightMargin;if(-1===l){if(r<=s){m=g;break}}else{if(!(r<=s))break;d!==g-l&&(m=g)}g+=l}m=null!=m?m:g-l,u=o[m];const p=u.bottomHeader.unit;(e.leftMargin||e.rightMargin)&&(n=new Date(n.getTime()-h*e.leftMargin),i=new Date(i.getTime()+h*e.rightMargin));const f=DateHelper.getDurationInUnit(n,i,p,!0)/u.bottomHeader.increment;if(0===f)return null;const v=Math.floor(s/f),y=e.centerDate||new Date((n.getTime()+i.getTime())/2);return c=r?{startDate:n,endDate:i}:t.calculateOptimalDateRange(y,s,u),t.zoomToLevel(m,Object.assign(c,{width:v,centerDate:y}))}return null}zoomIn(e=1){const t=this.zoomLevel;return t>=this.maxZoomLevel?null:this.zoomToLevel(t+e)}zoomOut(e=1){const t=this.zoomLevel;return t<=this.minZoomLevel?null:this.zoomToLevel(t-e)}zoomInFull(){return this.zoomToLevel(this.maxZoomLevel)}zoomOutFull(){return this.zoomToLevel(this.minZoomLevel)}calculateOptimalDateRange(e,t,r,n){if(n)return n;const i=this,{timeAxis:s}=i,{bottomHeader:o}=r,a=i.isHorizontal?r.tickWidth:r.tickHeight;if(i.zoomKeepsOriginalTimespan)return{startDate:s.startDate,endDate:s.endDate};const l=o.unit,c=Math.ceil(t/a*o.increment*i.visibleZoomFactor/2),d=DateHelper.add(e,-c,l),u=DateHelper.add(e,c,l);return{startDate:s.floorDate(d,!1,l,o.increment),endDate:s.ceilDate(u,!1,l,o.increment)}}onWheel(e){const t=this;e.ctrlKey&&(e.preventDefault(),t.preventScrollZoom||(e.deltaY>0?t.zoomOut():e.deltaY<0&&t.zoomIn(),t.preventScrollZoom=!0,t.setTimeout((()=>t.preventScrollZoom=!1),30)))}setTimeSpan(e,t){this.timeAxis.setTimeSpan(e,t)}shift(e,t){this.timeAxis.shift(e,t)}shiftNext(e){this.timeAxis.shiftNext(e)}shiftPrevious(e){this.timeAxis.shiftPrevious(e)}get widgetClass(){}},RecurringEvents=e=>class extends(e||Base){static get $name(){return"RecurringEvents"}static get configurable(){return{enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}}}construct(e){super.construct(e),this.on({beforeeventdropfinalize:"onBeforeEventDropFinalize",beforeeventresizefinalize:"onBeforeEventResizeFinalize",beforeEventDelete:"onRecurrableEventBeforeDelete",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete",thisObj:this})}changeRecurrenceConfirmationPopup(e,t){const r=this.constructor.reconfigure(t,e,"recurrenceconfirmation");return r.owner=this,r}showDisplayConfirmationOnEventDelete(e){const{eventEdit:t}=this.features;return e.supportsRecurring&&(e.isRecurring||e.isOccurrence)&&(!t||!t.isEditing||t.eventRecord!==e)}onRecurrableEventBeforeDelete({eventRecords:e,context:t}){const[r]=e;if(this.enableRecurringEvents&&this.showDisplayConfirmationOnEventDelete(r))return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:r,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),!1}onRecurrableAssignmentBeforeDelete({assignmentRecords:e,context:t}){const r=e[0].event;if(this.enableRecurringEvents&&this.showDisplayConfirmationOnEventDelete(r))return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:r,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),!1}onBeforeEventDropFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecords:t}=e,r=t.filter((e=>e.supportsRecurring&&(e.isRecurring||e.isOccurrence)));r.length&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:r[0],changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}onBeforeEventResizeFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecord:t}=e;t.supportsRecurring&&(t.isRecurring||t.isOccurrence)&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:t,changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}getOccurrencesFor(e){return this.eventStore.getOccurrencesForTimeSpan(e,this.timeAxis.startDate,this.timeAxis.endDate)}get widgetClass(){}},TimelineEventRendering=e=>class extends(e||Base){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{barMargin:10,resourceMargin:null,managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed",eventStyle:"plain",eventColor:"green"}}get barMargin(){return this._barMargin}set barMargin(e){const t=this;ObjectHelper.assertNumber(e,"barMargin"),t.isHorizontal&&t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._barMargin!==e&&(t._barMargin=e,t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition()))}get resourceMargin(){return null==this._resourceMargin?this.barMargin:this._resourceMargin}set resourceMargin(e){const t=this;ObjectHelper.assertNumber(e,"resourceMargin"),t.isHorizontal&&t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._resourceMargin!==e&&(t._resourceMargin=e,t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition()))}set tickSize(e){ObjectHelper.assertNumber(e,"tickSize"),this.timeAxisViewModel.tickSize=e}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","deep-orange","gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}get widgetClass(){}},TimelineScroll=e=>class extends(e||Base){static get $name(){return"TimelineScroll"}scrollToDate(e,t={}){const r=this,n=r.timeAxisSubGrid.scrollable.viewport,i=r.getCoordinateFromDate(e,!0),s=r.isHorizontal?new Rectangle(r.getCoordinateFromDate(e,!1),n.y,r.timeAxisViewModel.tickSize,n.height):new Rectangle(n.x,r.getCoordinateFromDate(e,!1),n.width,r.timeAxisViewModel.tickSize);return r.scrollToCoordinate(i,s,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}async scrollToCoordinate(e,t,r,n={}){const i=this;if(e<0){const e=(i.timeAxis.endDate-i.timeAxis.startDate)/2,{unit:t,increment:s}=i.timeAxis,o=DateHelper.snap("floor",new Date(r.getTime()-e),s+" "+t),a=DateHelper.snap("ceil",new Date(r.getTime()+e),s+" "+t);return o-i.startDate!=0&&a-i.endDate!=0?(i.setTimeSpan(o,a),i.scrollToDate(r,n)):void 0}return await i.timeAxisSubGrid.scrollable.scrollIntoView(t,n),i.nextAnimationFrame()}set scrollLeft(e){this.timeAxisSubGrid.scrollable.x=e}set scrollTop(e){this.scrollable.y=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.x}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){return this.scrollable.scrollTo(null,e,t)}scrollTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}};const timeAxisColumnConfigs=["viewPreset","eventBarTextField","eventRenderer","eventRendererThisObj","eventBodyTemplate"],exitTransition={fn:"exitTransition",delay:0,cancelOutstanding:!0};class TimelineBase extends(GridBase.mixin(TimelineDateMapper,TimelineDomEvents,TimelineEventRendering,TimelineScroll,TimelineViewPresets,TimelineZoomable,RecurringEvents)){static get $name(){return"TimelineBase"}static get type(){return"timelinebase"}static get configurable(){return{partnerSharedConfigs:{value:["viewPreset","timeAxis","timeAxisViewModel"],$config:{merge:"distinct"}}}}static get defaultConfig(){return{workingTime:null,timeAxis:null,verticalTimeAxisColumn:{},timeAxisViewModel:null,autoAdjustTimeAxis:!0,startDate:null,endDate:null,snap:!1,snapRelativeToEventStartDate:!1,forceFit:!1,suppressFit:!1,eventCls:null,getDateConstraints:null,timeCellCls:null,timeCellSelector:null,scheduledEventName:null,createEventOnDblClick:!0,overScheduledEventClass:null,preventOverCls:!1,hoveredEventNode:null,useBackgroundCanvas:!1,enableEventAnimations:!BrowserHelper.isIE11,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,milestoneLayoutMode:"default",defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit"}}construct(e={}){const t=this,r=e.schedulerRegion||"normal",{subGridConfigs:n={}}=e;e.subGridConfigs=n,n[r]=n[r]||{},n[r].headerClass=Header$1,"flex"in n[r]||"width"in n[r]||(n[r].flex=1),e.startDate&&(e.startDate=DateHelper.parse(e.startDate)),e.endDate&&(e.endDate=DateHelper.parse(e.endDate)),super.construct(e),t.$firstVerticalOverflow=!0,t.onSchedulerViewportResize=t.throttle(t.onSchedulerViewportResize,250),t.initDomEvents(),t.currentOrientation.init(),t.rowManager.on("refresh",(()=>{t.forceLayout=!1}))}doDestroy(){const e=this,{currentOrientation:t}=this;t&&t.destroy(),e.partneredWith&&(e.partneredWith.forEach((t=>{e.removePartner(t)})),e.partneredWith.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),this._thisIsAUsedExpression(this.partner)}refreshVirtualScrollbars(){if(super.refreshVirtualScrollbars(),!this.hasVerticalOverflow){const{scrollable:e}=this;this.partners.some((e=>e.hasVerticalOverflow))?e.overflowY="scroll":e.overflowY=!0}}onPaint({firstPaint:e}){if(e){const{timeAxisSubGrid:e}=this,t=this.isVertical?this.bodyContainer.offsetHeight:e.width;this.timeAxisViewModel.update(t,!1,!0)}super.onPaint([...arguments])}changeSubGridConfigs(e){super.changeSubGridConfigs(e);const t=this,r=t.timeAxisSubGrid=t.subGrids[t.timeAxisColumn.region];r.sealedColumns=!0,r.on({resize:t.onTimeAxisSubGridResize,thisObj:t})}onSchedulerHorizontalScroll(e,t){this.currentOrientation.updateFromHorizontalScroll(t),super.onSchedulerHorizontalScroll(e,t)}initScroll(){const e=this;let t=0;super.initScroll(),BrowserHelper.isMobileSafari&&(e.scrollable.element.style.transform="translate3d(0, 0, 0)"),e.on("horizontalscroll",(({subGrid:r,scrollLeft:n})=>{!e.isPainted||r!==e.timeAxisSubGrid||e.isDestroying||e.refreshSuspended||e.onSchedulerHorizontalScroll(r,n),t++})),"horizontal"===e.testPerformance&&e.setTimeout((()=>{let r=performance.now(),n=5,i=1;const s=e.setInterval((()=>{if(n+=5,e.scrollLeft+=(10+Math.floor(n))*i,1===i&&e.scrollLeft>5500&&(i=-1,n=5),-1===i&&e.scrollLeft<=0){let n=1e3/((performance.now()-r)/t);n=Math.round(10*n)/10,clearInterval(s),console.log(e.eventPositionMode,e.eventScrollMode,n+"fps")}}),0)}),500)}preserveViewCenter(e,t=this,...r){const n=this,i=n.viewportCenterDate,s=e.apply(t,r),{isVertical:o}=n,a=(o?n.scrollable:n.timeAxisSubGrid.scrollable)[o?"clientHeight":"clientWidth"],l=Math.max(Math.floor(n.getCoordinateFromDate(i,!0)-a/2),0);return n.scrollingToCenter=!0,n[o?"scrollVerticallyTo":"scrollHorizontallyTo"](l,!1).then((()=>n.scrollingToCenter=!1)),s}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some((e=>this.timeAxis.isTimeSpanInAxis(e)))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=StringHelper.capitalize(this.scheduledEventName)),this._capitalizedEventName}set partner(e){const t=this,r=t.partneredWith||(t.partneredWith=new Collection);if(t._partner=e,!r.includes(e)){r.add(e),(e.partneredWith||(e.partneredWith=new Collection)).add(t),t.getConfig("viewPreset"),e.on({presetchange:"onPartnerPresetChange",thisObj:t});const n=t.partnerSharedConfigs.reduce(((t,r)=>(t[r]=e[r],t)),{});t.setConfig(n),t.on({presetchange:"onPartnerPresetChange",thisObj:e}),t.initScroll=FunctionHelper.createSequence(t.initScroll,(()=>{t.scrollable.addPartner(e.scrollable,"x")}),t)}}removePartner(e){const t=this,{partneredWith:r}=t;(null==r?void 0:r.includes(e))&&(r.remove(e),e.partneredWith.remove(t),e.scrollable.removePartner(t.scrollable),e.un({presetchange:"onPartnerPresetChange",thisObj:t}),t.un({presetchange:"onPartnerPresetChange",thisObj:e}))}onPartnerPresetChange({preset:e,startDate:t,endDate:r,centerDate:n}){this._viewPresetChanging||this.viewPreset===e||(e.options={startDate:t,endDate:r,centerDate:n},this.viewPreset=e)}get partner(){return this._partner}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.all),e}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}get columns(){return super.columns}set columns(e){const t=this;let r,n,i,s;if(e){const i=Array.isArray(e);let o=e;i||(o=e.data),r=o&&o.length,o.some(((e,i)=>{if("timeAxis"===e.type)return r=i,n=ObjectHelper.assign(e,t.timeAxisColumn),!0})),t.isVertical?(t._horizontalColumns=e,o=[ObjectHelper.assign({type:"verticalTimeAxis",locked:!0,timeline:t},t.verticalTimeAxisColumn),o[r]],r=1):o=o.slice(),n=o[r]=Object.assign({type:"timeAxis",locked:!1,timeline:t,cellCls:t.timeCellCls,mode:t.mode},n),timeAxisColumnConfigs.forEach((e=>{s=t[e],null!=s&&(n[e]=s)})),i?e=o:e.data=o}super.columns=e,e&&(i=t._timeAxisColumn=t.columns.getAt(r),t.isVertical&&(t.verticalTimeAxisColumn=t.columns.getAt(r-1)),i.relayAll(t))}get timeView(){const e=this;return e.columns&&e.isVertical?e.verticalTimeAxisColumn&&e.verticalTimeAxisColumn.view:e.timeAxisColumn&&e.timeAxisColumn.timeAxisView}set eventCls(e){const t=this;t._eventCls=e,t.eventSelector||(t.eventSelector=`.${e}-wrap`,t.unreleasedEventSelector=""+t.eventSelector),t.eventInnerSelector||(t.eventInnerSelector="."+e)}get eventCls(){return this._eventCls}set timeAxisViewModel(e){const t=this,r={update:"onTimeAxisViewModelUpdate",prio:100,thisObj:t};t.partner&&!e||(e&&e.isTimeAxisViewModel?e.on(r):(e=Object.assign({mode:t._mode,snap:t.snap,forceFit:t.forceFit,timeAxis:t.timeAxis,suppressFit:t.suppressFit,listeners:r},e),e=new TimeAxisViewModel(e)),t._timeAxisViewModel=e)}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var e,t;return null!==(e=null===(t=this._timeAxisViewModel)||void 0===t?void 0:t.suppressFit)&&void 0!==e?e:this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){const t=this;t.partner&&!e||(t.detachListeners("timeAxis"),e&&e.isTimeAxis||(e=ObjectHelper.assign({viewPreset:t.viewPreset,autoAdjust:t.autoAdjustTimeAxis,mode:"plain",weekStartDay:t.weekStartDay},e),t.startDate&&(e.startDate=t.startDate),t.endDate&&(e.endDate=t.endDate),t.workingTime&&t.applyWorkingTime(e),e=new TimeAxis(e)),e.on({name:"timeAxis",reconfigure({config:e}){t.trigger("timeAxisChange",{config:e})},thisObj:t}),t._timeAxis=e)}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,r=t._workingTime;if(r){let t=null;r.fromHour>=0&&r.fromHour<24&&r.toHour>r.fromHour&&r.toHour<=24&&r.toHour-r.fromHour<24&&(t={from:r.fromHour,to:r.toHour});let n=null;r.fromDay>=0&&r.fromDay<7&&r.toDay>r.fromDay&&r.toDay<=7&&r.toDay-r.fromDay<7&&(n={from:r.fromDay,to:r.toDay}),e.include=t||n?{hour:t,day:n}:null}else e.include=null;var n;t.isPainted&&(t.timeAxisColumn.refreshHeader(),null===(n=t.features.columnLines)||void 0===n||n.refresh(),t.refreshWithTransition())}set startDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const r=this,n=r._timeAxis||{},{startDate:i,endDate:s,mainUnit:o}=n;if("string"==typeof e&&(e=DateHelper.parse(e)),r._timeAxis&&s){if(e){let r=s;if(t&&i){const t=DateHelper.diff(i,s,o,!0);r=DateHelper.add(e,t,o)}n.setTimeSpan(e,r)}}else r._tempStartDate=e}get startDate(){const e=this;return e._timeAxis?e._timeAxis.startDate:e._tempStartDate||new Date}set endDate(e){this.setEndDate(e)}setEndDate(e,t=!1){const r=this,n=r._timeAxis||{},{startDate:i,endDate:s,mainUnit:o}=n;if("string"==typeof e&&(e=DateHelper.parse(e)),r._timeAxis&&i){if(e){let r=i;if(t&&s){const t=DateHelper.diff(i,s,o,!0);r=DateHelper.add(e,-t,o)}n.setTimeSpan(r,e)}}else r._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||DateHelper.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}get features(){return super.features}set features(e){"regionResize"in(e=!0===e?{}:e)||(e.regionResize=!0),super.features=e}get eventStyle(){return this._eventStyle}set eventStyle(e){const t=this;t._eventStyle=e,t.isPainted&&t.refreshWithTransition()}get eventColor(){return this._eventColor}set eventColor(e){const t=this;t._eventColor=e,t.isPainted&&t.refreshWithTransition()}onLocaleChange(){super.onLocaleChange(),this.timeAxisColumn.refreshHeader()}onInternalResize(e,t,r,n,i){const s=this._bodyRectangle;super.onInternalResize(e,t,r,n,i),!s||r===i&&t===n||this.onSchedulerViewportResize(t,r,s.width,s.height)}onTimeAxisSubGridResize({width:e,height:t,oldWidth:r,oldHeight:n}){const i=this;if(i.isPainted&&e!==r){const t=i._bodyRectangle;i.hasVerticalOverflow&&i.$firstVerticalOverflow?(i.onSchedulerViewportResize.now(e,t.height,r,t.height),i.$firstVerticalOverflow=!1):i.onSchedulerViewportResize(e,t.height,r,t.height)}}onSchedulerViewportResize(e,t,r,n){if(this.isPainted){const i=this,s=i.timeAxisSubGrid;i.currentOrientation.onViewportResize(e,t,r,n),null!=i._lastOverflow&&i._lastOverflow!==s.overflowingHorizontally||(i.setTimeout((()=>{i.timeAxisViewModel.availableSpace=i.isHorizontal?s.width:i._bodyRectangle.height}),0),i.partneredWith&&!i.isSyncingFromPartner&&i.partneredWith.forEach((e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,i.eachSubGrid((t=>{const r=e.subGrids[t.region];r.width!==t.width&&(t.collapsed?r.collapse():(r.collapsed&&r.expand(),t.flex?t.flex!==r.flex&&(r.flex=t.flex):r.width=t.width))})),e.isSyncingFromPartner=!1)}))),i.trigger("timelineViewportResize",{width:e,height:t,oldWidth:r,oldHeight:n}),i._lastOverflow=s.overflowingHorizontally}}onTimeAxisViewModelUpdate(){this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate()}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",IdHelper.generateId("svg")),t.retainElement=!0,e.foregroundCanvas.appendChild(t),e.trigger("svgCanvasCreated")}return e._svgCanvas}get timeAxisSubGridElement(){return this.getConfig("regions"),this.timeAxisColumn&&this.timeAxisColumn.subGridElement}updateCanvasSize(){const e=this,t=e.isHorizontal?e.timeAxisViewModel.totalSize:e.timeAxisColumn.width;let r=!1;return e.isVertical&&e.suppressFit&&(DomHelper.setLength(e.foregroundCanvas,"height",e.timeAxisViewModel.totalSize),r=!0),t!==e.$canvasWidth&&(e.backgroundCanvas&&DomHelper.setLength(e.backgroundCanvas,"width",t),DomHelper.setLength(e.foregroundCanvas,"width",t),e.$canvasWidth=e.timeAxisViewModel.totalSize,r=!0),r}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}refresh(e=!0){const t=this;t.isPainted&&!t.refreshSuspended&&(t.hasVisibleEvents?t.isEngineReady?t.refreshRows(!1,e):(t.refreshAfterProjectRefresh=!0,t.currentOrientation.refreshAllWhenReady=!0):t.rowManager.trigger("refresh"))}render(){const e=this,t=e.timeAxisSubGridElement;e.useBackgroundCanvas&&(e._backgroundCanvas=DomHelper.createElement({className:"b-sch-background-canvas",parent:t,nextSibling:t.firstElementChild}));const r=e._foregroundCanvas=DomHelper.createElement({className:"b-sch-foreground-canvas",style:`font-size:${e.rowHeight-2*e.resourceMargin}px`,parent:t});e.timeAxisSubGrid.insertRowsBefore=r,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments)}refreshRows(e=!1,t=!0){this.isConfiguring||(this.currentOrientation.refreshRows(t),super.refreshRows(e))}getDateConstraints(){}runWithTransition(e,t){const r=this;r.isVisible&&(null!=t&&!0!==t||(t=r.transitionDuration),t&&r.enableEventAnimations&&(r.isAnimating=!0,exitTransition.delay=t,r.setTimeout(exitTransition))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForTransition(){if(this.isAnimating)return this.await("transitionend")}refreshWithTransition(e,t){this.runWithTransition((()=>this.refresh(e)),t)}getVisibleDateRange(){return VersionHelper.deprecate("scheduler","5.0.0","Deprecated in favor of `get visibleDateRange`"),this.visibleDateRange}get visibleDateRange(){return this.currentOrientation.visibleDateRange}formatDuration(e,t=this.durationDisplayPrecision){const r=Math.pow(10,t);return Math.round(e*r)/r}}TimelineBase.initClass(),VersionHelper.setVersion("scheduler","4.0.2"),TimelineBase._$name="TimelineBase";const locale$3=LocaleHelper.mergeLocales(locale$2,{ResourceInfoColumn:{eventCountText:function(e){return e+" event"+(1!==e?"s":"")}},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-End",EndToStart:"End-to-Start",EndToEnd:"End-to-End",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-End","End-to-Start","End-to-End"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit event",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event"},HeaderContextMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST"},weekAndDay:{displayDateFormat:"ll LST"},dayAndWeek:{displayDateFormat:"ll LST"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:e})=>"Weekly on "+e,"Monthly on {1}":({days:e})=>"Monthly on "+e,"Yearly on {1} of {2}":({days:e,months:t})=>`Yearly on ${e} of ${t}`,"Every {0} days":({interval:e})=>`Every ${e} days`,"Every {0} weeks on {1}":({interval:e,days:t})=>`Every ${e} weeks on ${t}`,"Every {0} months on {1}":({interval:e,days:t})=>`Every ${e} months on ${t}`,"Every {0} years on {1} of {2}":({interval:e,days:t,months:r})=>`Every ${e} years on ${t} of ${r}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:e,days:t})=>`${e} ${t}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each","On the":"On the","End repeat":"End repeat","time(s)":"time(s)"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":e=>"Summary for "+e},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"}});LocaleManagerSingleton.registerLocale("En",{desc:"English",locale:locale$3});var SchedulerDom=e=>class extends(e||Base){static get $name(){return"SchedulerDom"}getElementFromAssignmentRecord(e,t=!1){return this.currentOrientation.getElementFromAssignmentRecord(e,t)}getElementFromEventRecord(e,t,r=!1){return this.currentOrientation.getElementFromEventRecord(e,t,r)}getElementsFromEventRecord(e,t,r=!1){return this.currentOrientation.getElementsFromEventRecord(e,t,r)}resolveResourceRecord(e,t){return this.currentOrientation.resolveRowRecord(e,t)}resolveEventRecord(e){if(e=DomHelper.up(e,this.eventSelector)){if(e.dataset.eventId)return this.eventStore.getById(e.dataset.eventId);if(e.dataset.assignmentId)return this.assignmentStore.getById(e.dataset.assignmentId).event}return null}resolveTimeSpanRecord(e){return this.resolveEventRecord(e)}resolveAssignmentRecord(e){const t=DomHelper.up(e,this.eventSelector),r=t&&this.assignmentStore.getById(t.dataset.assignmentId),n=t&&this.eventStore.getById(t.dataset.eventId);return this.assignmentStore.getOccurrence(r,n)}isRowVisible(e){return this.store.indexOf(e)>=0}getMilestoneLabelWidth(e){const t=this,r=t.milestoneLayoutMode;if("measure"===r){const r=t.milestoneMeasureElement||(t.milestoneMeasureElement=DomHelper.createElement({className:"b-sch-event-wrap b-milestone-wrap b-measure",children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content"}]}],parent:t.foregroundCanvas}));return r.retainElement=!0,r.firstElementChild.firstElementChild.innerHTML=e.name,r.offsetWidth}return"estimate"===r?Math.max(e.name.length*t.milestoneCharWidth,t.milestoneMinWidth):"data"===r?Math.max(e.milestoneWidth,t.milestoneMinWidth):0}set milestoneLayoutMode(e){this._milestoneLayoutMode=e,this.element.classList["default"!==e?"add":"remove"]("b-sch-layout-milestones"),this.isConfiguring||this.refreshWithTransition()}get milestoneLayoutMode(){return this._milestoneLayoutMode}set milestoneAlign(e){this._milestoneAlign=e,this.isConfiguring||this.refreshWithTransition()}get milestoneAlign(){return this._milestoneAlign}set milestoneCharWidth(e){this._milestoneCharWidth=e,this.isConfiguring||this.refreshWithTransition()}get milestoneCharWidth(){return this._milestoneCharWidth}get widgetClass(){}},SchedulerDomEvents=e=>class extends(e||Base){static get $name(){return"SchedulerDomEvents"}getTimeSpanMouseEventParams(e,t){const r=this.resolveEventRecord(e);return r&&{eventRecord:r,resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:t}}getScheduleMouseEventParams(e,t){return{resourceRecord:this.isVertical?this.resolveResourceRecord(t):this.store.getById(e.id)}}onElementKeyDown(e){super.onElementKeyDown(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyDown",{eventRecord:t.selectedEvents,assignmentRecord:t.selectedAssignments})}onElementKeyUp(e){super.onElementKeyUp(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyUp",{eventRecord:t.selectedEvents,assignmentRecord:t.selectedAssignments})}get widgetClass(){}},SchedulerDragResize=e=>class extends(e||Base){static get $name(){return"SchedulerDragResize"}construct(e){super.construct(e),this.hasFeature("eventDragCreate")&&this.on({dragCreateEnd:"internalOnDragCreateEnd",thisObj:this})}internalOnDragCreateEnd({newEventRecord:e,resourceRecord:t}){const r=this;if((!r.hasFeature("eventEdit")||r.features.eventEdit.disabled)&&(!r.hasFeature("taskEdit")||r.features.taskEdit.disabled)){const n=t?[t]:[];!1!==r.trigger("beforeEventAdd",{eventRecord:e,resources:n,resourceRecords:n})&&(r.onEventCreated(e),r.eventStore.add(e),e.assign(t))}}get eventEditor(){return this._eventEditor}set eventEditor(e){this._eventEditor=e}get widgetClass(){}};class HorizontalLayout extends Base{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}getNumberOfBands(e,t){const r=this.nbrOfBandsByResource;if(r.hasOwnProperty(e.id))return r[e.id];const n=("function"==typeof t?t():t).map((e=>({start:e.startDate,end:e.endDate,event:e})));return this.applyLayout(n,e)}applyLayout(e,t){const r=e.slice(),n=this.layoutEventsInBands(r);return this.nbrOfBandsByResource[t.id]=n}}HorizontalLayout._$name="HorizontalLayout";class HorizontalLayoutStack extends HorizontalLayout{layoutEventsInBands(e){let t=0;do{let r=0,n=e[0];for(;n;)n.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,t,n.eventRecord),e.splice(r,1),r=this.findClosestSuccessor(n,e),n=e[r];t++}while(e.length>0);return t}findClosestSuccessor(e,t){const r=e.endMS,n=e.eventRecord&&0===e.eventRecord.duration;let i,s,o,a=1/0;for(let e=0,l=t.length;e<l;e++)o=t[e],s=o.startMS-r,s>=0&&s<a&&(s>0||o.endMS-o.startMS>0||!n)&&(i=e,a=s);return i}}HorizontalLayoutStack._$name="HorizontalLayoutStack";var PackMixin=e=>class extends(e||Base){static get $name(){return"PackMixin"}static get defaultConfig(){return{coordProp:"top",sizeProp:"height"}}applyLayout(e,t){const r=this,{coordProp:n,sizeProp:i}=r;let s,o,a,l;for(let c=0,d=e.length;c<d;c++){if(o=e[c],s=r.findStartSlot(e,o),a=r.getCluster(e,c),a.length>1){for(o[n]=s.start,o[i]=s.end-s.start,l=1;l<a.length-1&&a[l+1].start-o.start==0;)l++;const t=r.findStartSlot(e,a[l]);t&&t.start<.8&&(a.length=l)}const d=a.length,u=(s.end-s.start)/d;for(l=0;l<d;l++)t(a[l],l,s,u);c+=d-1}}findStartSlot(e,t){const{sizeProp:r,coordProp:n}=this,i=this.getPriorOverlappingEvents(e,t);let s;if(0===i.length)return{start:0,end:1};for(s=0;s<i.length;s++){if(0===s&&i[0][n]>0)return{start:0,end:i[0][n]};if(i[s][n]+i[s][r]<(s<i.length-1?i[s+1][n]:1))return{start:i[s][n]+i[s][r],end:s<i.length-1?i[s+1][n]:1}}return!1}getPriorOverlappingEvents(e,t){const r=t.start,n=t.end,i=[];for(let s=0,o=e.indexOf(t);s<o;s++)DateHelper.intersectSpans(r,n,e[s].start,e[s].end)&&i.push(e[s]);return i.sort(this.sortOverlappers.bind(this)),i}sortOverlappers(e,t){return e[this.coordProp]<t[this.coordProp]?-1:1}getCluster(e,t){const r=e[t];if(t>=e.length-1)return[r];const n=[r],i=e.length;let{start:s,end:o}=r,a=t+1;for(;a<i&&DateHelper.intersectSpans(s,o,e[a].start,e[a].end);)n.push(e[a]),s=DateHelper.max(s,e[a].start),o=DateHelper.min(e[a].end,o),a++;return n}};class HorizontalLayoutPack extends(PackMixin(HorizontalLayout)){applyLayout(e){super.applyLayout(e,((e,t,r,n)=>{e.height=n,e.top=r.start+t*n})),e.forEach((e=>{Object.assign(e,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,e.top,e.height,null,e.eventRecord))}))}}HorizontalLayoutPack._$name="HorizontalLayoutPack";var SchedulerEventRendering=e=>class extends(e||Base){static get $name(){return"SchedulerEventRendering"}static get defaultConfig(){return{eventRenderer:null,eventRendererThisObj:null,eventPrefix:"",eventLayout:"stack",horizontalLayoutPackClass:HorizontalLayoutPack,horizontalLayoutStackClass:HorizontalLayoutStack,horizontalEventSorterFn:null,eventBarTextField:"name",eventBodyTemplate:null,eventPositionMode:"translate",eventScrollMode:"move",fillTicks:!1,useInitialAnimation:!0,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:"none.png",resourceImageExtension:".jpg",resourceMargin:null,isFirstRender:!0,initialAnimationDuration:2e3}}get eventPrefix(){return this._eventPrefix}set eventPrefix(e){this._eventPrefix=e||this.id+"-"}get layouts(){const e=this;return e._eventLayout||(e._eventLayout={},e.horizontalLayoutPackClass&&(e._eventLayout.horizontalPack=new e.horizontalLayoutPackClass(Object.assign({scheduler:e,timeAxisViewModel:e.timeAxisViewModel,bandIndexToPxConvertFn:e.horizontal.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:e.horizontal}))),e.horizontalLayoutStackClass&&(e._eventLayout.horizontalStack=new e.horizontalLayoutStackClass(Object.assign({scheduler:e,timeAxisViewModel:e.timeAxisViewModel,bandIndexToPxConvertFn:e.horizontal.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:e.horizontal})))),e._eventLayout}get eventLayout(){return this._overlapMode}set eventLayout(e){const t=this;e!==t._overlapMode&&(t.element.classList.remove("b-eventlayout-"+t._overlapMode),t._overlapMode=e,t.element.classList.add("b-eventlayout-"+e),t.isConfiguring||t.refreshWithTransition())}get fillTicks(){return this._fillTicks}set fillTicks(e){e!==this._fillTicks&&(this._fillTicks=e,this.isConfiguring||this.refreshWithTransition())}get currentEventLayout(){const e=this;if(!e.isHorizontal)return null;switch(e.eventLayout){case"stack":return e.layouts.horizontalStack;case"pack":return e.layouts.horizontalPack;default:return null}}get useInitialAnimation(){return this._useInitialAnimation}set useInitialAnimation(e){const t=this;t._useInitialAnimation&&t.element.classList.remove("b-initial-"+t._useInitialAnimation),t._useInitialAnimation=!0===e?"fade-in":e,e&&(t.element.classList.add("b-initial-"+t._useInitialAnimation),BrowserHelper.isFirefox&&t.element.classList.add("b-prevent-event-transitions"))}set horizontalEventSorterFn(e){this._horizontalEventSorterFn=e,this.rendered&&this.refreshWithTransition()}get horizontalEventSorterFn(){return this._horizontalEventSorterFn}set resourceColumns(e){this._resourceColumns=e}get resourceColumns(){var e;return(null===(e=this.timeAxisColumn)||void 0===e?void 0:e.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){return this.resourceColumns?this.resourceColumns.columnWidth:null}getEventsToRender(e,t){return t}repaintEventsForResource(e){this.currentOrientation.repaintEventsForResource(e)}repaintEvent(e){this.eventStore.getResourcesForEvent(e).forEach((e=>this.repaintEventsForResource(e)))}generateRenderData(e,t,r={viewport:!0}){const n=this,i=n.currentOrientation.getTimeSpanRenderData(e,t,r),{isEvent:s,isMilestone:o}=e,a=s&&e.assignments.find((e=>e.resourceId===t.id)),l={className:"b-sch-event-content",dataset:{taskBarFeature:"content"}};if(i){let r=e.isResizable;i.startsOutsideView&&(!0===r?r="end":"start"===r&&(r=!1)),i.endsOutsideView&&(!0===r?r="start":"end"===r&&(r=!1));const d=e.isResourceTimeRange?new DomClassList:e.cls.clone(),u=e.isResourceTimeRange?e.cls.clone():new DomClassList;if(Object.assign(d,{[t.cls]:t.cls,[n.generatedIdCls]:e.hasGeneratedId,[n.dirtyCls]:Boolean(e.hasPersistableChanges||a&&a.hasPersistableChanges),[n.committingCls]:e.isCommitting,[n.endsOutsideViewCls]:i.endsOutsideView,[n.startsOutsideViewCls]:i.startsOutsideView,"b-clipped-start":i.clippedStart,"b-clipped-end":i.clippedEnd}),Object.assign(u,{[n.eventCls+"-parent"]:t.isParent}),i.wrapperStyle="",s){const s=a&&n.isAssignmentSelected(a);Object.assign(d,{[n.eventCls]:1,"b-milestone":o,"b-sch-event-narrow":i.width<10,[n.fixedEventCls]:!1===e.isDraggable,["b-sch-event-resizable-"+r]:Boolean(n.features.eventResize),[n.eventSelectedCls]:s,[n.eventAssignHighlightCls]:n.isEventSelected(e)&&!s,"b-recurring":e.isRecurring,"b-occurrence":e.isOccurrence}),i.eventId=e.id;const l=e.eventStyle||t.eventStyle||n.eventStyle,c=e.eventColor||t.eventColor||n.eventColor,h=n.isFirstRender&&n.useInitialAnimation;if(Object.assign(u,{[n.eventCls+"-wrap"]:1,"b-milestone-wrap":o}),h){const e=i.row?i.row.index:i.top/n.tickSize;i.wrapperStyle=`animation-delay: ${e/20}s;`,n.initialAnimationDetacher||(n.initialAnimationDetacher=EventHelper.on({element:n.foregroundCanvas,delegate:n.eventSelector,animationend:"stopInitialAnimation",expires:{alt:"stopInitialAnimation",delay:n.initialAnimationDuration},thisObj:n}))}i.eventColor=c,i.eventStyle=l,i.assignmentRecord=i.assignment=a}if(i.wrapperCls=u,i.cls=d,i.iconCls=new DomClassList(e.get(n.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(i.style="",i.wrapperStyle+=e.style||""):i.style=e.style||"",i.resource=i.resourceRecord=t,i.resourceId=i.rowId,s){let r,s=null,a=null;if(n.eventRenderer){const s=n.eventRenderer.call(n.eventRendererThisObj||n,{eventRecord:e,resourceRecord:t,assignmentRecord:i.assignmentRecord,tplData:i,renderData:i});"string"==typeof i.cls&&(i.cls=new DomClassList(i.cls)),"string"==typeof i.wrapperCls&&(i.wrapperCls=new DomClassList(i.wrapperCls)),"string"==typeof i.iconCls&&(i.iconCls=new DomClassList(i.iconCls)),r=n.eventBodyTemplate?n.eventBodyTemplate(s):s}else n.eventBodyTemplate?r=n.eventBodyTemplate(e):n.eventBarTextField&&(r=e[n.eventBarTextField]||"");var c;if(n.eventBodyTemplate)l.html=r,i.children.push(l);else l.children=[],o&&"default"===n.milestoneLayoutMode&&null!=r&&""!==r&&l.children.unshift(a={tag:"label",children:[]}),(null===(c=i.iconCls)||void 0===c?void 0:c.length)&&l.children.unshift({tag:"i",className:i.iconCls}),Array.isArray(r)?(a||l).children.push(...r):"string"==typeof r&&r.includes("<")?s={html:r}:"string"==typeof r||"object"==typeof r?s=r:null!=r&&(s=String(r)),null!=s&&((a||l).children.push(s),i.cls.add("b-has-content")),l.children.length&&i.children.push(l);const{eventStyle:d,eventColor:u}=i;if(i.wrapperCls["b-sch-style-"+d]=d,null==u?void 0:u.startsWith("#")){const e=d?"color":"background-color";i.style=`${e}:${u};`+i.style,i.wrapperCls["b-sch-custom-color"]=1}else i.wrapperCls["b-sch-color-"+u]=u;i.style&&o&&l&&(l.style=i.style,delete i.style)}i.cls["b-sch-event-withicon"]=i.iconCls.length,i.eventContent=l,i.wrapperChildren=[],n.onEventDataGenerated(i)}return i}onEventDataGenerated(e){}restartInitialAnimation(e){var t;const r=this;null===(t=r.initialAnimationDetacher)||void 0===t||t.call(r),r.initialAnimationDetacher=null,r.useInitialAnimation=e,r.isFirstRender=!0,r.refresh()}stopInitialAnimation(){const e=this;e.initialAnimationDetacher(),e.isFirstRender=!1,e.useInitialAnimation=!1,BrowserHelper.isFirefox&&e.setTimeout((()=>e.element.classList.remove("b-prevent-event-transitions")),100)}get widgetClass(){}},ProjectModelMixin=e=>class extends(e||Model){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},eventModelClass:EventModel,dependencyModelClass:DependencyModel,timeRangeModelClass:TimeSpan,resourceTimeRangeModelClass:ResourceTimeRangeModel,resourceModelClass:ResourceModel,assignmentModelClass:AssignmentModel,eventStoreClass:EventStore,dependencyStoreClass:DependencyStore,resourceStoreClass:ResourceStore,assignmentStoreClass:AssignmentStore,timeRangeStoreClass:Store,resourceTimeRangeStoreClass:ResourceTimeRangeStore,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangeStore:null,resourceTimeRangeStore:null}}construct(e={}){super.construct(...arguments);const t=this;t.timeRangeStore||(t.timeRangeStore=new t.timeRangeStoreClass({modelClass:t.timeRangeModelClass,storeId:"timeRanges"})),t.resourceTimeRangeStore||(t.resourceTimeRangeStore=new t.resourceTimeRangeStoreClass({modelClass:t.resourceTimeRangeModelClass})),t.resourceTimeRangesData&&(t.resourceTimeRangeStore.data=t.resourceTimeRangesData),t.timeRangesData&&(t.timeRangeStore.data=t.timeRangesData)}toJSON(){const e=this,t={eventsData:e.eventStore.toJSON(),resourcesData:e.resourceStore.toJSON(),dependenciesData:e.dependencyStore.toJSON()};return e.eventStore.usesSingleAssignment||(t.assignmentsData=e.assignmentStore.toJSON()),t}get json(){return super.json}set json(e){"string"==typeof e&&(e=StringHelper.safeJsonParse(e)),this.loadInlineData(e)}afterChange(e,t){super.afterChange(...arguments),t.calendar&&this.trigger("calendarChange")}};class ModelPersistencyManager extends Base{set eventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.on({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.on({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.on({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.on({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){let t,r,n=e.added||[];for(r=n.length-1;r>=0;--r)t=n[r],t.isPersistable||n.splice(n.indexOf(t),1);0===n.length&&(e.added.length=0)}shallContinueSync(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}}ModelPersistencyManager._$name="ModelPersistencyManager";class Schema extends Base$1{constructor(){super(...arguments),this.entities=new Map}hasEntity(e){return this.entities.has(e)}getEntity(e){return this.entities.get(e)}addEntity(e){const t=e.name;if(!t)throw new Error("Entity must have a name");if(this.hasEntity(t))throw new Error(`Entity with name [${String(t)}] already exists`);return e.schema=this,this.entities.set(t,e),e}getEntityDecorator(){return e=>{const t=entityDecoratorBody(e);return this.addEntity(t),e}}}const entityDecoratorBody=e=>{if(!e.name)throw new Error("Can't add entity - the target class has no name");return ensureEntityOnPrototype(e.prototype)};var __decorate$e=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const ConflictSymbol=Symbol("ConflictSymbol");var ConflictResolutionResult;!function(e){e.Cancel="Cancel",e.Resume="Resume"}(ConflictResolutionResult||(ConflictResolutionResult={}));class ConflictEffect extends Effect{constructor(){super(...arguments),this.handler=ConflictSymbol}}__decorate$e([prototypeValue(!1)],ConflictEffect.prototype,"sync",void 0);class EngineRevision extends Revision{constructor(){super(...arguments),this.failedResolutionReferences=new Map}}class EngineTransaction extends Transaction$1{constructor(){super(...arguments),this.candidateClass=EngineRevision}initialize(...e){super.initialize(...e),this.candidate.failedResolutionReferences=new Map(this.baseRevision.failedResolutionReferences)}addIdentifier(e,t,...r){return this.markFailedResolutionReferences(),super.addIdentifier(e,t,...r)}markFailedResolutionReferences(){this.candidate.failedResolutionReferences.forEach(((e,t)=>{this.write(t,e)})),this.candidate.failedResolutionReferences.clear()}}class EngineReplica extends(Mixin([Replica],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.baseRevision=EngineRevision.new(),this.transactionClass=EngineTransaction,this.autoCommitMode="async",this.onComputationCycle="reject",this.silenceInitialCommit=!0,this.ignoreInitialCommitComputationCycles=!0}onPropagationProgressNotification(e){this.enableProgressNotifications&&this.project&&this.project.trigger("progress",e)}propagate(e){return this.commitAsync(e)}async commitAsync(e){this.project.trigger("beforeCommit"),this.isInitialCommit&&this.ignoreInitialCommitComputationCycles&&(this._onComputationCycle=this._onComputationCycle||this.onComputationCycle,this.onComputationCycle="ignore");const r=this.project.beforeCommitAsync();return r||t.commitAsync.call(this,e)}get isInitialCommit(){return this.project.isInitialCommit||super.isInitialCommit}set isInitialCommit(e){super.isInitialCommit=e}async finalizeCommitAsync(e){const{project:t}=this;if(!t||t.isDestroyed)return;const{entries:r}=e,n=new Set;BrowserHelper.global.DEBUG&&console.timeEnd("Time to visible");const{isInitialCommit:i,silenceInitialCommit:s}=this,o=i&&s;i&&(t.isInitialCommitPerformed=!0,this.ignoreInitialCommitComputationCycles&&(this.onComputationCycle=this._onComputationCycle)),t.isWritingData=!0,t.hasLoadedDataToCommit=!1,t.trigger("refresh",{isInitialCommit:i}),await new Promise((s=>{setTimeout((()=>{var a,l;if(!t.isDestroyed&&!e.transaction.rejectedWith){null===(a=t.suspendChangesTracking)||void 0===a||a.call(t),BrowserHelper.global.DEBUG&&console.time("Finalize propagation");const e=new Set;for(const t of r.values()){const r=t.identifier,i=t.getValue(),{field:s}=r;if(t.isShadow()||!r[IsChronoModelSymbol]||i===TombStone||s instanceof ModelBucketField)continue;const o=r.self,a=o.firstStore;e.has(o)||(o.beginBatch(),e.add(o)),(null==a?void 0:a.autoCommit)&&!n.has(a)&&(a.suspendAutoCommit(),n.add(a)),o.set(s.name,i)}for(const t of e)t.ignoreBag=o,t.endBatch(o,!0),t.ignoreBag=!1;BrowserHelper.global.DEBUG&&console.timeEnd("Finalize propagation"),t.trigger("dataReady",{records:e,isInitialCommit:i}),null===(l=t.resumeChangesTracking)||void 0===l||l.call(t,o),n.forEach((e=>e.resumeAutoCommit())),o&&[t.eventStore,t.dependencyStore,t.resourceStore,t.assignmentStore,t.calendarManagerStore].forEach((e=>e.acceptChanges()))}t.isWritingData=!1,s()}),0)}))}async[ConflictSymbol](e,t){return this.project.onSchedulingConflict(e,t)}[RejectSymbol](e,t){return super[RejectSymbol](e,t)}}}))){}var __decorate$f=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class DurationConverterMixin extends(Mixin([ChronoModelMixin],(e=>{e.prototype;class t extends e{*calculateUnitsInMs(){const e=yield this.$.hoursPerDay,t=yield this.$.daysPerWeek,r=yield this.$.daysPerMonth;return{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:60*e*60*1e3,week:t*e*60*60*1e3,month:r*e*60*60*1e3,quarter:3*r*e*60*60*1e3,year:12*r*e*60*60*1e3}}convertDuration(e,t,r){let n=e;return t!==r&&(n=e*this.unitsInMs[t]/this.unitsInMs[r]),n}*$convertDuration(e,t,r){if(!t||!r)throw new Error("Conversion unit not provided");const n=yield this.$.unitsInMs;let i=e;return t!==r&&(i=e*n[t]/n[r]),i}}return __decorate$f([field()],t.prototype,"unitsInMs",void 0),__decorate$f([model_field({type:"number",defaultValue:24})],t.prototype,"hoursPerDay",void 0),__decorate$f([model_field({type:"number",defaultValue:7})],t.prototype,"daysPerWeek",void 0),__decorate$f([model_field({type:"number",defaultValue:30})],t.prototype,"daysPerMonth",void 0),__decorate$f([calculate("unitsInMs")],t.prototype,"calculateUnitsInMs",null),t}))){}class AbstractCalendarManagerStoreMixin extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{}}))){}class ChronoCalendarManagerStoreMixin extends(Mixin([AbstractCalendarManagerStoreMixin,ChronoPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{tree:!0,modelClass:BaseCalendarMixin}}}}))){}class EventsWrapper extends(Mixin([],Events)){}class DelayableWrapper extends(Mixin([],Delayable)){}class AbstractProjectMixin extends(Mixin([EventsWrapper,DelayableWrapper,Model],(e=>{const t=e.prototype;return class extends e{get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(e={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1,t.construct.call(this,e),this.silenceInitialCommit=!("silenceInitialCommit"in e)||e.silenceInitialCommit}repopulateStore(e){}repopulateReplica(){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}}}))){}class ChronoAbstractProjectMixin extends(Mixin([ChronoModelMixin,AbstractProjectMixin],(e=>{e.prototype;return class extends e{getGraph(){return this.replica}beforeCommitAsync(){return null}async commitAsync(){return this.replica.commitAsync()}async onSchedulingConflict(e,t){return this.hasListener("schedulingConflict")?new Promise(((t,r)=>{this.trigger("schedulingConflict",{continueWithResolutionResult:t,conflict:e})})):ConflictResolutionResult.Cancel}}}))){}class HasSubEventsMixin extends(Mixin([BaseEventMixin],(e=>{const t=e.prototype;return class extends e{*hasSubEvents(){throw new Error("Abstract method `hasSubEvents` has been called")}*subEventsIterable(){throw new Error("Abstract method `subEventsIterable` has been called")}*calculateStartDatePure(){const e=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!e&&r?yield*this.calculateMinChildrenStartDate():yield*t.calculateStartDatePure.call(this)}*calculateEndDatePure(){const e=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!e&&r?yield*this.calculateMaxChildrenEndDate():yield*t.calculateEndDatePure.call(this)}*calculateStartDateProposed(){const e=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!e&&r?yield*this.calculateStartDatePure():yield*t.calculateStartDateProposed.call(this)}*calculateEndDateProposed(){const e=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!e&&r?yield*this.calculateEndDatePure():yield*t.calculateEndDateProposed.call(this)}*calculateDurationProposed(){const e=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!e&&r?yield*this.calculateDurationPure():yield*t.calculateDurationProposed.call(this)}*calculateMinChildrenStartDate(){const e=yield*this.subEventsIterable(),t=[];for(const r of e)t.push(yield r.$.startDate);let r=t.reduce(((e,t)=>t?Math.min(e,t.getTime()):e),MAX_DATE.getTime());return r===MIN_DATE$1.getTime()||r===MAX_DATE.getTime()?null:new Date(r)}*calculateMaxChildrenEndDate(){const e=yield*this.subEventsIterable(),t=[];for(const r of e)t.push(yield r.$.endDate);let r=t.reduce(((e,t)=>t?Math.max(e,t.getTime()):e),MIN_DATE$1.getTime());return r===MIN_DATE$1.getTime()||r===MAX_DATE.getTime()?null:new Date(r)}}}))){}var _window$bryntum$8,__decorate$g=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class SchedulerBasicProjectMixin extends(MixinAny([ChronoAbstractProjectMixin,BaseEventMixin,HasSubEventsMixin,HasCalendarMixin,DurationConverterMixin,CanCombineCalendarsMixin],(e=>{const t=e.prototype;class r extends e{construct(e={}){this.enableProgressNotifications=e.enableProgressNotifications,"expanded"in e||(e.expanded=!0),t.construct.call(this,e),this.ignoreInitialCommitComputationCycles=!("ignoreInitialCommitComputationCycles"in e)||e.ignoreInitialCommitComputationCycles,!1!==this.repopulateOnDataset&&(this.repopulateOnDataset=!0),this.eventModelClass||(this.eventModelClass=this.getDefaultEventModelClass()),this.eventStoreClass||(this.eventStoreClass=this.getDefaultEventStoreClass()),this.dependencyModelClass||(this.dependencyModelClass=this.getDefaultDependencyModelClass()),this.dependencyStoreClass||(this.dependencyStoreClass=this.getDefaultDependencyStoreClass()),this.resourceModelClass||(this.resourceModelClass=this.getDefaultResourceModelClass()),this.resourceStoreClass||(this.resourceStoreClass=this.getDefaultResourceStoreClass()),this.assignmentModelClass||(this.assignmentModelClass=this.getDefaultAssignmentModelClass()),this.assignmentStoreClass||(this.assignmentStoreClass=this.getDefaultAssignmentStoreClass()),this.calendarModelClass||(this.calendarModelClass=this.getDefaultCalendarModelClass()),this.calendarManagerStoreClass||(this.calendarManagerStoreClass=this.getDefaultCalendarManagerStoreClass()),this.replica=this.createReplica(),this.replica.addEntity(this),this.defaultCalendar=new this.calendarModelClass({unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this,this.replica.addEntity(this.defaultCalendar);const r=this.stm=new StateTrackingManager(Object.assign({disabled:!0},this.stm));let n;this.stm.on({restoringStop:async()=>{this.stm.disable(),await this.commitAsync(),this.isDestroyed||(this.stm.enable(),this.trigger("stateRestoringDone"))}}),this.on({beforeCommit(){r.isRecording&&r.autoRecord&&(n=!0,r.autoRecord=!1)},dataReady(){n&&(r.autoRecord=!0,n=!1)}}),this.setCalendarManagerStore(this.calendarManagerStore),this.setEventStore(this.eventStore),this.setDependencyStore(this.dependencyStore),this.setResourceStore(this.resourceStore),this.setAssignmentStore(this.assignmentStore);Boolean(this.calendarsData||this.eventsData||this.dependenciesData||this.resourcesData||this.assignmentsData)&&(this.loadInlineData({calendarsData:this.calendarsData,eventsData:this.eventsData,dependenciesData:this.dependenciesData,resourcesData:this.resourcesData,assignmentsData:this.assignmentsData}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData)}doDestroy(){var e,r,n,i,s,o;const a=this;null===(e=a.eventStore)||void 0===e||e.destroy(),null===(r=a.dependencyStore)||void 0===r||r.destroy(),null===(n=a.assignmentStore)||void 0===n||n.destroy(),null===(i=a.resourceStore)||void 0===i||i.destroy(),null===(s=a.calendarManagerStore)||void 0===s||s.destroy(),a.replica.clear(),null===(o=a.stm)||void 0===o||o.destroy(),t.doDestroy.call(this)}createReplica(){return EngineReplica.mix(Replica).new({project:this,schema:Schema.new(),enableProgressNotifications:this.enableProgressNotifications,silenceInitialCommit:this.silenceInitialCommit,ignoreInitialCommitComputationCycles:this.ignoreInitialCommitComputationCycles,onWriteDuringCommit:"ignore",readMode:ReadMode.CurrentOrProposedOrPrevious})}*hasSubEvents(){return this.getEventStore().count>0}*subEventsIterable(){return this.getEventStore().getRange()}getType(){return ProjectType.SchedulerBasic}get enableProgressNotifications(){return this._enableProgressNotifications}set enableProgressNotifications(e){this._enableProgressNotifications=e,this.replica&&(this.replica.enableProgressNotifications=e)}getDefaultEventModelClass(){return SchedulerBasicEvent}getDefaultEventStoreClass(){return ChronoEventStoreMixin}getDefaultDependencyModelClass(){return BaseDependencyMixin}getDefaultDependencyStoreClass(){return ChronoDependencyStoreMixin}getDefaultResourceModelClass(){return BaseResourceMixin}getDefaultResourceStoreClass(){return ChronoResourceStoreMixin}getDefaultAssignmentModelClass(){return BaseAssignmentMixin}getDefaultAssignmentStoreClass(){return ChronoAssignmentStoreMixin}getDefaultCalendarModelClass(){return BaseCalendarMixin}getDefaultCalendarManagerStoreClass(){return ChronoCalendarManagerStoreMixin}async loadInlineData(e){const{calendarManagerStore:t,eventStore:r,dependencyStore:n,assignmentStore:i,resourceStore:s}=this;this.replica.unScheduleAutoCommit(),this.replica.enableProgressNotifications&&(await delay(0),this.replica.onPropagationProgressNotification({total:0,remaining:0,phase:"storePopulation"}),await delay(50)),this.isLoadingInlineData=!0,BrowserHelper.global.DEBUG&&(console.log("%cInitializing project","font-weight:bold;color:darkgreen;text-transform:uppercase;margin-top: 2em"),console.time("Time to visible"),console.time("Populating project")),e.calendarsData&&(this.repopulateStore(t),t.data=e.calendarsData),(e.eventsData||e.tasksData)&&(this.repopulateStore(r),r.data=e.eventsData||e.tasksData),e.dependenciesData&&(this.repopulateStore(n),n.data=e.dependenciesData),e.resourcesData&&(this.repopulateStore(s),s.data=e.resourcesData),e.assignmentsData&&(this.repopulateStore(i),i.data=e.assignmentsData),BrowserHelper.global.DEBUG&&console.timeEnd("Populating project"),await this.commitLoad(),this.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}get isRepopulatingStores(){var e;return Boolean(null===(e=this.repopulateStores)||void 0===e?void 0:e.size)}repopulateStore(e){this.repopulateOnDataset&&e.count&&(this.repopulateStores||(this.repopulateStores=new Set),this.repopulateStores.add(e),this.repopulateReplica())}repopulateReplica(){const{calendarManagerStore:e,eventStore:t,dependencyStore:r,assignmentStore:n,resourceStore:i,replica:s}=this;this.unlinkStoreRecords(e,t,r,i,n),this.unlinkRecord(this),this.unlinkRecord(this.defaultCalendar),s.clear();const o=this.replica=this.createReplica();o.addEntity(this),o.addEntity(this.defaultCalendar),this.joinStoreRecords(e,!0),this.joinStoreRecords(t,!0),this.joinStoreRecords(r,!0),this.joinStoreRecords(i,!0),this.joinStoreRecords(n,!0),this.repopulateStores.clear()}beforeCommitAsync(){return this.repopulateReplica.isPending?(this.repopulateReplica.now(),this.replica.commitAsync()):null}unlinkRecord(e){var t;const{activeTransaction:r}=this.replica,{$:n}=e,i=Object.keys(n);for(let s=0;s<i.length;s++){const o=i[s],a=n[o];if(a.field instanceof ModelReferenceField){const r=e[o];a.DATA=null!==(t=null==r?void 0:r.id)&&void 0!==t?t:r}else{const e=r.getLatestStableEntryFor(a);e&&(a.DATA=e.getValue())}}e.graph=null}unlinkStoreRecords(...e){e.forEach((e=>e.traverse((t=>{this.repopulateStores.has(e)||this.unlinkRecord(t)}),!1)))}getGraph(){return this.replica}async addEvents(e){return this.eventStore.add(e),this.graph.commitAsync()}async addEvent(e){return this.eventStore.add(e),this.graph.commitAsync()}includeEvent(e){this.eventStore.add(e)}async removeEvents(e){return this.eventStore.remove(e),this.graph.commitAsync()}excludeEvent(e){this.eventStore.remove(e)}async removeEvent(e){return this.eventStore.remove(e),this.graph.commitAsync()}getStm(){return this.stm}calculateProject(){return this}resolveCalendar(e){return super.resolveCalendar(e)||this.defaultCalendar}joinStoreRecords(e,t=!1){const r=e=>{e.setProject(this),e.joinProject()};e.rootNode?e.rootNode.traverse(r,t):e.forEach(r)}unJoinStoreRecords(e){const t=e=>{e.leaveProject(),e.setProject(this)};e.rootNode?e.rootNode.traverse((r=>{r!==e.rootNode&&t(r)})):e.forEach(t)}setEventStore(e){const t=this.eventStore;if(t&&this.stm.hasStore(t)){this.stm.removeStore(t),this.unJoinStoreRecords(t);const r=t.assignmentsForRemoval;r.forEach((t=>{const n=t.event;if(n){const i=e.getById(n.id);i&&(t.event=i,r.delete(t))}})),t.afterEventRemoval()}if(e&&e instanceof Store)this.eventStore=e,e.setProject(this),this.stm.addStore(e),e.tree&&e.rootNode!==this?(this.appendChild(e.rootNode.children||[]),e.rootNode=this):this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.eventStoreClass;this.eventStore=new t(Object.assign({modelClass:this.eventModelClass,project:this,stm:this.stm},e||{}))}this.trigger("eventStoreChange",{store:this.eventStore})}setDependencyStore(e){const t=this.dependencyStore;if(t&&this.stm.hasStore(t)&&this.stm.removeStore(t),e&&e instanceof Store)this.dependencyStore=e,e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.dependencyStoreClass;this.dependencyStore=new t(Object.assign({modelClass:this.dependencyModelClass,project:this,stm:this.stm},e||{}))}this.trigger("dependencyStoreChange",{store:this.dependencyStore})}setResourceStore(e){const t=this.resourceStore;if(t&&this.stm.hasStore(t)){this.stm.removeStore(t),this.unJoinStoreRecords(t);const r=t.assignmentsForRemoval;r.forEach((t=>{const n=t.resource;if(n){const i=e.getById(n.id);i&&(t.resource=i,r.delete(t))}})),t.afterResourceRemoval()}if(e&&e instanceof Store)this.resourceStore=e,e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.resourceStoreClass;this.resourceStore=new t(Object.assign({modelClass:this.resourceModelClass,project:this,stm:this.stm},e||{}))}this.trigger("resourceStoreChange",{store:this.resourceStore})}setAssignmentStore(e){const t=this.assignmentStore;if(t&&this.stm.hasStore(t)&&(this.stm.removeStore(t),this.unJoinStoreRecords(t)),e&&e instanceof Store)this.assignmentStore=e,e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.assignmentStoreClass;this.assignmentStore=new t(Object.assign({modelClass:this.assignmentModelClass,project:this,stm:this.stm},e||{}))}this.trigger("assignmentStoreChange",{store:this.assignmentStore})}setCalendarManagerStore(e){const t=this.calendarManagerStore;if(t&&this.stm.hasStore(t)&&this.stm.removeStore(t),e&&e instanceof Store)this.calendarManagerStore=e,e&&(e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e));else{const t=(null==e?void 0:e.storeClass)||this.calendarManagerStoreClass;this.calendarManagerStore=new t(Object.assign({modelClass:this.calendarModelClass,project:this,stm:this.stm},e||{}))}this.trigger("calendarManagerStoreChange",{store:this.calendarManagerStore})}async isValidDependency(...e){return!0}async tryPropagateWithChanges(e){const t=this.stm;let r,n;r=t.disabled,n=t.autoRecord,r?t.enable():(n&&(t.autoRecord=!1),t.isRecording&&t.stopTransaction()),t.startTransaction(),e();let i=!0;try{i=!(await this.commitAsync()).rejectedWith}catch(e){if(!/cycle/i.test(e))throw e;i=!1}return i?(t.stopTransaction(),r&&t.resetQueue()):(this.replica.reject(),t.transaction.length?(t.forEachStore((e=>e.beginBatch())),t.rejectTransaction(),t.forEachStore((e=>e.endBatch()))):t.stopTransaction()),t.disabled=r,t.autoRecord=n,i}isEngineReady(){const{replica:e}=this;return!(e.dirty&&(e.hasPendingAutoCommit()||e.isCommitting))}static get defaultConfig(){return{assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null,eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null,calendarManagerStore:null,eventModelClass:null,resourceModelClass:null,assignmentModelClass:null,dependencyModelClass:null,calendarModelClass:null,repopulateOnDataSet:!0}}static get delayable(){return{repopulateReplica:10}}}return r.applyConfigs=!0,__decorate$g([model_field({type:"boolean",defaultValue:!0})],r.prototype,"unspecifiedTimeIsWorking",void 0),r}))){}class CoreCalendarMixin extends(Mixin([AbstractCalendarMixin,CorePartOfProjectModelMixin],(e=>{e.prototype;return class extends e{}}))){}class CoreCalendarManagerStoreMixin extends(Mixin([AbstractCalendarManagerStoreMixin,CorePartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{tree:!0,modelClass:CoreCalendarMixin}}}}))){}class EventsWrapper$1 extends(Mixin([],Events)){}class DelayableWrapper$1 extends(Mixin([],Delayable)){}class SchedulerCoreProjectMixin extends(Mixin([AbstractProjectMixin,CorePartOfProjectGenericMixin,EventsWrapper$1,DelayableWrapper$1,Model],(e=>{const t=e.prototype;class r extends e{static get defaultConfig(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:SchedulerCoreEvent,assignmentModelClass:CoreAssignmentMixin,resourceModelClass:CoreResourceMixin,dependencyModelClass:CoreDependencyMixin,calendarModelClass:CoreCalendarMixin,eventStoreClass:CoreEventStoreMixin,assignmentStoreClass:CoreAssignmentStoreMixin,resourceStoreClass:CoreResourceStoreMixin,dependencyStoreClass:CoreDependencyStoreMixin,calendarManagerStoreClass:CoreCalendarManagerStoreMixin,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(e={}){this.$invalidated=new Set,this.isPerformingCommit=!1,this.silenceInitialCommit=!0,this.ongoing=Promise.resolve(),t.construct.call(this,e),this.defaultCalendar=new this.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this;const{calendarsData:r,eventsData:n,dependenciesData:i,resourcesData:s,assignmentsData:o}=this;Boolean(r||n||i||s||o)?(this.loadInlineData({calendarsData:r,eventsData:n,dependenciesData:i,resourcesData:s,assignmentsData:o}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData):this.bufferedCommitAsync()}doDestroy(){var e,r,n,i,s,o;const a=this;null===(e=a.eventStore)||void 0===e||e.destroy(),null===(r=a.dependencyStore)||void 0===r||r.destroy(),null===(n=a.assignmentStore)||void 0===n||n.destroy(),null===(i=a.resourceStore)||void 0===i||i.destroy(),null===(s=a.calendarManagerStore)||void 0===s||s.destroy(),null===(o=a.stm)||void 0===o||o.destroy(),t.doDestroy.call(this)}async loadInlineData(e){this.isLoadingInlineData=!0,e.calendarsData&&(this.calendarManagerStore.data=e.calendarsData),e.resourcesData&&(this.resourceStore.data=e.resourcesData),e.assignmentsData&&(this.assignmentStore.data=e.assignmentsData),e.eventsData&&(this.eventStore.data=e.eventsData),e.dependenciesData&&(this.dependencyStore.data=e.dependenciesData),await this.commitLoad(),this.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(e){const t=e=>{e.setProject(this),e.joinProject()};e.rootNode?e.rootNode.traverse(t):e.forEach(t)}unJoinStoreRecords(e){const t=e=>{e.leaveProject(),e.setProject(this)};e.rootNode?e.rootNode.traverse((r=>{r!==e.rootNode&&t(r)})):e.forEach(t)}resolveStoreAndModelClass(e,t){const r=(null==t?void 0:t.storeClass)||this[e+"StoreClass"];let n=null==t?void 0:t.modelClass;return n||(n=this.getDefaultConfiguration()[e+"ModelClass"]!==r.defaultConfig.modelClass?r.defaultConfig.modelClass:this[e+"ModelClass"]),{storeClass:r,modelClass:n}}get eventStore(){return this.$eventStore}setEventStore(e){this.eventStore=e}set eventStore(e){const t=this,{stm:r}=t,n=t.$eventStore;if(e instanceof Store)e.project=t,r.addStore(e),t.joinStoreRecords(e);else{const{storeClass:n,modelClass:i}=t.resolveStoreAndModelClass("event",e);e=new n(Object.assign({modelClass:i,project:t,stm:r},e))}if(n&&r.hasStore(n)){r.removeStore(n),t.unJoinStoreRecords(n);const{assignmentsForRemoval:i}=n;i.forEach((t=>{const r=t.event;if(r){const n=e.getById(r.id);n&&(t.event=n,i.delete(t))}})),n.afterEventRemoval()}e.setProject(t),t.$eventStore=e,t.trigger("eventStoreChange",{store:e})}get assignmentStore(){return this.$assignmentStore}setAssignmentStore(e){this.assignmentStore=e}set assignmentStore(e){const t=this,{stm:r}=t,n=t.$assignmentStore;if(n&&r.hasStore(n)&&(r.removeStore(n),t.unJoinStoreRecords(n)),e instanceof Store)e.project=t,r.addStore(e),t.joinStoreRecords(e);else{const{storeClass:n,modelClass:i}=t.resolveStoreAndModelClass("assignment",e);e=new n(Object.assign({modelClass:i,project:t,stm:r},e))}e.setProject(t),t.$assignmentStore=e,t.trigger("assignmentStoreChange",{store:e})}get resourceStore(){return this.$resourceStore}setResourceStore(e){this.resourceStore=e}set resourceStore(e){const t=this,{stm:r}=t,n=t.$resourceStore;if(e instanceof Store)e.project=t,r.addStore(e),t.joinStoreRecords(e);else{const{storeClass:n,modelClass:i}=t.resolveStoreAndModelClass("resource",e);e=new n(Object.assign({modelClass:i,project:t,stm:r},e))}if(n&&r.hasStore(n)){r.removeStore(n),t.unJoinStoreRecords(n);const{assignmentsForRemoval:i}=n;i.forEach((t=>{const r=t.resource;if(r){const n=e.getById(r.id);n&&(t.resource=n,i.delete(t))}})),n.afterResourceRemoval()}e.setProject(t),t.$resourceStore=e,t.trigger("resourceStoreChange",{store:e})}get dependencyStore(){return this.$dependencyStore}setDependencyStore(e){this.dependencyStore=e}set dependencyStore(e){const t=this;if(e instanceof Store)e.project=t,t.stm.addStore(e),t.joinStoreRecords(e);else{const{storeClass:r,modelClass:n}=t.resolveStoreAndModelClass("dependency",e);e=new r(Object.assign({modelClass:n,project:t,stm:t.stm},e))}t.$dependencyStore=e,t.trigger("dependencyStoreChange",{store:e})}get calendarManagerStore(){return this.$calendarManagerStore}setCalendarManagerStore(e){this.calendarManagerStore=e}set calendarManagerStore(e){const t=this;if(e instanceof Store)t.stm.addStore(e);else{const r=(null==e?void 0:e.storeClass)||t.calendarManagerStoreClass,n=(null==e?void 0:e.modelClass)||r.defaultConfig.modelClass||t.calendarModelClass;e=new r(Object.assign({modelClass:n,project:t,stm:t.stm},e))}e.setProject(t),t.$calendarManagerStore=e,t.trigger("calendarManagerStoreChange",{store:e})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(e){this.$calendar=e}get effectiveCalendar(){return this.calendar}async addEvent(e){return this.eventStore.add(e),this.commitAsync()}async addAssignment(e){return this.assignmentStore.add(e),this.commitAsync()}async addResource(e){return this.resourceStore.add(e),this.commitAsync()}async addDependency(e){return this.dependencyStore.add(e),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){var e;if(this.isPerformingCommit=!0,this.unScheduleAutoCommit(),await(e=0,new Promise((t=>setTimeout(t,e)))),!this.isDestroyed){for(const e of this.$invalidated)e.calculateInvalidated();const{isInitialCommit:e,silenceInitialCommit:t}=this,r=e&&t;this.assignmentStore.onCommitAsync(),this.dependencyStore.onCommitAsync(),this.isInitialCommitPerformed=!0,this.hasLoadedDataToCommit=!1,this.isPerformingCommit=!1;const n=[this.assignmentStore,this.dependencyStore,this.eventStore,this.resourceStore,this.calendarManagerStore];n.forEach((e=>e.suspendAutoCommit())),this.isWritingData=!0,this.trigger("refresh",{isInitialCommit:e});for(const t of this.$invalidated)t.beginBatch(),t.finalizeInvalidated(e);for(const e of this.$invalidated)e.ignoreBag=r,e.endBatch(r,!0),e.ignoreBag=!1;return this.isWritingData=!1,this.$invalidated.clear(),this.trigger("dataReady"),n.forEach((e=>e.resumeAutoCommit())),r&&[this.eventStore,this.dependencyStore,this.resourceStore,this.assignmentStore,this.calendarManagerStore].forEach((e=>e.acceptChanges())),!0}}async propagateAsync(){return this.commitAsync()}invalidate(e){this.$invalidated.add(e),this.bufferedCommitAsync()}async isValidDependency(...e){return!0}getStm(){return this.stm}set stm(e){(e=this.$stm=new StateTrackingManager(Object.assign({disabled:!0},e))).on({restoringStop:async()=>{e.disable(),await this.commitAsync(),this.isDestroyed||(e.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return r.applyConfigs=!0,r}))){}const EngineMixin$8=(null===(_window$bryntum$8=window.bryntum)||void 0===_window$bryntum$8?void 0:_window$bryntum$8.useBasicEngine)?SchedulerBasicProjectMixin:SchedulerCoreProjectMixin;class ProjectModel extends(ProjectModelMixin(EngineMixin$8)){construct(...e){super.construct(...e),VersionHelper.isTestEnv&&(window.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new ModelPersistencyManager({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}}ProjectModel.applyConfigs=!0,ProjectModel._$name="ProjectModel";var ProjectConsumer=e=>class extends(e||Base){static get $name(){return"ProjectConsumer"}static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:ProjectModel,project:{},destroyStores:null,projectSubscribers:[]}}startConfigure(e){this.getConfig("project"),super.startConfigure(e)}changeProject(e,t){const r=this,{projectStoreNames:n,projectDataNames:i}=r.constructor;if(r.projectCallbacks=new Set,e){if(r.buildingProjectConfig=!0,!e.isModel){if(r.isConfiguring){r._project=e;const{crudManager:t}=r;if(t){const{isCrudManager:e}=t;for(const i of n)t[i]&&(r[i]=t[i],e||delete t[i])}r.getConfig("projectStores");for(const e of i)r.getConfig(e)}const{eventStore:t}=e;t&&!t.isEventStoreMixin&&t.autoLoad&&!t.count&&(t.autoLoad=!1,r.delayAutoLoad=!0),e=r._sharedProject||new r.projectModelClass(e),delete r._project}r.buildingProjectConfig=!1}return e}updateProject(e,t){const r=this,{projectListeners:n,crudManager:i}=r;if(r.detachListeners("projectConsumer"),delete r._crudManager,e){n.thisObj=r,e.on(n),e.isCrudManager?r.crudManager=e:i&&(i.project=e,r.crudManager=i),r.projectSubscribers.forEach((t=>t.attachToProject(e)));for(const t of r.constructor.projectStoreNames)r[t]=e[t];r.delayAutoLoad&&(e.eventStore.autoLoad=!0,e.eventStore.load())}r.trigger("projectChange",{project:e})}changeCrudManager(e){if(!this.buildingProjectConfig)return super.changeCrudManager(e);this._crudManager=e.isCrudManager?e:Object.assign({},e)}onProjectDataReady(){this.projectCallbacks.size&&(this.projectCallbacks.forEach((e=>e())),this.projectCallbacks.clear())}whenProjectReady(e){this.isEngineReady?e():this.projectCallbacks.add(e)}get isEngineReady(){var e,t;return Boolean(null===(e=(t=this.project).isEngineReady)||void 0===e?void 0:e.call(t))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:e}=this.constructor;return e.map((e=>this[e]))}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce(((e,t)=>{const{dataName:r}=this.projectStores[t];return r&&e.push(r),e}),[])}static setupProjectStores(e,t){const{projectStores:r}=e;if(r){const e={name:"projectConsumer",dataReady:"onProjectDataReady"},n={projectListeners:e};for(const i in r){const{dataName:s}=r[i];n[i]=null,s&&Object.defineProperty(t.class.prototype,s,{get(){var e;return null===(e=this.project[i])||void 0===e?void 0:e.records},set(e){const{project:t}=this;this.buildingProjectConfig?t[s+"Data"]=e:t[i].data=e}}),this.createStoreDescriptor(t,i,r[i],e)}this.setupConfigs(t,n)}}static createStoreDescriptor(e,t,{listeners:r},n){const{prototype:i}=e.class,s=StringHelper.capitalize(t);n[t+"Change"]=function({store:e}){this[t]=e},i["change"+s]=function(e,n){const i=this,{project:o}=i,a=e.project;return i.buildingProjectConfig?(a&&a.isProjectModel&&(i._sharedProject=a),void(o[t]=e)):(i.initializingProject||o[t]!==e&&(o["set"+s](e),e=o[t]),e!==n&&(r&&(r.thisObj=i,r.name=t+"Listeners",i.detachListeners(r.name),e.on(r)),i.projectSubscribers.forEach((r=>{r[t]!==e&&r["attachTo"+s](e)}))),e)}}get widgetClass(){}},SchedulerStores=e=>class extends(ProjectConsumer(e||Base)){static get $name(){return"SchedulerStores"}static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{changePreCommit:"onInternalEventStoreChange",clearChanges:"onEventClearChanges",beforeCommit:"onEventBeforeCommit",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"applyStartEndParameters"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{}}}static get configurable(){return{timeRanges:null,resourceTimeRanges:null,store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:!1,removeUnassignedEvent:!0}}updateProject(e,t){super.updateProject(e,t),this.detachListeners("schedulerStores"),e.on({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({isInitialCommit:e}){const t=this;e&&t.isVertical&&(t.refreshAfterProjectRefresh=!1,t.refreshWithTransition()),t.navigateToAfterRefresh&&(t.navigateTo(t.navigateToAfterRefresh),t.navigateToAfterRefresh=null),t.refreshAfterProjectRefresh&&(t.refreshWithTransition(),t.refreshAfterProjectRefresh=!1)}get store(){return!this._store&&this.isVertical&&(this._store=new Store({data:[{id:"verticalTimeAxisRow"}]})),super.store}set store(e){super.store=e}refreshFromRowOnStoreAdd(e,{isExpand:t}){const r=arguments;this.runWithTransition((()=>{this.currentOrientation.suspended=!t,super.refreshFromRowOnStoreAdd(e,...r),this.currentOrientation.suspended=!1}),!t)}onStoreAdd(e){super.onStoreAdd(e),this.calculateRowHeights(e.records)}onStoreUpdateRecord({source:e,record:t,changes:r}){let n=0;"assigned"in r&&n++,"calendar"in r&&n++,n!==Object.keys(r).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(e){e&&this.isHorizontal&&(e.metaMapId=this.id,this.store=e)}onEventIdChange(e){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(e)}onInternalEventStoreChange(e){!this._mode||e.isAssign||this.assignmentStore.isRemovingAssignment||this.currentOrientation.onEventStoreChange(e)}onEventCommit({changes:e}){let t=[...e.added,...e.modified].map((e=>this.eventStore.getResourcesForEvent(e)));t=Array.prototype.concat.apply([],t),new Set(t).forEach((e=>this.repaintEventsForResource(e)))}onEventBeforeCommit({changes:e}){const{currentOrientation:t,committingCls:r}=this;[...e.added,...e.modified].forEach((e=>e.assignments.forEach((e=>t.toggleCls(e,r,!0)))))}onEventException({action:e}){if("commit"===e){const{changes:e}=this.eventStore;[...e.added,...e.modified,...e.removed].forEach((e=>this.repaintEvent(e)))}}onEventClearChanges(){this.refresh()}onAssignmentBeforeRemove({source:e,records:t,removingAll:r}){if(r)return;const n=this;let i;if(!n.isConfiguring&&n.activeAssignment&&t.includes(n.activeAssignment)){if("key"===GlobalEvents.lastInteractionType)for(let e=0,r=t.length;e<r&&(!i||t.includes(i));e++){const r=t[e];r.resource&&r.resource.isModel&&(i=n.getNext(r)||n.getPrevious(r))}i?(n.navigateTo(i),n.navigateToAfterRefresh=i):DomHelper.focusWithoutScrolling(n.focusElement)}}applyStartEndParameters({source:e,params:t}){const r=this,n=e.modelClass.fieldMap.startDate;r.passStartEndParameters&&(t[r.startParamName]=n.print(r.startDate),t[r.endParamName]=n.print(r.endDate))}get widgetClass(){}};const immediatePromise$5=Promise.resolve(),defaultScrollOptions$3={block:"nearest",edgeOffset:20},unrenderedScrollOptions={highlight:!1,focus:!1};var SchedulerScroll=e=>class extends(e||Base){static get $name(){return"SchedulerScroll"}scrollEventIntoView(e,t=defaultScrollOptions$3){const r=e.resources||[e];if(r.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");return r.length?this.scrollResourceEventIntoView(r[0],e,null,t):(console.warn("You have asked to scroll to an event which is not assigned to a resource"),immediatePromise$5)}scrollAssignmentIntoView(e,...t){return this.scrollResourceEventIntoView(e.resource,e.event,...t)}scrollResourceEventIntoView(e,t,r,n=defaultScrollOptions$3){const i=this,s=t.startDate,o=t.endDate,a=t.isScheduled&&s<i.timeAxis.startDate|(o>i.timeAxis.endDate)<<1;let l;if(null==n.edgeOffset&&(n.edgeOffset=20),a&&!1!==n.extendTimeAxis){let e,r,n=i.timeAxis.endDate-i.timeAxis.startDate;3===a?i.timeAxis.setTimeSpan(new Date(s.valueOf()-n/2),new Date(o.getTime()+n/2)):(e=1&a?i.getCoordinateFromDate(t.endDate):i.getCoordinateFromDate(t.startDate),1&a?i.timeAxis.setTimeSpan(new Date(s),new Date(s.valueOf()+n)):i.timeAxis.setTimeSpan(new Date(o.valueOf()-n),new Date(o)),r=1&a?i.getCoordinateFromDate(t.endDate):i.getCoordinateFromDate(t.startDate),i.timeAxisSubGrid.scrollable.scrollBy(r-e))}if(l=i.getElementFromEventRecord(t,e),l){DomHelper.isFocusable(l)||(l=l.parentNode);const e=i.timeAxisSubGrid.scrollable;return i.timeAxisSubGrid.forceScrollUpdate=!0,e.scrollIntoView(l,n)}return a&&!1===n.extendTimeAxis?(console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"),immediatePromise$5):t.isOccurrence||i.eventStore.isAvailable(t)?t.isScheduled?i.scrollUnrenderedEventIntoView(e,t,n):i.scrollResourceIntoView(e,n):(console.warn("You have asked to scroll to an event which is not available"),immediatePromise$5)}scrollUnrenderedEventIntoView(e,t,r=defaultScrollOptions$3){return new Promise((n=>{const i=this,s=Object.assign({edgeOffset:20},r,unrenderedScrollOptions),o=i.timeAxisSubGrid.scrollable,a=i.getResourceEventBox(t,e),l=o.viewport;if(!l)return void n();const c=a.translate(l.x-o.x,l.y-o.y),d=o.getDeltaTo(c,s)[i.isHorizontal?"xDelta":"yDelta"],u=i.on({renderEvent:async({eventRecord:e,element:i,targetElement:s})=>{if(e===t){const e=i||s;u(),await h,d>0&&await o.scrollIntoView(e,{edgeOffset:r.edgeOffset}),r.highlight&&DomHelper.highlight(e),r.focus&&e.focus(),n()}}}),h=o.scrollIntoView(c,s)}))}scrollResourceIntoView(e,t=defaultScrollOptions$3){return this.isVertical?this.currentOrientation.scrollResourceIntoView(e,t):this.scrollRowIntoView(e,t)}get widgetClass(){}},SchedulerRegions=e=>class extends(e||Base){static get $name(){return"SchedulerRegions"}getScheduleRegion(e,t,r=!0){return this.currentOrientation.getScheduleRegion(e,t,r)}getResourceRegion(e,t,r){return this.currentOrientation.getRowRegion(e,t,r)}getAssignmentEventBox(e,t){return this.getResourceEventBox(e.event,e.resource,t)}getResourceEventBox(e,t,r=!1,n=!1){return this.currentOrientation.getResourceEventBox(e,t,r,n)}getItemBox(e,t=!1){return e.resources.map((r=>this.getResourceEventBox(e,r,t)))}get widgetClass(){}};const copyProperties=["eventLayout","barMargin","mode","eventColor","eventStyle","fillTicks"];var SchedulerState=e=>class extends(e||Base){static get $name(){return"SchedulerState"}getState(){const e=this,t=ObjectHelper.copyProperties(super.getState(),e,copyProperties);return t.zoomLevel=e.zoomLevel,t.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,viewportCenterDate:e.viewportCenterDate,width:e.tickSize},t}applyState(e){this.suspendRefresh(),e.zoomLevel&&this.zoomToLevel(e.zoomLevel,e.zoomLevelOptions),ObjectHelper.copyProperties(this,e,copyProperties),super.applyState(e),this.resumeRefresh(!0)}get widgetClass(){}},EventSelection=e=>class extends(e||Base){static get $name(){return"EventSelection"}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected",selectedCollection:{}}}afterConstruct(){super.afterConstruct(),this.navigator.on({navigate:"onEventNavigate",thisObj:this})}set selectedCollection(e){e instanceof Collection||(e=new Collection(e)),this._selectedCollection=e,e.on({change:"onSelectedCollectionChange",thisObj:this})}get selectedCollection(){return this._selectedCollection}getEventsFromAssignments(e){return ArrayHelper.unique(e.map((e=>e.event)))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(e){const t=[];e&&!Array.isArray(e)&&(e=[e]),e&&e.forEach((e=>{t.push(...e.assignments)})),this.selectedCollection.splice(0,this.selectedCollection.count,t)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}isEventSelected(e){return this.selectedEvents.includes(e)}isAssignmentSelected(e){return this.selectedCollection.includes(e)}select(e,t=!1){e.isAssignment?this.selectAssignment(e,t):this.selectEvent(e,t)}selectEvent(e,t=!1){this.isEventSelected(e)||(t?this.selectedCollection.add(e.assignments):this.selectedEvents=e)}selectAssignment(e,t=!1){this.isAssignmentSelected(e)||(t?this.selectedCollection.add(e):this.selectedAssignments=e)}deselect(e){e.isAssignment?this.deselectAssignment(e):this.deselectEvent(e)}deselectEvent(e){this.isEventSelected(e)&&this.selectedCollection.remove(...e.assignments)}deselectAssignment(e){this.isAssignmentSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e){this.selectedCollection.add(e.reduce(((e,t)=>(e.push(...t.assignments),e)),[]))}deselectEvents(e){this.selectedCollection.remove(e.reduce(((e,t)=>(e.push(...t.assignments),e)),[]))}selectAssignments(e){this.selectedCollection.add(e)}deselectAssignments(e){this.selectedCollection.remove(e)}clearEventSelection(){this.selectedAssignments=[]}onSelectedCollectionChange({added:e,removed:t}){const r=this,n=r.selectedAssignments,i=e||[],s=t||[];function o(e,t){const n=e.event;if(n){const i=r.getElementFromAssignmentRecord(e);r.currentOrientation.toggleCls(e,r.eventSelectedCls,t),r.getElementsFromEventRecord(n).forEach((e=>{if(e!==i){const n=r.resolveAssignmentRecord(e);r.currentOrientation.toggleCls(n,r.eventAssignHighlightCls,t),e.classList[t?"add":"remove"](r.eventAssignHighlightCls)}}))}}if(i.forEach((e=>o(e,!0))),s.forEach((e=>o(e,!1))),r.$selectedAssignments=n.map((e=>({eventId:e.eventId,resourceId:e.resourceId}))),!r.silent){const e=n.length>0?i.length>0&&s.length>0?"update":i.length>0?"select":"deselect":"clear";r.trigger("assignmentSelectionChange",{action:e,selection:n,selected:i,deselected:s}),r.trigger("eventSelectionChange",{action:e,selection:r.selectedEvents,selected:r.getEventsFromAssignments(i),deselected:r.getEventsFromAssignments(s)})}}onAssignmentChange({action:e,records:t}){const r=this;if(r.silent=!r.triggerSelectionChangeOnRemove,"remove"===e)r.deselectAssignments(t);else if("removeall"!==e||r.eventStore.isSettingData){if("dataset"===e&&r.$selectedAssignments)if(r.maintainSelectionOnDatasetChange){const e=r.$selectedAssignments.map((e=>t.find((t=>t.eventId===e.eventId&&t.resourceId===e.resourceId))));r.selectedAssignments=ArrayHelper.clean(e)}else r.clearEventSelection()}else r.clearEventSelection();r.silent=!1}onInternalEventStoreChange({action:e,records:t}){"dataset"!==e||t.length||this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(e,t){const r=this;r.isAssignmentSelected(t)?e.ctrlKey&&r.deselectAssignment(t,r.multiEventSelect):r.selectAssignment(t,e.ctrlKey&&r.multiEventSelect)}onEventNavigate({event:e,item:t}){if(!this.eventSelectionDisabled){const r=t&&(1===t.nodeType?this.resolveAssignmentRecord(t):t);r?this.onAssignmentSelectionClick(e,r):this.clearEventSelection()}}get widgetClass(){}};const preventDefault=e=>e.preventDefault();var EventNavigation=e=>class extends(Delayable(e||Base)){static get $name(){return"EventNavigation"}static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey"}}}}static get defaultConfig(){return{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}}construct(e){const t=this;t.isInTimeAxis=t.isInTimeAxis.bind(t),t.onDeleteKey=t.throttle(t.onDeleteKey,t.onDeleteKeyBuffer,t),super.construct(e)}changeNavigator(e){const t=this;return t.getConfig("subGridConfigs"),new Navigator(t.constructor.mergeConfigs({ownerCmp:t,target:t.timeAxisSubGridElement,processEvent:t.processEvent,itemSelector:`.${t.eventCls}-wrap`,focusCls:t.focusCls,navigatePrevious:t.throttle(t.navigatePrevious,{delay:t.navigatePreviousBuffer,throttled:preventDefault}),navigateNext:t.throttle(t.navigateNext,{delay:t.navigateNextBuffer,throttled:preventDefault})},e))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}accessibleFocusCell(e,t){if((e=this.normalizeCellContext(e)).columnId!==this.timeAxisColumn.id)return super.focusCell(e,t)}normalizeTarget(e){return e.assignmentRecord}getPrevious(e,t){const r=this,{resourceStore:n}=r,{eventSorter:i}=r.currentOrientation,{startDate:s,endDate:o}=r.timeAxis,a=e.event,l=r.eventStore.getEvents({resourceRecord:e.resource,startDate:s,endDate:o}).filter(this.isInTimeAxis).sort(i);let c=e.resource,d=l[l.indexOf(a)-1];if(!d)for(let e=n.indexOf(c)-1;(!d||t&&d===a)&&e>=0;e--){c=n.getAt(e);const t=r.eventStore.getEvents({resourceRecord:c,startDate:s,endDate:o}).filter(r.isInTimeAxis).sort(i);d=t.length&&t[t.length-1]}return r.assignmentStore.getAssignmentForEventAndResource(d,c)}navigatePrevious(e){const t=this,r=t.getPrevious(t.normalizeTarget(e));if(e.preventDefault(),r)return e.ctrlKey||t.clearEventSelection(),t.navigateTo(r,e)}getNext(e,t){const r=this,{resourceStore:n}=r,{eventSorter:i}=r.currentOrientation,{startDate:s,endDate:o}=r.timeAxis,a=e.event,l=r.eventStore.getEvents({resourceRecord:e.resource,startDate:s,endDate:o}).filter(this.isInTimeAxis).sort(i);let c=e.resource,d=l[l.indexOf(a)+1];if(!d)for(let e=n.indexOf(c)+1;(!d||t&&d===a)&&e<n.count;e++){c=n.getAt(e);d=r.eventStore.getEvents({resourceRecord:c,startDate:s,endDate:o}).filter(r.isInTimeAxis).sort(i)[0]}return r.assignmentStore.getAssignmentForEventAndResource(d,c)}navigateNext(e){const t=this,r=t.getNext(t.normalizeTarget(e));if(e.preventDefault(),r)return e.ctrlKey||t.clearEventSelection(),t.navigateTo(r,e)}async navigateTo(e,t={}){const r=this;e&&(r.navigator.disabled=!0,await r.scrollAssignmentIntoView(e,null,{animate:100}),r.isDestroyed||(r.navigator.disabled=!1,r.activeAssignment=e,r.navigator.trigger("navigate",{event:t,item:DomHelper.up(r.getElementFromAssignmentRecord(e),r.navigator.itemSelector)})))}set activeAssignment(e){const t=this.getElementFromAssignmentRecord(e);this.navigator.activeItem=t.parentNode}get activeAssignment(){const{activeItem:e}=this.navigator;if(e)return this.resolveAssignmentRecord(e)}get previousActiveEvent(){const{previousActiveItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}processEvent(e){const t=this,r=DomHelper.up(e.target,t.eventSelector);return!t.navigator.disabled&&r&&(e.assignmentRecord=t.resolveAssignmentRecord(r),e.eventRecord=t.resolveEventRecord(r),e.resourceRecord=t.resolveResourceRecord(r)),e}onDeleteKey(e){const t=this.eventStore.usesSingleAssignment?e.eventRecord:e.assignmentRecord;!this.readOnly&&this.enableDeleteKey&&t&&this.removeRecords([t])}removeRecords(e,t=null){if(!this.readOnly&&e.length){const r={finalize(r=!0){t&&t(r),!1!==r&&e.forEach((e=>{e.isAssignment&&e.isOccurrenceAssignment?e.event.remove():e.remove()}))}};let n;if(n=e[0].isAssignment?this.trigger("beforeAssignmentDelete",{assignmentRecords:e,context:r}):this.trigger("beforeEventDelete",{eventRecords:e,context:r}),!1!==n)return r.finalize(),!0}return!1}onEventSpaceKey(e){}onEventEnterKey(e){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}},AttachToProjectMixin=e=>class extends e{static get $name(){return"AttachToProjectMixin"}async afterConstruct(){super.afterConstruct();const e=this,t=e.client||e.grid,{project:r}=t;t.projectSubscribers.push(e),r&&(e.attachToProject(r),e.attachToResourceStore(r.resourceStore),e.attachToEventStore(r.eventStore),e.attachToAssignmentStore(r.assignmentStore),e.attachToDependencyStore(r.dependencyStore),e.attachToCalendarManagerStore(r.calendarManagerStore))}attachToProject(e){this.detachListeners("project"),this._project=e}attachToEventStore(e){this.detachListeners("eventStore"),this.eventStore=e}attachToResourceStore(e){this.detachListeners("resourceStore"),this.resourceStore=e}attachToAssignmentStore(e){this.detachListeners("assignmentStore"),this.assignmentStore=e}attachToDependencyStore(e){this.detachListeners("dependencyStore"),this.dependencyStore=e}attachToCalendarManagerStore(e){this.detachListeners("calendarManagerStore"),this.calendarManagerStore=e}get project(){return this._project}},BaseRendering=e=>class extends(e||Base){getElementFromAssignmentRecord(e,t=!1){if(this.scheduler.isPainted&&e){var r;const n=this.scheduler.foregroundCanvas.syncIdMap[e.id];return t?n:null==n||null===(r=n.syncIdMap)||void 0===r?void 0:r.event}return null}getElementFromEventRecord(e,t=e.resource,r=!1){const n=this.assignmentStore.getAssignmentForEventAndResource(e,t);return this.getElementFromAssignmentRecord(n,r)}getElementsFromEventRecord(e,t,r=!1){const n=this;return t?[n.getElementFromEventRecord(e,t,r)]:e.resources.reduce(((t,i)=>{const s=n.getElementFromEventRecord(e,i,r);return s&&t.push(s),t}),[])}};const releaseEventActions={releaseElement:1,reuseElement:1},renderEventActions={newElement:1,reuseOwnElement:1,reuseElement:1},MAX_WIDTH=9999999,heightEventSorter=({startDateMS:e},{startDateMS:t})=>e-t,chronoFields={startDate:1,endDate:1,duration:1};function getStartEnd(e,t,r,n,i){if(e.fillTicks){let e=t.getTickFromDate(r);if(e>=0){i&&e===Math.round(e)&&e>0&&e--;const r=Math.floor(e);return t.getAt(r)[i?"endDate":"startDate"].getTime()}}return n}class HorizontalRendering extends(Base.mixin(BaseRendering,AttachToProjectMixin)){static get configurable(){return{scrollBuffer:0}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],isFirstRefresh:!0}}construct(e){const t=this;t.client=t.scheduler=e,t.eventSorter=t.eventSorter.bind(e),e.rowManager.on({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",beforeRowHeight:"onBeforeRowHeightChange",thisObj:t}),t.toDrawOnProjectRefresh=new Set,t.toDrawOnDataReady=new Set,super.construct({})}init(){}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(e,t,r,n=!1){let i=e[0];return r||(i=this.translateToScheduleCoordinate(i)),this.scheduler.timeAxisViewModel.getDateFromPosition(i,t,n)}translateToScheduleCoordinate(e){return e-Math.floor(this.scheduler.timeAxisSubGridElement.getBoundingClientRect().left)+this.scheduler.scrollLeft}translateToPageCoordinate(e){const t=this.scheduler.timeAxisSubGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}getScheduleRegion(e,t,r=!0){const n=this,{scheduler:i}=n,{timeAxisSubGridElement:s,timeAxis:o}=i;let a;if(e){const r=t&&n.getElementsFromEventRecord(t,e)[0];if(a=Rectangle.from(i.getRowById(e.id).getElement("locked")),r){const e=Rectangle.from(r,s);a.y=e.y,a.bottom=e.bottom}else a.y=a.y+i.resourceMargin,a.bottom=a.bottom-i.resourceMargin}else a=Rectangle.from(s).moveTo(null,0),a.width=s.scrollWidth,a.y=a.y+i.resourceMargin,a.bottom=a.bottom-i.resourceMargin;const l=o.startDate,c=o.endDate,d=i.getDateConstraints(e,t)||{start:l,end:c};let u=i.getCoordinateFromDate(DateHelper.max(l,d.start)),h=i.getCoordinateFromDate(DateHelper.min(c,d.end));return r||(u=n.translateToPageCoordinate(u),h=n.translateToPageCoordinate(h)),a.left=Math.min(u,h),a.right=Math.max(u,h),a}getRowRegion(e,t,r){const{scheduler:n}=this,{timeAxis:i}=n,s=n.getRowById(e.id);if(!s)return null;const o=i.startDate,a=i.endDate,l=t?DateHelper.max(o,t):o,c=r?DateHelper.min(a,r):a,d=n.getCoordinateFromDate(l),u=n.getCoordinateFromDate(c,!0,!0),h=s.top,g=Math.min(d,u),m=h+s.offsetHeight;return new Rectangle(g,h,Math.max(d,u)-g,m-h)}getResourceEventBox(e,t,r,n=!1){const i=this.resourceMap.get(t.id);let s=null,o=!1;if(i&&(s=i.eventsData.find((t=>t.eventRecord===e))),s||(s=this.getTimeSpanRenderData(e,t,{viewport:!0,timeAxis:r}),o=!0),s){const e=this.scheduler.getRecordCoords(t,!0,n),r=s.top+e.top,i=new Rectangle(s.left,r,s.width,s.height);return o&&(i.layout=!1),i.rowTop=e.top,i.rowBottom=e.bottom,i}return null}resolveRowRecord(e){const t=this,{scheduler:r}=t,n=e instanceof Event?e.target:e,i=3===n.nodeType?n.parentElement:n,s=DomHelper.up(i,r.eventSelector);return s?t.resourceStore.getById(s.dataset.resourceId):r.getRecordFromElement(i)}attachToProject(e){super.attachToProject(e),this.refreshAllWhenReady=!0,e&&e.on({name:"project",refresh:"onProjectRefresh",dataReady:"onProjectDataReady",thisObj:this})}onProjectDataReady(){const e=this,{scheduler:t,toDrawOnDataReady:r}=e;t.refreshSuspended||(r.size&&(e.clearResources(r),e.refreshResources(r)),r.clear())}onProjectRefresh(){const e=this,{scheduler:t,toDrawOnProjectRefresh:r}=e;t.refreshSuspended||(e.refreshAllWhenReady?(t.calculateAllRowHeights(!0),t.rowManager.topRow?(e.clearAll(),t.refreshWithTransition(!1,!e.isFirstRefresh),e.isFirstRefresh=!1):t.rowManager.reinitialize(),e.refreshAllWhenReady=!1):r.size&&e.refreshResources(r),r.clear())}attachToAssignmentStore(e){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(e),e&&e.on({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:t,replaced:r,record:n,changes:i}){const s=this,o=new Set((t||(n?[n]:[])).map((e=>e.resourceId)));if(s.resourceStore.isRemoving||s.resourceStore.isChangingId)return;switch(e){case"dataset":return void(s.eventStore.usesSingleAssignment||s.refreshResourcesWhenReady(o));case"add":case"remove":case"updateMultiple":return void s.refreshResourcesWhenReady(o);case"removeall":return void(s.refreshAllWhenReady=!0);case"replace":return r.forEach((([e,t])=>{o.add(e.resourceId),o.add(t.resourceId)})),void s.refreshResourcesWhenReady(o);case"filter":return s.clearAll(),s.scheduler.calculateAllRowHeights(!0),void s.scheduler.refreshWithTransition();case"update":("eventId"in i||"resourceId"in i)&&("resourceId"in i&&o.add(i.resourceId.oldValue),s.refreshResources(o,true))}}onAssignmentStoreRefresh({action:e,records:t}){}attachToEventStore(e){this.refreshAllWhenReady=!0,super.attachToEventStore(e),e&&e.on({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){"batch"===e&&this.scheduler.isEngineReady&&(this.clearAll(),this.scheduler.refreshWithTransition())}onEventStoreChange({action:e,records:t,record:r,replaced:n,changes:i}){const s=this,o=t||(r?[r]:[]),a=o[0]&&o[0].isResourceTimeRange,l=new Set;if(o.forEach((e=>{var t;null===(t=e.resources)||void 0===t||t.forEach((e=>l.add(e.id)))})),a)s.refreshResources(l);else{switch(e){case"batch":case"sort":case"group":case"move":case"remove":return;case"clearchanges":case"dataset":return s.clearAll(),void(s.refreshAllWhenReady=!0);case"add":case"updateMultiple":break;case"replace":n.forEach((([,e])=>{e.resources.map((e=>l.add(e.id)))}));break;case"removeall":case"filter":return s.scheduler.isEngineReady?(s.clearAll(),s.scheduler.calculateAllRowHeights(!0),void s.scheduler.refreshWithTransition()):void(s.refreshAllWhenReady=!0);case"update":{const e=r.$entity?!Object.keys(i).some((e=>!r.$entity.getField(e))):!Object.keys(i).some((e=>!chronoFields[e]));let t=0;var c;if("startDate"in i&&t++,"endDate"in i&&t++,"duration"in i&&t++,"resourceId"in i&&l.add(i.resourceId.oldValue),!e||t&&(!("duration"in i)||1!==t)||"percentDone"in i)(null===(c=s.project)||void 0===c?void 0:c.propagatingLoadChanges)?l.forEach((e=>s.toDrawOnDataReady.add(e))):s.refreshResources(l);return}}s.refreshResourcesWhenReady(l)}}attachToResourceStore(e){this.refreshAllWhenReady=!0,super.attachToResourceStore(e),e&&e.on({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this})}onResourceStoreChange({action:e,isExpand:t,record:r,records:n,changes:i}){const s=this,o=r?[r.id]:null==n?void 0:n.map((e=>e.id));switch(e){case"add":return void(t||s.refreshResourcesWhenReady(o));case"update":return void(s.project.isBatchingChanges||i.isLeaf||s.refreshResources(o));case"filter":return;case"removeall":return void s.clearAll()}s.clearResources(o)}onTranslateRow({row:e}){null!=e.id&&this.refreshRow(e,!1)}calculateRowHeight(e){const{scheduler:t}=this;if("stack"===t.eventLayout&&t.isEngineReady&&!e.isSpecialRow&&e.events.length>1){const{assignmentStore:r,eventStore:n,timeAxis:i,resourceMargin:s,barMargin:o}=t,a=t.rowHeight-2*s,l=t=>t.assignments.some((t=>t.resource===e&&r.includes(t))),c=n.getEvents({resourceRecord:e,includeOccurrences:t.enableRecurringEvents,startDate:i.startDate,endDate:i.endDate,filter:l}).sort(heightEventSorter).map((e=>({eventRecord:e,startMS:e.startDateMS,endMS:e.endDate?e.endDateMS:e.startDateMS}))),d=t.currentEventLayout.layoutEventsInBands(c);return d*a+(d-1)*o+2*s}return t.rowHeight}doUpdateTimeView(){this.updateFromHorizontalScroll(this.scheduler.timeAxisSubGrid.scrollable.x)}onTimeAxisViewModelUpdate(){this.clearAll(),this.scheduler.refreshSuspended&&this.scheduler.on({resumeRefresh(){this.scheduler.isEngineReady&&this.doUpdateTimeView()},thisObj:this,once:!0}),this.doUpdateTimeView()}getConnectorStartSide(e){return"left"}getConnectorEndSide(e){return"right"}refreshRows(e){e&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(){}onDragAbort({context:e,dragData:t}){this.resourceStore.indexOf(t.record.resource)<this.scheduler.topRow.dataIndex&&e.element.remove()}toggleCls(e,t,r=!0,n=!1){const i=this.getElementFromAssignmentRecord(e,n),s=this.resourceMap.get(e.isModel?e.get("resourceId"):e.resourceId),o=null==s?void 0:s.eventsData.find((t=>t.eventId===e.eventId));o&&(o[n?"wrapperCls":"cls"][t]=r),i&&(i.classList[r?"add":"remove"](t),i.lastDomConfig.className[t]=r)}onRemoveRows({rows:e}){e.forEach((e=>this.rowMap.delete(e))),this.onRenderDone()}updateFromHorizontalScroll(e){const{scheduler:t}=this,{timeAxisSubGrid:r,timeAxis:n}=t,i=r.width,s=r.scrollable.maxX<=Math.round(e)+5,o=t.getDateFromCoordinate(Math.max(0,e-this.scrollBuffer)),a=s?n.endDate:t.getDateFromCoordinate(e+i+this.scrollBuffer)||n.endDate;if(o&&(this._visibleDateRange={startDate:o,endDate:a,startMS:o.getTime(),endMS:a.getTime()},t.timeView.range={startDate:o,endDate:a},t.trigger("visibleRangeChange",{startDate:o,endDate:a}),!t.refreshSuspended&&t.rowManager.rows.length)){if(null===t.rowManager.rows[0].id)return;t.rowManager.rows.forEach((e=>this.refreshRow(e,!1))),this.onRenderDone()}}repaintEventsForResource(e){this.refreshResources([e.id])}onBeforeRowHeightChange(e){const{scheduler:t}=this,r=e?e.height:t.rowHeight;this.clearAll(),t.foregroundCanvas&&(t.foregroundCanvas.style.fontSize=r-2*t.resourceMargin+"px")}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshResources(e,t=!0){const{scheduler:r}=this,n=[],i=[];this.clearResources(e),r.refreshSuspended||(e.forEach((e=>{const t=r.getRowById(e);t?n.push(t):i.push(t)})),r.runWithTransition((()=>{r.calculateRowHeights(i.map((e=>this.resourceStore.getById(e))),!0),r.rowManager.renderRows(n)}),t))}layoutEventVerticallyStack(e){const{resourceMargin:t,rowHeight:r,barMargin:n}=this.scheduler;return 0===e?t:t+e*(r-2*t)+e*n}layoutEventVerticallyPack(e,t){const{resourceMargin:r,rowHeight:n,barMargin:i}=this.scheduler,s=1/t,o=e*s,a=(n-2*r-(s-1)*i)*t;return{top:r+o*a+o*i,height:a}}addTemporaryDragElement(e,t=e.resource){const{scheduler:r}=this,n=r.generateRenderData(e,t,{timeAxis:!0,viewport:!0});n.absoluteTop=n.row?n.top+n.row.top:r.getResourceEventBox(e,t,!0).top;const i=this.renderEvent(n),{dataset:s}=i;delete i.tabIndex,delete s.eventId,delete s.resourceId,delete s.syncId,s.transient=!0,i.parent=this.scheduler.foregroundCanvas,i.retainElement=!0;const o=DomHelper.createElement(i);return o.innerElement=o.firstChild,e.instanceMeta(r).hasTemporaryDragElement=!0,o}eventSorter(e,t){if(this.horizontalEventSorterFn)return this.horizontalEventSorterFn(e.eventRecord||e,t.eventRecord||t);const r=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,n=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,i=t.isModel?t.startDateMS:t.dataStartMS||t.startMS,s=t.isModel?t.endDateMS:t.dataEndMS||t.endMS,o=e.isModel?e.name:e.eventRecord.name,a=t.isModel?t.name:t.eventRecord.name;return r-i||s-n||(o<a?-1:o==a?0:1)}calculateMS(e){const{scheduler:t}=this,{timeAxis:r,timeAxisViewModel:n}=t;let i=getStartEnd(t,r,e.startDate,e.startDateMS,!1),s=getStartEnd(t,r,e.endDate,e.endDateMS,!0),o=s-i;if("default"!==t.milestoneLayoutMode&&0===o){const r=n.getSingleUnitInPixels("minute");switch(o=60*(t.getMilestoneLabelWidth(e)*(1/r))*1e3,t.milestoneAlign){case"start":case"left":s=i+o;break;case"end":case"right":s=i,i=s-o;break;default:s=i+o/2,i=s-o}}return{startMS:i,endMS:s,durationMS:o}}getTimeSpanRenderData(e,t,r=!1){const n=this,{scheduler:i}=n,{timeAxis:s,timeAxisViewModel:o}=i,a=!0===r||r.timeAxis,l=!0===r||r.viewport;if(a||s.isTimeSpanInAxis(e)){const r=i.getRowById(t);if(r||l){const a=o.getSingleUnitInPixels("minute"),l=e.startDate,c=e.endDate||l,d=s.startMS,u=s.endMS,{startMS:h,endMS:g,durationMS:m}=n.calculateMS(e),p=h<d|(h>u)<<1,f=g>u|(g<=d)<<1,v=m/6e4,y=f?a*v:null;let b,C=i.getCoordinateFromDate(g,{local:!0,respectExclusion:!0,isEnd:!0}),D=!1,S=!1;if(p?b=(h-d)/6e4*a:(b=i.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:-1!==C}),D=-1===b),f?C=b+y:S=-1===C,S&&!D&&(C=i.getCoordinateFromDate(g,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),y>9999999&&(1===p?1===f?(b=-100,C=i.timeAxisColumn.width+100):b=C-9999999:1===f&&(C=b+9999999)),D&&S&&(b=i.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:g}),C=i.getCoordinateFromDate(g,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:h}),b===C))return e.instanceMeta(i).excluded=!0,null;const E={eventRecord:e,taskRecord:e,left:Math.min(b,C),width:Math.abs(C-b)||(e.isMilestone?0:1),start:l,end:c,rowId:t.id,children:[],startMS:h,endMS:g,startsOutsideView:p,endsOutsideView:f,clippedStart:D,clippedEnd:S,row:r};return i.fillTicks&&(E.dataStartMS=E.start.getTime(),E.dataEndMS=E.end.getTime()),E.top=Math.max(0,i.resourceMargin),i.managedEventSizing&&(E.height=Math.max(i.rowManager.rowHeight-2*i.resourceMargin,1)),E}}}layoutResourceEvents(e,t=!1){const{scheduler:r}=this,{eventStore:n,assignmentStore:i,timeAxis:s}=r,o=n.getEvents({includeOccurrences:r.enableRecurringEvents,resourceRecord:e,startDate:s.startDate,endDate:s.endDate,filter:t=>t.assignments.some((t=>t.resource===e&&i.includes(t)))}),a=(r.getEventsToRender(e,o)||[]).reduce(((n,i)=>{if(t||s.isTimeSpanInAxis(i)){const t=r.generateRenderData(i,e,!1);t&&n.push(t)}return n}),[]);a.sort(this.eventSorter);let l=r.rowHeight;const c=r.currentEventLayout,d=a.filter((e=>e.eventRecord.isEvent));if("stack"===r.eventLayout){const t=c.applyLayout(d,e);l=t*(r.rowHeight-2*r.resourceMargin)+(t-1)*r.barMargin+2*r.resourceMargin}else"pack"===r.eventLayout&&c.applyLayout(d,e);return{rowHeight:l,eventsData:a}}renderEvent(e,t){const{scheduler:r}=this,{resourceRecord:n,assignmentRecord:i,eventRecord:s}=e,o=i?this.assignmentStore.getOccurrence(i,s).id:e.eventId,a={className:e.wrapperCls,tabIndex:"0",children:[{className:e.cls,style:e.style||"",children:e.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...e.wrapperChildren],style:{transform:`translate(${e.left}px, ${e.absoluteTop}px)`,height:e.fillSize?t:e.height,width:e.width>0?e.width:null,zIndex:e.zIndex,style:e.wrapperStyle},dataset:{resourceId:n.id,eventId:e.eventId,syncId:o},elementData:e,retainElement:(i||s).instanceMeta(r).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return i&&(a.dataset.assignmentId=i.id),e.elementConfig=a,r.trigger("beforeRenderEvent",{renderData:e,domConfig:a}),a}refreshRow(e,t=!0){let r,n;e.isModel?(r=this.scheduler.rowManager.getRowFor(e),n=e):(r=e,n=this.resourceStore.getById(e.id)),t&&this.clearResources([e]),r&&(this.renderer({row:r,record:n}),t&&this.onRenderDone())}renderer({row:e,record:t,size:r={}}){if(t.isSpecialRow)return void this.rowMap.delete(e);const n=this,{startMS:i,endMS:s}=n.visibleDateRange,o=[];let a=n.resourceMap.get(t.id);if(!a||a.invalid){if(n.suspended)return;a=n.layoutResourceEvents(t),n.resourceMap.set(t.id,a)}r.height=a.rowHeight,a.eventsData.forEach((t=>{t.endMS>=i&&t.startMS<=s&&(t.absoluteTop=t.top+e.top,o.push(n.renderEvent(t,a.rowHeight)))})),this.rowMap.set(e,o)}onRenderDone(){const{scheduler:e,rowMap:t}=this,r=[];t.forEach((e=>r.push.apply(r,e))),DomSync.sync({domConfig:{onlyChildren:!0,children:r},targetElement:e.foregroundCanvas,syncIdField:"syncId",callback({action:t,domConfig:r,lastDomConfig:n,targetElement:i}){var s;if("none"!==t&&(null==r||null===(s=r.className)||void 0===s?void 0:s[e.eventCls+"-wrap"])){const s=renderEventActions[t];if(releaseEventActions[t]&&(null==n?void 0:n.elementData)){const{eventRecord:t,resourceRecord:r,assignmentRecord:s}=n.elementData,o={renderData:n.elementData,element:i,eventRecord:t,resourceRecord:r,assignmentRecord:s};i===document.activeElement&&e.focusElement.focus(),e.trigger("releaseEvent",o)}if(s){const{eventRecord:n,resourceRecord:s,assignmentRecord:o}=r.elementData,a={renderData:r.elementData,tplData:r.elementData,element:i,isReusingElement:"reuseElement"===t,isRepaint:"reuseOwnElement"===t,eventRecord:n,resourceRecord:s,assignmentRecord:o};e.trigger("renderEvent",a)}}}})}clearResources(e){e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=[e]);e.map(Model.asId).forEach((e=>{const t=this.resourceMap.get(e);t&&(t.invalid=!0);const r=this.scheduler.getRowById(e);r&&this.rowMap.delete(r)}))}clearAll(){this.resourceMap.clear(),this.rowMap.clear()}}HorizontalRendering._$name="HorizontalRendering";class VerticalLayout extends(PackMixin()){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(e,t,r,n,i){super.applyLayout(e,((e,i,s,o)=>{if("none"===this.scheduler.eventLayout)e.width=t-2*r,e.left+=r;else{e.widthFactor=o;const a=e.leftFactor=s.start+i*o,l=Math.round(1/o),c=a/o,d=t-2*r-n*(l-1);"mixed"===this.scheduler.eventLayout&&2===l?(e.left+=a*t/5+n,e.width=t-a*t/5-2*n,e.zIndex=5+c):(e.width=o*d,e.left+=a*d+r+n*c)}}))}}VerticalLayout._$name="VerticalLayout";const releaseEventActions$1={releaseElement:1,reuseElement:1},renderEventActions$1={newElement:1,reuseOwnElement:1,reuseElement:1},chronoFields$1={startDate:1,endDate:1,duration:1};class VerticalRendering extends(Base.mixin(Delayable,BaseRendering,AttachToProjectMixin)){static get properties(){return{eventMap:{},resourceMap:{},releasedElements:{},toDrawOnProjectRefresh:new Set}}construct(e){this.client=this.scheduler=e,this.timeAxisViewModel=e.timeAxisViewModel,this.verticalLayout=new VerticalLayout({scheduler:e}),super.construct({})}init(){const e=this,{scheduler:t}=e;e.resourceColumns=t.timeAxisColumn.resourceColumns,e.resourceColumns.resourceStore=e.resourceStore,t.element.classList.add("b-sch-vertical"),e.resourceColumns.on({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:e}),e.initialized=!0,t.isPainted&&e.renderer(),e.resourceColumns.availableWidth=t.timeAxisSubGridElement.offsetWidth}resolveRowRecord(e,t){const{scheduler:r}=this,n=e instanceof Event?e:null,i=n?n.target:e,s=n?[n.offsetX,n.offsetY]:t,o=3===i.nodeType?i.parentElement:i,a=DomHelper.up(o,r.eventSelector);if(a)return r.resourceStore.getById(a.dataset.resourceId);if(!DomHelper.up(i,".b-sch-timeaxis-cell"))return null;if(!s)throw new Error("Vertical mode needs coordinates to resolve this element. Can also be called with a browser\n                event instead of element to extract element and coordinates from");const l=Math.floor(s[0]/this.resourceColumns.columnWidth);return r.resourceStore.getAt(l)}toggleCls(e,t,r=!0,n=!1){const i=ObjectHelper.getPath(this.eventMap,`${e.eventId}.${e.resourceId}`);if(i){i.renderData[n?"wrapperCls":"cls"][t]=r;const s=this.getElementFromAssignmentRecord(e,n);s&&s.classList[r?"add":"remove"](t)}}getDateFromXY(e,t,r,n=!1){let i=e[1];return r||(i=this.translateToScheduleCoordinate(i)),this.timeAxisViewModel.getDateFromPosition(i,t,n)}translateToScheduleCoordinate(e){return e-this.scheduler._bodyRectangle.y+this.scheduler.scrollTop}translateToPageCoordinate(e){return e+this.scheduler._bodyRectangle.y-this.scheduler.scrollTop}getResourceEventBox(e,t){const r=e.id,n=t.id;let{renderData:i}=ObjectHelper.getPath(this.eventMap,`${r}.${n}`)||{};return i||(this.layoutResource(this.scheduler.resourceStore.getById(n)),i=ObjectHelper.getPath(this.eventMap,`${r}.${n}`).renderData),i?new Rectangle(i.left,i.top,i.width,i.bottom-i.top):null}getScheduleRegion(e,t,r){const n=this,{scheduler:i}=n,s=Rectangle.from(i.timeAxisSubGridElement);e&&(s.left=n.resourceStore.indexOf(e)*i.resourceColumnWidth,s.right=s.left+i.resourceColumnWidth);const o=i.timeAxis.startDate,a=i.timeAxis.endDate,l=i.getDateConstraints(e,t)||{start:o,end:a},c=i.getCoordinateFromDate(DateHelper.max(o,l.start)),d=i.getCoordinateFromDate(DateHelper.min(a,l.end));return r?(s.top=c,s.bottom=d):(s.top=n.translateToPageCoordinate(c),s.bottom=n.translateToPageCoordinate(d)),s}getRowRegion(e,t,r){const{scheduler:n}=this,i=this.resourceStore.indexOf(e)*n.resourceColumnWidth,s=n.timeAxis.startDate,o=n.timeAxis.endDate,a=t?DateHelper.max(s,t):s,l=r?DateHelper.min(o,r):o,c=n.getCoordinateFromDate(a),d=n.getCoordinateFromDate(l,!0,!0),u=Math.min(c,d),h=Math.abs(c-d);return new Rectangle(i,u,n.resourceColumnWidth,h)}get visibleDateRange(){const e=this.scheduler,t=e.scrollable.y,r=e.scrollable.clientHeight;return{startDate:e.getDateFromCoordinate(t),endDate:e.getDateFromCoordinate(t+r)||e.timeAxis.endDate}}onResourceColumnWidthChange({width:e,oldWidth:t}){const r=this,{scheduler:n}=r;r.resourceColumns.width=n.timeAxisColumn.width=r.resourceStore.count*e,r.clearAll(),r.refresh(Math.abs(e-t)>30)}attachToProject(e){super.attachToProject(e),e&&e.on({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const e=this,{scheduler:t,toDrawOnProjectRefresh:r}=e;t.rendered&&!t.refreshSuspended&&(e.refreshAllWhenReady?(e.clearAll(),e.refresh(),e.refreshAllWhenReady=!1):r.size&&e.refresh(),r.clear())}attachToEventStore(e){super.attachToEventStore(e),this.refreshAllWhenReady=!0,e&&e.on({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){"batch"===e&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:e,records:t,record:r,replaced:n,changes:i,isAssign:s}){const o=this,a=t||(r?[r]:[]),l=new Set;switch(a.forEach((e=>{e.resources.forEach((e=>l.add(e.id)))})),e){case"sort":case"group":case"move":case"remove":return;case"dataset":return void o.refreshAllResourcesWhenReady();case"add":case"updateMultiple":break;case"replace":n.forEach((([,e])=>{e.resources.map((e=>l.add(e.id)))})),o.clearResources(l);break;case"removeall":case"filter":return o.clearAll(),void o.refresh();case"update":{const e=r.$entity?!Object.keys(i).some((e=>!r.$entity.getField(e))):!Object.keys(i).some((e=>!chronoFields$1[e]));let t=0;return"startDate"in i&&t++,"endDate"in i&&t++,"duration"in i&&t++,void((!e||t>1)&&(o.clearResources(l),o.refresh()))}}o.refreshResourcesWhenReady(l)}attachToResourceStore(e){const t=this;super.attachToResourceStore(e),t.refreshAllWhenReady=!0,t.resourceColumns&&(t.resourceColumns.resourceStore=e),e.on({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>t.scheduler.unmaskBody(),thisObj:t,prio:1}),t.initialized&&(t.firstResource=t.lastResource=null,t.clearAll(),t.renderer())}onResourceStoreChange({source:e,action:t,records:r,record:n,replaced:i,changes:s}){const o=this,a=r||(i?i.map((e=>e[1])):n?[n]:[]),l=new Set(a.map((e=>e.id)));if(o.firstResource=o.lastResource=null,o.scheduler.isEngineReady){switch(t){case"update":s&&s.id&&o.clearResources([s.id.oldValue,s.id.value]);break;case"filter":o.clearAll()}o.refresh(!0)}else{switch(t){case"dataset":case"remove":case"removeall":return void o.refreshAllResourcesWhenReady();case"replace":case"add":for(let t=a.reduce(((t,r)=>Math.min(t,e.indexOf(r))),e.count);t<e.count;t++)l.add(e.getAt(t).id)}o.refreshResourcesWhenReady(l)}}onResourceStoreRefresh({action:e}){const t=this;if("group"===e)throw new Error("Grouping of resources not supported in vertical mode");"sort"===e&&(t.firstResource=t.lastResource=null,t.clearAll(),t.refresh())}attachToAssignmentStore(e){super.attachToAssignmentStore(e),this.refreshAllWhenReady=!0,e&&e.on({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:t,replaced:r,record:n,changes:i}){const s=this,o=new Set((t||(n?[n]:[])).map((e=>e.resourceId)));if(s.scheduler.isEngineReady){switch(e){case"filter":s.clearAll();break;case"update":if("resourceId"in i&&o.add(i.resourceId.oldValue),!Object.keys(i).filter((e=>"resource"!==e&&"event"!==e)).length)return;s.clearResources(o)}s.refresh(!0)}else{switch(e){case"removeall":return void s.refreshAllResourcesWhenReady();case"replace":r.forEach((([e,t])=>{o.add(e.resourceId),o.add(t.resourceId)}))}s.refreshResourcesWhenReady(o)}}onAssignmentStoreRefresh({action:e,records:t}){"batch"===e&&(this.clearResources(t.map((e=>e.resourceId))),this.renderer())}refreshRows(e){e&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(e){this.renderResource(e)}updateFromHorizontalScroll(e){e!==this.prevScrollLeft&&(this.renderer(),this.prevScrollLeft=e)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(e,t){const{scheduler:r}=this,n=r.resourceStore.indexOf(e)*r.resourceColumnWidth;return r.scrollHorizontallyTo(n,t)}onViewportResize(e){this.resourceColumns.availableWidth=e,this.renderer()}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){const{scheduler:e,resourceStore:t}=this;return t&&t.count?{firstResource:Math.max(Math.floor(e.scrollLeft/e.resourceColumnWidth)-1,0),lastResource:Math.min(Math.floor((e.scrollLeft+e.timeAxisSubGrid.width)/e.resourceColumnWidth)+1,t.count-1)}:{firstResource:-1,lastResource:-1}}get dateRange(){const{scheduler:e}=this;let t=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));t||(t=e.timeAxis.last.endDate);let r=e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0));return r||(r=e.timeAxis.first.startDate,t=e.getDateFromCoordinate(e.bodyHeight+e.tickSize-1)),{topDate:r,bottomDate:t}}getTimeSpanRenderData(e,t,r=!1){const{scheduler:n}=this,{startDate:i,endDate:s}=e,o=n.getCoordinateFromDate(i),a=this.resourceStore.indexOf(t)*n.resourceColumnWidth,l=n.resourceColumnWidth-2*n.resourceMargin,c=i.getTime(),d=s.getTime();let u=n.getCoordinateFromDate(s),h=u-o;return-1===u&&(h=Math.round((d-c)*n.timeAxisViewModel.getSingleUnitInPixels("ms")),u=o+h),{eventRecord:e,resourceRecord:t,left:a,top:o,bottom:u,width:l,height:h,startDate:i,endDate:s,startDateMS:c,endDateMS:d,children:[],start:i,end:s,startMs:c,endMs:d}}eventSorter(e,t){const r=e.dataStartMs||e.startDateMS,n=e.dataEndMs||e.endDateMS,i=t.dataStartMs||t.startDateMS,s=t.dataEndMs||t.endDateMS,o=e.isModel?e.name:e.eventRecord.name,a=t.isModel?t.name:t.eventRecord.name;return r-i||s-n||(o<a?-1:o==a?0:1)}layoutResource(e){const t=this,{scheduler:r}=t,{assignmentStore:n,eventStore:i}=r,s=t.resourceMap[e.id]={},o=r.resourceStore.indexOf(e);let a=e.assignments.reduce(((e,t)=>(n.isAvailable(t)&&i.isAvailable(t.event)&&e.push(t.event),e)),[]);a=r.getEventsToRender(e,a);const l=a.reduce(((n,i)=>{const a=r.generateRenderData(i,e),l={renderData:a};return ObjectHelper.setPath(t.eventMap,`${a.eventId}.${e.id}`,l),s[a.eventId]=l,a.fillSize?(a.left=o*r.resourceColumnWidth,a.width=r.resourceColumnWidth):n.push(a),n}),[]);return l.sort(t.eventSorter),t.verticalLayout.applyLayout(l,r.resourceColumnWidth,r.resourceMargin,r.barMargin,o),s}addTemporaryDragElement(e){const{scheduler:t}=this,r=t.generateRenderData(e,e.resource,{timeAxis:!0,viewport:!0});r.top=r.row?r.top+r.row.top:t.getResourceEventBox(e,e.resource,!0).top;const n=this.renderEvent({renderData:r}),{dataset:i}=n;delete n.tabIndex,delete i.eventId,delete i.resourceId,delete i.syncId,i.transient=!0,n.parent=this.scheduler.foregroundCanvas,n.retainElement=!0;const s=DomHelper.createElement(n);return s.innerElement=s.firstChild,e.instanceMeta(t).hasTemporaryDragElement=!0,s}renderEvent(e){const t=e.renderData,{resourceRecord:r,assignmentRecord:n}=t,i={className:t.wrapperCls,tabIndex:"0",children:[{className:t.cls,style:(t.internalStyle||"")+(t.style||""),children:t.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...t.wrapperChildren],style:{transform:`translate(${t.left}px, ${t.top}px)`,height:t.height,width:t.width,zIndex:t.zIndex,style:t.wrapperStyle||""},dataset:{resourceId:r.id,eventId:t.eventId,syncId:n?n.id:t.eventId},elementData:e,retainElement:(n||t.eventRecord).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return n&&(i.dataset.assignmentId=n.id),this.scheduler.trigger("beforeRenderEvent",{renderData:t,domConfig:i}),e.elementConfig=i,i}renderResource(e){const t=this,{topDateMS:r,bottomDateMS:n}=t,i=[];let s=t.resourceMap[e.id];s||(s=t.layoutResource(e));for(const e in s){const o=s[e],{endDateMS:a,startDateMS:l,eventRecord:c}=o.renderData;a>=r&&l<=n&&!c.instanceMeta(t.scheduler).hasTemporaryDragElement&&i.push(t.renderEvent(o))}return i}isEventElement(e){const t=e&&e.className;return t&&t[this.scheduler.eventCls+"-wrap"]}renderer(){const e=this,{scheduler:t}=e,{resourceStore:r}=t,{firstResource:n,lastResource:i}=e.resourceRange,{topDate:s,bottomDate:o}=e.dateRange,a=[],l=[];if(e.initialized&&e.scheduler.isEngineReady){if(DateHelper.isEqual(s,e.topDate)&&DateHelper.isEqual(o,e.bottomDate)||(e.topDate=s,e.bottomDate=o,e.topDateMS=s.getTime(),e.bottomDateMS=o.getTime(),e.timeView.range={startDate:s,endDate:o},t.trigger("visibleRangeChange",{startDate:s,endDate:o})),-1!==n&&-1!==i)for(let t=n;t<=i;t++)a.push.apply(a,e.renderResource(r.getAt(t)));t.getForegroundDomConfigs(l),a.push.apply(a,l),DomSync.sync({domConfig:{onlyChildren:!0,children:a},targetElement:t.foregroundCanvas,syncIdField:"syncId",callback({action:r,domConfig:n,lastDomConfig:i,targetElement:s}){if(e.isEventElement(n)){const o=renderEventActions$1[r];if(releaseEventActions$1[r]&&e.isEventElement(i)&&!i.isReleased){const e=i.elementData.renderData,r={renderData:e,assignmentRecord:e.assignmentRecord,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,element:s};s===document.activeElement&&t.focusElement.focus(),t.trigger("releaseEvent",r)}if(o){const e=n.elementData.renderData,i={renderData:e,tplData:e,assignmentRecord:e.assignmentRecord,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,element:s,isReusingElement:"reuseElement"===r,isRepaint:"reuseOwnElement"===r};i.reusingElement="reuseElement"===r,t.trigger("renderEvent",i)}}}}),e.firstResource===n&&e.lastResource===i||(e.resourceColumns.range={firstResource:n,lastResource:i},e.firstResource=n,e.lastResource=i)}}refresh(e){this.scheduler.runWithTransition((()=>this.renderer()),e)}refreshResources(e){this.clearResources(e),this.refresh()}get timeView(){return this.scheduler.timeView}clearResources(e){e.forEach((e=>{this.resourceMap[e]&&(Object.keys(this.resourceMap[e]).forEach((t=>{delete this.eventMap[t][e]})),delete this.resourceMap[e])}))}clearAll(){this.resourceMap={},this.eventMap={}}}function isLastLevel(e,t){return e===t.length-1}function isLastCell(e,t){return t===e.cells[e.cells.length-1]}VerticalRendering._$name="VerticalRendering";class TimeAxisBase extends Widget{static get defaultConfig(){return{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null,wrapText:null}}static get properties(){return{startDate:null,endDate:null,levels:[],size:null}}set range(e){this.startDate=e.startDate,this.endDate=e.endDate,this.refresh()}buildCells(){var e;const t=this,{sizeProperty:r}=t,n=[],i=t.levels.map(((e,n)=>{var i;return{className:{"b-sch-header-row":1,["b-sch-header-row-"+e.position]:1,"b-sch-header-row-main":n===t.model.viewPreset.mainHeaderLevel,"b-lowest":isLastLevel(n,t.levels)},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:"headerRow"+n,headerPosition:e.position},children:null===(i=e.cells)||void 0===i?void 0:i.filter((e=>e.start<t.endDate&&e.end>t.startDate)).map((n=>({className:{"b-sch-header-timeaxis-cell":1,[n.headerCellCls]:n.headerCellCls,["b-align-"+n.align]:n.align,"b-last":isLastCell(e,n)},dataset:{tickIndex:n.index,...window.DEBUG&&{date:n.start.getTime()}},style:{[t.positionProperty]:n.coord,[r]:n.width,["min-"+r]:n.width},children:t.wrapText?[{className:"b-sch-header-text",html:n.value}]:null,html:t.wrapText?null:n.value})))}}));return null===(e=t.client)||void 0===e||e.getHeaderDomConfigs(n),i.push(...n),{className:"b-widget "+t.cls,syncOptions:{releaseThreshold:0},style:{[r]:t.size},children:i}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const t=this,{columnConfig:r}=t.model,{levels:n}=t,i=n.length;if(e){n.length=0,r.forEach(((e,t)=>n[t]={position:t,cells:e})),t.size=n[0].cells.reduce(((e,t)=>e+t.width),0);const e=t.element.parentElement;e&&(e.classList.remove("b-sch-timeaxiscolumn-levels-"+i),e.classList.add("b-sch-timeaxiscolumn-levels-"+n.length))}t.startDate&&t.endDate&&(DomSync.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}get widgetClass(){}}TimeAxisBase._$name="TimeAxisBase";class HorizontalTimeAxis extends TimeAxisBase{static get $name(){return"HorizontalTimeAxis"}static get defaultConfig(){return{cls:"b-horizontaltimeaxis",sizeProperty:"width",positionProperty:"left",wrapText:!1}}construct(){super.construct(...arguments),this.model.on({update:this.onModelUpdate,thisObj:this})}get width(){return this.size}onModelUpdate(){this.model.availableSpace!==this.width&&this.refresh(!0)}}HorizontalTimeAxis._$name="HorizontalTimeAxis";class ResourceHeader extends Widget{static get $name(){return"ResourceHeader"}static get defaultConfig(){return{resourceStore:null,columnWidth:150,headerRenderer:null,fillWidth:!0,fitWidth:!1,imagePath:null,imageExtension:null,defaultImageName:null}}static get properties(){return{firstResource:-1,lastResource:-1}}construct(e){super.construct(e);const t=this;null!=t.imagePath&&(EventHelper.on({element:t.element,delegate:".b-resource-image",capture:!0,error:e=>t.setDefaultResourceImage(e.target),thisObj:t}),t.element.classList.add("b-has-images")),EventHelper.on({element:t.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:t})}set resourceStore(e){const t=this;var r;e!==t._resourceStore&&(null===(r=t.resourceStoreDetacher)||void 0===r||r.call(t),t._resourceStore=e,t.resourceStoreDetacher=e.on({changePreCommit:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}get resourceStore(){return this._resourceStore}onResourceStoreDataChange({action:e}){const t=this,r=t.resourceStore.count*t.columnWidth;r!==t.width&&(t.element.style.width=r+"px",t.column.set("width",r,t.column.grid.isConfiguring)),"removeall"===e&&(t.element.innerHTML=""),"remove"!==e&&"add"!==e&&"filter"!==e||t.refreshWidths()}get columnWidth(){return this._columnWidth}set columnWidth(e){const t=this;if(e!==t._columnWidth){const r=t._columnWidth;t._columnWidth=e,t.refreshingWidths||(t._originalColumnWidth=e,t.refreshWidths()),t.isConfiguring||(t.refresh(),t.trigger("columnWidthChange",{width:t._columnWidth,oldWidth:r}))}}get fillWidth(){return this._fillWidth}set fillWidth(e){this._fillWidth=e,this.refreshWidths()}get fitWidth(){return this._fitWidth}set fitWidth(e){this._fitWidth=e,this.refreshWidths()}setDefaultResourceImage(e){if(this.defaultImageName){const t=this.getImageURL(this.defaultImageName);e.src&&!e.src.endsWith(t.replace(/^[./]*/gm,""))&&(e.src=t)}}getImageURL(e){return StringHelper.joinPaths([this.imagePath||"",e||""])}get imagePath(){return this._imagePath}set imagePath(e){this._imagePath=e,this.refresh()}get availableWidth(){return this._availableWidth}set availableWidth(e){this._availableWidth=e,this.refreshWidths()}refreshWidths(){const e=this,{availableWidth:t,_originalColumnWidth:r}=e,n=e.resourceStore&&e.resourceStore.count;if(!t||!n)return;e.refreshingWidths=!0;const i=e.fitWidth||e.fillWidth&&r*n<t?Math.floor(t/n):r,s=e.column.grid.enableEventAnimations&&Math.abs(e._columnWidth-i)>30;DomHelper.addTemporaryClass(e.element,"b-animating",s?300:0,e),e.columnWidth=i,e.refreshingWidths=!1}set range(e){const t=this;t.firstResource=e.firstResource,t.lastResource=e.lastResource,t.refresh()}refresh(){const e=this,{firstResource:t,lastResource:r}=e;if(e.column.grid.isConfiguring||-1===t||-1===r||r>=e.resourceStore.count)return;const n=[];for(let i=t;i<=r;i++){const t=e.resourceStore.getAt(i),r={className:new DomClassList({"b-resourceheader-cell":1}),dataset:{resourceId:t.id},style:{left:i*e.columnWidth,width:e.columnWidth},children:[]};if(e.headerRenderer){const n=e.headerRenderer({elementConfig:r,resourceRecord:t});null!=n&&(r.html=n)}else{let n;if(t.imageUrl)n=t.imageUrl;else if(null!=e.imagePath){const r=t.image||t.name&&t.name.toLowerCase()+e.imageExtension||e.defaultImageName;n=e.getImageURL(r)}null!=n&&r.children.push({tag:"img",className:"b-resource-image",src:n}),t.iconCls&&r.children.push({tag:"i",className:t.iconCls}),r.children.push({tag:"span",className:"b-resource-name",html:t.name})}n.push(r)}DomSync.sync({domConfig:{onlyChildren:!0,children:n},targetElement:e.element,syncIdField:"resourceId"})}onResourceMouseEvent(e){const t=e.target.closest(".b-resourceheader-cell"),r=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+StringHelper.capitalize(e.type),{resourceRecord:r,event:e})}}ResourceHeader._$name="ResourceHeader";class TimeAxisColumn extends(Events(Column)){construct(){const e=this;super.construct(...arguments),e.initialRender=!0,e.thisObj=e,e.timeAxisViewModel=e.timeline.timeAxisViewModel,e.mode=e.mode,e.grid.on({paint:"onTimelinePaint",thisObj:e,once:!0}),e.timeAxisViewModel.on({update:e.onViewModelUpdate,thisObj:e})}static get autoExposeFields(){return!0}static get fields(){return["mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1}}static get type(){return"timeAxis"}doDestroy(){this.resourceColumns&&this.resourceColumns.destroy(),super.doDestroy()}set mode(e){const t=this,{timeline:r}=t;t.set("mode",e),"horizontal"===e?t.timeAxisView=new HorizontalTimeAxis({model:t.timeAxisViewModel,compactCellWidthThreshold:t.compactCellWidthThreshold,owner:t.grid,client:t.grid}):"vertical"===e&&(t.resourceColumns=new ResourceHeader(ObjectHelper.assign({column:t,resourceStore:r.resourceStore,imagePath:r.resourceImagePath,imageExtension:r.resourceImageExtension,defaultImageName:r.defaultResourceImageName},r.resourceColumns||{})),t.relayEvents(t.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:e}){const t=this;"horizontal"===t.mode?(t.refreshHeader(!0),t.width=e.totalSize,t.timeline.refresh()):"vertical"===t.mode&&t.timeline.refreshRows()}onTimelinePaint({firstPaint:e}){const t=this;t.subGrid.insertRowsBefore&&e&&(t.subGridElement.classList.add("b-timeline-subgrid"),t.element&&EventHelper.on({element:t.element,thisObj:t,click:"onContainerElementClick",dblclick:"onContainerElementClick",contextmenu:"onContainerElementClick"}),"vertical"===t.mode&&t.refreshHeader())}refreshHeader(e){const t=this,{element:r}=t;r&&("horizontal"===t.mode?(!e&&t.timeAxisViewModel.update(null,!0),t.timeAxisView.rendered?t.timeAxisView.refresh(!0):(r.innerHTML="",t.timeAxisView.render(r))):"vertical"===t.mode&&(t.resourceColumns.currentElement||(r.innerHTML="",t.resourceColumns.render(r))))}renderer(e){if(this.timeline.project.isInitialCommitPerformed)return this.timeline.currentOrientation.renderer(e)}onContainerElementClick(e){const t=DomHelper.up(e.target,".b-sch-header-timeaxis-cell");if(t){const r=t.dataset.tickIndex,n=t.parentElement.dataset.headerPosition,i=this.timeAxisViewModel.columnConfig[n][r],s=this.grid.features.contextMenu;s&&e.type===s.triggerEvent||this.trigger("timeAxisHeader"+StringHelper.capitalize(e.type),{startDate:i.start,endDate:i.end,event:e})}}}ColumnStore.registerColumnType(TimeAxisColumn),TimeAxisColumn._$name="TimeAxisColumn";class VerticalTimeAxis extends TimeAxisBase{static get $name(){return"VerticalTimeAxis"}static get defaultConfig(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}get height(){return this.size}}VerticalTimeAxis._$name="VerticalTimeAxis";class VerticalTimeAxisColumn extends Column{static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cellCls:"b-verticaltimeaxiscolumn"}}get isFocusable(){return!1}construct(e){const t=this;super.construct(...arguments),t.timeAxisViewModel=e.timeline.timeAxisViewModel,t.view=new VerticalTimeAxis({model:t.timeAxisViewModel,client:e.timeline})}renderer({cellElement:e,size:t}){this.view.render(e),t.height=this.view.height}}ColumnStore.registerColumnType(VerticalTimeAxisColumn),VerticalTimeAxisColumn._$name="VerticalTimeAxisColumn";class SchedulerBase extends(TimelineBase.mixin(CrudManagerView,SchedulerDom,SchedulerDomEvents,SchedulerDragResize,SchedulerStores,SchedulerScroll,SchedulerState,SchedulerEventRendering,SchedulerRegions,EventSelection,EventNavigation)){static get $name(){return"SchedulerBase"}static get type(){return"schedulerbase"}static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",timeCellSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,milestoneCharWidth:10,milestoneAlign:"center",preCalculateHeightLimit:1e4,milestoneMinWidth:40,crudManagerClass:CrudManager,testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}static get deprecatedEvents(){return{eventContextMenuBeforeShow:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`eventContextMenuBeforeShow` event is deprecated, in favor of `eventMenuBeforeShow` event. Please see https://bryntum.com/docs/scheduler/#guides/upgrades/3.1.0.md for more information."},eventContextMenuShow:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`eventContextMenuShow` event is deprecated, in favor of `eventMenuShow` event. Please see https://bryntum.com/docs/scheduler/#guides/upgrades/3.1.0.md for more information."},eventContextMenuItem:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`eventContextMenuItem` event is deprecated, in favor of `eventMenuItem` event. Please see https://bryntum.com/docs/scheduler/#guides/upgrades/3.1.0.md for more information."},scheduleContextMenuBeforeShow:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`scheduleContextMenuBeforeShow` event is deprecated, in favor of `scheduleMenuBeforeShow` event. Please see https://bryntum.com/docs/scheduler/#guides/upgrades/3.1.0.md for more information."},scheduleContextMenuShow:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`scheduleContextMenuShow` event is deprecated, in favor of `scheduleMenuShow` event. Please see https://bryntum.com/docs/scheduler/#guides/upgrades/3.1.0.md for more information."},scheduleContextMenuItem:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`scheduleContextMenuItem` event is deprecated, in favor of `scheduleMenuItem` event. Please see https://bryntum.com/docs/scheduler/#guides/upgrades/3.1.0.md for more information."}}}afterConstruct(){super.afterConstruct(),this.createEventOnDblClick&&this.on("scheduledblclick",this.onSchedulerDblClick)}set timeAxisViewModel(e){super.timeAxisViewModel=e,this.eventStore&&(this.timeAxisViewModel.eventStore=this.eventStore)}get timeAxisViewModel(){return super.timeAxisViewModel}get store(){return super.store}set store(e){super.store=e}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onSchedulerDblClick({date:e,resourceRecord:t,row:r}){this.readOnly||t.isSpecialRow||this.internalAddEvent(e,t,r)}onColumnsChanged({action:e,changes:t,record:r}){r===this.timeAxisColumn&&"width"in t&&this.updateCanvasSize(),super.onColumnsChanged(...arguments)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}onEventCreated(e){}get isHorizontal(){return"horizontal"===this.mode}get isVertical(){return"vertical"===this.mode}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||("horizontal"===e?(t.horizontal=new HorizontalRendering(t),t.isPainted&&t.horizontal.init(),t.un("scroll",t.onVerticalScroll,t)):"vertical"===e&&(t.zoomOnTimeAxisDoubleClick=t.zoomOnMouseWheel=!1,t.vertical=new VerticalRendering(t),t.rendered&&t.vertical.init(),t.on("scroll",t.onVerticalScroll,t)))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){super.onElementKeyDown(e)}onElementKeyUp(e){super.onElementKeyUp(e)}onElementMouseOver(e){super.onElementMouseOver(e)}onElementMouseOut(e){super.onElementMouseOut(e)}populateEventMenu(){}populateScheduleMenu(){}async internalAddEvent(e,t,r){const n=this,i=[t],s=new n.eventStore.modelClass({startDate:e,endDate:DateHelper.add(e,1,n.timeAxis.unit)});if(n.onEventCreated(s),n.eventEdit){const e=n.currentOrientation.getTimeSpanRenderData(s,t),i=DomHelper.createElement({parent:n.foregroundCanvas,className:"b-sch-dragcreator-proxy",style:`width:${e.width}px;height:${e.height}px`});return DomHelper.setTranslateXY(i,e.left,(r&&r.top||0)+e.top),void n.editEvent(s,t,i)}n.taskEdit?n.editEvent(s,t):!1!==n.trigger("beforeEventAdd",{eventRecord:s,resourceRecords:i,resources:i})&&(n.eventStore.add(s),n.assignmentStore.assignEventToResource(s,t),n.taskEdit&&(await n.project.commitAsync(),n.editEvent(s,t)))}isDateRangeAvailable(e,t,r,n){return this.eventStore.isDateRangeAvailable(e,t,r,n)}async resumeRefresh(e){if(super.resumeRefresh(!1),!this.refreshSuspended&&e){if(!this.isEngineReady)return this.currentOrientation.refreshAllWhenReady=!0,this.project.commitAsync();this.isDestroyed||this.refreshWithTransition()}}toggleEmptyText(){const e=this;e.bodyContainer&&DomHelper.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.crudManager&&e.crudManager.isLoading))}getRowHeight(e){if(this.currentOrientation.calculateRowHeight){const t=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,t),t}}calculateRowHeights(e,t=!1){e.forEach((e=>e&&this.getRowHeight(e))),t||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:t,rowManager:r}=this,n=Math.min(t.count,this.preCalculateHeightLimit);if(n){r.clearKnownHeights();for(let e=0;e<n;e++)this.getRowHeight(t.getAt(e));e||r.estimateTotalHeight(!0)}}}SchedulerBase.initClass(),SchedulerBase._$name="SchedulerBase";const refreshActions={add:1,remove:1,update:1,removeAll:1,filter:1};class GroupSummary$1 extends GroupSummary{static get $name(){return"GroupSummary"}static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const r=this;if(e.isVertical)throw new Error("GroupSummary feature is not supported in vertical mode");r.scheduler=e,super.construct(e,t),!r.summaries&&r.renderer&&(r.summaries=[{renderer:r.renderer}]),r.isScheduler=e instanceof SchedulerBase,r.isScheduler&&(e.eventStore.on({change:r.onEventStoreChange,thisObj:r}),e.timeAxis.on({reconfigure:r.onTimeAxisChange,thisObj:r}),e.timeAxisViewModel.on({update:r.onTimeAxisChange,thisObj:r}))}doDestroy(){this._tip&&this._tip.destroy(),super.doDestroy()}onTimeAxisChange(){this.rerenderGroupSummaries()}onEventStoreChange({action:e}){refreshActions[e]&&this.rerenderGroupSummaries()}rerenderGroupSummaries(){this.scheduler.rowManager.rows.forEach((e=>{e.isGroupFooter&&e.render()}))}onBeforeRenderRow({row:e,record:t}){if(e.isGroupFooter&&!t.meta.hasOwnProperty("groupFooterFor")){const t=e.elements.normal.querySelector(".b-sch-timeaxis-cell");t&&(t.innerHTML="")}super.onBeforeRenderRow(...arguments)}generateHtml(e,t,r){if("timeAxis"===e.type){const e=this,r=e.scheduler,n=r.tickSize;let i="";return r.isEngineReady&&r.timeAxis.forEach((s=>{const o=r.eventStore.getEvents({startDate:s.startDate,endDate:s.endDate,allowPartial:!0,onlyAssigned:!0}).filter((e=>e.resources.some((e=>t.includes(e))))),a=e.summaries.map((e=>`<div class="b-timeaxis-summary-value">${e.renderer({startDate:s.startDate,endDate:s.endDate,eventStore:r.eventStore,resourceStore:r.resourceStore,events:o})}</div>`)).join("");i+=`<div class="b-timeaxis-tick" style="width: ${n}px">${a}</div>`})),`<div class="b-timeaxis-group-summary">${i}</div>`}return super.generateHtml(e,t,r)}updateSummaryHtml(e,t,r){const n=super.updateSummaryHtml(e,t,r);if("timeAxis"===t.type){const e={count:0,height:0};return this.summaries.forEach((t=>{t.height?e.height+=t.height:e.count++})),e}return n}getTipHtml({activeTarget:e}){const t=this,r=Array.from(e.parentElement.children).indexOf(e),n=t.scheduler.timeAxis.getAt(r);let i=`<header>${t.L("L{Summary.Summary for}",t.scheduler.getFormattedDate(n.startDate))}</header>`,s=!1;return DomHelper.forEachSelector(e,".b-timeaxis-summary-value",((e,r)=>{const n=t._labels[r],o=e.innerText.trim();i+=`<label>${n||""}</label><div class="b-timeaxis-summary-value">${o}</div>`,e.innerHTML&&(s=!0)})),s?i:null}render(){const e=this,{scheduler:t}=e;e.isScheduler&&e.summaries&&e.summaries.some((e=>e.label))&&e.showTooltip&&!e._tip&&(e._labels=e.summaries.map((e=>e.label||"")),e._tip=new Tooltip({id:t.id+"-groupsummary-tip",cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:t.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",clippedBy:[t.timeAxisSubGridElement,t.bodyContainer],getHtml:e.getTipHtml.bind(e)}))}}GroupSummary$1._$name="GroupSummary",GridFeatureManager.registerFeature(GroupSummary$1,!1,"Scheduler");class HeaderContextMenu extends InstancePlugin{static get $name(){return"HeaderContextMenu"}static get defaultConfig(){return{extraItems:null,processItems:null}}static get pluginConfig(){return{chain:["populateHeaderMenu"]}}construct(e,t){super.construct(e,t),this.scheduler=e,VersionHelper.deprecate("Scheduler","5.0.0","`HeaderContextMenu` feature is deprecated, in favor of `TimeAxisHeaderMenu` feature. Please see https://bryntum.com/docs/scheduler/#guides/upgrades/3.1.0.md for more information."),e.features.timeAxisHeaderMenu&&(e.features.timeAxisHeaderMenu.disabled=!0),e.features.headerMenu&&(e.features.headerMenu._showForTimeAxis=!0)}populateHeaderMenu({column:e,items:t,menu:r}){const n=this;if("timeAxis"!==e.type)return;r&&(r.scrollAction="realign"),ObjectHelper.merge(t,n.defaultItems);const i=ObjectHelper.transformNamedObjectToArray(t);n.extraItems&&i.push(...n.extraItems),n.processItems&&n.processItems({items:i});const s=ObjectHelper.transformArrayToNamedObject(i);ObjectHelper.removeAllProperties(t),ObjectHelper.merge(t,s)}get defaultItems(){const e=this,{scheduler:t}=e,{timeAxis:r}=t,n={magnitude:r.shiftIncrement,unit:r.shiftUnit},i={};return i.pickZoomLevel={text:"L{pickZoomLevel}",localeClass:this,icon:"b-fw-icon b-icon-search-plus",disabled:!t.presets.count||e.disabled,menu:{type:"popup",items:[{type:"slider",showValue:!1,listeners:{input:e.onZoomSliderChange,thisObj:e},minWidth:130}],onBeforeShow({source:e}){const[r]=e.items;r.min=t.minZoomLevel,r.max=t.maxZoomLevel,r.value=t.zoomLevel}}},e.startDateField=new DateField({label:e.L("L{startText}"),labelWidth:"6em",required:!0,step:n,listeners:{change:e.onRangeDateFieldChange,thisObj:e}}),e.endDateField=new DateField({label:e.L("L{endText}"),labelWidth:"6em",required:!0,step:n,listeners:{change:e.onRangeDateFieldChange,thisObj:e}}),i.activeDateRange={text:"L{activeDateRange}",localeClass:this,icon:"b-fw-icon b-icon-calendar",disabled:e.disabled,menu:{type:"popup",width:"20em",items:[e.startDateField,e.endDateField,{type:"button",cls:"b-left-nav-btn",icon:"b-icon b-icon-prev",color:"b-blue b-raised",flex:1,margin:0,listeners:{click:e.onLeftShiftBtnClick,thisObj:e}},{type:"button",cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",localeClass:this,flex:4,margin:"0 8",listeners:{click:e.onTodayBtnClick,thisObj:e}},{type:"button",cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,listeners:{click:e.onRightShiftBtnClick,thisObj:e}}],onBeforeShow:()=>e.initDates()}},i}onZoomSliderChange({value:e}){this.scheduler.zoomLevel=e}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.scheduler.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.scheduler.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const t=this,r=e===t.startDateField,{client:n}=t,{timeAxis:i}=n,s=t.startDateFieldInitialValue&&!r?t.startDateFieldInitialValue:t.startDateField.value;let o=t.endDateFieldInitialValue&&r?t.endDateFieldInitialValue:t.endDateField.value;r?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,o-s?o<s&&(o=DateHelper.add(s,i.shiftIncrement,i.shiftUnit)):o=DateHelper.add(o,i.shiftIncrement,i.shiftUnit),n.preserveViewCenter((()=>n.timeAxis.setTimeSpan(s,o))),t.initDates()}onLeftShiftBtnClick(){this.scheduler.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=DateHelper.clearTime(new Date);this.scheduler.timeAxis.setTimeSpan(e,DateHelper.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.scheduler.timeAxis.shiftNext(),this.initDates()}}HeaderContextMenu.featureClass="",HeaderContextMenu._$name="HeaderContextMenu",GridFeatureManager.registerFeature(HeaderContextMenu);class HeaderZoom extends InstancePlugin{static get $name(){return"HeaderZoom"}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove","onElementMouseUp"]}}onElementMouseDown(e){const t=this,r=t.client;if(!e.touches&&0===e.button&&!t.disabled&&e.target.matches(".b-sch-header-timeaxis-cell")){const n=r.subGrids.normal.header.headersElement;t.startX=e.clientX,t.element=DomHelper.createElement({parent:n,tag:"div",className:"b-headerzoom-rect"}),t.headerElementRect=Rectangle.from(n)}}onElementMouseMove(e){const t=this;if(0!==e.buttons||BrowserHelper.isSafari||BrowserHelper.isIE11&&!e.isTrusted){if("number"==typeof t.startX){const r=Math.max(e.clientX,t.headerElementRect.left),n=Math.min(t.startX,r),i=Math.abs(t.startX-r),s=new Rectangle(n-t.headerElementRect.x+t.client.scrollLeft,0,i,t.headerElementRect.height);DomHelper.setTranslateX(t.element,s.left),t.element.style.width=s.width+"px"}}else t.onElementMouseUp(e)}onElementMouseUp(e){const t=this;if("number"==typeof t.startX){const e=t.client,r=Rectangle.from(t.element),n=e.getDateFromCoordinate(r.left,"round",!1),i=e.getDateFromCoordinate(r.right,"round",!1);t.element&&t.element.remove(),t.startX=null,t.client.zoomToSpan({startDate:n,endDate:i})}}}HeaderZoom._$name="HeaderZoom",GridFeatureManager.registerFeature(HeaderZoom,!1,"Scheduler");class AbstractTimeRanges extends(InstancePlugin.mixin(Delayable)){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",store:{modelClass:TimeSpan},enableResizing:!1,showTooltip:!0,showHeaderElements:!0,dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    <div class="b-sch-tip-name">${e.name||""}</div>\n                    ${e.startClockHtml}\n                    ${e.endClockHtml||""}\n                </div>\n            `,baseCls:"b-sch-timerange",cls:"",narrowThreshold:80}}static get pluginConfig(){return{chain:["onPaint","populateHeaderMenu","populateTimeAxisHeaderMenu"]}}construct(e,t){const r=this;super.construct(e,t),r.cls=r.cls||"b-timerange-"+r.constructor.$$name,r.baseSelector=`.${r.baseCls}.${r.cls}`,r.enableResizing&&(r.showHeaderElements=!0)}doDestroy(){var e,t,r,n,i;const s=this;null===(e=s.storeDetacher)||void 0===e||e.call(s),s.detachListeners("timeAxisViewModel"),s.detachListeners("timeAxis"),null===(t=s.clockTemplate)||void 0===t||t.destroy(),null===(r=s.tip)||void 0===r||r.destroy(),null===(n=s.drag)||void 0===n||n.destroy(),null===(i=s.resize)||void 0===i||i.destroy(),super.doDestroy()}doDisable(e){this.client.isPainted&&this.renderRanges(),super.doDisable(e)}onPaint(){const e=this,{client:t}=e;e.isPainted||(e.timeAxisViewModel=t.timeAxisViewModel,e.timeAxisViewModel.on({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),t.timeAxis.on({name:"timeAxis",includeChange:"onTimeAxisViewModelUpdate",thisObj:e}),e.enableResizing&&!t.hideHeaders&&(e.drag=new DragHelper({name:"rangeDrag",mode:t.isVertical?"translateY":"translateX",constrain:!0,outerElement:e.headerContainerElement,targetSelector:""+e.baseSelector,isElementDraggable:(r,n)=>!t.readOnly&&e.isElementDraggable(r,n),transitionDuration:t.transitionDuration,listeners:{dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onInvalidDrop",thisObj:e}}),e.resize=new ResizeHelper({direction:t.mode,targetSelector:e.baseSelector+".b-sch-range",outerElement:e.headerContainerElement,isElementResizable:e=>!e.closest(".b-dragging"),listeners:{resizestart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",thisObj:e}})),e.renderRanges())}renderRanges(){const e=this,t=e.client.foregroundCanvas;if(t){const{headerContainerElement:r}=e;if(DomHelper.removeEachSelector(t,e.baseSelector),r&&DomHelper.removeEachSelector(r,e.baseSelector),!e.disabled)for(const t of e.timeRanges)e.renderRange(t,!0)}}get timeRanges(){return this.store.records}shouldRenderRange(e){const{timeAxis:t}=this.client;return e.duration&&t.timeSpanInAxis(e.startDate,e.endDate)||e.startDate&&t.dateInAxis(e.startDate)}renderRange(e,t){const r=this,n=r.client;if(r.shouldRenderRange(e)){const i=n.getCoordinateFromDate(DateHelper.max(e.startDate,n.timeAxis.startDate),{respectExclusion:!0}),s=e.duration&&n.getCoordinateFromDate(DateHelper.min(e.endDate,n.timeAxis.endDate),{respectExclusion:!0,isEnd:!0}),o=s-i,a=`<label>${e.iconCls?`<i class="${e.iconCls}"></i>`:""} ${e.name||"&nbsp;"}</label>`,l={className:{[r.baseCls]:1,[r.cls]:r.cls,[r.rangeCls]:s,[r.lineCls]:!s,[e.cls]:e.cls,"b-narrow-range":s&&o<r.narrowThreshold},dataset:{id:e.id},style:n.isVertical?`transform: translateY(${i}px); ${s?`height:${o}px`:""};`:`transform: translateX(${i}px); ${s?`width:${o}px`:""};`,retainElement:!0},c=DomHelper.createElement(Object.assign({},l,{parent:t&&n.foregroundCanvas,style:l.style+(e.style||""),html:r.showHeaderElements&&!r.showLabelInBody?"":a}));let d;r.showHeaderElements&&(d=DomHelper.createElement(Object.assign({parent:t&&r.headerContainerElement,html:e.name&&!r.showLabelInBody?a:""},l)));const u={bodyElement:c,headerElement:d};return t&&r.rotateLabel(e,u),u}}rotateLabel(e,{bodyElement:t}){if(!e.iconCls&&!e.name)return;const r=t.firstChild;if(!r)return;r.classList.remove("b-vertical");const n=this.client.isVertical?r.offsetHeight<t.offsetHeight:r.offsetWidth>t.offsetWidth;r.classList[n?"add":"remove"]("b-vertical")}getElementsByRecord(e){const t="object"!=typeof e?e:e.id,r=this.client.foregroundCanvas.querySelector(`${this.baseSelector}[data-id="${t}"]`),n=this.headerContainerElement.querySelector(`${this.baseSelector}[data-id="${t}"]`);return r?{bodyElement:r,headerElement:n}:null}getBodyElementByRecord(e){const t="string"==typeof e?e:e.id;return this.client.foregroundCanvas.querySelector(`${this.baseSelector}[data-id="${t}"]`)}getRecordByElement(e){return this.store.getById(e.dataset.id)}get headerContainerElement(){const{isVertical:e,timeView:t,timeAxisColumn:r}=this.client;let n=null;return e&&t.element?n=t.element.parentElement:e||(n=r.element),n}get showHeaderElements(){return this._showHeaderElements}set showHeaderElements(e){this._showHeaderElements=e,this.client.isPainted&&(e?this.client.element.classList.add("b-sch-timeranges-with-headerelements"):this.client.element.classList.remove("b-sch-timeranges-with-headerelements"),this.renderRanges())}populateHeaderMenu({column:e,items:t}){"timeAxis"===e.type&&this.populateTimeAxisHeaderMenu(...arguments)}populateTimeAxisHeaderMenu({column:e,items:t}){}get store(){return this._store}set store(e){const t=this;t._store=Store.getStore(e,Store);let r=!1;t.storeDetacher&&(t.storeDetacher(),r=!0),t.storeDetacher=t._store.on({change:t.onStoreChanged,refresh:t.onStoreChanged,thisObj:t}),r&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.renderRanges()}onStoreChanged(e){const t=this;if(!(t.disabled||t.isConfiguring||"refresh"===e.type&&"batch"!==e.action))if("update"===e.action){const r=e.record,n=e.changes.hasOwnProperty("id")?e.changes.id.oldValue:r.id,i=t.getElementsByRecord(n),s=t.renderRange(r,!i);if(i&&!s&&(i.bodyElement.remove(),i.headerElement&&i.headerElement.remove()),!i||!s)return;t.client.runWithTransition((()=>{DomHelper.sync(s.bodyElement,i.bodyElement),t.showHeaderElements&&DomHelper.sync(s.headerElement,i.headerElement),t.rotateLabel(r,i)}))}else t.renderRanges()}showTip(e){const t=this;t.showTooltip&&(t.clockTemplate=new ClockTemplate({scheduler:t.client}),t.tip=new Tooltip({id:t.client.id+"-time-range-tip",cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>t.getTipHtml(e.record,e.element)}))}isElementDraggable(e){return(e=e.closest(this.baseSelector+":not(.b-resizing)"))&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const t=this,r=t.getRecordByElement(e.element.closest(t.baseSelector)),n=t.getBodyElementByRecord(r),i=t.drag;Object.assign(e,{record:r,rangeBodyEl:n,originRangeX:DomHelper.getTranslateX(n),originRangeY:DomHelper.getTranslateY(n)}),t.client.isVertical?(i.minY=0,i.maxY=t.timeAxisViewModel.totalSize-e.rangeBodyEl.offsetHeight,i.minX=0,i.maxX=Number.MAX_SAFE_INTEGER):(i.minX=0,i.maxX=t.timeAxisViewModel.totalSize-e.rangeBodyEl.offsetWidth,i.minY=0,i.maxY=Number.MAX_SAFE_INTEGER),t.client.element.classList.add("b-dragging-timerange"),t.showTip(e)}onDrag({context:e}){this.client.isVertical?DomHelper.setTranslateY(e.rangeBodyEl,DomHelper.getTranslateY(e.element)):DomHelper.setTranslateX(e.rangeBodyEl,DomHelper.getTranslateX(e.element))}onDrop({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,r=e.record,n=e.rangeBodyEl.getBoundingClientRect(),i=t.client.getDateFromCoordinate(t.client.isVertical?n.top:n.left,"round",!1);r.startDate-i!=0?r.setStartDate(i):t.onInvalidDrop(),t.tip&&(t.tip.destroy(),t.tip=null),t.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){const e=this;e.drag.reset(),e.renderRanges(),e.client.element.classList.remove("b-dragging-timerange"),e.tip&&(e.tip.destroy(),e.tip=null)}onResizeStart({context:e}){const t=this,r=t.getRecordByElement(e.element.closest(t.baseSelector)),n=t.getBodyElementByRecord(r);Object.assign(e,{record:r,rangeBodyEl:n}),t.showTip(e)}onResizeDrag({context:e}){this.client.isVertical?("top"===e.edge&&DomHelper.setTranslateY(e.rangeBodyEl,e.newY),e.rangeBodyEl.style.height=e.newHeight+"px"):("left"===e.edge&&DomHelper.setTranslateX(e.rangeBodyEl,e.newX),e.rangeBodyEl.style.width=e.newWidth+"px")}onResize({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,{client:r}=t,n=e.record,i=e.element.getBoundingClientRect(),s=r.isVertical?i.top:i.left,o=r.isVertical?i.bottom:i.right,a=r.getDateFromCoordinate(s,"round",!1),l="left"===e.edge||"top"===e.edge,c=r.getDateFromCoordinate(o,"round",!1);(l&&n.startDate-a!=0||c&&n.endDate-c!=0)&&c>a?l?n.setStartDate(a,!1):n.setEndDate(c,!1):t.onInvalidResize(),t.tip&&(t.tip.destroy(),t.tip=null)}onInvalidResize(){const e=this;e.resize.reset(),e.renderRanges(),e.tip&&(e.tip.destroy(),e.tip=null)}getTipHtml(e,t){const r=this,{client:n}=r,i=t.getBoundingClientRect(),s=n.isVertical?i.top:i.left,o=n.isVertical?i.bottom:i.right,a=n.getDateFromCoordinate(s,"round",!1),l=e.endDate&&n.getDateFromCoordinate(o,"round",!1),c=n.getFormattedDate(a),d=l&&n.getFormattedEndDate(l,a);return r.dragTipTemplate({name:e.name||"",startDate:a,endDate:l,startText:c,endText:d,startClockHtml:r.clockTemplate.template({date:a,text:c,cls:"b-sch-tooltip-startdate"}),endClockHtml:d&&r.clockTemplate.template({date:l,text:d,cls:"b-sch-tooltip-enddate"})})}}AbstractTimeRanges._$name="AbstractTimeRanges";class NonWorkingTime extends(AbstractTimeRanges.mixin(AttachToProjectMixin)){static get $name(){return"NonWorkingTime"}static get defaultConfig(){return{highlightWeekends:!0,showHeaderElements:!0,showLabelInBody:!0,cls:"b-sch-nonworkingtime",maxTimeAxisUnit:"week"}}static get pluginConfig(){return{chain:["onPaint","attachToProject"]}}doDestroy(){this.attachToCalendar(null),super.doDestroy()}attachToProject(e){super.attachToProject(e),this.attachToCalendar(e.effectiveCalendar),e.on({name:"project",calendarChange:()=>this.attachToCalendar(this.project.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate()}attachToCalendar(e){const t=this,{project:r,client:n}=t;t.detachListeners("calendar"),e&&(n.isSchedulerPro||n.isGantt||e!==r.defaultCalendar||r.defaultCalendar.intervalStore.count||e.addIntervals([{recurrentStartDate:"on Sat at 0:00",recurrentEndDate:"on Mon at 0:00",isWorking:!1}]),e.intervalStore.on({name:"calendar",change:t.renderRanges,delay:1,thisObj:t})),n.isEngineReady?t.renderRanges():r.isDestroyed||r.on({refresh:t.renderRanges,thisObj:t,once:!0})}get calendar(){var e;return null===(e=this.project)||void 0===e?void 0:e.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=DateHelper.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(e){return super.shouldRenderRange(e)&&e.durationMS>=this.timeAxisUnitDurationMs}renderRanges(){const e=this,{store:t,calendar:r}=e,{timeAxis:n,foregroundCanvas:i}=e.client;if(r&&i&&t&&!t.isDestroyed){if(!e.disabled){const i=!e.maxTimeAxisUnit||DateHelper.compareUnits(n.unit,e.maxTimeAxisUnit)<=0;if(t.removeAll(!0),r&&e.highlightWeekends&&i&&n.count){const e=r.getNonWorkingTimeRanges(n.startDate,n.endDate).map(((e,t)=>({name:e.name,cls:"b-nonworkingtime",startDate:e.startDate,endDate:e.endDate}))),i=[];let s;e.forEach((e=>{s&&e.startDate<=s.endDate&&e.name===s.name?s.endDate=e.endDate:(i.push(e),e.id="nonworking-"+i.length,s=e)})),t.add(i,!0)}}super.renderRanges()}}}NonWorkingTime._$name="NonWorkingTime",GridFeatureManager.registerFeature(NonWorkingTime,!1,"Scheduler"),GridFeatureManager.registerFeature(NonWorkingTime,!0,"SchedulerPro"),GridFeatureManager.registerFeature(NonWorkingTime,!0,"Gantt");class Pan extends InstancePlugin{static get $name(){return"Pan"}static get defaultConfig(){return{vertical:!0}}construct(e,t){if(this.timeline=e,e.features.eventDragCreate&&!e.features.eventDragCreate.disabled)throw new Error("Cannot combine Pan and eventDragCreate features");this.targetSelector=[".b-grid-cell",".b-timeline-subgrid"].join(","),super.construct(e,t)}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove","onElementMouseUp"]}}onElementMouseDown(e){const t=this,r=t.timeline,n=Object.values(r.features).find((e=>e instanceof DragBase)),i=r.readOnly||!n||n.disabled;e.touches||0!==e.button||t.disabled||(e.target.matches(t.targetSelector)||i&&e.target.closest(r.eventSelector))&&(t.mouseX=e.clientX,t.mouseY=e.clientY)}onElementMouseMove(e){const t=this;if(0!==e.buttons||BrowserHelper.isSafari||BrowserHelper.isIE11&&!e.isTrusted){if("number"==typeof t.mouseX){const r=t.timeline.subGrids.normal.scrollable,n=t.timeline.scrollable,i=e.clientX,s=e.clientY;e.preventDefault(),t.vertical&&n.scrollBy(0,t.mouseY-s),r.scrollBy(t.mouseX-i),t.mouseX=i,t.mouseY=s}}else t.onElementMouseUp()}onElementMouseUp(e){this.mouseX=this.mouseY=null}}Pan._$name="Pan",GridFeatureManager.registerFeature(Pan,!1,["Scheduler","Gantt"]);class ResourceTimeRangesBase extends(InstancePlugin.mixin(AttachToProjectMixin)){static get pluginConfig(){return{chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"]}}noFeatureElementsInAxis(){const{timeAxis:e}=this.scheduler;return this.store&&!this.store.storage.values.some((t=>e.isTimeSpanInAxis(t)))}construct(e,t){this.scheduler=e,super.construct(e,t)}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}getEventsToRender(e,t){throw new Error("Implement in subclass")}onEventDataGenerated(e){const t=this,{eventRecord:r}=e;t.shouldInclude(r)&&(t.scheduler.isVertical?e.width=t.scheduler.resourceColumnWidth:e.top=0,e.fillSize=!0,e.wrapperCls[t.rangeCls]=1,e.wrapperCls["b-sch-color-"+r.timeRangeColor]=r.timeRangeColor,e.children.push(r.name),e.eventId=`${t.idPrefix}-${r.id}`)}shouldInclude(e){throw new Error("Implement in subclass")}onStoreChange(e){this.scheduler.onInternalEventStoreChange(e)}}ResourceTimeRangesBase.featureClass="",ResourceTimeRangesBase._$name="ResourceTimeRangesBase";class ResourceTimeRanges extends ResourceTimeRangesBase{static get $name(){return"ResourceTimeRanges"}static get defaultConfig(){return{idPrefix:"resourcetimerange",rangeCls:"b-sch-resourcetimerange",store:!1,resourceTimeRanges:null}}attachToProject(e){const t=this,{scheduler:r}=t;if(super.attachToProject(e),!e.resourceTimeRangeStore){e.resourceTimeRangeStore=t._store||r.resourceTimeRangeStore||new ResourceTimeRangeStore;const{crudManager:n}=r;n&&!n.resourceTimeRangeStore&&(n.resourceTimeRangeStore=e.resourceTimeRangeStore)}const n=e.resourceTimeRangeStore;t.exposedOnScheduler||(r.resourceTimeRanges&&(n.add(r.resourceTimeRanges),delete r.resourceTimeRanges),Object.defineProperty(r,"resourceTimeRanges",{get:()=>n.records,set:e=>n.data=e}),Object.defineProperty(r,"resourceTimeRangeStore",{get:()=>n}),t.exposedOnScheduler=!0),n.resourceStore||(n.resourceStore=e.resourceStore),t.detachListeners("store"),n.on({name:"store",change:t.onStoreChange,thisObj:t})}set store(e){this._store=e}get store(){return this.project.resourceTimeRangeStore}getEventsToRender(e,t){return e.timeRanges&&e.timeRanges.length&&!this.disabled&&t.push(...e.timeRanges),t}shouldInclude(e){return e.isResourceTimeRange&&!e.isNonWorking}}ResourceTimeRanges.featureClass="",ResourceTimeRanges._$name="ResourceTimeRanges",GridFeatureManager.registerFeature(ResourceTimeRanges,!1,"Scheduler");class ScheduleMenu extends TimeSpanMenuBase{static get $name(){return"ScheduleMenu"}static get defaultConfig(){return{type:"schedule"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateScheduleMenu"),e}shouldShowMenu(e){const{client:t}=this,{column:r,targetElement:n,resourceRecord:i}=e;return(r?r===t.timeAxisColumn:t.timeAxisSubGrid.element===n)&&!(i&&i.isSpecialRow)}getDataFromEvent(e){const{client:t}=this,r=t.getCellDataFromEvent(e),n=t.getDateFromDomEvent(e,"floor"),i=t.resolveResourceRecord(e)||t.resourceStore.last;return ObjectHelper.assign(super.getDataFromEvent(e),r,{date:n,resourceRecord:i})}populateScheduleMenu({items:e}){const{client:t}=this;t.readOnly||(e.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:0===t.resourceStore.count,weight:100,onItem({date:e,resourceRecord:r}){t.internalAddEvent(e,r,t.getRowFor(r))}})}}ScheduleMenu.featureClass="",ScheduleMenu._$name="ScheduleMenu",GridFeatureManager.registerFeature(ScheduleMenu,!0,"Scheduler");class ScheduleContextMenu extends ScheduleMenu{static get $name(){return"ScheduleContextMenu"}construct(e,t){super.construct(e,t),this.scheduler=e,VersionHelper.deprecate("Scheduler","5.0.0","`ScheduleContextMenu` feature is deprecated, in favor of `ScheduleMenu` feature. Please see https://bryntum.com/docs/scheduler/#guides/upgrades/3.1.0.md for more information."),e.features.scheduleMenu&&(e.features.scheduleMenu.disabled=!0)}}ScheduleContextMenu.featureClass="",ScheduleContextMenu._$name="ScheduleContextMenu",GridFeatureManager.registerFeature(ScheduleContextMenu);class RectangularPathFinder extends Base{static get defaultConfig(){return{startSide:"right",startArrowSize:0,startArrowMargin:12,startShift:0,endSide:"left",endArrowSize:0,endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null}}findPath(e,t){let r,n,i,s,o,a,l,c,d,u,h,g,m,p,f,v,y,b,C,D,S,E,w,x,R,T,M,P,I,A,F,k=this;for(t&&!Array.isArray(t)&&(t=[t]),F=0;e&&!A;)for(r=Object.assign(k.config,e),n=r.startBox,i=r.endBox,s=r.startShift,o=r.endShift,a=r.startSide,l=r.endSide,c=r.startArrowSize,d=r.endArrowSize,u=r.startArrowMargin,h=r.endArrowMargin,g=r.horizontalMargin,m=r.verticalMargin,p=r.hasOwnProperty("startHorizontalMargin")?r.startHorizontalMargin:g,f=r.hasOwnProperty("startVerticalMargin")?r.startVerticalMargin:m,v=r.hasOwnProperty("endHorizontalMargin")?r.endHorizontalMargin:g,y=r.hasOwnProperty("endVerticalMargin")?r.endVerticalMargin:m,b=r.hasOwnProperty("otherHorizontalMargin")?r.otherHorizontalMargin:g,C=r.hasOwnProperty("otherVerticalMargin")?r.otherVerticalMargin:m,D=r.otherBoxes,a=k.normalizeSide(a),l=k.normalizeSide(l),S=k.getConnectionCoordinatesFromBoxSideShift(n,a,s),E=k.getConnectionCoordinatesFromBoxSideShift(i,l,o),M=k.calcGridBaseBoxFromBoxAndDrawParams(n,a,c,u,p,f),P=k.calcGridBaseBoxFromBoxAndDrawParams(i,l,d,h,v,y),D=D&&D.map((e=>k.calcGridBaseBoxFromBoxAndDrawParams(e,!1,0,0,b,C))),w=k.getConnectionCoordinatesFromBoxSideShift(M,a,s),x=k.getConnectionCoordinatesFromBoxSideShift(P,l,o),I=k.buildPathGrid(M,P,w,x,a,l,D),R=k.convertDecartPointToGridPoint(I,w),T=k.convertDecartPointToGridPoint(I,x),A=k.findPathOnGrid(I,R,T,a,l),e=!1;!A&&!e&&t&&F<t.length;F++)e=t[F](r);return A&&(A=k.prependPathWithArrowStaffSegment(A,S,c,a),A=k.appendPathWithArrowStaffSegment(A,E,d,l),A=k.optimizePath(A)),A}getConnectionCoordinatesFromBoxSideShift(e,t,r){let n;switch(t){case"left":n={x:e.start,y:(e.top+e.bottom)/2+r};break;case"right":n={x:e.end,y:(e.top+e.bottom)/2+r};break;case"top":n={x:(e.start+e.end)/2+r,y:e.top};break;case"bottom":n={x:(e.start+e.end)/2+r,y:e.bottom}}return n}calcGridBaseBoxFromBoxAndDrawParams(e,t,r,n,i,s){let o;switch(t){case"left":o={start:e.start-Math.max(r+n,i),end:e.end+i,top:e.top-s,bottom:e.bottom+s};break;case"right":o={start:e.start-i,end:e.end+Math.max(r+n,i),top:e.top-s,bottom:e.bottom+s};break;case"top":o={start:e.start-i,end:e.end+i,top:e.top-Math.max(r+n,s),bottom:e.bottom+s};break;case"bottom":o={start:e.start-i,end:e.end+i,top:e.top-s,bottom:e.bottom+Math.max(r+n,s)};break;default:o={start:e.start-i,end:e.end+i,top:e.top-s,bottom:e.bottom+s}}return o}buildPathGrid(e,t,r,n,i,s,o){let a,l,c,d,u,h,g,m,p,f,v,y,b,C={},D=[];for(a=[e.start,"left"===i||"right"===i?(e.start+e.end)/2:r.x,e.end,t.start,"left"===s||"right"===s?(t.start+t.end)/2:n.x,t.end],l=[e.top,"top"===i||"bottom"===i?(e.top+e.bottom)/2:r.y,e.bottom,t.top,"top"===s||"bottom"===s?(t.top+t.bottom)/2:n.y,t.bottom],o&&o.forEach((e=>{a.push(e.start,(e.start+e.end)/2,e.end),l.push(e.top,(e.top+e.bottom)/2,e.bottom)})),a=[...new Set(a.sort(((e,t)=>e-t)))],l=[...new Set(l.sort(((e,t)=>e-t)))],h=0,m=l.length;h<m;++h)for(C[h]=C[h]||{},c=l[h],u=0,g=a.length;u<g;++u){if(d=a[u],y=(d<=e.start||d>=e.end||c<=e.top||c>=e.bottom)&&(d<=t.start||d>=t.end||c<=t.top||c>=t.bottom),o)for(p=0,f=o.length;y&&p<f;++p)v=o[p],y=d<=v.start||d>=v.end||c<=v.top||c>=v.bottom||d===r.x&&c===r.y||d===n.x&&c===n.y;b={distance:Math.pow(2,53)-1,permitted:y,x:d,y:c,ix:u,iy:h},C[h][u]=b,D.push(b)}return{width:a.length,height:l.length,xs:a,ys:l,points:C,linearPoints:D}}convertDecartPointToGridPoint(e,t){let r=e.xs.indexOf(t.x),n=e.ys.indexOf(t.y);return e.points[n][r]}findPathOnGrid(e,t,r,n,i){let s=this,o=!1;return t.permitted&&r.permitted&&(e=s.waveForward(e,t,0),o=s.collectPath(e,r,i)),o}getGridPointNeighbors(e,t,r){let n,i=t.ix,s=t.iy,o=[];return s<e.height-1&&(n=e.points[s+1][i],(!r||r(n))&&o.push(n)),s>0&&(n=e.points[s-1][i],(!r||r(n))&&o.push(n)),i<e.width-1&&(n=e.points[s][i+1],(!r||r(n))&&o.push(n)),i>0&&(n=e.points[s][i-1],(!r||r(n))&&o.push(n)),o}waveForward(e,t,r){const n=this;return WalkHelper.preWalkUnordered([t,r],(([t,r])=>n.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance>r+1)).map((e=>[e,r+1]))),(([e,t])=>e.distance=t)),e}collectPath(e,t,r){let n,i,s,o,a=this,l=!0,c=[];for(;l&&t.distance;)if(n=a.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance==t.distance-1)),l=n.length>0,l){switch(n=n.sort(((e,n)=>{let i,s;i=e.ix-t.ix,s=e.iy-t.iy;let o=("left"===r||"right"===r)&&0===s||("top"===r||"bottom"===r)&&0===i?-1:1;i=n.ix-t.ix,s=n.iy-t.iy;let a=("left"===r||"right"===r)&&0===s||("top"===r||"bottom"===r)&&0===i?-1:1;return o>a?1:o<a?-1:o===a?e.y>n.y?-1:1:void 0})),i=n[0],c.push({x1:i.x,y1:i.y,x2:t.x,y2:t.y}),s=i.ix-t.ix,o=i.iy-t.iy,!0){case!o&&s>0:r="left";break;case!o&&s<0:r="right";break;case!s&&o>0:r="top";break;case!s&&o<0:r="bottom"}t=i}return l&&c.reverse()||!1}prependPathWithArrowStaffSegment(e,t,r,n){let i,s;if(e.length>0){switch(s=e[0],i={x2:s.x1,y2:s.y1},n){case"left":i.x1=t.x-r,i.y1=s.y1;break;case"right":i.x1=t.x+r,i.y1=s.y1;break;case"top":i.x1=s.x1,i.y1=t.y-r;break;case"bottom":i.x1=s.x1,i.y1=t.y+r}e.unshift(i)}return e}appendPathWithArrowStaffSegment(e,t,r,n){let i,s;if(e.length>0){switch(s=e[e.length-1],i={x1:s.x2,y1:s.y2},n){case"left":i.x2=t.x-r,i.y2=s.y2;break;case"right":i.x2=t.x+r,i.y2=s.y2;break;case"top":i.x2=s.x2,i.y2=t.y-r;break;case"bottom":i.x2=s.x2,i.y2=t.y+r}e.push(i)}return e}optimizePath(e){let t,r,n=[];if(e.length>0)for(t=e.shift(),n.push(t);e.length>0;)r=e.shift(),t.x1==r.x1&&t.y1==r.y1&&t.x2==r.x2&&t.y2==r.y2?t=r:t.y1-t.y2==0&&r.y1-r.y2==0?t.x2=r.x2:t.x1-t.x2==0&&r.x1-r.x2==0?t.y2=r.y2:(n.push(r),t=r);return n}normalizeSide(e){return RectangularPathFinder.sideToSide[e]||e}static get sideToSide(){return{l:"left",r:"right",t:"top",b:"bottom"}}}RectangularPathFinder._$name="RectangularPathFinder";const fromBoxSide=["left","left","right","right"],toBoxSide=["left","right","left","right"];class Dependencies extends(InstancePlugin.mixin(DependencyCreation,AttachToProjectMixin,Delayable)){static get $name(){return"Dependencies"}static get defaultConfig(){return{pathFinderConfig:null,overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",highlightDependenciesOnEventHover:!1,showTooltip:!0,tooltip:null,bufferSize:50,cacheGridSize:{ticks:25,index:25}}}static get properties(){return{toDrawOnProjectRefresh:new Set,dependenciesToRefresh:new Map,drawnDependencies:[],drawnLines:[]}}static get pluginConfig(){return{chain:["render","renderContents","onElementClick","onElementDblClick","onElementMouseOver","onElementMouseOut","onProjectRefresh"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}construct(e,t={}){const r=this;if(e.isVertical)throw new Error("Dependencies feature is not supported in vertical mode");r.doScheduleDraw=r.createOnFrame("draw",[],r,!0),super.construct(e,t),r.pathFinder=new RectangularPathFinder(r.pathFinderConfig),delete r.pathFinderConfig,r.lineDefAdjusters=r.createLineDefAdjusters(),e.rowManager.on({refresh:"onRefresh",thisObj:r})}doDestroy(){var e;null===(e=this.tooltip)||void 0===e||e.destroy(),super.doDestroy()}doDisable(e){const t=this,{project:r}=t;t.updateCreateListeners(),(r||e)&&(t.attachToResourceStore(e?null:r.resourceStore),t.attachToEventStore(e?null:r.eventStore),t.attachToAssignmentStore(e?null:r.assignmentStore),t.attachToDependencyStore(e?null:r.dependencyStore)),t.client.isPainted&&(t.dependencyStore=t.dependencyStore||r.dependencyStore,t.draw()),super.doDisable(e)}static getLocalizedDependencyType(e){return e?this.L(`L{DependencyType.${e}}`):""}findDependencyIndex(e=[],t,r){return e.findIndex((e=>e.dependency===t&&(e.assignmentData===r||e.assignmentData&&r&&e.assignmentData.from===r.from&&e.assignmentData.to===r.to)))}includesDependency(){return this.findDependencyIndex(...arguments)>=0}attachToResourceStore(e){super.attachToResourceStore(e),e&&!this.disabled&&e.on({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",thisObj:this})}attachToDependencyStore(e){const t=this;super.attachToDependencyStore(e),t.resetGridCache(),t.resetBoundsCache(),e&&!t.disabled&&(e.metaMapId=t.client.id,e.on({name:"dependencyStore",changePreCommit:"onDependencyChange",thisObj:t}))}attachToAssignmentStore(e){super.attachToAssignmentStore(e),e&&!this.disabled&&e.on({name:"assignmentStore",changePreCommit:"onAssignmentChange",refreshPreCommit:"onAssignmentRefresh",thisObj:this})}attachToEventStore(e){super.attachToEventStore(e),e&&!this.disabled&&e.on({name:"eventStore",changePreCommit:"onEventChange",thisObj:this})}createMarkers(){const e=this,t=e.client.svgCanvas,r=e.endMarker=e.initMarkerElement("arrowEnd","8","M0,0 L0,6 L9,3 z");if(BrowserHelper.isEdge||BrowserHelper.isIE11){const r=e.startMarker=e.initMarkerElement("arrowStart","1","M0,3 L9,6 L9,0 z");t.appendChild(r)}else r.setAttribute("orient","auto-start-reverse");t.appendChild(r)}initMarkerElement(e,t,r){return DomHelper.createElement({id:e,tag:"marker",ns:"http://www.w3.org/2000/svg",markerHeight:9,markerWidth:9,refX:t,refY:3,viewBox:"0 0 9 6",orient:"auto",markerUnits:"userSpaceOnUse",children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:r}]})}createLineDefAdjusters(){const e=this.client;return[function(t){let r=!1;return(t.startArrowMargin>e.barMargin||t.endArrowMargin>e.barMargin)&&(t.startArrowMargin=t.endArrowMargin=e.barMargin,r=!0),r?t:r},function(e){let t=!1;return(e.startArrowMargin>0||e.endArrowMargin>0)&&(e.startArrowMargin=e.endArrowMargin=0,t=!0),t?e:t}]}getElementForDependency(e,t=null){return this.getElementsForDependency(e,t)[0]}getElementsForDependency(e,t=null){let r=`[depId="${e.id}"]`;return t&&(r+=`[fromId="${t.from.id}"][toId="${t.to.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(r))}resolveDependencyRecord(e){const t="string"==typeof e?e:e.getAttribute("depId");return t?this.dependencyStore.getById(t):null}onRefresh(){this.client.isEngineReady&&this.onProjectRefresh()}onProjectRefresh(){const e=this;if(!e.client.refreshSuspended)if(e.refreshAllWhenReady)e.resetGridCache(),e.scheduleDraw(!0),e.refreshAllWhenReady=!1;else if(e.toDrawOnProjectRefresh.size){const t=e._dependencyGridCache;t&&e.toDrawOnProjectRefresh.forEach((t=>{e.addToGridCache(t)})),t||e._thisIsAUsedExpression(e.dependencyGridCache),e.toDrawOnProjectRefresh.clear(),e.scheduleDraw()}}onToggleNode(){this.resetGridCache(),this.scheduleDraw(!0)}onViewportResize(){this.scheduleDraw(!0)}onTranslateRow({row:e}){e.lastTop>=0&&e.top!==e.lastTop&&this.scheduleDraw(!0)}onChangeTotalHeight(){this.client.isEngineReady&&this.scheduleDraw(!0)}onHorizontalScroll({subGrid:e}){this.isDrawn&&e===this.client.timeAxisSubGrid&&this.scheduleDraw(!1)}onVerticalScroll(){this.isDrawn&&this.scheduleDraw(!1)}onRowsRefresh(){this.scheduleDraw(!0)}onResourceStoreChange({action:e}){this.client.project.propagatingLoadChanges||"add"!==e&&"remove"!==e&&"removeall"!==e||(this.refreshAllWhenReady=!0)}onResourceStoreRefresh({action:e}){if(!this.client.project.propagatingLoadChanges)switch(e){case"sort":case"filter":case"batch":this.resetGridCache(),this.scheduleDraw(!0)}}async onDependencyChange({action:e,record:t,records:r}){const n=this,{client:i}=n;if(i.isPainted&&!i.suspendRendering&&!this.client.project.propagatingLoadChanges){switch(e){case"dataset":return n.dependencyGridCache={},void(n.toDrawOnProjectRefresh=new Set(r));case"add":return void r.forEach((e=>n.toDrawOnProjectRefresh.add(e)));case"update":if(n.drawnDependencies.some((e=>e.dependency===t)))return n.scheduleRefreshDependency(t);n.addToGridCache(t),n.scheduleDraw();break;case"remove":return r.forEach((e=>{n.releaseDependency(e,!0),n.removeFromCache(e),n.dependenciesToRefresh.delete(e)})),void i.trigger("dependenciesDrawn");case"removeall":case"filter":n.resetGridCache()}n.scheduleDraw(!0)}}onEventChange({action:e,record:t,changes:r}){const n=this;if(!n.client.project.propagatingLoadChanges)switch(e){case"filter":n.scheduleDraw(!0);break;case"update":if(1===Object.keys(r).length&&(r.startDate||r.endDate||r.duration))return;if(t.isEvent){const e=[t];t.resources.forEach((t=>e.push(...t.events))),new Set(e).forEach((e=>n.drawForTimeSpan(e,!0)))}else n.drawForTimeSpan(t,!0);break;case"removeall":n.resetGridCache(),n.scheduleDraw(!0)}}onAssignmentRefresh({action:e}){this.client.project.propagatingLoadChanges||"dataset"===e&&(this.resetGridCache(),this.scheduleDraw(!0))}onAssignmentChange({action:e,record:t,records:r,changes:n}){const i=this;if(!i.client.project.propagatingLoadChanges&&(t&&(r=[t]),"filter"===e&&(i.resetGridCache(),i.scheduleDraw(!0)),"add"===e||"remove"===e||"update"===e)){if("update"===e&&2===Object.keys(n).length&&n.event&&n.resource&&!n.event.isModel&&!n.resource.isModel)return;r.forEach((r=>{const{assignmentStore:n,eventStore:s}=i.client,o=s.getById(r.eventId);o&&o.dependencies.forEach((s=>{if("add"===e)i.toDrawOnProjectRefresh.add(s);else if("remove"===e){let e;e=s.fromEvent===o?s.toEvent.assignments.map((e=>({from:r,to:e}))):s.fromEvent.assignments.map((e=>({from:e,to:r}))),e.forEach((e=>{i.releaseDependency(s,e),i.removeFromCache(s,e)}))}else"update"===e&&i.getDependencyAssignmentsAsFromToArray({dependency:s,assignmentStore:n}).filter((e=>e.from===t||e.to===t)).forEach((e=>{i.scheduleRefreshDependency(s,e)}))}))}))}}getDependencyAssignmentsAsFromToArray({dependency:e,assignmentStore:t}){const{fromEvent:r,toEvent:n}=e,i=[];if(r&&n){const e=this.getEventAssignments(r,t),s=this.getEventAssignments(n,t);e.forEach((e=>{s.forEach((t=>{i.push({from:e,to:t})}))}))}return i}getEventAssignments(e,t){if(e.isRemoved){const r=t.removed.values.filter((t=>t.event===e));for(const n of t.assignmentsForRemoval)n.event===e&&r.push(n);return r}return e.assignments}onElementClick(e){const t=this;if(e.target.matches("."+t.baseCls)){const r=DomDataStore.get(e.target).dependency,n="click"===e.type?"Click":"DblClick";t.client.trigger("dependency"+n,{dependency:r,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this;if(e.target.matches("."+t.baseCls)){const r=DomDataStore.get(e.target).dependency;t.client.trigger("dependencyMouseOver",{dependency:r,event:e}),t.overCls&&t.highlight(r,t.overCls)}}onElementMouseOut(e){const t=this;if(e.target.matches("."+t.baseCls)){const r=DomDataStore.get(e.target).dependency;t.client.trigger("dependencyMouseOut",{dependency:r,event:e}),t.overCls&&!r.isRemoved&&t.unhighlight(r)}}highlight(e,t=this.overCls){this.getElementsForDependency(e).forEach((e=>{e.classList.add(t)})),e.highlight(t)}unhighlight(e,t=this.overCls){this.getElementsForDependency(e).forEach((e=>{e.classList.remove(t)})),e.unhighlight(t)}highlightEventDependencies(e){e.dependencies.forEach((e=>this.highlight(e)))}unhighlightEventDependencies(e){e.dependencies.forEach((e=>this.unhighlight(e)))}isDependencyVisible(e,t=null){const{assignmentStore:r,resourceStore:n,eventStore:i}=this.client,{fromEvent:s,toEvent:o}=e;if(!s||!o)return!1;let a,l;if(t){const{from:e,to:n}=t;if(a=e.resource,l=n.resource,!1===e.drawDependencies||!1===n.drawDependencies||i.isFiltered&&(!i.includes(s)||!i.includes(o))||r.isFiltered&&(!r.includes(e)||!r.includes(n)))return!1}else a=s.resource,l=o.resource;return!(!n.isAvailable(a)||!n.isAvailable(l))&&(s.isModel&&!a.instanceMeta(n).hidden&&!l.instanceMeta(n).hidden)}getBox(e,t,r=null,n=!1){const i=this.getTimeSpanRecordFromDependency(e,t);let s;return s=r?r[t?"from":"to"].resource:i.resource,this.client.getResourceEventBox(i,s,!0,n)}getRowRecordFromDependency(e,t,r){let n;return n=r?r[t?"from":"to"].resource:this.getTimeSpanRecordFromDependency(e,t).resource,n}getTimeSpanRecordFromDependency(e,t=!0){return e[(t?"from":"to")+"Event"]}getMetaId(e=null){return e?`${this.client.id}-ass${e.from.id}-ass${e.to.id}`:this.client.id}getDependencyBounds(e,t,r=!1){const n=this,i=n.client,s=e.getDateRange();if(!i.rowManager.rowCount||!n.isDependencyVisible(e,t))return null;if(!(s&&i.timeAxis.count&&DateHelper.intersectSpans(s.start,s.end,i.startDate,i.endDate)))return null;const o=n.getMetaId(t),a=e.instanceMeta(o),l=n.getBox(e,!0,t,r),c=n.getBox(e,!1,t,r);if(!l||!c)return null;if(n._resetBoundsCache||!a.bounds||!a.bounds.layout){const r=n.getTimeSpanRecordFromDependency(e,!0),s=n.getTimeSpanRecordFromDependency(e,!1),o=Rectangle.union(l,c);i.isGantt||[[r,l,t.from],[s,c,t.to]].map((([e,t,r])=>{if("default"===i.milestoneLayoutMode&&e.isMilestone){if(!i.milestoneWidth){const e=i.getElementFromAssignmentRecord(r);e&&(i.milestoneWidth=e.offsetWidth)}const e=i.milestoneWidth||t.height;t.left-=e/2,t.right+=e/2}})),a.bounds={bounds:o,startRectangle:l,endRectangle:c,layout:l.layout||c.layout}}return e.instanceMeta(o).bounds}get dependencyGridCache(){const e=this;return e._dependencyGridCache||(e._dependencyGridCache={},e.dependencyStore.forEach((t=>e.addToGridCache(t)))),e._dependencyGridCache}getIteratableDependencyAssignments(e){return this.assignmentStore?this.getDependencyAssignmentsAsFromToArray({dependency:e,assignmentStore:this.assignmentStore}):[null]}addToGridCache(e){const t=this,{client:r}=t,{store:n}=r,{dependencyGridCache:i,cacheGridSize:s}=t,o=t.getIteratableDependencyAssignments(e),a=r.startDate.getTime(),l=r.endDate.getTime(),c=DateHelper.asMilliseconds(r.timeAxis.unit)*s.ticks;o.forEach((r=>{const o=t.getMetaId(r),d=e.instanceMeta(o).gridCache=[],u=n.indexOf(t.getRowRecordFromDependency(e,!0,r)),h=n.indexOf(t.getRowRecordFromDependency(e,!1,r)),g=e.getDateRange(),m=null==g?void 0:g.start.getTime(),p=null==g?void 0:g.end.getTime();if(-1!==u&&-1!==h&&g&&p>a&&m<l){const t=Math.min(u,h),n=Math.max(u,h),l=Math.floor(t/s.index),g=Math.floor(n/s.index),f=Math.floor(Math.max(m-a,0)/c),v=Math.floor(Math.max(p-a,0)/c),y=`${e.id}.-.${o}`;let b,C,D,S,E;for(S=f;S<=v;S++)for(b=i[S]||(i[S]={}),E=l;E<=g;E++)C=b[E]||(b[E]=[]),D=C.cached||(C.cached={}),D[y]||(D[y]=!0,C.push({dependency:e,assignmentData:r,metaId:o})),d.push([S,E])}}))}removeFromCache(e,t=null){const r=this,{_dependencyGridCache:n}=r;let i;i=t?[t]:this.getIteratableDependencyAssignments(e),i.forEach((t=>{var i;const s=r.getMetaId(t),o=e.instanceMeta(s),a=`${e.id}.-.${s}`;n&&(null===(i=o.gridCache)||void 0===i||i.forEach((([i,s])=>{var o;if(null===(o=n[i])||void 0===o?void 0:o.hasOwnProperty(s)){const n=r._dependencyGridCache[i][s];if(null==n?void 0:n.cached[a]){const i=r.findDependencyIndex(n,e,t);delete n.cached[a],i>-1&&n.splice(i,1)}}}))),o.bounds=null,o.gridCache=null}))}set dependencyGridCache(e){this._dependencyGridCache=e}resetBoundsCache(){this._resetBoundsCache=!0}resetGridCache(){this.dependencyGridCache=null}generateBoundaryBoxes(e,t){const r=[];return"bottom"===t?r.push({start:e.left,end:e.left+e.width/2,top:e.rowTop,bottom:e.rowBottom},{start:e.left+e.width/2,end:e.right,top:e.rowTop,bottom:e.rowBottom}):r.push({start:e.left-this.pathFinder.startArrowMargin,end:e.right+this.pathFinder.startArrowMargin,top:e.rowTop,bottom:e.rowBottom}),r}getDependencyStartSide(e){const t=this,r=t.getTimeSpanRecordFromDependency(e,!0),n=e.type;let i=e.fromSide;if(!i)switch(!0){case n===DependencyModel.Type.StartToEnd:case n===DependencyModel.Type.StartToStart:i=t.getConnectorStartSide(r);break;case n===DependencyModel.Type.EndToStart:case n===DependencyModel.Type.EndToEnd:i=t.getConnectorEndSide(r);break;default:throw new Error("Invalid dependency type: "+n)}return i}getDependencyEndSide(e){const t=this,r=t.getTimeSpanRecordFromDependency(e,!1),n=e.type;let i=e.toSide;if(!i)switch(!0){case n===DependencyModel.Type.StartToEnd:i=t.getConnectorEndSide(r);break;case n===DependencyModel.Type.StartToStart:case n===DependencyModel.Type.EndToStart:i=t.getConnectorStartSide(r);break;case n===DependencyModel.Type.EndToEnd:i=t.getConnectorEndSide(r);break;default:throw new Error("Invalid dependency type: "+n)}return i}prepareLineDef(e,t,r=null){const n=this,i=n.getDependencyStartSide(e),s=n.getDependencyEndSide(e),{startRectangle:o,endRectangle:a}=t,l=[];null!=o.rowTop&&o.rowTop!==a.rowTop&&l.push(...n.generateBoundaryBoxes(o,i));let{startArrowMargin:c,verticalMargin:d}=n.pathFinder;return e.bidirectional||(/(top|bottom)/.test(i)&&(c=n.client.barMargin/2),d=n.client.barMargin/2),{startBox:{start:o.x,end:o.right,top:o.y,bottom:o.bottom},endBox:{start:a.x,end:a.right,top:a.y,bottom:a.bottom},otherBoxes:l,startArrowMargin:c,verticalMargin:d,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:i,endSide:s}}drawLine(e,t,r,n=null,i=!0){const s=this.client,o=this.getMetaId(n);let a=t.instanceMeta(o).lineElement;if(a&&i||(a=document.createElementNS("http://www.w3.org/2000/svg","polyline"),i&&(t.instanceMeta(o).lineElement=a),a.setAttribute("depId",t.id),n&&(a.setAttribute("fromId",n.from.id),a.setAttribute("toId",n.to.id)),e.appendChild(a)),a.classList.length&&a.classList.remove.apply(a.classList,a.getAttribute("class").split(" ")),a.classList.add(this.baseCls),t.cls&&a.classList.add(t.cls),t.bidirectional&&a.classList.add("b-sch-bidirectional-line"),t.highlighted&&a.classList.add(...t.highlighted.split(" ")),BrowserHelper.isIE11){const e=t.getDateRange(!0),r=s.startDate;e.start<r&&a.classList.add("b-no-start-marker"),e.end<r&&a.classList.add("b-no-end-marker")}return a.setAttribute("points",r?r.map(((e,t)=>t!==r.length-1?`${e.x1},${e.y1}`:`${e.x1},${e.y1} ${e.x2},${e.y2}`)).join(" "):""),DomDataStore.set(a,{dependency:t}),a}refreshDependency(e){const t=this,r=t.getIteratableDependencyAssignments(e);t.releaseDependency(e,null!==r[0]),t.removeFromCache(e),t.addToGridCache(e),r.forEach((r=>t.drawDependency(e,null,r)))}refreshDependencyAssignment(e,t){const r=this;r.releaseDependency(e,t),r.removeFromCache(e,t),r.addToGridCache(e),r.drawDependency(e,null,t)}scheduleRefreshDependency(e,t=null){const r=this,n=r.dependenciesToRefresh;if(!r.drawnDependencies.find((t=>t.dependency===e)))return r.removeFromCache(e),void r.addToGridCache(e);t?n.has(e)?!0!==n.get(e)&&n.get(e).add(t):n.set(e,new Set([t])):n.set(e,!0),1===n.size&&r.requestAnimationFrame((()=>r.refreshDependencyOnFrame()))}getSortedDependenciesToRefresh(){return this.dependenciesToRefresh}refreshDependencyOnFrame(){const e=this,t=e.getSortedDependenciesToRefresh();e.client.isPainted&&(t.forEach(((t,r)=>{if(!0===t){const t=e.getIteratableDependencyAssignments(r);e.releaseDependency(r,null!==t[0]),e.removeFromCache(r)}else t.forEach((t=>{e.releaseDependency(r,t),e.removeFromCache(r,t)}))})),t.forEach(((t,r)=>{e.addToGridCache(r)})),t.forEach(((t,r)=>{!0===t&&(t=e.getIteratableDependencyAssignments(r)),t.forEach((t=>{e.drawDependency(r,null,t)}))})),e.dependenciesToRefresh.clear(),e.client.trigger("dependenciesDrawn",{partial:!0}))}drawDependency(e,t=null,r=null,n=this.client.svgCanvas,i=!0){const s=this,{drawnDependencies:o,oldDrawnDependencies:a}=s,l=t||s.getDependencyBounds(e,r);if(!s.disabled&&l){const t=s.prepareLineDef(e,l),a=s.pathFinder.findPath(t,s.lineDefAdjusters);s.drawLine(n,e,a,r,i),i&&!this.includesDependency(o,e,r)&&o.push({dependency:e,assignmentData:r})}const c=this.findDependencyIndex(a,e,r);c>=0&&a.splice(c,1)}drawForTimeSpan(e,t=!1){const r=this;r.client.isAnimating?r.client.on({transitionend(){!e.isRemoved&&r.drawForTimeSpan(e,!0)},once:!0}):r.dependencyStore.getTimeSpanDependencies(e).forEach((e=>{t?r.scheduleRefreshDependency(e):r.refreshDependency(e)}))}drawForEvent(e){this.drawForTimeSpan(e)}updateDependenciesForTimeSpan(e,t,r=null){const n=this,i=e.isAssignment?e.event:e,s=n.dependencyStore.getTimeSpanDependencies(i),o=n.getMetaId(),a=n.client,l=Rectangle.from(t,a.timeAxisSubGridElement),c=r&&a.getRowFor(r);let d;s.forEach((t=>{this.getIteratableDependencyAssignments(t).forEach((r=>{const s=l.clone();let a,u;c&&(s.rowTop=c.top,s.rowBottom=c.bottom),r&&r.from!==e&&r.to!==e||n.isDependencyVisible(t,r)&&(n.getTimeSpanRecordFromDependency(t,!0)===i?(a=s,u=(d=t.instanceMeta(o).bounds)?d.endRectangle:n.getBox(t,!1,r)):(a=(d=t.instanceMeta(o).bounds)?d.startRectangle:n.getBox(t,!0,r),u=s),a&&u&&n.drawDependency(t,{startRectangle:a,endRectangle:u},r))}))}))}scheduleDraw(e=!1){const t=this;t.disabled||(e&&t.resetBoundsCache(),t.client.isAnimating?t.clientTransitionRemover||(t.clientTransitionRemover=t.client.on({transitionend(){t.clientTransitionRemover(),t.clientTransitionRemover=null,t.draw()},once:!0})):t.doScheduleDraw())}draw(e=!1){const t=this,r=t.client;if(!t.oldDrawnDependencies&&!t.dependencyStore.count||!r.isPainted)return;if(r.isAnimating)return void r.on({transitionend(){t.scheduleDraw(!0)},once:!0});const n=r.timeAxisSubGrid.viewRectangle;if(e&&t.resetBoundsCache(),n.width&&n.height){if(t.oldDrawnDependencies=t.drawnDependencies,t.drawnDependencies=[],n.inflate(t.bufferSize),!t.disabled&&!r.suspendRendering&&r.store.count&&r.rowManager.rowCount){if(!r.project.isInitialCommitPerformed)return t.drawnDependencies=t.oldDrawnDependencies,void(t.refreshAllWhenReady=!0);const e={},{dependencyGridCache:i,cacheGridSize:s}=t,{startDate:o,visibleDateRange:a}=r,l=DateHelper.asMilliseconds(r.timeAxis.unit)*s.ticks,c=a.startDate.getTime()-o.getTime(),d=a.endDate.getTime()-o.getTime(),u=Math.floor(c/l),h=Math.floor(d/l),g=Math.floor(r.rowManager.topRow.dataIndex/s.index),m=Math.floor(r.rowManager.bottomRow.dataIndex/s.index),p=[];let f,v,y;for(f=u;f<=h;f++)for(v=g;v<=m;v++){const s=i[f],o=null==s?void 0:s[v];for(y=0;o&&y<o.length;y++){const{dependency:i,assignmentData:s,metaId:a}=o[y],l=i.id+"-"+a;if(!e[l]){const o=t.getDependencyBounds(i,s);((null==o?void 0:o.bounds.intersect(n,!0,!0))||r.ignoreViewBox)&&p.push([i,o,s]),e[l]=!0}}}p.forEach((([e,r,n])=>{t.drawDependency(e,r,n)}))}t._resetBoundsCache=!1,t.oldDrawnDependencies.forEach((e=>t.releaseDependency(e.dependency,e.assignmentData))),r.trigger("dependenciesDrawn"),t.isDrawn=!0}}releaseDependency(e,t=null){if(!0===t){Object.keys(e.meta.map||{}).filter((e=>e.startsWith(this.client.id))).forEach((t=>{const r=e.meta.map[t];r.lineElement&&(r.lineElement.remove(),r.lineElement=null)}))}else{const r=this.getMetaId(t),n=e.instanceMeta(r).lineElement;n&&(e.instanceMeta(r).lineElement=null,n.remove())}}render(){const e=this,t=e.client;e.showTooltip&&(e.tooltip=e.createTooltip()),t.timeAxis.on({endreconfigure:"resetGridCache",thisObj:e}),t.rowManager.on({refresh:"onRowsRefresh",changetotalheight:"onChangeTotalHeight",thisObj:e}),t.on({horizontalscroll:"onHorizontalScroll",svgcanvascreated:"createMarkers",togglenode:"onToggleNode",scroll:"onVerticalScroll",timelineviewportresize:"onViewportResize",thisObj:e}),e.highlightDependenciesOnEventHover&&(t.on(t.scheduledEventName+"MouseEnter",(t=>e.highlightEventDependencies(t.eventRecord||t.taskRecord))),t.on(t.scheduledEventName+"MouseLeave",(t=>e.unhighlightEventDependencies(t.eventRecord||t.taskRecord))))}renderContents(){this.draw()}getConnectorStartSide(e){return this.client.currentOrientation.getConnectorStartSide(e)}getConnectorEndSide(e){return this.client.currentOrientation.getConnectorEndSide(e)}createTooltip(){const e=this,t=e.client;return new Tooltip(Object.assign({align:"b-t",id:t.id+"-dependency-tip",forSelector:".b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) ."+e.baseCls,clippedBy:[t.timeAxisSubGridElement,t.bodyContainer],forElement:t.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:e.getHoverTipHtml.bind(e)},e.tooltip||{}))}getHoverTipHtml({activeTarget:e}){const t=this,r=t.resolveDependencyRecord(e),{fromEvent:n,toEvent:i}=r;return TemplateHelper.tpl`
             <table class="b-sch-dependency-tooltip">
                <tr>
                    <td>${t.L("L{from}")}: </td>
                    <td>${n.name}</td>
                    <td>
                        <div class="b-sch-box b-${fromBoxSide[r.type]}"></div>
                    </td>
                </tr>
                <tr>
                    <td>${t.L("L{to}")}: </td>
                    <td>${i.name}</td>
                    <td><div class="b-sch-box b-${toBoxSide[r.type]}"></div></td>
                </tr>
            </table>
        `}}Dependencies._$name="Dependencies",GridFeatureManager.registerFeature(Dependencies,!1,"Scheduler"),GridFeatureManager.registerFeature(Dependencies,!0,"SchedulerPro"),document.createElementNS&&!("classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))&&function(e){if("Element"in e){var t="classList",r=e.Element.prototype,n=Object,i=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array.prototype.indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1},o=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(""===t)throw new o("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(t))throw new o("INVALID_CHARACTER_ERR","The token must not contain space characters.");return s.call(e,t)},l=function(e){for(var t=i.call(e.getAttribute("class")||""),r=t?t.split(/\s+/):[],n=0,s=r.length;n<s;n++)this.push(r[n]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},c=l.prototype=[],d=function(){return new l(this)};if(o.prototype=Error.prototype,c.item=function(e){return this[e]||null},c.contains=function(e){return~a(this,e+"")},c.add=function(){var e,t=arguments,r=0,n=t.length,i=!1;do{e=t[r]+"",~a(this,e)||(this.push(e),i=!0)}while(++r<n);i&&this._updateClassName()},c.remove=function(){var e,t,r=arguments,n=0,i=r.length,s=!1;do{for(e=r[n]+"",t=a(this,e);~t;)this.splice(t,1),s=!0,t=a(this,e)}while(++n<i);s&&this._updateClassName()},c.toggle=function(e,t){var r=this.contains(e),n=r?!0!==t&&"remove":!1!==t&&"add";return n&&this[n](e),!0===t||!1===t?t:!r},c.replace=function(e,t){var r=a(e+"");~r&&(this.splice(r,1,t),this._updateClassName())},c.toString=function(){return this.join(" ")},n.defineProperty){var u={get:d,enumerable:!0,configurable:!0};try{n.defineProperty(r,t,u)}catch(e){void 0!==e.number&&-2146823252!==e.number||(u.enumerable=!1,n.defineProperty(r,t,u))}}else n.prototype.__defineGetter__&&r.__defineGetter__(t,d)}}(window),function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){for(var r=0,n=arguments.length;r<n;r++)e=arguments[r],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var r=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:r.call(this,e)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(e,t){var r=this.toString().split(" "),n=r.indexOf(e+"");~n&&(r=r.slice(n),this.remove.apply(this,r),this.add(t),this.add.apply(this,r.slice(1)))}),e=null}();class DependencyEditor extends Popup{static get $name(){return"DependencyEditor"}static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const t=this.dependencyEditFeature;return!("lagField"===e.ref&&!t.showLagField)&&(!("deleteButton"===e.ref&&!t.showDeleteButton)&&(Object.assign(e,{}),super.processWidgetConfig(e)))}afterShow(...e){const t=this.widgetMap.deleteButton;t&&(t.hidden=!this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}}DependencyEditor._$name="DependencyEditor";class DependencyEdit extends InstancePlugin{static get $name(){return"DependencyEdit"}static get defaultConfig(){return{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,defaults:{localeClass:this},items:{fromNameField:{type:"display",label:"L{From}",editable:!1},toNameField:{type:"display",label:"L{To}"},typeField:{type:"combo",label:"L{Type}",name:"type",editable:!1,valueField:"id",displayField:"name",items:Object.keys(DependencyModel.Type).map((e=>({id:DependencyModel.Type[e],name:this.L(e)})))},lagField:{type:"duration",label:"L{Lag}",name:"lag",allowNegative:!0}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler"},saveButton:{color:"b-green",text:"L{Save}"},deleteButton:{color:"b-gray",text:"L{Delete}"},cancelButton:{color:"b-gray",text:"L{Object.Cancel}"}}}}}}construct(e,t){const r=this;if(e.dependencyEdit=r,r.dependencyStore=e.dependencyStore,super.construct(e,t),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit");r.clientListenersDetacher=e.on({[r.triggerEvent]:r.onActivateEditor,thisObj:r})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}get editorConfig(){return this._editorConfig}set editorConfig(e){const t=this.getDefaultConfiguration().editorConfig;(e=ObjectHelper.assign({},t,e)).items=e.items||[],this._editorConfig=e}get isValid(){return Object.values(this.editor.widgetMap).every((e=>!(e.name&&!e.hidden)||!1!==e.isValid))}get values(){const e={};return this.editor.eachWidget((t=>{t.name&&!t.hidden&&(e[t.name]=t.value)}),!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;t.lag&&(t.lagUnit=t.lag.unit,t.lag=t.lag.magnitude),"type"in t&&(null!=e.fromSide&&(t.fromSide=null),null!=e.toSide&&(t.toSide=null)),ObjectHelper.cleanupProperties(t,!0),e.set(t)}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),this.onSaveClick())}onSaveClick(){this.save()&&this.editor.hide()}onDeleteClick(){this.deleteDependency(),this.editor.hide()}onCancelClick(){this.editor.hide()}internalShowEditor(e){const t=this,r=t.client;let n=t.lastPointerDownCoordinate;if(!1===r.trigger("beforeDependencyEdit",{dependencyEdit:t,dependencyRecord:e}))return;const i=t.getEditor(e);if(t.loadRecord(e),r.trigger("beforeDependencyEditShow",{dependencyEdit:t,dependencyRecord:e,editor:i}),!n){const e=Rectangle.from(t.client.element).center;n=[e.x-i.width/2,e.y-i.height/2]}i.showByPoint(n)}editDependency(e){this.client.readOnly||this.internalShowEditor(e)}getEditor(){var e,t,r;const n=this;let{editor:i}=n;return i||(i=n.editor=new DependencyEditor(ObjectHelper.assign({dependencyEditFeature:n,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[n.client.timeAxisSubGridElement,n.client.bodyContainer],constrainTo:window,autoClose:n.autoClose,cls:n.cls,listeners:{keydown:n.onPopupKeyDown,thisObj:n}},n.editorConfig)),0===i.items.length&&console.warn("Editor configured without any `items`"),i.eachWidget((e=>{const t=e.ref||e.id;t&&!n[t]&&(n[t]=e)})),null===(e=n.saveButton)||void 0===e||e.on("click",n.onSaveClick,n),null===(t=n.deleteButton)||void 0===t||t.on("click",n.onDeleteClick,n),null===(r=n.cancelButton)||void 0===r||r.on("click",n.onCancelClick,n),n.editor)}loadRecord(e){const t=this;t.fromNameField.value=e.fromEvent.name,t.toNameField.value=e.toEvent.name,t.lagField&&(t.lagField.unit=e.lagUnit),t.editor.record=t.dependencyRecord=e}async save(){const e=this,{client:t,dependencyRecord:r}=e;if(!r||!e.isValid)return;const{dependencyStore:n,values:i}=e;if(!1!==t.trigger("beforeDependencySave",{dependencyRecord:r,values:i})){var s;if(e.onBeforeSave(r),e.updateRecord(r),n&&!r.stores.length){if(!1===t.trigger("beforeDependencyAdd",{dependencyRecord:r,dependencyEdit:e}))return;n.add(r)}await(null===(s=t.project)||void 0===s?void 0:s.commitAsync()),t.trigger("afterDependencySave",{dependencyRecord:r}),e.onAfterSave(r)}return r}async deleteDependency(){const{client:e,editor:t,dependencyRecord:r}=this;var n;return!1!==e.trigger("beforeDependencyDelete",{dependencyRecord:r})&&(t.containsFocus&&t.revertFocus(),e.dependencyStore.remove(r),await(null===(n=e.project)||void 0===n?void 0:n.commitAsync()),!0)}onActivateEditor({dependency:e,event:t}){this.disabled||(this.lastPointerDownCoordinate=[t.clientX,t.clientY],this.editDependency(e))}}DependencyEdit._$name="DependencyEdit",GridFeatureManager.registerFeature(DependencyEdit,!1);const sides=["top","left","right","bottom"],editorAlign={top:"b-b",right:"l-l",bottom:"t-t",left:"r-r"},topBottom={top:1,bottom:1};class Labels extends InstancePlugin{static get $name(){return"Labels"}static get defaultConfig(){return{labelCls:"b-sch-label",top:null,right:null,bottom:null,left:null,thisObj:null,blurAction:"cancel"}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(e,t){const r=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");r.scheduler=e,super.construct(e,t),(r.top||r.bottom||r.left||r.right)&&r.updateHostClasslist()}updateHostClasslist(){const{top:e,bottom:t}=this,{classList:r}=this.scheduler.element;r.remove("b-labels-topbottom"),r.remove("b-labels-top"),r.remove("b-labels-bottom"),(e||t)&&(r.add("b-labels-topbottom"),e&&r.add("b-labels-top"),t&&r.add("b-labels-bottom"))}onLabelDblClick(e){const t=this,r=e.target;if(r&&!t.scheduler.readOnly){const{side:n}=r.dataset,i=t[n],{editor:s,field:o}=i;if(s){const a=this.scheduler.resolveEventRecord(e.target);return s instanceof Editor||(i.editor=new Editor({appendTo:t.scheduler.element,blurAction:t.blurAction,inputField:s,scrollAction:"realign"})),i.editor.startEdit({target:r,align:editorAlign[n],matchSize:!1,record:a,field:o}),e.stopImmediatePropagation(),!1}}}set top(e){this._top=this.processLabelSpec(e,"top"),this.updateHostClasslist()}get top(){return this._top}set right(e){this._right=this.processLabelSpec(e,"right"),this.updateHostClasslist()}get right(){return this._right}set bottom(e){this._bottom=this.processLabelSpec(e,"bottom"),this.updateHostClasslist()}get bottom(){return this._bottom}set left(e){this._left=this.processLabelSpec(e,"left"),this.updateHostClasslist()}get left(){return this._left}processLabelSpec(e,t){if("function"==typeof e)e={renderer:e};else if("string"==typeof e)e={field:e};else{if(!e)return;e=Object.setPrototypeOf({},e)}const{scheduler:r}=this,{eventStore:n,resourceStore:i,taskStore:s,id:o}=r,{field:a,editor:l}=e;if(topBottom[t]&&(r.milestoneWidth=null),e.recordType=n&&!s?"event":"task",a){let t;n&&!s&&(t=n.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="event"):Reflect.has(n.modelClass.prototype,a)&&(e.recordType="event")),!t&&s&&(t=s.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="task"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="task")),!t&&i&&(t=i.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="resource"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="resource")),l&&("boolean"==typeof l?r.editor={type:"textfield"}:"string"==typeof l&&(r.editor={type:l}),EventHelper.on({element:r.timeAxisSubGrid.element,delegate:".b-sch-label",dblclick:"onLabelDblClick",thisObj:this}))}return e}doDisable(e){super.doDisable(e),this.client.isPainted&&this.client.refresh()}onEventDataGenerated(e){const t=this;if(!t.disabled)for(const r of sides)if(t[r]){const{field:n,fieldDef:i,recordType:s,renderer:o,thisObj:a}=t[r],l={tag:"label",className:{[t.labelCls]:1,[`${t.labelCls}-${r}`]:1},dataset:{side:r,taskFeature:"label-"+r}};let c;const d=s+"Record",u=e[d];o?c=o.call(a||t.thisObj||t,{[d]:u,resourceRecord:e.resourceRecord,assignmentRecord:e.assignmentRecord,domConfig:l}):(c=u[n],i&&"date"===i.type&&!o&&(c=DateHelper.format(c,t.client.displayDateFormat))),l.html=c||" ",e.wrapperChildren.push(l)}}}Labels.featureClass="b-sch-labels",Labels._$name="Labels",GridFeatureManager.registerFeature(Labels,!1,"Scheduler");class ScheduleTooltip extends InstancePlugin{static get $name(){return"ScheduleTooltip"}static get defaultConfig(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`}}static get pluginConfig(){return{chain:["render"]}}render(){const e=this,t=e.client;let r;e.hoverTip&&e.hoverTip.destroy();const n=e.hoverTip=new Tooltip({id:t.id+"-schedule-tip",cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:t.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-animating):not(.b-dragging-event):not(.b-dragcreating) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",constrainTo:null,getHtml:e.getHoverTipHtml.bind(e),onDocumentMouseDown(e){n.forElement.contains(e.event.target)&&(r=EventHelper.on({element:t.timeAxisSubGridElement,mousemove:e=>n.internalOnPointerOver(e),capture:!0}));const i=n.hideAnimation;n.hideAnimation=!1,n.constructor.prototype.onDocumentMouseDown.call(n,e),n.hideAnimation=i},listeners:{pointerover:({event:t})=>{const n="buttons"in t?t.buttons>0:t.which>0;return!n&&r&&r(),!e.disabled&&!n}}});e.clockTemplate=new ClockTemplate({scheduler:t})}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:t}){const r=this,n=r.client,i=t&&n.getDateFromDomEvent(t,"floor",!0);let s=r.lastHtml;if(i){const e=n.resolveResourceRecord(t);!e||i-r.lastTime==0&&e===r.lastResource||(r.lastResource=e,s=r.lastHtml=r.generateTipContent({date:i,event:t,resourceRecord:e}))}else e.hide(),r.lastTime=null,r.lastResource=null;return s}generateTipContent({date:e,event:t,resourceRecord:r}){const n=this,i=n.clockTemplate.generateContent({date:e,text:n.client.getFormattedDate(e)}),s=n.messageTemplate({message:n.getText(e,t,r)||""});return n.lastTime=e,i+s}getText(e,t,r){}}ScheduleTooltip.featureClass="b-scheduletip",ScheduleTooltip._$name="ScheduleTooltip",GridFeatureManager.registerFeature(ScheduleTooltip,!0,"Scheduler");class SimpleEventEdit extends InstancePlugin{static get $name(){return"SimpleEventEdit"}static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEventEnterKey"],assign:["editEvent"]}}construct(e,t){const r=this;r.scheduler=e,e.eventEdit=r,super.construct(e,t),r.clientListenersDetacher=e.on({[r.triggerEvent]:({eventRecord:e,eventElement:t})=>r.editEvent(e,e.resource,t),dragcreateend:r.onDragCreateEnd,thisObj:r})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}get eventStore(){return this.scheduler.eventStore}editEvent(e,t,r){const n=this,i=n.scheduler;i.readOnly||n.disabled||(r=DomHelper.down(r,i.eventInnerSelector)||r,e=e instanceof AssignmentModel?e.event:e,n.resource=t,n.event=e,n.element=r,i.element.classList.add("b-eventeditor-editing"),n.editor||(n.editor=new Editor(Object.assign({owner:n.scheduler.timeAxisSubGrid,appendTo:n.scheduler.timeAxisSubGridElement,scrollAction:"realign",cls:"b-simpleeventeditor",listeners:{complete:n.onEditorComplete,cancel:n.onEditorCancel,thisObj:n}},n.editorConfig)),n.relayEvents(n.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),n.editor.startEdit({target:r,record:e,field:n.field}),n.scheduler.navigator.disabled=!0)}onEditorComplete(){var e;const t=this;0===t.event.stores.length&&(t.eventStore.add(t.editor.record),t.event.assign(t.resource)),(null===(e=t.element)||void 0===e?void 0:e.classList.contains("b-sch-dragcreator-proxy"))&&t.element.remove(),t.reset()}onEditorCancel(){0===this.event.stores.length&&this.element.remove(),this.reset()}reset(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1}onEventEnterKey({assignmentRecord:e,eventRecord:t}){const r=e?this.scheduler.getElementFromAssignmentRecord(e):this.scheduler.getElementFromEventRecord(t),n=(e||t).resource;this.editEvent(t,n,r)}onDragCreateEnd({newEventRecord:e,resourceRecord:t,proxyElement:r}){const n=this;n.scheduler.onEventCreated(e);const i=r.cloneNode(!0);i.removeAttribute("id"),r.parentElement.appendChild(i),n.element=i,n.editEvent(e,t,i)}}SimpleEventEdit._$name="SimpleEventEdit",GridFeatureManager.registerFeature(SimpleEventEdit,!1,"Scheduler");class Summary$1 extends Summary{static get $name(){return"Summary"}static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}construct(e,t){const r=this;if(e.isVertical)throw new Error("Summary feature is not supported in vertical mode");r.scheduler=e,super.construct(e,t),r.summaries||(r.summaries=[{renderer:r.renderer}]),e instanceof SchedulerBase&&(e.eventStore.on({filter:"updateScheduleSummaries",thisObj:r}),e.resourceStore.on({filter:"updateScheduleSummaries",thisObj:r}),e.project.on({refresh:"updateScheduleSummaries",thisObj:r}),e.timeAxisViewModel.on({update:r.renderRows,thisObj:r}))}renderRows(){super.renderRows(),this.render()}updateScheduleSummaries(){const e=this,t=e.scheduler,r=t.bodyElement.querySelector(".b-grid-footer.b-sch-timeaxiscolumn");r&&t.isEngineReady&&Array.from(r.children).forEach(((r,n)=>{const i=t.timeAxis.getAt(n),s=t.eventStore.getEvents({startDate:i.startDate,endDate:i.endDate,allowPartial:!0,onlyAssigned:!0});let o="",a=`<header>${e.L("L{Summary for}",t.getFormattedDate(i.startDate))}</header>`;e.summaries.forEach((n=>{const l=n.renderer({startDate:i.startDate,endDate:i.endDate,eventStore:t.eventStore,resourceStore:t.resourceStore,events:s,element:r}),c=`<div class="b-timeaxis-summary-value">${l}</div>`;(e.summaries.length>1||""!==l)&&(o+=c),a+=`<label>${n.label||""}</label>`+c})),r.innerHTML=o,r._tipHtml=a}))}render(){const e=this,t=e.scheduler,r=t.element.querySelector(".b-grid-footer.b-sch-timeaxiscolumn");r&&(e.summaries.some((e=>e.label))&&e.showTooltip&&!e._tip&&(e._tip=new Tooltip({id:t.id+"-summary-tip",cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:r,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:e})=>e._tipHtml})),r.innerHTML=`<div class="b-timeaxis-tick" style="width: ${t.tickSize}px"></div>`.repeat(t.timeAxis.count),e.updateScheduleSummaries())}}Summary$1._$name="Summary",GridFeatureManager.registerFeature(Summary$1,!1,"Scheduler");class TimeAxisHeaderMenu extends HeaderMenu{static get $name(){return"TimeAxisHeaderMenu"}static get defaultConfig(){return{type:"timeAxisHeader"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTimeAxisHeaderMenu"),e}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(e){const{column:t}=e;return t&&!1!==t.enableHeaderContextMenu&&t===this.client.timeAxisColumn}showContextMenu(e){super.showContextMenu(...arguments),this.menu&&(this.menu.scrollAction="realign")}populateTimeAxisHeaderMenu({items:e}){const t=this,{client:r}=t,n={magnitude:r.timeAxis.shiftIncrement,unit:r.timeAxis.shiftUnit};Object.assign(e,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:t,icon:"b-fw-icon b-icon-search-plus",disabled:!r.presets.count||t.disabled,weight:200,menu:{type:"popup",items:{zoomSlider:{weight:210,type:"slider",showValue:!1,listeners:{input:t.onZoomSliderChange,thisObj:t},minWidth:130}},onBeforeShow({source:e}){const[t]=e.items;t.min=r.minZoomLevel,t.max=r.maxZoomLevel,t.value=r.zoomLevel}}},dateRange:{text:"L{activeDateRange}",localeClass:t,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",width:"20em",defaults:{localeClass:t},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:n,listeners:{change:t.onRangeDateFieldChange,thisObj:t}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:n,listeners:{change:t.onRangeDateFieldChange,thisObj:t}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-prev",color:"b-blue b-raised",flex:1,margin:0,listeners:{click:t.onLeftShiftBtnClick,thisObj:t}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,margin:"0 8",listeners:{click:t.onTodayBtnClick,thisObj:t}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,listeners:{click:t.onRightShiftBtnClick,thisObj:t}}},listeners:{paint:t.initDateRangeFields,thisObj:t}}}})}onZoomSliderChange({value:e}){const t=this;t.menu.scrollAction="realign",t.client.zoomLevel=e,t.menu.setTimeout({fn:()=>t.menu.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDateRangeFields({source:e,firstPaint:t}){if(t){const{widgetMap:t}=e;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const t=this,r=e===t.startDateField,{client:n}=t,{timeAxis:i}=n,s=t.startDateFieldInitialValue&&!r?t.startDateFieldInitialValue:t.startDateField.value;let o=t.endDateFieldInitialValue&&r?t.endDateFieldInitialValue:t.endDateField.value;r?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,o-s?o<s&&(o=DateHelper.add(s,i.shiftIncrement,i.shiftUnit)):o=DateHelper.add(o,i.shiftIncrement,i.shiftUnit),n.preserveViewCenter((()=>n.timeAxis.setTimeSpan(s,o))),t.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=DateHelper.clearTime(new Date);this.client.timeAxis.setTimeSpan(e,DateHelper.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}}TimeAxisHeaderMenu._$name="TimeAxisHeaderMenu",GridFeatureManager.registerFeature(TimeAxisHeaderMenu,!0,["Scheduler","Gantt"]);class TimeRanges extends AbstractTimeRanges{static get $name(){return"TimeRanges"}static get defaultConfig(){return{store:{modelClass:TimeSpan,storeId:"timeRanges"},updateCurrentTimeLineInterval:1e4,currentDateFormat:"HH:mm",timeRanges:null,showCurrentTimeLine:!1}}construct(e,t){const r=this;super.construct(e,t),e._timeRangesExposed||(Object.defineProperty(e,"timeRanges",{get:()=>r.timeRanges,set:e=>r.store.data=e}),e._timeRangesExposed=!0),r.getConfig("timeRanges")}startConfigure(e){const{client:t}=this;if(t.project&&!this.initialConfig.store){const r=t.project.timeRangeStore;if(r){const t=ObjectHelper.getPath(e,"store.data");t&&(r.data=t),e.store=r}}}set timeRanges(e){const t=this.getConfig("store");t?t.data=e:this._timeRanges=e}get timeRanges(){const{store:e}=this,{records:t}=e;if(e.recurringEvents){const e=[],{startDate:r,endDate:n}=this.client.timeAxis;return t.forEach((t=>{t.isRecurring?e.push.apply(e,t.getOccurrencesForDateRange(r,n)):e.push(t)})),e}return t}initCurrentTimeLine(){const e=this,t=new Date;!e.currentTimeLine&&e.showCurrentTimeLine&&(e.currentTimeLine=new e.store.modelClass({id:"currentTime",cls:"b-sch-current-time",startDate:t,name:DateHelper.format(t,e.currentDateFormat)}),e.updateCurrentTimeLine=e.updateCurrentTimeLine.bind(e),e.currentTimeInterval=e.setInterval(e.updateCurrentTimeLine,e.updateCurrentTimeLineInterval),e.client.isPainted&&e.renderRanges())}updateCurrentTimeLine(){const e=this;e.currentTimeLine.startDate=new Date,e.currentTimeLine.name=DateHelper.format(e.currentTimeLine.startDate,e.currentDateFormat),e.onStoreChanged({action:"update",record:e.currentTimeLine,changes:{}})}hideCurrentTimeLine(){const e=this;e.currentTimeLine&&(e.clearInterval(e.currentTimeInterval),e.currentTimeLine=null,e.client.isPainted&&e.renderRanges())}renderRanges(){const e=this;super.renderRanges(),e.showCurrentTimeLine&&!e.disabled&&e.renderRange(e.currentTimeLine,!0)}get showCurrentTimeLine(){return this._showCurrentTimeLine}set showCurrentTimeLine(e){this._showCurrentTimeLine=e,e?this.initCurrentTimeLine():this.hideCurrentTimeLine()}populateHeaderMenu({column:e,items:t}){"timeAxis"===e.type&&this.populateTimeAxisHeaderMenu(...arguments)}populateTimeAxisHeaderMenu({column:e,items:t}){const r=this;t.currentTimeLine={weight:400,text:r.L("L{showCurrentTimeLine}"),checked:r.showCurrentTimeLine,onToggle:({checked:e})=>{r.showCurrentTimeLine=e}}}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.client.isPainted&&this.renderRanges()}get store(){return this._store}set store(e){const t=this,r=t.client;e.storeId||(e.storeId="timeRanges"),super.store=e,r.timeRanges&&!r._timeRangesExposed&&(t._store.add(r.timeRanges),delete r.timeRanges),t.timeRanges&&(t._store.add(t.timeRanges),delete t.timeRanges)}}function applyNamedItems(e,t){for(const r in e){let n=e[r];if(n){r in t&&(n=e[r]="object"==typeof n?ObjectHelper.merge(ObjectHelper.clone(t[r]),n):t[r]);const i=n.menu;i&&applyNamedItems("items"in i?i.items:i,t)}}}TimeRanges._$name="TimeRanges",GridFeatureManager.registerFeature(TimeRanges,!1,["Scheduler","Gantt"]);class TimeSpanRecordContextMenuBase extends InstancePlugin{static get defaultConfig(){return{defaultItems:null,items:null,processItems:null,triggerEvent:null}}static get pluginConfig(){return{assign:["showEventContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick","onEventSpaceKey"]}}construct(e,t){super.construct(e,t),VersionHelper.deprecate("Scheduler","5.0.0","`TimeSpanRecordContextMenuBase` feature is deprecated, in favor of `TimeSpanMenuBase` feature. Please see https://bryntum.com/docs/scheduler/#guides/upgrades/3.1.0.md for more information.")}doDestroy(){this.menu&&this.menu.destroy()}onElementContextMenu(e){"contextmenu"===this.triggerEvent&&this.showEventContextMenu(e)}onElementClick(e){"click"===this.triggerEvent&&this.showEventContextMenu(e)}onElementDblClick(e){"dblclick"===this.triggerEvent&&this.showEventContextMenu(e)}onEventSpaceKey(e){const t=Rectangle.from(e.target).center,r=new MouseEvent("contextmenu",Object.assign({clientX:t.x,clientY:t.y},e));Object.defineProperty(r,"target",{get:()=>e.target}),this.showEventContextMenu(r)}showEventContextMenu(e){const t=this,r=t.client,n=e.target,i=DomHelper.up(n,r.eventSelector),s=i||n;if(s){const r=t.resolveRecord(s);r&&(e.preventDefault(),t.showContextMenuFor(r,{targetElement:s,eventElement:i,event:e}))}}resolveRecord(){}showContextMenuFor(e,t){}beforeContextMenuShow(){}showContextMenu(e){if(this.disabled)return;const t=this,r=e.event,n=e.menuType.toLowerCase(),i=StringHelper.uncapitalize(n),s=`get${StringHelper.capitalize(n)}MenuItems`,{client:o,processItems:a,defaultItems:l,namedItems:c}=t,d=r?[r.clientX+1,r.clientY+1]:Rectangle.from(e.targetElement).center,u=e.items=ObjectHelper.isEmpty(t.items)?ObjectHelper.clone(l):ObjectHelper.merge(ObjectHelper.clone(l),t.items);e.namedItems=c,e.selection=o.selectedRecords,applyNamedItems(u,c),o[s]&&o[s](e,u),a&&!1===a(e)||ObjectHelper.isEmpty(e.items)||!1!==t.beforeContextMenuShow(e)&&!1!==o.trigger(i+"ContextMenuBeforeShow",e)&&(t.menu=WidgetHelper.showContextMenu(d,{owner:o,scrollAction:"hide",clippedBy:[o.timeAxisSubGridElement,o.bodyContainer],constrainTo:window,items:u,onDestroy(){t.menu=null},onBeforeItem:t=>{Object.assign(t,e)},onItem:e=>o.trigger(i+"ContextMenuItem",e),listeners:{show({source:t}){e.menu=t,o.trigger(i+"ContextMenuShow",e)}}}))}hideContextMenu(e){this.menu&&this.menu.hide(e)}set defaultItems(e){this._defaultItems=e}get defaultItems(){const e=ObjectHelper.clone(this._defaultItems);if(this.client.readOnly)for(const t in e)e[t]=!1;return e}get triggerEvent(){return this._triggerEvent||this.client.contextMenuTriggerEvent}set triggerEvent(e){this._triggerEvent=e}}TimeSpanRecordContextMenuBase._$name="TimeSpanRecordContextMenuBase";const ScheduleRange={completeview:"completeview",currentview:"currentview",daterange:"daterange"};class ScheduleRangeCombo extends LocalizableCombo{static get $name(){return"ScheduleRangeCombo"}static get type(){return"schedulerangecombo"}static get defaultConfig(){return{editable:!1}}buildLocalizedItems(){return Object.entries(ScheduleRange).map((([e,t])=>({id:e,text:this.L(t)})))}}ScheduleRangeCombo.initClass(),ScheduleRangeCombo._$name="ScheduleRangeCombo";class SchedulerExportDialog extends ExportDialog{static get $name(){return"SchedulerExportDialog"}static get defaultConfig(){return{scheduleRange:"completeview"}}onLocaleChange(){const e=this.L("labelWidth");this.width=this.L("L{width}"),this.items.forEach((t=>{t instanceof Field?t.labelWidth=e:"rangeFieldsContainer"===t.ref&&(t.items[0].width=e)}))}get fieldProperties(){return["scheduleRange",...super.fieldProperties]}buildDialogItems(e){const t=this,{client:r}=e,{scheduleRange:n}=t.getDefaultFieldValues(e),i=super.buildDialogItems(e),s=t.L("labelWidth");t.columnsStore=r.columns.chain((e=>e.isLeaf&&e.exportable));const o=i.find((e=>"columnsField"===e.ref));return o.store=t.columnsStore,o.value=t.columnsStore.allRecords,i.splice(1,0,{labelWidth:s,type:"schedulerangecombo",ref:"scheduleRangeField",label:"L{Schedule range}",localeClass:t,value:n,onChange({value:e}){const t=e!==ScheduleRange.daterange,r=this.owner.widgetMap;r.rangeStartField.hidden=r.rangeEndField.hidden=t}},{type:"container",ref:"rangeFieldsContainer",flex:"1 0 100%",defaults:{localeClass:t},items:[{type:"widget",width:s},{type:"datefield",ref:"rangeStartField",label:"L{Export from}",labelWidth:"3em",hidden:!0,flex:"1 0 25%",localeClass:t,value:r.startDate,max:DateHelper.max(r.startDate,DateHelper.add(r.endDate,-1,"d")),onChange({value:e}){this.owner.widgetMap.rangeEndField.min=DateHelper.add(e,1,"d")}},{type:"widget",width:"0.5em"},{type:"datefield",ref:"rangeEndField",label:"L{Export to}",labelWidth:"1em",hidden:!0,flex:"1 0 25%",localeClass:t,value:r.endDate,min:DateHelper.min(r.endDate,DateHelper.add(r.startDate,1,"d")),onChange({value:e}){this.owner.widgetMap.rangeStartField.max=DateHelper.add(e,-1,"d")}}]}),i}}SchedulerExportDialog._$name="SchedulerExportDialog";const immediatePromise$6=Promise.resolve();var SchedulerExporterMixin=e=>class extends e{async scrollRowIntoView(e,t){const{rowManager:r,scrollable:n}=e,i=n.y;return t<e.store.count&&(n.scrollTo(null,r.calculateTop(t)),n.y!==i)?new Promise((n=>{const i=e.on({scroll({scrollTop:e}){null!=e&&r.getRow(t)&&(i(),n())}})})):immediatePromise$6}async scrollToDate(e,t){let r=!1;const n=[],i=e.timeAxisSubGrid.scrollable.on({scrollstart({x:e}){null!=e&&(r=!0)}});n.push(e.scrollToDate(t,{block:"start"})),i(),r&&(n.push(e.timeView.await("refresh",{checkLog:!1})),n.push(e.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1}))),await Promise.all(n)}async prepareComponent(e){const t=this,{client:r}=e,n=r.timeAxisSubGrid.width>0;switch(e.scheduleRange){case ScheduleRange.completeview:e.rangeStart=r.startDate,e.rangeEnd=r.endDate;break;case ScheduleRange.currentview:const{startDate:t,endDate:n}=r.visibleDateRange;e.rangeStart=t,e.rangeEnd=n}await r.waitForTransition(),n&&(r.setTimeSpan(e.rangeStart,e.rangeEnd),r.svgCanvas),t._oldEnableEventAnimations=r.enableEventAnimations,r.enableEventAnimations=!1,r.currentOrientation.isHorizontalRendering&&(t._oldScrollBuffer=r.currentOrientation.scrollBuffer,r.currentOrientation.scrollBuffer=100),await super.prepareComponent(e);const{exportMeta:i}=t,s=t.element.querySelector(".b-sch-foreground-canvas"),o=t.element.querySelector(".b-horizontaltimeaxis");if(i.includeTimeline=n,n&&e.scheduleRange!==ScheduleRange.completeview){i.totalWidth-=i.subGrids.normal.width,i.totalWidth+=i.subGrids.normal.width=r.timeAxisViewModel.getDistanceBetweenDates(e.rangeStart,e.rangeEnd);const t=Math.ceil(i.totalWidth/i.pageWidth),n=t*i.verticalPages;i.horizontalPages=t,i.totalPages=n,i.subGrids.normal.scrollLeft=r.getCoordinateFromDate(e.rangeStart)}if(i.timeAxisHeaders=[],i.timeAxisPlaceholders=[],i.headersColleted=!1,DomHelper.forEachSelector(o,".b-sch-header-row",(e=>{i.timeAxisPlaceholders.push(t.createPlaceholder(e)),i.timeAxisHeaders.push(new Map)})),i.subGrids.normal.eventsPlaceholder=t.createPlaceholder(s,!1),DomHelper.removeEachSelector(s,".b-sch-event-wrap"),DomHelper.removeEachSelector(t.element,".b-released"),i.eventsBoxes=new Map,i.client=r,r.features.columnLines&&!r.features.columnLines.disabled){const e=t.element.querySelector(".b-column-lines-canvas");i.columnLinesPlaceholder=t.createPlaceholder(e),i.columnLines={lines:new Map,majorLines:new Map}}if(r.features.dependencies&&!r.features.dependencies.disabled){const e=t.element.querySelector(`[id="${r.svgCanvas.getAttribute("id")}"]`);(i.dependenciesPlaceholder=e)&&DomHelper.removeEachSelector(e,".b-sch-dependency")}n&&!DateHelper.betweenLesser(e.rangeStart,r.startDate,r.endDate)&&await t.scrollToDate(r,e.rangeStart)}async restoreState(e){let t=!1;const{client:r}=e,n=[],i=r.timeAxisSubGrid.scrollable.on({scrollStart({x:e}){this.element.scrollLeft!==e&&(t=!0)}});n.push(super.restoreState(e)),i(),t&&n.push(r.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(n)}async restoreComponent(e){const{client:t}=e;t.enableEventAnimations=this._oldEnableEventAnimations,t.currentOrientation.isHorizontalRendering&&(t.currentOrientation.scrollBuffer=this._oldScrollBuffer),await super.restoreComponent(e)}async onRowsCollected(e,t){const r=this;if(await super.onRowsCollected(e),r.exportMeta.includeTimeline){const{client:n}=t,{timeView:i}=n,{pageRangeStart:s,pageRangeEnd:o}=r.getCurrentPageDateRange(t);let a=!1;for(await r.scrollToDate(n,s);!a;)if(r.collectLines(t),r.collectHeaders(t),r.collectEvents(e,t),DateHelper.timeSpanContains(i.startDate,i.endDate,s,o))a=!0;else if(i.endDate.getTime()>=o.getTime())a=!0;else{const e=i.endDate;if(await r.scrollToDate(n,i.endDate),e.getTime()===i.endDate.getTime())throw new Error("Could not scroll to date")}await r.scrollToDate(n,t.rangeStart)}}getCurrentPageDateRange({rangeStart:e,rangeEnd:t,client:r}){const{exportMeta:n}=this,{horizontalPages:i,horizontalPosition:s,pageWidth:o,subGrids:a}=n;let l,c;if(i>1){const e=s*o,n=(s+1)*o,i=a.locked.width+a.locked.splitterWidth;n<=i?c=l=null:(l=r.getDateFromCoordinate(Math.max(e-i,0)),c=r.getDateFromCoordinate(1.2*(n-i))||t)}else l=e,c=t;return{pageRangeStart:l,pageRangeEnd:c}}prepareExportElement(){const{element:e,exportMeta:t}=this,{id:r,headerId:n,footerId:i,scrollLeft:s}=t.subGrids.normal,o=e.querySelector(`[id="${r}"]`);return[".b-sch-background-canvas",".b-sch-foreground-canvas"].forEach((e=>{const r=o.querySelector(e);r&&(t.lastExportedRowBottom?r.style.height=t.lastExportedRowBottom+"px":r.style.height="",s&&(r.style.marginLeft=`-${s}px`))})),s&&[n,i].forEach((t=>{const r=e.querySelector(`[id="${t}"] .b-widget-scroller`);r&&(r.style.marginLeft=`-${s}px`)})),super.prepareExportElement()}collectRow(e){const{subGrids:t}=this.exportMeta;Object.entries(e.elements).forEach((([r,n])=>{const i=[n.outerHTML,e.top,e.offsetHeight];"normal"===r&&i.push(new Map),t[r].rows.push(i)}))}collectHeaders(e){const{client:t}=e,{exportMeta:r}=this;if(!r.headersCollected){const e=t.timeView.element,n=r.timeAxisHeaders;DomHelper.forEachSelector(e,".b-sch-header-row",((e,i,s)=>{const o=n[i];DomHelper.forEachSelector(e,".b-sch-header-timeaxis-cell",(e=>{o.has(e.dataset.tickIndex)||o.set(e.dataset.tickIndex,e.outerHTML)})),i===s.length-1&&o.has(String(t.timeAxis.count-1))&&(r.headersCollected=!0)}))}}collectLines(e){const{client:t}=e,{exportMeta:r}=this,{columnLines:n}=r;if(!r.headersCollected&&n){const e=t.backgroundCanvas;DomHelper.forEachSelector(e,".b-column-line, .b-column-line-major",(e=>{if(e.classList.contains("b-column-line")){const t=Number(e.dataset.line.replace(/line-/,""));n.lines.set(t,e.outerHTML)}else{const t=Number(e.dataset.line.replace(/major-/,""));n.majorLines.set(t,e.outerHTML)}}))}}collectEvents(e,t){const r=e.length,{client:n}=t,i=this.exportMeta.subGrids.normal.rows;e.forEach(((e,t)=>{const s=i[i.length-r+t],o=n.store.getAt(e.dataIndex),a=s[3];o.events&&o.events.forEach((e=>{if(e.isScheduled){let t=n.getElementFromEventRecord(e,o);t&&(t=t.parentElement)&&!a.has(e.id)&&a.set(e.id,[t.outerHTML,Rectangle.from(t,t.offsetParent)])}}))}))}buildPageHtml(){const e=this,{subGrids:t,timeAxisHeaders:r,timeAxisPlaceholders:n,columnLines:i,columnLinesPlaceholder:s}=e.exportMeta;let o=e.prepareExportElement();if(Object.values(t).forEach((({placeHolder:t,eventsPlaceholder:r,rows:n})=>{const i=t.outerHTML,{resources:s,events:a}=e.positionRows(n);o=o.replace(i,s.join("")),r&&(o=o.replace(r.outerHTML,a.join("")))})),r.forEach(((e,t)=>{o=o.replace(n[t].outerHTML,Array.from(e.values()).join(""))})),i){const e=Array.from(i.lines.values()).concat(Array.from(i.majorLines.values()));o=o.replace(s.outerHTML,e.join(""))}return o=e.buildDependenciesHtml(o),o}getDependenciesOuterHTML(){const{dependenciesPlaceholder:e}=this.exportMeta;let t;if(BrowserHelper.isIE11){const r=document.createElement("div"),n=e.cloneNode(!0);r.appendChild(n),t=r.innerHTML}else t=e.outerHTML;return t}renderDependencies(){const{client:e,dependenciesPlaceholder:t,eventsBoxes:r}=this.exportMeta,{dependencies:n}=e,i=e.features.dependencies,s=Array.from(r.keys());n.filter((e=>s.includes(String(e.from))||s.includes(String(e.to)))).forEach((e=>{let n=r.get(String(e.from)),s=r.get(String(e.to));const o=i.getIteratableDependencyAssignments(e),{fromEvent:a,toEvent:l}=e;o.forEach((r=>{var o,c;if(!n&&a){const t=i.getBox(e,!0,r);t&&(n=t instanceof Rectangle?t:new Rectangle(t.start,t.top,t.end-t.start,t.bottom-t.top))}if(!s&&l){const t=i.getBox(e,!1,r);t&&(s=t instanceof Rectangle?t:new Rectangle(t.start,t.top,t.end-t.start,t.bottom-t.top))}const d={startRectangle:null===(o=n)||void 0===o?void 0:o.clone(),endRectangle:null===(c=s)||void 0===c?void 0:c.clone()};n&&s&&i.drawDependency(e,d,r,t,!1)}))}));const o=this.getDependenciesOuterHTML();return DomHelper.removeEachSelector(t,".b-sch-dependency"),o}buildDependenciesHtml(e){const{dependenciesPlaceholder:t,includeTimeline:r}=this.exportMeta;if(t&&r){const t=this.getDependenciesOuterHTML();e=e.replace(t,this.renderDependencies())}return e}};class MultiPageExporter$1 extends(SchedulerExporterMixin(MultiPageExporter)){static get $name(){return"MultiPageExporter"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}positionRows(e){const t=[],r=[];return e.forEach((([e,n,i,s])=>{t.push(e),s&&Array.from(s.entries()).forEach((([e,[t,n]])=>{r.push(t),this.exportMeta.eventsBoxes.set(String(e),n)}))})),{resources:t,events:r}}}MultiPageExporter$1._$name="MultiPageExporter";class MultiPageVerticalExporter$1 extends(SchedulerExporterMixin(MultiPageVerticalExporter)){static get $name(){return"MultiPageVerticalExporter"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}async prepareComponent(e){await super.prepareComponent(e),e.scheduleRange!==ScheduleRange.completeview&&this.estimateTotalPages(e)}positionRows(e){const t=[],r=[];return e.forEach((([e,n,i,s])=>{t.push(e),s&&Array.from(s.entries()).forEach((([e,[t,n]])=>{r.push(t),this.exportMeta.eventsBoxes.set(String(e),n)}))})),{resources:t,events:r}}}MultiPageVerticalExporter$1._$name="MultiPageVerticalExporter";class SinglePageExporter$1 extends(SchedulerExporterMixin(SinglePageExporter)){static get $name(){return"SinglePageExporter"}collectDependencies(){}positionRows(e){let t=0,r=[],n=[],i=/translate\((\d+.?\d*)px, (\d+.?\d*)px\)/;return e.forEach((([e,s,o,a])=>{r.push(e.replace(i,`translate($1px, ${t}px)`));const l=t-s;a&&Array.from(a.entries()).forEach((([e,[t,r]])=>{r.translate(0,l),this.exportMeta.eventsBoxes.set(String(e),r),n.push(t.replace(i,`translate($1px, ${r.y}px)`))})),t+=o})),{resources:r,events:n}}}SinglePageExporter$1._$name="SinglePageExporter";class PdfExport$1 extends PdfExport{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[SinglePageExporter$1,MultiPageExporter$1,MultiPageVerticalExporter$1],scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){return ObjectHelper.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"])}showExportDialog(){const e=this;e.exportDialog||(e.exportDialog=new SchedulerExportDialog(Object.assign({},e.defaultExportDialogConfig,{listeners:{export:e.onExportDialogExport,thisObj:e}}))),e.exportDialog.show()}buildExportConfig(e){e=super.buildExportConfig(e);const{scheduleRange:t,rangeStart:r,rangeEnd:n}=this;return e.columns&&!e.columns.find((e=>"timeAxis"===e.type))&&e.columns.push(e.client.timeAxisColumn.id),ObjectHelper.assign({scheduleRange:t,rangeStart:r,rangeEnd:n},e)}}PdfExport$1._$name="PdfExport",GridFeatureManager.registerFeature(PdfExport$1,!1,"Scheduler");class ScheduleTableExporter extends(Localizable(TableExporter)){static get defaultConfig(){return{includeUnassigned:!0,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140},{text:"Ends",field:"endDate",width:140}],eventSortFn:null}}construct(e={},...t){super.construct(e,...t),this.eventSortFn||(this.eventSortFn=(e,t)=>e.internalId-t.internalId)}normalizeColumns(e){super.normalizeColumns(e),e.eventColumns=e.eventColumns.map((e=>"string"==typeof e?{field:e}:e))}generateExportData(e){const t=this,r=this.target instanceof SchedulerBase,n=t.generateColumns(e),i=r?t.generateEventColumns(e):[];return{columns:n.concat(i),rows:t.generateRows(e)}}generateEventColumns(e){return e.eventColumns.map((t=>this.processEventColumn(t,e)))}processEventColumn(e,t){const{width:r,minWidth:n}=e,{defaultColumnWidth:i}=t;return{field:e.field,value:e.text,width:Math.max(r||i,n||i),eventColumn:!0,type:this.getColumnType(e,this.target.eventStore)}}generateRows(e){const t=this,{target:r}=t;let n;if(r instanceof SchedulerBase){if(n=[],r.resourceStore.map((r=>{const i=r.events||[];i.sort(t.eventSortFn),i.length||i.push(""),i.forEach((i=>n.push(t.getRowData(e,r,i))))})),e.includeUnassigned&&e.eventColumns.length){const i=r.eventStore.query((e=>!e.resources.length));if(i.length){const r=new Array(e.columns.length).fill("");r.push(t.L("L{ExcelExporter.No resource assigned}")),n.push(r),i.forEach((r=>n.push(t.getRowData(e,null,r))))}}n=n.filter((e=>e.length))}else n=super.generateRows(e);return n}getRowData(e,t,r){const{columns:n,eventColumns:i}=e,s=[],o=this.processRecord(t,n,e);if(o&&s.push(...o),!t||!t.isSpecialRow){const t=this.processRecord(r,i,e);t&&s.push(...t)}return s}}ScheduleTableExporter._$name="ScheduleTableExporter";class ExcelExporter$1 extends ExcelExporter{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{exporterClass:ScheduleTableExporter,exporterConfig:null}}}ExcelExporter$1._$name="ExcelExporter",GridFeatureManager.registerFeature(ExcelExporter$1,!1,"Scheduler");class ResourceInfoColumn extends Column{static get $name(){return"ResourceInfoColumn"}static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showImage","validNames","autoScaleThreshold"]}static get defaults(){return{showImage:!0,showEventCount:!0,showRole:!1,validNames:["amit","angelo","arcady","arnold","celia","chang","dan","dave","emilia","george","gloria","henrik","hitomi","jong","kate","lee","linda","lisa","lola","macy","madison","malik","mark","maxim","mike","rob","steve"],autoScaleThreshold:40,field:"name",htmlEncode:!1,width:140,cellCls:"b-resourceinfo-cell",editor:!VersionHelper.isTestEnv&&"text"}}construct(){const e=this;super.construct(...arguments),e.grid.isPainted?e.addErrorListener():e.grid.on({paint:e.addErrorListener,thisObj:e,once:!0})}getImageURL(e){return StringHelper.joinPaths([this.grid.resourceImagePath||"",e||""])}addErrorListener(){EventHelper.on({element:this.grid.element,delegate:".b-resource-image",error:e=>this.setDefaultResourceImage(e.target),capture:!0})}setDefaultResourceImage(e){const{defaultResourceImageName:t}=this.grid;if(t){const r=this.getImageURL(t);e.src&&!e.src.endsWith(r.replace(/^[./]*/gm,""))&&(e.src=r)}}template(e){const t=this,{showImage:r,showRole:n,showEventCount:i,grid:s}=t,{timeAxis:o,resourceImageExtension:a,defaultResourceImageName:l}=s,c="string"==typeof n?n:"role",d=e.eventStore.getEvents({includeOccurrences:s.enableRecurringEvents,resourceRecord:e,startDate:o.startDate,endDate:o.endDate}).length,u=e.get(t.field);let h;if(r&&!1!==e.image)if(e.imageUrl)h=e.imageUrl;else{const n="string"==typeof r?r:e.image||u&&u.toLowerCase()+a||l;h=t.getImageURL(n),n.includes(".")||(!t.validNames||t.validNames.includes(n)?h+=a:e.iconCls||(h=t.getImageURL(l)))}return{class:"b-resource-info",children:[h?{tag:"img",draggable:"false",class:"b-resource-image",src:h}:null,e.iconCls?{tag:"i",className:"b-resource-icon "+e.iconCls}:null,{tag:"dl",children:[{tag:"dt",html:u},n?{tag:"dd",class:"b-resource-role",html:e[c]}:null,i?{tag:"dd",class:"b-resource-events",html:t.L("L{eventCountText}",d)}:null]}]}}defaultRenderer({grid:e,record:t,cellElement:r,value:n,isExport:i}){let s;return t.isSpecialRow?s="":i?s=n:(this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?r.style.fontSize=e.rowHeight/40+"em":r.style.fontSize="",s=this.template(t)),s}}ColumnStore.registerColumnType(ResourceInfoColumn),ResourceInfoColumn._$name="ResourceInfoColumn";class Scheduler extends SchedulerBase{static get $name(){return"Scheduler"}static get type(){return"scheduler"}}Scheduler.initClass(),Scheduler._$name="Scheduler";const isProjectConsumer=e=>e.isProjectConsumer;class UndoRedo extends Container{static get $name(){return"UndoRedo"}static get type(){return"undoredo"}static get configurable(){return{scheduler:null,project:null,text:null,color:null,showZeroActionBadge:null,cls:"b-undo-controls b-toolbar",layoutStyle:{alignItems:"stretch",flexFlow:"row nowrap",overflow:"visible"},items:{undoBtn:{type:"button",icon:"b-fa-undo",tooltip:"Undo last action",disabled:!0,onAction:"up.onUndo"},transactionsCombo:{type:"combo",valueField:"idx",editable:!1,store:{},emptyText:"No items in the undo queue",onAction:"up.onTransactionSelected",displayValueRenderer:"up.transactionsDisplayValueRenderer"},redoBtn:{type:"button",icon:"b-fa-redo",tooltip:"Redo last undone action",disabled:!0,onAction:"up.onRedo"}}}}construct(){super.construct(...arguments),this.stm||(this.scheduler=this.up(isProjectConsumer)),this.stm.on({recordingstop:"updateUndoRedoControls",restoringstop:"updateUndoRedoControls",queueReset:"updateUndoRedoControls",disabled:"updateUndoRedoControls",thisObj:this})}changeItems(e){const{undoBtn:t,redoBtn:r}=e;return this.color&&(t&&(t.color=this.color),r&&(r.color=this.color)),this.text&&(t&&(t.text="Undo"),r&&(r.text="Redo")),super.changeItems(e)}changeScheduler(e){return e.isProjectConsumer?e:bryntum.get(e)}updateScheduler(e){const{crudManager:t}=e;t?t.on({load:"onCrudManagerLoad",thisObj:this}):this.onCrudManagerLoad(),this.stm=e.project.stm}updateProject(e){this.stm=e.stm}async onCrudManagerLoad(){await this.scheduler.project.commitAsync(),this.isDestroyed||(this.stm.enable(),this.fillUndoRedoCombo())}fillUndoRedoCombo(){this.widgetMap.transactionsCombo&&(this.widgetMap.transactionsCombo.items=this.stm.queue.map(((e,t)=>[t,e||"Transaction "+t])))}updateUndoRedoControls(){const{stm:e,showZeroActionBadge:t}=this,{undoBtn:r,redoBtn:n}=this.widgetMap;r.badge=e.position||(t?"0":""),n.badge=e.length-e.position||(t?"0":""),r.disabled=!e.canUndo,n.disabled=!e.canRedo,this.fillUndoRedoCombo()}transactionsDisplayValueRenderer(e,t){var r;const n=(null===(r=this.stm)||void 0===r?void 0:r.position)||0;return`${n} undo actions / ${t.store.count-n} redo actions`}onUndo(){this.stm.canUndo&&this.stm.undo()}onRedo(){this.stm.canRedo&&this.stm.redo()}onTransactionSelected(e){const t=this.stm,r=e.value;r>=0&&(t.canUndo&&r<t.position?t.undo(t.position-r):t.canRedo&&r>=t.position&&t.redo(r-t.position+1))}}UndoRedo.initClass(),UndoRedo._$name="UndoRedo";var __decorate$h=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class SchedulerProAssignmentMixin extends(Mixin([BaseAssignmentMixin],(e=>{e.prototype;class t extends e{}return __decorate$h([model_field({type:"number",defaultValue:100})],t.prototype,"units",void 0),t}))){}const throwIfNotTheSameStore=(e,t)=>{if(e!==t)throw new Error("Store set is prohibited for Scheduler Pro entity!")};var PartOfProject$1=e=>class extends(e||Base){static get $name(){return"PartOfProject"}get taskStore(){return this.eventStore}set taskStore(e){this.eventStore=e}get eventStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.eventStore}get leftProjectEventStore(){const e=this.leftProject;return(null==e?void 0:e.getEventStore())||null}set eventStore(e){throwIfNotTheSameStore(this.eventStore,e)}get dependencyStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.dependencyStore}set dependencyStore(e){throwIfNotTheSameStore(this.dependencyStore,e)}get assignmentStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore}set assignmentStore(e){throwIfNotTheSameStore(this.assignmentStore,e)}get resourceStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.resourceStore}set resourceStore(e){throwIfNotTheSameStore(this.resourceStore,e)}get calendarManagerStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.calendarManagerStore}set calendarManagerStore(e){throwIfNotTheSameStore(this.calendarManagerStore,e)}};class AssignmentModel$1 extends(PartOfProject$1(AssignmentModelMixin(SchedulerProAssignmentMixin.derive(Model)))){static get $name(){return"AssignmentModel"}static get isProAssignmentModel(){return!0}}AssignmentModel$1._$name="AssignmentModel";class AssignmentStore$1 extends(PartOfProject$1(AssignmentStoreMixin(ChronoAssignmentStoreMixin.derive(AjaxStore)))){static get defaultConfig(){return{modelClass:AssignmentModel$1}}}AssignmentStore$1._$name="AssignmentStore";class CalendarIntervalModel extends(PartOfProject$1(CalendarIntervalMixin.derive(Model))){static get $name(){return"CalendarIntervalModel"}}CalendarIntervalModel._$name="CalendarIntervalModel";class CalendarModel extends(PartOfProject$1(BaseCalendarMixin.derive(Model))){static get $name(){return"CalendarModel"}static get fields(){return[]}toString(){return this.name||""}static get defaultConfig(){return{calendarIntervalModelClass:CalendarIntervalModel}}}CalendarModel._$name="CalendarModel";class CalendarManagerStore extends(PartOfProject$1(ChronoCalendarManagerStoreMixin.derive(AjaxStore))){static get defaultConfig(){return{tree:!0,modelClass:CalendarModel,loadPriority:100,syncPriority:100,storeId:"calendars"}}}CalendarManagerStore._$name="CalendarManagerStore";var __decorate$i=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class SchedulerProDependencyMixin extends(Mixin([BaseDependencyMixin],(e=>{e.prototype;class t extends e{*calculateCalendar(){const e=this.getProject();let t;switch(yield e.$.dependenciesCalendar){case DependenciesCalendar.Project:t=yield e.$.effectiveCalendar;break;case DependenciesCalendar.FromEvent:const r=yield this.$.fromEvent;t=r&&!isAtomicValue(r)?yield r.$.effectiveCalendar:null;break;case DependenciesCalendar.ToEvent:const n=yield this.$.toEvent;t=n&&!isAtomicValue(n)?yield n.$.effectiveCalendar:null}return t||(t=yield e.$.effectiveCalendar),t}async setLag(e,t){if(this.graph)return this.graph.write(this.$.lag,e,t),this.graph.commitAsync();this.$.lag.DATA=e,null!=t&&(this.$.lagUnit.DATA=t)}writeLag(e,t,r,n,i){e.constructor.prototype.write.call(this,e,t,r,n),null!=i&&t.write(this.$.lagUnit,i)}}return __decorate$i([model_field({type:"number",defaultValue:0})],t.prototype,"lag",void 0),__decorate$i([model_field({type:"string",defaultValue:TimeUnit.Day},{converter:DateHelper.normalizeUnit})],t.prototype,"lagUnit",void 0),__decorate$i([field()],t.prototype,"calendar",void 0),__decorate$i([calculate("calendar")],t.prototype,"calculateCalendar",null),__decorate$i([write("lag")],t.prototype,"writeLag",null),t}))){}class DependencyModel$1 extends(PartOfProject$1(SchedulerProDependencyMixin.derive(DependencyBaseModel))){static get $name(){return"DependencyModel"}static get isProDependencyModel(){return!0}}DependencyModel$1._$name="DependencyModel";class DependencyStore$1 extends(PartOfProject$1(DependencyStoreMixin(ChronoDependencyStoreMixin.derive(AjaxStore)))){static get defaultConfig(){return{modelClass:DependencyModel$1}}}DependencyStore$1._$name="DependencyStore";var PercentDoneMixin=e=>class extends e{static get $name(){return"PercentDoneMixin"}get isStarted(){return this.percentDone>0}get isCompleted(){return this.percentDone>=100}get isInProgress(){return this.isStarted&&!this.isCompleted}copy(){const e=super.copy(...arguments);return e.percentDone=0,e}get renderedPercentDone(){const e="number"!=typeof this.percentDone||isNaN(this.percentDone)?0:this.percentDone;return e<=99?Math.round(e):Math.floor(e)}set renderedPercentDone(e){this.percentDone=e}};class DateInterval extends Base$1{initialize(...e){super.initialize(...e),this.startDate||(this.startDate=MIN_DATE$1),this.endDate||(this.endDate=MAX_DATE)}equalTo(e){return this.startDate.getTime()===e.startDate.getTime()&&this.endDate.getTime()===e.endDate.getTime()}startDateIsFinite(){return!this.isIntervalEmpty()&&this.startDate.getTime()!==MIN_DATE$1.getTime()}endDateIsFinite(){return!this.isIntervalEmpty()&&this.endDate.getTime()!==MAX_DATE.getTime()}containsDate(e,t=EdgeInclusion.Left){return t===EdgeInclusion.Left&&e>=this.startDate&&e<this.endDate||t===EdgeInclusion.Right&&e>this.startDate&&e<=this.endDate}isIntervalEmpty(){return this.startDate>this.endDate}intersect(e){const t=e.startDate,r=e.endDate,n=this.startDate,i=this.endDate;if(i<t||n>r)return EMPTY_INTERVAL;const s=new Date(Math.max(n.getTime(),t.getTime())),o=new Date(Math.min(i.getTime(),r.getTime()));return this.constructor.new({startDate:s,endDate:o})}intersectMut(e){const t=e.startDate,r=e.endDate,n=this.startDate,i=this.endDate;return i<t||n>r?(this.startDate=MAX_DATE,this.endDate=MIN_DATE$1,this):(this.startDate=new Date(Math.max(n.getTime(),t.getTime())),this.endDate=new Date(Math.min(i.getTime(),r.getTime())),this)}}const EMPTY_INTERVAL=DateInterval.new({startDate:MAX_DATE,endDate:MIN_DATE$1}),intersectIntervals=e=>e.reduce(((e,t)=>e.intersectMut(t)),DateInterval.new());var __decorate$j=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const calculateEffectiveStartDateConstraintInterval=function*(e,t,r,n){if(r.isIntervalEmpty())return EMPTY_INTERVAL;const i=r.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(r.startDate,!1,n):null,s=r.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(r.endDate,!1,n):null;return intersectIntervals([t,DateInterval.new({startDate:i,endDate:s})])},calculateEffectiveEndDateConstraintInterval=function*(e,t,r,n){if(t.isIntervalEmpty())return EMPTY_INTERVAL;const i=t.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.startDate,!0,n):null,s=t.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.endDate,!0,n):null;return intersectIntervals([r,DateInterval.new({startDate:i,endDate:s})])},EarlyLateLazyness=!0;class ConstrainedEarlyEventMixin extends(Mixin([HasSubEventsMixin],(e=>{const t=e.prototype;class r extends e{*maybeSkipNonWorkingTime(e,t=!0){let r=yield*this.calculateEffectiveDuration();return e&&r>0?yield*this.skipNonWorkingTime(e,t):e}*calculateEffectiveConstraintInterval(e,t,r){const n=yield*this.calculateEffectiveDuration();if(null==n)return null;const i=e?calculateEffectiveStartDateConstraintInterval:calculateEffectiveEndDateConstraintInterval;return yield*i(this,intersectIntervals(t),intersectIntervals(r),n)}*calculateStartDateConstraintIntervals(){return[]}*calculateEndDateConstraintIntervals(){return[]}*calculateEarlyStartDateConstraintIntervals(){return[]}*calculateEarlyEndDateConstraintIntervals(){return[]}*calculateEarlyEffectiveStartDateInterval(){const e=yield this.$.earlyStartDateConstraintIntervals,t=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!0,e.concat(yield this.$.startDateConstraintIntervals),t.concat(yield this.$.endDateConstraintIntervals))}*calculateEarlyEffectiveEndDateInterval(){const e=yield this.$.earlyStartDateConstraintIntervals,t=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!1,e.concat(yield this.$.startDateConstraintIntervals),t.concat(yield this.$.endDateConstraintIntervals))}*calculateEarlyStartDateRaw(){if(yield*this.hasSubEvents()){let e=MAX_DATE;const t=yield*this.subEventsIterable();for(let r of t){const t=yield r.$.earlyStartDate;t&&t<e&&(e=t)}return e.getTime()-MAX_DATE.getTime()?e:null}if(yield this.$.manuallyScheduled)return yield this.$.startDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.startDate;const e=yield this.$.earlyEffectiveStartDateInterval;if(null===e)return null;if(e.isIntervalEmpty()){const e=ConflictEffect.new();if((yield e)!==ConflictResolutionResult.Cancel)return null;yield Reject(e)}return isDateFinite(e.startDate)?e.startDate:null}*calculateEarlyStartDate(){const e=yield this.$.earlyStartDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!0)}*calculateEarlyEndDateRaw(){if(yield*this.hasSubEvents()){let e=MIN_DATE$1;const t=yield*this.subEventsIterable();for(let r of t){const t=yield r.$.earlyEndDate;t&&t>e&&(e=t)}return e.getTime()-MIN_DATE$1.getTime()?e:null}if(yield this.$.manuallyScheduled)return yield this.$.endDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.endDate;const e=yield this.$.earlyEffectiveEndDateInterval;if(null===e)return null;if(e.isIntervalEmpty()){const e=ConflictEffect.new();if((yield e)!==ConflictResolutionResult.Cancel)return null;yield Reject(e)}return isDateFinite(e.startDate)?e.startDate:null}*calculateEarlyEndDate(){const e=yield this.$.earlyEndDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!1)}*isConstrainedEarly(){const e=yield this.$.startDateConstraintIntervals,t=yield this.$.endDateConstraintIntervals,r=yield this.$.earlyStartDateConstraintIntervals,n=yield this.$.earlyEndDateConstraintIntervals;return Boolean((null==e?void 0:e.length)||(null==t?void 0:t.length)||(null==r?void 0:r.length)||(null==n?void 0:n.length))}*calculateStartDatePure(){return(yield this.$.direction)===Direction.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield*this.hasSubEvents())?yield*t.calculateStartDatePure.call(this):(yield this.$.earlyStartDate)||(yield*t.calculateStartDatePure.call(this)):yield*t.calculateStartDatePure.call(this)}*calculateStartDateProposed(){switch(yield this.$.direction){case Direction.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield*this.hasSubEvents()))return yield*t.calculateStartDateProposed.call(this);const e=yield this.$.earlyStartDate;if(e){if(isDateFinite(e))return e;const r=yield*t.calculateStartDateProposed.call(this),n=yield this.$.earlyEffectiveStartDateInterval;return n.containsDate(r)?r:isDateFinite(n.endDate)?n.endDate:r}return yield*t.calculateStartDateProposed.call(this);default:return yield*t.calculateStartDateProposed.call(this)}}*calculateEndDatePure(){return(yield this.$.direction)===Direction.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield*this.hasSubEvents())?yield*t.calculateEndDatePure.call(this):(yield this.$.earlyEndDate)||(yield*t.calculateEndDatePure.call(this)):yield*t.calculateEndDatePure.call(this)}*calculateEndDateProposed(){switch(yield this.$.direction){case Direction.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield*this.hasSubEvents()))return yield*t.calculateEndDateProposed.call(this);const e=yield this.$.earlyEndDate;if(e){if(isDateFinite(e))return e;const r=yield*t.calculateEndDateProposed.call(this),n=yield this.$.earlyEffectiveEndDateInterval;return n.containsDate(r)?r:isDateFinite(n.endDate)?n.endDate:r}return yield*t.calculateEndDateProposed.call(this);default:return yield*t.calculateEndDateProposed.call(this)}}*calculateDirection(){const e=this.getProject();return yield e.$.direction}}return __decorate$j([field({lazy:true})],r.prototype,"earlyStartDateRaw",void 0),__decorate$j([model_field({type:"date",persist:!1},{lazy:true,converter:dateConverter,persistent:!1})],r.prototype,"earlyStartDate",void 0),__decorate$j([field({lazy:true})],r.prototype,"earlyEndDateRaw",void 0),__decorate$j([model_field({type:"date",persist:!1},{lazy:true,converter:dateConverter,persistent:!1})],r.prototype,"earlyEndDate",void 0),__decorate$j([field()],r.prototype,"startDateConstraintIntervals",void 0),__decorate$j([field()],r.prototype,"endDateConstraintIntervals",void 0),__decorate$j([field({lazy:true})],r.prototype,"earlyStartDateConstraintIntervals",void 0),__decorate$j([field({lazy:true})],r.prototype,"earlyEndDateConstraintIntervals",void 0),__decorate$j([field()],r.prototype,"earlyEffectiveStartDateInterval",void 0),__decorate$j([field()],r.prototype,"earlyEffectiveEndDateInterval",void 0),__decorate$j([calculate("startDateConstraintIntervals")],r.prototype,"calculateStartDateConstraintIntervals",null),__decorate$j([calculate("endDateConstraintIntervals")],r.prototype,"calculateEndDateConstraintIntervals",null),__decorate$j([calculate("earlyStartDateConstraintIntervals")],r.prototype,"calculateEarlyStartDateConstraintIntervals",null),__decorate$j([calculate("earlyEndDateConstraintIntervals")],r.prototype,"calculateEarlyEndDateConstraintIntervals",null),__decorate$j([calculate("earlyEffectiveStartDateInterval")],r.prototype,"calculateEarlyEffectiveStartDateInterval",null),__decorate$j([calculate("earlyEffectiveEndDateInterval")],r.prototype,"calculateEarlyEffectiveEndDateInterval",null),__decorate$j([calculate("earlyStartDateRaw")],r.prototype,"calculateEarlyStartDateRaw",null),__decorate$j([calculate("earlyStartDate")],r.prototype,"calculateEarlyStartDate",null),__decorate$j([calculate("earlyEndDateRaw")],r.prototype,"calculateEarlyEndDateRaw",null),__decorate$j([calculate("earlyEndDate")],r.prototype,"calculateEarlyEndDate",null),__decorate$j([calculate("direction")],r.prototype,"calculateDirection",null),r}))){}var __decorate$k=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class HasChildrenMixin extends(Mixin([HasSubEventsMixin],(e=>{e.prototype;class t extends e{*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}get parent(){return this._parent}set parent(e){this._parent=e,this.parentEvent=e}}return __decorate$k([reference({bucket:"childEvents"})],t.prototype,"parentEvent",void 0),__decorate$k([bucket()],t.prototype,"childEvents",void 0),t}))){}var __decorate$l=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class HasDateConstraintMixin extends(Mixin([ConstrainedEarlyEventMixin,HasChildrenMixin],(e=>{const t=e.prototype;class r extends e{writeStartDate(e,r,n,i,s=!0){const o=this.getProject();if(r.graph.hasIdentifier(this.$.direction)&&(!o||!o.getStm().isRestoring)){const e=this.getStartDatePinConstraintType();e&&(this.constraintType=e,this.constraintDate=i)}return t.writeStartDate.call(this,e,r,n,i,s)}writeEndDate(e,r,n,i,s=!1){const o=this.getProject();if(r.graph.hasIdentifier(this.$.direction)&&s&&(!o||!o.getStm().isRestoring)){const e=this.getEndDatePinConstraintType();e&&(this.constraintType=e,this.constraintDate=i)}return t.writeEndDate.call(this,e,r,n,i,s)}*calculateConstraintType(){let e=yield ProposedOrPrevious;return(yield*this.isConstraintTypeApplicable(e))||(e=null),e}*calculateConstraintDate(e){let t=yield ProposedOrPrevious;const r=yield this.$.constraintType;return r?t||(t=this.getConstraintTypeDefaultDate(e,r)):t=null,t}getStartDatePinConstraintType(){const{direction:e}=this;if(!this.isTaskPinnableWithConstraint())return null;switch(e){case Direction.Forward:return ConstraintType.StartNoEarlierThan;case Direction.Backward:return ConstraintType.FinishNoLaterThan}}getEndDatePinConstraintType(){const{direction:e}=this;if(!this.isTaskPinnableWithConstraint())return null;switch(e){case Direction.Forward:return ConstraintType.FinishNoEarlierThan;case Direction.Backward:return ConstraintType.FinishNoLaterThan}}isTaskPinnableWithConstraint(){const{manuallyScheduled:e,constraintType:t}=this;let r=!1;if(!e)if(t)switch(t){case ConstraintType.StartNoEarlierThan:case ConstraintType.StartNoLaterThan:case ConstraintType.FinishNoEarlierThan:case ConstraintType.FinishNoLaterThan:r=!0}else r=!0;return r}getConstraintTypeDefaultDate(e,t){switch(t){case ConstraintType.StartNoEarlierThan:case ConstraintType.StartNoLaterThan:case ConstraintType.MustStartOn:return e(ProposedOrPreviousValueOf(this.$.startDate));case ConstraintType.FinishNoEarlierThan:case ConstraintType.FinishNoLaterThan:case ConstraintType.MustFinishOn:return e(ProposedOrPreviousValueOf(this.$.endDate))}return null}*isConstraintTypeApplicable(e){const t=(yield this.$.childEvents).size>0;switch(e){case ConstraintType.FinishNoEarlierThan:case ConstraintType.StartNoLaterThan:case ConstraintType.MustFinishOn:case ConstraintType.MustStartOn:return!t}return!0}async setConstraint(e,t){return this.constraintType=e,void 0!==t&&(this.constraintDate=t),this.commitAsync()}*calculateEndDateConstraintIntervals(){const e=yield*t.calculateEndDateConstraintIntervals.call(this),r=yield this.$.constraintType,n=yield this.$.constraintDate;if(r&&n)switch(r){case ConstraintType.MustFinishOn:e.unshift(DateInterval.new({startDate:n,endDate:n}));break;case ConstraintType.FinishNoEarlierThan:e.unshift(DateInterval.new({startDate:n}));break;case ConstraintType.FinishNoLaterThan:e.unshift(DateInterval.new({endDate:n}))}return e}*calculateStartDateConstraintIntervals(){const e=yield*t.calculateStartDateConstraintIntervals.call(this),r=yield this.$.constraintType,n=yield this.$.constraintDate;if(r&&n)switch(r){case ConstraintType.MustStartOn:e.unshift(DateInterval.new({startDate:n,endDate:n}));break;case ConstraintType.StartNoEarlierThan:e.unshift(DateInterval.new({startDate:n}));break;case ConstraintType.StartNoLaterThan:e.unshift(DateInterval.new({endDate:n}))}return e}}return __decorate$l([model_field({type:"string"},{sync:!0})],r.prototype,"constraintType",void 0),__decorate$l([model_field({type:"date"},{converter:dateConverter,sync:!0})],r.prototype,"constraintDate",void 0),__decorate$l([calculate("constraintType")],r.prototype,"calculateConstraintType",null),__decorate$l([calculate("constraintDate")],r.prototype,"calculateConstraintDate",null),r}))){}var __decorate$m=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class HasPercentDoneMixin extends(Mixin([HasChildrenMixin],(e=>{e.prototype;class t extends e{*calculatePercentDone(){const e=yield this.$.childEvents,t=this.getProject(),r=yield t.$.autoCalculatePercentDoneForParentTasks;if(e.size&&r){const e=yield this.$.percentDoneSummaryData;return e.totalDuration>0?e.completedDuration/e.totalDuration:e.milestonesNum>0?e.milestonesTotalPercentDone/e.milestonesNum:null}return yield ProposedOrPrevious}*calculatePercentDoneSummaryData(){const e=yield this.$.childEvents;if(e.size){let t={totalDuration:0,completedDuration:0,milestonesNum:0,milestonesTotalPercentDone:0};for(const r of e){const e=yield r.$.percentDoneSummaryData;e&&(t.totalDuration+=e.totalDuration,t.completedDuration+=e.completedDuration,t.milestonesNum+=e.milestonesNum,t.milestonesTotalPercentDone+=e.milestonesTotalPercentDone)}return t}{const e=yield this.$.duration;if("number"==typeof e){const t=yield*this.getProject().$convertDuration(e,yield this.$.durationUnit,TimeUnit.Millisecond),r=yield this.$.percentDone;return{totalDuration:t,completedDuration:t*r,milestonesNum:0===t?1:0,milestonesTotalPercentDone:0===t?r:0}}return null}}}return __decorate$m([model_field({type:"number",defaultValue:0})],t.prototype,"percentDone",void 0),__decorate$m([field()],t.prototype,"percentDoneSummaryData",void 0),__decorate$m([calculate("percentDone")],t.prototype,"calculatePercentDone",null),__decorate$m([calculate("percentDoneSummaryData")],t.prototype,"calculatePercentDoneSummaryData",null),t}))){}var __decorate$n=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class ScheduledByDependenciesEarlyEventMixin extends(Mixin([ConstrainedEarlyEventMixin,HasDependenciesMixin],(e=>{const t=e.prototype;class r extends e{*calculateEarlyStartDateConstraintIntervals(){const e=yield*t.calculateEarlyStartDateConstraintIntervals.call(this),r=this.getProject();for(const t of yield this.$.incomingDeps){const n=yield t.$.fromEvent;if(null==n||isAtomicValue(n))continue;let i;switch(yield t.$.type){case DependencyType.EndToStart:const e=yield n.$.earlyEndDateRaw;if(e){const n=yield t.$.lag,s=yield t.$.lagUnit,o=yield t.$.calendar;i=DateInterval.new({startDate:o.calculateEndDate(e,yield*r.$convertDuration(n,s,TimeUnit.Millisecond)),endDate:null})}break;case DependencyType.StartToStart:const s=yield n.$.earlyStartDateRaw;if(s){const e=yield t.$.lag,n=yield t.$.lagUnit,o=yield t.$.calendar;i=DateInterval.new({startDate:o.calculateEndDate(s,yield*r.$convertDuration(e,n,TimeUnit.Millisecond)),endDate:null})}}i&&e.unshift(i)}return e}*calculateEarlyEndDateConstraintIntervals(){const e=yield*t.calculateEarlyEndDateConstraintIntervals.call(this),r=this.getProject();for(const t of yield this.$.incomingDeps){const n=yield t.$.fromEvent;if(null==n||isAtomicValue(n))continue;let i;switch(yield t.$.type){case DependencyType.EndToEnd:const e=yield n.$.earlyEndDateRaw;if(e){const n=yield t.$.lag,s=yield t.$.lagUnit,o=yield t.$.calendar;i=DateInterval.new({startDate:o.calculateEndDate(e,yield*r.$convertDuration(n,s,TimeUnit.Millisecond)),endDate:null})}break;case DependencyType.StartToEnd:const s=yield n.$.earlyStartDateRaw;if(s){const e=yield t.$.lag,n=yield t.$.lagUnit,o=yield t.$.calendar;i=DateInterval.new({startDate:o.calculateEndDate(s,yield*r.$convertDuration(e,n,TimeUnit.Millisecond)),endDate:null})}}i&&e.unshift(i)}return e}}return __decorate$n([calculate("earlyEndDateIntervals")],r.prototype,"calculateEarlyEndDateConstraintIntervals",null),r}))){}var __decorate$o=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class SchedulerProHasAssignmentsMixin extends(Mixin([BaseHasAssignmentsMixin],(e=>{const t=e.prototype;class r extends e{async assign(e,t=100){if(this.getAssignmentFor(e))throw new Error("Resource can't be assigned twice to the same task");const r=this.getProject().assignmentStore.modelClass;return this.addAssignment(new r({event:this,resource:e,units:t})),this.commitAsync()}*forEachAvailabilityInterval(e,t){const r=yield this.$.effectiveCalendar,n=yield this.$.assignmentsByCalendar;return(yield this.$.effectiveCalendarsCombination).forEachAvailabilityInterval(e,((i,s,o)=>{const a=o.getCalendarsWorkStatus(),l=o.getCalendarsWorking();if(a.get(r)&&(e.ignoreResourceCalendars||l.some((e=>n.has(e)))))return t(i,s,o)}))}*calculateEffectiveCalendarsCombination(){const e=[...(yield this.$.assignmentsByCalendar).keys(),yield this.$.effectiveCalendar];return this.getProject().combineCalendars(e)}*calculateAssignmentsByCalendar(){const e=yield this.$.assigned,t=new Map;for(const r of e){const e=yield r.$.resource;if(e){const n=yield e.$.effectiveCalendar;let i=t.get(n);i||(i=[],t.set(n,i)),i.push(r)}}return t}*getBaseOptionsForDurationCalculations(){return{ignoreResourceCalendars:!1}}*skipNonWorkingTime(e,r=!0){if(!e)return null;if((yield this.$.assignmentsByCalendar).size>0){const t=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),r?{startDate:e,isForward:r}:{endDate:e,isForward:r});let n;const i=yield*this.forEachAvailabilityInterval(t,((e,t,i)=>(n=r?e:t,!1)));return i!==CalendarIteratorResult.MaxRangeReached&&i!==CalendarIteratorResult.FullRangeIterated||(yield Reject("Empty calendar")),new Date(n)}return yield*t.skipNonWorkingTime.call(this,e,r)}*calculateProjectedDuration(e,r,n){if(!e||!r)return null;if((yield this.$.assignmentsByCalendar).size>0){const t=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),{startDate:e,endDate:r,isForward:!0});let i=0;return yield*this.forEachAvailabilityInterval(t,((e,t)=>{i+=t.getTime()-e.getTime()})),n||(n=yield this.$.durationUnit),yield*this.getProject().$convertDuration(i,TimeUnit.Millisecond,n)}return yield*t.calculateProjectedDuration.call(this,e,r,n)}*calculateProjectedXDateWithDuration(e,t=!0,r){if(null==r||isNaN(r)||null==e)return null;if(0==r)return e;const n=yield this.$.durationUnit,i=yield*this.getProject().$convertDuration(r,n,TimeUnit.Millisecond);let s=e.getTime(),o=i;const a=yield this.$.effectiveCalendar;if((yield this.$.assignmentsByCalendar).size>0){const r=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),t?{startDate:e,isForward:t}:{endDate:e,isForward:t});return yield*this.forEachAvailabilityInterval(r,((e,r,n)=>{const i=e.getTime(),a=r.getTime(),l=a-i;if(l>=o)return s=t?i+o:a-o,!1;{const t=e.getTimezoneOffset()-r.getTimezoneOffset();o-=l+60*t*1e3}})),new Date(s)}return a.accumulateWorkingTime(e,i,t).finalDate}}return __decorate$o([field()],r.prototype,"effectiveCalendarsCombination",void 0),__decorate$o([field()],r.prototype,"assignmentsByCalendar",void 0),__decorate$o([calculate("effectiveCalendarsCombination")],r.prototype,"calculateEffectiveCalendarsCombination",null),__decorate$o([calculate("assignmentsByCalendar")],r.prototype,"calculateAssignmentsByCalendar",null),r}))){}class SchedulerProEvent extends(Mixin([SchedulerBasicEvent,HasDateConstraintMixin,HasPercentDoneMixin,SchedulerProHasAssignmentsMixin,ConstrainedEarlyEventMixin,ScheduledByDependenciesEarlyEventMixin],(e=>{e.prototype;return class extends e{}}))){}class EventModel$1 extends(SchedulerProEvent.derive(TimeSpan).mixin(RecurringTimeSpan,PartOfProject$1,EventModelMixin,PercentDoneMixin)){static get $name(){return"EventModel"}static get isProEventModel(){return!0}static get fields(){return[{name:"showInTimeline",type:"boolean"},"note"]}}EventModel$1._$name="EventModel";class EventStore$1 extends(PartOfProject$1(SharedEventStoreMixin(RecurringEventsMixin(EventStoreMixin(ChronoEventStoreMixin.derive(AjaxStore)))))){static get defaultConfig(){return{modelClass:EventModel$1}}}EventStore$1._$name="EventStore";var __decorate$p=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class ResourceAllocationEventRangeCalendarIntervalMixin extends CalendarIntervalMixin{static get fields(){return[{name:"isWorking",type:"boolean",defaultValue:!0}]}}class ResourceAllocationEventRangeCalendarIntervalStore extends CalendarIntervalStore{static get defaultConfig(){return{modelClass:ResourceAllocationEventRangeCalendarIntervalMixin}}}class ResourceAllocationEventRangeCalendar extends BaseCalendarMixin{get intervalStoreClass(){return ResourceAllocationEventRangeCalendarIntervalStore}}__decorate$p([model_field({type:"boolean",defaultValue:!1})],ResourceAllocationEventRangeCalendar.prototype,"unspecifiedTimeIsWorking",void 0);class ResourceAllocationInterval extends Base$1{constructor(){super(...arguments),this.assignments=null,this.effort=0,this.maxEffort=0,this.units=0,this.isOverallocated=!1,this.isUnderallocated=!1}}class ResourceAllocationInfo extends(Entity.mix(Base$1)){*calculateAllocation(){const e=[],t=yield this.ticks,r=yield this.$.resource,n=yield r.$.assigned,i=new Map,s=[];for(const e of n){const t=yield e.$.event;if(yield e.$.units,t){const r=yield t.$.startDate,n=yield t.$.endDate;s.push({startDate:r,endDate:n,assignment:e});const o=yield t.$.effectiveCalendar;let a=i.get(o);a||(a=[],i.set(o,a)),a.push(e)}}const o=new ResourceAllocationEventRangeCalendar({intervals:s}),a=[t,o,...i.keys()],l=new Map;let c,d;return t.intervalStore.forEach((t=>{const n=ResourceAllocationInterval.new({tick:t,resource:r});l.set(t,n),e.push(n)})),yield*r.forEachAvailabilityInterval({startDate:e[0].tick.startDate,endDate:e[e.length-1].tick.endDate,calendars:a},((e,r,n)=>{const i=n.getCalendarsWorkStatus();if(i.get(t)){const s=n.intervalsByCalendar.get(t)[0],a=r.getTime()-e.getTime(),u=l.get(s),h=u.assignments||new Set;u.assignments||(c=0,d=0);let g,m=0;n.intervalsByCalendar.get(o).forEach((t=>{const n=t.assignment;if(n&&i.get(n.event.effectiveCalendar)){const t=Math.max(e.getTime(),n.event.startDate.getTime()),i=Math.min(r.getTime(),n.event.endDate.getTime());g=i-t,u.effort+=g*n.units/100,m+=n.units,h.add(n)}})),u.maxEffort+=a,m&&(g?(c+=g*m,d+=g,u.units=c/d):c||(u.units=m)),h.size&&(u.assignments=h,u.isOverallocated=u.isOverallocated||m>100,u.isUnderallocated=u.isUnderallocated||m<100)}})),e}}__decorate$p([field()],ResourceAllocationInfo.prototype,"resource",void 0),__decorate$p([field()],ResourceAllocationInfo.prototype,"allocation",void 0),__decorate$p([calculate("allocation")],ResourceAllocationInfo.prototype,"calculateAllocation",null);class SchedulerProResourceMixin extends(Mixin([BaseResourceMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.observers=new Set,this.entities=new Set}leaveGraph(e){const{graph:r}=this;for(const e of this.entities)r.removeEntity(e);for(const e of this.observers)r.removeIdentifier(e);t.leaveGraph.call(this,e)}*forEachAvailabilityInterval(e,t){const r=yield this.$.effectiveCalendar;return this.getProject().combineCalendars([r].concat(e.calendars||[])).forEachAvailabilityInterval(e,((e,n,i)=>{if(i.getCalendarsWorkStatus().get(r))return t(e,n,i)}))}}}))){}class ResourceModel$1 extends(PartOfProject$1(ResourceModelMixin(SchedulerProResourceMixin.derive(GridRowModel)))){static get $name(){return"ResourceModel"}}ResourceModel$1._$name="ResourceModel";class ResourceStore$1 extends(PartOfProject$1(ResourceStoreMixin(ChronoResourceStoreMixin.derive(AjaxStore)))){static get defaultConfig(){return{modelClass:ResourceModel$1}}}ResourceStore$1._$name="ResourceStore";var ProjectCrudManager=e=>class extends((e||Base).mixin(SchedulerProjectCrudManager)){static get properties(){return{deprecatedProjectCalendarProperties:["hoursPerDay","daysPerWeek","daysPerMonth"]}}construct(...e){const t=this;super.construct(...e),t.addPrioritizedStore(t.calendarManagerStore),t.addPrioritizedStore(t.assignmentStore),t.addPrioritizedStore(t.dependencyStore),t.addPrioritizedStore(t.resourceStore),t.addPrioritizedStore(t.eventStore),t.timeRangeStore&&t.addPrioritizedStore(t.timeRangeStore),t.resourceTimeRangeStore&&t.addPrioritizedStore(t.resourceTimeRangeStore)}adjustDeprecatedResponse(e){const t=null==e?void 0:e.project,r=null==t?void 0:t.calendar,{deprecatedProjectCalendarProperties:n}=this;if(n&&r&&e.calendars){var i;const s=(null===(i=e.calendars.rows)||void 0===i?void 0:i.slice())||[];let o;for(;o=s.shift();){if(o.id==r){n.forEach((e=>{!t[e]&&o[e]&&(t[e]=o[e])}));break}o.children&&s.push(...o.children)}}return e}get project(){return this}set project(e){super.project=e}async applyResponse(e,t,r){if(!this.isDestroyed)return t=this.adjustDeprecatedResponse(t),super.applyResponse(e,t,r)}},__decorate$q=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class SchedulerProProjectMixin extends(Mixin([SchedulerBasicProjectMixin,ConstrainedEarlyEventMixin],(e=>{e.prototype;class t extends e{*calculateDirection(){return yield ProposedOrPrevious}getType(){return ProjectType.SchedulerPro}getDefaultEventModelClass(){return SchedulerProEvent}getDefaultDependencyModelClass(){return SchedulerProDependencyMixin}getDefaultAssignmentModelClass(){return SchedulerProAssignmentMixin}getDefaultResourceModelClass(){return SchedulerProResourceMixin}async validateDependency(e,t,r,n){return CI(e.outgoingDeps).some((e=>e.toEvent===t&&n!==e))?DependencyValidationResult.DuplicatingDependency:await this.isDependencyCyclic(e,t,r,n)?DependencyValidationResult.CyclicDependency:DependencyValidationResult.NoError}async isValidDependency(e,t,r,n){return await this.validateDependency(e,t,r,n)===DependencyValidationResult.NoError}async isDependencyCyclic(e,t,r,n){const i=new(0,this.getDependencyStore().modelClass)({fromEvent:e,toEvent:t,type:r}),s=this.replica.branch({autoCommit:!1,onComputationCycle:"throw"});n&&s.removeEntity(n),s.addEntity(i);try{return await s.readAsync(e.$.startDate),!1}catch(e){if(/cycle/i.test(e))return!0;throw e}}async isValidExistingDependency(e){const t=new(0,this.getDependencyStore().modelClass)({fromEvent:e.fromEvent,toEvent:e.toEvent,type:e.type});await this.replica.commitAsync();const r=this.replica.branch({autoCommit:!1,onComputationCycle:"throw"});r.removeEntity(e),r.addEntity(t);try{return await r.readAsync(t.fromEvent.$.startDate),!0}catch(e){if(/cycle/i.test(e))return!1;throw e}}}return __decorate$q([model_field({type:"string",defaultValue:DependenciesCalendar.ToEvent})],t.prototype,"dependenciesCalendar",void 0),__decorate$q([model_field({type:"boolean",defaultValue:!0})],t.prototype,"autoCalculatePercentDoneForParentTasks",void 0),t}))){}class ProjectModel$1 extends(ProjectCrudManager(SchedulerProProjectMixin.derive(ProjectModelMixin()))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{calendarModelClass:CalendarModel,dependencyModelClass:DependencyModel$1,eventModelClass:EventModel$1,assignmentModelClass:AssignmentModel$1,resourceModelClass:ResourceModel$1,calendarManagerStoreClass:CalendarManagerStore,dependencyStoreClass:DependencyStore$1,eventStoreClass:EventStore$1,assignmentStoreClass:AssignmentStore$1,resourceStoreClass:ResourceStore$1}}}ProjectModel$1._$name="ProjectModel";class DurationColumn extends NumberColumn{static get $name(){return"DurationColumn"}static get type(){return"duration"}static get isGanttColumn(){return!0}static get fields(){return[{name:"decimalPrecision",defaultValue:1}]}static get defaults(){return{field:"fullDuration",text:"L{Duration}",min:0,step:1,instantUpdate:!0,filterType:"duration",sortable:function(e,t){return e[this.field]-t[this.field]}}}construct(){super.construct(...arguments);const e=this.sortable;this.sortable=(...t)=>e.call(this,...t)}get durationUnitField(){return this.field+"Unit"}formatValue(e,t){const r="number"==typeof this.grid.durationDisplayPrecision?this.grid.durationDisplayPrecision:this.decimalPrecision,n=Math.pow(10,r);return Math.round(e*n)/n+" "+DateHelper.getLocalizedNameOfUnit(t,1!==e)}get defaultEditor(){return{type:"duration",name:this.field}}canEdit(e){return e.isLeaf}defaultRenderer({record:e,isExport:t}){const r=e[this.field],n=typeof r,i="number"===n?r:r&&r.magnitude,s="number"===n?e[this.durationUnitField]:r&&r.unit;return"number"!=typeof i?t?"":null:this.formatValue(i,s)}}ColumnStore.registerColumnType(DurationColumn),DurationColumn._$name="DurationColumn";class ModelCombo extends Combo{static get $name(){return"ModelCombo"}static get type(){return"modelcombo"}get value(){const e=super.value;return this.store.getById(e)||e}set value(e){super.value=e}}ModelCombo.initClass(),ModelCombo._$name="ModelCombo";class CalendarField extends ModelCombo{static get $name(){return"CalendarField"}static get type(){return"calendarfield"}static get defaultConfig(){return{valueField:"id",displayField:"name",editable:!1,store:null,listItemTpl:e=>e.name||this.L("L{Default calendar}"),displayValueRenderer:e=>e?e.name:this.L("L{Default calendar}")}}get value(){return super.value}set value(e){e&&e.isDefault&&e.isDefault()&&(e=null),super.value=e}}CalendarField.initClass(),CalendarField._$name="CalendarField";class ResourceCalendarColumn extends(Column.mixin(AttachToProjectMixin)){static get $name(){return"ResourceCalendarColumn"}static get type(){return"resourceCalendar"}static get defaults(){return{field:"calendar",text:"Calendar",editor:{type:CalendarField.type,clearable:!0,allowInvalid:!1}}}attachToProject(e){e&&(this.defaultCalendar=e.defaultCalendar,this.editor.store=e.calendarManagerStore)}attachToResourceStore(e){super.attachToResourceStore(e),e&&e.on({name:"resourceStore",update:"onResourceUpdate",thisObj:this})}onResourceUpdate({record:e,changes:t}){const r=t[this.field];if(r){if("string"==typeof r.oldValue&&r.value.id===r.oldValue)return;this.refreshCell(e)}}renderer({value:e}){if(e===this.defaultCalendar)return"";if(e&&e.id){const t=this.editor.store.getById(e.id);return t&&t[this.editor.displayField]||""}return""}}ColumnStore.registerColumnType(ResourceCalendarColumn),ResourceCalendarColumn._$name="ResourceCalendarColumn";var ProTaskEditStm=e=>class extends(e||Base){static get $name(){return"TaskEditStm"}captureStm(){const e=this,t=e.project.getStm();e.stmInitiallyDisabled=t.disabled,e.stmInitiallyAutoRecord=t.autoRecord,e.stmInitiallyDisabled?(t.enable(),t.autoRecord=!1):(e.stmInitiallyAutoRecord&&(t.autoRecord=!1),t.isRecording&&t.stopTransaction())}startStmTransaction(){this.project.getStm().startTransaction()}commitStmTransaction(){const e=this.project.getStm();e.stopTransaction(),this.stmInitiallyDisabled&&e.resetQueue()}async rejectStmTransaction(){const e=this.project.getStm(),{client:t}=this;e.transaction.length?(t.suspendRefresh(),e.forEachStore((e=>e.beginBatch())),e.rejectTransaction(),e.forEachStore((e=>e.endBatch())),await t.resumeRefresh(!0)):e.stopTransaction()}enableStm(){this.project.getStm().enable()}disableStm(){this.project.getStm().disable()}freeStm(){const e=this,t=e.project.getStm();t.disabled=e.stmInitiallyDisabled,t.autoRecord=e.stmInitiallyAutoRecord}};class ConstraintTypePicker extends Combo{static get $name(){return"ConstraintTypePicker"}static get type(){return"constrainttypepicker"}static get configurable(){return{valueField:"id"}}updateLocalization(){super.updateLocalization(),this.store.data=this.buildStoreData()}buildStoreData(){const e=this;return[{id:"none",text:e.L("L{none}")},{id:"muststarton",text:e.L("L{muststarton}")},{id:"mustfinishon",text:e.L("L{mustfinishon}")},{id:"startnoearlierthan",text:e.L("L{startnoearlierthan}")},{id:"startnolaterthan",text:e.L("L{startnolaterthan}")},{id:"finishnoearlierthan",text:e.L("L{finishnoearlierthan}")},{id:"finishnolaterthan",text:e.L("L{finishnolaterthan}")}]}set value(e){super.value=e}get value(){const e=super.value;return"none"===e?null:e}get store(){return this._store||(this.store=new Store({data:this.buildStoreData(),allowNullId:!0})),this._store}set store(e){super.store=e}}ConstraintTypePicker.initClass(),ConstraintTypePicker._$name="ConstraintTypePicker";const buildItems=e=>e.map(((e,t)=>[t,e]));class DependencyTypePicker extends Combo{static get $name(){return"DependencyTypePicker"}static get type(){return"dependencytypepicker"}construct(e){super.construct(e),LocaleManagerSingleton.on({locale:()=>{this.items=buildItems(this.L("L{DependencyType.long}"))},thisObj:this})}get store(){return this._items||(this.items=this._items=buildItems(this.L("L{DependencyType.long}"))),super.store}set store(e){super.store=e}}DependencyTypePicker.initClass(),DependencyTypePicker._$name="DependencyTypePicker";class EffortField extends DurationField{static get $name(){return"EffortField"}static get type(){return"effort"}static get alias(){return"effortfield"}}EffortField.initClass(),EffortField._$name="EffortField";class EndDateField extends DateField{static get $name(){return"EndDateField"}static get type(){return"enddatefield"}static get alias(){return"enddate"}static get defaultConfig(){return{project:null,eventRecord:null}}get calendarProvider(){return this.eventRecord||this.project}get backShiftDate(){const e=this;let t=e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit);return t=t&&e.calendarProvider.run("skipNonWorkingTime",t,!1),t}get forwardShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit)}transformTimeValue(e){const{calendarProvider:t}=this;if(t){const r=DateHelper.clearTime(e),n=DateHelper.add(r,1,"day"),i=t.run("skipNonWorkingTime",n,!1);if(DateHelper.isValidDate(i)&&DateHelper.isEqual(i,r,"day"))return DateHelper.copyTimeValues(r,i)}return super.transformTimeValue(e)}}EndDateField.initClass(),EndDateField._$name="EndDateField";var ReadyStatePropagator=e=>class extends(e||Events(Base)){get isReadyStatePropagator(){return!0}get canSave(){return!0}requestReadyStateChange(){this.trigger("readystatechange",{canSave:this.canSave})}get widgetClass(){}};const locale$4=LocaleHelper.mergeLocales(locale$3,{ConstraintTypePicker:{none:"None",muststarton:"Must start on",mustfinishon:"Must finish on",startnoearlierthan:"Start no earlier than",startnolaterthan:"Start no later than",finishnoearlierthan:"Finish no earlier than",finishnolaterthan:"Finish no later than"},CalendarField:{"Default calendar":"Default calendar"},TaskEditorBase:{Information:"Information",Save:"Save",Cancel:"Cancel",Delete:"Delete",calculateMask:"Calculating...",saveError:"Can't save, please correct errors first"},TaskEdit:{"Edit task":"Edit task",ConfirmDeletionTitle:"Confirm deletion",ConfirmDeletionMessage:"Are you sure you want to delete the event?"},TaskEditor:{editorWidth:"34em"},SchedulerTaskEditor:{editorWidth:"32em"},SchedulerGeneralTab:{labelWidth:"6em",General:"General",Name:"Name",Resources:"Resources","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish"},GeneralTab:{labelWidth:"6.5em",General:"General",Name:"Name","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Dates:"Dates"},SchedulerAdvancedTab:{labelWidth:"13em",Calendar:"Calendar",Advanced:"Advanced","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date"},AdvancedTab:{labelWidth:"11.5em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Constraint:"Constraint",Rollup:"Rollup"},DependencyTab:{Predecessors:"Predecessors",Successors:"Successors",ID:"ID",Name:"Name",Type:"Type",Lag:"Lag",cyclicDependency:"Cyclic dependency has been detected",invalidDependency:"Invalid dependency"},NotesTab:{Notes:"Notes"},ResourcesTab:{unitsTpl:({value:e})=>e+"%",Resources:"Resources",Resource:"Resource",Units:"Units"},SchedulingModePicker:{Normal:"Normal","Fixed Duration":"Fixed Duration","Fixed Units":"Fixed Units","Fixed Effort":"Fixed Effort"},ResourceHistogram:{barTipInRange:"<b>{resource}</b> {startDate} - {endDate}<br>{allocated} of {available} allocated",barTipOnDate:"<b>{resource}</b> on {startDate}<br>{allocated} of {available} allocated"},DurationColumn:{Duration:"Duration"}});LocaleManagerSingleton.registerLocale("En",{desc:"English",locale:locale$4});class TaskEditorBase extends(ReadyStatePropagator(Popup)){static get $name(){return"TaskEditorBase"}static get configurable(){return{localizableProperties:["width"],width:{$config:{localeKey:"L{editorWidth}"}}}}static get defaultConfig(){return{title:"L{Information}",cls:"b-schedulerpro-taskeditor",closable:!0,draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",autoClose:!0,onChange:null,onCancel:null,onSave:null,autoShow:!1,scrollAction:"realign",items:null,bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{text:"L{Save}",color:"b-green",weight:100},deleteButton:{text:"L{Delete}",color:"b-gray",weight:200},cancelButton:{text:"L{Object.Cancel}",color:"b-gray",weight:300}}},durationDisplayPrecision:1,extraItems:null,tabsConfig:null,tabPanelItems:null,defaultTabs:null,calculateMask:null,calculateMaskDelay:100,localizableProperties:["calculateMask"],project:null}}processWidgetConfig(e){var t;if((null===(t=e.type)||void 0===t?void 0:t.includes("date"))&&null==e.weekStartDay&&(e.weekStartDay=this.weekStartDay),"deleteButton"===e.ref&&!this.showDeleteButton)return!1;if("tabs"===e.ref&&this.extraItems){const t={};for(const e in this.extraItems){t[e.replace("tab","Tab")]={items:Array.isArray(this.extraItems[e])?ObjectHelper.transformArrayToNamedObject(this.extraItems[e]):this.extraItems[e]}}ObjectHelper.merge(e.items,t)}return e}changeItems(e){const{tabsConfig:t,tabPanelItems:r={}}=this,n=ObjectHelper.clone(e),i=n.find((e=>"tabs"===e.ref));if(t)for(const e in t){r[e.replace("tab","Tab")]=t[e]}return ObjectHelper.merge(i.items,r),super.changeItems(n)}afterConfigure(){const e=this,t=e.widgetMap,r=e.bbar&&e.bbar.widgetMap||{},{cancelButton:n,deleteButton:i,saveButton:s}=r;null==s||s.on("click",e.onSaveClick,e),null==n||n.on("click",e.onCancelClick,e),null==i||i.on("click",e.onDeleteClick,e),Object.values(t).forEach((t=>{t.isDurationField?t.decimalPrecision=this.durationDisplayPrecision:"startDate"===t.ref||"endDate"===t.ref?t.project=this.project:"predecessorsTab"!==t.ref&&"successorsTab"!==t.ref||(t.grid.durationDisplayPrecision=this.durationDisplayPrecision),t.isReadyStatePropagator&&t.on("readystatechange",e.onReadyStateChange,e)})),t.tabs.on({beforeActiveItemChange:"onBeforeTabChange",thisObj:e})}get canSave(){let e=!0;return Object.values(this.widgetMap).forEach((t=>{t.isReadyStatePropagator&&(e=e&&t.canSave)})),e}get canCancel(){let e=!0;return Object.values(this.widgetMap).forEach((t=>{t.isReadyStatePropagator&&(e=e&&t.canCancel)})),e}async hide(){return this.detachListeners("project"),this.detachListeners("eventStore"),this._delayedAction=null,this.trigger("cancel"),super.hide()}loadEvent(e,t=!1){this.loadedRecord=e,this.callWidgetHook("loadEvent",e,t),this.detachListeners("project"),e.project.on({name:"project",beforeCommit:"onProjectBeforeCommit",dataReady:"onProjectDataReady",thisObj:this}),this.detachListeners("eventStore"),e.project.eventStore.on({name:"eventStore",remove:"onTaskRemove",thisObj:this})}callWidgetHook(e,...t){this.eachWidget((r=>{"function"==typeof r[e]&&r[e](...t)}))}onBeforeTabChange({source:e,prevActiveItem:t}){const{generalTab:r}=this.widgetMap;t===r&&e.eachWidget((e=>{e!==r&&(e.height=r.element.getBoundingClientRect().height)}),!1)}onDocumentMouseDown(e){const t=this;let r=null;if(Object.values(t.widgetMap).some((e=>e._activeCellEdit))){const{event:n}=e,{saveButton:i,cancelButton:s,deleteButton:o}=t.widgetMap,a=n.target.closest("button");if(a)switch(a){case i&&i.element:r=t.onSaveClick;break;case s&&s.element:r=t.onCancelClick;break;case o&&o.element:r=t.onDeleteClick}}t._delayedAction=r,super.onDocumentMouseDown(e)}onSaveClick(){this._delayedAction=null,this.canSave?this.trigger("save"):Toast.show({html:this.L("L{saveError}")})}onCancelClick(){this.hide()}onDeleteClick(){this._delayedAction=null,this.trigger("delete")}onPropagationRequested(){this.trigger("requestPropagation")}onReadyStateChange({source:e,canSave:t}){this.requestReadyStateChange(),e.couldSaveTitle||(e.couldSaveTitle=e.title),e.parent===this.widgetMap.tabs&&(t?(e.titleElement.classList.remove("b-invalid"),e.title=e.couldSaveTitle,e.couldSaveTitle=null):(e.titleElement.classList.add("b-invalid"),e.title="<span class='b-icon b-icon-warning'></span>"+e.couldSaveTitle))}onTaskRemove(){this.afterDelete()}onProjectBeforeCommit(){this.calculateMask&&this.mask({text:this.calculateMask,showDelay:this.calculateMaskDelay})}onProjectDataReady({records:e}){this.calculateMask&&this.unmask(),e.has(this.loadedRecord)&&this.callWidgetHook("afterProjectChange"),this._delayedAction&&this._delayedAction()}beforeSave(){this.callWidgetHook("beforeSave")}afterSave(){this.callWidgetHook("afterSave")}beforeCancel(){this.callWidgetHook("beforeCancel")}afterCancel(){this.callWidgetHook("afterCancel")}beforeDelete(){this.callWidgetHook("beforeDelete")}afterDelete(){this.callWidgetHook("afterDelete")}onInternalKeyDown(e){if("Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()){if(e.target.matches("input")){const t=Widget.fromElement(e.target);(null==t?void 0:t.internalOnChange)&&t.internalOnChange()}e.preventDefault(),this.onSaveClick()}super.onInternalKeyDown(e)}updateReadOnly(e){const{deleteButton:t,saveButton:r,cancelButton:n,tabs:i}=this.widgetMap,{items:s}=i;super.updateReadOnly(e),t&&(t.hidden=e),r&&(r.hidden=e),n&&(n.hidden=e);for(let t=0,{length:r}=s;t<r;t++)s[t].readOnly=e}}TaskEditorBase.initClass(),TaskEditorBase._$name="TaskEditorBase";var EventLoader=e=>class extends(e||Container){get project(){var e;return null===(e=this.record)||void 0===e?void 0:e.project}loadEvent(e,t){this.setRecord(e,t)}resetData(){this.record=null}beforeSave(){}afterSave(){this.resetData()}beforeCancel(){}afterCancel(){this.resetData()}beforeDelete(){}afterDelete(){this.resetData()}get widgetClass(){}};class EditorTab extends(ReadyStatePropagator(EventLoader(Container))){static get $name(){return"EditorTab"}static get type(){return"editortab"}}EditorTab._$name="EditorTab";class FormTab extends EditorTab{static get $name(){return"FormTab"}static get type(){return"formtab"}static get defaultConfig(){return{layoutStyle:{flexFlow:"row wrap",alignItems:"flex-start",alignContent:"flex-start"},autoUpdateRecord:!0}}onFieldChange({source:e,valid:t,userAction:r}){r&&(t=void 0!==t?t:"function"==typeof e.isValid?e.isValid():e.isValid)&&super.onFieldChange(...arguments)}}FormTab.initClass(),FormTab._$name="FormTab";class StartDateField extends DateField{static get $name(){return"StartDateField"}static get type(){return"startdatefield"}static get alias(){return"startdate"}static get defaultConfig(){return{project:null,eventRecord:null}}get calendarProvider(){return this.eventRecord||this.project}get backShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit)}get forwardShiftDate(){const e=this;let t=e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit);return t=t&&e.calendarProvider.run("skipNonWorkingTime",t,!0),t}transformTimeValue(e){const{calendarProvider:t}=this;if(t){const r=DateHelper.clearTime(e),n=t.run("skipNonWorkingTime",r);if(DateHelper.isValidDate(n)&&DateHelper.isEqual(n,r,"day"))return DateHelper.copyTimeValues(r,n)}return super.transformTimeValue(e)}}StartDateField.initClass(),StartDateField._$name="StartDateField";class GeneralTab extends FormTab{static get $name(){return"GeneralTab"}static get type(){return"generaltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this},items:{name:{type:"text",weight:100,required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name"},percentDone:{type:"number",weight:200,label:"L{% complete}",name:"renderedPercentDone",cls:"b-percent-done b-inline",flex:"1 0 50%",min:0,max:100},effort:{type:"effort",weight:300,label:"L{Effort}",name:"fullEffort",flex:"1 0 50%"},divider:{html:"",weight:400,dataset:{text:this.L("L{Dates}")},cls:"b-divider",flex:"1 0 100%"},startDate:{type:"startdate",weight:500,label:"L{Start}",name:"startDate",cls:"b-start-date b-inline",flex:"1 0 50%"},endDate:{type:"enddate",weight:600,label:"L{Finish}",name:"endDate",cls:"b-end-date",flex:"1 0 50%"},duration:{type:"durationfield",weight:700,label:"L{Duration}",name:"fullDuration",flex:".5 0",cls:"b-inline"}}}}loadEvent(e){const t={unit:e.durationUnit,magnitude:1},{isParent:r}=e,{duration:n,percentDone:i,startDate:s,endDate:o,effort:a}=this.widgetMap;n&&(n.disabled=r),i&&(i.disabled=r),s&&(s.step=t,s.eventRecord=e),o&&(o.step=t,o.eventRecord=e,o.disabled=r),a&&(a.unit=e.effortUnit,a.disabled=r),super.loadEvent(e)}}GeneralTab.initClass(),GeneralTab._$name="GeneralTab";const markDependencyValid=(e,t)=>{e.instanceMeta(t).valid=!0},markDependencyInvalid=(e,t)=>{e.instanceMeta(t).valid=!1},isDependencyMarkedValid=(e,t)=>!1!==e.instanceMeta(t).valid;class DependencyTab extends EditorTab{static get $name(){return"DependencyTab"}static makeDefaultConfig(e){return{direction:e,negDirection:"fromEvent"===e?"toEvent":"fromEvent",title:"fromEvent"===e?"L{Predecessors}":"L{Successors}",layoutStyle:{flexFlow:"column nowrap"},items:{grid:{type:"grid",weight:100,flex:"1 1 auto",emptyText:"",features:{group:!1},columns:[{localeClass:this,text:"L{ID}",flex:1,editor:!1,htmlEncode:!1,hidden:!0,renderer({record:t,row:r,grid:n}){let i;if(isDependencyMarkedValid(t,n)){const r=t[e];i=!r||r.hasGeneratedId?"*":r.id}else r.addCls("b-invalid"),i='<div class="b-icon b-icon-warning"></div>';return i}},{localeClass:this,text:"L{Name}",field:e,flex:5,renderer:({value:e})=>e&&e.name+(e.hasGeneratedId?"":` (${e.id})`),finalizeCellEdit:"up.finalizeLinkedTaskCellEdit",editor:{type:"modelcombo",listItemTpl:e=>`${e.name} (${e.id})`,displayField:"name",valueField:"id",editable:!1,allowInvalid:!0}},{localeClass:this,text:"L{Type}",field:"type",flex:3,sortable:!1,editor:"dependencytypepicker",renderer({value:e}){return this.L("L{DependencyType.long}")[e]}},{localeClass:this,text:"L{Lag}",type:"duration",field:"fullLag",flex:2,editor:{allowNegative:!0}}],disableGridRowModelWarning:!0,asyncEventSuffix:"PreCommit"},toolbar:{type:"toolbar",weight:200,flex:"0 0 auto",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"b-icon b-icon-add"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0}}}}}}async finalizeLinkedTaskCellEdit({grid:e,value:t,record:r}){const{project:n}=e.store.masterStore;switch(await n.validateDependency(t,r.toEvent,r.type,r)){case 0:return!0;case 1:return"L{DependencyTab.cyclicDependency}"}return"L{DependencyTab.invalidDependency}"}afterConstruct(){super.afterConstruct();const e=this,t=e.addButton=e.widgetMap.add,r=e.removeButton=e.widgetMap.remove,n=e.grid=e.widgetMap.grid;t&&t.on("click",e.onAddClick,e),r&&r.on("click",e.onRemoveClick,e),n.on({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:e})}updateReadOnly(e){const{add:t,remove:r}=this.widgetMap;super.updateReadOnly(...arguments),t.hidden=r.hidden=e}get taskCombo(){const{grid:e}=this,t=e&&e.columns.get(this.direction);return t&&t.editor}loadEvent(e){const t=this,{grid:r}=t,n=!r.store.isChained,i=!n&&e!==t.record;super.loadEvent(e);const s=t.taskCombo,{dependencyStore:o,eventStore:a}=t.project;n?(t.depStoreGeneration=o.storage.generation,t.eventStoreGeneration=a.storage.generation,r.store=o.makeChained((e=>e[t.negDirection]===t.record),null),s.store=a.makeChained((e=>e!==t.record),null,{doRelayToMaster:[],excludeCollapsedRecords:!1}),s.store.filterBy((e=>!r.store.find((r=>r[t.direction]===e)))),s.on({thisObj:t,change:"onGridCellEditChange"})):((i||o.storage.generation!==t.depStoreGeneration)&&(r.store.fillFromMaster(),t.depStoreGeneration=o.storage.generation),(i||a.storage.generation!==t.eventStoreGeneration)&&(s.store.fillFromMaster(),t.eventStoreGeneration=a.storage.generation)),t.requestReadyStateChange()}async insertNewDependency(){const e=this,{grid:t}=e,r=t.store,n=e.project.dependencyStore,[i]=r.insert(0,{type:DependencyType.EndToStart,lag:0,lagUnit:TimeUnit.Day,[e.negDirection]:e.record});return e.depStoreGeneration=n.storage.generation,t.features.cellEdit.startEditing({field:e.direction,id:i.id}),markDependencyInvalid(i,t),i}onAddClick(){this.insertNewDependency()}onRemoveClick(){const e=this,t=e.grid.selectedRecords;e.project.dependencyStore.remove(t),e.grid.selectedRecords=null,e.taskCombo.store.fillFromMaster(),e.removeButton.disable()}onGridSelectionChange({selection:e}){e&&e.length&&!this.up((e=>e.readOnly))?this.removeButton.enable():this.removeButton.disable()}clearActiveEditorErrors(){const e=this._activeCellEdit;e&&e.column.field===this.direction&&e.editor.inputField.clearError()}onGridCellEditChange(){this.clearActiveEditorErrors()}onGridStartCellEdit({editorContext:e}){const t=this,r=t._editingDependency=e.record,{grid:n}=t,i=t.direction;t._activeCellEdit=e,e.column.field===i&&(isDependencyMarkedValid(r,n)?t.clearActiveEditorErrors():r[i]?e.editor.inputField.setError("L{DependencyTab.cyclicDependency}"):e.editor.inputField.setError("L{DependencyTab.invalidDependency}"))}async onGridFinishCellEdit({editorContext:e}){const t=this,{record:r,column:n}=e,{grid:i,direction:s}=t;n.field===s?(markDependencyValid(r,i),t.taskCombo.store.fillFromMaster()):t.redrawDependencyRow(r),t._activeCellEdit=t._editingDependency=null,t.requestReadyStateChange()}afterCancel(){this._activeCellEdit&&this.grid.features.cellEdit.cancelEditing()}onGridCancelCellEdit(e){const t=this,r=t._editingDependency;r&&(r[t.direction]||(markDependencyInvalid(r,t.grid),t.redrawDependencyRow(r)),t._activeCellEdit=t._editingDependency=null),t.requestReadyStateChange()}redrawDependencyRow(e){const{grid:t}=this,r=t.rowManager.getRowById(e);if(r){t.store.indexOf(e)>=0&&r.render(t.store.indexOf(e),e)}}get canSave(){const{grid:e}=this;return e.store.reduce(((t,r)=>t&&isDependencyMarkedValid(r,e)),!0)}}DependencyTab._$name="DependencyTab";class SuccessorsTab extends DependencyTab{static get $name(){return"SuccessorsTab"}static get type(){return"successorstab"}static get defaultConfig(){return Object.assign(this.makeDefaultConfig("toEvent"),{cls:"b-successors-tab"})}}SuccessorsTab.initClass(),SuccessorsTab._$name="SuccessorsTab";class PredecessorsTab extends DependencyTab{static get $name(){return"PredecessorsTab"}static get type(){return"predecessorstab"}static get defaultConfig(){return Object.assign(this.makeDefaultConfig("fromEvent"),{cls:"b-predecessors-tab"})}}PredecessorsTab.initClass(),PredecessorsTab._$name="PredecessorsTab";class ResourcesTab extends EditorTab{static get $name(){return"ResourcesTab"}static get type(){return"resourcestab"}static get defaultConfig(){return{title:"L{Resources}",cls:"b-resources-tab",layoutStyle:{flexFlow:"column nowrap"},items:{grid:{type:"grid",weight:100,flex:"1 1 auto",columns:[{localeClass:this,text:"L{Resource}",field:"resource",flex:7,renderer:({value:e})=>(null==e?void 0:e.name)||"",editor:{type:"modelcombo",displayField:"name",valueField:"id",editable:!1}},{localeClass:this,text:"L{Units}",field:"units",flex:3,renderer:e=>this.L("L{unitsTpl}",e),editor:{type:"numberfield",min:0,max:100,step:10}}],disableGridRowModelWarning:!0,asyncEventSuffix:"PreCommit"},toolbar:{type:"toolbar",weight:200,flex:"0 0 auto",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"b-icon b-icon-add"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0}}}}}}afterConstruct(){super.afterConstruct();const e=this,t=e.addButton=e.widgetMap.add,r=e.removeButton=e.widgetMap.remove,n=e.grid=e.widgetMap.grid;null==t||t.on("click",e.onAddClick,e),null==r||r.on("click",e.onRemoveClick,e),n.on({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:e})}updateReadOnly(e){const{add:t,remove:r}=this.widgetMap;super.updateReadOnly(...arguments),t.hidden=r.hidden=e}get resourceCombo(){var e;const t=null===(e=this.grid)||void 0===e?void 0:e.columns.get("resource");return null==t?void 0:t.editor}loadEvent(e){const t=this,{grid:r}=t,n=!r.store.isChained,i=!n&&e!==t.record;super.loadEvent(e);const{resourceCombo:s}=t,{assignmentStore:o,resourceStore:a}=t.project;e.isTask||r.columns.get("units").hide(),n?(t.assignmentStoreGeneration=o.storage.generation,t.resourceStoreGeneration=a.storage.generation,r.store=o.makeChained((e=>t.record&&e.event===t.record),null),s.store=a.makeChained((e=>t.record&&!t.record.isAssignedTo(e)||!t.activeAssignment||t.activeAssignment.resource===e))):((i||o.storage.generation!==t.assignmentStoreGeneration)&&r.store.fillFromMaster(),(i||a.storage.generation!==t.resourceStoreGeneration)&&s.store.fillFromMaster())}get activeAssignment(){return this.grid.features.cellEdit.activeRecord}async insertNewAssignment(){const e=this,{project:t,grid:r}=e,n=t.assignmentStore,[i]=n.insert(0,{event:e.record,resource:null,units:100});return e.assignmentStoreGeneration=n.storage.generation,r.features.cellEdit.startEditing({field:"resource",id:i.id}),i}beforeSave(){this.pruneInvalidAssignments()}onAddClick(){this.insertNewAssignment()}onRemoveClick(){const{grid:e}=this;e.store.remove(e.selectedRecords),e.selectedRecords=null,this.removeButton.disable()}onGridSelectionChange({selection:e}){this.removeButton.disabled=!(null==e?void 0:e.length)}onGridStartCellEdit({editorContext:e}){"resource"===e.column.field&&(this.resourceCombo.store.fillFromMaster(),this._editingAssignment=e.record,this._activeCellEdit=e)}onGridFinishCellEdit(){this._activeCellEdit=this._editingAssignment=null}onGridCancelCellEdit(){this._activeCellEdit=this._editingAssignment=null}pruneInvalidAssignments(){const{store:e}=this.grid;e.remove(e.query((e=>!e.isValid)))}}ResourcesTab.initClass(),ResourcesTab._$name="ResourcesTab";class SchedulingModePicker extends Combo{static get $name(){return"SchedulingModePicker"}static get type(){return"schedulingmodecombo"}buildStoreData(){return[{id:SchedulingMode.Normal,text:this.L("L{Normal}")},{id:SchedulingMode.FixedDuration,text:this.L("L{Fixed Duration}")},{id:SchedulingMode.FixedUnits,text:this.L("L{Fixed Units}")},{id:SchedulingMode.FixedEffort,text:this.L("L{Fixed Effort}")}]}get store(){return this._store||(this.store=new Store({data:this.buildStoreData()})),this._store}set store(e){super.store=e}updateLocalization(){super.updateLocalization(),this.store.data=this.buildStoreData()}}SchedulingModePicker.initClass(),SchedulingModePicker._$name="SchedulingModePicker";class AdvancedTab extends FormTab{static get $name(){return"AdvancedTab"}static get type(){return"advancedtab"}static get defaultConfig(){return{localeClass:this,title:"L{Advanced}",cls:"b-advanced-tab",defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",weight:100,ref:"",name:"calendar",label:"L{Calendar}",flex:"1 0 50%",cls:"b-inline"},manuallyScheduledField:{type:"checkbox",weight:200,name:"manuallyScheduled",label:"L{Manually scheduled}",flex:"1 0 50%"},schedulingModeField:{type:"schedulingmodecombo",weight:300,name:"schedulingMode",label:"L{Scheduling mode}",flex:"1 0 50%",cls:"b-inline"},effortDrivenField:{type:"checkbox",weight:400,name:"effortDriven",label:"L{Effort driven}",flex:"1 0 50%"},divider:{weight:500,html:"",dataset:{text:this.L("L{Constraint}")},cls:"b-divider",flex:"1 0 100%"},constraintTypeField:{type:"constrainttypepicker",weight:600,name:"constraintType",label:"L{Constraint type}",pickerWidth:"14em",clearable:!0,flex:"1 0 50%",cls:"b-inline"},constraintDateField:{type:"date",weight:700,name:"constraintDate",label:"L{Constraint date}",flex:"1 0 50%",cls:"b-inline"},rollupField:{type:"checkbox",weight:800,name:"rollup",label:"L{Rollup}",flex:"1 0 50%",cls:"b-inline"}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get effortDrivenField(){return this.widgetMap.effortDrivenField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}get rollupField(){return this.widgetMap.rollupField}get schedulingModeField(){return this.widgetMap.schedulingModeField}loadEvent(e){const t=!this.record,{calendarField:r}=this;r&&t&&(r.store=e.project.calendarManagerStore),super.loadEvent(e)}}AdvancedTab.initClass(),AdvancedTab._$name="AdvancedTab";class NotesTab extends FormTab{static get $name(){return"NotesTab"}static get type(){return"notestab"}static get defaultConfig(){return{title:'<i class="b-icon b-icon-note" data-btip="L{Notes}"></i>',cls:"b-notes-tab",layoutConfig:{alignItems:"flex-start",alignContent:"stretch"},items:{noteField:{weight:100,type:"textareafield",cls:"b-taskeditor-notes-field",name:"note"}}}}}NotesTab.initClass(),NotesTab._$name="NotesTab";class GanttTaskEditor extends TaskEditorBase{static get type(){return"gantttaskeditor"}static get $name(){return"GanttTaskEditor"}static get defaultConfig(){return{items:[{type:"tabpanel",defaultType:"formtab",ref:"tabs",flex:"1 0 100%",layoutConfig:{alignItems:"stretch",alignContent:"stretch"},items:{generalTab:{type:"generaltab",weight:100},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},resourcesTab:{type:"resourcestab",weight:400},advancedTab:{type:"advancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}]}}processWidgetConfig(e){return"tabs"===e.ref&&this.extraItems&&VersionHelper.deprecate("Gantt","5.0.0","`extraItems` config is deprecated, in favor of `items` config. Please see https://bryntum.com/docs/gantt/#guides/upgrades/4.0.0.md for more information."),super.processWidgetConfig(e)}startConfigure(e){e.tabsConfig&&VersionHelper.deprecate("Gantt","5.0.0","`tabsConfig` config is deprecated, in favor of `items` config. Please see https://bryntum.com/docs/gantt/#guides/upgrades/4.0.0.md for more information."),super.startConfigure(e)}}GanttTaskEditor.initClass(),GanttTaskEditor._$name="GanttTaskEditor";class SchedulerGeneralTab extends FormTab{static get $name(){return"SchedulerGeneralTab"}static get type(){return"schedulergeneraltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this,weight:10},items:{nameField:{type:"text",required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name",weight:100},resourcesField:{type:"combo",label:"L{Resources}",name:"resources",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,multiSelect:!0,cls:"b-resources",weight:200},startDateField:{type:"datetime",label:"L{Start}",name:"startDate",cls:"b-start-date",flex:"1 0 100%",weight:300,dateField:{type:"startdatefield"}},endDateField:{type:"datetime",label:"L{Finish}",name:"endDate",cls:"b-end-date",flex:"1 0 100%",weight:400,dateField:{type:"enddatefield"}},durationField:{type:"durationfield",label:"L{Duration}",name:"fullDuration",flex:"1 0 50%",cls:"b-duration b-inline",weight:500},percentDoneField:{type:"number",label:"L{% complete}",name:"renderedPercentDone",cls:"b-percent-done",flex:"1 0 50%",min:0,max:100,weight:600}}}}loadEvent(e){const t={unit:e.durationUnit,magnitude:1},{isParent:r,project:n}=e,{durationField:i,percentDoneField:s,startDateField:o,endDateField:a,resourcesField:l}=this.widgetMap;this.record;i&&(i.disabled=r),s&&(s.disabled=r),o&&(o.dateField.eventRecord=e,DateHelper.compareUnits(t.unit,"hour")>0?o.dateField.step=t:o.timeField.step=t),a&&(a.dateField.eventRecord=e,DateHelper.compareUnits(t.unit,"hour")>0?a.dateField.step=t:a.timeField.step=t,a.disabled=r),l&&(l.multiSelect=!n.eventStore.usesSingleAssignment,l.store=new n.resourceStore.constructor({chained:!0,masterStore:n.resourceStore,chainedFilterFn:e=>!e.isSpecialRow})),super.loadEvent(...arguments)}onFieldChange({source:e,valid:t,userAction:r,value:n}){if(r&&t){const{eventStore:t}=this.record,r="resources"===e.name&&0===n.length&&this.autoUpdateRecord&&t.removeUnassignedEvent;r&&(t.removeUnassignedEvent=!1),super.onFieldChange(...arguments),r&&(t.removeUnassignedEvent=!0)}}beforeSave(){0===this.record.resources.length&&this.record.eventStore.removeUnassignedEvent&&this.record.remove(),super.beforeSave()}}SchedulerGeneralTab.initClass(),SchedulerGeneralTab._$name="SchedulerGeneralTab";class SchedulerAdvancedTab extends FormTab{static get $name(){return"SchedulerAdvancedTab"}static get type(){return"scheduleradvancedtab"}static get defaultConfig(){return{title:'<i class="b-icon b-icon-advanced" data-btip="L{Advanced}"></i>',cls:"b-advanced-tab",defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",name:"calendar",label:"L{Calendar}",weight:100},constraintTypeField:{type:"constrainttypepicker",name:"constraintType",label:"L{Constraint type}",clearable:!0,weight:200},constraintDateField:{type:"date",name:"constraintDate",label:"L{Constraint date}",weight:300},manuallyScheduledField:{type:"checkbox",name:"manuallyScheduled",label:"L{Manually scheduled}",weight:400}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}loadEvent(e){this.record;const{calendarField:t}=this;t&&(t.store=e.project.calendarManagerStore,t.hidden=!e.project.calendarManagerStore.count),super.loadEvent(...arguments)}}SchedulerAdvancedTab.initClass(),SchedulerAdvancedTab._$name="SchedulerAdvancedTab";class SchedulerTaskEditor extends TaskEditorBase{static get type(){return"schedulertaskeditor"}static get $name(){return"SchedulerTaskEditor"}static get defaultConfig(){return{items:[{type:"tabpanel",defaultType:"formtab",ref:"tabs",flex:"1 0 100%",layoutConfig:{alignItems:"stretch",alignContent:"stretch"},items:{generalTab:{type:"schedulergeneraltab",weight:100},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},advancedTab:{type:"scheduleradvancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}]}}processWidgetConfig(e){return"tabs"===e.ref&&this.extraItems&&VersionHelper.deprecate("SchedulerPro","5.0.0","`extraItems` config is deprecated, in favor of `items` config. Please see https://bryntum.com/docs/gantt/#guides/upgrades/4.0.0.md for more information."),super.processWidgetConfig(e)}startConfigure(e){e.tabsConfig&&VersionHelper.deprecate("SchedulerPro","5.0.0","`tabsConfig` config is deprecated, in favor of `items` config. Please see https://bryntum.com/docs/gantt/#guides/upgrades/4.0.0.md for more information."),super.startConfigure(e)}}SchedulerTaskEditor.initClass(),SchedulerTaskEditor._$name="SchedulerTaskEditor";class Timeline extends SchedulerBase{static get $name(){return"Timeline"}static get type(){return"timeline"}static get defaultConfig(){return{height:"13em",eventLayout:"pack",barMargin:1,forceFit:!0,timeAxis:{autoAdjust:!1},readOnly:!0,zoomOnMouseWheel:!1,zoomOnTimeAxisDoubleClick:!1,eventColor:null,eventStyle:null,rowHeight:48,displayDateFormat:"L",features:{cellEdit:!1,cellMenu:!1,columnAutoWidth:!1,columnLines:!1,columnPicker:!1,columnReorder:!1,columnResize:!1,contextMenu:!1,eventContextMenu:!1,eventDrag:!1,eventDragCreate:!1,eventEdit:!1,eventFilter:!1,eventMenu:!1,eventResize:!1,eventTooltip:!1,group:!1,headerMenu:!1,regionResize:!1,scheduleContextMenu:!1,scheduleMenu:!1,scheduleTooltip:!1,sort:!1,timeAxisHeaderMenu:!1,timeRanges:{showCurrentTimeLine:!0}},resources:[{id:1}],columns:[]}}static get delayable(){return{fillFromTaskStore:100}}construct(e){const t=this;if(t.startDateLabel=document.createElement("label"),t.startDateLabel.className="b-timeline-startdate",t.endDateLabel=document.createElement("label"),t.endDateLabel.className="b-timeline-enddate","project"in e){if(!e.project)throw new Error("You need to configure the Timeline with a Project");e.project instanceof SchedulerProProjectMixin&&(t.taskStore=e.project.eventStore,e.project.isInitialCommitPerformed||e.project.on({refresh({isInitialCommit:e}){e&&this.fillFromTaskStore()},once:!0,thisObj:this}),delete e.project)}super.construct(e),t.features.timeRanges&&(t.features.timeRanges.store=new Store),t.fillFromTaskStore.now(),t.taskStore.on({refreshPreCommit:t.fillFromTaskStore,changePreCommit:t.onTaskStoreChange,thisObj:t}),t.on({resize:t.onSizeChanged,thisObj:t}),t.bodyContainer.appendChild(t.startDateLabel),t.bodyContainer.appendChild(t.endDateLabel),LocaleManagerSingleton.on({locale:"onLocaleChange",thisObj:t})}onSizeChanged({width:e,oldWidth:t}){this.suspendRefresh(),this.updateRowHeight(),this.resumeRefresh(),e!==t&&this.fitTimeline()}updateRowHeight(){this.rowHeight=this.bodyContainer.offsetHeight}fitTimeline(){this.eventStore.count>0&&this.zoomToFit({leftMargin:50,rightMargin:50}),this.updateStartEndLabels()}updateStartEndLabels(){const e=this;e.startDateLabel.innerHTML=e.getFormattedDate(e.startDate),e.endDateLabel.innerHTML=e.getFormattedDate(e.endDate)}async onTaskStoreChange({action:e,record:t,records:r,changes:n,isCollapse:i}){const s=this,o=s.eventStore;let a;switch(e){case"add":r.forEach((e=>{e.showInTimeline&&(o.add(s.cloneTask(e)),a=!0)}));break;case"remove":i||r.forEach((e=>{e.showInTimeline&&(o.remove(e.id),a=!0)}));break;case"removeall":s.fillFromTaskStore();break;case"update":{const e=t;if(n.showInTimeline)e.showInTimeline?o.add(s.cloneTask(e)):o.remove(o.getById(e.id)),a=!0;else if(e.showInTimeline){const t=o.getById(e.id);if(t){const r=Object.assign({},e.data);delete r.expanded,delete r.duration,delete r.durationUnit,delete r.calendar,t.set(r),a=!0}}break}}a&&s.fitTimeline()}cloneTask(e){return{id:e.id,resourceId:1,startDate:e.startDate,endDate:e.endDate,name:e.name}}render(){super.render(),this.updateRowHeight()}async fillFromTaskStore(){const e=this,t=[];e.taskStore.traverse((r=>{r.showInTimeline&&r.isScheduled&&t.push(e.cloneTask(r))})),e.suspendRefresh(),e.events=t,await e.project.commitAsync(),e.isDestroyed||(e.resumeRefresh(!0),e.fitTimeline())}onLocaleChange(){this.updateStartEndLabels()}}function cls(e){return"b-task-percent-bar"+(e[0]?"-"+e[0]:"")}Timeline.initClass(),Timeline._$name="Timeline";class PercentBar extends InstancePlugin{static get $name(){return"PercentBar"}static get configurable(){return{allowResize:!0,showPercentage:!0}}static get pluginConfig(){return{chain:["onPaint","onTaskDataGenerated","onEventDataGenerated"]}}onPaint(){const e=this,{client:t}=e;e.drag&&e.drag.destroy(),e.drag=new DragHelper({name:"percentBarHandle",mode:"translateX",targetSelector:`${t.eventSelector}:not(.${t.eventCls}-parent) .b-task-percent-bar-handle`,dragThreshold:1,listeners:{beforeDragStart:"onBeforeDragStart",dragStart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",thisObj:e}}),e.detachListeners("view"),e.client.on({name:"view",[t.scheduledEventName+"mouseenter"]:"onTimeSpanMouseEnter",[t.scheduledEventName+"mouseleave"]:"onTimeSpanMouseLeave",thisObj:e})}updateAllowResize(e){this.client.element.classList[e?"remove":"add"](cls`drag-disabled`)}updateShowPercentage(e){this.client.element.classList[e?"add":"remove"](cls`show-percentage`)}doDestroy(){this.drag&&this.drag.destroy(),super.doDestroy()}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}cleanup(e){const t=this;e.element.closest(t.client.eventSelector).classList.remove(cls`resizing`),t.client.element.classList.remove(cls`resizing-task`),t.isMouseInsideEvent||(t.handle.remove(),t.handle=null)}appendDOMConfig(e,t){!e.isEvent&&!e.isTask||e.isMilestone||this.disabled||t.unshift({className:cls`outer`,dataset:{taskBarFeature:"percentBar"},children:[{className:cls``,dataset:{percent:e.renderedPercentDone},style:{width:e.percentDone+"%"}}]})}onEventDataGenerated(e){this.appendDOMConfig(e.eventRecord,e.children)}onTaskDataGenerated(e){this.appendDOMConfig(e.task,e.children)}onTimeSpanMouseEnter(e){const t=this,r=e[t.client.scheduledEventName+"Record"];if(t.drag.context)r===t.drag.context.taskRecord&&(t.isMouseInsideEvent=!0);else{const n=e[t.client.scheduledEventName+"Element"],i=DomSync.getChild(n,t.client.scheduledEventName);t.handle||(t.handle=DomHelper.createElement({parent:i,className:cls`handle`,style:{left:r.percentDone+"%"},dataset:{percent:r.percentDone}})),t.isMouseInsideEvent=!0}}onTimeSpanMouseLeave(){const e=this;!e.drag.context&&e.handle&&(e.handle.remove(),e.handle=null),e.isMouseInsideEvent=!1}onBeforeDragStart({source:e,context:t}){const r=DomSync.getChild(t.element.parentElement,"percentBar"),n=r.firstElementChild,i=n.offsetWidth,s=r.offsetWidth,o=this.client.resolveEventRecord(t.element);e.minX=-i,e.maxX=s-i,Object.assign(t,{percentBar:n,initialX:i,outerWidth:s,taskRecord:o})}onDragStart({context:e}){const{client:t}=this;e.element.closest(t.eventSelector).classList.add(cls`resizing`),t.element.classList.add(cls`resizing-task`),e.element.retainElement=!0}onDrag({context:e}){const t=Math.round((e.initialX+e.newX)/e.outerWidth*100);e.percent=e.percentBar.dataset.percent=e.element.dataset.percent=t,e.percentBar.style.width=t+"%"}onDragAbort({context:e}){e.percentBar.style.width=e.taskRecord.percentDone+"%",this.cleanup(e)}onDrop({context:e}){e.taskRecord.percentDone=e.percent,e.element.style.cssText=`left: ${e.percent}%`,this.cleanup(e)}get featureClass(){}}PercentBar._$name="PercentBar",GridFeatureManager.registerFeature(PercentBar,!1,"SchedulerPro"),GridFeatureManager.registerFeature(PercentBar,!0,"Gantt");class ResourceNonWorkingTime extends ResourceTimeRangesBase{static get $name(){return"ResourceNonWorkingTime"}static get defaultConfig(){return{idPrefix:"resourcenonworkingtime",rangeCls:"b-sch-resourcetimerange b-sch-resourcenonworkingtime"}}static get properties(){return{resourceMap:new Map}}construct(){super.construct(...arguments),this.client.timeAxis.on({name:"timeAxis",reconfigure:"onTimeAxisReconfigure",prio:100,thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),e&&e.on({name:"resourceStore",changePreCommit:"onResourceChange",thisObj:this})}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e),e&&e.on({name:"calendarManagerStore",changePreCommit:"onCalendarChange",thisObj:this})}onTimeAxisReconfigure(){this.resourceMap.clear()}onResourceChange({action:e,records:t,record:r,changes:n}){if("update"===e){const e=n.calendar;!e||"string"==typeof e.oldValue&&e.value.id===e.oldValue||(this.resourceMap.delete(r.id),this.scheduler.currentOrientation.refreshRow(r))}"remove"===e&&t.forEach((e=>this.resourceMap.delete(e.id))),"removeall"===e&&this.resourceMap.clear()}onCalendarChange({action:e,records:t,record:r,changes:n}){}getEventsToRender(e,t){const{resourceMap:r,scheduler:n}=this;if(e.calendar){if(!r.has(e.id)){const t=e.calendar.getNonWorkingTimeRanges(n.startDate,n.endDate).map(((t,r)=>new ResourceTimeRangeModel({id:`r${e.id}i${r}`,startDate:t.startDate,endDate:t.endDate,resourceId:e.id,isNonWorking:!0})));r.set(e.id,t)}t.push(...r.get(e.id))}return t}shouldInclude(e){return e.isNonWorking}}ResourceNonWorkingTime.featureClass="",ResourceNonWorkingTime._$name="ResourceNonWorkingTime",GridFeatureManager.registerFeature(ResourceNonWorkingTime,!1,"SchedulerPro");class TaskEdit extends(InstancePlugin.mixin(Delayable,ProTaskEditStm)){static get $name(){return"TaskEdit"}static get pluginConfig(){return{chain:["getEventMenuItems","onEventEnterKey"],assign:["editEvent"]}}static get defaultConfig(){return{triggerEvent:"eventdblclick",editorClassMap:{[ProjectType.SchedulerBasic]:"schedulertaskeditor",[ProjectType.SchedulerPro]:"schedulertaskeditor",[ProjectType.Gantt]:"gantttaskeditor"},editorClass:null,editorConfig:null,showDeleteButton:!0,confirmDelete:!0,saveAndCloseOnEnter:!0,weekStartDay:null}}static get configurable(){return{items:null}}construct(e,t){e.taskEdit=this,super.construct(e,ObjectHelper.assign({weekStartDay:e.weekStartDay},t)),e.on({[this.triggerEvent]:"onActivateEditor",readOnly:"onClientReadOnlyToggle",dragCreateEnd:"onDragCreateEnd",thisObj:this})}doDestroy(){var e;this.detachFromProject(),null===(e=this.editor)||void 0===e||e.destroy(),this.deleteConfirmationPromise&&MessageDialogSingleton.hide(),super.doDestroy()}onClientReadOnlyToggle({readOnly:e}){this.editor&&(this.editor.readOnly=e)}get scheduler(){return this.client}getElementFromTaskRecord(e,t){return this.client.getElementFromEventRecord(e,t)}scrollEventIntoView(e,t){this.client.scrollResourceEventIntoView(t,e)}get isValid(){return this.editor.eachWidget((e=>!!(!0===e.isValid||e.hidden||e.disabled||e instanceof Field&&!e.name)||!1!==e.isValid),!0)}get project(){return this.scheduler.project}attachToProject(){this.detachFromProject(),this.project.on({name:"project",loadstart:()=>this.save(),dataReady:"onDataReady",thisObj:this})}detachFromProject(){this.detachListeners("project")}onDataReady(){const{record:e}=this;(null==e?void 0:e.project)?this.load(e,!0):this.save()}get isEditing(){return!!this._editing}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:r}){this.editEvent(e,t,r)}async editEvent(e,t=null,r=null){const n=this,{scheduler:i}=n;var s;(n._editing&&n.cancel(),n._canceling&&await n._canceling,t)||(t=e.resource||(null===(s=e.resources)||void 0===s?void 0:s[0]));if(!n.disabled){const{taskStore:s}=i;let o;n._editing=!0,n.captureStm(),n.startStmTransaction(),i.project.suspendAutoSync(),"function"==typeof e&&(e=e()),e.isOccurrence||s.includes(e)||(o=!0,s.add(e),t&&i.assignmentStore.assignEventToResource(e,t),await i.project.commitAsync()),!r&&s.includes(e)&&t&&await n.scrollEventIntoView(e,t);const a=r||DomHelper.down(n.getElementFromTaskRecord(e,t),i.eventInnerSelector),l=n.getEditor(e);!1!==i.trigger("beforeTaskEdit",{taskEdit:n,taskRecord:e,taskElement:a})?(i.element.classList.add("b-taskeditor-editing"),i.trigger("beforeTaskEditShow",{taskEdit:n,taskRecord:e,taskElement:a,editor:l}),n.load(e),n.getEditor().widgetMap.deleteButton&&(n.getEditor().widgetMap.deleteButton.hidden=i.readOnly||o||!n.showDeleteButton),n.attachToProject(),a?await l.showBy({target:a,anchor:!0,offset:-5}):await l.showBy({target:i.element,anchor:!1,align:"c-c"})):(await n.rejectStmTransaction(),n.disableStm(),n.freeStm(),n._editing=!1)}}getEditor(e=this.record){var t;const r=this,n=((null==e?void 0:e.project)||r.project).getType(),i=(null===(t=r.editorClass)||void 0===t?void 0:t.type)||r.editorClassMap[n]||r.editorClassMap[ProjectType.Unknown]||"schedulertaskeditor";var s;r.editor&&r.editor.type===i||(null===(s=r.editor)||void 0===s||s.destroy(),r.editor=Widget.create(ObjectHelper.merge({type:i,eventEditFeature:r,weekStartDay:r.weekStartDay,saveAndCloseOnEnter:r.saveAndCloseOnEnter,showDeleteButton:r.showDeleteButton,owner:r.client,project:r.project,durationDisplayPrecision:r.client.durationDisplayPrecision,tabPanelItems:r.items,listeners:{cancel:"onCancel",delete:"onDelete",save:"onSave",thisObj:r},tabsConfig:r.tabsConfig},r.editorConfig)));return r.editor.readOnly=r.client.readOnly,r.editor}load(e,t){const r=this,n=r.getEditor(e);r._loading=!0,r.record=e,n.loadEvent(e,t),r._loading=!1}async save(){const e=this,{scheduler:t}=e;if(e._editing){const r=e.getEditor();if(!e.isValid||!1===e.trigger("beforeTaskSave",{taskRecord:e.record,editor:r}))return;e.detachFromProject(),r.beforeSave(),e.commitStmTransaction(),e.freeStm(),e._editing=!1,r.hide().then((()=>r.afterSave())),t.project.resumeAutoSync(!0),t.element.classList.remove("b-taskeditor-editing"),e.trigger("afterTaskSave",{taskRecord:e.record,editor:r}),t.trigger("afterTaskEdit",{taskRecord:e.record,editor:r})}}async doCancel(){const e=this,{scheduler:t}=e;if(e._editing){e._editing=!1,e.detachFromProject();const r=e.record,n=e.project,i=e.getEditor();if(i.beforeCancel(),e.isDestroyed)return;if(await e.rejectStmTransaction(),e.isDestroyed)return;if(e.disableStm(),await n.propagateAsync(),e.isDestroyed)return;e.freeStm(),i.afterCancel(),t.project.resumeAutoSync(!1),e.scheduler.element.classList.remove("b-taskeditor-editing"),t.trigger("taskEditCanceled",{taskRecord:r,editor:i}),t.trigger("afterTaskEdit",{taskRecord:r,editor:i})}}async cancel(){const e=this;return e._canceling||(e._canceling=e.doCancel().finally((()=>e._canceling=void 0)))}async delete(){const e=this,t=e.getEditor();!1!==e.trigger("beforeTaskDelete",{taskRecord:e.record,editor:t})&&(e.detachFromProject(),t.beforeDelete(),e.record.remove(),e.freeStm(),await e.project.commitAsync(),e.isDestroyed||(e.scheduler.project.resumeAutoSync(!0),e._editing=!1,t.hide(),t.afterDelete(),e.scheduler.element.classList.remove("b-taskeditor-editing"),e.scheduler.trigger("afterTaskEdit",{editor:t})))}onSave(){this.requestAnimationFrame((()=>this.save()))}onCancel(){this.requestAnimationFrame((()=>this.cancel()))}async onDelete(){const e=this;if(e.confirmDelete){const{editor:t}=e,r=t.autoClose;t.autoClose=!1,e.deleteConfirmationPromise=MessageDialogSingleton.confirm({title:"L{TaskEdit.ConfirmDeletionTitle}",message:"L{TaskEdit.ConfirmDeletionMessage}"});const n=await e.deleteConfirmationPromise;t.autoClose=r,e.deleteConfirmationPromise=null,n===MessageDialogSingleton.yesButton&&e.delete()}else e.requestAnimationFrame((()=>e.delete()))}onDragCreateEnd({newEventRecord:e,resourceRecord:t,proxyElement:r}){this.disabled||(this.scheduler.onEventCreated(e),this.editEvent(e,t))}getEventMenuItems({eventRecord:e,resourceRecord:t,items:r}){this.scheduler.readOnly||(r.editEvent={text:"L{Edit task}",localeClass:this,icon:"b-icon b-icon-edit",weight:-200,disabled:this.disabled,onItem:()=>this.editEvent(e,t)})}onEventEnterKey({assignmentRecord:e,eventRecord:t}){e?this.editEvent(t,e.resource):t&&this.editEvent(t,t.resource)}trigger(e,t){if(/task/i.test(e)){const r=this.scheduler.trigger(...arguments),n=e.replace(/task/,"event").replace(/Task/,"Event");t.eventRecord=t.taskRecord,t.eventRecords=[t.taskRecord];const i=this.scheduler.trigger(n,t);return r&&i}return super.trigger(...arguments)}}TaskEdit._$name="TaskEdit",GridFeatureManager.registerFeature(TaskEdit,!0,"SchedulerPro");class SchedulerProBase extends SchedulerBase{static get $name(){return"SchedulerProBase"}static get type(){return"schedulerprobase"}static get configurable(){return{projectModelClass:ProjectModel$1}}static get isSchedulerPro(){return!0}toggleEmptyText(){const e=this;e.bodyContainer&&DomHelper.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.project.isLoadingOrSyncing))}get taskStore(){return this.project.eventStore}internalAddEvent(e,t,r){if(!this.taskEdit||!this.taskEdit.isEditing)return super.internalAddEvent(e,t,r);this.on({aftertaskedit:()=>super.internalAddEvent(e,t,r),once:!0})}}SchedulerProBase.initClass(),VersionHelper.setVersion("schedulerpro","4.0.2"),SchedulerProBase._$name="SchedulerProBase";class ScaleColumn extends Column{static get $name(){return"ScaleColumn"}static get type(){return"scale"}static get isScaleColumn(){return!0}static get fields(){return["scalePoints"]}static get defaults(){return{text:" ",width:40,minWidth:40,cellCls:"b-scale-cell",editor:!1,sortable:!1,groupable:!1,filterable:!1,scalePoints:[{value:4},{value:8,text:8}]}}onDestroy(){this.scaleWidget.destroy()}set width(e){super.width=e,this.scaleWidget.width=e}get width(){return super.width}applyValue(e,t,r){return"scalePoints"===t&&(this.scaleWidget[t]=r),super.applyValue(...arguments)}get scaleWidget(){const e=this;return e._scaleWidget||(e._scaleWidget=new Scale({owner:e.grid,appendTo:Widget.floatRoot,cls:"b-hide-offscreen",align:"right",scalePoints:e.scalePoints,monitorResize:!1}),Object.defineProperties(e._scaleWidget,{width:{get:()=>e.width,set(t){this.element.style.width=t+"px",this._width=e.width}},height:{get(){return this._height},set(e){this.element.style.height=e+"px",this._height=e}}}),e._scaleWidget.width=e.width),e._scaleWidget}renderer({cellElement:e}){const{scaleWidget:t}=this;t.height=this.grid.rowHeight,t.refresh();const r=t.element.cloneNode(!0);r.removeAttribute("id"),r.classList.remove("b-hide-offscreen"),e.innerHTML="",e.appendChild(r)}}ColumnStore.registerColumnType(ScaleColumn),ScaleColumn._$name="ScaleColumn";class ResourceHistogram extends SchedulerProBase{static get $name(){return"ResourceHistogram"}static get type(){return"resourcehistogram"}static get defaultConfig(){return{rowHeight:50,effortUnit:TimeUnit.Hour,barTextEffortUnit:null,barTipEffortUnit:null,showMaxEffort:!0,showBarText:!1,showBarTip:!1,series:{maxEffort:{type:"outline",field:"maxEffort"},effort:{type:"bar",field:"effort"}},features:{eventContextMenu:!1,eventFilter:!1,headerContextMenu:!1,scheduleTooltip:!1,scheduleMenu:!1,cellMenu:!1,nonWorkingTime:!0},getRectClass:null,getBarTip:null,getBarText:null,fixedRowHeight:!0}}construct(e){const t=this;t.allocationReportByResource=new Map,super.construct(e),t.scheduleRefreshRows=t.createOnFrame(t.refreshRows,[],t,!0),t.horizontal.refreshResourcesWhenReady=t.horizontal.onAssignmentStoreChange=t.horizontal.renderer=function(){},t.rowManager.on({beforeRowHeight:"onBeforeRowHeight",thisObj:t}),t.timeAxis.on({endReconfigure:"onTimeAxisEndReconfigure",thisObj:this})}onDestroy(){this.histogramWidget.destroy()}updateProject(e){const t=this;t.detachListeners("resourceHistogramProject"),t._project=e,e.on({name:"resourceHistogramProject",startApplyResponse:"onProjectStartApplyResponse",refresh:"internalOnProjectRefresh",thisObj:t}),this.store=e.resourceStore}scheduleRefreshRows(){}getEventsToRender(){}getRowHeight(){return this.rowHeight}get scaleColumn(){return this.columns.query((e=>e.isScaleColumn))[0]}get scalePoints(){return this._scalePoints}set scalePoints(e){const{project:t,histogramWidget:r,scaleColumn:n}=this,i=e[e.length-1],{value:s,unit:o}=i;this.scaleUnit=o,this._scalePoints=e;let a=s;if(n){const{scaleWidget:e}=n;a+=e.scaleMaxPadding*s}r.topValue=t.convertDuration(a,o,TimeUnit.Millisecond),n&&(n.scalePoints=e)}buildScalePointText(e){return`${e.value}${DateHelper.getShortNameOfUnit(e.unit)}`}generateScalePoints(){const{project:e,timeAxis:t}=this,r=[];let n,{unit:i,increment:s}=t;1===s&&(i=DateHelper.getSmallerUnit(i),s=Math.round(e.convertDuration(s,t.unit,i)));for(const e of[7,5,4,3,2])if(!(s%e)){n=s/e;break}n||(n=s);for(let e=n;e<=s;e+=n)r.push({value:e});const o=r[r.length-1];return o.unit=i,o.text=this.buildScalePointText(o),r}updateViewPreset(e){const t=this;t._updatingViewPreset=!0,super.updateViewPreset(...arguments),t._updatingViewPreset=!1,t.project.isInitialCommitPerformed&&t.isPainted&&t.onTimeAxisEndReconfigure()}buildTicksIdentifier(){const e=this,t=e.project.getGraph();return e.ticksIdentifier||(e.ticksIdentifier=t.addIdentifier(CalculatedValueGen.new())),e.ticksIdentifier.writeToGraph(t,new BaseCalendarMixin({unspecifiedTimeIsWorking:!1,intervals:e.timeAxis.ticks.map((e=>({startDate:e.startDate,endDate:e.endDate,isWorking:!0})))})),e.collectTicksWidth(),e.ticksIdentifier}collectTicksWidth(){const{ticks:e}=this.timeAxis,t=e[0].endDate-e[0].startDate,r={0:t};let n=t,i=!0;for(let s=1,{length:o}=e;s<o;s++){const o=e[s],a=o.endDate-o.startDate;t!==a&&(i=!1),n+=a,r[s]=a}if(i)this.ticksWidth=null;else{const t={};for(let i=0,{length:s}=e;i<s;i++)t[i]=r[i]/n;this.ticksWidth=t}}resumeRefresh(e){super.resumeRefresh(!1),!this.refreshSuspended&&e&&(this.rowManager.topRow?this.refreshWithTransition():this.rowManager.reinitialize())}internalOnProjectRefresh(){const e=this;e.ticksIdentifier||e.onTimeAxisEndReconfigure(),e.resumeRefresh(!e.rowManager.topRow)}get columns(){return super.columns}set columns(e){const t=this;super.columns=e,t.isDestroying||(t.timeAxisColumn.renderer=t.renderResourceHistogram,t.timeAxisColumn.cellCls="b-resourcehistogram-cell",t.columns.rootNode.insertChild({type:"scale"},t.timeAxisColumn))}onProjectStartApplyResponse(){this.suspendRefresh()}get histogramWidget(){const e=this;if(!e._histogramWidget){const t=e.series;!e.showMaxEffort&&t.maxEffort&&(t.maxEffort=!1),e._histogramWidget=new Histogram({owner:e,appendTo:document.body,cls:"b-hide-offscreen b-resourcehistogram-histogram",height:e.rowHeight,width:e.timeAxisColumn?e.timeAxisColumn.width:0,omitZeroHeightBars:!0,data:[],getRectClass:e.getRectClass,getBarText:e.getBarText,getBarTip:e.getBarTip,series:t})}return e._histogramWidget}getRectClass(e,t,r,n){if("effort"===e.id)switch(!0){case r.isOverallocated:return"b-overallocated";case r.isUnderallocated:return"b-underallocated"}return""}getEffortText(e,t){const{scaleUnit:r,project:n}=this;t=t||r;const i=DateHelper.getShortNameOfUnit(t),s=n.convertDuration(e,TimeUnit.Millisecond,t);return`${parseFloat(s.toFixed(1))}${i}`}getBarTipEffortUnit(e,t,r,n){const{effortUnit:i,barTipEffortUnit:s,timeAxis:o}=this,a=s||i;return DateHelper.compareUnits(o.unit,a)<0?o.unit:a}getBarTip(e,t,r,n){const i=this.owner,{showBarTip:s,timeAxis:o}=i;let a="";if(s&&r.effort){const e=i.getBarTipEffortUnit(...arguments),t=i.getEffortText(r.effort,e),n=i.getEffortText(r.maxEffort,e);let s="L",l=i.L("L{barTipInRange}");0==DateHelper.compareUnits(o.unit,TimeUnit.Day)?l=i.L("L{barTipOnDate}"):DateHelper.compareUnits(o.unit,TimeUnit.Second)<=0?s="HH:mm:ss A":DateHelper.compareUnits(o.unit,TimeUnit.Hour)<=0&&(s="LT"),a=l.replace("{resource}",r.resource.name).replace("{startDate}",DateHelper.format(r.tick.startDate,s)).replace("{endDate}",DateHelper.format(r.tick.endDate,s)).replace("{allocated}",t).replace("{available}",n)}return a}getBarTextEffortUnit(e,t,r,n){const{effortUnit:i,barTextEffortUnit:s,timeAxis:o}=this,a=s||i;return DateHelper.compareUnits(o.unit,a)<0?o.unit:a}getBarText(e,t){const{showBarText:r}=this.owner;let n="";if(r&&e.effort){const t=this.owner.getBarTextEffortUnit(...arguments);n=this.owner.getEffortText(e.effort,t)}return n}get showBarText(){return this._showBarText}set showBarText(e){this._showBarText=e,this.scheduleRefreshRows()}get showBarTip(){return this._showBarTip}set showBarTip(e){this._showBarTip=e,this.scheduleRefreshRows()}get showMaxEffort(){return this._showMaxEffort}set showMaxEffort(e){const t=this;if(t._showMaxEffort=e,t._histogramWidget){const{series:r}=t._histogramWidget;e?"object"==typeof e?r.maxEffort=e:"object"==typeof t._seriesMaxEffort?r.maxEffort=t._seriesMaxEffort:(r.maxEffort={type:"outline",field:"maxEffort"},r.maxEffort.id="maxEffort"):r.maxEffort&&(t._seriesMaxEffort=r.maxEffort,delete r.maxEffort),t.scheduleRefreshRows()}}onTimeAxisEndReconfigure(){if(!this._updatingViewPreset){const{unit:e,increment:t}=this.timeAxis;e===this._lastTimeAxisUnit&&t===this._lastTimeAxisIncrement||(this._lastTimeAxisUnit=e,this._lastTimeAxisIncrement=t,this._generatedScalePoints=this.scalePoints=this.generateScalePoints()),this.buildTicksIdentifier()}}onBeforeRowHeight({height:e}){if(this._timeAxisColumn){const{histogramWidget:t}=this;t.height=e,t.onElementResize(t.element)}}onTimeAxisViewModelUpdate(){const{histogramWidget:e}=this;e.width=this.timeAxisViewModel.totalSize,e.onElementResize(e.element)}renderResourceAllocationInfo(e,t){if(this.ticksWidth)for(let t=0,{length:r}=e;t<r;t++)e[t].width=this.ticksWidth[t];const{histogramWidget:r}=this;r.data=e,r.refresh();const n=r.element.cloneNode(!0);n.removeAttribute("id"),n.classList.remove("b-hide-offscreen"),t.innerHTML="",t.appendChild(n)}renderRows(){return!this.ticksIdentifier&&this.project.isInitialCommitPerformed&&(this.onTimeAxisEndReconfigure(),this.timeView.startDate&&this.timeView.endDate||(this.timeView.range={startDate:this.startDate,endDate:this.endDate})),super.renderRows([...arguments])}buildResourceAllocationReport(e){return ResourceAllocationInfo.new({resource:e,ticks:this.ticksIdentifier})}renderResourceHistogram({grid:e,cellElement:t,record:r}){if(e.project.isInitialCommitPerformed&&!r.isSpecialRow){const{allocationReportByResource:n}=e,i=n.get(r);if(i)i.allocation&&(i.graph?e.renderResourceAllocationInfo(i.allocation,t):n.delete(r));else{const t=e.project.getGraph(),i=e.buildResourceAllocationReport(r),{observers:s,entities:o}=r;n.set(r,i),t.addEntity(i),o.add(i),s.add(t.observe((function*(){return yield i.$.allocation}),(t=>{if(!e.isDestroying){const n=e.getCell({id:r.id,columnId:e.timeAxisColumn.id});e.renderResourceAllocationInfo(t,n)}})))}}}updateLocalization(){this._generatedScalePoints===this.scalePoints&&this.scalePoints&&this.scalePoints.forEach((e=>{e.text&&e.unit&&(e.text=this.buildScalePointText(e))})),super.updateLocalization(...arguments)}}ResourceHistogram.initClass(),ResourceHistogram._$name="ResourceHistogram";class EventResize$1 extends EventResize{static get $name(){return"EventResize"}async internalUpdateRecord(e,t){return t.run("calculateProjectedDuration",e.startDate,e.endDate)!==t.duration&&super.internalUpdateRecord(e,t)}}EventResize$1._$name="EventResize",GridFeatureManager.registerFeature(EventResize$1,!0,"SchedulerPro");class SchedulerPro extends SchedulerProBase{static get $name(){return"SchedulerPro"}static get type(){return"schedulerpro"}}SchedulerPro.initClass(),SchedulerPro._$name="SchedulerPro";class AddNewColumn extends Column{static get $name(){return"AddNewColumn"}static get type(){return"addnew"}static get defaults(){return{text:"L{New Column}",cls:"b-new-column-column",draggable:!1,sortable:!1,exportable:!1,field:null,editor:null}}get columnCombo(){const e=this,t=e.grid.columns;return e._columnCombo||(e._columnCombo=new Combo({owner:e.grid,cls:"b-new-column-combo",placeholder:e.L("L{New Column}"),triggers:!1,autoExpand:!0,store:e.ganttColumnStore,displayField:"text",monitorResize:!1,picker:{align:{align:"t0-b0",axisLock:!0},minWidth:200,onItem({record:r}){const n=new r.value({region:e.region},t);t.insert(t.indexOf(e),n),n.element.focus()}},syncInputFieldValue(){this.input.value=""},listeners:{keydown({event:e}){e.stopImmediatePropagation()}}}))}get ganttColumnStore(){return new Store({data:Object.values(ColumnStore.columnTypes).reduce(((e,t)=>(t.$meta.fields.exposedData||t.exposeProperties({}),t.isGanttColumn&&t.text&&e.push({id:t.type,text:t.optionalL(t.text),value:t}),e)),[]),filters:[e=>!this.grid.columns.some((t=>t.constructor===e.value))],sorters:[{field:"text"}]})}headerRenderer({column:e,headerElement:t,isExport:r}){if(!r){const{columnCombo:r}=e;r.render(t),r.picker.forElement=t}}onKeyDown(e){"Enter"===e.key&&this.columnCombo.focus()}updateLocalization(){this._columnCombo&&(this._columnCombo.destroy(),this._columnCombo=null),super.updateLocalization()}}ColumnStore.registerColumnType(AddNewColumn),AddNewColumn._$name="AddNewColumn";class CalendarPicker extends Combo{static get $name(){return"CalendarPicker"}static get type(){return"calendarpicker"}refreshCalendars(e){this.store.data=e.map((e=>({id:e.id,text:e.name})))}get store(){return this._store||(this.store=new Store),this._store}set store(e){super.store=e}get value(){return super.value}set value(e){e&&(e.isDefault&&e.isDefault()?e=null:e.id&&(e=e.id)),super.value=e}}CalendarPicker.initClass(),CalendarPicker._$name="CalendarPicker";class CalendarColumn extends Column{static get $name(){return"CalendarColumn"}static get type(){return"calendar"}static get isGanttColumn(){return!0}static get defaults(){return{field:"calendar",text:"L{Calendar}",editor:{type:CalendarPicker.type,clearable:!0,allowInvalid:!1}}}afterConstruct(){const e=this;super.afterConstruct();const t=e.grid.project;e.defaultCalendar=t.defaultCalendar,e.refreshCalendars(),t.calendarManagerStore.on({changePreCommit:e.refreshCalendars,refresh:e.refreshCalendars,thisObj:e})}refreshCalendars(){const e=this.grid.project;this.editor.refreshCalendars(e.calendarManagerStore.getRange())}renderer({value:e}){const t=this;if(e===t.defaultCalendar)return"";if(e&&e.id){const r=t.editor.store.getById(e.id);return r&&r[t.editor.displayField]||""}return""}}ColumnStore.registerColumnType(CalendarColumn),CalendarColumn._$name="CalendarColumn";class GanttDateColumn extends DateColumn{static get isGanttColumn(){return!0}static get defaults(){return{instantUpdate:!0,width:130,step:null,format:"ll"}}construct(e,t){const r=this;r.gantt=t.grid,super.construct(e,t),r.format?r.explicitFormat=!0:r.gantt.on({displayDateFormatChange({format:e}){r.explicitFormat||r.set("format",e)}})}set format(e){this.explicitFormat=!0,this.set("format",e)}get format(){return this.explicitFormat&&this.data.format||this.gantt.displayDateFormat}}GanttDateColumn._$name="GanttDateColumn";class ConstraintDateColumn extends GanttDateColumn{static get $name(){return"ConstraintDateColumn"}static get type(){return"constraintdate"}static get defaults(){return{field:"constraintDate",text:"L{Constraint Date}",width:146}}}ColumnStore.registerColumnType(ConstraintDateColumn),ConstraintDateColumn._$name="ConstraintDateColumn";class ConstraintTypeColumn extends Column{static get $name(){return"ConstraintTypeColumn"}static get type(){return"constrainttype"}static get isGanttColumn(){return!0}static get defaults(){return{field:"constraintType",text:"L{Constraint Type}",width:146,editor:{type:ConstraintTypePicker.type,clearable:!0,allowInvalid:!1},filterable:{filterField:{type:"constrainttypepicker"}}}}afterConstruct(){const e=this;super.afterConstruct(),e.grid.on({startCellEdit:e.onStartCellEdit,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),FunctionHelper.createSequence(e.editor.updateLocalization,e.onEditorLocaleChange,e)}onStartCellEdit({editorContext:{editor:e,record:t}}){e.inputField instanceof ConstraintTypePicker&&(e.inputField.store.filter((e=>t.run("isConstraintTypeApplicable",e.id))),this._filterDetacher=()=>e.inputField.store.clearFilters())}onDoneCellEdit(){this._filterDetacher&&this._filterDetacher()}renderer({value:e}){const t=null!=e&&"none"!==e&&this.editor.store.getById(e);return t&&t.text||""}onEditorLocaleChange(){this.grid.refreshColumn(this)}}ColumnStore.registerColumnType(ConstraintTypeColumn),ConstraintTypeColumn._$name="ConstraintTypeColumn";class DeadlineDateColumn extends GanttDateColumn{static get $name(){return"DeadlineDateColumn"}static get type(){return"deadlinedate"}static get defaults(){return{field:"deadlineDate",text:"L{Deadline}",width:146}}}ColumnStore.registerColumnType(DeadlineDateColumn),DeadlineDateColumn._$name="DeadlineDateColumn";class EarlyEndDateColumn extends GanttDateColumn{static get $name(){return"EarlyEndDateColumn"}static get type(){return"earlyenddate"}static get defaults(){return{field:"earlyEndDate",text:"L{Early End}"}}canEdit(e){return!1}}ColumnStore.registerColumnType(EarlyEndDateColumn),EarlyEndDateColumn._$name="EarlyEndDateColumn";class EarlyStartDateColumn extends GanttDateColumn{static get $name(){return"EarlyStartDateColumn"}static get type(){return"earlystartdate"}static get defaults(){return{field:"earlyStartDate",text:"L{Early Start}"}}canEdit(e){return!1}}ColumnStore.registerColumnType(EarlyStartDateColumn),EarlyStartDateColumn._$name="EarlyStartDateColumn";class EffortColumn extends DurationColumn{static get $name(){return"EffortColumn"}static get type(){return"effort"}static get defaults(){return{field:"fullEffort",text:"L{Effort}"}}get defaultEditor(){return{type:EffortField.type,name:this.field}}canEdit(e){return e.isLeaf}}ColumnStore.registerColumnType(EffortColumn),EffortColumn._$name="EffortColumn";class EndDateColumn extends GanttDateColumn{static get $name(){return"EndDateColumn"}static get type(){return"enddate"}static get defaults(){return{field:"endDate",text:"L{Finish}"}}get defaultEditor(){const e=super.defaultEditor;return e.type="enddate",e}get editor(){let e=this.data.editor;const t=e&&!(e instanceof Widget);return e=super.editor,e&&t&&(e.project=this.gantt.project),e}canEdit(e){return e.isLeaf}}ColumnStore.registerColumnType(EndDateColumn),EndDateColumn._$name="EndDateColumn";class LateEndDateColumn extends GanttDateColumn{static get $name(){return"LateEndDateColumn"}static get type(){return"lateenddate"}static get defaults(){return{field:"lateEndDate",text:"L{Late End}"}}canEdit(e){return!1}}ColumnStore.registerColumnType(LateEndDateColumn),LateEndDateColumn._$name="LateEndDateColumn";class LateStartDateColumn extends GanttDateColumn{static get $name(){return"LateStartDateColumn"}static get type(){return"latestartdate"}static get defaults(){return{field:"lateStartDate",text:"L{Late Start}"}}canEdit(e){return!1}}ColumnStore.registerColumnType(LateStartDateColumn),LateStartDateColumn._$name="LateStartDateColumn";class ManuallyScheduledColumn extends CheckColumn{static get $name(){return"ManuallyScheduledColumn"}static get type(){return"manuallyscheduled"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",text:"L{Manually scheduled}"}}}ColumnStore.registerColumnType(ManuallyScheduledColumn),ManuallyScheduledColumn._$name="ManuallyScheduledColumn";class MilestoneColumn extends CheckColumn{static get $name(){return"MilestoneColumn"}static get type(){return"milestone"}static get isGanttColumn(){return!0}static get defaults(){return{field:"milestone",text:"L{Milestone}"}}}ColumnStore.registerColumnType(MilestoneColumn),MilestoneColumn._$name="MilestoneColumn";class NameColumn extends TreeColumn{static get $name(){return"NameColumn"}static get type(){return"name"}static get isGanttColumn(){return!0}static get defaults(){return{htmlEncode:!1,width:200,field:"name",text:"L{Name}"}}}ColumnStore.registerColumnType(NameColumn),NameColumn._$name="NameColumn";class NoteColumn extends Column{static get $name(){return"NoteColumn"}static get type(){return"note"}static get isGanttColumn(){return!0}static get defaults(){return{field:"note",text:"L{Note}",width:150,editor:{type:"textareafield",inline:!1}}}renderer({value:e}){return(e||"").trim()}get disableHtmlEncode(){return!0}}ColumnStore.registerColumnType(NoteColumn),NoteColumn._$name="NoteColumn";class PercentDoneColumn extends NumberColumn{static get $name(){return"PercentDoneColumn"}static get type(){return"percentdone"}static get isGanttColumn(){return!0}static get fields(){return["showCircle"]}static get defaults(){return{field:"percentDone",text:"L{% Done}",unit:"%",step:1,min:0,max:100,width:90}}construct(e){super.construct(...arguments),this.showCircle&&(this.htmlEncode=!1)}defaultRenderer({record:e}){const t=e.renderedPercentDone;if(this.showCircle){const e=.8*this.grid.rowHeight;return{className:"b-percentdone-circle",style:{animationDelay:`-${t-.1}s`,width:e,height:e},dataset:{value:t}}}return t+this.unit}canEdit(e){return e.isLeaf}}ColumnStore.registerColumnType(PercentDoneColumn),PercentDoneColumn._$name="PercentDoneColumn";const toggleTypes={from:[2,3,0,1],to:[1,0,3,2]},buildDependencySuffixRe=()=>new RegExp(`(${dependencyTypes.join("|")})?((?:[+-])\\d+[a-z]*)?`,"i");let dependencyTypes=["SS","SF","FS","FF"],dependencySuffixRe=buildDependencySuffixRe();class DependencyField extends Combo{static get $name(){return"DependencyField"}static get type(){return"dependencyfield"}static get configurable(){return{listCls:"b-predecessor-list",displayField:"name",valueField:"name",picker:{floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,minHeight:161,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},delimiter:";",dependencyStore:null,otherSide:null,ourSide:null}}construct(e){const t=this,{ourSide:r,otherSide:n}=e;t.dependencies=new Collection({extraKeys:n}),t.startCollection=new Collection({extraKeys:n}),super.construct(e),t.delimiterRegEx=new RegExp(`\\s*${t.delimiter}\\s*`),LocaleManagerSingleton.on({locale(){dependencyTypes=t.L("L{DependencyType.short}"),dependencySuffixRe=buildDependencySuffixRe(),t.syncInputFieldValue()},thisObj:t})}internalOnInput(){this.isValid?(this.clearError(),TextField.prototype.internalOnInput.call(this)):this.setError("L{invalidDependencyFormat}")}onInternalKeyDown(e){const{key:t}=e;"Enter"!==t&&super.onInternalKeyDown&&super.onInternalKeyDown(e),this.pickerVisible&&"ArrowDown"===t&&this.filterField.focus()}onTriggerClick(){this.pickerVisible?super.onTriggerClick():this.doFilter(this.filterInput?this.filterInput.value:null)}set store(e){const t=this;(e=e.makeChained((e=>!t.record||e.id!==t.record.id))).tree=!1,super.store=e}get store(){return super.store}changePicker(e,t){const r=this,n=r.input,i=r.filterField||(r.filterField=new TextField({cls:"b-dependency-list-filter",owner:r,clearable:!0,placeholder:"Filter",triggers:{filter:{cls:"b-icon b-icon-filter",align:"start"}},listeners:{input({value:e}){r.input=s,r.filterList(e),r.input=n},clear(){r.input=s,r.filterList(),r.input=n}}})),s=r.filterInput=i.input,o=DependencyField.reconfigure(t,e?Objects.merge({owner:r,store:r.store,cls:"b-dependency-list "+r.listCls,itemTpl:r.listItemTpl,forElement:r[r.pickerAlignElement],align:{anchor:r.overlayAnchor,target:r[r.pickerAlignElement]},navigator:{keyEventTarget:s,processEvent:e=>{if("Escape"!==e.key)return e;r.hidePicker()}},onItem:r.onPredecessorClick.bind(r),getItemClasses:function(e){const t=List.prototype.getItemClasses.call(this,e),n=r.dependencies.getBy(r.otherSide+"Event",e);return t+(n?" b-selected b-"+n.getConnectorString(1).toLowerCase():"")}},e):null,r);return o?i.render(o.contentElement):r.destroyProperties("filterField"),o}showPicker(e){this.store.fillFromMaster(),super.showPicker(e)}onPickerShow({source:e}){const t=this,r=t.filterField,n=t.input;e.minWidth=t[t.pickerAlignElement].offsetWidth,e.contentElement.insertBefore(r.element,e.contentElement.firstChild),t.input=t.filterInput,super.onPickerShow(),t.input=n}listItemTpl(e){return`<div class="b-predecessor-item-text">${e.name}</div>\n            <div class="b-sch-box b-from" data-side="from"></div>\n            <div class="b-sch-box b-to" data-side="to"></div>`}get isValid(){return Boolean(!this.task||this.parseDependencies(this.input.value))}set value(e){const t=this,r=t.dependencies,n=t.startCollection;if("string"==typeof e){if(t.input.value=e,!(e=t.parseDependencies(e)))return void t.syncInvalid();for(let r=0;r<e.length;r++){const i=new t.dependencyStore.modelClass(e[r]);let s=n.getBy(t.otherSide,i.fromEvent);s&&(s=s.copy(s.id),s.type=i.type,s.fullLag=i.fullLag),e[r]=s||i}}else t.startCollection.clear(),t.startCollection.values=e;r.clear(),r.values=e,t.inputting||t.syncInputFieldValue()}get value(){return this.dependencies.values}get inputValue(){return this.constructor.predecessorsToString(this.dependencies.values,this.otherSide,this.delimiter)}onPredecessorClick({source:e,item:t,record:r,event:n}){const i=this,s=i.dependencies,o=n.target.closest(".b-sch-box"),a=o&&o.dataset.side;let l=s.getBy(i.otherSide+"Event",r);if(t.dataset.noselect=!0,l&&!o)s.remove(l);else if(l){const{id:e,type:t}=l;l=l.copy({id:e,type:toggleTypes[a][t]},{skipFieldIdentifiers:!0}),l[i.otherSide+"Event"]=r,s.add(l)}else s.add(i.dependencyStore.createRecord({[i.otherSide+"Event"]:r,[i.ourSide+"Event"]:i.task},!0));i.syncInputFieldValue(),e.refresh()}static predecessorsToString(e,t,r=";"){const n=e=>{const r=e[t+"Event"];return r&&r.isModel?r.id:r||""};if(e&&e.length){return e.sort(((e,t)=>n(e)-n(t))).map((e=>`${n(e)}${Dependencies.getLocalizedDependencyType(e.getConnectorString())}${e.getLag()}`)).join(r)}return""}get task(){var e;return null===(e=this.owner)||void 0===e?void 0:e.record}parseDependencies(e){const t=this,r=t.grid,n=t.task,i=t.store,s=t.dependencyStore,o=e.split(t.delimiterRegEx),a=s.modelClass,l=[];for(let e=0;e<o.length;e++){const s=o[e];if(s){let e,o=s.length+1,c=null;for(;o&&!c;o--)e=s.substr(0,o),c=i.getById(e);if(!c)return null;const d=s.substr(o+1),u={[t.otherSide+"Event"]:c,[t.ourSide+"Event"]:n,type:a.Type.EndToStart};if(d.length){const e=dependencySuffixRe.exec(d);if(!e||!e[1]&&!e[2])return null;if(e[1]&&(u.type=dependencyTypes.indexOf(e[1].toUpperCase())),e[2]){const t=DateHelper.parseDuration(e[2],!0,r.timeAxis.unit);u.lag=t.magnitude,u.lagUnit=t.unit}}l.push(u)}}return l}}DependencyField.initClass(),DependencyField._$name="DependencyField";const hasNoProject=e=>!e.project,depIsValid=e=>e,checkNext=async(e,t,r)=>{const n=e.shift();n&&(r.push(await t.getProject().isValidExistingDependency(n)),await checkNext(e,t,r))};class DependencyColumn extends(Delayable(Column)){static get $name(){return"DependencyColumn"}static get type(){return"dependency"}static get fields(){return[{name:"delimiter",defaultValue:";"}]}static get defaults(){return{htmlEncode:!1,width:120,renderer({record:e}){return DependencyField.predecessorsToString(e[this.field],"predecessors"===this.field?"from":"to",this.delimiter)}}}afterConstruct(){super.afterConstruct()}async finalizeCellEdit({grid:e,record:t,inputField:r,value:n,oldValue:i,editorContext:s}){if(t&&n){n=n.slice();const{dataField:o}=s.editor,a=n.filter(hasNoProject),l=[];await checkNext(a,e.dependencyStore,l);const c=l.every(depIsValid);if(c){const e="set"+StringHelper.capitalize(o);t[e]?t[e](n):t[o]=n}else r.value=i,WidgetHelper.toast(s.column.L("L{Invalid dependency}"));return c}}get defaultEditor(){const e=this,{grid:t}=e,r="predecessors"===e.field;return{type:"dependencyfield",grid:t,name:e.field,delimiter:e.delimiter,ourSide:r?"to":"from",otherSide:r?"from":"to",store:t.eventStore||t.taskStore,dependencyStore:t.dependencyStore}}}ColumnStore.registerColumnType(DependencyColumn),DependencyColumn._$name="DependencyColumn";class PredecessorColumn extends DependencyColumn{static get $name(){return"PredecessorColumn"}static get type(){return"predecessor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Predecessors}",field:"predecessors"}}}ColumnStore.registerColumnType(PredecessorColumn),PredecessorColumn._$name="PredecessorColumn";class AssignmentsManipulationModel extends Model{static get fields(){return[{name:"assignment",type:"object"},{name:"resource",type:"object"},{name:"event",type:"object"},{name:"units",type:"number",defaultValue:0}]}get name(){return this.resource?this.resource.name:""}get assigned(){return this.event&&this.firstStore.projectEvent===this.event}set assigned(e){const t=this;e?t.assigned||t.set({event:t.firstStore.projectEvent,units:t.units||100}):t.set({event:null,units:0})}}AssignmentsManipulationModel._$name="AssignmentsManipulationModel";const{defineParser:defineParser$1,alt:alt$1,seq:seq$1,string:string$1,regexp:regexp$1,succeed:succeed$1,red:red$1,isSuccess:isSuccess$1}=Parser,resourceNamePEG=defineParser$1(red$1(regexp$1("[^\\[\\,]+"),(e=>({name:e.trim(),units:100,match:e})))),integerPEG=defineParser$1(red$1(regexp$1("[0-9\\s]+"),(e=>({value:e.split(/\s*/).join(""),match:e})))),decimalSeparatorPEG=defineParser$1(red$1(alt$1(string$1("."),string$1(",")),(e=>({value:e,match:e})))),unitsNumberPEG=defineParser$1(alt$1(red$1(seq$1((()=>integerPEG),(()=>decimalSeparatorPEG),(()=>integerPEG)),((e,t,r)=>({value:Number(`${e.value}.${r.value}`),match:[e.match,t.match,r.match].join("")}))),red$1(seq$1((()=>decimalSeparatorPEG),(()=>integerPEG)),((e,t)=>({value:Number("0."+t.value),match:[e.match,t.match].join("")}))),red$1((()=>integerPEG),(e=>({value:Number(""+e.value),match:e.match}))))),unitsPersentagePEG=defineParser$1(alt$1(red$1(seq$1((()=>unitsNumberPEG),regexp$1("\\s*\\%")),((e,t)=>({value:e.value,match:[e.match,t].join("")}))),red$1((()=>unitsNumberPEG),(e=>({value:e.value,match:e.match}))))),unitsDesignationPEG=defineParser$1(red$1(seq$1(regexp$1("\\s*\\[\\s*"),(()=>unitsPersentagePEG),regexp$1("\\s*\\]")),((e,t,r)=>({units:t.value,match:[e,t.match,r].join("")})))),commaPEG=defineParser$1(red$1(regexp$1("\\s*,\\s*"),(e=>({value:e,match:e})))),raPEG=defineParser$1(alt$1(seq$1((()=>resourceNamePEG),(()=>unitsDesignationPEG),alt$1(seq$1((()=>commaPEG),(()=>raPEG)),succeed$1(""))),seq$1((()=>resourceNamePEG),alt$1(seq$1((()=>commaPEG),(()=>raPEG)),succeed$1(""))))),parse=e=>{let t=!1,r=[],n="";raPEG(e,(e=>{if(isSuccess$1(e)){const[,i,s]=e;i.length>r.length&&(r=i,n=s,t=!0)}}));let i=0;return!!t&&{rest:n,assignments:r.reduce(((e,t)=>{let r;return"object"==typeof t&&(Object.prototype.hasOwnProperty.call(t,"name")?(r=Object.assign({position:i},t),e.push(r)):(r=e[e.length-1],Object.prototype.hasOwnProperty.call(t,"units")&&(r.units=t.units),r.match+=t.match),i+=t.match.length),e}),[])}},compose=(e,t=!1)=>{let r="";return e.assignments&&(r+=e.assignments.reduce(((e,{name:r,units:n,match:i})=>e+=i&&t?i:(e.length?", ":"")+`${r} [${n}%]`),r)),e.rest&&(r+=e.rest),t||(r=r.trim()),r},normalize=e=>compose(parse(e));var Parser$1={parse:parse,compose:compose,normalize:normalize};const{compose:compose$1}=Parser$1;class AssignmentsManipulationStore extends Store{static get defaultConfig(){return{modelClass:AssignmentsManipulationModel,storeId:"assignmentsmanipulation",storage:{extraKeys:["resource"]},callOnFunctions:!0,projectEvent:null,floatAssignedResources:!0,liveFloatAssignedResources:!1}}afterConfigure(){const e=this;super.afterConfigure(),e.addSorter({fn:e.defaultSort.bind(e)})}get projectEvent(){return this._projectEvent}set projectEvent(e){const t=this;if(e!=t._projectEvent||e&&e.generation!==t._projectEventGeneration)if(t._projectEvent=e,t._projectEventGeneration=e.generation,e){t.fillFromMaster();const{assignments:r}=e,n=[];r.forEach((r=>{const i=t.find((e=>e.resource===r.resource));i&&(i.set({assignment:r,event:e,units:r.units||0}),n.push(i))})),t.originalAssignmentManipulationRecords=n,t.acceptChanges(),t.sort()}else t.removeAll()}get floatAssignedResources(){return this._floatAssignedResources}set floatAssignedResources(e){const t=this;e!==t.floatAssignedResources&&(t._floatAssignedResources=e,t.sort())}get assignmentStore(){return this.projectEvent&&this.projectEvent.getAssignmentStore()||null}get resourceStore(){return this.projectEvent&&this.projectEvent.getResourceStore()||null}fillFromMaster(){const e=this;e.projectEvent&&(e.data=e.resourceStore.map((e=>({resource:e}))))}async applyChanges(){const e=this,{projectEvent:t,assignmentStore:r}=e,n=[],i=e.query((e=>e.event&&e.units),!0),s=e.originalAssignmentManipulationRecords.filter((e=>!i.includes(e)));let o;if(i.length||s.length){const a=t.project.replica,l=a.projectRefreshThreshold;i.forEach((e=>{const t=e.assignment;t?t.units=e.units:n.push({resource:e.resource,event:e.event,units:e.units})})),e.commit(),r.remove(s.map((e=>e.assignment))),r.add(n),a.projectRefreshThreshold=0,o=await t.commitAsync(),e._projectEventGeneration--,a.projectRefreshThreshold=l,r.trigger("refresh",{action:"dataset"}),e.floatAssignedResources&&e.sort(),e.trigger("changesApplied")}return o}getResourceAssignment(e){return this.storage.getBy("resource",e)}get activeAssignments(){const e=this.projectEvent;return this.query((t=>t.event===e))}toValueString(){const{activeAssignments:e}=this;return compose$1({rest:"",assignments:e})}defaultSort(e,t){let r=0;return r=this.floatAssignedResources?!t.event&&e.event?-1:!e.event&&t.event?1:e.name.localeCompare(t.name):e.name.localeCompare(t.name),r}onUpdate({changes:e}){const t=this;t.isConfiguring||Object.hasOwnProperty.call(e,"event")&&t.floatAssignedResources&&t.liveFloatAssignedResources&&t.sort()}}AssignmentsManipulationStore._$name="AssignmentsManipulationStore";const locale$5=LocaleHelper.mergeLocales(locale$4,{Object:{Save:"Save"},AddNewColumn:{"New Column":"New Column"},CalendarColumn:{Calendar:"Calendar"},EarlyStartDateColumn:{"Early Start":"Early Start"},EarlyEndDateColumn:{"Early End":"Early End"},LateStartDateColumn:{"Late Start":"Late Start"},LateEndDateColumn:{"Late End":"Late End"},TotalSlackColumn:{"Total Slack":"Total Slack"},ConstraintDateColumn:{"Constraint Date":"Constraint Date"},ConstraintTypeColumn:{"Constraint Type":"Constraint Type"},DeadlineDateColumn:{Deadline:"Deadline"},DependencyColumn:{"Invalid dependency":"Invalid dependency found, change reverted"},DurationColumn:{Duration:"Duration"},EffortColumn:{Effort:"Effort"},EndDateColumn:{Finish:"Finish"},EventModeColumn:{"Event mode":"Event mode",Manual:"Manual",Auto:"Auto"},ManuallyScheduledColumn:{"Manually scheduled":"Manually scheduled"},MilestoneColumn:{Milestone:"Milestone"},NameColumn:{Name:"Name"},NoteColumn:{Note:"Note"},PercentDoneColumn:{"% Done":"% Done"},PredecessorColumn:{Predecessors:"Predecessors"},ResourceAssignmentColumn:{"Assigned Resources":"Assigned Resources","more resources":"more resources"},RollupColumn:{Rollup:"Rollup"},SchedulingModeColumn:{"Scheduling Mode":"Scheduling Mode"},SequenceColumn:{Sequence:"Sequence"},ShowInTimelineColumn:{"Show in timeline":"Show in timeline"},StartDateColumn:{Start:"Start"},SuccessorColumn:{Successors:"Successors"},WBSColumn:{WBS:"WBS"},DependencyField:{invalidDependencyFormat:"Invalid dependency format"},ProjectLines:{"Project Start":"Project start","Project End":"Project end"},TaskTooltip:{Start:"Start",End:"End",Duration:"Duration",Complete:"Complete"},AssignmentGrid:{Name:"Resource name",Units:"Units",unitsTpl:({value:e})=>e?e+"%":""},GanttBase:{propagating:"Calculating project",storePopulation:"Loading data"},Gantt:{Edit:"Edit task",Indent:"Indent",Outdent:"Outdent","Convert to milestone":"Convert to milestone",Add:"Add...","New task":"New task","New milestone":"New milestone","Task above":"Task above","Task below":"Task below","Delete task":"Delete task",Milestone:"Milestone","Sub-task":"Subtask",Successor:"Successor",Predecessor:"Predecessor",changeRejected:"Scheduling engine rejected the changes"},Indicators:{earlyDates:"Early start/end",lateDates:"Late start/end",Start:"Start",End:"End",deadlineDate:"Deadline"},TaskEditor:{editorWidth:"44em"}});LocaleHelper.trimLocale(locale$5,{EventEdit:["Repeat"],RecurrenceCombo:{},RecurrenceConfirmationPopup:{},RecurrenceDaysCombo:{},RecurrenceEditor:{},RecurrenceFrequencyCombo:{},RecurrenceLegend:{},RecurrencePositionsCombo:{},RecurrenceStopConditionCombo:{}}),LocaleManagerSingleton.registerLocale("En",{desc:"English",locale:locale$5});class AssignmentGrid extends Grid{static get $name(){return"AssignmentGrid"}static get type(){return"assignmentgrid"}static get configurable(){return{resourceColumn:{cls:"b-assignmentgrid-resource-column",field:"resourceId",flex:1,editor:null,renderer:({record:e})=>{var t;return null===(t=e.resource)||void 0===t?void 0:t.name},filterable:{filterField:{placeholder:"L{Name}",localeClass:this,triggers:{filter:{align:"start",cls:"b-icon b-icon-filter"}}},filterFn:({value:e,record:t})=>-1!==t.name.toLowerCase().indexOf(e.toLowerCase())},sortable:(e,t)=>e.name<t.name?-1:e.name>t.name?1:0},unitsColumn:{field:"units",type:NumberColumn.type,text:"L{Units}",localeClass:this,width:70,min:0,max:100,step:10,unit:"%",renderer:({value:e})=>this.L("L{unitsTpl}",{value:e}),filterable:!1}}}static get defaultConfig(){return{selectionMode:{rowCheckboxSelection:!0,multiSelect:!0,showCheckAll:!0},features:{group:!1,filterBar:!0,contextMenu:!1},disableGridRowModelWarning:!0,projectEvent:null}}construct(){super.construct(...arguments),this.on("selectionchange",(({selected:e,deselected:t})=>{e.forEach((e=>e.assigned=!0)),t.forEach((e=>e.assigned=!1))}))}get projectEvent(){const e=this,t=e.store;let r=e._projectEvent;return t&&r!==t.projectEvent&&(r=e._projectEvent=t.projectEvent),r}set projectEvent(e){this._projectEvent=e,this.store.projectEvent=e,this.selectedRecords=this.store.originalAssignmentManipulationRecords}get store(){return super.store}set store(e){const t=this;t.store!==e&&(e instanceof AssignmentsManipulationStore||(e=new AssignmentsManipulationStore(Object.assign({projectEvent:t._projectEvent},e))),super.store=e)}set columns(e){e&&e.unshift(Objects.clone(this.resourceColumn),Objects.clone(this.unitsColumn)),super.columns=e}get columns(){return super.columns}}AssignmentGrid.initClass(),AssignmentGrid._$name="AssignmentGrid";class AssignmentPicker extends AssignmentGrid{static get $name(){return"AssignmentPicker"}static get type(){return"assignmentpicker"}static get defaultConfig(){return{focusable:!0,trapFocus:!0,height:"20em",minWidth:"25em",bbar:[{type:"button",text:this.L("L{Object.Save}"),localeClass:this,ref:"saveBtn",color:"b-green"},{type:"button",text:this.L("L{Object.Cancel}"),localeClass:this,ref:"cancelBtn",color:"b-gray"}],projectEvent:null,store:null}}configure(e){let t=e.grid;t&&(VersionHelper.deprecate("Gantt","5.0.0","The `grid` config is deprecated, you can now set the config properties directly on this AssignmentPicker since it *is* the Grid"),t.columns&&(e.columns=t.columns||[],t=Object.assign({},t),delete t.columns),ObjectHelper.merge(e,t)),e.selectedRecordCollection=e.assignments,super.configure(e)}afterConfigure(){var e,t;const r=this;super.afterConfigure(),null===(e=r.bbar.widgetMap.saveBtn)||void 0===e||e.on("click",r.onSaveClick,r),null===(t=r.bbar.widgetMap.cancelBtn)||void 0===t||t.on("click",r.onCancelClick,r)}get focusElement(){return this.element.querySelector(".b-filter-bar-field-input")}onSaveClick(){this.store.applyChanges(),this.hide()}onCancelClick(){this.hide()}}AssignmentPicker.initClass(),AssignmentPicker._$name="AssignmentPicker";class AssignmentField extends Combo{static get $name(){return"AssignmentField"}static get type(){return"assignmentfield"}static get configurable(){return{chipView:{cls:"b-assignment-chipview",itemTpl:(e,t)=>`${e.name} ${e.units}%`,scrollable:{overflowX:"hidden-scroll"}},triggers:{expand:{cls:"b-icon-down",handler:"onTriggerClick"}},multiSelect:!0,clearable:!1,editable:!1,value:null,picker:{type:AssignmentPicker.type,floating:!0,scrollAction:"realign"},pickerWidth:null,projectEvent:null,store:{}}}onChipClose(e){this.showPicker(),e.forEach((e=>this.picker.deselectRow(e)))}syncInputFieldValue(){super.syncInputFieldValue(),this.store&&(this.tooltip=this.store.toValueString())}onTriggerClick(e){this.pickerVisible?this.hidePicker():PickerField.prototype.showPicker.call(this,e&&"key"in e)}focusPicker(){this.picker.focus()}changePicker(e,t){const r=this;return AssignmentPicker.reconfigure(t,e,{owner:r,defaults:{projectEvent:r.projectEvent,store:r.store,readOnly:r.readOnly,owner:r,forElement:r[r.pickerAlignElement],assignments:r.valueCollection,align:{anchor:r.overlayAnchor,target:r[r.pickerAlignElement]}}})}changeProjectEvent(e){const{picker:t,store:r}=this;return this._projectEvent=e,this._projectEventGeneration=e.generation,r&&(r.projectEvent=e),t&&(t.projectEvent=e),e}changeStore(e){return!e||e instanceof AssignmentsManipulationStore||(e=new AssignmentsManipulationStore(e)),e}updateStore(e){const t=this;if(t.detachListeners("storeMutation"),e instanceof AssignmentsManipulationStore){const{projectEvent:r}=e;r?t.projectEvent=r:e.projectEvent=t.projectEvent}e.on({name:"storeMutation",change:"syncInputFieldValue",thisObj:t})}get value(){}set value(e){}onPickerKeyDown(e){const t=this.picker;"ArrowDown"===e.key&&e.target.compareDocumentPosition(t.bodyContainer)===document.DOCUMENT_POSITION_FOLLOWING&&t.element.focus()}}AssignmentField.initClass(),AssignmentField._$name="AssignmentField";const defaultUserImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA3CAYAAABQOymxAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAABCJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIgogICAgICAgICAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyI+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjU8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOlhSZXNvbHV0aW9uPjcyPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjYwPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT4xPC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj41NTwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgICAgIDxkYzpzdWJqZWN0PgogICAgICAgICAgICA8cmRmOkJhZy8+CiAgICAgICAgIDwvZGM6c3ViamVjdD4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTgtMDMtMTBUMTE6MDM6NTc8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPlBpeGVsbWF0b3IgMy43PC94bXA6Q3JlYXRvclRvb2w+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpEgCIGAAADbUlEQVRoBe2aW08TQRTH/yVchVCg3Kyl1EAEg6VBjdpoor74ZUz8Nn4UIyHGy4NGLtEHoiLhBQpUkWAIt8itnkMt3SVud2b3DL0xSdPZnTNzzm8uZ87ubCCTyTwD8JR+1+hXyWme4J4HCPg7ZSodNjeQ8wycyV1Vw39NNUBaGWutF6bzh6Rg5XdeC8+t+nog3JK/ZzpnHDi9A0xNAUdH7ijt7cDjW+5yfiSMruHxD8Durr550Shw25AbNQL8hxhfvNIHtdZooWn+5J71jkzeiNMaf+PfuO1tYJo3TOEkDvx1WW29qnCkUsCBiqCGjDjw3JyGdgXRt5MKQhoiosA/PDgoN1u3ttwk9MpFgWdm9JSrSv/cU5V0lxMF3t93V+hFYpn8glQSBZYy6mw7ktF+WQCf7QA/1xfAfnovEPBT27lurWDEXxYjHAo5d4ZuSVkAR4K6WM7yZQHsbL5+yQWwfp/la5hyWpIv3URHOCi41vLdCEgaKdkWhoetZpZmXhT4crM8ZEODbJuiwGxaT4+sgfG4bHviwPcFDawh66JtJQ7M5tXVyRg5OCjTjrUV8RHmxmMxqwrv+Rv0ulY6GQGO92dPFPwY293tp7ZzXSPArK6vz1mpWwkHMA9G3aS8lRsDTlwFvD7W9fZ6g1GpZQyYlScSKibYZbiTkiP2e5JXRoH76XAsEtEzN5nUk9eVNgrMxjRrRl9twpHV2Q4xcpjGSn7RidrSErC+DuzQkalq6uwE+CGEt7YgOS/pJArMZ8Hz9OkIH4TxO2o/r1c5yuI4urUVGKPo7ZIQuW/ghTUgnc6OpB9ANx7uAN6bh4aAkI9IzjNwahNYXATWCPg8E3tx3rYGBryBawMz6MICsEn/x8fniWrXxeC81u+OAY32ooJXysB8MPh5Njt1Vb7XKKhVsJDXeVcXcEfx5YMrMB/cfSFHxOv0QPp0WhC8kYaZ9/zRWOFGCwJ/oqm7upr1uIWbKZ3SpiZ6hqanrBGHWP6/wLPkjHhEeXsp18TrOxwGrl+xE9iAD6ns3XTWIdnFyveKj2kekmPLJRvwy/fAnuBpe05Jsf87OoBHN7NWnMbSEx8rE5YxNzaA1/8+xzgZ4clv9A3kSrHHwbx+js9PRrgaYLk7OTI8ndLm+7f4GjjWrypg7vIL4OJPPLMWVN0I/wWcn9aXj4AzhgAAAABJRU5ErkJggg==";class ResourceAssignmentColumn extends Column{static get $name(){return"ResourceAssignmentColumn"}static get type(){return"resourceassignment"}static get isGanttColumn(){return!0}static get fields(){return["showAvatars","sideMargin","imageSize"]}static get defaults(){return{field:"assignments",instantUpdate:!1,text:"L{Assigned Resources}",width:250,cellCls:"b-resourceassignment-cell",showAvatars:!1,imageSize:30,sideMargin:20,sortable(e,t){const r=e.assignments.join(""),n=t.assignments.join("");return r===n?0:r<n?-1:1},filterable({value:e,record:t}){const r=new RegExp(e,"gi");return t.assignments.some((e=>r.test(e.resourceName)))}}}construct(){const e=this;if(super.construct(...arguments),e.showAvatars){if(EventHelper.on({element:e.grid.element,error:e.onError,thisObj:e,capture:!0}),Object.assign(e,{repaintOnResize:!0,htmlEncode:!1}),!e.grid.resourceImageFolderPath)throw new Error("Must provide a resourceImageFolderPath where resource images are located");e.renderer=e.rendererWithAvatars}e.grid.on({startCellEdit:e.onStartCellEdit,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),e.grid.resourceStore.on({name:"resourceStore",update:e.onResourceUpdate,thisObj:e})}get defaultEditor(){return{type:AssignmentField.type}}onStartCellEdit({editorContext:{record:e,column:t}}){const r=this;t===r&&(r.editor.projectEvent=e,this.detachListeners("editorStore"),r.editor.store.on({name:"editorStore",changesApplied:r.onEditorChangesApplied,thisObj:r}))}onDoneCellEdit(){this.detachListeners("editorStore")}onEditorChangesApplied(){const e=this,t=e.grid.getCell({id:e.editor.projectEvent.id,columnId:e.id});t&&e.renderer({value:e.editor.projectEvent.assignments,cellElement:t})}onResourceUpdate({source:e}){var t;(null===(t=e.project)||void 0===t?void 0:t.propagatingLoadChanges)||this.grid.refreshColumn(this)}get chipView(){const e=this;return e._chipView||(e._chipView=new ChipView({cls:"b-assignment-chipview",itemsFocusable:!1,closable:!1,itemTpl:e.itemTpl,store:{},scrollable:{overflowX:"hidden-scroll"}}),Object.defineProperty(e.chipView,"isVisible",{get:()=>!0})),e._chipView}itemTpl(e,t){return e.toString()}renderer({cellElement:e,value:t,isExport:r}){if(t=t.filter((e=>e.resource)).sort(((e,t)=>e.resourceName.localeCompare(t.resourceName))),r)return t.map(this.itemTpl).join(",");{const{chipView:r}=this;r.store.storage.replaceValues({values:t,silent:!0}),r.refresh();const n=r.element.cloneNode(!0);n.removeAttribute("id"),e.innerHTML='<div class="b-assignment-chipview-wrap"></div>',e.firstElementChild.appendChild(n)}}rendererWithAvatars({value:e,isExport:t}){const r=this,n=Math.floor((r.width-r.sideMargin)/(r.imageSize+2)),i=e.length>n?e.length-n:0;return e=e.filter((e=>e.resource)).sort(((e,t)=>e.resourceName.localeCompare(t.resourceName))),t?e.map(this.itemTpl).join(","):{className:"b-resource-avatar-container",children:e.map(((e,t)=>{const{resource:s}=e;if(t<n){const o=i>0&&t===n-1,a=r.renderImage({resource:s,assignment:e,overflowCount:o?i:0});return o?{className:"b-overflow-img",children:[a,{tag:"span",className:"b-overflow-count",html:"+"+i}]}:a}}))}}renderImage({resource:e,assignment:t,overflowCount:r}){return{tag:"img",className:"b-resource-avatar",dataset:{btipScrollAction:"realign",btip:`${t.toString()}${r?` (+${r} ${this.L("L{more resources}")})`:""}`},src:e.image?this.grid.resourceImageFolderPath+e.image:this.defaultAvatar}}onError(e){const t=e.target;t.classList.contains("b-resource-avatar")&&(t.getAttribute("src").endsWith(this.defaultAvatar)?t.src=defaultUserImage:t.src=this.defaultAvatar)}get defaultAvatar(){const{grid:e}=this;return e.defaultResourceImageName?e.resourceImageFolderPath+e.defaultResourceImageName:defaultUserImage}}ColumnStore.registerColumnType(ResourceAssignmentColumn),ResourceAssignmentColumn._$name="ResourceAssignmentColumn";class RollupColumn extends CheckColumn{static get $name(){return"RollupColumn"}static get type(){return"rollup"}static get isGanttColumn(){return!0}static get defaults(){return{field:"rollup",text:"L{Rollup}"}}}ColumnStore.registerColumnType(RollupColumn),RollupColumn._$name="RollupColumn";class SchedulingModeColumn extends Column{static get $name(){return"SchedulingModeColumn"}static get type(){return"schedulingmodecolumn"}static get isGanttColumn(){return!0}static get defaults(){return{field:"schedulingMode",text:"L{Scheduling Mode}",editor:{type:SchedulingModePicker.type,allowInvalid:!1,picker:{minWidth:"8.5em"}}}}afterConstruct(){const e=this;super.afterConstruct(),FunctionHelper.createSequence(e.editor.updateLocalization,e.onEditorLocaleChange,e)}renderer({value:e}){const t=this.editor.store.getById(e);return t&&t.text||""}onEditorLocaleChange(){this.grid.refreshColumn(this)}}ColumnStore.registerColumnType(SchedulingModeColumn),SchedulingModeColumn._$name="SchedulingModeColumn";class SequenceColumn extends Column{static get $name(){return"SequenceColumn"}static get type(){return"sequence"}static get isGanttColumn(){return!0}static get defaults(){return{field:"sequenceNumber",text:"L{Sequence}",sortable:!1,groupable:!1,filterable:!1,width:70,editor:null}}}ColumnStore.registerColumnType(SequenceColumn),SequenceColumn._$name="SequenceColumn";class ShowInTimelineColumn extends CheckColumn{static get $name(){return"ShowInTimelineColumn"}static get type(){return"showintimeline"}static get isGanttColumn(){return!0}static get defaults(){return{field:"showInTimeline",text:"L{Show in timeline}"}}}ColumnStore.registerColumnType(ShowInTimelineColumn),ShowInTimelineColumn._$name="ShowInTimelineColumn";class StartDateColumn extends GanttDateColumn{static get $name(){return"StartDateColumn"}static get type(){return"startdate"}static get defaults(){return{field:"startDate",text:"L{Start}"}}get defaultEditor(){const e=super.defaultEditor;return e.type="startdate",e}get editor(){let e=this.data.editor;const t=e&&!(e instanceof Widget);return e=super.editor,e&&t&&(e.project=this.gantt.project),e}}ColumnStore.registerColumnType(StartDateColumn),StartDateColumn._$name="StartDateColumn";class SuccessorColumn extends DependencyColumn{static get $name(){return"SuccessorColumn"}static get type(){return"successor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Successors}",field:"successors"}}}ColumnStore.registerColumnType(SuccessorColumn),SuccessorColumn._$name="SuccessorColumn";class TotalSlackColumn extends DurationColumn{static get $name(){return"TotalSlackColumn"}static get type(){return"totalslack"}static get isGanttColumn(){return!0}get durationUnitField(){return"slackUnit"}static get defaults(){return{field:"totalSlack",text:"L{Total Slack}"}}canEdit(e){return!1}}ColumnStore.registerColumnType(TotalSlackColumn),TotalSlackColumn._$name="TotalSlackColumn";class WBSColumn extends Column{static get $name(){return"WBSColumn"}static get type(){return"wbs"}static get isGanttColumn(){return!0}static get defaults(){return{field:"wbsIndex",text:"L{WBS}",width:70,editor:null}}}ColumnStore.registerColumnType(WBSColumn),WBSColumn._$name="WBSColumn";var AllColumns={AddNewColumn:AddNewColumn,CalendarColumn:CalendarColumn,ConstraintDateColumn:ConstraintDateColumn,ConstraintTypeColumn:ConstraintTypeColumn,DeadlineDateColumn:DeadlineDateColumn,DurationColumn:DurationColumn,EarlyEndDateColumn:EarlyEndDateColumn,EarlyStartDateColumn:EarlyStartDateColumn,EffortColumn:EffortColumn,EndDateColumn:EndDateColumn,LateEndDateColumn:LateEndDateColumn,LateStartDateColumn:LateStartDateColumn,ManuallyScheduledColumn:ManuallyScheduledColumn,MilestoneColumn:MilestoneColumn,NameColumn:NameColumn,NoteColumn:NoteColumn,PercentDoneColumn:PercentDoneColumn,PredecessorColumn:PredecessorColumn,ResourceAssignmentColumn:ResourceAssignmentColumn,RollupColumn:RollupColumn,SchedulingModeColumn:SchedulingModeColumn,SequenceColumn:SequenceColumn,ShowInTimelineColumn:ShowInTimelineColumn,StartDateColumn:StartDateColumn,SuccessorColumn:SuccessorColumn,TotalSlackColumn:TotalSlackColumn,WBSColumn:WBSColumn};class EventModeColumn extends CheckColumn{static get $name(){return"EventModeColumn"}static get type(){return"eventmode"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",align:"left",text:"L{Event mode}"}}constructor(e,t){super(...arguments),this.internalCellCls="b-eventmode-cell"}renderer({value:e,cellElement:t,column:r,isExport:n}){if(super.renderer(...arguments),n)return this.renderText(e);t.widget&&(t.widget.text=this.renderText(e))}onCheckboxChange({source:e,checked:t}){super.onCheckboxChange(...arguments),e.text=this.renderText(t)}renderText(e){return e?this.L("L{Manual}"):this.L("L{Auto}")}}ColumnStore.registerColumnType(EventModeColumn),EventModeColumn._$name="EventModeColumn";class TimeAxisColumn$1 extends TimeAxisColumn{static get defaults(){return{enableCellContextMenu:!0}}}ColumnStore.registerColumnType(TimeAxisColumn$1),TimeAxisColumn$1._$name="TimeAxisColumn";var __decorate$r=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class GanttAssignmentMixin extends(Mixin([SchedulerProAssignmentMixin],(e=>{e.prototype;class t extends e{*calculateUnits(){const e=yield this.$.event;return e?yield*e.calculateAssignmentUnits(this):yield ProposedOrPrevious}}return __decorate$r([calculate("units")],t.prototype,"calculateUnits",null),t}))){}class AssignmentModel$2 extends(GanttAssignmentMixin.mix(AssignmentModel$1)){static get fields(){return[{name:"event",persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual},{name:"resource",persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual},"eventId","resourceId"]}}AssignmentModel$2._$name="AssignmentModel";class AssignmentStore$2 extends AssignmentStore$1{static get defaultConfig(){return{modelClass:AssignmentModel$2,loadPriority:500,syncPriority:400}}}AssignmentStore$2._$name="AssignmentStore";class DependencyModel$2 extends DependencyModel$1{constructor(...e){const[t]=e;t&&t.fromTask&&(t.fromEvent=t.fromTask),t&&t.toTask&&(t.toEvent=t.toTask),super(...e)}get from(){var e;return null===(e=this.fromEvent)||void 0===e?void 0:e.id}get fromTask(){return this.fromEvent}set fromTask(e){this.fromEvent=e}get to(){var e;return null===(e=this.toEvent)||void 0===e?void 0:e.id}get toTask(){return this.toEvent}set toTask(e){this.toEvent=e}}DependencyModel$2._$name="DependencyModel";class DependencyStore$2 extends DependencyStore$1{static get defaultConfig(){return{modelClass:DependencyModel$2,loadPriority:300,syncPriority:500}}}DependencyStore$2._$name="DependencyStore";class ResourceModel$2 extends ResourceModel$1{}ResourceModel$2._$name="ResourceModel";class ResourceStore$2 extends ResourceStore$1{static get defaultConfig(){return{modelClass:ResourceModel$2,loadPriority:400,syncPriority:200}}}ResourceStore$2._$name="ResourceStore";class WbsField extends DataField{static get type(){return"wbs"}static parseValue(e){if("string"==typeof e)for(let t=(e=e.split(".")).length;t-- >0;)e[t]=parseInt(e[t],10);return e}compare(e,t){if(e===t)return 0;if(!e||!t)return e?1:t?-1:0;e=WbsField.parseValue(e),t=WbsField.parseValue(t);const r=e.length,n=t.length,i=r<n?r:n;for(let r,n=0;n<i;++n)if(r=e[n]-t[n],r)return r;return r-n}printValue(e){return"string"==typeof e?e:e.join(".")}}WbsField.initClass(),WbsField._$name="WbsField";var __decorate$s=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class ConstrainedByParentMixin extends(Mixin([BaseEventMixin,HasChildrenMixin,ConstrainedEarlyEventMixin],(e=>{const t=e.prototype;class r extends e{*maybeSkipNonWorkingTime(e,r=!0){return(yield this.$.childEvents).size>0?e:yield*t.maybeSkipNonWorkingTime.call(this,e,r)}*calculateStartDateConstraintIntervals(){const e=yield*t.calculateStartDateConstraintIntervals.call(this),r=yield this.$.parentEvent;if(r){const t=yield r.$.startDateConstraintIntervals;e.push.apply(e,t)}return e}*calculateEndDateConstraintIntervals(){const e=yield*t.calculateEndDateConstraintIntervals.call(this),r=yield this.$.parentEvent;if(r){const t=yield r.$.endDateConstraintIntervals;e.push.apply(e,t)}return e}*calculateEarlyStartDateConstraintIntervals(){const e=yield*t.calculateEarlyStartDateConstraintIntervals.call(this),r=yield this.$.parentEvent;if(r){const t=yield r.$.earlyStartDateConstraintIntervals;e.push.apply(e,t),(yield r.$.manuallyScheduled)&&(yield this.$.direction)===Direction.Forward&&e.push(DateInterval.new({startDate:yield r.$.startDate}))}return e}*calculateEarlyEndDateConstraintIntervals(){const e=yield*t.calculateEarlyEndDateConstraintIntervals.call(this),r=yield this.$.parentEvent;if(r){const t=yield r.$.earlyEndDateConstraintIntervals;e.push.apply(e,t)}return e}}return __decorate$s([calculate("startDateConstraintIntervals")],r.prototype,"calculateStartDateConstraintIntervals",null),__decorate$s([calculate("endDateConstraintIntervals")],r.prototype,"calculateEndDateConstraintIntervals",null),__decorate$s([calculate("earlyStartDateConstraintIntervals")],r.prototype,"calculateEarlyStartDateConstraintIntervals",null),__decorate$s([calculate("earlyEndDateConstraintIntervals")],r.prototype,"calculateEarlyEndDateConstraintIntervals",null),r}))){}var __decorate$t=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class ConstrainedLateEventMixin extends(Mixin([ConstrainedEarlyEventMixin,HasChildrenMixin],(e=>{const t=e.prototype;class r extends e{*calculateLateStartDateConstraintIntervals(){const e=[],t=yield this.$.parentEvent;if(t){const r=yield t.$.lateStartDateConstraintIntervals;e.push.apply(e,r)}return e}*calculateLateEndDateConstraintIntervals(){const e=[],t=yield this.$.parentEvent;if(t){const r=yield t.$.lateEndDateConstraintIntervals;e.push.apply(e,r),(yield t.$.manuallyScheduled)&&(yield this.$.direction)===Direction.Backward&&e.push(DateInterval.new({endDate:yield t.$.endDate}))}return e}*calculateLateStartDateRaw(){const e=yield this.$.childEvents;let t;if(!e.size){if(yield this.$.manuallyScheduled)return yield this.$.startDate;if(!(yield*this.isConstrainedLate()))return yield this.$.startDate;const e=yield this.$.lateStartDateConstraintIntervals,t=yield this.$.lateEndDateConstraintIntervals,r=yield*this.calculateEffectiveConstraintInterval(!0,e.concat(yield this.$.startDateConstraintIntervals),t.concat(yield this.$.endDateConstraintIntervals));if(null===r)return null;if(r.isIntervalEmpty()){const e=ConflictEffect.new();if((yield e)!==ConflictResolutionResult.Cancel)return null;yield Reject(e)}return isDateFinite(r.endDate)?r.endDate:null}t=MAX_DATE;for(let r of e){const e=yield r.$.lateStartDate;e&&e<t&&(t=e)}return t=t.getTime()-MAX_DATE.getTime()?t:null,t}*calculateLateStartDate(){const e=yield this.$.lateStartDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!0)}*calculateLateEndDateRaw(){const e=yield this.$.childEvents;let t;if(!e.size){if(yield this.$.manuallyScheduled)return yield this.$.endDate;if(!(yield*this.isConstrainedLate()))return yield this.$.endDate;const e=yield this.$.lateStartDateConstraintIntervals,t=yield this.$.lateEndDateConstraintIntervals,r=yield*this.calculateEffectiveConstraintInterval(!1,e.concat(yield this.$.startDateConstraintIntervals),t.concat(yield this.$.endDateConstraintIntervals));if(null===r)return null;if(r.isIntervalEmpty()){const e=ConflictEffect.new();if((yield e)!==ConflictResolutionResult.Cancel)return null;yield Reject(e)}return isDateFinite(r.endDate)?r.endDate:null}t=MIN_DATE$1;for(let r of e){const e=yield r.$.lateEndDate;e&&e>t&&(t=e)}return t=t.getTime()-MIN_DATE$1.getTime()?t:null,t}*calculateLateEndDate(){const e=yield this.$.lateEndDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!1)}*calculateTotalSlack(){const e=yield this.$.earlyStartDateRaw,t=yield this.$.lateStartDateRaw,r=yield this.$.earlyEndDateRaw,n=yield this.$.lateEndDateRaw,i=yield this.$.slackUnit;let s,o;return(e&&t||r&&n)&&(e&&t?(o=yield*this.calculateProjectedDuration(e,t,i),r&&n&&(s=yield*this.calculateProjectedDuration(r,n,i),s<o&&(o=s))):r&&n&&(o=yield*this.calculateProjectedDuration(r,n,i))),o}*calculateCritical(){return(yield this.$.totalSlack)<=0}*isConstrainedLate(){const e=yield this.$.startDateConstraintIntervals,t=yield this.$.endDateConstraintIntervals,r=yield this.$.lateStartDateConstraintIntervals,n=yield this.$.lateEndDateConstraintIntervals;return Boolean((null==e?void 0:e.length)||(null==t?void 0:t.length)||(null==r?void 0:r.length)||(null==n?void 0:n.length))}*calculateStartDatePure(){return(yield this.$.direction)===Direction.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield*this.hasSubEvents())?yield*t.calculateStartDatePure.call(this):yield this.$.lateStartDate:yield*t.calculateStartDatePure.call(this)}*calculateStartDateProposed(){switch(yield this.$.direction){case Direction.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield*this.hasSubEvents())?yield*t.calculateStartDateProposed.call(this):(yield this.$.lateStartDate)||(yield*t.calculateStartDateProposed.call(this));default:return yield*t.calculateStartDateProposed.call(this)}}*calculateEndDatePure(){return(yield this.$.direction)===Direction.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield*this.hasSubEvents())?yield*t.calculateEndDatePure.call(this):yield this.$.lateEndDate:yield*t.calculateEndDatePure.call(this)}*calculateEndDateProposed(){switch(yield this.$.direction){case Direction.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield*this.hasSubEvents())?yield*t.calculateEndDateProposed.call(this):(yield this.$.lateEndDate)||(yield*t.calculateEndDateProposed.call(this));default:return yield*t.calculateEndDateProposed.call(this)}}}return __decorate$t([field({lazy:true})],r.prototype,"lateStartDateRaw",void 0),__decorate$t([model_field({type:"date",persist:!1},{lazy:true,converter:dateConverter,persistent:!1})],r.prototype,"lateStartDate",void 0),__decorate$t([field({lazy:true})],r.prototype,"lateEndDateRaw",void 0),__decorate$t([model_field({type:"date",persist:!1},{lazy:true,converter:dateConverter,persistent:!1})],r.prototype,"lateEndDate",void 0),__decorate$t([field({lazy:true})],r.prototype,"lateStartDateConstraintIntervals",void 0),__decorate$t([field({lazy:true})],r.prototype,"lateEndDateConstraintIntervals",void 0),__decorate$t([model_field({type:"number",persist:!1},{lazy:true,persistent:!1})],r.prototype,"totalSlack",void 0),__decorate$t([model_field({type:"string",defaultValue:TimeUnit.Day,persist:!1},{lazy:true,converter:DateHelper.normalizeUnit,persistent:!1})],r.prototype,"slackUnit",void 0),__decorate$t([model_field({type:"boolean",defaultValue:!1,persist:!1},{persistent:!1,lazy:true})],r.prototype,"critical",void 0),__decorate$t([calculate("lateStartDateConstraintIntervals")],r.prototype,"calculateLateStartDateConstraintIntervals",null),__decorate$t([calculate("lateEndDateConstraintIntervals")],r.prototype,"calculateLateEndDateConstraintIntervals",null),__decorate$t([calculate("lateStartDateRaw")],r.prototype,"calculateLateStartDateRaw",null),__decorate$t([calculate("lateStartDate")],r.prototype,"calculateLateStartDate",null),__decorate$t([calculate("lateEndDateRaw")],r.prototype,"calculateLateEndDateRaw",null),__decorate$t([calculate("lateEndDate")],r.prototype,"calculateLateEndDate",null),__decorate$t([calculate("totalSlack")],r.prototype,"calculateTotalSlack",null),__decorate$t([calculate("critical")],r.prototype,"calculateCritical",null),r}))){}class GanttHasAssignmentsMixin extends(Mixin([SchedulerProHasAssignmentsMixin],(e=>{e.prototype;return class extends e{*hasProposedValueForUnits(){const e=yield this.$.assigned;for(const t of e){if((yield t.$.resource)&&(yield HasProposedValue(t.$.units)))return!0}return!1}}}))){}var __decorate$u=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class HasEffortMixin extends(Mixin([GanttHasAssignmentsMixin,HasChildrenMixin],(e=>{e.prototype;class t extends e{getEffort(e){const t=this.effort;return void 0!==e?this.getProject().convertDuration(t,this.effortUnit,e):t}writeEffort(e,t,r,n,i){n<0&&(n=0),(t.baseRevision.hasIdentifier(e)||null!=n)&&(null!=i&&i!==this.effortUnit&&this.$.effortUnit.write.call(this,this.$.effortUnit,t,null,i),e.constructor.prototype.write(e,t,r,n))}setEffortUnit(e){throw new Error("Use `setEffort` instead")}*calculateTotalChildrenEffort(){const e=yield this.$.childEvents,t=this.getProject();let r=0;for(const n of e){const e=yield n.$.effortUnit;r+=(yield*t.$convertDuration(yield n.$.effort,e,TimeUnit.Millisecond))}return yield*t.$convertDuration(r,TimeUnit.Millisecond,yield this.$.effortUnit)}*calculateEffort(){if((yield this.$.childEvents).size>0)return yield*this.calculateTotalChildrenEffort();{const e=yield ProposedOrPrevious;return void 0!==e?e:yield*this.calculateEffortPure()}}*calculateEffortPure(){return(yield this.$.childEvents).size>0?yield*this.calculateTotalChildrenEffort():yield*this.calculateProjectedEffort(yield this.$.startDate,yield this.$.endDate)}*calculateEffortProposed(){return yield ProposedOrPrevious}*calculateAssignmentUnits(e){return yield*this.calculateAssignmentUnitsProposed(e)}*calculateAssignmentUnitsPure(e){return yield*this.calculateUnitsByStartEndAndEffort(e)}*calculateAssignmentUnitsProposed(e){return yield ProposedOrPrevious}*getBaseOptionsForEffortCalculations(){return{ignoreResourceCalendars:!1}}*calculateProjectedEffort(e,t){if(null==e||null==t||e>t)return null;const r=yield this.$.assignmentsByCalendar,n=new Map;for(const[e,t]of r){let r=0;for(const e of t)r+=(yield e.$.units);n.set(e,r)}let i=0;const s=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:e,endDate:t});return 0===n.size&&(n.set(yield this.$.effectiveCalendar,100),s.ignoreResourceCalendars=!0),yield*this.forEachAvailabilityInterval(s,((e,t,r)=>{const s=r.getCalendarsWorking(),o=e.getTime(),a=t.getTime()-o;let l=0;for(const e of s)l+=n.get(e)||0;i+=l*a*.01})),yield*this.getProject().$convertDuration(i,TimeUnit.Millisecond,yield this.$.effortUnit)}*calculateUnitsByStartEndAndEffort(e){const t=yield this.$.effort,r=yield this.$.effortUnit,n=yield*this.getProject().$convertDuration(t,r,TimeUnit.Millisecond);let i=0;const s=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:yield this.$.startDate,endDate:yield this.$.endDate}),o=yield this.$.assignmentsByCalendar;return yield*this.forEachAvailabilityInterval(s,((e,t,r)=>{const n=r.getCalendarsWorking(),s=e.getTime(),a=t.getTime()-s;for(const e of n)i+=(o.has(e)?o.get(e).length:0)*a})),i?100*n/i:100}*calculateProjectedXDateByEffort(e,t=!0){const r=yield this.$.effort,n=yield this.$.effortUnit,i=yield*this.getProject().$convertDuration(r,n,TimeUnit.Millisecond);if(null==e||null==r)return null;let s=e.getTime(),o=i;const a=yield this.$.effectiveCalendar,l=yield this.$.assignmentsByCalendar,c=new Map;for(const[e,t]of l){let r=0;for(const e of t)r+=(yield e.$.units);c.set(e,r)}if(l.size>0){const r=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),t?{startDate:e,isForward:t}:{endDate:e,isForward:t});return yield*this.forEachAvailabilityInterval(r,((e,r,n)=>{const i=n.getCalendarsWorking(),a=e.getTime(),l=r.getTime(),d=l-a;let u=0;for(const e of i)u+=c.get(e)||0;const h=u*d*.01;if(h>=o)return s=t?a+o/(.01*u):l-o/(.01*u),!1;o-=h})),new Date(s)}return a.accumulateWorkingTime(e,i,t).finalDate}}return __decorate$u([model_field({type:"number"})],t.prototype,"effort",void 0),__decorate$u([model_field({type:"string",defaultValue:TimeUnit.Hour},{converter:DateHelper.normalizeUnit})],t.prototype,"effortUnit",void 0),__decorate$u([write("effort")],t.prototype,"writeEffort",null),__decorate$u([calculate("effort")],t.prototype,"calculateEffort",null),t}))){}const EffortVar=Symbol("EffortVar"),UnitsVar=Symbol("UnitsVar"),effortFormula=Formula.new({output:EffortVar,inputs:new Set([StartDateVar,EndDateVar,UnitsVar])}),unitsFormula=Formula.new({output:UnitsVar,inputs:new Set([StartDateVar,EndDateVar,EffortVar])}),endDateByEffortFormula=Formula.new({output:EndDateVar,inputs:new Set([StartDateVar,EffortVar,UnitsVar])}),startDateByEffortFormula=Formula.new({output:StartDateVar,inputs:new Set([EndDateVar,EffortVar,UnitsVar])});class SEDWUDispatcher extends SEDDispatcher{}class SEDWUDispatcherIdentifier extends SEDDispatcherIdentifier{equality(e,t){const r=e.resolution,n=t.resolution;return r.get(EffortVar)===n.get(EffortVar)&&r.get(UnitsVar)===n.get(UnitsVar)&&super.equality(e,t)}}var __decorate$v=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class HasSchedulingModeMixin extends(Mixin([HasEffortMixin],(e=>{const t=e.prototype;class r extends e{*calculateSchedulingMode(){return(yield ProposedOrPrevious)||SchedulingMode.Normal}*effectiveSchedulingMode(){return(yield this.$.assignmentsByCalendar).size>0?yield this.$.schedulingMode:SchedulingMode.Normal}effectiveSchedulingModeSync(e){return e(this.$.assignmentsByCalendar).size>0?e(this.$.schedulingMode):SchedulingMode.Normal}*prepareDispatcher(e){if((yield*this.effectiveSchedulingMode())!==SchedulingMode.Normal){const r=yield*t.prepareDispatcher.call(this,e);return r.collectInfo(e,this.$.effort,EffortVar),(yield*this.hasProposedValueForUnits())&&r.addProposedValueFlag(UnitsVar),r.addPreviousValueFlag(UnitsVar),r}return yield*t.prepareDispatcher.call(this,e)}dispatcherClass(e){return this.effectiveSchedulingModeSync(e)!==SchedulingMode.Normal?SEDWUDispatcher:t.dispatcherClass.call(this,e)}buildProposedDispatcher(e,r,n){const i=t.buildProposedDispatcher.call(this,e,r,n);return i.addPreviousValueFlag(EffortVar),i.addPreviousValueFlag(UnitsVar),i}*calculateAssignmentUnits(e){if((yield*this.effectiveSchedulingMode())!==SchedulingMode.Normal){const t=(yield this.$.dispatcher).resolution.get(UnitsVar);if(t===CalculateProposed)return yield*this.calculateAssignmentUnitsProposed(e);if(t===unitsFormula.formulaId)return yield*this.calculateAssignmentUnitsPure(e);throw new Error("Unknown formula for `units`")}return yield*t.calculateAssignmentUnits.call(this,e)}*calculateEffort(){if((yield*this.effectiveSchedulingMode())!==SchedulingMode.Normal){const e=(yield this.$.dispatcher).resolution.get(EffortVar);if(e===CalculateProposed)return yield*this.calculateEffortProposed();if(e===effortFormula.formulaId)return yield*this.calculateEffortPure();throw new Error("Unknown formula for `effort`")}return yield*t.calculateEffort.call(this)}*calculateStartDate(){if((yield*this.effectiveSchedulingMode())!==SchedulingMode.Normal){return(yield this.$.dispatcher).resolution.get(StartDateVar)===startDateByEffortFormula.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.endDate,!1):yield*t.calculateStartDate.call(this)}return yield*t.calculateStartDate.call(this)}*calculateEndDate(){if((yield*this.effectiveSchedulingMode())!==SchedulingMode.Normal){return(yield this.$.dispatcher).resolution.get(EndDateVar)===endDateByEffortFormula.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.startDate,!0):yield*t.calculateEndDate.call(this)}return yield*t.calculateEndDate.call(this)}*calculateEffectiveDuration(){const e=yield this.$.dispatcher,r=yield*this.effectiveSchedulingMode(),n=e.resolution.get(DurationVar);e.resolution.get(EffortVar);let i;if(n===durationFormula.formulaId&&r!=SchedulingMode.Normal){const r=yield ProposedOrPreviousValueOf(this.$.startDate),n=yield ProposedOrPreviousValueOf(this.$.endDate),s=e.resolution.get(StartDateVar),o=e.resolution.get(EndDateVar);yield this.$.effortDriven;n&&s===startDateByEffortFormula.formulaId?i=yield*this.calculateProjectedDuration(yield*this.calculateProjectedXDateByEffort(n,!1),n):r&&o===endDateByEffortFormula.formulaId?i=yield*this.calculateProjectedDuration(r,yield*this.calculateProjectedXDateByEffort(r,!0)):(r&&n||!r&&!n)&&(i=yield*t.calculateEffectiveDuration.call(this))}else i=yield*t.calculateEffectiveDuration.call(this);return i}}return __decorate$v([model_field({type:"boolean",defaultValue:!1})],r.prototype,"effortDriven",void 0),__decorate$v([model_field({type:"string",defaultValue:SchedulingMode.Normal},{sync:!0})],r.prototype,"schedulingMode",void 0),__decorate$v([field({identifierCls:SEDWUDispatcherIdentifier})],r.prototype,"dispatcher",void 0),__decorate$v([calculate("schedulingMode")],r.prototype,"calculateSchedulingMode",null),__decorate$v([calculate("effort")],r.prototype,"calculateEffort",null),__decorate$v([calculate("startDate")],r.prototype,"calculateStartDate",null),__decorate$v([calculate("endDate")],r.prototype,"calculateEndDate",null),r}))){}var __decorate$w=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class ScheduledByDependenciesLateEventMixin extends(Mixin([ScheduledByDependenciesEarlyEventMixin,ConstrainedLateEventMixin],(e=>{const t=e.prototype;class r extends e{*calculateLateStartDateConstraintIntervals(){const e=yield*t.calculateLateStartDateConstraintIntervals.call(this),r=this.getProject();let n;for(n of yield this.$.outgoingDeps){const t=yield n.$.toEvent;if(null==t||isAtomicValue(t))continue;let i;switch(yield n.$.type){case DependencyType.StartToStart:const e=yield t.$.lateStartDateRaw;if(e){const t=yield n.$.lag,s=yield n.$.lagUnit,o=yield n.$.calendar;i=DateInterval.new({startDate:null,endDate:o.calculateStartDate(e,yield*r.$convertDuration(t,s,TimeUnit.Millisecond))})}break;case DependencyType.StartToEnd:const s=yield t.$.lateEndDateRaw;if(s){const e=yield n.$.lag,t=yield n.$.lagUnit,o=yield n.$.calendar;i=DateInterval.new({startDate:null,endDate:o.calculateStartDate(s,yield*r.$convertDuration(e,t,TimeUnit.Millisecond))})}}i&&e.unshift(i)}return e}*calculateLateEndDateConstraintIntervals(){const e=yield*t.calculateLateEndDateConstraintIntervals.call(this),r=this.getProject();let n;for(n of yield this.$.outgoingDeps){const t=yield n.$.toEvent;if(null==t||isAtomicValue(t))continue;let i;switch(yield n.$.type){case DependencyType.EndToEnd:const e=yield t.$.lateEndDateRaw;if(e){const t=yield n.$.lag,s=yield n.$.lagUnit,o=yield n.$.calendar;i=DateInterval.new({startDate:null,endDate:o.calculateStartDate(e,yield*r.$convertDuration(t,s,TimeUnit.Millisecond))})}break;case DependencyType.EndToStart:const s=yield t.$.lateStartDateRaw;if(s){const e=yield n.$.lag,t=yield n.$.lagUnit,o=yield n.$.calendar;i=DateInterval.new({startDate:null,endDate:o.calculateStartDate(s,yield*r.$convertDuration(e,t,TimeUnit.Millisecond))})}}i&&e.unshift(i)}return e}}return __decorate$w([calculate("lateStartDateIntervals")],r.prototype,"calculateLateStartDateConstraintIntervals",null),__decorate$w([calculate("lateEndDateIntervals")],r.prototype,"calculateLateEndDateConstraintIntervals",null),r}))){}const fixedDurationSEDWUGraphDescription=CycleDescription.new({variables:new Set([StartDateVar,EndDateVar,DurationVar,EffortVar,UnitsVar]),formulas:new Set([startDateFormula,endDateFormula,durationFormula,unitsFormula,effortFormula])}),fixedDurationSEDWUForwardNonEffortDriven=CycleResolution.new({description:fixedDurationSEDWUGraphDescription,defaultResolutionFormulas:new Set([endDateFormula,effortFormula])}),fixedDurationSEDWUForwardEffortDriven=CycleResolution.new({description:fixedDurationSEDWUGraphDescription,defaultResolutionFormulas:new Set([endDateFormula,unitsFormula])}),fixedDurationSEDWUBackwardNonEffortDriven=CycleResolution.new({description:fixedDurationSEDWUGraphDescription,defaultResolutionFormulas:new Set([startDateFormula,effortFormula])}),fixedDurationSEDWUBackwardEffortDriven=CycleResolution.new({description:fixedDurationSEDWUGraphDescription,defaultResolutionFormulas:new Set([startDateFormula,unitsFormula])});class FixedDurationMixin extends(Mixin([HasSchedulingModeMixin],(e=>{const t=e.prototype;return class extends e{*prepareDispatcher(e){if((yield*this.effectiveSchedulingMode())===SchedulingMode.FixedDuration){const r=yield*t.prepareDispatcher.call(this,e),n=yield this.$.effortDriven;return n&&r.addKeepIfPossibleFlag(EffortVar),(yield HasProposedValue(this.$.assigned))&&(n?r.addProposedValueFlag(EffortVar):r.addProposedValueFlag(UnitsVar)),r}return yield*t.prepareDispatcher.call(this,e)}cycleResolutionContext(e){if(this.effectiveSchedulingModeSync(e)===SchedulingMode.FixedDuration){const t=e(this.$.direction),r=e(this.$.effortDriven);return t===Direction.Forward||t===Direction.None?r?fixedDurationSEDWUForwardEffortDriven:fixedDurationSEDWUForwardNonEffortDriven:r?fixedDurationSEDWUBackwardEffortDriven:fixedDurationSEDWUBackwardNonEffortDriven}return t.cycleResolutionContext.call(this,e)}*getBaseOptionsForDurationCalculations(){return(yield*this.effectiveSchedulingMode())===SchedulingMode.FixedDuration?{ignoreResourceCalendars:!0}:yield*t.getBaseOptionsForDurationCalculations.call(this)}}}))){}const fixedEffortSEDWUGraphDescription=CycleDescription.new({variables:new Set([StartDateVar,EndDateVar,DurationVar,EffortVar,UnitsVar]),formulas:new Set([endDateByEffortFormula,durationFormula,unitsFormula,effortFormula,startDateByEffortFormula,startDateFormula,endDateFormula])}),fixedEffortSEDWUForward=CycleResolution.new({description:fixedEffortSEDWUGraphDescription,defaultResolutionFormulas:new Set([endDateByEffortFormula,durationFormula])}),fixedEffortSEDWUBackward=CycleResolution.new({description:fixedEffortSEDWUGraphDescription,defaultResolutionFormulas:new Set([startDateByEffortFormula,durationFormula])});class FixedEffortMixin extends(Mixin([HasSchedulingModeMixin],(e=>{const t=e.prototype;return class extends e{*prepareDispatcher(e){if((yield*this.effectiveSchedulingMode())===SchedulingMode.FixedEffort){const r=yield*t.prepareDispatcher.call(this,e);return(yield HasProposedValue(this.$.assigned))&&r.addProposedValueFlag(UnitsVar),r.addKeepIfPossibleFlag(EffortVar),r}return yield*t.prepareDispatcher.call(this,e)}cycleResolutionContext(e){if(this.effectiveSchedulingModeSync(e)===SchedulingMode.FixedEffort){const t=e(this.$.direction);return t===Direction.Forward||t===Direction.None?fixedEffortSEDWUForward:fixedEffortSEDWUBackward}return t.cycleResolutionContext.call(this,e)}}}))){}const fixedUnitsSEDWUGraphDescription=CycleDescription.new({variables:new Set([StartDateVar,EndDateVar,DurationVar,EffortVar,UnitsVar]),formulas:new Set([endDateByEffortFormula,durationFormula,effortFormula,unitsFormula,startDateByEffortFormula,startDateFormula,endDateFormula])}),fixedUnitsSEDWUForwardNonEffortDriven=CycleResolution.new({description:fixedUnitsSEDWUGraphDescription,defaultResolutionFormulas:new Set([endDateByEffortFormula,endDateFormula,effortFormula])}),fixedUnitsSEDWUForwardEffortDriven=CycleResolution.new({description:fixedUnitsSEDWUGraphDescription,defaultResolutionFormulas:new Set([endDateByEffortFormula,endDateFormula,durationFormula])}),fixedUnitsSEDWUBackwardNonEffortDriven=CycleResolution.new({description:fixedUnitsSEDWUGraphDescription,defaultResolutionFormulas:new Set([startDateByEffortFormula,startDateFormula,effortFormula])}),fixedUnitsSEDWUBackwardEffortDriven=CycleResolution.new({description:fixedUnitsSEDWUGraphDescription,defaultResolutionFormulas:new Set([startDateByEffortFormula,startDateFormula,durationFormula])});class FixedUnitsMixin extends(Mixin([HasSchedulingModeMixin],(e=>{const t=e.prototype;return class extends e{*prepareDispatcher(e){if((yield*this.effectiveSchedulingMode())===SchedulingMode.FixedUnits){const r=yield*t.prepareDispatcher.call(this,e);return(yield HasProposedValue(this.$.assigned))&&r.addProposedValueFlag(UnitsVar),(yield this.$.effortDriven)&&r.addKeepIfPossibleFlag(EffortVar),r.addKeepIfPossibleFlag(UnitsVar),r}return yield*t.prepareDispatcher.call(this,e)}cycleResolutionContext(e){if(this.effectiveSchedulingModeSync(e)===SchedulingMode.FixedUnits){const t=e(this.$.direction),r=e(this.$.effortDriven);return t===Direction.Forward||t===Direction.None?r?fixedUnitsSEDWUForwardEffortDriven:fixedUnitsSEDWUForwardNonEffortDriven:r?fixedUnitsSEDWUBackwardEffortDriven:fixedUnitsSEDWUBackwardNonEffortDriven}return t.cycleResolutionContext.call(this,e)}}}))){}class GanttEvent extends(MixinAny([SchedulerProEvent,ConstrainedByParentMixin,ConstrainedLateEventMixin,ScheduledByDependenciesLateEventMixin,GanttHasAssignmentsMixin,HasEffortMixin,HasSchedulingModeMixin,FixedDurationMixin,FixedEffortMixin,FixedUnitsMixin],(e=>{e.prototype;return class extends e{}}))){}class Baseline extends TimeSpan{static get fields(){return[{name:"task",persist:!1}]}get isBaseline(){return!0}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:t}=this;if(e&&t)return t.getTime()===e.getTime()}return 0===this.duration}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}}Baseline._$name="Baseline";const applyBaselineDefaults=(e,t)=>{const{startDate:r,durationUnit:n,endDate:i}=e;return t?t.map((t=>Object.assign({task:e,startDate:r,durationUnit:n,endDate:i},t))):[]},descendingWbsSorter=e=>"wbsIndex"===e.field&&!e.ascending,emptyArray$8=Object.freeze([]),wbsCmp=WbsField.prototype.compare,isReversed=e=>{for(let t,r,n=0,i=e.length;n<i;++n)if(r=e[n].wbsIndex,r){if(t)return wbsCmp(r,t)<0;t=r}return!1},refreshWbsOnJoinOptions={deep:!0,silent:!0};class TaskModel extends(GanttEvent.derive(TimeSpan).mixin(PartOfProject$1,PercentDoneMixin)){static get fields(){return[{name:"cls",serialize:e=>e.isDomClassList?e.toString():e,persist:!0},{name:"fullEffort",persist:!1},{name:"baselines"},{name:"note",type:"string"},{name:"parentId",serialize:(e,t)=>{const r=t.getEventStore(),n=t.getProject();return r&&r.getById(e)===n&&(e=null),e}},{name:"children",persist:!1},{name:"showInTimeline",type:"boolean"},{name:"rollup",type:"boolean"},{name:"wbsIndex",type:"wbs",persist:!1},{name:"deadlineDate",type:"date"},{name:"parentIndex",type:"number",persist:!0},"iconCls","taskIconCls",{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0}]}static get defaultConfig(){return{baselineModelClass:Baseline}}get isTask(){return!0}get isEvent(){return!0}get wbsCode(){var e;return null===(e=this.wbsIndex)||void 0===e?void 0:e.join(".")}set wbsCode(e){this.wbsIndex=WbsField.parseValue(e)}copy(...e){const t=super.copy(...e);return t.setData("wbsIndex",null),t}get hasBaselines(){var e;return(null===(e=this.baselinesStore)||void 0===e?void 0:e.count)||Boolean(this.originalData.baselines)}setBaseline(e){const t=this,{baselines:r}=t;if(e>r.count+1)throw new Error(`Attempt to set baseline ${e} when there are only ${r.count} baselines`);if(e===r.count+1)return r.add(applyBaselineDefaults(t,[{}]));r.getAt(e-1).set(applyBaselineDefaults(t,[{}])[0])}get baselines(){const e=this;return e.baselinesStore||(e.baselinesStore=new Store({modelClass:e.constructor.getDefaultConfiguration().baselineModelClass,data:applyBaselineDefaults(e,e.originalData.baselines)})),e.baselinesStore}get successors(){return Array.from(this.outgoingDeps||[])}set successors(e){this.outgoingDeps=e}setSuccessors(e){const t=this,{dependencyStore:r}=t.project,n=new Set,i=new Set,s=[];return e.forEach((e=>{t.incomingDeps.has(e)?n.add(e):i.add(e)})),t.incomingDeps.forEach((e=>{n.has(e)||s.push(e)})),s.forEach((e=>r.remove(e))),i.forEach((e=>{e.fromEvent=t,r.add(e)})),t.commitAsync()}get predecessors(){return Array.from(this.incomingDeps||[])}set predecessors(e){this.incomingDeps=e}setPredecessors(e){const t=this,{dependencyStore:r}=t.project,n=new Set,i=new Set,s=[];return e.forEach((e=>{t.incomingDeps.has(e)?n.add(e):i.add(e)})),t.incomingDeps.forEach((e=>{n.has(e)||s.push(e)})),s.forEach((e=>r.remove(e))),i.forEach((e=>{e.toEvent=t,r.add(e)})),t.commitAsync()}get isDraggable(){return this.draggable}get isResizable(){return this.resizable&&!this.milestone&&!this.isParent}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:t}=this;if(e&&t)return t.getTime()===e.getTime()}return 0===this.duration}get isMilestone(){return this.milestone}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}get allDependencies(){return this.dependencies}get dependencies(){return[...this.incomingDeps||[],...this.outgoingDeps||[]]}get predecessorTasks(){return[...this.incomingDeps||[]].map((e=>e.fromEvent))}get successorTasks(){return[...this.outgoingDeps||[]].map((e=>e.toEvent))}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get sequenceNumber(){let e=0,t=this;for(;t.parent;)e+=t.previousSiblingsTotalCount+1,t=t.parent;return e}get isSubProject(){return!1}get subProject(){const e=this;let t=null;return e.isProject?t=e:e.bubbleWhile((e=>(e.isProject&&(t=e),!t))),t}get fullEffort(){return new Duration({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get resources(){return this.assignments.reduce(((e,t)=>(t.resource&&e.push(t.resource),e)),[])}normalize(){}inSetNormalize(e){}setStartEndDate(){throw new Error("Not supported")}joinStore(e){const t=this;var r,n,i;t.wbsIndex||((null===(r=t.taskStore)||void 0===r?void 0:r.isLoadingData)||!(null===(n=t.nextSibling)||void 0===n?void 0:n.wbsIndex)&&!(null===(i=t.previousSibling)||void 0===i?void 0:i.wbsIndex)?t.refreshWbs(refreshWbsOnJoinOptions):t.parent.refreshWbs(refreshWbsOnJoinOptions,-1));super.joinStore(e)}refreshWbs(e,t){var r;const n=this,{parent:i}=n;if(i&&-1!==t&&n.fieldMap.wbsIndex){var s,o;t=null!==(s=null!==(o=t)&&void 0!==o?o:n.unfilteredIndex)&&void 0!==s?s:n.parentIndex;const r=(i.isRoot?emptyArray$8:i.wbsIndex).concat(t+1);(null==e?void 0:e.silent)?n.setData("wbsIndex",r):n.set("wbsIndex",r)}if(null===(r=null==e?void 0:e.deep)||void 0===r||r){var a;const t=null!==(a=n.unfilteredChildren)&&void 0!==a?a:n.children,r=(null==t?void 0:t.length)||0;if(r){var l,c;const i=isReversed(t)&&0===(null===(l=n.taskStore)||void 0===l||null===(c=l.sorters)||void 0===c?void 0:c.findIndex(descendingWbsSorter));for(let n=0;n<r;++n)t[n].refreshWbs(e,i?r-n-1:n)}}}async tryInsertChild(){return this.getProject().tryPropagateWithChanges((()=>{this.insertChild(...arguments)}))}}TaskModel.convertEmptyParentToLeaf=!0,TaskModel._$name="TaskModel";const padWbs=e=>e.replace(/(\d+)/g,(e=>+e+1e5));class TaskStore extends(ChronoEventTreeStoreMixin.derive(AjaxStore).mixin(PartOfProject$1)){static get defaultConfig(){return{modelClass:TaskModel,loadPriority:200,syncPriority:300,storeId:"tasks",tree:!0}}setBaseline(e){const t=this.storage.values;this.forEach((t=>t.setBaseline(e))),this.trigger("refresh",{action:"batch",records:t,data:t})}async indent(e){const t=this,{taskStore:r,project:n}=t;let i=!1;return(e=(e=(e=Array.isArray(e)?e.slice():[e]).filter((e=>!e.isProjectModel&&!1!==n.trigger("beforeIndent",{task:e})))).filter((t=>{let r;for(r=Boolean(t.previousSibling);r&&!t.isRoot;)r=!e.includes(t.parent),t=t.parent;return r}))).length&&(e.sort(((e,t)=>{const r=padWbs(e.wbsCode),n=padWbs(t.wbsCode);return r<n?-1:r>n?1:0})),r.beginBatch(),i=await n.tryPropagateWithChanges((()=>{for(const r of e){const e=r.previousSibling;e.appendChild(r),t.toggleCollapse(e,!1)}})),r.endBatch(),i&&(t.trigger("indent",{records:e}),t.trigger("change",{action:"indent",records:e}))),i}async outdent(e){const t=this,{taskStore:r,project:n}=t;let i=!1;return(e=(e=(e=Array.isArray(e)?e.slice():[e]).filter((e=>!e.isProjectModel&&!1!==n.trigger("beforeOutdent",{task:e})))).filter((t=>{let r;for(r=t.parent&&!t.parent.isRoot;r&&!t.isRoot;)r=!e.includes(t.parent),t=t.parent;return r}))).length&&(e.sort(((e,t)=>{const r=padWbs(e.wbsCode),n=padWbs(t.wbsCode);return r<n?1:r>n?-1:0})),r.beginBatch(),i=await n.tryPropagateWithChanges((()=>{for(const r of e){const e=r.parent.children.slice(r.parent.children.indexOf(r)+1);r.parent.parent.insertChild(r,r.parent.nextSibling),r.appendChild(e),t.toggleCollapse(r,!1)}})),r.endBatch(),i&&(t.trigger("outdent",{records:e}),t.trigger("change",{action:"outdent",records:e}))),i}getTotalTimeSpan(){return{startDate:this.getProject().startDate,endDate:this.getProject().endDate}}getEvents({filter:e,resourceRecord:t,startDate:r,endDate:n}){const i=this;if(!i.count)return[];const s=i.isFiltered?e=>i.indexOf(e)>-1:null;let o=i.getEventsForResource(t);return s&&(o=o.filter(s)),o=o.filter((e=>e.startDate&&DateHelper.intersectSpans(e.startDate,e.endDate||e.startDate,r,n))),e?o.filter(e):o}getEventsForResource(e){const t=this.resourceStore.getById(e);return((null==t?void 0:t.assignments.filter((e=>e.isPartOfStore(this.assignmentStore))))||[]).map((e=>e.event))}}TaskStore._$name="TaskStore";const baselineSelector=".b-task-baseline";class Baselines extends TooltipBase{static get $name(){return"Baselines"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:baselineSelector,recordType:"baseline"}}static get pluginConfig(){return{chain:["onTaskDataGenerated","render"]}}construct(e,t){this.tipId=e.id+"-baselines-tip",this.gantt=e,super.construct(e,t)}doDisable(e){const{client:t}=this,{dependencies:r}=t.features;t.refreshWithTransition(),r&&t.setTimeout((()=>r.scheduleDraw(!0)),300),super.doDisable(e)}resolveTimeSpanRecord(e){const t=e.closest(baselineSelector);return null==t?void 0:t.elementData.baseline}template(e){const t=this,{baseline:r}=e,{task:n}=r,i=t.client.formatDuration(r.duration);return`\n            <div class="b-gantt-task-title">${n.name} (baseline ${r.parentIndex+1})</div>\n            <table>\n            <tr><td>${t.L("L{TaskTooltip.Start}")}:</td><td>${e.startClockHtml}</td></tr>\n            ${r.milestone?"":`\n                <tr><td>${t.L("L{TaskTooltip.End}")}:</td><td>${e.endClockHtml}</td></tr>\n                <tr><td>${t.L("L{TaskTooltip.Duration}")}:</td><td class="b-right">${i+" "+DateHelper.getLocalizedNameOfUnit(r.durationUnit,1!==r.duration)}</td></tr>\n            `}\n            </table>\n            `}getTaskDOMConfig(e,t){const r=e.baselines.allRecords;return{className:{"b-baseline-wrap":!0,"b-baseline-milestone":e.milestone},style:{transform:`translateY(${t}px)`},dataset:{taskId:"baselinesFor"+e.id},children:r.map(((e,t)=>{const r=this.gantt.taskRendering.getTaskBox(e);return r?{className:e.cls+"b-task-baseline",style:{width:r.width,left:r.left},dataset:{index:t},elementData:{baseline:e}}:null})),syncOptions:{syncIdField:"index"}}}onTaskDataGenerated({taskRecord:e,top:t,extraConfigs:r}){!this.disabled&&e.hasBaselines&&r.push(this.getTaskDOMConfig(e,t))}}Baselines._$name="Baselines",GridFeatureManager.registerFeature(Baselines,!1,"Gantt");class CellEdit$1 extends CellEdit{static get $name(){return"CellEdit"}async doAddNewAtEnd(){const e=this.grid,t=this.addNewAtEnd,r=e.taskStore,n=r.rootNode.appendChild(Object.assign({name:"New task",startDate:r.getProject().startDate},t));return await r.getProject().commitAsync(),e.rowManager.getRowFor(n)||e.rowManager.displayRecordAtBottom(),n}}CellEdit$1._$name="CellEdit",GridFeatureManager.registerFeature(CellEdit$1,!0,"Gantt");class CriticalPaths extends(Delayable(InstancePlugin)){static get $name(){return"CriticalPaths"}static get defaultConfig(){return{cls:"b-gantt-critical-paths",criticalDependencyCls:"b-critical",disabled:!0}}static get pluginConfig(){return{chain:["onTaskDataGenerated"]}}doDisable(e){e?this.unhighlightCriticalPaths():this.highlightCriticalPaths(),super.doDisable(e)}getDependenciesFeature(){return this.client.foregroundCanvas&&this.client.features.dependencies}setupObserver(){const e=this,{project:t}=e.client,r=e.getDependenciesFeature();e.destroyObserver(),e.criticalPathObserver=t.getGraph().observe((function*(){return yield t.$.criticalPaths}),(t=>{if(!e.disabled){e.removeCriticalCls();for(const n of t)for(const t of n)r&&t.dependency&&r.highlight(t.dependency,e.criticalDependencyCls);e.client.trigger("criticalPathsHighlighted")}}))}destroyObserver(){this.criticalPathObserver&&(this.client.project.getGraph().removeIdentifier(this.criticalPathObserver),this.criticalPathObserver=null)}doDestroy(){this.destroyObserver()}highlightCriticalPaths(){const e=this,{element:t}=e.client;t.classList.contains(e.cls)&&e.unhighlightCriticalPaths(),e.setupObserver(),t.classList.add(e.cls)}removeCriticalCls(){const e=this.client.project,t=this.getDependenciesFeature();t&&e.dependencyStore.forEach((e=>t.unhighlight(e,this.criticalDependencyCls)))}unhighlightCriticalPaths(){const e=this,t=e.client;e.destroyObserver(),e.removeCriticalCls(),t.element.classList.remove(e.cls),t.trigger("criticalPathsUnhighlighted")}onTaskDataGenerated(e){this.disabled||(e.cls["b-critical"]=e.taskRecord.critical)}}CriticalPaths._$name="CriticalPaths",GridFeatureManager.registerFeature(CriticalPaths,!0,"Gantt");const fromBoxSide$1=["left","left","right","right"],toBoxSide$1=["left","right","left","right"];class Dependencies$1 extends Dependencies{static get $name(){return"Dependencies"}static get defaultConfig(){return{terminalSides:["left","right"],storeClass:DependencyStore$2,highlightDependenciesOnEventHover:!0}}construct(e,t={}){const r=this;e.isGantt&&(r.gantt=e),Object.prototype.hasOwnProperty.call(t,"pathFinderConfig")?(Object.prototype.hasOwnProperty.call(t.pathFinderConfig,"otherHorizontalMargin")||(t.pathFinderConfig.otherHorizontalMargin=0),Object.prototype.hasOwnProperty.call(t.pathFinderConfig,"otherVerticalMargin")||(t.pathFinderConfig.otherVerticalMargin=0)):t.pathFinderConfig={otherHorizontalMargin:0,otherVerticalMargin:0},e.on({projectRefresh:"onProjectRefresh",thisObj:r}),r.added=new Set,super.construct(e,t)}attachToEventStore(e){super.attachToEventStore(e),this.detachListeners("taskStore"),e&&e.on({name:"taskStore",refreshPreCommit:"onTaskStoreRefresh",thisObj:this})}onDependencyChange({action:e,record:t,records:r}){if(!this.client.project.propagatingLoadChanges){switch(e){case"add":return void r.forEach((e=>this.added.add(e)))}super.onDependencyChange(...arguments)}}onTaskStoreRefresh({action:e}){switch(e){case"sort":this.scheduleDraw(!0)}}getIteratableDependencyAssignments(e){return[null]}isDependencyVisible(e,t=null){const{client:r}=this,n=e.fromEvent,i=e.toEvent;if(n&&i&&Object(n)===n&&Object(i)===i)return n instanceof TaskModel&&!t?!n.placeHolder&&r.store.isAvailable(n)&&!i.placeHolder&&r.store.isAvailable(i):super.isDependencyVisible(e,t)}getBox(e,t,r=null){const n=this.getTimeSpanRecordFromDependency(e,t);return this.gantt?this.gantt.getTaskBox(n,!0,!0):n.isEvent||r?super.getBox(e,t,r):n.assignments.length?this.client.getResourceEventBox(n,n.assignments[0].resource,!0):null}getRowRecordFromDependency(e,t){if(!this.gantt){const r=this.getTimeSpanRecordFromDependency(e,t);return r.isEvent?super.getRowRecordFromDependency(e,t):r.assignments.length?r.assignments[0].resource:null}return this.getTimeSpanRecordFromDependency(e,t)}onProjectRefresh(){const{added:e}=this;if(e.size){for(const t of e)this.addToGridCache(t);e.clear()}super.onProjectRefresh(),this.scheduleDraw()}drawLine(e,t,r,n=null,i=!0){super.drawLine(e,t,r,n);const s=super.drawLine(e,t,r,n,i),{client:o}=this,a=t.toEvent;(!a.milestone&&(a.endDate<=o.startDate||o.endDate<=a.startDate)||a.milestone&&(a.endDate<o.startDate||o.endDate<a.startDate))&&s.classList.add("b-sch-dependency-ends-outside")}prepareLineDef(e,t,r=null){const n=this,i=n.getTimeSpanRecordFromDependency(e,!0),s=n.getTimeSpanRecordFromDependency(e,!1),o=e.type,a=this.pathFinder.startArrowMargin;let l=e.fromSide,c=e.toSide;if(!l)switch(!0){case o===DependencyType.StartToEnd:case o===DependencyType.StartToStart:l=n.getConnectorStartSide(i);break;case o===DependencyType.EndToStart:case o===DependencyType.EndToEnd:l=n.getConnectorEndSide(i);break;default:throw new Error("Invalid dependency type: "+o)}if(!c)switch(!0){case o===DependencyType.StartToEnd:c=n.getConnectorEndSide(s);break;case o===DependencyType.StartToStart:case o===DependencyType.EndToStart:c=n.getConnectorStartSide(s);break;case o===DependencyType.EndToEnd:c=n.getConnectorEndSide(s);break;default:throw new Error("Invalid dependency type: "+o)}const{startRectangle:d,endRectangle:u}=t;o===DependencyType.EndToStart&&d.bottom<u.y&&Math.round(d.right)-Math.round(u.x)<=0&&(c="top",e.toEvent.milestone||(u.right=u.x+2*a));const h=n.client.getRecordCoords(i,!0),g=n.client.getRecordCoords(s,!0),m=[{start:d.x,end:d.right,top:h.y,bottom:h.y+h.height},{start:u.x,end:u.right,top:g.y,bottom:g.y+g.height}];return{endBox:{start:d.x,end:d.right,top:d.y,bottom:d.bottom},startBox:{start:u.x,end:u.right,top:u.y,bottom:u.bottom},endSide:l,startSide:c,boxesReversed:!0,otherBoxes:m}}drawForTask(e){this.drawForTimeSpan(e)}getSortedDependenciesToRefresh(){const e=this.client.features.criticalPaths;return e&&!e.disabled?new Map([...this.dependenciesToRefresh].sort((([{fromTask:e}],[{fromTask:t}])=>(null==e?void 0:e.critical)===(null==t?void 0:t.critical)?0:(null==e?void 0:e.critical)?1:-1))):this.dependenciesToRefresh}getHoverTipHtml({activeTarget:e}){const t=this,r=t.resolveDependencyRecord(e);if(!r)return null;const{fromEvent:n,toEvent:i}=r;return TemplateHelper.tpl`
             <table class="b-sch-dependency-tooltip">
                <tr>
                    <td>${t.L("L{Dependencies.from}")}: </td>
                    <td>${n.name} ${n.id}</td>
                    <td><div class="b-sch-box b-${fromBoxSide$1[r.type]}"></div></td>
                </tr>
                <tr>
                    <td>${t.L("L{Dependencies.to}")}: </td>
                    <td>${i.name} ${i.id}</td>
                    <td><div class="b-sch-box b-${toBoxSide$1[r.type]}"></div></td>
                </tr>
            </table>
        `}createDependency(e){const t=e.source,r=e.target,n=e.sourceTerminal.dataset.side,i=e.targetTerminal.dataset.side,s=("left"===n?0:2)+("right"===i?1:0);this.dependencyStore.add({fromEvent:t,toEvent:r,type:s,fromSide:n,toSide:i}),this.dependencyStore.project.propagateAsync()}createMarkers(){super.createMarkers();const e=(this.startMarker||this.endMarker).cloneNode(!0);e.setAttribute("id","arrowEndCritical"),this.client.svgCanvas.appendChild(e)}}Dependencies$1._$name="Dependencies",GridFeatureManager.registerFeature(Dependencies$1,!0,"Gantt");class DependencyEdit$1 extends DependencyEdit{static get $name(){return"DependencyEdit"}static get defaultConfig(){return{showLagField:!0}}}DependencyEdit$1._$name="DependencyEdit",GridFeatureManager.registerFeature(DependencyEdit$1,!1);class Labels$1 extends Labels{static get $name(){return"Labels"}static get pluginConfig(){return{chain:["onTaskDataGenerated"]}}onTaskDataGenerated(e){this.onEventDataGenerated(e)}}Labels$1._$name="Labels",GridFeatureManager.registerFeature(Labels$1,!1,"Gantt");class Indicators extends TooltipBase{static get $name(){return"Indicators"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",forSelector:".b-indicator",recordType:"indicator",hoverDelay:500,defaultIndicators:{earlyDates:e=>e.earlyStartDate&&!e.isMilestone?{startDate:e.earlyStartDate,endDate:e.earlyEndDate,cls:"b-bottom b-early-dates",name:this.L("L{earlyDates}")}:null,lateDates:e=>e.lateStartDate&&!e.isMilestone?{startDate:e.lateStartDate,endDate:e.lateEndDate,cls:"b-bottom b-late-dates",name:this.L("L{lateDates}")}:null,constraintDate:e=>e.constraintDate?{startDate:e.constraintDate,cls:"b-bottom b-constraint-date b-constraint-type-"+e.constraintType,name:this.L(`L{ConstraintTypePicker.${e.constraintType}}`)}:null,deadlineDate:e=>e.deadlineDate?{startDate:e.deadlineDate,cls:"b-bottom b-deadline-date",name:this.L("L{deadlineDate}")}:null},items:{}}}static get pluginConfig(){return{chain:["onTaskDataGenerated","render"]}}construct(e,t={}){this.tipId=e.id+"-indicators-tip",this.gantt=e;const{items:r}=t;delete t.items,super.construct(e,t),this.items=r}set items(e){const t=this;t._indicators=ObjectHelper.assign({},t.defaultIndicators,e),t._indicatorAccessors={},t._indicatorStatus={};for(const e in t._indicators)t._indicatorStatus[e]=Boolean(t._indicators[e]),"function"!=typeof t._indicators[e]&&(t._indicators[e]=t.defaultIndicators[e]),Object.defineProperty(t._indicatorAccessors,e,{enumerable:!0,get:()=>!!t._indicatorStatus[e]&&t._indicators[e],set(r){t._indicatorStatus[e]=r,t.gantt.refresh()}})}get items(){return this._indicatorAccessors}createIndicatorDOMConfig(e,t){const{gantt:r,renderData:n}=this,{taskRecord:i}=n,{cls:s,iconCls:o}=e,a=r.getCoordinateFromDate(e.startDate),l=e.endDate?r.getCoordinateFromDate(e.endDate)-a:null,c=s&&s.isDomClassList?s:new DomClassList(s),d=n.top||r.taskStore.indexOf(i)*r.rowManager.rowOffsetHeight+r.resourceMargin,u=n.height||r.rowHeight-2*r.resourceMargin;return{className:Object.assign(c,{"b-indicator":1,"b-has-icon":e.iconCls}),style:{transform:`translate(${a}px, ${d}px)`,height:u,width:l,style:e.style},dataset:{taskId:`${n.taskId}-indicator-${t}`,title:e.name},children:[o?{tag:"i",className:o}:null],elementData:e}}onTaskDataGenerated(e){const{items:t}=this,r=[];for(const n in t){const i=t[n];if(this._indicatorStatus[n]&&"function"==typeof i){const t=i(e.taskRecord);t&&this.gantt.timeAxis.timeSpanInAxis(t.startDate,t.endDate)&&r.push(t)}}e.extraConfigs.push(...r.map(this.createIndicatorDOMConfig,{gantt:this.gantt,renderData:e}))}resolveTimeSpanRecord(e){return e.lastDomConfig.elementData}template(e){const{indicator:t}=e;return e.endDate?`\n                ${t.name?`<div class="b-gantt-task-title">${t.name}</div>`:""}\n                <table border="0" cellspacing="0" cellpadding="0">\n                    <tr><td>${this.L("L{Start}")}:</td><td>${e.startClockHtml}</td></tr>\n                    <tr><td>${this.L("L{End}")}:</td><td>${e.endClockHtml}</td></tr>\n                </table>\n            `:`\n            ${t.name?`<div class="b-gantt-task-title">${t.name}</div>`:""}\n            ${e.startText}\n        `}}Indicators._$name="Indicators",GridFeatureManager.registerFeature(Indicators,!1);class ProgressLine extends(Delayable(InstancePlugin)){static get $name(){return"ProgressLine"}static get defaultConfig(){return{statusDate:new Date,drawLineOnlyWhenStatusDateVisible:!1,lineCls:"b-gantt-progress-line",containerCls:"b-progress-line-canvas"}}static get pluginConfig(){return{chain:["onPaint"]}}construct(e,t={}){const r=this;r.scheduleDraw=r.createOnFrame("draw",[],r,!0),super.construct(e,t),this.lineSegments=[]}doDisable(e){const t=this;t.attachToClient(e?null:t.client),t.client.rendered&&t.draw(),super.doDisable(e)}get statusDate(){return this._statusDate}set statusDate(e){e instanceof Date&&(this._statusDate=e,this.disabled||this.scheduleDraw())}getSVGCanvas(){const e=this,{client:t}=e;if(!e._svgCanvas){const r=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");r.retainElement=!0,r.classList.add(e.containerCls),t.foregroundCanvas.appendChild(r)}return e._svgCanvas}attachToProject(e){const t=this;t.detachListeners("project"),e&&e.on({name:"project",refresh:t.onProjectRefresh,thisObj:t})}attachToRowManager(e){const t=this;t.detachListeners("rowManager"),e&&e.on({name:"rowManager",translaterow:t.onTranslateRow,refresh:t.scheduleDraw,rerender:t.scheduleDraw,changetotalheight:t.scheduleDraw,thisObj:t})}attachToClient(e){const t=this;t.detachListeners("client"),e&&e.on({name:"client",horizontalscroll:t.scheduleDraw,togglenode:t.scheduleDraw,taskdrag:t.onTaskDrag,taskdragabort:t.scheduleDraw,aftertaskdrop:t.scheduleDraw,timelineviewportresize:t.scheduleDraw,thisObj:t}),t.attachToProject(null==e?void 0:e.project),t.attachToRowManager(null==e?void 0:e.rowManager)}onPaint(){this.attachToProject(this.disabled?null:this.client.project)}onProjectRefresh(){this.scheduleDraw()}onTranslateRow({row:e}){e.lastTop>=0&&e.top!==e.lastTop&&this.scheduleDraw()}onTaskDrag({taskRecords:e,dragData:t}){e.forEach((e=>{this.updateLineForTask(e,{[e.id]:DateHelper.add(e.startDate,t.timeDiff)})}))}shouldDrawProgressLine(){return!this.client.timeAxisSubGrid.collapsed&&!this.disabled&&(!this.drawLineOnlyWhenStatusDateVisible||this.client.timeAxis.dateInAxis(this.statusDate))}getStatusDateX(){let{statusDate:e}=this;const{client:t}=this;return t.timeAxis.dateInAxis(e)||(e=e<t.timeAxis.startDate?t.timeAxis.startDate:t.timeAxis.endDate),t.getCoordinateFromDate(e)}getRenderData(){const e=this.getStatusDateX(),t=this.client.timeAxisSubGridElement.getBoundingClientRect();return{statusDateX:e,viewXY:[this.client.scrollLeft-t.left,-t.top]}}draw(){const e=this,{client:t}=e;if(e.lineSegments.forEach((e=>e.remove())),e.lineSegments=[],!e.shouldDrawProgressLine())return;if(t.isAnimating)return void t.on({transitionend(){e.scheduleDraw()},once:!0});const r=e.getRenderData(),n=[];t.rowManager.forEach((t=>{n.push(...e.getLineSegmentRenderData(t,r))})),n.forEach((t=>e.drawLineSegment(t))),t.trigger("progressLineDrawn")}segmentBelongsToTask(e,t){return e.dataset.taskId==t.id}updateLineForTask(e,t){const r=this;if(r.disabled)return;const n=r.client.getRowFor(e);if(n){const i=[];r.lineSegments.forEach((t=>{r.segmentBelongsToTask(t,e)&&(i.push(t),t.remove())})),ArrayHelper.remove(r.lineSegments,...i),r.getLineSegmentRenderData(n,r.getRenderData(),t).forEach((e=>r.drawLineSegment(e)))}}getLineSegmentRenderData(e,t,r={}){const n=this,{statusDateX:i,viewXY:s}=t,o=n.client.getRecordFromElement(e.elements.normal),a=o.id,l=[];let c;return n.isStatusLineTask(o,r[o.id])&&(c=n.calculateCoordinateForTask(o,s),c&&l.push({dataset:{taskId:a},x1:i,y1:e.top,x2:c.x,y2:c.y},{dataset:{taskId:a},x1:c.x,y1:c.y,x2:i,y2:e.bottom})),c||l.push({dataset:{taskId:a},x1:i,y1:e.top,x2:i,y2:e.bottom}),l}drawLineSegment(e){const t=this;t.lineSegments.push(DomHelper.createElement(Object.assign({tag:"line",ns:"http://www.w3.org/2000/svg",class:t.lineCls,parent:t.getSVGCanvas()},e)))}isStatusLineTask(e,t){const r=this.statusDate;return t=t||e.startDate,e&&this.client.timeAxis.isTimeSpanInAxis(e)&&!e.milestone&&(e.isInProgress||!e.isStarted&&t<r||e.isCompleted&&t>r)}calculateCoordinateForTask(e,t){const{client:r}=this,n=r.getElementFromTaskRecord(e),i=null==n?void 0:n.querySelector(".b-task-percent-bar");if(i){const e=i.getBoundingClientRect(),n=r.timeAxisViewModel.totalSize;return{x:Math.min(e.right+t[0],n),y:e.top+e.height/2+t[1]}}}}ProgressLine._$name="ProgressLine",GridFeatureManager.registerFeature(ProgressLine);class ProjectLines extends AbstractTimeRanges{static get $name(){return"ProjectLines"}static get defaultConfig(){return{showHeaderElements:!0,cls:"b-gantt-project-line"}}startConfigure(){}onPaint(){const e=this;[e.startDateLine,e.endDateLine]=e.store.add([{name:e.L("L{Project Start}")},{name:e.L("L{Project End}")}]),e.updateDateFromProject(),e.client.project.on({name:"project",refresh:e.onProjectRefresh,thisObj:e}),super.onPaint()}updateLocalization(){const e=this;e.client.rendered&&(e.startDateLine.name=e.L("L{Project Start}"),e.endDateLine.name=e.L("L{Project End}"))}updateDateFromProject(){const{project:e}=this.client;this.startDateLine.startDate=e.startDate,this.endDateLine.startDate=e.endDate}onProjectRefresh(){this.updateDateFromProject()}}ProjectLines._$name="ProjectLines",GridFeatureManager.registerFeature(ProjectLines,!0,"Gantt");const rollupCls="b-task-rollup",rollupSelector="."+rollupCls;class Rollups extends TooltipBase{static get $name(){return"Rollups"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:rollupSelector}}static get pluginConfig(){return{chain:["onTaskDataGenerated","render"]}}construct(e,t){this.tipId=e.id+"-rollups-tip",super.construct(e,t)}attachToTaskStore(e){this.detachListeners("taskStore"),e&&e.on({name:"taskStore",update:"onStoreUpdateRecord",thisObj:this})}doDestroy(){this.attachToTaskStore(null),super.doDestroy()}doDisable(e){const t=this,{dependencies:r}=t.client.features;t.tooltip&&(t.tooltip.disabled=e),t.attachToTaskStore(e?null:t.client.taskStore),t.client.refresh(),r&&t.client.setTimeout((()=>r.scheduleDraw(!0)),300),super.doDisable(e)}getTipHtml({activeTarget:e,event:t}){const{client:r}=this,n=r.resolveTaskRecord(e),i=BrowserHelper.isEdge||BrowserHelper.isIE11,s=document[i?"msElementsFromPoint":"elementsFromPoint"](t.pageX+window.pageXOffset,t.pageY+window.pageYOffset),o=Array.from(s).filter((e=>e.classList.contains(rollupCls))).sort(((e,t)=>parseInt(e.dataset.index,10)-parseInt(t.dataset.index,10))),a=[];for(const e of o)a.push(n.children[parseInt(e.dataset.index,10)]);return this.template({task:n,children:a})}template({children:e}){const t=this,{client:r}=t,n=[];return e.map(((e,i)=>{const{startDate:s,endDate:o}=e,a=r.getFormattedDate(s),l=r.getDisplayEndDate(o,s),c=r.getFormattedDate(l);n.push(`<div class="b-gantt-task-title ${i?"b-follow-on":""}">${e.name}</div><table>`,`<tr><td>${t.L("L{TaskTooltip.Start}")}:</td><td>${t.clockTemplate.template({date:s,text:a,cls:"b-sch-tooltip-startdate"})}</td></tr>`,`<tr><td>${t.L("L{TaskTooltip.End}")}:</td><td>${e.isMilestone?"":t.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})}</td></tr></table>`)})),n.join("")}onStoreUpdateRecord({record:e,changes:t}){this.client.project.propagatingLoadChanges||e.parent&&(t.rollup||t.startDate||t.endDate)&&this.client.taskRendering.redraw(e.parent)}onTaskDataGenerated({taskRecord:e,left:t,wrapperChildren:r}){if(!this.disabled&&e.isParent){const n=e.children.slice().sort(((e,t)=>t.durationMS-e.durationMS));r.push({className:rollupCls+"-wrap",dataset:{taskFeature:"rollups"},children:n.map((e=>{if(e.rollup){const r=this.client.getSizeAndPosition(e);if(!r)return null;const{position:n,width:i}=r;return{dataset:{index:e.parentIndex,rollupTaskId:e.id},className:`${rollupCls} ${e.isMilestone?"b-milestone":""} ${e.cls}`,style:{width:e.isMilestone?null:i,left:n-t}}}return null})),syncOptions:{syncIdField:"rollupTaskId"}})}}}Rollups._$name="Rollups",GridFeatureManager.registerFeature(Rollups,!1,"Gantt");class TaskEditor extends GanttTaskEditor{static get type(){return"taskeditor"}static get $name(){return"TaskEditor"}static get defaultConfig(){return{cls:"b-gantt-taskeditor b-schedulerpro-taskeditor"}}afterConfigure(){super.afterConfigure(),"durationDecimalPrecision"in this&&VersionHelper.deprecate("gantt","5.0.0","`durationDecimalPrecision` is deprecated, in favor of `durationDisplayPrecision`")}}TaskEditor.initClass(),TaskEditor._$name="TaskEditor";class TaskEdit$1 extends TaskEdit{static get $name(){return"TaskEdit"}static get defaultConfig(){return{triggerEvent:"taskdblclick",saveAndCloseOnEnter:!0,tabsConfig:null,editorClass:TaskEditor}}static get pluginConfig(){return{chain:["populateTaskMenu","onTaskEnterKey"],assign:["editTask"]}}editTask(e,t){return this.editEvent(e,null,t)}onActivateEditor({taskRecord:e,taskElement:t}){this.editTask(e,t)}getElementFromTaskRecord(e){return this.client.getElementFromTaskRecord(e)}onTaskEnterKey({taskRecord:e}){this.editTask(e)}populateTaskMenu({taskRecord:e,selection:t,items:r}){!this.client.readOnly&&t.length<=1&&(r.editTask={text:"L{Gantt.Edit}",localeClass:this.client,cls:"b-separator",icon:"b-icon b-icon-edit",weight:100,disabled:this.disabled,onItem:()=>this.editTask(e)})}onEventEnterKey({taskRecord:e,target:t}){this.editTask(e)}scrollTaskIntoView(e){this.scrollEventIntoView(e)}scrollEventIntoView(e){this.client.scrollTaskIntoView(e)}}TaskEdit$1._$name="TaskEdit",GridFeatureManager.registerFeature(TaskEdit$1,!0,"Gantt");class TaskMenu extends EventMenu{static get $name(){return"TaskMenu"}static get defaultConfig(){return{type:"task"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTaskMenu"),e}construct(e,t){super.construct(...arguments),this.gantt=e,e.features.cellMenu&&(console.warn("`CellMenu` feature is ignored, when `TaskMenu` feature is enabled. If you need cell specific menu items, please configure `TaskMenu` feature items instead."),e.features.cellMenu.disabled=!0)}getDataFromEvent(e){const{client:t}=this,r=this.getTargetElementFromEvent(e),n=t.resolveTaskRecord(r)||t.getRecordFromElement(r),i=n&&t.getElementFromTaskRecord(n,!1),s=t.getCellDataFromEvent(e);return ObjectHelper.assign({event:e,targetElement:r,taskElement:i,taskRecord:n},s)}callChainablePopulateMenuMethod(e){e.cellData&&this.client.populateCellMenu&&this.client.populateCellMenu(e),super.callChainablePopulateMenuMethod(...arguments)}shouldShowMenu(e){const{column:t}=e;return e.taskRecord&&(!t||!1!==t.enableCellContextMenu)}getElementFromRecord(e){return this.client.getElementFromTaskRecord(e)}populateTaskMenu({items:e,column:t,selection:r,taskRecord:n}){const{client:i}=this,s=r.includes(n)&&r.length>1;Object.assign(e,{add:{text:"L{Gantt.Add}",cls:"b-separator",icon:"b-icon-add",hidden:s,weight:500,menu:{addTaskAbove:{text:"L{Gantt.Task above}",weight:510,icon:"b-icon-up",onItem({taskRecord:e}){i.addTaskAbove(e)}},addTaskBelow:{text:"L{Gantt.Task below}",weight:520,icon:"b-icon-down",onItem({taskRecord:e}){i.addTaskBelow(e)}},milestone:{text:"L{Gantt.Milestone}",weight:530,icon:"b-fa-flag",name:"milestone",onItem({taskRecord:e}){i.addMilestonBelow(e)}},subtask:{text:"L{Gantt.Sub-task}",weight:540,name:"subtask",onItem({taskRecord:e}){i.addSubtask(e)}},successor:{text:"L{Gantt.Successor}",weight:550,onItem({taskRecord:e}){i.addSuccessor(e)}},predecessor:{text:"L{Gantt.Predecessor}",weight:560,name:"predecessor",onItem({taskRecord:e}){i.addPredecessor(e)}}}},convertToMilestone:{icon:"b-icon-milestone",text:"L{Gantt.Convert to milestone}",weight:600,hidden:n.isParent||n.milestone,onItem({taskRecord:e}){e.convertToMilestone()}},indent:{text:"L{Gantt.Indent}",icon:"b-fa-indent",disabled:!n.previousSibling,weight:700,onItem({selection:e,taskRecord:t}){i.indent(e.includes(t)?e:t)}},outdent:{text:"L{Gantt.Outdent}",icon:"b-fa-outdent",disabled:n.parent===i.taskStore.rootNode,weight:800,onItem({selection:e,taskRecord:t}){i.outdent(e.includes(t)?e:t)}},deleteTask:{text:"L{Gantt.Delete task}",icon:"b-icon-trash",name:"deleteTask",cls:"b-separator",weight:900,onItem({selection:e,taskRecord:t}){i.taskStore.remove(e.includes(t)?e:t)}}}),(null==t?void 0:t.cellMenuItems)&&ObjectHelper.merge(e,t.cellMenuItems)}}TaskMenu.featureClass="",TaskMenu._$name="TaskMenu",GridFeatureManager.registerFeature(TaskMenu,!0,"Gantt");class TaskContextMenu extends TaskMenu{static get $name(){return"TaskContextMenu"}construct(e,t){super.construct(...arguments),VersionHelper.deprecate("Gantt","5.0.0","`TaskContextMenu` feature is deprecated, in favor of `TaskMenu` feature. Please see https://bryntum.com/docs/gantt/#guides/upgrades/4.0.0.md#context-menu for more information."),e.features.taskMenu&&(e.features.taskMenu.disabled=!0),e.features.contextMenu&&(e.showRemoveRowInContextMenu=!1,e.features.contextMenu.disableCellContextMenu=!0)}resolveRecord(e){return this.client.resolveTaskRecord(e)||this.client.getRecordFromElement(e)}showContextMenuFor(e,{targetElement:t,eventElement:r,event:n}={}){const{client:i}=this;if(e&&(t||(t=i.getElementFromTaskRecord(e)))){if(n){const e=i.getEventData(n);if(!e)return;const t=i.columns.getById(e.columnId);if(!r&&t&&!t.enableCellContextMenu)return}this.showContextMenu({menuType:"task",taskElement:t,targetElement:t,taskRecord:e,event:n})}}}TaskContextMenu.featureClass="",TaskContextMenu._$name="TaskContextMenu",GridFeatureManager.registerFeature(TaskContextMenu);class TaskTooltip extends TooltipBase{static get $name(){return"TaskTooltip"}static get defaultConfig(){return{template(e){const t=this,{taskRecord:r}=e,n=t.client.formatDuration(r.duration,t.decimalPrecision);return`\n                    ${r.name?`<div class="b-gantt-task-title">${r.name}</div>`:""}\n                    <table border="0" cellspacing="0" cellpadding="0">\n                    <tr><td>${t.L("L{Start}")}:</td><td>${e.startClockHtml}</td></tr>\n                    ${r.milestone?"":`\n                        <tr><td>${t.L("L{End}")}:</td><td>${e.endClockHtml}</td></tr>\n                        <tr><td>${t.L("L{Duration}")}:</td><td class="b-right">${n+" "+DateHelper.getLocalizedNameOfUnit(r.durationUnit,1!==r.duration)}</td></tr>\n                        <tr><td>${t.L("L{Complete}")}:</td><td class="b-right">${r.renderedPercentDone}%</td></tr>\n                    `}\n                    </table>\n                `},decimalPrecision:null,cls:"b-gantt-task-tooltip"}}}TaskTooltip._$name="TaskTooltip",GridFeatureManager.registerFeature(TaskTooltip,!0,"Gantt");var GanttExporterMixin=e=>class extends e{async prepareComponent(e){await super.prepareComponent(e);const t=this.element.querySelector(".b-sch-foreground-canvas");DomHelper.removeEachSelector(t,".b-gantt-task-wrap"),DomHelper.removeEachSelector(t,".b-released")}collectEvents(e,t){const r=e.length,{client:n}=t,i=this.exportMeta.subGrids.normal.rows;e.forEach(((e,t)=>{const s=i[i.length-r+t],o=n.store.getAt(e.dataIndex),a=s[3];if(o.isScheduled){const e=n.getElementFromTaskRecord(o,!1);e&&!a.has(o.id)&&a.set(o.id,[e.outerHTML,Rectangle.from(e.firstChild,e.offsetParent)])}}))}};class MultiPageExporter$2 extends(GanttExporterMixin(MultiPageExporter$1)){static get $name(){return"MultiPageExporter"}}MultiPageExporter$2._$name="MultiPageExporter";class MultiPageVerticalExporter$2 extends(GanttExporterMixin(MultiPageVerticalExporter$1)){static get $name(){return"MultiPageVerticalExporter"}}MultiPageVerticalExporter$2._$name="MultiPageVerticalExporter";class SinglePageExporter$2 extends(GanttExporterMixin(SinglePageExporter$1)){static get $name(){return"SinglePageExporter"}}SinglePageExporter$2._$name="SinglePageExporter";class PdfExport$2 extends PdfExport$1{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[SinglePageExporter$2,MultiPageExporter$2,MultiPageVerticalExporter$2]}}}PdfExport$2._$name="PdfExport",GridFeatureManager.registerFeature(PdfExport$2,!1,"Gantt");class CalendarIntervalModel$1 extends CalendarIntervalModel{}CalendarIntervalModel$1._$name="CalendarIntervalModel";class CalendarModel$1 extends CalendarModel{}CalendarModel$1._$name="CalendarModel";var __decorate$x=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class HasCriticalPathsMixin extends(Mixin([HasChildrenMixin],(e=>{e.prototype;class t extends e{*calculateCriticalPaths(){const e=[],t=[],r=[...yield this.$.childEvents],n=yield this.$.endDate;let i,s;for(;i=r.shift();){const e=yield i.$.childEvents,s=yield i.$.critical;i.endDate-n==0&&s&&t.push([{event:i}]),r.push(...e)}for(;s=t.shift();){let r,n=s.length-1;for(;r=s[n];){const e=[];for(const t of yield r.event.$.incomingDeps){const r=yield t.$.fromEvent;r&&(yield r.$.critical)&&e.push({event:r,dependency:t})}if(e.length){const r=s.slice();s.push(e[0]);for(let n=1;n<e.length;n++)t.push(r.concat(e[n]));n++}else n=-1}e.push(s.reverse())}return e}}return __decorate$x([field({lazy:!0})],t.prototype,"criticalPaths",void 0),__decorate$x([calculate("criticalPaths")],t.prototype,"calculateCriticalPaths",null),t}))){}class GanttProjectMixin extends(Mixin([SchedulerProProjectMixin,HasEffortMixin,ConstrainedLateEventMixin,HasCriticalPathsMixin],(e=>{const t=e.prototype;return class extends e{*calculateDirection(){return yield ProposedOrPrevious}*calculateStartDate(){const e=yield this.$.direction;if(e===Direction.Forward){let e=yield ProposedOrPrevious;return e||(e=yield*this.unsafeCalculateInitialMinChildrenStartDateDeep()),e}if(e===Direction.Backward)return yield*this.calculateMinChildrenStartDate()}*calculateEndDate(){const e=yield this.$.direction;if(e===Direction.Forward)return yield*this.calculateMaxChildrenEndDate();if(e===Direction.Backward){let e=yield ProposedOrPrevious;return e||(e=yield*this.unsafeCalculateInitialMaxChildrenEndDateDeep()),e}}*calculateEarlyStartDateConstraintIntervals(){const e=yield*t.calculateEarlyStartDateConstraintIntervals.call(this),r=yield this.$.direction;if(r===Direction.Forward){const t=yield this.$.startDate;t&&e.push(DateInterval.new({startDate:t}))}else if(r===Direction.Backward){const t=yield this.$.lateStartDate;t&&e.push(DateInterval.new({startDate:t}))}return e}*calculateLateEndDateConstraintIntervals(){const e=yield*t.calculateLateEndDateConstraintIntervals.call(this),r=yield this.$.direction;if(r===Direction.Forward){const t=yield this.$.earlyEndDate;t&&e.push(DateInterval.new({endDate:t}))}else if(r===Direction.Backward){const t=yield this.$.endDate;t&&e.push(DateInterval.new({endDate:t}))}return e}getDefaultEventModelClass(){return GanttEvent}getDefaultAssignmentModelClass(){return GanttAssignmentMixin}getDefaultResourceModelClass(){return SchedulerProResourceMixin}getDefaultEventStoreClass(){return ChronoEventTreeStoreMixin}getType(){return ProjectType.Gantt}*unsafeCalculateInitialMinChildrenStartDateDeep(){const e=yield this.$.childEvents;if(!e.size)return yield UnsafeProposedOrPreviousValueOf(this.$.startDate);let t,r=MAX_DATE;const n=[...e];for(;t=n.shift();){const e=yield UnsafeProposedOrPreviousValueOf(t.$.startDate);e&&e<r&&(r=e),n.push(...yield t.$.childEvents)}return r.getTime()!==MIN_DATE$1.getTime()&&r.getTime()!==MAX_DATE.getTime()?r:null}*unsafeCalculateInitialMaxChildrenEndDateDeep(){const e=yield this.$.childEvents;if(!e.size)return yield UnsafeProposedOrPreviousValueOf(this.$.endDate);let t,r=MIN_DATE$1;const n=[...e];for(;t=n.shift();){const e=yield UnsafeProposedOrPreviousValueOf(t.$.endDate);e&&e>r&&(r=e),n.push(...yield t.$.childEvents)}return r.getTime()!==MIN_DATE$1.getTime()&&r.getTime()!==MAX_DATE.getTime()?r:null}}}))){}class CalendarManagerStore$1 extends CalendarManagerStore{static get defaultConfig(){return{modelClass:CalendarModel$1}}}CalendarManagerStore$1._$name="CalendarManagerStore";class ProjectModel$2 extends(ProjectCrudManager(GanttProjectMixin.derive(Model))){static get defaults(){return{expanded:!0}}static get defaultConfig(){return{eventModelClass:TaskModel,taskModelClass:TaskModel,dependencyModelClass:DependencyModel$2,resourceModelClass:ResourceModel$2,assignmentModelClass:AssignmentModel$2,calendarModelClass:CalendarModel$1,eventStoreClass:TaskStore,taskStoreClass:TaskStore,dependencyStoreClass:DependencyStore$2,resourceStoreClass:ResourceStore$2,assignmentStoreClass:AssignmentStore$2,calendarManagerStoreClass:CalendarManagerStore$1,tasksData:null,eventsData:null,dependenciesData:null,resourcesData:null,assignmentsData:null,calendarsData:null,timeRangeStore:null,convertEmptyParentToLeaf:!1}}construct(...e){const t=e[0]||{};e[0]=t,"tasksData"in t&&(t.eventsData=t.tasksData,delete t.tasksData),"taskStore"in t&&(t.eventStore=t.taskStore,delete t.taskStore),t.eventModelClass=t.taskModelClass||t.eventModelClass||this.defaultEventModelClass,t.eventStoreClass=t.taskStoreClass||t.eventStoreClass||this.defaultEventStoreClass,t.timeRangeStore||(t.timeRangeStore={modelClass:TimeSpan,storeId:"timeRanges"}),super.construct(...e)}get defaultEventModelClass(){return TaskModel}get defaultEventStoreClass(){return TaskStore}get taskStore(){return this.getEventStore()}get timeRangeStore(){return this._timeRangeStore}set timeRangeStore(e){const t=this;t._timeRangeStore=Store.getStore(e,Store),t._timeRangeStore.storeId||(t._timeRangeStore.storeId="timeRanges")}async tryInsertChild(){return this.tryPropagateWithChanges((()=>{this.insertChild(...arguments)}))}toJSON(){return{eventsData:this.eventStore.toJSON(),resourcesData:this.resourceStore.toJSON(),dependenciesData:this.dependencyStore.toJSON(),assignmentsData:this.assignmentStore.toJSON()}}get json(){return super.json}set json(e){"string"==typeof e&&(e=StringHelper.safeJsonParse(e)),this.loadInlineData(e)}afterChange(e,t){super.afterChange(...arguments),t.calendar&&this.trigger("calendarChange")}refreshWbs(e){var t;const r=this,n=null!==(t=r.unfilteredChildren)&&void 0!==t?t:r.children;var i;n&&n.length&&(null===(i=n[0].refreshWbs)||void 0===i||i.call(r,e,-1))}}ProjectModel$2.applyConfigs=!0,ProjectModel$2._$name="ProjectModel";const today=new Date,firstDateOfThisYear=new Date(today.getFullYear(),0,1),rnd=new RandomGenerator;function getNum(e,t){return parseInt(""+e+t)}class ProjectGenerator{static async generateAsync(e,t,r=null,n=firstDateOfThisYear,i=!0){const s={startDate:n,tasksData:[],dependenciesData:[]},o=Math.ceil(e/10),a=Math.ceil(t/10),l=this.generateBlocks(o,a,s.startDate);let c=0,d=0,u=0,h=0;i&&console.time("generate");for(const e of l)s.tasksData.push(...e.tasksData),s.dependenciesData.push(...e.dependenciesData),e.projectDuration&&(d=Math.max(e.projectDuration,d)),u+=e.taskCount,h+=e.dependencyCount,++c%1e3==0&&(null==r||r(u,h,!1),await AsyncHelper.animationFrame());return null==r||r(u,h,!0),s.endDate=DateHelper.add(s.startDate,Math.max(d,30),"days"),i&&console.timeEnd("generate"),s}static*generateBlocks(e,t,r){let n=1,i=1,s=0,o=0;function a(e=!0){const t=rnd.nextRandom(5)+2;return e&&(o+=t),t}for(let l=0;l<e;l++){const e=n,c={tasksData:[{id:n++,name:"Parent "+e,startDate:r,expanded:!0,children:[{id:n++,name:"Sub-parent "+getNum(e,1),startDate:r,expanded:!0,children:[{id:n++,name:"Task "+getNum(e,11),startDate:r,duration:a(),percentDone:rnd.nextRandom(100)},{id:n++,name:"Task "+getNum(e,12),startDate:r,duration:a(),percentDone:rnd.nextRandom(100)},{id:n++,name:"Task "+getNum(e,13),startDate:r,duration:a(),percentDone:rnd.nextRandom(100)},{id:n++,name:"Task "+getNum(e,14),startDate:r,duration:a(),percentDone:rnd.nextRandom(100)}]},{id:n++,name:"Sub-parent "+getNum(e,2),startDate:r,expanded:!0,children:[{id:n++,name:"Task "+getNum(e,21),startDate:r,duration:a(),percentDone:rnd.nextRandom(100)},{id:n++,name:"Task "+getNum(e,22),startDate:r,duration:a(),percentDone:rnd.nextRandom(100)},{id:n++,name:"Task "+getNum(e,23),startDate:r,duration:a(),percentDone:rnd.nextRandom(100)}]}]}],dependenciesData:[{id:i++,fromEvent:e+2,toEvent:e+3},{id:i++,fromEvent:e+3,toEvent:e+4},{id:i++,fromEvent:e+4,toEvent:e+5},{id:i++,fromEvent:e+5,toEvent:e+7},{id:i++,fromEvent:e+7,toEvent:e+8},{id:i++,fromEvent:e+8,toEvent:e+9}],taskCount:10,dependencyCount:5};s+=o,o=0,c.projectDuration=s,l%t!=0?(c.dependenciesData.push({id:i++,fromEvent:e-2,toEvent:e+2,type:2,lag:0,lagUnit:"d"}),c.dependencyCount++):s=0,n++,yield c}}}ProjectGenerator._$name="ProjectGenerator";const releaseEventActions$2={releaseElement:1,reuseElement:1},renderEventActions$2={newElement:1,reuseOwnElement:1,reuseElement:1},horizontalTickBuffer=100;class NewTaskRendering extends Base{static get properties(){return{rowMap:new Map}}construct(e){this.gantt=e,e.rowManager.on({renderDone:"onRenderDone",removeRows:"onRemoveRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:this}),super.construct({})}init(){}bindTaskStore(){}refreshRows(){}onTimeAxisViewModelUpdate(){this.updateFromHorizontalScroll(this.gantt.timeAxisSubGrid.scrollable.x)}onViewportResize(){}onDragAbort(){}onBeforeRowHeightChange(e){const{gantt:t}=this;var r;t.foregroundCanvas&&(t.foregroundCanvas.style.fontSize=(null!==(r=null==e?void 0:e.height)&&void 0!==r?r:t.rowHeight)-2*t.resourceMargin+"px")}get visibleDateRange(){return this._visibleDateRange}getTaskBox(e,t=!1,r=!1){const{gantt:n}=this;if(r){const t=this.getElementFromTaskRecord(e);if(t)return Rectangle.from(t,n.timeAxisSubGridElement)}if(!e.startDate||!e.endDate||e.isTask&&(n.taskStore.isDestroyed||!n.taskStore.isAvailable(e)))return null;const i=this.getSizeAndPosition(e,t,r);if(!i)return null;const{position:s,width:o}=i,a=n.taskStore.indexOf(e)*n.rowManager.rowOffsetHeight+n.resourceMargin,l=n.rowHeight-2*n.resourceMargin;return new Rectangle(s,a,o,l)}getSizeAndPosition(e,t,r){const{gantt:n}=this,{timeAxis:i}=n,s=i.startDate,o=i.endDate,a=e.startDate,l=e.endDate||(null!=e.duration?DateHelper.add(a,e.duration,e.durationUnit):null),c=e.milestone,d=c?n.features.dependencies.pathFinder.startArrowMargin:0;let u,h;if(!t&&(l<s||a>o))return null;if(t&&a<s)u=n.getCoordinateFromDate(s)-d;else if(t&&a>o)u=n.getCoordinateFromDate(o)+d;else if(a<s){const t=n.timeAxisViewModel.getSingleUnitInPixels("second"),r=(i.startMS-e.startDateMS)/1e3*t;u=n.getCoordinateFromDate(s)-r}else u=n.getCoordinateFromDate(a);if(!c)if(t&&l<s)h=n.getCoordinateFromDate(s)-d;else if(t&&l>o)h=n.getCoordinateFromDate(o)+d;else if(l>o){const t=n.timeAxisViewModel.getSingleUnitInPixels("second"),r=(e.endDateMS-i.endMS)/1e3*t;h=n.getCoordinateFromDate(o)+r}else h=n.getCoordinateFromDate(l);let g=c?0:h-u;return r&&c&&a>s&&a<o&&(g=n.rowHeight-2*n.resourceMargin,u-=g/2),!t&&u+g<0?null:{position:u,width:g}}getRowRegion(e,t,r){const{gantt:n}=this,i=n.getRowFor(e);if(!i)return null;const s=i.getElement(n.timeAxisSubGrid.region),o=n.timeAxis.startDate,a=n.timeAxis.endDate,l=t?DateHelper.max(o,t):o,c=r?DateHelper.min(a,r):a,d=n.getCoordinateFromDate(l),u=n.getCoordinateFromDate(c,!0,!0),h=i.top+n.scrollTop,g=Math.min(d,u),m=h+s.offsetHeight;return new Rectangle(g,h,Math.max(d,u)-g,m-h)}getDateFromXY(e,t,r){let n=e[0];return r||(n=this.translateToScheduleCoordinate(n)),this.gantt.timeAxisViewModel.getDateFromPosition(n,t)}translateToScheduleCoordinate(e){return e-Math.floor(this.gantt.timeAxisSubGridElement.getBoundingClientRect().left)+this.gantt.scrollLeft}translateToPageCoordinate(e){const t=this.gantt.timeAxisSubGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}getElementFromTaskRecord(e,t=!0){const r=this.gantt.rowManager.getRowFor(e);if(r&&this.rowMap.has(r)){var n;const e=null===(n=this.rowMap.get(r)[0])||void 0===n?void 0:n._element;if(e)return t?e.syncIdMap.task:e}return null}getConnectorStartSide(e){return"left"}getConnectorEndSide(e){return"right"}onRemoveRows({rows:e}){e.forEach((e=>this.rowMap.delete(e))),this.onRenderDone()}updateFromHorizontalScroll(e){const{gantt:t}=this,r=t.timeAxisSubGrid.width,n=t.getDateFromCoordinate(Math.max(0,e-100)),i=t.getDateFromCoordinate(e+r+100)||t.endDate,s=t.getDateFromCoordinate(e)||t.startDate,o=t.getDateFromCoordinate(e+r)||t.endDate;this._visibleDateRange={startDate:s,endDate:o},t.timeView.range={startDate:n,endDate:i},t.trigger("visibleRangeChange",{startDate:n,endDate:i})}populateTaskRenderData(e,t){const{gantt:r}=this,n=!(!r.features.baselines||!r.features.baselines.disabled),i={className:"b-gantt-task-content",dataset:{taskBarFeature:"content"},children:[]};if(e){let s=void 0===t.isResizable||t.isResizable;e.startsOutsideView&&(!0===s?s="end":"start"===s&&(s=!1)),e.endsOutsideView&&(!0===s?s="start":"end"===s&&(s=!1)),Object.assign(e,{iconCls:new DomClassList(t.taskIconCls),id:r.getEventRenderId(t),style:t.style||"",taskId:t.id,wrapperCls:new DomClassList({[r.eventCls+"-wrap"]:1,[r.eventCls+"-parent"]:t.isParent,"b-milestone-wrap":t.milestone,"b-has-baselines":t.hasBaselines&&!n}),cls:t.isResourceTimeRange?new DomClassList:t.cls.clone(),extraConfigs:[]}),Object.assign(e.cls,{[r.eventCls]:1,[r.generatedIdCls]:t.hasGeneratedId,[r.dirtyCls]:t.modifications,[r.committingCls]:t.isCommitting,[r.endsOutsideViewCls]:e.endsOutsideView,[r.startsOutsideViewCls]:e.startsOutsideView,[r.fixedEventCls]:!1===t.isDraggable,["b-sch-event-resizable-"+s]:1,"b-milestone":t.milestone,"b-task-started":t.percentDone>0,"b-task-finished":t.isCompleted,"b-task-selected":r.selectedRecords.includes(t)});const o=t.eventStyle||r.eventStyle,a=t.eventColor||r.eventColor;if(e.eventColor=a,e.eventStyle=o,r.taskRenderer){const n=r.taskRenderer.call(r.taskRendererThisObj||r,{taskRecord:t,tplData:e,renderData:e});"string"==typeof e.cls&&(e.cls=new DomClassList(e.cls)),"string"==typeof e.iconCls&&(e.iconCls=new DomClassList(e.iconCls)),"string"==typeof e.wrapperCls&&(e.wrapperCls=new DomClassList(e.wrapperCls));let s=null;"string"==typeof n&&n.includes("<")?s={html:n}:"string"==typeof n||"object"==typeof n?s=n:null!=n&&(s=String(n)),s&&(Array.isArray(s)?i.children.push(...s):i.children.push(s),e.cls.add("b-has-content"))}e.cls["b-sch-event-withicon"]=e.iconCls.length,e.wrapperCls["b-sch-style-"+e.eventStyle]=e.eventStyle,e.eventColor&&e.eventColor.startsWith("#")?e.style=`background-color:${e.eventColor};`+e.style:e.wrapperCls["b-sch-color-"+e.eventColor]=e.eventColor,e.iconCls&&e.iconCls.length&&i.children.unshift({tag:"i",className:e.iconCls}),(i.children.length||t.milestone)&&e.children.push(i)}e.taskContent=i,e.wrapperChildren=[],r.onTaskDataGenerated(e)}renderer({row:e,record:t}){const r=this,n=r.getTaskBox(t),i={taskRecord:t,task:t,row:e,children:[]};let s;n?(Object.assign(i,{isTask:!0,top:n.top,left:n.left,width:n.width,height:n.height}),r.populateTaskRenderData(i,t),s={className:i.wrapperCls,tabIndex:"0",children:[{className:i.cls,style:(i.internalStyle||"")+(i.style||""),children:i.children,dataset:{taskFeature:"task"},syncOptions:{syncIdField:"taskBarFeature"}},...i.wrapperChildren],style:{transform:`translate(${i.left}px, ${i.top}px)`,width:i.width,zIndex:i.zIndex},dataset:{taskId:i.taskId},elementData:i,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}},r.gantt.trigger("beforeRenderTask",{renderData:i,domConfig:s})):r.populateTaskRenderData(i,t),n||0!==i.extraConfigs.length?r.rowMap.set(e,[s,...i.extraConfigs]):r.rowMap.delete(e)}onRenderDone(){const{gantt:e}=this,t=Array.from(this.rowMap.values()).flat();DomSync.sync({domConfig:{onlyChildren:!0,children:t},targetElement:e.foregroundCanvas,syncIdField:"taskId",callback({action:t,domConfig:r,lastDomConfig:n,targetElement:i}){if("none"!==t&&r&&r.className&&r.className[e.eventCls+"-wrap"]){var s,o;const a=renderEventActions$2[t];if(releaseEventActions$2[t]&&(null==n||null===(s=n.elementData)||void 0===s?void 0:s.isTask)){const t={renderData:n.elementData,taskRecord:n.elementData.taskRecord,element:i};e.trigger("releaseTask",t)}if(a&&(null==r||null===(o=r.elementData)||void 0===o?void 0:o.isTask)){const n={renderData:r.elementData,taskRecord:r.elementData.taskRecord,element:i};n.reusingElement="reuseElement"===t,e.trigger("renderTask",n)}}}})}redraw(e){this.gantt.rowManager.refreshCell(e,this.gantt.timeAxisColumn.id)&&this.onRenderDone()}}NewTaskRendering._$name="NewTaskRendering";const hyphenRe=/-/g;var GanttDom=e=>class extends(e||Base){static get $name(){return"GanttDom"}resolveEventRecord(e){return this.resolveTaskRecord(e)}resolveTaskRecord(e){return(e=DomHelper.up(e,this.eventSelector))?this.taskStore.getById(e.dataset.taskId):null}getElementFromTaskRecord(e,t=!0){return this.taskRendering.getElementFromTaskRecord(e,t)}getElementFromEventRecord(e){return this.getElementFromTaskRecord(e)}getEventRenderId(e){return`${this.id.toString().replace(hyphenRe,"_")}-${e.id}`}getEventData(e){const t=this,r=t.resolveTimeSpanRecord(e.target);if(r){const e=t.getCell({record:r,column:t.timeAxisColumn}),n=DomDataStore.get(e),i=n.id,s=n.columnId;return{cellElement:e,cellData:n,columnId:s,id:i,record:r,cellSelector:{id:i,columnId:s}}}return super.getEventData(e)}get widgetClass(){}},GanttRegions=e=>class extends(e||Base){static get $name(){return"GanttRegions"}getScheduleRegion(e,t){const r=this,n=r.timeAxisSubGridElement;let i;if(e){const t=r.getElementFromTaskRecord(e);if(i=Rectangle.from(r.getRowById(e.id).getElement("locked")),t){const e=Rectangle.from(t,n);i.y=e.y,i.bottom=e.bottom}else i.y=i.y+r.barMargin,i.bottom=i.bottom-r.barMargin}else i=Rectangle.from(n).moveTo(null,0),i.width=n.scrollWidth,i.y=i.y+r.barMargin,i.bottom=i.bottom-r.barMargin;const s=r.timeAxis.startDate,o=r.timeAxis.endDate,a=r.getDateConstraints(e)||{start:s,end:o},l=i.y,c=i.bottom;let d=r.getCoordinateFromDate(DateHelper.max(s,a.start)),u=r.getCoordinateFromDate(DateHelper.min(o,a.end));return t||(d=r.translateToPageCoordinate(d),u=r.translateToPageCoordinate(u)),{top:l,right:Math.max(d,u),bottom:c,left:Math.min(d,u)}}translateToPageCoordinate(e){const t=this.timeAxisSubGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}isRowVisible(e){return this.store.indexOf(e)>=0}getTaskBox(e,t=!1,r=!1){return this.taskRendering.getTaskBox(...arguments)}getSizeAndPosition(){return this.taskRendering.getSizeAndPosition(...arguments)}get widgetClass(){}};const defaultScrollOptions$4={block:"nearest",edgeOffset:20};var GanttScroll=e=>class extends(e||Base){static get $name(){return"GanttScroll"}scrollTaskIntoView(e,t=defaultScrollOptions$4){let r,n=e.startDate,i=e.endDate;const s=this;if(null==t.edgeOffset&&(t.edgeOffset=20),!e.isScheduled)return this.scrollRowIntoView(e,t);n=n||i,i=i||n;const o=n<s.timeAxis.startDate|(i>s.timeAxis.endDate)<<1;if(o&&!1!==t.extendTimeAxis){const e=s.timeAxis.endDate-s.timeAxis.startDate;let t,r;3===o?s.timeAxis.setTimeSpan(new Date(n.valueOf()-e/2),new Date(i.getTime()+e/2)):(t=s.getCoordinateFromDate(1&o?i:n),1&o?s.timeAxis.setTimeSpan(new Date(n),new Date(n.valueOf()+e)):s.timeAxis.setTimeSpan(new Date(i.valueOf()-e),new Date(i)),r=1&o?s.getCoordinateFromDate(i):s.getCoordinateFromDate(n),s.timeAxisSubGrid.scrollable.scrollBy(r-t))}if(r=s.getElementFromTaskRecord(e),r){return s.timeAxisSubGrid.scrollable.scrollIntoView(r,ObjectHelper.assign({silent:!0},t))}return s.scrollUnrenderedTaskIntoView(e,t)}scrollUnrenderedTaskIntoView(e,t=defaultScrollOptions$4){null==t.edgeOffset&&(t.edgeOffset=20);const r=this,n=r.timeAxisSubGrid.scrollable,i=r.getTaskBox(e),s=n.viewport,o=i.translate(s.x-n.x,s.y-n.y);let a=n.scrollIntoView(o,Object.assign({},t,{highlight:!1}));if(t.highlight||t.focus){const n=r.on({renderTask({taskRecord:r,element:i}){r===e&&(n(),a=a.then((()=>{t.highlight&&DomHelper.highlight(i),t.focus&&i.focus()})))}})}else a=Promise.all([a,new Promise((t=>{const n=r.on({renderTask({taskRecord:r}){r===e&&(n(),t())}})}))]);return a}get widgetClass(){}};const copyProperties$1=["barMargin"];var GanttState=e=>class extends(e||Base){static get $name(){return"GanttState"}getState(){const e=this,t=ObjectHelper.copyProperties(super.getState(),e,copyProperties$1);return t.zoomLevel=e.zoomLevel,t.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,centerDate:e.viewportCenterDate,width:e.tickSize},t}applyState(e){e.zoomLevel&&this.zoomToLevel(e.zoomLevel,e.zoomLevelOptions),ObjectHelper.copyProperties(this,e,copyProperties$1),super.applyState(e)}get widgetClass(){}},GanttStores=e=>class extends(ProjectConsumer(e||Base)){static get $name(){return"GanttStores"}static get projectStores(){return{calendarManagerStore:{},resourceStore:{dataName:"resources"},eventStore:{dataName:"events"},dependencyStore:{dataName:"dependencies"},assignmentStore:{dataName:"assignments"}}}static get configurable(){return{projectModelClass:ProjectModel$2,tasks:null,taskStore:null}}construct(){this.onRefreshCallsQueue=[],super.construct(...arguments)}updateProject(e,t){super.updateProject(e,t),this.detachListeners("ganttStores"),e&&e.on({name:"ganttStores",startApplyResponse:"onProjectStartApplyResponse",refresh:"internalOnProjectRefresh",progress:"onProjectProgress",thisObj:this})}get replica(){return this.project.replica}onProjectStartApplyResponse(){this.suspendRefresh()}internalOnProjectRefresh(){const e=this;e.project.enableProgressNotifications&&e.masked&&e.unmask(),e.appliedViewStartDate||"startDate"in e.initialConfig||!e.project.startDate||(e.setTimeSpan(e.project.startDate,e.project.endDate),e.appliedViewStartDate=!0),e.resumeRefresh(!0),e.suspendRendering||(e.refreshAfterProjectRefresh&&(e.refreshWithTransition(),e.refreshAfterProjectRefresh=!1),e.trigger("projectRefresh",{initial:!1}))}get tasks(){return this.project.eventStore.records}changeTasks(e){const{project:t}=this;this.buildingProjectConfig?t.eventsData=e:t.eventStore.data=e}changeTaskStore(e){const{project:t}=this;if(!this.buildingProjectConfig)return this.initializingProject||t.eventStore!==e&&(t.setEventStore(e),e=t.eventStore),e;t.eventStore=e}updateEventStore(e){const t=this;e.metaMapId=t.id,t.taskStore=t.store=t.timeAxisViewModel.store=e,t.currentOrientation.bindTaskStore(e)}get widgetClass(){}},GanttTimelineDateMapper=e=>class extends(e||Base){static get $name(){return"GanttTimelineDateMapper"}getDisplayEndDate(e,t){return e}get widgetClass(){}},TaskNavigation=e=>class extends(e||Base){static get $name(){return"TaskNavigation"}static get defaultConfig(){return{navigator:{inlineFlow:!1,prevKey:"ArrowUp",nextKey:"ArrowDown",keys:{ArrowLeft:()=>{},ArrowRight:()=>{},Enter:"onTaskEnterKey"}}}}processEvent(e){const t=this,r=DomHelper.up(e.target,t.eventSelector);return!t.navigator.disabled&&r&&(e.taskRecord=e.eventRecord=t.resolveTaskRecord(r),"click"===e.type&&t.selectEvent(e.taskRecord,e.ctrlKey||e.metaKey)),e}normalizeTarget(e){return e.taskRecord}selectEvent(e,t=!1){this.selectRow({record:e.id,column:!1,addToSelection:t})}deselectEvent(e){this.deselectRow(e.id)}getNext(e){const t=this,{taskStore:r}=t;for(let n=r.indexOf(e)+1;n<r.count;n++){const e=r.getAt(n);if(t.isInTimeAxis(e))return e}}getPrevious(e){const t=this,{taskStore:r}=t;for(let n=r.indexOf(e)-1;n>=0;n--){const e=r.getAt(n);if(t.isInTimeAxis(e))return e}}set activeEvent(e){this.navigator.activeItem=this.getElementFromTaskRecord(e,!1)}get activeEvent(){const{activeItem:e}=this.navigator;if(e)return this.resolveTaskRecord(e)}async navigateTo(e,t={}){const r=this;e&&(r.navigator.disabled=!0,await r.scrollTaskIntoView(e,{animate:100}).then((()=>{r.navigator.disabled=!1,r.activeEvent=e,r.navigator.trigger("navigate",{event:t,item:r.getElementFromTaskRecord(e,!1)})})))}clearEventSelection(){this.deselectAll()}onTaskEnterKey(){}onDeleteKey(e){const t=e.eventRecord;!this.readOnly&&this.enableDeleteKey&&t&&this.removeRecords([t])}get widgetClass(){}};const emptyObject$2=Object.freeze({});let newTaskCount=0;class GanttBase extends(TimelineBase.mixin(CrudManagerView,GanttDom,GanttRegions,GanttScroll,GanttState,GanttStores,GanttTimelineDateMapper,EventNavigation,TaskNavigation)){static get $name(){return"GanttBase"}static get type(){return"ganttbase"}static get defaultConfig(){return{project:null,resourceImageFolderPath:null,defaultResourceImageName:null,toggleParentTasksOnClick:!0,calendars:null,resources:null,tasks:null,dependencies:null,assignments:null,eventCls:"b-gantt-task",eventBarTextField:null,eventLayout:"none",eventSelectionDisable:!0,eventColor:null,eventStyle:null,rowHeight:45,scheduledEventName:"task",eventScrollMode:"move",overScheduledEventClass:"b-gantt-task-hover",mode:"horizontal",timeCellCls:"b-sch-timeaxis-cell",timeCellSelector:".b-sch-timeaxis-cell",focusCls:"b-active",taskRenderer:null}}static get deprecatedEvents(){return{taskContextMenuBeforeShow:{product:"Gantt",invalidAsOfVersion:"5.0.0",message:"`taskContextMenuBeforeShow` event is deprecated, in favor of `taskMenuBeforeShow` event. Please see https://bryntum.com/docs/gantt/#guides/upgrades/4.0.0.md for more information."},taskContextMenuShow:{product:"Gantt",invalidAsOfVersion:"5.0.0",message:"`taskContextMenuShow` event is deprecated, in favor of `taskMenuShow` event. Please see https://bryntum.com/docs/gantt/#guides/upgrades/4.0.0.md for more information."},taskContextMenuItem:{product:"Gantt",invalidAsOfVersion:"5.0.0",message:"`taskContextMenuItem` event is deprecated, in favor of `taskMenuItem` event. Please see https://bryntum.com/docs/gantt/#guides/upgrades/4.0.0.md for more information."}}}get isGantt(){return!0}construct(e){const t=this,r=Boolean(e.calendars||e.taskStore||e.dependencyStore||e.resourceStore||e.assignmentStore),n=Boolean(e.calendars||e.tasks||e.dependencies||e.resources||e.assignments);e.features||(e.features={}),"tree"in e.features||(e.features.tree=!0),"group"in e.features||(e.features.group=!1);const{project:i}=e;if(i&&(r||n))throw new Error("Providing both project and inline data is not supported");(null==i?void 0:i.isModel)||(e.project=ObjectHelper.assign({calendarsData:e.calendars,eventsData:e.tasks,dependenciesData:e.dependencies,resourcesData:e.resources,assignmentsData:e.assignments,resourceStore:e.resourceStore,eventStore:e.taskStore,assignmentStore:e.assignmentStore,dependencyStore:e.dependencyStore,timeRangeStore:e.timeRangeStore},i),delete e.resourceStore,delete e.taskStore,delete e.assignmentStore,delete e.dependencyStore,delete e.timeRangeStore,delete e.calendars,delete e.resources,delete e.tasks,delete e.assignments,delete e.dependencies),super.construct(e),t.features.cellEdit&&(t.features.cellEdit.addNewAtEnd={name:t.L("L{Gantt.New task}"),startDate:t.project.startDate,duration:1,durationUnit:t.timeAxis.unit}),t.toggleParentTasksOnClick&&t.on("taskclick",t.onTaskBarClick)}get columns(){return super.columns}set columns(e){if(e){let t=e;Array.isArray(e)||(t=e.data,this._thisIsAUsedExpression(this.taskStore)),t.some((e=>{const t=e instanceof Column?e.constructor:ColumnStore.getColumnClass(e.type)||Column;return t===NameColumn||t.prototype instanceof NameColumn}))||t.unshift({type:"name"})}super.columns=e}set timeAxisViewModel(e){super.timeAxisViewModel=e,this.taskStore&&(this.timeAxisViewModel.store=this.taskStore)}get timeAxisViewModel(){return super.timeAxisViewModel}resumeRefresh(e){super.resumeRefresh(!1),!this.refreshSuspended&&e&&(this.rowManager.topRow?this.refreshWithTransition():this.rowManager.reinitialize())}onStoreUpdateRecord(e){if(!this.project.isBatchingChanges){let t;return this.runWithTransition((()=>{t=super.onStoreUpdateRecord(e)})),t}}onStoreDataChange(e){this.runWithTransition((()=>{super.onStoreDataChange(e)}),"batch"===e.action)}onProjectProgress({total:e,remaining:t,phase:r="propagating"}){const n=this;if(n.project.enableProgressNotifications){const i=n.L(r),s=e?`${i} ${e-t} / ${e}`:i;n.masked||n.mask({maxProgress:e,useTransition:!1}),n.masked.text=s,e&&(n.masked.maxProgress=e,n.masked.progress=e-t)}}onTaskDataGenerated(){}onTaskBarClick({taskRecord:e}){e.isLeaf||this.toggleCollapse(e)}triggerChangeEvent(e,t){super.triggerChangeEvent(e,t);const r=this;function n(e,t){const n=r.getElementFromTaskRecord(e);n&&n.classList[t?"add":"remove"]("b-task-selected")}"row"===e.mode&&(e.selected.map((e=>n(e,!0))),e.deselected.map((e=>n(e,!1))))}toggleEmptyText(){const e=this;e.bodyContainer&&DomHelper.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.project.isLoadingOrSyncing))}get currentOrientation(){const e=this;return e._currentOrientation||(e.taskRendering=e._currentOrientation=new NewTaskRendering(e)),e._currentOrientation}getTimeSpanMouseEventParams(e,t){const r=this.resolveTaskRecord(e);return r?{taskRecord:r,taskElement:e,event:t}:null}getScheduleMouseEventParams(e){return{taskRecord:this.store.getById(e.id)}}resolveTimeSpanRecord(e){return this.resolveTaskRecord(e)}repaintEventsForResource(e){this.taskRendering.redraw(e)}populateTaskMenu(){}async addTask(e,t=emptyObject$2){const r=this,{milestone:n,above:i,asChild:s,asPredecessor:o,asSuccessor:a}=t,l=r.project,c=e.parent,d=e.copy();return d.name=n?`${r.L("L{Gantt.New milestone}")} ${++newTaskCount}`:`${r.L("L{Gantt.New task}")} ${++newTaskCount}`,s?e.insertChild(d,e.firstChild):i?e.parent.insertChild(d,e):c.insertChild(d,e.nextSibling),n?(await l.commitAsync(),await d.convertToMilestone()):await l.commitAsync(),a?r.dependencyStore.add({fromEvent:e,toEvent:d,type:DependencyType.EndToStart,fromSide:"right",toSide:"left"}):o&&r.dependencyStore.add({fromEvent:d,toEvent:e,type:DependencyType.EndToStart,fromSide:"right",toSide:"left"}),(a||o)&&await l.propagateAsync(),d}addTaskAbove(e){return this.addTask(e,{above:!0})}addTaskBelow(e){return this.addTask(e)}addMilestonBelow(e){return this.addTask(e,{milestone:!0})}addSubtask(e){const t=this.addTask(e,{asChild:!0});return this.toggleCollapse(e,!1),t}addSuccessor(e){return this.addTask(e,{asSuccessor:!0})}addPredecessor(e){return this.addTask(e,{above:!0,asPredecessor:!0})}async indent(e){const t=this,r=await t.taskStore.indent(e);return r||Toast.show(t.L("L{Gantt.changeRejected}")),r}async outdent(e){const t=this,r=await t.taskStore.outdent(e);return r||Toast.show(t.L("L{Gantt.changeRejected}")),r}}GanttBase.initClass(),VersionHelper.setVersion("gantt","4.0.3"),GanttBase._$name="GanttBase";class TaskDrag extends DragBase{static get $name(){return"TaskDrag"}static get defaultConfig(){return{validatorFn:(e,t,r,n)=>!0,validatorFnThisObj:null,tooltipCls:"b-gantt-taskdrag-tooltip"}}construct(e,t){this.gantt=e,super.construct(e,t)}get store(){return this.gantt.taskStore}isElementDraggable(e,t){const{gantt:r}=this,n=DomHelper.up(e,r.eventSelector),{taskResize:i}=r.features;if(!n)return!1;if(e.matches('[class$="-handle"]'))return!1;const s=r.resolveTaskRecord(n);return!(!s||!s.isDraggable)&&(!(s.resizable&&!s.isMilestone&&(null==i?void 0:i.resize.overAnyHandle(t,n)))&&!1!==r.trigger("beforeTaskDrag",{taskRecord:s}))}triggerEventDrag(e,t){this.gantt.trigger("taskDrag",{taskRecords:e.draggedEntities,startDate:e.startDate,endDate:e.endDate,dragData:e,changed:e.startDate-t!=0})}triggerDragStart(e){this.gantt.trigger("taskDragStart",{taskRecords:e.draggedEntities,dragData:e})}triggerDragAbort(e){this.gantt.trigger("taskDragAbort",{taskRecords:e.draggedEntities,context:e})}triggerAfterDrop(e,t){this.currentOverClient.trigger("afterTaskDrop",{taskRecords:e.draggedEntities,context:e,valid:t})}getProductDragContext(e){return{valid:!0}}setupProductDragData(e){const t=this,r=t.gantt,n=e.element,i=r.resolveTaskRecord(n),s=Rectangle.from(n),o=t.getRelatedRecords(i)||[],a=r.getDateConstraints(i),l=[n];t.setupConstraints(r.getScheduleRegion(i),s,r.timeAxisViewModel.snapPixelAmount,Boolean(a)),o.forEach((e=>{ArrayHelper.include(l,r.getElementFromTaskRecord(e,!1))}));const c=[i,...o];return{record:i,dateConstraints:a,eventBarEls:l,draggedEntities:c}}getCoordinate(e,t,r){return r[0]}checkDragValidity(e,t){return this.validatorFn.call(this.validatorFnThisObj||this,e.draggedEntities,e.startDate,e.duration,t)}isValidDrop(e){return!0}async updateRecords(e){const t=e.draggedEntities[0],r=t.startDate,n=e.startDate,i=t.setStartDate(n,!0);return await i,t.startDate-r?this.gantt.trigger("taskDrop",{taskRecords:e.draggedEntities}):this.dragData.valid=!1,i}getRecordElement(e){return this.gantt.getElementFromTaskRecord(e,!0)}}TaskDrag._$name="TaskDrag",GridFeatureManager.registerFeature(TaskDrag,!0,"Gantt");class TaskDragCreate extends DragCreateBase{static get $name(){return"TaskDragCreate"}static get defaultConfig(){return{preventMultiple:!0,validatorFn:()=>{}}}construct(e,t){this.gantt=e,super.construct(e,t)}get store(){return this.gantt.taskStore}async finalizeDragCreate(e){const{taskRecord:t}=e;t.beginBatch(),t.setStartDate(e.startDate),t.setEndDate(e.endDate),t.endBatch(),await this.gantt.project.commitAsync(),this.gantt.trigger("dragCreateEnd",{taskRecord:t,event:e.event,proxyElement:this.proxy})}handleBeforeDragCreate(e,t){const r=this,n=r.gantt.trigger("beforeDragCreate",{taskRecord:r.createContext.taskRecord,date:e,event:t});if(n){const e=r.gantt.features.scheduleTooltip;var i;if(e)null===(i=e.hoverTip)||void 0===i||i.hide()}return r.dateConstraints=r.gantt.getDateConstraints(r.createContext.rowRecord,e),n}checkValidity(e,t){const r=this;return e.taskRecord=e.rowRecord,r.validatorFn.call(r.validatorFnThisObj||r,e,t)}isRowEmpty(e){return!e.startDate||!e.endDate}}TaskDragCreate._$name="TaskDragCreate",GridFeatureManager.registerFeature(TaskDragCreate,!0,"Gantt");class TaskResize extends ResizeBase{static get $name(){return"TaskResize"}getTimespanRecord(e){return e.taskRecord}getRowRecord(e){return e.taskRecord}setupProductResizeContext(e,t){const r=this.client,n=r.resolveTaskRecord(e.element);Object.assign(e,{taskRecord:n,dateConstraints:r.getDateConstraints(n)})}get store(){return this.client.taskStore}internalUpdateRecord(e,t){const r=t.run("calculateProjectedDuration",e.startDate,e.endDate);return r===t.duration?(e.element.lastDomConfig.style.width=null,!1):(t.setDuration(r),!0)}createResizeHelper(){const e=this,t=e.client;return new ResizeHelper({name:e.constructor.name,isElementResizable:(t,r)=>e.isElementResizable(t,r),targetSelector:t.eventSelector,resizingCls:"b-sch-event-resizing",allowResize:e.isElementResizable.bind(e),outerElement:t.timeAxisSubGridElement,scrollManager:t.scrollManager,leftHandle:!1,dragThreshold:0,dynamicHandleSize:!0,reservedSpace:5,listeners:{beforeresizestart:e.onBeforeResizeStart,resizestart:e.onResizeStart,resizing:e.onResizing,resize:e.onFinishResize,cancel:e.onCancelResize,thisObj:e},highlightHandle(){const e=DomHelper.up(this.currentElement,this.targetSelector),r=DomHelper.up(this.currentElement,t.eventInnerSelector);r&&(r.classList.add("b-resize-handle"),e.classList.add("b-over-resize-handle"))},unHighlightHandle(){const e=DomHelper.up(this.currentElement,this.targetSelector);e&&e.classList.remove("b-over-resize-handle");const r=DomHelper.up(this.currentElement,t.eventInnerSelector);r&&r.classList.remove("b-resize-handle"),this.currentElement=null}})}}TaskResize._$name="TaskResize",GridFeatureManager.registerFeature(TaskResize,!0,"Gantt");class Gantt extends GanttBase{static get $name(){return"Gantt"}static get type(){return"gantt"}}Gantt.initClass(),Gantt._$name="Gantt";class GanttTag extends(window.customElements?HTMLElement:Object){constructor(){super();const e=this,t=[],r={};let n;for(const i of e.children)if("COLUMN"===i.tagName){const e=parseInt(i.dataset.width),r=parseInt(i.dataset.flex),n={field:i.dataset.field,text:i.innerHTML,type:i.dataset.type};e?n.width=e:n.flex=r||1,t.push(n)}else if("PROJECT"===i.tagName)n=new ProjectModel$2({transport:{load:{url:i.dataset.loadUrl}}});else if("FEATURE"===i.tagName){const e=i.dataset.name,t=Object.assign({},i.dataset);delete t.name,Object.keys(t).length?r[e]=t:r[e]="false"!==i.textContent}const i=Object.assign({},e.dataset),s=i.theme||"stockholm",o=this.attachShadow({mode:"open"}),a=document.createElement("link");delete i.theme,a.rel="stylesheet",a.href=`../../build/gantt.${s}.css`,a.onload=()=>{const e=document.createElement("div");e.id="container",e.style.width="100%",e.style.height="100%",o.appendChild(e),setupFocusListeners(o,EventHelper),Object.assign(i,{appendTo:e,columns:t,features:r,project:n});const s=new Gantt(i);n instanceof ProjectModel$2&&n.load(),window.gantt||(window.gantt=s)},o.appendChild(a)}}try{window.customElements&&window.customElements.define("bryntum-gantt",GanttTag)}catch(e){}GanttTag._$name="GanttTag",window.bryntum||(window.bryntum={});export{AbstractCrudManager,ActionColumn,AddNewColumn,AdvancedTab,AggregateColumn,AjaxHelper,AjaxStore,AjaxTransport,AllColumns,ArrayHelper,AssignmentField,AssignmentGrid,AssignmentModel$2 as AssignmentModel,AssignmentPicker,AssignmentStore$2 as AssignmentStore,AssignmentsManipulationModel,AssignmentsManipulationStore,AsyncHelper,Badge,Bag,Bar,Base,Baseline,Baselines,BooleanCombo,BooleanDataField,BrowserHelper,Button,ButtonGroup,CSSHelper,CalendarColumn,CalendarField,CalendarIntervalModel$1 as CalendarIntervalModel,CalendarManagerStore,CalendarModel$1 as CalendarModel,CalendarPanel,CalendarPicker,CellEdit$1 as CellEdit,CellMenu,CellTooltip,CheckColumn,Checkbox,ChipView,ClickRepeater,Collection,CollectionFilter,CollectionSorter,Column,ColumnAutoWidth,ColumnDragToolbar,ColumnLines,ColumnPicker,ColumnReorder,ColumnResize,ColumnStore,Combo,Config,ConstraintDateColumn,ConstraintType,ConstraintTypeColumn,ConstraintTypePicker,Container,ContextMenu,CriticalPaths,CrudManagerView,DataField,DataGenerator,DateColumn,DateDataField,DateField,DateHelper,DatePicker,DateTimeField,DeadlineDateColumn,Delayable,DemoBot,Dependencies$1 as Dependencies,DependencyColumn,DependencyCreation,DependencyEdit$1 as DependencyEdit,DependencyField,DependencyModel$2 as DependencyModel,DependencyStore$2 as DependencyStore,DependencyTab,DependencyTypePicker,DisplayField,DomClassList,DomDataStore,DomHelper,DomSync,DragBase,DragContext,DragHelper,DragProxy,DragTipProxy,Draggable,Droppable,Duration,DurationColumn,DurationField,DynamicObject,EarlyEndDateColumn,EarlyStartDateColumn,Editor,EditorTab,EffortColumn,EffortField,EndDateColumn,EndDateField,EventContextMenu,EventDrag,EventDragCreate,EventDragSelect,EventEdit,EventFilter,EventHelper,EventLoader,EventMenu,EventModeColumn,EventModel$1 as EventModel,EventResize,EventStore$1 as EventStore,EventTooltip,Events,ExcelExporter$1 as ExcelExporter,ExportOrientationCombo,ExportRowsCombo,Factoryable,Featureable,Field,FileField,FileFormat,FilePicker,Filter,FilterBar,FilterField,Finalizable,Footer,FormTab,Formatter,Fullscreen,FunctionHelper,Gantt,GanttBase,GanttDateColumn,MspExport as GanttMspExport,GanttProjectMixin,GanttTag,GanttTaskEditor,GeneralTab,GlobalEvents,Grid,GridBase,ExcelExporter as GridExcelExporter,ExportDialog as GridExportDialog,GridFeatureManager,GroupSummary as GridGroupSummary,MultiPageExporter as GridMultiPageExporter,MultiPageVerticalExporter as GridMultiPageVerticalExporter,PdfExport as GridPdfExport,GridRowModel,SinglePageExporter as GridSinglePageExporter,Summary as GridSummary,Group,GroupSummary$1 as GroupSummary,Header,HeaderContextMenu,HeaderMenu,HeaderZoom,Histogram,HorizontalTimeAxis,Hoverable,IdHelper,Indicators,InstancePlugin,IntegerDataField,JsonEncoder,Labels$1 as Labels,LateEndDateColumn,LateStartDateColumn,List,LocaleHelper,LocaleManagerSingleton as LocaleManager,Localizable,LocalizableCombo,ManuallyScheduledColumn,Mask,Menu,MenuItem,MessageDialogSingleton as MessageDialog,MilestoneColumn,Model,ModelCombo,ModelDataField,Month,MultiPageExporter$2 as MultiPageExporter,MultiPageVerticalExporter$2 as MultiPageVerticalExporter,NameColumn,NonWorkingTime,NoteColumn,NotesTab,NumberDataField,NumberField,NumberFormat,ObjectDataField,ObjectHelper,Objects,Orientation,Override,PagingToolbar,Pan,Panel,PaperFormat,Parser,PartOfProject$1 as PartOfProject,PdfExport$2 as PdfExport,PercentBar,PercentColumn,PercentDoneColumn,PercentDoneMixin,Pluggable,Point,Popup,PredecessorColumn,PredecessorsTab,pm as PresetManager,PresetStore,ProTaskEditStm,ProgressLine,ProjectCrudManager,ProjectGenerator,ProjectLines,ProjectModel$2 as ProjectModel,ProjectModelMixin,ProjectType,Promissory,QuickFind,RandomGenerator,RatingColumn,ReadyStatePropagator,Rectangle,RectangularPathFinder,RegionResize,Renderable,ResizeHelper,ResizeMonitor,ResourceAssignmentColumn,Parser$1 as ResourceAssignmentParser,ResourceCalendarColumn,ResourceHistogram,ResourceInfoColumn,ResourceModel$2 as ResourceModel,ResourceNonWorkingTime,ResourceStore$2 as ResourceStore,ResourceTimeRangeModel,ResourceTimeRangeStore,ResourceTimeRanges,ResourcesTab,Ripple,RollupColumn,Rollups,RowManager,RowNumberColumn,RowReorder,RowsRange,Scale,ScheduleContextMenu,ScheduleMenu,ScheduleRange,ScheduleRangeCombo,ScheduleTableExporter,ScheduleTooltip,Scheduler,SchedulerAdvancedTab,AssignmentModel as SchedulerAssignmentModel,AssignmentStore as SchedulerAssignmentStore,SchedulerBase,CrudManager as SchedulerCrudManager,Dependencies as SchedulerDependencies,DependencyEdit as SchedulerDependencyEdit,DependencyModel as SchedulerDependencyModel,DependencyStore as SchedulerDependencyStore,EventModel as SchedulerEventModel,EventStore as SchedulerEventStore,SchedulerExportDialog,SchedulerGeneralTab,Labels as SchedulerLabels,MultiPageExporter$1 as SchedulerMultiPageExporter,MultiPageVerticalExporter$1 as SchedulerMultiPageVerticalExporter,PdfExport$1 as SchedulerPdfExport,SchedulerPro,AssignmentModel$1 as SchedulerProAssignmentModel,AssignmentStore$1 as SchedulerProAssignmentStore,SchedulerProBase,CalendarIntervalModel as SchedulerProCalendarIntervalModel,CalendarModel as SchedulerProCalendarModel,DependencyModel$1 as SchedulerProDependencyModel,DependencyStore$1 as SchedulerProDependencyStore,ProjectModel$1 as SchedulerProProjectModel,ResourceModel$1 as SchedulerProResourceModel,ResourceStore$1 as SchedulerProResourceStore,TaskEdit as SchedulerProTaskEdit,SchedulerProjectCrudManager,ResourceModel as SchedulerResourceModel,ResourceStore as SchedulerResourceStore,SinglePageExporter$1 as SchedulerSinglePageExporter,SchedulerTaskEditor,TimeAxisColumn as SchedulerTimeAxisColumn,SchedulingMode,SchedulingModeColumn,SchedulingModePicker,ScrollManager,Scroller,Search,SequenceColumn,ShowInTimelineColumn,SimpleEventEdit,SinglePageExporter$2 as SinglePageExporter,Slider,Sort,Splitter,StartDateColumn,StartDateField,State,StateTrackingManager,Store,StringDataField,StringHelper,Stripe,SubGrid,SuccessorColumn,SuccessorsTab,Summary$1 as Summary,TabPanel,TableExporter,TaskContextMenu,TaskEdit$1 as TaskEdit,TaskEditor,TaskEditorBase,TaskMenu,TaskModel,TaskStore,TaskTooltip,TemplateColumn,TemplateHelper,TextAreaField,TextField,TimeAxis,TimeAxisColumn$1 as TimeAxisColumn,TimeAxisHeaderMenu,TimeAxisViewModel,TimeColumn,TimeField,TimePicker,TimeRanges,TimeSpan,TimeSpanMenuBase,TimeSpanRecordContextMenuBase,TimeUnit,Timeline,Toast,Tool,Toolbar,Tooltip,TotalSlackColumn,Transaction,Tree,TreeColumn,TreeGrid,UndoRedo,VersionHelper,ViewPreset,WBSColumn,WbsField,Widget,WidgetColumn,WidgetHelper,later};